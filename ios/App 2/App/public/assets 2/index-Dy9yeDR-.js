function tde(s,r){for(var o=0;o<r.length;o++){const l=r[o];if(typeof l!="string"&&!Array.isArray(l)){for(const u in l)if(u!=="default"&&!(u in s)){const f=Object.getOwnPropertyDescriptor(l,u);f&&Object.defineProperty(s,u,f.get?f:{enumerable:!0,get:()=>l[u]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))l(u);new MutationObserver(u=>{for(const f of u)if(f.type==="childList")for(const E of f.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&l(E)}).observe(document,{childList:!0,subtree:!0});function o(u){const f={};return u.integrity&&(f.integrity=u.integrity),u.referrerPolicy&&(f.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?f.credentials="include":u.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function l(u){if(u.ep)return;u.ep=!0;const f=o(u);fetch(u.href,f)}})();var VT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function sP(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var u8={exports:{}},xb={},h8={exports:{}},yn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var VE=Symbol.for("react.element"),nde=Symbol.for("react.portal"),rde=Symbol.for("react.fragment"),ide=Symbol.for("react.strict_mode"),sde=Symbol.for("react.profiler"),ode=Symbol.for("react.provider"),ade=Symbol.for("react.context"),cde=Symbol.for("react.forward_ref"),lde=Symbol.for("react.suspense"),dde=Symbol.for("react.memo"),ude=Symbol.for("react.lazy"),lG=Symbol.iterator;function hde(s){return s===null||typeof s!="object"?null:(s=lG&&s[lG]||s["@@iterator"],typeof s=="function"?s:null)}var p8={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m8=Object.assign,f8={};function yf(s,r,o){this.props=s,this.context=r,this.refs=f8,this.updater=o||p8}yf.prototype.isReactComponent={};yf.prototype.setState=function(s,r){if(typeof s!="object"&&typeof s!="function"&&s!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,s,r,"setState")};yf.prototype.forceUpdate=function(s){this.updater.enqueueForceUpdate(this,s,"forceUpdate")};function g8(){}g8.prototype=yf.prototype;function oP(s,r,o){this.props=s,this.context=r,this.refs=f8,this.updater=o||p8}var aP=oP.prototype=new g8;aP.constructor=oP;m8(aP,yf.prototype);aP.isPureReactComponent=!0;var dG=Array.isArray,_8=Object.prototype.hasOwnProperty,cP={current:null},E8={key:!0,ref:!0,__self:!0,__source:!0};function v8(s,r,o){var l,u={},f=null,E=null;if(r!=null)for(l in r.ref!==void 0&&(E=r.ref),r.key!==void 0&&(f=""+r.key),r)_8.call(r,l)&&!E8.hasOwnProperty(l)&&(u[l]=r[l]);var T=arguments.length-2;if(T===1)u.children=o;else if(1<T){for(var w=Array(T),A=0;A<T;A++)w[A]=arguments[A+2];u.children=w}if(s&&s.defaultProps)for(l in T=s.defaultProps,T)u[l]===void 0&&(u[l]=T[l]);return{$$typeof:VE,type:s,key:f,ref:E,props:u,_owner:cP.current}}function pde(s,r){return{$$typeof:VE,type:s.type,key:r,ref:s.ref,props:s.props,_owner:s._owner}}function lP(s){return typeof s=="object"&&s!==null&&s.$$typeof===VE}function mde(s){var r={"=":"=0",":":"=2"};return"$"+s.replace(/[=:]/g,function(o){return r[o]})}var uG=/\/+/g;function WN(s,r){return typeof s=="object"&&s!==null&&s.key!=null?mde(""+s.key):r.toString(36)}function d0(s,r,o,l,u){var f=typeof s;(f==="undefined"||f==="boolean")&&(s=null);var E=!1;if(s===null)E=!0;else switch(f){case"string":case"number":E=!0;break;case"object":switch(s.$$typeof){case VE:case nde:E=!0}}if(E)return E=s,u=u(E),s=l===""?"."+WN(E,0):l,dG(u)?(o="",s!=null&&(o=s.replace(uG,"$&/")+"/"),d0(u,r,o,"",function(A){return A})):u!=null&&(lP(u)&&(u=pde(u,o+(!u.key||E&&E.key===u.key?"":(""+u.key).replace(uG,"$&/")+"/")+s)),r.push(u)),1;if(E=0,l=l===""?".":l+":",dG(s))for(var T=0;T<s.length;T++){f=s[T];var w=l+WN(f,T);E+=d0(f,r,o,w,u)}else if(w=hde(s),typeof w=="function")for(s=w.call(s),T=0;!(f=s.next()).done;)f=f.value,w=l+WN(f,T++),E+=d0(f,r,o,w,u);else if(f==="object")throw r=String(s),Error("Objects are not valid as a React child (found: "+(r==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":r)+"). If you meant to render a collection of children, use an array instead.");return E}function FT(s,r,o){if(s==null)return s;var l=[],u=0;return d0(s,l,"","",function(f){return r.call(o,f,u++)}),l}function fde(s){if(s._status===-1){var r=s._result;r=r(),r.then(function(o){(s._status===0||s._status===-1)&&(s._status=1,s._result=o)},function(o){(s._status===0||s._status===-1)&&(s._status=2,s._result=o)}),s._status===-1&&(s._status=0,s._result=r)}if(s._status===1)return s._result.default;throw s._result}var As={current:null},u0={transition:null},gde={ReactCurrentDispatcher:As,ReactCurrentBatchConfig:u0,ReactCurrentOwner:cP};function y8(){throw Error("act(...) is not supported in production builds of React.")}yn.Children={map:FT,forEach:function(s,r,o){FT(s,function(){r.apply(this,arguments)},o)},count:function(s){var r=0;return FT(s,function(){r++}),r},toArray:function(s){return FT(s,function(r){return r})||[]},only:function(s){if(!lP(s))throw Error("React.Children.only expected to receive a single React element child.");return s}};yn.Component=yf;yn.Fragment=rde;yn.Profiler=sde;yn.PureComponent=oP;yn.StrictMode=ide;yn.Suspense=lde;yn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=gde;yn.act=y8;yn.cloneElement=function(s,r,o){if(s==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+s+".");var l=m8({},s.props),u=s.key,f=s.ref,E=s._owner;if(r!=null){if(r.ref!==void 0&&(f=r.ref,E=cP.current),r.key!==void 0&&(u=""+r.key),s.type&&s.type.defaultProps)var T=s.type.defaultProps;for(w in r)_8.call(r,w)&&!E8.hasOwnProperty(w)&&(l[w]=r[w]===void 0&&T!==void 0?T[w]:r[w])}var w=arguments.length-2;if(w===1)l.children=o;else if(1<w){T=Array(w);for(var A=0;A<w;A++)T[A]=arguments[A+2];l.children=T}return{$$typeof:VE,type:s.type,key:u,ref:f,props:l,_owner:E}};yn.createContext=function(s){return s={$$typeof:ade,_currentValue:s,_currentValue2:s,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},s.Provider={$$typeof:ode,_context:s},s.Consumer=s};yn.createElement=v8;yn.createFactory=function(s){var r=v8.bind(null,s);return r.type=s,r};yn.createRef=function(){return{current:null}};yn.forwardRef=function(s){return{$$typeof:cde,render:s}};yn.isValidElement=lP;yn.lazy=function(s){return{$$typeof:ude,_payload:{_status:-1,_result:s},_init:fde}};yn.memo=function(s,r){return{$$typeof:dde,type:s,compare:r===void 0?null:r}};yn.startTransition=function(s){var r=u0.transition;u0.transition={};try{s()}finally{u0.transition=r}};yn.unstable_act=y8;yn.useCallback=function(s,r){return As.current.useCallback(s,r)};yn.useContext=function(s){return As.current.useContext(s)};yn.useDebugValue=function(){};yn.useDeferredValue=function(s){return As.current.useDeferredValue(s)};yn.useEffect=function(s,r){return As.current.useEffect(s,r)};yn.useId=function(){return As.current.useId()};yn.useImperativeHandle=function(s,r,o){return As.current.useImperativeHandle(s,r,o)};yn.useInsertionEffect=function(s,r){return As.current.useInsertionEffect(s,r)};yn.useLayoutEffect=function(s,r){return As.current.useLayoutEffect(s,r)};yn.useMemo=function(s,r){return As.current.useMemo(s,r)};yn.useReducer=function(s,r,o){return As.current.useReducer(s,r,o)};yn.useRef=function(s){return As.current.useRef(s)};yn.useState=function(s){return As.current.useState(s)};yn.useSyncExternalStore=function(s,r,o){return As.current.useSyncExternalStore(s,r,o)};yn.useTransition=function(){return As.current.useTransition()};yn.version="18.3.1";h8.exports=yn;var ce=h8.exports;const dP=sP(ce),_de=tde({__proto__:null,default:dP},[ce]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ede=ce,vde=Symbol.for("react.element"),yde=Symbol.for("react.fragment"),Sde=Object.prototype.hasOwnProperty,Tde=Ede.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,bde={key:!0,ref:!0,__self:!0,__source:!0};function S8(s,r,o){var l,u={},f=null,E=null;o!==void 0&&(f=""+o),r.key!==void 0&&(f=""+r.key),r.ref!==void 0&&(E=r.ref);for(l in r)Sde.call(r,l)&&!bde.hasOwnProperty(l)&&(u[l]=r[l]);if(s&&s.defaultProps)for(l in r=s.defaultProps,r)u[l]===void 0&&(u[l]=r[l]);return{$$typeof:vde,type:s,key:f,ref:E,props:u,_owner:Tde.current}}xb.Fragment=yde;xb.jsx=S8;xb.jsxs=S8;u8.exports=xb;var p=u8.exports,Lx={},T8={exports:{}},So={},b8={exports:{}},R8={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(s){function r(Ge,nt){var pt=Ge.length;Ge.push(nt);e:for(;0<pt;){var ot=pt-1>>>1,Et=Ge[ot];if(0<u(Et,nt))Ge[ot]=nt,Ge[pt]=Et,pt=ot;else break e}}function o(Ge){return Ge.length===0?null:Ge[0]}function l(Ge){if(Ge.length===0)return null;var nt=Ge[0],pt=Ge.pop();if(pt!==nt){Ge[0]=pt;e:for(var ot=0,Et=Ge.length,un=Et>>>1;ot<un;){var In=2*(ot+1)-1,zn=Ge[In],Sr=In+1,Je=Ge[Sr];if(0>u(zn,pt))Sr<Et&&0>u(Je,zn)?(Ge[ot]=Je,Ge[Sr]=pt,ot=Sr):(Ge[ot]=zn,Ge[In]=pt,ot=In);else if(Sr<Et&&0>u(Je,pt))Ge[ot]=Je,Ge[Sr]=pt,ot=Sr;else break e}}return nt}function u(Ge,nt){var pt=Ge.sortIndex-nt.sortIndex;return pt!==0?pt:Ge.id-nt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var f=performance;s.unstable_now=function(){return f.now()}}else{var E=Date,T=E.now();s.unstable_now=function(){return E.now()-T}}var w=[],A=[],U=1,M=null,F=3,Y=!1,J=!1,ae=!1,he=typeof setTimeout=="function"?setTimeout:null,ee=typeof clearTimeout=="function"?clearTimeout:null,W=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Z(Ge){for(var nt=o(A);nt!==null;){if(nt.callback===null)l(A);else if(nt.startTime<=Ge)l(A),nt.sortIndex=nt.expirationTime,r(w,nt);else break;nt=o(A)}}function fe(Ge){if(ae=!1,Z(Ge),!J)if(o(w)!==null)J=!0,on(pe);else{var nt=o(A);nt!==null&&It(fe,nt.startTime-Ge)}}function pe(Ge,nt){J=!1,ae&&(ae=!1,ee(q),q=-1),Y=!0;var pt=F;try{for(Z(nt),M=o(w);M!==null&&(!(M.expirationTime>nt)||Ge&&!le());){var ot=M.callback;if(typeof ot=="function"){M.callback=null,F=M.priorityLevel;var Et=ot(M.expirationTime<=nt);nt=s.unstable_now(),typeof Et=="function"?M.callback=Et:M===o(w)&&l(w),Z(nt)}else l(w);M=o(w)}if(M!==null)var un=!0;else{var In=o(A);In!==null&&It(fe,In.startTime-nt),un=!1}return un}finally{M=null,F=pt,Y=!1}}var Ce=!1,te=null,q=-1,re=5,$=-1;function le(){return!(s.unstable_now()-$<re)}function ue(){if(te!==null){var Ge=s.unstable_now();$=Ge;var nt=!0;try{nt=te(!0,Ge)}finally{nt?ie():(Ce=!1,te=null)}}else Ce=!1}var ie;if(typeof W=="function")ie=function(){W(ue)};else if(typeof MessageChannel<"u"){var tt=new MessageChannel,Ot=tt.port2;tt.port1.onmessage=ue,ie=function(){Ot.postMessage(null)}}else ie=function(){he(ue,0)};function on(Ge){te=Ge,Ce||(Ce=!0,ie())}function It(Ge,nt){q=he(function(){Ge(s.unstable_now())},nt)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(Ge){Ge.callback=null},s.unstable_continueExecution=function(){J||Y||(J=!0,on(pe))},s.unstable_forceFrameRate=function(Ge){0>Ge||125<Ge?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):re=0<Ge?Math.floor(1e3/Ge):5},s.unstable_getCurrentPriorityLevel=function(){return F},s.unstable_getFirstCallbackNode=function(){return o(w)},s.unstable_next=function(Ge){switch(F){case 1:case 2:case 3:var nt=3;break;default:nt=F}var pt=F;F=nt;try{return Ge()}finally{F=pt}},s.unstable_pauseExecution=function(){},s.unstable_requestPaint=function(){},s.unstable_runWithPriority=function(Ge,nt){switch(Ge){case 1:case 2:case 3:case 4:case 5:break;default:Ge=3}var pt=F;F=Ge;try{return nt()}finally{F=pt}},s.unstable_scheduleCallback=function(Ge,nt,pt){var ot=s.unstable_now();switch(typeof pt=="object"&&pt!==null?(pt=pt.delay,pt=typeof pt=="number"&&0<pt?ot+pt:ot):pt=ot,Ge){case 1:var Et=-1;break;case 2:Et=250;break;case 5:Et=1073741823;break;case 4:Et=1e4;break;default:Et=5e3}return Et=pt+Et,Ge={id:U++,callback:nt,priorityLevel:Ge,startTime:pt,expirationTime:Et,sortIndex:-1},pt>ot?(Ge.sortIndex=pt,r(A,Ge),o(w)===null&&Ge===o(A)&&(ae?(ee(q),q=-1):ae=!0,It(fe,pt-ot))):(Ge.sortIndex=Et,r(w,Ge),J||Y||(J=!0,on(pe))),Ge},s.unstable_shouldYield=le,s.unstable_wrapCallback=function(Ge){var nt=F;return function(){var pt=F;F=nt;try{return Ge.apply(this,arguments)}finally{F=pt}}}})(R8);b8.exports=R8;var Rde=b8.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wde=ce,yo=Rde;function ze(s){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+s,o=1;o<arguments.length;o++)r+="&args[]="+encodeURIComponent(arguments[o]);return"Minified React error #"+s+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var w8=new Set,aE={};function Bh(s,r){tf(s,r),tf(s+"Capture",r)}function tf(s,r){for(aE[s]=r,s=0;s<r.length;s++)w8.add(r[s])}var El=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Mx=Object.prototype.hasOwnProperty,Cde=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,hG={},pG={};function Ide(s){return Mx.call(pG,s)?!0:Mx.call(hG,s)?!1:Cde.test(s)?pG[s]=!0:(hG[s]=!0,!1)}function Ade(s,r,o,l){if(o!==null&&o.type===0)return!1;switch(typeof r){case"function":case"symbol":return!0;case"boolean":return l?!1:o!==null?!o.acceptsBooleans:(s=s.toLowerCase().slice(0,5),s!=="data-"&&s!=="aria-");default:return!1}}function Nde(s,r,o,l){if(r===null||typeof r>"u"||Ade(s,r,o,l))return!0;if(l)return!1;if(o!==null)switch(o.type){case 3:return!r;case 4:return r===!1;case 5:return isNaN(r);case 6:return isNaN(r)||1>r}return!1}function Ns(s,r,o,l,u,f,E){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=l,this.attributeNamespace=u,this.mustUseProperty=o,this.propertyName=s,this.type=r,this.sanitizeURL=f,this.removeEmptyString=E}var Xi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(s){Xi[s]=new Ns(s,0,!1,s,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(s){var r=s[0];Xi[r]=new Ns(r,1,!1,s[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(s){Xi[s]=new Ns(s,2,!1,s.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(s){Xi[s]=new Ns(s,2,!1,s,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(s){Xi[s]=new Ns(s,3,!1,s.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(s){Xi[s]=new Ns(s,3,!0,s,null,!1,!1)});["capture","download"].forEach(function(s){Xi[s]=new Ns(s,4,!1,s,null,!1,!1)});["cols","rows","size","span"].forEach(function(s){Xi[s]=new Ns(s,6,!1,s,null,!1,!1)});["rowSpan","start"].forEach(function(s){Xi[s]=new Ns(s,5,!1,s.toLowerCase(),null,!1,!1)});var uP=/[\-:]([a-z])/g;function hP(s){return s[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(s){var r=s.replace(uP,hP);Xi[r]=new Ns(r,1,!1,s,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(s){var r=s.replace(uP,hP);Xi[r]=new Ns(r,1,!1,s,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(s){var r=s.replace(uP,hP);Xi[r]=new Ns(r,1,!1,s,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(s){Xi[s]=new Ns(s,1,!1,s.toLowerCase(),null,!1,!1)});Xi.xlinkHref=new Ns("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(s){Xi[s]=new Ns(s,1,!1,s.toLowerCase(),null,!0,!0)});function pP(s,r,o,l){var u=Xi.hasOwnProperty(r)?Xi[r]:null;(u!==null?u.type!==0:l||!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(Nde(r,o,u,l)&&(o=null),l||u===null?Ide(r)&&(o===null?s.removeAttribute(r):s.setAttribute(r,""+o)):u.mustUseProperty?s[u.propertyName]=o===null?u.type===3?!1:"":o:(r=u.attributeName,l=u.attributeNamespace,o===null?s.removeAttribute(r):(u=u.type,o=u===3||u===4&&o===!0?"":""+o,l?s.setAttributeNS(l,r,o):s.setAttribute(r,o))))}var Il=wde.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,BT=Symbol.for("react.element"),Pm=Symbol.for("react.portal"),Dm=Symbol.for("react.fragment"),mP=Symbol.for("react.strict_mode"),Ux=Symbol.for("react.profiler"),C8=Symbol.for("react.provider"),I8=Symbol.for("react.context"),fP=Symbol.for("react.forward_ref"),jx=Symbol.for("react.suspense"),Vx=Symbol.for("react.suspense_list"),gP=Symbol.for("react.memo"),Td=Symbol.for("react.lazy"),A8=Symbol.for("react.offscreen"),mG=Symbol.iterator;function R_(s){return s===null||typeof s!="object"?null:(s=mG&&s[mG]||s["@@iterator"],typeof s=="function"?s:null)}var Br=Object.assign,zN;function D_(s){if(zN===void 0)try{throw Error()}catch(o){var r=o.stack.trim().match(/\n( *(at )?)/);zN=r&&r[1]||""}return`
`+zN+s}var HN=!1;function KN(s,r){if(!s||HN)return"";HN=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(r)if(r=function(){throw Error()},Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(r,[])}catch(A){var l=A}Reflect.construct(s,[],r)}else{try{r.call()}catch(A){l=A}s.call(r.prototype)}else{try{throw Error()}catch(A){l=A}s()}}catch(A){if(A&&l&&typeof A.stack=="string"){for(var u=A.stack.split(`
`),f=l.stack.split(`
`),E=u.length-1,T=f.length-1;1<=E&&0<=T&&u[E]!==f[T];)T--;for(;1<=E&&0<=T;E--,T--)if(u[E]!==f[T]){if(E!==1||T!==1)do if(E--,T--,0>T||u[E]!==f[T]){var w=`
`+u[E].replace(" at new "," at ");return s.displayName&&w.includes("<anonymous>")&&(w=w.replace("<anonymous>",s.displayName)),w}while(1<=E&&0<=T);break}}}finally{HN=!1,Error.prepareStackTrace=o}return(s=s?s.displayName||s.name:"")?D_(s):""}function xde(s){switch(s.tag){case 5:return D_(s.type);case 16:return D_("Lazy");case 13:return D_("Suspense");case 19:return D_("SuspenseList");case 0:case 2:case 15:return s=KN(s.type,!1),s;case 11:return s=KN(s.type.render,!1),s;case 1:return s=KN(s.type,!0),s;default:return""}}function Fx(s){if(s==null)return null;if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case Dm:return"Fragment";case Pm:return"Portal";case Ux:return"Profiler";case mP:return"StrictMode";case jx:return"Suspense";case Vx:return"SuspenseList"}if(typeof s=="object")switch(s.$$typeof){case I8:return(s.displayName||"Context")+".Consumer";case C8:return(s._context.displayName||"Context")+".Provider";case fP:var r=s.render;return s=s.displayName,s||(s=r.displayName||r.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case gP:return r=s.displayName||null,r!==null?r:Fx(s.type)||"Memo";case Td:r=s._payload,s=s._init;try{return Fx(s(r))}catch{}}return null}function Ode(s){var r=s.type;switch(s.tag){case 24:return"Cache";case 9:return(r.displayName||"Context")+".Consumer";case 10:return(r._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return s=r.render,s=s.displayName||s.name||"",r.displayName||(s!==""?"ForwardRef("+s+")":"ForwardRef");case 7:return"Fragment";case 5:return r;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Fx(r);case 8:return r===mP?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r}return null}function Yd(s){switch(typeof s){case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function N8(s){var r=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function Pde(s){var r=N8(s)?"checked":"value",o=Object.getOwnPropertyDescriptor(s.constructor.prototype,r),l=""+s[r];if(!s.hasOwnProperty(r)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var u=o.get,f=o.set;return Object.defineProperty(s,r,{configurable:!0,get:function(){return u.call(this)},set:function(E){l=""+E,f.call(this,E)}}),Object.defineProperty(s,r,{enumerable:o.enumerable}),{getValue:function(){return l},setValue:function(E){l=""+E},stopTracking:function(){s._valueTracker=null,delete s[r]}}}}function GT(s){s._valueTracker||(s._valueTracker=Pde(s))}function x8(s){if(!s)return!1;var r=s._valueTracker;if(!r)return!0;var o=r.getValue(),l="";return s&&(l=N8(s)?s.checked?"true":"false":s.value),s=l,s!==o?(r.setValue(s),!0):!1}function D0(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}function Bx(s,r){var o=r.checked;return Br({},r,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:o??s._wrapperState.initialChecked})}function fG(s,r){var o=r.defaultValue==null?"":r.defaultValue,l=r.checked!=null?r.checked:r.defaultChecked;o=Yd(r.value!=null?r.value:o),s._wrapperState={initialChecked:l,initialValue:o,controlled:r.type==="checkbox"||r.type==="radio"?r.checked!=null:r.value!=null}}function O8(s,r){r=r.checked,r!=null&&pP(s,"checked",r,!1)}function Gx(s,r){O8(s,r);var o=Yd(r.value),l=r.type;if(o!=null)l==="number"?(o===0&&s.value===""||s.value!=o)&&(s.value=""+o):s.value!==""+o&&(s.value=""+o);else if(l==="submit"||l==="reset"){s.removeAttribute("value");return}r.hasOwnProperty("value")?Wx(s,r.type,o):r.hasOwnProperty("defaultValue")&&Wx(s,r.type,Yd(r.defaultValue)),r.checked==null&&r.defaultChecked!=null&&(s.defaultChecked=!!r.defaultChecked)}function gG(s,r,o){if(r.hasOwnProperty("value")||r.hasOwnProperty("defaultValue")){var l=r.type;if(!(l!=="submit"&&l!=="reset"||r.value!==void 0&&r.value!==null))return;r=""+s._wrapperState.initialValue,o||r===s.value||(s.value=r),s.defaultValue=r}o=s.name,o!==""&&(s.name=""),s.defaultChecked=!!s._wrapperState.initialChecked,o!==""&&(s.name=o)}function Wx(s,r,o){(r!=="number"||D0(s.ownerDocument)!==s)&&(o==null?s.defaultValue=""+s._wrapperState.initialValue:s.defaultValue!==""+o&&(s.defaultValue=""+o))}var k_=Array.isArray;function zm(s,r,o,l){if(s=s.options,r){r={};for(var u=0;u<o.length;u++)r["$"+o[u]]=!0;for(o=0;o<s.length;o++)u=r.hasOwnProperty("$"+s[o].value),s[o].selected!==u&&(s[o].selected=u),u&&l&&(s[o].defaultSelected=!0)}else{for(o=""+Yd(o),r=null,u=0;u<s.length;u++){if(s[u].value===o){s[u].selected=!0,l&&(s[u].defaultSelected=!0);return}r!==null||s[u].disabled||(r=s[u])}r!==null&&(r.selected=!0)}}function zx(s,r){if(r.dangerouslySetInnerHTML!=null)throw Error(ze(91));return Br({},r,{value:void 0,defaultValue:void 0,children:""+s._wrapperState.initialValue})}function _G(s,r){var o=r.value;if(o==null){if(o=r.children,r=r.defaultValue,o!=null){if(r!=null)throw Error(ze(92));if(k_(o)){if(1<o.length)throw Error(ze(93));o=o[0]}r=o}r==null&&(r=""),o=r}s._wrapperState={initialValue:Yd(o)}}function P8(s,r){var o=Yd(r.value),l=Yd(r.defaultValue);o!=null&&(o=""+o,o!==s.value&&(s.value=o),r.defaultValue==null&&s.defaultValue!==o&&(s.defaultValue=o)),l!=null&&(s.defaultValue=""+l)}function EG(s){var r=s.textContent;r===s._wrapperState.initialValue&&r!==""&&r!==null&&(s.value=r)}function D8(s){switch(s){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Hx(s,r){return s==null||s==="http://www.w3.org/1999/xhtml"?D8(r):s==="http://www.w3.org/2000/svg"&&r==="foreignObject"?"http://www.w3.org/1999/xhtml":s}var WT,k8=function(s){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(r,o,l,u){MSApp.execUnsafeLocalFunction(function(){return s(r,o,l,u)})}:s}(function(s,r){if(s.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in s)s.innerHTML=r;else{for(WT=WT||document.createElement("div"),WT.innerHTML="<svg>"+r.valueOf().toString()+"</svg>",r=WT.firstChild;s.firstChild;)s.removeChild(s.firstChild);for(;r.firstChild;)s.appendChild(r.firstChild)}});function cE(s,r){if(r){var o=s.firstChild;if(o&&o===s.lastChild&&o.nodeType===3){o.nodeValue=r;return}}s.textContent=r}var H_={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Dde=["Webkit","ms","Moz","O"];Object.keys(H_).forEach(function(s){Dde.forEach(function(r){r=r+s.charAt(0).toUpperCase()+s.substring(1),H_[r]=H_[s]})});function L8(s,r,o){return r==null||typeof r=="boolean"||r===""?"":o||typeof r!="number"||r===0||H_.hasOwnProperty(s)&&H_[s]?(""+r).trim():r+"px"}function M8(s,r){s=s.style;for(var o in r)if(r.hasOwnProperty(o)){var l=o.indexOf("--")===0,u=L8(o,r[o],l);o==="float"&&(o="cssFloat"),l?s.setProperty(o,u):s[o]=u}}var kde=Br({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Kx(s,r){if(r){if(kde[s]&&(r.children!=null||r.dangerouslySetInnerHTML!=null))throw Error(ze(137,s));if(r.dangerouslySetInnerHTML!=null){if(r.children!=null)throw Error(ze(60));if(typeof r.dangerouslySetInnerHTML!="object"||!("__html"in r.dangerouslySetInnerHTML))throw Error(ze(61))}if(r.style!=null&&typeof r.style!="object")throw Error(ze(62))}}function qx(s,r){if(s.indexOf("-")===-1)return typeof r.is=="string";switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Yx=null;function _P(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Xx=null,Hm=null,Km=null;function vG(s){if(s=GE(s)){if(typeof Xx!="function")throw Error(ze(280));var r=s.stateNode;r&&(r=Lb(r),Xx(s.stateNode,s.type,r))}}function U8(s){Hm?Km?Km.push(s):Km=[s]:Hm=s}function j8(){if(Hm){var s=Hm,r=Km;if(Km=Hm=null,vG(s),r)for(s=0;s<r.length;s++)vG(r[s])}}function V8(s,r){return s(r)}function F8(){}var qN=!1;function B8(s,r,o){if(qN)return s(r,o);qN=!0;try{return V8(s,r,o)}finally{qN=!1,(Hm!==null||Km!==null)&&(F8(),j8())}}function lE(s,r){var o=s.stateNode;if(o===null)return null;var l=Lb(o);if(l===null)return null;o=l[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(s=s.type,l=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!l;break e;default:s=!1}if(s)return null;if(o&&typeof o!="function")throw Error(ze(231,r,typeof o));return o}var Jx=!1;if(El)try{var w_={};Object.defineProperty(w_,"passive",{get:function(){Jx=!0}}),window.addEventListener("test",w_,w_),window.removeEventListener("test",w_,w_)}catch{Jx=!1}function Lde(s,r,o,l,u,f,E,T,w){var A=Array.prototype.slice.call(arguments,3);try{r.apply(o,A)}catch(U){this.onError(U)}}var K_=!1,k0=null,L0=!1,Qx=null,Mde={onError:function(s){K_=!0,k0=s}};function Ude(s,r,o,l,u,f,E,T,w){K_=!1,k0=null,Lde.apply(Mde,arguments)}function jde(s,r,o,l,u,f,E,T,w){if(Ude.apply(this,arguments),K_){if(K_){var A=k0;K_=!1,k0=null}else throw Error(ze(198));L0||(L0=!0,Qx=A)}}function Gh(s){var r=s,o=s;if(s.alternate)for(;r.return;)r=r.return;else{s=r;do r=s,r.flags&4098&&(o=r.return),s=r.return;while(s)}return r.tag===3?o:null}function G8(s){if(s.tag===13){var r=s.memoizedState;if(r===null&&(s=s.alternate,s!==null&&(r=s.memoizedState)),r!==null)return r.dehydrated}return null}function yG(s){if(Gh(s)!==s)throw Error(ze(188))}function Vde(s){var r=s.alternate;if(!r){if(r=Gh(s),r===null)throw Error(ze(188));return r!==s?null:s}for(var o=s,l=r;;){var u=o.return;if(u===null)break;var f=u.alternate;if(f===null){if(l=u.return,l!==null){o=l;continue}break}if(u.child===f.child){for(f=u.child;f;){if(f===o)return yG(u),s;if(f===l)return yG(u),r;f=f.sibling}throw Error(ze(188))}if(o.return!==l.return)o=u,l=f;else{for(var E=!1,T=u.child;T;){if(T===o){E=!0,o=u,l=f;break}if(T===l){E=!0,l=u,o=f;break}T=T.sibling}if(!E){for(T=f.child;T;){if(T===o){E=!0,o=f,l=u;break}if(T===l){E=!0,l=f,o=u;break}T=T.sibling}if(!E)throw Error(ze(189))}}if(o.alternate!==l)throw Error(ze(190))}if(o.tag!==3)throw Error(ze(188));return o.stateNode.current===o?s:r}function W8(s){return s=Vde(s),s!==null?z8(s):null}function z8(s){if(s.tag===5||s.tag===6)return s;for(s=s.child;s!==null;){var r=z8(s);if(r!==null)return r;s=s.sibling}return null}var H8=yo.unstable_scheduleCallback,SG=yo.unstable_cancelCallback,Fde=yo.unstable_shouldYield,Bde=yo.unstable_requestPaint,$r=yo.unstable_now,Gde=yo.unstable_getCurrentPriorityLevel,EP=yo.unstable_ImmediatePriority,K8=yo.unstable_UserBlockingPriority,M0=yo.unstable_NormalPriority,Wde=yo.unstable_LowPriority,q8=yo.unstable_IdlePriority,Ob=null,bc=null;function zde(s){if(bc&&typeof bc.onCommitFiberRoot=="function")try{bc.onCommitFiberRoot(Ob,s,void 0,(s.current.flags&128)===128)}catch{}}var La=Math.clz32?Math.clz32:qde,Hde=Math.log,Kde=Math.LN2;function qde(s){return s>>>=0,s===0?32:31-(Hde(s)/Kde|0)|0}var zT=64,HT=4194304;function L_(s){switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return s&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return s}}function U0(s,r){var o=s.pendingLanes;if(o===0)return 0;var l=0,u=s.suspendedLanes,f=s.pingedLanes,E=o&268435455;if(E!==0){var T=E&~u;T!==0?l=L_(T):(f&=E,f!==0&&(l=L_(f)))}else E=o&~u,E!==0?l=L_(E):f!==0&&(l=L_(f));if(l===0)return 0;if(r!==0&&r!==l&&!(r&u)&&(u=l&-l,f=r&-r,u>=f||u===16&&(f&4194240)!==0))return r;if(l&4&&(l|=o&16),r=s.entangledLanes,r!==0)for(s=s.entanglements,r&=l;0<r;)o=31-La(r),u=1<<o,l|=s[o],r&=~u;return l}function Yde(s,r){switch(s){case 1:case 2:case 4:return r+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Xde(s,r){for(var o=s.suspendedLanes,l=s.pingedLanes,u=s.expirationTimes,f=s.pendingLanes;0<f;){var E=31-La(f),T=1<<E,w=u[E];w===-1?(!(T&o)||T&l)&&(u[E]=Yde(T,r)):w<=r&&(s.expiredLanes|=T),f&=~T}}function $x(s){return s=s.pendingLanes&-1073741825,s!==0?s:s&1073741824?1073741824:0}function Y8(){var s=zT;return zT<<=1,!(zT&4194240)&&(zT=64),s}function YN(s){for(var r=[],o=0;31>o;o++)r.push(s);return r}function FE(s,r,o){s.pendingLanes|=r,r!==536870912&&(s.suspendedLanes=0,s.pingedLanes=0),s=s.eventTimes,r=31-La(r),s[r]=o}function Jde(s,r){var o=s.pendingLanes&~r;s.pendingLanes=r,s.suspendedLanes=0,s.pingedLanes=0,s.expiredLanes&=r,s.mutableReadLanes&=r,s.entangledLanes&=r,r=s.entanglements;var l=s.eventTimes;for(s=s.expirationTimes;0<o;){var u=31-La(o),f=1<<u;r[u]=0,l[u]=-1,s[u]=-1,o&=~f}}function vP(s,r){var o=s.entangledLanes|=r;for(s=s.entanglements;o;){var l=31-La(o),u=1<<l;u&r|s[l]&r&&(s[l]|=r),o&=~u}}var Xn=0;function X8(s){return s&=-s,1<s?4<s?s&268435455?16:536870912:4:1}var J8,yP,Q8,$8,Z8,Zx=!1,KT=[],kd=null,Ld=null,Md=null,dE=new Map,uE=new Map,wd=[],Qde="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function TG(s,r){switch(s){case"focusin":case"focusout":kd=null;break;case"dragenter":case"dragleave":Ld=null;break;case"mouseover":case"mouseout":Md=null;break;case"pointerover":case"pointerout":dE.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":uE.delete(r.pointerId)}}function C_(s,r,o,l,u,f){return s===null||s.nativeEvent!==f?(s={blockedOn:r,domEventName:o,eventSystemFlags:l,nativeEvent:f,targetContainers:[u]},r!==null&&(r=GE(r),r!==null&&yP(r)),s):(s.eventSystemFlags|=l,r=s.targetContainers,u!==null&&r.indexOf(u)===-1&&r.push(u),s)}function $de(s,r,o,l,u){switch(r){case"focusin":return kd=C_(kd,s,r,o,l,u),!0;case"dragenter":return Ld=C_(Ld,s,r,o,l,u),!0;case"mouseover":return Md=C_(Md,s,r,o,l,u),!0;case"pointerover":var f=u.pointerId;return dE.set(f,C_(dE.get(f)||null,s,r,o,l,u)),!0;case"gotpointercapture":return f=u.pointerId,uE.set(f,C_(uE.get(f)||null,s,r,o,l,u)),!0}return!1}function eH(s){var r=_h(s.target);if(r!==null){var o=Gh(r);if(o!==null){if(r=o.tag,r===13){if(r=G8(o),r!==null){s.blockedOn=r,Z8(s.priority,function(){Q8(o)});return}}else if(r===3&&o.stateNode.current.memoizedState.isDehydrated){s.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}s.blockedOn=null}function h0(s){if(s.blockedOn!==null)return!1;for(var r=s.targetContainers;0<r.length;){var o=eO(s.domEventName,s.eventSystemFlags,r[0],s.nativeEvent);if(o===null){o=s.nativeEvent;var l=new o.constructor(o.type,o);Yx=l,o.target.dispatchEvent(l),Yx=null}else return r=GE(o),r!==null&&yP(r),s.blockedOn=o,!1;r.shift()}return!0}function bG(s,r,o){h0(s)&&o.delete(r)}function Zde(){Zx=!1,kd!==null&&h0(kd)&&(kd=null),Ld!==null&&h0(Ld)&&(Ld=null),Md!==null&&h0(Md)&&(Md=null),dE.forEach(bG),uE.forEach(bG)}function I_(s,r){s.blockedOn===r&&(s.blockedOn=null,Zx||(Zx=!0,yo.unstable_scheduleCallback(yo.unstable_NormalPriority,Zde)))}function hE(s){function r(u){return I_(u,s)}if(0<KT.length){I_(KT[0],s);for(var o=1;o<KT.length;o++){var l=KT[o];l.blockedOn===s&&(l.blockedOn=null)}}for(kd!==null&&I_(kd,s),Ld!==null&&I_(Ld,s),Md!==null&&I_(Md,s),dE.forEach(r),uE.forEach(r),o=0;o<wd.length;o++)l=wd[o],l.blockedOn===s&&(l.blockedOn=null);for(;0<wd.length&&(o=wd[0],o.blockedOn===null);)eH(o),o.blockedOn===null&&wd.shift()}var qm=Il.ReactCurrentBatchConfig,j0=!0;function eue(s,r,o,l){var u=Xn,f=qm.transition;qm.transition=null;try{Xn=1,SP(s,r,o,l)}finally{Xn=u,qm.transition=f}}function tue(s,r,o,l){var u=Xn,f=qm.transition;qm.transition=null;try{Xn=4,SP(s,r,o,l)}finally{Xn=u,qm.transition=f}}function SP(s,r,o,l){if(j0){var u=eO(s,r,o,l);if(u===null)ix(s,r,l,V0,o),TG(s,l);else if($de(u,s,r,o,l))l.stopPropagation();else if(TG(s,l),r&4&&-1<Qde.indexOf(s)){for(;u!==null;){var f=GE(u);if(f!==null&&J8(f),f=eO(s,r,o,l),f===null&&ix(s,r,l,V0,o),f===u)break;u=f}u!==null&&l.stopPropagation()}else ix(s,r,l,null,o)}}var V0=null;function eO(s,r,o,l){if(V0=null,s=_P(l),s=_h(s),s!==null)if(r=Gh(s),r===null)s=null;else if(o=r.tag,o===13){if(s=G8(r),s!==null)return s;s=null}else if(o===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;s=null}else r!==s&&(s=null);return V0=s,null}function tH(s){switch(s){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Gde()){case EP:return 1;case K8:return 4;case M0:case Wde:return 16;case q8:return 536870912;default:return 16}default:return 16}}var xd=null,TP=null,p0=null;function nH(){if(p0)return p0;var s,r=TP,o=r.length,l,u="value"in xd?xd.value:xd.textContent,f=u.length;for(s=0;s<o&&r[s]===u[s];s++);var E=o-s;for(l=1;l<=E&&r[o-l]===u[f-l];l++);return p0=u.slice(s,1<l?1-l:void 0)}function m0(s){var r=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&r===13&&(s=13)):s=r,s===10&&(s=13),32<=s||s===13?s:0}function qT(){return!0}function RG(){return!1}function To(s){function r(o,l,u,f,E){this._reactName=o,this._targetInst=u,this.type=l,this.nativeEvent=f,this.target=E,this.currentTarget=null;for(var T in s)s.hasOwnProperty(T)&&(o=s[T],this[T]=o?o(f):f[T]);return this.isDefaultPrevented=(f.defaultPrevented!=null?f.defaultPrevented:f.returnValue===!1)?qT:RG,this.isPropagationStopped=RG,this}return Br(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=qT)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=qT)},persist:function(){},isPersistent:qT}),r}var Sf={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},bP=To(Sf),BE=Br({},Sf,{view:0,detail:0}),nue=To(BE),XN,JN,A_,Pb=Br({},BE,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:RP,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==A_&&(A_&&s.type==="mousemove"?(XN=s.screenX-A_.screenX,JN=s.screenY-A_.screenY):JN=XN=0,A_=s),XN)},movementY:function(s){return"movementY"in s?s.movementY:JN}}),wG=To(Pb),rue=Br({},Pb,{dataTransfer:0}),iue=To(rue),sue=Br({},BE,{relatedTarget:0}),QN=To(sue),oue=Br({},Sf,{animationName:0,elapsedTime:0,pseudoElement:0}),aue=To(oue),cue=Br({},Sf,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),lue=To(cue),due=Br({},Sf,{data:0}),CG=To(due),uue={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hue={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},pue={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function mue(s){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(s):(s=pue[s])?!!r[s]:!1}function RP(){return mue}var fue=Br({},BE,{key:function(s){if(s.key){var r=uue[s.key]||s.key;if(r!=="Unidentified")return r}return s.type==="keypress"?(s=m0(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?hue[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:RP,charCode:function(s){return s.type==="keypress"?m0(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?m0(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),gue=To(fue),_ue=Br({},Pb,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),IG=To(_ue),Eue=Br({},BE,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:RP}),vue=To(Eue),yue=Br({},Sf,{propertyName:0,elapsedTime:0,pseudoElement:0}),Sue=To(yue),Tue=Br({},Pb,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),bue=To(Tue),Rue=[9,13,27,32],wP=El&&"CompositionEvent"in window,q_=null;El&&"documentMode"in document&&(q_=document.documentMode);var wue=El&&"TextEvent"in window&&!q_,rH=El&&(!wP||q_&&8<q_&&11>=q_),AG=" ",NG=!1;function iH(s,r){switch(s){case"keyup":return Rue.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function sH(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var km=!1;function Cue(s,r){switch(s){case"compositionend":return sH(r);case"keypress":return r.which!==32?null:(NG=!0,AG);case"textInput":return s=r.data,s===AG&&NG?null:s;default:return null}}function Iue(s,r){if(km)return s==="compositionend"||!wP&&iH(s,r)?(s=nH(),p0=TP=xd=null,km=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return rH&&r.locale!=="ko"?null:r.data;default:return null}}var Aue={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function xG(s){var r=s&&s.nodeName&&s.nodeName.toLowerCase();return r==="input"?!!Aue[s.type]:r==="textarea"}function oH(s,r,o,l){U8(l),r=F0(r,"onChange"),0<r.length&&(o=new bP("onChange","change",null,o,l),s.push({event:o,listeners:r}))}var Y_=null,pE=null;function Nue(s){_H(s,0)}function Db(s){var r=Um(s);if(x8(r))return s}function xue(s,r){if(s==="change")return r}var aH=!1;if(El){var $N;if(El){var ZN="oninput"in document;if(!ZN){var OG=document.createElement("div");OG.setAttribute("oninput","return;"),ZN=typeof OG.oninput=="function"}$N=ZN}else $N=!1;aH=$N&&(!document.documentMode||9<document.documentMode)}function PG(){Y_&&(Y_.detachEvent("onpropertychange",cH),pE=Y_=null)}function cH(s){if(s.propertyName==="value"&&Db(pE)){var r=[];oH(r,pE,s,_P(s)),B8(Nue,r)}}function Oue(s,r,o){s==="focusin"?(PG(),Y_=r,pE=o,Y_.attachEvent("onpropertychange",cH)):s==="focusout"&&PG()}function Pue(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Db(pE)}function Due(s,r){if(s==="click")return Db(r)}function kue(s,r){if(s==="input"||s==="change")return Db(r)}function Lue(s,r){return s===r&&(s!==0||1/s===1/r)||s!==s&&r!==r}var Fa=typeof Object.is=="function"?Object.is:Lue;function mE(s,r){if(Fa(s,r))return!0;if(typeof s!="object"||s===null||typeof r!="object"||r===null)return!1;var o=Object.keys(s),l=Object.keys(r);if(o.length!==l.length)return!1;for(l=0;l<o.length;l++){var u=o[l];if(!Mx.call(r,u)||!Fa(s[u],r[u]))return!1}return!0}function DG(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function kG(s,r){var o=DG(s);s=0;for(var l;o;){if(o.nodeType===3){if(l=s+o.textContent.length,s<=r&&l>=r)return{node:o,offset:r-s};s=l}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=DG(o)}}function lH(s,r){return s&&r?s===r?!0:s&&s.nodeType===3?!1:r&&r.nodeType===3?lH(s,r.parentNode):"contains"in s?s.contains(r):s.compareDocumentPosition?!!(s.compareDocumentPosition(r)&16):!1:!1}function dH(){for(var s=window,r=D0();r instanceof s.HTMLIFrameElement;){try{var o=typeof r.contentWindow.location.href=="string"}catch{o=!1}if(o)s=r.contentWindow;else break;r=D0(s.document)}return r}function CP(s){var r=s&&s.nodeName&&s.nodeName.toLowerCase();return r&&(r==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||r==="textarea"||s.contentEditable==="true")}function Mue(s){var r=dH(),o=s.focusedElem,l=s.selectionRange;if(r!==o&&o&&o.ownerDocument&&lH(o.ownerDocument.documentElement,o)){if(l!==null&&CP(o)){if(r=l.start,s=l.end,s===void 0&&(s=r),"selectionStart"in o)o.selectionStart=r,o.selectionEnd=Math.min(s,o.value.length);else if(s=(r=o.ownerDocument||document)&&r.defaultView||window,s.getSelection){s=s.getSelection();var u=o.textContent.length,f=Math.min(l.start,u);l=l.end===void 0?f:Math.min(l.end,u),!s.extend&&f>l&&(u=l,l=f,f=u),u=kG(o,f);var E=kG(o,l);u&&E&&(s.rangeCount!==1||s.anchorNode!==u.node||s.anchorOffset!==u.offset||s.focusNode!==E.node||s.focusOffset!==E.offset)&&(r=r.createRange(),r.setStart(u.node,u.offset),s.removeAllRanges(),f>l?(s.addRange(r),s.extend(E.node,E.offset)):(r.setEnd(E.node,E.offset),s.addRange(r)))}}for(r=[],s=o;s=s.parentNode;)s.nodeType===1&&r.push({element:s,left:s.scrollLeft,top:s.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<r.length;o++)s=r[o],s.element.scrollLeft=s.left,s.element.scrollTop=s.top}}var Uue=El&&"documentMode"in document&&11>=document.documentMode,Lm=null,tO=null,X_=null,nO=!1;function LG(s,r,o){var l=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;nO||Lm==null||Lm!==D0(l)||(l=Lm,"selectionStart"in l&&CP(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),X_&&mE(X_,l)||(X_=l,l=F0(tO,"onSelect"),0<l.length&&(r=new bP("onSelect","select",null,r,o),s.push({event:r,listeners:l}),r.target=Lm)))}function YT(s,r){var o={};return o[s.toLowerCase()]=r.toLowerCase(),o["Webkit"+s]="webkit"+r,o["Moz"+s]="moz"+r,o}var Mm={animationend:YT("Animation","AnimationEnd"),animationiteration:YT("Animation","AnimationIteration"),animationstart:YT("Animation","AnimationStart"),transitionend:YT("Transition","TransitionEnd")},ex={},uH={};El&&(uH=document.createElement("div").style,"AnimationEvent"in window||(delete Mm.animationend.animation,delete Mm.animationiteration.animation,delete Mm.animationstart.animation),"TransitionEvent"in window||delete Mm.transitionend.transition);function kb(s){if(ex[s])return ex[s];if(!Mm[s])return s;var r=Mm[s],o;for(o in r)if(r.hasOwnProperty(o)&&o in uH)return ex[s]=r[o];return s}var hH=kb("animationend"),pH=kb("animationiteration"),mH=kb("animationstart"),fH=kb("transitionend"),gH=new Map,MG="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ru(s,r){gH.set(s,r),Bh(r,[s])}for(var tx=0;tx<MG.length;tx++){var nx=MG[tx],jue=nx.toLowerCase(),Vue=nx[0].toUpperCase()+nx.slice(1);ru(jue,"on"+Vue)}ru(hH,"onAnimationEnd");ru(pH,"onAnimationIteration");ru(mH,"onAnimationStart");ru("dblclick","onDoubleClick");ru("focusin","onFocus");ru("focusout","onBlur");ru(fH,"onTransitionEnd");tf("onMouseEnter",["mouseout","mouseover"]);tf("onMouseLeave",["mouseout","mouseover"]);tf("onPointerEnter",["pointerout","pointerover"]);tf("onPointerLeave",["pointerout","pointerover"]);Bh("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Bh("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Bh("onBeforeInput",["compositionend","keypress","textInput","paste"]);Bh("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Bh("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Bh("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var M_="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Fue=new Set("cancel close invalid load scroll toggle".split(" ").concat(M_));function UG(s,r,o){var l=s.type||"unknown-event";s.currentTarget=o,jde(l,r,void 0,s),s.currentTarget=null}function _H(s,r){r=(r&4)!==0;for(var o=0;o<s.length;o++){var l=s[o],u=l.event;l=l.listeners;e:{var f=void 0;if(r)for(var E=l.length-1;0<=E;E--){var T=l[E],w=T.instance,A=T.currentTarget;if(T=T.listener,w!==f&&u.isPropagationStopped())break e;UG(u,T,A),f=w}else for(E=0;E<l.length;E++){if(T=l[E],w=T.instance,A=T.currentTarget,T=T.listener,w!==f&&u.isPropagationStopped())break e;UG(u,T,A),f=w}}}if(L0)throw s=Qx,L0=!1,Qx=null,s}function Er(s,r){var o=r[aO];o===void 0&&(o=r[aO]=new Set);var l=s+"__bubble";o.has(l)||(EH(r,s,2,!1),o.add(l))}function rx(s,r,o){var l=0;r&&(l|=4),EH(o,s,l,r)}var XT="_reactListening"+Math.random().toString(36).slice(2);function fE(s){if(!s[XT]){s[XT]=!0,w8.forEach(function(o){o!=="selectionchange"&&(Fue.has(o)||rx(o,!1,s),rx(o,!0,s))});var r=s.nodeType===9?s:s.ownerDocument;r===null||r[XT]||(r[XT]=!0,rx("selectionchange",!1,r))}}function EH(s,r,o,l){switch(tH(r)){case 1:var u=eue;break;case 4:u=tue;break;default:u=SP}o=u.bind(null,r,o,s),u=void 0,!Jx||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(u=!0),l?u!==void 0?s.addEventListener(r,o,{capture:!0,passive:u}):s.addEventListener(r,o,!0):u!==void 0?s.addEventListener(r,o,{passive:u}):s.addEventListener(r,o,!1)}function ix(s,r,o,l,u){var f=l;if(!(r&1)&&!(r&2)&&l!==null)e:for(;;){if(l===null)return;var E=l.tag;if(E===3||E===4){var T=l.stateNode.containerInfo;if(T===u||T.nodeType===8&&T.parentNode===u)break;if(E===4)for(E=l.return;E!==null;){var w=E.tag;if((w===3||w===4)&&(w=E.stateNode.containerInfo,w===u||w.nodeType===8&&w.parentNode===u))return;E=E.return}for(;T!==null;){if(E=_h(T),E===null)return;if(w=E.tag,w===5||w===6){l=f=E;continue e}T=T.parentNode}}l=l.return}B8(function(){var A=f,U=_P(o),M=[];e:{var F=gH.get(s);if(F!==void 0){var Y=bP,J=s;switch(s){case"keypress":if(m0(o)===0)break e;case"keydown":case"keyup":Y=gue;break;case"focusin":J="focus",Y=QN;break;case"focusout":J="blur",Y=QN;break;case"beforeblur":case"afterblur":Y=QN;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Y=wG;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Y=iue;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Y=vue;break;case hH:case pH:case mH:Y=aue;break;case fH:Y=Sue;break;case"scroll":Y=nue;break;case"wheel":Y=bue;break;case"copy":case"cut":case"paste":Y=lue;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Y=IG}var ae=(r&4)!==0,he=!ae&&s==="scroll",ee=ae?F!==null?F+"Capture":null:F;ae=[];for(var W=A,Z;W!==null;){Z=W;var fe=Z.stateNode;if(Z.tag===5&&fe!==null&&(Z=fe,ee!==null&&(fe=lE(W,ee),fe!=null&&ae.push(gE(W,fe,Z)))),he)break;W=W.return}0<ae.length&&(F=new Y(F,J,null,o,U),M.push({event:F,listeners:ae}))}}if(!(r&7)){e:{if(F=s==="mouseover"||s==="pointerover",Y=s==="mouseout"||s==="pointerout",F&&o!==Yx&&(J=o.relatedTarget||o.fromElement)&&(_h(J)||J[vl]))break e;if((Y||F)&&(F=U.window===U?U:(F=U.ownerDocument)?F.defaultView||F.parentWindow:window,Y?(J=o.relatedTarget||o.toElement,Y=A,J=J?_h(J):null,J!==null&&(he=Gh(J),J!==he||J.tag!==5&&J.tag!==6)&&(J=null)):(Y=null,J=A),Y!==J)){if(ae=wG,fe="onMouseLeave",ee="onMouseEnter",W="mouse",(s==="pointerout"||s==="pointerover")&&(ae=IG,fe="onPointerLeave",ee="onPointerEnter",W="pointer"),he=Y==null?F:Um(Y),Z=J==null?F:Um(J),F=new ae(fe,W+"leave",Y,o,U),F.target=he,F.relatedTarget=Z,fe=null,_h(U)===A&&(ae=new ae(ee,W+"enter",J,o,U),ae.target=Z,ae.relatedTarget=he,fe=ae),he=fe,Y&&J)t:{for(ae=Y,ee=J,W=0,Z=ae;Z;Z=Rm(Z))W++;for(Z=0,fe=ee;fe;fe=Rm(fe))Z++;for(;0<W-Z;)ae=Rm(ae),W--;for(;0<Z-W;)ee=Rm(ee),Z--;for(;W--;){if(ae===ee||ee!==null&&ae===ee.alternate)break t;ae=Rm(ae),ee=Rm(ee)}ae=null}else ae=null;Y!==null&&jG(M,F,Y,ae,!1),J!==null&&he!==null&&jG(M,he,J,ae,!0)}}e:{if(F=A?Um(A):window,Y=F.nodeName&&F.nodeName.toLowerCase(),Y==="select"||Y==="input"&&F.type==="file")var pe=xue;else if(xG(F))if(aH)pe=kue;else{pe=Pue;var Ce=Oue}else(Y=F.nodeName)&&Y.toLowerCase()==="input"&&(F.type==="checkbox"||F.type==="radio")&&(pe=Due);if(pe&&(pe=pe(s,A))){oH(M,pe,o,U);break e}Ce&&Ce(s,F,A),s==="focusout"&&(Ce=F._wrapperState)&&Ce.controlled&&F.type==="number"&&Wx(F,"number",F.value)}switch(Ce=A?Um(A):window,s){case"focusin":(xG(Ce)||Ce.contentEditable==="true")&&(Lm=Ce,tO=A,X_=null);break;case"focusout":X_=tO=Lm=null;break;case"mousedown":nO=!0;break;case"contextmenu":case"mouseup":case"dragend":nO=!1,LG(M,o,U);break;case"selectionchange":if(Uue)break;case"keydown":case"keyup":LG(M,o,U)}var te;if(wP)e:{switch(s){case"compositionstart":var q="onCompositionStart";break e;case"compositionend":q="onCompositionEnd";break e;case"compositionupdate":q="onCompositionUpdate";break e}q=void 0}else km?iH(s,o)&&(q="onCompositionEnd"):s==="keydown"&&o.keyCode===229&&(q="onCompositionStart");q&&(rH&&o.locale!=="ko"&&(km||q!=="onCompositionStart"?q==="onCompositionEnd"&&km&&(te=nH()):(xd=U,TP="value"in xd?xd.value:xd.textContent,km=!0)),Ce=F0(A,q),0<Ce.length&&(q=new CG(q,s,null,o,U),M.push({event:q,listeners:Ce}),te?q.data=te:(te=sH(o),te!==null&&(q.data=te)))),(te=wue?Cue(s,o):Iue(s,o))&&(A=F0(A,"onBeforeInput"),0<A.length&&(U=new CG("onBeforeInput","beforeinput",null,o,U),M.push({event:U,listeners:A}),U.data=te))}_H(M,r)})}function gE(s,r,o){return{instance:s,listener:r,currentTarget:o}}function F0(s,r){for(var o=r+"Capture",l=[];s!==null;){var u=s,f=u.stateNode;u.tag===5&&f!==null&&(u=f,f=lE(s,o),f!=null&&l.unshift(gE(s,f,u)),f=lE(s,r),f!=null&&l.push(gE(s,f,u))),s=s.return}return l}function Rm(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5);return s||null}function jG(s,r,o,l,u){for(var f=r._reactName,E=[];o!==null&&o!==l;){var T=o,w=T.alternate,A=T.stateNode;if(w!==null&&w===l)break;T.tag===5&&A!==null&&(T=A,u?(w=lE(o,f),w!=null&&E.unshift(gE(o,w,T))):u||(w=lE(o,f),w!=null&&E.push(gE(o,w,T)))),o=o.return}E.length!==0&&s.push({event:r,listeners:E})}var Bue=/\r\n?/g,Gue=/\u0000|\uFFFD/g;function VG(s){return(typeof s=="string"?s:""+s).replace(Bue,`
`).replace(Gue,"")}function JT(s,r,o){if(r=VG(r),VG(s)!==r&&o)throw Error(ze(425))}function B0(){}var rO=null,iO=null;function sO(s,r){return s==="textarea"||s==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var oO=typeof setTimeout=="function"?setTimeout:void 0,Wue=typeof clearTimeout=="function"?clearTimeout:void 0,FG=typeof Promise=="function"?Promise:void 0,zue=typeof queueMicrotask=="function"?queueMicrotask:typeof FG<"u"?function(s){return FG.resolve(null).then(s).catch(Hue)}:oO;function Hue(s){setTimeout(function(){throw s})}function sx(s,r){var o=r,l=0;do{var u=o.nextSibling;if(s.removeChild(o),u&&u.nodeType===8)if(o=u.data,o==="/$"){if(l===0){s.removeChild(u),hE(r);return}l--}else o!=="$"&&o!=="$?"&&o!=="$!"||l++;o=u}while(o);hE(r)}function Ud(s){for(;s!=null;s=s.nextSibling){var r=s.nodeType;if(r===1||r===3)break;if(r===8){if(r=s.data,r==="$"||r==="$!"||r==="$?")break;if(r==="/$")return null}}return s}function BG(s){s=s.previousSibling;for(var r=0;s;){if(s.nodeType===8){var o=s.data;if(o==="$"||o==="$!"||o==="$?"){if(r===0)return s;r--}else o==="/$"&&r++}s=s.previousSibling}return null}var Tf=Math.random().toString(36).slice(2),Tc="__reactFiber$"+Tf,_E="__reactProps$"+Tf,vl="__reactContainer$"+Tf,aO="__reactEvents$"+Tf,Kue="__reactListeners$"+Tf,que="__reactHandles$"+Tf;function _h(s){var r=s[Tc];if(r)return r;for(var o=s.parentNode;o;){if(r=o[vl]||o[Tc]){if(o=r.alternate,r.child!==null||o!==null&&o.child!==null)for(s=BG(s);s!==null;){if(o=s[Tc])return o;s=BG(s)}return r}s=o,o=s.parentNode}return null}function GE(s){return s=s[Tc]||s[vl],!s||s.tag!==5&&s.tag!==6&&s.tag!==13&&s.tag!==3?null:s}function Um(s){if(s.tag===5||s.tag===6)return s.stateNode;throw Error(ze(33))}function Lb(s){return s[_E]||null}var cO=[],jm=-1;function iu(s){return{current:s}}function yr(s){0>jm||(s.current=cO[jm],cO[jm]=null,jm--)}function dr(s,r){jm++,cO[jm]=s.current,s.current=r}var Xd={},hs=iu(Xd),Xs=iu(!1),Nh=Xd;function nf(s,r){var o=s.type.contextTypes;if(!o)return Xd;var l=s.stateNode;if(l&&l.__reactInternalMemoizedUnmaskedChildContext===r)return l.__reactInternalMemoizedMaskedChildContext;var u={},f;for(f in o)u[f]=r[f];return l&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=r,s.__reactInternalMemoizedMaskedChildContext=u),u}function Js(s){return s=s.childContextTypes,s!=null}function G0(){yr(Xs),yr(hs)}function GG(s,r,o){if(hs.current!==Xd)throw Error(ze(168));dr(hs,r),dr(Xs,o)}function vH(s,r,o){var l=s.stateNode;if(r=r.childContextTypes,typeof l.getChildContext!="function")return o;l=l.getChildContext();for(var u in l)if(!(u in r))throw Error(ze(108,Ode(s)||"Unknown",u));return Br({},o,l)}function W0(s){return s=(s=s.stateNode)&&s.__reactInternalMemoizedMergedChildContext||Xd,Nh=hs.current,dr(hs,s),dr(Xs,Xs.current),!0}function WG(s,r,o){var l=s.stateNode;if(!l)throw Error(ze(169));o?(s=vH(s,r,Nh),l.__reactInternalMemoizedMergedChildContext=s,yr(Xs),yr(hs),dr(hs,s)):yr(Xs),dr(Xs,o)}var nl=null,Mb=!1,ox=!1;function yH(s){nl===null?nl=[s]:nl.push(s)}function Yue(s){Mb=!0,yH(s)}function su(){if(!ox&&nl!==null){ox=!0;var s=0,r=Xn;try{var o=nl;for(Xn=1;s<o.length;s++){var l=o[s];do l=l(!0);while(l!==null)}nl=null,Mb=!1}catch(u){throw nl!==null&&(nl=nl.slice(s+1)),H8(EP,su),u}finally{Xn=r,ox=!1}}return null}var Vm=[],Fm=0,z0=null,H0=0,Ho=[],Ko=0,xh=null,ol=1,al="";function hh(s,r){Vm[Fm++]=H0,Vm[Fm++]=z0,z0=s,H0=r}function SH(s,r,o){Ho[Ko++]=ol,Ho[Ko++]=al,Ho[Ko++]=xh,xh=s;var l=ol;s=al;var u=32-La(l)-1;l&=~(1<<u),o+=1;var f=32-La(r)+u;if(30<f){var E=u-u%5;f=(l&(1<<E)-1).toString(32),l>>=E,u-=E,ol=1<<32-La(r)+u|o<<u|l,al=f+s}else ol=1<<f|o<<u|l,al=s}function IP(s){s.return!==null&&(hh(s,1),SH(s,1,0))}function AP(s){for(;s===z0;)z0=Vm[--Fm],Vm[Fm]=null,H0=Vm[--Fm],Vm[Fm]=null;for(;s===xh;)xh=Ho[--Ko],Ho[Ko]=null,al=Ho[--Ko],Ho[Ko]=null,ol=Ho[--Ko],Ho[Ko]=null}var Eo=null,go=null,Pr=!1,Pa=null;function TH(s,r){var o=Yo(5,null,null,0);o.elementType="DELETED",o.stateNode=r,o.return=s,r=s.deletions,r===null?(s.deletions=[o],s.flags|=16):r.push(o)}function zG(s,r){switch(s.tag){case 5:var o=s.type;return r=r.nodeType!==1||o.toLowerCase()!==r.nodeName.toLowerCase()?null:r,r!==null?(s.stateNode=r,Eo=s,go=Ud(r.firstChild),!0):!1;case 6:return r=s.pendingProps===""||r.nodeType!==3?null:r,r!==null?(s.stateNode=r,Eo=s,go=null,!0):!1;case 13:return r=r.nodeType!==8?null:r,r!==null?(o=xh!==null?{id:ol,overflow:al}:null,s.memoizedState={dehydrated:r,treeContext:o,retryLane:1073741824},o=Yo(18,null,null,0),o.stateNode=r,o.return=s,s.child=o,Eo=s,go=null,!0):!1;default:return!1}}function lO(s){return(s.mode&1)!==0&&(s.flags&128)===0}function dO(s){if(Pr){var r=go;if(r){var o=r;if(!zG(s,r)){if(lO(s))throw Error(ze(418));r=Ud(o.nextSibling);var l=Eo;r&&zG(s,r)?TH(l,o):(s.flags=s.flags&-4097|2,Pr=!1,Eo=s)}}else{if(lO(s))throw Error(ze(418));s.flags=s.flags&-4097|2,Pr=!1,Eo=s}}}function HG(s){for(s=s.return;s!==null&&s.tag!==5&&s.tag!==3&&s.tag!==13;)s=s.return;Eo=s}function QT(s){if(s!==Eo)return!1;if(!Pr)return HG(s),Pr=!0,!1;var r;if((r=s.tag!==3)&&!(r=s.tag!==5)&&(r=s.type,r=r!=="head"&&r!=="body"&&!sO(s.type,s.memoizedProps)),r&&(r=go)){if(lO(s))throw bH(),Error(ze(418));for(;r;)TH(s,r),r=Ud(r.nextSibling)}if(HG(s),s.tag===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(ze(317));e:{for(s=s.nextSibling,r=0;s;){if(s.nodeType===8){var o=s.data;if(o==="/$"){if(r===0){go=Ud(s.nextSibling);break e}r--}else o!=="$"&&o!=="$!"&&o!=="$?"||r++}s=s.nextSibling}go=null}}else go=Eo?Ud(s.stateNode.nextSibling):null;return!0}function bH(){for(var s=go;s;)s=Ud(s.nextSibling)}function rf(){go=Eo=null,Pr=!1}function NP(s){Pa===null?Pa=[s]:Pa.push(s)}var Xue=Il.ReactCurrentBatchConfig;function N_(s,r,o){if(s=o.ref,s!==null&&typeof s!="function"&&typeof s!="object"){if(o._owner){if(o=o._owner,o){if(o.tag!==1)throw Error(ze(309));var l=o.stateNode}if(!l)throw Error(ze(147,s));var u=l,f=""+s;return r!==null&&r.ref!==null&&typeof r.ref=="function"&&r.ref._stringRef===f?r.ref:(r=function(E){var T=u.refs;E===null?delete T[f]:T[f]=E},r._stringRef=f,r)}if(typeof s!="string")throw Error(ze(284));if(!o._owner)throw Error(ze(290,s))}return s}function $T(s,r){throw s=Object.prototype.toString.call(r),Error(ze(31,s==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":s))}function KG(s){var r=s._init;return r(s._payload)}function RH(s){function r(ee,W){if(s){var Z=ee.deletions;Z===null?(ee.deletions=[W],ee.flags|=16):Z.push(W)}}function o(ee,W){if(!s)return null;for(;W!==null;)r(ee,W),W=W.sibling;return null}function l(ee,W){for(ee=new Map;W!==null;)W.key!==null?ee.set(W.key,W):ee.set(W.index,W),W=W.sibling;return ee}function u(ee,W){return ee=Bd(ee,W),ee.index=0,ee.sibling=null,ee}function f(ee,W,Z){return ee.index=Z,s?(Z=ee.alternate,Z!==null?(Z=Z.index,Z<W?(ee.flags|=2,W):Z):(ee.flags|=2,W)):(ee.flags|=1048576,W)}function E(ee){return s&&ee.alternate===null&&(ee.flags|=2),ee}function T(ee,W,Z,fe){return W===null||W.tag!==6?(W=px(Z,ee.mode,fe),W.return=ee,W):(W=u(W,Z),W.return=ee,W)}function w(ee,W,Z,fe){var pe=Z.type;return pe===Dm?U(ee,W,Z.props.children,fe,Z.key):W!==null&&(W.elementType===pe||typeof pe=="object"&&pe!==null&&pe.$$typeof===Td&&KG(pe)===W.type)?(fe=u(W,Z.props),fe.ref=N_(ee,W,Z),fe.return=ee,fe):(fe=S0(Z.type,Z.key,Z.props,null,ee.mode,fe),fe.ref=N_(ee,W,Z),fe.return=ee,fe)}function A(ee,W,Z,fe){return W===null||W.tag!==4||W.stateNode.containerInfo!==Z.containerInfo||W.stateNode.implementation!==Z.implementation?(W=mx(Z,ee.mode,fe),W.return=ee,W):(W=u(W,Z.children||[]),W.return=ee,W)}function U(ee,W,Z,fe,pe){return W===null||W.tag!==7?(W=wh(Z,ee.mode,fe,pe),W.return=ee,W):(W=u(W,Z),W.return=ee,W)}function M(ee,W,Z){if(typeof W=="string"&&W!==""||typeof W=="number")return W=px(""+W,ee.mode,Z),W.return=ee,W;if(typeof W=="object"&&W!==null){switch(W.$$typeof){case BT:return Z=S0(W.type,W.key,W.props,null,ee.mode,Z),Z.ref=N_(ee,null,W),Z.return=ee,Z;case Pm:return W=mx(W,ee.mode,Z),W.return=ee,W;case Td:var fe=W._init;return M(ee,fe(W._payload),Z)}if(k_(W)||R_(W))return W=wh(W,ee.mode,Z,null),W.return=ee,W;$T(ee,W)}return null}function F(ee,W,Z,fe){var pe=W!==null?W.key:null;if(typeof Z=="string"&&Z!==""||typeof Z=="number")return pe!==null?null:T(ee,W,""+Z,fe);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case BT:return Z.key===pe?w(ee,W,Z,fe):null;case Pm:return Z.key===pe?A(ee,W,Z,fe):null;case Td:return pe=Z._init,F(ee,W,pe(Z._payload),fe)}if(k_(Z)||R_(Z))return pe!==null?null:U(ee,W,Z,fe,null);$T(ee,Z)}return null}function Y(ee,W,Z,fe,pe){if(typeof fe=="string"&&fe!==""||typeof fe=="number")return ee=ee.get(Z)||null,T(W,ee,""+fe,pe);if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case BT:return ee=ee.get(fe.key===null?Z:fe.key)||null,w(W,ee,fe,pe);case Pm:return ee=ee.get(fe.key===null?Z:fe.key)||null,A(W,ee,fe,pe);case Td:var Ce=fe._init;return Y(ee,W,Z,Ce(fe._payload),pe)}if(k_(fe)||R_(fe))return ee=ee.get(Z)||null,U(W,ee,fe,pe,null);$T(W,fe)}return null}function J(ee,W,Z,fe){for(var pe=null,Ce=null,te=W,q=W=0,re=null;te!==null&&q<Z.length;q++){te.index>q?(re=te,te=null):re=te.sibling;var $=F(ee,te,Z[q],fe);if($===null){te===null&&(te=re);break}s&&te&&$.alternate===null&&r(ee,te),W=f($,W,q),Ce===null?pe=$:Ce.sibling=$,Ce=$,te=re}if(q===Z.length)return o(ee,te),Pr&&hh(ee,q),pe;if(te===null){for(;q<Z.length;q++)te=M(ee,Z[q],fe),te!==null&&(W=f(te,W,q),Ce===null?pe=te:Ce.sibling=te,Ce=te);return Pr&&hh(ee,q),pe}for(te=l(ee,te);q<Z.length;q++)re=Y(te,ee,q,Z[q],fe),re!==null&&(s&&re.alternate!==null&&te.delete(re.key===null?q:re.key),W=f(re,W,q),Ce===null?pe=re:Ce.sibling=re,Ce=re);return s&&te.forEach(function(le){return r(ee,le)}),Pr&&hh(ee,q),pe}function ae(ee,W,Z,fe){var pe=R_(Z);if(typeof pe!="function")throw Error(ze(150));if(Z=pe.call(Z),Z==null)throw Error(ze(151));for(var Ce=pe=null,te=W,q=W=0,re=null,$=Z.next();te!==null&&!$.done;q++,$=Z.next()){te.index>q?(re=te,te=null):re=te.sibling;var le=F(ee,te,$.value,fe);if(le===null){te===null&&(te=re);break}s&&te&&le.alternate===null&&r(ee,te),W=f(le,W,q),Ce===null?pe=le:Ce.sibling=le,Ce=le,te=re}if($.done)return o(ee,te),Pr&&hh(ee,q),pe;if(te===null){for(;!$.done;q++,$=Z.next())$=M(ee,$.value,fe),$!==null&&(W=f($,W,q),Ce===null?pe=$:Ce.sibling=$,Ce=$);return Pr&&hh(ee,q),pe}for(te=l(ee,te);!$.done;q++,$=Z.next())$=Y(te,ee,q,$.value,fe),$!==null&&(s&&$.alternate!==null&&te.delete($.key===null?q:$.key),W=f($,W,q),Ce===null?pe=$:Ce.sibling=$,Ce=$);return s&&te.forEach(function(ue){return r(ee,ue)}),Pr&&hh(ee,q),pe}function he(ee,W,Z,fe){if(typeof Z=="object"&&Z!==null&&Z.type===Dm&&Z.key===null&&(Z=Z.props.children),typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case BT:e:{for(var pe=Z.key,Ce=W;Ce!==null;){if(Ce.key===pe){if(pe=Z.type,pe===Dm){if(Ce.tag===7){o(ee,Ce.sibling),W=u(Ce,Z.props.children),W.return=ee,ee=W;break e}}else if(Ce.elementType===pe||typeof pe=="object"&&pe!==null&&pe.$$typeof===Td&&KG(pe)===Ce.type){o(ee,Ce.sibling),W=u(Ce,Z.props),W.ref=N_(ee,Ce,Z),W.return=ee,ee=W;break e}o(ee,Ce);break}else r(ee,Ce);Ce=Ce.sibling}Z.type===Dm?(W=wh(Z.props.children,ee.mode,fe,Z.key),W.return=ee,ee=W):(fe=S0(Z.type,Z.key,Z.props,null,ee.mode,fe),fe.ref=N_(ee,W,Z),fe.return=ee,ee=fe)}return E(ee);case Pm:e:{for(Ce=Z.key;W!==null;){if(W.key===Ce)if(W.tag===4&&W.stateNode.containerInfo===Z.containerInfo&&W.stateNode.implementation===Z.implementation){o(ee,W.sibling),W=u(W,Z.children||[]),W.return=ee,ee=W;break e}else{o(ee,W);break}else r(ee,W);W=W.sibling}W=mx(Z,ee.mode,fe),W.return=ee,ee=W}return E(ee);case Td:return Ce=Z._init,he(ee,W,Ce(Z._payload),fe)}if(k_(Z))return J(ee,W,Z,fe);if(R_(Z))return ae(ee,W,Z,fe);$T(ee,Z)}return typeof Z=="string"&&Z!==""||typeof Z=="number"?(Z=""+Z,W!==null&&W.tag===6?(o(ee,W.sibling),W=u(W,Z),W.return=ee,ee=W):(o(ee,W),W=px(Z,ee.mode,fe),W.return=ee,ee=W),E(ee)):o(ee,W)}return he}var sf=RH(!0),wH=RH(!1),K0=iu(null),q0=null,Bm=null,xP=null;function OP(){xP=Bm=q0=null}function PP(s){var r=K0.current;yr(K0),s._currentValue=r}function uO(s,r,o){for(;s!==null;){var l=s.alternate;if((s.childLanes&r)!==r?(s.childLanes|=r,l!==null&&(l.childLanes|=r)):l!==null&&(l.childLanes&r)!==r&&(l.childLanes|=r),s===o)break;s=s.return}}function Ym(s,r){q0=s,xP=Bm=null,s=s.dependencies,s!==null&&s.firstContext!==null&&(s.lanes&r&&(Ys=!0),s.firstContext=null)}function Qo(s){var r=s._currentValue;if(xP!==s)if(s={context:s,memoizedValue:r,next:null},Bm===null){if(q0===null)throw Error(ze(308));Bm=s,q0.dependencies={lanes:0,firstContext:s}}else Bm=Bm.next=s;return r}var Eh=null;function DP(s){Eh===null?Eh=[s]:Eh.push(s)}function CH(s,r,o,l){var u=r.interleaved;return u===null?(o.next=o,DP(r)):(o.next=u.next,u.next=o),r.interleaved=o,yl(s,l)}function yl(s,r){s.lanes|=r;var o=s.alternate;for(o!==null&&(o.lanes|=r),o=s,s=s.return;s!==null;)s.childLanes|=r,o=s.alternate,o!==null&&(o.childLanes|=r),o=s,s=s.return;return o.tag===3?o.stateNode:null}var bd=!1;function kP(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function IH(s,r){s=s.updateQueue,r.updateQueue===s&&(r.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,effects:s.effects})}function pl(s,r){return{eventTime:s,lane:r,tag:0,payload:null,callback:null,next:null}}function jd(s,r,o){var l=s.updateQueue;if(l===null)return null;if(l=l.shared,On&2){var u=l.pending;return u===null?r.next=r:(r.next=u.next,u.next=r),l.pending=r,yl(s,o)}return u=l.interleaved,u===null?(r.next=r,DP(l)):(r.next=u.next,u.next=r),l.interleaved=r,yl(s,o)}function f0(s,r,o){if(r=r.updateQueue,r!==null&&(r=r.shared,(o&4194240)!==0)){var l=r.lanes;l&=s.pendingLanes,o|=l,r.lanes=o,vP(s,o)}}function qG(s,r){var o=s.updateQueue,l=s.alternate;if(l!==null&&(l=l.updateQueue,o===l)){var u=null,f=null;if(o=o.firstBaseUpdate,o!==null){do{var E={eventTime:o.eventTime,lane:o.lane,tag:o.tag,payload:o.payload,callback:o.callback,next:null};f===null?u=f=E:f=f.next=E,o=o.next}while(o!==null);f===null?u=f=r:f=f.next=r}else u=f=r;o={baseState:l.baseState,firstBaseUpdate:u,lastBaseUpdate:f,shared:l.shared,effects:l.effects},s.updateQueue=o;return}s=o.lastBaseUpdate,s===null?o.firstBaseUpdate=r:s.next=r,o.lastBaseUpdate=r}function Y0(s,r,o,l){var u=s.updateQueue;bd=!1;var f=u.firstBaseUpdate,E=u.lastBaseUpdate,T=u.shared.pending;if(T!==null){u.shared.pending=null;var w=T,A=w.next;w.next=null,E===null?f=A:E.next=A,E=w;var U=s.alternate;U!==null&&(U=U.updateQueue,T=U.lastBaseUpdate,T!==E&&(T===null?U.firstBaseUpdate=A:T.next=A,U.lastBaseUpdate=w))}if(f!==null){var M=u.baseState;E=0,U=A=w=null,T=f;do{var F=T.lane,Y=T.eventTime;if((l&F)===F){U!==null&&(U=U.next={eventTime:Y,lane:0,tag:T.tag,payload:T.payload,callback:T.callback,next:null});e:{var J=s,ae=T;switch(F=r,Y=o,ae.tag){case 1:if(J=ae.payload,typeof J=="function"){M=J.call(Y,M,F);break e}M=J;break e;case 3:J.flags=J.flags&-65537|128;case 0:if(J=ae.payload,F=typeof J=="function"?J.call(Y,M,F):J,F==null)break e;M=Br({},M,F);break e;case 2:bd=!0}}T.callback!==null&&T.lane!==0&&(s.flags|=64,F=u.effects,F===null?u.effects=[T]:F.push(T))}else Y={eventTime:Y,lane:F,tag:T.tag,payload:T.payload,callback:T.callback,next:null},U===null?(A=U=Y,w=M):U=U.next=Y,E|=F;if(T=T.next,T===null){if(T=u.shared.pending,T===null)break;F=T,T=F.next,F.next=null,u.lastBaseUpdate=F,u.shared.pending=null}}while(!0);if(U===null&&(w=M),u.baseState=w,u.firstBaseUpdate=A,u.lastBaseUpdate=U,r=u.shared.interleaved,r!==null){u=r;do E|=u.lane,u=u.next;while(u!==r)}else f===null&&(u.shared.lanes=0);Ph|=E,s.lanes=E,s.memoizedState=M}}function YG(s,r,o){if(s=r.effects,r.effects=null,s!==null)for(r=0;r<s.length;r++){var l=s[r],u=l.callback;if(u!==null){if(l.callback=null,l=o,typeof u!="function")throw Error(ze(191,u));u.call(l)}}}var WE={},Rc=iu(WE),EE=iu(WE),vE=iu(WE);function vh(s){if(s===WE)throw Error(ze(174));return s}function LP(s,r){switch(dr(vE,r),dr(EE,s),dr(Rc,WE),s=r.nodeType,s){case 9:case 11:r=(r=r.documentElement)?r.namespaceURI:Hx(null,"");break;default:s=s===8?r.parentNode:r,r=s.namespaceURI||null,s=s.tagName,r=Hx(r,s)}yr(Rc),dr(Rc,r)}function of(){yr(Rc),yr(EE),yr(vE)}function AH(s){vh(vE.current);var r=vh(Rc.current),o=Hx(r,s.type);r!==o&&(dr(EE,s),dr(Rc,o))}function MP(s){EE.current===s&&(yr(Rc),yr(EE))}var jr=iu(0);function X0(s){for(var r=s;r!==null;){if(r.tag===13){var o=r.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||o.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if(r.flags&128)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break;for(;r.sibling===null;){if(r.return===null||r.return===s)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var ax=[];function UP(){for(var s=0;s<ax.length;s++)ax[s]._workInProgressVersionPrimary=null;ax.length=0}var g0=Il.ReactCurrentDispatcher,cx=Il.ReactCurrentBatchConfig,Oh=0,Vr=null,gi=null,Pi=null,J0=!1,J_=!1,yE=0,Jue=0;function is(){throw Error(ze(321))}function jP(s,r){if(r===null)return!1;for(var o=0;o<r.length&&o<s.length;o++)if(!Fa(s[o],r[o]))return!1;return!0}function VP(s,r,o,l,u,f){if(Oh=f,Vr=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,g0.current=s===null||s.memoizedState===null?ehe:the,s=o(l,u),J_){f=0;do{if(J_=!1,yE=0,25<=f)throw Error(ze(301));f+=1,Pi=gi=null,r.updateQueue=null,g0.current=nhe,s=o(l,u)}while(J_)}if(g0.current=Q0,r=gi!==null&&gi.next!==null,Oh=0,Pi=gi=Vr=null,J0=!1,r)throw Error(ze(300));return s}function FP(){var s=yE!==0;return yE=0,s}function Sc(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Pi===null?Vr.memoizedState=Pi=s:Pi=Pi.next=s,Pi}function $o(){if(gi===null){var s=Vr.alternate;s=s!==null?s.memoizedState:null}else s=gi.next;var r=Pi===null?Vr.memoizedState:Pi.next;if(r!==null)Pi=r,gi=s;else{if(s===null)throw Error(ze(310));gi=s,s={memoizedState:gi.memoizedState,baseState:gi.baseState,baseQueue:gi.baseQueue,queue:gi.queue,next:null},Pi===null?Vr.memoizedState=Pi=s:Pi=Pi.next=s}return Pi}function SE(s,r){return typeof r=="function"?r(s):r}function lx(s){var r=$o(),o=r.queue;if(o===null)throw Error(ze(311));o.lastRenderedReducer=s;var l=gi,u=l.baseQueue,f=o.pending;if(f!==null){if(u!==null){var E=u.next;u.next=f.next,f.next=E}l.baseQueue=u=f,o.pending=null}if(u!==null){f=u.next,l=l.baseState;var T=E=null,w=null,A=f;do{var U=A.lane;if((Oh&U)===U)w!==null&&(w=w.next={lane:0,action:A.action,hasEagerState:A.hasEagerState,eagerState:A.eagerState,next:null}),l=A.hasEagerState?A.eagerState:s(l,A.action);else{var M={lane:U,action:A.action,hasEagerState:A.hasEagerState,eagerState:A.eagerState,next:null};w===null?(T=w=M,E=l):w=w.next=M,Vr.lanes|=U,Ph|=U}A=A.next}while(A!==null&&A!==f);w===null?E=l:w.next=T,Fa(l,r.memoizedState)||(Ys=!0),r.memoizedState=l,r.baseState=E,r.baseQueue=w,o.lastRenderedState=l}if(s=o.interleaved,s!==null){u=s;do f=u.lane,Vr.lanes|=f,Ph|=f,u=u.next;while(u!==s)}else u===null&&(o.lanes=0);return[r.memoizedState,o.dispatch]}function dx(s){var r=$o(),o=r.queue;if(o===null)throw Error(ze(311));o.lastRenderedReducer=s;var l=o.dispatch,u=o.pending,f=r.memoizedState;if(u!==null){o.pending=null;var E=u=u.next;do f=s(f,E.action),E=E.next;while(E!==u);Fa(f,r.memoizedState)||(Ys=!0),r.memoizedState=f,r.baseQueue===null&&(r.baseState=f),o.lastRenderedState=f}return[f,l]}function NH(){}function xH(s,r){var o=Vr,l=$o(),u=r(),f=!Fa(l.memoizedState,u);if(f&&(l.memoizedState=u,Ys=!0),l=l.queue,BP(DH.bind(null,o,l,s),[s]),l.getSnapshot!==r||f||Pi!==null&&Pi.memoizedState.tag&1){if(o.flags|=2048,TE(9,PH.bind(null,o,l,u,r),void 0,null),Di===null)throw Error(ze(349));Oh&30||OH(o,r,u)}return u}function OH(s,r,o){s.flags|=16384,s={getSnapshot:r,value:o},r=Vr.updateQueue,r===null?(r={lastEffect:null,stores:null},Vr.updateQueue=r,r.stores=[s]):(o=r.stores,o===null?r.stores=[s]:o.push(s))}function PH(s,r,o,l){r.value=o,r.getSnapshot=l,kH(r)&&LH(s)}function DH(s,r,o){return o(function(){kH(r)&&LH(s)})}function kH(s){var r=s.getSnapshot;s=s.value;try{var o=r();return!Fa(s,o)}catch{return!0}}function LH(s){var r=yl(s,1);r!==null&&Ma(r,s,1,-1)}function XG(s){var r=Sc();return typeof s=="function"&&(s=s()),r.memoizedState=r.baseState=s,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:SE,lastRenderedState:s},r.queue=s,s=s.dispatch=Zue.bind(null,Vr,s),[r.memoizedState,s]}function TE(s,r,o,l){return s={tag:s,create:r,destroy:o,deps:l,next:null},r=Vr.updateQueue,r===null?(r={lastEffect:null,stores:null},Vr.updateQueue=r,r.lastEffect=s.next=s):(o=r.lastEffect,o===null?r.lastEffect=s.next=s:(l=o.next,o.next=s,s.next=l,r.lastEffect=s)),s}function MH(){return $o().memoizedState}function _0(s,r,o,l){var u=Sc();Vr.flags|=s,u.memoizedState=TE(1|r,o,void 0,l===void 0?null:l)}function Ub(s,r,o,l){var u=$o();l=l===void 0?null:l;var f=void 0;if(gi!==null){var E=gi.memoizedState;if(f=E.destroy,l!==null&&jP(l,E.deps)){u.memoizedState=TE(r,o,f,l);return}}Vr.flags|=s,u.memoizedState=TE(1|r,o,f,l)}function JG(s,r){return _0(8390656,8,s,r)}function BP(s,r){return Ub(2048,8,s,r)}function UH(s,r){return Ub(4,2,s,r)}function jH(s,r){return Ub(4,4,s,r)}function VH(s,r){if(typeof r=="function")return s=s(),r(s),function(){r(null)};if(r!=null)return s=s(),r.current=s,function(){r.current=null}}function FH(s,r,o){return o=o!=null?o.concat([s]):null,Ub(4,4,VH.bind(null,r,s),o)}function GP(){}function BH(s,r){var o=$o();r=r===void 0?null:r;var l=o.memoizedState;return l!==null&&r!==null&&jP(r,l[1])?l[0]:(o.memoizedState=[s,r],s)}function GH(s,r){var o=$o();r=r===void 0?null:r;var l=o.memoizedState;return l!==null&&r!==null&&jP(r,l[1])?l[0]:(s=s(),o.memoizedState=[s,r],s)}function WH(s,r,o){return Oh&21?(Fa(o,r)||(o=Y8(),Vr.lanes|=o,Ph|=o,s.baseState=!0),r):(s.baseState&&(s.baseState=!1,Ys=!0),s.memoizedState=o)}function Que(s,r){var o=Xn;Xn=o!==0&&4>o?o:4,s(!0);var l=cx.transition;cx.transition={};try{s(!1),r()}finally{Xn=o,cx.transition=l}}function zH(){return $o().memoizedState}function $ue(s,r,o){var l=Fd(s);if(o={lane:l,action:o,hasEagerState:!1,eagerState:null,next:null},HH(s))KH(r,o);else if(o=CH(s,r,o,l),o!==null){var u=Cs();Ma(o,s,l,u),qH(o,r,l)}}function Zue(s,r,o){var l=Fd(s),u={lane:l,action:o,hasEagerState:!1,eagerState:null,next:null};if(HH(s))KH(r,u);else{var f=s.alternate;if(s.lanes===0&&(f===null||f.lanes===0)&&(f=r.lastRenderedReducer,f!==null))try{var E=r.lastRenderedState,T=f(E,o);if(u.hasEagerState=!0,u.eagerState=T,Fa(T,E)){var w=r.interleaved;w===null?(u.next=u,DP(r)):(u.next=w.next,w.next=u),r.interleaved=u;return}}catch{}finally{}o=CH(s,r,u,l),o!==null&&(u=Cs(),Ma(o,s,l,u),qH(o,r,l))}}function HH(s){var r=s.alternate;return s===Vr||r!==null&&r===Vr}function KH(s,r){J_=J0=!0;var o=s.pending;o===null?r.next=r:(r.next=o.next,o.next=r),s.pending=r}function qH(s,r,o){if(o&4194240){var l=r.lanes;l&=s.pendingLanes,o|=l,r.lanes=o,vP(s,o)}}var Q0={readContext:Qo,useCallback:is,useContext:is,useEffect:is,useImperativeHandle:is,useInsertionEffect:is,useLayoutEffect:is,useMemo:is,useReducer:is,useRef:is,useState:is,useDebugValue:is,useDeferredValue:is,useTransition:is,useMutableSource:is,useSyncExternalStore:is,useId:is,unstable_isNewReconciler:!1},ehe={readContext:Qo,useCallback:function(s,r){return Sc().memoizedState=[s,r===void 0?null:r],s},useContext:Qo,useEffect:JG,useImperativeHandle:function(s,r,o){return o=o!=null?o.concat([s]):null,_0(4194308,4,VH.bind(null,r,s),o)},useLayoutEffect:function(s,r){return _0(4194308,4,s,r)},useInsertionEffect:function(s,r){return _0(4,2,s,r)},useMemo:function(s,r){var o=Sc();return r=r===void 0?null:r,s=s(),o.memoizedState=[s,r],s},useReducer:function(s,r,o){var l=Sc();return r=o!==void 0?o(r):r,l.memoizedState=l.baseState=r,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:r},l.queue=s,s=s.dispatch=$ue.bind(null,Vr,s),[l.memoizedState,s]},useRef:function(s){var r=Sc();return s={current:s},r.memoizedState=s},useState:XG,useDebugValue:GP,useDeferredValue:function(s){return Sc().memoizedState=s},useTransition:function(){var s=XG(!1),r=s[0];return s=Que.bind(null,s[1]),Sc().memoizedState=s,[r,s]},useMutableSource:function(){},useSyncExternalStore:function(s,r,o){var l=Vr,u=Sc();if(Pr){if(o===void 0)throw Error(ze(407));o=o()}else{if(o=r(),Di===null)throw Error(ze(349));Oh&30||OH(l,r,o)}u.memoizedState=o;var f={value:o,getSnapshot:r};return u.queue=f,JG(DH.bind(null,l,f,s),[s]),l.flags|=2048,TE(9,PH.bind(null,l,f,o,r),void 0,null),o},useId:function(){var s=Sc(),r=Di.identifierPrefix;if(Pr){var o=al,l=ol;o=(l&~(1<<32-La(l)-1)).toString(32)+o,r=":"+r+"R"+o,o=yE++,0<o&&(r+="H"+o.toString(32)),r+=":"}else o=Jue++,r=":"+r+"r"+o.toString(32)+":";return s.memoizedState=r},unstable_isNewReconciler:!1},the={readContext:Qo,useCallback:BH,useContext:Qo,useEffect:BP,useImperativeHandle:FH,useInsertionEffect:UH,useLayoutEffect:jH,useMemo:GH,useReducer:lx,useRef:MH,useState:function(){return lx(SE)},useDebugValue:GP,useDeferredValue:function(s){var r=$o();return WH(r,gi.memoizedState,s)},useTransition:function(){var s=lx(SE)[0],r=$o().memoizedState;return[s,r]},useMutableSource:NH,useSyncExternalStore:xH,useId:zH,unstable_isNewReconciler:!1},nhe={readContext:Qo,useCallback:BH,useContext:Qo,useEffect:BP,useImperativeHandle:FH,useInsertionEffect:UH,useLayoutEffect:jH,useMemo:GH,useReducer:dx,useRef:MH,useState:function(){return dx(SE)},useDebugValue:GP,useDeferredValue:function(s){var r=$o();return gi===null?r.memoizedState=s:WH(r,gi.memoizedState,s)},useTransition:function(){var s=dx(SE)[0],r=$o().memoizedState;return[s,r]},useMutableSource:NH,useSyncExternalStore:xH,useId:zH,unstable_isNewReconciler:!1};function xa(s,r){if(s&&s.defaultProps){r=Br({},r),s=s.defaultProps;for(var o in s)r[o]===void 0&&(r[o]=s[o]);return r}return r}function hO(s,r,o,l){r=s.memoizedState,o=o(l,r),o=o==null?r:Br({},r,o),s.memoizedState=o,s.lanes===0&&(s.updateQueue.baseState=o)}var jb={isMounted:function(s){return(s=s._reactInternals)?Gh(s)===s:!1},enqueueSetState:function(s,r,o){s=s._reactInternals;var l=Cs(),u=Fd(s),f=pl(l,u);f.payload=r,o!=null&&(f.callback=o),r=jd(s,f,u),r!==null&&(Ma(r,s,u,l),f0(r,s,u))},enqueueReplaceState:function(s,r,o){s=s._reactInternals;var l=Cs(),u=Fd(s),f=pl(l,u);f.tag=1,f.payload=r,o!=null&&(f.callback=o),r=jd(s,f,u),r!==null&&(Ma(r,s,u,l),f0(r,s,u))},enqueueForceUpdate:function(s,r){s=s._reactInternals;var o=Cs(),l=Fd(s),u=pl(o,l);u.tag=2,r!=null&&(u.callback=r),r=jd(s,u,l),r!==null&&(Ma(r,s,l,o),f0(r,s,l))}};function QG(s,r,o,l,u,f,E){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(l,f,E):r.prototype&&r.prototype.isPureReactComponent?!mE(o,l)||!mE(u,f):!0}function YH(s,r,o){var l=!1,u=Xd,f=r.contextType;return typeof f=="object"&&f!==null?f=Qo(f):(u=Js(r)?Nh:hs.current,l=r.contextTypes,f=(l=l!=null)?nf(s,u):Xd),r=new r(o,f),s.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=jb,s.stateNode=r,r._reactInternals=s,l&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=u,s.__reactInternalMemoizedMaskedChildContext=f),r}function $G(s,r,o,l){s=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(o,l),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(o,l),r.state!==s&&jb.enqueueReplaceState(r,r.state,null)}function pO(s,r,o,l){var u=s.stateNode;u.props=o,u.state=s.memoizedState,u.refs={},kP(s);var f=r.contextType;typeof f=="object"&&f!==null?u.context=Qo(f):(f=Js(r)?Nh:hs.current,u.context=nf(s,f)),u.state=s.memoizedState,f=r.getDerivedStateFromProps,typeof f=="function"&&(hO(s,r,f,o),u.state=s.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof u.getSnapshotBeforeUpdate=="function"||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(r=u.state,typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount(),r!==u.state&&jb.enqueueReplaceState(u,u.state,null),Y0(s,o,u,l),u.state=s.memoizedState),typeof u.componentDidMount=="function"&&(s.flags|=4194308)}function af(s,r){try{var o="",l=r;do o+=xde(l),l=l.return;while(l);var u=o}catch(f){u=`
Error generating stack: `+f.message+`
`+f.stack}return{value:s,source:r,stack:u,digest:null}}function ux(s,r,o){return{value:s,source:null,stack:o??null,digest:r??null}}function mO(s,r){try{console.error(r.value)}catch(o){setTimeout(function(){throw o})}}var rhe=typeof WeakMap=="function"?WeakMap:Map;function XH(s,r,o){o=pl(-1,o),o.tag=3,o.payload={element:null};var l=r.value;return o.callback=function(){Z0||(Z0=!0,RO=l),mO(s,r)},o}function JH(s,r,o){o=pl(-1,o),o.tag=3;var l=s.type.getDerivedStateFromError;if(typeof l=="function"){var u=r.value;o.payload=function(){return l(u)},o.callback=function(){mO(s,r)}}var f=s.stateNode;return f!==null&&typeof f.componentDidCatch=="function"&&(o.callback=function(){mO(s,r),typeof l!="function"&&(Vd===null?Vd=new Set([this]):Vd.add(this));var E=r.stack;this.componentDidCatch(r.value,{componentStack:E!==null?E:""})}),o}function ZG(s,r,o){var l=s.pingCache;if(l===null){l=s.pingCache=new rhe;var u=new Set;l.set(r,u)}else u=l.get(r),u===void 0&&(u=new Set,l.set(r,u));u.has(o)||(u.add(o),s=_he.bind(null,s,r,o),r.then(s,s))}function eW(s){do{var r;if((r=s.tag===13)&&(r=s.memoizedState,r=r!==null?r.dehydrated!==null:!0),r)return s;s=s.return}while(s!==null);return null}function tW(s,r,o,l,u){return s.mode&1?(s.flags|=65536,s.lanes=u,s):(s===r?s.flags|=65536:(s.flags|=128,o.flags|=131072,o.flags&=-52805,o.tag===1&&(o.alternate===null?o.tag=17:(r=pl(-1,1),r.tag=2,jd(o,r,1))),o.lanes|=1),s)}var ihe=Il.ReactCurrentOwner,Ys=!1;function Rs(s,r,o,l){r.child=s===null?wH(r,null,o,l):sf(r,s.child,o,l)}function nW(s,r,o,l,u){o=o.render;var f=r.ref;return Ym(r,u),l=VP(s,r,o,l,f,u),o=FP(),s!==null&&!Ys?(r.updateQueue=s.updateQueue,r.flags&=-2053,s.lanes&=~u,Sl(s,r,u)):(Pr&&o&&IP(r),r.flags|=1,Rs(s,r,l,u),r.child)}function rW(s,r,o,l,u){if(s===null){var f=o.type;return typeof f=="function"&&!JP(f)&&f.defaultProps===void 0&&o.compare===null&&o.defaultProps===void 0?(r.tag=15,r.type=f,QH(s,r,f,l,u)):(s=S0(o.type,null,l,r,r.mode,u),s.ref=r.ref,s.return=r,r.child=s)}if(f=s.child,!(s.lanes&u)){var E=f.memoizedProps;if(o=o.compare,o=o!==null?o:mE,o(E,l)&&s.ref===r.ref)return Sl(s,r,u)}return r.flags|=1,s=Bd(f,l),s.ref=r.ref,s.return=r,r.child=s}function QH(s,r,o,l,u){if(s!==null){var f=s.memoizedProps;if(mE(f,l)&&s.ref===r.ref)if(Ys=!1,r.pendingProps=l=f,(s.lanes&u)!==0)s.flags&131072&&(Ys=!0);else return r.lanes=s.lanes,Sl(s,r,u)}return fO(s,r,o,l,u)}function $H(s,r,o){var l=r.pendingProps,u=l.children,f=s!==null?s.memoizedState:null;if(l.mode==="hidden")if(!(r.mode&1))r.memoizedState={baseLanes:0,cachePool:null,transitions:null},dr(Wm,mo),mo|=o;else{if(!(o&1073741824))return s=f!==null?f.baseLanes|o:o,r.lanes=r.childLanes=1073741824,r.memoizedState={baseLanes:s,cachePool:null,transitions:null},r.updateQueue=null,dr(Wm,mo),mo|=s,null;r.memoizedState={baseLanes:0,cachePool:null,transitions:null},l=f!==null?f.baseLanes:o,dr(Wm,mo),mo|=l}else f!==null?(l=f.baseLanes|o,r.memoizedState=null):l=o,dr(Wm,mo),mo|=l;return Rs(s,r,u,o),r.child}function ZH(s,r){var o=r.ref;(s===null&&o!==null||s!==null&&s.ref!==o)&&(r.flags|=512,r.flags|=2097152)}function fO(s,r,o,l,u){var f=Js(o)?Nh:hs.current;return f=nf(r,f),Ym(r,u),o=VP(s,r,o,l,f,u),l=FP(),s!==null&&!Ys?(r.updateQueue=s.updateQueue,r.flags&=-2053,s.lanes&=~u,Sl(s,r,u)):(Pr&&l&&IP(r),r.flags|=1,Rs(s,r,o,u),r.child)}function iW(s,r,o,l,u){if(Js(o)){var f=!0;W0(r)}else f=!1;if(Ym(r,u),r.stateNode===null)E0(s,r),YH(r,o,l),pO(r,o,l,u),l=!0;else if(s===null){var E=r.stateNode,T=r.memoizedProps;E.props=T;var w=E.context,A=o.contextType;typeof A=="object"&&A!==null?A=Qo(A):(A=Js(o)?Nh:hs.current,A=nf(r,A));var U=o.getDerivedStateFromProps,M=typeof U=="function"||typeof E.getSnapshotBeforeUpdate=="function";M||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(T!==l||w!==A)&&$G(r,E,l,A),bd=!1;var F=r.memoizedState;E.state=F,Y0(r,l,E,u),w=r.memoizedState,T!==l||F!==w||Xs.current||bd?(typeof U=="function"&&(hO(r,o,U,l),w=r.memoizedState),(T=bd||QG(r,o,T,l,F,w,A))?(M||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount()),typeof E.componentDidMount=="function"&&(r.flags|=4194308)):(typeof E.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=l,r.memoizedState=w),E.props=l,E.state=w,E.context=A,l=T):(typeof E.componentDidMount=="function"&&(r.flags|=4194308),l=!1)}else{E=r.stateNode,IH(s,r),T=r.memoizedProps,A=r.type===r.elementType?T:xa(r.type,T),E.props=A,M=r.pendingProps,F=E.context,w=o.contextType,typeof w=="object"&&w!==null?w=Qo(w):(w=Js(o)?Nh:hs.current,w=nf(r,w));var Y=o.getDerivedStateFromProps;(U=typeof Y=="function"||typeof E.getSnapshotBeforeUpdate=="function")||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(T!==M||F!==w)&&$G(r,E,l,w),bd=!1,F=r.memoizedState,E.state=F,Y0(r,l,E,u);var J=r.memoizedState;T!==M||F!==J||Xs.current||bd?(typeof Y=="function"&&(hO(r,o,Y,l),J=r.memoizedState),(A=bd||QG(r,o,A,l,F,J,w)||!1)?(U||typeof E.UNSAFE_componentWillUpdate!="function"&&typeof E.componentWillUpdate!="function"||(typeof E.componentWillUpdate=="function"&&E.componentWillUpdate(l,J,w),typeof E.UNSAFE_componentWillUpdate=="function"&&E.UNSAFE_componentWillUpdate(l,J,w)),typeof E.componentDidUpdate=="function"&&(r.flags|=4),typeof E.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof E.componentDidUpdate!="function"||T===s.memoizedProps&&F===s.memoizedState||(r.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||T===s.memoizedProps&&F===s.memoizedState||(r.flags|=1024),r.memoizedProps=l,r.memoizedState=J),E.props=l,E.state=J,E.context=w,l=A):(typeof E.componentDidUpdate!="function"||T===s.memoizedProps&&F===s.memoizedState||(r.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||T===s.memoizedProps&&F===s.memoizedState||(r.flags|=1024),l=!1)}return gO(s,r,o,l,f,u)}function gO(s,r,o,l,u,f){ZH(s,r);var E=(r.flags&128)!==0;if(!l&&!E)return u&&WG(r,o,!1),Sl(s,r,f);l=r.stateNode,ihe.current=r;var T=E&&typeof o.getDerivedStateFromError!="function"?null:l.render();return r.flags|=1,s!==null&&E?(r.child=sf(r,s.child,null,f),r.child=sf(r,null,T,f)):Rs(s,r,T,f),r.memoizedState=l.state,u&&WG(r,o,!0),r.child}function e9(s){var r=s.stateNode;r.pendingContext?GG(s,r.pendingContext,r.pendingContext!==r.context):r.context&&GG(s,r.context,!1),LP(s,r.containerInfo)}function sW(s,r,o,l,u){return rf(),NP(u),r.flags|=256,Rs(s,r,o,l),r.child}var _O={dehydrated:null,treeContext:null,retryLane:0};function EO(s){return{baseLanes:s,cachePool:null,transitions:null}}function t9(s,r,o){var l=r.pendingProps,u=jr.current,f=!1,E=(r.flags&128)!==0,T;if((T=E)||(T=s!==null&&s.memoizedState===null?!1:(u&2)!==0),T?(f=!0,r.flags&=-129):(s===null||s.memoizedState!==null)&&(u|=1),dr(jr,u&1),s===null)return dO(r),s=r.memoizedState,s!==null&&(s=s.dehydrated,s!==null)?(r.mode&1?s.data==="$!"?r.lanes=8:r.lanes=1073741824:r.lanes=1,null):(E=l.children,s=l.fallback,f?(l=r.mode,f=r.child,E={mode:"hidden",children:E},!(l&1)&&f!==null?(f.childLanes=0,f.pendingProps=E):f=Bb(E,l,0,null),s=wh(s,l,o,null),f.return=r,s.return=r,f.sibling=s,r.child=f,r.child.memoizedState=EO(o),r.memoizedState=_O,s):WP(r,E));if(u=s.memoizedState,u!==null&&(T=u.dehydrated,T!==null))return she(s,r,E,l,T,u,o);if(f){f=l.fallback,E=r.mode,u=s.child,T=u.sibling;var w={mode:"hidden",children:l.children};return!(E&1)&&r.child!==u?(l=r.child,l.childLanes=0,l.pendingProps=w,r.deletions=null):(l=Bd(u,w),l.subtreeFlags=u.subtreeFlags&14680064),T!==null?f=Bd(T,f):(f=wh(f,E,o,null),f.flags|=2),f.return=r,l.return=r,l.sibling=f,r.child=l,l=f,f=r.child,E=s.child.memoizedState,E=E===null?EO(o):{baseLanes:E.baseLanes|o,cachePool:null,transitions:E.transitions},f.memoizedState=E,f.childLanes=s.childLanes&~o,r.memoizedState=_O,l}return f=s.child,s=f.sibling,l=Bd(f,{mode:"visible",children:l.children}),!(r.mode&1)&&(l.lanes=o),l.return=r,l.sibling=null,s!==null&&(o=r.deletions,o===null?(r.deletions=[s],r.flags|=16):o.push(s)),r.child=l,r.memoizedState=null,l}function WP(s,r){return r=Bb({mode:"visible",children:r},s.mode,0,null),r.return=s,s.child=r}function ZT(s,r,o,l){return l!==null&&NP(l),sf(r,s.child,null,o),s=WP(r,r.pendingProps.children),s.flags|=2,r.memoizedState=null,s}function she(s,r,o,l,u,f,E){if(o)return r.flags&256?(r.flags&=-257,l=ux(Error(ze(422))),ZT(s,r,E,l)):r.memoizedState!==null?(r.child=s.child,r.flags|=128,null):(f=l.fallback,u=r.mode,l=Bb({mode:"visible",children:l.children},u,0,null),f=wh(f,u,E,null),f.flags|=2,l.return=r,f.return=r,l.sibling=f,r.child=l,r.mode&1&&sf(r,s.child,null,E),r.child.memoizedState=EO(E),r.memoizedState=_O,f);if(!(r.mode&1))return ZT(s,r,E,null);if(u.data==="$!"){if(l=u.nextSibling&&u.nextSibling.dataset,l)var T=l.dgst;return l=T,f=Error(ze(419)),l=ux(f,l,void 0),ZT(s,r,E,l)}if(T=(E&s.childLanes)!==0,Ys||T){if(l=Di,l!==null){switch(E&-E){case 4:u=2;break;case 16:u=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:u=32;break;case 536870912:u=268435456;break;default:u=0}u=u&(l.suspendedLanes|E)?0:u,u!==0&&u!==f.retryLane&&(f.retryLane=u,yl(s,u),Ma(l,s,u,-1))}return XP(),l=ux(Error(ze(421))),ZT(s,r,E,l)}return u.data==="$?"?(r.flags|=128,r.child=s.child,r=Ehe.bind(null,s),u._reactRetry=r,null):(s=f.treeContext,go=Ud(u.nextSibling),Eo=r,Pr=!0,Pa=null,s!==null&&(Ho[Ko++]=ol,Ho[Ko++]=al,Ho[Ko++]=xh,ol=s.id,al=s.overflow,xh=r),r=WP(r,l.children),r.flags|=4096,r)}function oW(s,r,o){s.lanes|=r;var l=s.alternate;l!==null&&(l.lanes|=r),uO(s.return,r,o)}function hx(s,r,o,l,u){var f=s.memoizedState;f===null?s.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:l,tail:o,tailMode:u}:(f.isBackwards=r,f.rendering=null,f.renderingStartTime=0,f.last=l,f.tail=o,f.tailMode=u)}function n9(s,r,o){var l=r.pendingProps,u=l.revealOrder,f=l.tail;if(Rs(s,r,l.children,o),l=jr.current,l&2)l=l&1|2,r.flags|=128;else{if(s!==null&&s.flags&128)e:for(s=r.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&oW(s,o,r);else if(s.tag===19)oW(s,o,r);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break e;for(;s.sibling===null;){if(s.return===null||s.return===r)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}l&=1}if(dr(jr,l),!(r.mode&1))r.memoizedState=null;else switch(u){case"forwards":for(o=r.child,u=null;o!==null;)s=o.alternate,s!==null&&X0(s)===null&&(u=o),o=o.sibling;o=u,o===null?(u=r.child,r.child=null):(u=o.sibling,o.sibling=null),hx(r,!1,u,o,f);break;case"backwards":for(o=null,u=r.child,r.child=null;u!==null;){if(s=u.alternate,s!==null&&X0(s)===null){r.child=u;break}s=u.sibling,u.sibling=o,o=u,u=s}hx(r,!0,o,null,f);break;case"together":hx(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function E0(s,r){!(r.mode&1)&&s!==null&&(s.alternate=null,r.alternate=null,r.flags|=2)}function Sl(s,r,o){if(s!==null&&(r.dependencies=s.dependencies),Ph|=r.lanes,!(o&r.childLanes))return null;if(s!==null&&r.child!==s.child)throw Error(ze(153));if(r.child!==null){for(s=r.child,o=Bd(s,s.pendingProps),r.child=o,o.return=r;s.sibling!==null;)s=s.sibling,o=o.sibling=Bd(s,s.pendingProps),o.return=r;o.sibling=null}return r.child}function ohe(s,r,o){switch(r.tag){case 3:e9(r),rf();break;case 5:AH(r);break;case 1:Js(r.type)&&W0(r);break;case 4:LP(r,r.stateNode.containerInfo);break;case 10:var l=r.type._context,u=r.memoizedProps.value;dr(K0,l._currentValue),l._currentValue=u;break;case 13:if(l=r.memoizedState,l!==null)return l.dehydrated!==null?(dr(jr,jr.current&1),r.flags|=128,null):o&r.child.childLanes?t9(s,r,o):(dr(jr,jr.current&1),s=Sl(s,r,o),s!==null?s.sibling:null);dr(jr,jr.current&1);break;case 19:if(l=(o&r.childLanes)!==0,s.flags&128){if(l)return n9(s,r,o);r.flags|=128}if(u=r.memoizedState,u!==null&&(u.rendering=null,u.tail=null,u.lastEffect=null),dr(jr,jr.current),l)break;return null;case 22:case 23:return r.lanes=0,$H(s,r,o)}return Sl(s,r,o)}var r9,vO,i9,s9;r9=function(s,r){for(var o=r.child;o!==null;){if(o.tag===5||o.tag===6)s.appendChild(o.stateNode);else if(o.tag!==4&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return;o=o.return}o.sibling.return=o.return,o=o.sibling}};vO=function(){};i9=function(s,r,o,l){var u=s.memoizedProps;if(u!==l){s=r.stateNode,vh(Rc.current);var f=null;switch(o){case"input":u=Bx(s,u),l=Bx(s,l),f=[];break;case"select":u=Br({},u,{value:void 0}),l=Br({},l,{value:void 0}),f=[];break;case"textarea":u=zx(s,u),l=zx(s,l),f=[];break;default:typeof u.onClick!="function"&&typeof l.onClick=="function"&&(s.onclick=B0)}Kx(o,l);var E;o=null;for(A in u)if(!l.hasOwnProperty(A)&&u.hasOwnProperty(A)&&u[A]!=null)if(A==="style"){var T=u[A];for(E in T)T.hasOwnProperty(E)&&(o||(o={}),o[E]="")}else A!=="dangerouslySetInnerHTML"&&A!=="children"&&A!=="suppressContentEditableWarning"&&A!=="suppressHydrationWarning"&&A!=="autoFocus"&&(aE.hasOwnProperty(A)?f||(f=[]):(f=f||[]).push(A,null));for(A in l){var w=l[A];if(T=u!=null?u[A]:void 0,l.hasOwnProperty(A)&&w!==T&&(w!=null||T!=null))if(A==="style")if(T){for(E in T)!T.hasOwnProperty(E)||w&&w.hasOwnProperty(E)||(o||(o={}),o[E]="");for(E in w)w.hasOwnProperty(E)&&T[E]!==w[E]&&(o||(o={}),o[E]=w[E])}else o||(f||(f=[]),f.push(A,o)),o=w;else A==="dangerouslySetInnerHTML"?(w=w?w.__html:void 0,T=T?T.__html:void 0,w!=null&&T!==w&&(f=f||[]).push(A,w)):A==="children"?typeof w!="string"&&typeof w!="number"||(f=f||[]).push(A,""+w):A!=="suppressContentEditableWarning"&&A!=="suppressHydrationWarning"&&(aE.hasOwnProperty(A)?(w!=null&&A==="onScroll"&&Er("scroll",s),f||T===w||(f=[])):(f=f||[]).push(A,w))}o&&(f=f||[]).push("style",o);var A=f;(r.updateQueue=A)&&(r.flags|=4)}};s9=function(s,r,o,l){o!==l&&(r.flags|=4)};function x_(s,r){if(!Pr)switch(s.tailMode){case"hidden":r=s.tail;for(var o=null;r!==null;)r.alternate!==null&&(o=r),r=r.sibling;o===null?s.tail=null:o.sibling=null;break;case"collapsed":o=s.tail;for(var l=null;o!==null;)o.alternate!==null&&(l=o),o=o.sibling;l===null?r||s.tail===null?s.tail=null:s.tail.sibling=null:l.sibling=null}}function ss(s){var r=s.alternate!==null&&s.alternate.child===s.child,o=0,l=0;if(r)for(var u=s.child;u!==null;)o|=u.lanes|u.childLanes,l|=u.subtreeFlags&14680064,l|=u.flags&14680064,u.return=s,u=u.sibling;else for(u=s.child;u!==null;)o|=u.lanes|u.childLanes,l|=u.subtreeFlags,l|=u.flags,u.return=s,u=u.sibling;return s.subtreeFlags|=l,s.childLanes=o,r}function ahe(s,r,o){var l=r.pendingProps;switch(AP(r),r.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ss(r),null;case 1:return Js(r.type)&&G0(),ss(r),null;case 3:return l=r.stateNode,of(),yr(Xs),yr(hs),UP(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(s===null||s.child===null)&&(QT(r)?r.flags|=4:s===null||s.memoizedState.isDehydrated&&!(r.flags&256)||(r.flags|=1024,Pa!==null&&(IO(Pa),Pa=null))),vO(s,r),ss(r),null;case 5:MP(r);var u=vh(vE.current);if(o=r.type,s!==null&&r.stateNode!=null)i9(s,r,o,l,u),s.ref!==r.ref&&(r.flags|=512,r.flags|=2097152);else{if(!l){if(r.stateNode===null)throw Error(ze(166));return ss(r),null}if(s=vh(Rc.current),QT(r)){l=r.stateNode,o=r.type;var f=r.memoizedProps;switch(l[Tc]=r,l[_E]=f,s=(r.mode&1)!==0,o){case"dialog":Er("cancel",l),Er("close",l);break;case"iframe":case"object":case"embed":Er("load",l);break;case"video":case"audio":for(u=0;u<M_.length;u++)Er(M_[u],l);break;case"source":Er("error",l);break;case"img":case"image":case"link":Er("error",l),Er("load",l);break;case"details":Er("toggle",l);break;case"input":fG(l,f),Er("invalid",l);break;case"select":l._wrapperState={wasMultiple:!!f.multiple},Er("invalid",l);break;case"textarea":_G(l,f),Er("invalid",l)}Kx(o,f),u=null;for(var E in f)if(f.hasOwnProperty(E)){var T=f[E];E==="children"?typeof T=="string"?l.textContent!==T&&(f.suppressHydrationWarning!==!0&&JT(l.textContent,T,s),u=["children",T]):typeof T=="number"&&l.textContent!==""+T&&(f.suppressHydrationWarning!==!0&&JT(l.textContent,T,s),u=["children",""+T]):aE.hasOwnProperty(E)&&T!=null&&E==="onScroll"&&Er("scroll",l)}switch(o){case"input":GT(l),gG(l,f,!0);break;case"textarea":GT(l),EG(l);break;case"select":case"option":break;default:typeof f.onClick=="function"&&(l.onclick=B0)}l=u,r.updateQueue=l,l!==null&&(r.flags|=4)}else{E=u.nodeType===9?u:u.ownerDocument,s==="http://www.w3.org/1999/xhtml"&&(s=D8(o)),s==="http://www.w3.org/1999/xhtml"?o==="script"?(s=E.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild)):typeof l.is=="string"?s=E.createElement(o,{is:l.is}):(s=E.createElement(o),o==="select"&&(E=s,l.multiple?E.multiple=!0:l.size&&(E.size=l.size))):s=E.createElementNS(s,o),s[Tc]=r,s[_E]=l,r9(s,r,!1,!1),r.stateNode=s;e:{switch(E=qx(o,l),o){case"dialog":Er("cancel",s),Er("close",s),u=l;break;case"iframe":case"object":case"embed":Er("load",s),u=l;break;case"video":case"audio":for(u=0;u<M_.length;u++)Er(M_[u],s);u=l;break;case"source":Er("error",s),u=l;break;case"img":case"image":case"link":Er("error",s),Er("load",s),u=l;break;case"details":Er("toggle",s),u=l;break;case"input":fG(s,l),u=Bx(s,l),Er("invalid",s);break;case"option":u=l;break;case"select":s._wrapperState={wasMultiple:!!l.multiple},u=Br({},l,{value:void 0}),Er("invalid",s);break;case"textarea":_G(s,l),u=zx(s,l),Er("invalid",s);break;default:u=l}Kx(o,u),T=u;for(f in T)if(T.hasOwnProperty(f)){var w=T[f];f==="style"?M8(s,w):f==="dangerouslySetInnerHTML"?(w=w?w.__html:void 0,w!=null&&k8(s,w)):f==="children"?typeof w=="string"?(o!=="textarea"||w!=="")&&cE(s,w):typeof w=="number"&&cE(s,""+w):f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&f!=="autoFocus"&&(aE.hasOwnProperty(f)?w!=null&&f==="onScroll"&&Er("scroll",s):w!=null&&pP(s,f,w,E))}switch(o){case"input":GT(s),gG(s,l,!1);break;case"textarea":GT(s),EG(s);break;case"option":l.value!=null&&s.setAttribute("value",""+Yd(l.value));break;case"select":s.multiple=!!l.multiple,f=l.value,f!=null?zm(s,!!l.multiple,f,!1):l.defaultValue!=null&&zm(s,!!l.multiple,l.defaultValue,!0);break;default:typeof u.onClick=="function"&&(s.onclick=B0)}switch(o){case"button":case"input":case"select":case"textarea":l=!!l.autoFocus;break e;case"img":l=!0;break e;default:l=!1}}l&&(r.flags|=4)}r.ref!==null&&(r.flags|=512,r.flags|=2097152)}return ss(r),null;case 6:if(s&&r.stateNode!=null)s9(s,r,s.memoizedProps,l);else{if(typeof l!="string"&&r.stateNode===null)throw Error(ze(166));if(o=vh(vE.current),vh(Rc.current),QT(r)){if(l=r.stateNode,o=r.memoizedProps,l[Tc]=r,(f=l.nodeValue!==o)&&(s=Eo,s!==null))switch(s.tag){case 3:JT(l.nodeValue,o,(s.mode&1)!==0);break;case 5:s.memoizedProps.suppressHydrationWarning!==!0&&JT(l.nodeValue,o,(s.mode&1)!==0)}f&&(r.flags|=4)}else l=(o.nodeType===9?o:o.ownerDocument).createTextNode(l),l[Tc]=r,r.stateNode=l}return ss(r),null;case 13:if(yr(jr),l=r.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(Pr&&go!==null&&r.mode&1&&!(r.flags&128))bH(),rf(),r.flags|=98560,f=!1;else if(f=QT(r),l!==null&&l.dehydrated!==null){if(s===null){if(!f)throw Error(ze(318));if(f=r.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(ze(317));f[Tc]=r}else rf(),!(r.flags&128)&&(r.memoizedState=null),r.flags|=4;ss(r),f=!1}else Pa!==null&&(IO(Pa),Pa=null),f=!0;if(!f)return r.flags&65536?r:null}return r.flags&128?(r.lanes=o,r):(l=l!==null,l!==(s!==null&&s.memoizedState!==null)&&l&&(r.child.flags|=8192,r.mode&1&&(s===null||jr.current&1?Ei===0&&(Ei=3):XP())),r.updateQueue!==null&&(r.flags|=4),ss(r),null);case 4:return of(),vO(s,r),s===null&&fE(r.stateNode.containerInfo),ss(r),null;case 10:return PP(r.type._context),ss(r),null;case 17:return Js(r.type)&&G0(),ss(r),null;case 19:if(yr(jr),f=r.memoizedState,f===null)return ss(r),null;if(l=(r.flags&128)!==0,E=f.rendering,E===null)if(l)x_(f,!1);else{if(Ei!==0||s!==null&&s.flags&128)for(s=r.child;s!==null;){if(E=X0(s),E!==null){for(r.flags|=128,x_(f,!1),l=E.updateQueue,l!==null&&(r.updateQueue=l,r.flags|=4),r.subtreeFlags=0,l=o,o=r.child;o!==null;)f=o,s=l,f.flags&=14680066,E=f.alternate,E===null?(f.childLanes=0,f.lanes=s,f.child=null,f.subtreeFlags=0,f.memoizedProps=null,f.memoizedState=null,f.updateQueue=null,f.dependencies=null,f.stateNode=null):(f.childLanes=E.childLanes,f.lanes=E.lanes,f.child=E.child,f.subtreeFlags=0,f.deletions=null,f.memoizedProps=E.memoizedProps,f.memoizedState=E.memoizedState,f.updateQueue=E.updateQueue,f.type=E.type,s=E.dependencies,f.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),o=o.sibling;return dr(jr,jr.current&1|2),r.child}s=s.sibling}f.tail!==null&&$r()>cf&&(r.flags|=128,l=!0,x_(f,!1),r.lanes=4194304)}else{if(!l)if(s=X0(E),s!==null){if(r.flags|=128,l=!0,o=s.updateQueue,o!==null&&(r.updateQueue=o,r.flags|=4),x_(f,!0),f.tail===null&&f.tailMode==="hidden"&&!E.alternate&&!Pr)return ss(r),null}else 2*$r()-f.renderingStartTime>cf&&o!==1073741824&&(r.flags|=128,l=!0,x_(f,!1),r.lanes=4194304);f.isBackwards?(E.sibling=r.child,r.child=E):(o=f.last,o!==null?o.sibling=E:r.child=E,f.last=E)}return f.tail!==null?(r=f.tail,f.rendering=r,f.tail=r.sibling,f.renderingStartTime=$r(),r.sibling=null,o=jr.current,dr(jr,l?o&1|2:o&1),r):(ss(r),null);case 22:case 23:return YP(),l=r.memoizedState!==null,s!==null&&s.memoizedState!==null!==l&&(r.flags|=8192),l&&r.mode&1?mo&1073741824&&(ss(r),r.subtreeFlags&6&&(r.flags|=8192)):ss(r),null;case 24:return null;case 25:return null}throw Error(ze(156,r.tag))}function che(s,r){switch(AP(r),r.tag){case 1:return Js(r.type)&&G0(),s=r.flags,s&65536?(r.flags=s&-65537|128,r):null;case 3:return of(),yr(Xs),yr(hs),UP(),s=r.flags,s&65536&&!(s&128)?(r.flags=s&-65537|128,r):null;case 5:return MP(r),null;case 13:if(yr(jr),s=r.memoizedState,s!==null&&s.dehydrated!==null){if(r.alternate===null)throw Error(ze(340));rf()}return s=r.flags,s&65536?(r.flags=s&-65537|128,r):null;case 19:return yr(jr),null;case 4:return of(),null;case 10:return PP(r.type._context),null;case 22:case 23:return YP(),null;case 24:return null;default:return null}}var e0=!1,cs=!1,lhe=typeof WeakSet=="function"?WeakSet:Set,mt=null;function Gm(s,r){var o=s.ref;if(o!==null)if(typeof o=="function")try{o(null)}catch(l){qr(s,r,l)}else o.current=null}function yO(s,r,o){try{o()}catch(l){qr(s,r,l)}}var aW=!1;function dhe(s,r){if(rO=j0,s=dH(),CP(s)){if("selectionStart"in s)var o={start:s.selectionStart,end:s.selectionEnd};else e:{o=(o=s.ownerDocument)&&o.defaultView||window;var l=o.getSelection&&o.getSelection();if(l&&l.rangeCount!==0){o=l.anchorNode;var u=l.anchorOffset,f=l.focusNode;l=l.focusOffset;try{o.nodeType,f.nodeType}catch{o=null;break e}var E=0,T=-1,w=-1,A=0,U=0,M=s,F=null;t:for(;;){for(var Y;M!==o||u!==0&&M.nodeType!==3||(T=E+u),M!==f||l!==0&&M.nodeType!==3||(w=E+l),M.nodeType===3&&(E+=M.nodeValue.length),(Y=M.firstChild)!==null;)F=M,M=Y;for(;;){if(M===s)break t;if(F===o&&++A===u&&(T=E),F===f&&++U===l&&(w=E),(Y=M.nextSibling)!==null)break;M=F,F=M.parentNode}M=Y}o=T===-1||w===-1?null:{start:T,end:w}}else o=null}o=o||{start:0,end:0}}else o=null;for(iO={focusedElem:s,selectionRange:o},j0=!1,mt=r;mt!==null;)if(r=mt,s=r.child,(r.subtreeFlags&1028)!==0&&s!==null)s.return=r,mt=s;else for(;mt!==null;){r=mt;try{var J=r.alternate;if(r.flags&1024)switch(r.tag){case 0:case 11:case 15:break;case 1:if(J!==null){var ae=J.memoizedProps,he=J.memoizedState,ee=r.stateNode,W=ee.getSnapshotBeforeUpdate(r.elementType===r.type?ae:xa(r.type,ae),he);ee.__reactInternalSnapshotBeforeUpdate=W}break;case 3:var Z=r.stateNode.containerInfo;Z.nodeType===1?Z.textContent="":Z.nodeType===9&&Z.documentElement&&Z.removeChild(Z.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ze(163))}}catch(fe){qr(r,r.return,fe)}if(s=r.sibling,s!==null){s.return=r.return,mt=s;break}mt=r.return}return J=aW,aW=!1,J}function Q_(s,r,o){var l=r.updateQueue;if(l=l!==null?l.lastEffect:null,l!==null){var u=l=l.next;do{if((u.tag&s)===s){var f=u.destroy;u.destroy=void 0,f!==void 0&&yO(r,o,f)}u=u.next}while(u!==l)}}function Vb(s,r){if(r=r.updateQueue,r=r!==null?r.lastEffect:null,r!==null){var o=r=r.next;do{if((o.tag&s)===s){var l=o.create;o.destroy=l()}o=o.next}while(o!==r)}}function SO(s){var r=s.ref;if(r!==null){var o=s.stateNode;switch(s.tag){case 5:s=o;break;default:s=o}typeof r=="function"?r(s):r.current=s}}function o9(s){var r=s.alternate;r!==null&&(s.alternate=null,o9(r)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(r=s.stateNode,r!==null&&(delete r[Tc],delete r[_E],delete r[aO],delete r[Kue],delete r[que])),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}function a9(s){return s.tag===5||s.tag===3||s.tag===4}function cW(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||a9(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function TO(s,r,o){var l=s.tag;if(l===5||l===6)s=s.stateNode,r?o.nodeType===8?o.parentNode.insertBefore(s,r):o.insertBefore(s,r):(o.nodeType===8?(r=o.parentNode,r.insertBefore(s,o)):(r=o,r.appendChild(s)),o=o._reactRootContainer,o!=null||r.onclick!==null||(r.onclick=B0));else if(l!==4&&(s=s.child,s!==null))for(TO(s,r,o),s=s.sibling;s!==null;)TO(s,r,o),s=s.sibling}function bO(s,r,o){var l=s.tag;if(l===5||l===6)s=s.stateNode,r?o.insertBefore(s,r):o.appendChild(s);else if(l!==4&&(s=s.child,s!==null))for(bO(s,r,o),s=s.sibling;s!==null;)bO(s,r,o),s=s.sibling}var zi=null,Oa=!1;function vd(s,r,o){for(o=o.child;o!==null;)c9(s,r,o),o=o.sibling}function c9(s,r,o){if(bc&&typeof bc.onCommitFiberUnmount=="function")try{bc.onCommitFiberUnmount(Ob,o)}catch{}switch(o.tag){case 5:cs||Gm(o,r);case 6:var l=zi,u=Oa;zi=null,vd(s,r,o),zi=l,Oa=u,zi!==null&&(Oa?(s=zi,o=o.stateNode,s.nodeType===8?s.parentNode.removeChild(o):s.removeChild(o)):zi.removeChild(o.stateNode));break;case 18:zi!==null&&(Oa?(s=zi,o=o.stateNode,s.nodeType===8?sx(s.parentNode,o):s.nodeType===1&&sx(s,o),hE(s)):sx(zi,o.stateNode));break;case 4:l=zi,u=Oa,zi=o.stateNode.containerInfo,Oa=!0,vd(s,r,o),zi=l,Oa=u;break;case 0:case 11:case 14:case 15:if(!cs&&(l=o.updateQueue,l!==null&&(l=l.lastEffect,l!==null))){u=l=l.next;do{var f=u,E=f.destroy;f=f.tag,E!==void 0&&(f&2||f&4)&&yO(o,r,E),u=u.next}while(u!==l)}vd(s,r,o);break;case 1:if(!cs&&(Gm(o,r),l=o.stateNode,typeof l.componentWillUnmount=="function"))try{l.props=o.memoizedProps,l.state=o.memoizedState,l.componentWillUnmount()}catch(T){qr(o,r,T)}vd(s,r,o);break;case 21:vd(s,r,o);break;case 22:o.mode&1?(cs=(l=cs)||o.memoizedState!==null,vd(s,r,o),cs=l):vd(s,r,o);break;default:vd(s,r,o)}}function lW(s){var r=s.updateQueue;if(r!==null){s.updateQueue=null;var o=s.stateNode;o===null&&(o=s.stateNode=new lhe),r.forEach(function(l){var u=vhe.bind(null,s,l);o.has(l)||(o.add(l),l.then(u,u))})}}function Na(s,r){var o=r.deletions;if(o!==null)for(var l=0;l<o.length;l++){var u=o[l];try{var f=s,E=r,T=E;e:for(;T!==null;){switch(T.tag){case 5:zi=T.stateNode,Oa=!1;break e;case 3:zi=T.stateNode.containerInfo,Oa=!0;break e;case 4:zi=T.stateNode.containerInfo,Oa=!0;break e}T=T.return}if(zi===null)throw Error(ze(160));c9(f,E,u),zi=null,Oa=!1;var w=u.alternate;w!==null&&(w.return=null),u.return=null}catch(A){qr(u,r,A)}}if(r.subtreeFlags&12854)for(r=r.child;r!==null;)l9(r,s),r=r.sibling}function l9(s,r){var o=s.alternate,l=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:if(Na(r,s),vc(s),l&4){try{Q_(3,s,s.return),Vb(3,s)}catch(ae){qr(s,s.return,ae)}try{Q_(5,s,s.return)}catch(ae){qr(s,s.return,ae)}}break;case 1:Na(r,s),vc(s),l&512&&o!==null&&Gm(o,o.return);break;case 5:if(Na(r,s),vc(s),l&512&&o!==null&&Gm(o,o.return),s.flags&32){var u=s.stateNode;try{cE(u,"")}catch(ae){qr(s,s.return,ae)}}if(l&4&&(u=s.stateNode,u!=null)){var f=s.memoizedProps,E=o!==null?o.memoizedProps:f,T=s.type,w=s.updateQueue;if(s.updateQueue=null,w!==null)try{T==="input"&&f.type==="radio"&&f.name!=null&&O8(u,f),qx(T,E);var A=qx(T,f);for(E=0;E<w.length;E+=2){var U=w[E],M=w[E+1];U==="style"?M8(u,M):U==="dangerouslySetInnerHTML"?k8(u,M):U==="children"?cE(u,M):pP(u,U,M,A)}switch(T){case"input":Gx(u,f);break;case"textarea":P8(u,f);break;case"select":var F=u._wrapperState.wasMultiple;u._wrapperState.wasMultiple=!!f.multiple;var Y=f.value;Y!=null?zm(u,!!f.multiple,Y,!1):F!==!!f.multiple&&(f.defaultValue!=null?zm(u,!!f.multiple,f.defaultValue,!0):zm(u,!!f.multiple,f.multiple?[]:"",!1))}u[_E]=f}catch(ae){qr(s,s.return,ae)}}break;case 6:if(Na(r,s),vc(s),l&4){if(s.stateNode===null)throw Error(ze(162));u=s.stateNode,f=s.memoizedProps;try{u.nodeValue=f}catch(ae){qr(s,s.return,ae)}}break;case 3:if(Na(r,s),vc(s),l&4&&o!==null&&o.memoizedState.isDehydrated)try{hE(r.containerInfo)}catch(ae){qr(s,s.return,ae)}break;case 4:Na(r,s),vc(s);break;case 13:Na(r,s),vc(s),u=s.child,u.flags&8192&&(f=u.memoizedState!==null,u.stateNode.isHidden=f,!f||u.alternate!==null&&u.alternate.memoizedState!==null||(KP=$r())),l&4&&lW(s);break;case 22:if(U=o!==null&&o.memoizedState!==null,s.mode&1?(cs=(A=cs)||U,Na(r,s),cs=A):Na(r,s),vc(s),l&8192){if(A=s.memoizedState!==null,(s.stateNode.isHidden=A)&&!U&&s.mode&1)for(mt=s,U=s.child;U!==null;){for(M=mt=U;mt!==null;){switch(F=mt,Y=F.child,F.tag){case 0:case 11:case 14:case 15:Q_(4,F,F.return);break;case 1:Gm(F,F.return);var J=F.stateNode;if(typeof J.componentWillUnmount=="function"){l=F,o=F.return;try{r=l,J.props=r.memoizedProps,J.state=r.memoizedState,J.componentWillUnmount()}catch(ae){qr(l,o,ae)}}break;case 5:Gm(F,F.return);break;case 22:if(F.memoizedState!==null){uW(M);continue}}Y!==null?(Y.return=F,mt=Y):uW(M)}U=U.sibling}e:for(U=null,M=s;;){if(M.tag===5){if(U===null){U=M;try{u=M.stateNode,A?(f=u.style,typeof f.setProperty=="function"?f.setProperty("display","none","important"):f.display="none"):(T=M.stateNode,w=M.memoizedProps.style,E=w!=null&&w.hasOwnProperty("display")?w.display:null,T.style.display=L8("display",E))}catch(ae){qr(s,s.return,ae)}}}else if(M.tag===6){if(U===null)try{M.stateNode.nodeValue=A?"":M.memoizedProps}catch(ae){qr(s,s.return,ae)}}else if((M.tag!==22&&M.tag!==23||M.memoizedState===null||M===s)&&M.child!==null){M.child.return=M,M=M.child;continue}if(M===s)break e;for(;M.sibling===null;){if(M.return===null||M.return===s)break e;U===M&&(U=null),M=M.return}U===M&&(U=null),M.sibling.return=M.return,M=M.sibling}}break;case 19:Na(r,s),vc(s),l&4&&lW(s);break;case 21:break;default:Na(r,s),vc(s)}}function vc(s){var r=s.flags;if(r&2){try{e:{for(var o=s.return;o!==null;){if(a9(o)){var l=o;break e}o=o.return}throw Error(ze(160))}switch(l.tag){case 5:var u=l.stateNode;l.flags&32&&(cE(u,""),l.flags&=-33);var f=cW(s);bO(s,f,u);break;case 3:case 4:var E=l.stateNode.containerInfo,T=cW(s);TO(s,T,E);break;default:throw Error(ze(161))}}catch(w){qr(s,s.return,w)}s.flags&=-3}r&4096&&(s.flags&=-4097)}function uhe(s,r,o){mt=s,d9(s)}function d9(s,r,o){for(var l=(s.mode&1)!==0;mt!==null;){var u=mt,f=u.child;if(u.tag===22&&l){var E=u.memoizedState!==null||e0;if(!E){var T=u.alternate,w=T!==null&&T.memoizedState!==null||cs;T=e0;var A=cs;if(e0=E,(cs=w)&&!A)for(mt=u;mt!==null;)E=mt,w=E.child,E.tag===22&&E.memoizedState!==null?hW(u):w!==null?(w.return=E,mt=w):hW(u);for(;f!==null;)mt=f,d9(f),f=f.sibling;mt=u,e0=T,cs=A}dW(s)}else u.subtreeFlags&8772&&f!==null?(f.return=u,mt=f):dW(s)}}function dW(s){for(;mt!==null;){var r=mt;if(r.flags&8772){var o=r.alternate;try{if(r.flags&8772)switch(r.tag){case 0:case 11:case 15:cs||Vb(5,r);break;case 1:var l=r.stateNode;if(r.flags&4&&!cs)if(o===null)l.componentDidMount();else{var u=r.elementType===r.type?o.memoizedProps:xa(r.type,o.memoizedProps);l.componentDidUpdate(u,o.memoizedState,l.__reactInternalSnapshotBeforeUpdate)}var f=r.updateQueue;f!==null&&YG(r,f,l);break;case 3:var E=r.updateQueue;if(E!==null){if(o=null,r.child!==null)switch(r.child.tag){case 5:o=r.child.stateNode;break;case 1:o=r.child.stateNode}YG(r,E,o)}break;case 5:var T=r.stateNode;if(o===null&&r.flags&4){o=T;var w=r.memoizedProps;switch(r.type){case"button":case"input":case"select":case"textarea":w.autoFocus&&o.focus();break;case"img":w.src&&(o.src=w.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(r.memoizedState===null){var A=r.alternate;if(A!==null){var U=A.memoizedState;if(U!==null){var M=U.dehydrated;M!==null&&hE(M)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ze(163))}cs||r.flags&512&&SO(r)}catch(F){qr(r,r.return,F)}}if(r===s){mt=null;break}if(o=r.sibling,o!==null){o.return=r.return,mt=o;break}mt=r.return}}function uW(s){for(;mt!==null;){var r=mt;if(r===s){mt=null;break}var o=r.sibling;if(o!==null){o.return=r.return,mt=o;break}mt=r.return}}function hW(s){for(;mt!==null;){var r=mt;try{switch(r.tag){case 0:case 11:case 15:var o=r.return;try{Vb(4,r)}catch(w){qr(r,o,w)}break;case 1:var l=r.stateNode;if(typeof l.componentDidMount=="function"){var u=r.return;try{l.componentDidMount()}catch(w){qr(r,u,w)}}var f=r.return;try{SO(r)}catch(w){qr(r,f,w)}break;case 5:var E=r.return;try{SO(r)}catch(w){qr(r,E,w)}}}catch(w){qr(r,r.return,w)}if(r===s){mt=null;break}var T=r.sibling;if(T!==null){T.return=r.return,mt=T;break}mt=r.return}}var hhe=Math.ceil,$0=Il.ReactCurrentDispatcher,zP=Il.ReactCurrentOwner,Xo=Il.ReactCurrentBatchConfig,On=0,Di=null,si=null,qi=0,mo=0,Wm=iu(0),Ei=0,bE=null,Ph=0,Fb=0,HP=0,$_=null,Ks=null,KP=0,cf=1/0,tl=null,Z0=!1,RO=null,Vd=null,t0=!1,Od=null,eb=0,Z_=0,wO=null,v0=-1,y0=0;function Cs(){return On&6?$r():v0!==-1?v0:v0=$r()}function Fd(s){return s.mode&1?On&2&&qi!==0?qi&-qi:Xue.transition!==null?(y0===0&&(y0=Y8()),y0):(s=Xn,s!==0||(s=window.event,s=s===void 0?16:tH(s.type)),s):1}function Ma(s,r,o,l){if(50<Z_)throw Z_=0,wO=null,Error(ze(185));FE(s,o,l),(!(On&2)||s!==Di)&&(s===Di&&(!(On&2)&&(Fb|=o),Ei===4&&Cd(s,qi)),Qs(s,l),o===1&&On===0&&!(r.mode&1)&&(cf=$r()+500,Mb&&su()))}function Qs(s,r){var o=s.callbackNode;Xde(s,r);var l=U0(s,s===Di?qi:0);if(l===0)o!==null&&SG(o),s.callbackNode=null,s.callbackPriority=0;else if(r=l&-l,s.callbackPriority!==r){if(o!=null&&SG(o),r===1)s.tag===0?Yue(pW.bind(null,s)):yH(pW.bind(null,s)),zue(function(){!(On&6)&&su()}),o=null;else{switch(X8(l)){case 1:o=EP;break;case 4:o=K8;break;case 16:o=M0;break;case 536870912:o=q8;break;default:o=M0}o=E9(o,u9.bind(null,s))}s.callbackPriority=r,s.callbackNode=o}}function u9(s,r){if(v0=-1,y0=0,On&6)throw Error(ze(327));var o=s.callbackNode;if(Xm()&&s.callbackNode!==o)return null;var l=U0(s,s===Di?qi:0);if(l===0)return null;if(l&30||l&s.expiredLanes||r)r=tb(s,l);else{r=l;var u=On;On|=2;var f=p9();(Di!==s||qi!==r)&&(tl=null,cf=$r()+500,Rh(s,r));do try{fhe();break}catch(T){h9(s,T)}while(!0);OP(),$0.current=f,On=u,si!==null?r=0:(Di=null,qi=0,r=Ei)}if(r!==0){if(r===2&&(u=$x(s),u!==0&&(l=u,r=CO(s,u))),r===1)throw o=bE,Rh(s,0),Cd(s,l),Qs(s,$r()),o;if(r===6)Cd(s,l);else{if(u=s.current.alternate,!(l&30)&&!phe(u)&&(r=tb(s,l),r===2&&(f=$x(s),f!==0&&(l=f,r=CO(s,f))),r===1))throw o=bE,Rh(s,0),Cd(s,l),Qs(s,$r()),o;switch(s.finishedWork=u,s.finishedLanes=l,r){case 0:case 1:throw Error(ze(345));case 2:ph(s,Ks,tl);break;case 3:if(Cd(s,l),(l&130023424)===l&&(r=KP+500-$r(),10<r)){if(U0(s,0)!==0)break;if(u=s.suspendedLanes,(u&l)!==l){Cs(),s.pingedLanes|=s.suspendedLanes&u;break}s.timeoutHandle=oO(ph.bind(null,s,Ks,tl),r);break}ph(s,Ks,tl);break;case 4:if(Cd(s,l),(l&4194240)===l)break;for(r=s.eventTimes,u=-1;0<l;){var E=31-La(l);f=1<<E,E=r[E],E>u&&(u=E),l&=~f}if(l=u,l=$r()-l,l=(120>l?120:480>l?480:1080>l?1080:1920>l?1920:3e3>l?3e3:4320>l?4320:1960*hhe(l/1960))-l,10<l){s.timeoutHandle=oO(ph.bind(null,s,Ks,tl),l);break}ph(s,Ks,tl);break;case 5:ph(s,Ks,tl);break;default:throw Error(ze(329))}}}return Qs(s,$r()),s.callbackNode===o?u9.bind(null,s):null}function CO(s,r){var o=$_;return s.current.memoizedState.isDehydrated&&(Rh(s,r).flags|=256),s=tb(s,r),s!==2&&(r=Ks,Ks=o,r!==null&&IO(r)),s}function IO(s){Ks===null?Ks=s:Ks.push.apply(Ks,s)}function phe(s){for(var r=s;;){if(r.flags&16384){var o=r.updateQueue;if(o!==null&&(o=o.stores,o!==null))for(var l=0;l<o.length;l++){var u=o[l],f=u.getSnapshot;u=u.value;try{if(!Fa(f(),u))return!1}catch{return!1}}}if(o=r.child,r.subtreeFlags&16384&&o!==null)o.return=r,r=o;else{if(r===s)break;for(;r.sibling===null;){if(r.return===null||r.return===s)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function Cd(s,r){for(r&=~HP,r&=~Fb,s.suspendedLanes|=r,s.pingedLanes&=~r,s=s.expirationTimes;0<r;){var o=31-La(r),l=1<<o;s[o]=-1,r&=~l}}function pW(s){if(On&6)throw Error(ze(327));Xm();var r=U0(s,0);if(!(r&1))return Qs(s,$r()),null;var o=tb(s,r);if(s.tag!==0&&o===2){var l=$x(s);l!==0&&(r=l,o=CO(s,l))}if(o===1)throw o=bE,Rh(s,0),Cd(s,r),Qs(s,$r()),o;if(o===6)throw Error(ze(345));return s.finishedWork=s.current.alternate,s.finishedLanes=r,ph(s,Ks,tl),Qs(s,$r()),null}function qP(s,r){var o=On;On|=1;try{return s(r)}finally{On=o,On===0&&(cf=$r()+500,Mb&&su())}}function Dh(s){Od!==null&&Od.tag===0&&!(On&6)&&Xm();var r=On;On|=1;var o=Xo.transition,l=Xn;try{if(Xo.transition=null,Xn=1,s)return s()}finally{Xn=l,Xo.transition=o,On=r,!(On&6)&&su()}}function YP(){mo=Wm.current,yr(Wm)}function Rh(s,r){s.finishedWork=null,s.finishedLanes=0;var o=s.timeoutHandle;if(o!==-1&&(s.timeoutHandle=-1,Wue(o)),si!==null)for(o=si.return;o!==null;){var l=o;switch(AP(l),l.tag){case 1:l=l.type.childContextTypes,l!=null&&G0();break;case 3:of(),yr(Xs),yr(hs),UP();break;case 5:MP(l);break;case 4:of();break;case 13:yr(jr);break;case 19:yr(jr);break;case 10:PP(l.type._context);break;case 22:case 23:YP()}o=o.return}if(Di=s,si=s=Bd(s.current,null),qi=mo=r,Ei=0,bE=null,HP=Fb=Ph=0,Ks=$_=null,Eh!==null){for(r=0;r<Eh.length;r++)if(o=Eh[r],l=o.interleaved,l!==null){o.interleaved=null;var u=l.next,f=o.pending;if(f!==null){var E=f.next;f.next=u,l.next=E}o.pending=l}Eh=null}return s}function h9(s,r){do{var o=si;try{if(OP(),g0.current=Q0,J0){for(var l=Vr.memoizedState;l!==null;){var u=l.queue;u!==null&&(u.pending=null),l=l.next}J0=!1}if(Oh=0,Pi=gi=Vr=null,J_=!1,yE=0,zP.current=null,o===null||o.return===null){Ei=1,bE=r,si=null;break}e:{var f=s,E=o.return,T=o,w=r;if(r=qi,T.flags|=32768,w!==null&&typeof w=="object"&&typeof w.then=="function"){var A=w,U=T,M=U.tag;if(!(U.mode&1)&&(M===0||M===11||M===15)){var F=U.alternate;F?(U.updateQueue=F.updateQueue,U.memoizedState=F.memoizedState,U.lanes=F.lanes):(U.updateQueue=null,U.memoizedState=null)}var Y=eW(E);if(Y!==null){Y.flags&=-257,tW(Y,E,T,f,r),Y.mode&1&&ZG(f,A,r),r=Y,w=A;var J=r.updateQueue;if(J===null){var ae=new Set;ae.add(w),r.updateQueue=ae}else J.add(w);break e}else{if(!(r&1)){ZG(f,A,r),XP();break e}w=Error(ze(426))}}else if(Pr&&T.mode&1){var he=eW(E);if(he!==null){!(he.flags&65536)&&(he.flags|=256),tW(he,E,T,f,r),NP(af(w,T));break e}}f=w=af(w,T),Ei!==4&&(Ei=2),$_===null?$_=[f]:$_.push(f),f=E;do{switch(f.tag){case 3:f.flags|=65536,r&=-r,f.lanes|=r;var ee=XH(f,w,r);qG(f,ee);break e;case 1:T=w;var W=f.type,Z=f.stateNode;if(!(f.flags&128)&&(typeof W.getDerivedStateFromError=="function"||Z!==null&&typeof Z.componentDidCatch=="function"&&(Vd===null||!Vd.has(Z)))){f.flags|=65536,r&=-r,f.lanes|=r;var fe=JH(f,T,r);qG(f,fe);break e}}f=f.return}while(f!==null)}f9(o)}catch(pe){r=pe,si===o&&o!==null&&(si=o=o.return);continue}break}while(!0)}function p9(){var s=$0.current;return $0.current=Q0,s===null?Q0:s}function XP(){(Ei===0||Ei===3||Ei===2)&&(Ei=4),Di===null||!(Ph&268435455)&&!(Fb&268435455)||Cd(Di,qi)}function tb(s,r){var o=On;On|=2;var l=p9();(Di!==s||qi!==r)&&(tl=null,Rh(s,r));do try{mhe();break}catch(u){h9(s,u)}while(!0);if(OP(),On=o,$0.current=l,si!==null)throw Error(ze(261));return Di=null,qi=0,Ei}function mhe(){for(;si!==null;)m9(si)}function fhe(){for(;si!==null&&!Fde();)m9(si)}function m9(s){var r=_9(s.alternate,s,mo);s.memoizedProps=s.pendingProps,r===null?f9(s):si=r,zP.current=null}function f9(s){var r=s;do{var o=r.alternate;if(s=r.return,r.flags&32768){if(o=che(o,r),o!==null){o.flags&=32767,si=o;return}if(s!==null)s.flags|=32768,s.subtreeFlags=0,s.deletions=null;else{Ei=6,si=null;return}}else if(o=ahe(o,r,mo),o!==null){si=o;return}if(r=r.sibling,r!==null){si=r;return}si=r=s}while(r!==null);Ei===0&&(Ei=5)}function ph(s,r,o){var l=Xn,u=Xo.transition;try{Xo.transition=null,Xn=1,ghe(s,r,o,l)}finally{Xo.transition=u,Xn=l}return null}function ghe(s,r,o,l){do Xm();while(Od!==null);if(On&6)throw Error(ze(327));o=s.finishedWork;var u=s.finishedLanes;if(o===null)return null;if(s.finishedWork=null,s.finishedLanes=0,o===s.current)throw Error(ze(177));s.callbackNode=null,s.callbackPriority=0;var f=o.lanes|o.childLanes;if(Jde(s,f),s===Di&&(si=Di=null,qi=0),!(o.subtreeFlags&2064)&&!(o.flags&2064)||t0||(t0=!0,E9(M0,function(){return Xm(),null})),f=(o.flags&15990)!==0,o.subtreeFlags&15990||f){f=Xo.transition,Xo.transition=null;var E=Xn;Xn=1;var T=On;On|=4,zP.current=null,dhe(s,o),l9(o,s),Mue(iO),j0=!!rO,iO=rO=null,s.current=o,uhe(o),Bde(),On=T,Xn=E,Xo.transition=f}else s.current=o;if(t0&&(t0=!1,Od=s,eb=u),f=s.pendingLanes,f===0&&(Vd=null),zde(o.stateNode),Qs(s,$r()),r!==null)for(l=s.onRecoverableError,o=0;o<r.length;o++)u=r[o],l(u.value,{componentStack:u.stack,digest:u.digest});if(Z0)throw Z0=!1,s=RO,RO=null,s;return eb&1&&s.tag!==0&&Xm(),f=s.pendingLanes,f&1?s===wO?Z_++:(Z_=0,wO=s):Z_=0,su(),null}function Xm(){if(Od!==null){var s=X8(eb),r=Xo.transition,o=Xn;try{if(Xo.transition=null,Xn=16>s?16:s,Od===null)var l=!1;else{if(s=Od,Od=null,eb=0,On&6)throw Error(ze(331));var u=On;for(On|=4,mt=s.current;mt!==null;){var f=mt,E=f.child;if(mt.flags&16){var T=f.deletions;if(T!==null){for(var w=0;w<T.length;w++){var A=T[w];for(mt=A;mt!==null;){var U=mt;switch(U.tag){case 0:case 11:case 15:Q_(8,U,f)}var M=U.child;if(M!==null)M.return=U,mt=M;else for(;mt!==null;){U=mt;var F=U.sibling,Y=U.return;if(o9(U),U===A){mt=null;break}if(F!==null){F.return=Y,mt=F;break}mt=Y}}}var J=f.alternate;if(J!==null){var ae=J.child;if(ae!==null){J.child=null;do{var he=ae.sibling;ae.sibling=null,ae=he}while(ae!==null)}}mt=f}}if(f.subtreeFlags&2064&&E!==null)E.return=f,mt=E;else e:for(;mt!==null;){if(f=mt,f.flags&2048)switch(f.tag){case 0:case 11:case 15:Q_(9,f,f.return)}var ee=f.sibling;if(ee!==null){ee.return=f.return,mt=ee;break e}mt=f.return}}var W=s.current;for(mt=W;mt!==null;){E=mt;var Z=E.child;if(E.subtreeFlags&2064&&Z!==null)Z.return=E,mt=Z;else e:for(E=W;mt!==null;){if(T=mt,T.flags&2048)try{switch(T.tag){case 0:case 11:case 15:Vb(9,T)}}catch(pe){qr(T,T.return,pe)}if(T===E){mt=null;break e}var fe=T.sibling;if(fe!==null){fe.return=T.return,mt=fe;break e}mt=T.return}}if(On=u,su(),bc&&typeof bc.onPostCommitFiberRoot=="function")try{bc.onPostCommitFiberRoot(Ob,s)}catch{}l=!0}return l}finally{Xn=o,Xo.transition=r}}return!1}function mW(s,r,o){r=af(o,r),r=XH(s,r,1),s=jd(s,r,1),r=Cs(),s!==null&&(FE(s,1,r),Qs(s,r))}function qr(s,r,o){if(s.tag===3)mW(s,s,o);else for(;r!==null;){if(r.tag===3){mW(r,s,o);break}else if(r.tag===1){var l=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(Vd===null||!Vd.has(l))){s=af(o,s),s=JH(r,s,1),r=jd(r,s,1),s=Cs(),r!==null&&(FE(r,1,s),Qs(r,s));break}}r=r.return}}function _he(s,r,o){var l=s.pingCache;l!==null&&l.delete(r),r=Cs(),s.pingedLanes|=s.suspendedLanes&o,Di===s&&(qi&o)===o&&(Ei===4||Ei===3&&(qi&130023424)===qi&&500>$r()-KP?Rh(s,0):HP|=o),Qs(s,r)}function g9(s,r){r===0&&(s.mode&1?(r=HT,HT<<=1,!(HT&130023424)&&(HT=4194304)):r=1);var o=Cs();s=yl(s,r),s!==null&&(FE(s,r,o),Qs(s,o))}function Ehe(s){var r=s.memoizedState,o=0;r!==null&&(o=r.retryLane),g9(s,o)}function vhe(s,r){var o=0;switch(s.tag){case 13:var l=s.stateNode,u=s.memoizedState;u!==null&&(o=u.retryLane);break;case 19:l=s.stateNode;break;default:throw Error(ze(314))}l!==null&&l.delete(r),g9(s,o)}var _9;_9=function(s,r,o){if(s!==null)if(s.memoizedProps!==r.pendingProps||Xs.current)Ys=!0;else{if(!(s.lanes&o)&&!(r.flags&128))return Ys=!1,ohe(s,r,o);Ys=!!(s.flags&131072)}else Ys=!1,Pr&&r.flags&1048576&&SH(r,H0,r.index);switch(r.lanes=0,r.tag){case 2:var l=r.type;E0(s,r),s=r.pendingProps;var u=nf(r,hs.current);Ym(r,o),u=VP(null,r,l,s,u,o);var f=FP();return r.flags|=1,typeof u=="object"&&u!==null&&typeof u.render=="function"&&u.$$typeof===void 0?(r.tag=1,r.memoizedState=null,r.updateQueue=null,Js(l)?(f=!0,W0(r)):f=!1,r.memoizedState=u.state!==null&&u.state!==void 0?u.state:null,kP(r),u.updater=jb,r.stateNode=u,u._reactInternals=r,pO(r,l,s,o),r=gO(null,r,l,!0,f,o)):(r.tag=0,Pr&&f&&IP(r),Rs(null,r,u,o),r=r.child),r;case 16:l=r.elementType;e:{switch(E0(s,r),s=r.pendingProps,u=l._init,l=u(l._payload),r.type=l,u=r.tag=She(l),s=xa(l,s),u){case 0:r=fO(null,r,l,s,o);break e;case 1:r=iW(null,r,l,s,o);break e;case 11:r=nW(null,r,l,s,o);break e;case 14:r=rW(null,r,l,xa(l.type,s),o);break e}throw Error(ze(306,l,""))}return r;case 0:return l=r.type,u=r.pendingProps,u=r.elementType===l?u:xa(l,u),fO(s,r,l,u,o);case 1:return l=r.type,u=r.pendingProps,u=r.elementType===l?u:xa(l,u),iW(s,r,l,u,o);case 3:e:{if(e9(r),s===null)throw Error(ze(387));l=r.pendingProps,f=r.memoizedState,u=f.element,IH(s,r),Y0(r,l,null,o);var E=r.memoizedState;if(l=E.element,f.isDehydrated)if(f={element:l,isDehydrated:!1,cache:E.cache,pendingSuspenseBoundaries:E.pendingSuspenseBoundaries,transitions:E.transitions},r.updateQueue.baseState=f,r.memoizedState=f,r.flags&256){u=af(Error(ze(423)),r),r=sW(s,r,l,o,u);break e}else if(l!==u){u=af(Error(ze(424)),r),r=sW(s,r,l,o,u);break e}else for(go=Ud(r.stateNode.containerInfo.firstChild),Eo=r,Pr=!0,Pa=null,o=wH(r,null,l,o),r.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(rf(),l===u){r=Sl(s,r,o);break e}Rs(s,r,l,o)}r=r.child}return r;case 5:return AH(r),s===null&&dO(r),l=r.type,u=r.pendingProps,f=s!==null?s.memoizedProps:null,E=u.children,sO(l,u)?E=null:f!==null&&sO(l,f)&&(r.flags|=32),ZH(s,r),Rs(s,r,E,o),r.child;case 6:return s===null&&dO(r),null;case 13:return t9(s,r,o);case 4:return LP(r,r.stateNode.containerInfo),l=r.pendingProps,s===null?r.child=sf(r,null,l,o):Rs(s,r,l,o),r.child;case 11:return l=r.type,u=r.pendingProps,u=r.elementType===l?u:xa(l,u),nW(s,r,l,u,o);case 7:return Rs(s,r,r.pendingProps,o),r.child;case 8:return Rs(s,r,r.pendingProps.children,o),r.child;case 12:return Rs(s,r,r.pendingProps.children,o),r.child;case 10:e:{if(l=r.type._context,u=r.pendingProps,f=r.memoizedProps,E=u.value,dr(K0,l._currentValue),l._currentValue=E,f!==null)if(Fa(f.value,E)){if(f.children===u.children&&!Xs.current){r=Sl(s,r,o);break e}}else for(f=r.child,f!==null&&(f.return=r);f!==null;){var T=f.dependencies;if(T!==null){E=f.child;for(var w=T.firstContext;w!==null;){if(w.context===l){if(f.tag===1){w=pl(-1,o&-o),w.tag=2;var A=f.updateQueue;if(A!==null){A=A.shared;var U=A.pending;U===null?w.next=w:(w.next=U.next,U.next=w),A.pending=w}}f.lanes|=o,w=f.alternate,w!==null&&(w.lanes|=o),uO(f.return,o,r),T.lanes|=o;break}w=w.next}}else if(f.tag===10)E=f.type===r.type?null:f.child;else if(f.tag===18){if(E=f.return,E===null)throw Error(ze(341));E.lanes|=o,T=E.alternate,T!==null&&(T.lanes|=o),uO(E,o,r),E=f.sibling}else E=f.child;if(E!==null)E.return=f;else for(E=f;E!==null;){if(E===r){E=null;break}if(f=E.sibling,f!==null){f.return=E.return,E=f;break}E=E.return}f=E}Rs(s,r,u.children,o),r=r.child}return r;case 9:return u=r.type,l=r.pendingProps.children,Ym(r,o),u=Qo(u),l=l(u),r.flags|=1,Rs(s,r,l,o),r.child;case 14:return l=r.type,u=xa(l,r.pendingProps),u=xa(l.type,u),rW(s,r,l,u,o);case 15:return QH(s,r,r.type,r.pendingProps,o);case 17:return l=r.type,u=r.pendingProps,u=r.elementType===l?u:xa(l,u),E0(s,r),r.tag=1,Js(l)?(s=!0,W0(r)):s=!1,Ym(r,o),YH(r,l,u),pO(r,l,u,o),gO(null,r,l,!0,s,o);case 19:return n9(s,r,o);case 22:return $H(s,r,o)}throw Error(ze(156,r.tag))};function E9(s,r){return H8(s,r)}function yhe(s,r,o,l){this.tag=s,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Yo(s,r,o,l){return new yhe(s,r,o,l)}function JP(s){return s=s.prototype,!(!s||!s.isReactComponent)}function She(s){if(typeof s=="function")return JP(s)?1:0;if(s!=null){if(s=s.$$typeof,s===fP)return 11;if(s===gP)return 14}return 2}function Bd(s,r){var o=s.alternate;return o===null?(o=Yo(s.tag,r,s.key,s.mode),o.elementType=s.elementType,o.type=s.type,o.stateNode=s.stateNode,o.alternate=s,s.alternate=o):(o.pendingProps=r,o.type=s.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=s.flags&14680064,o.childLanes=s.childLanes,o.lanes=s.lanes,o.child=s.child,o.memoizedProps=s.memoizedProps,o.memoizedState=s.memoizedState,o.updateQueue=s.updateQueue,r=s.dependencies,o.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},o.sibling=s.sibling,o.index=s.index,o.ref=s.ref,o}function S0(s,r,o,l,u,f){var E=2;if(l=s,typeof s=="function")JP(s)&&(E=1);else if(typeof s=="string")E=5;else e:switch(s){case Dm:return wh(o.children,u,f,r);case mP:E=8,u|=8;break;case Ux:return s=Yo(12,o,r,u|2),s.elementType=Ux,s.lanes=f,s;case jx:return s=Yo(13,o,r,u),s.elementType=jx,s.lanes=f,s;case Vx:return s=Yo(19,o,r,u),s.elementType=Vx,s.lanes=f,s;case A8:return Bb(o,u,f,r);default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case C8:E=10;break e;case I8:E=9;break e;case fP:E=11;break e;case gP:E=14;break e;case Td:E=16,l=null;break e}throw Error(ze(130,s==null?s:typeof s,""))}return r=Yo(E,o,r,u),r.elementType=s,r.type=l,r.lanes=f,r}function wh(s,r,o,l){return s=Yo(7,s,l,r),s.lanes=o,s}function Bb(s,r,o,l){return s=Yo(22,s,l,r),s.elementType=A8,s.lanes=o,s.stateNode={isHidden:!1},s}function px(s,r,o){return s=Yo(6,s,null,r),s.lanes=o,s}function mx(s,r,o){return r=Yo(4,s.children!==null?s.children:[],s.key,r),r.lanes=o,r.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},r}function The(s,r,o,l,u){this.tag=r,this.containerInfo=s,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=YN(0),this.expirationTimes=YN(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=YN(0),this.identifierPrefix=l,this.onRecoverableError=u,this.mutableSourceEagerHydrationData=null}function QP(s,r,o,l,u,f,E,T,w){return s=new The(s,r,o,T,w),r===1?(r=1,f===!0&&(r|=8)):r=0,f=Yo(3,null,null,r),s.current=f,f.stateNode=s,f.memoizedState={element:l,isDehydrated:o,cache:null,transitions:null,pendingSuspenseBoundaries:null},kP(f),s}function bhe(s,r,o){var l=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Pm,key:l==null?null:""+l,children:s,containerInfo:r,implementation:o}}function v9(s){if(!s)return Xd;s=s._reactInternals;e:{if(Gh(s)!==s||s.tag!==1)throw Error(ze(170));var r=s;do{switch(r.tag){case 3:r=r.stateNode.context;break e;case 1:if(Js(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break e}}r=r.return}while(r!==null);throw Error(ze(171))}if(s.tag===1){var o=s.type;if(Js(o))return vH(s,o,r)}return r}function y9(s,r,o,l,u,f,E,T,w){return s=QP(o,l,!0,s,u,f,E,T,w),s.context=v9(null),o=s.current,l=Cs(),u=Fd(o),f=pl(l,u),f.callback=r??null,jd(o,f,u),s.current.lanes=u,FE(s,u,l),Qs(s,l),s}function Gb(s,r,o,l){var u=r.current,f=Cs(),E=Fd(u);return o=v9(o),r.context===null?r.context=o:r.pendingContext=o,r=pl(f,E),r.payload={element:s},l=l===void 0?null:l,l!==null&&(r.callback=l),s=jd(u,r,E),s!==null&&(Ma(s,u,E,f),f0(s,u,E)),E}function nb(s){if(s=s.current,!s.child)return null;switch(s.child.tag){case 5:return s.child.stateNode;default:return s.child.stateNode}}function fW(s,r){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var o=s.retryLane;s.retryLane=o!==0&&o<r?o:r}}function $P(s,r){fW(s,r),(s=s.alternate)&&fW(s,r)}function Rhe(){return null}var S9=typeof reportError=="function"?reportError:function(s){console.error(s)};function ZP(s){this._internalRoot=s}Wb.prototype.render=ZP.prototype.render=function(s){var r=this._internalRoot;if(r===null)throw Error(ze(409));Gb(s,r,null,null)};Wb.prototype.unmount=ZP.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var r=s.containerInfo;Dh(function(){Gb(null,s,null,null)}),r[vl]=null}};function Wb(s){this._internalRoot=s}Wb.prototype.unstable_scheduleHydration=function(s){if(s){var r=$8();s={blockedOn:null,target:s,priority:r};for(var o=0;o<wd.length&&r!==0&&r<wd[o].priority;o++);wd.splice(o,0,s),o===0&&eH(s)}};function eD(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function zb(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11&&(s.nodeType!==8||s.nodeValue!==" react-mount-point-unstable "))}function gW(){}function whe(s,r,o,l,u){if(u){if(typeof l=="function"){var f=l;l=function(){var A=nb(E);f.call(A)}}var E=y9(r,l,s,0,null,!1,!1,"",gW);return s._reactRootContainer=E,s[vl]=E.current,fE(s.nodeType===8?s.parentNode:s),Dh(),E}for(;u=s.lastChild;)s.removeChild(u);if(typeof l=="function"){var T=l;l=function(){var A=nb(w);T.call(A)}}var w=QP(s,0,!1,null,null,!1,!1,"",gW);return s._reactRootContainer=w,s[vl]=w.current,fE(s.nodeType===8?s.parentNode:s),Dh(function(){Gb(r,w,o,l)}),w}function Hb(s,r,o,l,u){var f=o._reactRootContainer;if(f){var E=f;if(typeof u=="function"){var T=u;u=function(){var w=nb(E);T.call(w)}}Gb(r,E,s,u)}else E=whe(o,r,s,u,l);return nb(E)}J8=function(s){switch(s.tag){case 3:var r=s.stateNode;if(r.current.memoizedState.isDehydrated){var o=L_(r.pendingLanes);o!==0&&(vP(r,o|1),Qs(r,$r()),!(On&6)&&(cf=$r()+500,su()))}break;case 13:Dh(function(){var l=yl(s,1);if(l!==null){var u=Cs();Ma(l,s,1,u)}}),$P(s,1)}};yP=function(s){if(s.tag===13){var r=yl(s,134217728);if(r!==null){var o=Cs();Ma(r,s,134217728,o)}$P(s,134217728)}};Q8=function(s){if(s.tag===13){var r=Fd(s),o=yl(s,r);if(o!==null){var l=Cs();Ma(o,s,r,l)}$P(s,r)}};$8=function(){return Xn};Z8=function(s,r){var o=Xn;try{return Xn=s,r()}finally{Xn=o}};Xx=function(s,r,o){switch(r){case"input":if(Gx(s,o),r=o.name,o.type==="radio"&&r!=null){for(o=s;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),r=0;r<o.length;r++){var l=o[r];if(l!==s&&l.form===s.form){var u=Lb(l);if(!u)throw Error(ze(90));x8(l),Gx(l,u)}}}break;case"textarea":P8(s,o);break;case"select":r=o.value,r!=null&&zm(s,!!o.multiple,r,!1)}};V8=qP;F8=Dh;var Che={usingClientEntryPoint:!1,Events:[GE,Um,Lb,U8,j8,qP]},O_={findFiberByHostInstance:_h,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Ihe={bundleType:O_.bundleType,version:O_.version,rendererPackageName:O_.rendererPackageName,rendererConfig:O_.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Il.ReactCurrentDispatcher,findHostInstanceByFiber:function(s){return s=W8(s),s===null?null:s.stateNode},findFiberByHostInstance:O_.findFiberByHostInstance||Rhe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var n0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!n0.isDisabled&&n0.supportsFiber)try{Ob=n0.inject(Ihe),bc=n0}catch{}}So.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Che;So.createPortal=function(s,r){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!eD(r))throw Error(ze(200));return bhe(s,r,null,o)};So.createRoot=function(s,r){if(!eD(s))throw Error(ze(299));var o=!1,l="",u=S9;return r!=null&&(r.unstable_strictMode===!0&&(o=!0),r.identifierPrefix!==void 0&&(l=r.identifierPrefix),r.onRecoverableError!==void 0&&(u=r.onRecoverableError)),r=QP(s,1,!1,null,null,o,!1,l,u),s[vl]=r.current,fE(s.nodeType===8?s.parentNode:s),new ZP(r)};So.findDOMNode=function(s){if(s==null)return null;if(s.nodeType===1)return s;var r=s._reactInternals;if(r===void 0)throw typeof s.render=="function"?Error(ze(188)):(s=Object.keys(s).join(","),Error(ze(268,s)));return s=W8(r),s=s===null?null:s.stateNode,s};So.flushSync=function(s){return Dh(s)};So.hydrate=function(s,r,o){if(!zb(r))throw Error(ze(200));return Hb(null,s,r,!0,o)};So.hydrateRoot=function(s,r,o){if(!eD(s))throw Error(ze(405));var l=o!=null&&o.hydratedSources||null,u=!1,f="",E=S9;if(o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(f=o.identifierPrefix),o.onRecoverableError!==void 0&&(E=o.onRecoverableError)),r=y9(r,null,s,1,o??null,u,!1,f,E),s[vl]=r.current,fE(s),l)for(s=0;s<l.length;s++)o=l[s],u=o._getVersion,u=u(o._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[o,u]:r.mutableSourceEagerHydrationData.push(o,u);return new Wb(r)};So.render=function(s,r,o){if(!zb(r))throw Error(ze(200));return Hb(null,s,r,!1,o)};So.unmountComponentAtNode=function(s){if(!zb(s))throw Error(ze(40));return s._reactRootContainer?(Dh(function(){Hb(null,null,s,!1,function(){s._reactRootContainer=null,s[vl]=null})}),!0):!1};So.unstable_batchedUpdates=qP;So.unstable_renderSubtreeIntoContainer=function(s,r,o,l){if(!zb(o))throw Error(ze(200));if(s==null||s._reactInternals===void 0)throw Error(ze(38));return Hb(s,r,o,!1,l)};So.version="18.3.1-next-f1338f8080-20240426";function T9(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(T9)}catch(s){console.error(s)}}T9(),T8.exports=So;var Ahe=T8.exports,_W=Ahe;Lx.createRoot=_W.createRoot,Lx.hydrateRoot=_W.hydrateRoot;/**
 * @remix-run/router v1.23.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function RE(){return RE=Object.assign?Object.assign.bind():function(s){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(s[l]=o[l])}return s},RE.apply(this,arguments)}var Pd;(function(s){s.Pop="POP",s.Push="PUSH",s.Replace="REPLACE"})(Pd||(Pd={}));const EW="popstate";function Nhe(s){s===void 0&&(s={});function r(l,u){let{pathname:f,search:E,hash:T}=l.location;return AO("",{pathname:f,search:E,hash:T},u.state&&u.state.usr||null,u.state&&u.state.key||"default")}function o(l,u){return typeof u=="string"?u:rb(u)}return Ohe(r,o,null,s)}function Fr(s,r){if(s===!1||s===null||typeof s>"u")throw new Error(r)}function tD(s,r){if(!s){typeof console<"u"&&console.warn(r);try{throw new Error(r)}catch{}}}function xhe(){return Math.random().toString(36).substr(2,8)}function vW(s,r){return{usr:s.state,key:s.key,idx:r}}function AO(s,r,o,l){return o===void 0&&(o=null),RE({pathname:typeof s=="string"?s:s.pathname,search:"",hash:""},typeof r=="string"?bf(r):r,{state:o,key:r&&r.key||l||xhe()})}function rb(s){let{pathname:r="/",search:o="",hash:l=""}=s;return o&&o!=="?"&&(r+=o.charAt(0)==="?"?o:"?"+o),l&&l!=="#"&&(r+=l.charAt(0)==="#"?l:"#"+l),r}function bf(s){let r={};if(s){let o=s.indexOf("#");o>=0&&(r.hash=s.substr(o),s=s.substr(0,o));let l=s.indexOf("?");l>=0&&(r.search=s.substr(l),s=s.substr(0,l)),s&&(r.pathname=s)}return r}function Ohe(s,r,o,l){l===void 0&&(l={});let{window:u=document.defaultView,v5Compat:f=!1}=l,E=u.history,T=Pd.Pop,w=null,A=U();A==null&&(A=0,E.replaceState(RE({},E.state,{idx:A}),""));function U(){return(E.state||{idx:null}).idx}function M(){T=Pd.Pop;let he=U(),ee=he==null?null:he-A;A=he,w&&w({action:T,location:ae.location,delta:ee})}function F(he,ee){T=Pd.Push;let W=AO(ae.location,he,ee);A=U()+1;let Z=vW(W,A),fe=ae.createHref(W);try{E.pushState(Z,"",fe)}catch(pe){if(pe instanceof DOMException&&pe.name==="DataCloneError")throw pe;u.location.assign(fe)}f&&w&&w({action:T,location:ae.location,delta:1})}function Y(he,ee){T=Pd.Replace;let W=AO(ae.location,he,ee);A=U();let Z=vW(W,A),fe=ae.createHref(W);E.replaceState(Z,"",fe),f&&w&&w({action:T,location:ae.location,delta:0})}function J(he){let ee=u.location.origin!=="null"?u.location.origin:u.location.href,W=typeof he=="string"?he:rb(he);return W=W.replace(/ $/,"%20"),Fr(ee,"No window.location.(origin|href) available to create URL for href: "+W),new URL(W,ee)}let ae={get action(){return T},get location(){return s(u,E)},listen(he){if(w)throw new Error("A history only accepts one active listener");return u.addEventListener(EW,M),w=he,()=>{u.removeEventListener(EW,M),w=null}},createHref(he){return r(u,he)},createURL:J,encodeLocation(he){let ee=J(he);return{pathname:ee.pathname,search:ee.search,hash:ee.hash}},push:F,replace:Y,go(he){return E.go(he)}};return ae}var yW;(function(s){s.data="data",s.deferred="deferred",s.redirect="redirect",s.error="error"})(yW||(yW={}));function Phe(s,r,o){return o===void 0&&(o="/"),Dhe(s,r,o)}function Dhe(s,r,o,l){let u=typeof r=="string"?bf(r):r,f=lf(u.pathname||"/",o);if(f==null)return null;let E=b9(s);khe(E);let T=null;for(let w=0;T==null&&w<E.length;++w){let A=Hhe(f);T=Whe(E[w],A)}return T}function b9(s,r,o,l){r===void 0&&(r=[]),o===void 0&&(o=[]),l===void 0&&(l="");let u=(f,E,T)=>{let w={relativePath:T===void 0?f.path||"":T,caseSensitive:f.caseSensitive===!0,childrenIndex:E,route:f};w.relativePath.startsWith("/")&&(Fr(w.relativePath.startsWith(l),'Absolute route path "'+w.relativePath+'" nested under path '+('"'+l+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),w.relativePath=w.relativePath.slice(l.length));let A=Gd([l,w.relativePath]),U=o.concat(w);f.children&&f.children.length>0&&(Fr(f.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+A+'".')),b9(f.children,r,U,A)),!(f.path==null&&!f.index)&&r.push({path:A,score:Bhe(A,f.index),routesMeta:U})};return s.forEach((f,E)=>{var T;if(f.path===""||!((T=f.path)!=null&&T.includes("?")))u(f,E);else for(let w of R9(f.path))u(f,E,w)}),r}function R9(s){let r=s.split("/");if(r.length===0)return[];let[o,...l]=r,u=o.endsWith("?"),f=o.replace(/\?$/,"");if(l.length===0)return u?[f,""]:[f];let E=R9(l.join("/")),T=[];return T.push(...E.map(w=>w===""?f:[f,w].join("/"))),u&&T.push(...E),T.map(w=>s.startsWith("/")&&w===""?"/":w)}function khe(s){s.sort((r,o)=>r.score!==o.score?o.score-r.score:Ghe(r.routesMeta.map(l=>l.childrenIndex),o.routesMeta.map(l=>l.childrenIndex)))}const Lhe=/^:[\w-]+$/,Mhe=3,Uhe=2,jhe=1,Vhe=10,Fhe=-2,SW=s=>s==="*";function Bhe(s,r){let o=s.split("/"),l=o.length;return o.some(SW)&&(l+=Fhe),r&&(l+=Uhe),o.filter(u=>!SW(u)).reduce((u,f)=>u+(Lhe.test(f)?Mhe:f===""?jhe:Vhe),l)}function Ghe(s,r){return s.length===r.length&&s.slice(0,-1).every((l,u)=>l===r[u])?s[s.length-1]-r[r.length-1]:0}function Whe(s,r,o){let{routesMeta:l}=s,u={},f="/",E=[];for(let T=0;T<l.length;++T){let w=l[T],A=T===l.length-1,U=f==="/"?r:r.slice(f.length)||"/",M=NO({path:w.relativePath,caseSensitive:w.caseSensitive,end:A},U),F=w.route;if(!M)return null;Object.assign(u,M.params),E.push({params:u,pathname:Gd([f,M.pathname]),pathnameBase:Jhe(Gd([f,M.pathnameBase])),route:F}),M.pathnameBase!=="/"&&(f=Gd([f,M.pathnameBase]))}return E}function NO(s,r){typeof s=="string"&&(s={path:s,caseSensitive:!1,end:!0});let[o,l]=zhe(s.path,s.caseSensitive,s.end),u=r.match(o);if(!u)return null;let f=u[0],E=f.replace(/(.)\/+$/,"$1"),T=u.slice(1);return{params:l.reduce((A,U,M)=>{let{paramName:F,isOptional:Y}=U;if(F==="*"){let ae=T[M]||"";E=f.slice(0,f.length-ae.length).replace(/(.)\/+$/,"$1")}const J=T[M];return Y&&!J?A[F]=void 0:A[F]=(J||"").replace(/%2F/g,"/"),A},{}),pathname:f,pathnameBase:E,pattern:s}}function zhe(s,r,o){r===void 0&&(r=!1),o===void 0&&(o=!0),tD(s==="*"||!s.endsWith("*")||s.endsWith("/*"),'Route path "'+s+'" will be treated as if it were '+('"'+s.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+s.replace(/\*$/,"/*")+'".'));let l=[],u="^"+s.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(E,T,w)=>(l.push({paramName:T,isOptional:w!=null}),w?"/?([^\\/]+)?":"/([^\\/]+)"));return s.endsWith("*")?(l.push({paramName:"*"}),u+=s==="*"||s==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):o?u+="\\/*$":s!==""&&s!=="/"&&(u+="(?:(?=\\/|$))"),[new RegExp(u,r?void 0:"i"),l]}function Hhe(s){try{return s.split("/").map(r=>decodeURIComponent(r).replace(/\//g,"%2F")).join("/")}catch(r){return tD(!1,'The URL path "'+s+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+r+").")),s}}function lf(s,r){if(r==="/")return s;if(!s.toLowerCase().startsWith(r.toLowerCase()))return null;let o=r.endsWith("/")?r.length-1:r.length,l=s.charAt(o);return l&&l!=="/"?null:s.slice(o)||"/"}const Khe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,qhe=s=>Khe.test(s);function Yhe(s,r){r===void 0&&(r="/");let{pathname:o,search:l="",hash:u=""}=typeof s=="string"?bf(s):s,f;if(o)if(qhe(o))f=o;else{if(o.includes("//")){let E=o;o=o.replace(/\/\/+/g,"/"),tD(!1,"Pathnames cannot have embedded double slashes - normalizing "+(E+" -> "+o))}o.startsWith("/")?f=TW(o.substring(1),"/"):f=TW(o,r)}else f=r;return{pathname:f,search:Qhe(l),hash:$he(u)}}function TW(s,r){let o=r.replace(/\/+$/,"").split("/");return s.split("/").forEach(u=>{u===".."?o.length>1&&o.pop():u!=="."&&o.push(u)}),o.length>1?o.join("/"):"/"}function fx(s,r,o,l){return"Cannot include a '"+s+"' character in a manually specified "+("`to."+r+"` field ["+JSON.stringify(l)+"].  Please separate it out to the ")+("`to."+o+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Xhe(s){return s.filter((r,o)=>o===0||r.route.path&&r.route.path.length>0)}function nD(s,r){let o=Xhe(s);return r?o.map((l,u)=>u===o.length-1?l.pathname:l.pathnameBase):o.map(l=>l.pathnameBase)}function rD(s,r,o,l){l===void 0&&(l=!1);let u;typeof s=="string"?u=bf(s):(u=RE({},s),Fr(!u.pathname||!u.pathname.includes("?"),fx("?","pathname","search",u)),Fr(!u.pathname||!u.pathname.includes("#"),fx("#","pathname","hash",u)),Fr(!u.search||!u.search.includes("#"),fx("#","search","hash",u)));let f=s===""||u.pathname==="",E=f?"/":u.pathname,T;if(E==null)T=o;else{let M=r.length-1;if(!l&&E.startsWith("..")){let F=E.split("/");for(;F[0]==="..";)F.shift(),M-=1;u.pathname=F.join("/")}T=M>=0?r[M]:"/"}let w=Yhe(u,T),A=E&&E!=="/"&&E.endsWith("/"),U=(f||E===".")&&o.endsWith("/");return!w.pathname.endsWith("/")&&(A||U)&&(w.pathname+="/"),w}const Gd=s=>s.join("/").replace(/\/\/+/g,"/"),Jhe=s=>s.replace(/\/+$/,"").replace(/^\/*/,"/"),Qhe=s=>!s||s==="?"?"":s.startsWith("?")?s:"?"+s,$he=s=>!s||s==="#"?"":s.startsWith("#")?s:"#"+s;function Zhe(s){return s!=null&&typeof s.status=="number"&&typeof s.statusText=="string"&&typeof s.internal=="boolean"&&"data"in s}const w9=["post","put","patch","delete"];new Set(w9);const epe=["get",...w9];new Set(epe);/**
 * React Router v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function wE(){return wE=Object.assign?Object.assign.bind():function(s){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(s[l]=o[l])}return s},wE.apply(this,arguments)}const Kb=ce.createContext(null),C9=ce.createContext(null),Al=ce.createContext(null),qb=ce.createContext(null),Nl=ce.createContext({outlet:null,matches:[],isDataRoute:!1}),I9=ce.createContext(null);function tpe(s,r){let{relative:o}=r===void 0?{}:r;Rf()||Fr(!1);let{basename:l,navigator:u}=ce.useContext(Al),{hash:f,pathname:E,search:T}=Yb(s,{relative:o}),w=E;return l!=="/"&&(w=E==="/"?l:Gd([l,E])),u.createHref({pathname:w,search:T,hash:f})}function Rf(){return ce.useContext(qb)!=null}function ou(){return Rf()||Fr(!1),ce.useContext(qb).location}function A9(s){ce.useContext(Al).static||ce.useLayoutEffect(s)}function ei(){let{isDataRoute:s}=ce.useContext(Nl);return s?fpe():npe()}function npe(){Rf()||Fr(!1);let s=ce.useContext(Kb),{basename:r,future:o,navigator:l}=ce.useContext(Al),{matches:u}=ce.useContext(Nl),{pathname:f}=ou(),E=JSON.stringify(nD(u,o.v7_relativeSplatPath)),T=ce.useRef(!1);return A9(()=>{T.current=!0}),ce.useCallback(function(A,U){if(U===void 0&&(U={}),!T.current)return;if(typeof A=="number"){l.go(A);return}let M=rD(A,JSON.parse(E),f,U.relative==="path");s==null&&r!=="/"&&(M.pathname=M.pathname==="/"?r:Gd([r,M.pathname])),(U.replace?l.replace:l.push)(M,U.state,U)},[r,l,E,f,s])}function rpe(){let{matches:s}=ce.useContext(Nl),r=s[s.length-1];return r?r.params:{}}function Yb(s,r){let{relative:o}=r===void 0?{}:r,{future:l}=ce.useContext(Al),{matches:u}=ce.useContext(Nl),{pathname:f}=ou(),E=JSON.stringify(nD(u,l.v7_relativeSplatPath));return ce.useMemo(()=>rD(s,JSON.parse(E),f,o==="path"),[s,E,f,o])}function ipe(s,r){return spe(s,r)}function spe(s,r,o,l){Rf()||Fr(!1);let{navigator:u}=ce.useContext(Al),{matches:f}=ce.useContext(Nl),E=f[f.length-1],T=E?E.params:{};E&&E.pathname;let w=E?E.pathnameBase:"/";E&&E.route;let A=ou(),U;if(r){var M;let he=typeof r=="string"?bf(r):r;w==="/"||(M=he.pathname)!=null&&M.startsWith(w)||Fr(!1),U=he}else U=A;let F=U.pathname||"/",Y=F;if(w!=="/"){let he=w.replace(/^\//,"").split("/");Y="/"+F.replace(/^\//,"").split("/").slice(he.length).join("/")}let J=Phe(s,{pathname:Y}),ae=dpe(J&&J.map(he=>Object.assign({},he,{params:Object.assign({},T,he.params),pathname:Gd([w,u.encodeLocation?u.encodeLocation(he.pathname).pathname:he.pathname]),pathnameBase:he.pathnameBase==="/"?w:Gd([w,u.encodeLocation?u.encodeLocation(he.pathnameBase).pathname:he.pathnameBase])})),f,o,l);return r&&ae?ce.createElement(qb.Provider,{value:{location:wE({pathname:"/",search:"",hash:"",state:null,key:"default"},U),navigationType:Pd.Pop}},ae):ae}function ope(){let s=mpe(),r=Zhe(s)?s.status+" "+s.statusText:s instanceof Error?s.message:JSON.stringify(s),o=s instanceof Error?s.stack:null,u={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return ce.createElement(ce.Fragment,null,ce.createElement("h2",null,"Unexpected Application Error!"),ce.createElement("h3",{style:{fontStyle:"italic"}},r),o?ce.createElement("pre",{style:u},o):null,null)}const ape=ce.createElement(ope,null);class cpe extends ce.Component{constructor(r){super(r),this.state={location:r.location,revalidation:r.revalidation,error:r.error}}static getDerivedStateFromError(r){return{error:r}}static getDerivedStateFromProps(r,o){return o.location!==r.location||o.revalidation!=="idle"&&r.revalidation==="idle"?{error:r.error,location:r.location,revalidation:r.revalidation}:{error:r.error!==void 0?r.error:o.error,location:o.location,revalidation:r.revalidation||o.revalidation}}componentDidCatch(r,o){console.error("React Router caught the following error during render",r,o)}render(){return this.state.error!==void 0?ce.createElement(Nl.Provider,{value:this.props.routeContext},ce.createElement(I9.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function lpe(s){let{routeContext:r,match:o,children:l}=s,u=ce.useContext(Kb);return u&&u.static&&u.staticContext&&(o.route.errorElement||o.route.ErrorBoundary)&&(u.staticContext._deepestRenderedBoundaryId=o.route.id),ce.createElement(Nl.Provider,{value:r},l)}function dpe(s,r,o,l){var u;if(r===void 0&&(r=[]),o===void 0&&(o=null),l===void 0&&(l=null),s==null){var f;if(!o)return null;if(o.errors)s=o.matches;else if((f=l)!=null&&f.v7_partialHydration&&r.length===0&&!o.initialized&&o.matches.length>0)s=o.matches;else return null}let E=s,T=(u=o)==null?void 0:u.errors;if(T!=null){let U=E.findIndex(M=>M.route.id&&(T==null?void 0:T[M.route.id])!==void 0);U>=0||Fr(!1),E=E.slice(0,Math.min(E.length,U+1))}let w=!1,A=-1;if(o&&l&&l.v7_partialHydration)for(let U=0;U<E.length;U++){let M=E[U];if((M.route.HydrateFallback||M.route.hydrateFallbackElement)&&(A=U),M.route.id){let{loaderData:F,errors:Y}=o,J=M.route.loader&&F[M.route.id]===void 0&&(!Y||Y[M.route.id]===void 0);if(M.route.lazy||J){w=!0,A>=0?E=E.slice(0,A+1):E=[E[0]];break}}}return E.reduceRight((U,M,F)=>{let Y,J=!1,ae=null,he=null;o&&(Y=T&&M.route.id?T[M.route.id]:void 0,ae=M.route.errorElement||ape,w&&(A<0&&F===0?(gpe("route-fallback"),J=!0,he=null):A===F&&(J=!0,he=M.route.hydrateFallbackElement||null)));let ee=r.concat(E.slice(0,F+1)),W=()=>{let Z;return Y?Z=ae:J?Z=he:M.route.Component?Z=ce.createElement(M.route.Component,null):M.route.element?Z=M.route.element:Z=U,ce.createElement(lpe,{match:M,routeContext:{outlet:U,matches:ee,isDataRoute:o!=null},children:Z})};return o&&(M.route.ErrorBoundary||M.route.errorElement||F===0)?ce.createElement(cpe,{location:o.location,revalidation:o.revalidation,component:ae,error:Y,children:W(),routeContext:{outlet:null,matches:ee,isDataRoute:!0}}):W()},null)}var N9=function(s){return s.UseBlocker="useBlocker",s.UseRevalidator="useRevalidator",s.UseNavigateStable="useNavigate",s}(N9||{}),x9=function(s){return s.UseBlocker="useBlocker",s.UseLoaderData="useLoaderData",s.UseActionData="useActionData",s.UseRouteError="useRouteError",s.UseNavigation="useNavigation",s.UseRouteLoaderData="useRouteLoaderData",s.UseMatches="useMatches",s.UseRevalidator="useRevalidator",s.UseNavigateStable="useNavigate",s.UseRouteId="useRouteId",s}(x9||{});function upe(s){let r=ce.useContext(Kb);return r||Fr(!1),r}function hpe(s){let r=ce.useContext(C9);return r||Fr(!1),r}function ppe(s){let r=ce.useContext(Nl);return r||Fr(!1),r}function O9(s){let r=ppe(),o=r.matches[r.matches.length-1];return o.route.id||Fr(!1),o.route.id}function mpe(){var s;let r=ce.useContext(I9),o=hpe(),l=O9();return r!==void 0?r:(s=o.errors)==null?void 0:s[l]}function fpe(){let{router:s}=upe(N9.UseNavigateStable),r=O9(x9.UseNavigateStable),o=ce.useRef(!1);return A9(()=>{o.current=!0}),ce.useCallback(function(u,f){f===void 0&&(f={}),o.current&&(typeof u=="number"?s.navigate(u):s.navigate(u,wE({fromRouteId:r},f)))},[s,r])}const bW={};function gpe(s,r,o){bW[s]||(bW[s]=!0)}function _pe(s,r){s==null||s.v7_startTransition,s==null||s.v7_relativeSplatPath}function r0(s){let{to:r,replace:o,state:l,relative:u}=s;Rf()||Fr(!1);let{future:f,static:E}=ce.useContext(Al),{matches:T}=ce.useContext(Nl),{pathname:w}=ou(),A=ei(),U=rD(r,nD(T,f.v7_relativeSplatPath),w,u==="path"),M=JSON.stringify(U);return ce.useEffect(()=>A(JSON.parse(M),{replace:o,state:l,relative:u}),[A,M,u,o,l]),null}function nr(s){Fr(!1)}function Epe(s){let{basename:r="/",children:o=null,location:l,navigationType:u=Pd.Pop,navigator:f,static:E=!1,future:T}=s;Rf()&&Fr(!1);let w=r.replace(/^\/*/,"/"),A=ce.useMemo(()=>({basename:w,navigator:f,static:E,future:wE({v7_relativeSplatPath:!1},T)}),[w,T,f,E]);typeof l=="string"&&(l=bf(l));let{pathname:U="/",search:M="",hash:F="",state:Y=null,key:J="default"}=l,ae=ce.useMemo(()=>{let he=lf(U,w);return he==null?null:{location:{pathname:he,search:M,hash:F,state:Y,key:J},navigationType:u}},[w,U,M,F,Y,J,u]);return ae==null?null:ce.createElement(Al.Provider,{value:A},ce.createElement(qb.Provider,{children:o,value:ae}))}function gx(s){let{children:r,location:o}=s;return ipe(xO(r),o)}new Promise(()=>{});function xO(s,r){r===void 0&&(r=[]);let o=[];return ce.Children.forEach(s,(l,u)=>{if(!ce.isValidElement(l))return;let f=[...r,u];if(l.type===ce.Fragment){o.push.apply(o,xO(l.props.children,f));return}l.type!==nr&&Fr(!1),!l.props.index||!l.props.children||Fr(!1);let E={id:l.props.id||f.join("-"),caseSensitive:l.props.caseSensitive,element:l.props.element,Component:l.props.Component,index:l.props.index,path:l.props.path,loader:l.props.loader,action:l.props.action,errorElement:l.props.errorElement,ErrorBoundary:l.props.ErrorBoundary,hasErrorBoundary:l.props.ErrorBoundary!=null||l.props.errorElement!=null,shouldRevalidate:l.props.shouldRevalidate,handle:l.props.handle,lazy:l.props.lazy};l.props.children&&(E.children=xO(l.props.children,f)),o.push(E)}),o}/**
 * React Router DOM v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ib(){return ib=Object.assign?Object.assign.bind():function(s){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(s[l]=o[l])}return s},ib.apply(this,arguments)}function P9(s,r){if(s==null)return{};var o={},l=Object.keys(s),u,f;for(f=0;f<l.length;f++)u=l[f],!(r.indexOf(u)>=0)&&(o[u]=s[u]);return o}function vpe(s){return!!(s.metaKey||s.altKey||s.ctrlKey||s.shiftKey)}function ype(s,r){return s.button===0&&(!r||r==="_self")&&!vpe(s)}function OO(s){return s===void 0&&(s=""),new URLSearchParams(typeof s=="string"||Array.isArray(s)||s instanceof URLSearchParams?s:Object.keys(s).reduce((r,o)=>{let l=s[o];return r.concat(Array.isArray(l)?l.map(u=>[o,u]):[[o,l]])},[]))}function Spe(s,r){let o=OO(s);return r&&r.forEach((l,u)=>{o.has(u)||r.getAll(u).forEach(f=>{o.append(u,f)})}),o}const Tpe=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],bpe=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],Rpe="6";try{window.__reactRouterVersion=Rpe}catch{}const wpe=ce.createContext({isTransitioning:!1}),Cpe="startTransition",RW=_de[Cpe];function Ipe(s){let{basename:r,children:o,future:l,window:u}=s,f=ce.useRef();f.current==null&&(f.current=Nhe({window:u,v5Compat:!0}));let E=f.current,[T,w]=ce.useState({action:E.action,location:E.location}),{v7_startTransition:A}=l||{},U=ce.useCallback(M=>{A&&RW?RW(()=>w(M)):w(M)},[w,A]);return ce.useLayoutEffect(()=>E.listen(U),[E,U]),ce.useEffect(()=>_pe(l),[l]),ce.createElement(Epe,{basename:r,children:o,location:T.location,navigationType:T.action,navigator:E,future:l})}const Ape=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Npe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,kh=ce.forwardRef(function(r,o){let{onClick:l,relative:u,reloadDocument:f,replace:E,state:T,target:w,to:A,preventScrollReset:U,viewTransition:M}=r,F=P9(r,Tpe),{basename:Y}=ce.useContext(Al),J,ae=!1;if(typeof A=="string"&&Npe.test(A)&&(J=A,Ape))try{let Z=new URL(window.location.href),fe=A.startsWith("//")?new URL(Z.protocol+A):new URL(A),pe=lf(fe.pathname,Y);fe.origin===Z.origin&&pe!=null?A=pe+fe.search+fe.hash:ae=!0}catch{}let he=tpe(A,{relative:u}),ee=Ppe(A,{replace:E,state:T,target:w,preventScrollReset:U,relative:u,viewTransition:M});function W(Z){l&&l(Z),Z.defaultPrevented||ee(Z)}return ce.createElement("a",ib({},F,{href:J||he,onClick:ae||f?l:W,ref:o,target:w}))}),xpe=ce.forwardRef(function(r,o){let{"aria-current":l="page",caseSensitive:u=!1,className:f="",end:E=!1,style:T,to:w,viewTransition:A,children:U}=r,M=P9(r,bpe),F=Yb(w,{relative:M.relative}),Y=ou(),J=ce.useContext(C9),{navigator:ae,basename:he}=ce.useContext(Al),ee=J!=null&&kpe(F)&&A===!0,W=ae.encodeLocation?ae.encodeLocation(F).pathname:F.pathname,Z=Y.pathname,fe=J&&J.navigation&&J.navigation.location?J.navigation.location.pathname:null;u||(Z=Z.toLowerCase(),fe=fe?fe.toLowerCase():null,W=W.toLowerCase()),fe&&he&&(fe=lf(fe,he)||fe);const pe=W!=="/"&&W.endsWith("/")?W.length-1:W.length;let Ce=Z===W||!E&&Z.startsWith(W)&&Z.charAt(pe)==="/",te=fe!=null&&(fe===W||!E&&fe.startsWith(W)&&fe.charAt(W.length)==="/"),q={isActive:Ce,isPending:te,isTransitioning:ee},re=Ce?l:void 0,$;typeof f=="function"?$=f(q):$=[f,Ce?"active":null,te?"pending":null,ee?"transitioning":null].filter(Boolean).join(" ");let le=typeof T=="function"?T(q):T;return ce.createElement(kh,ib({},M,{"aria-current":re,className:$,ref:o,style:le,to:w,viewTransition:A}),typeof U=="function"?U(q):U)});var PO;(function(s){s.UseScrollRestoration="useScrollRestoration",s.UseSubmit="useSubmit",s.UseSubmitFetcher="useSubmitFetcher",s.UseFetcher="useFetcher",s.useViewTransitionState="useViewTransitionState"})(PO||(PO={}));var wW;(function(s){s.UseFetcher="useFetcher",s.UseFetchers="useFetchers",s.UseScrollRestoration="useScrollRestoration"})(wW||(wW={}));function Ope(s){let r=ce.useContext(Kb);return r||Fr(!1),r}function Ppe(s,r){let{target:o,replace:l,state:u,preventScrollReset:f,relative:E,viewTransition:T}=r===void 0?{}:r,w=ei(),A=ou(),U=Yb(s,{relative:E});return ce.useCallback(M=>{if(ype(M,o)){M.preventDefault();let F=l!==void 0?l:rb(A)===rb(U);w(s,{replace:F,state:u,preventScrollReset:f,relative:E,viewTransition:T})}},[A,w,U,l,u,o,s,f,E,T])}function Dpe(s){let r=ce.useRef(OO(s)),o=ce.useRef(!1),l=ou(),u=ce.useMemo(()=>Spe(l.search,o.current?null:r.current),[l.search]),f=ei(),E=ce.useCallback((T,w)=>{const A=OO(typeof T=="function"?T(u):T);o.current=!0,f("?"+A,w)},[f,u]);return[u,E]}function kpe(s,r){r===void 0&&(r={});let o=ce.useContext(wpe);o==null&&Fr(!1);let{basename:l}=Ope(PO.useViewTransitionState),u=Yb(s,{relative:r.relative});if(!o.isTransitioning)return!1;let f=lf(o.currentLocation.pathname,l)||o.currentLocation.pathname,E=lf(o.nextLocation.pathname,l)||o.nextLocation.pathname;return NO(u.pathname,E)!=null||NO(u.pathname,f)!=null}var CW={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D9=function(s){const r=[];let o=0;for(let l=0;l<s.length;l++){let u=s.charCodeAt(l);u<128?r[o++]=u:u<2048?(r[o++]=u>>6|192,r[o++]=u&63|128):(u&64512)===55296&&l+1<s.length&&(s.charCodeAt(l+1)&64512)===56320?(u=65536+((u&1023)<<10)+(s.charCodeAt(++l)&1023),r[o++]=u>>18|240,r[o++]=u>>12&63|128,r[o++]=u>>6&63|128,r[o++]=u&63|128):(r[o++]=u>>12|224,r[o++]=u>>6&63|128,r[o++]=u&63|128)}return r},Lpe=function(s){const r=[];let o=0,l=0;for(;o<s.length;){const u=s[o++];if(u<128)r[l++]=String.fromCharCode(u);else if(u>191&&u<224){const f=s[o++];r[l++]=String.fromCharCode((u&31)<<6|f&63)}else if(u>239&&u<365){const f=s[o++],E=s[o++],T=s[o++],w=((u&7)<<18|(f&63)<<12|(E&63)<<6|T&63)-65536;r[l++]=String.fromCharCode(55296+(w>>10)),r[l++]=String.fromCharCode(56320+(w&1023))}else{const f=s[o++],E=s[o++];r[l++]=String.fromCharCode((u&15)<<12|(f&63)<<6|E&63)}}return r.join("")},k9={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(s,r){if(!Array.isArray(s))throw Error("encodeByteArray takes an array as a parameter");this.init_();const o=r?this.byteToCharMapWebSafe_:this.byteToCharMap_,l=[];for(let u=0;u<s.length;u+=3){const f=s[u],E=u+1<s.length,T=E?s[u+1]:0,w=u+2<s.length,A=w?s[u+2]:0,U=f>>2,M=(f&3)<<4|T>>4;let F=(T&15)<<2|A>>6,Y=A&63;w||(Y=64,E||(F=64)),l.push(o[U],o[M],o[F],o[Y])}return l.join("")},encodeString(s,r){return this.HAS_NATIVE_SUPPORT&&!r?btoa(s):this.encodeByteArray(D9(s),r)},decodeString(s,r){return this.HAS_NATIVE_SUPPORT&&!r?atob(s):Lpe(this.decodeStringToByteArray(s,r))},decodeStringToByteArray(s,r){this.init_();const o=r?this.charToByteMapWebSafe_:this.charToByteMap_,l=[];for(let u=0;u<s.length;){const f=o[s.charAt(u++)],T=u<s.length?o[s.charAt(u)]:0;++u;const A=u<s.length?o[s.charAt(u)]:64;++u;const M=u<s.length?o[s.charAt(u)]:64;if(++u,f==null||T==null||A==null||M==null)throw new Mpe;const F=f<<2|T>>4;if(l.push(F),A!==64){const Y=T<<4&240|A>>2;if(l.push(Y),M!==64){const J=A<<6&192|M;l.push(J)}}}return l},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let s=0;s<this.ENCODED_VALS.length;s++)this.byteToCharMap_[s]=this.ENCODED_VALS.charAt(s),this.charToByteMap_[this.byteToCharMap_[s]]=s,this.byteToCharMapWebSafe_[s]=this.ENCODED_VALS_WEBSAFE.charAt(s),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[s]]=s,s>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(s)]=s,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(s)]=s)}}};class Mpe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Upe=function(s){const r=D9(s);return k9.encodeByteArray(r,!0)},sb=function(s){return Upe(s).replace(/\./g,"")},L9=function(s){try{return k9.decodeString(s,!0)}catch(r){console.error("base64Decode failed: ",r)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jpe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vpe=()=>jpe().__FIREBASE_DEFAULTS__,Fpe=()=>{if(typeof process>"u"||typeof CW>"u")return;const s=CW.__FIREBASE_DEFAULTS__;if(s)return JSON.parse(s)},Bpe=()=>{if(typeof document>"u")return;let s;try{s=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const r=s&&L9(s[1]);return r&&JSON.parse(r)},Xb=()=>{try{return Vpe()||Fpe()||Bpe()}catch(s){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${s}`);return}},M9=s=>{var r,o;return(o=(r=Xb())===null||r===void 0?void 0:r.emulatorHosts)===null||o===void 0?void 0:o[s]},U9=s=>{const r=M9(s);if(!r)return;const o=r.lastIndexOf(":");if(o<=0||o+1===r.length)throw new Error(`Invalid host ${r} with no separate hostname and port!`);const l=parseInt(r.substring(o+1),10);return r[0]==="["?[r.substring(1,o-1),l]:[r.substring(0,o),l]},j9=()=>{var s;return(s=Xb())===null||s===void 0?void 0:s.config},V9=s=>{var r;return(r=Xb())===null||r===void 0?void 0:r[`_${s}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gpe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((r,o)=>{this.resolve=r,this.reject=o})}wrapCallback(r){return(o,l)=>{o?this.reject(o):this.resolve(l),typeof r=="function"&&(this.promise.catch(()=>{}),r.length===1?r(o):r(o,l))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F9(s,r){if(s.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const o={alg:"none",type:"JWT"},l=r||"demo-project",u=s.iat||0,f=s.sub||s.user_id;if(!f)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const E=Object.assign({iss:`https://securetoken.google.com/${l}`,aud:l,iat:u,exp:u+3600,auth_time:u,sub:f,user_id:f,firebase:{sign_in_provider:"custom",identities:{}}},s);return[sb(JSON.stringify(o)),sb(JSON.stringify(E)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ps(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Wpe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ps())}function zpe(){var s;const r=(s=Xb())===null||s===void 0?void 0:s.forceEnvironment;if(r==="node")return!0;if(r==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Hpe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Kpe(){const s=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof s=="object"&&s.id!==void 0}function qpe(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Ype(){const s=ps();return s.indexOf("MSIE ")>=0||s.indexOf("Trident/")>=0}function Xpe(){return!zpe()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Jpe(){try{return typeof indexedDB=="object"}catch{return!1}}function Qpe(){return new Promise((s,r)=>{try{let o=!0;const l="validate-browser-context-for-indexeddb-analytics-module",u=self.indexedDB.open(l);u.onsuccess=()=>{u.result.close(),o||self.indexedDB.deleteDatabase(l),s(!0)},u.onupgradeneeded=()=>{o=!1},u.onerror=()=>{var f;r(((f=u.error)===null||f===void 0?void 0:f.message)||"")}}catch(o){r(o)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $pe="FirebaseError";class Pc extends Error{constructor(r,o,l){super(o),this.code=r,this.customData=l,this.name=$pe,Object.setPrototypeOf(this,Pc.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,zE.prototype.create)}}class zE{constructor(r,o,l){this.service=r,this.serviceName=o,this.errors=l}create(r,...o){const l=o[0]||{},u=`${this.service}/${r}`,f=this.errors[r],E=f?Zpe(f,l):"Error",T=`${this.serviceName}: ${E} (${u}).`;return new Pc(u,T,l)}}function Zpe(s,r){return s.replace(eme,(o,l)=>{const u=r[l];return u!=null?String(u):`<${l}?>`})}const eme=/\{\$([^}]+)}/g;function tme(s){for(const r in s)if(Object.prototype.hasOwnProperty.call(s,r))return!1;return!0}function CE(s,r){if(s===r)return!0;const o=Object.keys(s),l=Object.keys(r);for(const u of o){if(!l.includes(u))return!1;const f=s[u],E=r[u];if(IW(f)&&IW(E)){if(!CE(f,E))return!1}else if(f!==E)return!1}for(const u of l)if(!o.includes(u))return!1;return!0}function IW(s){return s!==null&&typeof s=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HE(s){const r=[];for(const[o,l]of Object.entries(s))Array.isArray(l)?l.forEach(u=>{r.push(encodeURIComponent(o)+"="+encodeURIComponent(u))}):r.push(encodeURIComponent(o)+"="+encodeURIComponent(l));return r.length?"&"+r.join("&"):""}function U_(s){const r={};return s.replace(/^\?/,"").split("&").forEach(l=>{if(l){const[u,f]=l.split("=");r[decodeURIComponent(u)]=decodeURIComponent(f)}}),r}function j_(s){const r=s.indexOf("?");if(!r)return"";const o=s.indexOf("#",r);return s.substring(r,o>0?o:void 0)}function nme(s,r){const o=new rme(s,r);return o.subscribe.bind(o)}class rme{constructor(r,o){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=o,this.task.then(()=>{r(this)}).catch(l=>{this.error(l)})}next(r){this.forEachObserver(o=>{o.next(r)})}error(r){this.forEachObserver(o=>{o.error(r)}),this.close(r)}complete(){this.forEachObserver(r=>{r.complete()}),this.close()}subscribe(r,o,l){let u;if(r===void 0&&o===void 0&&l===void 0)throw new Error("Missing Observer.");ime(r,["next","error","complete"])?u=r:u={next:r,error:o,complete:l},u.next===void 0&&(u.next=_x),u.error===void 0&&(u.error=_x),u.complete===void 0&&(u.complete=_x);const f=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?u.error(this.finalError):u.complete()}catch{}}),this.observers.push(u),f}unsubscribeOne(r){this.observers===void 0||this.observers[r]===void 0||(delete this.observers[r],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(r){if(!this.finalized)for(let o=0;o<this.observers.length;o++)this.sendOne(o,r)}sendOne(r,o){this.task.then(()=>{if(this.observers!==void 0&&this.observers[r]!==void 0)try{o(this.observers[r])}catch(l){typeof console<"u"&&console.error&&console.error(l)}})}close(r){this.finalized||(this.finalized=!0,r!==void 0&&(this.finalError=r),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ime(s,r){if(typeof s!="object"||s===null)return!1;for(const o of r)if(o in s&&typeof s[o]=="function")return!0;return!1}function _x(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function li(s){return s&&s._delegate?s._delegate:s}class Jd{constructor(r,o,l){this.name=r,this.instanceFactory=o,this.type=l,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(r){return this.instantiationMode=r,this}setMultipleInstances(r){return this.multipleInstances=r,this}setServiceProps(r){return this.serviceProps=r,this}setInstanceCreatedCallback(r){return this.onInstanceCreated=r,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mh="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sme{constructor(r,o){this.name=r,this.container=o,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(r){const o=this.normalizeInstanceIdentifier(r);if(!this.instancesDeferred.has(o)){const l=new Gpe;if(this.instancesDeferred.set(o,l),this.isInitialized(o)||this.shouldAutoInitialize())try{const u=this.getOrInitializeService({instanceIdentifier:o});u&&l.resolve(u)}catch{}}return this.instancesDeferred.get(o).promise}getImmediate(r){var o;const l=this.normalizeInstanceIdentifier(r==null?void 0:r.identifier),u=(o=r==null?void 0:r.optional)!==null&&o!==void 0?o:!1;if(this.isInitialized(l)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:l})}catch(f){if(u)return null;throw f}else{if(u)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(r){if(r.name!==this.name)throw Error(`Mismatching Component ${r.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=r,!!this.shouldAutoInitialize()){if(ame(r))try{this.getOrInitializeService({instanceIdentifier:mh})}catch{}for(const[o,l]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(o);try{const f=this.getOrInitializeService({instanceIdentifier:u});l.resolve(f)}catch{}}}}clearInstance(r=mh){this.instancesDeferred.delete(r),this.instancesOptions.delete(r),this.instances.delete(r)}async delete(){const r=Array.from(this.instances.values());await Promise.all([...r.filter(o=>"INTERNAL"in o).map(o=>o.INTERNAL.delete()),...r.filter(o=>"_delete"in o).map(o=>o._delete())])}isComponentSet(){return this.component!=null}isInitialized(r=mh){return this.instances.has(r)}getOptions(r=mh){return this.instancesOptions.get(r)||{}}initialize(r={}){const{options:o={}}=r,l=this.normalizeInstanceIdentifier(r.instanceIdentifier);if(this.isInitialized(l))throw Error(`${this.name}(${l}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const u=this.getOrInitializeService({instanceIdentifier:l,options:o});for(const[f,E]of this.instancesDeferred.entries()){const T=this.normalizeInstanceIdentifier(f);l===T&&E.resolve(u)}return u}onInit(r,o){var l;const u=this.normalizeInstanceIdentifier(o),f=(l=this.onInitCallbacks.get(u))!==null&&l!==void 0?l:new Set;f.add(r),this.onInitCallbacks.set(u,f);const E=this.instances.get(u);return E&&r(E,u),()=>{f.delete(r)}}invokeOnInitCallbacks(r,o){const l=this.onInitCallbacks.get(o);if(l)for(const u of l)try{u(r,o)}catch{}}getOrInitializeService({instanceIdentifier:r,options:o={}}){let l=this.instances.get(r);if(!l&&this.component&&(l=this.component.instanceFactory(this.container,{instanceIdentifier:ome(r),options:o}),this.instances.set(r,l),this.instancesOptions.set(r,o),this.invokeOnInitCallbacks(l,r),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,r,l)}catch{}return l||null}normalizeInstanceIdentifier(r=mh){return this.component?this.component.multipleInstances?r:mh:r}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function ome(s){return s===mh?void 0:s}function ame(s){return s.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cme{constructor(r){this.name=r,this.providers=new Map}addComponent(r){const o=this.getProvider(r.name);if(o.isComponentSet())throw new Error(`Component ${r.name} has already been registered with ${this.name}`);o.setComponent(r)}addOrOverwriteComponent(r){this.getProvider(r.name).isComponentSet()&&this.providers.delete(r.name),this.addComponent(r)}getProvider(r){if(this.providers.has(r))return this.providers.get(r);const o=new sme(r,this);return this.providers.set(r,o),o}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Rn;(function(s){s[s.DEBUG=0]="DEBUG",s[s.VERBOSE=1]="VERBOSE",s[s.INFO=2]="INFO",s[s.WARN=3]="WARN",s[s.ERROR=4]="ERROR",s[s.SILENT=5]="SILENT"})(Rn||(Rn={}));const lme={debug:Rn.DEBUG,verbose:Rn.VERBOSE,info:Rn.INFO,warn:Rn.WARN,error:Rn.ERROR,silent:Rn.SILENT},dme=Rn.INFO,ume={[Rn.DEBUG]:"log",[Rn.VERBOSE]:"log",[Rn.INFO]:"info",[Rn.WARN]:"warn",[Rn.ERROR]:"error"},hme=(s,r,...o)=>{if(r<s.logLevel)return;const l=new Date().toISOString(),u=ume[r];if(u)console[u](`[${l}]  ${s.name}:`,...o);else throw new Error(`Attempted to log a message with an invalid logType (value: ${r})`)};class iD{constructor(r){this.name=r,this._logLevel=dme,this._logHandler=hme,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(r){if(!(r in Rn))throw new TypeError(`Invalid value "${r}" assigned to \`logLevel\``);this._logLevel=r}setLogLevel(r){this._logLevel=typeof r=="string"?lme[r]:r}get logHandler(){return this._logHandler}set logHandler(r){if(typeof r!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=r}get userLogHandler(){return this._userLogHandler}set userLogHandler(r){this._userLogHandler=r}debug(...r){this._userLogHandler&&this._userLogHandler(this,Rn.DEBUG,...r),this._logHandler(this,Rn.DEBUG,...r)}log(...r){this._userLogHandler&&this._userLogHandler(this,Rn.VERBOSE,...r),this._logHandler(this,Rn.VERBOSE,...r)}info(...r){this._userLogHandler&&this._userLogHandler(this,Rn.INFO,...r),this._logHandler(this,Rn.INFO,...r)}warn(...r){this._userLogHandler&&this._userLogHandler(this,Rn.WARN,...r),this._logHandler(this,Rn.WARN,...r)}error(...r){this._userLogHandler&&this._userLogHandler(this,Rn.ERROR,...r),this._logHandler(this,Rn.ERROR,...r)}}const pme=(s,r)=>r.some(o=>s instanceof o);let AW,NW;function mme(){return AW||(AW=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function fme(){return NW||(NW=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const B9=new WeakMap,DO=new WeakMap,G9=new WeakMap,Ex=new WeakMap,sD=new WeakMap;function gme(s){const r=new Promise((o,l)=>{const u=()=>{s.removeEventListener("success",f),s.removeEventListener("error",E)},f=()=>{o(Wd(s.result)),u()},E=()=>{l(s.error),u()};s.addEventListener("success",f),s.addEventListener("error",E)});return r.then(o=>{o instanceof IDBCursor&&B9.set(o,s)}).catch(()=>{}),sD.set(r,s),r}function _me(s){if(DO.has(s))return;const r=new Promise((o,l)=>{const u=()=>{s.removeEventListener("complete",f),s.removeEventListener("error",E),s.removeEventListener("abort",E)},f=()=>{o(),u()},E=()=>{l(s.error||new DOMException("AbortError","AbortError")),u()};s.addEventListener("complete",f),s.addEventListener("error",E),s.addEventListener("abort",E)});DO.set(s,r)}let kO={get(s,r,o){if(s instanceof IDBTransaction){if(r==="done")return DO.get(s);if(r==="objectStoreNames")return s.objectStoreNames||G9.get(s);if(r==="store")return o.objectStoreNames[1]?void 0:o.objectStore(o.objectStoreNames[0])}return Wd(s[r])},set(s,r,o){return s[r]=o,!0},has(s,r){return s instanceof IDBTransaction&&(r==="done"||r==="store")?!0:r in s}};function Eme(s){kO=s(kO)}function vme(s){return s===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(r,...o){const l=s.call(vx(this),r,...o);return G9.set(l,r.sort?r.sort():[r]),Wd(l)}:fme().includes(s)?function(...r){return s.apply(vx(this),r),Wd(B9.get(this))}:function(...r){return Wd(s.apply(vx(this),r))}}function yme(s){return typeof s=="function"?vme(s):(s instanceof IDBTransaction&&_me(s),pme(s,mme())?new Proxy(s,kO):s)}function Wd(s){if(s instanceof IDBRequest)return gme(s);if(Ex.has(s))return Ex.get(s);const r=yme(s);return r!==s&&(Ex.set(s,r),sD.set(r,s)),r}const vx=s=>sD.get(s);function Sme(s,r,{blocked:o,upgrade:l,blocking:u,terminated:f}={}){const E=indexedDB.open(s,r),T=Wd(E);return l&&E.addEventListener("upgradeneeded",w=>{l(Wd(E.result),w.oldVersion,w.newVersion,Wd(E.transaction),w)}),o&&E.addEventListener("blocked",w=>o(w.oldVersion,w.newVersion,w)),T.then(w=>{f&&w.addEventListener("close",()=>f()),u&&w.addEventListener("versionchange",A=>u(A.oldVersion,A.newVersion,A))}).catch(()=>{}),T}const Tme=["get","getKey","getAll","getAllKeys","count"],bme=["put","add","delete","clear"],yx=new Map;function xW(s,r){if(!(s instanceof IDBDatabase&&!(r in s)&&typeof r=="string"))return;if(yx.get(r))return yx.get(r);const o=r.replace(/FromIndex$/,""),l=r!==o,u=bme.includes(o);if(!(o in(l?IDBIndex:IDBObjectStore).prototype)||!(u||Tme.includes(o)))return;const f=async function(E,...T){const w=this.transaction(E,u?"readwrite":"readonly");let A=w.store;return l&&(A=A.index(T.shift())),(await Promise.all([A[o](...T),u&&w.done]))[0]};return yx.set(r,f),f}Eme(s=>({...s,get:(r,o,l)=>xW(r,o)||s.get(r,o,l),has:(r,o)=>!!xW(r,o)||s.has(r,o)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rme{constructor(r){this.container=r}getPlatformInfoString(){return this.container.getProviders().map(o=>{if(wme(o)){const l=o.getImmediate();return`${l.library}/${l.version}`}else return null}).filter(o=>o).join(" ")}}function wme(s){const r=s.getComponent();return(r==null?void 0:r.type)==="VERSION"}const LO="@firebase/app",OW="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tl=new iD("@firebase/app"),Cme="@firebase/app-compat",Ime="@firebase/analytics-compat",Ame="@firebase/analytics",Nme="@firebase/app-check-compat",xme="@firebase/app-check",Ome="@firebase/auth",Pme="@firebase/auth-compat",Dme="@firebase/database",kme="@firebase/data-connect",Lme="@firebase/database-compat",Mme="@firebase/functions",Ume="@firebase/functions-compat",jme="@firebase/installations",Vme="@firebase/installations-compat",Fme="@firebase/messaging",Bme="@firebase/messaging-compat",Gme="@firebase/performance",Wme="@firebase/performance-compat",zme="@firebase/remote-config",Hme="@firebase/remote-config-compat",Kme="@firebase/storage",qme="@firebase/storage-compat",Yme="@firebase/firestore",Xme="@firebase/vertexai-preview",Jme="@firebase/firestore-compat",Qme="firebase",$me="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MO="[DEFAULT]",Zme={[LO]:"fire-core",[Cme]:"fire-core-compat",[Ame]:"fire-analytics",[Ime]:"fire-analytics-compat",[xme]:"fire-app-check",[Nme]:"fire-app-check-compat",[Ome]:"fire-auth",[Pme]:"fire-auth-compat",[Dme]:"fire-rtdb",[kme]:"fire-data-connect",[Lme]:"fire-rtdb-compat",[Mme]:"fire-fn",[Ume]:"fire-fn-compat",[jme]:"fire-iid",[Vme]:"fire-iid-compat",[Fme]:"fire-fcm",[Bme]:"fire-fcm-compat",[Gme]:"fire-perf",[Wme]:"fire-perf-compat",[zme]:"fire-rc",[Hme]:"fire-rc-compat",[Kme]:"fire-gcs",[qme]:"fire-gcs-compat",[Yme]:"fire-fst",[Jme]:"fire-fst-compat",[Xme]:"fire-vertex","fire-js":"fire-js",[Qme]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ob=new Map,efe=new Map,UO=new Map;function PW(s,r){try{s.container.addComponent(r)}catch(o){Tl.debug(`Component ${r.name} failed to register with FirebaseApp ${s.name}`,o)}}function Lh(s){const r=s.name;if(UO.has(r))return Tl.debug(`There were multiple attempts to register component ${r}.`),!1;UO.set(r,s);for(const o of ob.values())PW(o,s);for(const o of efe.values())PW(o,s);return!0}function Jb(s,r){const o=s.container.getProvider("heartbeat").getImmediate({optional:!0});return o&&o.triggerHeartbeat(),s.container.getProvider(r)}function Da(s){return s.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tfe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},zd=new zE("app","Firebase",tfe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nfe{constructor(r,o,l){this._isDeleted=!1,this._options=Object.assign({},r),this._config=Object.assign({},o),this._name=o.name,this._automaticDataCollectionEnabled=o.automaticDataCollectionEnabled,this._container=l,this.container.addComponent(new Jd("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(r){this.checkDestroyed(),this._automaticDataCollectionEnabled=r}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(r){this._isDeleted=r}checkDestroyed(){if(this.isDeleted)throw zd.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wh=$me;function W9(s,r={}){let o=s;typeof r!="object"&&(r={name:r});const l=Object.assign({name:MO,automaticDataCollectionEnabled:!1},r),u=l.name;if(typeof u!="string"||!u)throw zd.create("bad-app-name",{appName:String(u)});if(o||(o=j9()),!o)throw zd.create("no-options");const f=ob.get(u);if(f){if(CE(o,f.options)&&CE(l,f.config))return f;throw zd.create("duplicate-app",{appName:u})}const E=new cme(u);for(const w of UO.values())E.addComponent(w);const T=new nfe(o,l,E);return ob.set(u,T),T}function oD(s=MO){const r=ob.get(s);if(!r&&s===MO&&j9())return W9();if(!r)throw zd.create("no-app",{appName:s});return r}function wc(s,r,o){var l;let u=(l=Zme[s])!==null&&l!==void 0?l:s;o&&(u+=`-${o}`);const f=u.match(/\s|\//),E=r.match(/\s|\//);if(f||E){const T=[`Unable to register library "${u}" with version "${r}":`];f&&T.push(`library name "${u}" contains illegal characters (whitespace or "/")`),f&&E&&T.push("and"),E&&T.push(`version name "${r}" contains illegal characters (whitespace or "/")`),Tl.warn(T.join(" "));return}Lh(new Jd(`${u}-version`,()=>({library:u,version:r}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rfe="firebase-heartbeat-database",ife=1,IE="firebase-heartbeat-store";let Sx=null;function z9(){return Sx||(Sx=Sme(rfe,ife,{upgrade:(s,r)=>{switch(r){case 0:try{s.createObjectStore(IE)}catch(o){console.warn(o)}}}}).catch(s=>{throw zd.create("idb-open",{originalErrorMessage:s.message})})),Sx}async function sfe(s){try{const o=(await z9()).transaction(IE),l=await o.objectStore(IE).get(H9(s));return await o.done,l}catch(r){if(r instanceof Pc)Tl.warn(r.message);else{const o=zd.create("idb-get",{originalErrorMessage:r==null?void 0:r.message});Tl.warn(o.message)}}}async function DW(s,r){try{const l=(await z9()).transaction(IE,"readwrite");await l.objectStore(IE).put(r,H9(s)),await l.done}catch(o){if(o instanceof Pc)Tl.warn(o.message);else{const l=zd.create("idb-set",{originalErrorMessage:o==null?void 0:o.message});Tl.warn(l.message)}}}function H9(s){return`${s.name}!${s.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ofe=1024,afe=30*24*60*60*1e3;class cfe{constructor(r){this.container=r,this._heartbeatsCache=null;const o=this.container.getProvider("app").getImmediate();this._storage=new dfe(o),this._heartbeatsCachePromise=this._storage.read().then(l=>(this._heartbeatsCache=l,l))}async triggerHeartbeat(){var r,o;try{const u=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),f=kW();return((r=this._heartbeatsCache)===null||r===void 0?void 0:r.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((o=this._heartbeatsCache)===null||o===void 0?void 0:o.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===f||this._heartbeatsCache.heartbeats.some(E=>E.date===f)?void 0:(this._heartbeatsCache.heartbeats.push({date:f,agent:u}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(E=>{const T=new Date(E.date).valueOf();return Date.now()-T<=afe}),this._storage.overwrite(this._heartbeatsCache))}catch(l){Tl.warn(l)}}async getHeartbeatsHeader(){var r;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((r=this._heartbeatsCache)===null||r===void 0?void 0:r.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const o=kW(),{heartbeatsToSend:l,unsentEntries:u}=lfe(this._heartbeatsCache.heartbeats),f=sb(JSON.stringify({version:2,heartbeats:l}));return this._heartbeatsCache.lastSentHeartbeatDate=o,u.length>0?(this._heartbeatsCache.heartbeats=u,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),f}catch(o){return Tl.warn(o),""}}}function kW(){return new Date().toISOString().substring(0,10)}function lfe(s,r=ofe){const o=[];let l=s.slice();for(const u of s){const f=o.find(E=>E.agent===u.agent);if(f){if(f.dates.push(u.date),LW(o)>r){f.dates.pop();break}}else if(o.push({agent:u.agent,dates:[u.date]}),LW(o)>r){o.pop();break}l=l.slice(1)}return{heartbeatsToSend:o,unsentEntries:l}}class dfe{constructor(r){this.app=r,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Jpe()?Qpe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const o=await sfe(this.app);return o!=null&&o.heartbeats?o:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(r){var o;if(await this._canUseIndexedDBPromise){const u=await this.read();return DW(this.app,{lastSentHeartbeatDate:(o=r.lastSentHeartbeatDate)!==null&&o!==void 0?o:u.lastSentHeartbeatDate,heartbeats:r.heartbeats})}else return}async add(r){var o;if(await this._canUseIndexedDBPromise){const u=await this.read();return DW(this.app,{lastSentHeartbeatDate:(o=r.lastSentHeartbeatDate)!==null&&o!==void 0?o:u.lastSentHeartbeatDate,heartbeats:[...u.heartbeats,...r.heartbeats]})}else return}}function LW(s){return sb(JSON.stringify({version:2,heartbeats:s})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ufe(s){Lh(new Jd("platform-logger",r=>new Rme(r),"PRIVATE")),Lh(new Jd("heartbeat",r=>new cfe(r),"PRIVATE")),wc(LO,OW,s),wc(LO,OW,"esm2017"),wc("fire-js","")}ufe("");function aD(s,r){var o={};for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&r.indexOf(l)<0&&(o[l]=s[l]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,l=Object.getOwnPropertySymbols(s);u<l.length;u++)r.indexOf(l[u])<0&&Object.prototype.propertyIsEnumerable.call(s,l[u])&&(o[l[u]]=s[l[u]]);return o}function K9(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const hfe=K9,q9=new zE("auth","Firebase",K9());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ab=new iD("@firebase/auth");function pfe(s,...r){ab.logLevel<=Rn.WARN&&ab.warn(`Auth (${Wh}): ${s}`,...r)}function T0(s,...r){ab.logLevel<=Rn.ERROR&&ab.error(`Auth (${Wh}): ${s}`,...r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zo(s,...r){throw lD(s,...r)}function Ua(s,...r){return lD(s,...r)}function cD(s,r,o){const l=Object.assign(Object.assign({},hfe()),{[r]:o});return new zE("auth","Firebase",l).create(r,{appName:s.name})}function ml(s){return cD(s,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function mfe(s,r,o){const l=o;if(!(r instanceof l))throw l.name!==r.constructor.name&&Zo(s,"argument-error"),cD(s,"argument-error",`Type of ${r.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function lD(s,...r){if(typeof s!="string"){const o=r[0],l=[...r.slice(1)];return l[0]&&(l[0].appName=s.name),s._errorFactory.create(o,...l)}return q9.create(s,...r)}function Vt(s,r,...o){if(!s)throw lD(r,...o)}function cl(s){const r="INTERNAL ASSERTION FAILED: "+s;throw T0(r),new Error(r)}function bl(s,r){s||cl(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jO(){var s;return typeof self<"u"&&((s=self.location)===null||s===void 0?void 0:s.href)||""}function ffe(){return MW()==="http:"||MW()==="https:"}function MW(){var s;return typeof self<"u"&&((s=self.location)===null||s===void 0?void 0:s.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gfe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(ffe()||Kpe()||"connection"in navigator)?navigator.onLine:!0}function _fe(){if(typeof navigator>"u")return null;const s=navigator;return s.languages&&s.languages[0]||s.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KE{constructor(r,o){this.shortDelay=r,this.longDelay=o,bl(o>r,"Short delay should be less than long delay!"),this.isMobile=Wpe()||qpe()}get(){return gfe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dD(s,r){bl(s.emulator,"Emulator should always be set here");const{url:o}=s.emulator;return r?`${o}${r.startsWith("/")?r.slice(1):r}`:o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y9{static initialize(r,o,l){this.fetchImpl=r,o&&(this.headersImpl=o),l&&(this.responseImpl=l)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;cl("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;cl("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;cl("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Efe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vfe=new KE(3e4,6e4);function xl(s,r){return s.tenantId&&!r.tenantId?Object.assign(Object.assign({},r),{tenantId:s.tenantId}):r}async function Ol(s,r,o,l,u={}){return X9(s,u,async()=>{let f={},E={};l&&(r==="GET"?E=l:f={body:JSON.stringify(l)});const T=HE(Object.assign({key:s.config.apiKey},E)).slice(1),w=await s._getAdditionalHeaders();w["Content-Type"]="application/json",s.languageCode&&(w["X-Firebase-Locale"]=s.languageCode);const A=Object.assign({method:r,headers:w},f);return Hpe()||(A.referrerPolicy="no-referrer"),Y9.fetch()(J9(s,s.config.apiHost,o,T),A)})}async function X9(s,r,o){s._canInitEmulator=!1;const l=Object.assign(Object.assign({},Efe),r);try{const u=new Sfe(s),f=await Promise.race([o(),u.promise]);u.clearNetworkTimeout();const E=await f.json();if("needConfirmation"in E)throw i0(s,"account-exists-with-different-credential",E);if(f.ok&&!("errorMessage"in E))return E;{const T=f.ok?E.errorMessage:E.error.message,[w,A]=T.split(" : ");if(w==="FEDERATED_USER_ID_ALREADY_LINKED")throw i0(s,"credential-already-in-use",E);if(w==="EMAIL_EXISTS")throw i0(s,"email-already-in-use",E);if(w==="USER_DISABLED")throw i0(s,"user-disabled",E);const U=l[w]||w.toLowerCase().replace(/[_\s]+/g,"-");if(A)throw cD(s,U,A);Zo(s,U)}}catch(u){if(u instanceof Pc)throw u;Zo(s,"network-request-failed",{message:String(u)})}}async function qE(s,r,o,l,u={}){const f=await Ol(s,r,o,l,u);return"mfaPendingCredential"in f&&Zo(s,"multi-factor-auth-required",{_serverResponse:f}),f}function J9(s,r,o,l){const u=`${r}${o}?${l}`;return s.config.emulator?dD(s.config,u):`${s.config.apiScheme}://${u}`}function yfe(s){switch(s){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Sfe{constructor(r){this.auth=r,this.timer=null,this.promise=new Promise((o,l)=>{this.timer=setTimeout(()=>l(Ua(this.auth,"network-request-failed")),vfe.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function i0(s,r,o){const l={appName:s.name};o.email&&(l.email=o.email),o.phoneNumber&&(l.phoneNumber=o.phoneNumber);const u=Ua(s,r,l);return u.customData._tokenResponse=o,u}function UW(s){return s!==void 0&&s.enterprise!==void 0}class Tfe{constructor(r){if(this.siteKey="",this.recaptchaEnforcementState=[],r.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=r.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=r.recaptchaEnforcementState}getProviderEnforcementState(r){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const o of this.recaptchaEnforcementState)if(o.provider&&o.provider===r)return yfe(o.enforcementState);return null}isProviderEnabled(r){return this.getProviderEnforcementState(r)==="ENFORCE"||this.getProviderEnforcementState(r)==="AUDIT"}}async function bfe(s,r){return Ol(s,"GET","/v2/recaptchaConfig",xl(s,r))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rfe(s,r){return Ol(s,"POST","/v1/accounts:delete",r)}async function Q9(s,r){return Ol(s,"POST","/v1/accounts:lookup",r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eE(s){if(s)try{const r=new Date(Number(s));if(!isNaN(r.getTime()))return r.toUTCString()}catch{}}async function wfe(s,r=!1){const o=li(s),l=await o.getIdToken(r),u=uD(l);Vt(u&&u.exp&&u.auth_time&&u.iat,o.auth,"internal-error");const f=typeof u.firebase=="object"?u.firebase:void 0,E=f==null?void 0:f.sign_in_provider;return{claims:u,token:l,authTime:eE(Tx(u.auth_time)),issuedAtTime:eE(Tx(u.iat)),expirationTime:eE(Tx(u.exp)),signInProvider:E||null,signInSecondFactor:(f==null?void 0:f.sign_in_second_factor)||null}}function Tx(s){return Number(s)*1e3}function uD(s){const[r,o,l]=s.split(".");if(r===void 0||o===void 0||l===void 0)return T0("JWT malformed, contained fewer than 3 sections"),null;try{const u=L9(o);return u?JSON.parse(u):(T0("Failed to decode base64 JWT payload"),null)}catch(u){return T0("Caught error parsing JWT payload as JSON",u==null?void 0:u.toString()),null}}function jW(s){const r=uD(s);return Vt(r,"internal-error"),Vt(typeof r.exp<"u","internal-error"),Vt(typeof r.iat<"u","internal-error"),Number(r.exp)-Number(r.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AE(s,r,o=!1){if(o)return r;try{return await r}catch(l){throw l instanceof Pc&&Cfe(l)&&s.auth.currentUser===s&&await s.auth.signOut(),l}}function Cfe({code:s}){return s==="auth/user-disabled"||s==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ife{constructor(r){this.user=r,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(r){var o;if(r){const l=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),l}else{this.errorBackoff=3e4;const u=((o=this.user.stsTokenManager.expirationTime)!==null&&o!==void 0?o:0)-Date.now()-3e5;return Math.max(0,u)}}schedule(r=!1){if(!this.isRunning)return;const o=this.getInterval(r);this.timerId=setTimeout(async()=>{await this.iteration()},o)}async iteration(){try{await this.user.getIdToken(!0)}catch(r){(r==null?void 0:r.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VO{constructor(r,o){this.createdAt=r,this.lastLoginAt=o,this._initializeTime()}_initializeTime(){this.lastSignInTime=eE(this.lastLoginAt),this.creationTime=eE(this.createdAt)}_copy(r){this.createdAt=r.createdAt,this.lastLoginAt=r.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cb(s){var r;const o=s.auth,l=await s.getIdToken(),u=await AE(s,Q9(o,{idToken:l}));Vt(u==null?void 0:u.users.length,o,"internal-error");const f=u.users[0];s._notifyReloadListener(f);const E=!((r=f.providerUserInfo)===null||r===void 0)&&r.length?$9(f.providerUserInfo):[],T=Nfe(s.providerData,E),w=s.isAnonymous,A=!(s.email&&f.passwordHash)&&!(T!=null&&T.length),U=w?A:!1,M={uid:f.localId,displayName:f.displayName||null,photoURL:f.photoUrl||null,email:f.email||null,emailVerified:f.emailVerified||!1,phoneNumber:f.phoneNumber||null,tenantId:f.tenantId||null,providerData:T,metadata:new VO(f.createdAt,f.lastLoginAt),isAnonymous:U};Object.assign(s,M)}async function Afe(s){const r=li(s);await cb(r),await r.auth._persistUserIfCurrent(r),r.auth._notifyListenersIfCurrent(r)}function Nfe(s,r){return[...s.filter(l=>!r.some(u=>u.providerId===l.providerId)),...r]}function $9(s){return s.map(r=>{var{providerId:o}=r,l=aD(r,["providerId"]);return{providerId:o,uid:l.rawId||"",displayName:l.displayName||null,email:l.email||null,phoneNumber:l.phoneNumber||null,photoURL:l.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xfe(s,r){const o=await X9(s,{},async()=>{const l=HE({grant_type:"refresh_token",refresh_token:r}).slice(1),{tokenApiHost:u,apiKey:f}=s.config,E=J9(s,u,"/v1/token",`key=${f}`),T=await s._getAdditionalHeaders();return T["Content-Type"]="application/x-www-form-urlencoded",Y9.fetch()(E,{method:"POST",headers:T,body:l})});return{accessToken:o.access_token,expiresIn:o.expires_in,refreshToken:o.refresh_token}}async function Ofe(s,r){return Ol(s,"POST","/v2/accounts:revokeToken",xl(s,r))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jm{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(r){Vt(r.idToken,"internal-error"),Vt(typeof r.idToken<"u","internal-error"),Vt(typeof r.refreshToken<"u","internal-error");const o="expiresIn"in r&&typeof r.expiresIn<"u"?Number(r.expiresIn):jW(r.idToken);this.updateTokensAndExpiration(r.idToken,r.refreshToken,o)}updateFromIdToken(r){Vt(r.length!==0,"internal-error");const o=jW(r);this.updateTokensAndExpiration(r,null,o)}async getToken(r,o=!1){return!o&&this.accessToken&&!this.isExpired?this.accessToken:(Vt(this.refreshToken,r,"user-token-expired"),this.refreshToken?(await this.refresh(r,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(r,o){const{accessToken:l,refreshToken:u,expiresIn:f}=await xfe(r,o);this.updateTokensAndExpiration(l,u,Number(f))}updateTokensAndExpiration(r,o,l){this.refreshToken=o||null,this.accessToken=r||null,this.expirationTime=Date.now()+l*1e3}static fromJSON(r,o){const{refreshToken:l,accessToken:u,expirationTime:f}=o,E=new Jm;return l&&(Vt(typeof l=="string","internal-error",{appName:r}),E.refreshToken=l),u&&(Vt(typeof u=="string","internal-error",{appName:r}),E.accessToken=u),f&&(Vt(typeof f=="number","internal-error",{appName:r}),E.expirationTime=f),E}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(r){this.accessToken=r.accessToken,this.refreshToken=r.refreshToken,this.expirationTime=r.expirationTime}_clone(){return Object.assign(new Jm,this.toJSON())}_performRefresh(){return cl("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yd(s,r){Vt(typeof s=="string"||typeof s>"u","internal-error",{appName:r})}class ll{constructor(r){var{uid:o,auth:l,stsTokenManager:u}=r,f=aD(r,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Ife(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=o,this.auth=l,this.stsTokenManager=u,this.accessToken=u.accessToken,this.displayName=f.displayName||null,this.email=f.email||null,this.emailVerified=f.emailVerified||!1,this.phoneNumber=f.phoneNumber||null,this.photoURL=f.photoURL||null,this.isAnonymous=f.isAnonymous||!1,this.tenantId=f.tenantId||null,this.providerData=f.providerData?[...f.providerData]:[],this.metadata=new VO(f.createdAt||void 0,f.lastLoginAt||void 0)}async getIdToken(r){const o=await AE(this,this.stsTokenManager.getToken(this.auth,r));return Vt(o,this.auth,"internal-error"),this.accessToken!==o&&(this.accessToken=o,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),o}getIdTokenResult(r){return wfe(this,r)}reload(){return Afe(this)}_assign(r){this!==r&&(Vt(this.uid===r.uid,this.auth,"internal-error"),this.displayName=r.displayName,this.photoURL=r.photoURL,this.email=r.email,this.emailVerified=r.emailVerified,this.phoneNumber=r.phoneNumber,this.isAnonymous=r.isAnonymous,this.tenantId=r.tenantId,this.providerData=r.providerData.map(o=>Object.assign({},o)),this.metadata._copy(r.metadata),this.stsTokenManager._assign(r.stsTokenManager))}_clone(r){const o=new ll(Object.assign(Object.assign({},this),{auth:r,stsTokenManager:this.stsTokenManager._clone()}));return o.metadata._copy(this.metadata),o}_onReload(r){Vt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=r,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(r){this.reloadListener?this.reloadListener(r):this.reloadUserInfo=r}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(r,o=!1){let l=!1;r.idToken&&r.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(r),l=!0),o&&await cb(this),await this.auth._persistUserIfCurrent(this),l&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Da(this.auth.app))return Promise.reject(ml(this.auth));const r=await this.getIdToken();return await AE(this,Rfe(this.auth,{idToken:r})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(r=>Object.assign({},r)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(r,o){var l,u,f,E,T,w,A,U;const M=(l=o.displayName)!==null&&l!==void 0?l:void 0,F=(u=o.email)!==null&&u!==void 0?u:void 0,Y=(f=o.phoneNumber)!==null&&f!==void 0?f:void 0,J=(E=o.photoURL)!==null&&E!==void 0?E:void 0,ae=(T=o.tenantId)!==null&&T!==void 0?T:void 0,he=(w=o._redirectEventId)!==null&&w!==void 0?w:void 0,ee=(A=o.createdAt)!==null&&A!==void 0?A:void 0,W=(U=o.lastLoginAt)!==null&&U!==void 0?U:void 0,{uid:Z,emailVerified:fe,isAnonymous:pe,providerData:Ce,stsTokenManager:te}=o;Vt(Z&&te,r,"internal-error");const q=Jm.fromJSON(this.name,te);Vt(typeof Z=="string",r,"internal-error"),yd(M,r.name),yd(F,r.name),Vt(typeof fe=="boolean",r,"internal-error"),Vt(typeof pe=="boolean",r,"internal-error"),yd(Y,r.name),yd(J,r.name),yd(ae,r.name),yd(he,r.name),yd(ee,r.name),yd(W,r.name);const re=new ll({uid:Z,auth:r,email:F,emailVerified:fe,displayName:M,isAnonymous:pe,photoURL:J,phoneNumber:Y,tenantId:ae,stsTokenManager:q,createdAt:ee,lastLoginAt:W});return Ce&&Array.isArray(Ce)&&(re.providerData=Ce.map($=>Object.assign({},$))),he&&(re._redirectEventId=he),re}static async _fromIdTokenResponse(r,o,l=!1){const u=new Jm;u.updateFromServerResponse(o);const f=new ll({uid:o.localId,auth:r,stsTokenManager:u,isAnonymous:l});return await cb(f),f}static async _fromGetAccountInfoResponse(r,o,l){const u=o.users[0];Vt(u.localId!==void 0,"internal-error");const f=u.providerUserInfo!==void 0?$9(u.providerUserInfo):[],E=!(u.email&&u.passwordHash)&&!(f!=null&&f.length),T=new Jm;T.updateFromIdToken(l);const w=new ll({uid:u.localId,auth:r,stsTokenManager:T,isAnonymous:E}),A={uid:u.localId,displayName:u.displayName||null,photoURL:u.photoUrl||null,email:u.email||null,emailVerified:u.emailVerified||!1,phoneNumber:u.phoneNumber||null,tenantId:u.tenantId||null,providerData:f,metadata:new VO(u.createdAt,u.lastLoginAt),isAnonymous:!(u.email&&u.passwordHash)&&!(f!=null&&f.length)};return Object.assign(w,A),w}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VW=new Map;function dl(s){bl(s instanceof Function,"Expected a class definition");let r=VW.get(s);return r?(bl(r instanceof s,"Instance stored in cache mismatched with class"),r):(r=new s,VW.set(s,r),r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z9{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(r,o){this.storage[r]=o}async _get(r){const o=this.storage[r];return o===void 0?null:o}async _remove(r){delete this.storage[r]}_addListener(r,o){}_removeListener(r,o){}}Z9.type="NONE";const FW=Z9;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b0(s,r,o){return`firebase:${s}:${r}:${o}`}class Qm{constructor(r,o,l){this.persistence=r,this.auth=o,this.userKey=l;const{config:u,name:f}=this.auth;this.fullUserKey=b0(this.userKey,u.apiKey,f),this.fullPersistenceKey=b0("persistence",u.apiKey,f),this.boundEventHandler=o._onStorageEvent.bind(o),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(r){return this.persistence._set(this.fullUserKey,r.toJSON())}async getCurrentUser(){const r=await this.persistence._get(this.fullUserKey);return r?ll._fromJSON(this.auth,r):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(r){if(this.persistence===r)return;const o=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=r,o)return this.setCurrentUser(o)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(r,o,l="authUser"){if(!o.length)return new Qm(dl(FW),r,l);const u=(await Promise.all(o.map(async A=>{if(await A._isAvailable())return A}))).filter(A=>A);let f=u[0]||dl(FW);const E=b0(l,r.config.apiKey,r.name);let T=null;for(const A of o)try{const U=await A._get(E);if(U){const M=ll._fromJSON(r,U);A!==f&&(T=M),f=A;break}}catch{}const w=u.filter(A=>A._shouldAllowMigration);return!f._shouldAllowMigration||!w.length?new Qm(f,r,l):(f=w[0],T&&await f._set(E,T.toJSON()),await Promise.all(o.map(async A=>{if(A!==f)try{await A._remove(E)}catch{}})),new Qm(f,r,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BW(s){const r=s.toLowerCase();if(r.includes("opera/")||r.includes("opr/")||r.includes("opios/"))return"Opera";if(rK(r))return"IEMobile";if(r.includes("msie")||r.includes("trident/"))return"IE";if(r.includes("edge/"))return"Edge";if(eK(r))return"Firefox";if(r.includes("silk/"))return"Silk";if(sK(r))return"Blackberry";if(oK(r))return"Webos";if(tK(r))return"Safari";if((r.includes("chrome/")||nK(r))&&!r.includes("edge/"))return"Chrome";if(iK(r))return"Android";{const o=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,l=s.match(o);if((l==null?void 0:l.length)===2)return l[1]}return"Other"}function eK(s=ps()){return/firefox\//i.test(s)}function tK(s=ps()){const r=s.toLowerCase();return r.includes("safari/")&&!r.includes("chrome/")&&!r.includes("crios/")&&!r.includes("android")}function nK(s=ps()){return/crios\//i.test(s)}function rK(s=ps()){return/iemobile/i.test(s)}function iK(s=ps()){return/android/i.test(s)}function sK(s=ps()){return/blackberry/i.test(s)}function oK(s=ps()){return/webos/i.test(s)}function hD(s=ps()){return/iphone|ipad|ipod/i.test(s)||/macintosh/i.test(s)&&/mobile/i.test(s)}function Pfe(s=ps()){var r;return hD(s)&&!!(!((r=window.navigator)===null||r===void 0)&&r.standalone)}function Dfe(){return Ype()&&document.documentMode===10}function aK(s=ps()){return hD(s)||iK(s)||oK(s)||sK(s)||/windows phone/i.test(s)||rK(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cK(s,r=[]){let o;switch(s){case"Browser":o=BW(ps());break;case"Worker":o=`${BW(ps())}-${s}`;break;default:o=s}const l=r.length?r.join(","):"FirebaseCore-web";return`${o}/JsCore/${Wh}/${l}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kfe{constructor(r){this.auth=r,this.queue=[]}pushCallback(r,o){const l=f=>new Promise((E,T)=>{try{const w=r(f);E(w)}catch(w){T(w)}});l.onAbort=o,this.queue.push(l);const u=this.queue.length-1;return()=>{this.queue[u]=()=>Promise.resolve()}}async runMiddleware(r){if(this.auth.currentUser===r)return;const o=[];try{for(const l of this.queue)await l(r),l.onAbort&&o.push(l.onAbort)}catch(l){o.reverse();for(const u of o)try{u()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:l==null?void 0:l.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Lfe(s,r={}){return Ol(s,"GET","/v2/passwordPolicy",xl(s,r))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mfe=6;class Ufe{constructor(r){var o,l,u,f;const E=r.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(o=E.minPasswordLength)!==null&&o!==void 0?o:Mfe,E.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=E.maxPasswordLength),E.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=E.containsLowercaseCharacter),E.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=E.containsUppercaseCharacter),E.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=E.containsNumericCharacter),E.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=E.containsNonAlphanumericCharacter),this.enforcementState=r.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(u=(l=r.allowedNonAlphanumericCharacters)===null||l===void 0?void 0:l.join(""))!==null&&u!==void 0?u:"",this.forceUpgradeOnSignin=(f=r.forceUpgradeOnSignin)!==null&&f!==void 0?f:!1,this.schemaVersion=r.schemaVersion}validatePassword(r){var o,l,u,f,E,T;const w={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(r,w),this.validatePasswordCharacterOptions(r,w),w.isValid&&(w.isValid=(o=w.meetsMinPasswordLength)!==null&&o!==void 0?o:!0),w.isValid&&(w.isValid=(l=w.meetsMaxPasswordLength)!==null&&l!==void 0?l:!0),w.isValid&&(w.isValid=(u=w.containsLowercaseLetter)!==null&&u!==void 0?u:!0),w.isValid&&(w.isValid=(f=w.containsUppercaseLetter)!==null&&f!==void 0?f:!0),w.isValid&&(w.isValid=(E=w.containsNumericCharacter)!==null&&E!==void 0?E:!0),w.isValid&&(w.isValid=(T=w.containsNonAlphanumericCharacter)!==null&&T!==void 0?T:!0),w}validatePasswordLengthOptions(r,o){const l=this.customStrengthOptions.minPasswordLength,u=this.customStrengthOptions.maxPasswordLength;l&&(o.meetsMinPasswordLength=r.length>=l),u&&(o.meetsMaxPasswordLength=r.length<=u)}validatePasswordCharacterOptions(r,o){this.updatePasswordCharacterOptionsStatuses(o,!1,!1,!1,!1);let l;for(let u=0;u<r.length;u++)l=r.charAt(u),this.updatePasswordCharacterOptionsStatuses(o,l>="a"&&l<="z",l>="A"&&l<="Z",l>="0"&&l<="9",this.allowedNonAlphanumericCharacters.includes(l))}updatePasswordCharacterOptionsStatuses(r,o,l,u,f){this.customStrengthOptions.containsLowercaseLetter&&(r.containsLowercaseLetter||(r.containsLowercaseLetter=o)),this.customStrengthOptions.containsUppercaseLetter&&(r.containsUppercaseLetter||(r.containsUppercaseLetter=l)),this.customStrengthOptions.containsNumericCharacter&&(r.containsNumericCharacter||(r.containsNumericCharacter=u)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(r.containsNonAlphanumericCharacter||(r.containsNonAlphanumericCharacter=f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jfe{constructor(r,o,l,u){this.app=r,this.heartbeatServiceProvider=o,this.appCheckServiceProvider=l,this.config=u,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new GW(this),this.idTokenSubscription=new GW(this),this.beforeStateQueue=new kfe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=q9,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=r.name,this.clientVersion=u.sdkClientVersion}_initializeWithPersistence(r,o){return o&&(this._popupRedirectResolver=dl(o)),this._initializationPromise=this.queue(async()=>{var l,u;if(!this._deleted&&(this.persistenceManager=await Qm.create(this,r),!this._deleted)){if(!((l=this._popupRedirectResolver)===null||l===void 0)&&l._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(o),this.lastNotifiedUid=((u=this.currentUser)===null||u===void 0?void 0:u.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const r=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!r)){if(this.currentUser&&r&&this.currentUser.uid===r.uid){this._currentUser._assign(r),await this.currentUser.getIdToken();return}await this._updateCurrentUser(r,!0)}}async initializeCurrentUserFromIdToken(r){try{const o=await Q9(this,{idToken:r}),l=await ll._fromGetAccountInfoResponse(this,o,r);await this.directlySetCurrentUser(l)}catch(o){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",o),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(r){var o;if(Da(this.app)){const E=this.app.settings.authIdToken;return E?new Promise(T=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(E).then(T,T))}):this.directlySetCurrentUser(null)}const l=await this.assertedPersistence.getCurrentUser();let u=l,f=!1;if(r&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const E=(o=this.redirectUser)===null||o===void 0?void 0:o._redirectEventId,T=u==null?void 0:u._redirectEventId,w=await this.tryRedirectSignIn(r);(!E||E===T)&&(w!=null&&w.user)&&(u=w.user,f=!0)}if(!u)return this.directlySetCurrentUser(null);if(!u._redirectEventId){if(f)try{await this.beforeStateQueue.runMiddleware(u)}catch(E){u=l,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(E))}return u?this.reloadAndSetCurrentUserOrClear(u):this.directlySetCurrentUser(null)}return Vt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===u._redirectEventId?this.directlySetCurrentUser(u):this.reloadAndSetCurrentUserOrClear(u)}async tryRedirectSignIn(r){let o=null;try{o=await this._popupRedirectResolver._completeRedirectFn(this,r,!0)}catch{await this._setRedirectUser(null)}return o}async reloadAndSetCurrentUserOrClear(r){try{await cb(r)}catch(o){if((o==null?void 0:o.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(r)}useDeviceLanguage(){this.languageCode=_fe()}async _delete(){this._deleted=!0}async updateCurrentUser(r){if(Da(this.app))return Promise.reject(ml(this));const o=r?li(r):null;return o&&Vt(o.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(o&&o._clone(this))}async _updateCurrentUser(r,o=!1){if(!this._deleted)return r&&Vt(this.tenantId===r.tenantId,this,"tenant-id-mismatch"),o||await this.beforeStateQueue.runMiddleware(r),this.queue(async()=>{await this.directlySetCurrentUser(r),this.notifyAuthListeners()})}async signOut(){return Da(this.app)?Promise.reject(ml(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(r){return Da(this.app)?Promise.reject(ml(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(dl(r))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(r){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const o=this._getPasswordPolicyInternal();return o.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):o.validatePassword(r)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const r=await Lfe(this),o=new Ufe(r);this.tenantId===null?this._projectPasswordPolicy=o:this._tenantPasswordPolicies[this.tenantId]=o}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(r){this._errorFactory=new zE("auth","Firebase",r())}onAuthStateChanged(r,o,l){return this.registerStateListener(this.authStateSubscription,r,o,l)}beforeAuthStateChanged(r,o){return this.beforeStateQueue.pushCallback(r,o)}onIdTokenChanged(r,o,l){return this.registerStateListener(this.idTokenSubscription,r,o,l)}authStateReady(){return new Promise((r,o)=>{if(this.currentUser)r();else{const l=this.onAuthStateChanged(()=>{l(),r()},o)}})}async revokeAccessToken(r){if(this.currentUser){const o=await this.currentUser.getIdToken(),l={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:r,idToken:o};this.tenantId!=null&&(l.tenantId=this.tenantId),await Ofe(this,l)}}toJSON(){var r;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(r=this._currentUser)===null||r===void 0?void 0:r.toJSON()}}async _setRedirectUser(r,o){const l=await this.getOrInitRedirectPersistenceManager(o);return r===null?l.removeCurrentUser():l.setCurrentUser(r)}async getOrInitRedirectPersistenceManager(r){if(!this.redirectPersistenceManager){const o=r&&dl(r)||this._popupRedirectResolver;Vt(o,this,"argument-error"),this.redirectPersistenceManager=await Qm.create(this,[dl(o._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(r){var o,l;return this._isInitialized&&await this.queue(async()=>{}),((o=this._currentUser)===null||o===void 0?void 0:o._redirectEventId)===r?this._currentUser:((l=this.redirectUser)===null||l===void 0?void 0:l._redirectEventId)===r?this.redirectUser:null}async _persistUserIfCurrent(r){if(r===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(r))}_notifyListenersIfCurrent(r){r===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var r,o;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const l=(o=(r=this.currentUser)===null||r===void 0?void 0:r.uid)!==null&&o!==void 0?o:null;this.lastNotifiedUid!==l&&(this.lastNotifiedUid=l,this.authStateSubscription.next(this.currentUser))}registerStateListener(r,o,l,u){if(this._deleted)return()=>{};const f=typeof o=="function"?o:o.next.bind(o);let E=!1;const T=this._isInitialized?Promise.resolve():this._initializationPromise;if(Vt(T,this,"internal-error"),T.then(()=>{E||f(this.currentUser)}),typeof o=="function"){const w=r.addObserver(o,l,u);return()=>{E=!0,w()}}else{const w=r.addObserver(o);return()=>{E=!0,w()}}}async directlySetCurrentUser(r){this.currentUser&&this.currentUser!==r&&this._currentUser._stopProactiveRefresh(),r&&this.isProactiveRefreshEnabled&&r._startProactiveRefresh(),this.currentUser=r,r?await this.assertedPersistence.setCurrentUser(r):await this.assertedPersistence.removeCurrentUser()}queue(r){return this.operations=this.operations.then(r,r),this.operations}get assertedPersistence(){return Vt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(r){!r||this.frameworks.includes(r)||(this.frameworks.push(r),this.frameworks.sort(),this.clientVersion=cK(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var r;const o={"X-Client-Version":this.clientVersion};this.app.options.appId&&(o["X-Firebase-gmpid"]=this.app.options.appId);const l=await((r=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||r===void 0?void 0:r.getHeartbeatsHeader());l&&(o["X-Firebase-Client"]=l);const u=await this._getAppCheckToken();return u&&(o["X-Firebase-AppCheck"]=u),o}async _getAppCheckToken(){var r;const o=await((r=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||r===void 0?void 0:r.getToken());return o!=null&&o.error&&pfe(`Error while retrieving App Check token: ${o.error}`),o==null?void 0:o.token}}function Pl(s){return li(s)}class GW{constructor(r){this.auth=r,this.observer=null,this.addObserver=nme(o=>this.observer=o)}get next(){return Vt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qb={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Vfe(s){Qb=s}function lK(s){return Qb.loadJS(s)}function Ffe(){return Qb.recaptchaEnterpriseScript}function Bfe(){return Qb.gapiScript}function Gfe(s){return`__${s}${Math.floor(Math.random()*1e6)}`}const Wfe="recaptcha-enterprise",zfe="NO_RECAPTCHA";class Hfe{constructor(r){this.type=Wfe,this.auth=Pl(r)}async verify(r="verify",o=!1){async function l(f){if(!o){if(f.tenantId==null&&f._agentRecaptchaConfig!=null)return f._agentRecaptchaConfig.siteKey;if(f.tenantId!=null&&f._tenantRecaptchaConfigs[f.tenantId]!==void 0)return f._tenantRecaptchaConfigs[f.tenantId].siteKey}return new Promise(async(E,T)=>{bfe(f,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(w=>{if(w.recaptchaKey===void 0)T(new Error("recaptcha Enterprise site key undefined"));else{const A=new Tfe(w);return f.tenantId==null?f._agentRecaptchaConfig=A:f._tenantRecaptchaConfigs[f.tenantId]=A,E(A.siteKey)}}).catch(w=>{T(w)})})}function u(f,E,T){const w=window.grecaptcha;UW(w)?w.enterprise.ready(()=>{w.enterprise.execute(f,{action:r}).then(A=>{E(A)}).catch(()=>{E(zfe)})}):T(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((f,E)=>{l(this.auth).then(T=>{if(!o&&UW(window.grecaptcha))u(T,f,E);else{if(typeof window>"u"){E(new Error("RecaptchaVerifier is only supported in browser"));return}let w=Ffe();w.length!==0&&(w+=T),lK(w).then(()=>{u(T,f,E)}).catch(A=>{E(A)})}}).catch(T=>{E(T)})})}}async function WW(s,r,o,l=!1){const u=new Hfe(s);let f;try{f=await u.verify(o)}catch{f=await u.verify(o,!0)}const E=Object.assign({},r);return l?Object.assign(E,{captchaResp:f}):Object.assign(E,{captchaResponse:f}),Object.assign(E,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(E,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),E}async function lb(s,r,o,l){var u;if(!((u=s._getRecaptchaConfig())===null||u===void 0)&&u.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const f=await WW(s,r,o,o==="getOobCode");return l(s,f)}else return l(s,r).catch(async f=>{if(f.code==="auth/missing-recaptcha-token"){console.log(`${o} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const E=await WW(s,r,o,o==="getOobCode");return l(s,E)}else return Promise.reject(f)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kfe(s,r){const o=Jb(s,"auth");if(o.isInitialized()){const u=o.getImmediate(),f=o.getOptions();if(CE(f,r??{}))return u;Zo(u,"already-initialized")}return o.initialize({options:r})}function qfe(s,r){const o=(r==null?void 0:r.persistence)||[],l=(Array.isArray(o)?o:[o]).map(dl);r!=null&&r.errorMap&&s._updateErrorMap(r.errorMap),s._initializeWithPersistence(l,r==null?void 0:r.popupRedirectResolver)}function Yfe(s,r,o){const l=Pl(s);Vt(l._canInitEmulator,l,"emulator-config-failed"),Vt(/^https?:\/\//.test(r),l,"invalid-emulator-scheme");const u=!1,f=dK(r),{host:E,port:T}=Xfe(r),w=T===null?"":`:${T}`;l.config.emulator={url:`${f}//${E}${w}/`},l.settings.appVerificationDisabledForTesting=!0,l.emulatorConfig=Object.freeze({host:E,port:T,protocol:f.replace(":",""),options:Object.freeze({disableWarnings:u})}),Jfe()}function dK(s){const r=s.indexOf(":");return r<0?"":s.substr(0,r+1)}function Xfe(s){const r=dK(s),o=/(\/\/)?([^?#/]+)/.exec(s.substr(r.length));if(!o)return{host:"",port:null};const l=o[2].split("@").pop()||"",u=/^(\[[^\]]+\])(:|$)/.exec(l);if(u){const f=u[1];return{host:f,port:zW(l.substr(f.length+1))}}else{const[f,E]=l.split(":");return{host:f,port:zW(E)}}}function zW(s){if(!s)return null;const r=Number(s);return isNaN(r)?null:r}function Jfe(){function s(){const r=document.createElement("p"),o=r.style;r.innerText="Running in emulator mode. Do not use with production credentials.",o.position="fixed",o.width="100%",o.backgroundColor="#ffffff",o.border=".1em solid #000000",o.color="#b50000",o.bottom="0px",o.left="0px",o.margin="0px",o.zIndex="10000",o.textAlign="center",r.classList.add("firebase-emulator-warning"),document.body.appendChild(r)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",s):s())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pD{constructor(r,o){this.providerId=r,this.signInMethod=o}toJSON(){return cl("not implemented")}_getIdTokenResponse(r){return cl("not implemented")}_linkToIdToken(r,o){return cl("not implemented")}_getReauthenticationResolver(r){return cl("not implemented")}}async function Qfe(s,r){return Ol(s,"POST","/v1/accounts:signUp",r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $fe(s,r){return qE(s,"POST","/v1/accounts:signInWithPassword",xl(s,r))}async function Zfe(s,r){return Ol(s,"POST","/v1/accounts:sendOobCode",xl(s,r))}async function ege(s,r){return Zfe(s,r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tge(s,r){return qE(s,"POST","/v1/accounts:signInWithEmailLink",xl(s,r))}async function nge(s,r){return qE(s,"POST","/v1/accounts:signInWithEmailLink",xl(s,r))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NE extends pD{constructor(r,o,l,u=null){super("password",l),this._email=r,this._password=o,this._tenantId=u}static _fromEmailAndPassword(r,o){return new NE(r,o,"password")}static _fromEmailAndCode(r,o,l=null){return new NE(r,o,"emailLink",l)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(r){const o=typeof r=="string"?JSON.parse(r):r;if(o!=null&&o.email&&(o!=null&&o.password)){if(o.signInMethod==="password")return this._fromEmailAndPassword(o.email,o.password);if(o.signInMethod==="emailLink")return this._fromEmailAndCode(o.email,o.password,o.tenantId)}return null}async _getIdTokenResponse(r){switch(this.signInMethod){case"password":const o={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return lb(r,o,"signInWithPassword",$fe);case"emailLink":return tge(r,{email:this._email,oobCode:this._password});default:Zo(r,"internal-error")}}async _linkToIdToken(r,o){switch(this.signInMethod){case"password":const l={idToken:o,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return lb(r,l,"signUpPassword",Qfe);case"emailLink":return nge(r,{idToken:o,email:this._email,oobCode:this._password});default:Zo(r,"internal-error")}}_getReauthenticationResolver(r){return this._getIdTokenResponse(r)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $m(s,r){return qE(s,"POST","/v1/accounts:signInWithIdp",xl(s,r))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rge="http://localhost";class Mh extends pD{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(r){const o=new Mh(r.providerId,r.signInMethod);return r.idToken||r.accessToken?(r.idToken&&(o.idToken=r.idToken),r.accessToken&&(o.accessToken=r.accessToken),r.nonce&&!r.pendingToken&&(o.nonce=r.nonce),r.pendingToken&&(o.pendingToken=r.pendingToken)):r.oauthToken&&r.oauthTokenSecret?(o.accessToken=r.oauthToken,o.secret=r.oauthTokenSecret):Zo("argument-error"),o}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(r){const o=typeof r=="string"?JSON.parse(r):r,{providerId:l,signInMethod:u}=o,f=aD(o,["providerId","signInMethod"]);if(!l||!u)return null;const E=new Mh(l,u);return E.idToken=f.idToken||void 0,E.accessToken=f.accessToken||void 0,E.secret=f.secret,E.nonce=f.nonce,E.pendingToken=f.pendingToken||null,E}_getIdTokenResponse(r){const o=this.buildRequest();return $m(r,o)}_linkToIdToken(r,o){const l=this.buildRequest();return l.idToken=o,$m(r,l)}_getReauthenticationResolver(r){const o=this.buildRequest();return o.autoCreate=!1,$m(r,o)}buildRequest(){const r={requestUri:rge,returnSecureToken:!0};if(this.pendingToken)r.pendingToken=this.pendingToken;else{const o={};this.idToken&&(o.id_token=this.idToken),this.accessToken&&(o.access_token=this.accessToken),this.secret&&(o.oauth_token_secret=this.secret),o.providerId=this.providerId,this.nonce&&!this.pendingToken&&(o.nonce=this.nonce),r.postBody=HE(o)}return r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ige(s){switch(s){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function sge(s){const r=U_(j_(s)).link,o=r?U_(j_(r)).deep_link_id:null,l=U_(j_(s)).deep_link_id;return(l?U_(j_(l)).link:null)||l||o||r||s}class mD{constructor(r){var o,l,u,f,E,T;const w=U_(j_(r)),A=(o=w.apiKey)!==null&&o!==void 0?o:null,U=(l=w.oobCode)!==null&&l!==void 0?l:null,M=ige((u=w.mode)!==null&&u!==void 0?u:null);Vt(A&&U&&M,"argument-error"),this.apiKey=A,this.operation=M,this.code=U,this.continueUrl=(f=w.continueUrl)!==null&&f!==void 0?f:null,this.languageCode=(E=w.languageCode)!==null&&E!==void 0?E:null,this.tenantId=(T=w.tenantId)!==null&&T!==void 0?T:null}static parseLink(r){const o=sge(r);try{return new mD(o)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wf{constructor(){this.providerId=wf.PROVIDER_ID}static credential(r,o){return NE._fromEmailAndPassword(r,o)}static credentialWithLink(r,o){const l=mD.parseLink(o);return Vt(l,"argument-error"),NE._fromEmailAndCode(r,l.code,l.tenantId)}}wf.PROVIDER_ID="password";wf.EMAIL_PASSWORD_SIGN_IN_METHOD="password";wf.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fD{constructor(r){this.providerId=r,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(r){this.defaultLanguageCode=r}setCustomParameters(r){return this.customParameters=r,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YE extends fD{constructor(){super(...arguments),this.scopes=[]}addScope(r){return this.scopes.includes(r)||this.scopes.push(r),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Id extends YE{constructor(){super("facebook.com")}static credential(r){return Mh._fromParams({providerId:Id.PROVIDER_ID,signInMethod:Id.FACEBOOK_SIGN_IN_METHOD,accessToken:r})}static credentialFromResult(r){return Id.credentialFromTaggedObject(r)}static credentialFromError(r){return Id.credentialFromTaggedObject(r.customData||{})}static credentialFromTaggedObject({_tokenResponse:r}){if(!r||!("oauthAccessToken"in r)||!r.oauthAccessToken)return null;try{return Id.credential(r.oauthAccessToken)}catch{return null}}}Id.FACEBOOK_SIGN_IN_METHOD="facebook.com";Id.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class il extends YE{constructor(){super("google.com"),this.addScope("profile")}static credential(r,o){return Mh._fromParams({providerId:il.PROVIDER_ID,signInMethod:il.GOOGLE_SIGN_IN_METHOD,idToken:r,accessToken:o})}static credentialFromResult(r){return il.credentialFromTaggedObject(r)}static credentialFromError(r){return il.credentialFromTaggedObject(r.customData||{})}static credentialFromTaggedObject({_tokenResponse:r}){if(!r)return null;const{oauthIdToken:o,oauthAccessToken:l}=r;if(!o&&!l)return null;try{return il.credential(o,l)}catch{return null}}}il.GOOGLE_SIGN_IN_METHOD="google.com";il.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ad extends YE{constructor(){super("github.com")}static credential(r){return Mh._fromParams({providerId:Ad.PROVIDER_ID,signInMethod:Ad.GITHUB_SIGN_IN_METHOD,accessToken:r})}static credentialFromResult(r){return Ad.credentialFromTaggedObject(r)}static credentialFromError(r){return Ad.credentialFromTaggedObject(r.customData||{})}static credentialFromTaggedObject({_tokenResponse:r}){if(!r||!("oauthAccessToken"in r)||!r.oauthAccessToken)return null;try{return Ad.credential(r.oauthAccessToken)}catch{return null}}}Ad.GITHUB_SIGN_IN_METHOD="github.com";Ad.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nd extends YE{constructor(){super("twitter.com")}static credential(r,o){return Mh._fromParams({providerId:Nd.PROVIDER_ID,signInMethod:Nd.TWITTER_SIGN_IN_METHOD,oauthToken:r,oauthTokenSecret:o})}static credentialFromResult(r){return Nd.credentialFromTaggedObject(r)}static credentialFromError(r){return Nd.credentialFromTaggedObject(r.customData||{})}static credentialFromTaggedObject({_tokenResponse:r}){if(!r)return null;const{oauthAccessToken:o,oauthTokenSecret:l}=r;if(!o||!l)return null;try{return Nd.credential(o,l)}catch{return null}}}Nd.TWITTER_SIGN_IN_METHOD="twitter.com";Nd.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oge(s,r){return qE(s,"POST","/v1/accounts:signUp",xl(s,r))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uh{constructor(r){this.user=r.user,this.providerId=r.providerId,this._tokenResponse=r._tokenResponse,this.operationType=r.operationType}static async _fromIdTokenResponse(r,o,l,u=!1){const f=await ll._fromIdTokenResponse(r,l,u),E=HW(l);return new Uh({user:f,providerId:E,_tokenResponse:l,operationType:o})}static async _forOperation(r,o,l){await r._updateTokensIfNecessary(l,!0);const u=HW(l);return new Uh({user:r,providerId:u,_tokenResponse:l,operationType:o})}}function HW(s){return s.providerId?s.providerId:"phoneNumber"in s?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class db extends Pc{constructor(r,o,l,u){var f;super(o.code,o.message),this.operationType=l,this.user=u,Object.setPrototypeOf(this,db.prototype),this.customData={appName:r.name,tenantId:(f=r.tenantId)!==null&&f!==void 0?f:void 0,_serverResponse:o.customData._serverResponse,operationType:l}}static _fromErrorAndOperation(r,o,l,u){return new db(r,o,l,u)}}function uK(s,r,o,l){return(r==="reauthenticate"?o._getReauthenticationResolver(s):o._getIdTokenResponse(s)).catch(f=>{throw f.code==="auth/multi-factor-auth-required"?db._fromErrorAndOperation(s,f,r,l):f})}async function age(s,r,o=!1){const l=await AE(s,r._linkToIdToken(s.auth,await s.getIdToken()),o);return Uh._forOperation(s,"link",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cge(s,r,o=!1){const{auth:l}=s;if(Da(l.app))return Promise.reject(ml(l));const u="reauthenticate";try{const f=await AE(s,uK(l,u,r,s),o);Vt(f.idToken,l,"internal-error");const E=uD(f.idToken);Vt(E,l,"internal-error");const{sub:T}=E;return Vt(s.uid===T,l,"user-mismatch"),Uh._forOperation(s,u,f)}catch(f){throw(f==null?void 0:f.code)==="auth/user-not-found"&&Zo(l,"user-mismatch"),f}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hK(s,r,o=!1){if(Da(s.app))return Promise.reject(ml(s));const l="signIn",u=await uK(s,l,r),f=await Uh._fromIdTokenResponse(s,l,u);return o||await s._updateCurrentUser(f.user),f}async function lge(s,r){return hK(Pl(s),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pK(s){const r=Pl(s);r._getPasswordPolicyInternal()&&await r._updatePasswordPolicy()}async function dge(s,r,o){const l=Pl(s);await lb(l,{requestType:"PASSWORD_RESET",email:r,clientType:"CLIENT_TYPE_WEB"},"getOobCode",ege)}async function uge(s,r,o){if(Da(s.app))return Promise.reject(ml(s));const l=Pl(s),E=await lb(l,{returnSecureToken:!0,email:r,password:o,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",oge).catch(w=>{throw w.code==="auth/password-does-not-meet-requirements"&&pK(s),w}),T=await Uh._fromIdTokenResponse(l,"signIn",E);return await l._updateCurrentUser(T.user),T}function hge(s,r,o){return Da(s.app)?Promise.reject(ml(s)):lge(li(s),wf.credential(r,o)).catch(async l=>{throw l.code==="auth/password-does-not-meet-requirements"&&pK(s),l})}function pge(s,r,o,l){return li(s).onIdTokenChanged(r,o,l)}function mge(s,r,o){return li(s).beforeAuthStateChanged(r,o)}function fge(s,r,o,l){return li(s).onAuthStateChanged(r,o,l)}function gge(s){return li(s).signOut()}const ub="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mK{constructor(r,o){this.storageRetriever=r,this.type=o}_isAvailable(){try{return this.storage?(this.storage.setItem(ub,"1"),this.storage.removeItem(ub),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(r,o){return this.storage.setItem(r,JSON.stringify(o)),Promise.resolve()}_get(r){const o=this.storage.getItem(r);return Promise.resolve(o?JSON.parse(o):null)}_remove(r){return this.storage.removeItem(r),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _ge=1e3,Ege=10;class fK extends mK{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(r,o)=>this.onStorageEvent(r,o),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=aK(),this._shouldAllowMigration=!0}forAllChangedKeys(r){for(const o of Object.keys(this.listeners)){const l=this.storage.getItem(o),u=this.localCache[o];l!==u&&r(o,u,l)}}onStorageEvent(r,o=!1){if(!r.key){this.forAllChangedKeys((E,T,w)=>{this.notifyListeners(E,w)});return}const l=r.key;o?this.detachListener():this.stopPolling();const u=()=>{const E=this.storage.getItem(l);!o&&this.localCache[l]===E||this.notifyListeners(l,E)},f=this.storage.getItem(l);Dfe()&&f!==r.newValue&&r.newValue!==r.oldValue?setTimeout(u,Ege):u()}notifyListeners(r,o){this.localCache[r]=o;const l=this.listeners[r];if(l)for(const u of Array.from(l))u(o&&JSON.parse(o))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((r,o,l)=>{this.onStorageEvent(new StorageEvent("storage",{key:r,oldValue:o,newValue:l}),!0)})},_ge)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(r,o){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[r]||(this.listeners[r]=new Set,this.localCache[r]=this.storage.getItem(r)),this.listeners[r].add(o)}_removeListener(r,o){this.listeners[r]&&(this.listeners[r].delete(o),this.listeners[r].size===0&&delete this.listeners[r]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(r,o){await super._set(r,o),this.localCache[r]=JSON.stringify(o)}async _get(r){const o=await super._get(r);return this.localCache[r]=JSON.stringify(o),o}async _remove(r){await super._remove(r),delete this.localCache[r]}}fK.type="LOCAL";const vge=fK;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gK extends mK{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(r,o){}_removeListener(r,o){}}gK.type="SESSION";const _K=gK;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yge(s){return Promise.all(s.map(async r=>{try{return{fulfilled:!0,value:await r}}catch(o){return{fulfilled:!1,reason:o}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $b{constructor(r){this.eventTarget=r,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(r){const o=this.receivers.find(u=>u.isListeningto(r));if(o)return o;const l=new $b(r);return this.receivers.push(l),l}isListeningto(r){return this.eventTarget===r}async handleEvent(r){const o=r,{eventId:l,eventType:u,data:f}=o.data,E=this.handlersMap[u];if(!(E!=null&&E.size))return;o.ports[0].postMessage({status:"ack",eventId:l,eventType:u});const T=Array.from(E).map(async A=>A(o.origin,f)),w=await yge(T);o.ports[0].postMessage({status:"done",eventId:l,eventType:u,response:w})}_subscribe(r,o){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[r]||(this.handlersMap[r]=new Set),this.handlersMap[r].add(o)}_unsubscribe(r,o){this.handlersMap[r]&&o&&this.handlersMap[r].delete(o),(!o||this.handlersMap[r].size===0)&&delete this.handlersMap[r],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}$b.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gD(s="",r=10){let o="";for(let l=0;l<r;l++)o+=Math.floor(Math.random()*10);return s+o}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sge{constructor(r){this.target=r,this.handlers=new Set}removeMessageHandler(r){r.messageChannel&&(r.messageChannel.port1.removeEventListener("message",r.onMessage),r.messageChannel.port1.close()),this.handlers.delete(r)}async _send(r,o,l=50){const u=typeof MessageChannel<"u"?new MessageChannel:null;if(!u)throw new Error("connection_unavailable");let f,E;return new Promise((T,w)=>{const A=gD("",20);u.port1.start();const U=setTimeout(()=>{w(new Error("unsupported_event"))},l);E={messageChannel:u,onMessage(M){const F=M;if(F.data.eventId===A)switch(F.data.status){case"ack":clearTimeout(U),f=setTimeout(()=>{w(new Error("timeout"))},3e3);break;case"done":clearTimeout(f),T(F.data.response);break;default:clearTimeout(U),clearTimeout(f),w(new Error("invalid_response"));break}}},this.handlers.add(E),u.port1.addEventListener("message",E.onMessage),this.target.postMessage({eventType:r,eventId:A,data:o},[u.port2])}).finally(()=>{E&&this.removeMessageHandler(E)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cc(){return window}function Tge(s){Cc().location.href=s}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EK(){return typeof Cc().WorkerGlobalScope<"u"&&typeof Cc().importScripts=="function"}async function bge(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Rge(){var s;return((s=navigator==null?void 0:navigator.serviceWorker)===null||s===void 0?void 0:s.controller)||null}function wge(){return EK()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vK="firebaseLocalStorageDb",Cge=1,hb="firebaseLocalStorage",yK="fbase_key";class XE{constructor(r){this.request=r}toPromise(){return new Promise((r,o)=>{this.request.addEventListener("success",()=>{r(this.request.result)}),this.request.addEventListener("error",()=>{o(this.request.error)})})}}function Zb(s,r){return s.transaction([hb],r?"readwrite":"readonly").objectStore(hb)}function Ige(){const s=indexedDB.deleteDatabase(vK);return new XE(s).toPromise()}function FO(){const s=indexedDB.open(vK,Cge);return new Promise((r,o)=>{s.addEventListener("error",()=>{o(s.error)}),s.addEventListener("upgradeneeded",()=>{const l=s.result;try{l.createObjectStore(hb,{keyPath:yK})}catch(u){o(u)}}),s.addEventListener("success",async()=>{const l=s.result;l.objectStoreNames.contains(hb)?r(l):(l.close(),await Ige(),r(await FO()))})})}async function KW(s,r,o){const l=Zb(s,!0).put({[yK]:r,value:o});return new XE(l).toPromise()}async function Age(s,r){const o=Zb(s,!1).get(r),l=await new XE(o).toPromise();return l===void 0?null:l.value}function qW(s,r){const o=Zb(s,!0).delete(r);return new XE(o).toPromise()}const Nge=800,xge=3;class SK{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await FO(),this.db)}async _withRetries(r){let o=0;for(;;)try{const l=await this._openDb();return await r(l)}catch(l){if(o++>xge)throw l;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return EK()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=$b._getInstance(wge()),this.receiver._subscribe("keyChanged",async(r,o)=>({keyProcessed:(await this._poll()).includes(o.key)})),this.receiver._subscribe("ping",async(r,o)=>["keyChanged"])}async initializeSender(){var r,o;if(this.activeServiceWorker=await bge(),!this.activeServiceWorker)return;this.sender=new Sge(this.activeServiceWorker);const l=await this.sender._send("ping",{},800);l&&!((r=l[0])===null||r===void 0)&&r.fulfilled&&!((o=l[0])===null||o===void 0)&&o.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(r){if(!(!this.sender||!this.activeServiceWorker||Rge()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:r},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const r=await FO();return await KW(r,ub,"1"),await qW(r,ub),!0}catch{}return!1}async _withPendingWrite(r){this.pendingWrites++;try{await r()}finally{this.pendingWrites--}}async _set(r,o){return this._withPendingWrite(async()=>(await this._withRetries(l=>KW(l,r,o)),this.localCache[r]=o,this.notifyServiceWorker(r)))}async _get(r){const o=await this._withRetries(l=>Age(l,r));return this.localCache[r]=o,o}async _remove(r){return this._withPendingWrite(async()=>(await this._withRetries(o=>qW(o,r)),delete this.localCache[r],this.notifyServiceWorker(r)))}async _poll(){const r=await this._withRetries(u=>{const f=Zb(u,!1).getAll();return new XE(f).toPromise()});if(!r)return[];if(this.pendingWrites!==0)return[];const o=[],l=new Set;if(r.length!==0)for(const{fbase_key:u,value:f}of r)l.add(u),JSON.stringify(this.localCache[u])!==JSON.stringify(f)&&(this.notifyListeners(u,f),o.push(u));for(const u of Object.keys(this.localCache))this.localCache[u]&&!l.has(u)&&(this.notifyListeners(u,null),o.push(u));return o}notifyListeners(r,o){this.localCache[r]=o;const l=this.listeners[r];if(l)for(const u of Array.from(l))u(o)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Nge)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(r,o){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[r]||(this.listeners[r]=new Set,this._get(r)),this.listeners[r].add(o)}_removeListener(r,o){this.listeners[r]&&(this.listeners[r].delete(o),this.listeners[r].size===0&&delete this.listeners[r]),Object.keys(this.listeners).length===0&&this.stopPolling()}}SK.type="LOCAL";const Oge=SK;new KE(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TK(s,r){return r?dl(r):(Vt(s._popupRedirectResolver,s,"argument-error"),s._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _D extends pD{constructor(r){super("custom","custom"),this.params=r}_getIdTokenResponse(r){return $m(r,this._buildIdpRequest())}_linkToIdToken(r,o){return $m(r,this._buildIdpRequest(o))}_getReauthenticationResolver(r){return $m(r,this._buildIdpRequest())}_buildIdpRequest(r){const o={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return r&&(o.idToken=r),o}}function Pge(s){return hK(s.auth,new _D(s),s.bypassAuthState)}function Dge(s){const{auth:r,user:o}=s;return Vt(o,r,"internal-error"),cge(o,new _D(s),s.bypassAuthState)}async function kge(s){const{auth:r,user:o}=s;return Vt(o,r,"internal-error"),age(o,new _D(s),s.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bK{constructor(r,o,l,u,f=!1){this.auth=r,this.resolver=l,this.user=u,this.bypassAuthState=f,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(o)?o:[o]}execute(){return new Promise(async(r,o)=>{this.pendingPromise={resolve:r,reject:o};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(l){this.reject(l)}})}async onAuthEvent(r){const{urlResponse:o,sessionId:l,postBody:u,tenantId:f,error:E,type:T}=r;if(E){this.reject(E);return}const w={auth:this.auth,requestUri:o,sessionId:l,tenantId:f||void 0,postBody:u||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(T)(w))}catch(A){this.reject(A)}}onError(r){this.reject(r)}getIdpTask(r){switch(r){case"signInViaPopup":case"signInViaRedirect":return Pge;case"linkViaPopup":case"linkViaRedirect":return kge;case"reauthViaPopup":case"reauthViaRedirect":return Dge;default:Zo(this.auth,"internal-error")}}resolve(r){bl(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(r),this.unregisterAndCleanUp()}reject(r){bl(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(r),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lge=new KE(2e3,1e4);async function Mge(s,r,o){if(Da(s.app))return Promise.reject(Ua(s,"operation-not-supported-in-this-environment"));const l=Pl(s);mfe(s,r,fD);const u=TK(l,o);return new yh(l,"signInViaPopup",r,u).executeNotNull()}class yh extends bK{constructor(r,o,l,u,f){super(r,o,u,f),this.provider=l,this.authWindow=null,this.pollId=null,yh.currentPopupAction&&yh.currentPopupAction.cancel(),yh.currentPopupAction=this}async executeNotNull(){const r=await this.execute();return Vt(r,this.auth,"internal-error"),r}async onExecution(){bl(this.filter.length===1,"Popup operations only handle one event");const r=gD();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],r),this.authWindow.associatedEvent=r,this.resolver._originValidation(this.auth).catch(o=>{this.reject(o)}),this.resolver._isIframeWebStorageSupported(this.auth,o=>{o||this.reject(Ua(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var r;return((r=this.authWindow)===null||r===void 0?void 0:r.associatedEvent)||null}cancel(){this.reject(Ua(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,yh.currentPopupAction=null}pollUserCancellation(){const r=()=>{var o,l;if(!((l=(o=this.authWindow)===null||o===void 0?void 0:o.window)===null||l===void 0)&&l.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ua(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(r,Lge.get())};r()}}yh.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uge="pendingRedirect",R0=new Map;class jge extends bK{constructor(r,o,l=!1){super(r,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],o,void 0,l),this.eventId=null}async execute(){let r=R0.get(this.auth._key());if(!r){try{const l=await Vge(this.resolver,this.auth)?await super.execute():null;r=()=>Promise.resolve(l)}catch(o){r=()=>Promise.reject(o)}R0.set(this.auth._key(),r)}return this.bypassAuthState||R0.set(this.auth._key(),()=>Promise.resolve(null)),r()}async onAuthEvent(r){if(r.type==="signInViaRedirect")return super.onAuthEvent(r);if(r.type==="unknown"){this.resolve(null);return}if(r.eventId){const o=await this.auth._redirectUserForId(r.eventId);if(o)return this.user=o,super.onAuthEvent(r);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Vge(s,r){const o=Gge(r),l=Bge(s);if(!await l._isAvailable())return!1;const u=await l._get(o)==="true";return await l._remove(o),u}function Fge(s,r){R0.set(s._key(),r)}function Bge(s){return dl(s._redirectPersistence)}function Gge(s){return b0(Uge,s.config.apiKey,s.name)}async function Wge(s,r,o=!1){if(Da(s.app))return Promise.reject(ml(s));const l=Pl(s),u=TK(l,r),E=await new jge(l,u,o).execute();return E&&!o&&(delete E.user._redirectEventId,await l._persistUserIfCurrent(E.user),await l._setRedirectUser(null,r)),E}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zge=10*60*1e3;class Hge{constructor(r){this.auth=r,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(r){this.consumers.add(r),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,r)&&(this.sendToConsumer(this.queuedRedirectEvent,r),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(r){this.consumers.delete(r)}onEvent(r){if(this.hasEventBeenHandled(r))return!1;let o=!1;return this.consumers.forEach(l=>{this.isEventForConsumer(r,l)&&(o=!0,this.sendToConsumer(r,l),this.saveEventToCache(r))}),this.hasHandledPotentialRedirect||!Kge(r)||(this.hasHandledPotentialRedirect=!0,o||(this.queuedRedirectEvent=r,o=!0)),o}sendToConsumer(r,o){var l;if(r.error&&!RK(r)){const u=((l=r.error.code)===null||l===void 0?void 0:l.split("auth/")[1])||"internal-error";o.onError(Ua(this.auth,u))}else o.onAuthEvent(r)}isEventForConsumer(r,o){const l=o.eventId===null||!!r.eventId&&r.eventId===o.eventId;return o.filter.includes(r.type)&&l}hasEventBeenHandled(r){return Date.now()-this.lastProcessedEventTime>=zge&&this.cachedEventUids.clear(),this.cachedEventUids.has(YW(r))}saveEventToCache(r){this.cachedEventUids.add(YW(r)),this.lastProcessedEventTime=Date.now()}}function YW(s){return[s.type,s.eventId,s.sessionId,s.tenantId].filter(r=>r).join("-")}function RK({type:s,error:r}){return s==="unknown"&&(r==null?void 0:r.code)==="auth/no-auth-event"}function Kge(s){switch(s.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return RK(s);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qge(s,r={}){return Ol(s,"GET","/v1/projects",r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yge=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Xge=/^https?/;async function Jge(s){if(s.config.emulator)return;const{authorizedDomains:r}=await qge(s);for(const o of r)try{if(Qge(o))return}catch{}Zo(s,"unauthorized-domain")}function Qge(s){const r=jO(),{protocol:o,hostname:l}=new URL(r);if(s.startsWith("chrome-extension://")){const E=new URL(s);return E.hostname===""&&l===""?o==="chrome-extension:"&&s.replace("chrome-extension://","")===r.replace("chrome-extension://",""):o==="chrome-extension:"&&E.hostname===l}if(!Xge.test(o))return!1;if(Yge.test(s))return l===s;const u=s.replace(/\./g,"\\.");return new RegExp("^(.+\\."+u+"|"+u+")$","i").test(l)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $ge=new KE(3e4,6e4);function XW(){const s=Cc().___jsl;if(s!=null&&s.H){for(const r of Object.keys(s.H))if(s.H[r].r=s.H[r].r||[],s.H[r].L=s.H[r].L||[],s.H[r].r=[...s.H[r].L],s.CP)for(let o=0;o<s.CP.length;o++)s.CP[o]=null}}function Zge(s){return new Promise((r,o)=>{var l,u,f;function E(){XW(),gapi.load("gapi.iframes",{callback:()=>{r(gapi.iframes.getContext())},ontimeout:()=>{XW(),o(Ua(s,"network-request-failed"))},timeout:$ge.get()})}if(!((u=(l=Cc().gapi)===null||l===void 0?void 0:l.iframes)===null||u===void 0)&&u.Iframe)r(gapi.iframes.getContext());else if(!((f=Cc().gapi)===null||f===void 0)&&f.load)E();else{const T=Gfe("iframefcb");return Cc()[T]=()=>{gapi.load?E():o(Ua(s,"network-request-failed"))},lK(`${Bfe()}?onload=${T}`).catch(w=>o(w))}}).catch(r=>{throw w0=null,r})}let w0=null;function e_e(s){return w0=w0||Zge(s),w0}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t_e=new KE(5e3,15e3),n_e="__/auth/iframe",r_e="emulator/auth/iframe",i_e={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},s_e=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function o_e(s){const r=s.config;Vt(r.authDomain,s,"auth-domain-config-required");const o=r.emulator?dD(r,r_e):`https://${s.config.authDomain}/${n_e}`,l={apiKey:r.apiKey,appName:s.name,v:Wh},u=s_e.get(s.config.apiHost);u&&(l.eid=u);const f=s._getFrameworks();return f.length&&(l.fw=f.join(",")),`${o}?${HE(l).slice(1)}`}async function a_e(s){const r=await e_e(s),o=Cc().gapi;return Vt(o,s,"internal-error"),r.open({where:document.body,url:o_e(s),messageHandlersFilter:o.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:i_e,dontclear:!0},l=>new Promise(async(u,f)=>{await l.restyle({setHideOnLeave:!1});const E=Ua(s,"network-request-failed"),T=Cc().setTimeout(()=>{f(E)},t_e.get());function w(){Cc().clearTimeout(T),u(l)}l.ping(w).then(w,()=>{f(E)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c_e={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},l_e=500,d_e=600,u_e="_blank",h_e="http://localhost";class JW{constructor(r){this.window=r,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function p_e(s,r,o,l=l_e,u=d_e){const f=Math.max((window.screen.availHeight-u)/2,0).toString(),E=Math.max((window.screen.availWidth-l)/2,0).toString();let T="";const w=Object.assign(Object.assign({},c_e),{width:l.toString(),height:u.toString(),top:f,left:E}),A=ps().toLowerCase();o&&(T=nK(A)?u_e:o),eK(A)&&(r=r||h_e,w.scrollbars="yes");const U=Object.entries(w).reduce((F,[Y,J])=>`${F}${Y}=${J},`,"");if(Pfe(A)&&T!=="_self")return m_e(r||"",T),new JW(null);const M=window.open(r||"",T,U);Vt(M,s,"popup-blocked");try{M.focus()}catch{}return new JW(M)}function m_e(s,r){const o=document.createElement("a");o.href=s,o.target=r;const l=document.createEvent("MouseEvent");l.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),o.dispatchEvent(l)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f_e="__/auth/handler",g_e="emulator/auth/handler",__e=encodeURIComponent("fac");async function QW(s,r,o,l,u,f){Vt(s.config.authDomain,s,"auth-domain-config-required"),Vt(s.config.apiKey,s,"invalid-api-key");const E={apiKey:s.config.apiKey,appName:s.name,authType:o,redirectUrl:l,v:Wh,eventId:u};if(r instanceof fD){r.setDefaultLanguage(s.languageCode),E.providerId=r.providerId||"",tme(r.getCustomParameters())||(E.customParameters=JSON.stringify(r.getCustomParameters()));for(const[U,M]of Object.entries({}))E[U]=M}if(r instanceof YE){const U=r.getScopes().filter(M=>M!=="");U.length>0&&(E.scopes=U.join(","))}s.tenantId&&(E.tid=s.tenantId);const T=E;for(const U of Object.keys(T))T[U]===void 0&&delete T[U];const w=await s._getAppCheckToken(),A=w?`#${__e}=${encodeURIComponent(w)}`:"";return`${E_e(s)}?${HE(T).slice(1)}${A}`}function E_e({config:s}){return s.emulator?dD(s,g_e):`https://${s.authDomain}/${f_e}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bx="webStorageSupport";class v_e{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=_K,this._completeRedirectFn=Wge,this._overrideRedirectResult=Fge}async _openPopup(r,o,l,u){var f;bl((f=this.eventManagers[r._key()])===null||f===void 0?void 0:f.manager,"_initialize() not called before _openPopup()");const E=await QW(r,o,l,jO(),u);return p_e(r,E,gD())}async _openRedirect(r,o,l,u){await this._originValidation(r);const f=await QW(r,o,l,jO(),u);return Tge(f),new Promise(()=>{})}_initialize(r){const o=r._key();if(this.eventManagers[o]){const{manager:u,promise:f}=this.eventManagers[o];return u?Promise.resolve(u):(bl(f,"If manager is not set, promise should be"),f)}const l=this.initAndGetManager(r);return this.eventManagers[o]={promise:l},l.catch(()=>{delete this.eventManagers[o]}),l}async initAndGetManager(r){const o=await a_e(r),l=new Hge(r);return o.register("authEvent",u=>(Vt(u==null?void 0:u.authEvent,r,"invalid-auth-event"),{status:l.onEvent(u.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[r._key()]={manager:l},this.iframes[r._key()]=o,l}_isIframeWebStorageSupported(r,o){this.iframes[r._key()].send(bx,{type:bx},u=>{var f;const E=(f=u==null?void 0:u[0])===null||f===void 0?void 0:f[bx];E!==void 0&&o(!!E),Zo(r,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(r){const o=r._key();return this.originValidationPromises[o]||(this.originValidationPromises[o]=Jge(r)),this.originValidationPromises[o]}get _shouldInitProactively(){return aK()||tK()||hD()}}const y_e=v_e;var $W="@firebase/auth",ZW="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S_e{constructor(r){this.auth=r,this.internalListeners=new Map}getUid(){var r;return this.assertAuthConfigured(),((r=this.auth.currentUser)===null||r===void 0?void 0:r.uid)||null}async getToken(r){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(r)}:null}addAuthTokenListener(r){if(this.assertAuthConfigured(),this.internalListeners.has(r))return;const o=this.auth.onIdTokenChanged(l=>{r((l==null?void 0:l.stsTokenManager.accessToken)||null)});this.internalListeners.set(r,o),this.updateProactiveRefresh()}removeAuthTokenListener(r){this.assertAuthConfigured();const o=this.internalListeners.get(r);o&&(this.internalListeners.delete(r),o(),this.updateProactiveRefresh())}assertAuthConfigured(){Vt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T_e(s){switch(s){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function b_e(s){Lh(new Jd("auth",(r,{options:o})=>{const l=r.getProvider("app").getImmediate(),u=r.getProvider("heartbeat"),f=r.getProvider("app-check-internal"),{apiKey:E,authDomain:T}=l.options;Vt(E&&!E.includes(":"),"invalid-api-key",{appName:l.name});const w={apiKey:E,authDomain:T,clientPlatform:s,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:cK(s)},A=new jfe(l,u,f,w);return qfe(A,o),A},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((r,o,l)=>{r.getProvider("auth-internal").initialize()})),Lh(new Jd("auth-internal",r=>{const o=Pl(r.getProvider("auth").getImmediate());return(l=>new S_e(l))(o)},"PRIVATE").setInstantiationMode("EXPLICIT")),wc($W,ZW,T_e(s)),wc($W,ZW,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R_e=5*60,w_e=V9("authIdTokenMaxAge")||R_e;let ez=null;const C_e=s=>async r=>{const o=r&&await r.getIdTokenResult(),l=o&&(new Date().getTime()-Date.parse(o.issuedAtTime))/1e3;if(l&&l>w_e)return;const u=o==null?void 0:o.token;ez!==u&&(ez=u,await fetch(s,{method:u?"POST":"DELETE",headers:u?{Authorization:`Bearer ${u}`}:{}}))};function I_e(s=oD()){const r=Jb(s,"auth");if(r.isInitialized())return r.getImmediate();const o=Kfe(s,{popupRedirectResolver:y_e,persistence:[Oge,vge,_K]}),l=V9("authTokenSyncURL");if(l&&typeof isSecureContext=="boolean"&&isSecureContext){const f=new URL(l,location.origin);if(location.origin===f.origin){const E=C_e(f.toString());mge(o,E,()=>E(o.currentUser)),pge(o,T=>E(T))}}const u=M9("auth");return u&&Yfe(o,`http://${u}`),o}function A_e(){var s,r;return(r=(s=document.getElementsByTagName("head"))===null||s===void 0?void 0:s[0])!==null&&r!==void 0?r:document}Vfe({loadJS(s){return new Promise((r,o)=>{const l=document.createElement("script");l.setAttribute("src",s),l.onload=r,l.onerror=u=>{const f=Ua("internal-error");f.customData=u,o(f)},l.type="text/javascript",l.charset="UTF-8",A_e().appendChild(l)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});b_e("Browser");var tz=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ch,wK;(function(){var s;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function r(te,q){function re(){}re.prototype=q.prototype,te.D=q.prototype,te.prototype=new re,te.prototype.constructor=te,te.C=function($,le,ue){for(var ie=Array(arguments.length-2),tt=2;tt<arguments.length;tt++)ie[tt-2]=arguments[tt];return q.prototype[le].apply($,ie)}}function o(){this.blockSize=-1}function l(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}r(l,o),l.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function u(te,q,re){re||(re=0);var $=Array(16);if(typeof q=="string")for(var le=0;16>le;++le)$[le]=q.charCodeAt(re++)|q.charCodeAt(re++)<<8|q.charCodeAt(re++)<<16|q.charCodeAt(re++)<<24;else for(le=0;16>le;++le)$[le]=q[re++]|q[re++]<<8|q[re++]<<16|q[re++]<<24;q=te.g[0],re=te.g[1],le=te.g[2];var ue=te.g[3],ie=q+(ue^re&(le^ue))+$[0]+3614090360&4294967295;q=re+(ie<<7&4294967295|ie>>>25),ie=ue+(le^q&(re^le))+$[1]+3905402710&4294967295,ue=q+(ie<<12&4294967295|ie>>>20),ie=le+(re^ue&(q^re))+$[2]+606105819&4294967295,le=ue+(ie<<17&4294967295|ie>>>15),ie=re+(q^le&(ue^q))+$[3]+3250441966&4294967295,re=le+(ie<<22&4294967295|ie>>>10),ie=q+(ue^re&(le^ue))+$[4]+4118548399&4294967295,q=re+(ie<<7&4294967295|ie>>>25),ie=ue+(le^q&(re^le))+$[5]+1200080426&4294967295,ue=q+(ie<<12&4294967295|ie>>>20),ie=le+(re^ue&(q^re))+$[6]+2821735955&4294967295,le=ue+(ie<<17&4294967295|ie>>>15),ie=re+(q^le&(ue^q))+$[7]+4249261313&4294967295,re=le+(ie<<22&4294967295|ie>>>10),ie=q+(ue^re&(le^ue))+$[8]+1770035416&4294967295,q=re+(ie<<7&4294967295|ie>>>25),ie=ue+(le^q&(re^le))+$[9]+2336552879&4294967295,ue=q+(ie<<12&4294967295|ie>>>20),ie=le+(re^ue&(q^re))+$[10]+4294925233&4294967295,le=ue+(ie<<17&4294967295|ie>>>15),ie=re+(q^le&(ue^q))+$[11]+2304563134&4294967295,re=le+(ie<<22&4294967295|ie>>>10),ie=q+(ue^re&(le^ue))+$[12]+1804603682&4294967295,q=re+(ie<<7&4294967295|ie>>>25),ie=ue+(le^q&(re^le))+$[13]+4254626195&4294967295,ue=q+(ie<<12&4294967295|ie>>>20),ie=le+(re^ue&(q^re))+$[14]+2792965006&4294967295,le=ue+(ie<<17&4294967295|ie>>>15),ie=re+(q^le&(ue^q))+$[15]+1236535329&4294967295,re=le+(ie<<22&4294967295|ie>>>10),ie=q+(le^ue&(re^le))+$[1]+4129170786&4294967295,q=re+(ie<<5&4294967295|ie>>>27),ie=ue+(re^le&(q^re))+$[6]+3225465664&4294967295,ue=q+(ie<<9&4294967295|ie>>>23),ie=le+(q^re&(ue^q))+$[11]+643717713&4294967295,le=ue+(ie<<14&4294967295|ie>>>18),ie=re+(ue^q&(le^ue))+$[0]+3921069994&4294967295,re=le+(ie<<20&4294967295|ie>>>12),ie=q+(le^ue&(re^le))+$[5]+3593408605&4294967295,q=re+(ie<<5&4294967295|ie>>>27),ie=ue+(re^le&(q^re))+$[10]+38016083&4294967295,ue=q+(ie<<9&4294967295|ie>>>23),ie=le+(q^re&(ue^q))+$[15]+3634488961&4294967295,le=ue+(ie<<14&4294967295|ie>>>18),ie=re+(ue^q&(le^ue))+$[4]+3889429448&4294967295,re=le+(ie<<20&4294967295|ie>>>12),ie=q+(le^ue&(re^le))+$[9]+568446438&4294967295,q=re+(ie<<5&4294967295|ie>>>27),ie=ue+(re^le&(q^re))+$[14]+3275163606&4294967295,ue=q+(ie<<9&4294967295|ie>>>23),ie=le+(q^re&(ue^q))+$[3]+4107603335&4294967295,le=ue+(ie<<14&4294967295|ie>>>18),ie=re+(ue^q&(le^ue))+$[8]+1163531501&4294967295,re=le+(ie<<20&4294967295|ie>>>12),ie=q+(le^ue&(re^le))+$[13]+2850285829&4294967295,q=re+(ie<<5&4294967295|ie>>>27),ie=ue+(re^le&(q^re))+$[2]+4243563512&4294967295,ue=q+(ie<<9&4294967295|ie>>>23),ie=le+(q^re&(ue^q))+$[7]+1735328473&4294967295,le=ue+(ie<<14&4294967295|ie>>>18),ie=re+(ue^q&(le^ue))+$[12]+2368359562&4294967295,re=le+(ie<<20&4294967295|ie>>>12),ie=q+(re^le^ue)+$[5]+4294588738&4294967295,q=re+(ie<<4&4294967295|ie>>>28),ie=ue+(q^re^le)+$[8]+2272392833&4294967295,ue=q+(ie<<11&4294967295|ie>>>21),ie=le+(ue^q^re)+$[11]+1839030562&4294967295,le=ue+(ie<<16&4294967295|ie>>>16),ie=re+(le^ue^q)+$[14]+4259657740&4294967295,re=le+(ie<<23&4294967295|ie>>>9),ie=q+(re^le^ue)+$[1]+2763975236&4294967295,q=re+(ie<<4&4294967295|ie>>>28),ie=ue+(q^re^le)+$[4]+1272893353&4294967295,ue=q+(ie<<11&4294967295|ie>>>21),ie=le+(ue^q^re)+$[7]+4139469664&4294967295,le=ue+(ie<<16&4294967295|ie>>>16),ie=re+(le^ue^q)+$[10]+3200236656&4294967295,re=le+(ie<<23&4294967295|ie>>>9),ie=q+(re^le^ue)+$[13]+681279174&4294967295,q=re+(ie<<4&4294967295|ie>>>28),ie=ue+(q^re^le)+$[0]+3936430074&4294967295,ue=q+(ie<<11&4294967295|ie>>>21),ie=le+(ue^q^re)+$[3]+3572445317&4294967295,le=ue+(ie<<16&4294967295|ie>>>16),ie=re+(le^ue^q)+$[6]+76029189&4294967295,re=le+(ie<<23&4294967295|ie>>>9),ie=q+(re^le^ue)+$[9]+3654602809&4294967295,q=re+(ie<<4&4294967295|ie>>>28),ie=ue+(q^re^le)+$[12]+3873151461&4294967295,ue=q+(ie<<11&4294967295|ie>>>21),ie=le+(ue^q^re)+$[15]+530742520&4294967295,le=ue+(ie<<16&4294967295|ie>>>16),ie=re+(le^ue^q)+$[2]+3299628645&4294967295,re=le+(ie<<23&4294967295|ie>>>9),ie=q+(le^(re|~ue))+$[0]+4096336452&4294967295,q=re+(ie<<6&4294967295|ie>>>26),ie=ue+(re^(q|~le))+$[7]+1126891415&4294967295,ue=q+(ie<<10&4294967295|ie>>>22),ie=le+(q^(ue|~re))+$[14]+2878612391&4294967295,le=ue+(ie<<15&4294967295|ie>>>17),ie=re+(ue^(le|~q))+$[5]+4237533241&4294967295,re=le+(ie<<21&4294967295|ie>>>11),ie=q+(le^(re|~ue))+$[12]+1700485571&4294967295,q=re+(ie<<6&4294967295|ie>>>26),ie=ue+(re^(q|~le))+$[3]+2399980690&4294967295,ue=q+(ie<<10&4294967295|ie>>>22),ie=le+(q^(ue|~re))+$[10]+4293915773&4294967295,le=ue+(ie<<15&4294967295|ie>>>17),ie=re+(ue^(le|~q))+$[1]+2240044497&4294967295,re=le+(ie<<21&4294967295|ie>>>11),ie=q+(le^(re|~ue))+$[8]+1873313359&4294967295,q=re+(ie<<6&4294967295|ie>>>26),ie=ue+(re^(q|~le))+$[15]+4264355552&4294967295,ue=q+(ie<<10&4294967295|ie>>>22),ie=le+(q^(ue|~re))+$[6]+2734768916&4294967295,le=ue+(ie<<15&4294967295|ie>>>17),ie=re+(ue^(le|~q))+$[13]+1309151649&4294967295,re=le+(ie<<21&4294967295|ie>>>11),ie=q+(le^(re|~ue))+$[4]+4149444226&4294967295,q=re+(ie<<6&4294967295|ie>>>26),ie=ue+(re^(q|~le))+$[11]+3174756917&4294967295,ue=q+(ie<<10&4294967295|ie>>>22),ie=le+(q^(ue|~re))+$[2]+718787259&4294967295,le=ue+(ie<<15&4294967295|ie>>>17),ie=re+(ue^(le|~q))+$[9]+3951481745&4294967295,te.g[0]=te.g[0]+q&4294967295,te.g[1]=te.g[1]+(le+(ie<<21&4294967295|ie>>>11))&4294967295,te.g[2]=te.g[2]+le&4294967295,te.g[3]=te.g[3]+ue&4294967295}l.prototype.u=function(te,q){q===void 0&&(q=te.length);for(var re=q-this.blockSize,$=this.B,le=this.h,ue=0;ue<q;){if(le==0)for(;ue<=re;)u(this,te,ue),ue+=this.blockSize;if(typeof te=="string"){for(;ue<q;)if($[le++]=te.charCodeAt(ue++),le==this.blockSize){u(this,$),le=0;break}}else for(;ue<q;)if($[le++]=te[ue++],le==this.blockSize){u(this,$),le=0;break}}this.h=le,this.o+=q},l.prototype.v=function(){var te=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);te[0]=128;for(var q=1;q<te.length-8;++q)te[q]=0;var re=8*this.o;for(q=te.length-8;q<te.length;++q)te[q]=re&255,re/=256;for(this.u(te),te=Array(16),q=re=0;4>q;++q)for(var $=0;32>$;$+=8)te[re++]=this.g[q]>>>$&255;return te};function f(te,q){var re=T;return Object.prototype.hasOwnProperty.call(re,te)?re[te]:re[te]=q(te)}function E(te,q){this.h=q;for(var re=[],$=!0,le=te.length-1;0<=le;le--){var ue=te[le]|0;$&&ue==q||(re[le]=ue,$=!1)}this.g=re}var T={};function w(te){return-128<=te&&128>te?f(te,function(q){return new E([q|0],0>q?-1:0)}):new E([te|0],0>te?-1:0)}function A(te){if(isNaN(te)||!isFinite(te))return M;if(0>te)return he(A(-te));for(var q=[],re=1,$=0;te>=re;$++)q[$]=te/re|0,re*=4294967296;return new E(q,0)}function U(te,q){if(te.length==0)throw Error("number format error: empty string");if(q=q||10,2>q||36<q)throw Error("radix out of range: "+q);if(te.charAt(0)=="-")return he(U(te.substring(1),q));if(0<=te.indexOf("-"))throw Error('number format error: interior "-" character');for(var re=A(Math.pow(q,8)),$=M,le=0;le<te.length;le+=8){var ue=Math.min(8,te.length-le),ie=parseInt(te.substring(le,le+ue),q);8>ue?(ue=A(Math.pow(q,ue)),$=$.j(ue).add(A(ie))):($=$.j(re),$=$.add(A(ie)))}return $}var M=w(0),F=w(1),Y=w(16777216);s=E.prototype,s.m=function(){if(ae(this))return-he(this).m();for(var te=0,q=1,re=0;re<this.g.length;re++){var $=this.i(re);te+=(0<=$?$:4294967296+$)*q,q*=4294967296}return te},s.toString=function(te){if(te=te||10,2>te||36<te)throw Error("radix out of range: "+te);if(J(this))return"0";if(ae(this))return"-"+he(this).toString(te);for(var q=A(Math.pow(te,6)),re=this,$="";;){var le=fe(re,q).g;re=ee(re,le.j(q));var ue=((0<re.g.length?re.g[0]:re.h)>>>0).toString(te);if(re=le,J(re))return ue+$;for(;6>ue.length;)ue="0"+ue;$=ue+$}},s.i=function(te){return 0>te?0:te<this.g.length?this.g[te]:this.h};function J(te){if(te.h!=0)return!1;for(var q=0;q<te.g.length;q++)if(te.g[q]!=0)return!1;return!0}function ae(te){return te.h==-1}s.l=function(te){return te=ee(this,te),ae(te)?-1:J(te)?0:1};function he(te){for(var q=te.g.length,re=[],$=0;$<q;$++)re[$]=~te.g[$];return new E(re,~te.h).add(F)}s.abs=function(){return ae(this)?he(this):this},s.add=function(te){for(var q=Math.max(this.g.length,te.g.length),re=[],$=0,le=0;le<=q;le++){var ue=$+(this.i(le)&65535)+(te.i(le)&65535),ie=(ue>>>16)+(this.i(le)>>>16)+(te.i(le)>>>16);$=ie>>>16,ue&=65535,ie&=65535,re[le]=ie<<16|ue}return new E(re,re[re.length-1]&-2147483648?-1:0)};function ee(te,q){return te.add(he(q))}s.j=function(te){if(J(this)||J(te))return M;if(ae(this))return ae(te)?he(this).j(he(te)):he(he(this).j(te));if(ae(te))return he(this.j(he(te)));if(0>this.l(Y)&&0>te.l(Y))return A(this.m()*te.m());for(var q=this.g.length+te.g.length,re=[],$=0;$<2*q;$++)re[$]=0;for($=0;$<this.g.length;$++)for(var le=0;le<te.g.length;le++){var ue=this.i($)>>>16,ie=this.i($)&65535,tt=te.i(le)>>>16,Ot=te.i(le)&65535;re[2*$+2*le]+=ie*Ot,W(re,2*$+2*le),re[2*$+2*le+1]+=ue*Ot,W(re,2*$+2*le+1),re[2*$+2*le+1]+=ie*tt,W(re,2*$+2*le+1),re[2*$+2*le+2]+=ue*tt,W(re,2*$+2*le+2)}for($=0;$<q;$++)re[$]=re[2*$+1]<<16|re[2*$];for($=q;$<2*q;$++)re[$]=0;return new E(re,0)};function W(te,q){for(;(te[q]&65535)!=te[q];)te[q+1]+=te[q]>>>16,te[q]&=65535,q++}function Z(te,q){this.g=te,this.h=q}function fe(te,q){if(J(q))throw Error("division by zero");if(J(te))return new Z(M,M);if(ae(te))return q=fe(he(te),q),new Z(he(q.g),he(q.h));if(ae(q))return q=fe(te,he(q)),new Z(he(q.g),q.h);if(30<te.g.length){if(ae(te)||ae(q))throw Error("slowDivide_ only works with positive integers.");for(var re=F,$=q;0>=$.l(te);)re=pe(re),$=pe($);var le=Ce(re,1),ue=Ce($,1);for($=Ce($,2),re=Ce(re,2);!J($);){var ie=ue.add($);0>=ie.l(te)&&(le=le.add(re),ue=ie),$=Ce($,1),re=Ce(re,1)}return q=ee(te,le.j(q)),new Z(le,q)}for(le=M;0<=te.l(q);){for(re=Math.max(1,Math.floor(te.m()/q.m())),$=Math.ceil(Math.log(re)/Math.LN2),$=48>=$?1:Math.pow(2,$-48),ue=A(re),ie=ue.j(q);ae(ie)||0<ie.l(te);)re-=$,ue=A(re),ie=ue.j(q);J(ue)&&(ue=F),le=le.add(ue),te=ee(te,ie)}return new Z(le,te)}s.A=function(te){return fe(this,te).h},s.and=function(te){for(var q=Math.max(this.g.length,te.g.length),re=[],$=0;$<q;$++)re[$]=this.i($)&te.i($);return new E(re,this.h&te.h)},s.or=function(te){for(var q=Math.max(this.g.length,te.g.length),re=[],$=0;$<q;$++)re[$]=this.i($)|te.i($);return new E(re,this.h|te.h)},s.xor=function(te){for(var q=Math.max(this.g.length,te.g.length),re=[],$=0;$<q;$++)re[$]=this.i($)^te.i($);return new E(re,this.h^te.h)};function pe(te){for(var q=te.g.length+1,re=[],$=0;$<q;$++)re[$]=te.i($)<<1|te.i($-1)>>>31;return new E(re,te.h)}function Ce(te,q){var re=q>>5;q%=32;for(var $=te.g.length-re,le=[],ue=0;ue<$;ue++)le[ue]=0<q?te.i(ue+re)>>>q|te.i(ue+re+1)<<32-q:te.i(ue+re);return new E(le,te.h)}l.prototype.digest=l.prototype.v,l.prototype.reset=l.prototype.s,l.prototype.update=l.prototype.u,wK=l,E.prototype.add=E.prototype.add,E.prototype.multiply=E.prototype.j,E.prototype.modulo=E.prototype.A,E.prototype.compare=E.prototype.l,E.prototype.toNumber=E.prototype.m,E.prototype.toString=E.prototype.toString,E.prototype.getBits=E.prototype.i,E.fromNumber=A,E.fromString=U,Ch=E}).apply(typeof tz<"u"?tz:typeof self<"u"?self:typeof window<"u"?window:{});var s0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var CK,V_,IK,C0,BO,AK,NK,xK;(function(){var s,r=typeof Object.defineProperties=="function"?Object.defineProperty:function(S,P,V){return S==Array.prototype||S==Object.prototype||(S[P]=V.value),S};function o(S){S=[typeof globalThis=="object"&&globalThis,S,typeof window=="object"&&window,typeof self=="object"&&self,typeof s0=="object"&&s0];for(var P=0;P<S.length;++P){var V=S[P];if(V&&V.Math==Math)return V}throw Error("Cannot find global object")}var l=o(this);function u(S,P){if(P)e:{var V=l;S=S.split(".");for(var Q=0;Q<S.length-1;Q++){var Te=S[Q];if(!(Te in V))break e;V=V[Te]}S=S[S.length-1],Q=V[S],P=P(Q),P!=Q&&P!=null&&r(V,S,{configurable:!0,writable:!0,value:P})}}function f(S,P){S instanceof String&&(S+="");var V=0,Q=!1,Te={next:function(){if(!Q&&V<S.length){var Ne=V++;return{value:P(Ne,S[Ne]),done:!1}}return Q=!0,{done:!0,value:void 0}}};return Te[Symbol.iterator]=function(){return Te},Te}u("Array.prototype.values",function(S){return S||function(){return f(this,function(P,V){return V})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var E=E||{},T=this||self;function w(S){var P=typeof S;return P=P!="object"?P:S?Array.isArray(S)?"array":P:"null",P=="array"||P=="object"&&typeof S.length=="number"}function A(S){var P=typeof S;return P=="object"&&S!=null||P=="function"}function U(S,P,V){return S.call.apply(S.bind,arguments)}function M(S,P,V){if(!S)throw Error();if(2<arguments.length){var Q=Array.prototype.slice.call(arguments,2);return function(){var Te=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Te,Q),S.apply(P,Te)}}return function(){return S.apply(P,arguments)}}function F(S,P,V){return F=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?U:M,F.apply(null,arguments)}function Y(S,P){var V=Array.prototype.slice.call(arguments,1);return function(){var Q=V.slice();return Q.push.apply(Q,arguments),S.apply(this,Q)}}function J(S,P){function V(){}V.prototype=P.prototype,S.aa=P.prototype,S.prototype=new V,S.prototype.constructor=S,S.Qb=function(Q,Te,Ne){for(var Ye=Array(arguments.length-2),Vn=2;Vn<arguments.length;Vn++)Ye[Vn-2]=arguments[Vn];return P.prototype[Te].apply(Q,Ye)}}function ae(S){const P=S.length;if(0<P){const V=Array(P);for(let Q=0;Q<P;Q++)V[Q]=S[Q];return V}return[]}function he(S,P){for(let V=1;V<arguments.length;V++){const Q=arguments[V];if(w(Q)){const Te=S.length||0,Ne=Q.length||0;S.length=Te+Ne;for(let Ye=0;Ye<Ne;Ye++)S[Te+Ye]=Q[Ye]}else S.push(Q)}}class ee{constructor(P,V){this.i=P,this.j=V,this.h=0,this.g=null}get(){let P;return 0<this.h?(this.h--,P=this.g,this.g=P.next,P.next=null):P=this.i(),P}}function W(S){return/^[\s\xa0]*$/.test(S)}function Z(){var S=T.navigator;return S&&(S=S.userAgent)?S:""}function fe(S){return fe[" "](S),S}fe[" "]=function(){};var pe=Z().indexOf("Gecko")!=-1&&!(Z().toLowerCase().indexOf("webkit")!=-1&&Z().indexOf("Edge")==-1)&&!(Z().indexOf("Trident")!=-1||Z().indexOf("MSIE")!=-1)&&Z().indexOf("Edge")==-1;function Ce(S,P,V){for(const Q in S)P.call(V,S[Q],Q,S)}function te(S,P){for(const V in S)P.call(void 0,S[V],V,S)}function q(S){const P={};for(const V in S)P[V]=S[V];return P}const re="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function $(S,P){let V,Q;for(let Te=1;Te<arguments.length;Te++){Q=arguments[Te];for(V in Q)S[V]=Q[V];for(let Ne=0;Ne<re.length;Ne++)V=re[Ne],Object.prototype.hasOwnProperty.call(Q,V)&&(S[V]=Q[V])}}function le(S){var P=1;S=S.split(":");const V=[];for(;0<P&&S.length;)V.push(S.shift()),P--;return S.length&&V.push(S.join(":")),V}function ue(S){T.setTimeout(()=>{throw S},0)}function ie(){var S=nt;let P=null;return S.g&&(P=S.g,S.g=S.g.next,S.g||(S.h=null),P.next=null),P}class tt{constructor(){this.h=this.g=null}add(P,V){const Q=Ot.get();Q.set(P,V),this.h?this.h.next=Q:this.g=Q,this.h=Q}}var Ot=new ee(()=>new on,S=>S.reset());class on{constructor(){this.next=this.g=this.h=null}set(P,V){this.h=P,this.g=V,this.next=null}reset(){this.next=this.g=this.h=null}}let It,Ge=!1,nt=new tt,pt=()=>{const S=T.Promise.resolve(void 0);It=()=>{S.then(ot)}};var ot=()=>{for(var S;S=ie();){try{S.h.call(S.g)}catch(V){ue(V)}var P=Ot;P.j(S),100>P.h&&(P.h++,S.next=P.g,P.g=S)}Ge=!1};function Et(){this.s=this.s,this.C=this.C}Et.prototype.s=!1,Et.prototype.ma=function(){this.s||(this.s=!0,this.N())},Et.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function un(S,P){this.type=S,this.g=this.target=P,this.defaultPrevented=!1}un.prototype.h=function(){this.defaultPrevented=!0};var In=function(){if(!T.addEventListener||!Object.defineProperty)return!1;var S=!1,P=Object.defineProperty({},"passive",{get:function(){S=!0}});try{const V=()=>{};T.addEventListener("test",V,P),T.removeEventListener("test",V,P)}catch{}return S}();function zn(S,P){if(un.call(this,S?S.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,S){var V=this.type=S.type,Q=S.changedTouches&&S.changedTouches.length?S.changedTouches[0]:null;if(this.target=S.target||S.srcElement,this.g=P,P=S.relatedTarget){if(pe){e:{try{fe(P.nodeName);var Te=!0;break e}catch{}Te=!1}Te||(P=null)}}else V=="mouseover"?P=S.fromElement:V=="mouseout"&&(P=S.toElement);this.relatedTarget=P,Q?(this.clientX=Q.clientX!==void 0?Q.clientX:Q.pageX,this.clientY=Q.clientY!==void 0?Q.clientY:Q.pageY,this.screenX=Q.screenX||0,this.screenY=Q.screenY||0):(this.clientX=S.clientX!==void 0?S.clientX:S.pageX,this.clientY=S.clientY!==void 0?S.clientY:S.pageY,this.screenX=S.screenX||0,this.screenY=S.screenY||0),this.button=S.button,this.key=S.key||"",this.ctrlKey=S.ctrlKey,this.altKey=S.altKey,this.shiftKey=S.shiftKey,this.metaKey=S.metaKey,this.pointerId=S.pointerId||0,this.pointerType=typeof S.pointerType=="string"?S.pointerType:Sr[S.pointerType]||"",this.state=S.state,this.i=S,S.defaultPrevented&&zn.aa.h.call(this)}}J(zn,un);var Sr={2:"touch",3:"pen",4:"mouse"};zn.prototype.h=function(){zn.aa.h.call(this);var S=this.i;S.preventDefault?S.preventDefault():S.returnValue=!1};var Je="closure_listenable_"+(1e6*Math.random()|0),Kt=0;function lr(S,P,V,Q,Te){this.listener=S,this.proxy=null,this.src=P,this.type=V,this.capture=!!Q,this.ha=Te,this.key=++Kt,this.da=this.fa=!1}function Qn(S){S.da=!0,S.listener=null,S.proxy=null,S.src=null,S.ha=null}function ms(S){this.src=S,this.g={},this.h=0}ms.prototype.add=function(S,P,V,Q,Te){var Ne=S.toString();S=this.g[Ne],S||(S=this.g[Ne]=[],this.h++);var Ye=$n(S,P,Q,Te);return-1<Ye?(P=S[Ye],V||(P.fa=!1)):(P=new lr(P,this.src,Ne,!!Q,Te),P.fa=V,S.push(P)),P};function it(S,P){var V=P.type;if(V in S.g){var Q=S.g[V],Te=Array.prototype.indexOf.call(Q,P,void 0),Ne;(Ne=0<=Te)&&Array.prototype.splice.call(Q,Te,1),Ne&&(Qn(P),S.g[V].length==0&&(delete S.g[V],S.h--))}}function $n(S,P,V,Q){for(var Te=0;Te<S.length;++Te){var Ne=S[Te];if(!Ne.da&&Ne.listener==P&&Ne.capture==!!V&&Ne.ha==Q)return Te}return-1}var $s="closure_lm_"+(1e6*Math.random()|0),xe={};function _t(S,P,V,Q,Te){if(Array.isArray(P)){for(var Ne=0;Ne<P.length;Ne++)_t(S,P[Ne],V,Q,Te);return null}return V=Pf(V),S&&S[Je]?S.K(P,V,A(Q)?!!Q.capture:!1,Te):Ln(S,P,V,!1,Q,Te)}function Ln(S,P,V,Q,Te,Ne){if(!P)throw Error("Invalid event type");var Ye=A(Te)?!!Te.capture:!!Te,Vn=fs(S);if(Vn||(S[$s]=Vn=new ms(S)),V=Vn.add(P,V,Q,Ye,Ne),V.proxy)return V;if(Q=kt(),V.proxy=Q,Q.src=S,Q.listener=V,S.addEventListener)In||(Te=Ye),Te===void 0&&(Te=!1),S.addEventListener(P.toString(),Q,Te);else if(S.attachEvent)S.attachEvent(ki(P.toString()),Q);else if(S.addListener&&S.removeListener)S.addListener(Q);else throw Error("addEventListener and attachEvent are unavailable.");return V}function kt(){function S(V){return P.call(S.src,S.listener,V)}const P=di;return S}function qt(S,P,V,Q,Te){if(Array.isArray(P))for(var Ne=0;Ne<P.length;Ne++)qt(S,P[Ne],V,Q,Te);else Q=A(Q)?!!Q.capture:!!Q,V=Pf(V),S&&S[Je]?(S=S.i,P=String(P).toString(),P in S.g&&(Ne=S.g[P],V=$n(Ne,V,Q,Te),-1<V&&(Qn(Ne[V]),Array.prototype.splice.call(Ne,V,1),Ne.length==0&&(delete S.g[P],S.h--)))):S&&(S=fs(S))&&(P=S.g[P.toString()],S=-1,P&&(S=$n(P,V,Q,Te)),(V=-1<S?P[S]:null)&&Rt(V))}function Rt(S){if(typeof S!="number"&&S&&!S.da){var P=S.src;if(P&&P[Je])it(P.i,S);else{var V=S.type,Q=S.proxy;P.removeEventListener?P.removeEventListener(V,Q,S.capture):P.detachEvent?P.detachEvent(ki(V),Q):P.addListener&&P.removeListener&&P.removeListener(Q),(V=fs(P))?(it(V,S),V.h==0&&(V.src=null,P[$s]=null)):Qn(S)}}}function ki(S){return S in xe?xe[S]:xe[S]="on"+S}function di(S,P){if(S.da)S=!0;else{P=new zn(P,this);var V=S.listener,Q=S.ha||S.src;S.fa&&Rt(S),S=V.call(Q,P)}return S}function fs(S){return S=S[$s],S instanceof ms?S:null}var Tr="__closure_events_fn_"+(1e9*Math.random()>>>0);function Pf(S){return typeof S=="function"?S:(S[Tr]||(S[Tr]=function(P){return S.handleEvent(P)}),S[Tr])}function ui(){Et.call(this),this.i=new ms(this),this.M=this,this.F=null}J(ui,Et),ui.prototype[Je]=!0,ui.prototype.removeEventListener=function(S,P,V,Q){qt(this,S,P,V,Q)};function ur(S,P){var V,Q=S.F;if(Q)for(V=[];Q;Q=Q.F)V.push(Q);if(S=S.M,Q=P.type||P,typeof P=="string")P=new un(P,S);else if(P instanceof un)P.target=P.target||S;else{var Te=P;P=new un(Q,S),$(P,Te)}if(Te=!0,V)for(var Ne=V.length-1;0<=Ne;Ne--){var Ye=P.g=V[Ne];Te=cu(Ye,Q,!0,P)&&Te}if(Ye=P.g=S,Te=cu(Ye,Q,!0,P)&&Te,Te=cu(Ye,Q,!1,P)&&Te,V)for(Ne=0;Ne<V.length;Ne++)Ye=P.g=V[Ne],Te=cu(Ye,Q,!1,P)&&Te}ui.prototype.N=function(){if(ui.aa.N.call(this),this.i){var S=this.i,P;for(P in S.g){for(var V=S.g[P],Q=0;Q<V.length;Q++)Qn(V[Q]);delete S.g[P],S.h--}}this.F=null},ui.prototype.K=function(S,P,V,Q){return this.i.add(String(S),P,!1,V,Q)},ui.prototype.L=function(S,P,V,Q){return this.i.add(String(S),P,!0,V,Q)};function cu(S,P,V,Q){if(P=S.i.g[String(P)],!P)return!0;P=P.concat();for(var Te=!0,Ne=0;Ne<P.length;++Ne){var Ye=P[Ne];if(Ye&&!Ye.da&&Ye.capture==V){var Vn=Ye.listener,hi=Ye.ha||Ye.src;Ye.fa&&it(S.i,Ye),Te=Vn.call(hi,Q)!==!1&&Te}}return Te&&!Q.defaultPrevented}function qh(S,P,V){if(typeof S=="function")V&&(S=F(S,V));else if(S&&typeof S.handleEvent=="function")S=F(S.handleEvent,S);else throw Error("Invalid listener argument");return 2147483647<Number(P)?-1:T.setTimeout(S,P||0)}function Df(S){S.g=qh(()=>{S.g=null,S.i&&(S.i=!1,Df(S))},S.l);const P=S.h;S.h=null,S.m.apply(null,P)}class rv extends Et{constructor(P,V){super(),this.m=P,this.l=V,this.h=null,this.i=!1,this.g=null}j(P){this.h=arguments,this.g?this.i=!0:Df(this)}N(){super.N(),this.g&&(T.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function kl(S){Et.call(this),this.h=S,this.g={}}J(kl,Et);var kf=[];function Ga(S){Ce(S.g,function(P,V){this.g.hasOwnProperty(V)&&Rt(P)},S),S.g={}}kl.prototype.N=function(){kl.aa.N.call(this),Ga(this)},kl.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Yh=T.JSON.stringify,RR=T.JSON.parse,wR=class{stringify(S){return T.JSON.stringify(S,void 0)}parse(S){return T.JSON.parse(S,void 0)}};function Wa(){}Wa.prototype.h=null;function Lf(S){return S.h||(S.h=S.i())}function iv(){}var lu={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Mf(){un.call(this,"d")}J(Mf,un);function Uf(){un.call(this,"c")}J(Uf,un);var Zs={},sv=null;function ea(){return sv=sv||new ui}Zs.La="serverreachability";function ov(S){un.call(this,Zs.La,S)}J(ov,un);function du(S){const P=ea();ur(P,new ov(P))}Zs.STAT_EVENT="statevent";function av(S,P){un.call(this,Zs.STAT_EVENT,S),this.stat=P}J(av,un);function jn(S){const P=ea();ur(P,new av(P,S))}Zs.Ma="timingevent";function cv(S,P){un.call(this,Zs.Ma,S),this.size=P}J(cv,un);function uu(S,P){if(typeof S!="function")throw Error("Fn must not be null and must be a function");return T.setTimeout(function(){S()},P)}function ta(){this.g=!0}ta.prototype.xa=function(){this.g=!1};function lv(S,P,V,Q,Te,Ne){S.info(function(){if(S.g)if(Ne)for(var Ye="",Vn=Ne.split("&"),hi=0;hi<Vn.length;hi++){var an=Vn[hi].split("=");if(1<an.length){var Si=an[0];an=an[1];var Ti=Si.split("_");Ye=2<=Ti.length&&Ti[1]=="type"?Ye+(Si+"="+an+"&"):Ye+(Si+"=redacted&")}}else Ye=null;else Ye=Ne;return"XMLHTTP REQ ("+Q+") [attempt "+Te+"]: "+P+`
`+V+`
`+Ye})}function dv(S,P,V,Q,Te,Ne,Ye){S.info(function(){return"XMLHTTP RESP ("+Q+") [ attempt "+Te+"]: "+P+`
`+V+`
`+Ne+" "+Ye})}function kc(S,P,V,Q){S.info(function(){return"XMLHTTP TEXT ("+P+"): "+uv(S,V)+(Q?" "+Q:"")})}function CR(S,P){S.info(function(){return"TIMEOUT: "+P})}ta.prototype.info=function(){};function uv(S,P){if(!S.g)return P;if(!P)return null;try{var V=JSON.parse(P);if(V){for(S=0;S<V.length;S++)if(Array.isArray(V[S])){var Q=V[S];if(!(2>Q.length)){var Te=Q[1];if(Array.isArray(Te)&&!(1>Te.length)){var Ne=Te[0];if(Ne!="noop"&&Ne!="stop"&&Ne!="close")for(var Ye=1;Ye<Te.length;Ye++)Te[Ye]=""}}}}return Yh(V)}catch{return P}}var hu={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},hv={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},jf;function Xh(){}J(Xh,Wa),Xh.prototype.g=function(){return new XMLHttpRequest},Xh.prototype.i=function(){return{}},jf=new Xh;function na(S,P,V,Q){this.j=S,this.i=P,this.l=V,this.R=Q||1,this.U=new kl(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Vf}function Vf(){this.i=null,this.g="",this.h=!1}var Jh={},Qh={};function za(S,P,V){S.L=1,S.v=np(ra(P)),S.m=V,S.P=!0,pv(S,null)}function pv(S,P){S.F=Date.now(),$h(S),S.A=ra(S.v);var V=S.A,Q=S.R;Array.isArray(Q)||(Q=[String(Q)]),wv(V.i,"t",Q),S.C=0,V=S.j.J,S.h=new Vf,S.g=Zf(S.j,V?P:null,!S.m),0<S.O&&(S.M=new rv(F(S.Y,S,S.g),S.O)),P=S.U,V=S.g,Q=S.ca;var Te="readystatechange";Array.isArray(Te)||(Te&&(kf[0]=Te.toString()),Te=kf);for(var Ne=0;Ne<Te.length;Ne++){var Ye=_t(V,Te[Ne],Q||P.handleEvent,!1,P.h||P);if(!Ye)break;P.g[Ye.key]=Ye}P=S.H?q(S.H):{},S.m?(S.u||(S.u="POST"),P["Content-Type"]="application/x-www-form-urlencoded",S.g.ea(S.A,S.u,S.m,P)):(S.u="GET",S.g.ea(S.A,S.u,null,P)),du(),lv(S.i,S.u,S.A,S.l,S.R,S.m)}na.prototype.ca=function(S){S=S.target;const P=this.M;P&&ia(S)==3?P.j():this.Y(S)},na.prototype.Y=function(S){try{if(S==this.g)e:{const Ti=ia(this.g);var P=this.g.Ba();const Bl=this.g.Z();if(!(3>Ti)&&(Ti!=3||this.g&&(this.h.h||this.g.oa()||Ov(this.g)))){this.J||Ti!=4||P==7||(P==8||0>=Bl?du(3):du(2)),br(this);var V=this.g.Z();this.X=V;t:if(mv(this)){var Q=Ov(this.g);S="";var Te=Q.length,Ne=ia(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Lc(this),pu(this);var Ye="";break t}this.h.i=new T.TextDecoder}for(P=0;P<Te;P++)this.h.h=!0,S+=this.h.i.decode(Q[P],{stream:!(Ne&&P==Te-1)});Q.length=0,this.h.g+=S,this.C=0,Ye=this.h.g}else Ye=this.g.oa();if(this.o=V==200,dv(this.i,this.u,this.A,this.l,this.R,Ti,V),this.o){if(this.T&&!this.K){t:{if(this.g){var Vn,hi=this.g;if((Vn=hi.g?hi.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!W(Vn)){var an=Vn;break t}}an=null}if(V=an)kc(this.i,this.l,V,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ff(this,V);else{this.o=!1,this.s=3,jn(12),Lc(this),pu(this);break e}}if(this.P){V=!0;let Ps;for(;!this.J&&this.C<Ye.length;)if(Ps=bo(this,Ye),Ps==Qh){Ti==4&&(this.s=4,jn(14),V=!1),kc(this.i,this.l,null,"[Incomplete Response]");break}else if(Ps==Jh){this.s=4,jn(15),kc(this.i,this.l,Ye,"[Invalid Chunk]"),V=!1;break}else kc(this.i,this.l,Ps,null),Ff(this,Ps);if(mv(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ti!=4||Ye.length!=0||this.h.h||(this.s=1,jn(16),V=!1),this.o=this.o&&V,!V)kc(this.i,this.l,Ye,"[Invalid Chunked Response]"),Lc(this),pu(this);else if(0<Ye.length&&!this.W){this.W=!0;var Si=this.j;Si.g==this&&Si.ba&&!Si.M&&(Si.j.info("Great, no buffering proxy detected. Bytes received: "+Ye.length),$f(Si),Si.M=!0,jn(11))}}else kc(this.i,this.l,Ye,null),Ff(this,Ye);Ti==4&&Lc(this),this.o&&!this.J&&(Ti==4?Lv(this.j,this):(this.o=!1,$h(this)))}else kR(this.g),V==400&&0<Ye.indexOf("Unknown SID")?(this.s=3,jn(12)):(this.s=0,jn(13)),Lc(this),pu(this)}}}catch{}finally{}};function mv(S){return S.g?S.u=="GET"&&S.L!=2&&S.j.Ca:!1}function bo(S,P){var V=S.C,Q=P.indexOf(`
`,V);return Q==-1?Qh:(V=Number(P.substring(V,Q)),isNaN(V)?Jh:(Q+=1,Q+V>P.length?Qh:(P=P.slice(Q,Q+V),S.C=Q+V,P)))}na.prototype.cancel=function(){this.J=!0,Lc(this)};function $h(S){S.S=Date.now()+S.I,fv(S,S.I)}function fv(S,P){if(S.B!=null)throw Error("WatchDog timer not null");S.B=uu(F(S.ba,S),P)}function br(S){S.B&&(T.clearTimeout(S.B),S.B=null)}na.prototype.ba=function(){this.B=null;const S=Date.now();0<=S-this.S?(CR(this.i,this.A),this.L!=2&&(du(),jn(17)),Lc(this),this.s=2,pu(this)):fv(this,this.S-S)};function pu(S){S.j.G==0||S.J||Lv(S.j,S)}function Lc(S){br(S);var P=S.M;P&&typeof P.ma=="function"&&P.ma(),S.M=null,Ga(S.U),S.g&&(P=S.g,S.g=null,P.abort(),P.ma())}function Ff(S,P){try{var V=S.j;if(V.G!=0&&(V.g==S||Gf(V.h,S))){if(!S.K&&Gf(V.h,S)&&V.G==3){try{var Q=V.Da.g.parse(P)}catch{Q=null}if(Array.isArray(Q)&&Q.length==3){var Te=Q;if(Te[0]==0){e:if(!V.u){if(V.g)if(V.g.F+3e3<S.F)ap(V),jl(V);else break e;jc(V),jn(18)}}else V.za=Te[1],0<V.za-V.T&&37500>Te[2]&&V.F&&V.v==0&&!V.C&&(V.C=uu(F(V.Za,V),6e3));if(1>=Bf(V.h)&&V.ca){try{V.ca()}catch{}V.ca=void 0}}else Os(V,11)}else if((S.K||V.g==S)&&ap(V),!W(P))for(Te=V.Da.g.parse(P),P=0;P<Te.length;P++){let an=Te[P];if(V.T=an[0],an=an[1],V.G==2)if(an[0]=="c"){V.K=an[1],V.ia=an[2];const Si=an[3];Si!=null&&(V.la=Si,V.j.info("VER="+V.la));const Ti=an[4];Ti!=null&&(V.Aa=Ti,V.j.info("SVER="+V.Aa));const Bl=an[5];Bl!=null&&typeof Bl=="number"&&0<Bl&&(Q=1.5*Bl,V.L=Q,V.j.info("backChannelRequestTimeoutMs_="+Q)),Q=V;const Ps=S.g;if(Ps){const Gl=Ps.g?Ps.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Gl){var Ne=Q.h;Ne.g||Gl.indexOf("spdy")==-1&&Gl.indexOf("quic")==-1&&Gl.indexOf("h2")==-1||(Ne.j=Ne.l,Ne.g=new Set,Ne.h&&(Wf(Ne,Ne.h),Ne.h=null))}if(Q.D){const eg=Ps.g?Ps.g.getResponseHeader("X-HTTP-Session-Id"):null;eg&&(Q.ya=eg,rr(Q.I,Q.D,eg))}}V.G=3,V.l&&V.l.ua(),V.ba&&(V.R=Date.now()-S.F,V.j.info("Handshake RTT: "+V.R+"ms")),Q=V;var Ye=S;if(Q.qa=Vc(Q,Q.J?Q.ia:null,Q.W),Ye.K){_v(Q.h,Ye);var Vn=Ye,hi=Q.L;hi&&(Vn.I=hi),Vn.B&&(br(Vn),$h(Vn)),Q.g=Ye}else Ja(Q);0<V.i.length&&Vl(V)}else an[0]!="stop"&&an[0]!="close"||Os(V,7);else V.G==3&&(an[0]=="stop"||an[0]=="close"?an[0]=="stop"?Os(V,7):Jf(V):an[0]!="noop"&&V.l&&V.l.ta(an),V.v=0)}}du(4)}catch{}}var IR=class{constructor(S,P){this.g=S,this.map=P}};function Zh(S){this.l=S||10,T.PerformanceNavigationTiming?(S=T.performance.getEntriesByType("navigation"),S=0<S.length&&(S[0].nextHopProtocol=="hq"||S[0].nextHopProtocol=="h2")):S=!!(T.chrome&&T.chrome.loadTimes&&T.chrome.loadTimes()&&T.chrome.loadTimes().wasFetchedViaSpdy),this.j=S?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function gv(S){return S.h?!0:S.g?S.g.size>=S.j:!1}function Bf(S){return S.h?1:S.g?S.g.size:0}function Gf(S,P){return S.h?S.h==P:S.g?S.g.has(P):!1}function Wf(S,P){S.g?S.g.add(P):S.h=P}function _v(S,P){S.h&&S.h==P?S.h=null:S.g&&S.g.has(P)&&S.g.delete(P)}Zh.prototype.cancel=function(){if(this.i=Mc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const S of this.g.values())S.cancel();this.g.clear()}};function Mc(S){if(S.h!=null)return S.i.concat(S.h.D);if(S.g!=null&&S.g.size!==0){let P=S.i;for(const V of S.g.values())P=P.concat(V.D);return P}return ae(S.i)}function zf(S){if(S.V&&typeof S.V=="function")return S.V();if(typeof Map<"u"&&S instanceof Map||typeof Set<"u"&&S instanceof Set)return Array.from(S.values());if(typeof S=="string")return S.split("");if(w(S)){for(var P=[],V=S.length,Q=0;Q<V;Q++)P.push(S[Q]);return P}P=[],V=0;for(Q in S)P[V++]=S[Q];return P}function AR(S){if(S.na&&typeof S.na=="function")return S.na();if(!S.V||typeof S.V!="function"){if(typeof Map<"u"&&S instanceof Map)return Array.from(S.keys());if(!(typeof Set<"u"&&S instanceof Set)){if(w(S)||typeof S=="string"){var P=[];S=S.length;for(var V=0;V<S;V++)P.push(V);return P}P=[],V=0;for(const Q in S)P[V++]=Q;return P}}}function Mn(S,P){if(S.forEach&&typeof S.forEach=="function")S.forEach(P,void 0);else if(w(S)||typeof S=="string")Array.prototype.forEach.call(S,P,void 0);else for(var V=AR(S),Q=zf(S),Te=Q.length,Ne=0;Ne<Te;Ne++)P.call(void 0,Q[Ne],V&&V[Ne],S)}var Ev=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function vv(S,P){if(S){S=S.split("&");for(var V=0;V<S.length;V++){var Q=S[V].indexOf("="),Te=null;if(0<=Q){var Ne=S[V].substring(0,Q);Te=S[V].substring(Q+1)}else Ne=S[V];P(Ne,Te?decodeURIComponent(Te.replace(/\+/g," ")):"")}}}function Ha(S){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,S instanceof Ha){this.h=S.h,ep(this,S.j),this.o=S.o,this.g=S.g,tp(this,S.s),this.l=S.l;var P=S.i,V=new mu;V.i=P.i,P.g&&(V.g=new Map(P.g),V.h=P.h),yv(this,V),this.m=S.m}else S&&(P=String(S).match(Ev))?(this.h=!1,ep(this,P[1]||"",!0),this.o=Uc(P[2]||""),this.g=Uc(P[3]||"",!0),tp(this,P[4]),this.l=Uc(P[5]||"",!0),yv(this,P[6]||"",!0),this.m=Uc(P[7]||"")):(this.h=!1,this.i=new mu(null,this.h))}Ha.prototype.toString=function(){var S=[],P=this.j;P&&S.push(Ll(P,Sv,!0),":");var V=this.g;return(V||P=="file")&&(S.push("//"),(P=this.o)&&S.push(Ll(P,Sv,!0),"@"),S.push(encodeURIComponent(String(V)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),V=this.s,V!=null&&S.push(":",String(V))),(V=this.l)&&(this.g&&V.charAt(0)!="/"&&S.push("/"),S.push(Ll(V,V.charAt(0)=="/"?NR:Kf,!0))),(V=this.i.toString())&&S.push("?",V),(V=this.m)&&S.push("#",Ll(V,xR)),S.join("")};function ra(S){return new Ha(S)}function ep(S,P,V){S.j=V?Uc(P,!0):P,S.j&&(S.j=S.j.replace(/:$/,""))}function tp(S,P){if(P){if(P=Number(P),isNaN(P)||0>P)throw Error("Bad port number "+P);S.s=P}else S.s=null}function yv(S,P,V){P instanceof mu?(S.i=P,OR(S.i,S.h)):(V||(P=Ll(P,Tv)),S.i=new mu(P,S.h))}function rr(S,P,V){S.i.set(P,V)}function np(S){return rr(S,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),S}function Uc(S,P){return S?P?decodeURI(S.replace(/%25/g,"%2525")):decodeURIComponent(S):""}function Ll(S,P,V){return typeof S=="string"?(S=encodeURI(S).replace(P,Hf),V&&(S=S.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),S):null}function Hf(S){return S=S.charCodeAt(0),"%"+(S>>4&15).toString(16)+(S&15).toString(16)}var Sv=/[#\/\?@]/g,Kf=/[#\?:]/g,NR=/[#\?]/g,Tv=/[#\?@]/g,xR=/#/g;function mu(S,P){this.h=this.g=null,this.i=S||null,this.j=!!P}function Ka(S){S.g||(S.g=new Map,S.h=0,S.i&&vv(S.i,function(P,V){S.add(decodeURIComponent(P.replace(/\+/g," ")),V)}))}s=mu.prototype,s.add=function(S,P){Ka(this),this.i=null,S=Ml(this,S);var V=this.g.get(S);return V||this.g.set(S,V=[]),V.push(P),this.h+=1,this};function bv(S,P){Ka(S),P=Ml(S,P),S.g.has(P)&&(S.i=null,S.h-=S.g.get(P).length,S.g.delete(P))}function Rv(S,P){return Ka(S),P=Ml(S,P),S.g.has(P)}s.forEach=function(S,P){Ka(this),this.g.forEach(function(V,Q){V.forEach(function(Te){S.call(P,Te,Q,this)},this)},this)},s.na=function(){Ka(this);const S=Array.from(this.g.values()),P=Array.from(this.g.keys()),V=[];for(let Q=0;Q<P.length;Q++){const Te=S[Q];for(let Ne=0;Ne<Te.length;Ne++)V.push(P[Q])}return V},s.V=function(S){Ka(this);let P=[];if(typeof S=="string")Rv(this,S)&&(P=P.concat(this.g.get(Ml(this,S))));else{S=Array.from(this.g.values());for(let V=0;V<S.length;V++)P=P.concat(S[V])}return P},s.set=function(S,P){return Ka(this),this.i=null,S=Ml(this,S),Rv(this,S)&&(this.h-=this.g.get(S).length),this.g.set(S,[P]),this.h+=1,this},s.get=function(S,P){return S?(S=this.V(S),0<S.length?String(S[0]):P):P};function wv(S,P,V){bv(S,P),0<V.length&&(S.i=null,S.g.set(Ml(S,P),ae(V)),S.h+=V.length)}s.toString=function(){if(this.i)return this.i;if(!this.g)return"";const S=[],P=Array.from(this.g.keys());for(var V=0;V<P.length;V++){var Q=P[V];const Ne=encodeURIComponent(String(Q)),Ye=this.V(Q);for(Q=0;Q<Ye.length;Q++){var Te=Ne;Ye[Q]!==""&&(Te+="="+encodeURIComponent(String(Ye[Q]))),S.push(Te)}}return this.i=S.join("&")};function Ml(S,P){return P=String(P),S.j&&(P=P.toLowerCase()),P}function OR(S,P){P&&!S.j&&(Ka(S),S.i=null,S.g.forEach(function(V,Q){var Te=Q.toLowerCase();Q!=Te&&(bv(this,Q),wv(this,Te,V))},S)),S.j=P}function Cv(S,P){const V=new ta;if(T.Image){const Q=new Image;Q.onload=Y(qa,V,"TestLoadImage: loaded",!0,P,Q),Q.onerror=Y(qa,V,"TestLoadImage: error",!1,P,Q),Q.onabort=Y(qa,V,"TestLoadImage: abort",!1,P,Q),Q.ontimeout=Y(qa,V,"TestLoadImage: timeout",!1,P,Q),T.setTimeout(function(){Q.ontimeout&&Q.ontimeout()},1e4),Q.src=S}else P(!1)}function PR(S,P){const V=new ta,Q=new AbortController,Te=setTimeout(()=>{Q.abort(),qa(V,"TestPingServer: timeout",!1,P)},1e4);fetch(S,{signal:Q.signal}).then(Ne=>{clearTimeout(Te),Ne.ok?qa(V,"TestPingServer: ok",!0,P):qa(V,"TestPingServer: server error",!1,P)}).catch(()=>{clearTimeout(Te),qa(V,"TestPingServer: error",!1,P)})}function qa(S,P,V,Q,Te){try{Te&&(Te.onload=null,Te.onerror=null,Te.onabort=null,Te.ontimeout=null),Q(V)}catch{}}function DR(){this.g=new wR}function fu(S,P,V){const Q=V||"";try{Mn(S,function(Te,Ne){let Ye=Te;A(Te)&&(Ye=Yh(Te)),P.push(Q+Ne+"="+encodeURIComponent(Ye))})}catch(Te){throw P.push(Q+"type="+encodeURIComponent("_badmap")),Te}}function rp(S){this.l=S.Ub||null,this.j=S.eb||!1}J(rp,Wa),rp.prototype.g=function(){return new ip(this.l,this.j)},rp.prototype.i=function(S){return function(){return S}}({});function ip(S,P){ui.call(this),this.D=S,this.o=P,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}J(ip,ui),s=ip.prototype,s.open=function(S,P){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=S,this.A=P,this.readyState=1,Ul(this)},s.send=function(S){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const P={headers:this.u,method:this.B,credentials:this.m,cache:void 0};S&&(P.body=S),(this.D||T).fetch(new Request(this.A,P)).then(this.Sa.bind(this),this.ga.bind(this))},s.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,gu(this)),this.readyState=0},s.Sa=function(S){if(this.g&&(this.l=S,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=S.headers,this.readyState=2,Ul(this)),this.g&&(this.readyState=3,Ul(this),this.g)))if(this.responseType==="arraybuffer")S.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof T.ReadableStream<"u"&&"body"in S){if(this.j=S.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Iv(this)}else S.text().then(this.Ra.bind(this),this.ga.bind(this))};function Iv(S){S.j.read().then(S.Pa.bind(S)).catch(S.ga.bind(S))}s.Pa=function(S){if(this.g){if(this.o&&S.value)this.response.push(S.value);else if(!this.o){var P=S.value?S.value:new Uint8Array(0);(P=this.v.decode(P,{stream:!S.done}))&&(this.response=this.responseText+=P)}S.done?gu(this):Ul(this),this.readyState==3&&Iv(this)}},s.Ra=function(S){this.g&&(this.response=this.responseText=S,gu(this))},s.Qa=function(S){this.g&&(this.response=S,gu(this))},s.ga=function(){this.g&&gu(this)};function gu(S){S.readyState=4,S.l=null,S.j=null,S.v=null,Ul(S)}s.setRequestHeader=function(S,P){this.u.append(S,P)},s.getResponseHeader=function(S){return this.h&&this.h.get(S.toLowerCase())||""},s.getAllResponseHeaders=function(){if(!this.h)return"";const S=[],P=this.h.entries();for(var V=P.next();!V.done;)V=V.value,S.push(V[0]+": "+V[1]),V=P.next();return S.join(`\r
`)};function Ul(S){S.onreadystatechange&&S.onreadystatechange.call(S)}Object.defineProperty(ip.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(S){this.m=S?"include":"same-origin"}});function Av(S){let P="";return Ce(S,function(V,Q){P+=Q,P+=":",P+=V,P+=`\r
`}),P}function qf(S,P,V){e:{for(Q in V){var Q=!1;break e}Q=!0}Q||(V=Av(V),typeof S=="string"?V!=null&&encodeURIComponent(String(V)):rr(S,P,V))}function Rr(S){ui.call(this),this.headers=new Map,this.o=S||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}J(Rr,ui);var Ya=/^https?$/i,xs=["POST","PUT"];s=Rr.prototype,s.Ha=function(S){this.J=S},s.ea=function(S,P,V,Q){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+S);P=P?P.toUpperCase():"GET",this.D=S,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():jf.g(),this.v=this.o?Lf(this.o):Lf(jf),this.g.onreadystatechange=F(this.Ea,this);try{this.B=!0,this.g.open(P,String(S),!0),this.B=!1}catch(Ne){Yf(this,Ne);return}if(S=V||"",V=new Map(this.headers),Q)if(Object.getPrototypeOf(Q)===Object.prototype)for(var Te in Q)V.set(Te,Q[Te]);else if(typeof Q.keys=="function"&&typeof Q.get=="function")for(const Ne of Q.keys())V.set(Ne,Q.get(Ne));else throw Error("Unknown input type for opt_headers: "+String(Q));Q=Array.from(V.keys()).find(Ne=>Ne.toLowerCase()=="content-type"),Te=T.FormData&&S instanceof T.FormData,!(0<=Array.prototype.indexOf.call(xs,P,void 0))||Q||Te||V.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Ne,Ye]of V)this.g.setRequestHeader(Ne,Ye);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{yi(this),this.u=!0,this.g.send(S),this.u=!1}catch(Ne){Yf(this,Ne)}};function Yf(S,P){S.h=!1,S.g&&(S.j=!0,S.g.abort(),S.j=!1),S.l=P,S.m=5,Nv(S),sp(S)}function Nv(S){S.A||(S.A=!0,ur(S,"complete"),ur(S,"error"))}s.abort=function(S){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=S||7,ur(this,"complete"),ur(this,"abort"),sp(this))},s.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),sp(this,!0)),Rr.aa.N.call(this)},s.Ea=function(){this.s||(this.B||this.u||this.j?xv(this):this.bb())},s.bb=function(){xv(this)};function xv(S){if(S.h&&typeof E<"u"&&(!S.v[1]||ia(S)!=4||S.Z()!=2)){if(S.u&&ia(S)==4)qh(S.Ea,0,S);else if(ur(S,"readystatechange"),ia(S)==4){S.h=!1;try{const Ye=S.Z();e:switch(Ye){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var P=!0;break e;default:P=!1}var V;if(!(V=P)){var Q;if(Q=Ye===0){var Te=String(S.D).match(Ev)[1]||null;!Te&&T.self&&T.self.location&&(Te=T.self.location.protocol.slice(0,-1)),Q=!Ya.test(Te?Te.toLowerCase():"")}V=Q}if(V)ur(S,"complete"),ur(S,"success");else{S.m=6;try{var Ne=2<ia(S)?S.g.statusText:""}catch{Ne=""}S.l=Ne+" ["+S.Z()+"]",Nv(S)}}finally{sp(S)}}}}function sp(S,P){if(S.g){yi(S);const V=S.g,Q=S.v[0]?()=>{}:null;S.g=null,S.v=null,P||ur(S,"ready");try{V.onreadystatechange=Q}catch{}}}function yi(S){S.I&&(T.clearTimeout(S.I),S.I=null)}s.isActive=function(){return!!this.g};function ia(S){return S.g?S.g.readyState:0}s.Z=function(){try{return 2<ia(this)?this.g.status:-1}catch{return-1}},s.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},s.Oa=function(S){if(this.g){var P=this.g.responseText;return S&&P.indexOf(S)==0&&(P=P.substring(S.length)),RR(P)}};function Ov(S){try{if(!S.g)return null;if("response"in S.g)return S.g.response;switch(S.H){case"":case"text":return S.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in S.g)return S.g.mozResponseArrayBuffer}return null}catch{return null}}function kR(S){const P={};S=(S.g&&2<=ia(S)&&S.g.getAllResponseHeaders()||"").split(`\r
`);for(let Q=0;Q<S.length;Q++){if(W(S[Q]))continue;var V=le(S[Q]);const Te=V[0];if(V=V[1],typeof V!="string")continue;V=V.trim();const Ne=P[Te]||[];P[Te]=Ne,Ne.push(V)}te(P,function(Q){return Q.join(", ")})}s.Ba=function(){return this.m},s.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Xa(S,P,V){return V&&V.internalChannelParams&&V.internalChannelParams[S]||P}function Xf(S){this.Aa=0,this.i=[],this.j=new ta,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Xa("failFast",!1,S),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Xa("baseRetryDelayMs",5e3,S),this.cb=Xa("retryDelaySeedMs",1e4,S),this.Wa=Xa("forwardChannelMaxRetries",2,S),this.wa=Xa("forwardChannelRequestTimeoutMs",2e4,S),this.pa=S&&S.xmlHttpFactory||void 0,this.Xa=S&&S.Tb||void 0,this.Ca=S&&S.useFetchStreams||!1,this.L=void 0,this.J=S&&S.supportsCrossDomainXhr||!1,this.K="",this.h=new Zh(S&&S.concurrentRequestLimit),this.Da=new DR,this.P=S&&S.fastHandshake||!1,this.O=S&&S.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=S&&S.Rb||!1,S&&S.xa&&this.j.xa(),S&&S.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&S&&S.detectBufferingProxy||!1,this.ja=void 0,S&&S.longPollingTimeout&&0<S.longPollingTimeout&&(this.ja=S.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}s=Xf.prototype,s.la=8,s.G=1,s.connect=function(S,P,V,Q){jn(0),this.W=S,this.H=P||{},V&&Q!==void 0&&(this.H.OSID=V,this.H.OAID=Q),this.F=this.X,this.I=Vc(this,null,this.W),Vl(this)};function Jf(S){if(Pv(S),S.G==3){var P=S.U++,V=ra(S.I);if(rr(V,"SID",S.K),rr(V,"RID",P),rr(V,"TYPE","terminate"),_u(S,V),P=new na(S,S.j,P),P.L=2,P.v=np(ra(V)),V=!1,T.navigator&&T.navigator.sendBeacon)try{V=T.navigator.sendBeacon(P.v.toString(),"")}catch{}!V&&T.Image&&(new Image().src=P.v,V=!0),V||(P.g=Zf(P.j,null),P.g.ea(P.v)),P.F=Date.now(),$h(P)}Uv(S)}function jl(S){S.g&&($f(S),S.g.cancel(),S.g=null)}function Pv(S){jl(S),S.u&&(T.clearTimeout(S.u),S.u=null),ap(S),S.h.cancel(),S.s&&(typeof S.s=="number"&&T.clearTimeout(S.s),S.s=null)}function Vl(S){if(!gv(S.h)&&!S.s){S.s=!0;var P=S.Ga;It||pt(),Ge||(It(),Ge=!0),nt.add(P,S),S.B=0}}function Qf(S,P){return Bf(S.h)>=S.h.j-(S.s?1:0)?!1:S.s?(S.i=P.D.concat(S.i),!0):S.G==1||S.G==2||S.B>=(S.Va?0:S.Wa)?!1:(S.s=uu(F(S.Ga,S,P),Mv(S,S.B)),S.B++,!0)}s.Ga=function(S){if(this.s)if(this.s=null,this.G==1){if(!S){this.U=Math.floor(1e5*Math.random()),S=this.U++;const Te=new na(this,this.j,S);let Ne=this.o;if(this.S&&(Ne?(Ne=q(Ne),$(Ne,this.S)):Ne=this.S),this.m!==null||this.O||(Te.H=Ne,Ne=null),this.P)e:{for(var P=0,V=0;V<this.i.length;V++){t:{var Q=this.i[V];if("__data__"in Q.map&&(Q=Q.map.__data__,typeof Q=="string")){Q=Q.length;break t}Q=void 0}if(Q===void 0)break;if(P+=Q,4096<P){P=V;break e}if(P===4096||V===this.i.length-1){P=V+1;break e}}P=1e3}else P=1e3;P=Dv(this,Te,P),V=ra(this.I),rr(V,"RID",S),rr(V,"CVER",22),this.D&&rr(V,"X-HTTP-Session-Id",this.D),_u(this,V),Ne&&(this.O?P="headers="+encodeURIComponent(String(Av(Ne)))+"&"+P:this.m&&qf(V,this.m,Ne)),Wf(this.h,Te),this.Ua&&rr(V,"TYPE","init"),this.P?(rr(V,"$req",P),rr(V,"SID","null"),Te.T=!0,za(Te,V,null)):za(Te,V,P),this.G=2}}else this.G==3&&(S?op(this,S):this.i.length==0||gv(this.h)||op(this))};function op(S,P){var V;P?V=P.l:V=S.U++;const Q=ra(S.I);rr(Q,"SID",S.K),rr(Q,"RID",V),rr(Q,"AID",S.T),_u(S,Q),S.m&&S.o&&qf(Q,S.m,S.o),V=new na(S,S.j,V,S.B+1),S.m===null&&(V.H=S.o),P&&(S.i=P.D.concat(S.i)),P=Dv(S,V,1e3),V.I=Math.round(.5*S.wa)+Math.round(.5*S.wa*Math.random()),Wf(S.h,V),za(V,Q,P)}function _u(S,P){S.H&&Ce(S.H,function(V,Q){rr(P,Q,V)}),S.l&&Mn({},function(V,Q){rr(P,Q,V)})}function Dv(S,P,V){V=Math.min(S.i.length,V);var Q=S.l?F(S.l.Na,S.l,S):null;e:{var Te=S.i;let Ne=-1;for(;;){const Ye=["count="+V];Ne==-1?0<V?(Ne=Te[0].g,Ye.push("ofs="+Ne)):Ne=0:Ye.push("ofs="+Ne);let Vn=!0;for(let hi=0;hi<V;hi++){let an=Te[hi].g;const Si=Te[hi].map;if(an-=Ne,0>an)Ne=Math.max(0,Te[hi].g-100),Vn=!1;else try{fu(Si,Ye,"req"+an+"_")}catch{Q&&Q(Si)}}if(Vn){Q=Ye.join("&");break e}}}return S=S.i.splice(0,V),P.D=S,Q}function Ja(S){if(!S.g&&!S.u){S.Y=1;var P=S.Fa;It||pt(),Ge||(It(),Ge=!0),nt.add(P,S),S.v=0}}function jc(S){return S.g||S.u||3<=S.v?!1:(S.Y++,S.u=uu(F(S.Fa,S),Mv(S,S.v)),S.v++,!0)}s.Fa=function(){if(this.u=null,kv(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var S=2*this.R;this.j.info("BP detection timer enabled: "+S),this.A=uu(F(this.ab,this),S)}},s.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,jn(10),jl(this),kv(this))};function $f(S){S.A!=null&&(T.clearTimeout(S.A),S.A=null)}function kv(S){S.g=new na(S,S.j,"rpc",S.Y),S.m===null&&(S.g.H=S.o),S.g.O=0;var P=ra(S.qa);rr(P,"RID","rpc"),rr(P,"SID",S.K),rr(P,"AID",S.T),rr(P,"CI",S.F?"0":"1"),!S.F&&S.ja&&rr(P,"TO",S.ja),rr(P,"TYPE","xmlhttp"),_u(S,P),S.m&&S.o&&qf(P,S.m,S.o),S.L&&(S.g.I=S.L);var V=S.g;S=S.ia,V.L=1,V.v=np(ra(P)),V.m=null,V.P=!0,pv(V,S)}s.Za=function(){this.C!=null&&(this.C=null,jl(this),jc(this),jn(19))};function ap(S){S.C!=null&&(T.clearTimeout(S.C),S.C=null)}function Lv(S,P){var V=null;if(S.g==P){ap(S),$f(S),S.g=null;var Q=2}else if(Gf(S.h,P))V=P.D,_v(S.h,P),Q=1;else return;if(S.G!=0){if(P.o)if(Q==1){V=P.m?P.m.length:0,P=Date.now()-P.F;var Te=S.B;Q=ea(),ur(Q,new cv(Q,V)),Vl(S)}else Ja(S);else if(Te=P.s,Te==3||Te==0&&0<P.X||!(Q==1&&Qf(S,P)||Q==2&&jc(S)))switch(V&&0<V.length&&(P=S.h,P.i=P.i.concat(V)),Te){case 1:Os(S,5);break;case 4:Os(S,10);break;case 3:Os(S,6);break;default:Os(S,2)}}}function Mv(S,P){let V=S.Ta+Math.floor(Math.random()*S.cb);return S.isActive()||(V*=2),V*P}function Os(S,P){if(S.j.info("Error code "+P),P==2){var V=F(S.fb,S),Q=S.Xa;const Te=!Q;Q=new Ha(Q||"//www.google.com/images/cleardot.gif"),T.location&&T.location.protocol=="http"||ep(Q,"https"),np(Q),Te?Cv(Q.toString(),V):PR(Q.toString(),V)}else jn(2);S.G=0,S.l&&S.l.sa(P),Uv(S),Pv(S)}s.fb=function(S){S?(this.j.info("Successfully pinged google.com"),jn(2)):(this.j.info("Failed to ping google.com"),jn(1))};function Uv(S){if(S.G=0,S.ka=[],S.l){const P=Mc(S.h);(P.length!=0||S.i.length!=0)&&(he(S.ka,P),he(S.ka,S.i),S.h.i.length=0,ae(S.i),S.i.length=0),S.l.ra()}}function Vc(S,P,V){var Q=V instanceof Ha?ra(V):new Ha(V);if(Q.g!="")P&&(Q.g=P+"."+Q.g),tp(Q,Q.s);else{var Te=T.location;Q=Te.protocol,P=P?P+"."+Te.hostname:Te.hostname,Te=+Te.port;var Ne=new Ha(null);Q&&ep(Ne,Q),P&&(Ne.g=P),Te&&tp(Ne,Te),V&&(Ne.l=V),Q=Ne}return V=S.D,P=S.ya,V&&P&&rr(Q,V,P),rr(Q,"VER",S.la),_u(S,Q),Q}function Zf(S,P,V){if(P&&!S.J)throw Error("Can't create secondary domain capable XhrIo object.");return P=S.Ca&&!S.pa?new Rr(new rp({eb:V})):new Rr(S.pa),P.Ha(S.J),P}s.isActive=function(){return!!this.l&&this.l.isActive(this)};function jv(){}s=jv.prototype,s.ua=function(){},s.ta=function(){},s.sa=function(){},s.ra=function(){},s.isActive=function(){return!0},s.Na=function(){};function Lt(){}Lt.prototype.g=function(S,P){return new gs(S,P)};function gs(S,P){ui.call(this),this.g=new Xf(P),this.l=S,this.h=P&&P.messageUrlParams||null,S=P&&P.messageHeaders||null,P&&P.clientProtocolHeaderRequired&&(S?S["X-Client-Protocol"]="webchannel":S={"X-Client-Protocol":"webchannel"}),this.g.o=S,S=P&&P.initMessageHeaders||null,P&&P.messageContentType&&(S?S["X-WebChannel-Content-Type"]=P.messageContentType:S={"X-WebChannel-Content-Type":P.messageContentType}),P&&P.va&&(S?S["X-WebChannel-Client-Profile"]=P.va:S={"X-WebChannel-Client-Profile":P.va}),this.g.S=S,(S=P&&P.Sb)&&!W(S)&&(this.g.m=S),this.v=P&&P.supportsCrossDomainXhr||!1,this.u=P&&P.sendRawJson||!1,(P=P&&P.httpSessionIdParam)&&!W(P)&&(this.g.D=P,S=this.h,S!==null&&P in S&&(S=this.h,P in S&&delete S[P])),this.j=new Fl(this)}J(gs,ui),gs.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},gs.prototype.close=function(){Jf(this.g)},gs.prototype.o=function(S){var P=this.g;if(typeof S=="string"){var V={};V.__data__=S,S=V}else this.u&&(V={},V.__data__=Yh(S),S=V);P.i.push(new IR(P.Ya++,S)),P.G==3&&Vl(P)},gs.prototype.N=function(){this.g.l=null,delete this.j,Jf(this.g),delete this.g,gs.aa.N.call(this)};function Vv(S){Mf.call(this),S.__headers__&&(this.headers=S.__headers__,this.statusCode=S.__status__,delete S.__headers__,delete S.__status__);var P=S.__sm__;if(P){e:{for(const V in P){S=V;break e}S=void 0}(this.i=S)&&(S=this.i,P=P!==null&&S in P?P[S]:void 0),this.data=P}else this.data=S}J(Vv,Mf);function Fv(){Uf.call(this),this.status=1}J(Fv,Uf);function Fl(S){this.g=S}J(Fl,jv),Fl.prototype.ua=function(){ur(this.g,"a")},Fl.prototype.ta=function(S){ur(this.g,new Vv(S))},Fl.prototype.sa=function(S){ur(this.g,new Fv)},Fl.prototype.ra=function(){ur(this.g,"b")},Lt.prototype.createWebChannel=Lt.prototype.g,gs.prototype.send=gs.prototype.o,gs.prototype.open=gs.prototype.m,gs.prototype.close=gs.prototype.close,xK=function(){return new Lt},NK=function(){return ea()},AK=Zs,BO={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},hu.NO_ERROR=0,hu.TIMEOUT=8,hu.HTTP_ERROR=6,C0=hu,hv.COMPLETE="complete",IK=hv,iv.EventType=lu,lu.OPEN="a",lu.CLOSE="b",lu.ERROR="c",lu.MESSAGE="d",ui.prototype.listen=ui.prototype.K,V_=iv,Rr.prototype.listenOnce=Rr.prototype.L,Rr.prototype.getLastError=Rr.prototype.Ka,Rr.prototype.getLastErrorCode=Rr.prototype.Ba,Rr.prototype.getStatus=Rr.prototype.Z,Rr.prototype.getResponseJson=Rr.prototype.Oa,Rr.prototype.getResponseText=Rr.prototype.oa,Rr.prototype.send=Rr.prototype.ea,Rr.prototype.setWithCredentials=Rr.prototype.Ha,CK=Rr}).apply(typeof s0<"u"?s0:typeof self<"u"?self:typeof window<"u"?window:{});const nz="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let as=class{constructor(r){this.uid=r}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(r){return r.uid===this.uid}};as.UNAUTHENTICATED=new as(null),as.GOOGLE_CREDENTIALS=new as("google-credentials-uid"),as.FIRST_PARTY=new as("first-party-uid"),as.MOCK_USER=new as("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Cf="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jh=new iD("@firebase/firestore");function P_(){return jh.logLevel}function gt(s,...r){if(jh.logLevel<=Rn.DEBUG){const o=r.map(ED);jh.debug(`Firestore (${Cf}): ${s}`,...o)}}function Rl(s,...r){if(jh.logLevel<=Rn.ERROR){const o=r.map(ED);jh.error(`Firestore (${Cf}): ${s}`,...o)}}function df(s,...r){if(jh.logLevel<=Rn.WARN){const o=r.map(ED);jh.warn(`Firestore (${Cf}): ${s}`,...o)}}function ED(s){if(typeof s=="string")return s;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(o){return JSON.stringify(o)}(s)}catch{return s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gt(s="Unexpected state"){const r=`FIRESTORE (${Cf}) INTERNAL ASSERTION FAILED: `+s;throw Rl(r),new Error(r)}function Jn(s,r){s||Gt()}function $t(s,r){return s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const je={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ut extends Pc{constructor(r,o){super(r,o),this.code=r,this.message=o,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fl{constructor(){this.promise=new Promise((r,o)=>{this.resolve=r,this.reject=o})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OK{constructor(r,o){this.user=o,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${r}`)}}class N_e{getToken(){return Promise.resolve(null)}invalidateToken(){}start(r,o){r.enqueueRetryable(()=>o(as.UNAUTHENTICATED))}shutdown(){}}class x_e{constructor(r){this.token=r,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(r,o){this.changeListener=o,r.enqueueRetryable(()=>o(this.token.user))}shutdown(){this.changeListener=null}}class O_e{constructor(r){this.t=r,this.currentUser=as.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(r,o){Jn(this.o===void 0);let l=this.i;const u=w=>this.i!==l?(l=this.i,o(w)):Promise.resolve();let f=new fl;this.o=()=>{this.i++,this.currentUser=this.u(),f.resolve(),f=new fl,r.enqueueRetryable(()=>u(this.currentUser))};const E=()=>{const w=f;r.enqueueRetryable(async()=>{await w.promise,await u(this.currentUser)})},T=w=>{gt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=w,this.o&&(this.auth.addAuthTokenListener(this.o),E())};this.t.onInit(w=>T(w)),setTimeout(()=>{if(!this.auth){const w=this.t.getImmediate({optional:!0});w?T(w):(gt("FirebaseAuthCredentialsProvider","Auth not yet detected"),f.resolve(),f=new fl)}},0),E()}getToken(){const r=this.i,o=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(o).then(l=>this.i!==r?(gt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):l?(Jn(typeof l.accessToken=="string"),new OK(l.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const r=this.auth&&this.auth.getUid();return Jn(r===null||typeof r=="string"),new as(r)}}class P_e{constructor(r,o,l){this.l=r,this.h=o,this.P=l,this.type="FirstParty",this.user=as.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const r=this.T();return r&&this.I.set("Authorization",r),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class D_e{constructor(r,o,l){this.l=r,this.h=o,this.P=l}getToken(){return Promise.resolve(new P_e(this.l,this.h,this.P))}start(r,o){r.enqueueRetryable(()=>o(as.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class k_e{constructor(r){this.value=r,this.type="AppCheck",this.headers=new Map,r&&r.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class L_e{constructor(r){this.A=r,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(r,o){Jn(this.o===void 0);const l=f=>{f.error!=null&&gt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${f.error.message}`);const E=f.token!==this.R;return this.R=f.token,gt("FirebaseAppCheckTokenProvider",`Received ${E?"new":"existing"} token.`),E?o(f.token):Promise.resolve()};this.o=f=>{r.enqueueRetryable(()=>l(f))};const u=f=>{gt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=f,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(f=>u(f)),setTimeout(()=>{if(!this.appCheck){const f=this.A.getImmediate({optional:!0});f?u(f):gt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const r=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(r).then(o=>o?(Jn(typeof o.token=="string"),this.R=o.token,new k_e(o.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M_e(s){const r=typeof self<"u"&&(self.crypto||self.msCrypto),o=new Uint8Array(s);if(r&&typeof r.getRandomValues=="function")r.getRandomValues(o);else for(let l=0;l<s;l++)o[l]=Math.floor(256*Math.random());return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PK{static newId(){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=Math.floor(256/r.length)*r.length;let l="";for(;l.length<20;){const u=M_e(40);for(let f=0;f<u.length;++f)l.length<20&&u[f]<o&&(l+=r.charAt(u[f]%r.length))}return l}}function kn(s,r){return s<r?-1:s>r?1:0}function uf(s,r,o){return s.length===r.length&&s.every((l,u)=>o(l,r[u]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wn{constructor(r,o){if(this.seconds=r,this.nanoseconds=o,o<0)throw new ut(je.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+o);if(o>=1e9)throw new ut(je.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+o);if(r<-62135596800)throw new ut(je.INVALID_ARGUMENT,"Timestamp seconds out of range: "+r);if(r>=253402300800)throw new ut(je.INVALID_ARGUMENT,"Timestamp seconds out of range: "+r)}static now(){return Wn.fromMillis(Date.now())}static fromDate(r){return Wn.fromMillis(r.getTime())}static fromMillis(r){const o=Math.floor(r/1e3),l=Math.floor(1e6*(r-1e3*o));return new Wn(o,l)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(r){return this.seconds===r.seconds?kn(this.nanoseconds,r.nanoseconds):kn(this.seconds,r.seconds)}isEqual(r){return r.seconds===this.seconds&&r.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const r=this.seconds- -62135596800;return String(r).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jt{constructor(r){this.timestamp=r}static fromTimestamp(r){return new Jt(r)}static min(){return new Jt(new Wn(0,0))}static max(){return new Jt(new Wn(253402300799,999999999))}compareTo(r){return this.timestamp._compareTo(r.timestamp)}isEqual(r){return this.timestamp.isEqual(r.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xE{constructor(r,o,l){o===void 0?o=0:o>r.length&&Gt(),l===void 0?l=r.length-o:l>r.length-o&&Gt(),this.segments=r,this.offset=o,this.len=l}get length(){return this.len}isEqual(r){return xE.comparator(this,r)===0}child(r){const o=this.segments.slice(this.offset,this.limit());return r instanceof xE?r.forEach(l=>{o.push(l)}):o.push(r),this.construct(o)}limit(){return this.offset+this.length}popFirst(r){return r=r===void 0?1:r,this.construct(this.segments,this.offset+r,this.length-r)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(r){return this.segments[this.offset+r]}isEmpty(){return this.length===0}isPrefixOf(r){if(r.length<this.length)return!1;for(let o=0;o<this.length;o++)if(this.get(o)!==r.get(o))return!1;return!0}isImmediateParentOf(r){if(this.length+1!==r.length)return!1;for(let o=0;o<this.length;o++)if(this.get(o)!==r.get(o))return!1;return!0}forEach(r){for(let o=this.offset,l=this.limit();o<l;o++)r(this.segments[o])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(r,o){const l=Math.min(r.length,o.length);for(let u=0;u<l;u++){const f=r.get(u),E=o.get(u);if(f<E)return-1;if(f>E)return 1}return r.length<o.length?-1:r.length>o.length?1:0}}class vr extends xE{construct(r,o,l){return new vr(r,o,l)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...r){const o=[];for(const l of r){if(l.indexOf("//")>=0)throw new ut(je.INVALID_ARGUMENT,`Invalid segment (${l}). Paths must not contain // in them.`);o.push(...l.split("/").filter(u=>u.length>0))}return new vr(o)}static emptyPath(){return new vr([])}}const U_e=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ki extends xE{construct(r,o,l){return new Ki(r,o,l)}static isValidIdentifier(r){return U_e.test(r)}canonicalString(){return this.toArray().map(r=>(r=r.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ki.isValidIdentifier(r)||(r="`"+r+"`"),r)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Ki(["__name__"])}static fromServerFormat(r){const o=[];let l="",u=0;const f=()=>{if(l.length===0)throw new ut(je.INVALID_ARGUMENT,`Invalid field path (${r}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);o.push(l),l=""};let E=!1;for(;u<r.length;){const T=r[u];if(T==="\\"){if(u+1===r.length)throw new ut(je.INVALID_ARGUMENT,"Path has trailing escape character: "+r);const w=r[u+1];if(w!=="\\"&&w!=="."&&w!=="`")throw new ut(je.INVALID_ARGUMENT,"Path has invalid escape sequence: "+r);l+=w,u+=2}else T==="`"?(E=!E,u++):T!=="."||E?(l+=T,u++):(f(),u++)}if(f(),E)throw new ut(je.INVALID_ARGUMENT,"Unterminated ` in path: "+r);return new Ki(o)}static emptyPath(){return new Ki([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ct{constructor(r){this.path=r}static fromPath(r){return new Ct(vr.fromString(r))}static fromName(r){return new Ct(vr.fromString(r).popFirst(5))}static empty(){return new Ct(vr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(r){return this.path.length>=2&&this.path.get(this.path.length-2)===r}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(r){return r!==null&&vr.comparator(this.path,r.path)===0}toString(){return this.path.toString()}static comparator(r,o){return vr.comparator(r.path,o.path)}static isDocumentKey(r){return r.length%2==0}static fromSegments(r){return new Ct(new vr(r.slice()))}}function j_e(s,r){const o=s.toTimestamp().seconds,l=s.toTimestamp().nanoseconds+1,u=Jt.fromTimestamp(l===1e9?new Wn(o+1,0):new Wn(o,l));return new Qd(u,Ct.empty(),r)}function V_e(s){return new Qd(s.readTime,s.key,-1)}class Qd{constructor(r,o,l){this.readTime=r,this.documentKey=o,this.largestBatchId=l}static min(){return new Qd(Jt.min(),Ct.empty(),-1)}static max(){return new Qd(Jt.max(),Ct.empty(),-1)}}function F_e(s,r){let o=s.readTime.compareTo(r.readTime);return o!==0?o:(o=Ct.comparator(s.documentKey,r.documentKey),o!==0?o:kn(s.largestBatchId,r.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B_e="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class G_e{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(r){this.onCommittedListeners.push(r)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(r=>r())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JE(s){if(s.code!==je.FAILED_PRECONDITION||s.message!==B_e)throw s;gt("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Be{constructor(r){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,r(o=>{this.isDone=!0,this.result=o,this.nextCallback&&this.nextCallback(o)},o=>{this.isDone=!0,this.error=o,this.catchCallback&&this.catchCallback(o)})}catch(r){return this.next(void 0,r)}next(r,o){return this.callbackAttached&&Gt(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(o,this.error):this.wrapSuccess(r,this.result):new Be((l,u)=>{this.nextCallback=f=>{this.wrapSuccess(r,f).next(l,u)},this.catchCallback=f=>{this.wrapFailure(o,f).next(l,u)}})}toPromise(){return new Promise((r,o)=>{this.next(r,o)})}wrapUserFunction(r){try{const o=r();return o instanceof Be?o:Be.resolve(o)}catch(o){return Be.reject(o)}}wrapSuccess(r,o){return r?this.wrapUserFunction(()=>r(o)):Be.resolve(o)}wrapFailure(r,o){return r?this.wrapUserFunction(()=>r(o)):Be.reject(o)}static resolve(r){return new Be((o,l)=>{o(r)})}static reject(r){return new Be((o,l)=>{l(r)})}static waitFor(r){return new Be((o,l)=>{let u=0,f=0,E=!1;r.forEach(T=>{++u,T.next(()=>{++f,E&&f===u&&o()},w=>l(w))}),E=!0,f===u&&o()})}static or(r){let o=Be.resolve(!1);for(const l of r)o=o.next(u=>u?Be.resolve(u):l());return o}static forEach(r,o){const l=[];return r.forEach((u,f)=>{l.push(o.call(this,u,f))}),this.waitFor(l)}static mapArray(r,o){return new Be((l,u)=>{const f=r.length,E=new Array(f);let T=0;for(let w=0;w<f;w++){const A=w;o(r[A]).next(U=>{E[A]=U,++T,T===f&&l(E)},U=>u(U))}})}static doWhile(r,o){return new Be((l,u)=>{const f=()=>{r()===!0?o().next(()=>{f()},u):l()};f()})}}function W_e(s){const r=s.match(/Android ([\d.]+)/i),o=r?r[1].split(".").slice(0,2).join("."):"-1";return Number(o)}function QE(s){return s.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vD{constructor(r,o){this.previousValue=r,o&&(o.sequenceNumberHandler=l=>this.ie(l),this.se=l=>o.writeSequenceNumber(l))}ie(r){return this.previousValue=Math.max(r,this.previousValue),this.previousValue}next(){const r=++this.previousValue;return this.se&&this.se(r),r}}vD.oe=-1;function eR(s){return s==null}function pb(s){return s===0&&1/s==-1/0}function z_e(s){return typeof s=="number"&&Number.isInteger(s)&&!pb(s)&&s<=Number.MAX_SAFE_INTEGER&&s>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rz(s){let r=0;for(const o in s)Object.prototype.hasOwnProperty.call(s,o)&&r++;return r}function zh(s,r){for(const o in s)Object.prototype.hasOwnProperty.call(s,o)&&r(o,s[o])}function DK(s){for(const r in s)if(Object.prototype.hasOwnProperty.call(s,r))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gr{constructor(r,o){this.comparator=r,this.root=o||Hi.EMPTY}insert(r,o){return new Gr(this.comparator,this.root.insert(r,o,this.comparator).copy(null,null,Hi.BLACK,null,null))}remove(r){return new Gr(this.comparator,this.root.remove(r,this.comparator).copy(null,null,Hi.BLACK,null,null))}get(r){let o=this.root;for(;!o.isEmpty();){const l=this.comparator(r,o.key);if(l===0)return o.value;l<0?o=o.left:l>0&&(o=o.right)}return null}indexOf(r){let o=0,l=this.root;for(;!l.isEmpty();){const u=this.comparator(r,l.key);if(u===0)return o+l.left.size;u<0?l=l.left:(o+=l.left.size+1,l=l.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(r){return this.root.inorderTraversal(r)}forEach(r){this.inorderTraversal((o,l)=>(r(o,l),!1))}toString(){const r=[];return this.inorderTraversal((o,l)=>(r.push(`${o}:${l}`),!1)),`{${r.join(", ")}}`}reverseTraversal(r){return this.root.reverseTraversal(r)}getIterator(){return new o0(this.root,null,this.comparator,!1)}getIteratorFrom(r){return new o0(this.root,r,this.comparator,!1)}getReverseIterator(){return new o0(this.root,null,this.comparator,!0)}getReverseIteratorFrom(r){return new o0(this.root,r,this.comparator,!0)}}class o0{constructor(r,o,l,u){this.isReverse=u,this.nodeStack=[];let f=1;for(;!r.isEmpty();)if(f=o?l(r.key,o):1,o&&u&&(f*=-1),f<0)r=this.isReverse?r.left:r.right;else{if(f===0){this.nodeStack.push(r);break}this.nodeStack.push(r),r=this.isReverse?r.right:r.left}}getNext(){let r=this.nodeStack.pop();const o={key:r.key,value:r.value};if(this.isReverse)for(r=r.left;!r.isEmpty();)this.nodeStack.push(r),r=r.right;else for(r=r.right;!r.isEmpty();)this.nodeStack.push(r),r=r.left;return o}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const r=this.nodeStack[this.nodeStack.length-1];return{key:r.key,value:r.value}}}class Hi{constructor(r,o,l,u,f){this.key=r,this.value=o,this.color=l??Hi.RED,this.left=u??Hi.EMPTY,this.right=f??Hi.EMPTY,this.size=this.left.size+1+this.right.size}copy(r,o,l,u,f){return new Hi(r??this.key,o??this.value,l??this.color,u??this.left,f??this.right)}isEmpty(){return!1}inorderTraversal(r){return this.left.inorderTraversal(r)||r(this.key,this.value)||this.right.inorderTraversal(r)}reverseTraversal(r){return this.right.reverseTraversal(r)||r(this.key,this.value)||this.left.reverseTraversal(r)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(r,o,l){let u=this;const f=l(r,u.key);return u=f<0?u.copy(null,null,null,u.left.insert(r,o,l),null):f===0?u.copy(null,o,null,null,null):u.copy(null,null,null,null,u.right.insert(r,o,l)),u.fixUp()}removeMin(){if(this.left.isEmpty())return Hi.EMPTY;let r=this;return r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.removeMin(),null),r.fixUp()}remove(r,o){let l,u=this;if(o(r,u.key)<0)u.left.isEmpty()||u.left.isRed()||u.left.left.isRed()||(u=u.moveRedLeft()),u=u.copy(null,null,null,u.left.remove(r,o),null);else{if(u.left.isRed()&&(u=u.rotateRight()),u.right.isEmpty()||u.right.isRed()||u.right.left.isRed()||(u=u.moveRedRight()),o(r,u.key)===0){if(u.right.isEmpty())return Hi.EMPTY;l=u.right.min(),u=u.copy(l.key,l.value,null,null,u.right.removeMin())}u=u.copy(null,null,null,null,u.right.remove(r,o))}return u.fixUp()}isRed(){return this.color}fixUp(){let r=this;return r.right.isRed()&&!r.left.isRed()&&(r=r.rotateLeft()),r.left.isRed()&&r.left.left.isRed()&&(r=r.rotateRight()),r.left.isRed()&&r.right.isRed()&&(r=r.colorFlip()),r}moveRedLeft(){let r=this.colorFlip();return r.right.left.isRed()&&(r=r.copy(null,null,null,null,r.right.rotateRight()),r=r.rotateLeft(),r=r.colorFlip()),r}moveRedRight(){let r=this.colorFlip();return r.left.left.isRed()&&(r=r.rotateRight(),r=r.colorFlip()),r}rotateLeft(){const r=this.copy(null,null,Hi.RED,null,this.right.left);return this.right.copy(null,null,this.color,r,null)}rotateRight(){const r=this.copy(null,null,Hi.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,r)}colorFlip(){const r=this.left.copy(null,null,!this.left.color,null,null),o=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,r,o)}checkMaxDepth(){const r=this.check();return Math.pow(2,r)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Gt();const r=this.left.check();if(r!==this.right.check())throw Gt();return r+(this.isRed()?0:1)}}Hi.EMPTY=null,Hi.RED=!0,Hi.BLACK=!1;Hi.EMPTY=new class{constructor(){this.size=0}get key(){throw Gt()}get value(){throw Gt()}get color(){throw Gt()}get left(){throw Gt()}get right(){throw Gt()}copy(r,o,l,u,f){return this}insert(r,o,l){return new Hi(r,o)}remove(r,o){return this}isEmpty(){return!0}inorderTraversal(r){return!1}reverseTraversal(r){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yi{constructor(r){this.comparator=r,this.data=new Gr(this.comparator)}has(r){return this.data.get(r)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(r){return this.data.indexOf(r)}forEach(r){this.data.inorderTraversal((o,l)=>(r(o),!1))}forEachInRange(r,o){const l=this.data.getIteratorFrom(r[0]);for(;l.hasNext();){const u=l.getNext();if(this.comparator(u.key,r[1])>=0)return;o(u.key)}}forEachWhile(r,o){let l;for(l=o!==void 0?this.data.getIteratorFrom(o):this.data.getIterator();l.hasNext();)if(!r(l.getNext().key))return}firstAfterOrEqual(r){const o=this.data.getIteratorFrom(r);return o.hasNext()?o.getNext().key:null}getIterator(){return new iz(this.data.getIterator())}getIteratorFrom(r){return new iz(this.data.getIteratorFrom(r))}add(r){return this.copy(this.data.remove(r).insert(r,!0))}delete(r){return this.has(r)?this.copy(this.data.remove(r)):this}isEmpty(){return this.data.isEmpty()}unionWith(r){let o=this;return o.size<r.size&&(o=r,r=this),r.forEach(l=>{o=o.add(l)}),o}isEqual(r){if(!(r instanceof Yi)||this.size!==r.size)return!1;const o=this.data.getIterator(),l=r.data.getIterator();for(;o.hasNext();){const u=o.getNext().key,f=l.getNext().key;if(this.comparator(u,f)!==0)return!1}return!0}toArray(){const r=[];return this.forEach(o=>{r.push(o)}),r}toString(){const r=[];return this.forEach(o=>r.push(o)),"SortedSet("+r.toString()+")"}copy(r){const o=new Yi(this.comparator);return o.data=r,o}}class iz{constructor(r){this.iter=r}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _o{constructor(r){this.fields=r,r.sort(Ki.comparator)}static empty(){return new _o([])}unionWith(r){let o=new Yi(Ki.comparator);for(const l of this.fields)o=o.add(l);for(const l of r)o=o.add(l);return new _o(o.toArray())}covers(r){for(const o of this.fields)if(o.isPrefixOf(r))return!0;return!1}isEqual(r){return uf(this.fields,r.fields,(o,l)=>o.isEqual(l))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kK extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ji{constructor(r){this.binaryString=r}static fromBase64String(r){const o=function(u){try{return atob(u)}catch(f){throw typeof DOMException<"u"&&f instanceof DOMException?new kK("Invalid base64 string: "+f):f}}(r);return new Ji(o)}static fromUint8Array(r){const o=function(u){let f="";for(let E=0;E<u.length;++E)f+=String.fromCharCode(u[E]);return f}(r);return new Ji(o)}[Symbol.iterator](){let r=0;return{next:()=>r<this.binaryString.length?{value:this.binaryString.charCodeAt(r++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(o){return btoa(o)}(this.binaryString)}toUint8Array(){return function(o){const l=new Uint8Array(o.length);for(let u=0;u<o.length;u++)l[u]=o.charCodeAt(u);return l}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(r){return kn(this.binaryString,r.binaryString)}isEqual(r){return this.binaryString===r.binaryString}}Ji.EMPTY_BYTE_STRING=new Ji("");const H_e=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function $d(s){if(Jn(!!s),typeof s=="string"){let r=0;const o=H_e.exec(s);if(Jn(!!o),o[1]){let u=o[1];u=(u+"000000000").substr(0,9),r=Number(u)}const l=new Date(s);return{seconds:Math.floor(l.getTime()/1e3),nanos:r}}return{seconds:Qr(s.seconds),nanos:Qr(s.nanos)}}function Qr(s){return typeof s=="number"?s:typeof s=="string"?Number(s):0}function Vh(s){return typeof s=="string"?Ji.fromBase64String(s):Ji.fromUint8Array(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yD(s){var r,o;return((o=(((r=s==null?void 0:s.mapValue)===null||r===void 0?void 0:r.fields)||{}).__type__)===null||o===void 0?void 0:o.stringValue)==="server_timestamp"}function SD(s){const r=s.mapValue.fields.__previous_value__;return yD(r)?SD(r):r}function OE(s){const r=$d(s.mapValue.fields.__local_write_time__.timestampValue);return new Wn(r.seconds,r.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K_e{constructor(r,o,l,u,f,E,T,w,A){this.databaseId=r,this.appId=o,this.persistenceKey=l,this.host=u,this.ssl=f,this.forceLongPolling=E,this.autoDetectLongPolling=T,this.longPollingOptions=w,this.useFetchStreams=A}}class PE{constructor(r,o){this.projectId=r,this.database=o||"(default)"}static empty(){return new PE("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(r){return r instanceof PE&&r.projectId===this.projectId&&r.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a0={mapValue:{}};function Fh(s){return"nullValue"in s?0:"booleanValue"in s?1:"integerValue"in s||"doubleValue"in s?2:"timestampValue"in s?3:"stringValue"in s?5:"bytesValue"in s?6:"referenceValue"in s?7:"geoPointValue"in s?8:"arrayValue"in s?9:"mapValue"in s?yD(s)?4:Y_e(s)?9007199254740991:q_e(s)?10:11:Gt()}function Nc(s,r){if(s===r)return!0;const o=Fh(s);if(o!==Fh(r))return!1;switch(o){case 0:case 9007199254740991:return!0;case 1:return s.booleanValue===r.booleanValue;case 4:return OE(s).isEqual(OE(r));case 3:return function(u,f){if(typeof u.timestampValue=="string"&&typeof f.timestampValue=="string"&&u.timestampValue.length===f.timestampValue.length)return u.timestampValue===f.timestampValue;const E=$d(u.timestampValue),T=$d(f.timestampValue);return E.seconds===T.seconds&&E.nanos===T.nanos}(s,r);case 5:return s.stringValue===r.stringValue;case 6:return function(u,f){return Vh(u.bytesValue).isEqual(Vh(f.bytesValue))}(s,r);case 7:return s.referenceValue===r.referenceValue;case 8:return function(u,f){return Qr(u.geoPointValue.latitude)===Qr(f.geoPointValue.latitude)&&Qr(u.geoPointValue.longitude)===Qr(f.geoPointValue.longitude)}(s,r);case 2:return function(u,f){if("integerValue"in u&&"integerValue"in f)return Qr(u.integerValue)===Qr(f.integerValue);if("doubleValue"in u&&"doubleValue"in f){const E=Qr(u.doubleValue),T=Qr(f.doubleValue);return E===T?pb(E)===pb(T):isNaN(E)&&isNaN(T)}return!1}(s,r);case 9:return uf(s.arrayValue.values||[],r.arrayValue.values||[],Nc);case 10:case 11:return function(u,f){const E=u.mapValue.fields||{},T=f.mapValue.fields||{};if(rz(E)!==rz(T))return!1;for(const w in E)if(E.hasOwnProperty(w)&&(T[w]===void 0||!Nc(E[w],T[w])))return!1;return!0}(s,r);default:return Gt()}}function DE(s,r){return(s.values||[]).find(o=>Nc(o,r))!==void 0}function hf(s,r){if(s===r)return 0;const o=Fh(s),l=Fh(r);if(o!==l)return kn(o,l);switch(o){case 0:case 9007199254740991:return 0;case 1:return kn(s.booleanValue,r.booleanValue);case 2:return function(f,E){const T=Qr(f.integerValue||f.doubleValue),w=Qr(E.integerValue||E.doubleValue);return T<w?-1:T>w?1:T===w?0:isNaN(T)?isNaN(w)?0:-1:1}(s,r);case 3:return sz(s.timestampValue,r.timestampValue);case 4:return sz(OE(s),OE(r));case 5:return kn(s.stringValue,r.stringValue);case 6:return function(f,E){const T=Vh(f),w=Vh(E);return T.compareTo(w)}(s.bytesValue,r.bytesValue);case 7:return function(f,E){const T=f.split("/"),w=E.split("/");for(let A=0;A<T.length&&A<w.length;A++){const U=kn(T[A],w[A]);if(U!==0)return U}return kn(T.length,w.length)}(s.referenceValue,r.referenceValue);case 8:return function(f,E){const T=kn(Qr(f.latitude),Qr(E.latitude));return T!==0?T:kn(Qr(f.longitude),Qr(E.longitude))}(s.geoPointValue,r.geoPointValue);case 9:return oz(s.arrayValue,r.arrayValue);case 10:return function(f,E){var T,w,A,U;const M=f.fields||{},F=E.fields||{},Y=(T=M.value)===null||T===void 0?void 0:T.arrayValue,J=(w=F.value)===null||w===void 0?void 0:w.arrayValue,ae=kn(((A=Y==null?void 0:Y.values)===null||A===void 0?void 0:A.length)||0,((U=J==null?void 0:J.values)===null||U===void 0?void 0:U.length)||0);return ae!==0?ae:oz(Y,J)}(s.mapValue,r.mapValue);case 11:return function(f,E){if(f===a0.mapValue&&E===a0.mapValue)return 0;if(f===a0.mapValue)return 1;if(E===a0.mapValue)return-1;const T=f.fields||{},w=Object.keys(T),A=E.fields||{},U=Object.keys(A);w.sort(),U.sort();for(let M=0;M<w.length&&M<U.length;++M){const F=kn(w[M],U[M]);if(F!==0)return F;const Y=hf(T[w[M]],A[U[M]]);if(Y!==0)return Y}return kn(w.length,U.length)}(s.mapValue,r.mapValue);default:throw Gt()}}function sz(s,r){if(typeof s=="string"&&typeof r=="string"&&s.length===r.length)return kn(s,r);const o=$d(s),l=$d(r),u=kn(o.seconds,l.seconds);return u!==0?u:kn(o.nanos,l.nanos)}function oz(s,r){const o=s.values||[],l=r.values||[];for(let u=0;u<o.length&&u<l.length;++u){const f=hf(o[u],l[u]);if(f)return f}return kn(o.length,l.length)}function pf(s){return GO(s)}function GO(s){return"nullValue"in s?"null":"booleanValue"in s?""+s.booleanValue:"integerValue"in s?""+s.integerValue:"doubleValue"in s?""+s.doubleValue:"timestampValue"in s?function(o){const l=$d(o);return`time(${l.seconds},${l.nanos})`}(s.timestampValue):"stringValue"in s?s.stringValue:"bytesValue"in s?function(o){return Vh(o).toBase64()}(s.bytesValue):"referenceValue"in s?function(o){return Ct.fromName(o).toString()}(s.referenceValue):"geoPointValue"in s?function(o){return`geo(${o.latitude},${o.longitude})`}(s.geoPointValue):"arrayValue"in s?function(o){let l="[",u=!0;for(const f of o.values||[])u?u=!1:l+=",",l+=GO(f);return l+"]"}(s.arrayValue):"mapValue"in s?function(o){const l=Object.keys(o.fields||{}).sort();let u="{",f=!0;for(const E of l)f?f=!1:u+=",",u+=`${E}:${GO(o.fields[E])}`;return u+"}"}(s.mapValue):Gt()}function az(s,r){return{referenceValue:`projects/${s.projectId}/databases/${s.database}/documents/${r.path.canonicalString()}`}}function WO(s){return!!s&&"integerValue"in s}function TD(s){return!!s&&"arrayValue"in s}function cz(s){return!!s&&"nullValue"in s}function lz(s){return!!s&&"doubleValue"in s&&isNaN(Number(s.doubleValue))}function I0(s){return!!s&&"mapValue"in s}function q_e(s){var r,o;return((o=(((r=s==null?void 0:s.mapValue)===null||r===void 0?void 0:r.fields)||{}).__type__)===null||o===void 0?void 0:o.stringValue)==="__vector__"}function tE(s){if(s.geoPointValue)return{geoPointValue:Object.assign({},s.geoPointValue)};if(s.timestampValue&&typeof s.timestampValue=="object")return{timestampValue:Object.assign({},s.timestampValue)};if(s.mapValue){const r={mapValue:{fields:{}}};return zh(s.mapValue.fields,(o,l)=>r.mapValue.fields[o]=tE(l)),r}if(s.arrayValue){const r={arrayValue:{values:[]}};for(let o=0;o<(s.arrayValue.values||[]).length;++o)r.arrayValue.values[o]=tE(s.arrayValue.values[o]);return r}return Object.assign({},s)}function Y_e(s){return(((s.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qs{constructor(r){this.value=r}static empty(){return new qs({mapValue:{}})}field(r){if(r.isEmpty())return this.value;{let o=this.value;for(let l=0;l<r.length-1;++l)if(o=(o.mapValue.fields||{})[r.get(l)],!I0(o))return null;return o=(o.mapValue.fields||{})[r.lastSegment()],o||null}}set(r,o){this.getFieldsMap(r.popLast())[r.lastSegment()]=tE(o)}setAll(r){let o=Ki.emptyPath(),l={},u=[];r.forEach((E,T)=>{if(!o.isImmediateParentOf(T)){const w=this.getFieldsMap(o);this.applyChanges(w,l,u),l={},u=[],o=T.popLast()}E?l[T.lastSegment()]=tE(E):u.push(T.lastSegment())});const f=this.getFieldsMap(o);this.applyChanges(f,l,u)}delete(r){const o=this.field(r.popLast());I0(o)&&o.mapValue.fields&&delete o.mapValue.fields[r.lastSegment()]}isEqual(r){return Nc(this.value,r.value)}getFieldsMap(r){let o=this.value;o.mapValue.fields||(o.mapValue={fields:{}});for(let l=0;l<r.length;++l){let u=o.mapValue.fields[r.get(l)];I0(u)&&u.mapValue.fields||(u={mapValue:{fields:{}}},o.mapValue.fields[r.get(l)]=u),o=u}return o.mapValue.fields}applyChanges(r,o,l){zh(o,(u,f)=>r[u]=f);for(const u of l)delete r[u]}clone(){return new qs(tE(this.value))}}function LK(s){const r=[];return zh(s.fields,(o,l)=>{const u=new Ki([o]);if(I0(l)){const f=LK(l.mapValue).fields;if(f.length===0)r.push(u);else for(const E of f)r.push(u.child(E))}else r.push(u)}),new _o(r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ls{constructor(r,o,l,u,f,E,T){this.key=r,this.documentType=o,this.version=l,this.readTime=u,this.createTime=f,this.data=E,this.documentState=T}static newInvalidDocument(r){return new ls(r,0,Jt.min(),Jt.min(),Jt.min(),qs.empty(),0)}static newFoundDocument(r,o,l,u){return new ls(r,1,o,Jt.min(),l,u,0)}static newNoDocument(r,o){return new ls(r,2,o,Jt.min(),Jt.min(),qs.empty(),0)}static newUnknownDocument(r,o){return new ls(r,3,o,Jt.min(),Jt.min(),qs.empty(),2)}convertToFoundDocument(r,o){return!this.createTime.isEqual(Jt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=r),this.version=r,this.documentType=1,this.data=o,this.documentState=0,this}convertToNoDocument(r){return this.version=r,this.documentType=2,this.data=qs.empty(),this.documentState=0,this}convertToUnknownDocument(r){return this.version=r,this.documentType=3,this.data=qs.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Jt.min(),this}setReadTime(r){return this.readTime=r,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(r){return r instanceof ls&&this.key.isEqual(r.key)&&this.version.isEqual(r.version)&&this.documentType===r.documentType&&this.documentState===r.documentState&&this.data.isEqual(r.data)}mutableCopy(){return new ls(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mb{constructor(r,o){this.position=r,this.inclusive=o}}function dz(s,r,o){let l=0;for(let u=0;u<s.position.length;u++){const f=r[u],E=s.position[u];if(f.field.isKeyField()?l=Ct.comparator(Ct.fromName(E.referenceValue),o.key):l=hf(E,o.data.field(f.field)),f.dir==="desc"&&(l*=-1),l!==0)break}return l}function uz(s,r){if(s===null)return r===null;if(r===null||s.inclusive!==r.inclusive||s.position.length!==r.position.length)return!1;for(let o=0;o<s.position.length;o++)if(!Nc(s.position[o],r.position[o]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kE{constructor(r,o="asc"){this.field=r,this.dir=o}}function X_e(s,r){return s.dir===r.dir&&s.field.isEqual(r.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MK{}class oi extends MK{constructor(r,o,l){super(),this.field=r,this.op=o,this.value=l}static create(r,o,l){return r.isKeyField()?o==="in"||o==="not-in"?this.createKeyFieldInFilter(r,o,l):new Q_e(r,o,l):o==="array-contains"?new eEe(r,l):o==="in"?new tEe(r,l):o==="not-in"?new nEe(r,l):o==="array-contains-any"?new rEe(r,l):new oi(r,o,l)}static createKeyFieldInFilter(r,o,l){return o==="in"?new $_e(r,l):new Z_e(r,l)}matches(r){const o=r.data.field(this.field);return this.op==="!="?o!==null&&this.matchesComparison(hf(o,this.value)):o!==null&&Fh(this.value)===Fh(o)&&this.matchesComparison(hf(o,this.value))}matchesComparison(r){switch(this.op){case"<":return r<0;case"<=":return r<=0;case"==":return r===0;case"!=":return r!==0;case">":return r>0;case">=":return r>=0;default:return Gt()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ba extends MK{constructor(r,o){super(),this.filters=r,this.op=o,this.ae=null}static create(r,o){return new Ba(r,o)}matches(r){return UK(this)?this.filters.find(o=>!o.matches(r))===void 0:this.filters.find(o=>o.matches(r))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((r,o)=>r.concat(o.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function UK(s){return s.op==="and"}function jK(s){return J_e(s)&&UK(s)}function J_e(s){for(const r of s.filters)if(r instanceof Ba)return!1;return!0}function zO(s){if(s instanceof oi)return s.field.canonicalString()+s.op.toString()+pf(s.value);if(jK(s))return s.filters.map(r=>zO(r)).join(",");{const r=s.filters.map(o=>zO(o)).join(",");return`${s.op}(${r})`}}function VK(s,r){return s instanceof oi?function(l,u){return u instanceof oi&&l.op===u.op&&l.field.isEqual(u.field)&&Nc(l.value,u.value)}(s,r):s instanceof Ba?function(l,u){return u instanceof Ba&&l.op===u.op&&l.filters.length===u.filters.length?l.filters.reduce((f,E,T)=>f&&VK(E,u.filters[T]),!0):!1}(s,r):void Gt()}function FK(s){return s instanceof oi?function(o){return`${o.field.canonicalString()} ${o.op} ${pf(o.value)}`}(s):s instanceof Ba?function(o){return o.op.toString()+" {"+o.getFilters().map(FK).join(" ,")+"}"}(s):"Filter"}class Q_e extends oi{constructor(r,o,l){super(r,o,l),this.key=Ct.fromName(l.referenceValue)}matches(r){const o=Ct.comparator(r.key,this.key);return this.matchesComparison(o)}}class $_e extends oi{constructor(r,o){super(r,"in",o),this.keys=BK("in",o)}matches(r){return this.keys.some(o=>o.isEqual(r.key))}}class Z_e extends oi{constructor(r,o){super(r,"not-in",o),this.keys=BK("not-in",o)}matches(r){return!this.keys.some(o=>o.isEqual(r.key))}}function BK(s,r){var o;return(((o=r.arrayValue)===null||o===void 0?void 0:o.values)||[]).map(l=>Ct.fromName(l.referenceValue))}class eEe extends oi{constructor(r,o){super(r,"array-contains",o)}matches(r){const o=r.data.field(this.field);return TD(o)&&DE(o.arrayValue,this.value)}}class tEe extends oi{constructor(r,o){super(r,"in",o)}matches(r){const o=r.data.field(this.field);return o!==null&&DE(this.value.arrayValue,o)}}class nEe extends oi{constructor(r,o){super(r,"not-in",o)}matches(r){if(DE(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const o=r.data.field(this.field);return o!==null&&!DE(this.value.arrayValue,o)}}class rEe extends oi{constructor(r,o){super(r,"array-contains-any",o)}matches(r){const o=r.data.field(this.field);return!(!TD(o)||!o.arrayValue.values)&&o.arrayValue.values.some(l=>DE(this.value.arrayValue,l))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iEe{constructor(r,o=null,l=[],u=[],f=null,E=null,T=null){this.path=r,this.collectionGroup=o,this.orderBy=l,this.filters=u,this.limit=f,this.startAt=E,this.endAt=T,this.ue=null}}function hz(s,r=null,o=[],l=[],u=null,f=null,E=null){return new iEe(s,r,o,l,u,f,E)}function bD(s){const r=$t(s);if(r.ue===null){let o=r.path.canonicalString();r.collectionGroup!==null&&(o+="|cg:"+r.collectionGroup),o+="|f:",o+=r.filters.map(l=>zO(l)).join(","),o+="|ob:",o+=r.orderBy.map(l=>function(f){return f.field.canonicalString()+f.dir}(l)).join(","),eR(r.limit)||(o+="|l:",o+=r.limit),r.startAt&&(o+="|lb:",o+=r.startAt.inclusive?"b:":"a:",o+=r.startAt.position.map(l=>pf(l)).join(",")),r.endAt&&(o+="|ub:",o+=r.endAt.inclusive?"a:":"b:",o+=r.endAt.position.map(l=>pf(l)).join(",")),r.ue=o}return r.ue}function RD(s,r){if(s.limit!==r.limit||s.orderBy.length!==r.orderBy.length)return!1;for(let o=0;o<s.orderBy.length;o++)if(!X_e(s.orderBy[o],r.orderBy[o]))return!1;if(s.filters.length!==r.filters.length)return!1;for(let o=0;o<s.filters.length;o++)if(!VK(s.filters[o],r.filters[o]))return!1;return s.collectionGroup===r.collectionGroup&&!!s.path.isEqual(r.path)&&!!uz(s.startAt,r.startAt)&&uz(s.endAt,r.endAt)}function HO(s){return Ct.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class If{constructor(r,o=null,l=[],u=[],f=null,E="F",T=null,w=null){this.path=r,this.collectionGroup=o,this.explicitOrderBy=l,this.filters=u,this.limit=f,this.limitType=E,this.startAt=T,this.endAt=w,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function sEe(s,r,o,l,u,f,E,T){return new If(s,r,o,l,u,f,E,T)}function tR(s){return new If(s)}function pz(s){return s.filters.length===0&&s.limit===null&&s.startAt==null&&s.endAt==null&&(s.explicitOrderBy.length===0||s.explicitOrderBy.length===1&&s.explicitOrderBy[0].field.isKeyField())}function GK(s){return s.collectionGroup!==null}function nE(s){const r=$t(s);if(r.ce===null){r.ce=[];const o=new Set;for(const f of r.explicitOrderBy)r.ce.push(f),o.add(f.field.canonicalString());const l=r.explicitOrderBy.length>0?r.explicitOrderBy[r.explicitOrderBy.length-1].dir:"asc";(function(E){let T=new Yi(Ki.comparator);return E.filters.forEach(w=>{w.getFlattenedFilters().forEach(A=>{A.isInequality()&&(T=T.add(A.field))})}),T})(r).forEach(f=>{o.has(f.canonicalString())||f.isKeyField()||r.ce.push(new kE(f,l))}),o.has(Ki.keyField().canonicalString())||r.ce.push(new kE(Ki.keyField(),l))}return r.ce}function Ic(s){const r=$t(s);return r.le||(r.le=oEe(r,nE(s))),r.le}function oEe(s,r){if(s.limitType==="F")return hz(s.path,s.collectionGroup,r,s.filters,s.limit,s.startAt,s.endAt);{r=r.map(u=>{const f=u.dir==="desc"?"asc":"desc";return new kE(u.field,f)});const o=s.endAt?new mb(s.endAt.position,s.endAt.inclusive):null,l=s.startAt?new mb(s.startAt.position,s.startAt.inclusive):null;return hz(s.path,s.collectionGroup,r,s.filters,s.limit,o,l)}}function KO(s,r){const o=s.filters.concat([r]);return new If(s.path,s.collectionGroup,s.explicitOrderBy.slice(),o,s.limit,s.limitType,s.startAt,s.endAt)}function fb(s,r,o){return new If(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),r,o,s.startAt,s.endAt)}function nR(s,r){return RD(Ic(s),Ic(r))&&s.limitType===r.limitType}function WK(s){return`${bD(Ic(s))}|lt:${s.limitType}`}function Im(s){return`Query(target=${function(o){let l=o.path.canonicalString();return o.collectionGroup!==null&&(l+=" collectionGroup="+o.collectionGroup),o.filters.length>0&&(l+=`, filters: [${o.filters.map(u=>FK(u)).join(", ")}]`),eR(o.limit)||(l+=", limit: "+o.limit),o.orderBy.length>0&&(l+=`, orderBy: [${o.orderBy.map(u=>function(E){return`${E.field.canonicalString()} (${E.dir})`}(u)).join(", ")}]`),o.startAt&&(l+=", startAt: ",l+=o.startAt.inclusive?"b:":"a:",l+=o.startAt.position.map(u=>pf(u)).join(",")),o.endAt&&(l+=", endAt: ",l+=o.endAt.inclusive?"a:":"b:",l+=o.endAt.position.map(u=>pf(u)).join(",")),`Target(${l})`}(Ic(s))}; limitType=${s.limitType})`}function rR(s,r){return r.isFoundDocument()&&function(l,u){const f=u.key.path;return l.collectionGroup!==null?u.key.hasCollectionId(l.collectionGroup)&&l.path.isPrefixOf(f):Ct.isDocumentKey(l.path)?l.path.isEqual(f):l.path.isImmediateParentOf(f)}(s,r)&&function(l,u){for(const f of nE(l))if(!f.field.isKeyField()&&u.data.field(f.field)===null)return!1;return!0}(s,r)&&function(l,u){for(const f of l.filters)if(!f.matches(u))return!1;return!0}(s,r)&&function(l,u){return!(l.startAt&&!function(E,T,w){const A=dz(E,T,w);return E.inclusive?A<=0:A<0}(l.startAt,nE(l),u)||l.endAt&&!function(E,T,w){const A=dz(E,T,w);return E.inclusive?A>=0:A>0}(l.endAt,nE(l),u))}(s,r)}function aEe(s){return s.collectionGroup||(s.path.length%2==1?s.path.lastSegment():s.path.get(s.path.length-2))}function zK(s){return(r,o)=>{let l=!1;for(const u of nE(s)){const f=cEe(u,r,o);if(f!==0)return f;l=l||u.field.isKeyField()}return 0}}function cEe(s,r,o){const l=s.field.isKeyField()?Ct.comparator(r.key,o.key):function(f,E,T){const w=E.data.field(f),A=T.data.field(f);return w!==null&&A!==null?hf(w,A):Gt()}(s.field,r,o);switch(s.dir){case"asc":return l;case"desc":return-1*l;default:return Gt()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Af{constructor(r,o){this.mapKeyFn=r,this.equalsFn=o,this.inner={},this.innerSize=0}get(r){const o=this.mapKeyFn(r),l=this.inner[o];if(l!==void 0){for(const[u,f]of l)if(this.equalsFn(u,r))return f}}has(r){return this.get(r)!==void 0}set(r,o){const l=this.mapKeyFn(r),u=this.inner[l];if(u===void 0)return this.inner[l]=[[r,o]],void this.innerSize++;for(let f=0;f<u.length;f++)if(this.equalsFn(u[f][0],r))return void(u[f]=[r,o]);u.push([r,o]),this.innerSize++}delete(r){const o=this.mapKeyFn(r),l=this.inner[o];if(l===void 0)return!1;for(let u=0;u<l.length;u++)if(this.equalsFn(l[u][0],r))return l.length===1?delete this.inner[o]:l.splice(u,1),this.innerSize--,!0;return!1}forEach(r){zh(this.inner,(o,l)=>{for(const[u,f]of l)r(u,f)})}isEmpty(){return DK(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lEe=new Gr(Ct.comparator);function wl(){return lEe}const HK=new Gr(Ct.comparator);function F_(...s){let r=HK;for(const o of s)r=r.insert(o.key,o);return r}function KK(s){let r=HK;return s.forEach((o,l)=>r=r.insert(o,l.overlayedDocument)),r}function Sh(){return rE()}function qK(){return rE()}function rE(){return new Af(s=>s.toString(),(s,r)=>s.isEqual(r))}const dEe=new Gr(Ct.comparator),uEe=new Yi(Ct.comparator);function Tn(...s){let r=uEe;for(const o of s)r=r.add(o);return r}const hEe=new Yi(kn);function pEe(){return hEe}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wD(s,r){if(s.useProto3Json){if(isNaN(r))return{doubleValue:"NaN"};if(r===1/0)return{doubleValue:"Infinity"};if(r===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:pb(r)?"-0":r}}function YK(s){return{integerValue:""+s}}function mEe(s,r){return z_e(r)?YK(r):wD(s,r)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iR{constructor(){this._=void 0}}function fEe(s,r,o){return s instanceof LE?function(u,f){const E={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:u.seconds,nanos:u.nanoseconds}}}};return f&&yD(f)&&(f=SD(f)),f&&(E.fields.__previous_value__=f),{mapValue:E}}(o,r):s instanceof mf?JK(s,r):s instanceof ME?QK(s,r):function(u,f){const E=XK(u,f),T=mz(E)+mz(u.Pe);return WO(E)&&WO(u.Pe)?YK(T):wD(u.serializer,T)}(s,r)}function gEe(s,r,o){return s instanceof mf?JK(s,r):s instanceof ME?QK(s,r):o}function XK(s,r){return s instanceof gb?function(l){return WO(l)||function(f){return!!f&&"doubleValue"in f}(l)}(r)?r:{integerValue:0}:null}class LE extends iR{}class mf extends iR{constructor(r){super(),this.elements=r}}function JK(s,r){const o=$K(r);for(const l of s.elements)o.some(u=>Nc(u,l))||o.push(l);return{arrayValue:{values:o}}}class ME extends iR{constructor(r){super(),this.elements=r}}function QK(s,r){let o=$K(r);for(const l of s.elements)o=o.filter(u=>!Nc(u,l));return{arrayValue:{values:o}}}class gb extends iR{constructor(r,o){super(),this.serializer=r,this.Pe=o}}function mz(s){return Qr(s.integerValue||s.doubleValue)}function $K(s){return TD(s)&&s.arrayValue.values?s.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZK{constructor(r,o){this.field=r,this.transform=o}}function _Ee(s,r){return s.field.isEqual(r.field)&&function(l,u){return l instanceof mf&&u instanceof mf||l instanceof ME&&u instanceof ME?uf(l.elements,u.elements,Nc):l instanceof gb&&u instanceof gb?Nc(l.Pe,u.Pe):l instanceof LE&&u instanceof LE}(s.transform,r.transform)}class EEe{constructor(r,o){this.version=r,this.transformResults=o}}class ja{constructor(r,o){this.updateTime=r,this.exists=o}static none(){return new ja}static exists(r){return new ja(void 0,r)}static updateTime(r){return new ja(r)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(r){return this.exists===r.exists&&(this.updateTime?!!r.updateTime&&this.updateTime.isEqual(r.updateTime):!r.updateTime)}}function A0(s,r){return s.updateTime!==void 0?r.isFoundDocument()&&r.version.isEqual(s.updateTime):s.exists===void 0||s.exists===r.isFoundDocument()}class sR{}function e7(s,r){if(!s.hasLocalMutations||r&&r.fields.length===0)return null;if(r===null)return s.isNoDocument()?new n7(s.key,ja.none()):new $E(s.key,s.data,ja.none());{const o=s.data,l=qs.empty();let u=new Yi(Ki.comparator);for(let f of r.fields)if(!u.has(f)){let E=o.field(f);E===null&&f.length>1&&(f=f.popLast(),E=o.field(f)),E===null?l.delete(f):l.set(f,E),u=u.add(f)}return new au(s.key,l,new _o(u.toArray()),ja.none())}}function vEe(s,r,o){s instanceof $E?function(u,f,E){const T=u.value.clone(),w=gz(u.fieldTransforms,f,E.transformResults);T.setAll(w),f.convertToFoundDocument(E.version,T).setHasCommittedMutations()}(s,r,o):s instanceof au?function(u,f,E){if(!A0(u.precondition,f))return void f.convertToUnknownDocument(E.version);const T=gz(u.fieldTransforms,f,E.transformResults),w=f.data;w.setAll(t7(u)),w.setAll(T),f.convertToFoundDocument(E.version,w).setHasCommittedMutations()}(s,r,o):function(u,f,E){f.convertToNoDocument(E.version).setHasCommittedMutations()}(0,r,o)}function iE(s,r,o,l){return s instanceof $E?function(f,E,T,w){if(!A0(f.precondition,E))return T;const A=f.value.clone(),U=_z(f.fieldTransforms,w,E);return A.setAll(U),E.convertToFoundDocument(E.version,A).setHasLocalMutations(),null}(s,r,o,l):s instanceof au?function(f,E,T,w){if(!A0(f.precondition,E))return T;const A=_z(f.fieldTransforms,w,E),U=E.data;return U.setAll(t7(f)),U.setAll(A),E.convertToFoundDocument(E.version,U).setHasLocalMutations(),T===null?null:T.unionWith(f.fieldMask.fields).unionWith(f.fieldTransforms.map(M=>M.field))}(s,r,o,l):function(f,E,T){return A0(f.precondition,E)?(E.convertToNoDocument(E.version).setHasLocalMutations(),null):T}(s,r,o)}function yEe(s,r){let o=null;for(const l of s.fieldTransforms){const u=r.data.field(l.field),f=XK(l.transform,u||null);f!=null&&(o===null&&(o=qs.empty()),o.set(l.field,f))}return o||null}function fz(s,r){return s.type===r.type&&!!s.key.isEqual(r.key)&&!!s.precondition.isEqual(r.precondition)&&!!function(l,u){return l===void 0&&u===void 0||!(!l||!u)&&uf(l,u,(f,E)=>_Ee(f,E))}(s.fieldTransforms,r.fieldTransforms)&&(s.type===0?s.value.isEqual(r.value):s.type!==1||s.data.isEqual(r.data)&&s.fieldMask.isEqual(r.fieldMask))}class $E extends sR{constructor(r,o,l,u=[]){super(),this.key=r,this.value=o,this.precondition=l,this.fieldTransforms=u,this.type=0}getFieldMask(){return null}}class au extends sR{constructor(r,o,l,u,f=[]){super(),this.key=r,this.data=o,this.fieldMask=l,this.precondition=u,this.fieldTransforms=f,this.type=1}getFieldMask(){return this.fieldMask}}function t7(s){const r=new Map;return s.fieldMask.fields.forEach(o=>{if(!o.isEmpty()){const l=s.data.field(o);r.set(o,l)}}),r}function gz(s,r,o){const l=new Map;Jn(s.length===o.length);for(let u=0;u<o.length;u++){const f=s[u],E=f.transform,T=r.data.field(f.field);l.set(f.field,gEe(E,T,o[u]))}return l}function _z(s,r,o){const l=new Map;for(const u of s){const f=u.transform,E=o.data.field(u.field);l.set(u.field,fEe(f,E,r))}return l}class n7 extends sR{constructor(r,o){super(),this.key=r,this.precondition=o,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class SEe extends sR{constructor(r,o){super(),this.key=r,this.precondition=o,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TEe{constructor(r,o,l,u){this.batchId=r,this.localWriteTime=o,this.baseMutations=l,this.mutations=u}applyToRemoteDocument(r,o){const l=o.mutationResults;for(let u=0;u<this.mutations.length;u++){const f=this.mutations[u];f.key.isEqual(r.key)&&vEe(f,r,l[u])}}applyToLocalView(r,o){for(const l of this.baseMutations)l.key.isEqual(r.key)&&(o=iE(l,r,o,this.localWriteTime));for(const l of this.mutations)l.key.isEqual(r.key)&&(o=iE(l,r,o,this.localWriteTime));return o}applyToLocalDocumentSet(r,o){const l=qK();return this.mutations.forEach(u=>{const f=r.get(u.key),E=f.overlayedDocument;let T=this.applyToLocalView(E,f.mutatedFields);T=o.has(u.key)?null:T;const w=e7(E,T);w!==null&&l.set(u.key,w),E.isValidDocument()||E.convertToNoDocument(Jt.min())}),l}keys(){return this.mutations.reduce((r,o)=>r.add(o.key),Tn())}isEqual(r){return this.batchId===r.batchId&&uf(this.mutations,r.mutations,(o,l)=>fz(o,l))&&uf(this.baseMutations,r.baseMutations,(o,l)=>fz(o,l))}}class CD{constructor(r,o,l,u){this.batch=r,this.commitVersion=o,this.mutationResults=l,this.docVersions=u}static from(r,o,l){Jn(r.mutations.length===l.length);let u=function(){return dEe}();const f=r.mutations;for(let E=0;E<f.length;E++)u=u.insert(f[E].key,l[E].version);return new CD(r,o,l,u)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bEe{constructor(r,o){this.largestBatchId=r,this.mutation=o}getKey(){return this.mutation.key}isEqual(r){return r!==null&&this.mutation===r.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class REe{constructor(r,o){this.count=r,this.unchangedNames=o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ii,Cn;function wEe(s){switch(s){default:return Gt();case je.CANCELLED:case je.UNKNOWN:case je.DEADLINE_EXCEEDED:case je.RESOURCE_EXHAUSTED:case je.INTERNAL:case je.UNAVAILABLE:case je.UNAUTHENTICATED:return!1;case je.INVALID_ARGUMENT:case je.NOT_FOUND:case je.ALREADY_EXISTS:case je.PERMISSION_DENIED:case je.FAILED_PRECONDITION:case je.ABORTED:case je.OUT_OF_RANGE:case je.UNIMPLEMENTED:case je.DATA_LOSS:return!0}}function r7(s){if(s===void 0)return Rl("GRPC error has no .code"),je.UNKNOWN;switch(s){case ii.OK:return je.OK;case ii.CANCELLED:return je.CANCELLED;case ii.UNKNOWN:return je.UNKNOWN;case ii.DEADLINE_EXCEEDED:return je.DEADLINE_EXCEEDED;case ii.RESOURCE_EXHAUSTED:return je.RESOURCE_EXHAUSTED;case ii.INTERNAL:return je.INTERNAL;case ii.UNAVAILABLE:return je.UNAVAILABLE;case ii.UNAUTHENTICATED:return je.UNAUTHENTICATED;case ii.INVALID_ARGUMENT:return je.INVALID_ARGUMENT;case ii.NOT_FOUND:return je.NOT_FOUND;case ii.ALREADY_EXISTS:return je.ALREADY_EXISTS;case ii.PERMISSION_DENIED:return je.PERMISSION_DENIED;case ii.FAILED_PRECONDITION:return je.FAILED_PRECONDITION;case ii.ABORTED:return je.ABORTED;case ii.OUT_OF_RANGE:return je.OUT_OF_RANGE;case ii.UNIMPLEMENTED:return je.UNIMPLEMENTED;case ii.DATA_LOSS:return je.DATA_LOSS;default:return Gt()}}(Cn=ii||(ii={}))[Cn.OK=0]="OK",Cn[Cn.CANCELLED=1]="CANCELLED",Cn[Cn.UNKNOWN=2]="UNKNOWN",Cn[Cn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Cn[Cn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Cn[Cn.NOT_FOUND=5]="NOT_FOUND",Cn[Cn.ALREADY_EXISTS=6]="ALREADY_EXISTS",Cn[Cn.PERMISSION_DENIED=7]="PERMISSION_DENIED",Cn[Cn.UNAUTHENTICATED=16]="UNAUTHENTICATED",Cn[Cn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Cn[Cn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Cn[Cn.ABORTED=10]="ABORTED",Cn[Cn.OUT_OF_RANGE=11]="OUT_OF_RANGE",Cn[Cn.UNIMPLEMENTED=12]="UNIMPLEMENTED",Cn[Cn.INTERNAL=13]="INTERNAL",Cn[Cn.UNAVAILABLE=14]="UNAVAILABLE",Cn[Cn.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CEe(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IEe=new Ch([4294967295,4294967295],0);function Ez(s){const r=CEe().encode(s),o=new wK;return o.update(r),new Uint8Array(o.digest())}function vz(s){const r=new DataView(s.buffer),o=r.getUint32(0,!0),l=r.getUint32(4,!0),u=r.getUint32(8,!0),f=r.getUint32(12,!0);return[new Ch([o,l],0),new Ch([u,f],0)]}class ID{constructor(r,o,l){if(this.bitmap=r,this.padding=o,this.hashCount=l,o<0||o>=8)throw new B_(`Invalid padding: ${o}`);if(l<0)throw new B_(`Invalid hash count: ${l}`);if(r.length>0&&this.hashCount===0)throw new B_(`Invalid hash count: ${l}`);if(r.length===0&&o!==0)throw new B_(`Invalid padding when bitmap length is 0: ${o}`);this.Ie=8*r.length-o,this.Te=Ch.fromNumber(this.Ie)}Ee(r,o,l){let u=r.add(o.multiply(Ch.fromNumber(l)));return u.compare(IEe)===1&&(u=new Ch([u.getBits(0),u.getBits(1)],0)),u.modulo(this.Te).toNumber()}de(r){return(this.bitmap[Math.floor(r/8)]&1<<r%8)!=0}mightContain(r){if(this.Ie===0)return!1;const o=Ez(r),[l,u]=vz(o);for(let f=0;f<this.hashCount;f++){const E=this.Ee(l,u,f);if(!this.de(E))return!1}return!0}static create(r,o,l){const u=r%8==0?0:8-r%8,f=new Uint8Array(Math.ceil(r/8)),E=new ID(f,u,o);return l.forEach(T=>E.insert(T)),E}insert(r){if(this.Ie===0)return;const o=Ez(r),[l,u]=vz(o);for(let f=0;f<this.hashCount;f++){const E=this.Ee(l,u,f);this.Ae(E)}}Ae(r){const o=Math.floor(r/8),l=r%8;this.bitmap[o]|=1<<l}}class B_ extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oR{constructor(r,o,l,u,f){this.snapshotVersion=r,this.targetChanges=o,this.targetMismatches=l,this.documentUpdates=u,this.resolvedLimboDocuments=f}static createSynthesizedRemoteEventForCurrentChange(r,o,l){const u=new Map;return u.set(r,ZE.createSynthesizedTargetChangeForCurrentChange(r,o,l)),new oR(Jt.min(),u,new Gr(kn),wl(),Tn())}}class ZE{constructor(r,o,l,u,f){this.resumeToken=r,this.current=o,this.addedDocuments=l,this.modifiedDocuments=u,this.removedDocuments=f}static createSynthesizedTargetChangeForCurrentChange(r,o,l){return new ZE(l,o,Tn(),Tn(),Tn())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N0{constructor(r,o,l,u){this.Re=r,this.removedTargetIds=o,this.key=l,this.Ve=u}}class i7{constructor(r,o){this.targetId=r,this.me=o}}class s7{constructor(r,o,l=Ji.EMPTY_BYTE_STRING,u=null){this.state=r,this.targetIds=o,this.resumeToken=l,this.cause=u}}class yz{constructor(){this.fe=0,this.ge=Tz(),this.pe=Ji.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(r){r.approximateByteSize()>0&&(this.we=!0,this.pe=r)}ve(){let r=Tn(),o=Tn(),l=Tn();return this.ge.forEach((u,f)=>{switch(f){case 0:r=r.add(u);break;case 2:o=o.add(u);break;case 1:l=l.add(u);break;default:Gt()}}),new ZE(this.pe,this.ye,r,o,l)}Ce(){this.we=!1,this.ge=Tz()}Fe(r,o){this.we=!0,this.ge=this.ge.insert(r,o)}Me(r){this.we=!0,this.ge=this.ge.remove(r)}xe(){this.fe+=1}Oe(){this.fe-=1,Jn(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class AEe{constructor(r){this.Le=r,this.Be=new Map,this.ke=wl(),this.qe=Sz(),this.Qe=new Gr(kn)}Ke(r){for(const o of r.Re)r.Ve&&r.Ve.isFoundDocument()?this.$e(o,r.Ve):this.Ue(o,r.key,r.Ve);for(const o of r.removedTargetIds)this.Ue(o,r.key,r.Ve)}We(r){this.forEachTarget(r,o=>{const l=this.Ge(o);switch(r.state){case 0:this.ze(o)&&l.De(r.resumeToken);break;case 1:l.Oe(),l.Se||l.Ce(),l.De(r.resumeToken);break;case 2:l.Oe(),l.Se||this.removeTarget(o);break;case 3:this.ze(o)&&(l.Ne(),l.De(r.resumeToken));break;case 4:this.ze(o)&&(this.je(o),l.De(r.resumeToken));break;default:Gt()}})}forEachTarget(r,o){r.targetIds.length>0?r.targetIds.forEach(o):this.Be.forEach((l,u)=>{this.ze(u)&&o(u)})}He(r){const o=r.targetId,l=r.me.count,u=this.Je(o);if(u){const f=u.target;if(HO(f))if(l===0){const E=new Ct(f.path);this.Ue(o,E,ls.newNoDocument(E,Jt.min()))}else Jn(l===1);else{const E=this.Ye(o);if(E!==l){const T=this.Ze(r),w=T?this.Xe(T,r,E):1;if(w!==0){this.je(o);const A=w===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(o,A)}}}}}Ze(r){const o=r.me.unchangedNames;if(!o||!o.bits)return null;const{bits:{bitmap:l="",padding:u=0},hashCount:f=0}=o;let E,T;try{E=Vh(l).toUint8Array()}catch(w){if(w instanceof kK)return df("Decoding the base64 bloom filter in existence filter failed ("+w.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw w}try{T=new ID(E,u,f)}catch(w){return df(w instanceof B_?"BloomFilter error: ":"Applying bloom filter failed: ",w),null}return T.Ie===0?null:T}Xe(r,o,l){return o.me.count===l-this.nt(r,o.targetId)?0:2}nt(r,o){const l=this.Le.getRemoteKeysForTarget(o);let u=0;return l.forEach(f=>{const E=this.Le.tt(),T=`projects/${E.projectId}/databases/${E.database}/documents/${f.path.canonicalString()}`;r.mightContain(T)||(this.Ue(o,f,null),u++)}),u}rt(r){const o=new Map;this.Be.forEach((f,E)=>{const T=this.Je(E);if(T){if(f.current&&HO(T.target)){const w=new Ct(T.target.path);this.ke.get(w)!==null||this.it(E,w)||this.Ue(E,w,ls.newNoDocument(w,r))}f.be&&(o.set(E,f.ve()),f.Ce())}});let l=Tn();this.qe.forEach((f,E)=>{let T=!0;E.forEachWhile(w=>{const A=this.Je(w);return!A||A.purpose==="TargetPurposeLimboResolution"||(T=!1,!1)}),T&&(l=l.add(f))}),this.ke.forEach((f,E)=>E.setReadTime(r));const u=new oR(r,o,this.Qe,this.ke,l);return this.ke=wl(),this.qe=Sz(),this.Qe=new Gr(kn),u}$e(r,o){if(!this.ze(r))return;const l=this.it(r,o.key)?2:0;this.Ge(r).Fe(o.key,l),this.ke=this.ke.insert(o.key,o),this.qe=this.qe.insert(o.key,this.st(o.key).add(r))}Ue(r,o,l){if(!this.ze(r))return;const u=this.Ge(r);this.it(r,o)?u.Fe(o,1):u.Me(o),this.qe=this.qe.insert(o,this.st(o).delete(r)),l&&(this.ke=this.ke.insert(o,l))}removeTarget(r){this.Be.delete(r)}Ye(r){const o=this.Ge(r).ve();return this.Le.getRemoteKeysForTarget(r).size+o.addedDocuments.size-o.removedDocuments.size}xe(r){this.Ge(r).xe()}Ge(r){let o=this.Be.get(r);return o||(o=new yz,this.Be.set(r,o)),o}st(r){let o=this.qe.get(r);return o||(o=new Yi(kn),this.qe=this.qe.insert(r,o)),o}ze(r){const o=this.Je(r)!==null;return o||gt("WatchChangeAggregator","Detected inactive target",r),o}Je(r){const o=this.Be.get(r);return o&&o.Se?null:this.Le.ot(r)}je(r){this.Be.set(r,new yz),this.Le.getRemoteKeysForTarget(r).forEach(o=>{this.Ue(r,o,null)})}it(r,o){return this.Le.getRemoteKeysForTarget(r).has(o)}}function Sz(){return new Gr(Ct.comparator)}function Tz(){return new Gr(Ct.comparator)}const NEe={asc:"ASCENDING",desc:"DESCENDING"},xEe={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},OEe={and:"AND",or:"OR"};class PEe{constructor(r,o){this.databaseId=r,this.useProto3Json=o}}function qO(s,r){return s.useProto3Json||eR(r)?r:{value:r}}function _b(s,r){return s.useProto3Json?`${new Date(1e3*r.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+r.nanoseconds).slice(-9)}Z`:{seconds:""+r.seconds,nanos:r.nanoseconds}}function o7(s,r){return s.useProto3Json?r.toBase64():r.toUint8Array()}function DEe(s,r){return _b(s,r.toTimestamp())}function Ac(s){return Jn(!!s),Jt.fromTimestamp(function(o){const l=$d(o);return new Wn(l.seconds,l.nanos)}(s))}function AD(s,r){return YO(s,r).canonicalString()}function YO(s,r){const o=function(u){return new vr(["projects",u.projectId,"databases",u.database])}(s).child("documents");return r===void 0?o:o.child(r)}function a7(s){const r=vr.fromString(s);return Jn(h7(r)),r}function XO(s,r){return AD(s.databaseId,r.path)}function Rx(s,r){const o=a7(r);if(o.get(1)!==s.databaseId.projectId)throw new ut(je.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+o.get(1)+" vs "+s.databaseId.projectId);if(o.get(3)!==s.databaseId.database)throw new ut(je.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+o.get(3)+" vs "+s.databaseId.database);return new Ct(l7(o))}function c7(s,r){return AD(s.databaseId,r)}function kEe(s){const r=a7(s);return r.length===4?vr.emptyPath():l7(r)}function JO(s){return new vr(["projects",s.databaseId.projectId,"databases",s.databaseId.database]).canonicalString()}function l7(s){return Jn(s.length>4&&s.get(4)==="documents"),s.popFirst(5)}function bz(s,r,o){return{name:XO(s,r),fields:o.value.mapValue.fields}}function LEe(s,r){let o;if("targetChange"in r){r.targetChange;const l=function(A){return A==="NO_CHANGE"?0:A==="ADD"?1:A==="REMOVE"?2:A==="CURRENT"?3:A==="RESET"?4:Gt()}(r.targetChange.targetChangeType||"NO_CHANGE"),u=r.targetChange.targetIds||[],f=function(A,U){return A.useProto3Json?(Jn(U===void 0||typeof U=="string"),Ji.fromBase64String(U||"")):(Jn(U===void 0||U instanceof Buffer||U instanceof Uint8Array),Ji.fromUint8Array(U||new Uint8Array))}(s,r.targetChange.resumeToken),E=r.targetChange.cause,T=E&&function(A){const U=A.code===void 0?je.UNKNOWN:r7(A.code);return new ut(U,A.message||"")}(E);o=new s7(l,u,f,T||null)}else if("documentChange"in r){r.documentChange;const l=r.documentChange;l.document,l.document.name,l.document.updateTime;const u=Rx(s,l.document.name),f=Ac(l.document.updateTime),E=l.document.createTime?Ac(l.document.createTime):Jt.min(),T=new qs({mapValue:{fields:l.document.fields}}),w=ls.newFoundDocument(u,f,E,T),A=l.targetIds||[],U=l.removedTargetIds||[];o=new N0(A,U,w.key,w)}else if("documentDelete"in r){r.documentDelete;const l=r.documentDelete;l.document;const u=Rx(s,l.document),f=l.readTime?Ac(l.readTime):Jt.min(),E=ls.newNoDocument(u,f),T=l.removedTargetIds||[];o=new N0([],T,E.key,E)}else if("documentRemove"in r){r.documentRemove;const l=r.documentRemove;l.document;const u=Rx(s,l.document),f=l.removedTargetIds||[];o=new N0([],f,u,null)}else{if(!("filter"in r))return Gt();{r.filter;const l=r.filter;l.targetId;const{count:u=0,unchangedNames:f}=l,E=new REe(u,f),T=l.targetId;o=new i7(T,E)}}return o}function MEe(s,r){let o;if(r instanceof $E)o={update:bz(s,r.key,r.value)};else if(r instanceof n7)o={delete:XO(s,r.key)};else if(r instanceof au)o={update:bz(s,r.key,r.data),updateMask:HEe(r.fieldMask)};else{if(!(r instanceof SEe))return Gt();o={verify:XO(s,r.key)}}return r.fieldTransforms.length>0&&(o.updateTransforms=r.fieldTransforms.map(l=>function(f,E){const T=E.transform;if(T instanceof LE)return{fieldPath:E.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(T instanceof mf)return{fieldPath:E.field.canonicalString(),appendMissingElements:{values:T.elements}};if(T instanceof ME)return{fieldPath:E.field.canonicalString(),removeAllFromArray:{values:T.elements}};if(T instanceof gb)return{fieldPath:E.field.canonicalString(),increment:T.Pe};throw Gt()}(0,l))),r.precondition.isNone||(o.currentDocument=function(u,f){return f.updateTime!==void 0?{updateTime:DEe(u,f.updateTime)}:f.exists!==void 0?{exists:f.exists}:Gt()}(s,r.precondition)),o}function UEe(s,r){return s&&s.length>0?(Jn(r!==void 0),s.map(o=>function(u,f){let E=u.updateTime?Ac(u.updateTime):Ac(f);return E.isEqual(Jt.min())&&(E=Ac(f)),new EEe(E,u.transformResults||[])}(o,r))):[]}function jEe(s,r){return{documents:[c7(s,r.path)]}}function VEe(s,r){const o={structuredQuery:{}},l=r.path;let u;r.collectionGroup!==null?(u=l,o.structuredQuery.from=[{collectionId:r.collectionGroup,allDescendants:!0}]):(u=l.popLast(),o.structuredQuery.from=[{collectionId:l.lastSegment()}]),o.parent=c7(s,u);const f=function(A){if(A.length!==0)return u7(Ba.create(A,"and"))}(r.filters);f&&(o.structuredQuery.where=f);const E=function(A){if(A.length!==0)return A.map(U=>function(F){return{field:Am(F.field),direction:GEe(F.dir)}}(U))}(r.orderBy);E&&(o.structuredQuery.orderBy=E);const T=qO(s,r.limit);return T!==null&&(o.structuredQuery.limit=T),r.startAt&&(o.structuredQuery.startAt=function(A){return{before:A.inclusive,values:A.position}}(r.startAt)),r.endAt&&(o.structuredQuery.endAt=function(A){return{before:!A.inclusive,values:A.position}}(r.endAt)),{_t:o,parent:u}}function FEe(s){let r=kEe(s.parent);const o=s.structuredQuery,l=o.from?o.from.length:0;let u=null;if(l>0){Jn(l===1);const U=o.from[0];U.allDescendants?u=U.collectionId:r=r.child(U.collectionId)}let f=[];o.where&&(f=function(M){const F=d7(M);return F instanceof Ba&&jK(F)?F.getFilters():[F]}(o.where));let E=[];o.orderBy&&(E=function(M){return M.map(F=>function(J){return new kE(Nm(J.field),function(he){switch(he){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(J.direction))}(F))}(o.orderBy));let T=null;o.limit&&(T=function(M){let F;return F=typeof M=="object"?M.value:M,eR(F)?null:F}(o.limit));let w=null;o.startAt&&(w=function(M){const F=!!M.before,Y=M.values||[];return new mb(Y,F)}(o.startAt));let A=null;return o.endAt&&(A=function(M){const F=!M.before,Y=M.values||[];return new mb(Y,F)}(o.endAt)),sEe(r,u,E,f,T,"F",w,A)}function BEe(s,r){const o=function(u){switch(u){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Gt()}}(r.purpose);return o==null?null:{"goog-listen-tags":o}}function d7(s){return s.unaryFilter!==void 0?function(o){switch(o.unaryFilter.op){case"IS_NAN":const l=Nm(o.unaryFilter.field);return oi.create(l,"==",{doubleValue:NaN});case"IS_NULL":const u=Nm(o.unaryFilter.field);return oi.create(u,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const f=Nm(o.unaryFilter.field);return oi.create(f,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const E=Nm(o.unaryFilter.field);return oi.create(E,"!=",{nullValue:"NULL_VALUE"});default:return Gt()}}(s):s.fieldFilter!==void 0?function(o){return oi.create(Nm(o.fieldFilter.field),function(u){switch(u){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Gt()}}(o.fieldFilter.op),o.fieldFilter.value)}(s):s.compositeFilter!==void 0?function(o){return Ba.create(o.compositeFilter.filters.map(l=>d7(l)),function(u){switch(u){case"AND":return"and";case"OR":return"or";default:return Gt()}}(o.compositeFilter.op))}(s):Gt()}function GEe(s){return NEe[s]}function WEe(s){return xEe[s]}function zEe(s){return OEe[s]}function Am(s){return{fieldPath:s.canonicalString()}}function Nm(s){return Ki.fromServerFormat(s.fieldPath)}function u7(s){return s instanceof oi?function(o){if(o.op==="=="){if(lz(o.value))return{unaryFilter:{field:Am(o.field),op:"IS_NAN"}};if(cz(o.value))return{unaryFilter:{field:Am(o.field),op:"IS_NULL"}}}else if(o.op==="!="){if(lz(o.value))return{unaryFilter:{field:Am(o.field),op:"IS_NOT_NAN"}};if(cz(o.value))return{unaryFilter:{field:Am(o.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Am(o.field),op:WEe(o.op),value:o.value}}}(s):s instanceof Ba?function(o){const l=o.getFilters().map(u=>u7(u));return l.length===1?l[0]:{compositeFilter:{op:zEe(o.op),filters:l}}}(s):Gt()}function HEe(s){const r=[];return s.fields.forEach(o=>r.push(o.canonicalString())),{fieldPaths:r}}function h7(s){return s.length>=4&&s.get(0)==="projects"&&s.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dd{constructor(r,o,l,u,f=Jt.min(),E=Jt.min(),T=Ji.EMPTY_BYTE_STRING,w=null){this.target=r,this.targetId=o,this.purpose=l,this.sequenceNumber=u,this.snapshotVersion=f,this.lastLimboFreeSnapshotVersion=E,this.resumeToken=T,this.expectedCount=w}withSequenceNumber(r){return new Dd(this.target,this.targetId,this.purpose,r,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(r,o){return new Dd(this.target,this.targetId,this.purpose,this.sequenceNumber,o,this.lastLimboFreeSnapshotVersion,r,null)}withExpectedCount(r){return new Dd(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,r)}withLastLimboFreeSnapshotVersion(r){return new Dd(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,r,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KEe{constructor(r){this.ct=r}}function qEe(s){const r=FEe({parent:s.parent,structuredQuery:s.structuredQuery});return s.limitType==="LAST"?fb(r,r.limit,"L"):r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YEe{constructor(){this.un=new XEe}addToCollectionParentIndex(r,o){return this.un.add(o),Be.resolve()}getCollectionParents(r,o){return Be.resolve(this.un.getEntries(o))}addFieldIndex(r,o){return Be.resolve()}deleteFieldIndex(r,o){return Be.resolve()}deleteAllFieldIndexes(r){return Be.resolve()}createTargetIndexes(r,o){return Be.resolve()}getDocumentsMatchingTarget(r,o){return Be.resolve(null)}getIndexType(r,o){return Be.resolve(0)}getFieldIndexes(r,o){return Be.resolve([])}getNextCollectionGroupToUpdate(r){return Be.resolve(null)}getMinOffset(r,o){return Be.resolve(Qd.min())}getMinOffsetFromCollectionGroup(r,o){return Be.resolve(Qd.min())}updateCollectionGroup(r,o,l){return Be.resolve()}updateIndexEntries(r,o){return Be.resolve()}}class XEe{constructor(){this.index={}}add(r){const o=r.lastSegment(),l=r.popLast(),u=this.index[o]||new Yi(vr.comparator),f=!u.has(l);return this.index[o]=u.add(l),f}has(r){const o=r.lastSegment(),l=r.popLast(),u=this.index[o];return u&&u.has(l)}getEntries(r){return(this.index[r]||new Yi(vr.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ff{constructor(r){this.Ln=r}next(){return this.Ln+=2,this.Ln}static Bn(){return new ff(0)}static kn(){return new ff(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JEe{constructor(){this.changes=new Af(r=>r.toString(),(r,o)=>r.isEqual(o)),this.changesApplied=!1}addEntry(r){this.assertNotApplied(),this.changes.set(r.key,r)}removeEntry(r,o){this.assertNotApplied(),this.changes.set(r,ls.newInvalidDocument(r).setReadTime(o))}getEntry(r,o){this.assertNotApplied();const l=this.changes.get(o);return l!==void 0?Be.resolve(l):this.getFromCache(r,o)}getEntries(r,o){return this.getAllFromCache(r,o)}apply(r){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(r)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QEe{constructor(r,o){this.overlayedDocument=r,this.mutatedFields=o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $Ee{constructor(r,o,l,u){this.remoteDocumentCache=r,this.mutationQueue=o,this.documentOverlayCache=l,this.indexManager=u}getDocument(r,o){let l=null;return this.documentOverlayCache.getOverlay(r,o).next(u=>(l=u,this.remoteDocumentCache.getEntry(r,o))).next(u=>(l!==null&&iE(l.mutation,u,_o.empty(),Wn.now()),u))}getDocuments(r,o){return this.remoteDocumentCache.getEntries(r,o).next(l=>this.getLocalViewOfDocuments(r,l,Tn()).next(()=>l))}getLocalViewOfDocuments(r,o,l=Tn()){const u=Sh();return this.populateOverlays(r,u,o).next(()=>this.computeViews(r,o,u,l).next(f=>{let E=F_();return f.forEach((T,w)=>{E=E.insert(T,w.overlayedDocument)}),E}))}getOverlayedDocuments(r,o){const l=Sh();return this.populateOverlays(r,l,o).next(()=>this.computeViews(r,o,l,Tn()))}populateOverlays(r,o,l){const u=[];return l.forEach(f=>{o.has(f)||u.push(f)}),this.documentOverlayCache.getOverlays(r,u).next(f=>{f.forEach((E,T)=>{o.set(E,T)})})}computeViews(r,o,l,u){let f=wl();const E=rE(),T=function(){return rE()}();return o.forEach((w,A)=>{const U=l.get(A.key);u.has(A.key)&&(U===void 0||U.mutation instanceof au)?f=f.insert(A.key,A):U!==void 0?(E.set(A.key,U.mutation.getFieldMask()),iE(U.mutation,A,U.mutation.getFieldMask(),Wn.now())):E.set(A.key,_o.empty())}),this.recalculateAndSaveOverlays(r,f).next(w=>(w.forEach((A,U)=>E.set(A,U)),o.forEach((A,U)=>{var M;return T.set(A,new QEe(U,(M=E.get(A))!==null&&M!==void 0?M:null))}),T))}recalculateAndSaveOverlays(r,o){const l=rE();let u=new Gr((E,T)=>E-T),f=Tn();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(r,o).next(E=>{for(const T of E)T.keys().forEach(w=>{const A=o.get(w);if(A===null)return;let U=l.get(w)||_o.empty();U=T.applyToLocalView(A,U),l.set(w,U);const M=(u.get(T.batchId)||Tn()).add(w);u=u.insert(T.batchId,M)})}).next(()=>{const E=[],T=u.getReverseIterator();for(;T.hasNext();){const w=T.getNext(),A=w.key,U=w.value,M=qK();U.forEach(F=>{if(!f.has(F)){const Y=e7(o.get(F),l.get(F));Y!==null&&M.set(F,Y),f=f.add(F)}}),E.push(this.documentOverlayCache.saveOverlays(r,A,M))}return Be.waitFor(E)}).next(()=>l)}recalculateAndSaveOverlaysForDocumentKeys(r,o){return this.remoteDocumentCache.getEntries(r,o).next(l=>this.recalculateAndSaveOverlays(r,l))}getDocumentsMatchingQuery(r,o,l,u){return function(E){return Ct.isDocumentKey(E.path)&&E.collectionGroup===null&&E.filters.length===0}(o)?this.getDocumentsMatchingDocumentQuery(r,o.path):GK(o)?this.getDocumentsMatchingCollectionGroupQuery(r,o,l,u):this.getDocumentsMatchingCollectionQuery(r,o,l,u)}getNextDocuments(r,o,l,u){return this.remoteDocumentCache.getAllFromCollectionGroup(r,o,l,u).next(f=>{const E=u-f.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(r,o,l.largestBatchId,u-f.size):Be.resolve(Sh());let T=-1,w=f;return E.next(A=>Be.forEach(A,(U,M)=>(T<M.largestBatchId&&(T=M.largestBatchId),f.get(U)?Be.resolve():this.remoteDocumentCache.getEntry(r,U).next(F=>{w=w.insert(U,F)}))).next(()=>this.populateOverlays(r,A,f)).next(()=>this.computeViews(r,w,A,Tn())).next(U=>({batchId:T,changes:KK(U)})))})}getDocumentsMatchingDocumentQuery(r,o){return this.getDocument(r,new Ct(o)).next(l=>{let u=F_();return l.isFoundDocument()&&(u=u.insert(l.key,l)),u})}getDocumentsMatchingCollectionGroupQuery(r,o,l,u){const f=o.collectionGroup;let E=F_();return this.indexManager.getCollectionParents(r,f).next(T=>Be.forEach(T,w=>{const A=function(M,F){return new If(F,null,M.explicitOrderBy.slice(),M.filters.slice(),M.limit,M.limitType,M.startAt,M.endAt)}(o,w.child(f));return this.getDocumentsMatchingCollectionQuery(r,A,l,u).next(U=>{U.forEach((M,F)=>{E=E.insert(M,F)})})}).next(()=>E))}getDocumentsMatchingCollectionQuery(r,o,l,u){let f;return this.documentOverlayCache.getOverlaysForCollection(r,o.path,l.largestBatchId).next(E=>(f=E,this.remoteDocumentCache.getDocumentsMatchingQuery(r,o,l,f,u))).next(E=>{f.forEach((w,A)=>{const U=A.getKey();E.get(U)===null&&(E=E.insert(U,ls.newInvalidDocument(U)))});let T=F_();return E.forEach((w,A)=>{const U=f.get(w);U!==void 0&&iE(U.mutation,A,_o.empty(),Wn.now()),rR(o,A)&&(T=T.insert(w,A))}),T})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZEe{constructor(r){this.serializer=r,this.hr=new Map,this.Pr=new Map}getBundleMetadata(r,o){return Be.resolve(this.hr.get(o))}saveBundleMetadata(r,o){return this.hr.set(o.id,function(u){return{id:u.id,version:u.version,createTime:Ac(u.createTime)}}(o)),Be.resolve()}getNamedQuery(r,o){return Be.resolve(this.Pr.get(o))}saveNamedQuery(r,o){return this.Pr.set(o.name,function(u){return{name:u.name,query:qEe(u.bundledQuery),readTime:Ac(u.readTime)}}(o)),Be.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eve{constructor(){this.overlays=new Gr(Ct.comparator),this.Ir=new Map}getOverlay(r,o){return Be.resolve(this.overlays.get(o))}getOverlays(r,o){const l=Sh();return Be.forEach(o,u=>this.getOverlay(r,u).next(f=>{f!==null&&l.set(u,f)})).next(()=>l)}saveOverlays(r,o,l){return l.forEach((u,f)=>{this.ht(r,o,f)}),Be.resolve()}removeOverlaysForBatchId(r,o,l){const u=this.Ir.get(l);return u!==void 0&&(u.forEach(f=>this.overlays=this.overlays.remove(f)),this.Ir.delete(l)),Be.resolve()}getOverlaysForCollection(r,o,l){const u=Sh(),f=o.length+1,E=new Ct(o.child("")),T=this.overlays.getIteratorFrom(E);for(;T.hasNext();){const w=T.getNext().value,A=w.getKey();if(!o.isPrefixOf(A.path))break;A.path.length===f&&w.largestBatchId>l&&u.set(w.getKey(),w)}return Be.resolve(u)}getOverlaysForCollectionGroup(r,o,l,u){let f=new Gr((A,U)=>A-U);const E=this.overlays.getIterator();for(;E.hasNext();){const A=E.getNext().value;if(A.getKey().getCollectionGroup()===o&&A.largestBatchId>l){let U=f.get(A.largestBatchId);U===null&&(U=Sh(),f=f.insert(A.largestBatchId,U)),U.set(A.getKey(),A)}}const T=Sh(),w=f.getIterator();for(;w.hasNext()&&(w.getNext().value.forEach((A,U)=>T.set(A,U)),!(T.size()>=u)););return Be.resolve(T)}ht(r,o,l){const u=this.overlays.get(l.key);if(u!==null){const E=this.Ir.get(u.largestBatchId).delete(l.key);this.Ir.set(u.largestBatchId,E)}this.overlays=this.overlays.insert(l.key,new bEe(o,l));let f=this.Ir.get(o);f===void 0&&(f=Tn(),this.Ir.set(o,f)),this.Ir.set(o,f.add(l.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tve{constructor(){this.sessionToken=Ji.EMPTY_BYTE_STRING}getSessionToken(r){return Be.resolve(this.sessionToken)}setSessionToken(r,o){return this.sessionToken=o,Be.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ND{constructor(){this.Tr=new Yi(Oi.Er),this.dr=new Yi(Oi.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(r,o){const l=new Oi(r,o);this.Tr=this.Tr.add(l),this.dr=this.dr.add(l)}Rr(r,o){r.forEach(l=>this.addReference(l,o))}removeReference(r,o){this.Vr(new Oi(r,o))}mr(r,o){r.forEach(l=>this.removeReference(l,o))}gr(r){const o=new Ct(new vr([])),l=new Oi(o,r),u=new Oi(o,r+1),f=[];return this.dr.forEachInRange([l,u],E=>{this.Vr(E),f.push(E.key)}),f}pr(){this.Tr.forEach(r=>this.Vr(r))}Vr(r){this.Tr=this.Tr.delete(r),this.dr=this.dr.delete(r)}yr(r){const o=new Ct(new vr([])),l=new Oi(o,r),u=new Oi(o,r+1);let f=Tn();return this.dr.forEachInRange([l,u],E=>{f=f.add(E.key)}),f}containsKey(r){const o=new Oi(r,0),l=this.Tr.firstAfterOrEqual(o);return l!==null&&r.isEqual(l.key)}}class Oi{constructor(r,o){this.key=r,this.wr=o}static Er(r,o){return Ct.comparator(r.key,o.key)||kn(r.wr,o.wr)}static Ar(r,o){return kn(r.wr,o.wr)||Ct.comparator(r.key,o.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nve{constructor(r,o){this.indexManager=r,this.referenceDelegate=o,this.mutationQueue=[],this.Sr=1,this.br=new Yi(Oi.Er)}checkEmpty(r){return Be.resolve(this.mutationQueue.length===0)}addMutationBatch(r,o,l,u){const f=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const E=new TEe(f,o,l,u);this.mutationQueue.push(E);for(const T of u)this.br=this.br.add(new Oi(T.key,f)),this.indexManager.addToCollectionParentIndex(r,T.key.path.popLast());return Be.resolve(E)}lookupMutationBatch(r,o){return Be.resolve(this.Dr(o))}getNextMutationBatchAfterBatchId(r,o){const l=o+1,u=this.vr(l),f=u<0?0:u;return Be.resolve(this.mutationQueue.length>f?this.mutationQueue[f]:null)}getHighestUnacknowledgedBatchId(){return Be.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(r){return Be.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(r,o){const l=new Oi(o,0),u=new Oi(o,Number.POSITIVE_INFINITY),f=[];return this.br.forEachInRange([l,u],E=>{const T=this.Dr(E.wr);f.push(T)}),Be.resolve(f)}getAllMutationBatchesAffectingDocumentKeys(r,o){let l=new Yi(kn);return o.forEach(u=>{const f=new Oi(u,0),E=new Oi(u,Number.POSITIVE_INFINITY);this.br.forEachInRange([f,E],T=>{l=l.add(T.wr)})}),Be.resolve(this.Cr(l))}getAllMutationBatchesAffectingQuery(r,o){const l=o.path,u=l.length+1;let f=l;Ct.isDocumentKey(f)||(f=f.child(""));const E=new Oi(new Ct(f),0);let T=new Yi(kn);return this.br.forEachWhile(w=>{const A=w.key.path;return!!l.isPrefixOf(A)&&(A.length===u&&(T=T.add(w.wr)),!0)},E),Be.resolve(this.Cr(T))}Cr(r){const o=[];return r.forEach(l=>{const u=this.Dr(l);u!==null&&o.push(u)}),o}removeMutationBatch(r,o){Jn(this.Fr(o.batchId,"removed")===0),this.mutationQueue.shift();let l=this.br;return Be.forEach(o.mutations,u=>{const f=new Oi(u.key,o.batchId);return l=l.delete(f),this.referenceDelegate.markPotentiallyOrphaned(r,u.key)}).next(()=>{this.br=l})}On(r){}containsKey(r,o){const l=new Oi(o,0),u=this.br.firstAfterOrEqual(l);return Be.resolve(o.isEqual(u&&u.key))}performConsistencyCheck(r){return this.mutationQueue.length,Be.resolve()}Fr(r,o){return this.vr(r)}vr(r){return this.mutationQueue.length===0?0:r-this.mutationQueue[0].batchId}Dr(r){const o=this.vr(r);return o<0||o>=this.mutationQueue.length?null:this.mutationQueue[o]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rve{constructor(r){this.Mr=r,this.docs=function(){return new Gr(Ct.comparator)}(),this.size=0}setIndexManager(r){this.indexManager=r}addEntry(r,o){const l=o.key,u=this.docs.get(l),f=u?u.size:0,E=this.Mr(o);return this.docs=this.docs.insert(l,{document:o.mutableCopy(),size:E}),this.size+=E-f,this.indexManager.addToCollectionParentIndex(r,l.path.popLast())}removeEntry(r){const o=this.docs.get(r);o&&(this.docs=this.docs.remove(r),this.size-=o.size)}getEntry(r,o){const l=this.docs.get(o);return Be.resolve(l?l.document.mutableCopy():ls.newInvalidDocument(o))}getEntries(r,o){let l=wl();return o.forEach(u=>{const f=this.docs.get(u);l=l.insert(u,f?f.document.mutableCopy():ls.newInvalidDocument(u))}),Be.resolve(l)}getDocumentsMatchingQuery(r,o,l,u){let f=wl();const E=o.path,T=new Ct(E.child("")),w=this.docs.getIteratorFrom(T);for(;w.hasNext();){const{key:A,value:{document:U}}=w.getNext();if(!E.isPrefixOf(A.path))break;A.path.length>E.length+1||F_e(V_e(U),l)<=0||(u.has(U.key)||rR(o,U))&&(f=f.insert(U.key,U.mutableCopy()))}return Be.resolve(f)}getAllFromCollectionGroup(r,o,l,u){Gt()}Or(r,o){return Be.forEach(this.docs,l=>o(l))}newChangeBuffer(r){return new ive(this)}getSize(r){return Be.resolve(this.size)}}class ive extends JEe{constructor(r){super(),this.cr=r}applyChanges(r){const o=[];return this.changes.forEach((l,u)=>{u.isValidDocument()?o.push(this.cr.addEntry(r,u)):this.cr.removeEntry(l)}),Be.waitFor(o)}getFromCache(r,o){return this.cr.getEntry(r,o)}getAllFromCache(r,o){return this.cr.getEntries(r,o)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sve{constructor(r){this.persistence=r,this.Nr=new Af(o=>bD(o),RD),this.lastRemoteSnapshotVersion=Jt.min(),this.highestTargetId=0,this.Lr=0,this.Br=new ND,this.targetCount=0,this.kr=ff.Bn()}forEachTarget(r,o){return this.Nr.forEach((l,u)=>o(u)),Be.resolve()}getLastRemoteSnapshotVersion(r){return Be.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(r){return Be.resolve(this.Lr)}allocateTargetId(r){return this.highestTargetId=this.kr.next(),Be.resolve(this.highestTargetId)}setTargetsMetadata(r,o,l){return l&&(this.lastRemoteSnapshotVersion=l),o>this.Lr&&(this.Lr=o),Be.resolve()}Kn(r){this.Nr.set(r.target,r);const o=r.targetId;o>this.highestTargetId&&(this.kr=new ff(o),this.highestTargetId=o),r.sequenceNumber>this.Lr&&(this.Lr=r.sequenceNumber)}addTargetData(r,o){return this.Kn(o),this.targetCount+=1,Be.resolve()}updateTargetData(r,o){return this.Kn(o),Be.resolve()}removeTargetData(r,o){return this.Nr.delete(o.target),this.Br.gr(o.targetId),this.targetCount-=1,Be.resolve()}removeTargets(r,o,l){let u=0;const f=[];return this.Nr.forEach((E,T)=>{T.sequenceNumber<=o&&l.get(T.targetId)===null&&(this.Nr.delete(E),f.push(this.removeMatchingKeysForTargetId(r,T.targetId)),u++)}),Be.waitFor(f).next(()=>u)}getTargetCount(r){return Be.resolve(this.targetCount)}getTargetData(r,o){const l=this.Nr.get(o)||null;return Be.resolve(l)}addMatchingKeys(r,o,l){return this.Br.Rr(o,l),Be.resolve()}removeMatchingKeys(r,o,l){this.Br.mr(o,l);const u=this.persistence.referenceDelegate,f=[];return u&&o.forEach(E=>{f.push(u.markPotentiallyOrphaned(r,E))}),Be.waitFor(f)}removeMatchingKeysForTargetId(r,o){return this.Br.gr(o),Be.resolve()}getMatchingKeysForTargetId(r,o){const l=this.Br.yr(o);return Be.resolve(l)}containsKey(r,o){return Be.resolve(this.Br.containsKey(o))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ove{constructor(r,o){this.qr={},this.overlays={},this.Qr=new vD(0),this.Kr=!1,this.Kr=!0,this.$r=new tve,this.referenceDelegate=r(this),this.Ur=new sve(this),this.indexManager=new YEe,this.remoteDocumentCache=function(u){return new rve(u)}(l=>this.referenceDelegate.Wr(l)),this.serializer=new KEe(o),this.Gr=new ZEe(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(r){return this.indexManager}getDocumentOverlayCache(r){let o=this.overlays[r.toKey()];return o||(o=new eve,this.overlays[r.toKey()]=o),o}getMutationQueue(r,o){let l=this.qr[r.toKey()];return l||(l=new nve(o,this.referenceDelegate),this.qr[r.toKey()]=l),l}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(r,o,l){gt("MemoryPersistence","Starting transaction:",r);const u=new ave(this.Qr.next());return this.referenceDelegate.zr(),l(u).next(f=>this.referenceDelegate.jr(u).next(()=>f)).toPromise().then(f=>(u.raiseOnCommittedEvent(),f))}Hr(r,o){return Be.or(Object.values(this.qr).map(l=>()=>l.containsKey(r,o)))}}class ave extends G_e{constructor(r){super(),this.currentSequenceNumber=r}}class xD{constructor(r){this.persistence=r,this.Jr=new ND,this.Yr=null}static Zr(r){return new xD(r)}get Xr(){if(this.Yr)return this.Yr;throw Gt()}addReference(r,o,l){return this.Jr.addReference(l,o),this.Xr.delete(l.toString()),Be.resolve()}removeReference(r,o,l){return this.Jr.removeReference(l,o),this.Xr.add(l.toString()),Be.resolve()}markPotentiallyOrphaned(r,o){return this.Xr.add(o.toString()),Be.resolve()}removeTarget(r,o){this.Jr.gr(o.targetId).forEach(u=>this.Xr.add(u.toString()));const l=this.persistence.getTargetCache();return l.getMatchingKeysForTargetId(r,o.targetId).next(u=>{u.forEach(f=>this.Xr.add(f.toString()))}).next(()=>l.removeTargetData(r,o))}zr(){this.Yr=new Set}jr(r){const o=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Be.forEach(this.Xr,l=>{const u=Ct.fromPath(l);return this.ei(r,u).next(f=>{f||o.removeEntry(u,Jt.min())})}).next(()=>(this.Yr=null,o.apply(r)))}updateLimboDocument(r,o){return this.ei(r,o).next(l=>{l?this.Xr.delete(o.toString()):this.Xr.add(o.toString())})}Wr(r){return 0}ei(r,o){return Be.or([()=>Be.resolve(this.Jr.containsKey(o)),()=>this.persistence.getTargetCache().containsKey(r,o),()=>this.persistence.Hr(r,o)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OD{constructor(r,o,l,u){this.targetId=r,this.fromCache=o,this.$i=l,this.Ui=u}static Wi(r,o){let l=Tn(),u=Tn();for(const f of o.docChanges)switch(f.type){case 0:l=l.add(f.doc.key);break;case 1:u=u.add(f.doc.key)}return new OD(r,o.fromCache,l,u)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cve{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(r){this._documentReadCount+=r}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lve{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Xpe()?8:W_e(ps())>0?6:4}()}initialize(r,o){this.Ji=r,this.indexManager=o,this.Gi=!0}getDocumentsMatchingQuery(r,o,l,u){const f={result:null};return this.Yi(r,o).next(E=>{f.result=E}).next(()=>{if(!f.result)return this.Zi(r,o,u,l).next(E=>{f.result=E})}).next(()=>{if(f.result)return;const E=new cve;return this.Xi(r,o,E).next(T=>{if(f.result=T,this.zi)return this.es(r,o,E,T.size)})}).next(()=>f.result)}es(r,o,l,u){return l.documentReadCount<this.ji?(P_()<=Rn.DEBUG&&gt("QueryEngine","SDK will not create cache indexes for query:",Im(o),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),Be.resolve()):(P_()<=Rn.DEBUG&&gt("QueryEngine","Query:",Im(o),"scans",l.documentReadCount,"local documents and returns",u,"documents as results."),l.documentReadCount>this.Hi*u?(P_()<=Rn.DEBUG&&gt("QueryEngine","The SDK decides to create cache indexes for query:",Im(o),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(r,Ic(o))):Be.resolve())}Yi(r,o){if(pz(o))return Be.resolve(null);let l=Ic(o);return this.indexManager.getIndexType(r,l).next(u=>u===0?null:(o.limit!==null&&u===1&&(o=fb(o,null,"F"),l=Ic(o)),this.indexManager.getDocumentsMatchingTarget(r,l).next(f=>{const E=Tn(...f);return this.Ji.getDocuments(r,E).next(T=>this.indexManager.getMinOffset(r,l).next(w=>{const A=this.ts(o,T);return this.ns(o,A,E,w.readTime)?this.Yi(r,fb(o,null,"F")):this.rs(r,A,o,w)}))})))}Zi(r,o,l,u){return pz(o)||u.isEqual(Jt.min())?Be.resolve(null):this.Ji.getDocuments(r,l).next(f=>{const E=this.ts(o,f);return this.ns(o,E,l,u)?Be.resolve(null):(P_()<=Rn.DEBUG&&gt("QueryEngine","Re-using previous result from %s to execute query: %s",u.toString(),Im(o)),this.rs(r,E,o,j_e(u,-1)).next(T=>T))})}ts(r,o){let l=new Yi(zK(r));return o.forEach((u,f)=>{rR(r,f)&&(l=l.add(f))}),l}ns(r,o,l,u){if(r.limit===null)return!1;if(l.size!==o.size)return!0;const f=r.limitType==="F"?o.last():o.first();return!!f&&(f.hasPendingWrites||f.version.compareTo(u)>0)}Xi(r,o,l){return P_()<=Rn.DEBUG&&gt("QueryEngine","Using full collection scan to execute query:",Im(o)),this.Ji.getDocumentsMatchingQuery(r,o,Qd.min(),l)}rs(r,o,l,u){return this.Ji.getDocumentsMatchingQuery(r,l,u).next(f=>(o.forEach(E=>{f=f.insert(E.key,E)}),f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dve{constructor(r,o,l,u){this.persistence=r,this.ss=o,this.serializer=u,this.os=new Gr(kn),this._s=new Af(f=>bD(f),RD),this.us=new Map,this.cs=r.getRemoteDocumentCache(),this.Ur=r.getTargetCache(),this.Gr=r.getBundleCache(),this.ls(l)}ls(r){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(r),this.indexManager=this.persistence.getIndexManager(r),this.mutationQueue=this.persistence.getMutationQueue(r,this.indexManager),this.localDocuments=new $Ee(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(r){return this.persistence.runTransaction("Collect garbage","readwrite-primary",o=>r.collect(o,this.os))}}function uve(s,r,o,l){return new dve(s,r,o,l)}async function p7(s,r){const o=$t(s);return await o.persistence.runTransaction("Handle user change","readonly",l=>{let u;return o.mutationQueue.getAllMutationBatches(l).next(f=>(u=f,o.ls(r),o.mutationQueue.getAllMutationBatches(l))).next(f=>{const E=[],T=[];let w=Tn();for(const A of u){E.push(A.batchId);for(const U of A.mutations)w=w.add(U.key)}for(const A of f){T.push(A.batchId);for(const U of A.mutations)w=w.add(U.key)}return o.localDocuments.getDocuments(l,w).next(A=>({hs:A,removedBatchIds:E,addedBatchIds:T}))})})}function hve(s,r){const o=$t(s);return o.persistence.runTransaction("Acknowledge batch","readwrite-primary",l=>{const u=r.batch.keys(),f=o.cs.newChangeBuffer({trackRemovals:!0});return function(T,w,A,U){const M=A.batch,F=M.keys();let Y=Be.resolve();return F.forEach(J=>{Y=Y.next(()=>U.getEntry(w,J)).next(ae=>{const he=A.docVersions.get(J);Jn(he!==null),ae.version.compareTo(he)<0&&(M.applyToRemoteDocument(ae,A),ae.isValidDocument()&&(ae.setReadTime(A.commitVersion),U.addEntry(ae)))})}),Y.next(()=>T.mutationQueue.removeMutationBatch(w,M))}(o,l,r,f).next(()=>f.apply(l)).next(()=>o.mutationQueue.performConsistencyCheck(l)).next(()=>o.documentOverlayCache.removeOverlaysForBatchId(l,u,r.batch.batchId)).next(()=>o.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,function(T){let w=Tn();for(let A=0;A<T.mutationResults.length;++A)T.mutationResults[A].transformResults.length>0&&(w=w.add(T.batch.mutations[A].key));return w}(r))).next(()=>o.localDocuments.getDocuments(l,u))})}function m7(s){const r=$t(s);return r.persistence.runTransaction("Get last remote snapshot version","readonly",o=>r.Ur.getLastRemoteSnapshotVersion(o))}function pve(s,r){const o=$t(s),l=r.snapshotVersion;let u=o.os;return o.persistence.runTransaction("Apply remote event","readwrite-primary",f=>{const E=o.cs.newChangeBuffer({trackRemovals:!0});u=o.os;const T=[];r.targetChanges.forEach((U,M)=>{const F=u.get(M);if(!F)return;T.push(o.Ur.removeMatchingKeys(f,U.removedDocuments,M).next(()=>o.Ur.addMatchingKeys(f,U.addedDocuments,M)));let Y=F.withSequenceNumber(f.currentSequenceNumber);r.targetMismatches.get(M)!==null?Y=Y.withResumeToken(Ji.EMPTY_BYTE_STRING,Jt.min()).withLastLimboFreeSnapshotVersion(Jt.min()):U.resumeToken.approximateByteSize()>0&&(Y=Y.withResumeToken(U.resumeToken,l)),u=u.insert(M,Y),function(ae,he,ee){return ae.resumeToken.approximateByteSize()===0||he.snapshotVersion.toMicroseconds()-ae.snapshotVersion.toMicroseconds()>=3e8?!0:ee.addedDocuments.size+ee.modifiedDocuments.size+ee.removedDocuments.size>0}(F,Y,U)&&T.push(o.Ur.updateTargetData(f,Y))});let w=wl(),A=Tn();if(r.documentUpdates.forEach(U=>{r.resolvedLimboDocuments.has(U)&&T.push(o.persistence.referenceDelegate.updateLimboDocument(f,U))}),T.push(mve(f,E,r.documentUpdates).next(U=>{w=U.Ps,A=U.Is})),!l.isEqual(Jt.min())){const U=o.Ur.getLastRemoteSnapshotVersion(f).next(M=>o.Ur.setTargetsMetadata(f,f.currentSequenceNumber,l));T.push(U)}return Be.waitFor(T).next(()=>E.apply(f)).next(()=>o.localDocuments.getLocalViewOfDocuments(f,w,A)).next(()=>w)}).then(f=>(o.os=u,f))}function mve(s,r,o){let l=Tn(),u=Tn();return o.forEach(f=>l=l.add(f)),r.getEntries(s,l).next(f=>{let E=wl();return o.forEach((T,w)=>{const A=f.get(T);w.isFoundDocument()!==A.isFoundDocument()&&(u=u.add(T)),w.isNoDocument()&&w.version.isEqual(Jt.min())?(r.removeEntry(T,w.readTime),E=E.insert(T,w)):!A.isValidDocument()||w.version.compareTo(A.version)>0||w.version.compareTo(A.version)===0&&A.hasPendingWrites?(r.addEntry(w),E=E.insert(T,w)):gt("LocalStore","Ignoring outdated watch update for ",T,". Current version:",A.version," Watch version:",w.version)}),{Ps:E,Is:u}})}function fve(s,r){const o=$t(s);return o.persistence.runTransaction("Get next mutation batch","readonly",l=>(r===void 0&&(r=-1),o.mutationQueue.getNextMutationBatchAfterBatchId(l,r)))}function gve(s,r){const o=$t(s);return o.persistence.runTransaction("Allocate target","readwrite",l=>{let u;return o.Ur.getTargetData(l,r).next(f=>f?(u=f,Be.resolve(u)):o.Ur.allocateTargetId(l).next(E=>(u=new Dd(r,E,"TargetPurposeListen",l.currentSequenceNumber),o.Ur.addTargetData(l,u).next(()=>u))))}).then(l=>{const u=o.os.get(l.targetId);return(u===null||l.snapshotVersion.compareTo(u.snapshotVersion)>0)&&(o.os=o.os.insert(l.targetId,l),o._s.set(r,l.targetId)),l})}async function QO(s,r,o){const l=$t(s),u=l.os.get(r),f=o?"readwrite":"readwrite-primary";try{o||await l.persistence.runTransaction("Release target",f,E=>l.persistence.referenceDelegate.removeTarget(E,u))}catch(E){if(!QE(E))throw E;gt("LocalStore",`Failed to update sequence numbers for target ${r}: ${E}`)}l.os=l.os.remove(r),l._s.delete(u.target)}function Rz(s,r,o){const l=$t(s);let u=Jt.min(),f=Tn();return l.persistence.runTransaction("Execute query","readwrite",E=>function(w,A,U){const M=$t(w),F=M._s.get(U);return F!==void 0?Be.resolve(M.os.get(F)):M.Ur.getTargetData(A,U)}(l,E,Ic(r)).next(T=>{if(T)return u=T.lastLimboFreeSnapshotVersion,l.Ur.getMatchingKeysForTargetId(E,T.targetId).next(w=>{f=w})}).next(()=>l.ss.getDocumentsMatchingQuery(E,r,o?u:Jt.min(),o?f:Tn())).next(T=>(_ve(l,aEe(r),T),{documents:T,Ts:f})))}function _ve(s,r,o){let l=s.us.get(r)||Jt.min();o.forEach((u,f)=>{f.readTime.compareTo(l)>0&&(l=f.readTime)}),s.us.set(r,l)}class wz{constructor(){this.activeTargetIds=pEe()}fs(r){this.activeTargetIds=this.activeTargetIds.add(r)}gs(r){this.activeTargetIds=this.activeTargetIds.delete(r)}Vs(){const r={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(r)}}class Eve{constructor(){this.so=new wz,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(r){}updateMutationState(r,o,l){}addLocalQueryTarget(r,o=!0){return o&&this.so.fs(r),this.oo[r]||"not-current"}updateQueryState(r,o,l){this.oo[r]=o}removeLocalQueryTarget(r){this.so.gs(r)}isLocalQueryTarget(r){return this.so.activeTargetIds.has(r)}clearQueryState(r){delete this.oo[r]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(r){return this.so.activeTargetIds.has(r)}start(){return this.so=new wz,Promise.resolve()}handleUserChange(r,o,l){}setOnlineState(r){}shutdown(){}writeSequenceNumber(r){}notifyBundleLoaded(r){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vve{_o(r){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cz{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(r){this.ho.push(r)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){gt("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const r of this.ho)r(0)}lo(){gt("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const r of this.ho)r(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let c0=null;function wx(){return c0===null?c0=function(){return 268435456+Math.round(2147483648*Math.random())}():c0++,"0x"+c0.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yve={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sve{constructor(r){this.Io=r.Io,this.To=r.To}Eo(r){this.Ao=r}Ro(r){this.Vo=r}mo(r){this.fo=r}onMessage(r){this.po=r}close(){this.To()}send(r){this.Io(r)}yo(){this.Ao()}wo(){this.Vo()}So(r){this.fo(r)}bo(r){this.po(r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const os="WebChannelConnection";class Tve extends class{constructor(o){this.databaseInfo=o,this.databaseId=o.databaseId;const l=o.ssl?"https":"http",u=encodeURIComponent(this.databaseId.projectId),f=encodeURIComponent(this.databaseId.database);this.Do=l+"://"+o.host,this.vo=`projects/${u}/databases/${f}`,this.Co=this.databaseId.database==="(default)"?`project_id=${u}`:`project_id=${u}&database_id=${f}`}get Fo(){return!1}Mo(o,l,u,f,E){const T=wx(),w=this.xo(o,l.toUriEncodedString());gt("RestConnection",`Sending RPC '${o}' ${T}:`,w,u);const A={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(A,f,E),this.No(o,w,A,u).then(U=>(gt("RestConnection",`Received RPC '${o}' ${T}: `,U),U),U=>{throw df("RestConnection",`RPC '${o}' ${T} failed with error: `,U,"url: ",w,"request:",u),U})}Lo(o,l,u,f,E,T){return this.Mo(o,l,u,f,E)}Oo(o,l,u){o["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Cf}(),o["Content-Type"]="text/plain",this.databaseInfo.appId&&(o["X-Firebase-GMPID"]=this.databaseInfo.appId),l&&l.headers.forEach((f,E)=>o[E]=f),u&&u.headers.forEach((f,E)=>o[E]=f)}xo(o,l){const u=yve[o];return`${this.Do}/v1/${l}:${u}`}terminate(){}}{constructor(r){super(r),this.forceLongPolling=r.forceLongPolling,this.autoDetectLongPolling=r.autoDetectLongPolling,this.useFetchStreams=r.useFetchStreams,this.longPollingOptions=r.longPollingOptions}No(r,o,l,u){const f=wx();return new Promise((E,T)=>{const w=new CK;w.setWithCredentials(!0),w.listenOnce(IK.COMPLETE,()=>{try{switch(w.getLastErrorCode()){case C0.NO_ERROR:const U=w.getResponseJson();gt(os,`XHR for RPC '${r}' ${f} received:`,JSON.stringify(U)),E(U);break;case C0.TIMEOUT:gt(os,`RPC '${r}' ${f} timed out`),T(new ut(je.DEADLINE_EXCEEDED,"Request time out"));break;case C0.HTTP_ERROR:const M=w.getStatus();if(gt(os,`RPC '${r}' ${f} failed with status:`,M,"response text:",w.getResponseText()),M>0){let F=w.getResponseJson();Array.isArray(F)&&(F=F[0]);const Y=F==null?void 0:F.error;if(Y&&Y.status&&Y.message){const J=function(he){const ee=he.toLowerCase().replace(/_/g,"-");return Object.values(je).indexOf(ee)>=0?ee:je.UNKNOWN}(Y.status);T(new ut(J,Y.message))}else T(new ut(je.UNKNOWN,"Server responded with status "+w.getStatus()))}else T(new ut(je.UNAVAILABLE,"Connection failed."));break;default:Gt()}}finally{gt(os,`RPC '${r}' ${f} completed.`)}});const A=JSON.stringify(u);gt(os,`RPC '${r}' ${f} sending request:`,u),w.send(o,"POST",A,l,15)})}Bo(r,o,l){const u=wx(),f=[this.Do,"/","google.firestore.v1.Firestore","/",r,"/channel"],E=xK(),T=NK(),w={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},A=this.longPollingOptions.timeoutSeconds;A!==void 0&&(w.longPollingTimeout=Math.round(1e3*A)),this.useFetchStreams&&(w.useFetchStreams=!0),this.Oo(w.initMessageHeaders,o,l),w.encodeInitMessageHeaders=!0;const U=f.join("");gt(os,`Creating RPC '${r}' stream ${u}: ${U}`,w);const M=E.createWebChannel(U,w);let F=!1,Y=!1;const J=new Sve({Io:he=>{Y?gt(os,`Not sending because RPC '${r}' stream ${u} is closed:`,he):(F||(gt(os,`Opening RPC '${r}' stream ${u} transport.`),M.open(),F=!0),gt(os,`RPC '${r}' stream ${u} sending:`,he),M.send(he))},To:()=>M.close()}),ae=(he,ee,W)=>{he.listen(ee,Z=>{try{W(Z)}catch(fe){setTimeout(()=>{throw fe},0)}})};return ae(M,V_.EventType.OPEN,()=>{Y||(gt(os,`RPC '${r}' stream ${u} transport opened.`),J.yo())}),ae(M,V_.EventType.CLOSE,()=>{Y||(Y=!0,gt(os,`RPC '${r}' stream ${u} transport closed`),J.So())}),ae(M,V_.EventType.ERROR,he=>{Y||(Y=!0,df(os,`RPC '${r}' stream ${u} transport errored:`,he),J.So(new ut(je.UNAVAILABLE,"The operation could not be completed")))}),ae(M,V_.EventType.MESSAGE,he=>{var ee;if(!Y){const W=he.data[0];Jn(!!W);const Z=W,fe=Z.error||((ee=Z[0])===null||ee===void 0?void 0:ee.error);if(fe){gt(os,`RPC '${r}' stream ${u} received error:`,fe);const pe=fe.status;let Ce=function(re){const $=ii[re];if($!==void 0)return r7($)}(pe),te=fe.message;Ce===void 0&&(Ce=je.INTERNAL,te="Unknown error status: "+pe+" with message "+fe.message),Y=!0,J.So(new ut(Ce,te)),M.close()}else gt(os,`RPC '${r}' stream ${u} received:`,W),J.bo(W)}}),ae(T,AK.STAT_EVENT,he=>{he.stat===BO.PROXY?gt(os,`RPC '${r}' stream ${u} detected buffering proxy`):he.stat===BO.NOPROXY&&gt(os,`RPC '${r}' stream ${u} detected no buffering proxy`)}),setTimeout(()=>{J.wo()},0),J}}function Cx(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aR(s){return new PEe(s,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f7{constructor(r,o,l=1e3,u=1.5,f=6e4){this.ui=r,this.timerId=o,this.ko=l,this.qo=u,this.Qo=f,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(r){this.cancel();const o=Math.floor(this.Ko+this.zo()),l=Math.max(0,Date.now()-this.Uo),u=Math.max(0,o-l);u>0&&gt("ExponentialBackoff",`Backing off for ${u} ms (base delay: ${this.Ko} ms, delay with jitter: ${o} ms, last attempt: ${l} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,u,()=>(this.Uo=Date.now(),r())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g7{constructor(r,o,l,u,f,E,T,w){this.ui=r,this.Ho=l,this.Jo=u,this.connection=f,this.authCredentialsProvider=E,this.appCheckCredentialsProvider=T,this.listener=w,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new f7(r,o)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(r){this.u_(),this.stream.send(r)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(r,o){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,r!==4?this.t_.reset():o&&o.code===je.RESOURCE_EXHAUSTED?(Rl(o.toString()),Rl("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):o&&o.code===je.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=r,await this.listener.mo(o)}l_(){}auth(){this.state=1;const r=this.h_(this.Yo),o=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([l,u])=>{this.Yo===o&&this.P_(l,u)},l=>{r(()=>{const u=new ut(je.UNKNOWN,"Fetching auth token failed: "+l.message);return this.I_(u)})})}P_(r,o){const l=this.h_(this.Yo);this.stream=this.T_(r,o),this.stream.Eo(()=>{l(()=>this.listener.Eo())}),this.stream.Ro(()=>{l(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(u=>{l(()=>this.I_(u))}),this.stream.onMessage(u=>{l(()=>++this.e_==1?this.E_(u):this.onNext(u))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(r){return gt("PersistentStream",`close with error: ${r}`),this.stream=null,this.close(4,r)}h_(r){return o=>{this.ui.enqueueAndForget(()=>this.Yo===r?o():(gt("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class bve extends g7{constructor(r,o,l,u,f,E){super(r,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",o,l,u,E),this.serializer=f}T_(r,o){return this.connection.Bo("Listen",r,o)}E_(r){return this.onNext(r)}onNext(r){this.t_.reset();const o=LEe(this.serializer,r),l=function(f){if(!("targetChange"in f))return Jt.min();const E=f.targetChange;return E.targetIds&&E.targetIds.length?Jt.min():E.readTime?Ac(E.readTime):Jt.min()}(r);return this.listener.d_(o,l)}A_(r){const o={};o.database=JO(this.serializer),o.addTarget=function(f,E){let T;const w=E.target;if(T=HO(w)?{documents:jEe(f,w)}:{query:VEe(f,w)._t},T.targetId=E.targetId,E.resumeToken.approximateByteSize()>0){T.resumeToken=o7(f,E.resumeToken);const A=qO(f,E.expectedCount);A!==null&&(T.expectedCount=A)}else if(E.snapshotVersion.compareTo(Jt.min())>0){T.readTime=_b(f,E.snapshotVersion.toTimestamp());const A=qO(f,E.expectedCount);A!==null&&(T.expectedCount=A)}return T}(this.serializer,r);const l=BEe(this.serializer,r);l&&(o.labels=l),this.a_(o)}R_(r){const o={};o.database=JO(this.serializer),o.removeTarget=r,this.a_(o)}}class Rve extends g7{constructor(r,o,l,u,f,E){super(r,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",o,l,u,E),this.serializer=f}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(r,o){return this.connection.Bo("Write",r,o)}E_(r){return Jn(!!r.streamToken),this.lastStreamToken=r.streamToken,Jn(!r.writeResults||r.writeResults.length===0),this.listener.f_()}onNext(r){Jn(!!r.streamToken),this.lastStreamToken=r.streamToken,this.t_.reset();const o=UEe(r.writeResults,r.commitTime),l=Ac(r.commitTime);return this.listener.g_(l,o)}p_(){const r={};r.database=JO(this.serializer),this.a_(r)}m_(r){const o={streamToken:this.lastStreamToken,writes:r.map(l=>MEe(this.serializer,l))};this.a_(o)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wve extends class{}{constructor(r,o,l,u){super(),this.authCredentials=r,this.appCheckCredentials=o,this.connection=l,this.serializer=u,this.y_=!1}w_(){if(this.y_)throw new ut(je.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(r,o,l,u){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,E])=>this.connection.Mo(r,YO(o,l),u,f,E)).catch(f=>{throw f.name==="FirebaseError"?(f.code===je.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),f):new ut(je.UNKNOWN,f.toString())})}Lo(r,o,l,u,f){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([E,T])=>this.connection.Lo(r,YO(o,l),u,E,T,f)).catch(E=>{throw E.name==="FirebaseError"?(E.code===je.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),E):new ut(je.UNKNOWN,E.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class Cve{constructor(r,o){this.asyncQueue=r,this.onlineStateHandler=o,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(r){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${r.toString()}`),this.C_("Offline")))}set(r){this.x_(),this.S_=0,r==="Online"&&(this.D_=!1),this.C_(r)}C_(r){r!==this.state&&(this.state=r,this.onlineStateHandler(r))}F_(r){const o=`Could not reach Cloud Firestore backend. ${r}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Rl(o),this.D_=!1):gt("OnlineStateTracker",o)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ive{constructor(r,o,l,u,f){this.localStore=r,this.datastore=o,this.asyncQueue=l,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=f,this.k_._o(E=>{l.enqueueAndForget(async()=>{Hh(this)&&(gt("RemoteStore","Restarting streams for network reachability change."),await async function(w){const A=$t(w);A.L_.add(4),await ev(A),A.q_.set("Unknown"),A.L_.delete(4),await cR(A)}(this))})}),this.q_=new Cve(l,u)}}async function cR(s){if(Hh(s))for(const r of s.B_)await r(!0)}async function ev(s){for(const r of s.B_)await r(!1)}function _7(s,r){const o=$t(s);o.N_.has(r.targetId)||(o.N_.set(r.targetId,r),LD(o)?kD(o):Nf(o).r_()&&DD(o,r))}function PD(s,r){const o=$t(s),l=Nf(o);o.N_.delete(r),l.r_()&&E7(o,r),o.N_.size===0&&(l.r_()?l.o_():Hh(o)&&o.q_.set("Unknown"))}function DD(s,r){if(s.Q_.xe(r.targetId),r.resumeToken.approximateByteSize()>0||r.snapshotVersion.compareTo(Jt.min())>0){const o=s.remoteSyncer.getRemoteKeysForTarget(r.targetId).size;r=r.withExpectedCount(o)}Nf(s).A_(r)}function E7(s,r){s.Q_.xe(r),Nf(s).R_(r)}function kD(s){s.Q_=new AEe({getRemoteKeysForTarget:r=>s.remoteSyncer.getRemoteKeysForTarget(r),ot:r=>s.N_.get(r)||null,tt:()=>s.datastore.serializer.databaseId}),Nf(s).start(),s.q_.v_()}function LD(s){return Hh(s)&&!Nf(s).n_()&&s.N_.size>0}function Hh(s){return $t(s).L_.size===0}function v7(s){s.Q_=void 0}async function Ave(s){s.q_.set("Online")}async function Nve(s){s.N_.forEach((r,o)=>{DD(s,r)})}async function xve(s,r){v7(s),LD(s)?(s.q_.M_(r),kD(s)):s.q_.set("Unknown")}async function Ove(s,r,o){if(s.q_.set("Online"),r instanceof s7&&r.state===2&&r.cause)try{await async function(u,f){const E=f.cause;for(const T of f.targetIds)u.N_.has(T)&&(await u.remoteSyncer.rejectListen(T,E),u.N_.delete(T),u.Q_.removeTarget(T))}(s,r)}catch(l){gt("RemoteStore","Failed to remove targets %s: %s ",r.targetIds.join(","),l),await Eb(s,l)}else if(r instanceof N0?s.Q_.Ke(r):r instanceof i7?s.Q_.He(r):s.Q_.We(r),!o.isEqual(Jt.min()))try{const l=await m7(s.localStore);o.compareTo(l)>=0&&await function(f,E){const T=f.Q_.rt(E);return T.targetChanges.forEach((w,A)=>{if(w.resumeToken.approximateByteSize()>0){const U=f.N_.get(A);U&&f.N_.set(A,U.withResumeToken(w.resumeToken,E))}}),T.targetMismatches.forEach((w,A)=>{const U=f.N_.get(w);if(!U)return;f.N_.set(w,U.withResumeToken(Ji.EMPTY_BYTE_STRING,U.snapshotVersion)),E7(f,w);const M=new Dd(U.target,w,A,U.sequenceNumber);DD(f,M)}),f.remoteSyncer.applyRemoteEvent(T)}(s,o)}catch(l){gt("RemoteStore","Failed to raise snapshot:",l),await Eb(s,l)}}async function Eb(s,r,o){if(!QE(r))throw r;s.L_.add(1),await ev(s),s.q_.set("Offline"),o||(o=()=>m7(s.localStore)),s.asyncQueue.enqueueRetryable(async()=>{gt("RemoteStore","Retrying IndexedDB access"),await o(),s.L_.delete(1),await cR(s)})}function y7(s,r){return r().catch(o=>Eb(s,o,r))}async function lR(s){const r=$t(s),o=Zd(r);let l=r.O_.length>0?r.O_[r.O_.length-1].batchId:-1;for(;Pve(r);)try{const u=await fve(r.localStore,l);if(u===null){r.O_.length===0&&o.o_();break}l=u.batchId,Dve(r,u)}catch(u){await Eb(r,u)}S7(r)&&T7(r)}function Pve(s){return Hh(s)&&s.O_.length<10}function Dve(s,r){s.O_.push(r);const o=Zd(s);o.r_()&&o.V_&&o.m_(r.mutations)}function S7(s){return Hh(s)&&!Zd(s).n_()&&s.O_.length>0}function T7(s){Zd(s).start()}async function kve(s){Zd(s).p_()}async function Lve(s){const r=Zd(s);for(const o of s.O_)r.m_(o.mutations)}async function Mve(s,r,o){const l=s.O_.shift(),u=CD.from(l,r,o);await y7(s,()=>s.remoteSyncer.applySuccessfulWrite(u)),await lR(s)}async function Uve(s,r){r&&Zd(s).V_&&await async function(l,u){if(function(E){return wEe(E)&&E!==je.ABORTED}(u.code)){const f=l.O_.shift();Zd(l).s_(),await y7(l,()=>l.remoteSyncer.rejectFailedWrite(f.batchId,u)),await lR(l)}}(s,r),S7(s)&&T7(s)}async function Iz(s,r){const o=$t(s);o.asyncQueue.verifyOperationInProgress(),gt("RemoteStore","RemoteStore received new credentials");const l=Hh(o);o.L_.add(3),await ev(o),l&&o.q_.set("Unknown"),await o.remoteSyncer.handleCredentialChange(r),o.L_.delete(3),await cR(o)}async function jve(s,r){const o=$t(s);r?(o.L_.delete(2),await cR(o)):r||(o.L_.add(2),await ev(o),o.q_.set("Unknown"))}function Nf(s){return s.K_||(s.K_=function(o,l,u){const f=$t(o);return f.w_(),new bve(l,f.connection,f.authCredentials,f.appCheckCredentials,f.serializer,u)}(s.datastore,s.asyncQueue,{Eo:Ave.bind(null,s),Ro:Nve.bind(null,s),mo:xve.bind(null,s),d_:Ove.bind(null,s)}),s.B_.push(async r=>{r?(s.K_.s_(),LD(s)?kD(s):s.q_.set("Unknown")):(await s.K_.stop(),v7(s))})),s.K_}function Zd(s){return s.U_||(s.U_=function(o,l,u){const f=$t(o);return f.w_(),new Rve(l,f.connection,f.authCredentials,f.appCheckCredentials,f.serializer,u)}(s.datastore,s.asyncQueue,{Eo:()=>Promise.resolve(),Ro:kve.bind(null,s),mo:Uve.bind(null,s),f_:Lve.bind(null,s),g_:Mve.bind(null,s)}),s.B_.push(async r=>{r?(s.U_.s_(),await lR(s)):(await s.U_.stop(),s.O_.length>0&&(gt("RemoteStore",`Stopping write stream with ${s.O_.length} pending writes`),s.O_=[]))})),s.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MD{constructor(r,o,l,u,f){this.asyncQueue=r,this.timerId=o,this.targetTimeMs=l,this.op=u,this.removalCallback=f,this.deferred=new fl,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(E=>{})}get promise(){return this.deferred.promise}static createAndSchedule(r,o,l,u,f){const E=Date.now()+l,T=new MD(r,o,E,u,f);return T.start(l),T}start(r){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),r)}skipDelay(){return this.handleDelayElapsed()}cancel(r){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ut(je.CANCELLED,"Operation cancelled"+(r?": "+r:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(r=>this.deferred.resolve(r))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function UD(s,r){if(Rl("AsyncQueue",`${r}: ${s}`),QE(s))return new ut(je.UNAVAILABLE,`${r}: ${s}`);throw s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zm{constructor(r){this.comparator=r?(o,l)=>r(o,l)||Ct.comparator(o.key,l.key):(o,l)=>Ct.comparator(o.key,l.key),this.keyedMap=F_(),this.sortedSet=new Gr(this.comparator)}static emptySet(r){return new Zm(r.comparator)}has(r){return this.keyedMap.get(r)!=null}get(r){return this.keyedMap.get(r)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(r){const o=this.keyedMap.get(r);return o?this.sortedSet.indexOf(o):-1}get size(){return this.sortedSet.size}forEach(r){this.sortedSet.inorderTraversal((o,l)=>(r(o),!1))}add(r){const o=this.delete(r.key);return o.copy(o.keyedMap.insert(r.key,r),o.sortedSet.insert(r,null))}delete(r){const o=this.get(r);return o?this.copy(this.keyedMap.remove(r),this.sortedSet.remove(o)):this}isEqual(r){if(!(r instanceof Zm)||this.size!==r.size)return!1;const o=this.sortedSet.getIterator(),l=r.sortedSet.getIterator();for(;o.hasNext();){const u=o.getNext().key,f=l.getNext().key;if(!u.isEqual(f))return!1}return!0}toString(){const r=[];return this.forEach(o=>{r.push(o.toString())}),r.length===0?"DocumentSet ()":`DocumentSet (
  `+r.join(`  
`)+`
)`}copy(r,o){const l=new Zm;return l.comparator=this.comparator,l.keyedMap=r,l.sortedSet=o,l}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Az{constructor(){this.W_=new Gr(Ct.comparator)}track(r){const o=r.doc.key,l=this.W_.get(o);l?r.type!==0&&l.type===3?this.W_=this.W_.insert(o,r):r.type===3&&l.type!==1?this.W_=this.W_.insert(o,{type:l.type,doc:r.doc}):r.type===2&&l.type===2?this.W_=this.W_.insert(o,{type:2,doc:r.doc}):r.type===2&&l.type===0?this.W_=this.W_.insert(o,{type:0,doc:r.doc}):r.type===1&&l.type===0?this.W_=this.W_.remove(o):r.type===1&&l.type===2?this.W_=this.W_.insert(o,{type:1,doc:l.doc}):r.type===0&&l.type===1?this.W_=this.W_.insert(o,{type:2,doc:r.doc}):Gt():this.W_=this.W_.insert(o,r)}G_(){const r=[];return this.W_.inorderTraversal((o,l)=>{r.push(l)}),r}}class gf{constructor(r,o,l,u,f,E,T,w,A){this.query=r,this.docs=o,this.oldDocs=l,this.docChanges=u,this.mutatedKeys=f,this.fromCache=E,this.syncStateChanged=T,this.excludesMetadataChanges=w,this.hasCachedResults=A}static fromInitialDocuments(r,o,l,u,f){const E=[];return o.forEach(T=>{E.push({type:0,doc:T})}),new gf(r,o,Zm.emptySet(o),E,l,u,!0,!1,f)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(r){if(!(this.fromCache===r.fromCache&&this.hasCachedResults===r.hasCachedResults&&this.syncStateChanged===r.syncStateChanged&&this.mutatedKeys.isEqual(r.mutatedKeys)&&nR(this.query,r.query)&&this.docs.isEqual(r.docs)&&this.oldDocs.isEqual(r.oldDocs)))return!1;const o=this.docChanges,l=r.docChanges;if(o.length!==l.length)return!1;for(let u=0;u<o.length;u++)if(o[u].type!==l[u].type||!o[u].doc.isEqual(l[u].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vve{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(r=>r.J_())}}class Fve{constructor(){this.queries=Nz(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(o,l){const u=$t(o),f=u.queries;u.queries=Nz(),f.forEach((E,T)=>{for(const w of T.j_)w.onError(l)})})(this,new ut(je.ABORTED,"Firestore shutting down"))}}function Nz(){return new Af(s=>WK(s),nR)}async function jD(s,r){const o=$t(s);let l=3;const u=r.query;let f=o.queries.get(u);f?!f.H_()&&r.J_()&&(l=2):(f=new Vve,l=r.J_()?0:1);try{switch(l){case 0:f.z_=await o.onListen(u,!0);break;case 1:f.z_=await o.onListen(u,!1);break;case 2:await o.onFirstRemoteStoreListen(u)}}catch(E){const T=UD(E,`Initialization of query '${Im(r.query)}' failed`);return void r.onError(T)}o.queries.set(u,f),f.j_.push(r),r.Z_(o.onlineState),f.z_&&r.X_(f.z_)&&FD(o)}async function VD(s,r){const o=$t(s),l=r.query;let u=3;const f=o.queries.get(l);if(f){const E=f.j_.indexOf(r);E>=0&&(f.j_.splice(E,1),f.j_.length===0?u=r.J_()?0:1:!f.H_()&&r.J_()&&(u=2))}switch(u){case 0:return o.queries.delete(l),o.onUnlisten(l,!0);case 1:return o.queries.delete(l),o.onUnlisten(l,!1);case 2:return o.onLastRemoteStoreUnlisten(l);default:return}}function Bve(s,r){const o=$t(s);let l=!1;for(const u of r){const f=u.query,E=o.queries.get(f);if(E){for(const T of E.j_)T.X_(u)&&(l=!0);E.z_=u}}l&&FD(o)}function Gve(s,r,o){const l=$t(s),u=l.queries.get(r);if(u)for(const f of u.j_)f.onError(o);l.queries.delete(r)}function FD(s){s.Y_.forEach(r=>{r.next()})}var $O,xz;(xz=$O||($O={})).ea="default",xz.Cache="cache";class BD{constructor(r,o,l){this.query=r,this.ta=o,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=l||{}}X_(r){if(!this.options.includeMetadataChanges){const l=[];for(const u of r.docChanges)u.type!==3&&l.push(u);r=new gf(r.query,r.docs,r.oldDocs,l,r.mutatedKeys,r.fromCache,r.syncStateChanged,!0,r.hasCachedResults)}let o=!1;return this.na?this.ia(r)&&(this.ta.next(r),o=!0):this.sa(r,this.onlineState)&&(this.oa(r),o=!0),this.ra=r,o}onError(r){this.ta.error(r)}Z_(r){this.onlineState=r;let o=!1;return this.ra&&!this.na&&this.sa(this.ra,r)&&(this.oa(this.ra),o=!0),o}sa(r,o){if(!r.fromCache||!this.J_())return!0;const l=o!=="Offline";return(!this.options._a||!l)&&(!r.docs.isEmpty()||r.hasCachedResults||o==="Offline")}ia(r){if(r.docChanges.length>0)return!0;const o=this.ra&&this.ra.hasPendingWrites!==r.hasPendingWrites;return!(!r.syncStateChanged&&!o)&&this.options.includeMetadataChanges===!0}oa(r){r=gf.fromInitialDocuments(r.query,r.docs,r.mutatedKeys,r.fromCache,r.hasCachedResults),this.na=!0,this.ta.next(r)}J_(){return this.options.source!==$O.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b7{constructor(r){this.key=r}}class R7{constructor(r){this.key=r}}class Wve{constructor(r,o){this.query=r,this.Ta=o,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Tn(),this.mutatedKeys=Tn(),this.Aa=zK(r),this.Ra=new Zm(this.Aa)}get Va(){return this.Ta}ma(r,o){const l=o?o.fa:new Az,u=o?o.Ra:this.Ra;let f=o?o.mutatedKeys:this.mutatedKeys,E=u,T=!1;const w=this.query.limitType==="F"&&u.size===this.query.limit?u.last():null,A=this.query.limitType==="L"&&u.size===this.query.limit?u.first():null;if(r.inorderTraversal((U,M)=>{const F=u.get(U),Y=rR(this.query,M)?M:null,J=!!F&&this.mutatedKeys.has(F.key),ae=!!Y&&(Y.hasLocalMutations||this.mutatedKeys.has(Y.key)&&Y.hasCommittedMutations);let he=!1;F&&Y?F.data.isEqual(Y.data)?J!==ae&&(l.track({type:3,doc:Y}),he=!0):this.ga(F,Y)||(l.track({type:2,doc:Y}),he=!0,(w&&this.Aa(Y,w)>0||A&&this.Aa(Y,A)<0)&&(T=!0)):!F&&Y?(l.track({type:0,doc:Y}),he=!0):F&&!Y&&(l.track({type:1,doc:F}),he=!0,(w||A)&&(T=!0)),he&&(Y?(E=E.add(Y),f=ae?f.add(U):f.delete(U)):(E=E.delete(U),f=f.delete(U)))}),this.query.limit!==null)for(;E.size>this.query.limit;){const U=this.query.limitType==="F"?E.last():E.first();E=E.delete(U.key),f=f.delete(U.key),l.track({type:1,doc:U})}return{Ra:E,fa:l,ns:T,mutatedKeys:f}}ga(r,o){return r.hasLocalMutations&&o.hasCommittedMutations&&!o.hasLocalMutations}applyChanges(r,o,l,u){const f=this.Ra;this.Ra=r.Ra,this.mutatedKeys=r.mutatedKeys;const E=r.fa.G_();E.sort((U,M)=>function(Y,J){const ae=he=>{switch(he){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Gt()}};return ae(Y)-ae(J)}(U.type,M.type)||this.Aa(U.doc,M.doc)),this.pa(l),u=u!=null&&u;const T=o&&!u?this.ya():[],w=this.da.size===0&&this.current&&!u?1:0,A=w!==this.Ea;return this.Ea=w,E.length!==0||A?{snapshot:new gf(this.query,r.Ra,f,E,r.mutatedKeys,w===0,A,!1,!!l&&l.resumeToken.approximateByteSize()>0),wa:T}:{wa:T}}Z_(r){return this.current&&r==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Az,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(r){return!this.Ta.has(r)&&!!this.Ra.has(r)&&!this.Ra.get(r).hasLocalMutations}pa(r){r&&(r.addedDocuments.forEach(o=>this.Ta=this.Ta.add(o)),r.modifiedDocuments.forEach(o=>{}),r.removedDocuments.forEach(o=>this.Ta=this.Ta.delete(o)),this.current=r.current)}ya(){if(!this.current)return[];const r=this.da;this.da=Tn(),this.Ra.forEach(l=>{this.Sa(l.key)&&(this.da=this.da.add(l.key))});const o=[];return r.forEach(l=>{this.da.has(l)||o.push(new R7(l))}),this.da.forEach(l=>{r.has(l)||o.push(new b7(l))}),o}ba(r){this.Ta=r.Ts,this.da=Tn();const o=this.ma(r.documents);return this.applyChanges(o,!0)}Da(){return gf.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class zve{constructor(r,o,l){this.query=r,this.targetId=o,this.view=l}}class Hve{constructor(r){this.key=r,this.va=!1}}class Kve{constructor(r,o,l,u,f,E){this.localStore=r,this.remoteStore=o,this.eventManager=l,this.sharedClientState=u,this.currentUser=f,this.maxConcurrentLimboResolutions=E,this.Ca={},this.Fa=new Af(T=>WK(T),nR),this.Ma=new Map,this.xa=new Set,this.Oa=new Gr(Ct.comparator),this.Na=new Map,this.La=new ND,this.Ba={},this.ka=new Map,this.qa=ff.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function qve(s,r,o=!0){const l=x7(s);let u;const f=l.Fa.get(r);return f?(l.sharedClientState.addLocalQueryTarget(f.targetId),u=f.view.Da()):u=await w7(l,r,o,!0),u}async function Yve(s,r){const o=x7(s);await w7(o,r,!0,!1)}async function w7(s,r,o,l){const u=await gve(s.localStore,Ic(r)),f=u.targetId,E=s.sharedClientState.addLocalQueryTarget(f,o);let T;return l&&(T=await Xve(s,r,f,E==="current",u.resumeToken)),s.isPrimaryClient&&o&&_7(s.remoteStore,u),T}async function Xve(s,r,o,l,u){s.Ka=(M,F,Y)=>async function(ae,he,ee,W){let Z=he.view.ma(ee);Z.ns&&(Z=await Rz(ae.localStore,he.query,!1).then(({documents:te})=>he.view.ma(te,Z)));const fe=W&&W.targetChanges.get(he.targetId),pe=W&&W.targetMismatches.get(he.targetId)!=null,Ce=he.view.applyChanges(Z,ae.isPrimaryClient,fe,pe);return Pz(ae,he.targetId,Ce.wa),Ce.snapshot}(s,M,F,Y);const f=await Rz(s.localStore,r,!0),E=new Wve(r,f.Ts),T=E.ma(f.documents),w=ZE.createSynthesizedTargetChangeForCurrentChange(o,l&&s.onlineState!=="Offline",u),A=E.applyChanges(T,s.isPrimaryClient,w);Pz(s,o,A.wa);const U=new zve(r,o,E);return s.Fa.set(r,U),s.Ma.has(o)?s.Ma.get(o).push(r):s.Ma.set(o,[r]),A.snapshot}async function Jve(s,r,o){const l=$t(s),u=l.Fa.get(r),f=l.Ma.get(u.targetId);if(f.length>1)return l.Ma.set(u.targetId,f.filter(E=>!nR(E,r))),void l.Fa.delete(r);l.isPrimaryClient?(l.sharedClientState.removeLocalQueryTarget(u.targetId),l.sharedClientState.isActiveQueryTarget(u.targetId)||await QO(l.localStore,u.targetId,!1).then(()=>{l.sharedClientState.clearQueryState(u.targetId),o&&PD(l.remoteStore,u.targetId),ZO(l,u.targetId)}).catch(JE)):(ZO(l,u.targetId),await QO(l.localStore,u.targetId,!0))}async function Qve(s,r){const o=$t(s),l=o.Fa.get(r),u=o.Ma.get(l.targetId);o.isPrimaryClient&&u.length===1&&(o.sharedClientState.removeLocalQueryTarget(l.targetId),PD(o.remoteStore,l.targetId))}async function $ve(s,r,o){const l=sye(s);try{const u=await function(E,T){const w=$t(E),A=Wn.now(),U=T.reduce((Y,J)=>Y.add(J.key),Tn());let M,F;return w.persistence.runTransaction("Locally write mutations","readwrite",Y=>{let J=wl(),ae=Tn();return w.cs.getEntries(Y,U).next(he=>{J=he,J.forEach((ee,W)=>{W.isValidDocument()||(ae=ae.add(ee))})}).next(()=>w.localDocuments.getOverlayedDocuments(Y,J)).next(he=>{M=he;const ee=[];for(const W of T){const Z=yEe(W,M.get(W.key).overlayedDocument);Z!=null&&ee.push(new au(W.key,Z,LK(Z.value.mapValue),ja.exists(!0)))}return w.mutationQueue.addMutationBatch(Y,A,ee,T)}).next(he=>{F=he;const ee=he.applyToLocalDocumentSet(M,ae);return w.documentOverlayCache.saveOverlays(Y,he.batchId,ee)})}).then(()=>({batchId:F.batchId,changes:KK(M)}))}(l.localStore,r);l.sharedClientState.addPendingMutation(u.batchId),function(E,T,w){let A=E.Ba[E.currentUser.toKey()];A||(A=new Gr(kn)),A=A.insert(T,w),E.Ba[E.currentUser.toKey()]=A}(l,u.batchId,o),await tv(l,u.changes),await lR(l.remoteStore)}catch(u){const f=UD(u,"Failed to persist write");o.reject(f)}}async function C7(s,r){const o=$t(s);try{const l=await pve(o.localStore,r);r.targetChanges.forEach((u,f)=>{const E=o.Na.get(f);E&&(Jn(u.addedDocuments.size+u.modifiedDocuments.size+u.removedDocuments.size<=1),u.addedDocuments.size>0?E.va=!0:u.modifiedDocuments.size>0?Jn(E.va):u.removedDocuments.size>0&&(Jn(E.va),E.va=!1))}),await tv(o,l,r)}catch(l){await JE(l)}}function Oz(s,r,o){const l=$t(s);if(l.isPrimaryClient&&o===0||!l.isPrimaryClient&&o===1){const u=[];l.Fa.forEach((f,E)=>{const T=E.view.Z_(r);T.snapshot&&u.push(T.snapshot)}),function(E,T){const w=$t(E);w.onlineState=T;let A=!1;w.queries.forEach((U,M)=>{for(const F of M.j_)F.Z_(T)&&(A=!0)}),A&&FD(w)}(l.eventManager,r),u.length&&l.Ca.d_(u),l.onlineState=r,l.isPrimaryClient&&l.sharedClientState.setOnlineState(r)}}async function Zve(s,r,o){const l=$t(s);l.sharedClientState.updateQueryState(r,"rejected",o);const u=l.Na.get(r),f=u&&u.key;if(f){let E=new Gr(Ct.comparator);E=E.insert(f,ls.newNoDocument(f,Jt.min()));const T=Tn().add(f),w=new oR(Jt.min(),new Map,new Gr(kn),E,T);await C7(l,w),l.Oa=l.Oa.remove(f),l.Na.delete(r),GD(l)}else await QO(l.localStore,r,!1).then(()=>ZO(l,r,o)).catch(JE)}async function eye(s,r){const o=$t(s),l=r.batch.batchId;try{const u=await hve(o.localStore,r);A7(o,l,null),I7(o,l),o.sharedClientState.updateMutationState(l,"acknowledged"),await tv(o,u)}catch(u){await JE(u)}}async function tye(s,r,o){const l=$t(s);try{const u=await function(E,T){const w=$t(E);return w.persistence.runTransaction("Reject batch","readwrite-primary",A=>{let U;return w.mutationQueue.lookupMutationBatch(A,T).next(M=>(Jn(M!==null),U=M.keys(),w.mutationQueue.removeMutationBatch(A,M))).next(()=>w.mutationQueue.performConsistencyCheck(A)).next(()=>w.documentOverlayCache.removeOverlaysForBatchId(A,U,T)).next(()=>w.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(A,U)).next(()=>w.localDocuments.getDocuments(A,U))})}(l.localStore,r);A7(l,r,o),I7(l,r),l.sharedClientState.updateMutationState(r,"rejected",o),await tv(l,u)}catch(u){await JE(u)}}function I7(s,r){(s.ka.get(r)||[]).forEach(o=>{o.resolve()}),s.ka.delete(r)}function A7(s,r,o){const l=$t(s);let u=l.Ba[l.currentUser.toKey()];if(u){const f=u.get(r);f&&(o?f.reject(o):f.resolve(),u=u.remove(r)),l.Ba[l.currentUser.toKey()]=u}}function ZO(s,r,o=null){s.sharedClientState.removeLocalQueryTarget(r);for(const l of s.Ma.get(r))s.Fa.delete(l),o&&s.Ca.$a(l,o);s.Ma.delete(r),s.isPrimaryClient&&s.La.gr(r).forEach(l=>{s.La.containsKey(l)||N7(s,l)})}function N7(s,r){s.xa.delete(r.path.canonicalString());const o=s.Oa.get(r);o!==null&&(PD(s.remoteStore,o),s.Oa=s.Oa.remove(r),s.Na.delete(o),GD(s))}function Pz(s,r,o){for(const l of o)l instanceof b7?(s.La.addReference(l.key,r),nye(s,l)):l instanceof R7?(gt("SyncEngine","Document no longer in limbo: "+l.key),s.La.removeReference(l.key,r),s.La.containsKey(l.key)||N7(s,l.key)):Gt()}function nye(s,r){const o=r.key,l=o.path.canonicalString();s.Oa.get(o)||s.xa.has(l)||(gt("SyncEngine","New document in limbo: "+o),s.xa.add(l),GD(s))}function GD(s){for(;s.xa.size>0&&s.Oa.size<s.maxConcurrentLimboResolutions;){const r=s.xa.values().next().value;s.xa.delete(r);const o=new Ct(vr.fromString(r)),l=s.qa.next();s.Na.set(l,new Hve(o)),s.Oa=s.Oa.insert(o,l),_7(s.remoteStore,new Dd(Ic(tR(o.path)),l,"TargetPurposeLimboResolution",vD.oe))}}async function tv(s,r,o){const l=$t(s),u=[],f=[],E=[];l.Fa.isEmpty()||(l.Fa.forEach((T,w)=>{E.push(l.Ka(w,r,o).then(A=>{var U;if((A||o)&&l.isPrimaryClient){const M=A?!A.fromCache:(U=o==null?void 0:o.targetChanges.get(w.targetId))===null||U===void 0?void 0:U.current;l.sharedClientState.updateQueryState(w.targetId,M?"current":"not-current")}if(A){u.push(A);const M=OD.Wi(w.targetId,A);f.push(M)}}))}),await Promise.all(E),l.Ca.d_(u),await async function(w,A){const U=$t(w);try{await U.persistence.runTransaction("notifyLocalViewChanges","readwrite",M=>Be.forEach(A,F=>Be.forEach(F.$i,Y=>U.persistence.referenceDelegate.addReference(M,F.targetId,Y)).next(()=>Be.forEach(F.Ui,Y=>U.persistence.referenceDelegate.removeReference(M,F.targetId,Y)))))}catch(M){if(!QE(M))throw M;gt("LocalStore","Failed to update sequence numbers: "+M)}for(const M of A){const F=M.targetId;if(!M.fromCache){const Y=U.os.get(F),J=Y.snapshotVersion,ae=Y.withLastLimboFreeSnapshotVersion(J);U.os=U.os.insert(F,ae)}}}(l.localStore,f))}async function rye(s,r){const o=$t(s);if(!o.currentUser.isEqual(r)){gt("SyncEngine","User change. New user:",r.toKey());const l=await p7(o.localStore,r);o.currentUser=r,function(f,E){f.ka.forEach(T=>{T.forEach(w=>{w.reject(new ut(je.CANCELLED,E))})}),f.ka.clear()}(o,"'waitForPendingWrites' promise is rejected due to a user change."),o.sharedClientState.handleUserChange(r,l.removedBatchIds,l.addedBatchIds),await tv(o,l.hs)}}function iye(s,r){const o=$t(s),l=o.Na.get(r);if(l&&l.va)return Tn().add(l.key);{let u=Tn();const f=o.Ma.get(r);if(!f)return u;for(const E of f){const T=o.Fa.get(E);u=u.unionWith(T.view.Va)}return u}}function x7(s){const r=$t(s);return r.remoteStore.remoteSyncer.applyRemoteEvent=C7.bind(null,r),r.remoteStore.remoteSyncer.getRemoteKeysForTarget=iye.bind(null,r),r.remoteStore.remoteSyncer.rejectListen=Zve.bind(null,r),r.Ca.d_=Bve.bind(null,r.eventManager),r.Ca.$a=Gve.bind(null,r.eventManager),r}function sye(s){const r=$t(s);return r.remoteStore.remoteSyncer.applySuccessfulWrite=eye.bind(null,r),r.remoteStore.remoteSyncer.rejectFailedWrite=tye.bind(null,r),r}class vb{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(r){this.serializer=aR(r.databaseInfo.databaseId),this.sharedClientState=this.Wa(r),this.persistence=this.Ga(r),await this.persistence.start(),this.localStore=this.za(r),this.gcScheduler=this.ja(r,this.localStore),this.indexBackfillerScheduler=this.Ha(r,this.localStore)}ja(r,o){return null}Ha(r,o){return null}za(r){return uve(this.persistence,new lve,r.initialUser,this.serializer)}Ga(r){return new ove(xD.Zr,this.serializer)}Wa(r){return new Eve}async terminate(){var r,o;(r=this.gcScheduler)===null||r===void 0||r.stop(),(o=this.indexBackfillerScheduler)===null||o===void 0||o.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}vb.provider={build:()=>new vb};class eP{async initialize(r,o){this.localStore||(this.localStore=r.localStore,this.sharedClientState=r.sharedClientState,this.datastore=this.createDatastore(o),this.remoteStore=this.createRemoteStore(o),this.eventManager=this.createEventManager(o),this.syncEngine=this.createSyncEngine(o,!r.synchronizeTabs),this.sharedClientState.onlineStateHandler=l=>Oz(this.syncEngine,l,1),this.remoteStore.remoteSyncer.handleCredentialChange=rye.bind(null,this.syncEngine),await jve(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(r){return function(){return new Fve}()}createDatastore(r){const o=aR(r.databaseInfo.databaseId),l=function(f){return new Tve(f)}(r.databaseInfo);return function(f,E,T,w){return new wve(f,E,T,w)}(r.authCredentials,r.appCheckCredentials,l,o)}createRemoteStore(r){return function(l,u,f,E,T){return new Ive(l,u,f,E,T)}(this.localStore,this.datastore,r.asyncQueue,o=>Oz(this.syncEngine,o,0),function(){return Cz.D()?new Cz:new vve}())}createSyncEngine(r,o){return function(u,f,E,T,w,A,U){const M=new Kve(u,f,E,T,w,A);return U&&(M.Qa=!0),M}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,r.initialUser,r.maxConcurrentLimboResolutions,o)}async terminate(){var r,o;await async function(u){const f=$t(u);gt("RemoteStore","RemoteStore shutting down."),f.L_.add(5),await ev(f),f.k_.shutdown(),f.q_.set("Unknown")}(this.remoteStore),(r=this.datastore)===null||r===void 0||r.terminate(),(o=this.eventManager)===null||o===void 0||o.terminate()}}eP.provider={build:()=>new eP};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WD{constructor(r){this.observer=r,this.muted=!1}next(r){this.muted||this.observer.next&&this.Ya(this.observer.next,r)}error(r){this.muted||(this.observer.error?this.Ya(this.observer.error,r):Rl("Uncaught Error in snapshot listener:",r.toString()))}Za(){this.muted=!0}Ya(r,o){setTimeout(()=>{this.muted||r(o)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oye{constructor(r,o,l,u,f){this.authCredentials=r,this.appCheckCredentials=o,this.asyncQueue=l,this.databaseInfo=u,this.user=as.UNAUTHENTICATED,this.clientId=PK.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=f,this.authCredentials.start(l,async E=>{gt("FirestoreClient","Received user=",E.uid),await this.authCredentialListener(E),this.user=E}),this.appCheckCredentials.start(l,E=>(gt("FirestoreClient","Received new app check token=",E),this.appCheckCredentialListener(E,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(r){this.authCredentialListener=r}setAppCheckTokenChangeListener(r){this.appCheckCredentialListener=r}terminate(){this.asyncQueue.enterRestrictedMode();const r=new fl;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),r.resolve()}catch(o){const l=UD(o,"Failed to shutdown persistence");r.reject(l)}}),r.promise}}async function Ix(s,r){s.asyncQueue.verifyOperationInProgress(),gt("FirestoreClient","Initializing OfflineComponentProvider");const o=s.configuration;await r.initialize(o);let l=o.initialUser;s.setCredentialChangeListener(async u=>{l.isEqual(u)||(await p7(r.localStore,u),l=u)}),r.persistence.setDatabaseDeletedListener(()=>s.terminate()),s._offlineComponents=r}async function Dz(s,r){s.asyncQueue.verifyOperationInProgress();const o=await aye(s);gt("FirestoreClient","Initializing OnlineComponentProvider"),await r.initialize(o,s.configuration),s.setCredentialChangeListener(l=>Iz(r.remoteStore,l)),s.setAppCheckTokenChangeListener((l,u)=>Iz(r.remoteStore,u)),s._onlineComponents=r}async function aye(s){if(!s._offlineComponents)if(s._uninitializedComponentsProvider){gt("FirestoreClient","Using user provided OfflineComponentProvider");try{await Ix(s,s._uninitializedComponentsProvider._offline)}catch(r){const o=r;if(!function(u){return u.name==="FirebaseError"?u.code===je.FAILED_PRECONDITION||u.code===je.UNIMPLEMENTED:!(typeof DOMException<"u"&&u instanceof DOMException)||u.code===22||u.code===20||u.code===11}(o))throw o;df("Error using user provided cache. Falling back to memory cache: "+o),await Ix(s,new vb)}}else gt("FirestoreClient","Using default OfflineComponentProvider"),await Ix(s,new vb);return s._offlineComponents}async function O7(s){return s._onlineComponents||(s._uninitializedComponentsProvider?(gt("FirestoreClient","Using user provided OnlineComponentProvider"),await Dz(s,s._uninitializedComponentsProvider._online)):(gt("FirestoreClient","Using default OnlineComponentProvider"),await Dz(s,new eP))),s._onlineComponents}function cye(s){return O7(s).then(r=>r.syncEngine)}async function yb(s){const r=await O7(s),o=r.eventManager;return o.onListen=qve.bind(null,r.syncEngine),o.onUnlisten=Jve.bind(null,r.syncEngine),o.onFirstRemoteStoreListen=Yve.bind(null,r.syncEngine),o.onLastRemoteStoreUnlisten=Qve.bind(null,r.syncEngine),o}function lye(s,r,o={}){const l=new fl;return s.asyncQueue.enqueueAndForget(async()=>function(f,E,T,w,A){const U=new WD({next:F=>{U.Za(),E.enqueueAndForget(()=>VD(f,M));const Y=F.docs.has(T);!Y&&F.fromCache?A.reject(new ut(je.UNAVAILABLE,"Failed to get document because the client is offline.")):Y&&F.fromCache&&w&&w.source==="server"?A.reject(new ut(je.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):A.resolve(F)},error:F=>A.reject(F)}),M=new BD(tR(T.path),U,{includeMetadataChanges:!0,_a:!0});return jD(f,M)}(await yb(s),s.asyncQueue,r,o,l)),l.promise}function dye(s,r,o={}){const l=new fl;return s.asyncQueue.enqueueAndForget(async()=>function(f,E,T,w,A){const U=new WD({next:F=>{U.Za(),E.enqueueAndForget(()=>VD(f,M)),F.fromCache&&w.source==="server"?A.reject(new ut(je.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):A.resolve(F)},error:F=>A.reject(F)}),M=new BD(T,U,{includeMetadataChanges:!0,_a:!0});return jD(f,M)}(await yb(s),s.asyncQueue,r,o,l)),l.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P7(s){const r={};return s.timeoutSeconds!==void 0&&(r.timeoutSeconds=s.timeoutSeconds),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kz=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D7(s,r,o){if(!o)throw new ut(je.INVALID_ARGUMENT,`Function ${s}() cannot be called with an empty ${r}.`)}function uye(s,r,o,l){if(r===!0&&l===!0)throw new ut(je.INVALID_ARGUMENT,`${s} and ${o} cannot be used together.`)}function Lz(s){if(!Ct.isDocumentKey(s))throw new ut(je.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${s} has ${s.length}.`)}function Mz(s){if(Ct.isDocumentKey(s))throw new ut(je.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${s} has ${s.length}.`)}function dR(s){if(s===void 0)return"undefined";if(s===null)return"null";if(typeof s=="string")return s.length>20&&(s=`${s.substring(0,20)}...`),JSON.stringify(s);if(typeof s=="number"||typeof s=="boolean")return""+s;if(typeof s=="object"){if(s instanceof Array)return"an array";{const r=function(l){return l.constructor?l.constructor.name:null}(s);return r?`a custom ${r} object`:"an object"}}return typeof s=="function"?"a function":Gt()}function vo(s,r){if("_delegate"in s&&(s=s._delegate),!(s instanceof r)){if(r.name===s.constructor.name)throw new ut(je.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const o=dR(s);throw new ut(je.INVALID_ARGUMENT,`Expected type '${r.name}', but it was: ${o}`)}}return s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uz{constructor(r){var o,l;if(r.host===void 0){if(r.ssl!==void 0)throw new ut(je.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=r.host,this.ssl=(o=r.ssl)===null||o===void 0||o;if(this.credentials=r.credentials,this.ignoreUndefinedProperties=!!r.ignoreUndefinedProperties,this.localCache=r.localCache,r.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(r.cacheSizeBytes!==-1&&r.cacheSizeBytes<1048576)throw new ut(je.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=r.cacheSizeBytes}uye("experimentalForceLongPolling",r.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",r.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!r.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:r.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!r.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=P7((l=r.experimentalLongPollingOptions)!==null&&l!==void 0?l:{}),function(f){if(f.timeoutSeconds!==void 0){if(isNaN(f.timeoutSeconds))throw new ut(je.INVALID_ARGUMENT,`invalid long polling timeout: ${f.timeoutSeconds} (must not be NaN)`);if(f.timeoutSeconds<5)throw new ut(je.INVALID_ARGUMENT,`invalid long polling timeout: ${f.timeoutSeconds} (minimum allowed value is 5)`);if(f.timeoutSeconds>30)throw new ut(je.INVALID_ARGUMENT,`invalid long polling timeout: ${f.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!r.useFetchStreams}isEqual(r){return this.host===r.host&&this.ssl===r.ssl&&this.credentials===r.credentials&&this.cacheSizeBytes===r.cacheSizeBytes&&this.experimentalForceLongPolling===r.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===r.experimentalAutoDetectLongPolling&&function(l,u){return l.timeoutSeconds===u.timeoutSeconds}(this.experimentalLongPollingOptions,r.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===r.ignoreUndefinedProperties&&this.useFetchStreams===r.useFetchStreams}}class uR{constructor(r,o,l,u){this._authCredentials=r,this._appCheckCredentials=o,this._databaseId=l,this._app=u,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Uz({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ut(je.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(r){if(this._settingsFrozen)throw new ut(je.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Uz(r),r.credentials!==void 0&&(this._authCredentials=function(l){if(!l)return new N_e;switch(l.type){case"firstParty":return new D_e(l.sessionIndex||"0",l.iamToken||null,l.authTokenFactory||null);case"provider":return l.client;default:throw new ut(je.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(r.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(o){const l=kz.get(o);l&&(gt("ComponentProvider","Removing Datastore"),kz.delete(o),l.terminate())}(this),Promise.resolve()}}function hye(s,r,o,l={}){var u;const f=(s=vo(s,uR))._getSettings(),E=`${r}:${o}`;if(f.host!=="firestore.googleapis.com"&&f.host!==E&&df("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),s._setSettings(Object.assign(Object.assign({},f),{host:E,ssl:!1})),l.mockUserToken){let T,w;if(typeof l.mockUserToken=="string")T=l.mockUserToken,w=as.MOCK_USER;else{T=F9(l.mockUserToken,(u=s._app)===null||u===void 0?void 0:u.options.projectId);const A=l.mockUserToken.sub||l.mockUserToken.user_id;if(!A)throw new ut(je.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");w=new as(A)}s._authCredentials=new x_e(new OK(T,w))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dl{constructor(r,o,l){this.converter=o,this._query=l,this.type="query",this.firestore=r}withConverter(r){return new Dl(this.firestore,r,this._query)}}class us{constructor(r,o,l){this.converter=o,this._key=l,this.type="document",this.firestore=r}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Hd(this.firestore,this.converter,this._key.path.popLast())}withConverter(r){return new us(this.firestore,r,this._key)}}class Hd extends Dl{constructor(r,o,l){super(r,o,tR(l)),this._path=l,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const r=this._path.popLast();return r.isEmpty()?null:new us(this.firestore,null,new Ct(r))}withConverter(r){return new Hd(this.firestore,r,this._path)}}function Zr(s,r,...o){if(s=li(s),D7("collection","path",r),s instanceof uR){const l=vr.fromString(r,...o);return Mz(l),new Hd(s,null,l)}{if(!(s instanceof us||s instanceof Hd))throw new ut(je.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const l=s._path.child(vr.fromString(r,...o));return Mz(l),new Hd(s.firestore,null,l)}}function Dr(s,r,...o){if(s=li(s),arguments.length===1&&(r=PK.newId()),D7("doc","path",r),s instanceof uR){const l=vr.fromString(r,...o);return Lz(l),new us(s,null,new Ct(l))}{if(!(s instanceof us||s instanceof Hd))throw new ut(je.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const l=s._path.child(vr.fromString(r,...o));return Lz(l),new us(s.firestore,s instanceof Hd?s.converter:null,new Ct(l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jz{constructor(r=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new f7(this,"async_queue_retry"),this.Vu=()=>{const l=Cx();l&&gt("AsyncQueue","Visibility state changed to "+l.visibilityState),this.t_.jo()},this.mu=r;const o=Cx();o&&typeof o.addEventListener=="function"&&o.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(r){this.enqueue(r)}enqueueAndForgetEvenWhileRestricted(r){this.fu(),this.gu(r)}enterRestrictedMode(r){if(!this.Iu){this.Iu=!0,this.Au=r||!1;const o=Cx();o&&typeof o.removeEventListener=="function"&&o.removeEventListener("visibilitychange",this.Vu)}}enqueue(r){if(this.fu(),this.Iu)return new Promise(()=>{});const o=new fl;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(r().then(o.resolve,o.reject),o.promise)).then(()=>o.promise)}enqueueRetryable(r){this.enqueueAndForget(()=>(this.Pu.push(r),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(r){if(!QE(r))throw r;gt("AsyncQueue","Operation failed with retryable error: "+r)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(r){const o=this.mu.then(()=>(this.du=!0,r().catch(l=>{this.Eu=l,this.du=!1;const u=function(E){let T=E.message||"";return E.stack&&(T=E.stack.includes(E.message)?E.stack:E.message+`
`+E.stack),T}(l);throw Rl("INTERNAL UNHANDLED ERROR: ",u),l}).then(l=>(this.du=!1,l))));return this.mu=o,o}enqueueAfterDelay(r,o,l){this.fu(),this.Ru.indexOf(r)>-1&&(o=0);const u=MD.createAndSchedule(this,r,o,l,f=>this.yu(f));return this.Tu.push(u),u}fu(){this.Eu&&Gt()}verifyOperationInProgress(){}async wu(){let r;do r=this.mu,await r;while(r!==this.mu)}Su(r){for(const o of this.Tu)if(o.timerId===r)return!0;return!1}bu(r){return this.wu().then(()=>{this.Tu.sort((o,l)=>o.targetTimeMs-l.targetTimeMs);for(const o of this.Tu)if(o.skipDelay(),r!=="all"&&o.timerId===r)break;return this.wu()})}Du(r){this.Ru.push(r)}yu(r){const o=this.Tu.indexOf(r);this.Tu.splice(o,1)}}function Vz(s){return function(o,l){if(typeof o!="object"||o===null)return!1;const u=o;for(const f of l)if(f in u&&typeof u[f]=="function")return!0;return!1}(s,["next","error","complete"])}class eu extends uR{constructor(r,o,l,u){super(r,o,l,u),this.type="firestore",this._queue=new jz,this._persistenceKey=(u==null?void 0:u.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const r=this._firestoreClient.terminate();this._queue=new jz(r),this._firestoreClient=void 0,await r}}}function pye(s,r){const o=typeof s=="object"?s:oD(),l=typeof s=="string"?s:"(default)",u=Jb(o,"firestore").getImmediate({identifier:l});if(!u._initialized){const f=U9("firestore");f&&hye(u,...f)}return u}function hR(s){if(s._terminated)throw new ut(je.FAILED_PRECONDITION,"The client has already been terminated.");return s._firestoreClient||mye(s),s._firestoreClient}function mye(s){var r,o,l;const u=s._freezeSettings(),f=function(T,w,A,U){return new K_e(T,w,A,U.host,U.ssl,U.experimentalForceLongPolling,U.experimentalAutoDetectLongPolling,P7(U.experimentalLongPollingOptions),U.useFetchStreams)}(s._databaseId,((r=s._app)===null||r===void 0?void 0:r.options.appId)||"",s._persistenceKey,u);s._componentsProvider||!((o=u.localCache)===null||o===void 0)&&o._offlineComponentProvider&&(!((l=u.localCache)===null||l===void 0)&&l._onlineComponentProvider)&&(s._componentsProvider={_offline:u.localCache._offlineComponentProvider,_online:u.localCache._onlineComponentProvider}),s._firestoreClient=new oye(s._authCredentials,s._appCheckCredentials,s._queue,f,s._componentsProvider&&function(T){const w=T==null?void 0:T._online.build();return{_offline:T==null?void 0:T._offline.build(w),_online:w}}(s._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _f{constructor(r){this._byteString=r}static fromBase64String(r){try{return new _f(Ji.fromBase64String(r))}catch(o){throw new ut(je.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+o)}}static fromUint8Array(r){return new _f(Ji.fromUint8Array(r))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(r){return this._byteString.isEqual(r._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pR{constructor(...r){for(let o=0;o<r.length;++o)if(r[o].length===0)throw new ut(je.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ki(r)}isEqual(r){return this._internalPath.isEqual(r._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nv{constructor(r){this._methodName=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zD{constructor(r,o){if(!isFinite(r)||r<-90||r>90)throw new ut(je.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+r);if(!isFinite(o)||o<-180||o>180)throw new ut(je.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+o);this._lat=r,this._long=o}get latitude(){return this._lat}get longitude(){return this._long}isEqual(r){return this._lat===r._lat&&this._long===r._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(r){return kn(this._lat,r._lat)||kn(this._long,r._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HD{constructor(r){this._values=(r||[]).map(o=>o)}toArray(){return this._values.map(r=>r)}isEqual(r){return function(l,u){if(l.length!==u.length)return!1;for(let f=0;f<l.length;++f)if(l[f]!==u[f])return!1;return!0}(this._values,r._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fye=/^__.*__$/;class gye{constructor(r,o,l){this.data=r,this.fieldMask=o,this.fieldTransforms=l}toMutation(r,o){return this.fieldMask!==null?new au(r,this.data,this.fieldMask,o,this.fieldTransforms):new $E(r,this.data,o,this.fieldTransforms)}}class k7{constructor(r,o,l){this.data=r,this.fieldMask=o,this.fieldTransforms=l}toMutation(r,o){return new au(r,this.data,this.fieldMask,o,this.fieldTransforms)}}function L7(s){switch(s){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Gt()}}class mR{constructor(r,o,l,u,f,E){this.settings=r,this.databaseId=o,this.serializer=l,this.ignoreUndefinedProperties=u,f===void 0&&this.vu(),this.fieldTransforms=f||[],this.fieldMask=E||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(r){return new mR(Object.assign(Object.assign({},this.settings),r),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(r){var o;const l=(o=this.path)===null||o===void 0?void 0:o.child(r),u=this.Fu({path:l,xu:!1});return u.Ou(r),u}Nu(r){var o;const l=(o=this.path)===null||o===void 0?void 0:o.child(r),u=this.Fu({path:l,xu:!1});return u.vu(),u}Lu(r){return this.Fu({path:void 0,xu:!0})}Bu(r){return Sb(r,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(r){return this.fieldMask.find(o=>r.isPrefixOf(o))!==void 0||this.fieldTransforms.find(o=>r.isPrefixOf(o.field))!==void 0}vu(){if(this.path)for(let r=0;r<this.path.length;r++)this.Ou(this.path.get(r))}Ou(r){if(r.length===0)throw this.Bu("Document fields must not be empty");if(L7(this.Cu)&&fye.test(r))throw this.Bu('Document fields cannot begin and end with "__"')}}class _ye{constructor(r,o,l){this.databaseId=r,this.ignoreUndefinedProperties=o,this.serializer=l||aR(r)}Qu(r,o,l,u=!1){return new mR({Cu:r,methodName:o,qu:l,path:Ki.emptyPath(),xu:!1,ku:u},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function fR(s){const r=s._freezeSettings(),o=aR(s._databaseId);return new _ye(s._databaseId,!!r.ignoreUndefinedProperties,o)}function M7(s,r,o,l,u,f={}){const E=s.Qu(f.merge||f.mergeFields?2:0,r,o,u);YD("Data must be an object, but it was:",E,l);const T=U7(l,E);let w,A;if(f.merge)w=new _o(E.fieldMask),A=E.fieldTransforms;else if(f.mergeFields){const U=[];for(const M of f.mergeFields){const F=tP(r,M,o);if(!E.contains(F))throw new ut(je.INVALID_ARGUMENT,`Field '${F}' is specified in your field mask but missing from your input data.`);V7(U,F)||U.push(F)}w=new _o(U),A=E.fieldTransforms.filter(M=>w.covers(M.field))}else w=null,A=E.fieldTransforms;return new gye(new qs(T),w,A)}class gR extends nv{_toFieldTransform(r){if(r.Cu!==2)throw r.Cu===1?r.Bu(`${this._methodName}() can only appear at the top level of your update data`):r.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return r.fieldMask.push(r.path),null}isEqual(r){return r instanceof gR}}function Eye(s,r,o){return new mR({Cu:3,qu:r.settings.qu,methodName:s._methodName,xu:o},r.databaseId,r.serializer,r.ignoreUndefinedProperties)}class KD extends nv{_toFieldTransform(r){return new ZK(r.path,new LE)}isEqual(r){return r instanceof KD}}class qD extends nv{constructor(r,o){super(r),this.Ku=o}_toFieldTransform(r){const o=Eye(this,r,!0),l=this.Ku.map(f=>xf(f,o)),u=new mf(l);return new ZK(r.path,u)}isEqual(r){return r instanceof qD&&CE(this.Ku,r.Ku)}}function vye(s,r,o,l){const u=s.Qu(1,r,o);YD("Data must be an object, but it was:",u,l);const f=[],E=qs.empty();zh(l,(w,A)=>{const U=XD(r,w,o);A=li(A);const M=u.Nu(U);if(A instanceof gR)f.push(U);else{const F=xf(A,M);F!=null&&(f.push(U),E.set(U,F))}});const T=new _o(f);return new k7(E,T,u.fieldTransforms)}function yye(s,r,o,l,u,f){const E=s.Qu(1,r,o),T=[tP(r,l,o)],w=[u];if(f.length%2!=0)throw new ut(je.INVALID_ARGUMENT,`Function ${r}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let F=0;F<f.length;F+=2)T.push(tP(r,f[F])),w.push(f[F+1]);const A=[],U=qs.empty();for(let F=T.length-1;F>=0;--F)if(!V7(A,T[F])){const Y=T[F];let J=w[F];J=li(J);const ae=E.Nu(Y);if(J instanceof gR)A.push(Y);else{const he=xf(J,ae);he!=null&&(A.push(Y),U.set(Y,he))}}const M=new _o(A);return new k7(U,M,E.fieldTransforms)}function Sye(s,r,o,l=!1){return xf(o,s.Qu(l?4:3,r))}function xf(s,r){if(j7(s=li(s)))return YD("Unsupported field value:",r,s),U7(s,r);if(s instanceof nv)return function(l,u){if(!L7(u.Cu))throw u.Bu(`${l._methodName}() can only be used with update() and set()`);if(!u.path)throw u.Bu(`${l._methodName}() is not currently supported inside arrays`);const f=l._toFieldTransform(u);f&&u.fieldTransforms.push(f)}(s,r),null;if(s===void 0&&r.ignoreUndefinedProperties)return null;if(r.path&&r.fieldMask.push(r.path),s instanceof Array){if(r.settings.xu&&r.Cu!==4)throw r.Bu("Nested arrays are not supported");return function(l,u){const f=[];let E=0;for(const T of l){let w=xf(T,u.Lu(E));w==null&&(w={nullValue:"NULL_VALUE"}),f.push(w),E++}return{arrayValue:{values:f}}}(s,r)}return function(l,u){if((l=li(l))===null)return{nullValue:"NULL_VALUE"};if(typeof l=="number")return mEe(u.serializer,l);if(typeof l=="boolean")return{booleanValue:l};if(typeof l=="string")return{stringValue:l};if(l instanceof Date){const f=Wn.fromDate(l);return{timestampValue:_b(u.serializer,f)}}if(l instanceof Wn){const f=new Wn(l.seconds,1e3*Math.floor(l.nanoseconds/1e3));return{timestampValue:_b(u.serializer,f)}}if(l instanceof zD)return{geoPointValue:{latitude:l.latitude,longitude:l.longitude}};if(l instanceof _f)return{bytesValue:o7(u.serializer,l._byteString)};if(l instanceof us){const f=u.databaseId,E=l.firestore._databaseId;if(!E.isEqual(f))throw u.Bu(`Document reference is for database ${E.projectId}/${E.database} but should be for database ${f.projectId}/${f.database}`);return{referenceValue:AD(l.firestore._databaseId||u.databaseId,l._key.path)}}if(l instanceof HD)return function(E,T){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:E.toArray().map(w=>{if(typeof w!="number")throw T.Bu("VectorValues must only contain numeric values.");return wD(T.serializer,w)})}}}}}}(l,u);throw u.Bu(`Unsupported field value: ${dR(l)}`)}(s,r)}function U7(s,r){const o={};return DK(s)?r.path&&r.path.length>0&&r.fieldMask.push(r.path):zh(s,(l,u)=>{const f=xf(u,r.Mu(l));f!=null&&(o[l]=f)}),{mapValue:{fields:o}}}function j7(s){return!(typeof s!="object"||s===null||s instanceof Array||s instanceof Date||s instanceof Wn||s instanceof zD||s instanceof _f||s instanceof us||s instanceof nv||s instanceof HD)}function YD(s,r,o){if(!j7(o)||!function(u){return typeof u=="object"&&u!==null&&(Object.getPrototypeOf(u)===Object.prototype||Object.getPrototypeOf(u)===null)}(o)){const l=dR(o);throw l==="an object"?r.Bu(s+" a custom object"):r.Bu(s+" "+l)}}function tP(s,r,o){if((r=li(r))instanceof pR)return r._internalPath;if(typeof r=="string")return XD(s,r);throw Sb("Field path arguments must be of type string or ",s,!1,void 0,o)}const Tye=new RegExp("[~\\*/\\[\\]]");function XD(s,r,o){if(r.search(Tye)>=0)throw Sb(`Invalid field path (${r}). Paths must not contain '~', '*', '/', '[', or ']'`,s,!1,void 0,o);try{return new pR(...r.split("."))._internalPath}catch{throw Sb(`Invalid field path (${r}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,s,!1,void 0,o)}}function Sb(s,r,o,l,u){const f=l&&!l.isEmpty(),E=u!==void 0;let T=`Function ${r}() called with invalid data`;o&&(T+=" (via `toFirestore()`)"),T+=". ";let w="";return(f||E)&&(w+=" (found",f&&(w+=` in field ${l}`),E&&(w+=` in document ${u}`),w+=")"),new ut(je.INVALID_ARGUMENT,T+s+w)}function V7(s,r){return s.some(o=>o.isEqual(r))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F7{constructor(r,o,l,u,f){this._firestore=r,this._userDataWriter=o,this._key=l,this._document=u,this._converter=f}get id(){return this._key.path.lastSegment()}get ref(){return new us(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const r=new bye(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(r)}return this._userDataWriter.convertValue(this._document.data.value)}}get(r){if(this._document){const o=this._document.data.field(_R("DocumentSnapshot.get",r));if(o!==null)return this._userDataWriter.convertValue(o)}}}class bye extends F7{data(){return super.data()}}function _R(s,r){return typeof r=="string"?XD(s,r):r instanceof pR?r._internalPath:r._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B7(s){if(s.limitType==="L"&&s.explicitOrderBy.length===0)throw new ut(je.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class JD{}class QD extends JD{}function qo(s,r,...o){let l=[];r instanceof JD&&l.push(r),l=l.concat(o),function(f){const E=f.filter(w=>w instanceof $D).length,T=f.filter(w=>w instanceof ER).length;if(E>1||E>0&&T>0)throw new ut(je.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(l);for(const u of l)s=u._apply(s);return s}class ER extends QD{constructor(r,o,l){super(),this._field=r,this._op=o,this._value=l,this.type="where"}static _create(r,o,l){return new ER(r,o,l)}_apply(r){const o=this._parse(r);return W7(r._query,o),new Dl(r.firestore,r.converter,KO(r._query,o))}_parse(r){const o=fR(r.firestore);return function(f,E,T,w,A,U,M){let F;if(A.isKeyField()){if(U==="array-contains"||U==="array-contains-any")throw new ut(je.INVALID_ARGUMENT,`Invalid Query. You can't perform '${U}' queries on documentId().`);if(U==="in"||U==="not-in"){Bz(M,U);const Y=[];for(const J of M)Y.push(Fz(w,f,J));F={arrayValue:{values:Y}}}else F=Fz(w,f,M)}else U!=="in"&&U!=="not-in"&&U!=="array-contains-any"||Bz(M,U),F=Sye(T,E,M,U==="in"||U==="not-in");return oi.create(A,U,F)}(r._query,"where",o,r.firestore._databaseId,this._field,this._op,this._value)}}function ds(s,r,o){const l=r,u=_R("where",s);return ER._create(u,l,o)}class $D extends JD{constructor(r,o){super(),this.type=r,this._queryConstraints=o}static _create(r,o){return new $D(r,o)}_parse(r){const o=this._queryConstraints.map(l=>l._parse(r)).filter(l=>l.getFilters().length>0);return o.length===1?o[0]:Ba.create(o,this._getOperator())}_apply(r){const o=this._parse(r);return o.getFilters().length===0?r:(function(u,f){let E=u;const T=f.getFlattenedFilters();for(const w of T)W7(E,w),E=KO(E,w)}(r._query,o),new Dl(r.firestore,r.converter,KO(r._query,o)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class ZD extends QD{constructor(r,o){super(),this._field=r,this._direction=o,this.type="orderBy"}static _create(r,o){return new ZD(r,o)}_apply(r){const o=function(u,f,E){if(u.startAt!==null)throw new ut(je.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(u.endAt!==null)throw new ut(je.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new kE(f,E)}(r._query,this._field,this._direction);return new Dl(r.firestore,r.converter,function(u,f){const E=u.explicitOrderBy.concat([f]);return new If(u.path,u.collectionGroup,E,u.filters.slice(),u.limit,u.limitType,u.startAt,u.endAt)}(r._query,o))}}function G7(s,r="asc"){const o=r,l=_R("orderBy",s);return ZD._create(l,o)}class ek extends QD{constructor(r,o,l){super(),this.type=r,this._limit=o,this._limitType=l}static _create(r,o,l){return new ek(r,o,l)}_apply(r){return new Dl(r.firestore,r.converter,fb(r._query,this._limit,this._limitType))}}function Rye(s){return ek._create("limit",s,"F")}function Fz(s,r,o){if(typeof(o=li(o))=="string"){if(o==="")throw new ut(je.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!GK(r)&&o.indexOf("/")!==-1)throw new ut(je.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${o}' contains a '/' character.`);const l=r.path.child(vr.fromString(o));if(!Ct.isDocumentKey(l))throw new ut(je.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${l}' is not because it has an odd number of segments (${l.length}).`);return az(s,new Ct(l))}if(o instanceof us)return az(s,o._key);throw new ut(je.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${dR(o)}.`)}function Bz(s,r){if(!Array.isArray(s)||s.length===0)throw new ut(je.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${r.toString()}' filters.`)}function W7(s,r){const o=function(u,f){for(const E of u)for(const T of E.getFlattenedFilters())if(f.indexOf(T.op)>=0)return T.op;return null}(s.filters,function(u){switch(u){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(r.op));if(o!==null)throw o===r.op?new ut(je.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${r.op.toString()}' filter.`):new ut(je.INVALID_ARGUMENT,`Invalid query. You cannot use '${r.op.toString()}' filters with '${o.toString()}' filters.`)}class wye{convertValue(r,o="none"){switch(Fh(r)){case 0:return null;case 1:return r.booleanValue;case 2:return Qr(r.integerValue||r.doubleValue);case 3:return this.convertTimestamp(r.timestampValue);case 4:return this.convertServerTimestamp(r,o);case 5:return r.stringValue;case 6:return this.convertBytes(Vh(r.bytesValue));case 7:return this.convertReference(r.referenceValue);case 8:return this.convertGeoPoint(r.geoPointValue);case 9:return this.convertArray(r.arrayValue,o);case 11:return this.convertObject(r.mapValue,o);case 10:return this.convertVectorValue(r.mapValue);default:throw Gt()}}convertObject(r,o){return this.convertObjectMap(r.fields,o)}convertObjectMap(r,o="none"){const l={};return zh(r,(u,f)=>{l[u]=this.convertValue(f,o)}),l}convertVectorValue(r){var o,l,u;const f=(u=(l=(o=r.fields)===null||o===void 0?void 0:o.value.arrayValue)===null||l===void 0?void 0:l.values)===null||u===void 0?void 0:u.map(E=>Qr(E.doubleValue));return new HD(f)}convertGeoPoint(r){return new zD(Qr(r.latitude),Qr(r.longitude))}convertArray(r,o){return(r.values||[]).map(l=>this.convertValue(l,o))}convertServerTimestamp(r,o){switch(o){case"previous":const l=SD(r);return l==null?null:this.convertValue(l,o);case"estimate":return this.convertTimestamp(OE(r));default:return null}}convertTimestamp(r){const o=$d(r);return new Wn(o.seconds,o.nanos)}convertDocumentKey(r,o){const l=vr.fromString(r);Jn(h7(l));const u=new PE(l.get(1),l.get(3)),f=new Ct(l.popFirst(5));return u.isEqual(o)||Rl(`Document ${f} contains a document reference within a different database (${u.projectId}/${u.database}) which is not supported. It will be treated as a reference in the current database (${o.projectId}/${o.database}) instead.`),f}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z7(s,r,o){let l;return l=s?s.toFirestore(r):r,l}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G_{constructor(r,o){this.hasPendingWrites=r,this.fromCache=o}isEqual(r){return this.hasPendingWrites===r.hasPendingWrites&&this.fromCache===r.fromCache}}class H7 extends F7{constructor(r,o,l,u,f,E){super(r,o,l,u,E),this._firestore=r,this._firestoreImpl=r,this.metadata=f}exists(){return super.exists()}data(r={}){if(this._document){if(this._converter){const o=new x0(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(o,r)}return this._userDataWriter.convertValue(this._document.data.value,r.serverTimestamps)}}get(r,o={}){if(this._document){const l=this._document.data.field(_R("DocumentSnapshot.get",r));if(l!==null)return this._userDataWriter.convertValue(l,o.serverTimestamps)}}}class x0 extends H7{data(r={}){return super.data(r)}}class K7{constructor(r,o,l,u){this._firestore=r,this._userDataWriter=o,this._snapshot=u,this.metadata=new G_(u.hasPendingWrites,u.fromCache),this.query=l}get docs(){const r=[];return this.forEach(o=>r.push(o)),r}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(r,o){this._snapshot.docs.forEach(l=>{r.call(o,new x0(this._firestore,this._userDataWriter,l.key,l,new G_(this._snapshot.mutatedKeys.has(l.key),this._snapshot.fromCache),this.query.converter))})}docChanges(r={}){const o=!!r.includeMetadataChanges;if(o&&this._snapshot.excludesMetadataChanges)throw new ut(je.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===o||(this._cachedChanges=function(u,f){if(u._snapshot.oldDocs.isEmpty()){let E=0;return u._snapshot.docChanges.map(T=>{const w=new x0(u._firestore,u._userDataWriter,T.doc.key,T.doc,new G_(u._snapshot.mutatedKeys.has(T.doc.key),u._snapshot.fromCache),u.query.converter);return T.doc,{type:"added",doc:w,oldIndex:-1,newIndex:E++}})}{let E=u._snapshot.oldDocs;return u._snapshot.docChanges.filter(T=>f||T.type!==3).map(T=>{const w=new x0(u._firestore,u._userDataWriter,T.doc.key,T.doc,new G_(u._snapshot.mutatedKeys.has(T.doc.key),u._snapshot.fromCache),u.query.converter);let A=-1,U=-1;return T.type!==0&&(A=E.indexOf(T.doc.key),E=E.delete(T.doc.key)),T.type!==1&&(E=E.add(T.doc),U=E.indexOf(T.doc.key)),{type:Cye(T.type),doc:w,oldIndex:A,newIndex:U}})}}(this,o),this._cachedChangesIncludeMetadataChanges=o),this._cachedChanges}}function Cye(s){switch(s){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Gt()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ef(s){s=vo(s,us);const r=vo(s.firestore,eu);return lye(hR(r),s._key).then(o=>q7(r,s,o))}class tk extends wye{constructor(r){super(),this.firestore=r}convertBytes(r){return new _f(r)}convertReference(r){const o=this.convertDocumentKey(r,this.firestore._databaseId);return new us(this.firestore,null,o)}}function Rd(s){s=vo(s,Dl);const r=vo(s.firestore,eu),o=hR(r),l=new tk(r);return B7(s._query),dye(o,s._query).then(u=>new K7(r,l,s,u))}function nP(s,r,o){s=vo(s,us);const l=vo(s.firestore,eu),u=z7(s.converter,r);return nk(l,[M7(fR(l),"setDoc",s._key,u,s.converter!==null,o).toMutation(s._key,ja.none())])}function fo(s,r,o,...l){s=vo(s,us);const u=vo(s.firestore,eu),f=fR(u);let E;return E=typeof(r=li(r))=="string"||r instanceof pR?yye(f,"updateDoc",s._key,r,o,l):vye(f,"updateDoc",s._key,r),nk(u,[E.toMutation(s._key,ja.exists(!0))])}function UE(s,r){const o=vo(s.firestore,eu),l=Dr(s),u=z7(s.converter,r);return nk(o,[M7(fR(s.firestore),"addDoc",l._key,u,s.converter!==null,{}).toMutation(l._key,ja.exists(!1))]).then(()=>l)}function gl(s,...r){var o,l,u;s=li(s);let f={includeMetadataChanges:!1,source:"default"},E=0;typeof r[E]!="object"||Vz(r[E])||(f=r[E],E++);const T={includeMetadataChanges:f.includeMetadataChanges,source:f.source};if(Vz(r[E])){const M=r[E];r[E]=(o=M.next)===null||o===void 0?void 0:o.bind(M),r[E+1]=(l=M.error)===null||l===void 0?void 0:l.bind(M),r[E+2]=(u=M.complete)===null||u===void 0?void 0:u.bind(M)}let w,A,U;if(s instanceof us)A=vo(s.firestore,eu),U=tR(s._key.path),w={next:M=>{r[E]&&r[E](q7(A,s,M))},error:r[E+1],complete:r[E+2]};else{const M=vo(s,Dl);A=vo(M.firestore,eu),U=M._query;const F=new tk(A);w={next:Y=>{r[E]&&r[E](new K7(A,F,M,Y))},error:r[E+1],complete:r[E+2]},B7(s._query)}return function(F,Y,J,ae){const he=new WD(ae),ee=new BD(Y,he,J);return F.asyncQueue.enqueueAndForget(async()=>jD(await yb(F),ee)),()=>{he.Za(),F.asyncQueue.enqueueAndForget(async()=>VD(await yb(F),ee))}}(hR(A),U,T,w)}function nk(s,r){return function(l,u){const f=new fl;return l.asyncQueue.enqueueAndForget(async()=>$ve(await cye(l),u,f)),f.promise}(hR(s),r)}function q7(s,r,o){const l=o.docs.get(r._key),u=new tk(s);return new H7(s,u,r._key,l,new G_(o.hasPendingWrites,o.fromCache),r.converter)}function W_(){return new KD("serverTimestamp")}function Iye(...s){return new qD("arrayUnion",s)}(function(r,o=!0){(function(u){Cf=u})(Wh),Lh(new Jd("firestore",(l,{instanceIdentifier:u,options:f})=>{const E=l.getProvider("app").getImmediate(),T=new eu(new O_e(l.getProvider("auth-internal")),new L_e(l.getProvider("app-check-internal")),function(A,U){if(!Object.prototype.hasOwnProperty.apply(A.options,["projectId"]))throw new ut(je.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new PE(A.options.projectId,U)}(E,u),E);return f=Object.assign({useFetchStreams:o},f),T._setSettings(f),T},"PUBLIC").setMultipleInstances(!0)),wc(nz,"4.7.3",r),wc(nz,"4.7.3","esm2017")})();var Aye="firebase",Nye="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */wc(Aye,Nye,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y7="firebasestorage.googleapis.com",xye="storageBucket",Oye=2*60*1e3,Pye=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dc extends Pc{constructor(r,o,l=0){super(Ax(r),`Firebase Storage: ${o} (${Ax(r)})`),this.status_=l,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Dc.prototype)}get status(){return this.status_}set status(r){this.status_=r}_codeEquals(r){return Ax(r)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(r){this.customData.serverResponse=r,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var xc;(function(s){s.UNKNOWN="unknown",s.OBJECT_NOT_FOUND="object-not-found",s.BUCKET_NOT_FOUND="bucket-not-found",s.PROJECT_NOT_FOUND="project-not-found",s.QUOTA_EXCEEDED="quota-exceeded",s.UNAUTHENTICATED="unauthenticated",s.UNAUTHORIZED="unauthorized",s.UNAUTHORIZED_APP="unauthorized-app",s.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",s.INVALID_CHECKSUM="invalid-checksum",s.CANCELED="canceled",s.INVALID_EVENT_NAME="invalid-event-name",s.INVALID_URL="invalid-url",s.INVALID_DEFAULT_BUCKET="invalid-default-bucket",s.NO_DEFAULT_BUCKET="no-default-bucket",s.CANNOT_SLICE_BLOB="cannot-slice-blob",s.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",s.NO_DOWNLOAD_URL="no-download-url",s.INVALID_ARGUMENT="invalid-argument",s.INVALID_ARGUMENT_COUNT="invalid-argument-count",s.APP_DELETED="app-deleted",s.INVALID_ROOT_OPERATION="invalid-root-operation",s.INVALID_FORMAT="invalid-format",s.INTERNAL_ERROR="internal-error",s.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(xc||(xc={}));function Ax(s){return"storage/"+s}function Dye(){const s="An unknown error occurred, please check the error payload for server response.";return new Dc(xc.UNKNOWN,s)}function kye(){return new Dc(xc.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Lye(){return new Dc(xc.CANCELED,"User canceled the upload/download.")}function Mye(s){return new Dc(xc.INVALID_URL,"Invalid URL '"+s+"'.")}function Uye(s){return new Dc(xc.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+s+"'.")}function Gz(s){return new Dc(xc.INVALID_ARGUMENT,s)}function X7(){return new Dc(xc.APP_DELETED,"The Firebase app was deleted.")}function jye(s){return new Dc(xc.INVALID_ROOT_OPERATION,"The operation '"+s+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ka{constructor(r,o){this.bucket=r,this.path_=o}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const r=encodeURIComponent;return"/b/"+r(this.bucket)+"/o/"+r(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(r,o){let l;try{l=ka.makeFromUrl(r,o)}catch{return new ka(r,"")}if(l.path==="")return l;throw Uye(r)}static makeFromUrl(r,o){let l=null;const u="([A-Za-z0-9.\\-_]+)";function f(fe){fe.path.charAt(fe.path.length-1)==="/"&&(fe.path_=fe.path_.slice(0,-1))}const E="(/(.*))?$",T=new RegExp("^gs://"+u+E,"i"),w={bucket:1,path:3};function A(fe){fe.path_=decodeURIComponent(fe.path)}const U="v[A-Za-z0-9_]+",M=o.replace(/[.]/g,"\\."),F="(/([^?#]*).*)?$",Y=new RegExp(`^https?://${M}/${U}/b/${u}/o${F}`,"i"),J={bucket:1,path:3},ae=o===Y7?"(?:storage.googleapis.com|storage.cloud.google.com)":o,he="([^?#]*)",ee=new RegExp(`^https?://${ae}/${u}/${he}`,"i"),Z=[{regex:T,indices:w,postModify:f},{regex:Y,indices:J,postModify:A},{regex:ee,indices:{bucket:1,path:2},postModify:A}];for(let fe=0;fe<Z.length;fe++){const pe=Z[fe],Ce=pe.regex.exec(r);if(Ce){const te=Ce[pe.indices.bucket];let q=Ce[pe.indices.path];q||(q=""),l=new ka(te,q),pe.postModify(l);break}}if(l==null)throw Mye(r);return l}}class Vye{constructor(r){this.promise_=Promise.reject(r)}getPromise(){return this.promise_}cancel(r=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fye(s,r,o){let l=1,u=null,f=null,E=!1,T=0;function w(){return T===2}let A=!1;function U(...he){A||(A=!0,r.apply(null,he))}function M(he){u=setTimeout(()=>{u=null,s(Y,w())},he)}function F(){f&&clearTimeout(f)}function Y(he,...ee){if(A){F();return}if(he){F(),U.call(null,he,...ee);return}if(w()||E){F(),U.call(null,he,...ee);return}l<64&&(l*=2);let Z;T===1?(T=2,Z=0):Z=(l+Math.random())*1e3,M(Z)}let J=!1;function ae(he){J||(J=!0,F(),!A&&(u!==null?(he||(T=2),clearTimeout(u),M(0)):he||(T=1)))}return M(0),f=setTimeout(()=>{E=!0,ae(!0)},o),ae}function Bye(s){s(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gye(s){return s!==void 0}function Wz(s,r,o,l){if(l<r)throw Gz(`Invalid value for '${s}'. Expected ${r} or greater.`);if(l>o)throw Gz(`Invalid value for '${s}'. Expected ${o} or less.`)}function Wye(s){const r=encodeURIComponent;let o="?";for(const l in s)if(s.hasOwnProperty(l)){const u=r(l)+"="+r(s[l]);o=o+u+"&"}return o=o.slice(0,-1),o}var Tb;(function(s){s[s.NO_ERROR=0]="NO_ERROR",s[s.NETWORK_ERROR=1]="NETWORK_ERROR",s[s.ABORT=2]="ABORT"})(Tb||(Tb={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zye(s,r){const o=s>=500&&s<600,u=[408,429].indexOf(s)!==-1,f=r.indexOf(s)!==-1;return o||u||f}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hye{constructor(r,o,l,u,f,E,T,w,A,U,M,F=!0){this.url_=r,this.method_=o,this.headers_=l,this.body_=u,this.successCodes_=f,this.additionalRetryCodes_=E,this.callback_=T,this.errorCallback_=w,this.timeout_=A,this.progressCallback_=U,this.connectionFactory_=M,this.retry=F,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((Y,J)=>{this.resolve_=Y,this.reject_=J,this.start_()})}start_(){const r=(l,u)=>{if(u){l(!1,new l0(!1,null,!0));return}const f=this.connectionFactory_();this.pendingConnection_=f;const E=T=>{const w=T.loaded,A=T.lengthComputable?T.total:-1;this.progressCallback_!==null&&this.progressCallback_(w,A)};this.progressCallback_!==null&&f.addUploadProgressListener(E),f.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&f.removeUploadProgressListener(E),this.pendingConnection_=null;const T=f.getErrorCode()===Tb.NO_ERROR,w=f.getStatus();if(!T||zye(w,this.additionalRetryCodes_)&&this.retry){const U=f.getErrorCode()===Tb.ABORT;l(!1,new l0(!1,null,U));return}const A=this.successCodes_.indexOf(w)!==-1;l(!0,new l0(A,f))})},o=(l,u)=>{const f=this.resolve_,E=this.reject_,T=u.connection;if(u.wasSuccessCode)try{const w=this.callback_(T,T.getResponse());Gye(w)?f(w):f()}catch(w){E(w)}else if(T!==null){const w=Dye();w.serverResponse=T.getErrorText(),this.errorCallback_?E(this.errorCallback_(T,w)):E(w)}else if(u.canceled){const w=this.appDelete_?X7():Lye();E(w)}else{const w=kye();E(w)}};this.canceled_?o(!1,new l0(!1,null,!0)):this.backoffId_=Fye(r,o,this.timeout_)}getPromise(){return this.promise_}cancel(r){this.canceled_=!0,this.appDelete_=r||!1,this.backoffId_!==null&&Bye(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class l0{constructor(r,o,l){this.wasSuccessCode=r,this.connection=o,this.canceled=!!l}}function Kye(s,r){r!==null&&r.length>0&&(s.Authorization="Firebase "+r)}function qye(s,r){s["X-Firebase-Storage-Version"]="webjs/"+(r??"AppManager")}function Yye(s,r){r&&(s["X-Firebase-GMPID"]=r)}function Xye(s,r){r!==null&&(s["X-Firebase-AppCheck"]=r)}function Jye(s,r,o,l,u,f,E=!0){const T=Wye(s.urlParams),w=s.url+T,A=Object.assign({},s.headers);return Yye(A,r),Kye(A,o),qye(A,f),Xye(A,l),new Hye(w,s.method,A,s.body,s.successCodes,s.additionalRetryCodes,s.handler,s.errorHandler,s.timeout,s.progressCallback,u,E)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qye(s){if(s.length===0)return null;const r=s.lastIndexOf("/");return r===-1?"":s.slice(0,r)}function $ye(s){const r=s.lastIndexOf("/",s.length-2);return r===-1?s:s.slice(r+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bb{constructor(r,o){this._service=r,o instanceof ka?this._location=o:this._location=ka.makeFromUrl(o,r.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(r,o){return new bb(r,o)}get root(){const r=new ka(this._location.bucket,"");return this._newRef(this._service,r)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return $ye(this._location.path)}get storage(){return this._service}get parent(){const r=Qye(this._location.path);if(r===null)return null;const o=new ka(this._location.bucket,r);return new bb(this._service,o)}_throwIfRoot(r){if(this._location.path==="")throw jye(r)}}function zz(s,r){const o=r==null?void 0:r[xye];return o==null?null:ka.makeFromBucketSpec(o,s)}function Zye(s,r,o,l={}){s.host=`${r}:${o}`,s._protocol="http";const{mockUserToken:u}=l;u&&(s._overrideAuthToken=typeof u=="string"?u:F9(u,s.app.options.projectId))}class eSe{constructor(r,o,l,u,f){this.app=r,this._authProvider=o,this._appCheckProvider=l,this._url=u,this._firebaseVersion=f,this._bucket=null,this._host=Y7,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Oye,this._maxUploadRetryTime=Pye,this._requests=new Set,u!=null?this._bucket=ka.makeFromBucketSpec(u,this._host):this._bucket=zz(this._host,this.app.options)}get host(){return this._host}set host(r){this._host=r,this._url!=null?this._bucket=ka.makeFromBucketSpec(this._url,r):this._bucket=zz(r,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(r){Wz("time",0,Number.POSITIVE_INFINITY,r),this._maxUploadRetryTime=r}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(r){Wz("time",0,Number.POSITIVE_INFINITY,r),this._maxOperationRetryTime=r}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const r=this._authProvider.getImmediate({optional:!0});if(r){const o=await r.getToken();if(o!==null)return o.accessToken}return null}async _getAppCheckToken(){const r=this._appCheckProvider.getImmediate({optional:!0});return r?(await r.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(r=>r.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(r){return new bb(this,r)}_makeRequest(r,o,l,u,f=!0){if(this._deleted)return new Vye(X7());{const E=Jye(r,this._appId,l,u,o,this._firebaseVersion,f);return this._requests.add(E),E.getPromise().then(()=>this._requests.delete(E),()=>this._requests.delete(E)),E}}async makeRequestWithTokens(r,o){const[l,u]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(r,o,l,u).getPromise()}}const Hz="@firebase/storage",Kz="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J7="storage";function tSe(s=oD(),r){s=li(s);const l=Jb(s,J7).getImmediate({identifier:r}),u=U9("storage");return u&&nSe(l,...u),l}function nSe(s,r,o,l={}){Zye(s,r,o,l)}function rSe(s,{instanceIdentifier:r}){const o=s.getProvider("app").getImmediate(),l=s.getProvider("auth-internal"),u=s.getProvider("app-check-internal");return new eSe(o,l,u,r,Wh)}function iSe(){Lh(new Jd(J7,rSe,"PUBLIC").setMultipleInstances(!0)),wc(Hz,Kz,""),wc(Hz,Kz,"esm2017")}iSe();const sSe={apiKey:"AIzaSyCMdQlzbrfXAVT6mB0tXuAUbj7-3QBOyLQ",authDomain:"butterbread-web.firebaseapp.com",projectId:"butterbread-web",storageBucket:"butterbread-web.firebasestorage.app",messagingSenderId:"1037775236421",appId:"1:1037775236421:web:d9525d697800c7ffc5e22c",measurementId:"G-TF57S4VYP9"},rk=W9(sSe),fh=I_e(rk),Qt=pye(rk);tSe(rk);const oSe={},qz=s=>{let r;const o=new Set,l=(U,M)=>{const F=typeof U=="function"?U(r):U;if(!Object.is(F,r)){const Y=r;r=M??(typeof F!="object"||F===null)?F:Object.assign({},r,F),o.forEach(J=>J(r,Y))}},u=()=>r,w={setState:l,getState:u,getInitialState:()=>A,subscribe:U=>(o.add(U),()=>o.delete(U)),destroy:()=>{(oSe?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),o.clear()}},A=r=s(l,u,w);return w},aSe=s=>s?qz(s):qz;var Q7={exports:{}},$7={},Z7={exports:{}},eq={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ef=ce;function cSe(s,r){return s===r&&(s!==0||1/s===1/r)||s!==s&&r!==r}var lSe=typeof Object.is=="function"?Object.is:cSe,dSe=Ef.useState,uSe=Ef.useEffect,hSe=Ef.useLayoutEffect,pSe=Ef.useDebugValue;function mSe(s,r){var o=r(),l=dSe({inst:{value:o,getSnapshot:r}}),u=l[0].inst,f=l[1];return hSe(function(){u.value=o,u.getSnapshot=r,Nx(u)&&f({inst:u})},[s,o,r]),uSe(function(){return Nx(u)&&f({inst:u}),s(function(){Nx(u)&&f({inst:u})})},[s]),pSe(o),o}function Nx(s){var r=s.getSnapshot;s=s.value;try{var o=r();return!lSe(s,o)}catch{return!0}}function fSe(s,r){return r()}var gSe=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?fSe:mSe;eq.useSyncExternalStore=Ef.useSyncExternalStore!==void 0?Ef.useSyncExternalStore:gSe;Z7.exports=eq;var _Se=Z7.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vR=ce,ESe=_Se;function vSe(s,r){return s===r&&(s!==0||1/s===1/r)||s!==s&&r!==r}var ySe=typeof Object.is=="function"?Object.is:vSe,SSe=ESe.useSyncExternalStore,TSe=vR.useRef,bSe=vR.useEffect,RSe=vR.useMemo,wSe=vR.useDebugValue;$7.useSyncExternalStoreWithSelector=function(s,r,o,l,u){var f=TSe(null);if(f.current===null){var E={hasValue:!1,value:null};f.current=E}else E=f.current;f=RSe(function(){function w(Y){if(!A){if(A=!0,U=Y,Y=l(Y),u!==void 0&&E.hasValue){var J=E.value;if(u(J,Y))return M=J}return M=Y}if(J=M,ySe(U,Y))return J;var ae=l(Y);return u!==void 0&&u(J,ae)?(U=Y,J):(U=Y,M=ae)}var A=!1,U,M,F=o===void 0?null:o;return[function(){return w(r())},F===null?void 0:function(){return w(F())}]},[r,o,l,u]);var T=SSe(s,f[0],f[1]);return bSe(function(){E.hasValue=!0,E.value=T},[T]),wSe(T),T};Q7.exports=$7;var CSe=Q7.exports;const ISe=sP(CSe),tq={},{useDebugValue:ASe}=dP,{useSyncExternalStoreWithSelector:NSe}=ISe;let Yz=!1;const xSe=s=>s;function OSe(s,r=xSe,o){(tq?"production":void 0)!=="production"&&o&&!Yz&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Yz=!0);const l=NSe(s.subscribe,s.getState,s.getServerState||s.getInitialState,r,o);return ASe(l),l}const Xz=s=>{(tq?"production":void 0)!=="production"&&typeof s!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const r=typeof s=="function"?aSe(s):s,o=(l,u)=>OSe(r,l,u);return Object.assign(o,r),o},PSe=s=>s?Xz(s):Xz,DSe=()=>{const s=localStorage.getItem("delulu-language");if(s&&["de","en","es","fr","pt"].includes(s))return s;const r=navigator.language.split("-")[0];return["de","en","es","fr","pt"].includes(r)?r:"en"},vi=PSe(s=>({user:null,isAuthenticated:!1,isLoading:!0,location:null,locationError:null,locationPermission:null,nearbyUsers:[],searchRadius:500,isDiscovering:!1,chats:[],activeChat:null,language:DSe(),showXPToast:!1,xpToastAmount:0,xpToastReason:"",starProfile:null,starApplication:null,liveStarEvents:[],newsTicker:[],isVerifiedStar:!1,setUser:r=>s({user:r,isAuthenticated:!!r}),setLocation:r=>s({location:r}),setLocationError:r=>s({locationError:r}),setLocationPermission:r=>s({locationPermission:r}),setNearbyUsers:r=>s({nearbyUsers:r}),setSearchRadius:r=>s({searchRadius:r}),setIsDiscovering:r=>s({isDiscovering:r}),setChats:r=>s({chats:r}),setActiveChat:r=>s({activeChat:r}),setIsLoading:r=>s({isLoading:r}),setLanguage:r=>{localStorage.setItem("delulu-language",r),s({language:r})},showXPGain:(r,o)=>s({showXPToast:!0,xpToastAmount:r,xpToastReason:o}),hideXPToast:()=>s({showXPToast:!1}),logout:()=>s({user:null,isAuthenticated:!1,location:null,nearbyUsers:[],chats:[],activeChat:null,starProfile:null,starApplication:null,isVerifiedStar:!1}),setStarProfile:r=>s({starProfile:r,isVerifiedStar:!!r}),setStarApplication:r=>s({starApplication:r}),setLiveStarEvents:r=>s({liveStarEvents:r}),setNewsTicker:r=>s({newsTicker:r})})),Jz={freeStarsPerDay:3,premiumStarsPerDay:15},Qz={founder:{canMuteParticipants:!0,canRemoveParticipants:!0,canManageHandRaise:!0,canPinMessages:!0,canStartRecording:!0,canVoiceLiftUsers:!0,maxVoiceLiftSlots:999,canCreatePublicEvents:!0,canScheduleEvents:!0,maxEventCapacity:999999,canChargeForEvents:!0,hasAdvancedAnalytics:!0,canExportData:!0,canReportFastTrack:!0,hasModeratorSupport:!0}},Or={starsRequired:500,levelRequired:25,voiceMinutesRequired:120,minPositiveRatings:80},$z=["yunghundse@gmail.com","jan@butterbread.de","founder@delulu.app"],yR=()=>{const{user:s,isAuthenticated:r,isLoading:o,setUser:l,setIsLoading:u,logout:f,setStarProfile:E}=vi();return ce.useEffect(()=>{const F=fge(fh,async Y=>{var J,ae;if(Y){const he=await ef(Dr(Qt,"users",Y.uid));if(he.exists()){const ee=he.data();if(l({...ee,id:Y.uid}),$z.includes(((J=Y.email)==null?void 0:J.toLowerCase())||"")){const W={userId:Y.uid,username:ee.username||"founder",displayName:ee.displayName||"Founder",avatar:ee.avatarUrl,verifiedAt:new Date,category:"creator",nebulaTier:"founder",totalListeners:99999,totalStarsReceived:99999,totalEventsHosted:999,averageEventRating:5,isLive:!1,permissions:Qz.founder};E(W)}}else{const ee={email:Y.email||"",username:`user_${Y.uid.slice(0,8)}`,displayName:Y.displayName||"Anonymous",avatarUrl:Y.photoURL||void 0,visibilityMode:"anonymous",isActive:!0,lastSeen:new Date,createdAt:new Date};if(await nP(Dr(Qt,"users",Y.uid),{...ee,lastSeen:W_(),createdAt:W_()}),l({...ee,id:Y.uid}),$z.includes(((ae=Y.email)==null?void 0:ae.toLowerCase())||"")){const W={userId:Y.uid,username:ee.username,displayName:ee.displayName,avatar:ee.avatarUrl,verifiedAt:new Date,category:"creator",nebulaTier:"founder",totalListeners:99999,totalStarsReceived:99999,totalEventsHosted:999,averageEventRating:5,isLive:!1,permissions:Qz.founder};E(W)}}}else l(null);u(!1)});return()=>F()},[l,u]),{user:s,isAuthenticated:r,isLoading:o,signIn:async(F,Y)=>{try{return await hge(fh,F,Y),{success:!0}}catch(J){return{success:!1,error:J.message}}},signUp:async(F,Y,J)=>{try{const ae=await uge(fh,F,Y),he={email:F,username:J,displayName:J,visibilityMode:"anonymous",isActive:!0,lastSeen:W_(),createdAt:W_()};return await nP(Dr(Qt,"users",ae.user.uid),he),{success:!0}}catch(ae){return{success:!1,error:ae.message}}},signInWithGoogle:async()=>{try{const F=new il;return await Mge(fh,F),{success:!0}}catch(F){return{success:!1,error:F.message}}},resetPassword:async F=>{try{return await dge(fh,F),{success:!0}}catch(Y){let J="Fehler beim Zurcksetzen des Passworts";return Y.code==="auth/user-not-found"?J="Kein Account mit dieser E-Mail gefunden":Y.code==="auth/invalid-email"&&(J="Ungltige E-Mail-Adresse"),{success:!1,error:J}}},logout:async()=>{try{return await gge(fh),f(),{success:!0}}catch(F){return{success:!1,error:F.message}}}}},kSe=()=>p.jsxs("div",{className:"min-h-screen min-h-[100dvh] bg-delulu-bg flex flex-col items-center justify-center px-6 py-12",children:[p.jsx("div",{className:"fixed top-0 right-0 w-80 h-80 bg-gradient-radial from-delulu-violet/20 to-transparent rounded-full blur-3xl pointer-events-none"}),p.jsx("div",{className:"fixed bottom-0 left-0 w-60 h-60 bg-gradient-radial from-delulu-violet-dark/15 to-transparent rounded-full blur-3xl pointer-events-none"}),p.jsxs("div",{className:"relative z-10 text-center max-w-sm",children:[p.jsx("div",{className:"w-28 h-28 mx-auto rounded-3xl bg-gradient-to-br from-delulu-violet to-delulu-violet-dark flex items-center justify-center shadow-lg mb-8",children:p.jsx("span",{className:"text-5xl",children:""})}),p.jsx("h1",{className:"font-display text-5xl font-bold mb-4",children:p.jsx("span",{className:"gradient-text",children:"delulu"})}),p.jsx("p",{className:"text-delulu-text text-xl font-display font-semibold mb-2",children:"Connect in the Clouds"}),p.jsxs("p",{className:"text-delulu-muted mb-10",children:["Echte Begegnungen in deiner Nachbarschaft.",p.jsx("br",{}),p.jsx("span",{className:"font-semibold text-delulu-text",children:"Hyperlokal. Anonym. Algorithmus-frei."})]}),p.jsxs("div",{className:"space-y-4",children:[p.jsx(kh,{to:"/register",className:"btn-primary block w-full py-4 text-white font-display font-bold text-center",children:"Jetzt starten"}),p.jsx(kh,{to:"/login",className:"block w-full py-4 text-delulu-violet font-display font-semibold text-center border-2 border-delulu-violet/20 rounded-xl hover:border-delulu-violet transition-colors",children:"Ich habe schon einen Account"})]}),p.jsxs("div",{className:"mt-12 grid grid-cols-3 gap-4 text-center",children:[p.jsxs("div",{children:[p.jsx("div",{className:"text-2xl mb-2",children:""}),p.jsxs("p",{className:"text-xs text-delulu-muted",children:["Max 500m",p.jsx("br",{}),"Radius"]})]}),p.jsxs("div",{children:[p.jsx("div",{className:"text-2xl mb-2",children:""}),p.jsxs("p",{className:"text-xs text-delulu-muted",children:["Anonym",p.jsx("br",{}),"oder Offen"]})]}),p.jsxs("div",{children:[p.jsx("div",{className:"text-2xl mb-2",children:""}),p.jsxs("p",{className:"text-xs text-delulu-muted",children:["Privacy",p.jsx("br",{}),"First"]})]})]})]})]});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var LSe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MSe=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Xe=(s,r)=>{const o=ce.forwardRef(({color:l="currentColor",size:u=24,strokeWidth:f=2,absoluteStrokeWidth:E,className:T="",children:w,...A},U)=>ce.createElement("svg",{ref:U,...LSe,width:u,height:u,stroke:l,strokeWidth:E?Number(f)*24/Number(u):f,className:["lucide",`lucide-${MSe(s)}`,T].join(" "),...A},[...r.map(([M,F])=>ce.createElement(M,F)),...Array.isArray(w)?w:[w]]));return o.displayName=`${s}`,o};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const USe=Xe("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ik=Xe("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=Xe("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sE=Xe("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nq=Xe("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oE=Xe("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kd=Xe("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jSe=Xe("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qd=Xe("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VSe=Xe("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rl=Xe("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xx=Xe("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jo=Xe("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rq=Xe("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zz=Xe("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _i=Xe("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Th=Xe("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FSe=Xe("CloudOff",[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5.782 5.782A7 7 0 0 0 9 19h8.5a4.5 4.5 0 0 0 1.307-.193",key:"yfwify"}],["path",{d:"M21.532 16.5A4.5 4.5 0 0 0 17.5 10h-1.79A7.008 7.008 0 0 0 10 5.07",key:"jlfiyv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rb=Xe("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BSe=Xe("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sk=Xe("Compass",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76",key:"m9r19z"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ul=Xe("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GSe=Xe("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WSe=Xe("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _l=Xe("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oc=Xe("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rP=Xe("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iq=Xe("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sq=Xe("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zSe=Xe("Gamepad2",[["line",{x1:"6",x2:"10",y1:"11",y2:"11",key:"1gktln"}],["line",{x1:"8",x2:"8",y1:"9",y2:"13",key:"qnk9ow"}],["line",{x1:"15",x2:"15.01",y1:"12",y2:"12",key:"krot7o"}],["line",{x1:"18",x2:"18.01",y1:"10",y2:"10",key:"1lcuu1"}],["path",{d:"M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z",key:"mfqc10"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oq=Xe("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jE=Xe("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HSe=Xe("GraduationCap",[["path",{d:"M22 10v6M2 10l10-5 10 5-10 5z",key:"1ef52a"}],["path",{d:"M6 12v5c3 3 9 3 12 0v-5",key:"1f75yj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aq=Xe("Hand",[["path",{d:"M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0",key:"aigmz7"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v2",key:"1n6bmn"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8",key:"a9iiix"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SR=Xe("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KSe=Xe("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qSe=Xe("Instagram",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YSe=Xe("Linkedin",[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=Xe("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tu=Xe("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cq=Xe("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wb=Xe("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TR=Xe("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kh=Xe("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XSe=Xe("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cl=Xe("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JSe=Xe("Music2",[["circle",{cx:"8",cy:"18",r:"4",key:"1fc0mg"}],["path",{d:"M12 18V2l7 4",key:"g04rme"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QSe=Xe("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e8=Xe("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t8=Xe("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $Se=Xe("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lq=Xe("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cb=Xe("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ib=Xe("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZSe=Xe("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iP=Xe("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eTe=Xe("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tTe=Xe("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Va=Xe("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ci=Xe("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qi=Xe("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nTe=Xe("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n8=Xe("ThumbsDown",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z",key:"s6e0r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O0=Xe("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ab=Xe("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rTe=Xe("Twitter",[["path",{d:"M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z",key:"pff0z6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iTe=Xe("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r8=Xe("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sTe=Xe("UserMinus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ih=Xe("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i8=Xe("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ah=Xe("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ai=Xe("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oTe=Xe("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ok=Xe("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aTe=Xe("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dq=Xe("WifiOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 4.17-2.65",key:"11utq1"}],["path",{d:"M10.66 5c4.01-.36 8.14.9 11.34 3.76",key:"hxefdu"}],["path",{d:"M16.85 11.25a10 10 0 0 1 2.22 1.68",key:"q734kn"}],["path",{d:"M5 13a10 10 0 0 1 5.24-2.76",key:"piq4yl"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uq=Xe("Wifi",[["path",{d:"M5 13a10 10 0 0 1 14 0",key:"6v8j51"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nu=Xe("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cTe=Xe("Youtube",[["path",{d:"M2.5 17a24.12 24.12 0 0 1 0-10 2 2 0 0 1 1.4-1.4 49.56 49.56 0 0 1 16.2 0A2 2 0 0 1 21.5 7a24.12 24.12 0 0 1 0 10 2 2 0 0 1-1.4 1.4 49.55 49.55 0 0 1-16.2 0A2 2 0 0 1 2.5 17",key:"1q2vi4"}],["path",{d:"m10 15 5-3-5-3z",key:"1jp15x"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hl=Xe("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),lTe=()=>{const[s,r]=ce.useState(""),[o,l]=ce.useState(""),[u,f]=ce.useState(!1),[E,T]=ce.useState(""),[w,A]=ce.useState(!1),[U,M]=ce.useState(!1),[F,Y]=ce.useState(!1),{signIn:J,signInWithGoogle:ae,resetPassword:he}=yR(),ee=ei(),W=async pe=>{pe.preventDefault(),T(""),A(!0);const Ce=await J(s,o);Ce.success?ee("/"):T(Ce.error||"Login fehlgeschlagen"),A(!1)},Z=async()=>{T(""),A(!0);const pe=await ae();pe.success?ee("/"):T(pe.error||"Google Login fehlgeschlagen"),A(!1)},fe=async pe=>{if(pe.preventDefault(),T(""),A(!0),!s){T("Bitte gib deine E-Mail-Adresse ein"),A(!1);return}const Ce=await he(s);Ce.success?Y(!0):T(Ce.error||"Fehler beim Zurcksetzen"),A(!1)};return U?p.jsxs("div",{className:"min-h-screen min-h-[100dvh] bg-delulu-bg px-6 py-8 safe-top",children:[p.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[p.jsx("button",{onClick:()=>{M(!1),Y(!1),T("")},className:"w-10 h-10 rounded-xl bg-white flex items-center justify-center shadow-sm",children:p.jsx(Is,{size:20,className:"text-delulu-text"})}),p.jsx("h1",{className:"font-display text-2xl font-bold text-delulu-text",children:"Passwort vergessen"})]}),F?p.jsxs("div",{className:"glass-card p-6 text-center",children:[p.jsx("div",{className:"w-16 h-16 mx-auto rounded-full bg-green-100 flex items-center justify-center mb-4",children:p.jsx(rl,{size:32,className:"text-green-600"})}),p.jsx("h2",{className:"font-display text-xl font-bold text-delulu-text mb-2",children:"E-Mail gesendet!"}),p.jsxs("p",{className:"text-delulu-muted mb-6",children:["Wir haben dir eine E-Mail an ",p.jsx("strong",{children:s})," gesendet. Folge dem Link in der E-Mail, um dein Passwort zurckzusetzen."]}),p.jsx("p",{className:"text-sm text-delulu-muted mb-6",children:"Keine E-Mail erhalten? berprfe deinen Spam-Ordner oder versuche es erneut."}),p.jsx("button",{onClick:()=>{M(!1),Y(!1)},className:"btn-primary w-full py-4 text-white font-display font-bold",children:"Zurck zum Login"})]}):p.jsxs("div",{className:"glass-card p-6",children:[p.jsx("p",{className:"text-delulu-muted mb-6",children:"Gib deine E-Mail-Adresse ein und wir senden dir einen Link zum Zurcksetzen deines Passworts."}),p.jsxs("form",{onSubmit:fe,className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-delulu-muted mb-2",children:"E-Mail"}),p.jsxs("div",{className:"relative",children:[p.jsx(wb,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-delulu-muted"}),p.jsx("input",{type:"email",value:s,onChange:pe=>r(pe.target.value),placeholder:"deine@email.de",required:!0,className:"w-full pl-12 pr-4 py-3 bg-white border-2 border-delulu-soft rounded-xl focus:border-delulu-violet focus:outline-none transition-colors"})]})]}),E&&p.jsx("p",{className:"text-red-500 text-sm text-center",children:E}),p.jsx("button",{type:"submit",disabled:w,className:"btn-primary w-full py-4 text-white font-display font-bold disabled:opacity-70",children:w?"Wird gesendet...":"Link senden"})]})]})]}):p.jsxs("div",{className:"min-h-screen min-h-[100dvh] bg-delulu-bg px-6 py-8 safe-top",children:[p.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[p.jsx(kh,{to:"/",className:"w-10 h-10 rounded-xl bg-white flex items-center justify-center shadow-sm",children:p.jsx(Is,{size:20,className:"text-delulu-text"})}),p.jsx("h1",{className:"font-display text-2xl font-bold text-delulu-text",children:"Login"})]}),p.jsx("div",{className:"glass-card p-6 mb-6",children:p.jsxs("form",{onSubmit:W,className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-delulu-muted mb-2",children:"E-Mail"}),p.jsxs("div",{className:"relative",children:[p.jsx(wb,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-delulu-muted"}),p.jsx("input",{type:"email",value:s,onChange:pe=>r(pe.target.value),placeholder:"deine@email.de",required:!0,className:"w-full pl-12 pr-4 py-3 bg-white border-2 border-delulu-soft rounded-xl focus:border-delulu-violet focus:outline-none transition-colors"})]})]}),p.jsxs("div",{children:[p.jsxs("div",{className:"flex items-center justify-between mb-2",children:[p.jsx("label",{className:"block text-sm font-medium text-delulu-muted",children:"Passwort"}),p.jsx("button",{type:"button",onClick:()=>M(!0),className:"text-sm text-delulu-violet font-medium hover:underline",children:"Passwort vergessen?"})]}),p.jsxs("div",{className:"relative",children:[p.jsx(tu,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-delulu-muted"}),p.jsx("input",{type:u?"text":"password",value:o,onChange:pe=>l(pe.target.value),placeholder:"",required:!0,className:"w-full pl-12 pr-12 py-3 bg-white border-2 border-delulu-soft rounded-xl focus:border-delulu-violet focus:outline-none transition-colors"}),p.jsx("button",{type:"button",onClick:()=>f(!u),className:"absolute right-4 top-1/2 -translate-y-1/2 text-delulu-muted",children:u?p.jsx(_l,{size:18}):p.jsx(Oc,{size:18})})]})]}),E&&p.jsx("p",{className:"text-red-500 text-sm text-center",children:E}),p.jsx("button",{type:"submit",disabled:w,className:"btn-primary w-full py-4 text-white font-display font-bold disabled:opacity-70",children:w?"Wird eingeloggt...":"Login"})]})}),p.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[p.jsx("div",{className:"flex-1 h-px bg-delulu-soft"}),p.jsx("span",{className:"text-sm text-delulu-muted",children:"oder"}),p.jsx("div",{className:"flex-1 h-px bg-delulu-soft"})]}),p.jsx("div",{className:"space-y-3",children:p.jsxs("button",{onClick:Z,disabled:w,className:"w-full py-4 bg-white border-2 border-delulu-soft rounded-xl font-medium flex items-center justify-center gap-3 hover:border-delulu-violet transition-colors disabled:opacity-70",children:[p.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",children:[p.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),p.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),p.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),p.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Mit Google anmelden"]})}),p.jsxs("p",{className:"text-center text-delulu-muted mt-8",children:["Noch kein Account?"," ",p.jsx(kh,{to:"/register",className:"text-delulu-violet font-semibold",children:"Registrieren"})]})]})},dTe=()=>{const[s,r]=ce.useState(""),[o,l]=ce.useState(""),[u,f]=ce.useState(""),[E,T]=ce.useState(!1),[w,A]=ce.useState(""),[U,M]=ce.useState(!1),{signUp:F,signInWithGoogle:Y}=yR(),J=ei(),ae=async ee=>{if(ee.preventDefault(),A(""),s.length<3){A("Username muss mindestens 3 Zeichen haben");return}if(u.length<6){A("Passwort muss mindestens 6 Zeichen haben");return}M(!0);const W=await F(o,u,s);W.success?J("/"):A(W.error||"Registrierung fehlgeschlagen"),M(!1)},he=async()=>{A(""),M(!0);const ee=await Y();ee.success?J("/"):A(ee.error||"Google Registrierung fehlgeschlagen"),M(!1)};return p.jsxs("div",{className:"min-h-screen min-h-[100dvh] bg-delulu-bg px-6 py-8 safe-top",children:[p.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[p.jsx(kh,{to:"/",className:"w-10 h-10 rounded-xl bg-white flex items-center justify-center shadow-sm",children:p.jsx(Is,{size:20,className:"text-delulu-text"})}),p.jsx("h1",{className:"font-display text-2xl font-bold text-delulu-text",children:"Registrieren"})]}),p.jsx("div",{className:"glass-card p-6 mb-6",children:p.jsxs("form",{onSubmit:ae,className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-delulu-muted mb-2",children:"Username"}),p.jsxs("div",{className:"relative",children:[p.jsx(Ah,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-delulu-muted"}),p.jsx("input",{type:"text",value:s,onChange:ee=>r(ee.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"")),placeholder:"dein_username",required:!0,maxLength:20,className:"w-full pl-12 pr-4 py-3 bg-white border-2 border-delulu-soft rounded-xl focus:border-delulu-violet focus:outline-none transition-colors"})]}),p.jsx("p",{className:"text-xs text-delulu-muted mt-1",children:"Nur Kleinbuchstaben, Zahlen und Unterstriche"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-delulu-muted mb-2",children:"E-Mail"}),p.jsxs("div",{className:"relative",children:[p.jsx(wb,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-delulu-muted"}),p.jsx("input",{type:"email",value:o,onChange:ee=>l(ee.target.value),placeholder:"deine@email.de",required:!0,className:"w-full pl-12 pr-4 py-3 bg-white border-2 border-delulu-soft rounded-xl focus:border-delulu-violet focus:outline-none transition-colors"})]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-delulu-muted mb-2",children:"Passwort"}),p.jsxs("div",{className:"relative",children:[p.jsx(tu,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-delulu-muted"}),p.jsx("input",{type:E?"text":"password",value:u,onChange:ee=>f(ee.target.value),placeholder:"Mindestens 6 Zeichen",required:!0,minLength:6,className:"w-full pl-12 pr-12 py-3 bg-white border-2 border-delulu-soft rounded-xl focus:border-delulu-violet focus:outline-none transition-colors"}),p.jsx("button",{type:"button",onClick:()=>T(!E),className:"absolute right-4 top-1/2 -translate-y-1/2 text-delulu-muted",children:E?p.jsx(_l,{size:18}):p.jsx(Oc,{size:18})})]})]}),w&&p.jsx("p",{className:"text-red-500 text-sm text-center",children:w}),p.jsx("button",{type:"submit",disabled:U,className:"btn-primary w-full py-4 text-white font-display font-bold disabled:opacity-70",children:U?"Wird registriert...":"Account erstellen"})]})}),p.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[p.jsx("div",{className:"flex-1 h-px bg-delulu-soft"}),p.jsx("span",{className:"text-sm text-delulu-muted",children:"oder"}),p.jsx("div",{className:"flex-1 h-px bg-delulu-soft"})]}),p.jsxs("button",{onClick:he,disabled:U,className:"w-full py-4 bg-white border-2 border-delulu-soft rounded-xl font-medium flex items-center justify-center gap-3 hover:border-delulu-violet transition-colors disabled:opacity-70",children:[p.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",children:[p.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),p.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),p.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),p.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Mit Google registrieren"]}),p.jsxs("p",{className:"text-center text-delulu-muted mt-8",children:["Schon einen Account?"," ",p.jsx(kh,{to:"/login",className:"text-delulu-violet font-semibold",children:"Login"})]}),p.jsxs("p",{className:"text-xs text-delulu-muted text-center mt-6 px-4",children:["Mit der Registrierung akzeptierst du unsere"," ",p.jsx("a",{href:"#",className:"text-delulu-violet",children:"Nutzungsbedingungen"})," und"," ",p.jsx("a",{href:"#",className:"text-delulu-violet",children:"Datenschutzerklrung"}),"."]})]})},uTe=()=>{const s=ei(),{user:r,setUser:o}=vi(),[l,u]=ce.useState("age"),[f,E]=ce.useState(!1),[T,w]=ce.useState(!1),[A,U]=ce.useState(!1),[M,F]=ce.useState(!1),[Y,J]=ce.useState(!0),[ae,he]=ce.useState(0),[ee,W]=ce.useState((r==null?void 0:r.username)||""),[Z,fe]=ce.useState((r==null?void 0:r.displayName)||""),[pe,Ce]=ce.useState(""),[te,q]=ce.useState(""),[re,$]=ce.useState(""),[le,ue]=ce.useState(!1),ie=new Date().getFullYear(),tt=Array.from({length:80},(ot,Et)=>ie-18-Et),Ot=[{icon:p.jsx(Rb,{size:64,className:"text-delulu-violet"}),title:"Willkommen in der Wolke",description:"delulu verbindet dich mit Menschen in deiner Nhe ber Voice-Chat. Tippe auf die Wolke um loszulegen."},{icon:p.jsx(TR,{size:64,className:"text-green-500"}),title:"Hyperlokal",description:"Du siehst nur Menschen im Umkreis von max. 500m. Echte Nachbarn, echte Gesprche."},{icon:p.jsx(Oc,{size:64,className:"text-purple-500"}),title:"Anonym oder Offen",description:'Du entscheidest bei jedem Chat ob du als du selbst oder als "Wanderer" anonym bleibst.'},{icon:p.jsx(tu,{size:64,className:"text-blue-500"}),title:"Privacy First",description:"Deine Daten gehren dir. Kein Tracking, keine Algorithmen. Du hast die volle Kontrolle."},{icon:p.jsx(ai,{size:64,className:"text-amber-500"}),title:"Community Regeln",description:"Respekt ist Pflicht. Belstigung, Hate Speech und unangemessenes Verhalten fhren zum Ausschluss."}],on=()=>{f&&u("terms")},It=()=>{T&&A&&M&&u(Y?"tutorial":"profile")},Ge=()=>{ae<Ot.length-1?he(ae+1):u("profile")},nt=()=>{u("profile")},pt=async()=>{if(!(!r||!ee.trim())){ue(!0);try{const ot={username:ee.trim().toLowerCase().replace(/\s+/g,"_"),displayName:Z.trim()||ee.trim(),bio:pe.trim(),birthYear:te?parseInt(te):null,city:re.trim(),onboardingCompleted:!0,onboardingCompletedAt:new Date,isOver18Verified:!0,termsAcceptedAt:new Date,privacyAcceptedAt:new Date,communityGuidelinesAcceptedAt:new Date};await fo(Dr(Qt,"users",r.id),ot),o({...r,...ot}),s("/")}catch(ot){console.error("Error saving profile:",ot)}finally{ue(!1)}}};return p.jsxs("div",{className:"min-h-screen bg-delulu-bg flex flex-col",children:[p.jsx("div",{className:"px-6 pt-6",children:p.jsx("div",{className:"flex gap-2",children:["age","terms","tutorial","profile"].map((ot,Et)=>p.jsx("div",{className:`h-1 flex-1 rounded-full transition-colors ${["age","terms","tutorial","profile"].indexOf(l)>=Et?"bg-delulu-violet":"bg-gray-200"}`},ot))})}),l==="age"&&p.jsxs("div",{className:"flex-1 flex flex-col px-6 py-8",children:[p.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-center",children:[p.jsx("div",{className:"w-20 h-20 rounded-full bg-amber-100 flex items-center justify-center mb-6",children:p.jsx(ik,{size:40,className:"text-amber-600"})}),p.jsx("h1",{className:"font-display text-2xl font-bold text-delulu-text mb-4",children:"Altersverifikation"}),p.jsx("p",{className:"text-delulu-muted mb-8 max-w-sm",children:"delulu ist eine Plattform fr Erwachsene. Du musst mindestens 18 Jahre alt sein um die App zu nutzen."}),p.jsxs("label",{className:"flex items-start gap-3 p-4 bg-white rounded-xl border-2 border-gray-200 cursor-pointer mb-6 text-left max-w-sm",children:[p.jsx("input",{type:"checkbox",checked:f,onChange:ot=>E(ot.target.checked),className:"mt-1 w-5 h-5 rounded border-gray-300 text-delulu-violet focus:ring-delulu-violet"}),p.jsxs("div",{children:[p.jsx("p",{className:"font-semibold text-delulu-text",children:"Ich besttige, dass ich 18 Jahre oder lter bin"}),p.jsx("p",{className:"text-sm text-delulu-muted mt-1",children:"Falsche Angaben fhren zur sofortigen Sperrung des Accounts."})]})]}),p.jsx("p",{className:"text-xs text-delulu-muted max-w-sm",children:"Bei Verdacht auf Minderjhrigkeit kann eine ID-Verifikation angefordert werden."})]}),p.jsx("button",{onClick:on,disabled:!f,className:"w-full py-4 bg-delulu-violet text-white font-bold rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-opacity",children:"Weiter"})]}),l==="terms"&&p.jsxs("div",{className:"flex-1 flex flex-col px-6 py-8",children:[p.jsxs("div",{className:"flex-1",children:[p.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[p.jsx("button",{onClick:()=>u("age"),className:"p-2 -m-2",children:p.jsx(Zz,{size:24,className:"text-delulu-muted"})}),p.jsx("h1",{className:"font-display text-2xl font-bold text-delulu-text",children:"Nutzungsbedingungen"})]}),p.jsx("p",{className:"text-delulu-muted mb-6",children:"Bitte lies und akzeptiere unsere Richtlinien um fortzufahren."}),p.jsxs("div",{className:"space-y-4 mb-6",children:[p.jsxs("label",{className:"flex items-start gap-3 p-4 bg-white rounded-xl border-2 border-gray-200 cursor-pointer",children:[p.jsx("input",{type:"checkbox",checked:T,onChange:ot=>w(ot.target.checked),className:"mt-1 w-5 h-5 rounded border-gray-300 text-delulu-violet focus:ring-delulu-violet"}),p.jsxs("div",{className:"flex-1",children:[p.jsx("p",{className:"font-semibold text-delulu-text",children:"AGB akzeptieren"}),p.jsxs("p",{className:"text-sm text-delulu-muted",children:["Ich habe die"," ",p.jsx("a",{href:"/impressum",className:"text-delulu-violet underline",children:"Allgemeinen Geschftsbedingungen"})," ","gelesen und akzeptiere diese."]})]})]}),p.jsxs("label",{className:"flex items-start gap-3 p-4 bg-white rounded-xl border-2 border-gray-200 cursor-pointer",children:[p.jsx("input",{type:"checkbox",checked:A,onChange:ot=>U(ot.target.checked),className:"mt-1 w-5 h-5 rounded border-gray-300 text-delulu-violet focus:ring-delulu-violet"}),p.jsxs("div",{className:"flex-1",children:[p.jsx("p",{className:"font-semibold text-delulu-text",children:"Datenschutz akzeptieren"}),p.jsxs("p",{className:"text-sm text-delulu-muted",children:["Ich habe die"," ",p.jsx("a",{href:"/datenschutz",className:"text-delulu-violet underline",children:"Datenschutzerklrung"})," ","gelesen und akzeptiere diese."]})]})]}),p.jsxs("label",{className:"flex items-start gap-3 p-4 bg-white rounded-xl border-2 border-gray-200 cursor-pointer",children:[p.jsx("input",{type:"checkbox",checked:M,onChange:ot=>F(ot.target.checked),className:"mt-1 w-5 h-5 rounded border-gray-300 text-delulu-violet focus:ring-delulu-violet"}),p.jsxs("div",{className:"flex-1",children:[p.jsx("p",{className:"font-semibold text-delulu-text",children:"Community-Regeln akzeptieren"}),p.jsx("p",{className:"text-sm text-delulu-muted",children:"Ich verpflichte mich zu respektvollem Umgang. Belstigung, Hate Speech und unangemessenes Verhalten sind verboten."})]})]})]}),p.jsxs("label",{className:"flex items-center gap-3 p-4 bg-purple-50 rounded-xl cursor-pointer",children:[p.jsx("input",{type:"checkbox",checked:Y,onChange:ot=>J(ot.target.checked),className:"w-5 h-5 rounded border-gray-300 text-delulu-violet focus:ring-delulu-violet"}),p.jsxs("div",{children:[p.jsx("p",{className:"font-semibold text-delulu-text",children:"App-Einfhrung anzeigen"}),p.jsx("p",{className:"text-sm text-delulu-muted",children:"Kurze Erklrung wie delulu funktioniert"})]})]})]}),p.jsx("button",{onClick:It,disabled:!T||!A||!M,className:"w-full py-4 bg-delulu-violet text-white font-bold rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-opacity",children:"Weiter"})]}),l==="tutorial"&&p.jsxs("div",{className:"flex-1 flex flex-col px-6 py-8",children:[p.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-center",children:[p.jsx("div",{className:"mb-8",children:Ot[ae].icon}),p.jsx("h2",{className:"font-display text-2xl font-bold text-delulu-text mb-4",children:Ot[ae].title}),p.jsx("p",{className:"text-delulu-muted max-w-sm mb-8",children:Ot[ae].description}),p.jsx("div",{className:"flex gap-2",children:Ot.map((ot,Et)=>p.jsx("div",{className:`w-2 h-2 rounded-full transition-colors ${Et===ae?"bg-delulu-violet w-6":"bg-gray-300"}`},Et))})]}),p.jsxs("div",{className:"flex gap-3",children:[p.jsx("button",{onClick:nt,className:"flex-1 py-4 border-2 border-gray-200 text-delulu-muted font-semibold rounded-xl",children:"berspringen"}),p.jsx("button",{onClick:Ge,className:"flex-1 py-4 bg-delulu-violet text-white font-bold rounded-xl flex items-center justify-center gap-2",children:ae<Ot.length-1?p.jsxs(p.Fragment,{children:["Weiter ",p.jsx(_i,{size:20})]}):p.jsxs(p.Fragment,{children:["Los geht's ",p.jsx(ci,{size:20})]})})]})]}),l==="profile"&&p.jsxs("div",{className:"flex-1 flex flex-col px-6 py-8",children:[p.jsxs("div",{className:"flex-1",children:[p.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[p.jsx("button",{onClick:()=>u("tutorial"),className:"p-2 -m-2",children:p.jsx(Zz,{size:24,className:"text-delulu-muted"})}),p.jsx("h1",{className:"font-display text-2xl font-bold text-delulu-text",children:"Dein Profil"})]}),p.jsx("p",{className:"text-delulu-muted mb-6",children:"Richte dein Profil ein. Du kannst diese Angaben spter jederzeit ndern."}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-semibold text-delulu-text mb-2",children:"Benutzername *"}),p.jsxs("div",{className:"relative",children:[p.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-delulu-muted",children:"@"}),p.jsx("input",{type:"text",value:ee,onChange:ot=>W(ot.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"")),placeholder:"dein_name",maxLength:20,className:"w-full pl-8 pr-4 py-3 border-2 border-gray-200 rounded-xl focus:border-delulu-violet focus:outline-none"})]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-semibold text-delulu-text mb-2",children:"Anzeigename"}),p.jsx("input",{type:"text",value:Z,onChange:ot=>fe(ot.target.value),placeholder:"Wie sollen dich andere sehen?",maxLength:30,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-delulu-violet focus:outline-none"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-semibold text-delulu-text mb-2",children:"Geburtsjahr"}),p.jsxs("select",{value:te,onChange:ot=>q(ot.target.value),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-delulu-violet focus:outline-none bg-white",children:[p.jsx("option",{value:"",children:"Auswhlen..."}),tt.map(ot=>p.jsx("option",{value:ot,children:ot},ot))]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-semibold text-delulu-text mb-2",children:"Stadt / Region"}),p.jsx("input",{type:"text",value:re,onChange:ot=>$(ot.target.value),placeholder:"z.B. Berlin, Mnchen...",maxLength:50,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-delulu-violet focus:outline-none"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-semibold text-delulu-text mb-2",children:"ber dich"}),p.jsx("textarea",{value:pe,onChange:ot=>Ce(ot.target.value),placeholder:"Erzhl etwas ber dich... (optional)",maxLength:200,rows:3,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-delulu-violet focus:outline-none resize-none"}),p.jsxs("p",{className:"text-xs text-delulu-muted mt-1 text-right",children:[pe.length,"/200"]})]})]})]}),p.jsx("button",{onClick:pt,disabled:!ee.trim()||le,className:"w-full py-4 bg-delulu-violet text-white font-bold rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-opacity flex items-center justify-center gap-2",children:le?p.jsx(p.Fragment,{children:"Speichern..."}):p.jsxs(p.Fragment,{children:[p.jsx(rl,{size:20}),"Profil speichern & starten"]})})]})]})},hTe=()=>{const{location:s,locationError:r,locationPermission:o,setLocation:l,setLocationError:u,setLocationPermission:f}=vi(),E=ce.useCallback(async(A,U,M)=>{const F=fh.currentUser;if(F)try{await nP(Dr(Qt,"user_locations",F.uid),{userId:F.uid,latitude:A,longitude:U,accuracy:M,updatedAt:W_(),expiresAt:new Date(Date.now()+15*60*1e3)})}catch(Y){console.error("Failed to update location:",Y)}},[]),T=ce.useCallback(async()=>{if(!navigator.geolocation)return u("Geolocation wird nicht untersttzt"),!1;try{const A=await navigator.permissions.query({name:"geolocation"});return f(A.state),A.state==="denied"?(u("Standort-Zugriff verweigert"),!1):!0}catch{return!0}},[f,u]),w=ce.useCallback(()=>navigator.geolocation?navigator.geolocation.watchPosition(U=>{const M={latitude:U.coords.latitude,longitude:U.coords.longitude,accuracy:U.coords.accuracy,timestamp:new Date(U.timestamp)};l(M),u(null),f("granted"),E(M.latitude,M.longitude,M.accuracy)},U=>{switch(U.code){case U.PERMISSION_DENIED:u("Standort-Zugriff verweigert"),f("denied");break;case U.POSITION_UNAVAILABLE:u("Standort nicht verfgbar");break;case U.TIMEOUT:u("Standort-Anfrage Timeout");break;default:u("Unbekannter Fehler")}},{enableHighAccuracy:!0,maximumAge:1e4,timeout:1e4}):(u("Geolocation wird nicht untersttzt"),null),[l,u,f,E]);return ce.useEffect(()=>{let A=null;return(async()=>{await T()&&(A=w())})(),()=>{A!==null&&navigator.geolocation.clearWatch(A)}},[T,w]),{location:s,error:r,permission:o,requestPermission:T}},sl={de:{name:"German",flag:"",native:"Deutsch"},en:{name:"English",flag:"",native:"English"},es:{name:"Spanish",flag:"",native:"Espaol"},fr:{name:"French",flag:"",native:"Franais"},pt:{name:"Portuguese",flag:"",native:"Portugus"}},pTe={common:{save:{de:"Speichern",en:"Save",es:"Guardar",fr:"Enregistrer",pt:"Salvar"},cancel:{de:"Abbrechen",en:"Cancel",es:"Cancelar",fr:"Annuler",pt:"Cancelar"},confirm:{de:"Besttigen",en:"Confirm",es:"Confirmar",fr:"Confirmer",pt:"Confirmar"},delete:{de:"Lschen",en:"Delete",es:"Eliminar",fr:"Supprimer",pt:"Excluir"},edit:{de:"Bearbeiten",en:"Edit",es:"Editar",fr:"Modifier",pt:"Editar"},back:{de:"Zurck",en:"Back",es:"Atrs",fr:"Retour",pt:"Voltar"},next:{de:"Weiter",en:"Next",es:"Siguiente",fr:"Suivant",pt:"Prximo"},done:{de:"Fertig",en:"Done",es:"Hecho",fr:"Termin",pt:"Concludo"},loading:{de:"Ldt...",en:"Loading...",es:"Cargando...",fr:"Chargement...",pt:"Carregando..."},retry:{de:"Erneut versuchen",en:"Retry",es:"Reintentar",fr:"Ressayer",pt:"Tentar novamente"}},nav:{home:{de:"Home",en:"Home",es:"Inicio",fr:"Accueil",pt:"Incio"},discover:{de:"Entdecken",en:"Discover",es:"Descubrir",fr:"Dcouvrir",pt:"Descobrir"},messages:{de:"Nachrichten",en:"Messages",es:"Mensajes",fr:"Messages",pt:"Mensagens"},profile:{de:"Profil",en:"Profile",es:"Perfil",fr:"Profil",pt:"Perfil"}},profile:{title:{de:"Profil",en:"Profile",es:"Perfil",fr:"Profil",pt:"Perfil"},editProfile:{de:"Profil bearbeiten",en:"Edit Profile",es:"Editar perfil",fr:"Modifier le profil",pt:"Editar perfil"},bioPlaceholder:{de:"Erzhl was ber dich...",en:"Tell us about yourself...",es:"Cuntanos sobre ti...",fr:"Parlez-nous de vous...",pt:"Conte-nos sobre voc..."},noBio:{de:"Keine Bio. Ein Mensch der Geheimnisse.",en:"No bio. A person of mystery.",es:"Sin bio. Una persona misteriosa.",fr:"Pas de bio. Une personne mystrieuse.",pt:"Sem bio. Uma pessoa misteriosa."},stats:{friends:{de:"Freunde",en:"Friends",es:"Amigos",fr:"Amis",pt:"Amigos"},trust:{de:"Trust",en:"Trust",es:"Confianza",fr:"Confiance",pt:"Confiana"},voiceMin:{de:"Voice Min",en:"Voice Min",es:"Min de Voz",fr:"Min Vocal",pt:"Min de Voz"}},logout:{de:"Abmelden",en:"Log out",es:"Cerrar sesin",fr:"Dconnexion",pt:"Sair"},loggingOut:{de:"Wird abgemeldet...",en:"Logging out...",es:"Cerrando sesin...",fr:"Dconnexion...",pt:"Saindo..."}},level:{level:{de:"Level",en:"Level",es:"Nivel",fr:"Niveau",pt:"Nvel"},xpToNext:{de:"XP zum nchsten Level",en:"XP to next level",es:"XP para el siguiente nivel",fr:"XP pour le prochain niveau",pt:"XP para o prximo nvel"},titles:{newcomer:{de:"Newcomer",en:"Newcomer",es:"Novato",fr:"Nouveau",pt:"Novato"},dreamer:{de:"Dreamer",en:"Dreamer",es:"Soador",fr:"Rveur",pt:"Sonhador"},connector:{de:"Connector",en:"Connector",es:"Conector",fr:"Connecteur",pt:"Conector"},socialite:{de:"Socialite",en:"Socialite",es:"Socialit",fr:"Mondain",pt:"Socialite"},influencer:{de:"Influencer",en:"Influencer",es:"Influencer",fr:"Influenceur",pt:"Influenciador"},legend:{de:"Legend",en:"Legend",es:"Leyenda",fr:"Lgende",pt:"Lenda"}},levelUp:{de:"Du bist jetzt offiziell weniger irrelevant. Willkommen auf Level {level}.",en:"You're officially less irrelevant now. Welcome to Level {level}.",es:"Ahora eres oficialmente menos irrelevante. Bienvenido al Nivel {level}.",fr:"Tu es officiellement moins insignifiant maintenant. Bienvenue au Niveau {level}.",pt:"Voc agora  oficialmente menos irrelevante. Bem-vindo ao Nvel {level}."}},streak:{title:{de:"Streak",en:"Streak",es:"Racha",fr:"Srie",pt:"Sequncia"},days:{de:"Tage",en:"days",es:"das",fr:"jours",pt:"dias"},xpBoost:{de:"XP Boost",en:"XP Boost",es:"Bonus de XP",fr:"Bonus XP",pt:"Bnus de XP"},lost:{de:"Streak verloren. Das war wohl nichts. Aber hey, morgen ist ein neuer Tag.",en:"Streak lost. That didn't work out. But hey, tomorrow's a new day.",es:"Racha perdida. Eso no funcion. Pero oye, maana es un nuevo da.",fr:"Srie perdue. a n'a pas march. Mais bon, demain est un autre jour.",pt:"Sequncia perdida. No deu certo. Mas ei, amanh  um novo dia."},frozen:{de:"Streak eingefroren. Ausnahmsweise.",en:"Streak frozen. Just this once.",es:"Racha congelada. Solo por esta vez.",fr:"Srie gele. Exceptionnellement.",pt:"Sequncia congelada. S desta vez."}},visibility:{title:{de:"Wer darf dich sehen?",en:"Who can see you?",es:"Quin puede verte?",fr:"Qui peut te voir?",pt:"Quem pode te ver?"},public:{title:{de:"Alle in Reichweite",en:"Everyone nearby",es:"Todos cerca",fr:"Tout le monde  proximit",pt:"Todos por perto"},description:{de:"Jeder im Radius kann dich sehen",en:"Anyone in range can see you",es:"Cualquiera en el rango puede verte",fr:"Tout le monde dans le rayon peut te voir",pt:"Qualquer um no raio pode te ver"},hint:{de:"Alle sehen dich. Kein Verstecken.",en:"Everyone sees you. No hiding.",es:"Todos te ven. Sin esconderse.",fr:"Tout le monde te voit. Pas de cachette.",pt:"Todos te veem. Sem se esconder."}},friends:{title:{de:"Nur meine Freunde",en:"Only my friends",es:"Solo mis amigos",fr:"Seulement mes amis",pt:"Apenas meus amigos"},description:{de:"Fremde sehen dich nicht",en:"Strangers can't see you",es:"Los extraos no pueden verte",fr:"Les inconnus ne te voient pas",pt:"Estranhos no podem te ver"},hint:{de:"Nur deine Freunde sehen dich. Exklusivclub.",en:"Only your friends see you. Exclusive club.",es:"Solo tus amigos te ven. Club exclusivo.",fr:"Seuls tes amis te voient. Club exclusif.",pt:"S seus amigos te veem. Clube exclusivo."}},ghost:{title:{de:"Niemand (Ghost Mode) ",en:"Nobody (Ghost Mode) ",es:"Nadie (Modo Fantasma) ",fr:"Personne (Mode Fantme) ",pt:"Ningum (Modo Fantasma) "},description:{de:"Du bist komplett unsichtbar",en:"You're completely invisible",es:"Eres completamente invisible",fr:"Tu es compltement invisible",pt:"Voc est completamente invisvel"},hint:{de:"Ghost Mode aktiv. Du existierst nicht. Sehr dramatisch.",en:"Ghost Mode active. You don't exist. Very dramatic.",es:"Modo Fantasma activo. No existes. Muy dramtico.",fr:"Mode Fantme actif. Tu n'existes pas. Trs dramatique.",pt:"Modo Fantasma ativo. Voc no existe. Muito dramtico."}}},friendRadar:{title:{de:"Friend-Radar",en:"Friend Radar",es:"Radar de Amigos",fr:"Radar Amis",pt:"Radar de Amigos"},description:{de:"Benachrichtigung im 10km Radius",en:"Notification within 10km radius",es:"Notificacin en radio de 10km",fr:"Notification dans un rayon de 10km",pt:"Notificao em raio de 10km"},notification:{de:"{name} ist im 10km-Radius. Keine Sorge, er kann dich nicht hren  es sei denn, du willst es.",en:"{name} is within 10km. Don't worry, they can't hear you  unless you want them to.",es:"{name} est a 10km. No te preocupes, no pueden orte  a menos que quieras.",fr:"{name} est  10km. T'inquite, ils ne peuvent pas t'entendre  sauf si tu le veux.",pt:"{name} est a 10km. No se preocupe, eles no podem te ouvir  a menos que voc queira."},enabled:{de:"Friend-Radar aktiv",en:"Friend Radar active",es:"Radar de Amigos activo",fr:"Radar Amis actif",pt:"Radar de Amigos ativo"},disabled:{de:"Friend-Radar aus. Du willst also berrascht werden? Mutig.",en:"Friend Radar off. So you want to be surprised? Bold.",es:"Radar de Amigos apagado. Quieres sorpresas? Valiente.",fr:"Radar Amis dsactiv. Tu veux tre surpris? Audacieux.",pt:"Radar de Amigos desligado. Quer ser surpreendido? Corajoso."}},radius:{title:{de:"Suchradius",en:"Search Radius",es:"Radio de Bsqueda",fr:"Rayon de Recherche",pt:"Raio de Busca"},description:{de:"Wie weit siehst du andere?",en:"How far can you see others?",es:"Qu tan lejos puedes ver a otros?",fr:" quelle distance peux-tu voir les autres?",pt:"At onde voc pode ver os outros?"},hint:{max:{de:"Maximale Reichweite. Viel Spa mit dem Chaos.",en:"Maximum range. Have fun with the chaos.",es:"Alcance mximo. Divirtete con el caos.",fr:"Porte maximale. Amuse-toi avec le chaos.",pt:"Alcance mximo. Divirta-se com o caos."},min:{de:"Nur die Nchsten. Sehr... intim.",en:"Only the closest. Very... intimate.",es:"Solo los ms cercanos. Muy... ntimo.",fr:"Seulement les plus proches. Trs... intime.",pt:"Apenas os mais prximos. Muito... ntimo."},default:{de:"Sollte reichen.",en:"Should be enough.",es:"Debera ser suficiente.",fr:"a devrait suffire.",pt:"Deve ser suficiente."}},error:{de:"Nett versucht, aber die Physik lsst sich nicht austricksen. Wir kalibrieren den Radius neu.",en:"Nice try, but you can't trick physics. We're recalibrating the radius.",es:"Buen intento, pero no puedes engaar a la fsica. Recalibrando el radio.",fr:"Bien essay, mais tu ne peux pas tromper la physique. On recalibre le rayon.",pt:"Boa tentativa, mas voc no pode enganar a fsica. Recalibrando o raio."}},premium:{title:{de:"CATALYST",en:"CATALYST",es:"CATALYST",fr:"CATALYST",pt:"CATALYST"},upsell:{de:"Hr auf zu schleichen. Hol dir den Catalyst und sieh genau, wer in deiner Nhe ist, bevor sie dich sehen.",en:"Stop lurking. Get Catalyst and see exactly who is near you before they see you.",es:"Deja de acechar. Obtn Catalyst y ve exactamente quin est cerca antes de que te vean.",fr:"Arrte de rder. Prends Catalyst et vois exactement qui est prs de toi avant qu'ils te voient.",pt:"Pare de espreitar. Obtenha o Catalyst e veja exatamente quem est perto antes que te vejam."},upgrade:{de:"Jetzt upgraden",en:"Upgrade now",es:"Actualizar ahora",fr:"Mettre  niveau",pt:"Atualizar agora"},features:{xpBoost:{de:"1.5x XP Boost  permanent",en:"1.5x XP Boost  permanent",es:"1.5x Bonus de XP  permanente",fr:"1.5x Bonus XP  permanent",pt:"1.5x Bnus de XP  permanente"},exactDistance:{de:"Meter-genaue Distanzanzeige",en:"Meter-precise distance display",es:"Distancia precisa en metros",fr:"Distance prcise au mtre",pt:"Distncia precisa em metros"},profileStalker:{de:"Sieh wer dein Profil besucht",en:"See who viewed your profile",es:"Ve quin visit tu perfil",fr:"Vois qui a visit ton profil",pt:"Veja quem visitou seu perfil"},priorityListing:{de:"Immer oben in der Liste",en:"Always at the top of the list",es:"Siempre arriba en la lista",fr:"Toujours en haut de la liste",pt:"Sempre no topo da lista"}}},settings:{title:{de:"Einstellungen",en:"Settings",es:"Configuracin",fr:"Paramtres",pt:"Configuraes"},blockedUsers:{de:"Blockierte Nutzer",en:"Blocked Users",es:"Usuarios Bloqueados",fr:"Utilisateurs Bloqus",pt:"Usurios Bloqueados"},myStats:{de:"Meine Statistiken",en:"My Statistics",es:"Mis Estadsticas",fr:"Mes Statistiques",pt:"Minhas Estatsticas"},notifications:{de:"Benachrichtigungen",en:"Notifications",es:"Notificaciones",fr:"Notifications",pt:"Notificaes"},appDesign:{de:"App-Design",en:"App Design",es:"Diseo de la App",fr:"Design de l'App",pt:"Design do App"},language:{de:"Sprache",en:"Language",es:"Idioma",fr:"Langue",pt:"Idioma"},help:{de:"Hilfe & FAQ",en:"Help & FAQ",es:"Ayuda y FAQ",fr:"Aide et FAQ",pt:"Ajuda e FAQ"}},moderation:{shadowMuted:{de:"Deine Vibes sind gerade ziemlich toxic. Wir haben dich mal kurz stummgeschaltet, damit die anderen in Ruhe weiterreden knnen. Atme mal tief durch.",en:"Your vibes are pretty toxic right now. We've muted you for a bit so others can chat in peace. Take a deep breath.",es:"Tus vibes son bastante txicas ahora. Te silenciamos un rato para que otros puedan charlar en paz. Respira hondo.",fr:"Tes vibes sont assez toxiques l. On t'a mis en sourdine pour que les autres puissent discuter tranquilles. Respire un coup.",pt:"Suas vibes esto bem txicas agora. Te silenciamos um pouco para os outros conversarem em paz. Respire fundo."},tempBanned:{de:"OK, das war's erstmal fr dich. Du bist fr {hours}h auf Eis gelegt. Nutz die Zeit, um ber deine Lebensentscheidungen nachzudenken.",en:"OK, that's it for now. You're on ice for {hours}h. Use the time to reflect on your life choices.",es:"OK, eso es todo por ahora. Ests en hielo por {hours}h. Usa el tiempo para reflexionar sobre tus decisiones de vida.",fr:"OK, c'est fini pour l'instant. Tu es sur glace pour {hours}h. Profite pour rflchir  tes choix de vie.",pt:"OK,  isso por agora. Voc est no gelo por {hours}h. Use o tempo para refletir sobre suas escolhas de vida."},warning:{de:"Heads up: Noch ein Ausrutscher und du landest auf der Bank. Deine Entscheidung.",en:"Heads up: One more slip and you're benched. Your call.",es:"Aviso: Un error ms y ests en la banca. Tu decisin.",fr:"Attention: Un faux pas de plus et tu es sur le banc.  toi de voir.",pt:"Aviso: Mais um deslize e voc vai pro banco. Sua deciso."}},errors:{generic:{de:"Irgendwas ist schiefgelaufen. Wahrscheinlich nicht deine Schuld. Wahrscheinlich.",en:"Something went wrong. Probably not your fault. Probably.",es:"Algo sali mal. Probablemente no es tu culpa. Probablemente.",fr:"Quelque chose s'est mal pass. Probablement pas ta faute. Probablement.",pt:"Algo deu errado. Provavelmente no  sua culpa. Provavelmente."},network:{de:"Keine Verbindung. Das Internet hat dich verlassen, nicht wir.",en:"No connection. The internet left you, not us.",es:"Sin conexin. Internet te dej, no nosotros.",fr:"Pas de connexion. Internet t'a quitt, pas nous.",pt:"Sem conexo. A internet te deixou, no ns."},location:{de:"GPS-Signal verloren. Vielleicht stehst du in einem Bunker?",en:"GPS signal lost. Maybe you're in a bunker?",es:"Seal GPS perdida. Quizs ests en un bnker?",fr:"Signal GPS perdu. T'es peut-tre dans un bunker?",pt:"Sinal GPS perdido. Talvez voc esteja em um bunker?"}},empty:{friends:{de:"Noch keine Freunde. Das lsst sich ndern  geh raus und quatsch Leute an.",en:"No friends yet. That can change  go out and talk to people.",es:"An sin amigos. Eso puede cambiar  sal y habla con la gente.",fr:"Pas encore d'amis. a peut changer  sors et parle aux gens.",pt:"Ainda sem amigos. Isso pode mudar  saia e fale com as pessoas."},nearbyUsers:{de:"Niemand in Reichweite. Entweder bist du allein, oder alle verstecken sich vor dir.",en:"No one in range. Either you're alone, or everyone's hiding from you.",es:"Nadie en rango. O ests solo, o todos se esconden de ti.",fr:"Personne  porte. Soit t'es seul, soit tout le monde se cache de toi.",pt:"Ningum no alcance. Ou voc est sozinho, ou todos esto se escondendo de voc."},messages:{de:"Keine Nachrichten. Die Stille ist ohrenbetubend.",en:"No messages. The silence is deafening.",es:"Sin mensajes. El silencio es ensordecedor.",fr:"Pas de messages. Le silence est assourdissant.",pt:"Sem mensagens. O silncio  ensurdecedor."}},avatar:{title:{de:"Whle deinen Avatar",en:"Choose your avatar",es:"Elige tu avatar",fr:"Choisis ton avatar",pt:"Escolha seu avatar"},subtitle:{de:"Dein Avatar wird anderen angezeigt",en:"Your avatar will be shown to others",es:"Tu avatar se mostrar a otros",fr:"Ton avatar sera montr aux autres",pt:"Seu avatar ser mostrado aos outros"},selected:{de:"Ausgewhlt",en:"Selected",es:"Seleccionado",fr:"Slectionn",pt:"Selecionado"}},trust:{trusted:{de:"TRUSTED",en:"TRUSTED",es:"CONFIABLE",fr:"FIABLE",pt:"CONFIVEL"},reliable:{de:"RELIABLE",en:"RELIABLE",es:"FIABLE",fr:"SRIEUX",pt:"CONFIVEL"},neutral:{de:"NEUTRAL",en:"NEUTRAL",es:"NEUTRAL",fr:"NEUTRE",pt:"NEUTRO"},caution:{de:"VORSICHT",en:"CAUTION",es:"PRECAUCIN",fr:"ATTENTION",pt:"CUIDADO"}}};function Of(){const{language:s,setLanguage:r}=vi(),o=ce.useCallback((u,f)=>{const E=u.split(".");let T=pTe;for(const w of E)if(T&&typeof T=="object"&&w in T)T=T[w];else return console.warn(`Translation not found: ${u}`),u;if(T&&typeof T=="object"&&s in T){let w=T[s];return f&&Object.entries(f).forEach(([A,U])=>{w=w.replace(new RegExp(`{${A}}`,"g"),String(U))}),w}return console.warn(`Translation not found for language ${s}: ${u}`),u},[s]),l=ce.useCallback(u=>{r(u),localStorage.setItem("delulu-language",u)},[r]);return{t:o,language:s,setLanguage:l,languages:sl,currentLanguage:sl[s]}}const ak={empty:{messages:"Keine Nachrichten. Die Stille ist ohrenbetubend.",lounges:"Keine Lounges in der Nhe. Zeit, selbst eine zu erstellen?",stats:"Noch keine Stats. Fang an zu reden, dann gibts auch was zu zeigen."}},ck=s=>s>=76?{name:"Legend",emoji:""}:s>=51?{name:"Influencer",emoji:""}:s>=31?{name:"Socialite",emoji:""}:s>=16?{name:"Connector",emoji:""}:s>=6?{name:"Dreamer",emoji:""}:{name:"Newcomer",emoji:""},bR=s=>s>=30?2:s>=14?1.8:s>=7?1.6:s>=6?1.5:s>=5?1.4:s>=4?1.3:s>=3?1.2:s>=2?1.1:1,s8=s=>Math.floor(Math.pow(s,1.5)*100),mTe=({onToggle:s})=>{var T;const{user:r}=vi(),[o,l]=ce.useState((r==null?void 0:r.isGlobalAnonymous)||!1),[u,f]=ce.useState(!1),E=()=>{const w=!o;l(w),"vibrate"in navigator&&navigator.vibrate(w?[20,10,20]:10),s==null||s(w)};return p.jsxs("div",{className:"relative flex items-center gap-3",children:[p.jsxs("div",{className:"relative",children:[p.jsxs("div",{className:`
            w-12 h-12 rounded-2xl overflow-hidden transition-all duration-300
            ${o?"ring-2 ring-green-400 ring-offset-2 shadow-lg shadow-green-400/30":"ring-1 ring-gray-200"}
          `,children:[r!=null&&r.avatarUrl?p.jsx("img",{src:r.avatarUrl,alt:"",className:`w-full h-full object-cover transition-all duration-300 ${o?"blur-md scale-110":""}`}):p.jsx("div",{className:`
              w-full h-full bg-gradient-to-br from-delulu-violet to-purple-600
              flex items-center justify-center text-white text-xl font-bold
              transition-all duration-300
              ${o?"blur-sm":""}
            `,children:((T=r==null?void 0:r.displayName)==null?void 0:T.charAt(0))||"?"}),o&&p.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20",children:p.jsx(Va,{size:20,className:"text-white drop-shadow-lg"})})]}),p.jsx("div",{className:`
            absolute -bottom-1 -right-1 w-5 h-5 rounded-full
            flex items-center justify-center
            transition-all duration-300
            ${o?"bg-green-500 shadow-lg shadow-green-500/50":"bg-gray-400"}
          `,children:o?p.jsx(_l,{size:10,className:"text-white"}):p.jsx(Oc,{size:10,className:"text-white"})})]}),p.jsxs("button",{onClick:E,onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),className:`
          relative flex items-center gap-2 px-3 py-2 rounded-xl
          font-semibold text-sm transition-all duration-300
          ${o?"bg-green-100 text-green-700 border border-green-200 shadow-sm":"bg-gray-100 text-gray-500 border border-gray-200 hover:bg-gray-50"}
        `,children:[p.jsx("div",{className:`
          relative w-8 h-5 rounded-full transition-colors duration-300
          ${o?"bg-green-500":"bg-gray-300"}
        `,children:p.jsx("div",{className:`
            absolute top-0.5 w-4 h-4 rounded-full bg-white shadow-sm
            transition-transform duration-300
            ${o?"left-3.5":"left-0.5"}
          `})}),p.jsx("span",{className:"hidden sm:inline",children:o?"Anonym":"Sichtbar"})]}),u&&p.jsxs("div",{className:"absolute top-full left-0 mt-2 p-3 bg-gray-900 text-white text-xs rounded-xl shadow-xl z-50 w-48 animate-in fade-in slide-in-from-top-2",children:[p.jsx("p",{className:"font-semibold mb-1",children:o?" Anonymer Modus":" Sichtbarer Modus"}),p.jsx("p",{className:"text-gray-300",children:o?"Dein Profilbild ist verschleiert. Andere sehen nur deinen Alias.":"Dein Profil ist vollstndig sichtbar fr andere User."})]})]})},fTe=({currentStreak:s,longestStreak:r=0,onClaim:o,canClaim:l=!1})=>{const{t:u}=Of(),f=bR(s),E=[7,14,30,60,100].find(A=>A>s)||100,T=s/E*100,w=A=>A>=100?" Legend Box":A>=60?" Diamond Box":A>=30?" Royal Box":A>=14?" Premium Box":A>=7?" Bonus Box":" XP Bonus";return p.jsxs("div",{className:"relative overflow-hidden",children:[p.jsxs("div",{className:"glass-card p-4 border-2 border-orange-200 bg-gradient-to-r from-orange-50 to-amber-50",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsxs("div",{className:"relative",children:[p.jsx("div",{className:"w-14 h-14 rounded-2xl bg-gradient-to-br from-orange-400 to-red-500 flex items-center justify-center shadow-lg",children:p.jsx(sq,{size:28,className:"text-white"})}),p.jsx("div",{className:"absolute inset-0 rounded-2xl bg-orange-400/30 animate-pulse"})]}),p.jsxs("div",{children:[p.jsxs("div",{className:"flex items-baseline gap-2",children:[p.jsx("span",{className:"font-display text-3xl font-black text-orange-600",children:s}),p.jsx("span",{className:"text-sm font-semibold text-orange-500",children:u("profile.stats.streak")})]}),p.jsxs("p",{className:"text-xs text-orange-600/70",children:["Best: ",r," Tage"]})]})]}),p.jsxs("div",{className:"text-right",children:[p.jsxs("div",{className:"inline-flex items-center gap-1 bg-gradient-to-r from-amber-400 to-orange-500 text-white px-3 py-1.5 rounded-xl shadow-lg",children:[p.jsx(hl,{size:14,className:"fill-white"}),p.jsxs("span",{className:"font-bold text-sm",children:[f,"x XP"]})]}),l&&p.jsxs("button",{onClick:o,className:"mt-2 flex items-center gap-1 text-xs font-semibold text-amber-600 hover:text-amber-700 transition-colors",children:[p.jsx(oq,{size:12}),p.jsx("span",{children:"Bonus abholen!"})]})]})]}),p.jsxs("div",{className:"mt-4",children:[p.jsxs("div",{className:"flex items-center justify-between text-xs mb-1.5",children:[p.jsx("span",{className:"text-orange-600/70",children:"Nchste Belohnung"}),p.jsxs("span",{className:"font-semibold text-orange-600",children:[w(E)," @ Tag ",E]})]}),p.jsx("div",{className:"h-2 bg-orange-100 rounded-full overflow-hidden",children:p.jsx("div",{className:"h-full bg-gradient-to-r from-orange-400 to-amber-500 rounded-full transition-all duration-500",style:{width:`${Math.min(T,100)}%`}})}),p.jsxs("div",{className:"flex justify-between text-[10px] text-orange-500/60 mt-1",children:[p.jsxs("span",{children:["Tag ",s]}),p.jsxs("span",{children:["Tag ",E]})]})]})]}),s>=7&&p.jsx("div",{className:"absolute -top-2 -right-2 text-2xl animate-bounce",children:""}),s>=30&&p.jsx("div",{className:"absolute -top-2 -left-2 text-xl animate-bounce",style:{animationDelay:"0.2s"},children:""})]})},gTe=({isOpen:s,onClose:r,onChoose:o,chatType:l,targetName:u="Chat"})=>{const{user:f}=vi(),[E,T]=ce.useState(null),[w,A]=ce.useState(!0);if(!s)return null;const U={dm:"Direktnachricht",lounge:"Lounge",voice:"Voice Chat"},M=()=>{E&&o(E)};return p.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:p.jsxs("div",{className:"relative w-full max-w-md bg-white rounded-3xl shadow-2xl overflow-hidden animate-in zoom-in-95 duration-200",children:[p.jsxs("div",{className:"relative bg-gradient-to-br from-delulu-violet to-purple-600 p-6 text-white",children:[p.jsx("button",{onClick:r,className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-white/20 flex items-center justify-center hover:bg-white/30 transition-colors",children:p.jsx(nu,{size:18})}),p.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[p.jsx("div",{className:"w-12 h-12 rounded-2xl bg-white/20 flex items-center justify-center",children:p.jsx(Va,{size:24})}),p.jsxs("div",{children:[p.jsx("h2",{className:"font-display text-xl font-bold",children:"Identitt whlen"}),p.jsxs("p",{className:"text-white/80 text-sm",children:["Wie mchtest du ",U[l]," beitreten?"]})]})]}),u&&p.jsx("div",{className:"mt-2 px-3 py-1.5 bg-white/10 rounded-lg inline-block",children:p.jsxs("span",{className:"text-sm",children:[" ",u]})})]}),p.jsxs("div",{className:"p-6 space-y-4",children:[p.jsx("button",{onClick:()=>T("anonymous"),className:`w-full p-5 rounded-2xl border-2 text-left transition-all duration-200 ${E==="anonymous"?"border-delulu-violet bg-delulu-violet/5 shadow-lg scale-[1.02]":"border-gray-200 hover:border-delulu-violet/50 hover:bg-gray-50"}`,children:p.jsxs("div",{className:"flex items-start gap-4",children:[p.jsx("div",{className:`w-14 h-14 rounded-2xl flex items-center justify-center ${E==="anonymous"?"bg-delulu-violet text-white":"bg-gray-100 text-gray-500"}`,children:p.jsx(_l,{size:24})}),p.jsxs("div",{className:"flex-1",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("h3",{className:"font-display font-bold text-lg text-delulu-text",children:"Anonym"}),p.jsx("span",{className:"px-2 py-0.5 bg-green-100 text-green-700 text-[10px] font-semibold rounded-full",children:"EMPFOHLEN"})]}),p.jsxs("p",{className:"text-sm text-delulu-muted mt-1",children:["Dein Profilbild wird verschleiert und du erscheinst als",p.jsxs("span",{className:"font-semibold text-delulu-violet ml-1",children:['"',(f==null?void 0:f.anonymousAlias)||"Wanderer_"+Math.floor(Math.random()*9999),'"']})]}),p.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[p.jsx(tu,{size:12,className:"text-green-600"}),p.jsx("span",{className:"text-xs text-green-600 font-medium",children:"Echte Identitt geschtzt"})]})]}),E==="anonymous"&&p.jsx("div",{className:"w-6 h-6 rounded-full bg-delulu-violet flex items-center justify-center",children:p.jsx(ci,{size:14,className:"text-white"})})]})}),p.jsx("button",{onClick:()=>T("public"),className:`w-full p-5 rounded-2xl border-2 text-left transition-all duration-200 ${E==="public"?"border-delulu-violet bg-delulu-violet/5 shadow-lg scale-[1.02]":"border-gray-200 hover:border-delulu-violet/50 hover:bg-gray-50"}`,children:p.jsxs("div",{className:"flex items-start gap-4",children:[p.jsx("div",{className:`w-14 h-14 rounded-2xl flex items-center justify-center ${E==="public"?"bg-delulu-violet text-white":"bg-gray-100 text-gray-500"}`,children:f!=null&&f.avatarUrl?p.jsx("img",{src:f.avatarUrl,alt:"",className:"w-full h-full rounded-2xl object-cover"}):p.jsx(Ah,{size:24})}),p.jsxs("div",{className:"flex-1",children:[p.jsx("h3",{className:"font-display font-bold text-lg text-delulu-text",children:"ffentlich"}),p.jsxs("p",{className:"text-sm text-delulu-muted mt-1",children:["Du erscheinst als",p.jsxs("span",{className:"font-semibold text-delulu-text ml-1",children:["@",(f==null?void 0:f.username)||"dein_name"]})," ","mit deinem echten Profilbild"]}),p.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[p.jsx(Oc,{size:12,className:"text-amber-600"}),p.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Profil vollstndig sichtbar"})]})]}),E==="public"&&p.jsx("div",{className:"w-6 h-6 rounded-full bg-delulu-violet flex items-center justify-center",children:p.jsx(ci,{size:14,className:"text-white"})})]})}),p.jsxs("label",{className:"flex items-center gap-3 py-3 cursor-pointer",children:[p.jsxs("div",{className:"relative",children:[p.jsx("input",{type:"checkbox",checked:w,onChange:F=>A(F.target.checked),className:"sr-only peer"}),p.jsx("div",{className:"w-10 h-6 bg-gray-200 rounded-full peer-checked:bg-delulu-violet transition-colors"}),p.jsx("div",{className:"absolute top-1 left-1 w-4 h-4 bg-white rounded-full shadow transition-transform peer-checked:translate-x-4"})]}),p.jsx("span",{className:"text-sm text-delulu-muted",children:"Auswahl fr diesen Chat merken (24h)"})]})]}),p.jsxs("div",{className:"p-6 pt-0",children:[p.jsxs("button",{onClick:M,disabled:!E,className:`
              w-full py-4 px-6 rounded-2xl font-bold text-lg
              flex items-center justify-center gap-2
              transition-all duration-200
              ${E?"bg-gradient-to-r from-delulu-violet to-purple-600 text-white shadow-lg hover:shadow-xl hover:scale-[1.02] active:scale-[0.98]":"bg-gray-200 text-gray-400 cursor-not-allowed"}
            `,children:[E==="anonymous"?p.jsxs(p.Fragment,{children:[p.jsx(_l,{size:20}),"Anonym beitreten"]}):E==="public"?p.jsxs(p.Fragment,{children:[p.jsx(Oc,{size:20}),"ffentlich beitreten"]}):"Bitte whlen",E&&p.jsx(_i,{size:20})]}),p.jsx("p",{className:"text-center text-xs text-delulu-muted mt-4",children:"Du kannst deine Identitt jederzeit in den Einstellungen ndern"})]})]})})},hq={nebula:{label:"Verified",labelDe:"Verifiziert",icon:ci,primaryColor:"#8B5CF6",secondaryColor:"#A78BFA",glowColor:"rgba(139, 92, 246, 0.6)",gradient:"from-purple-500 via-violet-500 to-purple-600"},supernova:{label:"Supernova",labelDe:"Supernova",icon:Qi,primaryColor:"#F59E0B",secondaryColor:"#FBBF24",glowColor:"rgba(245, 158, 11, 0.6)",gradient:"from-amber-400 via-yellow-500 to-orange-500"},galaxy:{label:"Galaxy",labelDe:"Galaxie",icon:hl,primaryColor:"#EC4899",secondaryColor:"#F472B6",glowColor:"rgba(236, 72, 153, 0.6)",gradient:"from-pink-500 via-rose-500 to-fuchsia-500"},universe:{label:"Universe",labelDe:"Universum",icon:ul,primaryColor:"#06B6D4",secondaryColor:"#22D3EE",glowColor:"rgba(6, 182, 212, 0.6)",gradient:"from-cyan-400 via-teal-500 to-emerald-500"},founder:{label:"Founder",labelDe:"Grnder",icon:Va,primaryColor:"#FFD700",secondaryColor:"#FFF8DC",glowColor:"rgba(255, 215, 0, 0.8)",gradient:"from-yellow-300 via-amber-400 to-yellow-500"}},_Te={sm:{badge:"w-4 h-4",icon:10,text:"text-[10px]"},md:{badge:"w-5 h-5",icon:12,text:"text-xs"},lg:{badge:"w-6 h-6",icon:14,text:"text-sm"},xl:{badge:"w-8 h-8",icon:18,text:"text-base"}},vf=({tier:s,size:r="md",showLabel:o=!1,animated:l=!0,className:u=""})=>{const f=hq[s],E=_Te[r],T=f.icon;return p.jsxs("div",{className:`inline-flex items-center gap-1.5 ${u}`,children:[p.jsxs("div",{className:"relative",children:[l&&p.jsxs(p.Fragment,{children:[p.jsx("div",{className:`absolute inset-0 ${E.badge} rounded-full opacity-60`,style:{background:`radial-gradient(circle, ${f.glowColor} 0%, transparent 70%)`,animation:"nebulaPulse 2s ease-in-out infinite"}}),p.jsx("div",{className:"absolute inset-[-2px] rounded-full",style:{background:`conic-gradient(from 0deg, ${f.primaryColor}, ${f.secondaryColor}, ${f.primaryColor})`,animation:"nebulaRotate 3s linear infinite",opacity:.4}})]}),p.jsx("div",{className:`relative ${E.badge} rounded-full flex items-center justify-center bg-gradient-to-br ${f.gradient} shadow-lg`,style:{boxShadow:l?`0 0 12px ${f.glowColor}`:"none"},children:p.jsx(T,{size:E.icon,className:"text-white drop-shadow-md",strokeWidth:2.5})}),l&&s!=="nebula"&&p.jsx("div",{className:"absolute inset-0 pointer-events-none",children:[...Array(3)].map((w,A)=>p.jsx("div",{className:"absolute w-1 h-1 bg-white rounded-full opacity-80",style:{top:`${20+A*25}%`,left:`${10+A*30}%`,animation:`sparkle ${1.5+A*.3}s ease-in-out infinite ${A*.2}s`}},A))})]}),o&&p.jsx("span",{className:`font-semibold ${E.text} bg-gradient-to-r ${f.gradient} bg-clip-text text-transparent`,children:f.label}),p.jsx("style",{children:`
        @keyframes nebulaPulse {
          0%, 100% { transform: scale(1); opacity: 0.6; }
          50% { transform: scale(1.4); opacity: 0.3; }
        }

        @keyframes nebulaRotate {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }

        @keyframes sparkle {
          0%, 100% { opacity: 0; transform: scale(0); }
          50% { opacity: 1; transform: scale(1); }
        }
      `})]})},ETe=({tier:s,children:r,intensity:o="normal",className:l=""})=>{const u=hq[s],f={subtle:{blur:"20px",opacity:.3},normal:{blur:"30px",opacity:.5},intense:{blur:"40px",opacity:.7}},{blur:E,opacity:T}=f[o];return p.jsxs("div",{className:`relative ${l}`,children:[p.jsx("div",{className:"absolute inset-[-10px] rounded-full pointer-events-none",style:{background:`radial-gradient(circle, ${u.glowColor} 0%, transparent 70%)`,filter:`blur(${E})`,opacity:T,animation:"auraBreath 3s ease-in-out infinite"}}),p.jsx("div",{className:"relative z-10",children:r}),p.jsx("style",{children:`
        @keyframes auraBreath {
          0%, 100% { transform: scale(1); opacity: ${T}; }
          50% { transform: scale(1.1); opacity: ${T*.6}; }
        }
      `})]})},vTe={influencer:{en:"Influencer",de:"Influencer",emoji:""},entrepreneur:{en:"Entrepreneur",de:"Unternehmer",emoji:""},artist:{en:"Artist",de:"Knstler",emoji:""},athlete:{en:"Athlete",de:"Sportler",emoji:""},musician:{en:"Musician",de:"Musiker",emoji:""},actor:{en:"Actor",de:"Schauspieler",emoji:""},journalist:{en:"Journalist",de:"Journalist",emoji:""},politician:{en:"Politician",de:"Politiker",emoji:""},scientist:{en:"Scientist",de:"Wissenschaftler",emoji:""},creator:{en:"Creator",de:"Creator",emoji:""},other:{en:"Public Figure",de:"Persnlichkeit",emoji:""}},pq=({category:s,size:r="md"})=>{const o=vTe[s];return p.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-gray-800/60 border border-gray-700/50 ${r==="sm"?"text-[10px]":"text-xs"}`,children:[p.jsx("span",{children:o.emoji}),p.jsx("span",{className:"text-gray-300",children:o.de})]})},o8={de:"Wanderer",en:"Wanderer",es:"Caminante",fr:"Voyageur",pt:"Andarilho"},yTe=()=>{var $,le,ue;const s=ei(),{user:r,isVerifiedStar:o}=vi(),{location:l}=hTe(),{language:u}=Of(),[f,E]=ce.useState((r==null?void 0:r.isGlobalAnonymous)||!1),[T,w]=ce.useState(!1),[A,U]=ce.useState(!1),[M,F]=ce.useState(0),[Y,J]=ce.useState(0),[ae,he]=ce.useState([]),[ee,W]=ce.useState(0);ce.useEffect(()=>{if(!l){J(0);return}const ie=Zr(Qt,"users"),tt=qo(ie,ds("isActive","==",!0),ds("lastSeen",">",new Date(Date.now()-5*60*1e3))),Ot=gl(tt,on=>{const It=on.docs.filter(Ge=>{const nt=Ge.data();if(!nt.location||Ge.id===(r==null?void 0:r.id))return!1;const pt=l.latitude,ot=l.longitude,Et=nt.location.latitude,un=nt.location.longitude;if(!Et||!un)return!1;const In=6371e3,zn=(Et-pt)*Math.PI/180,Sr=(un-ot)*Math.PI/180,Je=Math.sin(zn/2)*Math.sin(zn/2)+Math.cos(pt*Math.PI/180)*Math.cos(Et*Math.PI/180)*Math.sin(Sr/2)*Math.sin(Sr/2),Kt=2*Math.atan2(Math.sqrt(Je),Math.sqrt(1-Je));return In*Kt<=500});J(It.length)},on=>{console.error("Error fetching nearby users:",on),J(0)});return()=>Ot()},[l,r==null?void 0:r.id]),ce.useEffect(()=>{const ie=Zr(Qt,"starEvents"),tt=qo(ie,ds("isLive","==",!0),G7("startedAt","desc"),Rye(10)),Ot=gl(tt,on=>{const It=on.docs.map(Ge=>{var pt;const nt=Ge.data();return{id:Ge.id,type:"star_live",title:`${nt.hostDisplayName} ist LIVE`,subtitle:nt.title,starId:nt.hostId,starUsername:nt.hostUsername,starTier:nt.hostTier||"nebula",eventId:Ge.id,priority:10,createdAt:((pt=nt.startedAt)==null?void 0:pt.toDate())||new Date,expiresAt:new Date(Date.now()+36e5)}});he(It)},on=>{console.error("Error fetching live events:",on),he([])});return()=>Ot()},[]),ce.useEffect(()=>{if(!(r!=null&&r.id)){W(0);return}const ie=Zr(Qt,"notifications"),tt=qo(ie,ds("userId","==",r.id),ds("read","==",!1)),Ot=gl(tt,on=>{W(on.size)},()=>{W(0)});return()=>Ot()},[r==null?void 0:r.id]),ce.useEffect(()=>{if(ae.length<=1)return;const ie=setInterval(()=>{F(tt=>(tt+1)%ae.length)},4e3);return()=>clearInterval(ie)},[ae.length]);const Z=(r==null?void 0:r.level)||1,fe=(r==null?void 0:r.currentStreak)||0,pe=ck(Z),Ce=bR(fe),te=()=>f?o8[u]||o8.de:(r==null?void 0:r.username)||(r==null?void 0:r.displayName)||"du",q=async()=>{if(Y===0){alert("Aktuell ist niemand in deiner Nhe aktiv. Versuch es spter nochmal!");return}U(!0),"vibrate"in navigator&&navigator.vibrate([20,10,30]),await new Promise(ie=>setTimeout(ie,1500)),U(!1),w(!0)},re=ie=>{console.log("Joining voice chat as:",ie),w(!1),s("/discover",{state:{joinRoom:!0,mode:ie}}),"vibrate"in navigator&&navigator.vibrate([30,20,50])};return p.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white safe-top pb-24",children:[p.jsxs("div",{className:"px-6 pt-6 pb-4",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx(mTe,{onToggle:E}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsxs("button",{onClick:()=>s("/notifications"),className:"relative w-10 h-10 rounded-xl bg-white shadow-sm flex items-center justify-center text-delulu-muted hover:text-delulu-violet transition-colors",children:[p.jsx(Kd,{size:20}),ee>0&&p.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center",children:ee>9?"9+":ee})]}),p.jsx("button",{onClick:()=>s("/settings"),className:"w-10 h-10 rounded-xl bg-white shadow-sm flex items-center justify-center text-delulu-muted hover:text-delulu-violet transition-colors",children:p.jsx(eTe,{size:20})})]})]}),p.jsxs("div",{className:"mt-4",children:[p.jsx("h1",{className:"font-display text-2xl font-bold text-delulu-text",children:f?p.jsxs(p.Fragment,{children:["Hallo, ",te()," "]}):p.jsxs(p.Fragment,{children:["Hey @",te(),"! "]})}),p.jsxs("p",{className:"text-sm text-delulu-muted flex items-center gap-2",children:[p.jsxs("span",{children:[pe.emoji," Level ",Z]}),Ce>1&&p.jsxs("span",{className:"text-amber-500 font-semibold",children:[" ",Ce,"x XP"]})]})]})]}),fe>=2&&p.jsx("div",{className:"px-6 mb-4",children:p.jsx(fTe,{currentStreak:fe,longestStreak:(r==null?void 0:r.longestStreak)||fe,canClaim:!1})}),ae.length>0&&p.jsx("div",{className:"px-6 mb-4",children:p.jsx("button",{onClick:()=>s("/discover",{state:{filter:"stars"}}),className:"w-full overflow-hidden",children:p.jsxs("div",{className:"relative bg-gradient-to-r from-purple-900/80 to-pink-900/80 rounded-2xl p-3 border border-purple-500/30",children:[p.jsx("div",{className:"absolute inset-0 opacity-30",children:p.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_top_left,_var(--tw-gradient-stops))] from-purple-500/40 via-transparent to-transparent animate-pulse"})}),p.jsxs("div",{className:"relative flex items-center gap-3",children:[p.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-red-500/20 rounded-full",children:[p.jsxs("div",{className:"relative",children:[p.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-ping absolute"}),p.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full relative"})]}),p.jsx("span",{className:"text-[10px] font-bold text-red-400",children:"LIVE"})]}),p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(vf,{tier:(($=ae[M])==null?void 0:$.starTier)||"nebula",size:"sm",animated:!1}),p.jsx("p",{className:"text-sm font-semibold text-white truncate",children:(le=ae[M])==null?void 0:le.title})]}),p.jsx("p",{className:"text-xs text-gray-400 truncate",children:(ue=ae[M])==null?void 0:ue.subtitle})]}),p.jsx(_i,{size:20,className:"text-gray-400 flex-shrink-0"})]}),ae.length>1&&p.jsx("div",{className:"absolute bottom-1.5 left-1/2 -translate-x-1/2 flex gap-1",children:ae.map((ie,tt)=>p.jsx("div",{className:`w-1 h-1 rounded-full transition-all ${tt===M?"bg-purple-400 w-3":"bg-gray-600"}`},tt))})]})})}),o&&p.jsx("div",{className:"px-6 mb-4",children:p.jsx("button",{onClick:()=>s("/stars/dashboard"),className:"w-full bg-gradient-to-r from-amber-500/20 to-orange-500/20 border border-amber-500/30 rounded-2xl p-4 text-left",children:p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center",children:p.jsx(Ib,{size:24,className:"text-white"})}),p.jsxs("div",{className:"flex-1",children:[p.jsx("h3",{className:"font-semibold text-white",children:"Dein Star Dashboard"}),p.jsx("p",{className:"text-xs text-gray-400",children:"Analytics, Events & mehr"})]}),p.jsx(_i,{size:20,className:"text-gray-500"})]})})}),p.jsx("div",{className:"px-6 mb-6",children:p.jsxs("div",{className:"flex items-center justify-between bg-white rounded-2xl p-3 shadow-sm",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${l?Y>0?"bg-green-100":"bg-gray-100":"bg-orange-100"}`,children:l?Y>0?p.jsx(uq,{size:18,className:"text-green-600"}):p.jsx(TR,{size:18,className:"text-gray-400"}):p.jsx(dq,{size:18,className:"text-orange-600"})}),p.jsxs("div",{children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{className:"font-semibold text-sm text-delulu-text",children:l?Y>0?"Cloud aktiv":"Keine Aktivitt":"Verbinde..."}),l&&Y>0&&p.jsxs("div",{className:"flex items-center gap-1 text-green-500",children:[p.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),p.jsx("span",{className:"text-[10px] font-semibold",children:"LIVE"})]})]}),p.jsx("p",{className:"text-[11px] text-delulu-muted",children:l?Y===0?"Niemand in deiner Nhe aktiv":`${Y} aktive${Y===1?"r User":" User"} in deiner Nhe`:"Standort wird ermittelt..."})]})]}),p.jsxs("button",{onClick:()=>s("/statistics"),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-xl bg-delulu-violet/10 text-delulu-violet hover:bg-delulu-violet/20 transition-colors",children:[p.jsx(Ab,{size:14}),p.jsx("span",{className:"text-xs font-semibold",children:"Stats"})]})]})}),p.jsx("div",{className:"px-6 mb-6",children:p.jsxs("button",{onClick:q,disabled:A||!l,className:"relative w-full aspect-square max-w-[320px] mx-auto group",children:[p.jsx("div",{className:`absolute inset-0 rounded-full transition-colors ${Y>0?"bg-gradient-to-br from-delulu-violet/20 to-purple-300/20 animate-pulse":"bg-gradient-to-br from-gray-200/50 to-gray-300/50"}`}),p.jsxs("div",{className:`absolute inset-4 rounded-full shadow-2xl flex flex-col items-center justify-center transition-all duration-300 ${Y>0?"bg-gradient-to-br from-delulu-violet to-purple-600 shadow-delulu-violet/40":"bg-gradient-to-br from-gray-400 to-gray-500 shadow-gray-400/40"} ${A?"scale-95":"group-hover:scale-[1.02] group-active:scale-95"}`,children:[A?p.jsx(ws,{size:64,className:"text-white/90 animate-spin"}):Y>0?p.jsx(Rb,{size:64,className:"text-white/90 group-hover:scale-110 transition-transform"}):p.jsx(FSe,{size:64,className:"text-white/60"}),p.jsx("p",{className:"text-white font-display text-xl font-bold mt-4",children:A?"Suche...":Y>0?"In die Wolke":"Niemand da"}),p.jsx("p",{className:"text-white/70 text-sm mt-1",children:A?"Finde aktiven Raum":Y>0?"Tippe zum Starten":"Versuch es spter nochmal"}),p.jsxs("div",{className:`absolute bottom-8 flex items-center gap-2 backdrop-blur-sm px-4 py-2 rounded-full ${Y>0?"bg-white/20":"bg-black/20"}`,children:[p.jsx(ai,{size:16,className:"text-white"}),p.jsxs("span",{className:"text-white text-sm font-semibold",children:[Y," online"]})]})]}),Y>0&&p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"absolute top-8 left-12 w-3 h-3 bg-white/40 rounded-full animate-bounce",style:{animationDelay:"0s"}}),p.jsx("div",{className:"absolute top-16 right-16 w-2 h-2 bg-white/30 rounded-full animate-bounce",style:{animationDelay:"0.5s"}}),p.jsx("div",{className:"absolute bottom-20 left-8 w-4 h-4 bg-white/20 rounded-full animate-bounce",style:{animationDelay:"1s"}}),p.jsx("div",{className:"absolute bottom-12 right-12 w-2 h-2 bg-white/40 rounded-full animate-bounce",style:{animationDelay:"0.3s"}})]})]})}),p.jsx("div",{className:"px-6 mb-6",children:p.jsxs("div",{className:"bg-gradient-to-r from-delulu-violet/10 to-purple-100 rounded-2xl p-4 flex items-center gap-4",children:[p.jsx(ci,{size:24,className:"text-delulu-violet flex-shrink-0"}),p.jsxs("div",{children:[p.jsx("p",{className:"font-semibold text-delulu-text text-sm",children:Y>0?"Zuflliger Voice-Chat":"Noch keine Aktivitt"}),p.jsx("p",{className:"text-xs text-delulu-muted",children:Y>0?"Du wirst automatisch mit jemandem in der Nhe verbunden":"Sei der Erste in deiner Nhe und starte eine Session!"})]})]})}),p.jsx("div",{className:"px-6 mb-4",children:p.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[p.jsxs("div",{className:"bg-white rounded-2xl p-4 text-center shadow-sm",children:[p.jsx("p",{className:"font-display text-2xl font-bold gradient-text",children:Z}),p.jsx("p",{className:"text-[10px] text-delulu-muted",children:"Level"})]}),p.jsxs("div",{className:"bg-white rounded-2xl p-4 text-center shadow-sm",children:[p.jsx("p",{className:"font-display text-2xl font-bold text-amber-500",children:(r==null?void 0:r.xp)||0}),p.jsx("p",{className:"text-[10px] text-delulu-muted",children:"XP"})]}),p.jsxs("div",{className:"bg-white rounded-2xl p-4 text-center shadow-sm",children:[p.jsx("p",{className:"font-display text-2xl font-bold text-green-600",children:(r==null?void 0:r.totalStarsReceived)||0}),p.jsx("p",{className:"text-[10px] text-delulu-muted",children:"Sterne"})]})]})}),!(r!=null&&r.isPremium)&&p.jsx("div",{className:"px-6 mb-4",children:p.jsxs("button",{onClick:()=>s("/premium"),className:"relative w-full overflow-hidden bg-gradient-to-r from-amber-400 via-orange-500 to-amber-500 rounded-2xl p-5 shadow-lg text-left",children:[p.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full animate-shimmer"}),p.jsxs("div",{className:"relative flex items-center gap-4",children:[p.jsx("div",{className:"w-14 h-14 rounded-2xl bg-white/20 backdrop-blur flex items-center justify-center",children:p.jsx(ul,{size:28,className:"text-white"})}),p.jsxs("div",{className:"flex-1",children:[p.jsx("h3",{className:"font-display font-bold text-white text-lg",children:"Catalyst Premium"}),p.jsx("p",{className:"text-white/80 text-sm",children:"1.5x XP  Unbegrenzte Sterne  Profilbesucher"})]})]})]})}),p.jsx(gTe,{isOpen:T,onClose:()=>w(!1),onChoose:re,chatType:"voice",targetName:"zuflligen Raum"})]})};var mq={exports:{}};(function(s,r){(function(o,l){s.exports=l()})(VT,function(){function o(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in e)){var a=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(e,i,a.get?a:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(e)}var l=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof VT<"u"?VT:typeof self<"u"?self:{};function u(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var f=function(e){try{return!!e()}catch{return!0}},E=!f(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),T=E,w=Function.prototype,A=w.call,U=T&&w.bind.bind(A,A),M=T?U:function(e){return function(){return A.apply(e,arguments)}},F=M({}.isPrototypeOf),Y=function(e){return e&&e.Math===Math&&e},J=Y(typeof globalThis=="object"&&globalThis)||Y(typeof window=="object"&&window)||Y(typeof self=="object"&&self)||Y(typeof l=="object"&&l)||Y(typeof l=="object"&&l)||function(){return this}()||Function("return this")(),ae=E,he=Function.prototype,ee=he.apply,W=he.call,Z=typeof Reflect=="object"&&Reflect.apply||(ae?W.bind(ee):function(){return W.apply(ee,arguments)}),fe=M,pe=fe({}.toString),Ce=fe("".slice),te=function(e){return Ce(pe(e),8,-1)},q=te,re=M,$=function(e){if(q(e)==="Function")return re(e)},le=typeof document=="object"&&document.all,ue=le===void 0&&le!==void 0?function(e){return typeof e=="function"||e===le}:function(e){return typeof e=="function"},ie={},tt=!f(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),Ot=E,on=Function.prototype.call,It=Ot?on.bind(on):function(){return on.apply(on,arguments)},Ge={},nt={}.propertyIsEnumerable,pt=Object.getOwnPropertyDescriptor,ot=pt&&!nt.call({1:2},1);Ge.f=ot?function(e){var t=pt(this,e);return!!t&&t.enumerable}:nt;var Et,un,In=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},zn=f,Sr=te,Je=Object,Kt=M("".split),lr=zn(function(){return!Je("z").propertyIsEnumerable(0)})?function(e){return Sr(e)==="String"?Kt(e,""):Je(e)}:Je,Qn=function(e){return e==null},ms=Qn,it=TypeError,$n=function(e){if(ms(e))throw new it("Can't call method on "+e);return e},$s=lr,xe=$n,_t=function(e){return $s(xe(e))},Ln=ue,kt=function(e){return typeof e=="object"?e!==null:Ln(e)},qt={},Rt=qt,ki=J,di=ue,fs=function(e){return di(e)?e:void 0},Tr=function(e,t){return arguments.length<2?fs(Rt[e])||fs(ki[e]):Rt[e]&&Rt[e][t]||ki[e]&&ki[e][t]},Pf=J.navigator,ui=Pf&&Pf.userAgent,ur=ui?String(ui):"",cu=J,qh=ur,Df=cu.process,rv=cu.Deno,kl=Df&&Df.versions||rv&&rv.version,kf=kl&&kl.v8;kf&&(un=(Et=kf.split("."))[0]>0&&Et[0]<4?1:+(Et[0]+Et[1])),!un&&qh&&(!(Et=qh.match(/Edge\/(\d+)/))||Et[1]>=74)&&(Et=qh.match(/Chrome\/(\d+)/))&&(un=+Et[1]);var Ga=un,Yh=Ga,RR=f,wR=J.String,Wa=!!Object.getOwnPropertySymbols&&!RR(function(){var e=Symbol("symbol detection");return!wR(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Yh&&Yh<41}),Lf=Wa&&!Symbol.sham&&typeof Symbol.iterator=="symbol",iv=Tr,lu=ue,Mf=F,Uf=Object,Zs=Lf?function(e){return typeof e=="symbol"}:function(e){var t=iv("Symbol");return lu(t)&&Mf(t.prototype,Uf(e))},sv=String,ea=function(e){try{return sv(e)}catch{return"Object"}},ov=ue,du=ea,av=TypeError,jn=function(e){if(ov(e))return e;throw new av(du(e)+" is not a function")},cv=jn,uu=Qn,ta=function(e,t){var n=e[t];return uu(n)?void 0:cv(n)},lv=It,dv=ue,kc=kt,CR=TypeError,uv={exports:{}},hu=J,hv=Object.defineProperty,jf=J,Xh=function(e,t){try{hv(hu,e,{value:t,configurable:!0,writable:!0})}catch{hu[e]=t}return t},na="__core-js_shared__",Vf=uv.exports=jf[na]||Xh(na,{});(Vf.versions||(Vf.versions=[])).push({version:"3.46.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.46.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Jh=uv.exports,Qh=Jh,za=function(e,t){return Qh[e]||(Qh[e]=t||{})},pv=$n,mv=Object,bo=function(e){return mv(pv(e))},$h=bo,fv=M({}.hasOwnProperty),br=Object.hasOwn||function(e,t){return fv($h(e),t)},pu=M,Lc=0,Ff=Math.random(),IR=pu(1.1.toString),Zh=function(e){return"Symbol("+(e===void 0?"":e)+")_"+IR(++Lc+Ff,36)},gv=za,Bf=br,Gf=Zh,Wf=Wa,_v=Lf,Mc=J.Symbol,zf=gv("wks"),AR=_v?Mc.for||Mc:Mc&&Mc.withoutSetter||Gf,Mn=function(e){return Bf(zf,e)||(zf[e]=Wf&&Bf(Mc,e)?Mc[e]:AR("Symbol."+e)),zf[e]},Ev=It,vv=kt,Ha=Zs,ra=ta,ep=function(e,t){var n,i;if(dv(n=e.toString)&&!kc(i=lv(n,e))||dv(n=e.valueOf)&&!kc(i=lv(n,e)))return i;throw new CR("Can't convert object to primitive value")},tp=TypeError,yv=Mn("toPrimitive"),rr=function(e,t){if(!vv(e)||Ha(e))return e;var n,i=ra(e,yv);if(i){if(n=Ev(i,e,t),!vv(n)||Ha(n))return n;throw new tp("Can't convert object to primitive value")}return ep(e)},np=Zs,Uc=function(e){var t=rr(e,"string");return np(t)?t:t+""},Ll=kt,Hf=J.document,Sv=Ll(Hf)&&Ll(Hf.createElement),Kf=function(e){return Sv?Hf.createElement(e):{}},NR=Kf,Tv=!tt&&!f(function(){return Object.defineProperty(NR("div"),"a",{get:function(){return 7}}).a!==7}),xR=tt,mu=It,Ka=Ge,bv=In,Rv=_t,wv=Uc,Ml=br,OR=Tv,Cv=Object.getOwnPropertyDescriptor;ie.f=xR?Cv:function(e,t){if(e=Rv(e),t=wv(t),OR)try{return Cv(e,t)}catch{}if(Ml(e,t))return bv(!mu(Ka.f,e,t),e[t])};var PR=f,qa=ue,DR=/#|\.prototype\./,fu=function(e,t){var n=ip[rp(e)];return n===gu||n!==Iv&&(qa(t)?PR(t):!!t)},rp=fu.normalize=function(e){return String(e).replace(DR,".").toLowerCase()},ip=fu.data={},Iv=fu.NATIVE="N",gu=fu.POLYFILL="P",Ul=fu,Av=jn,qf=E,Rr=$($.bind),Ya=function(e,t){return Av(e),t===void 0?e:qf?Rr(e,t):function(){return e.apply(t,arguments)}},xs={},Yf=tt&&f(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),Nv=kt,xv=String,sp=TypeError,yi=function(e){if(Nv(e))return e;throw new sp(xv(e)+" is not an object")},ia=tt,Ov=Tv,kR=Yf,Xa=yi,Xf=Uc,Jf=TypeError,jl=Object.defineProperty,Pv=Object.getOwnPropertyDescriptor,Vl="enumerable",Qf="configurable",op="writable";xs.f=ia?kR?function(e,t,n){if(Xa(e),t=Xf(t),Xa(n),typeof e=="function"&&t==="prototype"&&"value"in n&&op in n&&!n[op]){var i=Pv(e,t);i&&i[op]&&(e[t]=n.value,n={configurable:Qf in n?n[Qf]:i[Qf],enumerable:Vl in n?n[Vl]:i[Vl],writable:!1})}return jl(e,t,n)}:jl:function(e,t,n){if(Xa(e),t=Xf(t),Xa(n),Ov)try{return jl(e,t,n)}catch{}if("get"in n||"set"in n)throw new Jf("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var _u=xs,Dv=In,Ja=tt?function(e,t,n){return _u.f(e,t,Dv(1,n))}:function(e,t,n){return e[t]=n,e},jc=J,$f=Z,kv=$,ap=ue,Lv=ie.f,Mv=Ul,Os=qt,Uv=Ya,Vc=Ja,Zf=br,jv=function(e){var t=function(n,i,a){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,i)}return new e(n,i,a)}return $f(e,this,arguments)};return t.prototype=e.prototype,t},Lt=function(e,t){var n,i,a,c,d,h,m,g,_,v=e.target,y=e.global,b=e.stat,O=e.proto,I=y?jc:b?jc[v]:jc[v]&&jc[v].prototype,N=y?Os:Os[v]||Vc(Os,v,{})[v],k=N.prototype;for(c in t)i=!(n=Mv(y?c:v+(b?".":"#")+c,e.forced))&&I&&Zf(I,c),h=N[c],i&&(m=e.dontCallGetSet?(_=Lv(I,c))&&_.value:I[c]),d=i&&m?m:t[c],(n||O||typeof h!=typeof d)&&(g=e.bind&&i?Uv(d,jc):e.wrap&&i?jv(d):O&&ap(d)?kv(d):d,(e.sham||d&&d.sham||h&&h.sham)&&Vc(g,"sham",!0),Vc(N,c,g),O&&(Zf(Os,a=v+"Prototype")||Vc(Os,a,{}),Vc(Os[a],c,d),e.real&&k&&(n||!k[c])&&Vc(k,c,d)))},gs=Math.ceil,Vv=Math.floor,Fv=Math.trunc||function(e){var t=+e;return(t>0?Vv:gs)(t)},Fl=Fv,S=function(e){var t=+e;return t!=t||t===0?0:Fl(t)},P=S,V=Math.max,Q=Math.min,Te=function(e,t){var n=P(e);return n<0?V(n+t,0):Q(n,t)},Ne=S,Ye=Math.min,Vn=function(e){var t=Ne(e);return t>0?Ye(t,9007199254740991):0},hi=Vn,an=function(e){return hi(e.length)},Si=_t,Ti=Te,Bl=an,Ps=function(e){return function(t,n,i){var a=Si(t),c=Bl(a);if(c===0)return!e&&-1;var d,h=Ti(i,c);if(e&&n!=n){for(;c>h;)if((d=a[h++])!=d)return!0}else for(;c>h;h++)if((e||h in a)&&a[h]===n)return e||h||0;return!e&&-1}},Gl={includes:Ps(!0),indexOf:Ps(!1)},eg=Gl.includes;Lt({target:"Array",proto:!0,forced:f(function(){return!Array(1).includes()})},{includes:function(e){return eg(this,e,arguments.length>1?arguments[1]:void 0)}});var _q=J,Eq=qt,eo=function(e,t){var n=Eq[e+"Prototype"],i=n&&n[t];if(i)return i;var a=_q[e],c=a&&a.prototype;return c&&c[t]},vq=eo("Array","includes"),yq=kt,Sq=te,Tq=Mn("match"),LR=function(e){var t;return yq(e)&&((t=e[Tq])!==void 0?!!t:Sq(e)==="RegExp")},bq=LR,Rq=TypeError,lk={};lk[Mn("toStringTag")]="z";var MR=String(lk)==="[object z]",wq=MR,Cq=ue,Bv=te,Iq=Mn("toStringTag"),Aq=Object,Nq=Bv(function(){return arguments}())==="Arguments",Wl=wq?Bv:function(e){var t,n,i;return e===void 0?"Undefined":e===null?"Null":typeof(n=function(a,c){try{return a[c]}catch{}}(t=Aq(e),Iq))=="string"?n:Nq?Bv(t):(i=Bv(t))==="Object"&&Cq(t.callee)?"Arguments":i},xq=Wl,Oq=String,_s=function(e){if(xq(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return Oq(e)},Pq=Mn("match"),Dq=Lt,kq=function(e){if(bq(e))throw new Rq("The method doesn't accept regular expressions");return e},Lq=$n,dk=_s,Mq=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[Pq]=!1,"/./"[e](t)}catch{}}return!1},Uq=M("".indexOf);Dq({target:"String",proto:!0,forced:!Mq("includes")},{includes:function(e){return!!~Uq(dk(Lq(this)),dk(kq(e)),arguments.length>1?arguments[1]:void 0)}});var jq=eo("String","includes"),uk=F,Vq=vq,Fq=jq,UR=Array.prototype,jR=String.prototype,Bq=function(e){var t=e.includes;return e===UR||uk(UR,e)&&t===UR.includes?Vq:typeof e=="string"||e===jR||uk(jR,e)&&t===jR.includes?Fq:t},ve=u(Bq),Gq=jn,Wq=bo,zq=lr,Hq=an,hk=TypeError,pk="Reduce of empty array with no initial value",Kq=function(e){return function(t,n,i,a){var c=Wq(t),d=zq(c),h=Hq(c);if(Gq(n),h===0&&i<2)throw new hk(pk);var m=e?h-1:0,g=e?-1:1;if(i<2)for(;;){if(m in d){a=d[m],m+=g;break}if(m+=g,e?m<0:h<=m)throw new hk(pk)}for(;e?m>=0:h>m;m+=g)m in d&&(a=n(a,d[m],m,c));return a}},qq={left:Kq(!1)},Yq=f,Gv=function(e,t){var n=[][e];return!!n&&Yq(function(){n.call(null,t||function(){return 1},1)})},tg=J,Xq=ur,Jq=te,Wv=function(e){return Xq.slice(0,e.length)===e},VR=Wv("Bun/")?"BUN":Wv("Cloudflare-Workers")?"CLOUDFLARE":Wv("Deno/")?"DENO":Wv("Node.js/")?"NODE":tg.Bun&&typeof Bun.version=="string"?"BUN":tg.Deno&&typeof Deno.version=="object"?"DENO":Jq(tg.process)==="process"?"NODE":tg.window&&tg.document?"BROWSER":"REST",zv=VR==="NODE",Qq=qq.left;Lt({target:"Array",proto:!0,forced:!zv&&Ga>79&&Ga<83||!Gv("reduce")},{reduce:function(e){var t=arguments.length;return Qq(this,e,t,t>1?arguments[1]:void 0)}});var $q=eo("Array","reduce"),Zq=F,eY=$q,FR=Array.prototype,tY=function(e){var t=e.reduce;return e===FR||Zq(FR,e)&&t===FR.reduce?eY:t},mk=tY,to=u(mk),nY=te,ng=Array.isArray||function(e){return nY(e)==="Array"},rY=Lt,iY=ng,sY=M([].reverse),fk=[1,2];rY({target:"Array",proto:!0,forced:String(fk)===String(fk.reverse())},{reverse:function(){return iY(this)&&(this.length=this.length),sY(this)}});var oY=eo("Array","reverse"),aY=F,cY=oY,BR=Array.prototype,lY=function(e){var t=e.reverse;return e===BR||aY(BR,e)&&t===BR.reverse?cY:t},gk=lY,_k=u(gk),dY=Zh,Ek=za("keys"),Hv=function(e){return Ek[e]||(Ek[e]=dY(e))},uY=!f(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),hY=br,pY=ue,mY=bo,fY=uY,vk=Hv("IE_PROTO"),GR=Object,gY=GR.prototype,WR=fY?GR.getPrototypeOf:function(e){var t=mY(e);if(hY(t,vk))return t[vk];var n=t.constructor;return pY(n)&&t instanceof n?n.prototype:t instanceof GR?gY:null},_Y=M,EY=jn,vY=kt,yY=function(e){return vY(e)||e===null},SY=String,TY=TypeError,bY=function(e,t,n){try{return _Y(EY(Object.getOwnPropertyDescriptor(e,t)[n]))}catch{}},RY=kt,wY=$n,CY=function(e){if(yY(e))return e;throw new TY("Can't set "+SY(e)+" as a prototype")},IY=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=bY(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(i,a){return wY(i),CY(a),RY(i)&&(t?e(i,a):i.__proto__=a),i}}():void 0),Kv={},qv={},zR=br,AY=_t,NY=Gl.indexOf,xY=qv,yk=M([].push),Sk=function(e,t){var n,i=AY(e),a=0,c=[];for(n in i)!zR(xY,n)&&zR(i,n)&&yk(c,n);for(;t.length>a;)zR(i,n=t[a++])&&(~NY(c,n)||yk(c,n));return c},HR=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],OY=Sk,PY=HR.concat("length","prototype");Kv.f=Object.getOwnPropertyNames||function(e){return OY(e,PY)};var rg={};rg.f=Object.getOwnPropertySymbols;var DY=Tr,kY=Kv,LY=rg,MY=yi,UY=M([].concat),jY=DY("Reflect","ownKeys")||function(e){var t=kY.f(MY(e)),n=LY.f;return n?UY(t,n(e)):t},Tk=br,VY=jY,FY=ie,BY=xs,KR={},GY=Sk,WY=HR,Yv=Object.keys||function(e){return GY(e,WY)},zY=tt,HY=Yf,KY=xs,qY=yi,YY=_t,XY=Yv;KR.f=zY&&!HY?Object.defineProperties:function(e,t){qY(e);for(var n,i=YY(t),a=XY(t),c=a.length,d=0;c>d;)KY.f(e,n=a[d++],i[n]);return e};var Xv,bk=Tr("document","documentElement"),JY=yi,QY=KR,Rk=HR,$Y=qv,ZY=bk,eX=Kf,qR="prototype",YR="script",wk=Hv("IE_PROTO"),XR=function(){},Ck=function(e){return"<"+YR+">"+e+"</"+YR+">"},Ik=function(e){e.write(Ck("")),e.close();var t=e.parentWindow.Object;return e=null,t},Jv=function(){try{Xv=new ActiveXObject("htmlfile")}catch{}var e,t,n;Jv=typeof document<"u"?document.domain&&Xv?Ik(Xv):(t=eX("iframe"),n="java"+YR+":",t.style.display="none",ZY.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(Ck("document.F=Object")),e.close(),e.F):Ik(Xv);for(var i=Rk.length;i--;)delete Jv[qR][Rk[i]];return Jv()};$Y[wk]=!0;var ig=Object.create||function(e,t){var n;return e!==null?(XR[qR]=JY(e),n=new XR,XR[qR]=null,n[wk]=e):n=Jv(),t===void 0?n:QY.f(n,t)},tX=kt,nX=Ja,Ak=Error,rX=M("".replace),iX=String(new Ak("zxcasd").stack),Nk=/\n\s*at [^:]*:[^\n]*/,sX=Nk.test(iX),oX=In,aX=!f(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",oX(1,7)),e.stack!==7)}),cX=Ja,lX=function(e,t){if(sX&&typeof e=="string"&&!Ak.prepareStackTrace)for(;t--;)e=rX(e,Nk,"");return e},dX=aX,xk=Error.captureStackTrace,cp={},uX=cp,hX=Mn("iterator"),pX=Array.prototype,Ok=function(e){return e!==void 0&&(uX.Array===e||pX[hX]===e)},mX=Wl,Pk=ta,fX=Qn,gX=cp,_X=Mn("iterator"),Qv=function(e){if(!fX(e))return Pk(e,_X)||Pk(e,"@@iterator")||gX[mX(e)]},EX=It,vX=jn,yX=yi,SX=ea,TX=Qv,bX=TypeError,JR=function(e,t){var n=arguments.length<2?TX(e):t;if(vX(n))return yX(EX(n,e));throw new bX(SX(e)+" is not iterable")},RX=It,Dk=yi,wX=ta,kk=function(e,t,n){var i,a;Dk(e);try{if(!(i=wX(e,"return"))){if(t==="throw")throw n;return n}i=RX(i,e)}catch(c){a=!0,i=c}if(t==="throw")throw n;if(a)throw i;return Dk(i),n},CX=Ya,IX=It,AX=yi,NX=ea,xX=Ok,OX=an,Lk=F,PX=JR,DX=Qv,Mk=kk,kX=TypeError,$v=function(e,t){this.stopped=e,this.result=t},Uk=$v.prototype,sg=function(e,t,n){var i,a,c,d,h,m,g,_=n&&n.that,v=!(!n||!n.AS_ENTRIES),y=!(!n||!n.IS_RECORD),b=!(!n||!n.IS_ITERATOR),O=!(!n||!n.INTERRUPTED),I=CX(t,_),N=function(j){return i&&Mk(i,"normal"),new $v(!0,j)},k=function(j){return v?(AX(j),O?I(j[0],j[1],N):I(j[0],j[1])):O?I(j,N):I(j)};if(y)i=e.iterator;else if(b)i=e;else{if(!(a=DX(e)))throw new kX(NX(e)+" is not iterable");if(xX(a)){for(c=0,d=OX(e);d>c;c++)if((h=k(e[c]))&&Lk(Uk,h))return h;return new $v(!1)}i=PX(e,a)}for(m=y?e.next:i.next;!(g=IX(m,i)).done;){try{h=k(g.value)}catch(j){Mk(i,"throw",j)}if(typeof h=="object"&&h&&Lk(Uk,h))return h}return new $v(!1)},LX=_s,MX=Lt,UX=F,jX=WR,Zv=IY,VX=function(e,t,n){for(var i=VY(t),a=BY.f,c=FY.f,d=0;d<i.length;d++){var h=i[d];Tk(e,h)||n&&Tk(n,h)||a(e,h,c(t,h))}},jk=ig,QR=Ja,$R=In,FX=function(e,t){tX(t)&&"cause"in t&&nX(e,"cause",t.cause)},BX=function(e,t,n,i){dX&&(xk?xk(e,t):cX(e,"stack",lX(n,i)))},GX=sg,WX=function(e,t){return e===void 0?arguments.length<2?"":t:LX(e)},zX=Mn("toStringTag"),ey=Error,HX=[].push,lp=function(e,t){var n,i=UX(ZR,this);Zv?n=Zv(new ey,i?jX(this):ZR):(n=i?this:jk(ZR),QR(n,zX,"Error")),t!==void 0&&QR(n,"message",WX(t)),BX(n,lp,n.stack,1),arguments.length>2&&FX(n,arguments[2]);var a=[];return GX(e,HX,{that:a}),QR(n,"errors",a),n};Zv?Zv(lp,ey):VX(lp,ey,{name:!0});var ZR=lp.prototype=jk(ey.prototype,{constructor:$R(1,lp),message:$R(1,""),name:$R(1,"AggregateError")});MX({global:!0},{AggregateError:lp});var ty,og,ny,KX=ue,Vk=J.WeakMap,qX=KX(Vk)&&/native code/.test(String(Vk)),Fk=J,YX=kt,XX=Ja,ew=br,tw=Jh,JX=Hv,QX=qv,Bk="Object already initialized",nw=Fk.TypeError,$X=Fk.WeakMap;if(qX||tw.state){var Qa=tw.state||(tw.state=new $X);Qa.get=Qa.get,Qa.has=Qa.has,Qa.set=Qa.set,ty=function(e,t){if(Qa.has(e))throw new nw(Bk);return t.facade=e,Qa.set(e,t),t},og=function(e){return Qa.get(e)||{}},ny=function(e){return Qa.has(e)}}else{var dp=JX("state");QX[dp]=!0,ty=function(e,t){if(ew(e,dp))throw new nw(Bk);return t.facade=e,XX(e,dp,t),t},og=function(e){return ew(e,dp)?e[dp]:{}},ny=function(e){return ew(e,dp)}}var Eu,Gk,Wk,vu={set:ty,get:og,has:ny,enforce:function(e){return ny(e)?og(e):ty(e,{})},getterFor:function(e){return function(t){var n;if(!YX(t)||(n=og(t)).type!==e)throw new nw("Incompatible receiver, "+e+" required");return n}}},rw=tt,ZX=br,zk=Function.prototype,eJ=rw&&Object.getOwnPropertyDescriptor,Hk=ZX(zk,"name"),Kk={PROPER:Hk&&(function(){}).name==="something",CONFIGURABLE:Hk&&(!rw||rw&&eJ(zk,"name").configurable)},tJ=Ja,zl=function(e,t,n,i){return i&&i.enumerable?e[t]=n:tJ(e,t,n),e},nJ=f,rJ=ue,iJ=kt,sJ=ig,qk=WR,oJ=zl,iw=Mn("iterator"),Yk=!1;[].keys&&("next"in(Wk=[].keys())?(Gk=qk(qk(Wk)))!==Object.prototype&&(Eu=Gk):Yk=!0);var aJ=!iJ(Eu)||nJ(function(){var e={};return Eu[iw].call(e)!==e});rJ((Eu=aJ?{}:sJ(Eu))[iw])||oJ(Eu,iw,function(){return this});var Xk={IteratorPrototype:Eu,BUGGY_SAFARI_ITERATORS:Yk},cJ=Wl,lJ=MR?{}.toString:function(){return"[object "+cJ(this)+"]"},dJ=MR,uJ=xs.f,hJ=Ja,pJ=br,mJ=lJ,Jk=Mn("toStringTag"),Fc=function(e,t,n,i){var a=n?e:e&&e.prototype;a&&(pJ(a,Jk)||uJ(a,Jk,{configurable:!0,value:t}),i&&!dJ&&hJ(a,"toString",mJ))},fJ=Xk.IteratorPrototype,gJ=ig,_J=In,EJ=Fc,vJ=cp,yJ=function(){return this},sw=function(e,t,n,i){var a=t+" Iterator";return e.prototype=gJ(fJ,{next:_J(+!i,n)}),EJ(e,a,!1,!0),vJ[a]=yJ,e},SJ=Lt,TJ=It,bJ=Kk,RJ=sw,wJ=WR,CJ=Fc,Qk=zl,$k=cp,IJ=Xk,AJ=bJ.PROPER,ry=IJ.BUGGY_SAFARI_ITERATORS,ow=Mn("iterator"),Zk="keys",iy="values",e1="entries",NJ=function(){return this},t1=function(e,t,n,i,a,c,d){RJ(n,t,i);var h,m,g,_=function(k){if(k===a&&I)return I;if(!ry&&k&&k in b)return b[k];switch(k){case Zk:case iy:case e1:return function(){return new n(this,k)}}return function(){return new n(this)}},v=t+" Iterator",y=!1,b=e.prototype,O=b[ow]||b["@@iterator"]||a&&b[a],I=!ry&&O||_(a),N=t==="Array"&&b.entries||O;if(N&&(h=wJ(N.call(new e)))!==Object.prototype&&h.next&&(CJ(h,v,!0,!0),$k[v]=NJ),AJ&&a===iy&&O&&O.name!==iy&&(y=!0,I=function(){return TJ(O,this)}),a)if(m={values:_(iy),keys:c?I:_(Zk),entries:_(e1)},d)for(g in m)(ry||y||!(g in b))&&Qk(b,g,m[g]);else SJ({target:t,proto:!0,forced:ry||y},m);return d&&b[ow]!==I&&Qk(b,ow,I,{}),$k[t]=I,m},sy=function(e,t){return{value:e,done:t}},xJ=_t,n1=cp,r1=vu;xs.f;var OJ=t1,oy=sy,i1="Array Iterator",PJ=r1.set,DJ=r1.getterFor(i1);OJ(Array,"Array",function(e,t){PJ(this,{type:i1,target:xJ(e),index:0,kind:t})},function(){var e=DJ(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,oy(void 0,!0);switch(e.kind){case"keys":return oy(n,!1);case"values":return oy(t[n],!1)}return oy([n,t[n]],!1)},"values"),n1.Arguments=n1.Array;var kJ=xs,ay=function(e,t,n){return kJ.f(e,t,n)},LJ=Tr,MJ=ay,UJ=tt,s1=Mn("species"),jJ=F,VJ=TypeError,aw=function(e,t){if(jJ(t,e))return e;throw new VJ("Incorrect invocation")},FJ=ue,cw=Jh,BJ=M(Function.toString);FJ(cw.inspectSource)||(cw.inspectSource=function(e){return BJ(e)});var o1=cw.inspectSource,GJ=M,WJ=f,a1=ue,zJ=Wl,HJ=o1,c1=function(){},l1=Tr("Reflect","construct"),lw=/^\s*(?:class|function)\b/,KJ=GJ(lw.exec),qJ=!lw.test(c1),ag=function(e){if(!a1(e))return!1;try{return l1(c1,[],e),!0}catch{return!1}},d1=function(e){if(!a1(e))return!1;switch(zJ(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return qJ||!!KJ(lw,HJ(e))}catch{return!0}};d1.sham=!0;var cg,up,u1,dw,cy=!l1||WJ(function(){var e;return ag(ag.call)||!ag(Object)||!ag(function(){e=!0})||e})?d1:ag,YJ=cy,XJ=ea,JJ=TypeError,h1=yi,QJ=function(e){if(YJ(e))return e;throw new JJ(XJ(e)+" is not a constructor")},$J=Qn,ZJ=Mn("species"),uw=function(e,t){var n,i=h1(e).constructor;return i===void 0||$J(n=h1(i)[ZJ])?t:QJ(n)},Hl=M([].slice),eQ=TypeError,yu=function(e,t){if(e<t)throw new eQ("Not enough arguments");return e},p1=/(?:ipad|iphone|ipod).*applewebkit/i.test(ur),no=J,tQ=Z,nQ=Ya,m1=ue,rQ=br,f1=f,g1=bk,iQ=Hl,_1=Kf,sQ=yu,oQ=p1,aQ=zv,hw=no.setImmediate,pw=no.clearImmediate,cQ=no.process,mw=no.Dispatch,lQ=no.Function,E1=no.MessageChannel,dQ=no.String,fw=0,lg={},v1="onreadystatechange";f1(function(){cg=no.location});var gw=function(e){if(rQ(lg,e)){var t=lg[e];delete lg[e],t()}},_w=function(e){return function(){gw(e)}},y1=function(e){gw(e.data)},S1=function(e){no.postMessage(dQ(e),cg.protocol+"//"+cg.host)};hw&&pw||(hw=function(e){sQ(arguments.length,1);var t=m1(e)?e:lQ(e),n=iQ(arguments,1);return lg[++fw]=function(){tQ(t,void 0,n)},up(fw),fw},pw=function(e){delete lg[e]},aQ?up=function(e){cQ.nextTick(_w(e))}:mw&&mw.now?up=function(e){mw.now(_w(e))}:E1&&!oQ?(dw=(u1=new E1).port2,u1.port1.onmessage=y1,up=nQ(dw.postMessage,dw)):no.addEventListener&&m1(no.postMessage)&&!no.importScripts&&cg&&cg.protocol!=="file:"&&!f1(S1)?(up=S1,no.addEventListener("message",y1,!1)):up=v1 in _1("script")?function(e){g1.appendChild(_1("script"))[v1]=function(){g1.removeChild(this),gw(e)}}:function(e){setTimeout(_w(e),0)});var ly={set:hw,clear:pw},T1=J,uQ=tt,hQ=Object.getOwnPropertyDescriptor,b1=function(e){if(!uQ)return T1[e];var t=hQ(T1,e);return t&&t.value},R1=function(){this.head=null,this.tail=null};R1.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var hp,Ew,vw,yw,w1,C1=R1,pQ=/ipad|iphone|ipod/i.test(ur)&&typeof Pebble<"u",mQ=/web0s(?!.*chrome)/i.test(ur),pp=J,fQ=b1,I1=Ya,Sw=ly.set,gQ=C1,_Q=p1,EQ=pQ,vQ=mQ,Tw=zv,A1=pp.MutationObserver||pp.WebKitMutationObserver,N1=pp.document,x1=pp.process,dy=pp.Promise,bw=fQ("queueMicrotask");if(!bw){var uy=new gQ,hy=function(){var e,t;for(Tw&&(e=x1.domain)&&e.exit();t=uy.get();)try{t()}catch(n){throw uy.head&&hp(),n}e&&e.enter()};_Q||Tw||vQ||!A1||!N1?!EQ&&dy&&dy.resolve?((yw=dy.resolve(void 0)).constructor=dy,w1=I1(yw.then,yw),hp=function(){w1(hy)}):Tw?hp=function(){x1.nextTick(hy)}:(Sw=I1(Sw,pp),hp=function(){Sw(hy)}):(Ew=!0,vw=N1.createTextNode(""),new A1(hy).observe(vw,{characterData:!0}),hp=function(){vw.data=Ew=!Ew}),bw=function(e){uy.head||hp(),uy.add(e)}}var O1=bw,mp=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Su=J.Promise,yQ=J,dg=Su,SQ=ue,TQ=Ul,bQ=o1,RQ=Mn,P1=VR,Rw=Ga,D1=dg&&dg.prototype,wQ=RQ("species"),k1=SQ(yQ.PromiseRejectionEvent),CQ=TQ("Promise",function(){var e=bQ(dg),t=e!==String(dg);if(!t&&Rw===66||!D1.catch||!D1.finally)return!0;if(!Rw||Rw<51||!/native code/.test(e)){var n=new dg(function(a){a(1)}),i=function(a){a(function(){},function(){})};if((n.constructor={})[wQ]=i,!(n.then(function(){})instanceof i))return!0}return!(t||P1!=="BROWSER"&&P1!=="DENO"||k1)}),ug={CONSTRUCTOR:CQ,REJECTION_EVENT:k1},$a={},L1=jn,IQ=TypeError,AQ=function(e){var t,n;this.promise=new e(function(i,a){if(t!==void 0||n!==void 0)throw new IQ("Bad Promise constructor");t=i,n=a}),this.resolve=L1(t),this.reject=L1(n)};$a.f=function(e){return new AQ(e)};var ww,M1,U1,NQ=Lt,py=zv,Kl=J,xQ=qt,hg=It,OQ=zl,PQ=Fc,DQ=function(e){var t=LJ(e);UJ&&t&&!t[s1]&&MJ(t,s1,{configurable:!0,get:function(){return this}})},kQ=jn,Cw=ue,LQ=kt,MQ=aw,UQ=uw,j1=ly.set,Iw=O1,jQ=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},VQ=mp,FQ=C1,V1=vu,Aw=Su,F1=ug,B1=$a,my="Promise",G1=F1.CONSTRUCTOR,BQ=F1.REJECTION_EVENT,Nw=V1.getterFor(my),GQ=V1.set,WQ=Aw&&Aw.prototype,pg=Aw,xw=WQ,W1=Kl.TypeError,Ow=Kl.document,Pw=Kl.process,Dw=B1.f,zQ=Dw,HQ=!!(Ow&&Ow.createEvent&&Kl.dispatchEvent),z1="unhandledrejection",H1=function(e){var t;return!(!LQ(e)||!Cw(t=e.then))&&t},K1=function(e,t){var n,i,a,c=t.value,d=t.state===1,h=d?e.ok:e.fail,m=e.resolve,g=e.reject,_=e.domain;try{h?(d||(t.rejection===2&&qQ(t),t.rejection=1),h===!0?n=c:(_&&_.enter(),n=h(c),_&&(_.exit(),a=!0)),n===e.promise?g(new W1("Promise-chain cycle")):(i=H1(n))?hg(i,n,m,g):m(n)):g(c)}catch(v){_&&!a&&_.exit(),g(v)}},q1=function(e,t){e.notified||(e.notified=!0,Iw(function(){for(var n,i=e.reactions;n=i.get();)K1(n,e);e.notified=!1,t&&!e.rejection&&KQ(e)}))},Y1=function(e,t,n){var i,a;HQ?((i=Ow.createEvent("Event")).promise=t,i.reason=n,i.initEvent(e,!1,!0),Kl.dispatchEvent(i)):i={promise:t,reason:n},!BQ&&(a=Kl["on"+e])?a(i):e===z1&&jQ("Unhandled promise rejection",n)},KQ=function(e){hg(j1,Kl,function(){var t,n=e.facade,i=e.value;if(X1(e)&&(t=VQ(function(){py?Pw.emit("unhandledRejection",i,n):Y1(z1,n,i)}),e.rejection=py||X1(e)?2:1,t.error))throw t.value})},X1=function(e){return e.rejection!==1&&!e.parent},qQ=function(e){hg(j1,Kl,function(){var t=e.facade;py?Pw.emit("rejectionHandled",t):Y1("rejectionhandled",t,e.value)})},fp=function(e,t,n){return function(i){e(t,i,n)}},gp=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,q1(e,!0))},kw=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new W1("Promise can't be resolved itself");var i=H1(t);i?Iw(function(){var a={done:!1};try{hg(i,t,fp(kw,a,e),fp(gp,a,e))}catch(c){gp(a,c,e)}}):(e.value=t,e.state=1,q1(e,!1))}catch(a){gp({done:!1},a,e)}}};G1&&(xw=(pg=function(e){MQ(this,xw),kQ(e),hg(ww,this);var t=Nw(this);try{e(fp(kw,t),fp(gp,t))}catch(n){gp(t,n)}}).prototype,(ww=function(e){GQ(this,{type:my,done:!1,notified:!1,parent:!1,reactions:new FQ,rejection:!1,state:0,value:null})}).prototype=OQ(xw,"then",function(e,t){var n=Nw(this),i=Dw(UQ(this,pg));return n.parent=!0,i.ok=!Cw(e)||e,i.fail=Cw(t)&&t,i.domain=py?Pw.domain:void 0,n.state===0?n.reactions.add(i):Iw(function(){K1(i,n)}),i.promise}),M1=function(){var e=new ww,t=Nw(e);this.promise=e,this.resolve=fp(kw,t),this.reject=fp(gp,t)},B1.f=Dw=function(e){return e===pg||e===U1?new M1(e):zQ(e)}),NQ({global:!0,wrap:!0,forced:G1},{Promise:pg}),U1=xQ.Promise,PQ(pg,my,!1,!0),DQ(my);var J1=Mn("iterator"),Q1=!1;try{var YQ=0,$1={next:function(){return{done:!!YQ++}},return:function(){Q1=!0}};$1[J1]=function(){return this},Array.from($1,function(){throw 2})}catch{}var XQ=Su,JQ=function(e,t){try{if(!t&&!Q1)return!1}catch{return!1}var n=!1;try{var i={};i[J1]=function(){return{next:function(){return{done:n=!0}}}},e(i)}catch{}return n},fy=ug.CONSTRUCTOR||!JQ(function(e){XQ.all(e).then(void 0,function(){})}),QQ=It,$Q=jn,ZQ=$a,e$=mp,t$=sg;Lt({target:"Promise",stat:!0,forced:fy},{all:function(e){var t=this,n=ZQ.f(t),i=n.resolve,a=n.reject,c=e$(function(){var d=$Q(t.resolve),h=[],m=0,g=1;t$(e,function(_){var v=m++,y=!1;g++,QQ(d,t,_).then(function(b){y||(y=!0,h[v]=b,--g||i(h))},a)}),--g||i(h)});return c.error&&a(c.value),n.promise}});var n$=Lt,r$=ug.CONSTRUCTOR;Su&&Su.prototype,n$({target:"Promise",proto:!0,forced:r$,real:!0},{catch:function(e){return this.then(void 0,e)}});var i$=It,s$=jn,o$=$a,a$=mp,c$=sg;Lt({target:"Promise",stat:!0,forced:fy},{race:function(e){var t=this,n=o$.f(t),i=n.reject,a=a$(function(){var c=s$(t.resolve);c$(e,function(d){i$(c,t,d).then(n.resolve,i)})});return a.error&&i(a.value),n.promise}});var l$=$a;Lt({target:"Promise",stat:!0,forced:ug.CONSTRUCTOR},{reject:function(e){var t=l$.f(this);return(0,t.reject)(e),t.promise}});var d$=yi,u$=kt,h$=$a,Z1=function(e,t){if(d$(e),u$(t)&&t.constructor===e)return t;var n=h$.f(e);return(0,n.resolve)(t),n.promise},p$=Lt,m$=Su,f$=ug.CONSTRUCTOR,g$=Z1,_$=Tr("Promise"),E$=!f$;p$({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return g$(E$&&this===_$?m$:this,e)}});var v$=It,y$=jn,S$=$a,T$=mp,b$=sg;Lt({target:"Promise",stat:!0,forced:fy},{allSettled:function(e){var t=this,n=S$.f(t),i=n.resolve,a=n.reject,c=T$(function(){var d=y$(t.resolve),h=[],m=0,g=1;b$(e,function(_){var v=m++,y=!1;g++,v$(d,t,_).then(function(b){y||(y=!0,h[v]={status:"fulfilled",value:b},--g||i(h))},function(b){y||(y=!0,h[v]={status:"rejected",reason:b},--g||i(h))})}),--g||i(h)});return c.error&&a(c.value),n.promise}});var R$=It,w$=jn,C$=Tr,I$=$a,A$=mp,N$=sg,eL="No one promise resolved";Lt({target:"Promise",stat:!0,forced:fy},{any:function(e){var t=this,n=C$("AggregateError"),i=I$.f(t),a=i.resolve,c=i.reject,d=A$(function(){var h=w$(t.resolve),m=[],g=0,_=1,v=!1;N$(e,function(y){var b=g++,O=!1;_++,R$(h,t,y).then(function(I){O||v||(v=!0,a(I))},function(I){O||v||(O=!0,m[b]=I,--_||c(new n(m,eL)))})}),--_||c(new n(m,eL))});return d.error&&c(d.value),i.promise}});var x$=Lt,O$=Z,P$=Hl,D$=$a,k$=jn,tL=mp,Lw=J.Promise,nL=!1;x$({target:"Promise",stat:!0,forced:!Lw||!Lw.try||tL(function(){Lw.try(function(e){nL=e===8},8)}).error||!nL},{try:function(e){var t=arguments.length>1?P$(arguments,1):[],n=D$.f(this),i=tL(function(){return O$(k$(e),void 0,t)});return(i.error?n.reject:n.resolve)(i.value),n.promise}});var L$=$a;Lt({target:"Promise",stat:!0},{withResolvers:function(){var e=L$.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var M$=Lt,Mw=Su,U$=f,j$=Tr,V$=ue,F$=uw,rL=Z1,B$=Mw&&Mw.prototype;M$({target:"Promise",proto:!0,real:!0,forced:!!Mw&&U$(function(){B$.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=F$(this,j$("Promise")),n=V$(e);return this.then(n?function(i){return rL(t,e()).then(function(){return i})}:e,n?function(i){return rL(t,e()).then(function(){throw i})}:e)}});var Uw=M,G$=S,W$=_s,z$=$n,H$=Uw("".charAt),iL=Uw("".charCodeAt),K$=Uw("".slice),sL=function(e){return function(t,n){var i,a,c=W$(z$(t)),d=G$(n),h=c.length;return d<0||d>=h?e?"":void 0:(i=iL(c,d))<55296||i>56319||d+1===h||(a=iL(c,d+1))<56320||a>57343?e?H$(c,d):i:e?K$(c,d,d+2):a-56320+(i-55296<<10)+65536}},jw={codeAt:sL(!1),charAt:sL(!0)},q$=jw.charAt,Y$=_s,oL=vu,X$=t1,aL=sy,cL="String Iterator",J$=oL.set,Q$=oL.getterFor(cL);X$(String,"String",function(e){J$(this,{type:cL,string:Y$(e),index:0})},function(){var e,t=Q$(this),n=t.string,i=t.index;return i>=n.length?aL(void 0,!0):(e=q$(n,i),t.index+=e.length,aL(e,!1))});var $$=qt.Promise,Z$={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},eZ=J,tZ=Fc,lL=cp;for(var Vw in Z$)tZ(eZ[Vw],Vw),lL[Vw]=lL.Array;var dL=$$,we=u(dL),nZ=eo("Array","values"),rZ=Wl,iZ=br,sZ=F,oZ=nZ,Fw=Array.prototype,aZ={DOMTokenList:!0,NodeList:!0},cZ=function(e){var t=e.values;return e===Fw||sZ(Fw,e)&&t===Fw.values||iZ(aZ,rZ(e))?oZ:t},Es=u(cZ),uL=ea,lZ=TypeError,hL=Hl,dZ=Math.floor,Bw=function(e,t){var n=e.length;if(n<8)for(var i,a,c=1;c<n;){for(a=c,i=e[c];a&&t(e[a-1],i)>0;)e[a]=e[--a];a!==c++&&(e[a]=i)}else for(var d=dZ(n/2),h=Bw(hL(e,0,d),t),m=Bw(hL(e,d),t),g=h.length,_=m.length,v=0,y=0;v<g||y<_;)e[v+y]=v<g&&y<_?t(h[v],m[y])<=0?h[v++]:m[y++]:v<g?h[v++]:m[y++];return e},pL=Bw,mL=ur.match(/firefox\/(\d+)/i),uZ=!!mL&&+mL[1],hZ=/MSIE|Trident/.test(ur),fL=ur.match(/AppleWebKit\/(\d+)\./),pZ=!!fL&&+fL[1],mZ=Lt,gL=M,fZ=jn,gZ=bo,_L=an,_Z=function(e,t){if(!delete e[t])throw new lZ("Cannot delete property "+uL(t)+" of "+uL(e))},EL=_s,Gw=f,EZ=pL,vZ=Gv,vL=uZ,yZ=hZ,yL=Ga,SL=pZ,ql=[],TL=gL(ql.sort),SZ=gL(ql.push),TZ=Gw(function(){ql.sort(void 0)}),bZ=Gw(function(){ql.sort(null)}),RZ=vZ("sort"),bL=!Gw(function(){if(yL)return yL<70;if(!(vL&&vL>3)){if(yZ)return!0;if(SL)return SL<603;var e,t,n,i,a="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)ql.push({k:t+i,v:n})}for(ql.sort(function(c,d){return d.v-c.v}),i=0;i<ql.length;i++)t=ql[i].k.charAt(0),a.charAt(a.length-1)!==t&&(a+=t);return a!=="DGBEFHACIJK"}});mZ({target:"Array",proto:!0,forced:TZ||!bZ||!RZ||!bL},{sort:function(e){e!==void 0&&fZ(e);var t=gZ(this);if(bL)return e===void 0?TL(t):TL(t,e);var n,i,a=[],c=_L(t);for(i=0;i<c;i++)i in t&&SZ(a,t[i]);for(EZ(a,function(d){return function(h,m){return m===void 0?-1:h===void 0?1:d!==void 0?+d(h,m)||0:EL(h)>EL(m)?1:-1}}(e)),n=_L(a),i=0;i<n;)t[i]=a[i++];for(;i<c;)_Z(t,i++);return t}});var wZ=eo("Array","sort"),CZ=F,IZ=wZ,Ww=Array.prototype,AZ=function(e){var t=e.sort;return e===Ww||CZ(Ww,e)&&t===Ww.sort?IZ:t},Tu=u(AZ),NZ=Lt,xZ=M,OZ=Te,PZ=RangeError,RL=String.fromCharCode,wL=String.fromCodePoint,DZ=xZ([].join);NZ({target:"String",stat:!0,forced:!!wL&&wL.length!==1},{fromCodePoint:function(e){for(var t,n=[],i=arguments.length,a=0;i>a;){if(t=+arguments[a++],OZ(t,1114111)!==t)throw new PZ(t+" is not a valid code point");n[a]=t<65536?RL(t):RL(55296+((t-=65536)>>10),t%1024+56320)}return DZ(n,"")}});var kZ=f,LZ=Mn("iterator"),gy=!kZ(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),i="";return e.pathname="c%20d",t.forEach(function(a,c){t.delete("b"),i+=c+a}),n.delete("a",2),n.delete("b",void 0),!e.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[LZ]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||i!=="a1c3"||new URL("https://x",void 0).host!=="x"}),MZ=zl,zw=Lt,CL=J,Hw=b1,UZ=Tr,_y=It,sa=M,mg=tt,IL=gy,AL=zl,jZ=ay,VZ=function(e,t,n){for(var i in t)n&&n.unsafe&&e[i]?e[i]=t[i]:MZ(e,i,t[i],n);return e},FZ=Fc,BZ=sw,Kw=vu,NL=aw,qw=ue,GZ=br,WZ=Ya,zZ=Wl,HZ=yi,xL=kt,vs=_s,KZ=ig,OL=In,PL=JR,qZ=Qv,Ey=sy,_p=yu,YZ=pL,XZ=Mn("iterator"),Ep="URLSearchParams",DL=Ep+"Iterator",kL=Kw.set,Ro=Kw.getterFor(Ep),JZ=Kw.getterFor(DL),LL=Hw("fetch"),vy=Hw("Request"),fg=Hw("Headers"),Yw=vy&&vy.prototype,ML=fg&&fg.prototype,QZ=CL.TypeError,$Z=CL.encodeURIComponent,ZZ=String.fromCharCode,eee=UZ("String","fromCodePoint"),tee=parseInt,yy=sa("".charAt),UL=sa([].join),Yl=sa([].push),jL=sa("".replace),nee=sa([].shift),VL=sa([].splice),FL=sa("".split),BL=sa("".slice),ree=sa(/./.exec),iee=/\+/g,see=/^[0-9a-f]+$/i,GL=function(e,t){var n=BL(e,t,t+2);return ree(see,n)?tee(n,16):NaN},oee=function(e){for(var t=0,n=128;n>0&&e&n;n>>=1)t++;return t},aee=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},WL=function(e){for(var t=(e=jL(e,iee," ")).length,n="",i=0;i<t;){var a=yy(e,i);if(a==="%"){if(yy(e,i+1)==="%"||i+3>t){n+="%",i++;continue}var c=GL(e,i+1);if(c!=c){n+=a,i++;continue}i+=2;var d=oee(c);if(d===0)a=ZZ(c);else{if(d===1||d>4){n+="",i++;continue}for(var h=[c],m=1;m<d&&!(++i+3>t||yy(e,i)!=="%");){var g=GL(e,i+1);if(g!=g){i+=3;break}if(g>191||g<128)break;Yl(h,g),i+=2,m++}if(h.length!==d){n+="";continue}var _=aee(h);_===null?n+="":a=eee(_)}}n+=a,i++}return n},cee=/[!'()~]|%20/g,lee={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},dee=function(e){return lee[e]},zL=function(e){return jL($Z(e),cee,dee)},Xw=BZ(function(e,t){kL(this,{type:DL,target:Ro(e).entries,index:0,kind:t})},Ep,function(){var e=JZ(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,Ey(void 0,!0);var i=t[n];switch(e.kind){case"keys":return Ey(i.key,!1);case"values":return Ey(i.value,!1)}return Ey([i.key,i.value],!1)},!0),HL=function(e){this.entries=[],this.url=null,e!==void 0&&(xL(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?yy(e,0)==="?"?BL(e,1):e:vs(e)))};HL.prototype={type:Ep,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,i,a,c,d,h,m=this.entries,g=qZ(e);if(g)for(n=(t=PL(e,g)).next;!(i=_y(n,t)).done;){if(c=(a=PL(HZ(i.value))).next,(d=_y(c,a)).done||(h=_y(c,a)).done||!_y(c,a).done)throw new QZ("Expected sequence with length 2");Yl(m,{key:vs(d.value),value:vs(h.value)})}else for(var _ in e)GZ(e,_)&&Yl(m,{key:_,value:vs(e[_])})},parseQuery:function(e){if(e)for(var t,n,i=this.entries,a=FL(e,"&"),c=0;c<a.length;)(t=a[c++]).length&&(n=FL(t,"="),Yl(i,{key:WL(nee(n)),value:WL(UL(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],i=0;i<t.length;)e=t[i++],Yl(n,zL(e.key)+"="+zL(e.value));return UL(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Sy=function(){NL(this,vp);var e=kL(this,new HL(arguments.length>0?arguments[0]:void 0));mg||(this.size=e.entries.length)},vp=Sy.prototype;if(VZ(vp,{append:function(e,t){var n=Ro(this);_p(arguments.length,2),Yl(n.entries,{key:vs(e),value:vs(t)}),mg||this.length++,n.updateURL()},delete:function(e){for(var t=Ro(this),n=_p(arguments.length,1),i=t.entries,a=vs(e),c=n<2?void 0:arguments[1],d=c===void 0?c:vs(c),h=0;h<i.length;){var m=i[h];if(m.key!==a||d!==void 0&&m.value!==d)h++;else if(VL(i,h,1),d!==void 0)break}mg||(this.size=i.length),t.updateURL()},get:function(e){var t=Ro(this).entries;_p(arguments.length,1);for(var n=vs(e),i=0;i<t.length;i++)if(t[i].key===n)return t[i].value;return null},getAll:function(e){var t=Ro(this).entries;_p(arguments.length,1);for(var n=vs(e),i=[],a=0;a<t.length;a++)t[a].key===n&&Yl(i,t[a].value);return i},has:function(e){for(var t=Ro(this).entries,n=_p(arguments.length,1),i=vs(e),a=n<2?void 0:arguments[1],c=a===void 0?a:vs(a),d=0;d<t.length;){var h=t[d++];if(h.key===i&&(c===void 0||h.value===c))return!0}return!1},set:function(e,t){var n=Ro(this);_p(arguments.length,1);for(var i,a=n.entries,c=!1,d=vs(e),h=vs(t),m=0;m<a.length;m++)(i=a[m]).key===d&&(c?VL(a,m--,1):(c=!0,i.value=h));c||Yl(a,{key:d,value:h}),mg||(this.size=a.length),n.updateURL()},sort:function(){var e=Ro(this);YZ(e.entries,function(t,n){return t.key>n.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,n=Ro(this).entries,i=WZ(e,arguments.length>1?arguments[1]:void 0),a=0;a<n.length;)i((t=n[a++]).value,t.key,this)},keys:function(){return new Xw(this,"keys")},values:function(){return new Xw(this,"values")},entries:function(){return new Xw(this,"entries")}},{enumerable:!0}),AL(vp,XZ,vp.entries,{}),AL(vp,"toString",function(){return Ro(this).serialize()},{enumerable:!0}),mg&&jZ(vp,"size",{get:function(){return Ro(this).entries.length},configurable:!0,enumerable:!0}),FZ(Sy,Ep),zw({global:!0,forced:!IL},{URLSearchParams:Sy}),!IL&&qw(fg)){var uee=sa(ML.has),hee=sa(ML.set),KL=function(e){if(xL(e)){var t,n=e.body;if(zZ(n)===Ep)return t=e.headers?new fg(e.headers):new fg,uee(t,"content-type")||hee(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),KZ(e,{body:OL(0,vs(n)),headers:OL(0,t)})}return e};if(qw(LL)&&zw({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return LL(e,arguments.length>1?KL(arguments[1]):{})}}),qw(vy)){var Jw=function(e){return NL(this,Yw),new vy(e,arguments.length>1?KL(arguments[1]):{})};Yw.constructor=Jw,Jw.prototype=Yw,zw({global:!0,dontCallGetSet:!0,forced:!0},{Request:Jw})}}var wo,pee={URLSearchParams:Sy,getState:Ro},mee=qt.URLSearchParams,qL=tt,fee=M,gee=It,_ee=f,Qw=Yv,Eee=rg,vee=Ge,yee=bo,See=lr,yp=Object.assign,YL=Object.defineProperty,Tee=fee([].concat),bee=!yp||_ee(function(){if(qL&&yp({b:1},yp(YL({},"a",{enumerable:!0,get:function(){YL(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},n=Symbol("assign detection"),i="abcdefghijklmnopqrst";return e[n]=7,i.split("").forEach(function(a){t[a]=a}),yp({},e)[n]!==7||Qw(yp({},t)).join("")!==i})?function(e,t){for(var n=yee(e),i=arguments.length,a=1,c=Eee.f,d=vee.f;i>a;)for(var h,m=See(arguments[a++]),g=c?Tee(Qw(m),c(m)):Qw(m),_=g.length,v=0;_>v;)h=g[v++],qL&&!gee(d,m,h)||(n[h]=m[h]);return n}:yp,Ree=yi,wee=kk,Cee=tt,Iee=xs,Aee=In,$w=function(e,t,n){Cee?Iee.f(e,t,Aee(0,n)):e[t]=n},Nee=Ya,xee=It,Oee=bo,Pee=function(e,t,n,i){try{return i?t(Ree(n)[0],n[1]):t(n)}catch(a){wee(e,"throw",a)}},Dee=Ok,kee=cy,Lee=an,XL=$w,Mee=JR,Uee=Qv,JL=Array,bu=M,Zw=2147483647,jee=/[^\0-\u007E]/,QL=/[.\u3002\uFF0E\uFF61]/g,$L="Overflow: input needs wider integers to process",ZL=RangeError,Vee=bu(QL.exec),Sp=Math.floor,eC=String.fromCharCode,e2=bu("".charCodeAt),t2=bu([].join),Xl=bu([].push),Fee=bu("".replace),Bee=bu("".split),Gee=bu("".toLowerCase),n2=function(e){return e+22+75*(e<26)},Wee=function(e,t,n){var i=0;for(e=n?Sp(e/700):e>>1,e+=Sp(e/t);e>455;)e=Sp(e/35),i+=36;return Sp(i+36*e/(e+38))},zee=function(e){var t=[];e=function(k){for(var j=[],G=0,K=k.length;G<K;){var X=e2(k,G++);if(X>=55296&&X<=56319&&G<K){var z=e2(k,G++);(64512&z)==56320?Xl(j,((1023&X)<<10)+(1023&z)+65536):(Xl(j,X),G--)}else Xl(j,X)}return j}(e);var n,i,a=e.length,c=128,d=0,h=72;for(n=0;n<e.length;n++)(i=e[n])<128&&Xl(t,eC(i));var m=t.length,g=m;for(m&&Xl(t,"-");g<a;){var _=Zw;for(n=0;n<e.length;n++)(i=e[n])>=c&&i<_&&(_=i);var v=g+1;if(_-c>Sp((Zw-d)/v))throw new ZL($L);for(d+=(_-c)*v,c=_,n=0;n<e.length;n++){if((i=e[n])<c&&++d>Zw)throw new ZL($L);if(i===c){for(var y=d,b=36;;){var O=b<=h?1:b>=h+26?26:b-h;if(y<O)break;var I=y-O,N=36-O;Xl(t,eC(n2(O+I%N))),y=Sp(I/N),b+=36}Xl(t,eC(n2(y))),h=Wee(d,v,g===m),d=0,g++}}d++,c++}return t2(t,"")},Hee=Lt,tC=tt,Kee=gy,nC=J,r2=Ya,Co=M,Ty=zl,Io=ay,qee=aw,rC=br,iC=bee,Tp=function(e){var t=Oee(e),n=kee(this),i=arguments.length,a=i>1?arguments[1]:void 0,c=a!==void 0;c&&(a=Nee(a,i>2?arguments[2]:void 0));var d,h,m,g,_,v,y=Uee(t),b=0;if(!y||this===JL&&Dee(y))for(d=Lee(t),h=n?new this(d):JL(d);d>b;b++)v=c?a(t[b],b):t[b],XL(h,b,v);else for(h=n?new this:[],_=(g=Mee(t,y)).next;!(m=xee(_,g)).done;b++)v=c?Pee(g,a,[m.value,b],!0):m.value,XL(h,b,v);return h.length=b,h},oa=Hl,Yee=jw.codeAt,Xee=function(e){var t,n,i=[],a=Bee(Fee(Gee(e),QL,"."),".");for(t=0;t<a.length;t++)n=a[t],Xl(i,Vee(jee,n)?"xn--"+zee(n):n);return t2(i,".")},Bc=_s,Jee=Fc,Qee=yu,i2=pee,s2=vu,$ee=s2.set,by=s2.getterFor("URL"),Zee=i2.URLSearchParams,ete=i2.getState,gg=nC.URL,sC=nC.TypeError,Ry=nC.parseInt,tte=Math.floor,o2=Math.pow,Ao=Co("".charAt),aa=Co(/./.exec),_g=Co([].join),nte=Co(1.1.toString),rte=Co([].pop),bp=Co([].push),oC=Co("".replace),ite=Co([].shift),ste=Co("".split),Eg=Co("".slice),wy=Co("".toLowerCase),ote=Co([].unshift),aC="Invalid scheme",Ru="Invalid host",a2="Invalid port",c2=/[a-z]/i,ate=/[\d+-.a-z]/i,cC=/\d/,cte=/^0x/i,lte=/^[0-7]+$/,dte=/^\d+$/,l2=/^[\da-f]+$/i,ute=/[\0\t\n\r #%/:<>?@[\\\]^|]/,hte=/[\0\t\n\r #/:<>?@[\\\]^|]/,pte=/^[\u0000-\u0020]+/,mte=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,fte=/[\t\n\r]/g,vg=function(e){var t,n,i,a;if(typeof e=="number"){for(t=[],n=0;n<4;n++)ote(t,e%256),e=tte(e/256);return _g(t,".")}if(typeof e=="object"){for(t="",i=function(c){for(var d=null,h=1,m=null,g=0,_=0;_<8;_++)c[_]!==0?(g>h&&(d=m,h=g),m=null,g=0):(m===null&&(m=_),++g);return g>h?m:d}(e),n=0;n<8;n++)a&&e[n]===0||(a&&(a=!1),i===n?(t+=n?":":"::",a=!0):(t+=nte(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},Cy={},d2=iC({},Cy,{" ":1,'"':1,"<":1,">":1,"`":1}),u2=iC({},d2,{"#":1,"?":1,"{":1,"}":1}),lC=iC({},u2,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Jl=function(e,t){var n=Yee(e,0);return n>32&&n<127&&!rC(t,e)?e:encodeURIComponent(e)},Iy={ftp:21,file:null,http:80,https:443,ws:80,wss:443},yg=function(e,t){var n;return e.length===2&&aa(c2,Ao(e,0))&&((n=Ao(e,1))===":"||!t&&n==="|")},h2=function(e){var t;return e.length>1&&yg(Eg(e,0,2))&&(e.length===2||(t=Ao(e,2))==="/"||t==="\\"||t==="?"||t==="#")},gte=function(e){return e==="."||wy(e)==="%2e"},dC={},p2={},uC={},m2={},f2={},hC={},g2={},_2={},Ay={},Ny={},pC={},mC={},fC={},gC={},E2={},_C={},Rp={},Za={},v2={},wu={},Gc={},EC=function(e,t,n){var i,a,c,d=Bc(e);if(t){if(a=this.parse(d))throw new sC(a);this.searchParams=null}else{if(n!==void 0&&(i=new EC(n,!0)),a=this.parse(d,null,i))throw new sC(a);(c=ete(new Zee)).bindURL(this),this.searchParams=c}};EC.prototype={type:"URL",parse:function(e,t,n){var i,a,c,d,h,m=this,g=t||dC,_=0,v="",y=!1,b=!1,O=!1;for(e=Bc(e),t||(m.scheme="",m.username="",m.password="",m.host=null,m.port=null,m.path=[],m.query=null,m.fragment=null,m.cannotBeABaseURL=!1,e=oC(e,pte,""),e=oC(e,mte,"$1")),e=oC(e,fte,""),i=Tp(e);_<=i.length;){switch(a=i[_],g){case dC:if(!a||!aa(c2,a)){if(t)return aC;g=uC;continue}v+=wy(a),g=p2;break;case p2:if(a&&(aa(ate,a)||a==="+"||a==="-"||a==="."))v+=wy(a);else{if(a!==":"){if(t)return aC;v="",g=uC,_=0;continue}if(t&&(m.isSpecial()!==rC(Iy,v)||v==="file"&&(m.includesCredentials()||m.port!==null)||m.scheme==="file"&&!m.host))return;if(m.scheme=v,t)return void(m.isSpecial()&&Iy[m.scheme]===m.port&&(m.port=null));v="",m.scheme==="file"?g=gC:m.isSpecial()&&n&&n.scheme===m.scheme?g=m2:m.isSpecial()?g=_2:i[_+1]==="/"?(g=f2,_++):(m.cannotBeABaseURL=!0,bp(m.path,""),g=v2)}break;case uC:if(!n||n.cannotBeABaseURL&&a!=="#")return aC;if(n.cannotBeABaseURL&&a==="#"){m.scheme=n.scheme,m.path=oa(n.path),m.query=n.query,m.fragment="",m.cannotBeABaseURL=!0,g=Gc;break}g=n.scheme==="file"?gC:hC;continue;case m2:if(a!=="/"||i[_+1]!=="/"){g=hC;continue}g=Ay,_++;break;case f2:if(a==="/"){g=Ny;break}g=Za;continue;case hC:if(m.scheme=n.scheme,a===wo)m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,m.path=oa(n.path),m.query=n.query;else if(a==="/"||a==="\\"&&m.isSpecial())g=g2;else if(a==="?")m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,m.path=oa(n.path),m.query="",g=wu;else{if(a!=="#"){m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,m.path=oa(n.path),m.path.length--,g=Za;continue}m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,m.path=oa(n.path),m.query=n.query,m.fragment="",g=Gc}break;case g2:if(!m.isSpecial()||a!=="/"&&a!=="\\"){if(a!=="/"){m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,g=Za;continue}g=Ny}else g=Ay;break;case _2:if(g=Ay,a!=="/"||Ao(v,_+1)!=="/")continue;_++;break;case Ay:if(a!=="/"&&a!=="\\"){g=Ny;continue}break;case Ny:if(a==="@"){y&&(v="%40"+v),y=!0,c=Tp(v);for(var I=0;I<c.length;I++){var N=c[I];if(N!==":"||O){var k=Jl(N,lC);O?m.password+=k:m.username+=k}else O=!0}v=""}else if(a===wo||a==="/"||a==="?"||a==="#"||a==="\\"&&m.isSpecial()){if(y&&v==="")return"Invalid authority";_-=Tp(v).length+1,v="",g=pC}else v+=a;break;case pC:case mC:if(t&&m.scheme==="file"){g=_C;continue}if(a!==":"||b){if(a===wo||a==="/"||a==="?"||a==="#"||a==="\\"&&m.isSpecial()){if(m.isSpecial()&&v==="")return Ru;if(t&&v===""&&(m.includesCredentials()||m.port!==null))return;if(d=m.parseHost(v))return d;if(v="",g=Rp,t)return;continue}a==="["?b=!0:a==="]"&&(b=!1),v+=a}else{if(v==="")return Ru;if(d=m.parseHost(v))return d;if(v="",g=fC,t===mC)return}break;case fC:if(!aa(cC,a)){if(a===wo||a==="/"||a==="?"||a==="#"||a==="\\"&&m.isSpecial()||t){if(v!==""){var j=Ry(v,10);if(j>65535)return a2;m.port=m.isSpecial()&&j===Iy[m.scheme]?null:j,v=""}if(t)return;g=Rp;continue}return a2}v+=a;break;case gC:if(m.scheme="file",a==="/"||a==="\\")g=E2;else{if(!n||n.scheme!=="file"){g=Za;continue}switch(a){case wo:m.host=n.host,m.path=oa(n.path),m.query=n.query;break;case"?":m.host=n.host,m.path=oa(n.path),m.query="",g=wu;break;case"#":m.host=n.host,m.path=oa(n.path),m.query=n.query,m.fragment="",g=Gc;break;default:h2(_g(oa(i,_),""))||(m.host=n.host,m.path=oa(n.path),m.shortenPath()),g=Za;continue}}break;case E2:if(a==="/"||a==="\\"){g=_C;break}n&&n.scheme==="file"&&!h2(_g(oa(i,_),""))&&(yg(n.path[0],!0)?bp(m.path,n.path[0]):m.host=n.host),g=Za;continue;case _C:if(a===wo||a==="/"||a==="\\"||a==="?"||a==="#"){if(!t&&yg(v))g=Za;else if(v===""){if(m.host="",t)return;g=Rp}else{if(d=m.parseHost(v))return d;if(m.host==="localhost"&&(m.host=""),t)return;v="",g=Rp}continue}v+=a;break;case Rp:if(m.isSpecial()){if(g=Za,a!=="/"&&a!=="\\")continue}else if(t||a!=="?")if(t||a!=="#"){if(a!==wo&&(g=Za,a!=="/"))continue}else m.fragment="",g=Gc;else m.query="",g=wu;break;case Za:if(a===wo||a==="/"||a==="\\"&&m.isSpecial()||!t&&(a==="?"||a==="#")){if((h=wy(h=v))===".."||h==="%2e."||h===".%2e"||h==="%2e%2e"?(m.shortenPath(),a==="/"||a==="\\"&&m.isSpecial()||bp(m.path,"")):gte(v)?a==="/"||a==="\\"&&m.isSpecial()||bp(m.path,""):(m.scheme==="file"&&!m.path.length&&yg(v)&&(m.host&&(m.host=""),v=Ao(v,0)+":"),bp(m.path,v)),v="",m.scheme==="file"&&(a===wo||a==="?"||a==="#"))for(;m.path.length>1&&m.path[0]==="";)ite(m.path);a==="?"?(m.query="",g=wu):a==="#"&&(m.fragment="",g=Gc)}else v+=Jl(a,u2);break;case v2:a==="?"?(m.query="",g=wu):a==="#"?(m.fragment="",g=Gc):a!==wo&&(m.path[0]+=Jl(a,Cy));break;case wu:t||a!=="#"?a!==wo&&(a==="'"&&m.isSpecial()?m.query+="%27":m.query+=a==="#"?"%23":Jl(a,Cy)):(m.fragment="",g=Gc);break;case Gc:a!==wo&&(m.fragment+=Jl(a,d2))}_++}},parseHost:function(e){var t,n,i;if(Ao(e,0)==="["){if(Ao(e,e.length-1)!=="]"||(t=function(a){var c,d,h,m,g,_,v,y=[0,0,0,0,0,0,0,0],b=0,O=null,I=0,N=function(){return Ao(a,I)};if(N()===":"){if(Ao(a,1)!==":")return;I+=2,O=++b}for(;N();){if(b===8)return;if(N()!==":"){for(c=d=0;d<4&&aa(l2,N());)c=16*c+Ry(N(),16),I++,d++;if(N()==="."){if(d===0||(I-=d,b>6))return;for(h=0;N();){if(m=null,h>0){if(!(N()==="."&&h<4))return;I++}if(!aa(cC,N()))return;for(;aa(cC,N());){if(g=Ry(N(),10),m===null)m=g;else{if(m===0)return;m=10*m+g}if(m>255)return;I++}y[b]=256*y[b]+m,++h!=2&&h!==4||b++}if(h!==4)return;break}if(N()===":"){if(I++,!N())return}else if(N())return;y[b++]=c}else{if(O!==null)return;I++,O=++b}}if(O!==null)for(_=b-O,b=7;b!==0&&_>0;)v=y[b],y[b--]=y[O+_-1],y[O+--_]=v;else if(b!==8)return;return y}(Eg(e,1,-1)),!t))return Ru;this.host=t}else if(this.isSpecial()){if(e=Xee(e),aa(ute,e)||(t=function(a){var c,d,h,m,g,_,v,y=ste(a,".");if(y.length&&y[y.length-1]===""&&y.length--,(c=y.length)>4)return a;for(d=[],h=0;h<c;h++){if((m=y[h])==="")return a;if(g=10,m.length>1&&Ao(m,0)==="0"&&(g=aa(cte,m)?16:8,m=Eg(m,g===8?1:2)),m==="")_=0;else{if(!aa(g===10?dte:g===8?lte:l2,m))return a;_=Ry(m,g)}bp(d,_)}for(h=0;h<c;h++)if(_=d[h],h===c-1){if(_>=o2(256,5-c))return null}else if(_>255)return null;for(v=rte(d),h=0;h<d.length;h++)v+=d[h]*o2(256,3-h);return v}(e),t===null))return Ru;this.host=t}else{if(aa(hte,e))return Ru;for(t="",n=Tp(e),i=0;i<n.length;i++)t+=Jl(n[i],Cy);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return rC(Iy,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&yg(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,i=e.password,a=e.host,c=e.port,d=e.path,h=e.query,m=e.fragment,g=t+":";return a!==null?(g+="//",e.includesCredentials()&&(g+=n+(i?":"+i:"")+"@"),g+=vg(a),c!==null&&(g+=":"+c)):t==="file"&&(g+="//"),g+=e.cannotBeABaseURL?d[0]:d.length?"/"+_g(d,"/"):"",h!==null&&(g+="?"+h),m!==null&&(g+="#"+m),g},setHref:function(e){var t=this.parse(e);if(t)throw new sC(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new wp(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+vg(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Bc(e)+":",dC)},getUsername:function(){return this.username},setUsername:function(e){var t=Tp(Bc(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=Jl(t[n],lC)}},getPassword:function(){return this.password},setPassword:function(e){var t=Tp(Bc(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=Jl(t[n],lC)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?vg(e):vg(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,pC)},getHostname:function(){var e=this.host;return e===null?"":vg(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,mC)},getPort:function(){var e=this.port;return e===null?"":Bc(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Bc(e))===""?this.port=null:this.parse(e,fC))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+_g(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Rp))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Bc(e))===""?this.query=null:(Ao(e,0)==="?"&&(e=Eg(e,1)),this.query="",this.parse(e,wu)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Bc(e))!==""?(Ao(e,0)==="#"&&(e=Eg(e,1)),this.fragment="",this.parse(e,Gc)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var wp=function(e){var t=qee(this,ys),n=Qee(arguments.length,1)>1?arguments[1]:void 0,i=$ee(t,new EC(e,!1,n));tC||(t.href=i.serialize(),t.origin=i.getOrigin(),t.protocol=i.getProtocol(),t.username=i.getUsername(),t.password=i.getPassword(),t.host=i.getHost(),t.hostname=i.getHostname(),t.port=i.getPort(),t.pathname=i.getPathname(),t.search=i.getSearch(),t.searchParams=i.getSearchParams(),t.hash=i.getHash())},ys=wp.prototype,No=function(e,t){return{get:function(){return by(this)[e]()},set:t&&function(n){return by(this)[t](n)},configurable:!0,enumerable:!0}};if(tC&&(Io(ys,"href",No("serialize","setHref")),Io(ys,"origin",No("getOrigin")),Io(ys,"protocol",No("getProtocol","setProtocol")),Io(ys,"username",No("getUsername","setUsername")),Io(ys,"password",No("getPassword","setPassword")),Io(ys,"host",No("getHost","setHost")),Io(ys,"hostname",No("getHostname","setHostname")),Io(ys,"port",No("getPort","setPort")),Io(ys,"pathname",No("getPathname","setPathname")),Io(ys,"search",No("getSearch","setSearch")),Io(ys,"searchParams",No("getSearchParams")),Io(ys,"hash",No("getHash","setHash"))),Ty(ys,"toJSON",function(){return by(this).serialize()},{enumerable:!0}),Ty(ys,"toString",function(){return by(this).serialize()},{enumerable:!0}),gg){var y2=gg.createObjectURL,S2=gg.revokeObjectURL;y2&&Ty(wp,"createObjectURL",r2(y2,gg)),S2&&Ty(wp,"revokeObjectURL",r2(S2,gg))}Jee(wp,"URL"),Hee({global:!0,forced:!Kee,sham:!tC},{URL:wp});var _te=Lt,T2=f,Ete=yu,b2=_s,vte=gy,vC=Tr("URL"),yte=vte&&T2(function(){vC.canParse()}),Ste=T2(function(){return vC.canParse.length!==1});_te({target:"URL",stat:!0,forced:!yte||Ste},{canParse:function(e){var t=Ete(arguments.length,1),n=b2(e),i=t<2||arguments[1]===void 0?void 0:b2(arguments[1]);try{return!!new vC(n,i)}catch{return!1}}});var Tte=Lt,bte=yu,R2=_s,Rte=gy,wte=Tr("URL");Tte({target:"URL",stat:!0,forced:!Rte},{parse:function(e){var t=bte(arguments.length,1),n=R2(e),i=t<2||arguments[1]===void 0?void 0:R2(arguments[1]);try{return new wte(n,i)}catch{return null}}});var xy=u(qt.URL);let w2=!0,C2=!0;function Oy(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function Cu(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,a=i.addEventListener;i.addEventListener=function(d,h){if(d!==t)return a.apply(this,arguments);const m=g=>{const _=n(g);_&&(h.handleEvent?h.handleEvent(_):h(_))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(h,m),a.apply(this,[d,m])};const c=i.removeEventListener;i.removeEventListener=function(d,h){if(d!==t||!this._eventMap||!this._eventMap[t])return c.apply(this,arguments);if(!this._eventMap[t].has(h))return c.apply(this,arguments);const m=this._eventMap[t].get(h);return this._eventMap[t].delete(h),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,c.apply(this,[d,m])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(d){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),d&&this.addEventListener(t,this["_on"+t]=d)},enumerable:!0,configurable:!0})}function Cte(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(w2=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Ite(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(C2=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function I2(){if(typeof window=="object"){if(w2)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function yC(e,t){C2&&console.warn(e+" is deprecated, please use "+t+" instead.")}function A2(e){return Object.prototype.toString.call(e)==="[object Object]"}function N2(e){var t;return A2(e)?to(t=Object.keys(e)).call(t,function(n,i){const a=A2(e[i]),c=a?N2(e[i]):e[i],d=a&&!Object.keys(c).length;return c===void 0||d?n:Object.assign(n,{[i]:c})},{}):e}function SC(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?SC(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach(a=>{SC(e,e.get(a),n)})}))}function x2(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",a=new Map;if(t===null)return a;const c=[];return e.forEach(d=>{d.type==="track"&&d.trackIdentifier===t.id&&c.push(d)}),c.forEach(d=>{e.forEach(h=>{h.type===i&&h.trackId===d.id&&SC(e,h,a)})}),a}const O2=I2;function P2(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(d){if(typeof d!="object"||d.mandatory||d.optional)return d;const h={};return Object.keys(d).forEach(m=>{if(m==="require"||m==="advanced"||m==="mediaSource")return;const g=typeof d[m]=="object"?d[m]:{ideal:d[m]};g.exact!==void 0&&typeof g.exact=="number"&&(g.min=g.max=g.exact);const _=function(v,y){return v?v+y.charAt(0).toUpperCase()+y.slice(1):y==="deviceId"?"sourceId":y};if(g.ideal!==void 0){h.optional=h.optional||[];let v={};typeof g.ideal=="number"?(v[_("min",m)]=g.ideal,h.optional.push(v),v={},v[_("max",m)]=g.ideal,h.optional.push(v)):(v[_("",m)]=g.ideal,h.optional.push(v))}g.exact!==void 0&&typeof g.exact!="number"?(h.mandatory=h.mandatory||{},h.mandatory[_("",m)]=g.exact):["min","max"].forEach(v=>{g[v]!==void 0&&(h.mandatory=h.mandatory||{},h.mandatory[_(v,m)]=g[v])})}),d.advanced&&(h.optional=(h.optional||[]).concat(d.advanced)),h},a=function(d,h){if(t.version>=61)return h(d);if((d=JSON.parse(JSON.stringify(d)))&&typeof d.audio=="object"){const m=function(g,_,v){_ in g&&!(v in g)&&(g[v]=g[_],delete g[_])};m((d=JSON.parse(JSON.stringify(d))).audio,"autoGainControl","googAutoGainControl"),m(d.audio,"noiseSuppression","googNoiseSuppression"),d.audio=i(d.audio)}if(d&&typeof d.video=="object"){let m=d.video.facingMode;m=m&&(typeof m=="object"?m:{ideal:m});const g=t.version<66;if(m&&(m.exact==="user"||m.exact==="environment"||m.ideal==="user"||m.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||g)){let _;if(delete d.video.facingMode,m.exact==="environment"||m.ideal==="environment"?_=["back","rear"]:m.exact!=="user"&&m.ideal!=="user"||(_=["front"]),_)return n.mediaDevices.enumerateDevices().then(v=>{v=v.filter(b=>b.kind==="videoinput");let y=v.find(b=>_.some(O=>{var I;return ve(I=b.label.toLowerCase()).call(I,O)}));return!y&&v.length&&ve(_).call(_,"back")&&(y=v[v.length-1]),y&&(d.video.deviceId=m.exact?{exact:y.deviceId}:{ideal:y.deviceId}),d.video=i(d.video),O2("chrome: "+JSON.stringify(d)),h(d)})}d.video=i(d.video)}return O2("chrome: "+JSON.stringify(d)),h(d)},c=function(d){return t.version>=64?d:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[d.name]||d.name,message:d.message,constraint:d.constraint||d.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(d,h,m){a(d,g=>{n.webkitGetUserMedia(g,h,_=>{m&&m(c(_))})})}).bind(n),n.mediaDevices.getUserMedia){const d=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(h){return a(h,m=>d(m).then(g=>{if(m.audio&&!g.getAudioTracks().length||m.video&&!g.getVideoTracks().length)throw g.getTracks().forEach(_=>{_.stop()}),new DOMException("","NotFoundError");return g},g=>we.reject(c(g))))}}}function D2(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function k2(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let a;a=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(d=>d.track&&d.track.id===i.track.id):{track:i.track};const c=new Event("track");c.track=i.track,c.receiver=a,c.transceiver={receiver:a},c.streams=[n.stream],this.dispatchEvent(c)}),n.stream.getTracks().forEach(i=>{let a;a=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(d=>d.track&&d.track.id===i.id):{track:i};const c=new Event("track");c.track=i,c.receiver=a,c.transceiver={receiver:a},c.streams=[n.stream],this.dispatchEvent(c)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Cu(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function L2(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(a,c){return{track:c,get dtmf(){return this._dtmf===void 0&&(c.kind==="audio"?this._dtmf=a.createDTMFSender(c):this._dtmf=null),this._dtmf},_pc:a}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const a=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(d,h){let m=a.apply(this,arguments);return m||(m=t(this,d),this._senders.push(m)),m};const c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(d){c.apply(this,arguments);const h=this._senders.indexOf(d);h!==-1&&this._senders.splice(h,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(a){this._senders=this._senders||[],n.apply(this,[a]),a.getTracks().forEach(c=>{this._senders.push(t(this,c))})};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(a){this._senders=this._senders||[],i.apply(this,[a]),a.getTracks().forEach(c=>{const d=this._senders.find(h=>h.track===c);d&&this._senders.splice(this._senders.indexOf(d),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function M2(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,i,a]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const c=function(h){const m={};return h.result().forEach(g=>{const _={id:g.id,timestamp:g.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[g.type]||g.type};g.names().forEach(v=>{_[v]=g.stat(v)}),m[_.id]=_}),m},d=function(h){return new Map(Object.keys(h).map(m=>[m,h[m]]))};if(arguments.length>=2){const h=function(m){i(d(c(m)))};return t.apply(this,[h,n])}return new we((h,m)=>{t.apply(this,[function(g){h(d(c(g)))},m])}).then(i,a)}}function U2(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const a=n.apply(this,[]);return a.forEach(c=>c._pc=this),a});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const a=i.apply(this,arguments);return a._pc=this,a}),e.RTCRtpSender.prototype.getStats=function(){const a=this;return this._pc.getStats().then(c=>x2(c,a.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(a=>a._pc=this),i}),Cu(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(a=>x2(a,i.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let i,a,c;return this.getSenders().forEach(d=>{d.track===n&&(i?c=!0:i=d)}),this.getReceivers().forEach(d=>(d.track===n&&(a?c=!0:a=d),d.track===n)),c||i&&a?we.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():a?a.getStats():we.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function j2(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(c=>this._shimmedLocalStreams[c][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(c,d){if(!d)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const h=t.apply(this,arguments);return this._shimmedLocalStreams[d.id]?this._shimmedLocalStreams[d.id].indexOf(h)===-1&&this._shimmedLocalStreams[d.id].push(h):this._shimmedLocalStreams[d.id]=[d,h],h};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._shimmedLocalStreams=this._shimmedLocalStreams||{},c.getTracks().forEach(m=>{if(this.getSenders().find(_=>_.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});const d=this.getSenders();n.apply(this,arguments);const h=this.getSenders().filter(m=>d.indexOf(m)===-1);this._shimmedLocalStreams[c.id]=[c].concat(h)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[c.id],i.apply(this,arguments)};const a=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},c&&Object.keys(this._shimmedLocalStreams).forEach(d=>{const h=this._shimmedLocalStreams[d].indexOf(c);h!==-1&&this._shimmedLocalStreams[d].splice(h,1),this._shimmedLocalStreams[d].length===1&&delete this._shimmedLocalStreams[d]}),a.apply(this,arguments)}}function V2(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return j2(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const m=n.apply(this);return this._reverseStreams=this._reverseStreams||{},m.map(g=>this._reverseStreams[g.id])};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(m){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(g=>{if(this.getSenders().find(v=>v.track===g))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){const g=new e.MediaStream(m.getTracks());this._streams[m.id]=g,this._reverseStreams[g.id]=m,m=g}i.apply(this,[m])};const a=e.RTCPeerConnection.prototype.removeStream;function c(m,g){let _=g.sdp;return Object.keys(m._reverseStreams||[]).forEach(v=>{const y=m._reverseStreams[v],b=m._streams[y.id];_=_.replace(new RegExp(b.id,"g"),y.id)}),new RTCSessionDescription({type:g.type,sdp:_})}e.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},a.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},e.RTCPeerConnection.prototype.addTrack=function(m,g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const _=[].slice.call(arguments,1);if(_.length!==1||!_[0].getTracks().find(b=>b===m))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(b=>b.track===m))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const y=this._streams[g.id];if(y)y.addTrack(m),we.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const b=new e.MediaStream([m]);this._streams[g.id]=b,this._reverseStreams[b.id]=g,this.addStream(b)}return this.getSenders().find(b=>b.track===m)},["createOffer","createAnswer"].forEach(function(m){const g=e.RTCPeerConnection.prototype[m],_={[m](){const v=arguments;return arguments.length&&typeof arguments[0]=="function"?g.apply(this,[y=>{const b=c(this,y);v[0].apply(null,[b])},y=>{v[1]&&v[1].apply(null,y)},arguments[2]]):g.apply(this,arguments).then(y=>c(this,y))}};e.RTCPeerConnection.prototype[m]=_[m]});const d=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(m,g){let _=g.sdp;return Object.keys(m._reverseStreams||[]).forEach(v=>{const y=m._reverseStreams[v],b=m._streams[y.id];_=_.replace(new RegExp(y.id,"g"),b.id)}),new RTCSessionDescription({type:g.type,sdp:_})}(this,arguments[0]),d.apply(this,arguments)):d.apply(this,arguments)};const h=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const m=h.get.apply(this);return m.type===""?m:c(this,m)}}),e.RTCPeerConnection.prototype.removeTrack=function(m){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(m._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let g;this._streams=this._streams||{},Object.keys(this._streams).forEach(_=>{this._streams[_].getTracks().find(v=>m.track===v)&&(g=this._streams[_])}),g&&(g.getTracks().length===1?this.removeStream(this._reverseStreams[g.id]):g.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}function TC(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=e.RTCPeerConnection.prototype[n],a={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=a[n]})}function F2(e,t){Cu(e,"negotiationneeded",n=>{const i=n.target;if(!(t.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return n})}var B2=Object.freeze({__proto__:null,fixNegotiationNeeded:F2,shimAddTrackRemoveTrack:V2,shimAddTrackRemoveTrackWithNative:j2,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(i=>{const a=n.video&&n.video.width,c=n.video&&n.video.height,d=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:d||3}},a&&(n.video.mandatory.maxWidth=a),c&&(n.video.mandatory.maxHeight=c),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:L2,shimGetStats:M2,shimGetUserMedia:P2,shimMediaStream:D2,shimOnTrack:k2,shimPeerConnection:TC,shimSenderReceiverGetStats:U2});function G2(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(a,c,d){yC("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(a).then(c,d)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const a=function(d,h,m){h in d&&!(m in d)&&(d[m]=d[h],delete d[h])},c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(d){return typeof d=="object"&&typeof d.audio=="object"&&(d=JSON.parse(JSON.stringify(d)),a(d.audio,"autoGainControl","mozAutoGainControl"),a(d.audio,"noiseSuppression","mozNoiseSuppression")),c(d)},i&&i.prototype.getSettings){const d=i.prototype.getSettings;i.prototype.getSettings=function(){const h=d.apply(this,arguments);return a(h,"mozAutoGainControl","autoGainControl"),a(h,"mozNoiseSuppression","noiseSuppression"),h}}if(i&&i.prototype.applyConstraints){const d=i.prototype.applyConstraints;i.prototype.applyConstraints=function(h){return this.kind==="audio"&&typeof h=="object"&&(h=JSON.parse(JSON.stringify(h)),a(h,"autoGainControl","mozAutoGainControl"),a(h,"noiseSuppression","mozNoiseSuppression")),d.apply(this,[h])}}}}function W2(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function bC(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){const c=e.RTCPeerConnection.prototype[a],d={[a](){return arguments[0]=new(a==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}};e.RTCPeerConnection.prototype[a]=d[a]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[a,c,d]=arguments;return i.apply(this,[a||null]).then(h=>{if(t.version<53&&!c)try{h.forEach(m=>{m.type=n[m.type]||m.type})}catch(m){if(m.name!=="TypeError")throw m;h.forEach((g,_)=>{h.set(_,Object.assign({},g,{type:n[g.type]||g.type}))})}return h}).then(c,d)}}function z2(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(a=>a._pc=this),i});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):we.resolve(new Map)}}function H2(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n}),Cu(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function K2(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){yC("removeStream","removeTrack"),this.getSenders().forEach(n=>{var i;n.track&&ve(i=t.getTracks()).call(i,n.track)&&this.removeTrack(n)})})}function q2(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Y2(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const i=n.length>0;i&&n.forEach(c=>{if("rid"in c&&!/^[a-z0-9]{0,16}$/i.test(c.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in c&&!(parseFloat(c.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in c&&!(parseFloat(c.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const a=t.apply(this,arguments);if(i){const{sender:c}=a,d=c.getParameters();(!("encodings"in d)||d.encodings.length===1&&Object.keys(d.encodings[0]).length===0)&&(d.encodings=n,c.sendEncodings=n,this.setParametersPromises.push(c.setParameters(d).then(()=>{delete c.sendEncodings}).catch(()=>{delete c.sendEncodings})))}return a})}function X2(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function J2(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?we.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function Q2(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?we.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var $2=Object.freeze({__proto__:null,shimAddTransceiver:Y2,shimCreateAnswer:Q2,shimCreateOffer:J2,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,we.reject(i)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:X2,shimGetUserMedia:G2,shimOnTrack:W2,shimPeerConnection:bC,shimRTCDataChannel:q2,shimReceiverGetStats:H2,shimRemoveStream:K2,shimSenderGetStats:z2});function Z2(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){var i;this._localStreams||(this._localStreams=[]),ve(i=this._localStreams).call(i,n)||this._localStreams.push(n),n.getAudioTracks().forEach(a=>t.call(this,a,n)),n.getVideoTracks().forEach(a=>t.call(this,a,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var i=arguments.length,a=new Array(i>1?i-1:0),c=1;c<i;c++)a[c-1]=arguments[c];return a&&a.forEach(d=>{var h;this._localStreams?ve(h=this._localStreams).call(h,d)||this._localStreams.push(d):this._localStreams=[d]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const i=t.getTracks();this.getSenders().forEach(a=>{ve(i).call(i,a.track)&&this.removeTrack(a)})})}}function eM(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(a=>{var c;if(this._remoteStreams||(this._remoteStreams=[]),ve(c=this._remoteStreams).call(c,a))return;this._remoteStreams.push(a);const d=new Event("addstream");d.stream=a,this.dispatchEvent(d)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(a=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(a)>=0)return;n._remoteStreams.push(a);const c=new Event("addstream");c.stream=a,n.dispatchEvent(c)})}),t.apply(n,arguments)}}}function tM(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,a=t.setLocalDescription,c=t.setRemoteDescription,d=t.addIceCandidate;t.createOffer=function(m,g){const _=arguments.length>=2?arguments[2]:arguments[0],v=n.apply(this,[_]);return g?(v.then(m,g),we.resolve()):v},t.createAnswer=function(m,g){const _=arguments.length>=2?arguments[2]:arguments[0],v=i.apply(this,[_]);return g?(v.then(m,g),we.resolve()):v};let h=function(m,g,_){const v=a.apply(this,[m]);return _?(v.then(g,_),we.resolve()):v};t.setLocalDescription=h,h=function(m,g,_){const v=c.apply(this,[m]);return _?(v.then(g,_),we.resolve()):v},t.setRemoteDescription=h,h=function(m,g,_){const v=d.apply(this,[m]);return _?(v.then(g,_),we.resolve()):v},t.addIceCandidate=h}function nM(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,i=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=a=>i(rM(a))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(n,i,a){t.mediaDevices.getUserMedia(n).then(i,a)}).bind(t))}function rM(e){return e&&e.video!==void 0?Object.assign({},e,{video:N2(e.video)}):e}function iM(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const a=[];for(let c=0;c<n.iceServers.length;c++){let d=n.iceServers[c];!d.hasOwnProperty("urls")&&d.hasOwnProperty("url")?(yC("RTCIceServer.url","RTCIceServer.urls"),d=JSON.parse(JSON.stringify(d)),d.urls=d.url,delete d.url,a.push(d)):a.push(n.iceServers[c])}n.iceServers=a}return new t(n,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function sM(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function oM(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(c=>c.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const a=this.getTransceivers().find(c=>c.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):n.offerToReceiveVideo!==!0||a||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function aM(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var cM=Object.freeze({__proto__:null,shimAudioContext:aM,shimCallbacksAPI:tM,shimConstraints:rM,shimCreateOfferLegacy:oM,shimGetUserMedia:nM,shimLocalStreamsAPI:Z2,shimRTCIceServerUrls:iM,shimRemoteStreamsAPI:eM,shimTrackEventTransceiver:sM}),lM=`	
\v\f\r \u2028\u2029\uFEFF`,Ate=$n,Nte=_s,RC=lM,dM=M("".replace),xte=RegExp("^["+RC+"]+"),Ote=RegExp("(^|[^"+RC+"])["+RC+"]+$"),Pte=function(e){return function(t){var n=Nte(Ate(t));return 1&e&&(n=dM(n,xte,"")),2&e&&(n=dM(n,Ote,"$1")),n}},Dte={trim:Pte(3)},kte=Kk.PROPER,Lte=f,uM=lM,Mte=Dte.trim;Lt({target:"String",proto:!0,forced:function(e){return Lte(function(){return!!uM[e]()||""[e]()!==""||kte&&uM[e].name!==e})}("trim")},{trim:function(){return Mte(this)}});var Ute=eo("String","trim"),jte=F,Vte=Ute,wC=String.prototype,Fte=function(e){var t=e.trim;return typeof e=="string"||e===wC||jte(wC,e)&&t===wC.trim?Vte:t},bi=u(Fte),hM={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},t.splitSections=function(n){return n.split(`
m=`).map((i,a)=>(a>0?"m="+i:i).trim()+`\r
`)},t.getDescription=function(n){const i=t.splitSections(n);return i&&i[0]},t.getMediaSections=function(n){const i=t.splitSections(n);return i.shift(),i},t.matchPrefix=function(n,i){return t.splitLines(n).filter(a=>a.indexOf(i)===0)},t.parseCandidate=function(n){let i;i=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const a={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let c=8;c<i.length;c+=2)switch(i[c]){case"raddr":a.relatedAddress=i[c+1];break;case"rport":a.relatedPort=parseInt(i[c+1],10);break;case"tcptype":a.tcpType=i[c+1];break;case"ufrag":a.ufrag=i[c+1],a.usernameFragment=i[c+1];break;default:a[i[c]]===void 0&&(a[i[c]]=i[c+1])}return a},t.writeCandidate=function(n){const i=[];i.push(n.foundation);const a=n.component;a==="rtp"?i.push(1):a==="rtcp"?i.push(2):i.push(a),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const c=n.type;return i.push("typ"),i.push(c),c!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let i=n.substring(9).split(" ");const a={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),a.name=i[0],a.clockRate=parseInt(i[1],10),a.channels=i.length===3?parseInt(i[2],10):1,a.numChannels=a.channels,a},t.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const a=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(a!==1?"/"+a:"")+`\r
`},t.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const i={};let a;const c=n.substring(n.indexOf(" ")+1).split(";");for(let d=0;d<c.length;d++)a=c[d].trim().split("="),i[a[0].trim()]=a[1];return i},t.writeFmtp=function(n){let i="",a=n.payloadType;if(n.preferredPayloadType!==void 0&&(a=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const c=[];Object.keys(n.parameters).forEach(d=>{n.parameters[d]!==void 0?c.push(d+"="+n.parameters[d]):c.push(d)}),i+="a=fmtp:"+a+" "+c.join(";")+`\r
`}return i},t.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},t.writeRtcpFb=function(n){let i="",a=n.payloadType;return n.preferredPayloadType!==void 0&&(a=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(c=>{i+="a=rtcp-fb:"+a+" "+c.type+(c.parameter&&c.parameter.length?" "+c.parameter:"")+`\r
`}),i},t.parseSsrcMedia=function(n){const i=n.indexOf(" "),a={ssrc:parseInt(n.substring(7,i),10)},c=n.indexOf(":",i);return c>-1?(a.attribute=n.substring(i+1,c),a.value=n.substring(c+1)):a.attribute=n.substring(i+1),a},t.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(a=>parseInt(a,10))}},t.getMid=function(n){const i=t.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},t.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},t.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:t.matchPrefix(n+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,i){let a="a=setup:"+i+`\r
`;return n.fingerprints.forEach(c=>{a+="a=fingerprint:"+c.algorithm+" "+c.value+`\r
`}),a},t.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,i){return t.matchPrefix(n+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,i){const a=t.matchPrefix(n+i,"a=ice-ufrag:")[0],c=t.matchPrefix(n+i,"a=ice-pwd:")[0];return a&&c?{usernameFragment:a.substring(12),password:c.substring(10)}:null},t.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},t.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},a=t.splitLines(n)[0].split(" ");i.profile=a[2];for(let d=3;d<a.length;d++){const h=a[d],m=t.matchPrefix(n,"a=rtpmap:"+h+" ")[0];if(m){const g=t.parseRtpMap(m),_=t.matchPrefix(n,"a=fmtp:"+h+" ");switch(g.parameters=_.length?t.parseFmtp(_[0]):{},g.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+h+" ").map(t.parseRtcpFb),i.codecs.push(g),g.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(g.name.toUpperCase())}}}t.matchPrefix(n,"a=extmap:").forEach(d=>{i.headerExtensions.push(t.parseExtmap(d))});const c=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return i.codecs.forEach(d=>{c.forEach(h=>{d.rtcpFeedback.find(m=>m.type===h.type&&m.parameter===h.parameter)||d.rtcpFeedback.push(h)})}),i},t.writeRtpDescription=function(n,i){let a="";a+="m="+n+" ",a+=i.codecs.length>0?"9":"0",a+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",a+=i.codecs.map(d=>d.preferredPayloadType!==void 0?d.preferredPayloadType:d.payloadType).join(" ")+`\r
`,a+=`c=IN IP4 0.0.0.0\r
`,a+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(d=>{a+=t.writeRtpMap(d),a+=t.writeFmtp(d),a+=t.writeRtcpFb(d)});let c=0;return i.codecs.forEach(d=>{d.maxptime>c&&(c=d.maxptime)}),c>0&&(a+="a=maxptime:"+c+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(d=>{a+=t.writeExtmap(d)}),a},t.parseRtpEncodingParameters=function(n){const i=[],a=t.parseRtpParameters(n),c=a.fecMechanisms.indexOf("RED")!==-1,d=a.fecMechanisms.indexOf("ULPFEC")!==-1,h=t.matchPrefix(n,"a=ssrc:").map(y=>t.parseSsrcMedia(y)).filter(y=>y.attribute==="cname"),m=h.length>0&&h[0].ssrc;let g;const _=t.matchPrefix(n,"a=ssrc-group:FID").map(y=>y.substring(17).split(" ").map(b=>parseInt(b,10)));_.length>0&&_[0].length>1&&_[0][0]===m&&(g=_[0][1]),a.codecs.forEach(y=>{if(y.name.toUpperCase()==="RTX"&&y.parameters.apt){let b={ssrc:m,codecPayloadType:parseInt(y.parameters.apt,10)};m&&g&&(b.rtx={ssrc:g}),i.push(b),c&&(b=JSON.parse(JSON.stringify(b)),b.fec={ssrc:m,mechanism:d?"red+ulpfec":"red"},i.push(b))}}),i.length===0&&m&&i.push({ssrc:m});let v=t.matchPrefix(n,"b=");return v.length&&(v=v[0].indexOf("b=TIAS:")===0?parseInt(v[0].substring(7),10):v[0].indexOf("b=AS:")===0?1e3*parseInt(v[0].substring(5),10)*.95-16e3:void 0,i.forEach(y=>{y.maxBitrate=v})),i},t.parseRtcpParameters=function(n){const i={},a=t.matchPrefix(n,"a=ssrc:").map(h=>t.parseSsrcMedia(h)).filter(h=>h.attribute==="cname")[0];a&&(i.cname=a.value,i.ssrc=a.ssrc);const c=t.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=c.length>0,i.compound=c.length===0;const d=t.matchPrefix(n,"a=rtcp-mux");return i.mux=d.length>0,i},t.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},t.parseMsid=function(n){let i;const a=t.matchPrefix(n,"a=msid:");if(a.length===1)return i=a[0].substring(7).split(" "),{stream:i[0],track:i[1]};const c=t.matchPrefix(n,"a=ssrc:").map(d=>t.parseSsrcMedia(d)).filter(d=>d.attribute==="msid");return c.length>0?(i=c[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},t.parseSctpDescription=function(n){const i=t.parseMLine(n),a=t.matchPrefix(n,"a=max-message-size:");let c;a.length>0&&(c=parseInt(a[0].substring(19),10)),isNaN(c)&&(c=65536);const d=t.matchPrefix(n,"a=sctp-port:");if(d.length>0)return{port:parseInt(d[0].substring(12),10),protocol:i.fmt,maxMessageSize:c};const h=t.matchPrefix(n,"a=sctpmap:");if(h.length>0){const m=h[0].substring(10).split(" ");return{port:parseInt(m[0],10),protocol:m[1],maxMessageSize:c}}},t.writeSctpDescription=function(n,i){let a=[];return a=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&a.push("a=max-message-size:"+i.maxMessageSize+`\r
`),a.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,i,a){let c;const d=i!==void 0?i:2;return c=n||t.generateSessionId(),`v=0\r
o=`+(a||"thisisadapterortc")+" "+c+" "+d+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,i){const a=t.splitLines(n);for(let c=0;c<a.length;c++)switch(a[c]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return a[c].substring(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const i=t.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(n){const i=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=t.splitLines(n);for(let a=0;a<i.length;a++)if(i[a].length<2||i[a].charAt(1)!=="=")return!1;return!0},e.exports=t})(hM);var pM=hM.exports,Cp=u(pM),Bte=o({__proto__:null,default:Cp},[pM]);function Py(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new t(n),a=Cp.parseCandidate(n.candidate),c=Object.assign(i,a);return c.toJSON=function(){return{candidate:c.candidate,sdpMid:c.sdpMid,sdpMLineIndex:c.sdpMLineIndex,usernameFragment:c.usernameFragment}},c}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,Cu(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function CC(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Cu(e,"icecandidate",t=>{if(t.candidate){const n=Cp.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function Dy(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(h){if(!h||!h.sdp)return!1;const m=Cp.splitSections(h.sdp);return m.shift(),m.some(g=>{const _=Cp.parseMLine(g);return _&&_.kind==="application"&&_.protocol.indexOf("SCTP")!==-1})},i=function(h){const m=h.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(m===null||m.length<2)return-1;const g=parseInt(m[1],10);return g!=g?-1:g},a=function(h){let m=65536;return t.browser==="firefox"&&(m=t.version<57?h===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),m},c=function(h,m){let g=65536;t.browser==="firefox"&&t.version===57&&(g=65535);const _=Cp.matchPrefix(h.sdp,"a=max-message-size:");return _.length>0?g=parseInt(_[0].substr(19),10):t.browser==="firefox"&&m!==-1&&(g=2147483637),g},d=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:h}=this.getConfiguration();h==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const h=i(arguments[0]),m=a(h),g=c(arguments[0],h);let _;_=m===0&&g===0?Number.POSITIVE_INFINITY:m===0||g===0?Math.max(m,g):Math.min(m,g);const v={};Object.defineProperty(v,"maxMessageSize",{get:()=>_}),this._sctp=v}return d.apply(this,arguments)}}function ky(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(i,a){const c=i.send;i.send=function(){const d=arguments[0],h=d.length||d.size||d.byteLength;if(i.readyState==="open"&&a.sctp&&h>a.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+a.sctp.maxMessageSize+" bytes)");return c.apply(i,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return t(i,this),i},Cu(e,"datachannel",i=>(t(i.channel,i.target),i))}function IC(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=a=>{const c=a.target;if(c._lastConnectionState!==c.connectionState){c._lastConnectionState=c.connectionState;const d=new Event("connectionstatechange",a);c.dispatchEvent(d)}return a},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function AC(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const a=i.sdp.split(`
`).filter(c=>bi(c).call(c)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:a}):i.sdp=a}return n.apply(this,arguments)}}function Ly(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?we.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),we.resolve())})}function My(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>n.apply(this,[a]))})}var Gte=Object.freeze({__proto__:null,removeExtmapAllowMixed:AC,shimAddIceCandidateNullOrEmpty:Ly,shimConnectionState:IC,shimMaxMessageSize:Dy,shimParameterlessSetLocalDescription:My,shimRTCIceCandidate:Py,shimRTCIceCandidateRelayProtocol:CC,shimSendThrowTypeError:ky});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=I2,i=function(c){const d={browser:null,version:null};if(c===void 0||!c.navigator)return d.browser="Not a browser.",d;const{navigator:h}=c;if(h.mozGetUserMedia)d.browser="firefox",d.version=Oy(h.userAgent,/Firefox\/(\d+)\./,1);else if(h.webkitGetUserMedia||c.isSecureContext===!1&&c.webkitRTCPeerConnection)d.browser="chrome",d.version=Oy(h.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!c.RTCPeerConnection||!h.userAgent.match(/AppleWebKit\/(\d+)\./))return d.browser="Not a supported browser.",d;d.browser="safari",d.version=Oy(h.userAgent,/AppleWebKit\/(\d+)\./,1),d.supportsUnifiedPlan=c.RTCRtpTransceiver&&"currentDirection"in c.RTCRtpTransceiver.prototype}return d}(e),a={browserDetails:i,commonShim:Gte,extractVersion:Oy,disableLog:Cte,disableWarnings:Ite,sdp:Bte};switch(i.browser){case"chrome":if(!B2||!TC||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),a;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),a;n("adapter.js shimming chrome."),a.browserShim=B2,Ly(e,i),My(e),P2(e,i),D2(e),TC(e,i),k2(e),V2(e,i),L2(e),M2(e),U2(e),F2(e,i),Py(e),CC(e),IC(e),Dy(e,i),ky(e),AC(e,i);break;case"firefox":if(!$2||!bC||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),a;n("adapter.js shimming firefox."),a.browserShim=$2,Ly(e,i),My(e),G2(e,i),bC(e,i),W2(e),K2(e),z2(e),H2(e),q2(e),Y2(e),X2(e),J2(e),Q2(e),Py(e),IC(e),Dy(e,i),ky(e);break;case"safari":if(!cM||!t.shimSafari)return n("Safari shim is not included in this adapter release."),a;n("adapter.js shimming safari."),a.browserShim=cM,Ly(e,i),My(e),iM(e),oM(e),tM(e),Z2(e),eM(e),sM(e),nM(e),aM(e),Py(e),CC(e),Dy(e,i),ky(e),AC(e,i);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var Wte=f,mM=J.RegExp,zte=!Wte(function(){var e=!0;try{mM(".","d")}catch{e=!1}var t={},n="",i=e?"dgimsy":"gimsy",a=function(h,m){Object.defineProperty(t,h,{get:function(){return n+=m,!0}})},c={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var d in e&&(c.hasIndices="d"),c)a(d,c[d]);return Object.getOwnPropertyDescriptor(mM.prototype,"flags").get.call(t)!==i||n!==i}),Hte=yi,Kte=It,qte=br,Yte=F,fM={correct:zte},Xte=function(){var e=Hte(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},Jte=RegExp.prototype,NC=fM.correct?function(e){return e.flags}:function(e){return fM.correct||!Yte(Jte,e)||qte(e,"flags")?e.flags:Kte(Xte,e)},xC=M,Qte=Math.floor,OC=xC("".charAt),$te=xC("".replace),PC=xC("".slice),Zte=/\$([$&'`]|\d{1,2})/g,ene=Lt,tne=It,DC=M,gM=$n,nne=ue,rne=kt,ine=LR,Ip=_s,sne=ta,one=NC,ane=function(e,t,n,i,a,c){var d=n+e.length,h=i.length,m=Zte;return $te(c,m,function(g,_){var v;switch(OC(_,0)){case"$":return"$";case"&":return e;case"`":return PC(t,0,n);case"'":return PC(t,d);case"<":v=a[PC(_,1,-1)];break;default:var y=+_;if(y===0)return g;if(y>h){var b=Qte(y/10);return b===0?g:b<=h?i[b-1]===void 0?OC(_,1):i[b-1]+OC(_,1):g}v=i[y-1]}return v===void 0?"":v})},cne=Mn("replace"),lne=TypeError,kC=DC("".indexOf),dne=DC("".replace),_M=DC("".slice),une=Math.max;ene({target:"String",proto:!0},{replaceAll:function(e,t){var n,i,a,c,d,h,m,g,_,v,y=gM(this),b=0,O="";if(rne(e)){if((n=ine(e))&&(i=Ip(gM(one(e))),!~kC(i,"g")))throw new lne("`.replaceAll` does not allow non-global regexes");if(a=sne(e,cne))return tne(a,e,y,t);if(n)return dne(Ip(y),e,t)}for(c=Ip(y),d=Ip(e),(h=nne(t))||(t=Ip(t)),m=d.length,g=une(1,m),_=kC(c,d);_!==-1;)v=h?Ip(t(d,_,c)):ane(d,c,_,[],void 0,t),O+=_M(c,b,_)+v,b=_+m,_=_+g>c.length?-1:kC(c,d,_+g);return b<c.length&&(O+=_M(c,b)),O}});var hne=eo("String","replaceAll"),pne=F,mne=hne,LC=String.prototype,fne=function(e){var t=e.replaceAll;return typeof e=="string"||e===LC||pne(LC,e)&&t===LC.replaceAll?mne:t},gne=u(fne),MC=J;Lt({global:!0,forced:MC.globalThis!==MC},{globalThis:MC});var EM=u(J),UC={exports:{}};(function(e,t){(function(n,i){var a="function",c="undefined",d="object",h="string",m="major",g="model",_="name",v="type",y="vendor",b="version",O="architecture",I="console",N="mobile",k="tablet",j="smarttv",G="wearable",K="embedded",X="Amazon",z="Apple",ne="ASUS",me="BlackBerry",Ee="Browser",Oe="Chrome",Qe="Firefox",qe="Google",dt="Honor",at="Huawei",Ut="LG",vn="Microsoft",ge="Motorola",Re="Nvidia",ke="OnePlus",_e="Opera",C="OPPO",B="Samsung",H="Sharp",Se="Sony",et="Xiaomi",dn="Zebra",_r="Facebook",po="Chromium OS",_d="Mac OS",MT=" Browser",Tm=function(tr){for(var cr={},gn=0;gn<tr.length;gn++)cr[tr[gn].toUpperCase()]=tr[gn];return cr},UT=function(tr,cr){return typeof tr===h&&lh(cr).indexOf(lh(tr))!==-1},lh=function(tr){return tr.toLowerCase()},b_=function(tr,cr){if(typeof tr===h)return tr=tr.replace(/^\s\s*/,""),typeof cr===c?tr:tr.substring(0,500)},dh=function(tr,cr){for(var gn,rs,Ia,Gn,el,xt,Aa=0;Aa<cr.length&&!el;){var uh=cr[Aa],Ec=cr[Aa+1];for(gn=rs=0;gn<uh.length&&!el&&uh[gn];)if(el=uh[gn++].exec(tr))for(Ia=0;Ia<Ec.length;Ia++)xt=el[++rs],typeof(Gn=Ec[Ia])===d&&Gn.length>0?Gn.length===2?typeof Gn[1]==a?this[Gn[0]]=Gn[1].call(this,xt):this[Gn[0]]=Gn[1]:Gn.length===3?typeof Gn[1]!==a||Gn[1].exec&&Gn[1].test?this[Gn[0]]=xt?xt.replace(Gn[1],Gn[2]):i:this[Gn[0]]=xt?Gn[1].call(this,xt,Gn[2]):i:Gn.length===4&&(this[Gn[0]]=xt?Gn[3].call(this,xt.replace(Gn[1],Gn[2])):i):this[Gn]=xt||i;Aa+=2}},Ed=function(tr,cr){for(var gn in cr)if(typeof cr[gn]===d&&cr[gn].length>0){for(var rs=0;rs<cr[gn].length;rs++)if(UT(cr[gn][rs],tr))return gn==="?"?i:gn}else if(UT(cr[gn],tr))return gn==="?"?i:gn;return cr.hasOwnProperty("*")?cr["*"]:tr},aG={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},cG={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[b,[_,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[b,[_,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[_,b],[/opios[\/ ]+([\w\.]+)/i],[b,[_,_e+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[b,[_,_e+" GX"]],[/\bopr\/([\w\.]+)/i],[b,[_,_e]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[b,[_,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[b,[_,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[_,b],[/quark(?:pc)?\/([-\w\.]+)/i],[b,[_,"Quark"]],[/\bddg\/([\w\.]+)/i],[b,[_,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[b,[_,"UC"+Ee]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[b,[_,"WeChat"]],[/konqueror\/([\w\.]+)/i],[b,[_,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[b,[_,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[b,[_,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[b,[_,"Smart Lenovo "+Ee]],[/(avast|avg)\/([\w\.]+)/i],[[_,/(.+)/,"$1 Secure "+Ee],b],[/\bfocus\/([\w\.]+)/i],[b,[_,Qe+" Focus"]],[/\bopt\/([\w\.]+)/i],[b,[_,_e+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[b,[_,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[b,[_,"Dolphin"]],[/coast\/([\w\.]+)/i],[b,[_,_e+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[b,[_,"MIUI"+MT]],[/fxios\/([\w\.-]+)/i],[b,[_,Qe]],[/\bqihoobrowser\/?([\w\.]*)/i],[b,[_,"360"]],[/\b(qq)\/([\w\.]+)/i],[[_,/(.+)/,"$1Browser"],b],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[_,/(.+)/,"$1"+MT],b],[/samsungbrowser\/([\w\.]+)/i],[b,[_,B+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[b,[_,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[_,"Sogou Mobile"],b],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[_,b],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[_],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[b,_],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[_,_r],b],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[_,b],[/\bgsa\/([\w\.]+) .*safari\//i],[b,[_,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[b,[_,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[b,[_,Oe+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[_,Oe+" WebView"],b],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[b,[_,"Android "+Ee]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[_,b],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[b,[_,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[b,_],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[_,[b,Ed,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[_,b],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[_,"Netscape"],b],[/(wolvic|librewolf)\/([\w\.]+)/i],[_,b],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[b,[_,Qe+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[_,[b,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[_,[b,/master.|lts./,""]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[O,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[O,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[O,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[O,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[O,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[O,/ower/,"",lh]],[/ sun4\w[;\)]/i],[[O,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[O,lh]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[g,[y,B],[v,k]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[g,[y,B],[v,N]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[g,[y,z],[v,N]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[g,[y,z],[v,k]],[/(macintosh);/i],[g,[y,z]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[g,[y,H],[v,N]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[g,[y,dt],[v,k]],[/honor([-\w ]+)[;\)]/i],[g,[y,dt],[v,N]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[g,[y,at],[v,k]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[g,[y,at],[v,N]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[g,/_/g," "],[y,et],[v,k]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[g,/_/g," "],[y,et],[v,N]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[g,[y,C],[v,N]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[g,[y,Ed,{OnePlus:["304","403","203"],"*":C}],[v,k]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[g,[y,"Vivo"],[v,N]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[g,[y,"Realme"],[v,N]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[g,[y,ge],[v,N]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[g,[y,ge],[v,k]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[g,[y,Ut],[v,k]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv|watch)\w+)/i,/\blg-?([\d\w]+) bui/i],[g,[y,Ut],[v,N]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[g,[y,"Lenovo"],[v,k]],[/(nokia) (t[12][01])/i],[y,g,[v,k]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[g,/_/g," "],[v,N],[y,"Nokia"]],[/(pixel (c|tablet))\b/i],[g,[y,qe],[v,k]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[g,[y,qe],[v,N]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[g,[y,Se],[v,N]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[g,"Xperia Tablet"],[y,Se],[v,k]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[g,[y,ke],[v,N]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[g,[y,X],[v,k]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[g,/(.+)/g,"Fire Phone $1"],[y,X],[v,N]],[/(playbook);[-\w\),; ]+(rim)/i],[g,y,[v,k]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[g,[y,me],[v,N]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[g,[y,ne],[v,k]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[g,[y,ne],[v,N]],[/(nexus 9)/i],[g,[y,"HTC"],[v,k]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[y,[g,/_/g," "],[v,N]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[g,[y,"TCL"],[v,k]],[/(itel) ((\w+))/i],[[y,lh],g,[v,Ed,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[g,[y,"Acer"],[v,k]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[g,[y,"Meizu"],[v,N]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[g,[y,"Ulefone"],[v,N]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[g,[y,"Energizer"],[v,N]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[g,[y,"Cat"],[v,N]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[g,[y,"Smartfren"],[v,N]],[/droid.+; (a(?:015|06[35]|142p?))/i],[g,[y,"Nothing"],[v,N]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[g,[y,"Archos"],[v,k]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[g,[y,"Archos"],[v,N]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[y,g,[v,k]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (hmd|imo) ([\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[y,g,[v,N]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[y,g,[v,k]],[/(surface duo)/i],[g,[y,vn],[v,k]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[g,[y,"Fairphone"],[v,N]],[/(u304aa)/i],[g,[y,"AT&T"],[v,N]],[/\bsie-(\w*)/i],[g,[y,"Siemens"],[v,N]],[/\b(rct\w+) b/i],[g,[y,"RCA"],[v,k]],[/\b(venue[\d ]{2,7}) b/i],[g,[y,"Dell"],[v,k]],[/\b(q(?:mv|ta)\w+) b/i],[g,[y,"Verizon"],[v,k]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[g,[y,"Barnes & Noble"],[v,k]],[/\b(tm\d{3}\w+) b/i],[g,[y,"NuVision"],[v,k]],[/\b(k88) b/i],[g,[y,"ZTE"],[v,k]],[/\b(nx\d{3}j) b/i],[g,[y,"ZTE"],[v,N]],[/\b(gen\d{3}) b.+49h/i],[g,[y,"Swiss"],[v,N]],[/\b(zur\d{3}) b/i],[g,[y,"Swiss"],[v,k]],[/\b((zeki)?tb.*\b) b/i],[g,[y,"Zeki"],[v,k]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[y,"Dragon Touch"],g,[v,k]],[/\b(ns-?\w{0,9}) b/i],[g,[y,"Insignia"],[v,k]],[/\b((nxa|next)-?\w{0,9}) b/i],[g,[y,"NextBook"],[v,k]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[y,"Voice"],g,[v,N]],[/\b(lvtel\-)?(v1[12]) b/i],[[y,"LvTel"],g,[v,N]],[/\b(ph-1) /i],[g,[y,"Essential"],[v,N]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[g,[y,"Envizen"],[v,k]],[/\b(trio[-\w\. ]+) b/i],[g,[y,"MachSpeed"],[v,k]],[/\btu_(1491) b/i],[g,[y,"Rotor"],[v,k]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[g,[y,Re],[v,k]],[/(sprint) (\w+)/i],[y,g,[v,N]],[/(kin\.[onetw]{3})/i],[[g,/\./g," "],[y,vn],[v,N]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[g,[y,dn],[v,k]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[g,[y,dn],[v,N]],[/smart-tv.+(samsung)/i],[y,[v,j]],[/hbbtv.+maple;(\d+)/i],[[g,/^/,"SmartTV"],[y,B],[v,j]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[y,Ut],[v,j]],[/(apple) ?tv/i],[y,[g,z+" TV"],[v,j]],[/crkey/i],[[g,Oe+"cast"],[y,qe],[v,j]],[/droid.+aft(\w+)( bui|\))/i],[g,[y,X],[v,j]],[/(shield \w+ tv)/i],[g,[y,Re],[v,j]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[g,[y,H],[v,j]],[/(bravia[\w ]+)( bui|\))/i],[g,[y,Se],[v,j]],[/(mi(tv|box)-?\w+) bui/i],[g,[y,et],[v,j]],[/Hbbtv.*(technisat) (.*);/i],[y,g,[v,j]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[y,b_],[g,b_],[v,j]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[g,[v,j]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[v,j]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[y,g,[v,I]],[/droid.+; (shield)( bui|\))/i],[g,[y,Re],[v,I]],[/(playstation \w+)/i],[g,[y,Se],[v,I]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[g,[y,vn],[v,I]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[g,[y,B],[v,G]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[y,g,[v,G]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[g,[y,C],[v,G]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[g,[y,z],[v,G]],[/(opwwe\d{3})/i],[g,[y,ke],[v,G]],[/(moto 360)/i],[g,[y,ge],[v,G]],[/(smartwatch 3)/i],[g,[y,Se],[v,G]],[/(g watch r)/i],[g,[y,Ut],[v,G]],[/droid.+; (wt63?0{2,3})\)/i],[g,[y,dn],[v,G]],[/droid.+; (glass) \d/i],[g,[y,qe],[v,G]],[/(pico) (4|neo3(?: link|pro)?)/i],[y,g,[v,G]],[/; (quest( \d| pro)?)/i],[g,[y,_r],[v,G]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[y,[v,K]],[/(aeobc)\b/i],[g,[y,X],[v,K]],[/(homepod).+mac os/i],[g,[y,z],[v,K]],[/windows iot/i],[[v,K]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[g,[v,N]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[g,[v,k]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[v,k]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[v,N]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[g,[y,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[b,[_,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[_,b],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[b,[_,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[_,b],[/ladybird\//i],[[_,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[b,_]],os:[[/microsoft (windows) (vista|xp)/i],[_,b],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[_,[b,Ed,aG]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[b,Ed,aG],[_,"Windows"]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[b,/_/g,"."],[_,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[_,_d],[b,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[b,_],[/(ubuntu) ([\w\.]+) like android/i],[[_,/(.+)/,"$1 Touch"],b],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/; ]?([\d\.]*)/i],[_,b],[/\(bb(10);/i],[b,[_,me]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[b,[_,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[b,[_,Qe+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[b,[_,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[b,[_,"watchOS"]],[/crkey\/([\d\.]+)/i],[b,[_,Oe+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[_,po],b],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[_,b],[/(sunos) ?([\w\.\d]*)/i],[[_,"Solaris"],b],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[_,b]]},Ca=function(tr,cr){if(typeof tr===d&&(cr=tr,tr=i),!(this instanceof Ca))return new Ca(tr,cr).getResult();var gn=typeof n!==c&&n.navigator?n.navigator:i,rs=tr||(gn&&gn.userAgent?gn.userAgent:""),Ia=gn&&gn.userAgentData?gn.userAgentData:i,Gn=cr?function(xt,Aa){var uh={};for(var Ec in xt)Aa[Ec]&&Aa[Ec].length%2==0?uh[Ec]=Aa[Ec].concat(xt[Ec]):uh[Ec]=xt[Ec];return uh}(cG,cr):cG,el=gn&&gn.userAgent==rs;return this.getBrowser=function(){var xt={};return xt[_]=i,xt[b]=i,dh.call(xt,rs,Gn.browser),xt[m]=function(Aa){return typeof Aa===h?Aa.replace(/[^\d\.]/g,"").split(".")[0]:i}(xt[b]),el&&gn&&gn.brave&&typeof gn.brave.isBrave==a&&(xt[_]="Brave"),xt},this.getCPU=function(){var xt={};return xt[O]=i,dh.call(xt,rs,Gn.cpu),xt},this.getDevice=function(){var xt={};return xt[y]=i,xt[g]=i,xt[v]=i,dh.call(xt,rs,Gn.device),el&&!xt[v]&&Ia&&Ia.mobile&&(xt[v]=N),el&&xt[g]=="Macintosh"&&gn&&typeof gn.standalone!==c&&gn.maxTouchPoints&&gn.maxTouchPoints>2&&(xt[g]="iPad",xt[v]=k),xt},this.getEngine=function(){var xt={};return xt[_]=i,xt[b]=i,dh.call(xt,rs,Gn.engine),xt},this.getOS=function(){var xt={};return xt[_]=i,xt[b]=i,dh.call(xt,rs,Gn.os),el&&!xt[_]&&Ia&&Ia.platform&&Ia.platform!="Unknown"&&(xt[_]=Ia.platform.replace(/chrome os/i,po).replace(/macos/i,_d)),xt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return rs},this.setUA=function(xt){return rs=typeof xt===h&&xt.length>500?b_(xt,500):xt,this},this.setUA(rs),this};Ca.VERSION="0.7.41",Ca.BROWSER=Tm([_,b,m]),Ca.CPU=Tm([O]),Ca.DEVICE=Tm([g,y,v,I,N,j,k,G,K]),Ca.ENGINE=Ca.OS=Tm([_,b]),e.exports&&(t=e.exports=Ca),t.UAParser=Ca;var bm=typeof n!==c&&(n.jQuery||n.Zepto);if(bm&&!bm.ua){var jT=new Ca;bm.ua=jT.getResult(),bm.ua.get=function(){return jT.getUA()},bm.ua.set=function(tr){jT.setUA(tr);var cr=jT.getResult();for(var gn in cr)bm.ua[gn]=cr[gn]}}})(typeof window=="object"?window:l)})(UC,UC.exports);var _ne=u(UC.exports),vM=ly.clear;Lt({global:!0,bind:!0,forced:J.clearImmediate!==vM},{clearImmediate:vM});var yM=J,Ene=Z,vne=ue,yne=VR,Sne=ur,Tne=Hl,bne=yu,Rne=yM.Function,wne=/MSIE .\./.test(Sne)||yne==="BUN"&&function(){var e=yM.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")}(),Cne=Lt,SM=J,TM=ly.set,Ine=function(e,t){var n=1;return wne?function(i,a){var c=bne(arguments.length,1)>n,d=vne(i)?i:Rne(i),h=c?Tne(arguments,n):[],m=c?function(){Ene(d,this,h)}:d;return e(m)}:e},bM=SM.setImmediate?Ine(TM):TM;Cne({global:!0,bind:!0,forced:SM.setImmediate!==bM},{setImmediate:bM});var RM=u(qt.setImmediate),Ane=J,Nne=O1,xne=jn,One=yu,Pne=tt;Lt({global:!0,dontCallGetSet:!0,forced:f(function(){return Pne&&Object.getOwnPropertyDescriptor(Ane,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){One(arguments.length,1),Nne(xne(e))}});var wM=u(qt.queueMicrotask);function CM(e,t){return function(){return e.apply(t,arguments)}}const{toString:Dne}=Object.prototype,{getPrototypeOf:jC}=Object,{iterator:Uy,toStringTag:IM}=Symbol,jy=(VC=Object.create(null),e=>{const t=Dne.call(e);return VC[t]||(VC[t]=t.slice(8,-1).toLowerCase())});var VC;const ca=e=>(e=e.toLowerCase(),t=>jy(t)===e),Vy=e=>t=>typeof t===e,{isArray:Ap}=Array,Np=Vy("undefined");function Sg(e){return e!==null&&!Np(e)&&e.constructor!==null&&!Np(e.constructor)&&Ds(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const AM=ca("ArrayBuffer"),kne=Vy("string"),Ds=Vy("function"),NM=Vy("number"),Tg=e=>e!==null&&typeof e=="object",Fy=e=>{if(jy(e)!=="object")return!1;const t=jC(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||IM in e||Uy in e)},Lne=ca("Date"),Mne=ca("File"),Une=ca("Blob"),jne=ca("FileList"),Vne=ca("URLSearchParams"),[Fne,Bne,Gne,Wne]=["ReadableStream","Request","Response","Headers"].map(ca);function bg(e,t){let n,i,{allOwnKeys:a=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Ap(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{if(Sg(e))return;const c=a?Object.getOwnPropertyNames(e):Object.keys(e),d=c.length;let h;for(n=0;n<d;n++)h=c[n],t.call(null,e[h],h,e)}}function xM(e,t){if(Sg(e))return null;t=t.toLowerCase();const n=Object.keys(e);let i,a=n.length;for(;a-- >0;)if(i=n[a],t===i.toLowerCase())return i;return null}const Iu=EM!==void 0?EM:typeof self<"u"?self:typeof window<"u"?window:VT,OM=e=>!Np(e)&&e!==Iu,zne=(FC=typeof Uint8Array<"u"&&jC(Uint8Array),e=>FC&&e instanceof FC);var FC;const Hne=ca("HTMLFormElement"),PM=(e=>{let{hasOwnProperty:t}=e;return(n,i)=>t.call(n,i)})(Object.prototype),Kne=ca("RegExp"),DM=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),i={};bg(n,(a,c)=>{let d;(d=t(a,c,e))!==!1&&(i[c]=d||a)}),Object.defineProperties(e,i)},qne=ca("AsyncFunction"),kM=(LM=typeof RM=="function",MM=Ds(Iu.postMessage),LM?RM:MM?(BC="axios@".concat(Math.random()),By=[],Iu.addEventListener("message",e=>{let{source:t,data:n}=e;t===Iu&&n===BC&&By.length&&By.shift()()},!1),e=>{By.push(e),Iu.postMessage(BC,"*")}):e=>setTimeout(e));var LM,MM,BC,By;const Yne=wM!==void 0?wM.bind(Iu):typeof process<"u"&&process.nextTick||kM;var Ae={isArray:Ap,isArrayBuffer:AM,isBuffer:Sg,isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Ds(e.append)&&((t=jy(e))==="formdata"||t==="object"&&Ds(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&AM(e.buffer),t},isString:kne,isNumber:NM,isBoolean:e=>e===!0||e===!1,isObject:Tg,isPlainObject:Fy,isEmptyObject:e=>{if(!Tg(e)||Sg(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},isReadableStream:Fne,isRequest:Bne,isResponse:Gne,isHeaders:Wne,isUndefined:Np,isDate:Lne,isFile:Mne,isBlob:Une,isRegExp:Kne,isFunction:Ds,isStream:e=>Tg(e)&&Ds(e.pipe),isURLSearchParams:Vne,isTypedArray:zne,isFileList:jne,forEach:bg,merge:function e(){const{caseless:t,skipUndefined:n}=OM(this)&&this||{},i={},a=(c,d)=>{const h=t&&xM(i,d)||d;Fy(i[h])&&Fy(c)?i[h]=e(i[h],c):Fy(c)?i[h]=e({},c):Ap(c)?i[h]=c.slice():n&&Np(c)||(i[h]=c)};for(let c=0,d=arguments.length;c<d;c++)arguments[c]&&bg(arguments[c],a);return i},extend:function(e,t,n){let{allOwnKeys:i}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return bg(t,(a,c)=>{n&&Ds(a)?e[c]=CM(a,n):e[c]=a},{allOwnKeys:i}),e},trim:e=>bi(e)?bi(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,n,i)=>{e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,i)=>{let a,c,d;const h={};if(t=t||{},e==null)return t;do{for(a=Object.getOwnPropertyNames(e),c=a.length;c-- >0;)d=a[c],i&&!i(d,e,t)||h[d]||(t[d]=e[d],h[d]=!0);e=n!==!1&&jC(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:jy,kindOfTest:ca,endsWith:(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const i=e.indexOf(t,n);return i!==-1&&i===n},toArray:e=>{if(!e)return null;if(Ap(e))return e;let t=e.length;if(!NM(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Uy]).call(e);let i;for(;(i=n.next())&&!i.done;){const a=i.value;t.call(e,a[0],a[1])}},matchAll:(e,t)=>{let n;const i=[];for(;(n=e.exec(t))!==null;)i.push(n);return i},isHTMLForm:Hne,hasOwnProperty:PM,hasOwnProp:PM,reduceDescriptors:DM,freezeMethods:e=>{DM(e,(t,n)=>{if(Ds(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const i=e[n];Ds(i)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},i=a=>{a.forEach(c=>{n[c]=!0})};return Ap(e)?i(e):i(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,i){return n.toUpperCase()+i}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:xM,global:Iu,isContextDefined:OM,isSpecCompliantForm:function(e){return!!(e&&Ds(e.append)&&e[IM]==="FormData"&&e[Uy])},toJSONObject:e=>{const t=new Array(10),n=(i,a)=>{if(Tg(i)){if(t.indexOf(i)>=0)return;if(Sg(i))return i;if(!("toJSON"in i)){t[a]=i;const c=Ap(i)?[]:{};return bg(i,(d,h)=>{const m=n(d,a+1);!Np(m)&&(c[h]=m)}),t[a]=void 0,c}}return i};return n(e,0)},isAsyncFn:qne,isThenable:e=>e&&(Tg(e)||Ds(e))&&Ds(e.then)&&Ds(e.catch),setImmediate:kM,asap:Yne,isIterable:e=>e!=null&&Ds(e[Uy])};function tn(e,t,n,i,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),i&&(this.request=i),a&&(this.response=a,this.status=a.status?a.status:null)}Ae.inherits(tn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ae.toJSONObject(this.config),code:this.code,status:this.status}}});const UM=tn.prototype,jM={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{jM[e]={value:e}}),Object.defineProperties(tn,jM),Object.defineProperty(UM,"isAxiosError",{value:!0}),tn.from=(e,t,n,i,a,c)=>{const d=Object.create(UM);Ae.toFlatObject(e,d,function(g){return g!==Error.prototype},g=>g!=="isAxiosError");const h=e&&e.message?e.message:"Error",m=t==null&&e?e.code:t;return tn.call(d,h,m,n,i,a),e&&d.cause==null&&Object.defineProperty(d,"cause",{value:e,configurable:!0}),d.name=e&&e.name||"Error",c&&Object.assign(d,c),d};function GC(e){return Ae.isPlainObject(e)||Ae.isArray(e)}function VM(e){return Ae.endsWith(e,"[]")?e.slice(0,-2):e}function FM(e,t,n){return e?e.concat(t).map(function(i,a){return i=VM(i),!n&&a?"["+i+"]":i}).join(n?".":""):t}const Xne=Ae.toFlatObject(Ae,{},null,function(e){return/^is[A-Z]/.test(e)});function Gy(e,t,n){if(!Ae.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const i=(n=Ae.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(y,b){return!Ae.isUndefined(b[y])})).metaTokens,a=n.visitor||g,c=n.dots,d=n.indexes,h=(n.Blob||typeof Blob<"u"&&Blob)&&Ae.isSpecCompliantForm(t);if(!Ae.isFunction(a))throw new TypeError("visitor must be a function");function m(y){if(y===null)return"";if(Ae.isDate(y))return y.toISOString();if(Ae.isBoolean(y))return y.toString();if(!h&&Ae.isBlob(y))throw new tn("Blob is not supported. Use a Buffer instead.");return Ae.isArrayBuffer(y)||Ae.isTypedArray(y)?h&&typeof Blob=="function"?new Blob([y]):Buffer.from(y):y}function g(y,b,O){let I=y;if(y&&!O&&typeof y=="object"){if(Ae.endsWith(b,"{}"))b=i?b:b.slice(0,-2),y=JSON.stringify(y);else if(Ae.isArray(y)&&function(N){return Ae.isArray(N)&&!N.some(GC)}(y)||(Ae.isFileList(y)||Ae.endsWith(b,"[]"))&&(I=Ae.toArray(y)))return b=VM(b),I.forEach(function(N,k){!Ae.isUndefined(N)&&N!==null&&t.append(d===!0?FM([b],k,c):d===null?b:b+"[]",m(N))}),!1}return!!GC(y)||(t.append(FM(O,b,c),m(y)),!1)}const _=[],v=Object.assign(Xne,{defaultVisitor:g,convertValue:m,isVisitable:GC});if(!Ae.isObject(e))throw new TypeError("data must be an object");return function y(b,O){if(!Ae.isUndefined(b)){if(_.indexOf(b)!==-1)throw Error("Circular reference detected in "+O.join("."));_.push(b),Ae.forEach(b,function(I,N){(!(Ae.isUndefined(I)||I===null)&&a.call(t,I,Ae.isString(N)?bi(N).call(N):N,O,v))===!0&&y(I,O?O.concat(N):[N])}),_.pop()}}(e),t}function BM(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function WC(e,t){this._pairs=[],e&&Gy(e,this,t)}const GM=WC.prototype;function Jne(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function WM(e,t,n){if(!t)return e;const i=n&&n.encode||Jne;Ae.isFunction(n)&&(n={serialize:n});const a=n&&n.serialize;let c;if(c=a?a(t,n):Ae.isURLSearchParams(t)?t.toString():new WC(t,n).toString(i),c){const d=e.indexOf("#");d!==-1&&(e=e.slice(0,d)),e+=(e.indexOf("?")===-1?"?":"&")+c}return e}GM.append=function(e,t){this._pairs.push([e,t])},GM.toString=function(e){const t=e?function(n){return e.call(this,n,BM)}:BM;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};var zM=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Ae.forEach(this.handlers,function(t){t!==null&&e(t)})}},HM={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},KM={exports:{}},Qne=Lt,$ne=tt,qM=xs.f;Qne({target:"Object",stat:!0,forced:Object.defineProperty!==qM,sham:!$ne},{defineProperty:qM});var YM=qt.Object,Zne=KM.exports=function(e,t,n){return YM.defineProperty(e,t,n)};YM.defineProperty.sham&&(Zne.sham=!0);var XM=u(KM.exports),ere=TypeError,JM=ng,tre=cy,nre=kt,rre=Mn("species"),QM=Array,ire=function(e){var t;return JM(e)&&(t=e.constructor,(tre(t)&&(t===QM||JM(t.prototype))||nre(t)&&(t=t[rre])===null)&&(t=void 0)),t===void 0?QM:t},$M=function(e,t){return new(ire(e))(t===0?0:t)},sre=f,ore=Ga,are=Mn("species"),ZM=function(e){return ore>=51||!sre(function(){var t=[];return(t.constructor={})[are]=function(){return{foo:1}},t[e](Boolean).foo!==1})},cre=Lt,lre=f,dre=ng,ure=kt,hre=bo,pre=an,eU=function(e){if(e>9007199254740991)throw ere("Maximum allowed index exceeded");return e},tU=$w,mre=$M,fre=ZM,gre=Ga,nU=Mn("isConcatSpreadable"),_re=gre>=51||!lre(function(){var e=[];return e[nU]=!1,e.concat()[0]!==e}),Ere=function(e){if(!ure(e))return!1;var t=e[nU];return t!==void 0?!!t:dre(e)};cre({target:"Array",proto:!0,forced:!_re||!fre("concat")},{concat:function(e){var t,n,i,a,c,d=hre(this),h=mre(d,0),m=0;for(t=-1,i=arguments.length;t<i;t++)if(Ere(c=t===-1?d:arguments[t]))for(a=pre(c),eU(m+a),n=0;n<a;n++,m++)n in c&&tU(h,m,c[n]);else eU(m+1),tU(h,m++,c);return h.length=m,h}});var rU={},vre=te,yre=_t,iU=Kv.f,Sre=Hl,sU=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];rU.f=function(e){return sU&&vre(e)==="Window"?function(t){try{return iU(t)}catch{return Sre(sU)}}(e):iU(yre(e))};var xp={},Tre=Mn;xp.f=Tre;var oU=qt,bre=br,Rre=xp,wre=xs.f,kr=function(e){var t=oU.Symbol||(oU.Symbol={});bre(t,e)||wre(t,e,{value:Rre.f(e)})},Cre=It,Ire=Tr,Are=Mn,Nre=zl,aU=function(){var e=Ire("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,i=Are("toPrimitive");t&&!t[i]&&Nre(t,i,function(a){return Cre(n,this)},{})},xre=Ya,Ore=lr,Pre=bo,Dre=an,kre=$M,cU=M([].push),Lre=function(e){var t=e===1,n=e===2,i=e===3,a=e===4,c=e===6,d=e===7,h=e===5||c;return function(m,g,_,v){for(var y,b,O=Pre(m),I=Ore(O),N=Dre(I),k=xre(g,_),j=0,G=v||kre,K=t?G(m,N):n||d?G(m,0):void 0;N>j;j++)if((h||j in I)&&(b=k(y=I[j],j,O),e))if(t)K[j]=b;else if(b)switch(e){case 3:return!0;case 5:return y;case 6:return j;case 2:cU(K,y)}else switch(e){case 4:return!1;case 7:cU(K,y)}return c?-1:i||a?a:K}},lU={forEach:Lre(0)},Wy=Lt,Rg=J,zC=It,Mre=M,Op=tt,Pp=Wa,Ure=f,Ri=br,jre=F,HC=yi,zy=_t,KC=Uc,Vre=_s,qC=In,Dp=ig,dU=Yv,Fre=Kv,uU=rU,Bre=rg,hU=ie,pU=xs,Gre=KR,mU=Ge,fU=zl,Wre=ay,YC=za,gU=qv,_U=Zh,zre=Mn,Hre=xp,Kre=kr,qre=aU,Yre=Fc,EU=vu,Hy=lU.forEach,ks=Hv("hidden"),Ky="Symbol",wg="prototype",Xre=EU.set,vU=EU.getterFor(Ky),la=Object[wg],Au=Rg.Symbol,qy=Au&&Au[wg],Jre=Rg.RangeError,Qre=Rg.TypeError,XC=Rg.QObject,yU=hU.f,Nu=pU.f,SU=uU.f,$re=mU.f,TU=Mre([].push),Wc=YC("symbols"),Cg=YC("op-symbols"),Zre=YC("wks"),JC=!XC||!XC[wg]||!XC[wg].findChild,bU=function(e,t,n){var i=yU(la,t);i&&delete la[t],Nu(e,t,n),i&&e!==la&&Nu(la,t,i)},QC=Op&&Ure(function(){return Dp(Nu({},"a",{get:function(){return Nu(this,"a",{value:7}).a}})).a!==7})?bU:Nu,$C=function(e,t){var n=Wc[e]=Dp(qy);return Xre(n,{type:Ky,tag:e,description:t}),Op||(n.description=t),n},Yy=function(e,t,n){e===la&&Yy(Cg,t,n),HC(e);var i=KC(t);return HC(n),Ri(Wc,i)?(n.enumerable?(Ri(e,ks)&&e[ks][i]&&(e[ks][i]=!1),n=Dp(n,{enumerable:qC(0,!1)})):(Ri(e,ks)||Nu(e,ks,qC(1,Dp(null))),e[ks][i]=!0),QC(e,i,n)):Nu(e,i,n)},ZC=function(e,t){HC(e);var n=zy(t),i=dU(n).concat(IU(n));return Hy(i,function(a){Op&&!zC(RU,n,a)||Yy(e,a,n[a])}),e},RU=function(e){var t=KC(e),n=zC($re,this,t);return!(this===la&&Ri(Wc,t)&&!Ri(Cg,t))&&(!(n||!Ri(this,t)||!Ri(Wc,t)||Ri(this,ks)&&this[ks][t])||n)},wU=function(e,t){var n=zy(e),i=KC(t);if(n!==la||!Ri(Wc,i)||Ri(Cg,i)){var a=yU(n,i);return!a||!Ri(Wc,i)||Ri(n,ks)&&n[ks][i]||(a.enumerable=!0),a}},CU=function(e){var t=SU(zy(e)),n=[];return Hy(t,function(i){Ri(Wc,i)||Ri(gU,i)||TU(n,i)}),n},IU=function(e){var t=e===la,n=SU(t?Cg:zy(e)),i=[];return Hy(n,function(a){!Ri(Wc,a)||t&&!Ri(la,a)||TU(i,Wc[a])}),i};Pp||(Au=function(){if(jre(qy,this))throw new Qre("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?Vre(arguments[0]):void 0,t=_U(e),n=function(i){var a=this===void 0?Rg:this;a===la&&zC(n,Cg,i),Ri(a,ks)&&Ri(a[ks],t)&&(a[ks][t]=!1);var c=qC(1,i);try{QC(a,t,c)}catch(d){if(!(d instanceof Jre))throw d;bU(a,t,c)}};return Op&&JC&&QC(la,t,{configurable:!0,set:n}),$C(t,e)},fU(qy=Au[wg],"toString",function(){return vU(this).tag}),fU(Au,"withoutSetter",function(e){return $C(_U(e),e)}),mU.f=RU,pU.f=Yy,Gre.f=ZC,hU.f=wU,Fre.f=uU.f=CU,Bre.f=IU,Hre.f=function(e){return $C(zre(e),e)},Op&&Wre(qy,"description",{configurable:!0,get:function(){return vU(this).description}})),Wy({global:!0,wrap:!0,forced:!Pp,sham:!Pp},{Symbol:Au}),Hy(dU(Zre),function(e){Kre(e)}),Wy({target:Ky,stat:!0,forced:!Pp},{useSetter:function(){JC=!0},useSimple:function(){JC=!1}}),Wy({target:"Object",stat:!0,forced:!Pp,sham:!Op},{create:function(e,t){return t===void 0?Dp(e):ZC(Dp(e),t)},defineProperty:Yy,defineProperties:ZC,getOwnPropertyDescriptor:wU}),Wy({target:"Object",stat:!0,forced:!Pp},{getOwnPropertyNames:CU}),qre(),Yre(Au,Ky),gU[ks]=!0;var AU=Wa&&!!Symbol.for&&!!Symbol.keyFor,eie=Lt,tie=Tr,nie=br,rie=_s,NU=za,iie=AU,eI=NU("string-to-symbol-registry"),sie=NU("symbol-to-string-registry");eie({target:"Symbol",stat:!0,forced:!iie},{for:function(e){var t=rie(e);if(nie(eI,t))return eI[t];var n=tie("Symbol")(t);return eI[t]=n,sie[n]=t,n}});var oie=Lt,aie=br,cie=Zs,lie=ea,die=AU,xU=za("symbol-to-string-registry");oie({target:"Symbol",stat:!0,forced:!die},{keyFor:function(e){if(!cie(e))throw new TypeError(lie(e)+" is not a symbol");if(aie(xU,e))return xU[e]}});var OU=ng,uie=ue,PU=te,hie=_s,DU=M([].push),pie=Lt,kU=Tr,LU=Z,mie=It,Ig=M,MU=f,UU=ue,jU=Zs,VU=Hl,fie=function(e){if(uie(e))return e;if(OU(e)){for(var t=e.length,n=[],i=0;i<t;i++){var a=e[i];typeof a=="string"?DU(n,a):typeof a!="number"&&PU(a)!=="Number"&&PU(a)!=="String"||DU(n,hie(a))}var c=n.length,d=!0;return function(h,m){if(d)return d=!1,m;if(OU(this))return m;for(var g=0;g<c;g++)if(n[g]===h)return m}}},gie=Wa,_ie=String,Ql=kU("JSON","stringify"),Xy=Ig(/./.exec),FU=Ig("".charAt),Eie=Ig("".charCodeAt),vie=Ig("".replace),yie=Ig(1.1.toString),Sie=/[\uD800-\uDFFF]/g,BU=/^[\uD800-\uDBFF]$/,GU=/^[\uDC00-\uDFFF]$/,WU=!gie||MU(function(){var e=kU("Symbol")("stringify detection");return Ql([e])!=="[null]"||Ql({a:e})!=="{}"||Ql(Object(e))!=="{}"}),zU=MU(function(){return Ql("\uDF06\uD834")!=='"\\udf06\\ud834"'||Ql("\uDEAD")!=='"\\udead"'}),Tie=function(e,t){var n=VU(arguments),i=fie(t);if(UU(i)||e!==void 0&&!jU(e))return n[1]=function(a,c){if(UU(i)&&(c=mie(i,this,_ie(a),c)),!jU(c))return c},LU(Ql,null,n)},bie=function(e,t,n){var i=FU(n,t-1),a=FU(n,t+1);return Xy(BU,e)&&!Xy(GU,a)||Xy(GU,e)&&!Xy(BU,i)?"\\u"+yie(Eie(e,0),16):e};Ql&&pie({target:"JSON",stat:!0,forced:WU||zU},{stringify:function(e,t,n){var i=VU(arguments),a=LU(WU?Tie:Ql,null,i);return zU&&typeof a=="string"?vie(a,Sie,bie):a}});var HU=rg,Rie=bo;Lt({target:"Object",stat:!0,forced:!Wa||f(function(){HU.f(1)})},{getOwnPropertySymbols:function(e){var t=HU.f;return t?t(Rie(e)):[]}}),kr("asyncDispose"),kr("asyncIterator"),kr("dispose"),kr("hasInstance"),kr("isConcatSpreadable"),kr("iterator"),kr("match"),kr("matchAll"),kr("replace"),kr("search"),kr("species"),kr("split");var wie=aU;kr("toPrimitive"),wie();var Cie=Tr,Iie=Fc;kr("toStringTag"),Iie(Cie("Symbol"),"Symbol"),kr("unscopables"),Fc(J.JSON,"JSON",!0);var Aie=qt.Symbol,Nie=Mn,xie=xs.f,KU=Nie("metadata"),qU=Function.prototype;qU[KU]===void 0&&xie(qU,KU,{value:null}),kr("metadata");var Oie=Aie,Pie=M,tI=Tr("Symbol"),Die=tI.keyFor,kie=Pie(tI.prototype.valueOf),YU=tI.isRegisteredSymbol||function(e){try{return Die(kie(e))!==void 0}catch{return!1}};Lt({target:"Symbol",stat:!0},{isRegisteredSymbol:YU});for(var Lie=za,XU=Tr,Mie=M,Uie=Zs,jie=Mn,Jy=XU("Symbol"),JU=Jy.isWellKnownSymbol,QU=XU("Object","getOwnPropertyNames"),Vie=Mie(Jy.prototype.valueOf),$U=Lie("wks"),nI=0,ZU=QU(Jy),Fie=ZU.length;nI<Fie;nI++)try{var ej=ZU[nI];Uie(Jy[ej])&&jie(ej)}catch{}var tj=function(e){if(JU&&JU(e))return!0;try{for(var t=Vie(e),n=0,i=QU($U),a=i.length;n<a;n++)if($U[i[n]]==t)return!0}catch{}return!1};Lt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:tj}),kr("customMatcher"),kr("observable"),Lt({target:"Symbol",stat:!0},{isRegistered:YU}),Lt({target:"Symbol",stat:!0,forced:!0},{isWellKnown:tj}),kr("matcher"),kr("metadataKey"),kr("patternMatch"),kr("replaceAll");var kp=u(Oie),nj=u(xp.f("iterator"));function Ag(e){return Ag=typeof kp=="function"&&typeof nj=="symbol"?function(t){return typeof t}:function(t){return t&&typeof kp=="function"&&t.constructor===kp&&t!==kp.prototype?"symbol":typeof t},Ag(e)}var Bie=u(xp.f("toPrimitive"));function Gie(e){var t=function(n,i){if(Ag(n)!="object"||!n)return n;var a=n[Bie];if(a!==void 0){var c=a.call(n,i);if(Ag(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}(e,"string");return Ag(t)=="symbol"?t:t+""}function x(e,t,n){return(t=Gie(t))in e?XM(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var rj=u(mee),Wie={isBrowser:!0,classes:{URLSearchParams:rj!==void 0?rj:WC,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const rI=typeof window<"u"&&typeof document<"u",iI=typeof navigator=="object"&&navigator||void 0,zie=rI&&(!iI||["ReactNative","NativeScript","NS"].indexOf(iI.product)<0),Hie=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Kie=rI&&window.location.href||"http://localhost";function ij(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function sj(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ij(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ij(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}var $i=sj(sj({},Object.freeze({__proto__:null,hasBrowserEnv:rI,hasStandardBrowserEnv:zie,hasStandardBrowserWebWorkerEnv:Hie,navigator:iI,origin:Kie})),Wie);function oj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function qie(e,t){return Gy(e,new $i.classes.URLSearchParams,function(n){for(var i=1;i<arguments.length;i++){var a=arguments[i]!=null?arguments[i]:{};i%2?oj(Object(a),!0).forEach(function(c){x(n,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):oj(Object(a)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(a,c))})}return n}({visitor:function(n,i,a,c){return $i.isNode&&Ae.isBuffer(n)?(this.append(i,n.toString("base64")),!1):c.defaultVisitor.apply(this,arguments)}},t))}var Yie=jw.charAt,aj=It,Xie=yi,Jie=ue,Qie=te,$ie=/./.exec,Zie=TypeError,ese=Lt,cj=It,lj=$,tse=sw,Qy=sy,dj=$n,uj=Vn,Ng=_s,nse=yi,rse=kt,ise=te,sse=LR,hj=NC,ose=ta,ase=f,cse=uw,lse=function(e,t,n){return t+(n?Yie(e,t).length:1)},dse=function(e,t){var n=e.exec;if(Jie(n)){var i=aj(n,e,t);return i!==null&&Xie(i),i}if(Qie(e)==="RegExp")return aj($ie,e,t);throw new Zie("RegExp#exec called on incompatible receiver")},pj=vu,use=Mn("matchAll"),mj="RegExp String",fj=mj+" Iterator",hse=pj.set,pse=pj.getterFor(fj),mse=TypeError,sI=lj("".indexOf),$y=lj("".matchAll),oI=!!$y&&!ase(function(){$y("a",/./)}),fse=tse(function(e,t,n,i){hse(this,{type:fj,regexp:e,string:t,global:n,unicode:i,done:!1})},mj,function(){var e=pse(this);if(e.done)return Qy(void 0,!0);var t=e.regexp,n=e.string,i=dse(t,n);return i===null?(e.done=!0,Qy(void 0,!0)):e.global?(Ng(i[0])===""&&(t.lastIndex=lse(n,uj(t.lastIndex),e.unicode)),Qy(i,!1)):(e.done=!0,Qy(i,!1))}),gj=function(e){var t,n,i,a=nse(this),c=Ng(e),d=cse(a,RegExp),h=Ng(hj(a));return t=new d(d===RegExp?a.source:a,h),n=!!~sI(h,"g"),i=!!~sI(h,"u"),t.lastIndex=uj(a.lastIndex),new fse(t,c,n,i)};ese({target:"String",proto:!0,forced:oI},{matchAll:function(e){var t,n,i,a,c=dj(this);if(rse(e)){if(sse(e)&&(t=Ng(dj(hj(e))),!~sI(t,"g")))throw new mse("`.matchAll` does not allow non-global regexes");if(oI)return $y(c,e);if((i=ose(e,use))===void 0&&ise(e)==="RegExp"&&(i=gj),i)return cj(i,e,c)}else if(oI)return $y(c,e);return n=Ng(c),a=new RegExp(e,"g"),cj(gj,a,n)}});var gse=eo("String","matchAll"),_se=F,Ese=gse,aI=String.prototype,vse=function(e){var t=e.matchAll;return typeof e=="string"||e===aI||_se(aI,e)&&t===aI.matchAll?Ese:t},yse=u(vse);function _j(e){function t(n,i,a,c){let d=n[c++];if(d==="__proto__")return!0;const h=Number.isFinite(+d),m=c>=n.length;return d=!d&&Ae.isArray(a)?a.length:d,m?(Ae.hasOwnProp(a,d)?a[d]=[a[d],i]:a[d]=i,!h):(a[d]&&Ae.isObject(a[d])||(a[d]=[]),t(n,i,a[d],c)&&Ae.isArray(a[d])&&(a[d]=function(g){const _={},v=Object.keys(g);let y;const b=v.length;let O;for(y=0;y<b;y++)O=v[y],_[O]=g[O];return _}(a[d])),!h)}if(Ae.isFormData(e)&&Ae.isFunction(e.entries)){const n={};return Ae.forEachEntry(e,(i,a)=>{t(function(c){return yse(Ae).call(Ae,/\w+|\[(\w*)]/g,c).map(d=>d[0]==="[]"?"":d[1]||d[0])}(i),a,n,0)}),n}return null}const cI={transitional:HM,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",i=n.indexOf("application/json")>-1,a=Ae.isObject(e);if(a&&Ae.isHTMLForm(e)&&(e=new FormData(e)),Ae.isFormData(e))return i?JSON.stringify(_j(e)):e;if(Ae.isArrayBuffer(e)||Ae.isBuffer(e)||Ae.isStream(e)||Ae.isFile(e)||Ae.isBlob(e)||Ae.isReadableStream(e))return e;if(Ae.isArrayBufferView(e))return e.buffer;if(Ae.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let c;if(a){if(n.indexOf("application/x-www-form-urlencoded")>-1)return qie(e,this.formSerializer).toString();if((c=Ae.isFileList(e))||n.indexOf("multipart/form-data")>-1){const d=this.env&&this.env.FormData;return Gy(c?{"files[]":e}:e,d&&new d,this.formSerializer)}}return a||i?(t.setContentType("application/json",!1),function(d,h,m){if(Ae.isString(d))try{return(h||JSON.parse)(d),bi(Ae).call(Ae,d)}catch(g){if(g.name!=="SyntaxError")throw g}return(m||JSON.stringify)(d)}(e)):e}],transformResponse:[function(e){const t=this.transitional||cI.transitional,n=t&&t.forcedJSONParsing,i=this.responseType==="json";if(Ae.isResponse(e)||Ae.isReadableStream(e))return e;if(e&&Ae.isString(e)&&(n&&!this.responseType||i)){const a=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e,this.parseReviver)}catch(c){if(a)throw c.name==="SyntaxError"?tn.from(c,tn.ERR_BAD_RESPONSE,this,null,this.response):c}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:$i.classes.FormData,Blob:$i.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ae.forEach(["delete","get","head","post","put","patch"],e=>{cI.headers[e]={}});var lI=cI;const Sse=Ae.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Ej=Symbol("internals");function xg(e){var t;return e&&bi(t=String(e)).call(t).toLowerCase()}function Zy(e){return e===!1||e==null?e:Ae.isArray(e)?e.map(Zy):String(e)}function dI(e,t,n,i,a){return Ae.isFunction(i)?i.call(this,t,n):(a&&(t=n),Ae.isString(t)?Ae.isString(i)?t.indexOf(i)!==-1:Ae.isRegExp(i)?i.test(t):void 0:void 0)}class eS{constructor(t){t&&this.set(t)}set(t,n,i){const a=this;function c(m,g,_){const v=xg(g);if(!v)throw new Error("header name must be a non-empty string");const y=Ae.findKey(a,v);(!y||a[y]===void 0||_===!0||_===void 0&&a[y]!==!1)&&(a[y||g]=Zy(m))}const d=(m,g)=>Ae.forEach(m,(_,v)=>c(_,v,g));if(Ae.isPlainObject(t)||t instanceof this.constructor)d(t,n);else if(Ae.isString(t)&&(t=bi(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(bi(h=t).call(h)))d((m=>{const g={};let _,v,y;return m&&m.split(`
`).forEach(function(b){var O,I;y=b.indexOf(":"),_=bi(O=b.substring(0,y)).call(O).toLowerCase(),v=bi(I=b.substring(y+1)).call(I),!_||g[_]&&Sse[_]||(_==="set-cookie"?g[_]?g[_].push(v):g[_]=[v]:g[_]=g[_]?g[_]+", "+v:v)}),g})(t),n);else if(Ae.isObject(t)&&Ae.isIterable(t)){let m,g,_={};for(const v of t){if(!Ae.isArray(v))throw TypeError("Object iterator must return a key-value pair");_[g=v[0]]=(m=_[g])?Ae.isArray(m)?[...m,v[1]]:[m,v[1]]:v[1]}d(_,n)}else t!=null&&c(n,t,i);var h;return this}get(t,n){if(t=xg(t)){const i=Ae.findKey(this,t);if(i){const a=this[i];if(!n)return a;if(n===!0)return function(c){const d=Object.create(null),h=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let m;for(;m=h.exec(c);)d[m[1]]=m[2];return d}(a);if(Ae.isFunction(n))return n.call(this,a,i);if(Ae.isRegExp(n))return n.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=xg(t)){const i=Ae.findKey(this,t);return!(!i||this[i]===void 0||n&&!dI(0,this[i],i,n))}return!1}delete(t,n){const i=this;let a=!1;function c(d){if(d=xg(d)){const h=Ae.findKey(i,d);!h||n&&!dI(0,i[h],h,n)||(delete i[h],a=!0)}}return Ae.isArray(t)?t.forEach(c):c(t),a}clear(t){const n=Object.keys(this);let i=n.length,a=!1;for(;i--;){const c=n[i];t&&!dI(0,this[c],c,t,!0)||(delete this[c],a=!0)}return a}normalize(t){const n=this,i={};return Ae.forEach(this,(a,c)=>{var d;const h=Ae.findKey(i,c);if(h)return n[h]=Zy(a),void delete n[c];const m=t?function(g){return bi(g).call(g).toLowerCase().replace(/([a-z\d])(\w*)/g,(_,v,y)=>v.toUpperCase()+y)}(c):bi(d=String(c)).call(d);m!==c&&delete n[c],n[m]=Zy(a),i[m]=!0}),this}concat(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return this.constructor.concat(this,...n)}toJSON(t){const n=Object.create(null);return Ae.forEach(this,(i,a)=>{i!=null&&i!==!1&&(n[a]=t&&Ae.isArray(i)?i.join(", "):i)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[n,i]=t;return n+": "+i}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const n=new this(t);for(var i=arguments.length,a=new Array(i>1?i-1:0),c=1;c<i;c++)a[c-1]=arguments[c];return a.forEach(d=>n.set(d)),n}static accessor(t){const n=(this[Ej]=this[Ej]={accessors:{}}).accessors,i=this.prototype;function a(c){const d=xg(c);n[d]||(function(h,m){const g=Ae.toCamelCase(" "+m);["get","set","has"].forEach(_=>{Object.defineProperty(h,_+g,{value:function(v,y,b){return this[_].call(this,m,v,y,b)},configurable:!0})})}(i,c),n[d]=!0)}return Ae.isArray(t)?t.forEach(a):a(t),this}}eS.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Ae.reduceDescriptors(eS.prototype,(e,t)=>{let{value:n}=e,i=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(a){this[i]=a}}}),Ae.freezeMethods(eS);var da=eS;function uI(e,t){const n=this||lI,i=t||n,a=da.from(i.headers);let c=i.data;return Ae.forEach(e,function(d){c=d.call(n,c,a.normalize(),t?t.status:void 0)}),a.normalize(),c}function vj(e){return!(!e||!e.__CANCEL__)}function Lp(e,t,n){tn.call(this,e??"canceled",tn.ERR_CANCELED,t,n),this.name="CanceledError"}function yj(e,t,n){const i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(new tn("Request failed with status code "+n.status,[tn.ERR_BAD_REQUEST,tn.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}Ae.inherits(Lp,tn,{__CANCEL__:!0});const tS=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=0;const a=function(c,d){c=c||10;const h=new Array(c),m=new Array(c);let g,_=0,v=0;return d=d!==void 0?d:1e3,function(y){const b=Date.now(),O=m[v];g||(g=b),h[_]=y,m[_]=b;let I=v,N=0;for(;I!==_;)N+=h[I++],I%=c;if(_=(_+1)%c,_===v&&(v=(v+1)%c),b-g<d)return;const k=O&&b-O;return k?Math.round(1e3*N/k):void 0}}(50,250);return function(c,d){let h,m,g=0,_=1e3/d;const v=function(y){g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),h=null,m&&(clearTimeout(m),m=null),c(...y)};return[function(){const y=Date.now(),b=y-g;for(var O=arguments.length,I=new Array(O),N=0;N<O;N++)I[N]=arguments[N];b>=_?v(I,y):(h=I,m||(m=setTimeout(()=>{m=null,v(h)},_-b)))},()=>h&&v(h)]}(c=>{const d=c.loaded,h=c.lengthComputable?c.total:void 0,m=d-i,g=a(m);i=d,e({loaded:d,total:h,progress:h?d/h:void 0,bytes:m,rate:g||void 0,estimated:g&&h&&d<=h?(h-d)/g:void 0,event:c,lengthComputable:h!=null,[t?"download":"upload"]:!0})},n)},Sj=(e,t)=>{const n=e!=null;return[i=>t[0]({lengthComputable:n,total:e,loaded:i}),t[1]]},Tj=e=>function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ae.asap(()=>e(...n))};var Tse=$i.hasStandardBrowserEnv?((e,t)=>n=>(n=new xy(n,$i.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new xy($i.origin),$i.navigator&&/(msie|trident)/i.test($i.navigator.userAgent)):()=>!0,bse=$i.hasStandardBrowserEnv?{write(e,t,n,i,a,c,d){if(typeof document>"u")return;const h=["".concat(e,"=").concat(encodeURIComponent(t))];Ae.isNumber(n)&&h.push("expires=".concat(new Date(n).toUTCString())),Ae.isString(i)&&h.push("path=".concat(i)),Ae.isString(a)&&h.push("domain=".concat(a)),c===!0&&h.push("secure"),Ae.isString(d)&&h.push("SameSite=".concat(d)),document.cookie=h.join("; ")},read(e){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read:()=>null,remove(){}};function bj(e,t,n){let i=!function(a){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(a)}(t);return e&&(i||n==0)?function(a,c){return c?a.replace(/\/?\/$/,"")+"/"+c.replace(/^\/+/,""):a}(e,t):t}function Rj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function hI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Rj(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rj(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const wj=e=>e instanceof da?hI({},e):e;function xu(e,t){t=t||{};const n={};function i(g,_,v,y){return Ae.isPlainObject(g)&&Ae.isPlainObject(_)?Ae.merge.call({caseless:y},g,_):Ae.isPlainObject(_)?Ae.merge({},_):Ae.isArray(_)?_.slice():_}function a(g,_,v,y){return Ae.isUndefined(_)?Ae.isUndefined(g)?void 0:i(void 0,g,0,y):i(g,_,0,y)}function c(g,_){if(!Ae.isUndefined(_))return i(void 0,_)}function d(g,_){return Ae.isUndefined(_)?Ae.isUndefined(g)?void 0:i(void 0,g):i(void 0,_)}function h(g,_,v){return v in t?i(g,_):v in e?i(void 0,g):void 0}const m={url:c,method:c,data:c,baseURL:d,transformRequest:d,transformResponse:d,paramsSerializer:d,timeout:d,timeoutMessage:d,withCredentials:d,withXSRFToken:d,adapter:d,responseType:d,xsrfCookieName:d,xsrfHeaderName:d,onUploadProgress:d,onDownloadProgress:d,decompress:d,maxContentLength:d,maxBodyLength:d,beforeRedirect:d,transport:d,httpAgent:d,httpsAgent:d,cancelToken:d,socketPath:d,responseEncoding:d,validateStatus:h,headers:(g,_,v)=>a(wj(g),wj(_),0,!0)};return Ae.forEach(Object.keys(hI(hI({},e),t)),function(g){const _=m[g]||a,v=_(e[g],t[g],g);Ae.isUndefined(v)&&_!==h||(n[g]=v)}),n}var Cj=e=>{const t=xu({},e);let{data:n,withXSRFToken:i,xsrfHeaderName:a,xsrfCookieName:c,headers:d,auth:h}=t;if(t.headers=d=da.from(d),t.url=WM(bj(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),h&&d.set("Authorization","Basic "+btoa((h.username||"")+":"+(h.password?unescape(encodeURIComponent(h.password)):""))),Ae.isFormData(n)){if($i.hasStandardBrowserEnv||$i.hasStandardBrowserWebWorkerEnv)d.setContentType(void 0);else if(Ae.isFunction(n.getHeaders)){const m=n.getHeaders(),g=["content-type","content-length"];Object.entries(m).forEach(_=>{let[v,y]=_;ve(g).call(g,v.toLowerCase())&&d.set(v,y)})}}if($i.hasStandardBrowserEnv&&(i&&Ae.isFunction(i)&&(i=i(t)),i||i!==!1&&Tse(t.url))){const m=a&&c&&bse.read(c);m&&d.set(a,m)}return t},Rse=typeof XMLHttpRequest<"u"&&function(e){return new we(function(t,n){const i=Cj(e);let a=i.data;const c=da.from(i.headers).normalize();let d,h,m,g,_,{responseType:v,onUploadProgress:y,onDownloadProgress:b}=i;function O(){g&&g(),_&&_(),i.cancelToken&&i.cancelToken.unsubscribe(d),i.signal&&i.signal.removeEventListener("abort",d)}let I=new XMLHttpRequest;function N(){if(!I)return;const j=da.from("getAllResponseHeaders"in I&&I.getAllResponseHeaders());yj(function(G){t(G),O()},function(G){n(G),O()},{data:v&&v!=="text"&&v!=="json"?I.response:I.responseText,status:I.status,statusText:I.statusText,headers:j,config:e,request:I}),I=null}I.open(i.method.toUpperCase(),i.url,!0),I.timeout=i.timeout,"onloadend"in I?I.onloadend=N:I.onreadystatechange=function(){I&&I.readyState===4&&(I.status!==0||I.responseURL&&I.responseURL.indexOf("file:")===0)&&setTimeout(N)},I.onabort=function(){I&&(n(new tn("Request aborted",tn.ECONNABORTED,e,I)),I=null)},I.onerror=function(j){const G=new tn(j&&j.message?j.message:"Network Error",tn.ERR_NETWORK,e,I);G.event=j||null,n(G),I=null},I.ontimeout=function(){let j=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const G=i.transitional||HM;i.timeoutErrorMessage&&(j=i.timeoutErrorMessage),n(new tn(j,G.clarifyTimeoutError?tn.ETIMEDOUT:tn.ECONNABORTED,e,I)),I=null},a===void 0&&c.setContentType(null),"setRequestHeader"in I&&Ae.forEach(c.toJSON(),function(j,G){I.setRequestHeader(G,j)}),Ae.isUndefined(i.withCredentials)||(I.withCredentials=!!i.withCredentials),v&&v!=="json"&&(I.responseType=i.responseType),b&&([m,_]=tS(b,!0),I.addEventListener("progress",m)),y&&I.upload&&([h,g]=tS(y),I.upload.addEventListener("progress",h),I.upload.addEventListener("loadend",g)),(i.cancelToken||i.signal)&&(d=j=>{I&&(n(!j||j.type?new Lp(null,e,I):j),I.abort(),I=null)},i.cancelToken&&i.cancelToken.subscribe(d),i.signal&&(i.signal.aborted?d():i.signal.addEventListener("abort",d)));const k=function(j){const G=/^([-+\w]{1,25})(:?\/\/|:)/.exec(j);return G&&G[1]||""}(i.url);k&&$i.protocols.indexOf(k)===-1?n(new tn("Unsupported protocol "+k+":",tn.ERR_BAD_REQUEST,e)):I.send(a||null)})},wse=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let i,a=new AbortController;const c=function(g){if(!i){i=!0,h();const _=g instanceof Error?g:this.reason;a.abort(_ instanceof tn?_:new Lp(_ instanceof Error?_.message:_))}};let d=t&&setTimeout(()=>{d=null,c(new tn("timeout ".concat(t," of ms exceeded"),tn.ETIMEDOUT))},t);const h=()=>{e&&(d&&clearTimeout(d),d=null,e.forEach(g=>{g.unsubscribe?g.unsubscribe(c):g.removeEventListener("abort",c)}),e=null)};e.forEach(g=>g.addEventListener("abort",c));const{signal:m}=a;return m.unsubscribe=()=>Ae.asap(h),m}},pI=u(dL),Ij=xp.f("asyncIterator"),Cse=u(Ij);function mI(e,t){this.v=e,this.k=t}function Li(e){return function(){return new Og(e.apply(this,arguments))}}function Og(e){var t,n;function i(c,d){try{var h=e[c](d),m=h.value,g=m instanceof mI;pI.resolve(g?m.v:m).then(function(_){if(g){var v=c==="return"?"return":"next";if(!m.k||_.done)return i(v,_);_=e[v](_).value}a(h.done?"return":"normal",_)},function(_){i("throw",_)})}catch(_){a("throw",_)}}function a(c,d){switch(c){case"return":t.resolve({value:d,done:!0});break;case"throw":t.reject(d);break;default:t.resolve({value:d,done:!1})}(t=t.next)?i(t.key,t.arg):n=null}this._invoke=function(c,d){return new pI(function(h,m){var g={key:c,arg:d,resolve:h,reject:m,next:null};n?n=n.next=g:(t=n=g,i(c,d))})},typeof e.return!="function"&&(this.return=void 0)}function ht(e){return new mI(e,0)}function Mp(e){var t={},n=!1;function i(a,c){return n=!0,c=new pI(function(d){d(e[a](c))}),{done:!1,value:new mI(c,1)}}return t[kp!==void 0&&nj||"@@iterator"]=function(){return this},t.next=function(a){return n?(n=!1,a):i("next",a)},typeof e.throw=="function"&&(t.throw=function(a){if(n)throw n=!1,a;return i("throw",a)}),typeof e.return=="function"&&(t.return=function(a){return n?(n=!1,a):i("return",a)}),t}Og.prototype[typeof kp=="function"&&Cse||"@@asyncIterator"]=function(){return this},Og.prototype.next=function(e){return this._invoke("next",e)},Og.prototype.throw=function(e){return this._invoke("throw",e)},Og.prototype.return=function(e){return this._invoke("return",e)};var nS=u(Ij);function fI(e){var t,n,i,a=2;for(typeof Symbol<"u"&&(n=nS,i=Symbol.iterator);a--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new rS(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function rS(e){function t(n){if(Object(n)!==n)return we.reject(new TypeError(n+" is not an object."));var i=n.done;return we.resolve(n.value).then(function(a){return{value:a,done:i}})}return rS=function(n){this.s=n,this.n=n.next},rS.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?we.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?we.reject(n):t(i.apply(this.s,arguments))}},new rS(e)}const Ise=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let i,a=0;for(;a<n;)i=a+t,yield e.slice(a,i),a=i},Ase=function(){var e=Li(function*(t,n){var i,a=!1,c=!1;try{for(var d,h=fI(Nse(t));a=!(d=yield ht(h.next())).done;a=!1){const m=d.value;yield*Mp(fI(Ise(m,n)))}}catch(m){c=!0,i=m}finally{try{a&&h.return!=null&&(yield ht(h.return()))}finally{if(c)throw i}}});return function(t,n){return e.apply(this,arguments)}}(),Nse=function(){var e=Li(function*(t){if(t[nS])return void(yield*Mp(fI(t)));const n=t.getReader();try{for(;;){const{done:i,value:a}=yield ht(n.read());if(i)break;yield a}}finally{yield ht(n.cancel())}});return function(t){return e.apply(this,arguments)}}(),Aj=(e,t,n,i)=>{const a=Ase(e,t);let c,d=0,h=m=>{c||(c=!0,i&&i(m))};return new ReadableStream({async pull(m){try{const{done:g,value:_}=await a.next();if(g)return h(),void m.close();let v=_.byteLength;if(n){let y=d+=v;n(y)}m.enqueue(new Uint8Array(_))}catch(g){throw h(g),g}},cancel:m=>(h(m),a.return())},{highWaterMark:2})};function Nj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function xj(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Nj(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Nj(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const{isFunction:iS}=Ae,xse=(e=>{let{Request:t,Response:n}=e;return{Request:t,Response:n}})(Ae.global),{ReadableStream:Oj,TextEncoder:Pj}=Ae.global,Dj=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return!!e(...n)}catch{return!1}},Ose=e=>{e=Ae.merge.call({skipUndefined:!0},xse,e);const{fetch:t,Request:n,Response:i}=e,a=t?iS(t):typeof fetch=="function",c=iS(n),d=iS(i);if(!a)return!1;const h=a&&iS(Oj),m=a&&(typeof Pj=="function"?(g=new Pj,O=>g.encode(O)):async O=>new Uint8Array(await new n(O).arrayBuffer()));var g;const _=c&&h&&Dj(()=>{let O=!1;const I=new n($i.origin,{body:new Oj,method:"POST",get duplex(){return O=!0,"half"}}).headers.has("Content-Type");return O&&!I}),v=d&&h&&Dj(()=>Ae.isReadableStream(new i("").body)),y={stream:v&&(O=>O.body)};a&&["text","arrayBuffer","blob","formData","stream"].forEach(O=>{!y[O]&&(y[O]=(I,N)=>{let k=I&&I[O];if(k)return k.call(I);throw new tn("Response type '".concat(O,"' is not supported"),tn.ERR_NOT_SUPPORT,N)})});const b=async(O,I)=>{const N=Ae.toFiniteNumber(O.getContentLength());return N??(async k=>k==null?0:Ae.isBlob(k)?k.size:Ae.isSpecCompliantForm(k)?(await new n($i.origin,{method:"POST",body:k}).arrayBuffer()).byteLength:Ae.isArrayBufferView(k)||Ae.isArrayBuffer(k)?k.byteLength:(Ae.isURLSearchParams(k)&&(k+=""),Ae.isString(k)?(await m(k)).byteLength:void 0))(I)};return async O=>{let{url:I,method:N,data:k,signal:j,cancelToken:G,timeout:K,onDownloadProgress:X,onUploadProgress:z,responseType:ne,headers:me,withCredentials:Ee="same-origin",fetchOptions:Oe}=Cj(O),Qe=t||fetch;ne=ne?(ne+"").toLowerCase():"text";let qe=wse([j,G&&G.toAbortSignal()],K),dt=null;const at=qe&&qe.unsubscribe&&(()=>{qe.unsubscribe()});let Ut;try{if(z&&_&&N!=="get"&&N!=="head"&&(Ut=await b(me,k))!==0){let C,B=new n(I,{method:"POST",body:k,duplex:"half"});if(Ae.isFormData(k)&&(C=B.headers.get("content-type"))&&me.setContentType(C),B.body){const[H,Se]=Sj(Ut,tS(Tj(z)));k=Aj(B.body,65536,H,Se)}}Ae.isString(Ee)||(Ee=Ee?"include":"omit");const vn=c&&"credentials"in n.prototype,ge=xj(xj({},Oe),{},{signal:qe,method:N.toUpperCase(),headers:me.normalize().toJSON(),body:k,duplex:"half",credentials:vn?Ee:void 0});dt=c&&new n(I,ge);let Re=await(c?Qe(dt,Oe):Qe(I,ge));const ke=v&&(ne==="stream"||ne==="response");if(v&&(X||ke&&at)){const C={};["status","statusText","headers"].forEach(et=>{C[et]=Re[et]});const B=Ae.toFiniteNumber(Re.headers.get("content-length")),[H,Se]=X&&Sj(B,tS(Tj(X),!0))||[];Re=new i(Aj(Re.body,65536,H,()=>{Se&&Se(),at&&at()}),C)}ne=ne||"text";let _e=await y[Ae.findKey(y,ne)||"text"](Re,O);return!ke&&at&&at(),await new we((C,B)=>{yj(C,B,{data:_e,headers:da.from(Re.headers),status:Re.status,statusText:Re.statusText,config:O,request:dt})})}catch(vn){throw at&&at(),vn&&vn.name==="TypeError"&&/Load failed|fetch/i.test(vn.message)?Object.assign(new tn("Network Error",tn.ERR_NETWORK,O,dt),{cause:vn.cause||vn}):tn.from(vn,vn&&vn.code,O,dt)}}},Pse=new Map,kj=e=>{let t=e&&e.env||{};const{fetch:n,Request:i,Response:a}=t,c=[i,a,n];let d,h,m=c.length,g=Pse;for(;m--;)d=c[m],h=g.get(d),h===void 0&&g.set(d,h=m?new Map:Ose(t)),g=h;return h};kj();const gI={http:null,xhr:Rse,fetch:{get:kj}};Ae.forEach(gI,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const Lj=e=>"- ".concat(e),Dse=e=>Ae.isFunction(e)||e===null||e===!1;var Mj={getAdapter:function(e,t){e=Ae.isArray(e)?e:[e];const{length:n}=e;let i,a;const c={};for(let d=0;d<n;d++){let h;if(i=e[d],a=i,!Dse(i)&&(a=gI[(h=String(i)).toLowerCase()],a===void 0))throw new tn("Unknown adapter '".concat(h,"'"));if(a&&(Ae.isFunction(a)||(a=a.get(t))))break;c[h||"#"+d]=a}if(!a){const d=Object.entries(c).map(h=>{let[m,g]=h;return"adapter ".concat(m," ")+(g===!1?"is not supported by the environment":"is not available in the build")});throw new tn("There is no suitable adapter to dispatch the request "+(n?d.length>1?`since :
`+d.map(Lj).join(`
`):" "+Lj(d[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return a},adapters:gI};function _I(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Lp(null,e)}function Uj(e){return _I(e),e.headers=da.from(e.headers),e.data=uI.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),Mj.getAdapter(e.adapter||lI.adapter,e)(e).then(function(t){return _I(e),t.data=uI.call(e,e.transformResponse,t),t.headers=da.from(t.headers),t},function(t){return vj(t)||(_I(e),t&&t.response&&(t.response.data=uI.call(e,e.transformResponse,t.response),t.response.headers=da.from(t.response.headers))),we.reject(t)})}const jj="1.13.2",sS={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{sS[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const Vj={};sS.transitional=function(e,t,n){function i(a,c){return"[Axios v"+jj+"] Transitional option '"+a+"'"+c+(n?". "+n:"")}return(a,c,d)=>{if(e===!1)throw new tn(i(c," has been removed"+(t?" in "+t:"")),tn.ERR_DEPRECATED);return t&&!Vj[c]&&(Vj[c]=!0,console.warn(i(c," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(a,c,d)}},sS.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var oS={assertOptions:function(e,t,n){if(typeof e!="object")throw new tn("options must be an object",tn.ERR_BAD_OPTION_VALUE);const i=Object.keys(e);let a=i.length;for(;a-- >0;){const c=i[a],d=t[c];if(d){const h=e[c],m=h===void 0||d(h,c,e);if(m!==!0)throw new tn("option "+c+" must be "+m,tn.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new tn("Unknown option "+c,tn.ERR_BAD_OPTION)}},validators:sS};const ec=oS.validators;let aS=class{constructor(e){this.defaults=e||{},this.interceptors={request:new zM,response:new zM}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const a=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?a&&!String(n.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+a):n.stack=a}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=xu(this.defaults,t);const{transitional:n,paramsSerializer:i,headers:a}=t;n!==void 0&&oS.assertOptions(n,{silentJSONParsing:ec.transitional(ec.boolean),forcedJSONParsing:ec.transitional(ec.boolean),clarifyTimeoutError:ec.transitional(ec.boolean)},!1),i!=null&&(Ae.isFunction(i)?t.paramsSerializer={serialize:i}:oS.assertOptions(i,{encode:ec.function,serialize:ec.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),oS.assertOptions(t,{baseUrl:ec.spelling("baseURL"),withXsrfToken:ec.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let c=a&&Ae.merge(a.common,a[t.method]);a&&Ae.forEach(["delete","get","head","post","put","patch","common"],b=>{delete a[b]}),t.headers=da.concat(c,a);const d=[];let h=!0;this.interceptors.request.forEach(function(b){typeof b.runWhen=="function"&&b.runWhen(t)===!1||(h=h&&b.synchronous,d.unshift(b.fulfilled,b.rejected))});const m=[];let g;this.interceptors.response.forEach(function(b){m.push(b.fulfilled,b.rejected)});let _,v=0;if(!h){const b=[Uj.bind(this),void 0];for(b.unshift(...d),b.push(...m),_=b.length,g=we.resolve(t);v<_;)g=g.then(b[v++],b[v++]);return g}_=d.length;let y=t;for(;v<_;){const b=d[v++],O=d[v++];try{y=b(y)}catch(I){O.call(this,I);break}}try{g=Uj.call(this,y)}catch(b){return we.reject(b)}for(v=0,_=m.length;v<_;)g=g.then(m[v++],m[v++]);return g}getUri(e){return WM(bj((e=xu(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Ae.forEach(["delete","get","head","options"],function(e){aS.prototype[e]=function(t,n){return this.request(xu(n||{},{method:e,url:t,data:(n||{}).data}))}}),Ae.forEach(["post","put","patch"],function(e){function t(n){return function(i,a,c){return this.request(xu(c||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:a}))}}aS.prototype[e]=t(),aS.prototype[e+"Form"]=t(!0)});var cS=aS;class EI{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new we(function(a){n=a});const i=this;this.promise.then(a=>{if(!i._listeners)return;let c=i._listeners.length;for(;c-- >0;)i._listeners[c](a);i._listeners=null}),this.promise.then=a=>{let c;const d=new we(h=>{i.subscribe(h),c=h}).then(a);return d.cancel=function(){i.unsubscribe(c)},d},t(function(a,c,d){i.reason||(i.reason=new Lp(a,c,d),n(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=i=>{t.abort(i)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new EI(function(i){t=i}),cancel:t}}}var kse=EI;const vI={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(vI).forEach(e=>{let[t,n]=e;vI[n]=t});var Lse=vI;const ti=function e(t){const n=new cS(t),i=CM(cS.prototype.request,n);return Ae.extend(i,cS.prototype,n,{allOwnKeys:!0}),Ae.extend(i,n,null,{allOwnKeys:!0}),i.create=function(a){return e(xu(t,a))},i}(lI);ti.Axios=cS,ti.CanceledError=Lp,ti.CancelToken=kse,ti.isCancel=vj,ti.VERSION=jj,ti.toFormData=Gy,ti.AxiosError=tn,ti.Cancel=ti.CanceledError,ti.all=function(e){return we.all(e)},ti.spread=function(e){return function(t){return e.apply(null,t)}},ti.isAxiosError=function(e){return Ae.isObject(e)&&e.isAxiosError===!0},ti.mergeConfig=xu,ti.AxiosHeaders=da,ti.formToJSON=e=>_j(Ae.isHTMLForm(e)?new FormData(e):e),ti.getAdapter=Mj.getAdapter,ti.HttpStatusCode=Lse,ti.default=ti;var Mi=ti;const Mse=()=>{};function Pg(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Mse};return e.promise=new we((t,n)=>{e.resolve=i=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(i),e.value=i)},e.reject=i=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(i))}}),e}const lS=new Map,dS=new Map,tc=new Map;let hr=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Mt=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const Fj=new _ne;let ua=Fj.getResult(),yI=null;function Pt(e){if(!yI){ua=Fj.getResult();const t=function(h){if(h.engine.name==="Blink"&&h.browser.name!=="WeChat")return Mt.CHROME;switch(h.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Mt.CHROME;case"Safari":case"Mobile Safari":return Mt.SAFARI;case"Edge":return Mt.EDGE;case"Firefox":return Mt.FIREFOX;case"QQ":case"QQBrowser":return Mt.QQ;case"Opera":return Mt.OPERA;case"WeChat":return Mt.WECHAT;default:return h.browser.name||""}}(ua),n=Bj(ua),i=function(h){return h.os.name==="Windows"?h.os.version?h.os.name+" "+h.os.version:h.os.name:h.os.name||""}(ua),a=ua.os.version,c=Bj(ua,!1),d=ua.device.type;if(!(t&&n&&i&&a))return{name:t,version:n,os:i,osVersion:a,browserVersion:c,deviceType:d};yI={name:t,version:n,os:i,osVersion:a,browserVersion:c,deviceType:d}}return yI}function Bj(e){let t,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function uS(){return Pt().os}function Gj(){const e=Pt();return"".concat(e.os," ").concat(e.osVersion)}function hS(){const e=Pt();return!!(ua.engine.name==="WebKit"&&e.os===hr.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Mt.SAFARI||ni()&&e.name!==Mt.SAFARI)}function zc(){return Pt().name===Mt.CHROME}function wr(){return Pt().name===Mt.SAFARI}function Wj(){const e=Pt();if(e.name!==Mt.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function zj(){return Pt().name===Mt.EDGE}function pn(){return Pt().name===Mt.FIREFOX}function ni(){return Pt().os===hr.IOS}function ha(e){const t=Pt();return!(t.name!==Mt.CHROME||!t.osVersion)&&Number(t.version)>=e}function Hj(e){const t=Pt();return!(t.name!==Mt.CHROME||!t.osVersion)&&Number(t.version)<e}function SI(e,t,n){const i=Pt();return!(i.name!==e||!i.osVersion)&&(n?Number(i.version)>=t&&Number(i.version)<=n:Number(i.version)===t)}function $l(e){const t=Pt();return!(t.name!==Mt.EDGE||!t.osVersion)&&Number(t.version)>=e}function TI(e){const t=Pt();return!(t.name!==Mt.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function Kj(e){const t=Pt();return!(t.name!==Mt.SAFARI||!t.osVersion)&&Number(t.version)>=e}function qj(e,t,n){const i=Pt();if(i.os!==hr.IOS||!i.osVersion)return!1;const a=i.osVersion.split(".");return n?t&&Number(a[0])===e&&Number(a[1])>t||Number(a[0])>e:t?Number(a[0])===e&&Number(a[1])>=t||Number(a[0])>e:Number(a[0])>=e}function Yj(e,t,n){const i=Pt();if(i.os!==hr.IOS||!i.osVersion)return!1;const a=i.osVersion.split(".");return n?t&&Number(a[0])===e&&Number(a[1])<t||Number(a[0])<e:t?Number(a[0])===e&&Number(a[1])<=t||Number(a[0])<e:Number(a[0])<=e}function bI(e,t,n){const i=Pt();if(i.name!==Mt.SAFARI||!i.osVersion||!i.browserVersion)return!1;const a=i.browserVersion.split(".");return n?t&&Number(a[0])===e&&Number(a[1])<t||Number(a[0])<e:t?Number(a[0])===e&&Number(a[1])<=t||Number(a[0])<e:Number(a[0])<=e}function Ou(e){const t=Pt();return!(t.name!==Mt.OPERA||!t.osVersion)&&Number(t.version)>=e}function Xj(){const e=Pt();if(e.os!==hr.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function Up(){const e=Pt();if(e.os!==hr.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function RI(){const e=Pt();if(e.os!==hr.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function Jj(){const e=Pt();if(e.os!==hr.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function xo(){return wr()&&navigator.maxTouchPoints>0}function Qj(){return Pt().name===Mt.WECHAT}function $j(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function Zj(){const e=uS();return function(){const{deviceType:t}=Pt();return t==="mobile"||t==="tablet"}()||e===hr.ANDROID||e===hr.IOS||e===hr.HARMONY_OS}function nc(){const e=Pt();return e.name!==Mt.EDGE&&e.name!==Mt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Dg(){return uS()===hr.ANDROID}function kg(){const e=Pt();return Dg()&&(e.name===Mt.CHROME||e.name===Mt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function rt(e,t,n){return(t=function(i){var a=function(c,d){if(typeof c!="object"||!c)return c;var h=c[Symbol.toPrimitive];if(h!==void 0){var m=h.call(c,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(c)}(i);return typeof a=="symbol"?a:a+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function eV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function be(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?eV(Object(n),!0).forEach(function(i){rt(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eV(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let L=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),de=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),rt(this,"code",void 0),rt(this,"message",void 0),rt(this,"data",void 0),rt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Oo(e,t){if(typeof e!="boolean")throw new de(L.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function Hn(e,t,n){if(!ve(n).call(n,e))throw new de(L.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function nn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<n||e>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(a){return typeof a=="number"&&a%1==0}(e))throw new de(L.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(i,"]. integer only"))}function wI(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new de(L.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&nn(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&nn(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&nn(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&nn(e.ideal,"".concat(t,".ideal"),1,1/0)}else nn(e,t,1,1/0)}function Lr(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,a=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new de(L.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!tV(e,n,i,a))throw new de(L.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(i,"].").concat(a?" ASCII characters only.":""))}function Hc(e,t){if(!Array.isArray(e))throw new de(L.INVALID_PARAMS,"".concat(t," should be an array"))}function An(e){return e==null}function tV(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!i||function(a){if(typeof a!="string")return!1;for(let c=0;c<a.length;c+=1){const d=a.charCodeAt(c);if(d<0||d>255)return!1}return!0}(e))}function nV(e,t,n){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,n);const i=e.getUint32(t,n),a=e.getUint32(t+4,n),c=0,d=+!n;return BigInt(i*d+a*c)<<BigInt(32)|BigInt(i*c+a*d)}function rV(e,t,n,i){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,n,i);const a=Number(n>>BigInt(32)),c=Number(n&BigInt(4294967295));e.setUint32(t,a,i),e.setUint32(t+4,c,i)}var Lg=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(Lg||{}),CI=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(CI||{});const iV=new class{constructor(){rt(this,"_clientSize",null),rt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),rt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),rt(this,"getStyle",e=>window.getComputedStyle(e,null)),rt(this,"checkCssVisibleProperty",e=>{var t;let n=!0;const i=this.getStyle(e),{display:a,visibility:c,opacity:d,filter:h}=i;return(a==="none"||ve(t=["hidden","collapse"]).call(t,c)||Number(d)<.1)&&(n=!1),!!n&&(h&&h.split(" ").filter(m=>{var g;const _=m.split("(")[0];return ve(g=["brightness","blur","opacity"]).call(g,_)}).map(m=>{const[g,_]=m.split(/\(|\)/);return[g,Number(_.match(/^[0-9\.]+/))]}).forEach(m=>{const[g,_]=m;switch(g){case"brightness":(_<.1||_>3)&&(n=!1);break;case"blur":_>3&&(n=!1);break;case"opacity":_<.1&&(n=!1)}}),n)}),rt(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,i=!0;const a=d=>t(d);let c=e;for(;c&&i;)a(c)||(n=!1,i=!1),c=c.parentElement,c||(i=!1);return n}),rt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),rt(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:i,right:a,top:c,bottom:d}=e.getBoundingClientRect(),h=this.getClientWidth(),m=this.getClientHeight();return{width:t,height:n,left:i,right:a,top:c,bottom:d,clientWidth:h,clientHeight:m,clientMin:Math.min(h,m)}}),rt(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),rt(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),rt(this,"checkCoverForAPoint",(e,t,n)=>{const i=this.elementFromPoint(e,t);return i!==null&&i!==n}),rt(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:i}=this._clientSize,a=e/6,c=t/6,d=[],h=10**6;for(let m=0;m<5;m++)for(let g=0;g<5;g++){const _=(n*h+(m===0?.1:m===4?(a*m*h-1e5)/h:a*m)*h)/h,v=(i*h+(g===0?.1:g===4?(c*g*h-1e5)/h:c*g)*h)/h;d.push({x:_,y:v})}return[...d]}),rt(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),rt(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),rt(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:i,clientHeight:a,clientWidth:c,clientMin:d}=this._clientSize;let h,m,g,_;if(e<0)h=0;else{if(!(e<c))return!1;h=e}if(t<0)return!1;if(m=t<c?t:c,n<0)g=0;else{if(!(n<a))return!1;g=n}if(i<0)return!1;_=i<a?i:a;const v=m-h,y=_-g;return this.checkSizeIsVisible(v,y,d)}),rt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),rt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Lg.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(Lg.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Lg.SIZE)}}return this.returnHiddenResult(Lg.STYLE)}return this.returnHiddenResult(CI.UNMOUNTED)}return this.returnHiddenResult(CI.INVALID_HTML_ELEMENT)}),rt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function II(e){return new TextEncoder().encode(e)}const sV=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},AI=async e=>function(t,n){let i="";return new Uint8Array(t).forEach(a=>{i+=a.toString(n).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",II(e)),16);let Sn=class{constructor(){rt(this,"_events",{}),rt(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const n=this._events[e],i=this._indexOfListener(n,t);i!==-1&&n.splice(i,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map(c=>c);for(var n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];for(let c=0;c<t.length;c+=1){const d=t[c];d.once&&this.off(e,d.listener),d.listener.apply(this,i||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];[...this._events[e]||[]].forEach(a=>{a.once&&this.off(e,a.listener);try{a.listener.apply(this,n)}catch(c){console.error("safeEmit event:".concat(e," error ").concat(c==null?void 0:c.toString()))}})}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}},Mg=null;function oV(){if(Mg)return Mg;if(window.electron)return Mg=window.electron;if(!window.require)return null;try{return Mg=window.require("electron"),Mg}catch{return null}}let _n=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e.VOS_FALLBACK_CN="vosFallbackCN",e.DATACHANNEL_FAILBACK="datachannelFailback",e}({}),rn=function(e){return e.TRACER="tracer",e}({});function aV(e){return nn(e.timeout,"config.timeout",0,1e5),nn(e.timeoutFactor,"config.timeoutFactor",0,100,!1),nn(e.maxRetryCount,"config.maxRetryConfig",0,1/0),nn(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Use=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Tt=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.FALLBACK_TO_HLS="FALLBACK_TO_HLS",e.UID_CONFLICT="UID_CONFLICT",e}({});function Pu(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function cV(e){return Lr(e.turnServerURL,"turnServerURL"),Lr(e.username,"username"),Lr(e.password,"password"),e.udpport&&nn(e.udpport,"udpport",1,99999,!0),e.forceturn&&Oo(e.forceturn,"forceturn"),e.security&&Oo(e.security,"security"),e.tcpport&&nn(e.tcpport,"tcpport",1,99999,!0),!0}let jp=function(e){return e[e.AUTO_SIMULCAST_STREAM=-1]="AUTO_SIMULCAST_STREAM",e[e.DISABLE_SIMULCAST_STREM=0]="DISABLE_SIMULCAST_STREM",e[e.ENABLE_SIMULCAST_STREAM=1]="ENABLE_SIMULCAST_STREAM",e}({});function NI(e){return e.level!==void 0&&Hn(e.level,"level",[1,2,3]),e.delay!==void 0&&nn(e.delay,"delay",0,3e3,!0),!0}let ft=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e.FALLBACK_TO_HLS="fallback-to-hls",e.FIRST_VIDEO_BUFFER_READY="first-video-buffer-ready",e.FIRST_VIDEO_PRE_RENDER="first-video-pre-render",e.AV1_DECODABLE_RESULT="av1-decodable-result",e}({}),xI=function(e){return e.CONFIG="config",e.VOSERROR="vos_error",e.AP_ERROR="ap_error",e}({}),Wr=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),wi=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Du=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function Zn(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),a=2;a<n;a++)i[a-2]=arguments[a];return e.getListeners(t).length===0?we.reject(new de(L.UNEXPECTED_ERROR,"can not emit promise")):new we((c,d)=>{e.emit(t,...i,c,d)})}function cn(e,t){if(e.getListeners(t).length===0)return we.resolve();for(var n=arguments.length,i=new Array(n>2?n-2:0),a=2;a<n;a++)i[a-2]=arguments[a];return Zn(e,t,...i)}function Ss(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,i=new Array(n>2?n-2:0),a=2;a<n;a++)i[a-2]=arguments[a];return ku(e,t,...i)}function ku(e,t){let n=null,i=null;for(var a=arguments.length,c=new Array(a>2?a-2:0),d=2;d<a;d++)c[d-2]=arguments[d];if(e.emit(t,...c,h=>{n=h},h=>{i=h}),i!==null)throw i;if(n===null)throw new de(L.UNEXPECTED_ERROR,"handler is not sync");return n}const Nn=new class extends Sn{set networkState(e){this.emit(Du.NETWORK_STATE_CHANGE,e,this._networkState),e===wi.ONLINE?this.emit(Du.ONLINE):e===wi.OFFLINE&&(this.onlineWaiter=new we(t=>{this.once(Du.ONLINE,()=>{this.onlineWaiter=void 0,t(wi.ONLINE)})}),this.emit(Du.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===wi.ONLINE}constructor(){super(),rt(this,"_moduleName","network-indicator"),rt(this,"_networkState",wi.ONLINE),rt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=wi.ONLINE}),window.addEventListener("offline",()=>{this.networkState=wi.OFFLINE})}},Ui=[];for(let e=0;e<256;++e)Ui.push((e+256).toString(16).slice(1));const lV=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);let OI;const jse=new Uint8Array(16);function Vse(){return lV?lV():function(n,i,a){var c,d,h,m;const g=(c=(d=(n=n||{}).random)!==null&&d!==void 0?d:(h=(m=n).rng)===null||h===void 0?void 0:h.call(m))!==null&&c!==void 0?c:function(){if(!OI){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");OI=crypto.getRandomValues.bind(crypto)}return OI(jse)}();if(g.length<16)throw new Error("Random bytes length must be >= 16");if(g[6]=15&g[6]|64,g[8]=63&g[8]|128,i){if((a=a||0)<0||a+16>i.length)throw new RangeError("UUID byte range ".concat(a,":").concat(a+15," is out of buffer bounds"));for(let _=0;_<16;++_)i[a+_]=g[_];return i}return function(_){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(Ui[_[v+0]]+Ui[_[v+1]]+Ui[_[v+2]]+Ui[_[v+3]]+"-"+Ui[_[v+4]]+Ui[_[v+5]]+"-"+Ui[_[v+6]]+Ui[_[v+7]]+"-"+Ui[_[v+8]]+Ui[_[v+9]]+"-"+Ui[_[v+10]]+Ui[_[v+11]]+Ui[_[v+12]]+Ui[_[v+13]]+Ui[_[v+14]]+Ui[_[v+15]]).toLowerCase()}(g)}(e,t,void 0);var e,t}function pS(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function Vp(e){const t=[];return e.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),t}function mS(e){we!==void 0?we.resolve().then(e):setTimeout(e,0)}function mn(e){return JSON.parse(JSON.stringify(e))}function Lu(e){try{return mn(e)}catch{return e}}const dV={};function Zl(e,t){dV[t]||(dV[t]=!0,e())}function Mu(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let i=0;i<t.length;i+=1)n[i]=t.charCodeAt(i);return n}function ed(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function uV(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const i=new Uint8Array(t);i.set(n),n=i}return n}function hV(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=to(t).call(t,(d,h)=>d+h.length,0),a=new Uint8Array(new ArrayBuffer(i));let c=0;return t.forEach(d=>{a.set(d,c),c+=d.length}),a}function rc(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function pV(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(n=>{t+=typeof n=="string"?rc(n):n.size}),t+138}function Fse(e){const t=new de(L.TIMEOUT,"timeout");return new we((n,i)=>{window.setTimeout(()=>i(t),e)})}function pr(e){return new we(t=>{window.setTimeout(t,e)})}function Wt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+Wt(e-n.length,"")}function Uu(){let e,t=!1;try{var n;e=gne(n=Vse()).call(n,"-","")}catch{t=!0}return!t&&e&&e.length===32||(e=Wt(32,"")),e.toUpperCase()}const Ug=()=>{},mV=new class{constructor(){rt(this,"fnMap",new Map)}throttleByKey(e,t,n,i){for(var a=arguments.length,c=new Array(a>4?a-4:0),d=4;d<a;d++)c[d-4]=arguments[d];if(this.fnMap.has(t)){const h=this.fnMap.get(t);if(h.threshold!==n){h.fn(...h.args),clearTimeout(h.timer);const m=window.setTimeout(()=>{const g=this.fnMap.get(t);g&&g.fn(...g.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:m,args:c,skipFn:i})}else h.skipFn&&h.skipFn(...h.args),this.fnMap.set(t,be(be({},h),{},{fn:e,args:c,skipFn:i}))}else{const h=window.setTimeout(()=>{const m=this.fnMap.get(t);m&&m.fn(...m.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:h,args:c,skipFn:i})}}},fV=mV.throttleByKey.bind(mV);function gV(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function PI(e,t){if(!gV(e)||!gV(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let i=0;i<t.length;i++)n[i]=PI(e[i],t[i]);return n}{const n=be({},e);for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(Object.prototype.hasOwnProperty.call(e,i)?n[i]=PI(e[i],t[i]):n[i]=t[i]);return n}}function _V(e,t){let n=[0];if(n=new Array(t).fill(0),e===0)return n;let i=0;for(;e>0&&(n[i]=255&e,e>>=8,i++,i!==t););return n}function Fp(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function DI(e,t){try{return typeof e=="object"&&typeof t=="object"&&JSON.stringify(e)===JSON.stringify(t)}catch{return!1}}function kI(e){return to(e).call(e,(t,n)=>t+n,0)}function EV(e){const t="0123456789abcdef";function n(G){let K,X="";for(K=0;K<=3;K++)X+=t.charAt(G>>8*K+4&15)+t.charAt(G>>8*K&15);return X}function i(G,K){const X=(65535&G)+(65535&K);return(G>>16)+(K>>16)+(X>>16)<<16|65535&X}function a(G,K,X,z,ne,me){return i(function(Ee,Oe){return Ee<<Oe|Ee>>>32-Oe}(i(i(K,G),i(z,me)),ne),X)}function c(G,K,X,z,ne,me,Ee){return a(K&X|~K&z,G,K,ne,me,Ee)}function d(G,K,X,z,ne,me,Ee){return a(K&z|X&~z,G,K,ne,me,Ee)}function h(G,K,X,z,ne,me,Ee){return a(K^X^z,G,K,ne,me,Ee)}function m(G,K,X,z,ne,me,Ee){return a(X^(K|~z),G,K,ne,me,Ee)}const g=function(G){let K;const X=1+(G.length+8>>6),z=new Array(16*X);for(K=0;K<16*X;K++)z[K]=0;for(K=0;K<G.length;K++)z[K>>2]|=G.charCodeAt(K)<<K%4*8;return z[K>>2]|=128<<K%4*8,z[16*X-2]=8*G.length,z}(e);let _,v,y,b,O,I=1732584193,N=-271733879,k=-1732584194,j=271733878;for(_=0;_<g.length;_+=16)v=I,y=N,b=k,O=j,I=c(I,N,k,j,g[_+0],7,-680876936),j=c(j,I,N,k,g[_+1],12,-389564586),k=c(k,j,I,N,g[_+2],17,606105819),N=c(N,k,j,I,g[_+3],22,-1044525330),I=c(I,N,k,j,g[_+4],7,-176418897),j=c(j,I,N,k,g[_+5],12,1200080426),k=c(k,j,I,N,g[_+6],17,-1473231341),N=c(N,k,j,I,g[_+7],22,-45705983),I=c(I,N,k,j,g[_+8],7,1770035416),j=c(j,I,N,k,g[_+9],12,-1958414417),k=c(k,j,I,N,g[_+10],17,-42063),N=c(N,k,j,I,g[_+11],22,-1990404162),I=c(I,N,k,j,g[_+12],7,1804603682),j=c(j,I,N,k,g[_+13],12,-40341101),k=c(k,j,I,N,g[_+14],17,-1502002290),N=c(N,k,j,I,g[_+15],22,1236535329),I=d(I,N,k,j,g[_+1],5,-165796510),j=d(j,I,N,k,g[_+6],9,-1069501632),k=d(k,j,I,N,g[_+11],14,643717713),N=d(N,k,j,I,g[_+0],20,-373897302),I=d(I,N,k,j,g[_+5],5,-701558691),j=d(j,I,N,k,g[_+10],9,38016083),k=d(k,j,I,N,g[_+15],14,-660478335),N=d(N,k,j,I,g[_+4],20,-405537848),I=d(I,N,k,j,g[_+9],5,568446438),j=d(j,I,N,k,g[_+14],9,-1019803690),k=d(k,j,I,N,g[_+3],14,-187363961),N=d(N,k,j,I,g[_+8],20,1163531501),I=d(I,N,k,j,g[_+13],5,-1444681467),j=d(j,I,N,k,g[_+2],9,-51403784),k=d(k,j,I,N,g[_+7],14,1735328473),N=d(N,k,j,I,g[_+12],20,-1926607734),I=h(I,N,k,j,g[_+5],4,-378558),j=h(j,I,N,k,g[_+8],11,-2022574463),k=h(k,j,I,N,g[_+11],16,1839030562),N=h(N,k,j,I,g[_+14],23,-35309556),I=h(I,N,k,j,g[_+1],4,-1530992060),j=h(j,I,N,k,g[_+4],11,1272893353),k=h(k,j,I,N,g[_+7],16,-155497632),N=h(N,k,j,I,g[_+10],23,-1094730640),I=h(I,N,k,j,g[_+13],4,681279174),j=h(j,I,N,k,g[_+0],11,-358537222),k=h(k,j,I,N,g[_+3],16,-722521979),N=h(N,k,j,I,g[_+6],23,76029189),I=h(I,N,k,j,g[_+9],4,-640364487),j=h(j,I,N,k,g[_+12],11,-421815835),k=h(k,j,I,N,g[_+15],16,530742520),N=h(N,k,j,I,g[_+2],23,-995338651),I=m(I,N,k,j,g[_+0],6,-198630844),j=m(j,I,N,k,g[_+7],10,1126891415),k=m(k,j,I,N,g[_+14],15,-1416354905),N=m(N,k,j,I,g[_+5],21,-57434055),I=m(I,N,k,j,g[_+12],6,1700485571),j=m(j,I,N,k,g[_+3],10,-1894986606),k=m(k,j,I,N,g[_+10],15,-1051523),N=m(N,k,j,I,g[_+1],21,-2054922799),I=m(I,N,k,j,g[_+8],6,1873313359),j=m(j,I,N,k,g[_+15],10,-30611744),k=m(k,j,I,N,g[_+6],15,-1560198380),N=m(N,k,j,I,g[_+13],21,1309151649),I=m(I,N,k,j,g[_+4],6,-145523070),j=m(j,I,N,k,g[_+11],10,-1120210379),k=m(k,j,I,N,g[_+2],15,718787259),N=m(N,k,j,I,g[_+9],21,-343485551),I=i(I,v),N=i(N,y),k=i(k,b),j=i(j,O);return n(I)+n(N)+n(k)+n(j)}let Bse=1,vV=console,Cr=class{static setLogger(e){vV=e}constructor(e,t){rt(this,"id",void 0),rt(this,"lockingPromise",we.resolve()),rt(this,"locks",0),rt(this,"name",""),rt(this,"lockId",void 0),this.lockId=Bse++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),i=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");vV.debug("".concat(n," ").concat(i))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const n=new we(a=>{t=()=>{this.locks-=1,this.logger("unlocked",e),a()}}),i=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>n),i}};function Bp(e,t){return function(n,i,a){const c=a.value;if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return a.value=async function(){const d=this[t];if(!d)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const h=await d.lock("From ".concat(e,".").concat(i));try{for(var m=arguments.length,g=new Array(m),_=0;_<m;_++)g[_]=arguments[_];return await c.apply(this,g)}finally{h()}},a}}const Kn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function fS(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function pa(e,t,n,i){const a=Object.assign({},Kn,i);let c=a.timeout;const d=async()=>{await function(g){return new we(_=>{window.setTimeout(_,g)})}(c),c*=a.timeoutFactor,c=Math.min(a.maxRetryTimeout,c)};let h=!1;const m=new we(async(g,_)=>{t=t||(()=>!1),n=n||(()=>!0);for(let v=0;v<a.maxRetryCount;v+=1){if(h)return _(new de(L.OPERATION_ABORTED));try{const y=await e();if(!t(y,v)||v+1===a.maxRetryCount)return g(y);await d()}catch(y){if(!n(y,v)||v+1===a.maxRetryCount)return _(y);await d()}}});return m.cancel=()=>h=!0,m}let gS,LI=class{constructor(e){rt(this,"input",[]),rt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:to(e=this.input).call(e,(t,n)=>t+n)/this.input.length}},_S=0,MI=0;function UI(e,t,n,i){return new we((a,c)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),_S+=rc(t.data)):n&&(t.data.size?_S+=t.data.size:t.data instanceof FormData?_S+=pV(t.data):_S+=rc(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Mi.request(t).then(d=>{typeof d.data=="string"?MI+=rc(d.data):d.data instanceof ArrayBuffer||d.data instanceof Uint8Array?MI+=d.data.byteLength:MI+=rc(JSON.stringify(d.data)),a(d.data)}).catch(d=>{Mi.isCancel(d)?c(new de(L.OPERATION_ABORTED,"cancel token canceled")):d.code==="ECONNABORTED"?c(new de(L.NETWORK_TIMEOUT,d.message)):d.response?c(new de(L.NETWORK_RESPONSE_ERROR,d.response.status)):c(new de(L.NETWORK_ERROR,d.message))})})}async function Gse(e,t){const n=new Blob([t.data],{type:"buffer"});return await UI(e,be(be({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const yV=()=>window.isSecureContext!==void 0;function Po(e){if(Array.isArray(e))return e.map(n=>n);if(!SV(e))return e;const t={};for(const n in e){const i=e[n];SV(i)||Array.isArray(i)?t[n]=Po(i):t[n]=i}return t}function SV(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let jI=class{constructor(e){rt(this,"input",[]),rt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Do={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},jg={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],transport:{bytesSent:0,bytesReceived:0,packetsSent:0,packetsReceived:0},selectedCandidatePair:{id:"unknown",localCandidate:Do,remoteCandidate:Do},updateInterval:0},TV={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},bV={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},RV={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},wV={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let VI=class{constructor(e,t){rt(this,"onFirstVideoReceived",void 0),rt(this,"onFirstVideoDecoded",void 0),rt(this,"onFirstAudioReceived",void 0),rt(this,"onFirstVideoDecodedTimeout",void 0),rt(this,"onFirstAudioDecoded",void 0),rt(this,"onSelectedLocalCandidateChanged",void 0),rt(this,"onSelectedRemoteCandidateChanged",void 0),rt(this,"videoIsReady",!1),rt(this,"videoIsReady2",{}),rt(this,"pc",void 0),rt(this,"options",void 0),rt(this,"intervalTimer",void 0),rt(this,"stats",Po(jg)),rt(this,"isFirstVideoReceived",{}),rt(this,"isFirstVideoDecoded",{}),rt(this,"isFirstAudioReceived",{}),rt(this,"isFirstAudioDecoded",{}),rt(this,"isFirstVideoDecodedTimeout",{}),rt(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new we(e=>{e({local:be({},Do),remote:be({},Do)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let i=0,a=0,c=0,d=0;for(const h of n)e[h].forEach((m,g)=>{if(!this.lossRateWindowStats[t-1][h][g]||!this.lossRateWindowStats[0][h][g])return;const _=this.lossRateWindowStats[t-1][h][g].packets-this.lossRateWindowStats[0][h][g].packets,v=this.lossRateWindowStats[t-1][h][g].packetsLost-this.lossRateWindowStats[0][h][g].packetsLost;h==="videoSend"||h==="audioSend"?(i+=_,c+=v):(a+=_,d+=v),Number.isNaN(_)||Number.isNaN(_)?m.packetLostRate=0:m.packetLostRate=_<=0||v<=0?0:v/(_+v)});e.sendPacketLossRate=i<=0||c<=0?0:c/(i+c),e.recvPacketLossRate=a<=0||d<=0?0:d/(a+d)}},Wse=class extends VI{constructor(){super(...arguments),rt(this,"_stats",jg),rt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=Po(jg);const n=t.filter(a=>a.type==="ssrc");this.processSSRCStats(n);const i=t.find(a=>a.type==="VideoBwe");i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var n;const i=ve(n=t.id).call(n,"send");switch("".concat(t.mediaType,"_").concat(i?"send":"recv")){case"video_send":{const a=Po(bV);a.codec=t.googCodecName,a.adaptionChangeReason="none",t.googCpuLimitedResolution&&(a.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(a.adaptionChangeReason="bandwidth"),a.avgEncodeMs=Number(t.googAvgEncodeMs),a.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},a.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},a.firsCount=Number(t.googFirReceived),a.nacksCount=Number(t.googNacksReceived),a.plisCount=Number(t.googPlisReceived),a.frameCount=Number(t.framesEncoded),a.bytes=Number(t.bytesSent),a.packets=Number(t.packetsSent),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(a),this._stats.rtt=a.rttMs;break}case"video_recv":{const a=Po(TV),c=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(a.codec=t.googCodecName,a.targetDelayMs=Number(t.googTargetDelayMs),a.renderDelayMs=Number(t.googRenderDelayMs),a.currentDelayMs=Number(t.googCurrentDelayMs),a.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),a.decodeMs=Number(t.googDecodeMs),a.maxDecodeMs=Number(t.googMaxDecodeMs),a.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},a.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},a.decodeFrameRate=Number(t.googFrameRateDecoded),a.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},a.jitterBufferMs=Number(t.googJitterBufferMs),a.firsCount=Number(t.googFirsSent),a.nacksCount=Number(t.googNacksSent),a.plisCount=Number(t.googPlisSent),a.framesDecodeCount=Number(t.framesDecoded),a.bytes=Number(t.bytesReceived),a.packets=Number(t.packetsReceived),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.packets>0&&!this.isFirstVideoReceived[a.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(a.ssrc),this.isFirstVideoReceived[a.ssrc]=!0),a.framesDecodeCount>0&&!this.isFirstVideoDecoded[a.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(a.ssrc,a.decodedFrame.width,a.decodedFrame.height),this.isFirstVideoDecoded[a.ssrc]=!0),c){const d=c.stats,h=Date.now()-c.lts;a.framesDecodeFreezeTime=d.framesDecodeFreezeTime,a.framesDecodeInterval=d.framesDecodeInterval,a.framesDecodeCount>d.framesDecodeCount&&this.isFirstVideoDecoded[a.ssrc]?(c.lts=Date.now(),a.framesDecodeInterval=h,a.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?a.framesDecodeFreezeTime+=a.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):a.framesDecodeCount<c.stats.framesDecodeCount&&(a.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(a.ssrc,{stats:be({},a),lts:Date.now()}),this._stats.videoRecv.push(a);break}case"audio_recv":{const a=Po(wV);a.codec=t.googCodecName,a.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,a.decodingCNG=Number(t.googDecodingCNG),a.decodingCTN=Number(t.googDecodingCTN),a.decodingCTSG=Number(t.googDecodingCTSG),a.decodingNormal=Number(t.googDecodingNormal),a.decodingPLC=Number(t.googDecodingPLC),a.decodingPLCCNG=Number(t.googDecodingPLCCNG),a.expandRate=Number(t.googExpandRate),a.accelerateRate=Number(t.googAccelerateRate),a.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),a.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),a.speechExpandRate=Number(t.googSpeechExpandRate),a.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),a.jitterBufferMs=Number(t.googJitterBufferMs),a.jitterMs=Number(t.googJitterReceived),a.bytes=Number(t.bytesReceived),a.packets=Number(t.packetsReceived),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),a.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),a.receivedFrames>0&&!this.isFirstAudioReceived[a.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(a.ssrc),this.isFirstAudioReceived[a.ssrc]=!0),a.decodingNormal>0&&!this.isFirstAudioDecoded[a.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(a.ssrc),this.isFirstAudioDecoded[a.ssrc]=!0),this._stats.audioRecv.push(a);break}case"audio_send":{const a=Po(RV);a.codec=t.googCodecName,a.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,a.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),a.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),a.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),a.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),a.bytes=Number(t.bytesSent),a.packets=Number(t.packetsSent),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.rttMs=Number(t.googRtt||0),this._stats.rtt=a.rttMs,this._stats.audioSend.push(a);break}}})}_getStats(){return new we((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(n=>{const i={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(a=>{i[a]=n.stat(a)}),t.push(i)}),t}},Gp=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),ES=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),FI=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),Ls=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var Wp=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(Wp||{});function Vg(e,t,n,i){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Wp.kNone;if(!t)return;const c=Number(t[n]);if(typeof c!="number")return;const d=Number(t[i]);if(typeof d!="number")return;if(!e)return d?c/d*a:void 0;const h=Number(e[n]);if(typeof h!="number")return;const m=Number(e[i]);if(typeof m!="number")return;const g=d-m;return g?(c-h)/g*a:void 0}let CV=class extends VI{constructor(){super(...arguments),rt(this,"_stats",jg),rt(this,"report",void 0),rt(this,"lastDecodeVideoReceiverStats",new Map),rt(this,"lastVideoFramesRecv",new Map),rt(this,"lastVideoFramesSent",new Map),rt(this,"lastVideoFramesDecode",new Map),rt(this,"lastVideoFramesOutput",new Map),rt(this,"lastVideoJBDelay",new Map),rt(this,"lastAudioJBDelay",new Map),rt(this,"mediaBytesSent",new Map),rt(this,"mediaBytesRetransmit",new Map),rt(this,"mediaBytesTargetEncode",new Map),rt(this,"lastDecodeAudioReceiverStats",new Map),rt(this,"lastAudioConcealment",new Map),rt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Po(jg),this.report.forEach(e=>{switch(e.type){case Ls.OUTBOUND:case Ls.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,i=!t&&!("frameWidth"in e);e.type===Ls.OUTBOUND?t==="audio"||i?this.processAudioOutboundStats(e):(t==="video"||n)&&this.processVideoOutboundStats(e):e.type===Ls.INBOUND&&(t==="audio"||i?this.processAudioInboundStats(e):(t==="video"||n)&&this.processVideoInboundStats(e));break}case Ls.TRANSPORT:{this.processTransportStats(e);const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case Ls.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:be({},Do),remote:be({},Do)};return e.forEach(n=>{let i;if(n.type===Ls.TRANSPORT&&(i=e.get(n.selectedCandidatePairId)),n.type===Ls.CANDIDATE_PAIR&&n.selected&&(i=n),i){const a=(c,d)=>{c.type=d.type,c.id=d.id,d.address&&(c.address=d.address),d.candidateType&&(c.candidateType=d.candidateType),d.port&&(c.port=d.port),d.priority&&(c.priority=d.priority),d.protocol&&(c.protocol=d.protocol),d.relayProtocol&&(c.relayProtocol=d.relayProtocol)};if(i.localCandidateId){const c=e.get(i.localCandidateId);c&&a(t.local,c)}if(i.remoteCandidateId){const c=e.get(i.remoteCandidateId);c&&a(t.remote,c)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===Ls.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===Ls.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===Ls.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(be({},t),be({},this.stats.selectedCandidatePair.localCandidate)),e.type===Ls.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(be({},t),be({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(i=>i.ssrc===e.ssrc);t||(t=Po(wV),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount,t.estimatedPlayoutTimestamp=e.estimatedPlayoutTimestamp;const n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=Vg(n,t,"totalProcessingDelay","jitterBufferEmittedCount",Wp.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,n,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,be({},t))}calculateAudioFreeze(e,t,n){const i=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&i!=null){const a=i.lts,c=n.timestamp,d=c-a;if(d<=0)return;const h=e.concealedSamples-t.concealedSamples-0,m=i.nonSilent+h,g=e.totalSamplesReceived-t.totalSamplesReceived;if(g<=0)return;const _=80*g/d,v=200*g/d,y=d/g;let b=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,m>_&&(i.plc80>0?(e.freezeSamples80+=h,e.freezeMs80+=Math.round(h*y)):(e.freezeSamples80+=m,e.freezeMs80+=Math.round(m*y)),b=i.plc80+1);let O=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,m>v&&(i.plc200>0?(e.freezeSamples200+=h,e.freezeMs200+=Math.round(h*y)):(e.freezeSamples200+=m,e.freezeMs200+=Math.round(m*y)),O=i.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:h,lts:c,plc80:b,plc200:O})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:n.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(d=>d.ssrc===e.ssrc);t||(t=Po(TV),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.estimatedPlayoutTimestamp=e.estimatedPlayoutTimestamp;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),i=this.lastVideoFramesDecode.get(t.ssrc),a=this.lastVideoFramesOutput.get(t.ssrc),c=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const d=t.decodedFrame?t.decodedFrame.width:0,h=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,d,h),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const d=n.stats,h=c-n.lts;t.framesDecodeFreezeTime=d.framesDecodeFreezeTime,t.framesDecodeInterval=d.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&h>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>d.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=h,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<d.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=Vg(n==null?void 0:n.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=Vg(n==null?void 0:n.stats,t,"totalProcessingDelay","framesDecodeCount",Wp.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=Vg(n==null?void 0:n.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",Wp.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=Vg(n==null?void 0:n.stats,t,"totalInterFrameDelay","framesDecodeCount",Wp.kMillisecondsFromSeconds),i&&c-i.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-i.count)/((c-i.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:c,rate:t.decodeFrameRate})):i?t.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:c,rate:0}),t.framesDroppedCount&&e.framesReceived&&(a&&c-a.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-a.count)/((c-a.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:c,rate:Math.max(t.outputFrameRate,0)})):a?t.outputFrameRate=a.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:c,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:be({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(i=>i.ssrc===e.ssrc);t||(t=Po(bV),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const i=new jI(10);i.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,i)}if(e.retransmittedBytesSent!==void 0){const i=this.mediaBytesRetransmit.get(e.ssrc);if(i)i.add(e.retransmittedBytesSent);else{const a=new jI(10);a.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,a)}}if(e.totalEncodedBytesTarget){const i=this.mediaBytesTargetEncode.get(e.ssrc);if(i)i.add(e.totalEncodedBytesTarget);else{const a=new jI(10);a.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,a)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const i=this.lastEncoderMs.get(e.ssrc);if(!i||i.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const a=e.framesEncoded-i.lastFrameCount,c=e.totalEncodeTime-i.lastEncoderTime;t.avgEncodeMs=1e3*c/a}}if(e.framesEncoded&&e.qpSum){const i=this.lastEncoderMs.get(e.ssrc);!i||i.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-i.lastQpSum)/(e.framesEncoded-i.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const i=this.findRemoteStatsId(e.ssrc,Ls.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(n=>n.ssrc===e.ssrc);if(t||(t=Po(RV),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,Ls.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}processTransportStats(e){this._stats.transport.bytesReceived=e.bytesReceived||this._stats.transport.bytesReceived,this._stats.transport.bytesSent=e.bytesSent||this._stats.transport.bytesSent,this._stats.transport.packetsReceived=e.packetsReceived||this._stats.transport.packetsReceived,this._stats.transport.packetsSent=e.packetsSent||this._stats.transport.packetsSent}findRemoteStatsId(e,t){var n;const i=Array.from(Es(n=this.report).call(n)).find(a=>a.type===t&&a.ssrc===e);return i?i.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var i,a,c,d;const h=t?this.report.get(t):void 0,m=(i=h==null?void 0:h.framesSent)!==null&&i!==void 0?i:e.framesSent;if(typeof m!="number")return;let g=(a=h==null?void 0:h.frameWidth)!==null&&a!==void 0?a:e.frameWidth,_=(c=h==null?void 0:h.frameHeight)!==null&&c!==void 0?c:e.frameHeight,v=(d=h==null?void 0:h.framesPerSecond)!==null&&d!==void 0?d:e.framesPerSecond;if(typeof g=="number"&&typeof _=="number"||(g=0,_=0),v==null){const y=Date.now(),b=this.lastVideoFramesSent.get(n.ssrc);b&&y-b.lts>=800?(v=Math.round((m-b.count)/((y-b.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:m,lts:y,rate:v})):b?v=b.rate:this.lastVideoFramesSent.set(n.ssrc,{count:m,lts:y,rate:0})}n.sentFrame={width:g,height:_,frameRate:Math.max(0,v)}}processVideoTrackReceiverStats(e,t,n){var i,a,c,d,h;const m=t?this.report.get(t):void 0,g=(i=m==null?void 0:m.framesReceived)!==null&&i!==void 0?i:e.framesReceived,_=(a=m==null?void 0:m.frameWidth)!==null&&a!==void 0?a:e.frameWidth,v=(c=m==null?void 0:m.frameHeight)!==null&&c!==void 0?c:e.frameHeight,y=(d=m==null?void 0:m.jitterBufferDelay)!==null&&d!==void 0?d:e.jitterBufferDelay,b=(h=m==null?void 0:m.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount;if(typeof g=="number"){const O=this.lastVideoFramesRecv.get(n.ssrc),I=Date.now();n.framesReceivedCount=g;let N=0;O&&I-O.lts>=800?(N=Math.round((g-O.count)/((I-O.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:g,lts:I,rate:N})):O?N=O.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:g,lts:I,rate:0}),n.receivedFrame={width:_||0,height:v||0,frameRate:N||0},n.decodedFrame={width:_||0,height:v||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:_||0,height:v||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(y&&b){const O=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let I=O.jitterBufferMs;const N=b-O.jitterBufferEmittedCount;N>0&&(I=1e3*(y-O.jitterBufferDelay)/N),n.jitterBufferMs=I,n.currentDelayMs=Math.round(I),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:y,jitterBufferEmittedCount:b,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var i,a,c,d;const h=t?this.report.get(t):void 0,m=(i=(a=h==null?void 0:h.echoReturnLoss)!==null&&a!==void 0?a:e.echoReturnLoss)!==null&&i!==void 0?i:0,g=(c=(d=h==null?void 0:h.echoReturnLossEnhancement)!==null&&d!==void 0?d:e.echoReturnLossEnhancement)!==null&&c!==void 0?c:0;n.aecReturnLoss=m,n.aecReturnLossEnhancement=g}processAudioTrackReceiverStats(e,t,n){var i,a,c,d,h,m,g,_,v;const y=t?this.report.get(t):void 0,b=(i=y==null?void 0:y.removedSamplesForAcceleration)!==null&&i!==void 0?i:e.removedSamplesForAcceleration,O=(a=y==null?void 0:y.totalSamplesReceived)!==null&&a!==void 0?a:e.totalSamplesReceived,I=(c=y==null?void 0:y.jitterBufferDelay)!==null&&c!==void 0?c:e.jitterBufferDelay,N=(d=y==null?void 0:y.jitterBufferEmittedCount)!==null&&d!==void 0?d:e.jitterBufferEmittedCount,k=(h=y==null?void 0:y.audioLevel)!==null&&h!==void 0?h:e==null?void 0:e.audioLevel,j=(m=y==null?void 0:y.totalSamplesDuration)!==null&&m!==void 0?m:e==null?void 0:e.totalSamplesDuration,G=(g=y==null?void 0:y.concealedSamples)!==null&&g!==void 0?g:e.concealedSamples,K=(_=y==null?void 0:y.silentConcealedSamples)!==null&&_!==void 0?_:e.silentConcealedSamples,X=(v=y==null?void 0:y.concealmentEvents)!==null&&v!==void 0?v:e.concealmentEvents;if(typeof O=="number"&&(n.totalSamplesReceived=O),typeof K=="number"&&(n.silentConcealedSamples=K),typeof X=="number"&&(n.concealmentEvents=X),typeof G=="number"&&(n.concealedSamples=G),b&&O&&(n.accelerateRate=b/O),I&&N){const ne=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let me=ne.jitterBufferMs;const Ee=N-ne.jitterBufferEmittedCount;Ee>0&&(me=1e3*(I-ne.jitterBufferDelay)/Ee),n.jitterBufferMs=Math.round(me),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:I,jitterBufferEmittedCount:N,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=k;let z=1920;j&&O&&(z=O/j/50,n.receivedFrames=Math.round(O/z)),G&&(n.droppedFrames=Math.round(G/z))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach(a=>{e+=a.diffMean()}),this.mediaBytesRetransmit.forEach(a=>{t=t===null?a.diffMean():t+a.diffMean()}),this.mediaBytesTargetEncode.forEach(a=>{n=n===null?a.diffMean():n+a.diffMean()});const i=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},zse=class extends VI{updateStats(){return we.resolve()}};function vS(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const c=function(){const d=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return d&&d[0]?Number(d[0].split("/")[1]):null}();return c?c<76?new Wse(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:a}):new CV(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:a}):function(d){if(!window.RTCStatsReport)return!1;const h=d.getStats();return!!(h instanceof we||function(m){return!!m&&(typeof m=="object"||typeof m=="function")&&typeof m.then=="function"}(h))}(e)?new CV(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:a}):new zse(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:a})}const IV="websdk_ng_install_id";function BI(){try{if(D("INSTALL_ID"))return D("INSTALL_ID");let e=window.localStorage.getItem(IV);return e||(e=Uu(),window.localStorage.setItem(IV,e)),Zt("INSTALL_ID",e),e}catch{return}}const ro=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const n=t[1],i=t[2];return"".concat(n,".").concat(i)}return"4.0.0.999"}("4.24.2"),GI=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let ju=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const zr=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const i=n.join(""),a=[];for(let h=0;h<6;h++)a.push("1");const c=a.join(""),d={};return d[e]=i,d[t]=c,Object.assign(d,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=zr;const yS={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},WI={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},zI="v4.24.2-0-g002485b1-dirty(12/12/2025, 5:26:54 PM)",HI={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",TURN_DOMAINS:["edge.agora.io"],USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,FLS_FALLBACK_TIMEOUT:3e4,RTE_DETAIL_REPORT_INTERVAL:6e4,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0,UPDATE_RTP_CAP_IN_HOST:!1,IOS_BG_TAG:!0,IOS_AUTO_RESTART_BG_TAG:!0,IGNORE_UID_CHECK:!1,ENABLE_UP_SPS_PPS:!1,ENABLE_DOWN_SPS_PPS:!1,NO_EDGES_RETRY:!0,BUFFER_READY_FRAMES:3,FLS_SYNC_AV_PLAY_LIMIT:0,FLS_BUFFER_WAIT_TIME:1500,VOS_CONFIGURE:void 0,ENABLE_QUALITY_FALLBACK:!1,QUALITY_FALLBACK_REHEARSAL:!0,ENABLE_FLS_AV1_FIRST:!1,ENABLE_AP_MULTI_IP:!0,FLS_ENABLE_AV1_DETECT:!0,FLS_ENABLE_AV1_DECODE_DETECT:!0},zt=be(be(be(be({},HI),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_MANAGER_WSS:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_WSS:"",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,DC_JOIN_WITH_FAILBACK:4e3,DC_CONNECTION_TIMEOUT:2e3,DC_PINGPONG_INTERVAL:2e3,DC_DEBUG_LOG:!1,UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:WI,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},yS),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,REMOTE_VIDEO_STREAM_TYPE:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_FORCE_HLS:!1,MAX_WEBAUDIO_VOLUME:300,ENABLE_VOS_FALLBACK:!1,ENABLE_FALLBACK_TO_HLS:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!0,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1,IGNORE_RTC_DEVICE_CHECK:!1,FLS_AUTOPLAY_EMITS:!1,ENABLE_DUAL_STREAM_FLAG:!1,FORBID_MODIFY_LOCAL_OFFER_SDP:!1,RESERVE_MID_1_MLINE:!1});function Zt(e,t,n){var i,a,c;ve(i=Object.keys(zt)).call(i,e)&&(!n&&ve(a=Object.keys(Ms)).call(a,e)||(zt[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(zt.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(c=!!t,zt.USE_NEW_NETWORK_CONFIG=c,c&&(zt.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],zt.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],zt.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],zt.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],zt.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",zt.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",zt.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(zt.ENABLE_INSTANT_VIDEO=!0,zt.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(zt.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(zt.NEW_TURN_MODE||(zt.NEW_TURN_MODE=4))))}function D(e){if(e==="TURN_DOMAINS"){const t=zt.TURN_DOMAINS;return ve(t).call(t,D("TURN_DOMAIN"))?t:[D("TURN_DOMAIN")].concat(t)}return zt[e]}GI||(zt.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],zt.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],zt.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],zt.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],zt.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],zt.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],zt.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",zt.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",zt.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",zt.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",zt.AREAS=["NORTH_AMERICA","OVERSEA"]);let AV=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const Ms={};var $e=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_RTE_URL="SET_RTE_URL",e.SET_RTE_SID="SET_RTE_SID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}($e||{});let Vu=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const NV=128,Hse=96,xV=1e3,zp=10;let Kse=0;var OV=(()=>{var e={8:(i,a,c)=>{c.r(a),c.d(a,{Parser:()=>Ee,Printer:()=>at,parse:()=>Re,print:()=>ke});const d=`
`,h="".concat("\r").concat(d),m=" ";let g;function _(_e){return _e>="0"&&_e<="9"}function v(_e){return _e>="!"&&_e<="~"}function y(_e){return v(_e)||_e>=""&&_e<=""}function b(_e){return _e==="!"||_e>="#"&&_e<="'"||_e>="*"&&_e<="+"||_e>="-"&&_e<="."||_e>="0"&&_e<="9"||_e>="A"&&_e<="Z"||_e>="^"&&_e<="~"}function O(_e){return _e>="1"&&_e<="9"}function I(_e){return _e>="A"&&_e<="Z"||_e>="a"&&_e<="z"}function N(_e){return _e==="d"||_e==="h"||_e==="m"||_e==="s"}function k(_e){return _e>""&&_e<"	"||_e>"\v"&&_e<"\f"||_e>""&&_e<""}function j(_e){return I(_e)||_(_e)||_e==="+"||_e==="/"}function G(_e){return _(_e)||I(_e)||_e==="+"||_e==="/"||_e==="-"||_e==="_"}function K(_e){return I(_e)||_(_e)||_e==="+"||_e==="/"}function X(_e,C){var B=Object.keys(_e);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(_e);C&&(H=H.filter(function(Se){return Object.getOwnPropertyDescriptor(_e,Se).enumerable})),B.push.apply(B,H)}return B}function z(_e){for(var C=1;C<arguments.length;C++){var B=arguments[C]!=null?arguments[C]:{};C%2?X(Object(B),!0).forEach(function(H){ne(_e,H,B[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(B)):X(Object(B)).forEach(function(H){Object.defineProperty(_e,H,Object.getOwnPropertyDescriptor(B,H))})}return _e}function ne(_e,C,B){return C in _e?Object.defineProperty(_e,C,{value:B,enumerable:!0,configurable:!0,writable:!0}):_e[C]=B,_e}(function(_e){_e.VERSION="v",_e.ORIGIN="o",_e.SESSION_NAME="s",_e.INFORMATION="i",_e.URI="u",_e.EMAIL="e",_e.PHONE="p",_e.CONNECTION="c",_e.BANDWIDTH="b",_e.TIME="t",_e.REPEAT="r",_e.ZONE_ADJUSTMENTS="z",_e.KEY="k",_e.ATTRIBUTE="a",_e.MEDIA="m"})(g||(g={}));class me{consumeText(C,B){let H=B;for(;H<C.length;){const Se=C[H];if(Se==="\0"||Se==="\r"||Se===d)break;H+=1}if(H-B==0)throw new Error("Invalid text, at ".concat(C));return H}consumeUnicastAddress(C,B,H){return this.consumeTill(C,B,m)}consumeOneOrMore(C,B,H){let Se=B;for(;H(C[Se]);)Se++;if(Se-B==0)throw new Error("Invalid rule at ".concat(B,"."));return Se}consumeSpace(C,B){if(C[B]===m)return B+1;throw new Error("Invalid space at ".concat(B,"."))}consumeIP4Address(C,B){let H=B;for(let Se=0;Se<4;Se++)if(H=this.consumeDecimalUChar(C,H),Se!==3){if(C[H]!==".")throw new Error("Invalid IP4 address.");H++}return H}consumeDecimalUChar(C,B){let H=B;for(let et=0;et<3&&_(C[H]);et++,H++);if(H-B==0)throw new Error("Invalid decimal uchar.");const Se=parseInt(C.slice(B,H));if(Se>=0&&Se<=255)return H;throw new Error("Invalid decimal uchar")}consumeIP6Address(C,B){let H=this.consumeHexpart(C,B);return C[H]===":"&&(H+=1,H=this.consumeIP4Address(C,H)),H}consumeHexpart(C,B){let H=B;if(C[H]===":"&&C[H+1]===":"){H+=2;try{H=this.consumeHexseq(C,H)}catch{}return H}if(H=this.consumeHexseq(C,H),C[H]===":"&&C[H+1]===":"){H+=2;try{H=this.consumeHexseq(C,H)}catch{}return H}return H}consumeHexseq(C,B){let H=B;for(;H=this.consumeHex4(C,H),C[H]===":"&&C[H+1]!==":";)H+=1;return H}consumeHex4(C,B){let H=0;for(;H<4;H++)if(!((Se=C[B+H])>="0"&&Se<="9"||Se>="a"&&Se<="f"||Se>="A"&&Se<="F")){if(H===0)throw new Error("Invalid hex 4");break}var Se;return B+H}consumeFQDN(C,B){let H=B;for(;_(C[H])||I(C[H])||C[H]==="-"||C[H]===".";)H+=1;if(H-B<4)throw new Error("Invalid FQDN");return H}consumeExtnAddr(C,B){return this.consumeOneOrMore(C,B,y)}consumeMulticastAddress(C,B,H){switch(H){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(C,B);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(C,B);default:try{return this.consumeFQDN(C,B)}catch{return this.consumeExtnAddr(C,B)}}}consumeIP6MulticastAddress(C,B){const H=this.consumeHexpart(C,B);return C[H]==="/"?this.consumeInteger(C,H+1):H}consumeIP4MulticastAddress(C,B){let H=B+3;const Se=C.slice(B,H),et=parseInt(Se);if(et<224||et>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let dn=0;dn<3;dn++){if(C[H]!==".")throw new Error("Invalid IP4 multicast address.");H+=1,H=this.consumeDecimalUChar(C,H)}return C[H]==="/"&&(H+=1),H=this.consumeTTL(C,H),C[H]==="/"&&(H=this.consumeInteger(C,H)),H}consumeInteger(C,B){if(!O(C[B]))throw new Error("Invalid integer.");for(B+=1;_(C[B]);)B+=1;return B}consumeTTL(C,B){if(C[B]==="0")return B+1;if(!O(C[B]))throw new Error("Invalid TTL.");B+=1;for(let H=0;H<2&&_(C[B]);H++)B+=1;return B}consumeToken(C,B){return this.consumeOneOrMore(C,B,b)}consumeTime(C,B){let H=B;if(C[H]==="0")return H+1;for(O(C[H])&&(H+=1);_(C[H]);)H++;if(H-B<10)throw new Error("Invalid time");return H}consumeAddress(C,B){return this.consumeTill(C,B,m)}consumeTypedTime(C,B){let H=B;return H=this.consumeOneOrMore(C,H,_),N(C[H])?H+1:H}consumeRepeatInterval(C,B){if(!O(C[B]))throw new Error("Invalid repeat interval");for(B+=1;_(C[B]);)B+=1;return N(C[B])&&(B+=1),B}consumePort(C,B){return this.consumeOneOrMore(C,B,_)}consume(C,B,H){for(let Se=0;Se<H.length;Se++){if(B+Se>=C.length)throw new Error("consume exceeding value length");if(C[B+Se]!==H[Se])throw new Error("consume ".concat(H," failed at ").concat(Se))}return B+H.length}consumeTill(C,B,H){let Se=B;for(;Se<C.length&&(typeof H!="string"||C[Se]!==H)&&(typeof H!="function"||!H(C[Se]));)Se++;return Se}}class Ee extends me{constructor(){super(),ne(this,"records",[]),ne(this,"currentLine",0)}parse(C){const B=this.probeEOL(C);this.records=C.split(B).filter(Ed=>!!bi(Ed).call(Ed)).map(this.parseLine),this.currentLine=0;const H=this.parseVersion(),Se=this.parseOrigin(),et=this.parseSessionName(),dn=this.parseInformation(),_r=this.parseUri(),po=this.parseEmail(),_d=this.parsePhone(),MT=this.parseConnection(),Tm=this.parseBandWidth(),UT=this.parseTimeFields(),lh=this.parseKey(),b_=this.parseSessionAttribute(),dh=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:H,origin:Se,sessionName:et,information:dn,uri:_r,emails:po,phones:_d,connection:MT,bandwidths:Tm,timeFields:UT,key:lh,attributes:b_,mediaDescriptions:dh}}getCurrentRecord(){const C=this.records[this.currentLine];if(!C)throw new Error("Record doesn't exit.");return C}probeEOL(C){for(let B=0;B<C.length;B++)if(C[B]===d)return C[B-1]==="\r"?h:d;throw new Error("Invalid newline character.")}parseLine(C,B){if(C.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const H=C[0];if(C[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:H,value:C.slice(2),line:B,cur:0}}parseSessionAttribute(){const C=new Qe;for(;this.currentLine<this.records.length;){const B=this.getCurrentRecord();if(B.type!==g.ATTRIBUTE)break;const H={attField:this.extractOneOrMore(B,Se=>b(Se)&&Se!==":"),_cur:0};B.value[B.cur]===":"&&(B.cur+=1,H.attValue=this.extractOneOrMore(B,k)),C.parse(H),this.currentLine++}return C.digest()}parseMediaAttributes(C){const B=new qe(C);for(;this.currentLine<this.records.length;){const H=this.getCurrentRecord();if(H.type!==g.ATTRIBUTE)break;const Se={attField:this.extractOneOrMore(H,et=>b(et)&&et!==":"),_cur:0};H.value[H.cur]===":"&&(H.cur+=1,Se.attValue=this.extractOneOrMore(H,k)),B.parse(Se),this.currentLine++}return B.digest()}parseKey(){const C=this.getCurrentRecord();if(C.type===g.KEY){if(C.value==="prompt"||C.value==="clear:"||C.value==="base64:"||C.value==="uri:")return C.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const C=this.getCurrentRecord();if(C.type===g.ZONE_ADJUSTMENTS){const B=[];for(;;)try{const H=this.extract(C,this.consumeTime);this.consumeSpaceForRecord(C);let Se=!1;C.value[C.cur]==="-"&&(Se=!0,C.cur+=1);const et=this.extract(C,this.consumeTypedTime);B.push({time:H,typedTime:et,back:Se})}catch{break}if(B.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,B}return[]}parseRepeat(){const C=[];for(;;){const B=this.getCurrentRecord();if(B.type!==g.REPEAT)break;{const H=this.extract(B,this.consumeRepeatInterval),Se=this.parseTypedTime(B);C.push({repeatInterval:H,typedTimes:Se}),this.currentLine++}}return C}parseTypedTime(C){const B=[];for(;;)try{this.consumeSpaceForRecord(C),B.push(this.extract(C,this.consumeTypedTime))}catch{break}if(B.length===0)throw new Error("Invalid typed time.");return B}parseTime(){const C=this.getCurrentRecord(),B=this.extract(C,this.consumeTime);this.consumeSpaceForRecord(C);const H=this.extract(C,this.consumeTime);return this.currentLine++,{startTime:B,stopTime:H}}parseBandWidth(){const C=[];for(;this.currentLine<this.records.length;){const B=this.getCurrentRecord();if(B.type!==g.BANDWIDTH)break;{const H=this.extractOneOrMore(B,b);if(B.value[B.cur]!==":")throw new Error("Invalid bandwidth field.");B.cur++;const Se=this.extractOneOrMore(B,_);C.push({bwtype:H,bandwidth:Se}),this.currentLine++}}return C}parseVersion(){const C=this.getCurrentRecord();if(C.type!==g.VERSION)throw new Error("first sdp record must be version");const B=C.value.slice(0,this.consumeOneOrMore(C.value,0,_));if(B.length!==C.value.length)throw new Error('invalid proto version, "v='.concat(C.value,'"'));return this.currentLine++,B}parseOrigin(){const C=this.getCurrentRecord();if(C.type!==g.ORIGIN)throw new Error("second line of sdp must be origin");const B=this.extractOneOrMore(C,y);this.consumeSpaceForRecord(C);const H=this.extractOneOrMore(C,_);this.consumeSpaceForRecord(C);const Se=this.extractOneOrMore(C,_);this.consumeSpaceForRecord(C);const et=this.extractOneOrMore(C,b);this.consumeSpaceForRecord(C);const dn=this.extractOneOrMore(C,b);this.consumeSpaceForRecord(C);const _r=this.extract(C,this.consumeUnicastAddress);return this.currentLine++,{username:B,sessId:H,sessVersion:Se,nettype:et,addrtype:dn,unicastAddress:_r}}parseSessionName(){const C=this.getCurrentRecord();if(C.type===g.SESSION_NAME){const B=this.extract(C,this.consumeText);return this.currentLine++,B}}parseInformation(){const C=this.getCurrentRecord();if(C.type!==g.INFORMATION)return;const B=this.extract(C,this.consumeText);return this.currentLine++,B}parseUri(){const C=this.getCurrentRecord();if(C.type===g.URI)return this.currentLine++,C.value}parseEmail(){const C=[];for(;;){const B=this.getCurrentRecord();if(B.type!==g.EMAIL)break;C.push(B.value),this.currentLine++}return C}parsePhone(){const C=[];for(;;){const B=this.getCurrentRecord();if(B.type!==g.PHONE)break;C.push(B.value),this.currentLine++}return C}parseConnection(){const C=this.getCurrentRecord();if(C.type===g.CONNECTION){const B=this.extractOneOrMore(C,b);this.consumeSpaceForRecord(C);const H=this.extractOneOrMore(C,b);this.consumeSpaceForRecord(C);const Se=this.extract(C,this.consumeAddress);return this.currentLine++,{nettype:B,addrtype:H,address:Se}}}parseMedia(){const C=this.getCurrentRecord(),B=this.extract(C,this.consumeToken);this.consumeSpaceForRecord(C);let H=this.extract(C,this.consumePort);C.value[C.cur]==="/"&&(C.cur+=1,H+=this.extract(C,this.consumeInteger)),this.consumeSpaceForRecord(C);const Se=[];for(Se.push(this.extract(C,this.consumeToken));C.value[C.cur]==="/";)C.cur+=1,Se.push(this.extract(C,this.consumeToken));if(Se.length===0)throw new Error("Invalid proto");const et=this.parseFmt(C);return this.currentLine++,{mediaType:B,port:H,protos:Se,fmts:et}}parseTimeFields(){const C=[];for(;this.getCurrentRecord().type===g.TIME;){const B=this.parseTime(),H=this.parseRepeat(),Se=this.parseZone();C.push({time:B,repeats:H,zones:Se})}return C}parseMediaDescription(){const C=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===g.MEDIA;){const B=this.parseMedia(),H=this.parseInformation(),Se=this.parseConnections(),et=this.parseBandWidth(),dn=this.parseKey(),_r=this.parseMediaAttributes(B);C.push({media:B,information:H,connections:Se,bandwidths:et,key:dn,attributes:_r})}return C}parseConnections(){const C=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===g.CONNECTION;)C.push(this.parseConnection());return C}parseFmt(C){const B=[];for(;;)try{this.consumeSpaceForRecord(C),B.push(this.extract(C,this.consumeToken))}catch{break}if(B.length===0)throw new Error("Invalid fmts");return B}extract(C,B){for(var H=arguments.length,Se=new Array(H>2?H-2:0),et=2;et<H;et++)Se[et-2]=arguments[et];const dn=B.call(this,C.value,C.cur,...Se),_r=C.value.slice(C.cur,dn);return C.cur=dn,_r}extractOneOrMore(C,B){const H=this.consumeOneOrMore(C.value,C.cur,B),Se=C.value.slice(C.cur,H);return C.cur=H,Se}consumeSpaceForRecord(C){if(C.value[C.cur]!==m)throw new Error("Invalid space at ".concat(C.cur,"."));C.cur+=1}}class Oe extends me{constructor(){super(...arguments),ne(this,"attributes",void 0),ne(this,"digested",!1)}extractOneOrMore(C,B,H){const Se=this.consumeOneOrMore(C.attValue,C._cur,B),et=C.attValue.slice(C._cur,Se),[dn,_r]=H||[];if(typeof dn=="number"&&et.length<dn)throw new Error("error in length, should be more or equal than ".concat(dn," characters."));if(typeof _r=="number"&&et.length>_r)throw new Error("error in length, should be less or equal than ".concat(_r," characters."));return C._cur=Se,et}consumeAttributeSpace(C){if(C.attValue[C._cur]!==m)throw new Error("Invalid space at ".concat(C._cur,"."));C._cur+=1}extract(C,B){if(!C.attValue)throw new Error("Nothing to extract from attValue.");for(var H=arguments.length,Se=new Array(H>2?H-2:0),et=2;et<H;et++)Se[et-2]=arguments[et];const dn=B.call(this,C.attValue,C._cur,...Se),_r=C.attValue.slice(C._cur,dn);return C._cur=dn,_r}atEnd(C){if(!C.attValue)throw new Error;return C._cur>=C.attValue.length}peekChar(C){if(!C.attValue)throw new Error;return C.attValue[C._cur]}peek(C,B){if(!C.attValue)throw new Error;for(let H=0;H<B.length;H++)if(B[H]!==C.attValue[C._cur+H])return!1;return!0}parseIceUfrag(C){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(C,j,[4,256])}parseIcePwd(C){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(C,j,[22,256])}parseIceOptions(C){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const B=[];for(;!this.atEnd(C);){B.push(this.extractOneOrMore(C,j));try{this.consumeAttributeSpace(C)}catch(H){if(this.atEnd(C))break;throw H}}this.attributes.iceOptions=B}parseFingerprint(C){const B=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C);const H=this.extract(C,this.consumeTill);this.attributes.fingerprints.push({hashFunction:B,fingerprint:H})}parseExtmap(C){const B=this.extractOneOrMore(C,_);let H;this.peekChar(C)==="/"&&(this.extract(C,this.consume,"/"),H=this.extract(C,this.consumeToken)),this.consumeAttributeSpace(C);const Se=this.extract(C,this.consumeTill,m),et=z(z({entry:parseInt(B,10)},H&&{direction:H}),{},{extensionName:Se});this.peekChar(C)===m&&(this.consumeAttributeSpace(C),et.extensionAttributes=this.extract(C,this.consumeTill)),this.attributes.extmaps.push(et)}parseSetup(C){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const B=this.extract(C,this.consumeTill);if(B!=="active"&&B!=="passive"&&B!=="actpass"&&B!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=B}}class Qe extends Oe{constructor(){super(...arguments),ne(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(C){if(this.digested)throw new Error("already digested");try{switch(C.attField){case"group":this.parseGroup(C);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(C);break;case"ice-pwd":this.parseIcePwd(C);break;case"ice-options":this.parseIceOptions(C);break;case"fingerprint":this.parseFingerprint(C);break;case"setup":this.parseSetup(C);break;case"tls-id":this.parseTlsId(C);break;case"identity":this.parseIdentity(C);break;case"extmap":this.parseExtmap(C);break;case"msid-semantic":this.parseMsidSemantic(C);break;default:C.ignored=!0,this.attributes.unrecognized.push(C)}}catch(B){throw console.error("parsing session attribute ".concat(C.attField,' error, "a=').concat(C.attField,":").concat(C.attValue,'"')),B}if(!C.ignored&&C.attValue&&!this.atEnd(C))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(C){const B=this.extract(C,this.consumeToken),H=[];for(;!this.atEnd(C)&&this.peekChar(C)===m;)this.consumeAttributeSpace(C),H.push(this.extract(C,this.consumeToken));this.attributes.groups.push({semantic:B,identificationTag:H})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(C){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(C,G)}parseIdentity(C){const B=this.extractOneOrMore(C,K),H=[];for(;!this.atEnd(C)&&this.peekChar(C)===m;){this.consumeAttributeSpace(C);const Se=this.extract(C,this.consumeToken);this.extract(C,this.consume,"=");const et=this.extractOneOrMore(C,dn=>dn!==m&&k(dn));H.push({name:Se,value:et})}this.attributes.identities.push({assertionValue:B,extensions:H})}parseMsidSemantic(C){this.peekChar(C)===m&&this.consumeAttributeSpace(C);const B={semantic:this.extract(C,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(C)}catch{break}if(this.peekChar(C)==="*"){this.extract(C,this.consume,"*"),B.applyForAll=!0;break}{const H=this.extract(C,this.consumeTill,m);B.identifierList.push(H)}}this.attributes.msidSemantic=B}}class qe extends Oe{constructor(C){super(),ne(this,"attributes",void 0),C.protos.indexOf("RTP")!==-1||C.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(C){if(this.digested)throw new Error("already digested");try{switch(C.attField){case"extmap":this.parseExtmap(C);break;case"setup":this.parseSetup(C);break;case"ice-ufrag":this.parseIceUfrag(C);break;case"ice-pwd":this.parseIcePwd(C);break;case"ice-options":this.parseIceOptions(C);break;case"candidate":this.parseCandidate(C);break;case"remote-candidate":this.parseRemoteCandidate(C);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(C);break;case"rtpmap":this.parseRtpmap(C);break;case"ptime":this.parsePtime(C);break;case"maxptime":this.parseMaxPtime(C);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(C);break;case"ssrc":this.parseSSRC(C);break;case"fmtp":this.parseFmtp(C);break;case"rtcp-fb":this.parseRtcpFb(C);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(C);break;case"mid":this.parseMid(C);break;case"msid":this.parseMsid(C);break;case"imageattr":this.parseImageAttr(C);break;case"rid":this.parseRid(C);break;case"simulcast":this.parseSimulcast(C);break;case"sctp-port":this.parseSctpPort(C);break;case"max-message-size":this.parseMaxMessageSize(C);break;case"ssrc-group":this.parseSSRCGroup(C);break;default:C.ignored=!0,this.attributes.unrecognized.push(C)}}catch(B){throw console.error("parsing media attribute ".concat(C.attField,' error, "a=').concat(C.attField,":").concat(C.attValue,'"')),B}if(!C.ignored&&C.attValue&&!this.atEnd(C))throw new Error("attribute parsing error")}parseCandidate(C){const B=this.extractOneOrMore(C,j,[1,32]);this.consumeAttributeSpace(C);const H=this.extractOneOrMore(C,_,[1,5]);this.consumeAttributeSpace(C);const Se=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C);const et=this.extractOneOrMore(C,_,[1,10]);this.consumeAttributeSpace(C);const dn=this.extract(C,this.consumeAddress);this.consumeAttributeSpace(C);const _r=this.extract(C,this.consumePort);this.consumeAttributeSpace(C),this.extract(C,this.consume,"typ"),this.consumeAttributeSpace(C);const po={foundation:B,componentId:H,transport:Se,priority:et,connectionAddress:dn,port:_r,type:this.extract(C,this.consumeToken),extension:{}};for(this.peek(C," raddr")&&(this.extract(C,this.consume," raddr"),this.consumeAttributeSpace(C),po.relAddr=this.extract(C,this.consumeAddress)),this.peek(C," rport")&&(this.extract(C,this.consume," rport"),this.consumeAttributeSpace(C),po.relPort=this.extract(C,this.consumePort));this.peekChar(C)===m;){this.consumeAttributeSpace(C);const _d=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C),po.extension[_d]=this.extractOneOrMore(C,v)}this.attributes.candidates.push(po)}parseRemoteCandidate(C){const B=[];for(;;){const H=this.extractOneOrMore(C,_,[1,5]);this.consumeAttributeSpace(C);const Se=this.extract(C,this.consumeAddress);this.consumeAttributeSpace(C);const et=this.extract(C,this.consumePort);B.push({componentId:H,connectionAddress:Se,port:et});try{this.consumeAttributeSpace(C)}catch{break}}this.attributes.remoteCandidatesList.push(B)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(C){const B=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C);const H=this.extract(C,this.consumeTill,"/");this.extract(C,this.consume,"/");const Se={encodingName:H,clockRate:this.extractOneOrMore(C,_)};this.atEnd(C)||this.peekChar(C)!=="/"||(this.extract(C,this.consume,"/"),Se.encodingParameters=parseInt(this.extract(C,this.consumeTill),10));const et=this.attributes.payloads.find(dn=>dn.payloadType===parseInt(B,10));et?et.rtpMap=Se:this.attributes.payloads.push({payloadType:parseInt(B,10),rtpMap:Se,rtcpFeedbacks:[]})}parsePtime(C){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(C,this.consumeTill)}parseMaxPtime(C){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(C,this.consumeTill)}parseDirection(C){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=C.attField}parseSSRC(C){const B=this.extractOneOrMore(C,_);this.consumeAttributeSpace(C);const H=this.extract(C,this.consumeTill,":");let Se;this.peekChar(C)===":"&&(this.extract(C,this.consume,":"),Se=this.extract(C,this.consumeTill));const et=this.attributes.ssrcs.find(dn=>dn.ssrcId===parseInt(B,10));et?et.attributes[H]=Se:this.attributes.ssrcs.push({ssrcId:parseInt(B,10),attributes:{[H]:Se}})}parseFmtp(C){const B=this.extract(C,this.consumeTill,m);this.consumeAttributeSpace(C);const H=this.extract(C,this.consumeTill),Se={};H.split(";").forEach(dn=>{let[_r,po]=dn.split("=");_r=bi(_r).call(_r);const _d=typeof po=="string"?bi(po).call(po):null;typeof _r=="string"&&_r.length>0&&(Se[_r]=_d)});const et=this.attributes.payloads.find(dn=>dn.payloadType===parseInt(B,10));et?et.fmtp={parameters:Se}:this.attributes.payloads.push({payloadType:parseInt(B,10),rtcpFeedbacks:[],fmtp:{parameters:Se}})}parseFmtParameters(C){const B={},H=this.extract(C,this.consumeTill,"=");C._cur++;const Se=this.extract(C,this.consumeTill,";");for(B[H]=Se;C.attValue[C._cur]===";";){const et=this.extract(C,this.consumeTill,"=");C._cur++;const dn=this.extract(C,this.consumeTill,";");B[et]=dn}return B}parseRtcpFb(C){let B="";B=this.peekChar(C)==="*"?this.extract(C,this.consume,"*"):this.extract(C,this.consumeTill,m),this.consumeAttributeSpace(C);const H=this.extract(C,this.consumeTill,m);let Se;if(H==="trr-int")Se={type:H,interval:this.extract(C,this.consumeTill)};else{const et={type:H};this.peekChar(C)===m&&(this.consumeAttributeSpace(C),et.parameter=this.extract(C,this.consumeToken),this.peekChar(C)===m&&(et.additional=this.extract(C,this.consumeTill))),Se=et}if(B==="*")this.attributes.rtcpFeedbackWildcards.push(Se);else{const et=this.attributes.payloads.find(dn=>dn.payloadType===parseInt(B,10));et?et.rtcpFeedbacks.push(Se):this.attributes.payloads.push({payloadType:parseInt(B,10),rtcpFeedbacks:[Se]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(C){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const B={port:this.extract(C,this.consumePort)};this.peekChar(C)===m&&(this.consumeAttributeSpace(C),B.netType=this.extractOneOrMore(C,b),this.consumeAttributeSpace(C),B.addressType=this.extractOneOrMore(C,b),this.consumeAttributeSpace(C),B.address=this.extract(C,this.consumeAddress)),this.attributes.rtcp=B}parseMsid(C){const B={id:this.extractOneOrMore(C,b,[1,64])};this.peekChar(C)===m&&(this.consumeAttributeSpace(C),B.appdata=this.extractOneOrMore(C,b,[1,64])),this.attributes.msids.push(B)}parseImageAttr(C){this.attributes.imageattr.push(C.attValue)}parseRid(C){const B=this.extractOneOrMore(C,Se=>I(Se)||_(Se)||Se==="_"||Se==="-");this.consumeAttributeSpace(C);const H={id:B,direction:this.extract(C,this.consumeToken),params:[]};if(this.peekChar(C)===m){if(this.consumeAttributeSpace(C),this.peek(C,"pt=")){this.extract(C,this.consume,"pt=");const Se=[];for(;;){const et=this.extract(C,this.consumeToken);Se.push(et);try{this.extract(C,this.consume,",")}catch{break}}H.payloads=Se,this.peekChar(C)===m&&this.extract(C,this.consume,m)}for(;;){const Se=this.extract(C,this.consumeToken);switch(Se){case"depend":{const et={type:Se,rids:this.extract(C,this.consume,"=").split(",")};H.params.push(et);break}default:{const et={type:Se};this.peekChar(C)==="="&&(this.extract(C,this.consume,"="),et.val=this.extract(C,this.consumeTill,";")),H.params.push(et)}}try{this.extract(C,this.consume,";")}catch{break}}}this.attributes.rids.push(H)}parseSimulcast(C){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=C.attValue,this.extract(C,this.consumeTill)}parseSctpPort(C){this.attributes.sctpPort=this.extractOneOrMore(C,_,[1,5])}parseMaxMessageSize(C){this.attributes.maxMessageSize=this.extractOneOrMore(C,_,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(C){this.attributes.mid=this.extract(C,this.consumeToken)}parseSSRCGroup(C){const B=this.extract(C,this.consumeToken),H=[];for(;;)try{this.consumeAttributeSpace(C);const Se=this.extract(C,this.consumeInteger);H.push(parseInt(Se,10))}catch{break}this.attributes.ssrcGroups.push({semantic:B,ssrcIds:H})}}function dt(_e,C,B){return C in _e?Object.defineProperty(_e,C,{value:B,enumerable:!0,configurable:!0,writable:!0}):_e[C]=B,_e}class at{constructor(){dt(this,"eol",h)}print(C,B){let H="";return B&&(this.eol=B),H+=this.printVersion(C.version),H+=this.printOrigin(C.origin),H+=this.printSessionName(C.sessionName),H+=this.printInformation(C.information),H+=this.printUri(C.uri),H+=this.printEmail(C.emails),H+=this.printPhone(C.phones),H+=this.printConnection(C.connection),H+=this.printBandwidth(C.bandwidths),H+=this.printTimeFields(C.timeFields),H+=this.printKey(C.key),H+=this.printSessionAttributes(C.attributes),H+=this.printMediaDescription(C.mediaDescriptions),H}printVersion(C){return"v=".concat(C).concat(this.eol)}printOrigin(C){return"o=".concat(C.username," ").concat(C.sessId," ").concat(C.sessVersion," ").concat(C.nettype," ").concat(C.addrtype," ").concat(C.unicastAddress).concat(this.eol)}printSessionName(C){return C?"s=".concat(C).concat(this.eol):""}printInformation(C){return C?"i=".concat(C).concat(this.eol):""}printUri(C){return C?"u=".concat(C).concat(this.eol):""}printEmail(C){let B="";for(const H of C)B+="e=".concat(H).concat(this.eol);return B}printPhone(C){let B="";for(const H of C)B+="e=".concat(H).concat(this.eol);return B}printConnection(C){return C?"c=".concat(C.nettype," ").concat(C.addrtype," ").concat(C.address).concat(this.eol):""}printBandwidth(C){let B="";for(const H of C)B+="b=".concat(H.bwtype,":").concat(H.bandwidth).concat(this.eol);return B}printTimeFields(C){let B="";for(const H of C){B+="t=".concat(H.time.startTime," ").concat(H.time.startTime).concat(this.eol);for(const Se of H.repeats)B+="r=".concat(Se.repeatInterval," ").concat(Se.typedTimes.join(" ")).concat(this.eol);H.zoneAdjustments&&(B+="z=",B+="z=".concat(H.zoneAdjustments.map(Se=>"".concat(Se.time," ").concat(Se.back?"-":""," ").concat(Se.typedTime)).join(" ")).concat(this.eol),B+=this.eol)}return B}printKey(C){return C?"k=".concat(C).concat(this.eol):""}printAttributes(C){let B="";for(const H of C)B+="a=".concat(H.attField).concat(H.attValue?":".concat(H.attValue):"").concat(this.eol);return B}printMediaDescription(C){let B="";for(const H of C)B+=this.printMedia(H.media),B+=this.printInformation(H.information),B+=this.printConnections(H.connections),B+=this.printBandwidth(H.bandwidths),B+=this.printKey(H.key),B+=this.printMediaAttributes(H);return B}printConnections(C){let B="";for(const H of C)B+=this.printConnection(H);return B}printMedia(C){return"m=".concat(C.mediaType," ").concat(C.port," ").concat(C.protos.join("/")," ").concat(C.fmts.join(" ")).concat(this.eol)}printSessionAttributes(C){return new vn(this.eol).print(C)}printMediaAttributes(C){return new ge(this.eol).print(C)}}class Ut{constructor(C){dt(this,"eol",void 0),this.eol=C}printIceUfrag(C){return C===void 0?"":"a=ice-ufrag:".concat(C).concat(this.eol)}printIcePwd(C){return C===void 0?"":"a=ice-pwd:".concat(C).concat(this.eol)}printIceOptions(C){return C===void 0?"":"a=ice-options:".concat(C.join(m)).concat(this.eol)}printFingerprints(C){return C.length>0?C.map(B=>"a=fingerprint:".concat(B.hashFunction).concat(m).concat(B.fingerprint)).join(this.eol)+this.eol:""}printExtmap(C){return C.map(B=>"a=extmap:".concat(B.entry).concat(B.direction?"/".concat(B.direction):"").concat(m).concat(B.extensionName).concat(B.extensionAttributes?"".concat(m).concat(B.extensionAttributes):"").concat(this.eol)).join("")}printSetup(C){return C===void 0?"":"a=setup:".concat(C).concat(this.eol)}printUnrecognized(C){return C.map(B=>"a=".concat(B.attField).concat(B.attValue?":".concat(B.attValue):"").concat(this.eol)).join("")}}class vn extends Ut{print(C){let B="";return B+=this.printGroups(C.groups),B+=this.printMsidSemantic(C.msidSemantic),B+=this.printIceLite(C.iceLite),B+=this.printIceUfrag(C.iceUfrag),B+=this.printIcePwd(C.icePwd),B+=this.printIceOptions(C.iceOptions),B+=this.printFingerprints(C.fingerprints),B+=this.printSetup(C.setup),B+=this.printTlsId(C.tlsId),B+=this.printIdentity(C.identities),B+=this.printExtmap(C.extmaps),B+=this.printUnrecognized(C.unrecognized),B}printGroups(C){let B="";return C.length>0&&(B+=C.map(H=>"a=group:".concat(H.semantic).concat(H.identificationTag.map(Se=>"".concat(m).concat(Se)).join("")).concat(this.eol)).join("")),B}printIceLite(C){return C===void 0?"":"a=ice-lite"+this.eol}printTlsId(C){return C?"a=tls-id:".concat(C).concat(this.eol):""}printIdentity(C){return C.length===0?"":C.map(B=>"a=identity:".concat(B.assertionValue).concat(B.extensions.map(H=>"".concat(m).concat(H.name).concat(H.value?"=".concat(H.value):"")))).join(this.eol)+this.eol}printMsidSemantic(C){if(!C)return"";let B="a=msid-semantic:".concat(C.semantic);return C.applyForAll?B+="".concat(m,"*"):C.identifierList.length>0&&(B+=C.identifierList.map(H=>"".concat(m).concat(H))),B+this.eol}}class ge extends Ut{print(C){const B=C.attributes;let H="";return H+=this.printRTCP(B.rtcp),H+=this.printIceUfrag(B.iceUfrag),H+=this.printIcePwd(B.icePwd),H+=this.printIceOptions(B.iceOptions),H+=this.printCandidates(B.candidates),H+=this.printRemoteCandidatesList(B.remoteCandidatesList),H+=this.printEndOfCandidates(B.endOfCandidates),H+=this.printFingerprints(B.fingerprints),H+=this.printSetup(B.setup),H+=this.printMid(B.mid),H+=this.printExtmap(B.extmaps),H+=this.printRTPRelated(B),H+=this.printPtime(B.ptime),H+=this.printMaxPtime(B.maxPtime),H+=this.printDirection(B.direction),H+=this.printSSRCGroups(B.ssrcGroups),H+=this.printSSRC(B.ssrcs),H+=this.printRTCPMux(B.rtcpMux),H+=this.printRTCPMuxOnly(B.rtcpMuxOnly),H+=this.printRTCPRsize(B.rtcpRsize),H+=this.printMSId(B.msids),H+=this.printImageattr(B.imageattr),H+=this.printRid(B.rids),H+=this.printSimulcast(B.simulcast),H+=this.printSCTPPort(B.sctpPort),H+=this.printMaxMessageSize(B.maxMessageSize),H+=this.printUnrecognized(B.unrecognized),H}printCandidates(C){return C.map(B=>"a=candidate:".concat(B.foundation).concat(m).concat(B.componentId).concat(m).concat(B.transport).concat(m).concat(B.priority).concat(m).concat(B.connectionAddress).concat(m).concat(B.port).concat(m,"typ").concat(m).concat(B.type).concat(B.relAddr?"".concat(m,"raddr").concat(m).concat(B.relAddr):"").concat(B.relPort?"".concat(m,"rport").concat(m).concat(B.relPort):"").concat(Object.keys(B.extension).map(H=>"".concat(m).concat(H).concat(m).concat(B.extension[H])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(C){return C.map(B=>"a=remote-candidates:".concat(B.join(m)).concat(this.eol)).join("")}printEndOfCandidates(C){return C===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(C){if(!C.payloads)return"";const B=C.payloads;let H="";H+=C.rtcpFeedbackWildcards.map(Se=>this.printRTCPFeedback("*",Se)).join("");for(const Se of B)H+=this.printRtpMap(Se.payloadType,Se.rtpMap),H+=this.printFmtp(Se.payloadType,Se.fmtp),H+=Se.rtcpFeedbacks.map(et=>this.printRTCPFeedback(Se.payloadType,et)).join("");return H}printFmtp(C,B){if(!B)return"";const H=Object.keys(B.parameters);return H.length===1&&B.parameters[H[0]]===null?"a=fmtp:".concat(C).concat(m).concat(H[0]).concat(this.eol):"a=fmtp:".concat(C).concat(m).concat(Object.keys(B.parameters).map(Se=>"".concat(Se,"=").concat(B.parameters[Se])).join(";")).concat(this.eol)}printRtpMap(C,B){return B?"a=rtpmap:".concat(C).concat(m).concat(B.encodingName,"/").concat(B.clockRate).concat(B.encodingParameters?"/".concat(B.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(C,B){let H="a=rtcp-fb:".concat(C).concat(m),Se=B;return Se.type==="trr-int"?H+="ttr-int".concat(m).concat(Se.interval):(H+="".concat(Se.type),Se.parameter&&(H+="".concat(m).concat(Se.parameter),Se.additional&&(H+="".concat(m).concat(Se.additional)))),H+this.eol}printPtime(C){return C===void 0?"":"a=ptime:".concat(C).concat(this.eol)}printMaxPtime(C){return C===void 0?"":"a=maxptime:".concat(C).concat(this.eol)}printDirection(C){return C===void 0?"":"a=".concat(C).concat(this.eol)}printSSRC(C){return C.map(B=>Object.keys(B.attributes).map(H=>"a=ssrc:".concat(B.ssrcId.toString(10)).concat(m).concat(H).concat(B.attributes[H]?":".concat(B.attributes[H]):"").concat(this.eol)).join("")).join("")}printRTCPMux(C){return C===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(C){return C===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(C){return C===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(C){if(C===void 0)return"";let B="a=rtcp:".concat(C.port);return C.netType&&(B+="".concat(m).concat(C.netType)),C.addressType&&(B+="".concat(m).concat(C.addressType)),C.address&&(B+="".concat(m).concat(C.address)),B+this.eol}printMSId(C){return C.map(B=>"a=msid:".concat(B.id).concat(B.appdata?"".concat(m).concat(B.appdata):"").concat(this.eol)).join("")}printImageattr(C){return C.map(B=>"a=imageattr:".concat(B).concat(this.eol)).join("")}printRid(C){return C.map(B=>{let H="a=rid:".concat(B.id).concat(m).concat(B.direction);return B.payloads&&(H+="".concat(m,"pt=").concat(B.payloads.join(","))),B.params.length>0&&(H+="".concat(m).concat(B.params.map(Se=>Se.type==="depend"?"depend=".concat(Se.rids.join(",")):"".concat(Se.type,"=").concat(Se.val)).join(";"))),H+this.eol}).join("")}printSimulcast(C){return C===void 0?"":"a=simulcast:".concat(C).concat(this.eol)}printSCTPPort(C){return C===void 0?"":"a=sctp-port:".concat(C).concat(this.eol)}printMaxMessageSize(C){return C===void 0?"":"a=max-message-size:".concat(C).concat(this.eol)}printMid(C){return C===void 0?"":"a=mid:".concat(C).concat(this.eol)}printSSRCGroups(C){return C.map(B=>"a=ssrc-group:".concat(B.semantic).concat(B.ssrcIds.map(H=>"".concat(m).concat(H.toString(10))).join("")).concat(this.eol)).join("")}}function Re(_e){return new Ee().parse(_e)}function ke(_e,C){return new at().print(_e,C)}}},t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={exports:{}};return e[i](a,a.exports,n),a.exports}return n.d=(i,a)=>{for(var c in a)n.o(a,c)&&!n.o(i,c)&&Object.defineProperty(i,c,{enumerable:!0,get:a[c]})},n.o=(i,a)=>Object.prototype.hasOwnProperty.call(i,a),n.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},n(8)})();function Ci(e){return OV.parse(e)}function Kc(e,t){return OV.print(e,t)}var qse=eo("Array","keys"),Yse=Wl,Xse=br,Jse=F,Qse=qse,KI=Array.prototype,$se={DOMTokenList:!0,NodeList:!0},Zse=function(e){var t=e.keys;return e===KI||Jse(KI,e)&&t===KI.keys||Xse($se,Yse(e))?Qse:t},ri=u(Zse);function xn(e,t,n){return(t=function(i){var a=function(c,d){if(typeof c!="object"||!c)return c;var h=c[Symbol.toPrimitive];if(h!==void 0){var m=h.call(c,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(c)}(i);return typeof a=="symbol"?a:a+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function PV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function lt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?PV(Object(n),!0).forEach(function(i){xn(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):PV(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function SS(e,t){return SS=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},SS(e,t)}function qI(){qI=function(a,c){return new n(a,void 0,c)};var e=RegExp.prototype,t=new WeakMap;function n(a,c,d){var h=RegExp(a,c);return t.set(h,d||t.get(a)),SS(h,n.prototype)}function i(a,c){var d,h=t.get(c);return to(d=Object.keys(h)).call(d,function(m,g){var _=h[g];if(typeof _=="number")m[g]=a[_];else{for(var v=0;a[_[v]]===void 0&&v+1<_.length;)v++;m[g]=a[_[v]]}return m},Object.create(null))}return function(a,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),c&&SS(a,c)}(n,RegExp),n.prototype.exec=function(a){var c=e.exec.call(this,a);if(c){c.groups=i(c,this);var d=c.indices;d&&(d.groups=i(d,this))}return c},n.prototype[Symbol.replace]=function(a,c){if(typeof c=="string"){var d=t.get(this);return e[Symbol.replace].call(this,a,c.replace(/\$<([^>]+)(>|$)/g,function(m,g,_){if(_==="")return m;var v=d[g];return Array.isArray(v)?"$"+v.join("$"):typeof v=="number"?"$"+v:""}))}if(typeof c=="function"){var h=this;return e[Symbol.replace].call(this,a,function(){var m=arguments;return typeof m[m.length-1]!="object"&&(m=[].slice.call(m)).push(i(m,h)),c.apply(this,m)})}return e[Symbol.replace].call(this,a,c)},qI.apply(this,arguments)}const DV=new class extends Sn{constructor(){super(...arguments),xn(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class eoe{constructor(t){xn(this,"logger",void 0),xn(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function YI(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function kV(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const io={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},TS=Date.now(),Fg=e=>{for(const t in io)if(Object.prototype.hasOwnProperty.call(io,t)&&io[t]===e)return t;return"DEFAULT"},R=new class{constructor(){xn(this,"proxyServerURL",void 0),xn(this,"logLevel",io.DEBUG),xn(this,"uploadState","collecting"),xn(this,"uploadLogWaitingList",[]),xn(this,"uploadLogUploadingList",[]),xn(this,"uploadErrorCount",0),xn(this,"currentLogID",0),xn(this,"url",void 0),xn(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[io.DEBUG].concat(t);this.log.apply(this,i)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[io.INFO].concat(t);this.log.apply(this,i)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[io.WARNING].concat(t);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[io.ERROR].concat(t);this.log.apply(this,i)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[io.DEBUG].concat(t);this.uploadLog.apply(this,i)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Zt("UPLOAD_LOG",!0)}disableLogUpload(){Zt("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new eoe(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-TS<100)return void setTimeout(()=>{this.log(...t)},Date.now()-TS);const i=Math.max(0,Math.min(4,t[0]));if(t[0]=YI()+" Agora-SDK [".concat(Fg(i),"]:"),this.appendLogToWaitingList(i,...t),i<this.logLevel)return;const a=YI()+" %cAgora-SDK [".concat(Fg(i),"]:");let c=[];if(!D("USE_NEW_LOG"))switch(i){case io.DEBUG:c=[a,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,c);break;case io.INFO:c=[a,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,c);break;case io.WARNING:c=[a,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,c);break;case io.ERROR:c=[a,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,c)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-TS<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-TS);const i=Math.max(0,Math.min(4,t[0]));t[0]=YI()+" Agora-SDK [".concat(Fg(i),"]:"),this.appendLogToWaitingList(i,...t)}appendLogToWaitingList(e){if(!D("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];Array.isArray(n[0])?n[0][0]=kV()+" Agora-SDK [".concat(Fg(e),"]:"):n[0]=kV()+" Agora-SDK [".concat(Fg(e),"]:");let a="";n.forEach(c=>{typeof c=="object"&&(c=JSON.stringify(c)),a+="".concat(c," ")}),this.uploadLogWaitingList.push({payload_str:a,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:ro,process_id:D("PROCESS_ID"),payload:JSON.stringify(e)};return pa(async()=>{const n=await Mi.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(D("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(D("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){const i=new Error("unexpected upload log response");throw i.response=n,i}},()=>(this.uploadLogUploadingList=[],!1),n=>{const i={status:-1,message:n.message,errorRange:e.map(a=>a.log_item_id)};return n.response?(i.status=n.response.status,i.data=n.response.data,i.headers=n.response.headers):n.request&&(i.status=n.request.status),DV.reportLogUploadError(i),!0},{timeout:D("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:D("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,D("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),D("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),D("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),D("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var LV;function toe(e){return Lr(e.reportId,"params.reportId",0,100,!1),Lr(e.category,"params.category",0,100,!1),Lr(e.event,"params.event",0,100,!1),Lr(e.label,"params.label",0,100,!1),nn(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(LV={}).FREE="free",LV.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const noe={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let ir=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.RTE_DETAIL="rte_detail_stats",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),En=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.RTE_DETAIL="io.agora.pb.Wrtc.RteDetailStats",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let roe=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function He(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,i){const a=i.value;if(typeof a=="function"){const c=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);i.value=function(){for(var d,h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];let _=m;if(e.argsMap)try{_=e.argsMap(this,...m)}catch(y){R.warning(y),_=[]}try{JSON.stringify(_)}catch{R.warning("arguments for method ".concat(c,".").concat(String(n)," not serializable for apiInvoke.")),_=[]}const v=(e.report||Le).reportApiInvoke(this._sessionId||null,{id:this._clientId||((d=this.store)===null||d===void 0?void 0:d.clientId)||this._ID,name:"".concat(c,".").concat(String(n)),options:_,tag:rn.TRACER,reportResult:e.reportResult},e.throttleTime);try{const y=a.apply(this,m);return y instanceof we?y.then(b=>(v.onSuccess(e.reportResult&&b),b)).catch(b=>{throw v.onError(b),b}):(v.onSuccess(e.reportResult&&y),y)}catch(y){throw v.onError(y),y}}}return i}}const Le=new class{constructor(){xn(this,"baseInfoMap",new Map),xn(this,"proxyServer",void 0),xn(this,"eventUploadTimer",void 0),xn(this,"setSessionIdTimer",void 0),xn(this,"url",void 0),xn(this,"sids",new Set),xn(this,"backupUrl",void 0),xn(this,"_appId",void 0),xn(this,"_aid",0),xn(this,"keyEventUploadPendingItems",[]),xn(this,"normalEventUploadPendingItems",[]),xn(this,"apiInvokeUploadPendingItems",[]),xn(this,"apiInvokeCount",0),xn(this,"apiInvokeLoggedCount",0),xn(this,"ltsList",[]),xn(this,"lastSendNormalEventTime",Date.now()),xn(this,"customReportCounterTimer",void 0),xn(this,"customReportCount",0),xn(this,"extApiInvoke",async e=>{for(const t of e){const n=lt(lt({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:rn.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),D("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),D("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[n,i]=t;return n+i}),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const i=Date.now();this.apiInvokeCount+=1;const a=this.apiInvokeCount,c=!!D("SHOW_REPORT_INVOKER_LOG"),d=!!D("SHOW_REPORT_USER_INVOKER_LOG"),h=c||d&&t.id;h&&(this.apiInvokeLoggedCount+=1);const m=this.apiInvokeLoggedCount;function g(b,O){if(h){let I="[apiInvoke-".concat(m,"]");if(t.id&&(I+="[".concat(t.id,"]")),t.name&&(I+="[".concat(t.name,"]"),t.name===_n.JOIN))return R.info("".concat(I," ").concat(b));R.info("".concat(I," ").concat(b),b==="start"?t.options:O||"")}}const _=()=>({tag:t.tag,invokeId:a,sid:e,name:t.name,apiInvokeTime:i,options:t.options,states:t.states||null});g("start");let v=!1;pr(t.timeout).then(()=>{v||(this.sendApiInvoke(lt(lt({},_()),{},{error:L.API_INVOKE_TIMEOUT,success:!1})),g("timeout"))});const y=new de(L.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:b=>{const O=()=>{if(v)throw y;return v=!0,this.sendApiInvoke(lt(lt({},_()),{},{success:!0},t.reportResult&&{result:b})),g("onSuccess"),b};return n?fV(O,t.name+"Success",n,()=>v=!0):O()},onError:b=>{const O=()=>{if(v)throw b;v=!0,this.sendApiInvoke(lt(lt({},_()),{},{success:!1,error:b})),g("onFailure",b.toString())};return n?fV(O,t.name+"Error",n,()=>v=!0):O()}}}_send(e,t,n){this.send({type:e,data:t},n)}_sendApiInvoke(e){return this.sendApiInvoke(e)}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),i=this.createBaseInfo(e,n);i.cname=t.cname,i.rteUrl=t.rteUrl;const a=Object.assign({},{willUploadConsoleLog:D("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:GI?"global":"oversea",areas:D("AREAS")&&D("AREAS").join(",")},t.extend),{stringUid:c,channelProfile:d,channelMode:h,isABTestSuccess:m,lsid:g,clientRole:_}=t,v=Date.now(),y=lt(lt({},i),{},{eventType:ir.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:zI,lts:v,elapse:v-n,extend:JSON.stringify(a),mode:t.mode,process:D("PROCESS_ID"),appType:D("APP_TYPE"),success:!0,version:ro,stringUid:c,channelProfile:d,channelMode:h,isABTestSuccess:m,lsid:g,clientType:ve(b=window.navigator.userAgent).call(b,"AgoraWebView")?42:20,clientRole:_,serviceId:D("PROCESS_ID"),extensionID:D("PLUGIN_INFO").join(",")||"",rteUrl:t.rteUrl,rteSid:t.rteSid});var b;this.send({type:En.SESSION,data:y},!0)}reportRteDetail(e){const t=this.baseInfoMap.get(e);if(!t)return;const n=t.info,i=Date.now(),a=lt(lt({},n),{},{eventType:ir.RTE_DETAIL,lts:i,success:!0,elapse:i-t.startTime,vid:n.vid===void 0?0:Number(n.vid),ua:navigator.userAgent});this.send({type:En.RTE_DETAIL,data:a},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info;t.vid&&(i.vid=t.vid);const a=Date.now(),c=lt(lt({},i),{},{role:t.role,eventType:ir.JOIN_CHOOSE_SERVER,lts:a,eventElapse:t.elapse||a-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:a-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,ua:navigator.userAgent,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:En.JOIN_CHOOSE_SERVER,data:c},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now(),c=lt(lt({},i),{},{eventType:ir.REQ_USER_ACCOUNT,lts:a,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||a-n.startTime,eventElapse:a-t.lts,extend:JSON.stringify(t.extend)});this.send({type:En.REQ_USER_ACCOUNT,data:c},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info;t.vid&&(i.vid=t.vid),i.uid=t.uid,i.cid=t.cid;const a=Date.now(),{firstSuccess:c,addr:d,isProxy:h}=t,m=a-n.startTime,g=lt(lt({},i),{},{eventType:ir.JOIN_GATEWAY,lts:a,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:m,eventElapse:a-t.lts,firstSuccess:c,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:BI(),isABTestSuccess:t.isABTestSuccess?1:0,gatewayIp:null,gatewayPort:null,isProxy:h?1:0}),_=g.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=a),d)if(g.signalChannel==="1"){const v=qI(/(\d+\.\d+\.\d+\.\d+):(\d+)/,{ip:1,port:2}),y=d.match(v);g.gatewayIp=y&&y.groups?y.groups.ip:"",g.gatewayPort=y&&y.groups?y.groups.port:""}else if(h){const v=d.match(/h=(\d{1,3}-){3}\d{1,3}/g),y=d.match(/p=[0-9]{1,6}/g);g.gatewayIp=v&&v.length?v[0].split("=")[1].replace(/-/g,"."):"",g.gatewayPort=y&&y.length?y[0].split("=")[1]:""}else{const v=d.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),y=d.match(/(:|p=)[0-9]{1,6}/g);g.gatewayIp=v&&v.length?v[0].split("//")[1].replace(/-/g,"."):"",g.gatewayPort=y&&y.length?y[0].split(/:|p=/g)[1]:""}if(c)this.send({type:En.JOIN_GATEWAY,data:g},!0);else{let v={isSuccess:_,port:g.gatewayPort};delete g.success,delete g.eventType,delete g.firstSuccess,delete g.gatewayPort,g.vid=Number(g.vid);const y=Object.assign({},g,v,{eventType:ir.REJOIN_GATEWAY});this.send({type:En.RE_JOIN_GATEWAY,data:y},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=Date.now(),a=lt(lt({},n.info),{},{lts:i,timeout:t,elapse:i-n.startTime});this.send({type:En.JOIN_CHANNEL_TIMEOUT,data:a},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now(),c=lt(lt({},i),{},{eventType:ir.PUBLISH,lts:a,eventElapse:t.eventElapse,elapse:a-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:En.PUBLISH,data:c},!0)}subscribe(e,t,n){const i=this.baseInfoMap.get(e);if(!i)return;const a=i.info,c=Date.now(),d=lt(lt({},a),{},{eventType:ir.SUBSCRIBE,lts:c,eventElapse:t.eventElapse,elapse:c-i.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?d.peerSuid=t.peerid:d.peer=t.peerid,this.send({type:En.SUBSCRIBE,data:d},!0)}wsCompressorInit(e){var t;const n=[...ri(t=this.baseInfoMap).call(t)],i=n.length?n[0]:"UnableToGetSid",a=this.baseInfoMap.get(i);if(!a)return;const c=a.info,d=Date.now(),h=lt(lt({},c),{},{eventType:ir.WS_COMPRESSOR_INIT,lts:d,eventElapse:e.eventElapse,elapse:d-a.startTime,status:e.status?1:2});this.send({type:En.WS_COMPRESSOR_INIT,data:h},!0)}firstXLAPeerFirstVideoFrame(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now(),c=t.peerPubStatusMs-(n.lastJoinSuccessTime||a),d=lt(lt({},i),{},{elapse:a-n.startTime,eventType:ir.XLA_PEER_FIRST_VIDEO_FRAME,lts:a,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:c,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>c?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0,firstReceivedEncodedFrame:t.firstReceivedEncodedFrame?Math.max(t.firstReceivedEncodedFrame-t.joinChannelStart,0):void 0,frameType:t.frameType||"",rtpTimestamp:t.rtpTimestamp||0,framePayloadType:t.framePayloadType||0,frameDataLength:t.frameDataLength||0,mimeType:t.mimeType||""});this.send({type:En.XLA_PEER_FIRST_VIDEO_FRAME,data:d},!0)}firstRemoteVideoDecode(e,t,n,i){const a=this.baseInfoMap.get(e);if(!a)return;const c=a.info,d=Date.now(),h=lt(lt(lt({},c),i),{},{elapse:d-a.startTime,eventType:t,lts:d,firstDecodeFrame:Math.max((i.firstFrame||d)-a.startTime,0),apEnd:Math.max(i.apEnd-a.startTime,0),apStart:Math.max(i.apStart-a.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-a.startTime,0),joinGwStart:Math.max(i.joinGwStart-a.startTime,0),pcEnd:Math.max(i.pcEnd-a.startTime,0),pcStart:Math.max(i.pcStart-a.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-a.startTime,0),subscriberStart:Math.max(i.subscriberStart-a.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-a.startTime,0)});this.send({type:n,data:h},!0)}firstRemoteFrame(e,t,n,i){const a=this.baseInfoMap.get(e);if(!a)return;const c=a.info,d=Date.now(),h=lt(lt(lt({},c),i),{},{elapse:d-a.startTime,eventType:t,lts:d});this.send({type:n,data:h},!0)}abTest(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now(),c=lt(lt(lt({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:a-n.startTime,eventType:ir.AB_TEST,lts:a});this.send({type:En.AB_TEST,data:c},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now(),c=lt(lt(lt({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:a-n.startTime,eventType:ir.PC_STATS,lts:a,preallocation:t.preallocation?1:0});this.send({type:En.PC_STATS,data:c},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now(),c=lt(lt(lt({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),eventType:ir.UPDATE_REMOTE_RTPCAPABILITIES,lts:a});this.send({type:En.UPDATE_REMOTE_RTPCAPABILITIES,data:c},!0)}}onGatewayStream(e,t,n,i){const a=this.baseInfoMap.get(e);if(!a)return;const c=a.info,d=Date.now(),h=lt(lt(lt({},c),i),{},{eventType:t,lts:d});this.send({type:n,data:h},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now(),c=lt(lt({},i),{},{eventType:ir.STREAM_SWITCH,lts:a,isDual:t.isdual,elapse:a-n.startTime,success:t.succ});this.send({type:En.STREAM_SWITCH,data:c},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now(),c=lt(lt({},i),{},{eventType:ir.REQUEST_PROXY_APPCENTER,lts:a,eventElapse:a-t.lts,elapse:a-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:En.REQUEST_PROXY_APPCENTER,data:c},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now(),c=lt(lt({},i),{},{eventType:ir.REQUEST_PROXY_WORKER_MANAGER,lts:a,eventElapse:a-t.lts,elapse:a-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:En.REQUEST_PROXY_WORKER_MANAGER,data:c},!0)}setProxyServer(e){this.proxyServer=e,e?R.debug("reportProxyServerurl: ".concat(e)):R.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now(),c=lt(lt({},i),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:a,elapse:a-n.startTime,joinChannelSuccessElapse:a-(n.lastJoinSuccessTime||a),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:En.PEER_PUBLISH_STATUS,data:c},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now();(function(c,d,h){const m=c[d];if(!m||typeof m!="string")return[c];c[d]="";const g=rc(JSON.stringify(c));let _=0;const v=[];let y=0;for(let b=0;b<m.length;b++)y+=m.charCodeAt(b)<=127?1:3,y<=h-g||(v[v.length]=be(be({},c),{},{[d]:m.substring(_,b)}),_=b,y=m.charCodeAt(b)<=127?1:3);return _!==m.length-1&&(v[v.length]=be(be({},c),{},{[d]:m.substring(_)})),v})(lt(lt(lt({},i),t),{},{elapse:a-n.startTime,lts:a,productType:"WebRTC"}),"payload",1300).forEach(c=>this.send({type:En.WORKER_EVENT,data:c},!0))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now(),c=lt(lt(lt({},i),t),{},{elapse:a-n.startTime,lts:a});this.send({type:En.AP_WORKER_EVENT,data:c},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now(),c=lt(lt(lt({},i),t),{},{elapse:a-n.startTime,lts:a,extend:t.extend||void 0});this.send({type:En.JOIN_WEB_PROXY_AP,data:c},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now(),c=lt(lt(lt({},i),t),{},{elapse:a-n.startTime,lts:a});this.send({type:En.WEBSOCKET_QUIT,data:c},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>D("CUSTOM_REPORT_LIMIT"))throw new de(L.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),i=t.map(a=>({type:En.USER_ANALYTICS,data:lt(lt({sid:e},a),{},{lts:n})}));try{D("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(a){throw R.error("send custom report message failed",a.toString()),new de(L.CUSTOM_REPORT_SEND_FAILED,a.message)}}sendApiInvoke(e){const t=D("NOT_REPORT_EVENT");if(e.tag&&ve(t)&&ve(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:i,uid:a,cid:c}=n.info;let d;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof de){const{code:m,message:g}=e.error;d=m||g||e.error.toString()}else d=e.error.toString();const h={invokeId:e.invokeId,sid:e.sid,cname:i,cid:c,uid:a,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?d:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:En.API_INVOKE,data:h},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find(n=>n!==null);t&&e.forEach(n=>{n&&(n.sid=t,this.sendApiInvoke(Object.assign({},n)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>D("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],i=[];for(;e.length;){const c=e.shift();n.length<20?n.push(c):i.push(c)}e.push(...i);for(const c of[...n]){var a;this.ltsList.indexOf(c.data.lts)!==-1?(c.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(c.data.lts)):(this.ltsList.push(c.data.lts),Tu(a=this.ltsList).call(a,(d,h)=>d-h))}return t||(this.lastSendNormalEventTime=Date.now()),D("ENABLE_EVENT_REPORT")&&n.length&&(D("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((c=>d=>{D("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(c):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(c),this.normalEventUploadPendingItems.length>D("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-D("NORMAL_EVENT_QUEUE_CAPACITY")),R.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){Nn.networkState===wi.OFFLINE&&await we.race([Nn.onlineWaiter,pr(2*Kn.maxRetryTimeout)]);const t=a=>{let c=new Uint8Array;return a.forEach(d=>{const h=II(JSON.stringify(d.data)),m=new ArrayBuffer(5),g=(v=>{let y=0;return Object.entries(En).forEach(b=>{let[O,I]=b;I===v.type&&(y=roe[O])}),y})(d),_=new DataView(m);_.setUint16(0,h.byteLength,!0),_.setUint8(2,255&g),_.setUint8(3,g>>>8&255),_.setUint8(4,g>>>16&255),c=sV(c,new Uint8Array(m)),c=sV(c,h)}),c},n="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(D("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(D("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let a=0;a<2;a+=1){a===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(D("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(D("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await UI(i,{timeout:1e4,data:t(e),headers:lt(lt({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(c){if(a===1)throw c;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(h=>{const m=h&&h.data.sid&&this.baseInfoMap.get(h.data.sid);return m&&m.info.vid&&+m.info.vid||0})(e[0]),i=n?void 0:this._aid,a={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(h=>JSON.stringify(h)),vid:n,aid:i};Nn.networkState===wi.OFFLINE&&await we.race([Nn.onlineWaiter,pr(2*Kn.maxRetryTimeout)]);const c=t?"/events/proto-raws":"/events/messages";let d=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(D("EVENT_REPORT_DOMAIN"),"&p=").concat(D("STATS_COLLECTOR_PORT"),"&d=").concat(c):"https://".concat(D("EVENT_REPORT_DOMAIN"),":").concat(D("STATS_COLLECTOR_PORT")).concat(c));for(let h=0;h<2;h+=1){h===1&&(d=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(D("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(D("STATS_COLLECTOR_PORT"),"&d=").concat(c):"https://".concat(D("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(D("STATS_COLLECTOR_PORT")).concat(c)));try{t?await Gse(d,{timeout:1e4,data:a}):await UI(d,{timeout:1e4,data:a})}catch(m){if(h===1)throw m;continue}return}}createBaseInfo(e,t){const n=Object.assign({},noe);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),i=n[n.length-1];i&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:i,tag:rn.TRACER}).onSuccess()}};DV.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Nn.networkState,Le.reportApiInvoke(null,{name:"logUploadError",options:e,tag:rn.TRACER}).onSuccess("logUploadError")});let se=class extends de{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),xn(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,R)}throw(){super.throw(R)}};const mr={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1,supportSuppressLocalAudioPlayback:!1,supportRestrictOwnAudio:!1};function vt(){return mr}function MV(){return"setSinkId"in HTMLAudioElement.prototype&&(!D("RESTRICTION_SET_PLAYBACK_DEVICE")||(zc()||zj())&&!Zj())}function bS(){return!mr.supportUnifiedPlan||D("CHROME_FORCE_PLAN_B")&&nc()}function Bg(e){return!(pn()||Hj(87)||bS()||!D("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||D("FORCE_DISABLE_AUTO_SUB")))}function UV(e){return D("ENABLE_INSTANT_VIDEO")?D("ENABLE_INSTANT_VIDEO"):!(e==null||!e.autoSubscribe||D("FORCE_DISABLE_AUTO_SUB"))}function jV(){return navigator.mediaDevices&&"getSupportedConstraints"in navigator.mediaDevices}function VV(){if(jV()){const e=navigator.mediaDevices.getSupportedConstraints();return!(!("suppressLocalAudioPlayback"in e)||!e.suppressLocalAudioPlayback)}return ha(141)||$l(141)||Ou(141)}function FV(){if(jV()){const e=navigator.mediaDevices.getSupportedConstraints();return!(!("restrictOwnAudio"in e)||!e.restrictOwnAudio)}return ha(141)||$l(141)||Ou(125)}let Mr=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Hp(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function Dt(e,t,n,i,a){return{width:e,height:t,frameRate:n,bitrateMin:i,bitrateMax:a}}function ko(e,t,n,i,a){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:i,bitrateMax:a}}function XI(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const ioe={"90p":Dt(160,90),"90p_1":Dt(160,90),"120p":Dt(160,120,15,30,65),"120p_1":Dt(160,120,15,30,65),"120p_3":Dt(120,120,15,30,50),"120p_4":Dt(212,120),"180p":Dt(320,180,15,30,140),"180p_1":Dt(320,180,15,30,140),"180p_3":Dt(180,180,15,30,100),"180p_4":Dt(240,180,15,30,120),"240p":Dt(320,240,15,40,200),"240p_1":Dt(320,240,15,40,200),"240p_3":Dt(240,240,15,40,140),"240p_4":Dt(424,240,15,40,220),"360p":Dt(640,360,15,80,400),"360p_1":Dt(640,360,15,80,400),"360p_3":Dt(360,360,15,80,260),"360p_4":Dt(640,360,30,80,600),"360p_6":Dt(360,360,30,80,400),"360p_7":Dt(480,360,15,80,320),"360p_8":Dt(480,360,30,80,490),"360p_9":Dt(640,360,15,80,800),"360p_10":Dt(640,360,24,80,800),"360p_11":Dt(640,360,24,80,1e3),"480p":Dt(640,480,15,100,500),"480p_1":Dt(640,480,15,100,500),"480p_2":Dt(640,480,30,100,1e3),"480p_3":Dt(480,480,15,100,400),"480p_4":Dt(640,480,30,100,750),"480p_6":Dt(480,480,30,100,600),"480p_8":Dt(848,480,15,100,610),"480p_9":Dt(848,480,30,100,930),"480p_10":Dt(640,480,10,100,400),"720p":Dt(1280,720,15,120,1130),"720p_auto":Dt(1280,720,30,900,3e3),"720p_1":Dt(1280,720,15,120,1130),"720p_2":Dt(1280,720,30,120,2e3),"720p_3":Dt(1280,720,30,120,1710),"720p_5":Dt(960,720,15,120,910),"720p_6":Dt(960,720,30,120,1380),"1080p":Dt(1920,1080,15,120,2080),"1080p_1":Dt(1920,1080,15,120,2080),"1080p_2":Dt(1920,1080,30,120,3e3),"1080p_3":Dt(1920,1080,30,120,3150),"1080p_5":Dt(1920,1080,60,120,4780),"1440p":Dt(2560,1440,30,120,4850),"1440p_1":Dt(2560,1440,30,120,4850),"1440p_2":Dt(2560,1440,60,120,7350),"4k":Dt(3840,2160,30,120,8910),"4k_1":Dt(3840,2160,30,120,8910),"4k_3":Dt(3840,2160,60,120,13500)},soe={"480p":ko(640,480,5),"480p_1":ko(640,480,5),"480p_2":ko(640,480,30),"480p_3":ko(640,480,15),"720p":ko(1280,720,5),"720p_auto":Dt(1280,720,30,900,3e3),"720p_1":ko(1280,720,5),"720p_2":ko(1280,720,30),"720p_3":ko(1280,720,15),"1080p":ko(1920,1080,5),"1080p_1":ko(1920,1080,5),"1080p_2":ko(1920,1080,30),"1080p_3":ko(1920,1080,15)},ooe={"1SL1TL":XI(1,1),"3SL3TL":XI(3,3),"2SL3TL":XI(2,3)};function Lo(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},ioe[e]):e}function JI(e){return typeof e=="string"?Object.assign({},soe[e]):e}function RS(e){return typeof e=="string"?Object.assign({},ooe[e]):e}const aoe={speech_low_quality:Hp(16e3,!1),speech_standard:Hp(32e3,!1,18),music_standard:Hp(48e3,!1),standard_stereo:Hp(48e3,!0,56),high_quality:Hp(48e3,!1,128),high_quality_stereo:Hp(48e3,!0,192)};function wS(e){return typeof e=="string"?Object.assign({},aoe[e]):e}const Fu=[];function BV(e){return Hn(e,"mediaSource",["screen","window","application"]),!0}let Me=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),Bt=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),Kp=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),coe=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),loe=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),Bu=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),qp=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),so=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e}({}),Yp=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),Us=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const QI={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},$I={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},GV={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},doe={uplinkNetworkQuality:0,downlinkNetworkQuality:0},WV={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Ii=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),js=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),Gg=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),Gu=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Yr=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),ic=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const ZI={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let CS=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function wt(e,t,n,i,a){var c,d,h={};return Object.keys(i).forEach(function(m){h[m]=i[m]}),h.enumerable=!!h.enumerable,h.configurable=!!h.configurable,("value"in h||h.initializer)&&(h.writable=!0),h=to(c=_k(d=n.slice()).call(d)).call(c,function(m,g){return g(e,t,m)||m},h),a&&h.initializer!==void 0&&(h.value=h.initializer?h.initializer.call(a):void 0,h.initializer=void 0),h.initializer===void 0?(Object.defineProperty(e,t,h),null):h}function oe(e,t,n){return(t=function(i){var a=function(c,d){if(typeof c!="object"||!c)return c;var h=c[Symbol.toPrimitive];if(h!==void 0){var m=h.call(c,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(c)}(i);return typeof a=="symbol"?a:a+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function zV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function hn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?zV(Object(n),!0).forEach(function(i){oe(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zV(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class HV extends Sn{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(Bu.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,n){super(),oe(this,"trackMediaType",void 0),oe(this,"_ID",void 0),oe(this,"_rtpTransceiver",void 0),oe(this,"_lowRtpTransceiver",void 0),oe(this,"_hints",[]),oe(this,"_isClosed",!1),oe(this,"_originMediaStreamTrack",void 0),oe(this,"mediaStreamTrack",void 0),oe(this,"_external",{}),this._ID=n||Wt(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(i){ve(Fu).call(Fu,i)||Fu.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||Zl(()=>{var n;Le.reportApiInvoke(null,{name:_n.GET_MEDIA_STREAM_TRACK,options:[],tag:rn.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===Kp.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const n=Fu.indexOf(t);n!==-1&&Fu.splice(n,1)}(this),this.emit(qp.CLOSED),this.removeAllListeners(Bu.SEI_RECEIVED)}_updateRtpTransceiver(t,n){if(n===Kp.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(Bu.TRANSCEIVER_UPDATED,t,n)}}class Xp extends HV{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,n){super(t,n),oe(this,"_enabled",!0),oe(this,"_muted",!1),oe(this,"_isExternalTrack",!1),oe(this,"_isClosed",!1),oe(this,"_enabledMutex",void 0),oe(this,"processor",void 0),oe(this,"_processorContext",void 0),oe(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Cr("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,R.debug("[".concat(this.getTrackId(),"] close")),this.emit(Me.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await cn(this,Me.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(qp.TRACK_ENDED)}stateCheck(t,n){if(R.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),Oo(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new de(L.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",R);if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new de(L.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",R)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():we.resolve([])}}const KV=window.AudioContext||window.webkitAudioContext;let eA,Vs=null;const en=new class extends Sn{constructor(){super(...arguments),oe(this,"prevState",void 0),oe(this,"curState",void 0),oe(this,"currentTime",void 0),oe(this,"currentTimeStuckAt",void 0),oe(this,"interruptDetectorTrack",void 0),oe(this,"onLocalAudioTrackMute",()=>{R.info("ios15-interruption-start"),this.emit(Mr.IOS_15_16_INTERRUPTION_START)}),oe(this,"onLocalAudioTrackUnmute",async()=>{R.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?R.info("ios15-interruption-end-canceled"):(Vs&&await Vs.suspend(),this.emit(Mr.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){R.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){R.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Jp(){if(!Vs){if(function(){if(!KV)return void R.error("your browser is not support web audio");R.info("create audio context");const e=hn({},D("WEBAUDIO_INIT_OPTIONS"));R.debug("audio context init option:",JSON.stringify(e)),Vs=new KV(e),en.curState=Vs.state,Vs.onstatechange=()=>{en.prevState=en.curState,en.curState=Vs?Vs.state:void 0;const{prevState:t,curState:n}=en,i=n==="running",a=n==="interrupted",c=t==="running",d=t==="suspended",h=t==="interrupted",m=Pt().osVersion;(ni()||xo())&&c&&a&&(R.info("ios".concat(m,"-interruption-start")),en.emit(Mr.IOS_INTERRUPTION_START)),(ni()||xo())&&(d||h)&&i&&(R.info("ios".concat(m,"-interruption-end")),en.emit(Mr.IOS_INTERRUPTION_END)),t!==n&&en.emit(Mr.STATE_CHANGE,n,t)},setInterval(()=>{var t;const n=(t=Vs)===null||t===void 0?void 0:t.currentTime;en.currentTime!==n?(en.currentTimeStuckAt&&(R.debug("AudioContext current time resume at ".concat(n)),en.currentTimeStuckAt=void 0),en.currentTime=n):(n!==en.currentTimeStuckAt&&(Le.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:rn.TRACER}).onSuccess(),R.warning("AudioContext current time stuck at ".concat(n))),en.currentTimeStuckAt=n)},5e3),async function(t){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let i,a,c=!1,d=!1,h=!1;function m(k){t.state==="running"?g(!1):ni()||xo()?t.state==="suspended"&&(g(!0),k&&t.resume().then(_,_)):t.state!=="closed"&&(g(!0),k&&t.resume().then(_,_))}function g(k){if(c!==k){c=k;for(let j=0,G=n;j<G.length;j+=1){const K=G[j];k?window.addEventListener(K,v,{capture:!0,passive:!0}):window.removeEventListener(K,v,{capture:!0,passive:!0})}}}function _(){m(!1)}function v(){m(!0)}function y(){let k;try{k=i.play(),k?k.then(I,I):(i.addEventListener("playing",I),i.addEventListener("abort",I),i.addEventListener("error",I))}catch{I()}}function b(k){h||(i.paused?k?(O(!1),h=!0,y()):O(!0):O(!1))}function O(k){if(d!==k){d=k;for(let j=0,G=n;j<G.length;j++){const K=G[j];k?window.addEventListener(K,N,{capture:!0,passive:!0}):window.removeEventListener(K,N,{capture:!0,passive:!0})}}}function I(){i.removeEventListener("playing",I),i.removeEventListener("abort",I),i.removeEventListener("error",I),h=!1,b(!1)}function N(){b(!0)}if(ni()&&D("IOS_BG_TAG")){const k=t.createMediaStreamDestination(),j=document.createElement("div");j.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=j.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=k.stream,a=()=>{if(D("IOS_AUTO_RESTART_BG_TAG")&&i&&i.srcObject&&!h&&(!i.paused||d!==!0)){i.paused||i.pause();try{h=!0,y()}catch{h=!1}return!0}},b(!0)}return en.on(Mr.STATE_CHANGE,function(){m(!0)}),m(!1),a}(Vs).then(t=>{eA=t})}(),!Vs)throw new de(L.NOT_SUPPORTED,"can not create audio context");return Vs}return Vs}function Wu(e){if(function(){if(tA!==null)return tA;const i=Jp(),a=i.createBufferSource(),c=i.createGain(),d=i.createGain();a.connect(c),a.connect(d),a.disconnect(c);let h=!1;try{a.disconnect(c)}catch{h=!0}return a.disconnect(),tA=h,h}())return;const t=e.connect,n=e.disconnect;e.connect=(i,a,c)=>{var d;return e._inputNodes||(e._inputNodes=[]),ve(d=e._inputNodes).call(d,i)||(i instanceof AudioNode?(e._inputNodes.push(i),t.call(e,i,a,c)):t.call(e,i,a)),e},e.disconnect=(i,a,c)=>{n.call(e),i?pS(e._inputNodes,i):e._inputNodes=[];for(const d of e._inputNodes)t.call(e,d)}}let tA=null;function nA(e,t){let n=!1;const i=1/t;if(D("DISABLE_WEBAUDIO")){const a=window.setInterval(()=>{n?window.clearInterval(a):e(performance.now()/1e3)},1e3*i)}else{const a=Jp();let c=a.createGain();c.gain.value=0,c.connect(a.destination);const d=()=>{if(n)return void(c=null);const h=a.createOscillator();h.onended=d,h.connect(c),h.start(0),h.stop(a.currentTime+i),e(a.currentTime)};d()}return()=>{n=!0}}class qV{constructor(){oe(this,"context",void 0),oe(this,"analyserNode",void 0),oe(this,"sourceNode",void 0),this.context=Jp(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||ni()||xo()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let a=0;a<t.length;++a)t[a]=i[a]/128-1}const n=to(t).call(t,(i,a)=>i+a*a,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{R.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class YV extends Sn{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),oe(this,"outputNode",void 0),oe(this,"outputTrack",void 0),oe(this,"isPlayed",!1),oe(this,"sourceNode",void 0),oe(this,"context",void 0),oe(this,"audioBufferNode",void 0),oe(this,"destNode",void 0),oe(this,"audioOutputLevel",0),oe(this,"volumeLevelAnalyser",void 0),oe(this,"_processedNode",void 0),oe(this,"playNode",void 0),oe(this,"isDestroyed",!1),oe(this,"onNoAudioInput",void 0),oe(this,"isNoAudioInput",!1),oe(this,"_noAudioInputCount",0),this.context=Jp(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Wu(this.outputNode),this.volumeLevelAnalyser=new qV}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(Us.ON_AUDIO_BUFFER,function(i){for(let a=0;a<i.outputBuffer.numberOfChannels;a+=1){const c=i.outputBuffer.getChannelData(a);for(let d=0;d<c.length;d+=1)c[d]=0}return i.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!vt().webAudioMediaStreamDest)throw new de(L.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&mS(()=>{en.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;ni()||xo()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let i;n.getFloatTimeDomainData?(i=new Float32Array(n.fftSize),n.getFloatTimeDomainData(i)):(i=new Uint8Array(n.fftSize),n.getByteTimeDomainData(i));let a=!1;for(let c=0;c<i.length;c++)i[c]!==0&&(a=!0);return a?(this.isNoAudioInput=!1,!0):(await pr(200),await this.checkHasAudioInput(t?t+1:1)&&a)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class rA extends YV{get isFreeze(){return!1}constructor(t,n,i){var a;if(super(),oe(this,"sourceNode",void 0),oe(this,"track",void 0),oe(this,"clonedTrack",void 0),oe(this,"audioElement",void 0),oe(this,"isCurrentTrackCloned",!1),oe(this,"isRemoteTrack",!1),oe(this,"originVolumeLevelAnalyser",void 0),oe(this,"rebuildWebAudio",async()=>{if(R.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void R.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>R.info("resume success")),R.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const h=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?h.stop():this.isCurrentTrackCloned=!0;const m=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(m),Wu(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const g=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(g,this.context.currentTime),Wu(this.outputNode),this.emit(Us.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=m,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new de(L.UNEXPECTED_ERROR);this.track=t;const c=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(c),Wu(this.sourceNode),i){const h=i.clone();h.enabled=!0,this.clonedTrack=h,R.debug("create an unmuted track ".concat(h.id," from the original track ").concat(i.id," to get the volume"));const m=this.context.createMediaStreamSource(new MediaStream([h]));Wu(m),this.originVolumeLevelAnalyser=new qV,this.originVolumeLevelAnalyser.updateSource(m)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=c;const d=Pt();n&&d.os===hr.IOS&&Number((a=d.osVersion)===null||a===void 0?void 0:a.split(".")[0])<15&&(en.on(Mr.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(h=>{h||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),Wu(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Us.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),en.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),R.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([n]));Wu(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function XV(e,t,n){const i=(c,d)=>c?typeof c!="number"?c.max||c.exact||c.ideal||c.min||d:c:d,a={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:i(t.height,1080),maxWidth:i(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(a.video.mandatory.maxFrameRate=t.frameRate.max,a.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(a.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(a)}async function uoe(e,t){const n=await JV(e.mediaSource),{sourceId:i,audio:a}=await function(c){let d=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new we((h,m)=>{const g=document.createElement("div");g.innerText="share screen",g.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const _=document.createElement("div");_.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const v=document.createElement("div");v.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",v.setAttribute("style","height: 12%;");const y=document.createElement("div");y.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const b=document.createElement("div");b.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const O=document.createElement("button");O.innerHTML="cancel",O.setAttribute("style","width: 85px;"),O.onclick=()=>{document.body.removeChild(k);const j=new Error("NotAllowedError");j.name="NotAllowedError",m(j)};let I=d;const N=document.createElement("div");if(d){const j=document.createElement("input");j.setAttribute("type","checkbox");const G=document.createElement("span");j.setAttribute("style","margin-right: 6px;"),G.innerText="Share audio",j.checked=I,j.onchange=()=>{I=j.checked},N.appendChild(j),N.appendChild(G)}b.appendChild(N),b.appendChild(O),_.appendChild(v),_.appendChild(y),_.appendChild(b);const k=document.createElement("div");k.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),k.appendChild(g),k.appendChild(_),document.body.appendChild(k),c.map(j=>{if(j.id){const G=document.createElement("div");G.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let K=j.thumbnail;try{const{width:X}=K.getSize();X>1920&&(K=K.resize({width:1920}))}catch(X){throw X&&X.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),X}G.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+K.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+j.name.replace(/[\u00A0-\u9999<>\&]/g,function(X){return"&#"+X.charCodeAt(0)+";"})+"</span>",G.onclick=()=>{document.body.removeChild(k),h({sourceId:j.id,audio:I})},y.appendChild(G)}})})}(n,t);return await XV(i,e,a)}async function JV(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const n=oV();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new de(L.ELECTRON_IS_NULL);let i=null;try{var a;i=((a=n.desktopCapturer)===null||a===void 0?void 0:a.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{i=null}i&&i.then||(i=new we((c,d)=>{n.desktopCapturer.getSources({types:t},(h,m)=>{h?d(h):c(m)})}));try{return await i}catch(c){throw new de(L.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,c.toString())}}const iA=new Cr("safari");let QV=!1,$V=!1;async function Fs(e,t){let n=0,i=null;for(;n<2;)try{i=await hoe(e,t,n>0);break}catch(a){if(a instanceof de)throw R.error("[".concat(t,"] ").concat(a.toString())),a;const c=IS(a.name||a.code||a,a.message);if(c.code===L.MEDIA_OPTION_INVALID){R.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await pr(500);continue}throw R.error("[".concat(t,"] ").concat(c.toString())),c}if(!i)throw new de(L.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function hoe(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new de(L.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const i=vt(),a=new MediaStream;if(e.audioSource&&a.addTrack(e.audioSource),e.videoSource&&a.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return R.debug("Using Video Source/ Audio Source"),a;if(e.screen)if(oV())e.screen.sourceId?Qp(a,await XV(e.screen.sourceId,e.screen,!!e.screenAudio)):Qp(a,await uoe(e.screen,!!e.screenAudio));else if(zc()&&e.screen.extensionId&&e.screen.mandatory){if(!i.getStreamFromExtension)throw new de(L.NOT_SUPPORTED,"This browser does not support screen sharing");R.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const y=await(d=e.screen.extensionId,h=t,new we((b,O)=>{try{chrome.runtime.sendMessage(d,{getStream:!0},I=>{if(!I||!I.streamId)return R.error("[".concat(h,"] No response from Chrome Plugin. Plugin not installed properly"),I),void O(new de(L.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));b(I.streamId)})}catch(I){R.error("[".concat(h,"] AgoraRTC screensharing plugin is not accessible(").concat(d,")"),I.toString()),O(new de(L.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=y,Qp(a,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(i.getDisplayMedia){var c;e.screen.mediaSource&&BV(e.screen.mediaSource);const y={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(c=e.screen.displaySurface)!==null&&c!==void 0?c:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:b,surfaceSwitching:O,systemAudio:I,preferCurrentTab:N,windowAudio:k,monitorTypeSurfaces:j}=e.screen,G={selfBrowserSurface:b,surfaceSwitching:O,systemAudio:I,preferCurrentTab:N,windowAudio:k,monitorTypeSurfaces:j};!b&&delete G.selfBrowserSurface,!O&&delete G.surfaceSwitching,!I&&delete G.systemAudio,!N&&delete G.preferCurrentTab,!k&&delete G.windowAudio,!j&&delete G.monitorTypeSurfaces,R.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:y,audio:e.screenAudio,controls:G})),Qp(a,await navigator.mediaDevices.getDisplayMedia(hn({video:y,audio:e.screenAudio},G)))}else{if(!pn())throw R.error("[".concat(t,"] This browser does not support screenSharing")),new de(L.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&BV(e.screen.mediaSource);const y={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};R.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(y))),Qp(a,await navigator.mediaDevices.getUserMedia(y))}}var d,h;if(!e.video&&!e.audio)return a;let m={video:e.video,audio:e.audio},g=D("MEDIA_DEVICE_CONSTRAINTS");if(g)try{typeof g=="string"&&(g=JSON.parse(g)),m=PI(m,g)}catch{}R.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(m)),Pt();let _,v=null;(wr()||ni()||hS())&&(v=await iA.lock());try{_=await navigator.mediaDevices.getUserMedia(m)}catch(y){throw v&&v(),y}return m.audio&&(QV=!0),m.video&&($V=!0),Qp(a,_),v&&v(),a}function IS(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new de(L.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new de(L.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new de(L.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new de(L.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new de(L.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new de(L.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return R.error("getUserMedia unexpected error",e),new de(L.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function Qp(e,t){const n=e.getVideoTracks()[0],i=e.getAudioTracks()[0],a=t.getVideoTracks()[0],c=t.getAudioTracks()[0];c&&(i&&e.removeTrack(i),e.addTrack(c)),a&&(n&&e.removeTrack(n),e.addTrack(a))}const Bs=new class extends Sn{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Gu.STATE_CHANGE,e),this._state=e)}constructor(){super(),oe(this,"_state",Gg.IDLE),oe(this,"isAccessMicrophonePermission",!1),oe(this,"isAccessCameraPermission",!1),oe(this,"lastAccessMicrophonePermission",!1),oe(this,"lastAccessCameraPermission",!1),oe(this,"checkdeviceMatched",!1),oe(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(D("ENUMERATE_DEVICES_INTERVAL")||(Dg()||uS()===hr.HARMONY_OS)&&nc())&&this.updateDevicesInfo()},D("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>R.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new de(L.NOT_SUPPORTED,"enumerateDevices() not supported.");const i=await navigator.mediaDevices.enumerateDevices(),a=this.checkMediaDeviceInfoIsOk(i);let c=!this.isAccessMicrophonePermission&&e,d=!this.isAccessCameraPermission&&t;a.audio&&(c=!1),a.video&&(d=!1);let h=null,m=null,g=null;if(!n&&(c||d)){if(iA.isLocked&&(R.debug("[device manager] wait GUM lock"),(await iA.lock())(),R.debug("[device manager] GUM unlock")),QV&&(c=!1,this.isAccessMicrophonePermission=!0),$V&&(d=!1,this.isAccessCameraPermission=!0),R.debug("[device manager] check media device permissions",e,t,c,d),c&&d){try{g=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(_){const v=IS(_.name||_.code||_,_.message);if(v.code===L.PERMISSION_DENIED)throw v;R.warning("getUserMedia failed in getDevices",v)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(c){try{h=await navigator.mediaDevices.getUserMedia({audio:e})}catch(_){const v=IS(_.name||_.code||_,_.message);if(v.code===L.PERMISSION_DENIED)throw v;R.warning("getUserMedia failed in getDevices",v)}this.isAccessMicrophonePermission=!0}else if(d){try{m=await navigator.mediaDevices.getUserMedia({video:t})}catch(_){const v=IS(_.name||_.code||_,_.message);if(v.code===L.PERMISSION_DENIED)throw v;R.warning("getUserMedia failed in getDevices",v)}this.isAccessCameraPermission=!0}R.debug("[device manager] mic permission",e,"cam permission",t)}try{const _=await navigator.mediaDevices.enumerateDevices();return h&&h.getTracks().forEach(v=>v.stop()),m&&m.getTracks().forEach(v=>v.stop()),g&&g.getTracks().forEach(v=>v.stop()),h=null,m=null,g=null,_}catch(_){return h&&h.getTracks().forEach(v=>v.stop()),m&&m.getTracks().forEach(v=>v.stop()),g&&g.getTracks().forEach(v=>v.stop()),h=null,m=null,g=null,new de(L.ENUMERATE_DEVICES_FAILED,_.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===e);if(!t)throw new de(L.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Gg.INITING;try{await this.updateDevicesInfo(),this.state=Gg.INITEND}catch(e){throw this.state=Gg.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")?(R.warning("Device Detection functionality cannot start properly.",e.toString()),e):new de(L.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.")}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const a=e.find(d=>d.kind==="audioinput"&&d.deviceId==="default"),c=e.find(d=>d.kind==="audiooutput"&&d.deviceId==="default");a&&c?c.groupId===a.groupId?R.debug("[device-check] default input ".concat(a.label," and output ").concat(c.label," is the same group")):R.debug("[device-check] default input ".concat(a.label," and output ").concat(c.label," is not the same group")):R.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(a=>{if(!a.deviceId)return;const c=this.deviceInfoMap.get("".concat(a.kind,"_").concat(a.deviceId));if((c?c.state:"INACTIVE")!=="ACTIVE"){const d={initAt:t,updateAt:t,device:a,state:"ACTIVE"};this.deviceInfoMap.set("".concat(a.kind,"_").concat(a.deviceId),d),n.push(d)}c&&(c.updateAt=t)}),this.deviceInfoMap.forEach((a,c)=>{a.state==="ACTIVE"&&a.updateAt!==t&&(a.state="INACTIVE",n.push(a))}),this.state!==Gg.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(a=>{switch(a.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Gu.RECORDING_DEVICE_CHANGED,a);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Gu.CAMERA_DEVICE_CHANGED,a);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Gu.PLAYOUT_DEVICE_CHANGED,a)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(a=>a.kind==="audioinput"),n=e.filter(a=>a.kind==="videoinput"),i={audio:!1,video:!1};for(const a of t)if(a.label&&a.deviceId){i.audio=!0;break}for(const a of n)if(a.label&&a.deviceId){i.video=!0;break}return i}};let sA=!1;const ji=new class extends Sn{constructor(){super(...arguments),oe(this,"onAutoplayFailed",void 0),oe(this,"onAudioAutoplayFailed",void 0)}};function ZV(){if(sA)return D("FLS_AUTOPLAY_EMITS")?(ji.onAutoplayFailed&&ji.onAutoplayFailed(),ji.emit("autoplay-failed")):void 0;{const e=t=>{t.preventDefault(),sA=!1,kg()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};sA=!0,kg()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),R.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),ji.onAutoplayFailed?ji.onAutoplayFailed():ji.onAudioAutoplayFailed?R.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):R.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),ji.emit("autoplay-failed")}}function eF(e,t,n,i){if(!e)return;const a=Le.getBaseInfoBySessionId(e);if(!a)return;const c=a.info,d=Date.now(),h=hn(hn({},c),{},{vid:c.vid===void 0?0:Number(c.vid),lts:d,elapse:d-a.startTime,cbRegistered:ji.onAutoplayFailed||ji.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:i,extend:void 0});Le.send({type:En.AUTOPLAY_FAILED,data:h},!0)}const poe=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],pi=new class{constructor(){oe(this,"onAutoplayFailed",void 0),oe(this,"elementMap",new Map),oe(this,"elementStateMap",new Map),oe(this,"elementsNeedToResume",[]),oe(this,"sinkIdMap",new Map),oe(this,"autoResumeAfterInterruption",e=>we.all(Array.from(this.elementMap.entries()).map(async t=>{let[n,i]=t;const a=this.elementStateMap.get(n),c=i.srcObject.getAudioTracks()[0],d=c&&c.readyState;if(R.debug("resume after interrupted, ele: ".concat(a," audio: ").concat(d," ").concat(e)),d==="live"){if(e)return i.pause(),i.play();if(en.curState==="running")return Up()?(i.pause(),i.play()):a&&a==="paused"?i.play():void 0}}))),oe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const i=n.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(R.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),en.on(Mr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),en.on(Mr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),en.on(Mr.STATE_CHANGE,()=>{ni()&&en.prevState==="suspended"&&en.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(i){throw new de(L.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(e,t,n,i){if(this.elementMap.has(t))return;const a=document.createElement("audio");a.autoplay=!0,a.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,a),this.elementMap.set(t,a),this.elementStateMap.set(t,Yr.INIT),this.setVolume(t,n);const c=this.sinkIdMap.get(t);if(c)try{a.setSinkId(c).catch(h=>{R.warning("[".concat(t,"] set sink id failed"),h.toString())})}catch(h){R.warning("[".concat(t,"] set sink id failed"),h.toString())}const d=a.play();d&&d.then&&d.catch(h=>{i&&eF(i,"audio",h.message,t),R.warning("audio element play warning",h.toString()),this.elementMap.has(t)&&h.name==="NotAllowedError"&&(R.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(a),mS(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),ZV()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}getVolume(e){const t=this.elementMap.get(e);return t?t.volume:0}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){poe.forEach(n=>{t.addEventListener(n,i=>{const a=this.elementStateMap.get(e),c=i.type==="pause"?"paused":i.type;if(R.debug("[".concat(e,"] audio-element-status change ").concat(a," => ").concat(c)),i.type==="error"){const d=t==null?void 0:t.error;d&&R.error("[".concat(e,"] media error, code: ").concat(d.code,", message: ").concat(d.message))}this.elementStateMap.set(e,c)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{R.debug("Auto resume audio element success")}).catch(n=>{R.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new we(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{kg()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Pn(){return function(e,t,n){const i=n.value;return typeof i=="function"&&(n.value=function(){this._isClosed&&new de(L.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",R);for(var a=arguments.length,c=new Array(a),d=0;d<a;d++)c[d]=arguments[d];const h=i.apply(this,c);return h instanceof we?new we((m,g)=>{h.then(m).catch(g)}):h}),n}}class tF extends Sn{constructor(t){super(),oe(this,"name","VideoProcessorDestination"),oe(this,"ID","0"),oe(this,"_source",void 0),oe(this,"videoContext",void 0),oe(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new de(L.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new de(L.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(Ii.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Ii.ON_TRACK,void 0)}}class nF extends Sn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),oe(this,"constraintsMap",new Map),oe(this,"statsRegistry",[]),oe(this,"usageRegistry",[]),oe(this,"trackId",void 0),oe(this,"direction",void 0),oe(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await Zn(this,js.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var i;return R.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),cn(this,js.REQUEST_UPDATE_CONSTRAINTS,Array.from(Es(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return R.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),cn(this,js.REQUEST_UPDATE_CONSTRAINTS,Array.from(Es(n=this.constraintsMap).call(n)))}registerStats(t,n,i){this.statsRegistry.find(a=>a.processorID===t.ID&&a.processorName===t.name&&a.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:i})}unregisterStats(t,n){const i=this.statsRegistry.findIndex(a=>a.processorID===t.ID&&a.processorName===t.name&&a.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:i,type:a,cb:c}of this.statsRegistry)try{const d=c();t.push({processorID:n,processorName:i,type:a,stats:d})}catch(d){R.error(new de(L.UNEXPECTED_ERROR,d.message))}return t}registerUsage(t,n){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof we&&(i=await i),t.push(hn(hn({},i),{},{direction:this.direction}))}catch(i){R.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class rF extends Sn{constructor(t){super(),oe(this,"name","AudioProcessorDestination"),oe(this,"ID","0"),oe(this,"inputTrack",void 0),oe(this,"inputNode",void 0),oe(this,"audioProcessorContext",void 0),oe(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new de(L.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new de(L.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Ii.ON_TRACK,void 0),this.emit(Ii.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(Ii.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(Ii.ON_NODE,this.inputNode))}}class iF extends Sn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,i){super(),oe(this,"constraintsMap",new Map),oe(this,"statsRegistry",[]),oe(this,"audioContext",void 0),oe(this,"trackId",void 0),oe(this,"direction",void 0),oe(this,"usageRegistry",[]),oe(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=i}async getConstraints(){return Zn(this,js.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var i;return R.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),cn(this,js.REQUEST_UPDATE_CONSTRAINTS,Array.from(Es(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),cn(this,js.REQUEST_UPDATE_CONSTRAINTS,Array.from(Es(n=this.constraintsMap).call(n)))}registerStats(t,n,i){this.statsRegistry.find(a=>a.processorID===t.ID&&a.processorName===t.name&&a.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:i})}unregisterStats(t,n){const i=this.statsRegistry.findIndex(a=>a.processorID===t.ID&&a.processorName===t.name&&a.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:i,type:a,cb:c}of this.statsRegistry)try{const d=c();t.push({processorID:n,processorName:i,type:a,stats:d})}catch(d){R.error(new de(L.UNEXPECTED_ERROR,d.message))}return t}registerUsage(t,n){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof we&&(i=await i),t.push(hn(hn({},i),{},{direction:this.direction}))}catch(i){R.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class oA extends Sn{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),oe(this,"context",void 0),oe(this,"processSourceNode",void 0),oe(this,"outputTrack",void 0),oe(this,"processedNode",void 0),oe(this,"clonedTrack",void 0),oe(this,"outputNode",void 0),this.outputNode=new moe}setVolume(){}createOutputTrack(){throw new de(L.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class moe{disconnect(){}connect(){}}function sF(e){return new we((t,n)=>{let i=!1;const a=document.createElement("video");a.setAttribute("autoplay",""),a.setAttribute("muted",""),a.muted=!0,a.autoplay=!0,a.setAttribute("playsinline",""),a.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(a);const c=ni()?"canplay":"playing";a.addEventListener(c,()=>{const d=a.videoWidth,h=a.videoHeight;!d&&pn()||(i=!0,a.srcObject=null,a.remove(),t([d,h]))}),a.srcObject=new MediaStream([e]),a.play().catch(Ug),setTimeout(()=>{i||(a.srcObject=null,a.remove(),t([a.videoWidth,a.videoHeight]))},4e3)})}function AS(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=Lo(e.encoderConfig);return n.width!=null&&(t.width=n.width),n.height!=null&&(t.height=n.height),!$j()&&n.frameRate&&(t.frameRate=n.frameRate),zj()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),pn()&&(t.frameRate={ideal:30,max:30}),t}function oF(e){const t={};return $j()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,zc()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function aF(e){const t=oF(e);if(e.encoderConfig){const n=wS(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),Dg()&&(t.sampleRate=void 0),t}const cF=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:i,height:a}=e.getMediaStreamTrackSettings();let{frameRate:c=n,width:d=i,height:h=a}=t;if(!c||!d||!h)return;d=Fp(d),h=Fp(h),c=Fp(c);const{max:m,min:g}=function(b,O,I){const N=200*Math.pow(I/15,.6)*Math.pow(b*O/640/360,.75);return{min:Math.floor(N),max:Math.floor(4*N)}}(d,h,c),{bitrateMax:_,bitrateMin:v}=t||{};_||R.debug("calculate bitrate: [w: ".concat(d,", h: ").concat(h,", fps: ").concat(c,"] => [brMax: ").concat(_,", brMin: ").concat(v,"]"));const{maxFramerate:y}=D("ENCODER_CONFIG_LIMIT");return y&&typeof y=="number"&&(c=Math.min(c,y)),{frameRate:c,bitrateMax:_||m,bitrateMin:v||g,scaleResolutionDownBy:1,scale:0}},lF=async(e,t,n)=>await(async(i,a,c)=>{const d=function(g){const _=[];for(let v=0;v<g.length;v+=2)_.push(parseInt(g.slice(v,v+2),16));return Uint8Array.from(_)}(EV(""+a+c)).slice(0,16),h=d.slice(0,12),m=await window.crypto.subtle.importKey("raw",d,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:h},m,i))})(e.buffer,t,n),aA=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new we((n,i)=>{t.toBlob(async a=>{if(t.remove(),a){const c=await dF(a);n({buffer:c,width:t.width,height:t.height})}else i(new de(L.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},dF=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var uF,hF,pF,mF,fF,gF,_F,EF,vF,yF,SF,TF,bF,RF,wF,CF,IF,AF,wn,NF,xF,OF,PF,DF,kF,sc,LF,MF,UF,jF,VF,FF,BF,GF,WF,zF,HF,KF,qF,Hr;let Dn=(uF=He({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),hF=He({argsMap:(e,t)=>[e.getTrackId(),t]}),pF=Pn(),mF=Bp("LocalAudioTrack","_enabledMutex"),fF=He({argsMap:(e,t)=>[e.getTrackId(),t]}),gF=Pn(),_F=Bp("LocalAudioTrack","_enabledMutex"),EF=He({argsMap:(e,t)=>[e.getTrackId(),t]}),vF=Pn(),yF=Pn(),SF=Pn(),TF=He({argsMap:e=>[e.getTrackId()]}),bF=Pn(),RF=He({argsMap:e=>[e.getTrackId()]}),wF=Pn(),CF=He({argsMap:e=>[e.getTrackId()]}),IF=He({argsMap:(e,t)=>[e.getTrackId(),t.name]}),AF=He({argsMap:e=>[e.getTrackId()]}),wt((wn=class extends Xp{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?pi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,i){super(e,n),oe(this,"trackMediaType",Yp.AUDIO),oe(this,"_encoderConfig",void 0),oe(this,"_trackSource",void 0),oe(this,"metadata",[]),oe(this,"_enabled",!0),oe(this,"_volume",100),oe(this,"_useAudioElement",!0),oe(this,"_bypassWebAudio",!1),oe(this,"processor",void 0),oe(this,"_processorContext",void 0),oe(this,"_processorDestination",void 0),oe(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!i,this._trackSource=new oA,D("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),D("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),wr()&&!Vs?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){nn(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&pi.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void R.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,cn(this,Me.NEED_REPLACE_TRACK,this).then(()=>{R.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{R.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!MV())throw new de(L.NOT_SUPPORTED,"your browser does not support setting the audio output device");await pi.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await cn(this,Me.NEED_ENABLE_TRACK,this),R.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(i){throw n||(this._enabled=!1),R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await cn(this,Me.NEED_DISABLE_TRACK,this)}catch(i){throw n||(this._enabled=!0),R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,R.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await cn(this,Me.NEED_MUTE_TRACK,this):await cn(this,Me.NEED_UNMUTE_TRACK,this))}getStats(){return Zl(()=>{R.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Ss(this,Me.GET_STATS)||hn({},QI)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Us.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Us.ON_AUDIO_BUFFER),this._source.on(Us.ON_AUDIO_BUFFER,n=>e(n))}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] start audio playback in element")),pi.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?pi.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&pi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await cn(this,Me.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return we.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new de(L.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new de(L.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(Ii.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await cn(this,Me.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await cn(this,Me.NEED_REPLACE_TRACK,this))}),e.on(Ii.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(Ii.ON_TRACK),e.removeAllListeners(Ii.ON_NODE)}bindProcessorContextEvents(e){e.on(js.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(js.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof oA&&(this._trackSource=new rA(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new iF(this._source.context,this.getTrackId(),"local"),t=new rF(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(Us.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(pi.stop(this.getTrackId()),this._source.play()),cn(this,Me.NEED_REPLACE_MIXING_TRACK,this).then(()=>{R.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{R.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[uF],Object.getOwnPropertyDescriptor(wn.prototype,"setVolume"),wn.prototype),wt(wn.prototype,"setPlaybackDevice",[hF,pF],Object.getOwnPropertyDescriptor(wn.prototype,"setPlaybackDevice"),wn.prototype),wt(wn.prototype,"setEnabled",[mF,fF,gF],Object.getOwnPropertyDescriptor(wn.prototype,"setEnabled"),wn.prototype),wt(wn.prototype,"setMuted",[_F,EF,vF],Object.getOwnPropertyDescriptor(wn.prototype,"setMuted"),wn.prototype),wt(wn.prototype,"getStats",[yF],Object.getOwnPropertyDescriptor(wn.prototype,"getStats"),wn.prototype),wt(wn.prototype,"setAudioFrameCallback",[SF],Object.getOwnPropertyDescriptor(wn.prototype,"setAudioFrameCallback"),wn.prototype),wt(wn.prototype,"play",[TF,bF],Object.getOwnPropertyDescriptor(wn.prototype,"play"),wn.prototype),wt(wn.prototype,"stop",[RF,wF],Object.getOwnPropertyDescriptor(wn.prototype,"stop"),wn.prototype),wt(wn.prototype,"close",[CF],Object.getOwnPropertyDescriptor(wn.prototype,"close"),wn.prototype),wt(wn.prototype,"pipe",[IF],Object.getOwnPropertyDescriptor(wn.prototype,"pipe"),wn.prototype),wt(wn.prototype,"unpipe",[AF],Object.getOwnPropertyDescriptor(wn.prototype,"unpipe"),wn.prototype),wn),Wg=(NF=He({argsMap:(e,t)=>[e.getTrackId(),t]}),xF=Pn(),OF=Bp("MicrophoneAudioTrack","_enabledMutex"),PF=He({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),DF=Pn(),kF=He({argsMap:e=>[e.getTrackId()]}),wt((sc=class extends Dn{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,i){super(e,t.encoderConfig?wS(t.encoderConfig):{},i,D("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),oe(this,"_config",void 0),oe(this,"_deviceName","default"),oe(this,"_constraints",void 0),oe(this,"_originalConstraints",void 0),oe(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(Up()||RI())&&en.bindInterruptDetectorTrack(this)}async setDevice(e){if(R.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await Bs.getDeviceById(e),n={};n.audio=hn({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let i=null;try{i=await Fs(n,this.getTrackId())}catch(a){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),a.toString()),i=await Fs({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),a}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await Bs.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}R.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return R.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),e),D("AUTO_RESET_AUDIO_ROUTE")&&(ni()||xo())){const d=navigator.audioSession;d&&(e||(d.type="playback"),d.type="auto")}if(!e){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(i=this._source.clonedTrack)===null||i===void 0||i.stop(),n||(this._enabled=!1);try{await cn(this,Me.NEED_DISABLE_TRACK,this)}catch(d){throw R.error("[".concat(this.getTrackId(),"] setEnabled false failed"),d.toString()),d}return}const a=hn({},this._constraints),c=Bs.searchDeviceIdByName(this._deviceName);c&&!a.deviceId&&(a.deviceId=c);try{n||(this._enabled=!0);const d=await Fs({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!1),await cn(this,Me.NEED_ENABLE_TRACK,this)}catch(d){throw n||(this._enabled=!1),R.error("[".concat(this.getTrackId(),"] setEnabled true failed"),d.toString()),d}R.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Up()||RI())&&en.unbindInterruptDetectorTrack(this),Fu.some(e=>function(t){return"__className__"in t&&t.__className__==="MicrophoneAudioTrack"}(e))||eA&&eA()&&(Le.reportApiInvoke(null,{name:"BG_AUDIO_TAG_RESTART",options:{},tag:rn.TRACER}).onSuccess(),R.debug("restart background audio tag success"))}onTrackEnded(){if((ni()||xo())&&this._enabled&&!this._isClosed&&en.duringInterruption){const e=async()=>{en.off(Mr.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};en.on(Mr.IOS_INTERRUPTION_END,e)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(qp.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=Bs.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const i=await Fs({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(js.REQUEST_UPDATE_CONSTRAINTS,async(t,n,i)=>{try{const a=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(a),n()}catch(a){i(a)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(js.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[NF,xF],Object.getOwnPropertyDescriptor(sc.prototype,"setDevice"),sc.prototype),wt(sc.prototype,"setEnabled",[OF,PF,DF],Object.getOwnPropertyDescriptor(sc.prototype,"setEnabled"),sc.prototype),wt(sc.prototype,"close",[kF],Object.getOwnPropertyDescriptor(sc.prototype,"close"),sc.prototype),sc),foe=(LF=He({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),MF=Pn(),UF=He({argsMap:e=>[e.getTrackId()]}),jF=Pn(),VF=He({argsMap:e=>[e.getTrackId()]}),FF=Pn(),BF=He({argsMap:e=>[e.getTrackId()]}),GF=Pn(),WF=He({argsMap:e=>[e.getTrackId()]}),zF=Pn(),HF=He({argsMap:e=>[e.getTrackId()]}),KF=He({argsMap:e=>[e.getTrackId()]}),qF=Pn(),wt((Hr=class extends Dn{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,i){super(t.createOutputTrack(),n,i),oe(this,"source",void 0),oe(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(Us.AUDIO_SOURCE_STATE_CHANGE,a=>{this.safeEmit(qp.SOURCE_STATE_CHANGE,a)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){nn(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[LF,MF],Object.getOwnPropertyDescriptor(Hr.prototype,"startProcessAudioBuffer"),Hr.prototype),wt(Hr.prototype,"pauseProcessAudioBuffer",[UF,jF],Object.getOwnPropertyDescriptor(Hr.prototype,"pauseProcessAudioBuffer"),Hr.prototype),wt(Hr.prototype,"seekAudioBuffer",[VF,FF],Object.getOwnPropertyDescriptor(Hr.prototype,"seekAudioBuffer"),Hr.prototype),wt(Hr.prototype,"resumeProcessAudioBuffer",[BF,GF],Object.getOwnPropertyDescriptor(Hr.prototype,"resumeProcessAudioBuffer"),Hr.prototype),wt(Hr.prototype,"stopProcessAudioBuffer",[WF,zF],Object.getOwnPropertyDescriptor(Hr.prototype,"stopProcessAudioBuffer"),Hr.prototype),wt(Hr.prototype,"close",[HF],Object.getOwnPropertyDescriptor(Hr.prototype,"close"),Hr.prototype),wt(Hr.prototype,"setAudioBufferPlaybackSpeed",[KF,qF],Object.getOwnPropertyDescriptor(Hr.prototype,"setAudioBufferPlaybackSpeed"),Hr.prototype),Hr);class sr extends Dn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=Jp().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,Wt(8,"track-mix-")),oe(this,"trackList",void 0),oe(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(R.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):R.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){R.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}pS(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(n=>{n instanceof sr?n.emit(Bu.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)}))}}class goe extends YV{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(Us.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),oe(this,"audioBuffer",void 0),oe(this,"sourceNode",void 0),oe(this,"startPlayTime",0),oe(this,"startPlayOffset",0),oe(this,"pausePlayTime",0),oe(this,"options",void 0),oe(this,"currentLoopCount",0),oe(this,"currentPlaybackSpeed",100),oe(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):R.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const YF=new Map;function XF(e,t){if(e.length===0||t.length===0)return 1/0;const n=kI(e),i=kI(t);return Math.floor(i/n)}class cA{get rendFrameRate(){const t=Math.max(1,XF(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:Yr.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(R.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var n;t!==this._videoState&&(this._videoState=t,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(t){oe(this,"trackId",void 0),oe(this,"config",void 0),oe(this,"onFirstVideoFrameDecoded",void 0),oe(this,"onFirstVideoFrameRender",void 0),oe(this,"onVideoBufferReady",void 0),oe(this,"onVideoStateChanged",void 0),oe(this,"freezeTimeCounterList",[]),oe(this,"renderFreezeAccTime",0),oe(this,"renderFreezeAccTime2",0),oe(this,"isKeepLastFrame",!1),oe(this,"isDestroyed",!1),oe(this,"timeUpdatedCount",0),oe(this,"freezeTime",0),oe(this,"playbackTime",0),oe(this,"lastTimeUpdatedTime",0),oe(this,"autoplayFailed",!1),oe(this,"videoTrack",void 0),oe(this,"videoElement",void 0),oe(this,"cacheVideoElement",void 0),oe(this,"cancelRVFId",void 0),oe(this,"internal",!1),oe(this,"_render_interframe_delays",[]),oe(this,"_render_interframe_delays_sizes",[]),oe(this,"_videoState",ic.VideoStateStopped),oe(this,"videoElementCheckInterval",void 0),oe(this,"videoElementFreezeTimeout",void 0),oe(this,"_videoElementStatus",Yr.NONE),oe(this,"_isInPage",!0),oe(this,"isGettingVideoDimensions",!1),oe(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return R.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),oe(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&en.curState==="running"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Gj())),Jj()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),oe(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":n.type==="play"&&R.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=Yr.PLAYING;break;case"loadeddata":if(this.videoState=ic.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Yr.CANPLAY;break;case"stalled":this.videoElementStatus=Yr.STALLED;break;case"suspend":this.videoElementStatus=Yr.SUSPEND;break;case"pause":this.videoElementStatus=Yr.PAUSED,ni()||xo()||wr()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Yr.WAITING;break;case"abort":this.videoElementStatus=Yr.ABORT;break;case"ended":this.videoElementStatus=Yr.ENDED;break;case"emptied":this.videoElementStatus=Yr.EMPTIED;break;case"error":{const i=this.videoElement.error;i&&(this.videoElementStatus=Yr.ERROR,R.error("[".concat(this.trackId,"] media error: ").concat(i.message," (").concat(i.code,")")));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.onVideoBufferReady&&this.timeUpdatedCount>D("BUFFER_READY_FRAMES")&&this.onVideoBufferReady(),this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const a=i-this.lastTimeUpdatedTime,c=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,Ts.lastVisibleTime<Ts.lastHiddenTime||c<Ts.lastHiddenTime||c<Ts.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(a>D("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=a),this.playbackTime+=a;this.playbackTime>=6e3;){this.playbackTime-=6e3;const d=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(d),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),oe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Gj())),Jj()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),en.on(Mr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),en.on(Mr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch(a=>{t&&eF(t,"video",a.message,this.trackId),a.name==="NotAllowedError"?(R.warning("detected video element autoplay failed",a),this.autoplayFailed=!0,this.handleAutoPlayFailed()):R.warning("[".concat(this.trackId,"] play warning: "),a)});const i=Pt();if((i.name==="Safari"&&Number(i.version)===15||Up())&&n&&n.then){const a=()=>{this.config.mirror&&!this.config.noStyle&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(a).catch(a)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return R.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height);return t.remove(),i}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const a=i.getContext("2d");return a?(a.drawImage(this.videoElement,0,0,i.width,i.height),new we((c,d)=>{i.toBlob(async h=>{if(i.remove(),h){const m=await dF(h);c({buffer:m,width:i.width,height:i.height})}else d(new de(L.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,n<0?.1:n>1?1:n)})):await aA(t)}destroy(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.isDestroyed=!0,en.off(Mr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),en.off(Mr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),t?this.videoElement.pause():this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=ic.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Yr.INIT,!this.videoElementCheckInterval&&(JF.forEach(c=>{this.videoElement.addEventListener(c,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(c){return c!==document.body&&document.body.contains(c)}(this.videoElement)},1e3),D("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let c;const d=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",d),this.videoElementFreezeTimeout=window.setTimeout(h,D("VIDEO_FREEZE_DURATION")))},h=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===ic.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=ic.VideoStateFrozen:document.addEventListener("visibilitychange",d))},m=(g,_)=>{if(this.videoElementStatus===Yr.PLAYING){if(c){const b=_.presentationTime-c.presentationTime,O=_.presentedFrames-c.presentedFrames;this._render_interframe_delays_sizes.push(O),this._render_interframe_delays.push(b);const I=kI(this._render_interframe_delays_sizes),N=I-this._render_interframe_delays_sizes[0];if(I>30&&N>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===ic.VideoStateStarting&&(this.videoState=ic.VideoStateDecoding),this.videoState===ic.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(h,D("VIDEO_FREEZE_DURATION"))),b<D("VIDEO_FREEZE_DURATION")&&this.videoState===ic.VideoStateFrozen&&(this.videoState=ic.VideoStateDecoding),b>D("VIDEO_FREEZE_DURATION")&&Ts.lastVisibleTime>=Ts.lastHiddenTime&&c.timestamp>Ts.lastVisibleTime&&c.timestamp>Ts.lastHiddenTime){const k=Math.min(66,XF(this._render_interframe_delays_sizes,this._render_interframe_delays)),j=Math.max(0,b-(O-1)*k);this.renderFreezeAccTime2+=j>k?j:0,this.renderFreezeAccTime+=b}}c=hn(hn({},_),{},{timestamp:g})}else this.isSkipCalcRenderFreezeTime()&&(c=hn(hn({},_),{},{timestamp:g}));var v,y;D("ENABLE_VIDEO_FRAME_CALLBACK")&&(this.cancelRVFId=(v=(y=this.videoElement).requestVideoFrameCallback)===null||v===void 0?void 0:v.call(y,m))};this.cancelRVFId=(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0?void 0:t.call(n,m)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Dg()&&!D("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const i=Pt();this.config.noStyle||(i.name==="Safari"&&Number(i.version)===15||Up()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover"),this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,pn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,pn()&&this.videoElement.load());const a=this.videoElement.play();a!==void 0&&a.catch(c=>{R.debug("[".concat(this.trackId,"] playback interrupted"),c.toString())})}resetVideoElement(){var t,n;JF.forEach(i=>{this.videoElement&&this.videoElement.removeEventListener(i,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.cancelRVFId&&this.videoElement&&((t=(n=this.videoElement).cancelVideoFrameCallback)===null||t===void 0||t.call(n,this.cancelRVFId),this.cancelRVFId=void 0),this.videoElementStatus=Yr.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===Yr.DESTROYED||this.internal}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{R.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{R.error(i)}),this.autoplayFailed=!1,kg()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};kg()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),ZV()}}const JF=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class NS extends cA{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),oe(this,"container",void 0),oe(this,"slot",void 0),this.slot=t.element,this.internal=n,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;var i;!this.internal||this.slot?(n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()):(this.slot=n,n&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(i=this.slot)===null||i===void 0||i.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,i):await aA(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",D("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var QF,$F,ZF,e4,t4,n4,r4,i4,s4,o4,a4,c4,l4,d4,u4,h4,p4,m4,f4,g4,_4,E4,v4,y4,S4,T4,b4,R4,yt,w4,C4,I4,A4,N4,x4,O4,P4,Gs;let sn=(QF=He({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),$F=Pn(),ZF=He({argsMap:e=>[e.getTrackId()]}),e4=Bp("LocalVideoTrack","_enabledMutex"),t4=He({argsMap:(e,t)=>[e.getTrackId(),t]}),n4=Pn(),r4=Bp("LocalVideoTrack","_enabledMutex"),i4=He({argsMap:(e,t)=>[e.getTrackId(),t]}),s4=Pn(),o4=He({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),a4=Pn(),c4=He({argsMap:(e,t)=>[e.getTrackId(),t]}),l4=Pn(),d4=Pn(),u4=He({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),h4=Pn(),p4=Pn(),m4=Pn(),f4=He({argsMap:e=>[e.getTrackId()]}),g4=Pn(),_4=Pn(),E4=Pn(),v4=Pn(),y4=Pn(),S4=He({argsMap:(e,t)=>[e.getTrackId(),t.name]}),T4=He({argsMap:e=>[e.getTrackId()]}),b4=He({argsMap:e=>[e.getTrackId()]}),R4=He({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),yt=class fq extends Xp{get videoHeight(){if(wr()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(wr()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Yr.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,i,a,c,d){if(super(t,c),oe(this,"trackMediaType",Yp.VIDEO),oe(this,"_player",void 0),oe(this,"isUseScaleResolutionDownBy",!1),oe(this,"_videoVisibleTimer",null),oe(this,"_previousVideoVisibleStatus",void 0),oe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),oe(this,"_encoderConfig",void 0),oe(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),oe(this,"_optimizationMode",void 0),oe(this,"_saveEncodeBitrateRatio",1),oe(this,"_videoHeight",void 0),oe(this,"_videoWidth",void 0),oe(this,"_forceBitrateLimit",void 0),oe(this,"_enabled",!0),oe(this,"_processorDestination",void 0),oe(this,"_processorContext",void 0),wr()){const{width:h,height:m}=t.getSettings();this._videoWidth=h,this._videoHeight=m}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=i,this._optimizationMode=a,this._hints=d||[],n&&this._hints.indexOf(Bt.CUSTOM_TRACK)!==-1?this._encoderConfig=mn(n):this._encoderConfig=n,this._hints.indexOf(Bt.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(SI(Mt.CHROME,115)&&uS().indexOf("Windows")!==-1){const h=function(m,g){if("VideoFrame"in window&&"TransformStream"in window&&vt().supportWebRTCInsertableStream){const _=new MediaStreamTrackProcessor(m),v=new MediaStreamTrackGenerator({kind:"video"});let y,b,O=Date.now();const I=()=>{N&&(clearInterval(N),N=void 0),y&&(y.close(),y=void 0),m.stop(),b=void 0,v.removeEventListener("ended",I)};let N=window.setInterval(()=>{if(b&&y&&Date.now()-O>1e3)try{v.readyState==="live"?b.enqueue(y.clone()):I()}catch{I()}},1e3);const k=new TransformStream({transform:(j,G)=>{v.readyState==="live"?(b=G,O=Date.now(),y===void 0?(y=j,G.enqueue(j.clone())):(G.enqueue(y),y=j)):j.close()}});return v.addEventListener("ended",I),_.readable.pipeThrough(k).pipeTo(v.writable),v}}(t);h&&(R.info("local screen video track begin to inject frame"),this._mediaStreamTrack=h)}n&&this._hints.indexOf(Bt.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new nF(this.getTrackId(),"local"),this._processorDestination=new tF(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const a=document.getElementById(t);a?t=a:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=hn(hn(hn({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(i):(t instanceof HTMLVideoElement?this._player=new cA(i):this._player=new NS(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const a=this.getVideoElementVisibleStatus();this.safeEmit(qp.VIDEO_ELEMENT_VISIBLE_STATUS,a)}catch{}},D("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await cn(this,Me.NEED_DISABLE_TRACK,this)}catch(i){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return n||(this._enabled=!1),void R.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await cn(this,Me.NEED_ENABLE_TRACK,this)}catch(i){throw R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,R.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await cn(this,Me.NEED_MUTE_TRACK,this):await cn(this,Me.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),R.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await cn(this,Me.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(R)}}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new de(L.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=Lo(t),D("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const i=AS({encoderConfig:t});(wr()||ni()||xo())&&(i.deviceId=void 0),R.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(a){const c=new de(L.UNEXPECTED_ERROR,a.toString());throw R.error("[".concat(this.getTrackId(),"] applyConstraints error"),c.toString()),c}}this._encoderConfig=t,this._hints.indexOf(Bt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await cn(this,Me.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(R)}}getStats(){return Zl(()=>{R.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Ss(this,Me.GET_STATS)||hn({},$I)}async setBeautyEffect(t){R.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await aA(t)}async findClosestProfile(){const{width:t,height:n,frameRate:i}=this.getMediaStreamTrackSettings(),{width:a,height:c,frameRate:d}=this._encoderConfig||{},h=Fp(this._videoWidth||t||a||0),m=Fp(this._videoHeight||n||c||0),g=function(_,v,y){if(!Array.isArray(D("VIDEO_ENCODER_CONFIG_LIST"))||D("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const b=Math.min(_,v);return!(b>=480)&&hn(hn({},D("VIDEO_ENCODER_CONFIG_LIST").find(O=>O.height>b)),{},{frameRate:y})}(h,m,Fp(i||d||15));if(g)return R.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(h,"x").concat(m," => ").concat(JSON.stringify(g))),this.setEncoderConfiguration(g)}async setBitrateLimit(t){R.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void R.error(L.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=t,await cn(this,Me.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(i){throw this._optimizationMode=n,R.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}R.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return R.error(L.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,R.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){sF(this._originMediaStreamTrack).then(t=>{let[n,i]=t;this._videoHeight=i,this._videoWidth=n}).catch(Ug)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new de(L.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");R.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=Lo(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(Bt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await cn(this,Me.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(R)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:i}=this.getMediaStreamTrackSettings();if(!t||!n||!i)return;const{bitrateMax:a,bitrateMin:c}=this._encoderConfig;if(c==null||a==null){const{max:d,min:h}=function(m,g,_,v,y){const b=D("BITRATE_ADAPTER_TYPE");if(b==="DEFAULT_BITRATE")return{min:v,max:y};if(y===void 0){const O=Math.floor(200*Math.pow(_/15,.6)*Math.pow(m*g/640/360,.75));y=b==="STANDARD_BITRATE"?4*O:2*O,v=v??O}else v=v??Math.floor(y/10);return{min:v,max:y}}(t,n,i,c,a);if(this._encoderConfig.bitrateMin=h,this._encoderConfig.bitrateMax=d,D("VIDEO_STANDARD_BITRATE_VERSION")&&c==null&&a==null){const[m,g]=function(_,v,y){const b=4*Math.floor(2e5*Math.pow(y/15,.6)*Math.pow(_*v/230400,.75)),O=_*v,I=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),N=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let k=Es(I).call(I).next().value,j=1;if(I.has(O))k=I.get(O);else{var G;const Oe=Tu(G=Array.from(I.entries())).call(G,(qe,dt)=>{let[at]=qe,[Ut]=dt;return at-Ut}),Qe=Oe.find(qe=>{let[dt]=qe;return dt>O});if(Qe){const qe=Oe.indexOf(Qe);if(qe>0){const dt=Oe[qe-1],at=(O-dt[0])/(Qe[0]-dt[0]);k=dt[1]+at*(Qe[1]-dt[1])}else k=Qe[1]}else k=Oe[Oe.length-1][1]}if(N.has(O))j=N.get(O);else{var K;const Oe=Tu(K=Array.from(N.entries())).call(K,(qe,dt)=>{let[at]=qe,[Ut]=dt;return at-Ut}),Qe=Oe.find(qe=>{let[dt]=qe;return dt>O});if(Qe){const qe=Oe.indexOf(Qe);if(qe>0){const dt=Oe[qe-1],at=(O-dt[0])/(Qe[0]-dt[0]);j=dt[1]+at*(Qe[1]-dt[1])}else j=Qe[1]}else j=Oe[Oe.length-1][1]}const X=D("VIDEO_NEW_BITRATE_RATIO");X&&X>0&&(k=X/100);const z=Math.floor(b*k),ne=Math.floor(65e4*Math.pow(_*v/230400,.5)*Math.pow(y/15,.69));let me=z;const Ee=D("VIDEO_STANDARD_BITRATE_VERSION");return Ee&&Ee>0&&(Ee===1?me=b:Ee===2?me=z:Ee===3&&(me=ne)),[Math.floor(me/1e3),j]}(t,n,i);this._encoderConfig.bitrateMax=m,this._encoderConfig.bitrateMin=h?Math.min(h,m):m,this._saveEncodeBitrateRatio=g,R.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else R.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(d,", brMin: ").concat(h,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,n;const i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),a={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:c,slot:d}=a;if(this.isPlaying&&c instanceof HTMLVideoElement&&d instanceof HTMLElement){const h=iV.checkOneElementVisible(c),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const g=Le.reportApiInvoke(null,{tag:rn.TRACER,name:_n.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?g.onSuccess("Video is visible"):g.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(i){throw new de(L.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new de(L.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=hn(hn({},i),Lo(t))),i=Lu(i);const a=Wt(8,"track-video-cloned-"),c=new fq(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,Lu(this._scalabilityMode),this._optimizationMode,a,Lu(this._hints));return t&&i&&c.setEncoderConfiguration(i),R.debug("clone video track from ".concat(this.getTrackId()," to ").concat(a,", clone ").concat(n)),c}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new de(L.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new de(L.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(Zl(()=>{Le.reportApiInvoke(null,{name:_n.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:rn.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!D("ENABLE_VIDEO_SEI")||!D("ENABLE_ENCODED_TRANSFORM"))return void R.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new de(L.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void R.warning("Video track is not published, SEI can not be send");const i=n.sender.getParameters();if(i.codecs.length===0)return;const a=i.codecs[0].mimeType.toLocaleLowerCase();a==="video/h264"||a==="video/h265"?this.safeEmit("sei-to-send",t):R.warning("SEI is not supported by ".concat(a))}bindProcessorDestinationEvents(){this.processorDestination.on(Ii.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await cn(this,Me.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await cn(this,Me.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ii.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(js.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(js.REQUEST_CONSTRAINTS)}},wt(yt.prototype,"play",[QF,$F],Object.getOwnPropertyDescriptor(yt.prototype,"play"),yt.prototype),wt(yt.prototype,"stop",[ZF],Object.getOwnPropertyDescriptor(yt.prototype,"stop"),yt.prototype),wt(yt.prototype,"setEnabled",[e4,t4,n4],Object.getOwnPropertyDescriptor(yt.prototype,"setEnabled"),yt.prototype),wt(yt.prototype,"setMuted",[r4,i4,s4],Object.getOwnPropertyDescriptor(yt.prototype,"setMuted"),yt.prototype),wt(yt.prototype,"setSaveEncodeBitrateRatio",[o4,a4],Object.getOwnPropertyDescriptor(yt.prototype,"setSaveEncodeBitrateRatio"),yt.prototype),wt(yt.prototype,"setEncoderConfiguration",[c4,l4],Object.getOwnPropertyDescriptor(yt.prototype,"setEncoderConfiguration"),yt.prototype),wt(yt.prototype,"getStats",[d4],Object.getOwnPropertyDescriptor(yt.prototype,"getStats"),yt.prototype),wt(yt.prototype,"setBeautyEffect",[u4,h4],Object.getOwnPropertyDescriptor(yt.prototype,"setBeautyEffect"),yt.prototype),wt(yt.prototype,"getCurrentFrameData",[p4],Object.getOwnPropertyDescriptor(yt.prototype,"getCurrentFrameData"),yt.prototype),wt(yt.prototype,"getCurrentFrameImage",[m4],Object.getOwnPropertyDescriptor(yt.prototype,"getCurrentFrameImage"),yt.prototype),wt(yt.prototype,"findClosestProfile",[f4,g4],Object.getOwnPropertyDescriptor(yt.prototype,"findClosestProfile"),yt.prototype),wt(yt.prototype,"setBitrateLimit",[_4],Object.getOwnPropertyDescriptor(yt.prototype,"setBitrateLimit"),yt.prototype),wt(yt.prototype,"setOptimizationMode",[E4],Object.getOwnPropertyDescriptor(yt.prototype,"setOptimizationMode"),yt.prototype),wt(yt.prototype,"setScalabiltyMode",[v4],Object.getOwnPropertyDescriptor(yt.prototype,"setScalabiltyMode"),yt.prototype),wt(yt.prototype,"updateMediaStreamTrackResolution",[y4],Object.getOwnPropertyDescriptor(yt.prototype,"updateMediaStreamTrackResolution"),yt.prototype),wt(yt.prototype,"pipe",[S4],Object.getOwnPropertyDescriptor(yt.prototype,"pipe"),yt.prototype),wt(yt.prototype,"unpipe",[T4],Object.getOwnPropertyDescriptor(yt.prototype,"unpipe"),yt.prototype),wt(yt.prototype,"close",[b4],Object.getOwnPropertyDescriptor(yt.prototype,"close"),yt.prototype),wt(yt.prototype,"replaceTrack",[R4],Object.getOwnPropertyDescriptor(yt.prototype,"replaceTrack"),yt.prototype),yt),xS=(w4=He({argsMap:(e,t)=>[e.getTrackId(),t]}),C4=Pn(),I4=Bp("CameraVideoTrack","_enabledMutex"),A4=He({argsMap:(e,t)=>[e.getTrackId(),t]}),N4=Pn(),x4=He({argsMap:(e,t)=>[e.getTrackId(),t]}),O4=Pn(),P4=He({argsMap:e=>[e.getTrackId()]}),Gs=class gq extends sn{get __className__(){return"CameraVideoTrack"}constructor(t,n,i,a,c,d){super(t,Lo(n.encoderConfig),a,c,d),oe(this,"_config",void 0),oe(this,"_originalConstraints",void 0),oe(this,"_constraints",void 0),oe(this,"_enabled",!0),oe(this,"_deviceName","default"),oe(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Up()||RI())&&!function(){const h=Pt();if(h.os!==hr.IOS||!h.osVersion)return!1;const m=h.osVersion.split(".");return Number(m[0])===15&&Number(m[1])>=2}()&&Qj()&&this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=i,this._constraints=i,this._deviceName=t.label,this._encoderConfig=Lo(this._config.encoderConfig),en.on(Mr.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),en.on(Mr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(R.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const n=await Bs.getDeviceById(t),i={};i.video=hn({},this._constraints),i.video.deviceId={exact:t},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let a=null;try{a=await Fs(i,this.getTrackId())}catch(c){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),a=await Fs({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await Bs.getDeviceById(t);this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}R.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){R.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const n={video:hn(hn({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await Fs(n,this.getTrackId())}catch(a){throw R.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),a.toString()),i=await Fs({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),a}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=hn({},n.video),R.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const i=await Fs({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await cn(this,Me.NEED_ENABLE_TRACK,this)}catch(i){throw R.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await cn(this,Me.NEED_DISABLE_TRACK,this)}catch(i){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}R.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new de(L.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=Lo(t),D("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const i=mn(this._config);i.encoderConfig=t;const a=AS(i);(wr()||ni()||xo())&&(a.deviceId=void 0),R.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(a));try{await this._originMediaStreamTrack.applyConstraints(a),this.updateMediaStreamTrackResolution()}catch(c){const d=new de(L.UNEXPECTED_ERROR,c.toString());throw R.error("[".concat(this.getTrackId(),"] applyConstraints error"),d.toString()),d}this._config=i,this._constraints=a,this._originalConstraints=a,this._encoderConfig=t,this._hints.indexOf(Bt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await cn(this,Me.NEED_UPDATE_VIDEO_ENCODER,this)}catch(c){return c.throw(R)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((ni()||xo())&&this._enabled&&!this._isClosed&&en.duringInterruption){const t=async()=>{en.off(Mr.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};en.on(Mr.IOS_INTERRUPTION_END,t)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(qp.TRACK_ENDED)}async renewMediaStreamTrack(t){const n=t||this._constraints,i=Bs.searchDeviceIdByName(this._deviceName);if(i&&!n.deviceId&&(n.deviceId={exact:i}),this._enabled){const a=await Fs({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),en.off(Mr.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),en.off(Mr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=hn(hn({},i),Lo(t))),i=Lu(i);const a=Wt(8,"track-cam-cloned-"),c=new gq(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,Lu(hn(hn({},this._config),{},{encoderConfig:i})),Lu(this._constraints),Lu(this._scalabilityMode),this._optimizationMode,a);return t&&i&&c.setEncoderConfiguration(i),R.debug("clone track from ".concat(this.getTrackId()," to ").concat(a,", clone ").concat(n)),c}bindProcessorContextEvents(){this.processorContext.on(js.REQUEST_UPDATE_CONSTRAINTS,async(t,n,i)=>{try{const a=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(a),n()}catch(a){i(a)}}),this.processorContext.on(js.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},wt(Gs.prototype,"setDevice",[w4,C4],Object.getOwnPropertyDescriptor(Gs.prototype,"setDevice"),Gs.prototype),wt(Gs.prototype,"setEnabled",[I4,A4,N4],Object.getOwnPropertyDescriptor(Gs.prototype,"setEnabled"),Gs.prototype),wt(Gs.prototype,"setEncoderConfiguration",[x4,O4],Object.getOwnPropertyDescriptor(Gs.prototype,"setEncoderConfiguration"),Gs.prototype),wt(Gs.prototype,"close",[P4],Object.getOwnPropertyDescriptor(Gs.prototype,"close"),Gs.prototype),Gs);function D4(e){const t=Wt(8,"track-cus-"),n=Le.reportApiInvoke(null,{id:t,tag:rn.TRACER,name:_n.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),i=new Dn(e.mediaStreamTrack,e.encoderConfig?wS(e.encoderConfig):{},t,!1);return R.info("create custom audio track success with config",e,"trackId",i.getTrackId()),n.onSuccess(i.getTrackId()),i}function lA(e,t,n,i){n.optimizationMode&&(i&&i.width&&i.height?(n.encoderConfig=hn(hn({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?R.debug("[".concat(e,"] set content hint to"),n.optimizationMode):R.debug("[".concat(e,"] set content hint failed")))):R.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var k4,L4,M4,U4,oo,j4,V4,F4,B4,G4,W4,z4,Kr;class H4 extends HV{getUserId(){return this._userId}constructor(t,n,i,a){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(a.clientId,"_").concat(Wt(5,""))),oe(this,"_userId",void 0),oe(this,"_uintId",void 0),oe(this,"_isDestroyed",!1),oe(this,"store",void 0),oe(this,"processor",void 0),oe(this,"processorContext",void 0),this._userId=n,this._uintId=i,this.store=a}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,R.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let $p=(k4=He({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),L4=He({argsMap:e=>[e.getTrackId()]}),M4=He({argsMap:(e,t)=>[e.getTrackId(),t.name]}),U4=He({argsMap:e=>[e.getTrackId()]}),wt((oo=class extends H4{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Yr.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,i,a){super(e,t,n,i),oe(this,"_videoVisibleTimer",null),oe(this,"_previousVideoVisibleStatus",void 0),oe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),oe(this,"trackMediaType",Yp.VIDEO),oe(this,"_videoWidth",void 0),oe(this,"_videoHeight",void 0),oe(this,"_player",void 0),oe(this,"_prePlayer",void 0),oe(this,"processorDestination",void 0),oe(this,"processorContext",void 0),this._prePlayer=a,this.updateMediaStreamTrackResolution(),this.processorContext=new nF(this.getTrackId(),"remote"),this.processorDestination=new tF(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Zl(()=>{R.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Ss(this,Me.GET_STATS)||hn({},WV)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(so.PLAY_START),typeof e=="string"){const i=document.getElementById(e);i?e=i:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=hn(hn({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(n);else{let i=!1,a=!1;e instanceof HTMLVideoElement?(this._player=new cA(n),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,a=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,i=this._player.videoState>0,this._player.updateConfig(n)):this._player=new NS(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(so.FIRST_FRAME_DECODED),a&&this.safeEmit(so.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=c=>{this.safeEmit(so.VIDEO_STATE_CHANGED,c)},i&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(so.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},D("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(so.PLAY_END)}stop(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(e),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){sF(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(Ug)}_updatePlayerSource(){R.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),i={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:a,slot:c}=i;if(this.isPlaying&&a instanceof HTMLVideoElement&&c instanceof HTMLElement){const d=iV.checkOneElementVisible(a),h=Object.assign({},d);if(h.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=h.visible;const m=Le.reportApiInvoke(null,{tag:rn.TRACER,name:_n.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});h.visible?m.onSuccess("Video is visible"):m.onSuccess("Invisible because of ".concat(h.reason))}return h}return}catch(n){throw new de(L.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new de(L.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Ii.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ii.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Bu.SEI_RECEIVED,e)}}).prototype,"play",[k4],Object.getOwnPropertyDescriptor(oo.prototype,"play"),oo.prototype),wt(oo.prototype,"stop",[L4],Object.getOwnPropertyDescriptor(oo.prototype,"stop"),oo.prototype),wt(oo.prototype,"pipe",[M4],Object.getOwnPropertyDescriptor(oo.prototype,"pipe"),oo.prototype),wt(oo.prototype,"unpipe",[U4],Object.getOwnPropertyDescriptor(oo.prototype,"unpipe"),oo.prototype),oo),Zp=(j4=He({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),V4=He({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),F4=He({argsMap:(e,t)=>[e.getTrackId(),t]}),B4=He({argsMap:e=>[e.getTrackId()]}),G4=He({argsMap:e=>[e.getTrackId()]}),W4=He({argsMap:(e,t)=>[e.getTrackId(),t.name]}),z4=He({argsMap:e=>[e.getTrackId()]}),wt((Kr=class extends H4{get isPlaying(){return this._useAudioElement?pi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,i){super(e,t,n,i),oe(this,"trackMediaType",Yp.AUDIO),oe(this,"_source",void 0),oe(this,"_useAudioElement",!0),oe(this,"_volume",100),oe(this,"processorContext",void 0),oe(this,"processorDestination",void 0),oe(this,"_played",!1),oe(this,"_bypassWebAudio",!1),D("DISABLE_WEBAUDIO")?(this._source=new oA,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new rA(e,!0),D("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Us.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(so.FIRST_FRAME_DECODED)}),this.processorContext=new iF(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new rF(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Us.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Us.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Us.ON_AUDIO_BUFFER),this._source.on(Us.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?pi.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}setAmplifiedVolume(e){this._useAudioElement&&this._played&&(pi.stop(this.getTrackId()),this._source.play()),this._useAudioElement=!1,e=Math.min(e,D("MAX_WEBAUDIO_VOLUME")),this._volume=e,this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!MV())throw new de(L.NOT_SUPPORTED,"your browser does not support setting the audio output device");await pi.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getVolume(){return this._useAudioElement?pi.getVolume(this.getTrackId()):this._source instanceof rA?this._source.getAudioVolume():0}getStats(){return Zl(()=>{R.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Ss(this,Me.GET_STATS)||hn({},GV)}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] use audio element to play")),pi.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):(R.debug("[".concat(this.getTrackId(),"] use audio context to play")),this._source.play())}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?pi.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&pi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new de(L.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new de(L.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new de(L.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Ii.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Ii.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ii.ON_TRACK),this.processorDestination.removeAllListeners(Ii.ON_NODE)}}).prototype,"setVolume",[j4],Object.getOwnPropertyDescriptor(Kr.prototype,"setVolume"),Kr.prototype),wt(Kr.prototype,"setAmplifiedVolume",[V4],Object.getOwnPropertyDescriptor(Kr.prototype,"setAmplifiedVolume"),Kr.prototype),wt(Kr.prototype,"setPlaybackDevice",[F4],Object.getOwnPropertyDescriptor(Kr.prototype,"setPlaybackDevice"),Kr.prototype),wt(Kr.prototype,"play",[B4],Object.getOwnPropertyDescriptor(Kr.prototype,"play"),Kr.prototype),wt(Kr.prototype,"stop",[G4],Object.getOwnPropertyDescriptor(Kr.prototype,"stop"),Kr.prototype),wt(Kr.prototype,"pipe",[W4],Object.getOwnPropertyDescriptor(Kr.prototype,"pipe"),Kr.prototype),wt(Kr.prototype,"unpipe",[z4],Object.getOwnPropertyDescriptor(Kr.prototype,"unpipe"),Kr.prototype),Kr);const Ts=new class extends Sn{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),oe(this,"_lastHiddenTime",0),oe(this,"_lastVisibleTime",0),oe(this,"needUploadStats",[]),oe(this,"isCollectingStats",!1),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),this.isCollectingStats&&this.needUploadStats.push(document.visibilityState==="visible"?1:0),R.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}startCollectStats(){this.isCollectingStats=!0,this.needUploadStats.push(this.visibility==="visible"?1:0)}stopCollectStats(){this.isCollectingStats=!1,this.needUploadStats.length=0}};class K4 extends Sn{constructor(t,n){super(),oe(this,"trackMediaType",Yp.DATA),oe(this,"_version",1),oe(this,"_type",3),oe(this,"_config",void 0),oe(this,"_originDataChannel",void 0),oe(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),oe(this,"_dataStreamPacketHandler",{serialize:i=>i,deserialize:i=>i}),oe(this,"_datachannelEventMap",new Map),this._config=t,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return D("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new we((t,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const i=setTimeout(()=>{var a;n(new de(L.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((a=this._originDataChannel)===null||a===void 0?void 0:a.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new de(L.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new de(L.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[CS.OPEN,CS.CLOSE,CS.ERROR].forEach(n=>{const i=()=>{this.emit(n)};this._datachannelEventMap.set(n,i),t.addEventListener(n,i)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[i,a]=n;t.removeEventListener(i,a)}),this._datachannelEventMap.clear()}}class _oe extends K4{constructor(t){super(t),oe(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const i=n.data.slice(0,this._dataStreamPacketHeader.byteLength),a=new DataView(i).getUint8(3);if(a!==this.id)return void(D("SHOW_DATASTREAM2_LOG")&&R.debug("invalid datachannel id: ".concat(a," !== ").concat(this.id)));let c=n.data.slice(this._dataStreamPacketHeader.byteLength);c=this._dataStreamPacketHandler.deserialize(c),this.emit(CS.MESSAGE,c)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Eoe extends K4{send(t){if(this._originDataChannel){let n=t;n=this._dataStreamPacketHandler.serialize(t);const i=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}function OS(){const e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcixuPVtdLHI9W107bGV0IGg9bnVsbDtlLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9dD0+e3QuZGF0YS5zZWkmJm4ucHVzaCh0LmRhdGEuc2VpKSx0LmRhdGEubWV0YWRhdGEmJnIucHVzaCh0LmRhdGEubWV0YWRhdGEpfSxzZWxmLnBvc3RNZXNzYWdlKCJzdGFydGVkIik7Y29uc3QgcD1lLnJlYWRhYmxlLmdldFJlYWRlcigpLFU9ZS53cml0YWJsZS5nZXRXcml0ZXIoKTsic2VpLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KG4udmFsdWUuZGF0YSkpLHI9YShuLnZhbHVlLHQpO2lmKHImJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtzZWk6cn0pLCFoKXtjb25zdCB0PW4udmFsdWUuZ2V0TWV0YWRhdGEoKXx8e307aD17dHlwZTpuLnZhbHVlLnR5cGUscnRwVGltZXN0YW1wOm4udmFsdWUudGltZXN0YW1wLHBheWxvYWRUeXBlOnQucGF5bG9hZFR5cGV8fDAsc3NyYzp0LnN5bmNocm9uaXphdGlvblNvdXJjZXx8MCxsZW5ndGg6bi52YWx1ZS5kYXRhLmJ5dGVMZW5ndGgsLi4uIm1pbWVUeXBlImluIHQ/e21pbWVUeXBlOnQubWltZVR5cGV9Ont9fSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7Zmlyc3RGcmFtZUluZm86aH0pfX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToic2VpLXR4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigoYT0+e2lmKCFhLmRvbmUpe2lmKGEudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KGEudmFsdWUuZGF0YSkpLGU9bi5zaGlmdCgpO2lmKGUpe2NvbnN0IG49byhhLnZhbHVlLmRhdGEsZSx0KTtuJiYoYS52YWx1ZS5kYXRhPW4pfX1VLndyaXRlKGEudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtwLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PW5ldyBEYXRhVmlldyhuLnZhbHVlLmRhdGEpLGE9dC5nZXRVaW50OCgwKTtsZXQgcjtpZigwIT0oMTI4JmEpJiY3MSE9PWEpe2NvbnN0IGU9ZnVuY3Rpb24odCl7aWYodC5ieXRlTGVuZ3RoPD0wKXJldHVybltdO2NvbnN0IGU9W107bGV0IG49MDtmb3IoO248dC5ieXRlTGVuZ3RoOyl7Y29uc3QgYT0oMTI4JnQuZ2V0VWludDgobikpPj43LHI9MTI3JnQuZ2V0VWludDgobik7aWYoIShhJiZuKzQ8PXQuYnl0ZUxlbmd0aCkpe24rKzticmVha317Y29uc3QgYT10LmdldFVpbnQzMihuLCExKSxvPSgxNjc3NjE5MiZhKT4+MTAsaT0xMDIzJmE7ZS5wdXNoKHtwdDpyLHRzX29mZnNldDpvLGxlbmd0aDppLGRhdGE6bmV3IFVpbnQ4QXJyYXl9KSxuKz00fX1sZXQgYT10LmJ5dGVMZW5ndGgtbjtmb3IoY29uc3QgciBvZiBlKXtpZihyLmxlbmd0aD5hKXJldHVybiBjb25zb2xlLndhcm4oIkJyb2tlbiByZWQgcGF5bG9hZCIpLFtdO3IubGVuZ3RoPjAmJihyLmRhdGE9bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sci5sZW5ndGgpLG4rPXIubGVuZ3RoLGEtPXIubGVuZ3RoKX1pZihhPjApe2NvbnN0IHI9e3B0OmUubGVuZ3RoPjA/ZVtlLmxlbmd0aC0xXS5wdDowLHRzX29mZnNldDowLGxlbmd0aDphLGRhdGE6bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sYSl9O2UucHVzaChyKX1yZXR1cm4gZX0odCk7aWYoZS5sZW5ndGg+MCl7Y29uc3QgdD1mdW5jdGlvbih0KXtsZXQgZT0wO2ZvcihsZXQgbj0wO248dC5sZW5ndGg7bisrKWUrPW48dC5sZW5ndGgtMT80OjEsZSs9dFtuXS5sZW5ndGg7Y29uc3Qgbj1uZXcgVWludDhBcnJheShlKTtsZXQgYT0wO2ZvcihsZXQgZT0wO2U8dC5sZW5ndGg7ZSsrKWlmKGU8dC5sZW5ndGgtMSl7Y29uc3Qgcj0oMjE0NzQ4MzY0OHwoMTI3JnRbZV0ucHQpPDwyNHwoMjYyMTQzJnRbZV0udHNfb2Zmc2V0KTw8MTB8MTAyMyZ0W2VdLmxlbmd0aCk+Pj4wO25bYSsrXT1yPj4yNCYyNTUsblthKytdPXI+PjE2JjI1NSxuW2ErK109cj4+OCYyNTUsblthKytdPTI1NSZyfWVsc2UgblthKytdPTEyNyZ0W2VdLnB0O2Zvcihjb25zdCBlIG9mIHQpbi5zZXQoZS5kYXRhLGEpLGErPWUubGVuZ3RoO3JldHVybiBufShlLm1hcCgodD0+e2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>xy.revokeObjectURL(e),0),new Worker(xy.createObjectURL(e))}const q4=71,dA=1,uA=2,hA=1,Y4=2;var td=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(td||{});function pA(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=e.getUint8(0);if(n!==q4)return;const i=e.getUint16(1),a=dA+uA+i,c=new Uint8Array(e.byteLength-a);c.set(new Uint8Array(e.buffer,a,e.byteLength-a));const d={m:n,tlvLen:i,tlv:[],frame:c};let h=dA+uA;for(;h<a;){const m=e.getUint8(h),g=e.getUint16(h+hA),_=hA+Y4;if(m===td.AUDIO_LEVEL){let v=e.getUint8(h+_);for(let y=1;y<g;y++)v=v<<8|e.getUint8(h+_+y);d.tlv.push({tag:m,length:g,value:t?127^v>>1:127&v})}else if(m===td.METADATA||m===td.AUDIO_64_BIT_PTS){const v=new Uint8Array(g);for(let y=0;y<g;y++)v[y]=e.getUint8(h+_+y);d.tlv.push({tag:m,length:g,value:v})}h+=_+g}return d}const PS=new Map,DS=127,zu=1e-10,mA=139/13,kS=new Map;function fA(e,t,n){const i="".concat(e,"-").concat(t,"-").concat(n);let a=0;return kS.has(i)?a=kS.get(i):(a=Math.log(function(d,h){const m=d-h;h<m&&(h=m);let g=1;for(let _=d,v=1;_>h;_--,v++)g=g*_/v;return g}(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(n)+n*e,kS.set(i,a)),a<zu&&(a=zu),a}function X4(e,t,n){const i=t.length,a=e.length/i;let c=!1;for(let d=0,h=0;d<i;d++){let m=0;for(let g=h+a;h<g;h++)e[h]>n&&m++;t[d]!==m&&(t[d]=m,c=!0)}return c}window.cache=kS;let voe=0;class J4{constructor(t){oe(this,"id",void 0),oe(this,"immediates",[]),oe(this,"lastNonSilence",-1),oe(this,"immediateSpeechActivityScore",zu),oe(this,"lastLevelChangedTime",Date.now()),oe(this,"levels",[]),oe(this,"longs",[]),oe(this,"longSpeechActivityScore",zu),oe(this,"mediums",[]),oe(this,"mediumSpeechActivityScore",zu),oe(this,"minLevel",0),oe(this,"nextMinLevel",0),oe(this,"nextMinLevelWindowLength",0),oe(this,"energyScore",0),this.id=t||"".concat(voe++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,n=this.levels,i=this.minLevel+mA;let a=!1;for(let c=0;c<t.length;++c){let d=n[c];d<i&&(d=0);const h=Math.floor(d/mA);t[c]!==h&&(t[c]=h,a=!0)}return a}computeLongs(){return X4(this.mediums,this.longs,4)}computeMediums(){return X4(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=fA(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=fA(this.longs[0],10,47),this.longSpeechActivityScore>zu&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=fA(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(_k(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let i=t;return t<0&&(i=0),t>DS&&(i=DS),this.levels.unshift(i),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(i),i>=this.minLevel+mA?i:i/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>DS&&(n=DS),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class yoe{constructor(t){oe(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?t=!0:setTimeout(this.execute.bind(this),n)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class gA{constructor(t,n,i){oe(this,"isDominant",void 0),oe(this,"energyRanking",void 0),oe(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=n,this.energyScore=i}}class Soe extends Sn{constructor(t){super(),oe(this,"dominantId",null),oe(this,"lastDecisionTime",0),oe(this,"lastLevelChangedTime",0),oe(this,"lastLevelIdleTime",0),oe(this,"relativeSpeechActivities",[]),oe(this,"speakers",new Map),oe(this,"enableSilence",!1),oe(this,"timeoutToSilenceInterval",0),oe(this,"decisionMaker",null),oe(this,"loudest",[]),oe(this,"numLoudestToTrack",3),oe(this,"energyExpireTimeMs",250),oe(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,n!=null&&(this.energyExpireTimeMs=n),i!=null&&(this.energyAlphaPct=i),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(n=>n.id===t)}levelChanged(t,n){const i=Date.now(),a=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<i&&(this.lastLevelChangedTime=i,this.maybeStartDecisionMaker());const c=a.levelChanged(n,i);return this.updateLoudestList(a,c,i)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(t){t.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(t){let n=this.speakers.get(t);return n||(n=new J4(t),this.speakers.set(t,n),this.maybeStartDecisionMaker()),n}updateLoudestList(t,n,i){const a=t.id===this.dominantId;if(n<0){let m=0;for(;m<this.loudest.length&&this.loudest[m]!==t;)++m;return new gA(a,m,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new gA(a,0,t.energyScore);const c=i-this.energyExpireTimeMs;let d=0;for(;d<this.loudest.length;){const m=this.loudest[d];if(m.getLastLevelChangedTime()<c&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(d,1);else if(m.id!==t.id)++d;else if(this.loudest.splice(d,1),this.loudest.length<this.numLoudestToTrack)break}let h=0;for(;h<this.loudest.length&&!(this.loudest[h].energyScore<t.energyScore);)++h;return h<this.numLoudestToTrack&&(this.loudest.splice(h,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new gA(a,h,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new yoe(this),this.decisionMaker.execute())}makeDecision(t){let n=null,i=null;const a=this.speakers.size;let c=null;if(a===0)c=null;else if(a===1){var d;const h=Es(d=this.speakers).call(d).next().value;this.enableSilence&&h&&(c=h.id,h.evaluateSpeechActivityScores(t),t-h.lastNonSilence>this.timeoutToSilenceInterval&&(c=null))}else{let h=this.dominantId==null?null:this.speakers.get(this.dominantId);if(h==null){const _=this.speakers.entries().next();_.value&&(c=_.value[0],h=_.value[1])}else c=h.id;h!=null&&h.evaluateSpeechActivityScores(t);const m=this.relativeSpeechActivities;let g=2;for(const _ of this.speakers.entries()){const[v,y]=_;if(y===h)continue;y.evaluateSpeechActivityScores(t);for(let N=0;N<m.length;++N){const k=h==null?zu:h.getSpeechActivityScore(N);m[N]=Math.log(y.getSpeechActivityScore(N)/k)}const b=m[0],O=m[1],I=m[2];b>3&&O>2&&I>0&&O>g&&(g=O,c=v)}this.enableSilence&&h!=null&&c===h.id&&t-h.lastNonSilence>this.timeoutToSilenceInterval&&(c=null)}c==null&&!this.enableSilence||c===this.dominantId||(n=this.dominantId,this.dominantId=c,i=this.dominantId),i==null&&!this.enableSilence||i===n||this.emit("ActiveSpeakerChanged",i)}_runInDecisionMaker(){const t=Date.now(),n=300-(t-this.lastLevelIdleTime);let i=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):i=n;let a=300-(t-this.lastDecisionTime);return a<=0&&(this.lastDecisionTime=t,this.makeDecision(t),a=300-(Date.now()-t)),a>0&&i>a&&(i=a),i}timeoutIdleLevels(t){const n=[];for(const a of Es(i=this.speakers).call(i)){var i;const c=t-a.getLastLevelChangedTime();36e5<c&&(this.dominantId==null||a.id!==this.dominantId)?n.push(a.id):300<c&&a.levelTimedOut()}n.forEach(a=>this.speakers.delete(a))}}const em=new Map;let ma=null,LS=null;const Q4=3;let Hu=[];const fa=new Map,MS=new Map;class Toe{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,n){oe(this,"id",void 0),oe(this,"track",void 0),oe(this,"score",0),oe(this,"active",!0),oe(this,"muted",!1),oe(this,"timer",0),oe(this,"actives",0),oe(this,"inactives",0),this.id=t,this.track=n,this.setActive(fa.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:i}=function(){const a=[],c=[];return Array.from(Es(fa).call(fa)).forEach(d=>{d.active?a.push(d):c.push(d)}),{actives:a,inactives:c}}();if(n.length>3){let a;n.forEach(c=>{(!a||a.score>c.score)&&(a=c)}),a&&a.setActive(!1)}if(n.length<3&&i.length>0){let a;i.forEach(c=>{(!a||a.score<c.score)&&c.id!==this.id&&(a=c)}),a&&t&&!this.active&&(a.samples>40&&a.activeRate-this.activeRate>.4?a.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=function(n){let i;return Array.from(Es(fa).call(fa)).forEach(a=>{!a.active||a.id===n||a.samples<40||(!i||a.score<i.score)&&(i=a)}),i}(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=function(n){let i;return Array.from(Es(fa).call(fa)).forEach(a=>{a.active||a.id===n||a.samples<40||(!i||a.score>i.score)&&(i=a)}),i}(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let US;function $4(e){const t=fa.get(e);t&&(fa.delete(e),t.clearTimer())}const jS=new Map,boe=new Map,_A="video/h264",EA="video/h265";function Z4(e,t,n){let i=new Uint8Array(e,t,n),a=[],c=0;for(;a.length<n;)c+3<n&&i[c]===0&&i[c+1]===0&&i[c+2]===3&&(i[c+3]===0||i[c+3]===1||i[c+3]===2||i[c+3]===3)?(a.push(i[c],i[c+1],i[c+3]),c+=4):(a.push(i[c]),c++);return new Uint8Array(a)}function e3(e){const t=e.length;let n=[],i=0;for(;i<t;)i+2<t&&e[i]===0&&e[i+1]===0&&(e[i+2]===0||e[i+2]===1||e[i+2]===2||e[i+2]===3)?(n.push(e[i],e[i+1],3,e[i+2]),i+=3):(n.push(e[i]),i++);return new Uint8Array(n)}function t3(e){if(e.length<5)return"";let t=-1;for(let a=0;a<e.length-3;a++){if(e[a]===0&&e[a+1]===0&&e[a+2]===1){t=a;break}if(a<e.length-4&&e[a]===0&&e[a+1]===0&&e[a+2]===0&&e[a+3]===1){t=a;break}}if(t===-1)return"";const n=t+(e[t+2]===0?4:3);if(n>=e.length)return"";const i=e[n];return 128&i?"":(i>>1&63)>=32||n+1<e.length&&!(248&e[n+1])?EA:(31&i)<=31?_A:""}const VS=new Map,zg=new Map;(function(){const e=Pt();mr.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),mr.getStreamFromExtension=e.name===Mt.CHROME&&Number(e.version)>34,mr.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n}(),mr.supportMinBitrate=e.name===Mt.CHROME||e.name===Mt.EDGE,mr.supportSetRtpSenderParameters=function(){const t=Pt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!nc()||!(!wr()&&!hS())||t.name===Mt.FIREFOX&&Number(t.version)>=64)}(),e.name===Mt.SAFARI&&(Number(e.version)>=14?mr.supportDualStream=!0:mr.supportDualStream=!1),mr.webAudioMediaStreamDest=function(){const t=Pt();return!(t.name===Mt.SAFARI&&Number(t.version)<12)}(),mr.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",mr.supportWebGL=typeof WebGLRenderingContext<"u",mr.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,nc()||(mr.webAudioWithAEC=!0),mr.supportShareAudio=function(){const t=Pt();return(t.os===hr.WIN_10||t.os===hr.WIN_81||t.os===hr.WIN_7||t.os===hr.LINUX||t.os===hr.MAC_OS||t.os===hr.CHROMIUM_OS)&&t.name===Mt.CHROME&&Number(t.version)>=74}(),mr.supportDataChannel=!!(ha(76)||TI(68)||Kj(14)),mr.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!pn()&&!!t&&t.prototype.setConfiguration instanceof Function}(),mr.supportWebRTCEncodedTransform=ha(87)||Wj()||TI(117),mr.supportWebRTCInsertableStream=function(){const t=Pt();return(t.name===Mt.CHROME||t.name===Mt.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),mr.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,mr.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,mr.supportSuppressLocalAudioPlayback=VV(),mr.supportRestrictOwnAudio=FV(),mS(()=>{mr.supportDualStreamEncoding=function(){const t=Pt();return!!D("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&D("CHROME_DUAL_STREAM_USE_ENCODING"))}(),R.debug("browser ua: ",navigator.userAgent),R.info("browser info: ",e),R.info("browser compatibility: ",mr)})})();const Roe=["CHINA","GLOBAL"],n3=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Ku=[],tm=[];function qu(e,t){return!!t&&Ku.some(n=>n.uid===e&&n.channelName===t)}function vA(){return tm.length>0}var woe=lU.forEach,r3=Gv("forEach")?[].forEach:function(e){return woe(this,e,arguments.length>1?arguments[1]:void 0)};Lt({target:"Array",proto:!0,forced:[].forEach!==r3},{forEach:r3});var Coe=eo("Array","forEach"),Ioe=Wl,Aoe=br,Noe=F,xoe=Coe,yA=Array.prototype,Ooe={DOMTokenList:!0,NodeList:!0},Poe=function(e){var t=e.forEach;return e===yA||Noe(yA,e)&&t===yA.forEach||Aoe(Ooe,Ioe(e))?xoe:t},Doe=u(Poe),koe=bo,i3=Yv;Lt({target:"Object",stat:!0,forced:f(function(){i3(1)})},{keys:function(e){return i3(koe(e))}});var Loe=u(qt.Object.keys),Moe=u(mk),Uoe=u(gk),joe=Lt,s3=ng,Voe=cy,Foe=kt,o3=Te,Boe=an,Goe=_t,Woe=$w,zoe=Mn,Hoe=Hl,Koe=ZM("slice"),qoe=zoe("species"),SA=Array,Yoe=Math.max;joe({target:"Array",proto:!0,forced:!Koe},{slice:function(e,t){var n,i,a,c=Goe(this),d=Boe(c),h=o3(e,d),m=o3(t===void 0?d:t,d);if(s3(c)&&(n=c.constructor,(Voe(n)&&(n===SA||s3(n.prototype))||Foe(n)&&(n=n[qoe])===null)&&(n=void 0),n===SA||n===void 0))return Hoe(c,h,m);for(i=new(n===void 0?SA:n)(Yoe(m-h,0)),a=0;h<m;h++,a++)h in c&&Woe(i,a,c[h]);return i.length=a,i}});var Xoe=eo("Array","slice"),Joe=F,Qoe=Xoe,TA=Array.prototype,$oe=function(e){var t=e.slice;return e===TA||Joe(TA,e)&&t===TA.slice?Qoe:t},Zoe=u($oe);function Ie(e,t,n,i,a){var c,d,h,m={};return Doe(c=Loe(i)).call(c,function(g){m[g]=i[g]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=Moe(d=Uoe(h=Zoe(n).call(n)).call(h)).call(d,function(g,_){return _(e,t,g)||g},m),a&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(a):void 0,m.initializer=void 0),m.initializer===void 0?(XM(e,t,m),null):m}let FS=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),bA=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),ao=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e[e.REQ_DOWNGRADE_FALLBACK=27]="REQ_DOWNGRADE_FALLBACK",e}({}),Ai=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),We=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.K_VOS_FALLBACK=30]="K_VOS_FALLBACK",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),bt=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Ue=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e.VOS_FALLBACK="vos_fallback",e.VOS_FALLBACK_PROMISE="vos_fallback_promise",e}({}),Ve=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SET_DUAL_STREAM_MODE="set_dual_stream_mode",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.CONFIGURE="configure",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e}({}),Yu=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),Ze=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e.ENABLE_MULTI_STREAM="enable_multi_stream",e}({}),Ni=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),ct=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e.ON_FALLBACK="websocket:on_fallback",e}({});function BS(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw R.error("Invalid Channel Name ".concat(e)),new se(L.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function GS(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||tV(e,1,255)))throw new se(L.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&R.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let qc=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const eae={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},RA={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function wA(e,t){Lr(e.url,"".concat(t,".url"),1,1e3,!1),An(e.x)||nn(e.x,"".concat(t,".x"),0,1e4),An(e.y)||nn(e.y,"".concat(t,".y"),0,1e4),An(e.width)||nn(e.width,"".concat(t,".width"),0,1e4),An(e.height)||nn(e.height,"".concat(t,".height"),0,1e4),An(e.zOrder)||nn(e.zOrder,"".concat(t,".zOrder"),0,255),An(e.alpha)||nn(e.alpha,"".concat(t,".alpha"),0,1,!1)}const tae={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let nd=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),CA=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),or=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function a3(e){if(!e.channelName)throw new se(L.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new se(L.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Lr(e.token,"info.token",1,2047),GS(e.uid),BS(e.channelName),!0}let Vi=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Yc=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),Zi=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),nm=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),Ht=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),Fn=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e.VOS_FALLBACK="vos-fallback",e.VOS_FALLBACK_PROMISE="vos-fallback-promise",e.RESET_SIGNAL="reset-signal",e.DATACHANNEL_FAILBACK="datachannel-failback",e}({}),WS=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),fr=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),jt=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const c3=[jt.AFRICA,jt.ASIA,jt.CHINA,jt.EUROPE,jt.GLOBAL,jt.INDIA,jt.JAPAN,jt.NORTH_AMERICA,jt.OCEANIA,jt.OVERSEA,jt.SOUTH_AMERICA];let Xr=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const zS={CHINA:{},ASIA:{CODE:Xr.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Xr.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Xr.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Xr.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Xr.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Xr.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Xr.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Xr.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Xr.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Xr.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Xr.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Xr.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Xr.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};GI&&(zS.CHINA={CODE:Xr.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let ga=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e.UPDATE_REMOTE_VIDEO_STREAM_TYPE="update_remote_video_stream_type",e.FALLBACK_TO_HLS="fallback_to_hls",e.UPDATE_VOS_CONFIGURE="update_vos_configure",e}({});function l3(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class d3 extends Sn{constructor(t,n){super(),x(this,"onICEConnectionStateChange",void 0),x(this,"onConnectionStateChange",void 0),x(this,"onDTLSTransportStateChange",void 0),x(this,"onDTLSTransportError",void 0),x(this,"onICETransportStateChange",void 0),x(this,"onFirstAudioReceived",void 0),x(this,"onFirstVideoReceived",void 0),x(this,"onFirstAudioDecoded",void 0),x(this,"onFirstVideoDecoded",void 0),x(this,"onFirstVideoRender",void 0),x(this,"onFirstVideoBufferReady",void 0),x(this,"onFirstVideoDecodedTimeout",void 0),x(this,"onSelectedLocalCandidateChanged",void 0),x(this,"onSelectedRemoteCandidateChanged",void 0),x(this,"onICECandidateError",void 0),x(this,"getLocalVideoStats",void 0)}}class HS extends d3{constructor(t,n){super(t,n),x(this,"establishPromise",void 0)}}let De=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),Ir=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),Xc=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const u3=["disconnected","failed"];let ye=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Ft=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Fe=function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e.FirstVideoPreRender="FirstVideoPreRender",e.FirstVideoBufferReady="FirstVideoBufferReady",e}({}),Mo=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Uo=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Ar=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),rd=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),ar=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),oc=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),co=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),_a=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),rm=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Bn=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),im=function(e){return e.ABORT="abort",e}({}),id=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),nae=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const rae={[FS.ACCESS_POINT]:{[Ai.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Ai.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Ai.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Ai.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Ai.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Ai.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Ai.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Ai.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Ai.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Ai.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Ai.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Ai.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Ai.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Ai.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Ai.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Ai.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Ai.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Ai.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[FS.UNILBS]:{[ao.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[ao.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[ao.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[ao.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[ao.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[ao.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[ao.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[ao.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[ao.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[ao.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[ao.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[ao.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1},[ao.REQ_DOWNGRADE_FALLBACK]:{desc:"request downgrade fallback",retry:!1}},[FS.STRING_UID_ALLOCATOR]:{[bA.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[bA.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[bA.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function sm(e){const t=rae[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===FS.ACCESS_POINT){const i=e%1e4;if(i.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const iae={[We.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[We.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[We.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[We.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[We.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[We.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[We.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[We.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[We.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[We.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[We.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[We.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[We.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[We.K_VOS_FALLBACK]:{desc:"K_VOS_FALLBACK",action:"tryNext"},[We.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[We.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[We.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[We.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[We.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[We.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[We.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[We.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[We.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[We.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[We.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[We.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[We.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[We.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[We.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[We.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[We.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[We.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[We.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[We.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[We.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[We.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[We.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[We.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[We.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[We.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[We.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[We.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[We.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[We.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[We.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[We.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[We.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[We.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[We.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[We.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[We.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[We.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[We.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[We.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[We.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[We.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[We.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[We.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[We.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[We.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[We.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[We.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[We.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[We.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[We.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Xu(e){return iae[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function h3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function IA(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?h3(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h3(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function AA(e,t){if(typeof e=="string")return e;const{proxy:n,host:i,port:a}=e;if(t){const c=D("JOIN_GATEWAY_FALLBACK_PORT")||443;return c===443?"wss://".concat(i,"/ws/?p=").concat(Number(a)+150):"wss://".concat(i,":").concat(c,"/ws/?p=").concat(Number(a)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(i,"&p=").concat(a):"wss://".concat(i,":").concat(a)}const sae=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,oae=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,aae=/wss:\/\/(.+):([0-9]+)\/?/,cae=/wss:\/\/(.[^\/]+)\/?/;let lae=0;class dae{constructor(t,n){x(this,"id",0),x(this,"store",void 0),x(this,"recordIndex",void 0),x(this,"websockets",[]),x(this,"try443PortDuration",2e3),x(this,"forceCloseWSDuration",5e3),x(this,"try443PortTimeout",null),x(this,"forceCloseTimeout",null),x(this,"isTry443PortFailed",!1),x(this,"isNormalPortFailed",!1),x(this,"useDoubleDomain",!1),x(this,"useProxy",!1),x(this,"startTime",Date.now()),this.id=++lae,this.try443PortDuration=D("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const n=Date.now()-this.startTime;for(var i=arguments.length,a=new Array(i),c=0;c<i;c++)a[c]=arguments[c];R.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...a)}createWebSocket(t,n,i){this.logger("createWebSocket:",t,{isTry443Port:n,hasTimeoutDetection:i});const a=D("GATEWAY_DOMAINS"),c=Date.now(),d=[],h=a.find(y=>{var b;return ve(b=t.host).call(b,y)});h||(this.useDoubleDomain=!1);const m=[];if(this.useDoubleDomain)a.forEach(y=>{m.push(AA(IA(IA({},t),{},{host:t.host.replace(h,y)}),n))});else{const y=IA({},t);if(n&&h){const b=a.find(O=>O!==h);b&&(y.host=y.host.replace(h,b))}m.push(AA(y,n))}try{m.forEach(y=>{const b=new WebSocket(y);b.binaryType="arraybuffer",d.push(b),this.logger("ws is connecting:",b.url)})}catch(y){if(this.logger("ws create failed"),d.forEach(b=>b.close()),d.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,n,i);if(!n&&Number(t.port)!==443)return this.createWebSocket(t,!0,i);throw new se(L.WS_ERR,"init websocket failed! Error: ".concat(y.toString()))}const g=Pg();this.store&&this.store.recordJoinChannelService({urls:d.map(y=>y.url),service:"gateway"},this.recordIndex),d.forEach(y=>{y.onopen=()=>{this.logger("onopen: ws ".concat(y.url," open cost ").concat(Date.now()-c,"ms")),this.websockets.forEach(b=>{b!==y&&(b.onopen=null,b.onclose=null,b.onmessage=null,b.close(),this.logger("close backup websocket: ".concat(b.url)))}),this.websockets.length=0,g.resolve(y)},y.onclose=b=>{this.logger("onclose: ws ".concat(y.url," closed cost ").concat(Date.now()-c,"ms state: ").concat(y.readyState));const O=d.every(I=>I.readyState===WebSocket.CLOSED||I.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(O)),O&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(b.reason)),g.reject({code:b.code,reason:WS.A_ROUND_WS_FAILED})):!n&&O&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),v()),n?this.isTry443PortFailed=O:this.isNormalPortFailed=O},y.onmessage=b=>this.logger("".concat(y.url," onmessage: ").concat(b.data))}),this.websockets.push(...d);const _=()=>{this.websockets.forEach(y=>y.readyState!==WebSocket.OPEN&&y.close())},v=()=>{if(g.isResolved)return _();Pt().os===hr.MAC_OS&&pn()&&_(),this.createWebSocket(t,!0,!0).then(y=>{g.resolve(y)}).catch(y=>{this.isNormalPortFailed&&g.reject(y),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",g.isResolved),this.forceCloseTimeout=null,_()},this.forceCloseWSDuration)};return i||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,_()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",g.isResolved),this.try443PortTimeout=null,v()},this.try443PortDuration)})(),g.promise}chooseBestWebsocket(t,n,i,a){return this.useDoubleDomain=!!n,typeof t=="string"&&(t=function(c){let d,h,m;return[,d,h,m]=c.match(sae)||[],d||([,h,m]=c.match(oae)||[]),h&&m||([,h,m]=c.match(aae)||[]),h&&m||([,h]=c.match(cae)||[]),h||R.warning("un-destructible url: ",c),{proxy:d,host:h,port:m||"443"}}(t)),this.recordIndex=a,this.useProxy=!!t.proxy,i&&this.useProxy&&(R.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(t,!!i,!1).finally(()=>this.clearTimeout())}}function p3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}class m3 extends Sn{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;ve(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(ct.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(ct.CONNECTED):this._state==="closed"?this.emit(ct.CLOSED):this._state==="failed"&&this.emit(ct.FAILED))}resetReconnectCount(t){R.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],a=arguments.length>3&&arguments[3]!==void 0&&arguments[3],c=arguments.length>4&&arguments[4]!==void 0&&arguments[4],d=arguments.length>5?arguments[5]:void 0;super(),x(this,"_websocketUrl",null),x(this,"connectionID",0),x(this,"currentURLIndex",0),x(this,"urls",[]),x(this,"_reconnectMode","tryNext"),x(this,"reconnectReason",void 0),x(this,"_initMutex",void 0),x(this,"name",void 0),x(this,"_state","closed"),x(this,"reconnectInterrupter",void 0),x(this,"websocket",void 0),x(this,"retryConfig",void 0),x(this,"reconnectCount",0),x(this,"forceCloseTimeout",5e3),x(this,"onlineReconnectListener",void 0),x(this,"useCompress",void 0),x(this,"tryDoubleDomain",!1),x(this,"use443PortOnly",!1),x(this,"wsInflateLength",0),x(this,"wsDeflateLength",0),x(this,"closeEstablishingWs",()=>{}),x(this,"store",void 0),x(this,"joinGatewayRecordIndex",void 0),this.store=d,this.name=t,this.retryConfig=function(v){for(var y=1;y<arguments.length;y++){var b=arguments[y]!=null?arguments[y]:{};y%2?p3(Object(b),!0).forEach(function(O){x(v,O,b[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(b)):p3(Object(b)).forEach(function(O){Object.defineProperty(v,O,Object.getOwnPropertyDescriptor(b,O))})}return v}({},n),this.useCompress=i,this.tryDoubleDomain=a,this.use443PortOnly=c,this._initMutex=new Cr("websocket",d?d.clientId:void 0);const{timeout:h,timeoutFactor:m}=n,g=Math.max(300,Math.floor(3*h/5)),_=Math.max(1.2,Math.floor(8*m)/10);wi.ONLINE&&(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=_),Nn.on(Du.NETWORK_STATE_CHANGE,(v,y)=>{v!==y&&(this.resetReconnectCount("network state change: ".concat(y," -> ").concat(v)),v===wi.ONLINE?(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=_):(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=m))})}getConnection(){return this.websocket||void 0}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=t,this.state="connecting";try{var a;const c=Pg(),d=this.urls[this.currentURLIndex];(a=this.store)===null||a===void 0||a.beforeConnect(),function(h){return!(bS()||D("USE_NEW_TOKEN")||!D("ENABLE_PREALLOC_PC")&&(h==null||!h.autoSubscribe||D("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(ar.PRE_CONNECT_PC),this.createWebSocketConnection(d).then(c.resolve).catch(c.reject),this.once(ct.CLOSED,()=>{c.reject(new de(L.WS_DISCONNECT))}),this.once(ct.CONNECTED,c.resolve),await c.promise}catch{}finally{i()}}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;n?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void R.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),R.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new de(L.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(i){throw new de(L.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var n;const i=Pg();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const a=_=>{var v;(v=this.store)===null||v===void 0||v.signalChannelOpen(),R.debug("[".concat(this.name,"] websocket opened:"),_),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},c=async _=>{var v;if(R.debug("[".concat(this.name,"] websocket close ").concat((v=this.websocket)===null||v===void 0?void 0:v.url,", code: ").concat(_.code,", reason: ").concat(_.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new de(L.WS_DISCONNECT,"websocket close: ".concat(_.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=_.reason,this.state="reconnecting");const y=Ss(this,ct.WILL_RECONNECT,this.reconnectMode,_.reason)||this.reconnectMode,b=await this.reconnectWithAction(y);if(this.state==="closed")return void R.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!b)return i.reject(new de(L.WS_DISCONNECT,"websocket reconnect failed: ".concat(_.code))),this.close(!0);i.resolve()}},d=_=>{this.emit(ct.ON_MESSAGE,_)},h=_=>{R.warn("[".concat(this.connectionID,"] ws open error ").concat(_))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),D("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=D("GATEWAY_WSS_ADDRESS")),R.debug("[".concat(this.name,"] start connect, url:"),t);const m=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var g;this._websocketUrl=AA(t);const _=await this.chooseBestWebsocketConnection(t);this.websocket=_,a&&a(this.websocket.url),this.websocket.onclose=c,this.websocket.onmessage=d,this.websocket.onerror=h,(g=this.store)===null||g===void 0||g.recordJoinChannelService({endTs:Date.now(),status:"success"},m),this.joinGatewayRecordIndex=m}catch(_){const v=this.state==="closed",y=_ instanceof de,b=y&&_.code===L.WS_ABORT,O=y&&_.code===L.WS_ERR,I=y?_.message:_&&(_.reason||_.toString());R.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(I)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:b?"aborted":"error",errors:[_]},m),v||O?(i.reject(v?new de(L.WS_DISCONNECT,"websocket is closed: ".concat(I)):new de(L.WS_ERR,"init websocket failed: ".concat(I))),O&&R.error("[".concat(this.name,"] init websocket failed: ").concat(I))):c&&c(_)}return i.promise}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;R.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Nn.isOnline||!Nn.onlineWaiter||(this.onlineReconnectListener=Nn.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,n){const d=fS(this.reconnectCount,this.retryConfig);R.debug("[".concat(this.name,"] wait ").concat(d,"ms to reconnect websocket, mode: ").concat(t)),await we.race([pr(d),this.onlineReconnectListener||new we(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;const a=async(d,h)=>{this.emit(ct.RECONNECT_CREATE_CONNECTION,h),await this.createWebSocketConnection(d)};try{if(t==="retry")await a(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);R.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await a(this.urls[this.currentURLIndex],t)}else t==="recover"&&(R.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Zn(this,ct.REQUEST_NEW_URLS),this.currentURLIndex=0,await a(this.urls[this.currentURLIndex],t))}catch(d){var c;R.error("[".concat(this.name,"] reconnect failed ").concat(d&&d.toString()));const h=d==null||(c=d.data)===null||c===void 0?void 0:c.desc;if(Array.isArray(h)){if(ve(h).call(h,"dynamic key expired"))return this.emit(ct.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1;if(ve(h).call(h,"request downgrade fallback"))return this.emit(ct.ON_FALLBACK),!1}return this.reconnectWithAction(t,n)}return!0}}class NA extends m3{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){const i=Pg(),a=function(d,h){return new dae(d,h)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{R.debug("[choose-best-ws] close establishing websockets"),a.closeAllWebsockets(),i.reject(new de(L.WS_ABORT,"choose best websocket aborted"))};const c=D("GATEWAY_DOMAINS");return R.debug("[choose-best-ws] currentDomain: ",t,", domains: ",c,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),a.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,n).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Hg extends m3{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){return new we((i,a)=>{let c=!1;const d=[];this.closeEstablishingWs=()=>{R.debug("[choose-best-ws] close establishing websockets"),d.forEach(O=>{O.onclose=null,O.onopen=null,O.onmessage=null,O.close()}),a(new de(L.WS_ABORT,"choose best websocket aborted"))};const h=D("GATEWAY_DOMAINS");let m;const g=t.indexOf("?h="),_=h.find(O=>g!==-1?ve(t).call(t,O,g):ve(t).call(t,O));R.debug("[choose-best-ws] currentDomain: ",_,", domains: ",h);let v=!this.tryDoubleDomain||!_;if(!v&&_){var y;const O=Date.now();try{h.forEach(I=>{const N=g===-1?t.replace(_,I):t.substr(0,g)+t.substr(g).replace(_,I),k=new WebSocket(N);k.binaryType="arraybuffer",d.push(k),R.debug("[choose-best-ws] ws is connecting:",k.url)})}catch{for(R.debug("[choose-best-ws] ws create failed, fallback to single url"),d.forEach(N=>N.close());d.length;)d.pop();v=!0}(y=this.store)===null||y===void 0||y.recordJoinChannelService({urls:d.map(I=>I.url),service:"gateway"},n),d.forEach(I=>{I.onopen=()=>{if(c)return;const N=Date.now()-O;R.debug("[choose-best-ws] ws open cost ".concat(N,"ms")),d.filter(k=>k!==I).forEach(k=>{R.debug("[choose-best-ws]close backup websocket: ".concat(k.url)),k.close()}),c=!0,i(I)},I.onclose=N=>{m=N,!c&&(d.find(k=>!(k.readyState===WebSocket.CLOSED||k.readyState===WebSocket.CLOSING))||(R.debug("[choose-best-ws] all websocket is closed"),c=!0,a(m)))},I.onmessage=N=>{R.debug("[choose-best-ws]".concat(I.url," onmessage: ").concat(N.data))}}),pr(this.forceCloseTimeout).then(()=>{d.forEach(I=>{I.readyState!==WebSocket.OPEN&&I.close()})})}if(v){var b;let O;R.debug("[choose-best-ws] use single url: ",t),(b=this.store)===null||b===void 0||b.recordJoinChannelService({urls:[t],service:"gateway"},n);try{O=new WebSocket(t),d.push(O),O.binaryType="arraybuffer"}catch(I){const N=new de(L.WS_ERR,"init websocket failed! Error: ".concat(I.toString()));return R.error("[".concat(this.name,"]").concat(N)),void a(N)}O.onopen=()=>{i(O)},O.onclose=I=>{a(I)},O.onmessage=I=>{R.debug("[choose-best-ws]".concat(O.url," onmessage: ").concat(I.data))},pr(this.forceCloseTimeout).then(()=>{O&&O.readyState!==WebSocket.OPEN&&O.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}}class f3 extends Sn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===bt.CONNECTED?this.emit(Ue.WS_CONNECTED):t===bt.RECONNECTING?this.emit(Ue.WS_RECONNECTING,this._websocketReconnectReason):t===bt.CLOSED&&this.emit(Ue.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),x(this,"__name__","AgoraRTCSignal"),x(this,"_disconnectedReason",void 0),x(this,"_websocketReconnectReason",void 0),x(this,"_connectionState",bt.CLOSED),x(this,"reconnectToken",void 0),x(this,"websocket",void 0),x(this,"openConnectionTime",void 0),x(this,"clientId",void 0),x(this,"lastMsgTime",Date.now()),x(this,"uploadCache",[]),x(this,"uploadCacheInterval",void 0),x(this,"rttRolling",new LI(5)),x(this,"pingpongTimer",void 0),x(this,"wsInflateDataTimer",void 0),x(this,"pingpongTimeoutCount",0),x(this,"ortc",void 0),x(this,"joinResponse",void 0),x(this,"multiIpOption",void 0),x(this,"initError",void 0),x(this,"spec",void 0),x(this,"store",void 0),x(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(Ue.ON_BINARY_DATA,i.data);const a=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(a,"_id")){const c="res-@".concat(a._id);this.emit(c,a._result,a._message)}else if(Object.prototype.hasOwnProperty.call(a,"_type")){if(this.emit(a._type,a._message),a._type===Ze.ON_NOTIFICATION&&this.handleNotification(a._message),a._type===Ze.ON_USER_BANNED)switch(a._message.error_code){case 14:this.close(Tt.UID_BANNED);break;case 15:this.close(Tt.IP_BANNED);break;case 16:this.close(Tt.CHANNEL_BANNED)}if(a._type===Ze.ON_USER_LICENSE_BANNED)switch(a._message.error_code){case We.ERR_LICENSE_MISSING:this.close(Tt.LICENSE_MISSING);break;case We.ERR_LICENSE_EXPIRED:this.close(Tt.LICENSE_EXPIRED);break;case We.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Tt.LICENSE_MINUTES_EXCEEDED);break;case We.ERR_LICENSE_PERIOD_INVALID:this.close(Tt.LICENSE_PERIOD_INVALID);break;case We.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Tt.LICENSE_MULTIPLE_SDK_SERVICE);break;case We.ERR_LICENSE_ILLEGAL:this.close(Tt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new NA("gateway-".concat(this.clientId),this.spec.retryConfig,!0,D("JOIN_GATEWAY_USE_DUAL_DOMAIN"),D("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===bt.CONNECTED&&this.reconnect("retry",Wr.OFFLINE)})}async request(t,n,i,a){const c=Wt(6,""),d={_id:c,_type:t,_message:n},h=this.websocket.connectionID,m=()=>new we((O,I)=>{if(this.connectionState===bt.CONNECTED)return O();const N=()=>{this.off(Ue.WS_CLOSED,k),O()},k=()=>{this.off(Ue.WS_CONNECTED,N),I(new se(L.WS_ABORT))};this.once(Ue.WS_CONNECTED,N),this.once(Ue.WS_CLOSED,k),t!==Ve.PUBLISH&&t!==Ve.PUBLISH_DATASTREAM&&t!==Ve.SUBSCRIBE&&t!==Ve.SUBSCRIBE_DATASTREAM&&t!==Ve.UNSUBSCRIBE&&t!==Ve.UNSUBSCRIBE_DATASTREAM&&t!==Ve.UNPUBLISH&&t!==Ve.UNPUBLISH_DATASTREAM&&t!==Ve.CONTROL&&t!==Ve.RESTART_ICE||this.once(Ue.DISCONNECT_P2P,()=>{I(new se(L.DISCONNECT_P2P))}),t!==Ve.PUBLISH&&t!==Ve.RESTART_ICE||this.once(Ue.ABORT_P2P_EXECUTION,()=>{I(new se(L.DISCONNECT_P2P))})});if(this.connectionState!==bt.CONNECTING&&this.connectionState!==bt.RECONNECTING||t===Ve.JOIN||t===Ve.REJOIN||await m(),this.websocket.sendMessage(d,!0),a)return;const g=new we((O,I)=>{let N=!1;const k=(G,K)=>{N=!0,O({isSuccess:G==="success",message:K||{}}),this.off(Ue.WS_CLOSED,j),this.off(Ue.WS_RECONNECTING,j),this.emit(Ue.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(c),k);const j=()=>{I(new se(L.WS_ABORT,"type: ".concat(t))),this.off(Ue.WS_CLOSED,j),this.off(Ue.WS_RECONNECTING,j),this.off("res-@".concat(c),k)};this.once(Ue.WS_CLOSED,j),this.once(Ue.WS_RECONNECTING,j),pr(D("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==h||N||(R.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Ue.REQUEST_TIMEOUT,t,n))})});let _=null;try{_=await g}catch(O){if(this.connectionState===bt.CLOSED||t===Ve.LEAVE)throw new se(L.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?O.throw():t===Ve.JOIN||t===Ve.REJOIN?null:(await m(),await this.request(t,n))}if(_.isSuccess)return _.message;const v=Number(_.message.error_code||_.message.code),y=Xu(v),b=new se(L.UNEXPECTED_RESPONSE,"".concat(y.desc,": ").concat(_.message.error_str),{code:v,data:_.message,desc:y.desc});return y.action==="success"?_.message:(R.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(v,", message: ").concat(y.desc,", action: ").concat(y.action)),v===We.ERR_TOO_MANY_BROADCASTERS?((t===Ve.JOIN||t===Ve.REJOIN)&&(this.initError=b,this.close()),b.throw()):y.action==="failed"?b.throw():y.action==="quit"?(this.initError=b,this.close(),b.throw()):(v===We.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Wr.MULTI_IP)):this.reconnect(y.action,Wr.SERVER_ERROR),t===Ve.JOIN||t===Ve.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new we(i=>{const a=c=>{(!n||n(c))&&(this.off(t,a),i(c))};this.on(t,a)})}uploadWRTCStats(t){if(!this.store.sessionId)return void R.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Yu.WRTC_STATS,n)}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const c=D("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>c&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==bt.CONNECTED)return;const d=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(d._type,d._message)},D("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const i={_type:t,_message:n};this.websocket.sendMessage(i)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new we((n,i)=>{this.once(Ue.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Ue.WS_CLOSED,a=>i(this.initError||new se(L.WS_ABORT,a))),this.connectionState=bt.CONNECTING,this.websocket.init(t).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Tt.LEAVE,this.connectionState=bt.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Ue.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await Zn(this,Ue.REQUEST_JOIN_INFO);this.store.joinReq();const n=await this.request(Ve.JOIN,t);if(this.ortc=t==null?void 0:t.ortc,this.store.joinRep(),!n)return this.emit(Ue.REPORT_JOIN_GATEWAY,WS.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Ue.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=bt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new se(L.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=ku(this,Ue.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(Ve.REJOIN,t);return!!n&&(this.connectionState=bt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(i=>{this.emit(Ze.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(Ze.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(Ze.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(Ze.MUTE_AUDIO,{uid:i.uid}):this.emit(Ze.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(Ze.MUTE_VIDEO,{uid:i.uid}):this.emit(Ze.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(Ze.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(Ze.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(Ze.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(Ze.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(Ze.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){if(!this.ortc)return!1;const n={downgrade_codec:t,ortc:this.ortc};return!!await this.request(Ve.DOWNGRADE_CODEC,n)}handleNotification(t){R.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Xu(t.code);if(t.code===28&&"detail"in t&&(R.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(Ue.RECOVER_NOTIFICATION,t.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?t.code===We.ERR_REPEAT_JOIN_CHANNEL&&D("IGNORE_UID_CHECK")?void this.close(Tt.UID_CONFLICT):(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Tt.UID_BANNED),void this.close()):t.code===We.K_VOS_FALLBACK&&"detail"in t?(R.info("[".concat(this.clientId,"] receive vos fallback notification: "),t.detail),t.detail==="FALLBACKCN"&&D("ENABLE_QUALITY_FALLBACK")?void Zn(this,Ue.VOS_FALLBACK_PROMISE,t.detail).then(()=>{this.reconnect("recover",n.desc)}).catch(i=>{R.debug("[".concat(this.clientId,"] cancel vos fallback cn, error: "),i)}):t.detail==="fallback_hls"&&D("ENABLE_FALLBACK_TO_HLS")?(this.emit(Ue.VOS_FALLBACK,t.detail),void this.close(Tt.FALLBACK_TO_HLS)):this.reconnect(n.action,n.desc)):void this.reconnect(n.action,Wr.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=D("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(R.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>D("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Wr.TIMEOUT):this.request(Ve.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),D("REPORT_STATS")&&this.send(Ve.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(Yu.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(ct.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Ue.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(ct.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(ct.CLOSED,()=>{this.connectionState=bt.CLOSED}),this.websocket.on(ct.FAILED,()=>{this._disconnectedReason=Tt.NETWORK_ERROR,this.connectionState=bt.CLOSED}),this.websocket.on(ct.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===bt.CONNECTED?this.connectionState=bt.RECONNECTING:this.connectionState=bt.CONNECTING}),this.websocket.on(ct.WILL_RECONNECT,(t,n,i)=>{const a=ku(this,Ue.IS_P2P_DISCONNECTED),c=a||t!=="retry";a&&t==="retry"&&(R.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=WS.P2P_DISCONNECTED),c&&(R.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(Ue.REPORT_JOIN_GATEWAY,n||WS.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Ue.DISCONNECT_P2P)),i(t)}),this.websocket.on(ct.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{R.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Wr.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Ue.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof se){if(t.code===L.UNEXPECTED_RESPONSE&&t.data.code===We.ERR_NO_AUTHORIZED)return this.initError=new se(L.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Tt.TOKEN_EXPIRE);R.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Wr.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(ct.REQUEST_NEW_URLS,(t,n)=>{Zn(this,Ue.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(ct.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ze.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(ar.PRE_CONNECT_PC,()=>{this.emit(Ue.PRE_CONNECT_PC)}),this.websocket.on(ct.ON_FALLBACK,()=>{D("ENABLE_FALLBACK_TO_HLS")&&this.emit(Ue.VOS_FALLBACK,"fallback_hls")})}}let uae=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),qn=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function g3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function KS(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?g3(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g3(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let xA=0;function jo(e){const t=D("TURN_DOMAINS");xA=(xA+1)%t.length;const n=t[xA]||"edge.agora.io";return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(n):(R.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function qS(e){try{const t=D("TURN_DOMAINS"),n=D("GATEWAY_DOMAINS").concat(t).find(i=>ve(e).call(e,i));return n?e.split(".".concat(n))[0].replace(/-/g,"."):e}catch{return R.debug("serverUrlToIp error, fallback to url",e),e}}function OA(e,t){e.addresses||(e.addresses=[]);const n=function(h,m){if(D("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return h.map(v=>{let{ip:y,port:b}=v;return{address:"".concat(y,":").concat(b)}});const g=D("GATEWAY_DOMAINS");let _=g[1]&&ve(m).call(m,g[1])?1:0;return h.map(v=>{let{domain_prefix:y,port:b,ip:O}=v;if(y)return{address:"".concat(y,".").concat(g[_++%g.length],":").concat(b)};const I=/^[\.\:\d]+$/.test(O),N=I?"".concat(O.replace(/[^\d]/g,"-"),".").concat(g[_++%g.length],":").concat(b):"".concat(O,":").concat(b);return I||R.debug("Cannot recognized as ip address: ".concat(O,", use as host3")),{ip:O,port:b,address:N}})}(e.addresses,t),i=Array.isArray(e.detail)&&e.detail[18];if(i&&typeof i=="string"){const h=i.split(";");for(let m=0;m<h.length;m++){var a;const g=bi(a=h[m]).call(a);n[m]&&g&&(n[m].ip6=g)}}const c=e.detail&&e.detail.candidate;let d;if(c){const[h,m]=c.split(":");h&&m&&(d={port:Number(m),ip:h,address:"".concat(h,":").concat(m)})}return{gatewayAddrs:n,apGatewayAddress:d,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Fi(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function _3(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(Fi(t.width),"x").concat(Fi(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function YS(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Kg(e,t){let n,i,a;switch(t){case qn.CHOOSE_SERVER:i=4096,a="choose server";break;case qn.CLOUD_PROXY:i=1048576,a="proxy";break;case qn.CLOUD_PROXY_5:i=4194304,a="proxy5";break;case qn.CLOUD_PROXY_FALLBACK:i=4194310,a="proxy fallback";break;default:throw new se(L.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(c=>{c.buffer&&c.buffer.flag===i&&(n={code:c.buffer.code,addresses:(c.buffer.edges_services||[]).map(d=>KS(KS({},d),{},{ticket:c.buffer.cert})),server_ts:e.enter_ts,uid:c.buffer.uid,cid:c.buffer.cid,cname:c.buffer.cname,detail:KS(KS({},c.buffer.detail),e.detail),flag:c.buffer.flag,opid:e.opid,cert:c.buffer.cert})}),!n)throw new se(L.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(a," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function E3(e,t){return await we.all(e.addresses.map(async n=>({address:jo(n.ip),tcpport:n.port,udpport:n.port,username:t&&D("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():zr.username,password:t&&D("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await AI(t.toString()):zr.password})))}function PA(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),i=t.videoHeight||n.height,a=t.videoWidth||n.width;return i&&a?Math.max(Math.min(i,a)/Math.min(Fi(e.height),Fi(e.width)),1):(R.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function sd(e){let{candidateType:t,relayProtocol:n,type:i,address:a,port:c,protocol:d}=e;const h={candidateType:t,relayProtocol:n,protocol:d};if(i!=="local-candidate"){const m=a.split(".");m.length>=4&&(m[1]="*",m[2]="*"),h.address=m.join("."),h.port=c}return h}function ac(e){const t=e.split(":"),n=e.split(/[-.]/),i=ve(e).call(e,"-")?"-":".";let a=e;return t.length>1?n.length>1?(n[1]="**",a=n[0]+i+"**:"+t[t.length-1]):a=t.length>2?t[0]+i+"**:"+t[t.length-1]:"**:"+t[t.length-1]:n.length>1&&(a=n[0]+i+"**"),a}function v3(e,t){return e.getTransceivers().find(n=>n.sender.track===t||n.receiver.track===t)}function qg(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:D("SVC_MODE");if(D("ENABLE_SVC"))return function(t){return t in ES}(e)?e:ES.L1T3}const y3={[De.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[De.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function S3(e){e.send&&(om(De.VIDEO,e.send.videoExtensions),om(De.AUDIO,e.send.audioExtensions)),e.recv&&(om(De.VIDEO,e.recv.videoExtensions),om(De.AUDIO,e.recv.audioExtensions)),e.sendrecv&&(om(De.VIDEO,e.sendrecv.videoExtensions),om(De.AUDIO,e.sendrecv.audioExtensions))}function T3(e,t){e.send&&(XS(De.VIDEO,e.send.videoExtensions,t.send.videoExtensions),XS(De.AUDIO,e.send.audioExtensions,t.send.audioExtensions)),e.recv&&(XS(De.VIDEO,e.recv.videoExtensions,t.recv.videoExtensions),XS(De.AUDIO,e.recv.audioExtensions,t.recv.audioExtensions))}function XS(e,t,n){t.forEach(i=>{var a;const c=y3[e].find(h=>{var m;let{key:g}=h;return ve(m=i.extensionName).call(m,g)});if(!c)return;const d=n.find(h=>{let{extensionName:m}=h;return ve(m).call(m,c.key)});d&&ve(a=d.extensionName).call(a,"gdpr_forbidden")&&(i.extensionName=d.extensionName)})}function om(e,t){t.forEach(n=>{var i;const a=y3[e].find(c=>{var d;let{key:h}=c;return ve(d=n.extensionName).call(d,h)});ve(i=n.extensionName).call(i,"gdpr_forbidden")&&a&&(n.extensionName=a.extensionName)})}function b3(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||ve(e).call(e,"abs-send-time")}function JS(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||ve(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function R3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function w3(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?R3(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R3(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function Yg(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const{filterRTX:a,filterVideoFec:c,filterAudioFec:d,filterAudioCodec:h,filterVideoCodec:m,unsupportedVideoUplinkCodec:g,unsupportedVideoDownlinkCodec:_}=t,{useXR:v}=n;let y=[],b=[],O=[],I=[],N=!1,k=!1;if(Ci(e).mediaDescriptions.forEach(G=>{i&&i!==G.attributes.direction||(G.media.mediaType!=="video"||N||(b=G.attributes.payloads,I=G.attributes.extmaps,N=!0),G.media.mediaType!=="audio"||k||(y=G.attributes.payloads,O=G.attributes.extmaps,k=!0))}),!I||b.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!O||y.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(b.forEach(G=>{var K;(K=G.rtpMap)!==null&&K!==void 0&&K.clockRate&&(G.rtpMap.clockRate=parseInt(G.rtpMap.clockRate)),v&&G.rtcpFeedbacks.push({type:"rrtr"})}),y.forEach(G=>{var K;(K=G.rtpMap)!==null&&K!==void 0&&K.clockRate&&(G.rtpMap.clockRate=parseInt(G.rtpMap.clockRate)),v&&G.rtcpFeedbacks.push({type:"rrtr"})}),a&&(y=y.filter(G=>{var K;return((K=G.rtpMap)===null||K===void 0?void 0:K.encodingName.toLowerCase())!=="rtx"}),b=b.filter(G=>{var K;return((K=G.rtpMap)===null||K===void 0?void 0:K.encodingName.toLowerCase())!=="rtx"})),c){const G=b.filter(z=>{var ne;return/(red)|(ulpfec)|(flexfec)/i.test(((ne=z.rtpMap)===null||ne===void 0?void 0:ne.encodingName)||"")}),K=od(G,b).map(z=>z.payloadType),X=[...G.map(z=>z.payloadType),...K];b=b.filter(z=>!ve(X).call(X,z.payloadType))}if(d&&(y=y.filter(G=>{var K;return!/(red)|(ulpfec)|(flexfec)/i.test(((K=G.rtpMap)===null||K===void 0?void 0:K.encodingName)||"")})),h&&(h==null?void 0:h.length)>0&&(y=y.filter(G=>{var K;return ve(h).call(h,((K=G.rtpMap)===null||K===void 0?void 0:K.encodingName.toLowerCase())||"")})),m&&(m==null?void 0:m.length)>0){const G=b.filter(K=>{var X;return ve(m).call(m,((X=K.rtpMap)===null||X===void 0?void 0:X.encodingName.toLowerCase())||"")});b=G.concat(a?[]:od(G,b))}const j=D("UNSUPPORTED_VIDEO_CODEC");if(j&&j.length>0){const G=b.filter(z=>z.rtpMap&&ve(j).call(j,z.rtpMap.encodingName.toLowerCase())),K=od(G,b),X=G.concat(K).map(z=>z.payloadType);b=b.filter(z=>!ve(X).call(X,z.payloadType)),R.debug("unsupportedVideoCodec: ".concat(j,", toBeRemoved: ").concat(X))}if(g&&g.length>0&&i==="sendonly"){const G=b.filter(z=>z.rtpMap&&ve(g).call(g,z.rtpMap.encodingName.toLowerCase())),K=od(G,b),X=G.concat(K).map(z=>z.payloadType);b=b.filter(z=>!ve(X).call(X,z.payloadType)),R.debug("unsupportedVideoUplinkCodec: ".concat(g,", toBeRemoved: ").concat(X))}if(_&&_.length>0&&i==="recvonly"){const G=b.filter(z=>z.rtpMap&&ve(_).call(_,z.rtpMap.encodingName.toLowerCase())),K=od(G,b),X=G.concat(K).map(z=>z.payloadType);b=b.filter(z=>!ve(X).call(X,z.payloadType)),R.debug("unsupportedVideoDownlinkCodec: ".concat(_,", toBeRemoved: ").concat(X))}return{audioCodecs:y,videoCodecs:b,audioExtensions:O,videoExtensions:I}}function cc(e){const t=Ci(e);let n,i;for(const a of t.mediaDescriptions){if(!n){const c=a.attributes.iceUfrag,d=a.attributes.icePwd;if(!c||!d)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:c,icePwd:d}}if(!i){const c=a.attributes.fingerprints;c.length>0&&(i={fingerprints:c})}}if(!i&&t.attributes.fingerprints.length>0&&(i={fingerprints:t.attributes.fingerprints}),!i||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:i}}function DA(e,t){const n=[],i=e.attributes.ssrcGroups.filter(d=>d.semantic==="FID"),a=e.attributes.ssrcGroups.find(d=>d.semantic==="SIM"),c=e.attributes.ssrcs;if(a)a.ssrcIds.forEach(d=>{var h;const m=(h=i.find(g=>g.ssrcIds[0]===d))===null||h===void 0?void 0:h.ssrcIds[1];n.push({ssrcId:d,rtx:t?m:void 0})});else if(i.length>0){const d=i[0].ssrcIds[0],h=i[0].ssrcIds[1];n.push({ssrcId:d,rtx:t?h:void 0})}else{if(c.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:c[0].ssrcId})}return n}function C3(e,t,n){const{cname:i}=e;let a=[];t&&(a=I3(t)),a.length===0&&(a=e.iceParameters.candidates.map(_=>({foundation:_.foundation,componentId:"1",transport:_.protocol,priority:_.priority.toString(),connectionAddress:_.ip,port:_.port.toString(),type:_.type,extension:{}})),R.debug("Using candidates from gateway."));const c={fingerprints:e.dtlsParameters.fingerprints.map(_=>({hashFunction:_.algorithm,fingerprint:_.fingerprint}))},d={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let h;switch(e.dtlsParameters.role){case"server":h="passive";break;case"client":h="active";break;case"auto":h="actpass"}const m=Jg(e.rtpCapabilities),g=[];return Array.isArray(n)&&n.length>0&&n.forEach(_=>{g.push({kind:De.VIDEO,ssrcMsg:[{ssrcId:_.v,rtx:_.v_rtx}],mslabel:"".concat(_.v,"_").concat(_.a)},{kind:De.AUDIO,ssrcMsg:[{ssrcId:_.a}],mslabel:"".concat(_.v,"_").concat(_.a)})}),{dtlsParameters:c,iceParameters:d,candidates:a,rtpCapabilities:m,setup:h,cname:i,preSSRCs:g}}function I3(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],R.debug("Using remote candidate from AP ".concat(ac(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),R.debug("Using IPV6 remote candidate from AP ".concat(ac(e.ip6),":").concat(e.port)))),t}function Xg(e,t,n){const i=[],a=[];return e.forEach(c=>{let{ssrcId:d,rtx:h}=c;const m=Wt(8,"track-"),g={ssrcId:d,attributes:w3({label:m,mslabel:n=n||Wt(10,""),msid:"".concat(n," ").concat(m)},t&&{cname:t})};if(i.push(g),h!==void 0){const _={ssrcId:h,attributes:w3({label:m,mslabel:n,msid:"".concat(n," ").concat(m)},t&&{cname:t})};i.push(_),a.push({semantic:"FID",ssrcIds:[d,h]})}}),e.length>1&&a.push({semantic:"SIM",ssrcIds:e.map(c=>{let{ssrcId:d}=c;return d})}),{ssrcs:i,ssrcGroups:a}}function Ju(e,t){t instanceof Dn&&e.attributes.payloads.forEach(n=>{var i;const a=(i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!a||["opus","pcmu","pcma","g722"].indexOf(a)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),a==="opus"&&typeof D("OPUS_PTIME")=="number"?n.fmtp.parameters.ptime=D("OPUS_PTIME"):n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const c=t._encoderConfig;c&&(a!=="pcmu"&&a!=="pcma"&&a!=="g722"&&(c.bitrate&&!pn()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*c.bitrate))),c.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(c.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(c.sampleRate)),c.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1")),t instanceof Wg&&a==="opus"&&t._config.DTX&&(n.fmtp.parameters.usedtx="1"))})}function kA(e){const t=e.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function LA(e,t){var n;if(e.attributes.payloads.forEach(a=>{var c;((c=a.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())==="h264"&&a.fmtp&&a.fmtp.parameters&&D("ENABLE_UP_SPS_PPS")&&(a.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),!(t instanceof sn&&t._encoderConfig&&t._hints.indexOf(Bt.SCREEN_TRACK)===-1))return;const i=t._encoderConfig;vt().supportMinBitrate&&i.bitrateMin&&e.attributes.payloads.forEach(a=>{var c,d;ve(c=["h264","h265","vp8","vp9","av1"]).call(c,((d=a.rtpMap)===null||d===void 0?void 0:d.encodingName.toLowerCase())||"")&&(a.fmtp||(a.fmtp={parameters:{}}),a.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),vt().supportMinBitrate&&!ve(n=t._hints).call(n,Bt.LOW_STREAM)&&i.bitrateMax&&e.attributes.payloads.forEach(a=>{var c,d;ve(c=["h264","h265","vp8","vp9","av1"]).call(c,((d=a.rtpMap)===null||d===void 0?void 0:d.encodingName.toLowerCase())||"")&&(a.fmtp||(a.fmtp={parameters:{}}),a.fmtp.parameters["x-google-start-bitrate"]="".concat(D("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function A3(e){if(e.media.mediaType!=="video")return;const t=Pt();if(t.name!==Mt.SAFARI&&t.os!==hr.IOS)return;const n=e.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));n!==-1&&e.attributes.extmaps.splice(n,1)}function QS(e,t,n){if(!t)return;let i,a;if(e.media.mediaType==="video"?(i=n.videoExtensions,a=n.videoCodecs):(i=n.audioExtensions,a=n.audioCodecs),t.twcc===!0){const c=i.find(d=>JS(d.extensionName));if(c){const d=c.extensionName;e.attributes.extmaps.find(m=>JS(m.extensionName))||e.attributes.extmaps.push({entry:c.entry,extensionName:d}),function(m,g){return g.filter(_=>!!m.find(v=>v.payloadType===_.payloadType&&!!v.rtcpFeedbacks.find(y=>y.type==="transport-cc")))}(a,e.attributes.payloads).forEach(m=>{m.rtcpFeedbacks.find(g=>g.type==="transport-cc")||m.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){const c=e.attributes.extmaps.findIndex(d=>JS(d.extensionName));c!==-1&&e.attributes.extmaps.splice(c,1),e.attributes.payloads.forEach(d=>{const h=d.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&d.rtcpFeedbacks.splice(h,1)})}if(t.remb===!0){const c=i.find(d=>b3(d.extensionName));if(c){const d=c.extensionName;e.attributes.extmaps.find(m=>m.extensionName===d)||e.attributes.extmaps.push({entry:c.entry,extensionName:d}),function(m,g){return g.filter(_=>!!m.find(v=>v.payloadType===_.payloadType&&!!v.rtcpFeedbacks.find(y=>y.type==="goog-remb")))}(a,e.attributes.payloads).forEach(m=>{m.rtcpFeedbacks.find(g=>g.type==="goog-remb")||m.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){const c=e.attributes.extmaps.findIndex(d=>b3(d.extensionName));c!==-1&&e.attributes.extmaps.splice(c,1),e.attributes.payloads.forEach(d=>{const h=d.rtcpFeedbacks.findIndex(m=>m.type==="goog-remb");h!==-1&&d.rtcpFeedbacks.splice(h,1)})}}function MA(e,t,n){if(pn()||e.media.mediaType!=="video"||!(t instanceof sn)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!D("SIMULCAST")||n==="vp9"&&D("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const i=n==="vp8"?2:t._scalabilityMode.numSpatialLayers,a=e.attributes.ssrcs[0],c=e.attributes.ssrcGroups.find(h=>h.semantic==="FID"&&h.ssrcIds[0]===a.ssrcId),d={semantic:"SIM",ssrcIds:[a.ssrcId]};for(let h=1;h<i;h++)e.attributes.ssrcs.push({ssrcId:a.ssrcId+h,attributes:mn(a.attributes)}),d.ssrcIds.push(a.ssrcId+h),c&&(e.attributes.ssrcs.push({ssrcId:c.ssrcIds[1]+h,attributes:mn(a.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[a.ssrcId+h,c.ssrcIds[1]+h]}));e.attributes.ssrcGroups.unshift(d)}async function N3(){try{const e=new RTCPeerConnection;e.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:ES.L1T3}]});const t=await e.createOffer();if(!t.sdp)return void e.close();const n=Ci(t.sdp).mediaDescriptions[0];if(!n)return;const i=n.attributes.extmaps.find(a=>a.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return e.close(),i}catch{return}}async function UA(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const i=(await n.createOffer()).sdp,{send:a,recv:c,sendrecv:d}=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},g=arguments.length>2?arguments[2]:void 0;const _=Yg(g,h,m,"sendonly"),v=Yg(g,h,m,"recvonly"),y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Vo(_,v,"videoExtensions",y,b,O),Vo(_,v,"videoCodecs",y,b,O),Vo(_,v,"audioExtensions",y,b,O),Vo(_,v,"audioCodecs",y,b,O),D("RAISE_H264_BASELINE_PRIORITY")){const I=[],N=[];if(O.videoCodecs.forEach((k,j)=>{var G;if(((G=k.rtpMap)===null||G===void 0?void 0:G.encodingName.toLocaleLowerCase())==="h264"){var K,X;const z=O.videoCodecs[j+1],ne=z&&D3(k,z),me=(K=k.fmtp)===null||K===void 0?void 0:K.parameters["profile-level-id"],Ee=(X=k.fmtp)===null||X===void 0?void 0:X.parameters["packetization-mode"];!me||me!==D("FIRST_H264_PROFILE_LEVEL_ID")||D("FIRST_PACKETIZATION_MODE")&&Ee!==D("FIRST_PACKETIZATION_MODE")?ne?N.push([k,z]):N.push([k]):ne?I.push([k,z]):I.push([k])}}),I.length>0&&N.length>0){R.debug("raising H264 baseline profile priority"),O.videoCodecs.forEach((j,G)=>{var K;if(((K=j.rtpMap)===null||K===void 0?void 0:K.encodingName.toLocaleLowerCase())==="h264"){const X=D3(j,O.videoCodecs[G+1]),z=I.shift()||N.shift()||[];z.length>0&&(X?O.videoCodecs.splice(G,2,...z):O.videoCodecs.splice(G,1,...z))}});const k=b.videoCodecs.filter(j=>{var G,K;return((G=j.rtpMap)===null||G===void 0?void 0:G.encodingName.toLocaleLowerCase())==="h264"&&((K=j.fmtp)===null||K===void 0?void 0:K.parameters["profile-level-id"])!==D("FIRST_H264_PROFILE_LEVEL_ID")});if(k.length>0){const j=od(k,b.videoCodecs).map(K=>K.payloadType),G=[...k.map(K=>K.payloadType),...j];b.videoCodecs=b.videoCodecs.filter(K=>!ve(G).call(G,K.payloadType))}D("FILTER_SEND_H264_BASELINE")&&(y.videoCodecs=y.videoCodecs.filter(j=>{var G,K;return!(((G=j.rtpMap)===null||G===void 0?void 0:G.encodingName.toLocaleLowerCase())==="h264"&&((K=j.fmtp)===null||K===void 0?void 0:K.parameters["profile-level-id"])!==D("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:y,recv:b,sendrecv:O}}return{send:y,recv:b,sendrecv:O}}(e,t,i);try{n.close()}catch{}return{send:a,recv:c,sendrecv:d}}function x3(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=Yg(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Vo(e,t,"videoExtensions",n,i,a),Vo(e,t,"videoCodecs",n,i,a),Vo(e,t,"audioExtensions",n,i,a),Vo(e,t,"audioCodecs",n,i,a),D("RAISE_H264_BASELINE_PRIORITY")){const c=a.videoCodecs.findIndex(d=>d.rtpMap&&d.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&d.fmtp&&d.fmtp.parameters["profile-level-id"]==="42001f");if(c!==-1){const d=a.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(d<c){R.debug("raising H264 baseline profile priority");const h=a.videoCodecs[c];a.videoCodecs.splice(c,1),a.videoCodecs.splice(d,0,h)}d!==-1&&(i.videoCodecs=i.videoCodecs.filter(h=>!(h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:i,sendrecv:a}}function Vo(e,t,n,i,a,c){if(n==="videoExtensions"||n==="audioExtensions"){const d=[];return e[n].forEach(h=>{t[n].some((m,g)=>{if(h.entry===m.entry&&h.extensionName===m.extensionName)return d.push(g),!0})?c[n].push(h):i[n].push(h)}),void t[n].forEach((h,m)=>{d.indexOf(m)===-1&&a[n].push(h)})}if(n==="videoCodecs"||n==="audioCodecs"){const d=[];return e[n].forEach(h=>{t[n].some((m,g)=>{if(h.payloadType===m.payloadType&&JSON.stringify(h)===JSON.stringify(m))return d.push(g),!0})?c[n].push(h):i[n].push(h)}),void t[n].forEach((h,m)=>{d.indexOf(m)===-1&&a[n].push(h)})}}function Jg(e){const{send:t,recv:n,sendrecv:i}=e;if(!i){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let a,c;return t?(a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a.audioCodecs=[...t.audioCodecs,...i.audioCodecs],a.videoCodecs=[...t.videoCodecs,...i.videoCodecs],a.audioExtensions=[...t.audioExtensions,...i.audioExtensions],a.videoExtensions=[...t.videoExtensions,...i.videoExtensions]):a=mn(i),n?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...n.audioCodecs,...i.audioCodecs],c.videoCodecs=[...n.videoCodecs,...i.videoCodecs],c.audioExtensions=[...n.audioExtensions,...i.audioExtensions],c.videoExtensions=[...n.videoExtensions,...i.videoExtensions]):c=mn(i),{send:a,recv:c}}function am(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function Qg(e,t,n,i){let a=[];if(e===De.VIDEO){if(D("H264_PROFILE_LEVEL_ID")&&i==="h264"&&(a=t.videoCodecs.filter(c=>{var d;return ve(d=c.rtpMap&&c.rtpMap.encodingName.toLowerCase()||"").call(d,i)&&c&&c.fmtp&&c.fmtp.parameters["profile-level-id"]===D("H264_PROFILE_LEVEL_ID")})),!Array.isArray(a)||a.length===0){let c=[];const d=[],h=[],m=[];if(n.videoCodecs.forEach(g=>{const _=g.rtpMap&&g.rtpMap.encodingName.toLowerCase()||"";ve(_).call(_,i)?c.push(g):ve(_).call(_,"vp9")?d.push(g):ve(_).call(_,"vp8")?h.push(g):ve(_).call(_,"h264")&&m.push(g)}),c.length===0){let g="";d.length!==0?(c=d,g="vp9"):h.length!==0?(c=h,g="vp8"):m.length!==0&&(c=m,g="h264"),R.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(g))}c.length!==0&&(a=t.videoCodecs.filter(g=>c.some(_=>_.payloadType===g.payloadType)))}if(a.length===0&&(R.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),a=t.videoCodecs),D("USE_PUB_RTX")||D("USE_SUB_RTX")){const c=od(a,t.videoCodecs);a=[...a,...c]}}else{a=t.audioCodecs.filter(d=>{var h;return ve(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,i)});const c=t.audioCodecs.filter(d=>{var h;return ve(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,"red")});a.length===0&&(R.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),a=t.audioCodecs.filter(d=>{var h;return ve(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")})),D("ENABLE_AUDIO_RED")&&c.length!==0&&(a=[...c,...a])}return a}function od(e,t){const n=e.map(i=>i.payloadType.toString());return t.filter(i=>i.rtpMap&&i.rtpMap.encodingName==="rtx"&&i.fmtp&&i.fmtp.parameters.apt&&ve(n).call(n,i.fmtp&&i.fmtp.parameters.apt))}async function es(e,t,n){const i=t.toString(),a=O3(i,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:i});const c=await e.createAnswer();if(!c.sdp)throw new Error("cannot get answer sdp");let d=c.sdp;d=jA(d,n||{}),a==null||a(d||""),await e.setLocalDescription({type:"answer",sdp:d})}function jA(e,t,n){if(D("FORBID_MODIFY_LOCAL_OFFER_SDP"))return e;const i=Ci(e),{useXR:a}=t;return i.mediaDescriptions.forEach(c=>{var d;c.attributes.mid&&(Array.isArray(n)&&!ve(n).call(n,c.attributes.mid)||(c.media.mediaType==="audio"&&am(c),c.media.mediaType==="video"&&function(h){h.media.mediaType==="video"&&D("ENABLE_DOWN_SPS_PPS")&&h.attributes.payloads.filter(m=>{var g;return((g=m.rtpMap)===null||g===void 0?void 0:g.encodingName.toLowerCase())==="h264"}).forEach(m=>{m.fmtp||(m.fmtp={parameters:{}}),m.fmtp.parameters["sps-pps-idr-in-keyframe"]="1"})}(c),a&&ve(d=["audio","video"]).call(d,c.media.mediaType)&&c.attributes.payloads.forEach(h=>{h.rtcpFeedbacks.findIndex(m=>m.type==="rrtr")===-1&&h.rtcpFeedbacks.push({type:"rrtr"})})))}),Kc(i)}function O3(e,t,n,i){if(D("SDP_LOGGING"))return R.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(i,`
`),e),t==="offer"?a=>{O3(a,"answer",n==="local"?"remote":"local",i)}:void 0}async function P3(e,t,n){try{var i;if(!vt().supportSetRtpSenderParameters||!function(m){return m==="vp9"||m==="av1"}(e)||!D("ENABLE_SVC"))return;const a={},c={},d=t.getParameters(),h=(i=d.encodings)===null||i===void 0?void 0:i[0];c.scalabilityMode=qg(n),h&&Object.assign(h,c),Object.assign(d,a),await t.setParameters(d),R.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(d.encodings)))}catch(a){R.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",a)}}function $S(e){const t=D("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(n=>ve(e).call(e,n))}function D3(e,t){try{var n;return((n=e.fmtp)===null||n===void 0?void 0:n.parameters.apt)===t.payloadType.toString()}catch{return!1}}function k3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function bs(e,t){return typeof D(e)===t?D(e):void 0}function hae(){try{const e=D("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(t){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?k3(Object(i),!0).forEach(function(a){x(t,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):k3(Object(i)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(i,a))})}return t}({},e)}catch(e){return R.debug("handle gateway attributes failed: ",e),{}}}const L3={};function lc(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&R.debug("install service ".concat(e.name)),L3[e.name]=e}function Ea(e){const t=L3[e];if(!t)throw new de(L.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function M3(e,t){return Ea("DataStream").create(e,t)}function ZS(){return Ea("InterceptFrame").create()}function U3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function Nr(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?U3(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U3(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const VA=new Map;class pae extends Sn{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(Fn.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(Fn.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){R.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){var i,a,c;super(),x(this,"store",void 0),x(this,"joinInfo",void 0),x(this,"key",void 0),x(this,"ntpOffset",0),x(this,"usingProxy",!1),x(this,"signal",void 0),x(this,"role",void 0),x(this,"isPreallocation",void 0),x(this,"isPreSub",void 0),x(this,"inChannelInfo",{joinAt:null,duration:0}),x(this,"spec",void 0),x(this,"_state","DISCONNECTED"),x(this,"_statsCollector",void 0),x(this,"_disconnectedReason",void 0),x(this,"isSignalRecover",!1),x(this,"hasChangeBGPAddress",!1),x(this,"trafficStatsInterval",void 0),x(this,"networkQualityInterval",void 0),x(this,"_joinGatewayStartTime",0),x(this,"_signalTimeout",!1),x(this,"_clientRoleOptions",void 0),x(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useP2P?(i={spec:Nr(Nr({},n),{},{retryConfig:n.websocketRetryConfig}),store:t},(a=(c=Ea("P2PChannel")).createSubmodule)===null||a===void 0?void 0:a.call(c,i)):this.store.useDcSignal?function(d){return Ea("DataChannelSignal").create(d)}({spec:Nr(Nr({},n),{},{retryConfig:n.websocketRetryConfig}),store:t}):new f3(Nr(Nr({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}setUsingProxy(t){this.usingProxy=t}async join(t,n,i){if(this.store.useDcSignal){let _=!1;t.cloudProxyServer!=="disabled"?(R.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(t.cloudProxyServer,")")),_=!0):"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length>255||"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length<22?(R.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),_=!0):t.apResponse.addresses.some(v=>v.fingerprint)||D("FINGERPRINT")||(R.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),_=!0),_&&this.resetSignal()}this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const a=Date.now();let c=VA.get(t.cname);if(c||(c=new Map,VA.set(t.cname,c)),this._isProactiveJoin=!0,c.has(t.uid)){const _=new se(L.UID_CONFLICT);throw Le.joinGateway(t.sid,{lts:a,succ:!1,ec:_.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer||this.usingProxy,signalChannel:this.store.useDcSignal?"1":"0",preload:t.preload}),_}c.set(t.uid,!0),this.joinInfo=t,this.key=n;let d=0;this.joinGatewayStartTime=a;const h=t.proxyServer,m=this.store.useDcSignal?"datachannel":"websocket";try{R.debug("[".concat(this.store.clientId,"] use ").concat(m," join uid ").concat(d));const _=t.gatewayAddrs.map(y=>{let{address:b}=y;const[O,I]=b.split(":"),N={host:O,port:I};return t.proxyServer&&(N.proxy=t.proxyServer),N});let v;v=this.store.useDcSignal?await this.signal.init(t.apResponse.addresses):await this.signal.init(_),d=v.uid,R.debug("[".concat(this.store.clientId,"] ").concat(m," join uid ").concat(d," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(_){var g;throw _.code===L.INIT_DATACHANNEL_TIMEOUT&&this.signal.__name__==="AgoraRTCSignal"||Le.joinGateway(t.sid,{lts:a,succ:!1,ec:((g=_.data)===null||g===void 0?void 0:g.desc)||_.code,errorMsg:_.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!h||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:t.preload}),_&&_.code===L.INIT_DATACHANNEL_TIMEOUT?(R.warning("[".concat(this.store.clientId,"] User join datachannel failed"),_.toString()),this.resetSignal(),_):(R.error("[".concat(this.store.clientId,"] User join failed"),_.toString()),c.delete(t.uid),this.signal.close(),_)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),R.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(_=>{R.warning("[".concat(this.store.clientId,"] get traffic stats error"),_.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Fn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Fn.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Fn.NETWORK_QUALITY,{uplinkNetworkQuality:YS(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:YS(this._statsCollector.trafficStats.B_dnq)}):this.emit(Fn.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),d}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==Tt.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==bt.CONNECTED||await function(i,a){return a===1/0?i:we.race([i,Fse(a)])}(this.signal.request(Ve.LEAVE,void 0,!0),3e3)}catch(i){R.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(n),n!==Tt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const a={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:D("PUB_EXTEND"),twcc:!!D("PUBLISH_TWCC"),rtx:!!D("USE_PUB_RTX")};try{return(await this.signal.request(Ve.PUBLISH,a,!0))._message}catch(c){if(i&&c.data&&c.data.code===We.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),c.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw c}}async publishDataChannel(t,n,i){var a;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(a=n.maxRetransmits)!==null&&a!==void 0?a:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(Ve.PUBLISH_DATASTREAM,c,!0)}catch(d){if(i&&d.data&&d.data.code===We.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),d.toString()),await this.tryUnpubDataChannelBeforeRepub(t,n),this.publishDataChannel(t,n,!1);throw d}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Ve.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(i){R.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await we.all(t.map(n=>this.signal.request(Ve.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){R.warning("unpublish datachannels warning: ",n)}}async presubscribe(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(L.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const a={stream_id:t,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!D("SUBSCRIBE_TWCC"),rtx:!!D("USE_SUB_RTX")||void 0,extend:D("SUB_EXTEND"),svc:Array.isArray(D("SVC"))&&D("SVC").length!==0?D("SVC"):void 0};try{return await this.signal.request(Ve.PRE_SUBSCRIBE,a,!0)}catch(c){if(i&&c.data&&c.data.code===We.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),c.toString()),this.presubscribe(t,n,!1);throw c}}async subscribe(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(L.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const a={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!D("SUBSCRIBE_TWCC"),rtx:!!D("USE_SUB_RTX"),extend:D("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(D("SVC"))&&D("SVC").length!==0?D("SVC"):void 0};try{return(await this.signal.request(Ve.SUBSCRIBE,a,!0))._message}catch(c){if(i&&c.data&&c.data.code===We.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),c.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw c}}async subscribeDataChannel(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(L.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const a={uid:t,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(Ve.SUBSCRIBE_DATASTREAM,a,!0)}catch(c){if(i&&c.data&&c.data.code===We.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),c.toString()),await this.tryUnsubDataChannelBeforeResub(t,n),await this.subscribeDataChannel(t,n,!1);throw c}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(L.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const i={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!D("USE_SUB_RTX"),twcc:!!D("SUBSCRIBE_TWCC"),svc:Array.isArray(D("SVC"))&&D("SVC").length!==0?D("SVC"):void 0};try{return await this.signal.request(Ve.SUBSCRIBE_STREAMS,i,!0)}catch(a){if(n&&a.data&&a.data.code===We.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),a.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw a}}async setVideoProfile(t){const n=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let a=i.frameRate,c=i.width,d=i.height,h=!0;return typeof a!="number"&&(a=a.exact||a.ideal||a.max||a.min||0,a||(h=!1)),typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(h=!1)),typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,a||(h=!1)),h?{stream_type:0,width:c,height:d,fps:a,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(t);if(n)return this.signal.request(Ve.SET_VIDEO_PROFILE,n);R.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(Ve.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(i){R.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await we.all(t.map(i=>this.signal.request(Ve.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:n},!0)))}catch(i){R.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(t){try{await this.signal.request(Ve.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){R.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:i,rtpCapabilities:a}=t;return{gatewayEstablishParams:await this.signal.request(Ve.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:i,rtpCapabilities:a}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Ve.GATEWAY_INFO)}async renewToken(t){await this.signal.request(Ve.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,n){n&&(this._clientRoleOptions=Object.assign({},n)),D("CLIENT_ROLE_OPTIONS")&&(R.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(D("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},D("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),D("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},D("CLIENT_ROLE_OPTIONS")),R.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(D("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let i,a=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,a=1):a=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:a=0;const c=Object.assign({},n);delete c.delay,delete c.level,await this.signal.request(Ve.SET_CLIENT_ROLE,Nr(Nr({role:t,level:a,delay:i},c),{},{client_ts:Date.now()})),this.role=t}async setDualStreamMode(t,n,i){await this.signal.request(Ve.SET_DUAL_STREAM_MODE,{mode:t},i,n)}async setRemoteVideoStreamType(t,n){await this.signal.request(Ve.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(Ve.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(Ve.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(Ve.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(t){await this.signal.request(Ve.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,n,i){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,n,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Nr({},this.inChannelInfo)}async setConfigure(t){if(t&&Array.isArray(t)&&t.length!==0)return this.signal.request(Ve.CONFIGURE,t)}async getGatewayVersion(){return(await this.signal.request(Ve.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=VA.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0),this.usingProxy=!1}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(n){let i;return i=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:zr.username,password:zr.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Nr(Nr({},zr),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(Ve.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(n=>{const i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(a=>a.peer_uid===n.peer_uid);i&&i.B_st!==n.B_st&&mS(()=>{this.emit(Fn.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var n,i,a,c;if(!this.joinInfo||!this.key)throw new se(L.UNEXPECTED_ERROR,"can not generate join message, no join info");const d=Object.assign({},this.joinInfo.apResponse);let h=D("REPORT_APP_SCENARIO");if(typeof h!="string")try{h=JSON.stringify(h)}catch{h=void 0}var m;h&&h.length>128&&(h=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Fn.UPDATE_GATEWAY_CONFIG),m=this.store.clientId,ve(tm).call(tm,m)||tm.push(m);const g=Bg(this.store),_=!((n=this.isPreallocation)===null||n===void 0||!n.call(this)),v=UV(this.store),y=hae(),b=ha(87)||Wj()||TI(117),O=(function(){const j=Pt();if(j.name!==Mt.SAFARI||!j.browserVersion)return!1;const G=j.browserVersion.split(".");return Number(G[0])>18||Number(G[0])===18&&Number(G[1])>=4}()||qj(18,4,!1))&&bI(18,6,!0)&&this.spec.codec==="h264"&&D("ENABLE_ABSSENDTIME_AS_SENTTS"),I=!(((i=d.detail)===null||i===void 0?void 0:i[3])!=="CN"||!D("ENABLE_QUALITY_FALLBACK"))&&D("ENABLE_QUALITY_FALLBACK"),N=!!D("ENABLE_AP_MULTI_IP")&&((a=d.detail)===null||a===void 0?void 0:a[5])==="multi-ip",k=Nr({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:ro,browser:navigator.userAgent,process_id:D("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:N||this.hasChangeBGPAddress,ap_response:d,extend:D("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:h,attributes:{userAttributes:Nr(Nr({enableEncodedTransform:(!!D("ENABLE_AUDIO_METADATA")||!!D("ENABLE_AUDIO_PTS"))&&b||!!D("ENABLE_AUDIO_TOPN")&&SI(Mt.CHROME,87,116)||void 0,enableAudioMetadata:!!D("ENABLE_AUDIO_METADATA")&&b,enableAudioPts:!!D("ENABLE_AUDIO_PTS")&&b,topnSmoothLevel:D("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:D("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:D("TOPN_SWITCH_HOLD_MS"),topnAudioGain:D("TOPN_AUDIO_GAIN"),enableNetworkQualityProbe:this.store.networkQualityProbe,enablePublishedUserList:D("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:D("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:bs("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:bs("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:bs("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:D("USE_PUB_RTX")===!0||D("USE_SUB_RTX")===!0||void 0,disableFEC:D("DISABLE_FEC"),enableNTPReport:!!D("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:v,enableFulllinkAvSync:!!D("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:bs("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!D("FORCE_ENABLE_AUT_CC")||!bS()&&(!!D("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!D("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:bs("USE_XR","boolean"),enableLossbasedBwe:bs("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!D("FORCE_ENABLE_AUT_CC")||!bS()&&(!!D("ENABLE_AUT_CC")||void 0),enableCCFallback:bs("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:_,preSubNum:g?bs("PRE_SUB_NUM","number"):void 0,enablePubTWCC:bs("PUBLISH_TWCC","boolean"),enableSubTWCC:bs("SUBSCRIBE_TWCC","boolean"),enablePubRTX:bs("USE_PUB_RTX","boolean"),enableSubRTX:bs("USE_SUB_RTX","boolean"),enableSubSVC:D("ENABLE_SVC")?D("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(D("SVC"))&&D("SVC").length!==0?D("SVC"):void 0,enableSvcExtended:D("ENABLE_SVC")&&Array.isArray(D("SVC_EXTENDED"))&&D("SVC_EXTENDED").length!==0?D("SVC_EXTENDED"):void 0,enableVosFallback:D("ENABLE_VOS_FALLBACK"),enableQualityFallback:I},y),{},{audioDuplicate:bs("ENABLE_AUDIO_RED","boolean")?(c=bs("AUDIO_DUPLICATE_NUM","number"))!==null&&c!==void 0?c:2:void 0,senttsUsesAbsSendTime:!!O||void 0,enableDualStreamFlag:bs("ENABLE_DUAL_STREAM_FLAG","boolean")})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(k.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(k.aes_mode=this.joinInfo.aesmode,D("ENCRYPT_AES")?(k.aes_secret=this.joinInfo.aespassword,k.aes_encrypt=!0):k.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(k.aes_salt=this.joinInfo.aessalt)),d.addresses[this.signal.websocket.currentURLIndex]&&(k.ap_response.ticket=d.addresses[this.signal.websocket.currentURLIndex].ticket,delete d.addresses),this.joinInfo.defaultVideoStream!==void 0&&(k.default_video_stream=this.joinInfo.defaultVideoStream),k}getRejoinMessage(){if(!this.joinInfo)throw new se(L.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Ue.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Ue.WS_RECONNECTING,t=>{this.joinInfo&&Le.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Wr.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Le.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Ue.WS_CLOSED,t=>{let n;switch(t){case Tt.LEAVE:n=Wr.LEAVE;break;case Tt.UID_BANNED:case Tt.IP_BANNED:case Tt.CHANNEL_BANNED:case Tt.SERVER_ERROR:n=Wr.SERVER_ERROR;break;case Tt.FALLBACK:n=Wr.FALLBACK;break;case Tt.LICENSE_MISSING:case Tt.LICENSE_EXPIRED:case Tt.LICENSE_MINUTES_EXCEEDED:case Tt.LICENSE_PERIOD_INVALID:case Tt.LICENSE_MULTIPLE_SDK_SERVICE:case Tt.LICENSE_ILLEGAL:case Tt.TOKEN_EXPIRE:n=t;break;default:n=Wr.NETWORK_ERROR}R.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+Wr.NETWORK_ERROR)),this.joinInfo&&Le.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Tt.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==Tt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Ue.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=D("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(R.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(Le.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void R.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));Zt("EVENT_REPORT_DOMAIN",t[1]),Zt("EVENT_REPORT_BACKUP_DOMAIN",t[1]),Zt("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(Ze.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(Ue.REQUEST_RECOVER,(t,n,i)=>{if(!this.joinInfo)return i(new se(L.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Zn(this,Fn.REQUEST_NEW_GATEWAY_LIST).then(n).catch(i)}),this.signal.on(Ue.REQUEST_JOIN_INFO,async(t,n,i)=>{var a,c,d;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const h=mn((a=this.joinInfo)===null||a===void 0?void 0:a.turnServer);if(D("NEW_TURN_MODE")&&h&&((c=this.joinInfo)===null||c===void 0?void 0:c.cloudProxyServer)==="disabled"){var m;let y=h.servers.map(I=>"turnServerURL"in I&&D("USE_TURN_IP")?Nr(Nr({},I),{},{turnServerURL:qS(I.turnServerURL)}):I),b=(m=h.serversFromGateway)===null||m===void 0?void 0:m.map(I=>D("USE_TURN_IP")?Nr(Nr({},I),{},{turnServerURL:qS(I.turnServerURL)}):I);const O=this.signal.currentURLIndex;y.length>0&&(y=[y[O%y.length]],h.servers=y),Array.isArray(b)&&b.length>0&&(b=[b[0]],h.serversFromGateway=b),R.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(O))}const{iceParameters:g,dtlsParameters:_,rtpCapabilities:v}=await Zn(this,Fn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:h,cloudProxyServer:(d=this.joinInfo)===null||d===void 0?void 0:d.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:g,dtlsParameters:_,rtpCapabilities:v,version:"2"}}))}catch(y){n(y)}}),this.signal.on(Ue.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(Ue.REPORT_JOIN_GATEWAY,(t,n)=>{if(!this.joinInfo)return;let i,a="";var c;t instanceof se?(i=((c=t.data)===null||c===void 0?void 0:c.desc)||t.code,a=t.message):i=t,Le.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,errorMsg:a,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload})}),this.signal.on(Ue.IS_P2P_DISCONNECTED,t=>{t(ku(this,Fn.IS_P2P_DISCONNECTED))}),this.signal.on(Ue.DISCONNECT_P2P,()=>{this.emit(Fn.DISCONNECT_P2P)}),this.signal.on(Ue.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Ue.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Ue.JOIN_RESPONSE,t=>{const n=this.getCurrentGatewayAddress();this.emit(Fn.JOIN_RESPONSE,t,n)}),this.signal.on(Ue.PRE_CONNECT_PC,async(t,n)=>{if(this.joinInfo){var i,a;this.updateTurnConfigFromSignal();const d=this.getCurrentGatewayAddress(),h=mn((i=this.joinInfo)===null||i===void 0?void 0:i.turnServer);if(D("NEW_TURN_MODE")&&h&&((a=this.joinInfo)===null||a===void 0?void 0:a.cloudProxyServer)==="disabled"){var c;let g=h.servers.map(y=>"turnServerURL"in y&&D("USE_TURN_IP")?Nr(Nr({},y),{},{turnServerURL:qS(y.turnServerURL)}):y),_=(c=h.serversFromGateway)===null||c===void 0?void 0:c.map(y=>D("USE_TURN_IP")?Nr(Nr({},y),{},{turnServerURL:qS(y.turnServerURL)}):y);const v=this.signal.currentURLIndex;g.length>0&&(g=[g[v%g.length]],h.servers=g),Array.isArray(_)&&_.length>0&&(_=[_[0]],h.serversFromGateway=_),R.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(v,",in pre pc"))}const m=D("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(d&&m){const g=I3(d);Zn(this,Fn.PRE_CONNECT_PC,{candidates:g,fingerprint:m,turnServer:h}).then(_=>{t==null||t(_)}).catch(n||(()=>{}))}}}),this.signal.on(Ue.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof D("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(D("AP_REQUEST_DETAIL"),";").concat(t))}),this.signal.on(Ue.VOS_FALLBACK,t=>{this.emit(Fn.VOS_FALLBACK,t)}),this.signal.on(Ue.DATACHANNEL_FAILBACK,t=>{R.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(Fn.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(t,n){try{await this.signal.request(Ve.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(t,n){try{await this.signal.request(Ve.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(i){throw R.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(Ve.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(t,n){try{await this.signal.request(Ve.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(i){throw R.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(t){const n={users:t.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(Ve.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(t,n){const i={action:t.find(a=>a.stream_type===Ht.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(Ve.CONTROL,i,!0,!0)}catch(a){throw R.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),a),a}}async unmuteLocal(t,n){const i={action:t.find(a=>a.stream_type===Ht.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(Ve.CONTROL,i,!0,!0)}catch(a){throw R.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),a),a}}async muteRemote(t,n){const i={action:t===De.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Ve.CONTROL,i,!0,!0)}catch(a){throw R.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),a),a}}async unmuteRemote(t,n){const i={action:t===De.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Ve.CONTROL,i,!0,!0)}catch(a){throw R.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),a),a}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(Ve.RESTART_ICE,n,!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(t,n){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,n||Wr.P2P_FAILED)}getCurrentGatewayAddress(){var t,n;if(!D("GATEWAY_WSS_ADDRESS"))return D("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(R.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(Ve.SET_PARAMETER,{enablePublishAudioFilter:t})}downgradeCodec(t){this.signal.downgradeCodec(t)}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(Tt.FALLBACK)),this.store.useDcSignal=!1,this.signal=new f3(Nr(Nr({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(Fn.RESET_SIGNAL)}}let eT=0,FA=0;function va(e,t,n,i){return new we((a,c)=>{t.timeout=t.timeout||D("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),eT+=rc(t.data)):n&&(t.data.size?eT+=t.data.size:t.data instanceof FormData?eT+=pV(t.data):eT+=rc(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Mi.request(t).then(d=>{typeof d.data=="string"?FA+=rc(d.data):d.data instanceof ArrayBuffer||d.data instanceof Uint8Array?FA+=d.data.byteLength:FA+=rc(JSON.stringify(d.data)),i&&a({data:d.data,headers:d.headers}),a(d.data)}).catch(d=>{Mi.isCancel(d)?c(new se(L.OPERATION_ABORTED,"cancel token canceled")):d.code==="ECONNABORTED"?c(new se(L.NETWORK_TIMEOUT,d.message)):d.response?c(new se(L.NETWORK_RESPONSE_ERROR,d.response.status)):c(new se(L.NETWORK_ERROR,d.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(ge){var Re=0;return function(){return Re<ge.length?{done:!1,value:ge[Re++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(ge,Re,ke){return ge==Array.prototype||ge==Object.prototype||(ge[Re]=ke.value),ge},i,a=function(ge){ge=[typeof globalThis=="object"&&globalThis,ge,typeof window=="object"&&window,typeof self=="object"&&self,typeof l=="object"&&l];for(var Re=0;Re<ge.length;++Re){var ke=ge[Re];if(ke&&ke.Math==Math)return ke}throw Error("Cannot find global object")}(this);function c(ge,Re){if(Re)e:{var ke=a;ge=ge.split(".");for(var _e=0;_e<ge.length-1;_e++){var C=ge[_e];if(!(C in ke))break e;ke=ke[C]}(Re=Re(_e=ke[ge=ge[ge.length-1]]))!=_e&&Re!=null&&n(ke,ge,{configurable:!0,writable:!0,value:Re})}}function d(ge){return(ge={next:ge})[Symbol.iterator]=function(){return this},ge}function h(ge){var Re=typeof Symbol<"u"&&Symbol.iterator&&ge[Symbol.iterator];return Re?Re.call(ge):{next:t(ge)}}if(c("Symbol",function(ge){function Re(C,B){this.A=C,n(this,"description",{configurable:!0,writable:!0,value:B})}if(ge)return ge;Re.prototype.toString=function(){return this.A};var ke="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",_e=0;return function C(B){if(this instanceof C)throw new TypeError("Symbol is not a constructor");return new Re(ke+(B||"")+"_"+_e++,B)}}),c("Symbol.iterator",function(ge){if(ge)return ge;ge=Symbol("Symbol.iterator");for(var Re="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),ke=0;ke<Re.length;ke++){var _e=a[Re[ke]];typeof _e=="function"&&typeof _e.prototype[ge]!="function"&&n(_e.prototype,ge,{configurable:!0,writable:!0,value:function(){return d(t(this))}})}return ge}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var m;e:{var g={};try{g.__proto__={a:!0},m=g.a;break e}catch{}m=!1}i=m?function(ge,Re){if(ge.__proto__=Re,ge.__proto__!==Re)throw new TypeError(ge+" is not extensible");return ge}:null}var _=i;function v(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function y(ge){if(ge.m)throw new TypeError("Generator is already running");ge.m=!0}function b(ge,Re){return ge.h=3,{value:Re}}function O(ge){this.g=new v,this.G=ge}function I(ge,Re,ke,_e){try{var C=Re.call(ge.g.j,ke);if(!(C instanceof Object))throw new TypeError("Iterator result "+C+" is not an object");if(!C.done)return ge.g.m=!1,C;var B=C.value}catch(H){return ge.g.j=null,ge.g.s(H),N(ge)}return ge.g.j=null,_e.call(ge.g,B),N(ge)}function N(ge){for(;ge.g.h;)try{var Re=ge.G(ge.g);if(Re)return ge.g.m=!1,{value:Re.value,done:!1}}catch(ke){ge.g.v=void 0,ge.g.s(ke)}if(ge.g.m=!1,ge.g.l){if(Re=ge.g.l,ge.g.l=null,Re.F)throw Re.D;return{value:Re.return,done:!0}}return{value:void 0,done:!0}}function k(ge){this.next=function(Re){return ge.o(Re)},this.throw=function(Re){return ge.s(Re)},this.return=function(Re){return function(ke,_e){y(ke.g);var C=ke.g.j;return C?I(ke,"return"in C?C.return:function(B){return{value:B,done:!0}},_e,ke.g.return):(ke.g.return(_e),N(ke))}(ge,Re)},this[Symbol.iterator]=function(){return this}}function j(ge,Re){return Re=new k(new O(Re)),_&&ge.prototype&&_(Re,ge.prototype),Re}if(v.prototype.o=function(ge){this.v=ge},v.prototype.s=function(ge){this.l={D:ge,F:!0},this.h=this.C||this.u},v.prototype.return=function(ge){this.l={return:ge},this.h=this.u},O.prototype.o=function(ge){return y(this.g),this.g.j?I(this,this.g.j.next,ge,this.g.o):(this.g.o(ge),N(this))},O.prototype.s=function(ge){return y(this.g),this.g.j?I(this,this.g.j.throw,ge,this.g.o):(this.g.s(ge),N(this))},c("Array.prototype.entries",function(ge){return ge||function(){return function(Re,ke){Re instanceof String&&(Re+="");var _e=0,C=!1,B={next:function(){if(!C&&_e<Re.length){var H=_e++;return{value:ke(H,Re[H]),done:!1}}return C=!0,{done:!0,value:void 0}}};return B[Symbol.iterator]=function(){return B},B}(this,function(Re,ke){return[Re,ke]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var G=function(ge,Re){for(var ke=0;ke<ge.length;ke++)Re(ge[ke])},K=function(ge){return ge.replace(/\r?\n|\r/g,`\r
`)},X=function(ge,Re,ke){return Re instanceof Blob?(ke=ke!==void 0?ke+"":typeof Re.name=="string"?Re.name:"blob",Re.name===ke&&Object.prototype.toString.call(Re)!=="[object Blob]"||(Re=new File([Re],ke)),[String(ge),Re]):[String(ge),String(Re)]},z=function(ge,Re){if(ge.length<Re)throw new TypeError(Re+" argument required, but only "+ge.length+" present.")},ne=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,me=ne.FormData,Ee=ne.XMLHttpRequest&&ne.XMLHttpRequest.prototype.send,Oe=ne.Request&&ne.fetch,Qe=ne.navigator&&ne.navigator.sendBeacon,qe=ne.Element&&ne.Element.prototype,dt=ne.Symbol&&Symbol.toStringTag;dt&&(Blob.prototype[dt]||(Blob.prototype[dt]="Blob"),"File"in ne&&!File.prototype[dt]&&(File.prototype[dt]="File"));try{new File([],"")}catch{ne.File=function(Re,ke,_e){return Re=new Blob(Re,_e||{}),Object.defineProperties(Re,{name:{value:ke},lastModified:{value:+(_e&&_e.lastModified!==void 0?new Date(_e.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),dt&&Object.defineProperty(Re,dt,{value:"File"}),Re}}var at=function(ge){return ge.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Ut=function(ge){this.i=[];var Re=this;ge&&G(ge.elements,function(ke){if(ke.name&&!ke.disabled&&ke.type!=="submit"&&ke.type!=="button"&&!ke.matches("form fieldset[disabled] *"))if(ke.type==="file"){var _e=ke.files&&ke.files.length?ke.files:[new File([],"",{type:"application/octet-stream"})];G(_e,function(C){Re.append(ke.name,C)})}else ke.type==="select-multiple"||ke.type==="select-one"?G(ke.options,function(C){!C.disabled&&C.selected&&Re.append(ke.name,C.value)}):ke.type==="checkbox"||ke.type==="radio"?ke.checked&&Re.append(ke.name,ke.value):(_e=ke.type==="textarea"?K(ke.value):ke.value,Re.append(ke.name,_e))})};if((e=Ut.prototype).append=function(ge,Re,ke){z(arguments,2),this.i.push(X(ge,Re,ke))},e.delete=function(ge){z(arguments,1);var Re=[];ge=String(ge),G(this.i,function(ke){ke[0]!==ge&&Re.push(ke)}),this.i=Re},e.entries=function ge(){var Re,ke=this;return j(ge,function(_e){if(_e.h==1&&(Re=0),_e.h!=3)return Re<ke.i.length?_e=b(_e,ke.i[Re]):(_e.h=0,_e=void 0),_e;Re++,_e.h=2})},e.forEach=function(ge,Re){z(arguments,1);for(var ke=h(this),_e=ke.next();!_e.done;_e=ke.next()){var C=h(_e.value);_e=C.next().value,C=C.next().value,ge.call(Re,C,_e,this)}},e.get=function(ge){z(arguments,1);var Re=this.i;ge=String(ge);for(var ke=0;ke<Re.length;ke++)if(Re[ke][0]===ge)return Re[ke][1];return null},e.getAll=function(ge){z(arguments,1);var Re=[];return ge=String(ge),G(this.i,function(ke){ke[0]===ge&&Re.push(ke[1])}),Re},e.has=function(ge){z(arguments,1),ge=String(ge);for(var Re=0;Re<this.i.length;Re++)if(this.i[Re][0]===ge)return!0;return!1},e.keys=function ge(){var Re,ke,_e,C,B=this;return j(ge,function(H){if(H.h==1&&(Re=h(B),ke=Re.next()),H.h!=3)return ke.done?void(H.h=0):(_e=ke.value,C=h(_e),b(H,C.next().value));ke=Re.next(),H.h=2})},e.set=function(ge,Re,ke){z(arguments,2),ge=String(ge);var _e=[],C=X(ge,Re,ke),B=!0;G(this.i,function(H){H[0]===ge?B&&(B=!_e.push(C)):_e.push(H)}),B&&_e.push(C),this.i=_e},e.values=function ge(){var Re,ke,_e,C,B=this;return j(ge,function(H){if(H.h==1&&(Re=h(B),ke=Re.next()),H.h!=3)return ke.done?void(H.h=0):(_e=ke.value,(C=h(_e)).next(),b(H,C.next().value));ke=Re.next(),H.h=2})},Ut.prototype._asNative=function(){for(var ge=new me,Re=h(this),ke=Re.next();!ke.done;ke=Re.next()){var _e=h(ke.value);ke=_e.next().value,_e=_e.next().value,ge.append(ke,_e)}return ge},Ut.prototype._blob=function(){var ge="----formdata-polyfill-"+Math.random(),Re=[],ke="--"+ge+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(_e,C){return typeof _e=="string"?Re.push(ke+at(K(C))+`"\r
\r
`+K(_e)+`\r
`):Re.push(ke+at(K(C))+'"; filename="'+at(_e.name)+`"\r
Content-Type: `+(_e.type||"application/octet-stream")+`\r
\r
`,_e,`\r
`)}),Re.push("--"+ge+"--"),new Blob(Re,{type:"multipart/form-data; boundary="+ge})},Ut.prototype[Symbol.iterator]=function(){return this.entries()},Ut.prototype.toString=function(){return"[object FormData]"},qe&&!qe.matches&&(qe.matches=qe.matchesSelector||qe.mozMatchesSelector||qe.msMatchesSelector||qe.oMatchesSelector||qe.webkitMatchesSelector||function(ge){for(var Re=(ge=(this.document||this.ownerDocument).querySelectorAll(ge)).length;0<=--Re&&ge.item(Re)!==this;);return-1<Re}),dt&&(Ut.prototype[dt]="FormData"),Ee){var vn=ne.XMLHttpRequest.prototype.setRequestHeader;ne.XMLHttpRequest.prototype.setRequestHeader=function(ge,Re){vn.call(this,ge,Re),ge.toLowerCase()==="content-type"&&(this.B=!0)},ne.XMLHttpRequest.prototype.send=function(ge){ge instanceof Ut?(ge=ge._blob(),this.B||this.setRequestHeader("Content-Type",ge.type),Ee.call(this,ge)):Ee.call(this,ge)}}Oe&&(ne.fetch=function(ge,Re){return Re&&Re.body&&Re.body instanceof Ut&&(Re.body=Re.body._blob()),Oe.call(this,ge,Re)}),Qe&&(ne.navigator.sendBeacon=function(ge,Re){return Re instanceof Ut&&(Re=Re._asNative()),Qe.call(this,ge,Re)}),ne.FormData=Ut}})();const $g=()=>{const e=D("AREAS");return e.length===0&&e.push(jt.GLOBAL),to(e).call(e,(t,n,i)=>{const a=j3(n);return a?i===0?a:"".concat(t,",").concat(a):t},"")},j3=e=>e===jt.OVERSEA?"".concat(Xr.ASIA,",").concat(Xr.EUROPE,",").concat(Xr.AFRICA,",").concat(Xr.NORTH_AMERICA,",").concat(Xr.SOUTH_AMERICA,",").concat(Xr.OCEANIA):Xr[e],mae=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(n=>{const i=zS[n],a=Object.keys(i);a&&a.map(c=>{c!=="CODE"&&(t[c]=t[c].concat(i[c]))})}),t},tT={GLOBAL:{ASIA:[jt.CHINA,jt.JAPAN,jt.INDIA,jt.KOREA,jt.HKMC],EUROPE:[],NORTH_AMERICA:[jt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},nT=Object.keys(tT[jt.GLOBAL]),BA=[jt.CHINA,jt.NORTH_AMERICA,jt.EUROPE,jt.ASIA,jt.JAPAN,jt.INDIA,jt.OCEANIA,jt.SOUTH_AMERICA,jt.AFRICA,jt.KOREA,jt.HKMC,jt.US],fae=function(e,t){let n=[];if(ve(e).call(e,jt.GLOBAL)){const c=[jt.GLOBAL,jt.OVERSEA],d=Object.keys(zS);if(t===jt.GLOBAL)throw new se(L.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===jt.CHINA)n=[jt.OVERSEA];else if(a=t,ve(nT).call(nT,a)){const h=(i=t,tT[jt.GLOBAL][i]||[]),m=[...c,t,...h];n=d.filter(g=>!ve(m).call(m,g))}else if(function(h){let m=!1;return nT.forEach(g=>{var _;ve(_=tT[jt.GLOBAL][g]).call(_,h)&&(m=!0)}),m}(t)){const h=function(g){let _;return nT.forEach(v=>{var y;ve(y=tT[jt.GLOBAL][v]).call(y,g)&&(_=v)}),_}(t),m=[...c,h,t];n=d.filter(g=>!ve(m).call(m,g))}else n=e;n=function(h){const m=[];return BA.forEach(g=>{ve(h).call(h,g)&&m.push(g)}),m.concat(h.filter(g=>!ve(BA).call(BA,g)))}(n)}else n=e;var i,a;return n};function V3(e){var t,n;if(!e&&ve(t=D("AREAS")).call(t,jt.EXTENSIONS))return R.debug("update area from ap : reset"),void GA(Roe,!0);if(!ve(n=D("AREAS")).call(n,jt.GLOBAL)||!e)return;let i=zS.EXTENSIONS;i&&(i={CODE:j3(jt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},R.debug("update area from ap success: ".concat(e,",config is "),i),Zt("AREAS",[jt.EXTENSIONS],!0),Object.keys(i).map(a=>{a==="LOG_UPLOAD_SERVER"||a==="EVENT_REPORT_DOMAIN"||a==="EVENT_REPORT_BACKUP_DOMAIN"||a==="PROXY_SERVER_TYPE3"?Zt(a,i[a][0]):Zt(a,i[a])}))}function GA(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=Le.reportApiInvoke(null,{name:_n.SET_AREA,options:e,tag:rn.TRACER});try{let i=[];if(typeof e=="string"&&(i=[e]),Array.isArray(e)&&(e.forEach(c=>{if(!ve(c3).call(c3,c))throw new se(L.INVALID_PARAMS,"invalid area code")}),i=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:c,excludedArea:d}=e;if(!c)throw new se(L.INVALID_PARAMS,"area code is needed");let h=c;typeof c=="string"&&(h=[c]),i=d?fae(h,d):h}if(!t){if(Ms.AREAS){const c=new se(L.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(c),void R.warning("setArea is prohibited because of config-distribute")}if(ve(i).call(i,jt.GLOBAL)&&D("AREAS")===jt.EXTENSIONS){const c=new se(L.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(c),void R.warning("setArea is prohibited because of ap extensions")}}Zt("AREAS",i,t);const a=mae(i);Object.keys(a).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?Zt(c,a[c][0]):Zt(c,a[c])}),R.debug("set area success:",i.join(","))}catch(i){throw n.onError(i),i}n.onSuccess()}function F3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function dc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?F3(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):F3(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let WA=1;function gae(e,t,n,i,a){WA+=1;const c={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:WA,requestId:WA,version:ro,cname:n.cname},d={service_name:t,json_body:JSON.stringify(c)};let h,m,g=e[0];return pa(async()=>{h=Date.now();const _=await va(g,{data:d,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(m=Date.now()-h,_.code!==0){const b=new se(L.UNEXPECTED_RESPONSE,"live streaming ap error, code"+_.code,{retry:!0,responseTime:m});throw R.error(b.toString()),b}const v=JSON.parse(_.json_body);if(v.code!==200){const b=new se(L.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(v.code,", reason: ").concat(v.reason),{code:v.code,responseTime:m});throw R.error(b.toString()),b}if(!v.servers||v.servers.length===0){const b=new se(L.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:v.code,responseTime:m});throw R.error(b.toString()),b}const y=function(b,O){return{addressList:b.servers.map(I=>"wss://".concat(I.address.replace(/\./g,"-"),".").concat(D("WORKER_DOMAIN"),":").concat(I.wss,"?serviceName=").concat(encodeURIComponent(O))),workerToken:b.workerToken,vid:b.vid}}(v,t);return D("LIVE_STREAMING_ADDRESS")&&(y.addressList=D("LIVE_STREAMING_ADDRESS")instanceof Array?D("LIVE_STREAMING_ADDRESS"):[D("LIVE_STREAMING_ADDRESS")]),dc(dc({},y),{},{responseTime:m})},(_,v)=>(Le.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(_.addressList),firstSuccess:v===0,responseTime:m,serverIp:e[v%e.length]}),!1),(_,v)=>(Le.apworkerEvent(n.sid,{success:!1,sc:_.data&&_.data.code||200,serviceName:t,responseTime:m,serverIp:e[v%e.length]}),!!(_.code!==L.OPERATION_ABORTED&&_.code!==L.UNEXPECTED_RESPONSE||_.data&&_.data.retry)&&(g=e[(v+1)%e.length],!0)),a)}let zA=1;function B3(e,t,n,i){let{url:a,areaCode:c}=e;const{clientId:d,sid:h}=t,m=Date.now();let g;const _=t.role,[v,y]=KA(t,c,[qn.CHOOSE_SERVER]);let b=Nn.networkState;return pa(async()=>{b&&Nn.networkState===wi.OFFLINE&&Nn.onlineWaiter&&await we.race([Nn.onlineWaiter,pr(i&&i.maxRetryTimeout||Kn.maxRetryTimeout)]),b=Nn.networkState;const{data:O,headers:I}=await va(a,{data:v,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);g=I.http3==="1"?1:-1,Le.reportResourceTiming(a,h),W3(O,a,t,m,[qn.CHOOSE_SERVER],g);const N=Kg(O,qn.CHOOSE_SERVER);return HA(N),OA(N,a)},O=>(O&&Le.joinChooseServer(h,{role:_,lts:m,succ:!0,csAddr:a,opid:y,serverList:O.gatewayAddrs.map(I=>I.address),ec:null,cid:O.cid.toString(),uid:O.uid.toString(),csIp:O.csIp,unilbsServerIds:[qn.CHOOSE_SERVER].toString(),isHttp3:g,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:O.res.detail&&O.res.detail[38],vid:O.vid}),!1),O=>O.code!==L.OPERATION_ABORTED&&(O.code===L.CAN_NOT_GET_GATEWAY_SERVER?O.data.retry:(Le.joinChooseServer(h,{role:_,lts:m,succ:!1,csAddr:a,serverList:null,opid:y,ec:O.code,csIp:O.data&&O.data.csIp,unilbsServerIds:[qn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:b}),isHttp3:g,corssRegionTagReq:t.apRequestDetail}),R.warning("[".concat(d||"sid-".concat(h.slice(0,6)),"] Choose server network error, retry"),O),!0)),i)}function G3(e,t,n,i){let a,{url:c,areaCode:d,serviceIds:h}=e;const m=Date.now(),g=t.role,[_,v]=KA(t,d,h);let y;return pa(async()=>{y&&Nn.networkState===wi.OFFLINE&&Nn.onlineWaiter&&await we.race([Nn.onlineWaiter,pr(i&&i.maxRetryTimeout||Kn.maxRetryTimeout)]),y=Nn.networkState;const{data:b,headers:O}=await va(c,{data:_,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);a=O.http3==="1"?1:-1,Le.reportResourceTiming(c,t.sid),W3(b,c,t,m,h,a);const I=Kg(b,qn.CHOOSE_SERVER),N=Kg(b,t.cloudProxyServer==="proxy5"?qn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?qn.CLOUD_PROXY:qn.CLOUD_PROXY_FALLBACK),k=performance.getEntriesByName(c),j=k[k.length-1];let G;return j&&(G={name:j.name,protocol:"nextHopProtocol"in j?j.nextHopProtocol:"",dnscost:"domainLookupEnd"in j&&"domainLookupStart"in j&&typeof j.domainLookupEnd=="number"&&typeof j.domainLookupStart=="number"?j.domainLookupEnd-j.domainLookupStart:-1,tcpTlsCost:"connectEnd"in j&&"connectStart"in j&&typeof j.connectEnd=="number"&&typeof j.connectStart=="number"?j.connectEnd-j.connectStart:-1,reqCost:"requestStart"in j&&typeof j.requestStart=="number"&&"responseEnd"in j&&typeof j.responseEnd=="number"?j.responseEnd-j.requestStart:-1,handleCost:"leave_ts"in b&&"enter_ts"in b&&typeof b.leave_ts=="number"&&typeof b.enter_ts=="number"?b.leave_ts-b.enter_ts:-1}),HA(I),{gatewayInfo:OA(I,c),proxyInfo:N,url:c,resourceTimingInfo:G}},b=>{var O;return b.gatewayInfo&&Le.joinChooseServer(t.sid,{role:g,lts:m,succ:!0,csAddr:c,serverList:b.gatewayInfo.gatewayAddrs.map(I=>I.address),ec:null,opid:v,cid:b.gatewayInfo.cid.toString(),uid:b.gatewayInfo.uid.toString(),csIp:b.gatewayInfo.csIp,unilbsServerIds:h.toString(),isHttp3:a,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:b.gatewayInfo.res.detail&&b.gatewayInfo.res.detail[38],vid:(O=b.gatewayInfo)===null||O===void 0?void 0:O.vid,resourceTimingInfo:b.resourceTimingInfo?JSON.stringify(b.resourceTimingInfo):void 0}),b.proxyInfo&&Le.joinWebProxyAP(t.sid,{lts:m,sucess:1,apServerAddr:c,turnServerAddrList:b.proxyInfo.addresses.map(I=>I.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:h.toString()}),!1},b=>b.code!==L.OPERATION_ABORTED&&(b.code===L.CAN_NOT_GET_GATEWAY_SERVER?b.data.retry:(Le.joinWebProxyAP(t.sid,{lts:m,sucess:0,apServerAddr:c,turnServerAddrList:null,errorCode:b.code,eventType:t.cloudProxyServer,unilbsServerIds:h.toString(),extend:JSON.stringify({networkState:y})}),R.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),b),!0)),i)}const W3=(e,t,n,i,a,c)=>{const{sid:d,clientId:h,cloudProxyServer:m}=n,g=[],_=v=>{v.flag===4096?Le.joinChooseServer(d,{role:n.role,lts:i,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:v.error.message,csIp:v.error.data&&v.error.data.csIp,unilbsServerIds:a.toString(),isHttp3:c,corssRegionTagReq:n.apRequestDetail}):v.flag!==1048576&&v.flag!==4194304&&v.flag!==4194310||Le.joinWebProxyAP(d,{lts:i,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:v.error.code,eventType:m,unilbsServerIds:a.toString()})};if(e.response_body.forEach(v=>{const y=v.buffer.code;if(v.uri===23&&y===0&&!v.buffer.edges_services)if(v.buffer.flag===4194310)R.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),v.buffer.edges_services=[];else{const b={error:new se(L.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:D("NO_EDGES_RETRY"),csIp:e.detail[502]}),flag:v.buffer.flag};g.push(b),_(b)}if(y!==0){const b=sm(y),O={error:new se(L.CAN_NOT_GET_GATEWAY_SERVER,b.desc,{desc:b.desc,retry:b.retry,csIp:e.detail[502]}),flag:v.buffer.flag};v.buffer.flag===4194310?R.warning(O.error.toString()):g.push(O),_(O)}}),g.length)throw R.warning("[".concat(h||"sid-".concat(d.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(g.map(v=>"flag: ".concat(v.flag,", message: ").concat(v.error.message,", retry: ").concat(v.error.data.retry)).join(" | "))),new se(L.CAN_NOT_GET_GATEWAY_SERVER,g.map(v=>"flag: ".concat(v.flag,", message: ").concat(v.error.message)).join(" | "),{retry:!!g.find(v=>v.error.data.retry),csIp:e.detail[502],desc:[...new Set(g.map(v=>{var y;return v==null||(y=v.error)===null||y===void 0||(y=y.data)===null||y===void 0?void 0:y.desc}).filter(v=>!!v))]})},HA=e=>{var t,n,i,a;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new se(L.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(D("AP_AREA")&&((i=e.detail)!==null&&i!==void 0&&i[23]&&typeof((a=e.detail)===null||a===void 0?void 0:a[23])=="string"?V3(e.detail[23].toLowerCase()):V3()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){const d=e.detail[19],h=d==null?void 0:d.split(";");for(let m=0;m<h.length;m++){var c;const g=bi(c=h[m]).call(c);e.addresses[m]&&h&&(e.addresses[m].fingerprint=g)}}if(D("GATEWAY_ADDRESS")&&D("GATEWAY_ADDRESS").length>0){R.debug("assign gateway address to",D("GATEWAY_ADDRESS"));const d=D("GATEWAY_ADDRESS").map(h=>{var m,g;const _=(m=(g=e.addresses.find(v=>v.ip===h.ip&&v.port===h.port))===null||g===void 0?void 0:g.fingerprint)!==null&&m!==void 0?m:"";return{ip:h.ip,port:h.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:h.fingerprint||_}});e.addresses=d}},_ae=(e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(n.buffer.code!==0){const i=sm(n.buffer.code);throw new se(L.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return n.buffer.ticket}throw R.debug("update ticket request received ap response without response body:",t),new se(L.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},KA=(e,t,n)=>{const i=Math.floor(Math.random()*1e12),a=e.role==="host"?"1":e.role==="audience"?"2":void 0,c={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:dc(dc(dc({6:e.stringUid,11:t,12:D("USE_NEW_TOKEN")?"1":void 0},a?{17:a}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};c.request_bodies.forEach(h=>{e.multiIP&&e.multiIP.gateway_ip&&(h.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const d=new FormData;return d.append("request",JSON.stringify(c)),[d,i]},Eae=(e,t)=>{const n=Math.floor(Math.random()*1e12),i={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(c=>({ip:c.ip,port:c.port}))}}]},a=new FormData;return a.append("request",JSON.stringify(i)),[a,n]};let cm=0;function lm(e){return we.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}const Zg=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:i,allFailedhandler:a,promisesCollector:c}=e,d=0;const h=t;let m,g=0;const _=async()=>{const v=(()=>{const y=d*h,b=y+h;return n.slice(y,b).map(i)})();c&&c.push(...v);try{m=await lm(v)}catch(y){if(g+=h,d++,!(g>=n.length))return void await _();a(y)}v.forEach(y=>y.cancel())};return await _(),m},z3=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:i}=e;const a=t.length;let c=0;const d=async()=>{const h=n(t.shift());try{return await h}catch(m){if(c++,c>=a||i!=null&&i(m))throw m;return d()}};return d()};async function vae(){if(typeof VideoDecoder>"u")return!0;let e;const t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],n=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],i=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],a=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],c=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],d=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new we((m,g)=>{let _;(async function(){e&&e.state!=="closed"||await async function(){e=new VideoDecoder({output:y=>{y.close(),clearTimeout(_),m(!0)},error:y=>{clearTimeout(_),m(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})}();const v=[t,n,i,a,c,d];for(let y=0;y<v.length;y++){const b=new EncodedVideoChunk({type:y==0?"key":"delta",timestamp:33333*y,duration:33333,data:new Uint8Array(v[y])});try{await e.decode(b)}catch{return void m(!1)}}})(),_=setTimeout(()=>{m(!1)},5e3)})}async function rT(e,t,n,i){return{gatewayInfo:await async function(c,d,h,m){let g=null;const _=[],v=async()=>{const b=D("WEBCS_DOMAIN").slice(0,D("AJAX_REQUEST_CONCURRENT")).map(N=>({url:c.proxyServer?"https://".concat(c.proxyServer,"/ap/?url=").concat(N+"/api/v2/transpond/webrtc?v=2"):"https://".concat(N,"/api/v2/transpond/webrtc?v=2"),areaCode:$g()})),O=m.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:b.map(N=>N.url)}),I=await Zg({fragementLength:D("FRAGEMENT_LENGTH"),referenceList:b,asyncMapHandler:N=>(R.debug("[".concat(c.clientId,"] Connect to choose_server:"),N.url),B3(N,c,d,h)),allFailedhandler:N=>{throw m.recordJoinChannelService({endTs:Date.now(),status:"error",errors:N},O),N[0]},promisesCollector:_});return m.recordJoinChannelService({endTs:Date.now(),status:"success"},O),I},y=async()=>{if(await pr(1e3),g!==null)return g;const b=D("WEBCS_DOMAIN_BACKUP_LIST").map(N=>({url:c.proxyServer?"https://".concat(c.proxyServer,"/ap/?url=").concat(N+"/api/v2/transpond/webrtc?v=2"):"https://".concat(N,"/api/v2/transpond/webrtc?v=2"),areaCode:$g()})),O=m.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:b.map(N=>N.url)}),I=await Zg({fragementLength:D("FRAGEMENT_LENGTH"),referenceList:b,asyncMapHandler:N=>(R.debug("[".concat(c.clientId,"] Connect to backup choose_server:"),N.url),B3(N,c,d,h)),allFailedhandler:N=>{throw m.recordJoinChannelService({endTs:Date.now(),status:"error",errors:N},O),N[0]},promisesCollector:_});return m.recordJoinChannelService({endTs:Date.now(),status:"success"},O),I};try{return g=await lm([v(),y()]),_.length&&_.forEach(b=>b.cancel&&typeof b.cancel=="function"&&b.cancel()),g}catch(b){throw b[0]}}(e,t,n,i)}}async function H3(e,t,n,i,a){const c=e.cloudProxyServer;if(c==="disabled"){if(e.useLocalAccessPoint)return await rT(e,t,n,a);if(D("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:y,proxyInfo:b}=await Y3(e,t,n,a);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:y};const O=b.map(I=>({turnServerURL:I.address,tcpport:I.tcpport||zr.tcpport,udpport:I.udpport||zr.udpport,username:I.username||zr.username,password:I.password||zr.password,forceturn:!1,security:!0}));if(a.useP2P){var d;const I=(d=e.uid)!==null&&d!==void 0?d:y.uid,N="glb:".concat(I.toString()),k=await AI(N),j=b.map(G=>({turnServerURL:G.address,tcpport:G.tcpport||zr.tcpport,udpport:G.udpport||zr.udpport,username:N,password:k,forceturn:!1,security:!0}));O.push(...j)}return e.turnServer={mode:"manual",servers:O},{gatewayInfo:y}}return await rT(e,t,n,a)}const{proxyInfo:h,gatewayInfo:m}=await Y3(e,t,n,a),g={gatewayInfo:m},_=h.map(y=>({turnServerURL:y.address,tcpport:c==="proxy3"?void 0:y.tcpport?y.tcpport:zr.tcpport,udpport:c==="proxy4"?void 0:y.udpport?y.udpport:zr.udpport,username:y.username||zr.username,password:y.password||zr.password,forceturn:c!=="proxy4",security:c==="proxy5"}));if(a.useP2P){var v;const y=(v=e.uid)!==null&&v!==void 0?v:m.uid,b="glb:".concat(y.toString()),O=await AI(b),I=h.map(N=>({turnServerURL:N.address,tcpport:c==="proxy3"?void 0:N.tcpport||zr.tcpport,udpport:c==="proxy4"?void 0:N.udpport||zr.udpport,username:b,password:O,forceturn:c!=="proxy4",security:c==="proxy5"}));_.push(...I)}return e.turnServer={mode:"manual",servers:_},R.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(c)),g}async function K3(e,t,n,i,a){const c=D("ACCOUNT_REGISTER").slice(0,D("AJAX_REQUEST_CONCURRENT"));let d=[];d=t.proxyServer?c.map(m=>"https://".concat(t.proxyServer,"/ap/?url=").concat(m+"/api/v1")):c.map(m=>"https://".concat(m,"/api/v1"));const h=a==null?void 0:a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:d});try{const m=await async function(g,_,v,y,b){const O=Date.now(),I={sid:v.sid,opid:10,appid:v.appId,string_uid:_};let N=g[0];const k=await pa(()=>va(N+"".concat(N.indexOf("?")===-1?"?":"&","action=stringuid"),{data:I,cancelToken:y,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(j,G)=>{if(j.code===0){if(j.uid<=0||j.uid>=Math.pow(2,32))throw R.error("Invalid Uint Uid ".concat(_," => ").concat(j.uid),j),Le.reqUserAccount(I.sid,{lts:O,success:!1,serverAddr:N,stringUid:I.string_uid,uid:j.uid,errorCode:L.INVALID_UINT_UID_FROM_STRING_UID,extend:I}),new se(L.INVALID_UINT_UID_FROM_STRING_UID);return Le.reqUserAccount(I.sid,{lts:O,success:!0,serverAddr:N,stringUid:I.string_uid,uid:j.uid,errorCode:null,extend:I}),!1}const K=sm(j.code);return K.retry&&(N=g[(G+1)%g.length]),Le.reqUserAccount(I.sid,{lts:O,success:!1,serverAddr:N,stringUid:I.string_uid,uid:j.uid,errorCode:K.desc,extend:I}),K.retry},(j,G)=>j.code!==L.OPERATION_ABORTED&&(Le.reqUserAccount(I.sid,{lts:O,success:!1,serverAddr:N,stringUid:I.string_uid,uid:null,errorCode:j.code,extend:I}),N=g[(G+1)%g.length],!0),b);if(k.code!==0){const j=sm(k.code);throw new se(L.UNEXPECTED_RESPONSE,j.desc)}return k}(d,e,t,n,i);return a==null||a.recordJoinChannelService({status:"success",endTs:Date.now()},h),m.uid}catch(m){throw a==null||a.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[m]},h),m}}async function yae(e,t,n){const i=D("ACCOUNT_REGISTER");let a=[];a=t.proxyServer?i.map(c=>"https://".concat(t.proxyServer,"/ap/?url=").concat(c+"/api/v1")):i.map(c=>"https://".concat(c,"/api/v1"));try{return await z3({referenceList:a,asyncMapHandler:d=>async function(h,m,g,_){const v=Date.now(),y={sid:g.sid,opid:10,appid:g.appId,string_uid:m};try{const b=await va(h+"".concat(h.indexOf("?")===-1?"?":"&","action=stringuid"),{data:y,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(b.code!==0){const O=sm(b.code);throw new se(L.UNEXPECTED_RESPONSE,"preload sua error:".concat(O.desc),O)}if(b.uid<=0||b.uid>=Math.pow(2,32))throw new se(L.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:v,url:h,req:y,uid:b.uid,elapse:Date.now()-v}}catch(b){throw b}}(d,e,t,n),closeFn:d=>d.code===L.OPERATION_ABORTED||d.code===L.UNEXPECTED_RESPONSE&&!d.data.retry})}catch(c){throw c}}async function Sae(e,t,n){const i=D("CDS_AP").slice(0,D("AJAX_REQUEST_CONCURRENT")).map(m=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(m+"/api/v1"):"https://".concat(m,"/api/v1?action=config")),a=i.map(m=>function(g,_,v,y){const b=Pt(),O={flag:64,cipher_method:0,features:dc(dc(dc(dc(dc({install_id:BI(),device:b.name,system:b.os,system_general:navigator.userAgent,vendor:_.appId,version:ro,cname:_.cname,session_id:_.sid,proxyServer:_.proxyServer,sdk_type:uae.WEB_RTC,browser_name:b.name,browser_version:b.version,user_agent:navigator.userAgent,channel_name:_.cname},_.stringUid&&{string_uid:_.stringUid}),_.uid&&{uid:_.uid+""}),b.os&&{os_name:b.os}),b.osVersion&&{os_version:b.osVersion}),{},{detail:""})};return pa(()=>va(g,{data:O,timeout:1e3,cancelToken:v,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,I=>I.code!==L.OPERATION_ABORTED,y)}(m,e,t,n));let c=null,d=null,h={};try{c=await lm(a)}catch(m){if(m.code===L.OPERATION_ABORTED)throw m;d=m}if(a.forEach(m=>m.cancel()),Le.reportApiInvoke(e.sid,{name:_n.REQUEST_CONFIG_DISTRIBUTE,options:{error:d,res:c}}).onSuccess(),c&&c.test_tags)try{h=function(m){if(!m.test_tags)return{};const g=m.test_tags,_=Object.keys(g),v={};return _.forEach(y=>{var b;const O=bi(b=y.slice(4)).call(b),I=JSON.parse(g[y]),N=I[1];v[O]={tag:I[0]||"",value:N}}),v}(c)}catch{}return h}async function q3(e,t){const n=D("WEBCS_DOMAIN").concat(D("WEBCS_DOMAIN_BACKUP_LIST")).map(i=>({url:"https://".concat(i,"/api/v2/transpond/webrtc?v=2"),areaCode:$g(),serviceIds:[qn.CHOOSE_SERVER,qn.CLOUD_PROXY_FALLBACK]}));try{return await z3({referenceList:n,asyncMapHandler:a=>async function(c,d,h){let m,{url:g,areaCode:_,serviceIds:v}=c;const y=Date.now(),[b,O]=KA(d,_,v);let I=Nn.networkState;try{I&&Nn.networkState===wi.OFFLINE&&Nn.onlineWaiter&&await we.race([Nn.onlineWaiter,pr(Kn.maxRetryTimeout)]),I=Nn.networkState;const{data:N,headers:k}=await va(g,{data:b,cancelToken:h,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);m=k.http3==="1"?1:-1,(X=>{const z=[];if(X.response_body.forEach(ne=>{const me=ne.buffer.code;if(ne.uri===23&&me===0&&!ne.buffer.edges_services)if(ne.buffer.flag===4194310)ne.buffer.edges_services=[];else{const Ee={error:new se(L.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:D("NO_EDGES_RETRY"),csIp:X.detail[502]}),flag:ne.buffer.flag};z.push(Ee)}if(me!==0){const Ee=sm(me),Oe={error:new se(L.CAN_NOT_GET_GATEWAY_SERVER,Ee.desc,{desc:Ee.desc,retry:Ee.retry,csIp:X.detail[502]}),flag:ne.buffer.flag};ne.buffer.flag===4194310?R.warning(Oe.error.toString()):z.push(Oe)}}),z.length)throw new se(L.CAN_NOT_GET_GATEWAY_SERVER,z.map(ne=>"flag: ".concat(ne.flag,", message: ").concat(ne.error.message)).join(" | "),{retry:!!z.find(ne=>ne.error.data.retry),csIp:X.detail[502],desc:[...new Set(z.map(ne=>{var me;return ne==null||(me=ne.error)===null||me===void 0||(me=me.data)===null||me===void 0?void 0:me.desc}).filter(ne=>!!ne))]})})(N);const G=Kg(N,qn.CHOOSE_SERVER),K=Kg(N,qn.CLOUD_PROXY_FALLBACK);return HA(G),{gatewayInfo:OA(G,g),proxyInfo:K,opid:O,requestTime:y,url:g,isHttp3:m,elapse:Date.now()-y}}catch(N){throw N}}(a,e,t),closeFn:a=>a.code===L.OPERATION_ABORTED||a.code===L.CAN_NOT_GET_GATEWAY_SERVER&&!a.data.retry})}catch(i){throw i}}async function Y3(e,t,n,i){const a=D("PROXY_SERVER_TYPE3"),c=(b,O,I)=>{let N=I||a;return Array.isArray(N)&&(N=O%2==0&&a[1]||a[0]),"https://".concat(N,"/ap/?url=").concat(b)};let d=null;const h=[],m=async()=>{const b=D("WEBCS_DOMAIN").slice(0,D("AJAX_REQUEST_CONCURRENT")).map((N,k)=>{let j;return j=e.cloudProxyServer==="disabled"&&e.proxyServer?c("".concat(N,"/api/v2/transpond/webrtc?v=2"),k,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(N,"/api/v2/transpond/webrtc?v=2"):c("".concat(N,"/api/v2/transpond/webrtc?v=2"),k),{url:j,areaCode:$g(),serviceIds:[qn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?qn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?qn.CLOUD_PROXY:qn.CLOUD_PROXY_FALLBACK]}}),O=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:b.map(N=>N.url)}),I=await Zg({fragementLength:D("FRAGEMENT_LENGTH"),referenceList:b,asyncMapHandler:N=>(R.debug("[".concat(e.clientId,"] Connect to choose_server:"),N.url),G3(N,e,t,n)),allFailedhandler:N=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:N},O),N[0]},promisesCollector:h});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},O),I},g=async()=>{if(await pr(1e3),d!==null)return d;const b=D("WEBCS_DOMAIN_BACKUP_LIST").map((N,k)=>{let j;return j=e.cloudProxyServer==="disabled"&&e.proxyServer?c("".concat(N,"/api/v2/transpond/webrtc?v=2"),k,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(N,"/api/v2/transpond/webrtc?v=2"):c("".concat(N,"/api/v2/transpond/webrtc?v=2"),k),{url:j,areaCode:$g(),serviceIds:[qn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?qn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?qn.CLOUD_PROXY:qn.CLOUD_PROXY_FALLBACK]}}),O=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:b.map(N=>N.url)}),I=await Zg({fragementLength:D("FRAGEMENT_LENGTH"),referenceList:b,asyncMapHandler:N=>(R.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),N.url),G3(N,e,t,n)),allFailedhandler:N=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:N},O),N[0]},promisesCollector:h});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},O),I};let _,v,y;try{({gatewayInfo:_,proxyInfo:v,url:y}=await lm([m(),g()]))}catch(b){throw b[0]}if(h.length&&h.forEach(b=>b.cancel&&typeof b.cancel=="function"&&b.cancel()),!_||!v)throw new se(L.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=y,e.cloudProxyServer!=="disabled"&&Array.isArray(a)&&y){const b=/^https?:\/\/(.+?)(\/.*)?$/.exec(y)[1];ve(a).call(a,b)&&(e.proxyServer=b,R.setProxyServer(b),Le.setProxyServer(b))}return d={gatewayInfo:_,proxyInfo:await E3(v,_.uid)},d}async function Tae(e,t,n){const i=D("UAP_AP").slice(0,D("AJAX_REQUEST_CONCURRENT")).map(c=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(c+"/api/v1?action=uap"):"https://".concat(c,"/api/v1?action=uap")),a=i.map(c=>function(d,h,m,g){const _={command:"convergeAllocateEdge",sid:h.sid,appId:h.appId,token:h.token,ts:Date.now(),version:ro,cname:h.cname,uid:h.uid.toString(),requestId:zA,seq:zA};zA+=1;const v={service_name:"tele_channel",json_body:JSON.stringify(_)};return pa(async()=>{const y=await va(d,{data:v,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(y.code!==0){const O=new se(L.UNEXPECTED_RESPONSE,"cross channel ap error, code"+y.code,{retry:!0});throw R.error(O.toString()),O}const b=JSON.parse(y.json_body);if(b.code!==200){const O=new se(L.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(b.code,", reason: ").concat(b.reason));throw R.error(O.toString()),O}if(!b.servers||b.servers.length===0){const O=new se(L.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw R.error(O.toString()),O}return{vid:b.vid,workerToken:b.workerToken,addressList:(D("CHANNEL_MEDIA_RELAY_SERVERS")||b.servers).map(O=>"wss://".concat(O.address.replace(/\./g,"-"),".").concat(D("WORKER_DOMAIN"),":").concat(O.wss))}},void 0,y=>!!(y.code!==L.OPERATION_ABORTED&&y.code!==L.UNEXPECTED_RESPONSE||y.data&&y.data.retry),g)}(c,e,t,n));try{const c=await lm(a);return a.forEach(d=>d.cancel()),c}catch(c){throw c[0]}}async function bae(e,t,n){let i=null;const a=[],c=async d=>{const h=D(d?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(m=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(m+"/api/v2/transpond/webrtc?v=2"):"https://".concat(m,"/api/v2/transpond/webrtc?v=2"));return d&&(await pr(1e3),i!==null)?i:await Zg({fragementLength:D("FRAGEMENT_LENGTH"),referenceList:h,asyncMapHandler:m=>(R.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(d?"backup":""," choose_server:"),m),function(g,_,v,y){const[b]=Eae(_,[qn.CHOOSE_SERVER]);let O=Nn.networkState;return pa(async()=>{O&&Nn.networkState===wi.OFFLINE&&Nn.onlineWaiter&&await we.race([Nn.onlineWaiter,pr(y&&y.maxRetryTimeout||Kn.maxRetryTimeout)]),O=Nn.networkState;const I=await va(g,{data:b,cancelToken:v,headers:{"Content-Type":"multipart/form-data;"}},!0);return _ae(I,g)},()=>!1,I=>I.code!==L.OPERATION_ABORTED&&(I.code===L.UPDATE_TICKET_FAILED?I.data.retry:(R.warning("[".concat(_.clientId,"] update ticket network error, retry"),I),!0)),y)}(m,e,t,n)),allFailedhandler:m=>{throw m[0]},promisesCollector:a})};try{return i=await lm([c(!1),c(!0)]),a.length&&a.forEach(d=>d.cancel&&typeof d.cancel=="function"&&d.cancel()),i}catch(d){throw d[0]}}function X3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function qA(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?X3(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X3(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class Rae extends Sn{get isSuccess(){return!!this.configs}constructor(t,n){super(),x(this,"configs",void 0),x(this,"store",void 0),x(this,"joinInfo",void 0),x(this,"cancelToken",void 0),x(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),x(this,"interval",void 0),x(this,"mutex",void 0),x(this,"mutableParamsRead",!1),x(this,"configCache",{}),x(this,"limit_bitrate",void 0),this.mutex=new Cr("config-distribute",t),this.store=n}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),D("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},D("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Le.reportApiInvoke(null,{options:void 0,name:_n.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:rn.TRACER}).onSuccess(JSON.stringify(Ms))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void R.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await Sae(this.joinInfo,this.cancelToken,this.retryConfig),R.debug("[config-distribute] get config distribute",JSON.stringify(t));const i=function(a){var c;const d=Tu(c=Object.keys(a).filter(g=>/^webrtc_ng_global_parameter/.test(g))).call(c);for(let g=0;g<d.length;g++)for(let _=d.length-1;_>g;_--){const v=d[_],y=a[v].value;if(typeof y.__priority=="number"){const b=y.__priority,O=d[_-1],I=a[O].value;if(typeof I.__priority=="number"){if(!(b>I.__priority))continue;{const N=v;d[_]=d[_-1],d[_-1]=N}}else{const N=v;d[_]=d[_-1],d[_-1]=N}}}const h=Date.now(),m={};return d.forEach(g=>{const _=a[g].value.__expires;_&&_<=h||(m[g]=a[g])}),m}(t);this.cacheGlobalParameterConfig(i),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=i}catch(i){const a=new se(L.NETWORK_RESPONSE_ERROR,i);R.warning("[config-distribute] ".concat(a.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){l3(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(ga.UPDATE_BITRATE_LIMIT,t):this.emit(ga.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&qA({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const n={},i=Object.keys(t),a=[];i.forEach(c=>{const d=t[c].value;n[c]=d;const h=d.__id;if(h&&this.configCache[c]&&this.configCache[c].__id===h)return;const m=d.__type,g=t[c].value,_=t[c].tag;let v=0;m?m===AV.REALTIME&&(v=1):Object.keys(g).some(y=>Object.prototype.hasOwnProperty.call(HI,y)||!vA()&&Object.prototype.hasOwnProperty.call(yS,y)?(v=1,!0):void 0),a.push({tag:_,isApplied:v,feature:c,params:JSON.stringify(d)})}),a.forEach(c=>{let{tag:d,feature:h,params:m,isApplied:g}=c;this.store.sessionId&&Le.abTest(this.store.sessionId,{intSucc:1,isApplied:g,tag:d,feature:h,params:m,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){R.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(t){const n=function(a){const c={};return Object.keys(a).forEach(d=>{const h=a[d].value,m=h.__expires,g=h.__type;Object.keys(h).forEach(_=>{_==="__id"||_==="__type"||_==="__priority"||_==="__expires"||Object.prototype.hasOwnProperty.call(c,_)||(c[_]=qA(qA({value:h[_]},m&&{expires:m}),g&&{type:g}))})}),c}(t);try{var i;const a=(i=n.LIMIT_BITRATE)===null||i===void 0?void 0:i.value;delete n.LIMIT_BITRATE,a&&l3(a)&&this.handleBitrateLimit(a),this.limit_bitrate=a,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(t),function(h){try{const m=Date.now();Object.keys(h).forEach(g=>{const{value:_,type:v,expires:y}=h[g];y&&y<=m||((v===AV.REALTIME||Object.prototype.hasOwnProperty.call(HI,g))&&(Ms[g]=_,zt[g]=_,R.debug("Update realtime parameters from config distribute",g,_)),v||vA()||!Object.prototype.hasOwnProperty.call(yS,g)||(Ms[g]=_,zt[g]=_,R.debug("Update gateway parameters from config distribute",g,_)))})}catch(m){R.error("Error update config immediately: ".concat(h),m.message)}}(n);const c=JSON.stringify(n),d=window.btoa(c);window.localStorage.setItem("websdk_ng_global_parameter",d),R.debug("Caching global parameters ".concat(c))}catch(a){R.error("Error caching global parameters:",a.message)}}handleGlobalParameterConfig(t){try{const n=Date.now();Object.keys(t).forEach(i=>{switch(i){case"CLIENT_ROLE_OPTIONS":if(Object.prototype.hasOwnProperty.call(zt,i)){const{value:c,expires:d}=t[i];if(d&&d<=n)return;DI(zt[i],c)||(Ms[i]=c,zt[i]=c,this.emit(ga.UPDATE_CLIENT_ROLE_OPTIONS,c),R.debug("Updating client role options: ".concat(JSON.stringify(c))))}break;case"REMOTE_VIDEO_STREAM_TYPE":if(Object.prototype.hasOwnProperty.call(zt,i)){var a;const{value:c,expires:d}=t[i];if(d&&d<=n)return;typeof c=="number"&&ve(a=[0,1,4,5,6,7,8,9]).call(a,c)&&(Ms[i]={value:c},zt[i]=c,this.emit(ga.UPDATE_REMOTE_VIDEO_STREAM_TYPE,c),R.debug("Updating client remote stream type: ".concat(JSON.stringify(c))))}break;case"ENABLE_FORCE_HLS":if(Object.prototype.hasOwnProperty.call(zt,i)){const{value:c,expires:d}=t[i];if(d&&d<=n)return;DI(zt[i],c)||(Ms[i]=c,zt[i]=c,this.emit(ga.FALLBACK_TO_HLS,c),R.debug("Updating enable force hls: ".concat(JSON.stringify(c))))}break;case"VOS_CONFIGURE":if(Object.prototype.hasOwnProperty.call(zt,i)){const{value:c,expires:d}=t[i];if(d&&d<=n)return;DI(zt[i],c)||(Ms[i]=c,zt[i]=c,this.emit(ga.UPDATE_VOS_CONFIGURE,c),R.debug("Updating vos configure: ".concat(JSON.stringify(c))))}}})}catch(n){R.error("Error handling global parameter config:",n.message)}}}class wae extends Sn{constructor(){super(...arguments),x(this,"resultStorage",new Map)}setLocalAudioStats(t,n,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(i,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(i,n))}setLocalVideoStats(t,n,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(i,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(i,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(i)),!n.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(i))}setRemoteAudioStats(t,n){const i=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const i=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(n))}record(t,n,i){if(D("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const a=this.resultStorage.get(t);if(!a)return;a.result.push(i);const c=t==="VIDEO_ENCODE_FAILED"?D("ENCODE_EXCEPTION_TIMES"):5;if(a.result.length>=c){var d;const h=ve(d=a.result).call(d,!0);a.isPrevNormal&&!h&&this.emit("exception",YA[t],t,n),!a.isPrevNormal&&h&&this.emit("exception",YA[t]+2e3,t+"_RECOVER",n),a.isPrevNormal=h,a.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof sr&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let i=null;n._encoderConfig&&n._encoderConfig.frameRate&&(i=Fi(n._encoderConfig.frameRate));const a=t.captureFrameRate;return!i||!a||!(i>10&&a<5||i<10&&i>=5&&a<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var n;return!(!t.codecType||ve(n=D("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(n,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof sr&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const YA={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},Jr=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function J3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function Qu(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?J3(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J3(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class e_{constructor(t){x(this,"store",void 0),x(this,"onStatsException",void 0),x(this,"onUploadPublishDuration",void 0),x(this,"onStatsChanged",void 0),x(this,"onVideoCodecChanged",void 0),x(this,"localStats",new Map),x(this,"remoteStats",new Map),x(this,"updateStatsInterval",void 0),x(this,"trafficStats",void 0),x(this,"trafficStatsPeerList",[]),x(this,"uplinkStats",void 0),x(this,"exceptionMonitor",void 0),x(this,"p2pChannel",void 0),x(this,"scalabilityMode",ES.L1T1),x(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new wae,this.exceptionMonitor.on("exception",(n,i,a)=>{this.onStatsException&&this.onStatsException(n,i,a)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(ye.LocalAudioTrack)||Qu({},QI)}getLocalVideoTrackStats(){return this.localStats.get(ye.LocalVideoTrack)||Qu({},$I)}getRemoteAudioTrackStats(t){const n=(c,d)=>{if(!this.trafficStats)return d;const h=this.trafficStats.peer_delay.find(m=>m.peer_uid===c);return h&&(d.publishDuration=h.B_ppad+(Date.now()-this.trafficStats.timestamp)),d},i={};if(t){var a;const c=(a=this.remoteStats.get(t))===null||a===void 0?void 0:a.audioStats;c&&(i[t]=n(t,c))}else Array.from(this.remoteStats.entries()).forEach(c=>{let[d,{audioStats:h}]=c;h&&(i[d]=n(d,h))});return i}getRemoteNetworkQualityStats(t){const n={};if(t){var i;const a=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.networkStats;a&&(n[t]=a)}else Array.from(this.remoteStats.entries()).forEach(a=>{let[c,{networkStats:d}]=a;d&&(n[c]=d)});return n}getNetworkQuality(){let t=0,n=0;return this.trafficStats&&(t=YS(this.trafficStats.B_unq),n=YS(this.trafficStats.B_dnq)),{uplinkNetworkQuality:t,downlinkNetworkQuality:n}}getRemoteVideoTrackStats(t){const n=(c,d)=>{if(!this.trafficStats)return d;const h=this.trafficStats.peer_delay.find(m=>m.peer_uid===c);return h&&(d.publishDuration=h.B_ppvd+(Date.now()-this.trafficStats.timestamp)),d},i={};if(t){var a;const c=(a=this.remoteStats.get(t))===null||a===void 0?void 0:a.videoStats;c&&(i[t]=n(t,c))}else Array.from(this.remoteStats.entries()).forEach(c=>{let[d,{videoStats:h}]=c;h&&(i[d]=n(d,h))});return i}getRTCStats(){let t=0,n=0,i=0,a=0;const c=this.localStats.get(ye.LocalAudioTrack);c&&(t+=c.sendBytes,n+=c.sendBitrate);const d=this.localStats.get(ye.LocalVideoTrack);d&&(t+=d.sendBytes,n+=d.sendBitrate);const h=this.localStats.get(ye.LocalVideoLowTrack);h&&(t+=h.sendBytes,n+=h.sendBitrate),this.remoteStats.forEach(g=>{let{audioStats:_,videoStats:v}=g;_&&(i+=_.receiveBytes,a+=_.receiveBitrate),v&&(i+=v.receiveBytes,a+=v.receiveBitrate)});let m=1;return this.trafficStats&&(m+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:m,SendBitrate:n,SendBytes:t,RecvBytes:i,RecvBitrate:a,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),t.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var i;const a=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(n.peer_uid),c=a!=null&&a.videoSSRC?Jr.measureFromSubscribeStart(this.store.clientId,a.videoSSRC):0,d=a!=null&&a.audioSSRC?Jr.measureFromSubscribeStart(this.store.clientId,a.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,c>d?c:d),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&R.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,i){if(!t)return!1;const a=!!i&&n.framesDecodeFreezeTime>i.framesDecodeFreezeTime,c=!i||n.framesDecodeCount>i.framesDecodeCount;return a||!c}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[i,a]=n;switch(i){case ye.LocalVideoTrack:case ye.LocalVideoLowTrack:{const h=a,m=Qu({},$I),g=t.getStats(),_=t.getLocalMedia(i);if(g){const v=g.videoSend.find(y=>y.ssrc===(_==null?void 0:_.ssrcs[0].ssrcId));if(v){const y=t.getLocalVideoSize(),b=t.getEncoderConfig(ye.LocalVideoTrack);var c;(v.codec==="H264"||v.codec==="H265"||v.codec==="VP8"||v.codec==="VP9"||v.codec==="AV1X"||v.codec==="AV1")&&(m.codecType=v.codec,(h==null?void 0:h.codecType)!==v.codec&&((c=this.onVideoCodecChanged)===null||c===void 0||c.call(this,v.codec.toLocaleLowerCase()))),m.sendBytes=v.bytes,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0,v.inputFrame?(m.captureFrameRate=v.inputFrame.frameRate,m.captureResolutionHeight=v.inputFrame.height,m.captureResolutionWidth=v.inputFrame.width):y&&(m.captureResolutionWidth=y.width,m.captureResolutionHeight=y.height),v.sentFrame?(m.sendFrameRate=v.sentFrame.frameRate,m.sendResolutionHeight=v.sentFrame.height,m.sendResolutionWidth=v.sentFrame.width):y&&(m.sendResolutionWidth=y.width,m.sendResolutionHeight=y.height),v.avgEncodeMs&&(m.encodeDelay=v.avgEncodeMs),b&&b.bitrateMax?m.targetSendBitrate=1e3*b.bitrateMax:v.targetBitrate&&(m.targetSendBitrate=v.targetBitrate),m.sendPackets=v.packets,m.sendPacketsLost=v.packetsLost,m.sendJitterMs=v.jitterMs,m.sendRttMs=v.rttMs,m.totalDuration=h?h.totalDuration+1:1,m.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(v)&&(m.totalFreezeTime+=1),v.scalabilityMode&&this.scalabilityMode!==v.scalabilityMode&&(R.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(v.scalabilityMode)),this.scalabilityMode=v.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var d;this.localStats.set(i,m),((h==null?void 0:h.sendResolutionWidth)!==m.sendResolutionWidth||(h==null?void 0:h.sendResolutionHeight)!==m.sendResolutionHeight)&&((d=this.onStatsChanged)===null||d===void 0||d.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&_&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,_.track,m);break}case ye.LocalAudioTrack:{const h=a,m=Qu({},QI),g=t.getStats(),_=t.getLocalMedia(i);if(g){const v=g.audioSend.find(y=>y.ssrc===(_==null?void 0:_.ssrcs[0].ssrcId));if(v){if(v.codec!=="opus"&&v.codec!=="aac"&&v.codec!=="PCMU"&&v.codec!=="PCMA"&&v.codec!=="G722"||(m.codecType=v.codec),v.inputLevel)m.sendVolumeLevel=Math.round(32767*v.inputLevel);else{const y=t.getLocalAudioVolume();y&&(m.sendVolumeLevel=Math.round(32767*y))}m.sendBytes=v.bytes,m.sendPackets=v.packets,m.sendPacketsLost=v.packetsLost,m.sendJitterMs=v.jitterMs,m.sendRttMs=v.rttMs,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(ye.LocalAudioTrack,m),m&&_&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,_.track,m);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{var i,a;let[c,{videoStats:d,audioStats:h,videoPcStats:m}]=n;const g=h,_=d,v=m,y=Qu({},GV),b=Qu({},WV),O=Qu({},doe),{audioTrack:I,videoTrack:N,audioSSRC:k,videoSSRC:j}=t.getRemoteMedia(c);let G;G=this.store.useP2P?t.getStats(!0):t.getStats();const K=(i=G)===null||i===void 0?void 0:i.audioRecv.find(me=>me.ssrc===k),X=(a=G)===null||a===void 0?void 0:a.videoRecv.find(me=>me.ssrc===j),z=this.trafficStats&&this.trafficStats.peer_delay.find(me=>me.peer_uid===c);if(K&&(K.codec!=="opus"&&K.codec!=="aac"&&K.codec!=="PCMU"&&K.codec!=="PCMA"&&K.codec!=="G722"||(y.codecType=K.codec),K.outputLevel?y.receiveLevel=Math.round(32767*K.outputLevel):I&&(y.receiveLevel=Math.round(32767*I.getVolumeLevel())),y.receiveBytes=K.bytes,y.receivePackets=K.packets,y.receivePacketsLost=K.packetsLost,y.receivePacketsDiscarded=K.packetsDiscarded,y.packetLossRate=y.receivePacketsLost/(y.receivePackets+y.receivePacketsLost),y.receiveBitrate=g?8*Math.max(0,y.receiveBytes-g.receiveBytes):0,y.totalDuration=g?g.totalDuration+1:1,y.totalFreezeTime=g?g.totalFreezeTime:0,y.freezeRate=y.totalFreezeTime/y.totalDuration,y.receiveDelay=K.jitterBufferMs,y.totalDuration>10&&e_.isRemoteAudioFreeze(I)&&(y.totalFreezeTime+=1)),X){var ne;X.codec!=="H264"&&X.codec!=="H265"&&X.codec!=="VP8"&&X.codec!=="VP9"&&X.codec!=="AV1X"&&X.codec!=="AV1"||(b.codecType=X.codec),b.receiveBytes=X.bytes,b.receiveBitrate=_?8*Math.max(0,b.receiveBytes-_.receiveBytes):0,b.decodeFrameRate=X.decodeFrameRate<0?0:X.decodeFrameRate,b.renderFrameRate=X.decodeFrameRate<0?0:X.decodeFrameRate,X.outputFrame&&(b.renderFrameRate=X.outputFrame.frameRate),X.receivedFrame?(b.receiveFrameRate=X.receivedFrame.frameRate,b.receiveResolutionHeight=X.receivedFrame.height,b.receiveResolutionWidth=X.receivedFrame.width):N&&(b.receiveResolutionHeight=N._videoHeight||0,b.receiveResolutionWidth=N._videoWidth||0),X.framesRateFirefox!==void 0&&(b.receiveFrameRate=Math.round(X.framesRateFirefox)),b.receivePackets=X.packets,b.receivePacketsLost=X.packetsLost,b.packetLossRate=b.receivePacketsLost/(b.receivePackets+b.receivePacketsLost);const me=_?_.totalFreezeTime:0,Ee=_?_.totalDuration:0;b.totalDuration=_?_.totalDuration+1:1,b.totalFreezeTime=(ne=X.totalFreezesDuration)!==null&&ne!==void 0?ne:me||0,b.receiveDelay=X.jitterBufferMs||0;const Oe=!!j&&t.getRemoteVideoIsReady(j);X.totalFreezesDuration===void 0&&N&&Oe&&e_.isRemoteVideoFreeze(N,X,v)&&(b.totalFreezeTime+=1),b.freezeRate=Math.max(0,Math.min((b.totalFreezeTime-me)/(b.totalDuration-Ee),1))}z&&(y.end2EndDelay=z.B_ad,b.end2EndDelay=z.B_vd,y.transportDelay=z.B_ed,b.transportDelay=z.B_ed,y.currentPacketLossRate=z.B_ealr4/100,b.currentPacketLossRate=z.B_evlr4/100,O.uplinkNetworkQuality=z.B_punq?z.B_punq:0,O.downlinkNetworkQuality=z.B_pdnq?z.B_pdnq:0),this.remoteStats.set(c,{audioStats:y,videoStats:b,videoPcStats:X,networkStats:O}),I&&this.exceptionMonitor.setRemoteAudioStats(I,y),N&&this.exceptionMonitor.setRemoteVideoStats(N,b)})}}class Q3{constructor(){x(this,"destChannelMediaInfos",new Map),x(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){a3(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){a3(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){BS(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function $3(e){if(!(e instanceof Q3))return new se(L.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new se(L.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new se(L.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class ad{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,n){x(this,"uid",void 0),x(this,"_uintid",void 0),x(this,"_trust_in_room_",!0),x(this,"_trust_audio_enabled_state_",!0),x(this,"_trust_video_enabled_state_",!0),x(this,"_trust_audio_mute_state_",!0),x(this,"_trust_video_mute_state_",!0),x(this,"_audio_muted_",!1),x(this,"_video_muted_",!1),x(this,"_audio_enabled_",!0),x(this,"_video_enabled_",!0),x(this,"_audio_added_",!1),x(this,"_video_added_",!1),x(this,"_is_pre_created",!1),x(this,"_video_pre_subscribed",!1),x(this,"_audio_pre_subscribed",!1),x(this,"_trust_video_stream_added_state_",!0),x(this,"_trust_audio_stream_added_state_",!0),x(this,"_audioTrack",void 0),x(this,"_videoTrack",void 0),x(this,"_dataChannels",[]),x(this,"_audioSSRC",void 0),x(this,"_videoSSRC",void 0),x(this,"_audioOrtc",void 0),x(this,"_videoOrtc",void 0),x(this,"_cname",void 0),x(this,"_rtxSsrcId",void 0),x(this,"_videoMid",void 0),x(this,"_audioMid",void 0),this.uid=t,this._uintid=n}}function Z3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function XA(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Z3(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z3(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const Cae=e=>`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1 2
a=msid-semantic: WMS
a=ice-lite`.concat(e?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:2
`),iT="9",JA=2e4,sT=4e4;let eB=class{get localCapabilities(){return mn(this._localCapabilities)}get rtpCapabilities(){return mn(this._rtpCapabilities)}get candidates(){return mn(this._candidates)}get iceParameters(){return mn(this._iceParameters)}get dtlsParameters(){return mn(this._dtlsParameters)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],n=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i=arguments.length>3&&arguments[3]!==void 0&&arguments[3];x(this,"sessionDesc",void 0),x(this,"_localCapabilities",void 0),x(this,"_rtpCapabilities",void 0),x(this,"_candidates",void 0),x(this,"_originCandidates",void 0),x(this,"_iceParameters",void 0),x(this,"_isUseExtmapAllowMixed",void 0),x(this,"_isUseLocalCodecs",void 0),x(this,"_isUseDataChannel",void 0),x(this,"_dtlsParameters",void 0),x(this,"setup",void 0),x(this,"currentMidIndex",void 0),x(this,"cname",void 0),x(this,"useLocalCodecsMids",[]),x(this,"preloadSsrcs",[]),x(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=t,this._isUseLocalCodecs=n,this._isUseDataChannel=i,e=mn(e);const{iceParameters:a,dtlsParameters:c,candidates:d,rtpCapabilities:h,setup:m,localCapabilities:g,cname:_}=e;this._rtpCapabilities=h,this._candidates=d,this._originCandidates=mn(d),this._iceParameters=a,this._dtlsParameters=c,this._localCapabilities=g,this.setup=m,this.cname=_,[this.sessionDesc]=this.updateRemoteRTPCapabilities(h),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(e){return e.length===this.preloadSsrcs.length&&e.every(t=>{var n;return ve(n=this.preloadSsrcs).call(n,t)})}preloadRemoteMedia(e){let t=0;const n=[],i=[];for(;e>0;){const a=[XA({ssrcId:sT+t},D("USE_SUB_RTX")?{rtx:sT+t+1}:{})],c="".concat(sT+t,"_").concat(JA+t),{ssrcs:d,ssrcGroups:h}=Xg(a,this.cname,D("SYNC_GROUP")?c:void 0),m=this.preCreateOrRecycleSendMedia("video",d,h,void 0),g=[{ssrcId:JA+t}],_="".concat(sT+t,"_").concat(JA+t),{ssrcs:v,ssrcGroups:y}=Xg(g,this.cname,D("SYNC_GROUP")?_:void 0),b=this.preCreateOrRecycleSendMedia("audio",v,y,void 0);e--,t+=2,n.push(m,b),i.push(d[0].ssrcId,v[0].ssrcId)}return this.useLocalCodecsMids.push(...n),this.preloadSsrcs=i,{mids:n,preSSRCs:i,isAvailable:!0}}preCreateOrRecycleSendMedia(e,t,n,i){const a=this.rtpCapabilities.send.videoCodecs,c=this._isUseLocalCodecs||a.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;R.debug("create or recycle send media without remote rtp capabilities, ssrcs ",t[0].ssrcId);const d=e===De.VIDEO?c.videoCodecs:c.audioCodecs,h=e===De.VIDEO?c.videoExtensions:c.audioExtensions;this.currentMidIndex+=1;const m="".concat(this.currentMidIndex);let g={media:{mediaType:e,port:iT,protos:["UDP","TLS","RTP","SAVPF"],fmts:d.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:d,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(m)}};return g=this.mungSendMediaDesc(g,i),this.sessionDesc.mediaDescriptions.push(g),this.updateBundleMids(),m}toString(){return Kc(this.sessionDesc)}send(e,t,n,i){const{ssrcs:a,ssrcGroups:c}=Xg(t,this.cname,D("SYNC_GROUP")?n:void 0),d=this.findPreloadMediaDesc(a);if(d){if(pn()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,d.attributes.mid),i&&(i.twcc||i.remb)){const h=this.sessionDesc.mediaDescriptions.indexOf(d);return this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(d,i),{mid:d.attributes.mid,needExchangeSDP:!0}}return{mid:d.attributes.mid,needExchangeSDP:!1}}{const h=this.findAvailableMediaIndex(e,a);let m;return h===-1||h===1&&(wr()||function(){const g=Pt();return!(g.name!==Mt.CHROME||!g.osVersion)&&Number(g.version)<=90}()||ha(143)||$l(143)||D("RESERVE_MID_1_MLINE")||D("ENABLE_ENCODED_TRANSFORM")&&zc())||h===0&&!function(g){const _=Pt();return!(_.name!==Mt.FIREFOX||!_.osVersion)&&Number(_.version)===g}(138)&&D("USE_SUB_RTX")||Xj()?(m=this.createOrRecycleSendMedia(e,a,c,"sendonly",i),this.updateBundleMids()):(m=mn(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="sendonly",m.attributes.ssrcs=a,m.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(m,i)),pn()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,m.attributes.mid),{mid:m.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){const t=e.map(a=>{let{kind:c,ssrcMsg:d,mslabel:h}=a;return this.send(c,d,h)}),n=[];let i=!1;return t.forEach(a=>{let{mid:c,needExchangeSDP:d}=a;d&&(i=!0),n.push(c)}),{mids:n,needExchangeSDP:i}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.mid==="0"||pn()||Xj()?n.attributes.ssrcs=[]:(n.attributes.ssrcs=[],n.attributes.direction="inactive",n.media.port="0")}),this.updateBundleMids()}mute(e){const t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>ve(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>ve(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}receive(e,t,n,i){e.forEach((a,c)=>{this.createOrRecycleRecvMedia(a,[],"recvonly",t,n,i[c])}),this.updateBundleMids()}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e){const t=this.sessionDesc||Ci((n=this._isUseExtmapAllowMixed,this._isUseDataChannel?Cae(n):`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(n?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var n;this._rtpCapabilities=e;let i=!1;const a=this.rtpCapabilities.send,c=this.localCapabilities.send,d=this.localCapabilities.recv,h=d.videoCodecs,m=d.audioCodecs,g=d.videoExtensions,_=d.audioExtensions;for(const O of t.mediaDescriptions){var v;if(O.attributes.direction!=="sendonly"||typeof O.attributes.mid!="string"||!ve(v=this.useLocalCodecsMids).call(v,O.attributes.mid)){if(i=!0,O.attributes.iceUfrag=this._iceParameters.iceUfrag,O.attributes.icePwd=this._iceParameters.icePwd,O.attributes.fingerprints=this._dtlsParameters.fingerprints,O.attributes.candidates=this._candidates,O.attributes.setup=this.setup,O.media.mediaType==="application"&&(O.attributes.sctpPort="5000"),O.media.mediaType==="video")if(this._isUseLocalCodecs&&O.attributes.direction==="sendonly"){var y;O.media.fmts=h.map(N=>N.payloadType.toString(10)),O.attributes.payloads=h,O.attributes.extmaps=g;const I=O.attributes.mid;typeof I!="string"||ve(y=this.useLocalCodecsMids).call(y,I)||this.useLocalCodecsMids.push(I)}else if(a.videoCodecs.length===0){const I=c.videoCodecs.filter(N=>{var k,j;return(k=N.rtpMap)===null||k===void 0?void 0:ve(j=k.encodingName.toLowerCase()).call(j,"vp8")});I.length===0&&I.push(c.videoCodecs[0]),O.media.fmts=I.map(N=>N.payloadType.toString(10)),O.attributes.payloads=I,O.attributes.extmaps=[]}else O.media.fmts=a.videoCodecs.map(I=>I.payloadType.toString(10)),O.attributes.payloads=a.videoCodecs,O.attributes.extmaps=a.videoExtensions;if(O.media.mediaType==="audio")if(this._isUseLocalCodecs&&O.attributes.direction==="sendonly"){var b;O.media.fmts=m.map(N=>N.payloadType.toString(10)),O.attributes.payloads=m,O.attributes.extmaps=_;const I=O.attributes.mid;typeof I!="string"||ve(b=this.useLocalCodecsMids).call(b,I)||this.useLocalCodecsMids.push(I)}else if(a.audioCodecs.length===0){const I=c.audioCodecs.filter(N=>{var k,j;return(k=N.rtpMap)===null||k===void 0?void 0:ve(j=k.encodingName.toLowerCase()).call(j,"opus")})||[c.audioCodecs[0]];O.media.fmts=I.map(N=>N.payloadType.toString(10)),O.attributes.payloads=I,O.attributes.extmaps=[]}else O.media.fmts=a.audioCodecs.map(I=>I.payloadType.toString(10)),O.attributes.payloads=a.audioCodecs,O.attributes.extmaps=a.audioExtensions,am(O)}}return this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1,[this.sessionDesc,i]}updateCandidates(e){const t=this._originCandidates.filter(i=>i.transport==="udp"),n=[];if(t.forEach(i=>{n.push(XA(XA({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),t.length!==0){switch(e){case Ir.TCP_RELAY:this._candidates=n;break;case Ir.UDP_TCP_RELAY:case Ir.RELAY:this._candidates=[...t,...n];break;default:this._candidates=t}for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}}restartICE(e){e=mn(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex(n=>{const i=n.media.mediaType===e&&n.media.port!=="0"&&(n.attributes.direction==="sendonly"||n.attributes.direction==="sendrecv")&&n.attributes.ssrcs.length===0;if(pn()){if(i){const a=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(a||n.attributes.mid!=="0"&&n.attributes.mid!=="1")||!(!a||a!==n.attributes.mid)}return!1}return i})}createOrRecycleDataChannel(){for(const n of this.sessionDesc.mediaDescriptions)if(n.media.mediaType==="application")return{mediaDesc:n,needExchangeSDP:!1};this.currentMidIndex+=1;const e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:iT,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,n,i,a,c){const d=e._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=Qg(d,h,this.localCapabilities.send,d===De.VIDEO?i:a),g=d===De.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const _="".concat(this.currentMidIndex);let v={media:{mediaType:d,port:iT,protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_)}};v=this.mungRecvMediaDsec(v,e,c);const y=this.findFirstClosedMedia(d);if(y){const b=this.sessionDesc.mediaDescriptions.indexOf(y);this.sessionDesc.mediaDescriptions[b]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}updateRemoteDtlsParameters(e){const t=new Set(this._dtlsParameters.fingerprints.map(a=>a.fingerprint)),n=new Set(e.map(a=>a.fingerprint));let i=!1;t.size!==n.size&&(i=!0);for(const a of t)n.has(a)||(i=!0);return i}updateRemoteCodec(e,t,n){const i=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(v=>v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||"").filter(v=>{var y;return ve(y=Object.keys(Vu)).call(y,v)}))],a=new Set(t);if(i.every(v=>a.has(v)))return R.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;const c=this._rtpCapabilities.recv.videoCodecs.filter(v=>t.some(y=>{var b;return ve(b=v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||"").call(b,y)}));if(c.length===0)return R.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(i," codecs: ").concat(t)),!1;const d=[...new Set(c.map(v=>v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||""))];let h;if(R.debug("updateRemoteCodec, from ".concat(i," to ").concat(d)),e.length===0)h=this.sessionDesc.mediaDescriptions.filter(v=>v.media.mediaType==="video"&&v.attributes.direction==="recvonly");else if(h=this.sessionDesc.mediaDescriptions.filter(v=>v.attributes.mid&&v.media.mediaType==="video"&&ve(e).call(e,v.attributes.mid)&&v.attributes.direction==="recvonly"),h.length!==e.length)return R.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(D("USE_PUB_RTX")||D("USE_SUB_RTX")){const v=od(c,this.rtpCapabilities.recv.videoCodecs);c.push(...v)}this._rtpCapabilities.recv.videoCodecs=c;const m=this.localCapabilities.send,g=this.rtpCapabilities.recv,_=Qg(De.VIDEO,g,m,n);return h.forEach(v=>{const y=_.map(b=>b.payloadType.toString(10));R.debug("updateRemoteCodec mid: ".concat(v.attributes.mid,", from"),v.attributes.payloads,"to",_),v.attributes.payloads=_,v.media.fmts=y}),R.debug("updateRemoteCodec success, mids: ".concat(e,", codecs: ").concat(t,", remote recv: ").concat(this._rtpCapabilities.recv.videoCodecs.length,", remote send: ").concat(this._rtpCapabilities.send.videoCodecs.length)),!0}createOrRecycleSendMedia(e,t,n,i,a){const c=this.rtpCapabilities.send.videoCodecs,d=this._isUseLocalCodecs||c.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,h=e===De.VIDEO?d.videoCodecs:d.audioCodecs,m=e===De.VIDEO?d.videoExtensions:d.audioExtensions;this.currentMidIndex+=1;const g="".concat(this.currentMidIndex);let _={media:{mediaType:e,port:iT,protos:["UDP","TLS","RTP","SAVPF"],fmts:h.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};_=this.mungSendMediaDesc(_,a);const v=this.findFirstClosedMedia(e);if(v){const y=this.sessionDesc.mediaDescriptions.indexOf(v);this.sessionDesc.mediaDescriptions[y]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}mungRecvMediaDsec(e,t,n){const i=mn(e);return kA(i),Ju(i,t),LA(i,t),A3(i),QS(i,n,this.localCapabilities.send),i}mungSendMediaDesc(e,t){const n=mn(e);return n.attributes&&n.attributes.payloads&&Array.isArray(n.attributes.payloads)&&n.attributes.payloads.length>0&&n.attributes.payloads.forEach(i=>{i.rtpMap&&i.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&D("ENABLE_DOWN_SPS_PPS")&&(i.fmtp&&i.fmtp.parameters||(i.fmtp={parameters:{}}),i.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),QS(n,t,this.localCapabilities.recv),am(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===e);if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=i}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>pn()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}getSSRC(e){var t;return(t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e))===null||t===void 0?void 0:t.attributes.ssrcs}};function tB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function Jc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?tB(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tB(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}var dm=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(dm||{});const oT=new Map;function nB(e,t,n,i){let{scale:a}=e;if(a===0&&i===dm.UP||a>=t.length-1&&i===dm.DOWN)return e;let c=Jc(Jc({},e),{},{scale:i===dm.DOWN?++a:--a});switch(n){case"maintain-framerate":c=Jc(Jc({},c),t[a].motion);break;case"maintain-resolution":c=Jc(Jc({},c),t[a].detail);break;case"balanced":c=Jc(Jc({},c),t[a].balanced)}return c}function rB(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:iB(t)};oT.set(e,n)}else oT.delete(e)}function iB(e){const t=Jc({},e),{bitrateMax:n,frameRate:i,scaleResolutionDownBy:a,bitrateMin:c}=t,{MIN_FRAME_RATE:d,MAX_THRESHOLD_FRAMERATE:h,MAX_SCALE:m,BITRATE_MIN_THRESHOLD:g,BITRATE_MAX_THRESHOLD:_,BWE_SCALE_UP_THRESHOLD:v,BWE_SCALE_DOWN_THRESHOLD:y,PERF_SCALE_DOWN_THRESHOLD:b,PERF_SCALE_UP_THRESHOLD:O,BALANCE_BITRATE_FACTOR:I,BALANCE_FRAMERATE_FACTOR:N,BALANCE_RESOLUTION_FACTOR:k,MOTION_RESOLUTION_FACTOR:j,MOTION_BITRATE_FACTOR:G,DETAIL_FRAMERATE_FACTOR:K,DETAIL_BITRATE_FACTOR:X}=WI,z=Math.min(t.frameRate,h),ne=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(y,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(b,1)*z),fps_up:i},balanced:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:c},motion:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:c},detail:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:c}}];for(let me=1;me<=m;me++){const Ee={bwe_up:Math.round(Math.pow(v,me)*n),bwe_down:Math.round(Math.pow(y,me+1)*n),fps_up:Math.round(Math.pow(O,me)*z),fps_down:Math.round(Math.pow(b,me+1)*z)},Oe={scaleResolutionDownBy:a/Math.pow(k,me),frameRate:Math.max(Math.round(Math.pow(N,me)*i),d),bitrateMax:Math.max(Math.round(Math.pow(I,me)*n),_),bitrateMin:Math.max(Math.round(Math.pow(I,me)*c),g)},Qe={scaleResolutionDownBy:a/Math.pow(j,me),frameRate:i,bitrateMax:Math.max(Math.round(Math.pow(G,me)*n),_),bitrateMin:Math.max(Math.round(Math.pow(G,me)*c),g)},qe={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(K,me)*i),d),bitrateMax:Math.max(Math.round(Math.pow(X,me)*n),_),bitrateMin:Math.max(Math.round(Math.pow(X,me)*c),g)};ne.push({scale:me,threshold:Ee,balanced:Oe,motion:Qe,detail:qe})}return ne}function Iae(e,t,n,i,a,c){const d=oT.get(e)||{overUse:0,underUse:0,adaptationList:iB(a)},{adaptationList:h}=d;oT.set(e,d);const{OVERUSE_TIMES_THRESHOLD:m,UNDERUSE_TIMES_THRESHOLD:g}=WI,{scale:_}=i;let v,y;return typeof t=="number"&&t>0&&function(b,O,I,N){if(O>=I.length)return!1;let{threshold:{fps_down:k}}=I[O];return D("FORCE_AG_HIGH_FRAMERATE")&&N==="maintain-framerate"&&(k=I[0].threshold.fps_down),b<k}(t,_,h,c)&&(d.overUse++,y=Gp.CPU,d.overUse>m)||typeof n=="number"&&n>0&&function(b,O,I){if(O>=I.length)return!1;const{threshold:{bwe_down:N}}=I[O];return b<N}(n,_,h)&&(d.overUse++,y=Gp.BANDWIDTH,d.overUse>m)?(d.overUse=0,d.underUse=0,v=nB(i,h,c,dm.DOWN),[v,y]):(typeof t=="number"&&t>0&&typeof n=="number"&&n>0&&function(b,O,I,N){if(O===0)return;let{threshold:{fps_up:k}}=I[O];return D("FORCE_AG_HIGH_FRAMERATE")&&N==="maintain-framerate"&&(k=I[1].threshold.fps_up),b>k}(t,_,h,c)&&function(b,O,I){if(O===0)return;const{threshold:{bwe_up:N}}=I[O];return b>N}(n,_,h)&&(d.underUse++,d.underUse>g&&(d.overUse=0,d.underUse=0,v=nB(i,h,c,dm.UP),v.scale===0&&(y=Gp.NONE))),[v,y])}function sB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function QA(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?sB(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sB(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function oB(e){var t;return!!D("ENABLE_AG_ADAPTATION")&&!!(e instanceof xS||ve(t=e._hints).call(t,Bt.CUSTOM_TRACK))&&(!!D("FORCE_SUPPORT_AG_ADAPTATION")||!!(qj(14,0,!1)&&Yj(17,4,!0)||Kj(14)&&bI(17,4,!0)))}const aT=new Map;function aB(e,t,n,i,a,c){if(um(e,n),a(t),i!=="balanced"&&i!=="maintain-framerate"&&i!=="maintain-resolution")return;let d=-1;rB(e,t);const h=window.setInterval(()=>{const g=aT.get(e);if(!D("ENABLE_AG_ADAPTATION")||!g)return um(e,n),void a(t);const _=c();if(_.sendPackets>0&&_.OutgoingAvailableBandwidth>0){if(d===-1)return void(d=Date.now());if(Date.now()-d<1e3)return;const v=_.sendFrameRate,y=_.OutgoingAvailableBandwidth,[b,O]=Iae(e,v,y,g.adaptationConfig,t,i);O&&(n.qualityLimitationReason=O),b&&g.adaptationConfig.scale!==b.scale&&(R.debug("[".concat(e,"] applyAdaptation: ").concat(n.qualityLimitationReason,`
           sendFps `).concat(v,", bwe ").concat(y,", switch from ").concat(g.adaptationConfig.scale," to ").concat(b.scale," ")),g.adaptationConfig=QA(QA({},g.adaptationConfig),b),a(b))}},D("CHECK_LOCAL_STATS_INTERVAL")),m=QA({},t);aT.set(e,{timer:h,adaptationConfig:m,originConfig:t,adaptationFunc:a}),R.debug("[".concat(e,"] start adaptation, originConfig: ").concat(JSON.stringify(t),", degradationPreference: ").concat(i))}function um(e,t){const n=aT.get(e);if(n){const{timer:i}=n;window.clearTimeout(i),aT.delete(e)}t.qualityLimitationReason=Gp.NONE,rB(e)}function Aae(e,t){var n;let i;switch(t){case ye.LocalAudioTrack:i=Ht.Audio;break;case ye.LocalVideoTrack:i=ve(n=e._hints).call(n,Bt.SCREEN_TRACK)?Ht.Screen:Ht.High;break;case ye.LocalVideoLowTrack:i=Ht.Low}return i}function $A(e){const t=vt();if(e.some(n=>n._bypassWebAudio))throw new de(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new de(L.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function ZA(e,t){$A(e);const n=new sr;return e.forEach(i=>n.addAudioTrack(i)),n}const Nae=!vt().supportUnifiedPlan||D("CHROME_FORCE_PLAN_B")&&nc();function t_(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.useDcSignal)return n={spec:t,store:e},Ea("DataChannelConnection").create(n);var n;return Nae?function(a){return Ea("PlanBConnection").create(a)}({spec:t,store:e}):new Ws(t,e)}function eN(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function tN(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(Pu(e.turnServer.servers))return!1;if(D("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var At;function cB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function ya(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?cB(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cB(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let Ws=(At=class gh extends HS{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return ve(n=Object.keys(Vu)).call(n,t)}))]}constructor(t,n){super(t,n),x(this,"id",Wt(5,"connection-")),x(this,"store",void 0),x(this,"peerConnection",void 0),x(this,"forceTurn",!1),x(this,"remoteSDP",void 0),x(this,"initialOffer",void 0),x(this,"transportEventReceiver",void 0),x(this,"statsFilter",void 0),x(this,"extension",{useXR:D("USE_XR")}),x(this,"localCapabilities",void 0),x(this,"remoteCodecs",void 0),x(this,"localCandidateCount",0),x(this,"allCandidatesReceived",!1),x(this,"isPreallocation",!1),x(this,"isPreRender",!1),x(this,"preMediaMap",new Map),x(this,"dataStreamChannelMap",new Map),x(this,"establishPromise",void 0),x(this,"recoveredDataChannelIds",[]),x(this,"currentDataChannelId",1),x(this,"supportAV1RtpSpec",!1),x(this,"mutex",void 0),x(this,"qualityLimitationReason",Gp.NONE),x(this,"isFirstConnected",!1),this.store=n,this.forceTurn=tN(t),this.mutex=new Cr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(gh.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=vS(this.peerConnection,D("STATS_UPDATE_INTERVAL"),void 0,pn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void R.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const i=await this.peerConnection.createOffer(),a=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);const c=this.remoteSDP.toString();a==null||a(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}else R.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=cc(n.sdp),a=await UA({filterRTX:!D("USE_PUB_RTX")&&!D("USE_SUB_RTX"),filterVideoFec:D("FILTER_VIDEO_FEC"),filterAudioFec:D("FILTER_AUDIO_FEC"),filterVideoCodec:D("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:D("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:D("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=Jg(a),this.initialOffer=n,D("ENABLE_SVC")&&this.store.codec=="av1"){const d=await N3();var t;d&&(this.supportAV1RtpSpec=!0,(t=a.send)===null||t===void 0||t.videoExtensions.push(d))}let c;return n.sdp&&$S(n.sdp)&&(c=mn(a),S3(c)),ya(ya({},i),{},{rtpCapabilities:c||a,offerSDP:n.sdp})}catch(n){throw new de(L.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&$S(this.initialOffer.sdp)&&T3(t.rtpCapabilities,this.localCapabilities),this.remoteSDP=new eB(ya(ya({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!D("ENABLE_PRE_SUB_WITH_PRE_PC")||!D("PRE_USE_LOCAL_CODECS"))&&Bg(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const n=this.remoteSDP.toString(),i=jA(this.initialOffer.sdp,this.extension),a=this.logSDPExchange(i||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),a==null||a(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n});const c=this.peerConnection.getTransceivers()[0];if(c!=null&&c.receiver&&this.tryBindTransportEvents(c.receiver),Bg(this.store))if(t.preallocation&&D("ENABLE_PRE_SUB_WITH_PRE_PC")){const d=D("PRE_SUB_NUM"),{mids:h,preSSRCs:m}=this.remoteSDP.preloadRemoteMedia(d);await es(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(m)),this.presetMedia(h,m)}else{const{preSSRCs:d=[]}=t,h=d.map(g=>g.ssrcMsg[0].ssrcId);if(d.length===0)return;const{mids:m}=this.remoteSDP.batchSend(d.map(g=>Object.assign({},g)));await es(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(h)),this.presetMedia(m,h)}}catch(n){throw new de(L.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}presetMedia(t,n){t.forEach((i,a)=>{this.peerConnection.getTransceivers().forEach(c=>{if(c.mid!=null&&i===c.mid&&c.receiver.track){const d=c.receiver.track;let h;d.kind==="video"&&D("ENABLE_PRE_RENDER")&&(h=new NS({trackId:"track-".concat(d.kind,"-unknown-").concat(this.store.clientId,"_").concat(Wt(5,""))},!0),h.updateVideoTrack(d),h.onFirstVideoFrameRender=()=>{var m;const g=this.preMediaMap.get(n[a]);g&&(g.firstVideoRender=Date.now()),(m=this.onFirstVideoRender)===null||m===void 0||m.call(this,n[a])},h.onVideoBufferReady=()=>{var m;(m=this.onFirstVideoBufferReady)===null||m===void 0||m.call(this,n[a])},h.play(this.store.sessionId||void 0),this.isPreRender=!0),this.preMediaMap.set(n[a],{mid:i,track:d,player:h,transceiver:c})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let n=!1;const{rtpCapabilities:i}=t;if([,n]=this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const d=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);n=n||d}const{preSSRCs:a=[]}=t,c=a.map(d=>d.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(c)){const d=[],h=[];if(Array.from(this.preMediaMap.entries()).every(m=>{let[g,{mid:_,player:v,track:y}]=m;return d.push(_),h.push(g),this.preMediaMap.delete(g),v&&v.destroy(),!0}),d.length>0&&(this.remoteSDP.stopSending(d),await es(this.peerConnection,this.remoteSDP,this.extension),R.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(h)),Le.reportApiInvoke(this.store.sessionId,{name:_n.PRELOAD_MEDIA_FAILED,options:[a,h],tag:rn.TRACER}).onSuccess()),a.length>0){const{mids:m}=this.remoteSDP.batchSend(a.map(g=>Object.assign({},g)));await es(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(c)),this.presetMedia(m,c)}}n?(await es(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):R.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(n){throw new de(L.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(t,n,i){var a=this;return Li(function*(){const c=yield ht(a.mutex.lock("From P2PConnection.send"));try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=[],h=qg();t.forEach(N=>{const k=a.peerConnection.addTransceiver(N._mediaStreamTrack,ya({direction:"sendonly"},N.trackMediaType==="video"&&a.supportAV1RtpSpec&&h?{sendEncodings:[{scalabilityMode:h}]}:{}));d.push(k),N._updateRtpTransceiver(k)}),pn()&&D("SIMULCAST")===!0&&(yield ht(a.applySimulcastForFirefox(d,t)));const m=yield ht(a.peerConnection.createOffer()),g=a.remoteSDP.predictReceivingMids(t.length),_=a.mungSendOfferSDP(m.sdp,t,g),v=Ci(_),y=g.map(N=>{const k=v.mediaDescriptions.find(j=>j.attributes.mid===N);if(!k)throw new Error("Cannot extract ssrc from mediaDescription.");return DA(k,D("USE_PUB_RTX"))});let b;try{b=yield y}catch(N){b=[],a.remoteSDP.receive(t,n,i,b);const k=a.remoteSDP.toString();throw yield ht(a.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield ht(a.peerConnection.setRemoteDescription({type:"answer",sdp:k})),yield ht(a.stopSending(g,!0)),N}a.remoteSDP.receive(t,n,i,b);const O=a.remoteSDP.toString(),I=a.logSDPExchange(_,"offer","local","send");return yield ht(a.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield ht(a.applySimulcastEncodings(d,t)),yield ht(a.applySendEncodings(d,t)),I==null||I(O),yield ht(a.peerConnection.setRemoteDescription({type:"answer",sdp:O})),d.map((N,k)=>{const j=g[k];return{localSSRC:y[k],id:j,transceiver:N}})}catch(d){throw d instanceof de?d:new de(L.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{c()}})()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(t);if(i&&i.readyState==="open")R.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const c=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof c!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:c,negotiated:!0,ordered:!1,maxRetransmits:D("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,i)}n.forEach(c=>{c._updateOriginDataChannel(i)});const{needExchangeSDP:a}=this.remoteSDP.sendDataChannel();if(a){const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:c});const d=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(d),R.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else R.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof de?i:new de(L.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof de?n:new de(L.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const a=this.peerConnection.getTransceivers().filter(m=>t.indexOf(m.mid)!==-1);if(a.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");a.map(m=>{var g;um(this.id+m.mid,this),m.direction="inactive",(g=m.stop)===null||g===void 0||g.call(m)});const c=await this.peerConnection.createOffer(),d=this.logSDPExchange(c.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(c),this.remoteSDP.stopReceiving(t);const h=this.remoteSDP.toString();d==null||d(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new de(L.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(a.toString()))}finally{i&&i()}}async receive(t,n,i,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:c,needExchangeSDP:d}=this.remoteSDP.send(t,n,i,a);d&&(await es(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const h=this.peerConnection.getTransceivers().find(m=>m.mid===c);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:c,transceiver:h}}catch(c){throw new de(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(t);return i&&(await es(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(a=>{const c=this.peerConnection.getTransceivers().find(d=>d.mid===a);if(!c)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,id:a,transceiver:c}})}catch(n){throw new de(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(c=>{Array.from(this.preMediaMap.entries()).some(d=>{let[h,{mid:m,player:g}]=d;if(m===c)return this.preMediaMap.delete(h),g&&g.destroy(),!0})}),this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const a=await this.peerConnection.createAnswer();i==null||i(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(n){throw new de(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const a=await this.peerConnection.createAnswer();i==null||i(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(n){throw new de(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const a=await this.peerConnection.createAnswer();i==null||i(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(n){throw new de(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(d=>{d.direction="inactive"});const i=await this.peerConnection.createOffer(),a=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const c=this.remoteSDP.toString();a==null||a(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new de(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(d,h)=>{d.direction="sendonly"});const i=await this.peerConnection.createOffer(),a=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString();a==null||a(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new de(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return Li(function*(){const i=yield ht(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const a=vt().supportPCSetConfiguration,c=D("FORCE_TURN_TCP")||n.forceTurn;if(t===Ir.RELAY&&!a)return;if(a&&!c){const v=t===Ir.RELAY?"relay":"all",y=n.peerConnection.getConfiguration();y.iceTransportPolicy!==v&&(R.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(y.iceTransportPolicy,"] to [").concat(v,"]")),y.iceTransportPolicy=v,n.peerConnection.setConfiguration(y))}n.remoteSDP.updateCandidates(t);const d=yield ht(n.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=cc(d.sdp),{remoteIceParameters:m}=yield h.iceParameters;n.remoteSDP.restartICE(m);const g=n.remoteSDP.toString(),_=n.logSDPExchange(d.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield ht(n.peerConnection.setLocalDescription(d)),_==null||_(g),yield ht(n.peerConnection.setRemoteDescription({type:"answer",sdp:g}))}catch(a){R.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),a)}finally{i()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Ir.TCP_RELAY),await es(this.peerConnection,this.remoteSDP,this.extension)}catch(n){R.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{um(this.id+n.mid,this)}),this.preMediaMap.forEach(n=>{let{player:i}=n;i&&i.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return ya(ya({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),a=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const c=this.remoteSDP.toString(),d=this.logSDPExchange(a,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),d==null||d(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new de(L.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter(a=>a.mid===t);i.length===1&&(this.isVP8Simulcast(n)?pn()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find(a=>a.mid===n);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:i,remote:a}=n.getSelectedCandidatePair();return{local:ya(ya({},Do),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:ya(ya({},Do),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;const i="code: ".concat(t.errorCode,", message: ").concat(t.errorText),a=t.port?"local: ".concat(t.port):"",c=ac(t.url||"");R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(i,"), url: ").concat(c||"",", host_candidate:").concat(a)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,i)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},D("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]},i=t.cloudProxyServer||"disabled";return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(Pu(t.turnServer.servers)?n.iceServers=t.turnServer.servers:D("NEW_TURN_MODE")&&n.iceServers&&i==="disabled"?(D("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...gh.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...gh.newTurnServerConfigToIceServers(t.turnServer.servers)),D("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...gh.turnServerConfigToIceServers(t.turnServer.servers)),D("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...gh.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),D("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(n.iceTransportPolicy="relay")}))),D("ENABLE_ENCODED_TRANSFORM")&&vt().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(jo(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!D("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{const a=D("NEW_TURN_MODE");a===1?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}):a===2?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}):a===3?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(jo(i.turnServerURL),":443?transport=tcp")}):a===4&&(n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(jo(i.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var a;n!=null&&n.state&&((a=this.onDTLSTransportStateChange)===null||a===void 0||a.call(this,n.state))},n.onerror=a=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in a?a.error:a)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const a=n==null?void 0:n.iceTransport.state;var c;a&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,a))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:a,remote:c}=i.getSelectedCandidatePair()||{};if(a&&c){const d=a.address+":"+a.port,h=c.address+":"+c.port;R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(ac(d)),", remote ").concat(JSON.stringify(ac(h))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var i,a;if(n||(n=this.peerConnection.getSenders().find(N=>N.track===t._mediaStreamTrack)),!n)return R.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!vt().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},d={};switch(t._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;case"balanced":c.degradationPreference="balanced"}const h=v3(this.peerConnection,t._mediaStreamTrack),m=cF(t);if(oB(t)&&h&&n&&m&&this.getLocalVideoStats&&ve(i=["vp8","vp9"]).call(i,this.store.codec)){var g;const I=c.degradationPreference||(ve(g=t._hints).call(g,Bt.CUSTOM_TRACK)?D("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");aB(this.id+h.mid,m,this,I,N=>{n&&this.updateAdaptation(n,N)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var _;const{bitrateMax:I,frameRate:N,scaleResolutionDownBy:k}=t._encoderConfig;I&&(d.maxBitrate=1e3*I),(ve(_=t._hints).call(_,Bt.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(N&&(d.maxFramerate=Fi(N)),k&&k>=1&&(d.scaleResolutionDownBy=k))}const{maxFramerate:v}=D("ENCODER_CONFIG_LIMIT");if(v&&typeof v=="number"&&(d.maxFramerate=d.maxFramerate?Math.min(d.maxFramerate,v):v),D("DSCP_TYPE")&&nc()){var y;const I=D("DSCP_TYPE");ve(y=["very-low","low","medium","high"]).call(y,I)&&(d.networkPriority=I)}const b=n.getParameters(),O=(a=b.encodings)===null||a===void 0?void 0:a[0];pn()&&!O&&(c.encodings=[d]),O&&Object.assign(O,d),Object.assign(b,c),R.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(b.encodings))),await n.setParameters(b),await P3(this.store.codec,n,D("SVC_MODE"))}async updateAdaptation(t,n){var i,a;if(!t)return R.debug("[updateAdaptation] no rtpSender found");if(!vt().supportSetRtpSenderParameters)return R.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const c={},{bitrateMax:d,frameRate:h,scaleResolutionDownBy:m}=n;d&&(c.maxBitrate=1e3*d),h&&(c.maxFramerate=Fi(h)),m&&m>=1&&ve(i=["vp8","vp9"]).call(i,this.store.codec)&&(c.scaleResolutionDownBy=m);const g=t.getParameters(),_=(a=g.encodings)===null||a===void 0?void 0:a[0];_&&Object.assign(_,c),Object.assign(g,{});try{await t.setParameters(g),R.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(g.encodings)))}catch(v){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?R.debug("[updateAdaptation] peerConnection not connected}"):R.debug("[updateAdaptation] updateRtpSenderEncodings failed",v):R.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!vt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const a=t[i],c=n[i];c instanceof sn&&!this.isVP8Simulcast(c)&&await this.updateRtpSenderEncodings(c,a.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,i){if(D("FORBID_MODIFY_LOCAL_OFFER_SDP"))return t;const a=Ci(t);return n.forEach((c,d)=>{const h=i[d],m=a.mediaDescriptions.find(g=>g.attributes.mid===h);m&&(Ju(m,c),MA(m,c,this.store.codec))}),Kc(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var a;(a=this.onFirstVideoDecoded)===null||a===void 0||a.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let m=0;m<t.length;m++){var i,a,c,d,h;const g=t[m],_=n[m];if(_ instanceof sn&&!ve(i=_._hints).call(i,Bt.LOW_STREAM)&&(a=_._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=_._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=_._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=_._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1&&this.store.codec==="vp8"){const v={},y={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};v.encodings=[{rid:"m",active:!0,maxBitrate:y.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:y.high}];const b=g.sender.getParameters();await g.sender.setParameters(Object.assign(b,v))}}}async applySimulcastEncodings(t,n){if(!pn()&&t.length===n.length)for(let i=0;i<t.length;i++){const a=n[i];if(a instanceof sn&&this.isVP8Simulcast(a)){const c=t[i],d={},h={high:1e3*(a._encoderConfig.bitrateMax-50),medium:5e4};d.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:h.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:h.medium,scaleResolutionDownBy:4}];const m=c.sender.getParameters();await c.sender.setParameters(Object.assign(m,d))}}}isVP8Simulcast(t){var n,i,a,c,d;return!!(t instanceof sn&&D("SIMULCAST")&&this.store.codec==="vp8"&&!ve(n=t._hints).call(n,Bt.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((a=t._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(c=t._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((d=t._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1)}logSDPExchange(t,n,i,a){if(D("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(a,`
`),t),n==="offer"?c=>{this.logSDPExchange(c,"answer",i==="local"?"remote":"local",a)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(t){if(vt().supportPCSetConfiguration){const n=gh.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}t.isPreallocation&&(this.isPreallocation=!0)}},Ie(At.prototype,"updateRemoteRTPCapabilities",[Bi],Object.getOwnPropertyDescriptor(At.prototype,"updateRemoteRTPCapabilities"),At.prototype),Ie(At.prototype,"connect",[Bi],Object.getOwnPropertyDescriptor(At.prototype,"connect"),At.prototype),Ie(At.prototype,"updateRemoteConnect",[Bi],Object.getOwnPropertyDescriptor(At.prototype,"updateRemoteConnect"),At.prototype),Ie(At.prototype,"createDataChannels",[Bi],Object.getOwnPropertyDescriptor(At.prototype,"createDataChannels"),At.prototype),Ie(At.prototype,"receive",[Bi],Object.getOwnPropertyDescriptor(At.prototype,"receive"),At.prototype),Ie(At.prototype,"batchReceive",[Bi],Object.getOwnPropertyDescriptor(At.prototype,"batchReceive"),At.prototype),Ie(At.prototype,"stopReceiving",[Bi],Object.getOwnPropertyDescriptor(At.prototype,"stopReceiving"),At.prototype),Ie(At.prototype,"muteRemote",[Bi],Object.getOwnPropertyDescriptor(At.prototype,"muteRemote"),At.prototype),Ie(At.prototype,"unmuteRemote",[Bi],Object.getOwnPropertyDescriptor(At.prototype,"unmuteRemote"),At.prototype),Ie(At.prototype,"muteLocal",[Bi],Object.getOwnPropertyDescriptor(At.prototype,"muteLocal"),At.prototype),Ie(At.prototype,"unmuteLocal",[Bi],Object.getOwnPropertyDescriptor(At.prototype,"unmuteLocal"),At.prototype),Ie(At.prototype,"close",[Bi],Object.getOwnPropertyDescriptor(At.prototype,"close"),At.prototype),Ie(At.prototype,"updateEncoderConfig",[Bi],Object.getOwnPropertyDescriptor(At.prototype,"updateEncoderConfig"),At.prototype),Ie(At.prototype,"updateSendParameters",[Bi],Object.getOwnPropertyDescriptor(At.prototype,"updateSendParameters"),At.prototype),Ie(At.prototype,"replaceTrack",[Bi],Object.getOwnPropertyDescriptor(At.prototype,"replaceTrack"),At.prototype),Ie(At.prototype,"updateAdaptation",[Bi],Object.getOwnPropertyDescriptor(At.prototype,"updateAdaptation"),At.prototype),Ie(At.prototype,"getRemoteSSRC",[Bi],Object.getOwnPropertyDescriptor(At.prototype,"getRemoteSSRC"),At.prototype),At);function Bi(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const a=this.mutex,c=await a.lock("From P2PConnection.".concat(t));try{for(var d=arguments.length,h=new Array(d),m=0;m<d;m++)h[m]=arguments[m];return await i.apply(this,h)}finally{c()}},n}function nN(e,t){let n=document.createElement("video"),i=document.createElement("canvas");n.setAttribute("style","display:none"),i.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),i.width=Fi(t.width),i.height=Fi(t.height);const a=Fi(t.framerate||15);document.body.append(n),document.body.append(i);let c=e._mediaStreamTrack;n.srcObject=new MediaStream([c]),n.play().catch(Ug);const d=i.getContext("2d");if(!d)throw new se(L.UNEXPECTED_ERROR,"can not get canvas context");const h=vt(),m=i.captureStream(h.supportRequestFrame?0:a).getVideoTracks()[0];m.canvas||(m.canvas=i),i.startCapture=()=>{if(!n)return i.stopCapture&&i.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const _=n.videoWidth,v=n.videoHeight/_,y=i.width*v;Math.abs(y-i.height)>=2&&(R.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(y)),i.height=y)}d.drawImage(n,0,0,i.width,i.height),m.requestFrame&&m.requestFrame(),c!==e._mediaStreamTrack&&(c=e._mediaStreamTrack,n.srcObject=new MediaStream([c]))},i.stopCapture=nA(()=>i.startCapture&&i.startCapture(),a);const g=m.stop;return m.stop=()=>{g.call(m),n&&(n.remove(),n.srcObject=null,n=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),R.debug("clean low stream renderer")},m}var lB=function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e}(lB||{}),Sa=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e}(Sa||{}),st=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(st||{}),gr=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e[e.Audio_Recv_AV_Sync_TIME=2237]="Audio_Recv_AV_Sync_TIME",e}(gr||{}),Ur=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(Ur||{}),hm=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e[e.PAGE_VISIBILITY=2233]="PAGE_VISIBILITY",e}(hm||{}),rN=function(e){return e[e.Transport_Send_Bitrate=2234]="Transport_Send_Bitrate",e[e.Transport_Recv_Bitrate=2235]="Transport_Recv_Bitrate",e}(rN||{});const $u=1e3,cT=6,n_=3,xae=Math.max(cT,n_,60);function Ke(e,t,n){n!=null&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function dB(e){const t={[Ur.CONN_TYPE]:0,[Ur.RTT]:e.rtt,[Ur.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(t[Ur.CONN_TYPE]=1),n==="tcp"&&(t[Ur.CONN_TYPE]=3),n==="tls"&&(t[Ur.CONN_TYPE]=4);break}case"srflx":t[Ur.CONN_TYPE]=2;break;case"unknown":t[Ur.CONN_TYPE]=5;break;default:t[Ur.CONN_TYPE]=0}return t}function uB(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class hB extends Sn{constructor(t){super(),x(this,"store",void 0),x(this,"uploadWRTCStatsTimer",void 0),x(this,"uploadOutboundDenoiserStatsTimer",void 0),x(this,"uploadExtStatsTimer",void 0),x(this,"uploadExtUsageStatsTimer",void 0),x(this,"uploadInboundExtStatsTimer",void 0),x(this,"requestStats",void 0),x(this,"requestTransportStats",void 0),x(this,"requestLocalMedia",void 0),x(this,"requestRemoteMedia",void 0),x(this,"requestAllTracks",void 0),x(this,"requestVideoIsReady",void 0),x(this,"requestUploadStats",void 0),x(this,"requestUpload",void 0),x(this,"uploadOutboundStarted",!1),x(this,"uploadInboundStarted",!1),x(this,"uploadTransportStarted",!1),x(this,"uploadBaseStatsStarted",!1),x(this,"uploadExtensionUsageStarted",!1),x(this,"lastRecvStats",void 0),x(this,"lastSendStats",void 0),x(this,"lastRefRecvStats",void 0),x(this,"lastRefSendStats",void 0),x(this,"lastNormalRecvStats",void 0),x(this,"lastNormalSendStats",void 0),x(this,"lastExtendStats",{}),x(this,"needUploadStats",{}),x(this,"needUploadRenderFreezeTime",!0),x(this,"lastUploadCompensateTime",-1),x(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const n=t%n_==0,i=t%cT==0,a=t%60==0;let c,d;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(d=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!d&&this.uploadInboundStarted&&(d=this.requestStats(!0)),c||d){var h;const m={};if(this.uploadTransportStarted&&c){const _=this.getTransportStats(c,n?this.lastRefSendStats:void 0,d,n);_&&(m.misc=[_])}if(this.uploadOutboundStarted&&c){const _=this.getOutboundStats(c,i?this.lastNormalSendStats:void 0,n?this.lastRefSendStats:void 0,this.lastSendStats,a);_&&(m.outbound=[_])}if(this.uploadInboundStarted&&d){this.uploadCompensateStats(t);const _=this.getInboundStats(d,i?this.lastNormalRecvStats:void 0,n?this.lastRefRecvStats:void 0,this.lastRecvStats);_&&(m.inbound=_)}const g=(h=this.requestTransportStats)===null||h===void 0?void 0:h.call(this).connectState;if(g&&(Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[hm.RTC_PEER_CONNECTION_STATE]=FI[g]):m.misc=[{addition:{[hm.RTC_PEER_CONNECTION_STATE]:FI[g]}}]),Ts.needUploadStats.length>0||i){const _=Ts.needUploadStats.shift()||(Ts.visibility==="visible"?1:0);Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[hm.PAGE_VISIBILITY]=_):m.misc=[{addition:{[hm.PAGE_VISIBILITY]:_}}]}this.needUploadStats.sendType&&(Array.isArray(m.outbound)&&m.outbound[0]&&m.outbound[0].high&&(m.outbound[0].high[lB.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(m)}this.lastRecvStats=d,this.lastSendStats=c,i&&(this.lastNormalRecvStats=d,this.lastNormalSendStats=c),n&&(this.lastRefRecvStats=d,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0,Ts.startCollectStats();let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,i;const a=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(a&&((i=this.requestUploadStats)===null||i===void 0||i.call(this,{misc:[{addition:{[hm.RTC_PEER_CONNECTION_STATE]:FI[a.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===xae+1&&(t=1)},$u)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const n=t%n_==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!n)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const i=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=i,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const a=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*a;const c=this.requestStats(!0);new Array(a).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const d={};if(this.uploadInboundStarted&&c){const h=this.requestRemoteMedia()||[],m=[];h.forEach(g=>{let[_,v]=g;const y={peer:_.uid};if(_._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(_._videoSSRC)&&v.has(De.VIDEO)&&_.videoTrack){const b=function(O,I,N){if(!I.videoRecv.find(j=>j.ssrc===O))return;const k={};if(N&&N._player){const j=N._player,{renderFreezeAccTime2:G,videoElementStatus:K}=j;if(Ts.visibility==="visible"&&K===Yr.PLAYING&&vt().supportRequestVideoFrameCallback){const X=Math.min(6e3,G);j.renderFreezeAccTime2=Math.max(0,G-X),Ke(k,Sa.Video_Render_Freeze_Time_Render2,X),D("USE_NEW_RENDER_FREEZE_TIME")&&Ke(k,Sa.Video_Render_Freeze_Time_Render,X)}}return k}(_._videoSSRC,c,_.videoTrack);b&&(y.video=b)}y.video&&m.push(y)}),m.length>0&&(d.inbound=m,this.requestUploadStats(d))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,n,i,a){if(!this.requestStats)return;if(!a)return t.rtt==null?void 0:{addition:{[Ur.RTT]:t.rtt,[Ur.CONN_TYPE]:void 0,[Ur.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const c=dB(t);if(this.store.useP2P){if(i){const d=dB(i);c[Ur.CONN_TYPE]&&d[Ur.CONN_TYPE]&&(c[Ur.CONN_TYPE]+=d[Ur.CONN_TYPE]<<3)}c[Ur.CONN_TYPE]?c[Ur.CONN_TYPE]+=110:c[Ur.CONN_TYPE]=110}else{c[Ur.CONN_TYPE]?c[Ur.CONN_TYPE]+=100:c[Ur.CONN_TYPE]=100;const d=function(h,m){return m?[Math.ceil(8*(h.transport.bytesSent-m.transport.bytesSent)/(h.timestamp-m.timestamp)),Math.ceil(8*(h.transport.bytesReceived-m.transport.bytesReceived)/(h.timestamp-m.timestamp))]:[0,0]}(t,n);c[rN.Transport_Send_Bitrate]=d[0],c[rN.Transport_Recv_Bitrate]=d[1]}return{addition:c}}getOutboundStats(t,n,i,a,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const d=this.requestLocalMedia();if(!d||d.length===0)return;let h,m,g;return d.forEach(_=>{let[v,{track:y,ssrcs:b}]=_;switch(v){case ye.LocalVideoLowTrack:case ye.LocalVideoTrack:if(v===ye.LocalVideoTrack){var O;const I=function(G,K,X,z,ne,me){const Ee=K.videoSend.find(dt=>dt.ssrc===G);if(!Ee)return;const Oe={},{sentFrame:Qe,inputFrame:qe}=Ee;if(z&&(Ke(Oe,Sa.Video_Send_Qp_Sum,Ee.qpSumPerFrame),qe&&Qe)){const dt=qe.frameRate,at=Qe.frameRate;Oe[Sa.Video_Send_Freeze]=function(Ut,vn){let ge=!0;return ge=!(Ut<=5)&&(Ut<=10?vn<3:Ut<=20?vn<4:vn<5),ge}(dt,at)?1:0}if(ne){switch(Qe&&(Ke(Oe,st.Video_Send_Height,Qe.height),Ke(Oe,st.Video_Send_Width,Qe.width),Ke(Oe,st.Video_Send_Frame_Rate,Qe.frameRate)),Oe[st.Video_Send_Disabled]=X._originMediaStreamTrack&&!X._originMediaStreamTrack.enabled||X._mediaStreamTrack&&!X._mediaStreamTrack.enabled?1:0,Ee.adaptionChangeReason){case"none":Oe[st.Video_Send_Adaptation]=0;break;case"cpu":Oe[st.Video_Send_Adaptation]=1;break;case"bandwidth":Oe[st.Video_Send_Adaptation]=2;break;case"other":Oe[st.Video_Send_Adaptation]=3}let dt=0;Ee.adaptionChangeReason&&(dt+=uB(Ee.adaptionChangeReason)),K.qualityLimitationReason&&(dt+=uB(K.qualityLimitationReason)<<3),Oe[st.Video_Send_Adaptation]=dt,Oe[st.Video_Send_Player_Status]=ZI[X._player?X._player.videoElementStatus:"uninit"],Ke(Oe,st.Video_Send_Nacks,Ee.nacksCount),Ke(Oe,st.Video_Send_Plis,Ee.plisCount),Ke(Oe,st.Video_Send_Firs,Ee.firsCount),Ke(Oe,st.Video_Send_Avg_Encode,Ee.avgEncodeMs),Ke(Oe,st.Video_Send_Huge_Frame_Sent,Ee.hugeFramesSent),Ke(Oe,st.Video_Send_Bytes_Retransmit,Ee.retransmittedBytesSent),Ke(Oe,st.Video_Send_Packages_Retransmit,Ee.retransmittedPacketsSent),Ke(Oe,st.Video_Send_Key_Frames_Encoded,Ee.keyFramesEncoded);const at=ne.videoSend.find(Ut=>Ut.ssrc===G);if(at){let Ut=$u*n_;at.timestamp&&Ee.timestamp&&(Ut=Ee.timestamp-at.timestamp),at.packets!=null&&Ee.packets!=null&&Ke(Oe,st.Video_Send_Package_Rate,1e3*(Ee.packets-at.packets)/Ut),Ee.packetsLost!=null&&at.packetsLost!=null&&Ke(Oe,st.Video_Send_Package_Lost,Ee.packetsLost-at.packetsLost),at.bytes!=null&&Ee.bytes!=null&&Ke(Oe,st.Video_Send_Bitrate,8*(Ee.bytes-at.bytes)/Ut)}}return Oe}(b[0].ssrcId,t,y,n,i),N=y.__className__==="CameraVideoTrack"?3:ve(O=y._hints).call(O,Bt.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==N||c)&&(this.needUploadStats={sendType:N},this.lastExtendStats.sendType=N);const k=y&&function(G,K,X,z){const ne=K.videoSend.find(Ee=>Ee.ssrc===G);if(!ne)return null;const me={};if(z){const Ee=ne.inputFrame,Oe=Ee&&Ee.height||X.videoHeight||0,Qe=Ee&&Ee.width||X.videoWidth||0,qe=Ee&&Ee.frameRate||0;Ke(me,st.Video_Capture_Height,Oe),Ke(me,st.Video_Capture_Width,Qe),Ke(me,st.Video_Capture_Frame_Rate,qe)}return me}(b[0].ssrcId,t,y,!!i),j=function(G,K){const X={};return K&&(Ke(X,st.Video_Send_Retransmit,G.bitrate.retransmit),Ke(X,st.Video_Send_Target_Encoded,G.bitrate.targetEncoded),Ke(X,st.Video_Send_Actual_Encoded,G.bitrate.actualEncoded),Ke(X,st.Video_Send_Transmit,G.bitrate.transmit),Ke(X,st.Video_Send_Bandwidth,G.sendBandwidth)),X}(t,!!i);m=Object.assign({},I,k,j)}else g=function(I,N,k,j,G){const K=N.videoSend.find(z=>z.ssrc===I);if(!K)return;const X={};if(j){const z=K.sentFrame;z&&(Ke(X,st.Video_Send_Low_Height,z.height),Ke(X,st.Video_Send_Low_Width,z.width),Ke(X,st.Video_Send_Low_Frame_Rate,z.frameRate));const ne=j.videoSend.find(me=>me.ssrc===I);if(ne){let me=$u*cT;ne.timestamp&&K.timestamp&&(me=K.timestamp-ne.timestamp),ne.packets!=null&&K.packets!=null&&Ke(X,st.Video_Send_Low_Package_Rate,1e3*(K.packets-ne.packets)/me),K.packetsLost!=null&&ne.packetsLost!=null&&Ke(X,st.Video_Send_Low_Package_Lost,K.packetsLost-ne.packetsLost),ne.bytes!=null&&K.bytes!=null&&Ke(X,st.Video_Send_Low_Bitrate,8*(K.bytes-ne.bytes)/me)}}return X}(b[0].ssrcId,t,0,i);break;case ye.LocalAudioTrack:h=y&&function(I,N,k,j,G,K){const X=N.audioSend.find(ne=>ne.ssrc===I);if(!X)return;const z={};if(G){z[st.Audio_Send_Disabled]=k._originMediaStreamTrack&&!k._originMediaStreamTrack.enabled||k._mediaStreamTrack&&!k._mediaStreamTrack.enabled?1:0;const ne=100*k._source.getAccurateVolumeLevel(),me=X.inputLevel;if(me!=null){const Oe=Math.ceil(50*Math.log10(100*me+1));Ke(z,st.Audio_Send_Level,Oe)}Ke(z,st.Audio_Capture_PCM_Level,ne),Ke(z,st.Audio_Send_AEC_Return_Loss,X.aecReturnLoss),Ke(z,st.Audio_Send_AEC_Return_Loss_Enhancement,X.aecReturnLossEnhancement),Ke(z,st.Audio_Send_Bytes_Retransmit,X.retransmittedBytesSent),Ke(z,st.Audio_Send_Packages_Retransmit,X.retransmittedPacketsSent),z[st.Audio_Send_Freeze]=0;const Ee=G.audioSend.find(Oe=>Oe.ssrc===I);if(Ee){let Oe=$u*cT;Ee.timestamp&&X.timestamp&&(Oe=X.timestamp-Ee.timestamp),Ee.bytes!=null&&X.bytes!=null&&Ke(z,st.Audio_Send_Bitrate,8*(X.bytes-Ee.bytes)/Oe),Ee.packets!=null&&X.packets!=null&&Ke(z,st.Audio_Send_Package_Rate,1e3*(X.packets-Ee.packets)/Oe)}}return z}(b[0].ssrcId,t,y,0,i)}}),{high:m,low:g,audio:h}}getInboundStats(t,n,i,a){if(!this.requestRemoteMedia)return;const c=this.requestRemoteMedia()||[],d=[];return c.forEach(h=>{let[m,g]=h;const _={peer:m.uid};let v;if(g.has(De.VIDEO)&&m.videoTrack){const y=m._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(m._videoSSRC)||!1,b=m.videoTrack?function(O,I,N,k,j,G,K,X){const z=I.videoRecv.find(at=>at.ssrc===O);if(!z)return;const ne={},{receivedFrame:me,outputFrame:Ee,decodeFrameRate:Oe}=z;Ke(ne,gr.Video_Render_Frame_Rate_Decode,Oe),z.framesRateFirefox&&Ke(ne,gr.Video_Recv_Frame_Rate,z.framesRateFirefox),me&&Ke(ne,gr.Video_Recv_Frame_Rate,me.frameRate),Ke(ne,gr.Video_Recv_Frame_Dropped,z.framesDroppedCount),Ke(ne,gr.Video_Recv_Bytes_Retransmit,z.retransmittedBytesReceived),Ke(ne,gr.Video_Recv_Packages_Retransmit,z.retransmittedPacketsReceived),Ke(ne,gr.Video_Recv_Packages_Discarded,z.packetsDiscarded),Ke(ne,gr.Video_Recv_Avg_Decode,z.avgDecodeMs),Ke(ne,gr.Video_Recv_Avg_Processing_Delay,z.avgProcessingDelayMs),Ke(ne,gr.Video_Recv_Avg_Assembly_Time,z.avgFramesAssembledFromMultiplePacketsMs),Ke(ne,gr.Video_Recv_Avg_Inter_Frame_Delay,z.avgInterFrameDelayMs),Ke(ne,gr.Video_Recv_Key_Frames_Decoded,z.keyFramesDecoded);const Qe=X&&X.videoRecv.find(at=>at.ssrc===O);if(Qe){const at=I.timestamp-X.timestamp||$u;z.packetsLost!=null&&Qe.packetsLost!=null&&Ke(ne,gr.Video_Recv_Package_Lost,z.packetsLost-Qe.packetsLost),Qe.bytes!=null&&z.bytes!=null&&Ke(ne,gr.Video_Recv_Bitrate,8*(z.bytes-Qe.bytes)/at),Qe.packets!=null&&z.packets!=null&&Ke(ne,gr.Video_Recv_Package_Rate,1e3*(z.packets-Qe.packets)/at)}const qe=G&&G.videoRecv.find(at=>at.ssrc===O);if(qe&&(Ke(ne,Sa.Video_Recv_Qp_Sum,z.qpSumPerFrame),ne[Sa.Video_Recv_Freeze]=k&&e_.isRemoteVideoFreeze(N,z,qe)?1:0),K){var dt;const at=K.videoRecv.find(vn=>vn.ssrc===O);me?(Ke(ne,st.Video_Recv_Height,me.height),Ke(ne,st.Video_Recv_Width,me.width)):N&&(Ke(ne,st.Video_Recv_Height,N._videoHeight||0),Ke(ne,st.Video_Recv_Width,N._videoWidth||0)),Ee&&Ke(ne,st.Video_Recv_Frame_Rate_Output,Ee.frameRate);const Ut=(dt=N._player)===null||dt===void 0?void 0:dt.rendFrameRate.toFixed(0);if(Ut&&Ke(ne,st.Video_Render_Frame_Rate_Render,+Ut),Ke(ne,st.Video_Recv_Jitter_Buffer,z.jitterBufferMs),Ke(ne,st.Video_Recv_Current_Delay,z.currentDelayMs),Ke(ne,st.Video_Recv_Firs,z.firsCount),Ke(ne,st.Video_Recv_Nacks,z.nacksCount),Ke(ne,st.Video_Recv_Plis,z.plisCount),N){ne[st.Video_Recv_Disabled]=N._originMediaStreamTrack.enabled&&N._mediaStreamTrack.enabled?0:1;const vn=N._player;if(vn){const{freezeTimeCounterList:ge,renderFreezeAccTime:Re,renderFreezeAccTime2:ke,videoElementStatus:_e}=vn;if(ge&&ge.length>0&&Ke(ne,Sa.Video_Render_Freeze_Time,ge.splice(0,1)[0]),j&&Ts.visibility==="visible"&&_e===Yr.PLAYING&&vt().supportRequestVideoFrameCallback){const C=Math.min(6e3,ke);vn.renderFreezeAccTime2=Math.max(0,ke-C),Ke(ne,Sa.Video_Render_Freeze_Time_Render2,C);const B=Math.min(6e3,Re);vn.renderFreezeAccTime=Math.max(0,Re-B),Ke(ne,Sa.Video_Render_Freeze_Time_Render,D("USE_NEW_RENDER_FREEZE_TIME")?C:B)}if(typeof z.totalFreezesDuration=="number"){const C=at&&at.totalFreezesDuration?z.totalFreezesDuration-at.totalFreezesDuration:z.totalFreezesDuration;Ke(ne,st.Video_Render_Freeze_Duration,1e3*C)}}}if(ne[st.Video_Recv_Player_Status]=ZI[N._player?N._player.videoElementStatus:"uninit"],at&&z.totalInterFrameDelay!==void 0&&z.totalSquaredInterFrameDelay!==void 0&&at.totalInterFrameDelay!==void 0&&at.totalSquaredInterFrameDelay!==void 0){const vn=z.totalInterFrameDelay-at.totalInterFrameDelay,ge=z.totalSquaredInterFrameDelay-at.totalSquaredInterFrameDelay,Re=z.framesDecodeCount-at.framesDecodeCount,ke=vn/Re*1e3,_e=Math.round(1e3*Math.sqrt((ge-Math.pow(vn,2)/Re)/Re));!isNaN(_e)&&ke+_e>Math.max(3*ke,ke+150)&&(ne[st.Video_Recv_I_Frame_Delay]=_e)}}return ne}(m._videoSSRC,t,m.videoTrack,y===!0,this.needUploadRenderFreezeTime,n,i,a):void 0;if(b&&(_.video=b),m.videoTrack){const O=t.videoRecv.find(I=>I.ssrc===m._videoSSRC);O&&O.estimatedPlayoutTimestamp&&(v=O.estimatedPlayoutTimestamp)}}if(g.has(De.AUDIO)&&m.audioTrack){const y=m.audioTrack?function(b,O,I,N,k,j){const G=O.audioRecv.find(ne=>ne.ssrc===b);if(!G)return;const K={};Ke(K,gr.Audio_Recv_Jitter,G.jitterMs),Ke(K,gr.Audio_Recv_Bytes_Retransmit,G.retransmittedBytesReceived),Ke(K,gr.Audio_Recv_Packages_Retransmit,G.retransmittedPacketsReceived),Ke(K,gr.Audio_Recv_Packages_Discarded,G.packetsDiscarded),Ke(K,gr.Audio_Recv_Avg_Processing_Delay,G.avgProcessingDelayMs);const X=j&&j.audioRecv.find(ne=>ne.ssrc===b);if(X){const ne=$u;G.packets!=null&&X.packets!=null&&Ke(K,gr.Audio_Recv_Package_Rate,1e3*(G.packets-X.packets)/ne),G.packetsLost!=null&&X.packetsLost!=null&&Ke(K,gr.Audio_Recv_Package_Lost,G.packetsLost-X.packetsLost)}if(N){const{receivedFrames:ne,droppedFrames:me}=G;ne!=null&&me!=null&&(K[Sa.Audio_Recv_Freeze]=(z=ne)===0||100*me/z>20?1:0)}var z;if(k){const ne=100*I._source.getAccurateVolumeLevel(),me=G.outputLevel;if(me!=null){const Oe=Math.ceil(50*Math.log10(100*me+1));Ke(K,st.Audio_Render_Level,Oe)}Ke(K,st.Audio_Recv_PCM_Level,ne),I&&(K[st.Audio_Recv_Disabled]=I._originMediaStreamTrack.enabled&&I._mediaStreamTrack.enabled?0:1),Ke(K,st.Audio_Recv_Jitter_Buffer,G.jitterBufferMs),Ke(K,st.Audio_Recv_Current_Delay,G.jitterBufferMs),K[st.Audio_Recv_Player_Status]=ZI[pi.getPlayerState(I.getTrackId())];const Ee=k.audioRecv.find(Oe=>Oe.ssrc===b);if(Ee){Ee.bytes!=null&&G.bytes!=null&&Ke(K,st.Audio_Recv_Bitrate,8*(G.bytes-Ee.bytes)/($u*n_));const Oe=G.concealedSamples-Ee.concealedSamples;Oe>0&&Ke(K,st.Audio_Recv_Concealed_Samples,Oe);const Qe=G.totalSamplesReceived-Ee.totalSamplesReceived;Qe>0&&Ke(K,st.Audio_Recv_Total_Samples_Received,Qe);const qe=G.freezeSamples80-Ee.freezeSamples80;qe>0&&Ke(K,st.Audio_Render_Freeze_Samples_80ms,qe);const dt=G.freezeSamples200-Ee.freezeSamples200;dt>0&&Ke(K,st.Audio_Render_Freeze_Samples_200ms,dt);const at=G.freezeMs80-Ee.freezeMs80;Ke(K,st.Audio_Render_Freeze_Time_80ms,at<0?0:at);const Ut=G.freezeMs200-Ee.freezeMs200;Ke(K,st.Audio_Render_Freeze_Time_200ms,Ut<0?0:Ut)}}return K}(m._audioSSRC,t,m.audioTrack,n,i,a):void 0;if(y&&(_.audio=y),m.audioTrack&&v){const b=t.audioRecv.find(O=>O.ssrc===m._audioSSRC);if(b&&b.estimatedPlayoutTimestamp){const O=b.estimatedPlayoutTimestamp-v;_.audio?_.audio[gr.Audio_Recv_AV_Sync_TIME]=O:_.audio={[gr.Audio_Recv_AV_Sync_TIME]:O}}}}(_.video||_.audio)&&d.push(_)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,d}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find(n=>n instanceof Wg);if(t&&t._external.getDenoiserStats){const n=t._external.getDenoiserStats();n&&this.requestUpload(Yu.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[n,i]=t;i.has(De.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(a=>{this.requestUpload&&this.requestUpload(a.type,a.stats)}),i.has(De.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(a=>{this.requestUpload&&this.requestUpload(a.type,a.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),i={connectionInterval:D("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let a=[];const c=this.requestAllTracks&&this.requestAllTracks()||[];for(const g of c)!g.muted&&g.enabled&&(a=a.concat(await g.getProcessorUsage()));const d=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[g,_]of d)_.has(De.VIDEO)&&g.videoTrack&&(a=a.concat(await g.videoTrack.getProcessorUsage())),_.has(De.AUDIO)&&g.audioTrack&&(a=a.concat(await g.audioTrack.getProcessorUsage()));if(a.length===0)return;i.details=function(g,_){const v={};for(const{id:I,value:N,level:k,direction:j}of g){var y;const G=(y=_.get(I))!==null&&y!==void 0?y:0,K=N===2?G+D("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:G;var b,O;_.set(I,K),v[I]?(N===2&&(v[I].value=N),k>v[I].level&&(v[I].level=k),j==="remote"&&(v[I].remoteUidCount+=1),v[I].totalTs=(b=_.get(I))!==null&&b!==void 0?b:0):v[I]={value:N,level:k,remoteUidCount:j==="local"?0:1,totalTs:(O=_.get(I))!==null&&O!==void 0?O:0}}return Object.keys(v).map(I=>{const{level:N,value:k,totalTs:j}=v[I];return{id:I,level:N,value:k,totalTs:j}})}(a,t);const h=Date.now(),m=h>n?h:n+1;this.requestUpload&&this.requestUpload(Yu.EXTENSION_USAGE_STATS,{usageStats:i,sendTs:m})},D("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1,Ts.stopCollectStats()}}const Oae=D("ICE_RESTART_INTERVAL");let lT=new Map,pm=new Map,cd=[Ir.UDP_TCP_RELAY,Ir.TCP_RELAY,Ir.RELAY],iN=D("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&vt().supportPCSetConfiguration;function pB(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=lT.get(e.id);n&&(window.clearTimeout(n),lT.delete(e.id));const i=pm.get(e.id);t&&i&&i.index===cd.length-1&&(R.debug("[".concat(e.id,"] reset ICE restart policy")),pm.delete(e.id))}function mB(e,t,n){if(lT.size===0&&pm.size===0&&(Array.isArray(D("RESTART_SEQUENCE"))&&D("RESTART_SEQUENCE").length>0&&!function(h,m){if(h.length!==m.length)return!1;for(let g=0;g<h.length;g+=1){const _=h[g];if(h.filter(v=>v===_).length!==m.filter(v=>v===_).length)return!1}return!0}(cd,D("RESTART_SEQUENCE"))&&(cd=D("RESTART_SEQUENCE").filter(h=>{var m;if(ve(m=Object.values(Ir)).call(m,h))return!0}),R.debug("use reconnection policy from config distribution, queues: ".concat(cd.join(" => ")))),iN=D("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&vt().supportPCSetConfiguration),cd.length===0)return void n();let i,{index:a=0,type:c}=pm.get(e.id)||{};if(iN&&c===Ir.RELAY)return void n();let d=c&&a>=cd.length-1;if(iN)c=Ir.RELAY;else{if(d)return void n();c?(a++,c=cd[a]):(c=cd[0],a=0)}R.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(c,", index: ").concat(a)),t(c),pm.set(e.id,{index:a,type:c}),i=window.setTimeout(()=>mB(e,t,n),Oae),lT.set(e.id,i)}var St;function fB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function uc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?fB(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fB(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function gB(e){var t,n,i,a=2;for(typeof Symbol<"u"&&(n=nS,i=Symbol.iterator);a--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new dT(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function dT(e){function t(n){if(Object(n)!==n)return we.reject(new TypeError(n+" is not an object."));var i=n.done;return we.resolve(n.value).then(function(a){return{value:a,done:i}})}return dT=function(n){this.s=n,this.n=n.next},dT.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?we.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?we.reject(n):t(i.apply(this.s,arguments))}},new dT(e)}let Zu=(St=class extends Sn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Fe.StateChange,t,this._state)}constructor(e,t){super(),x(this,"isPlanB",void 0),x(this,"store",void 0),x(this,"statsUploader",void 0),x(this,"connection",void 0),x(this,"localTrackMap",new Map),x(this,"remoteUserMap",new Map),x(this,"localDataChannels",[]),x(this,"remoteDataChannelMap",new Map),x(this,"pendingLocalTracks",[]),x(this,"pendingRemoteTracks",[]),x(this,"pendingLocalDataChannels",[]),x(this,"pendingRemoteDataChannels",[]),x(this,"statsCollector",void 0),x(this,"shouldForwardP2PCreation",void 0),x(this,"iceFailedCount",0),x(this,"dtlsFailedCount",0),x(this,"mutex",void 0),x(this,"_state",Ft.Disconnected),x(this,"_pcStatsUploadType",D("NEW_ICE_RESTART")?Xc.FIRST_CONNECTION:Xc.OLD_FIRST_CONNECTION),x(this,"_isStartRestartIce",!1),x(this,"_restartTimer",void 0),x(this,"_isTryConnecting",!1),x(this,"_iceError",null),x(this,"_forceTurn",!1),x(this,"_isWaitPcToRePub",!1),x(this,"handleMuteLocalTrack",async(n,i,a)=>{const c=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Ft.Connected)return void a(new de(L.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const d=this.filterTobeMutedTracks(n);if(d.length===0)return void i();const h=d.find(g=>g[0]==="videoLowTrack");if(h){const g=h[1];this.store.enableInstantMuteRestore?(g.track._originMediaStreamTrack.enabled=!1,R.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):g.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?R.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(d.map(g=>{let[,{id:_}]=g;return _}));const m=this.createMuteMessage(d);await cn(this,Fe.RequestMuteLocal,m),i()}catch(d){a(d)}finally{c()}}),x(this,"handleUnmuteLocalTrack",async(n,i,a)=>{const c=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Ft.Connected)return void a(new de(L.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const d=this.filterTobeUnmutedTracks(n);if(d.length===0)return void i();const h=d.find(g=>g[0]==="videoLowTrack");if(h){const g=h[1];if(this.store.enableInstantMuteRestore)g.track._originMediaStreamTrack.enabled=!0,R.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(g.track._originMediaStreamTrack.stop(),!D("DISABLE_DUAL_STREAM_USE_ENCODING")&&vt().supportDualStreamEncoding){const _=n._mediaStreamTrack.clone();g.track._mediaStreamTrack=_,g.track._originMediaStreamTrack=_}else{const _=nN(n,ku(this,Fe.RequestLowStreamParameter));g.track._mediaStreamTrack=_,g.track._originMediaStreamTrack=_}await new we((_,v)=>{this.handleReplaceTrack(g.track,_,v,!0)})}}this.store.enableInstantMuteRestore?R.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(d.map(g=>{let[,{id:_}]=g;return _}));const m=this.createUnmuteMessage(d);await cn(this,Fe.RequestUnmuteLocal,m),i()}catch(d){a(d)}finally{c()}}),x(this,"handleUpdateVideoEncoder",async(n,i,a,c)=>{let d;c||(d=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const m=this.localTrackMap.get(ye.LocalVideoTrack);if(!this.connection||!m||m.track!==n||this.state!==Ft.Connected)return void i();const{id:g,track:_}=m;await this.connection.updateSendParameters(g,_),await this.connection.updateEncoderConfig(g,_),this.emit(Fe.UpdateVideoEncoder,_),i()}catch(m){a(m)}finally{var h;(h=d)===null||h===void 0||h()}}),x(this,"handleUpdateVideoSendParameters",async(n,i,a)=>{const c=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const d=this.localTrackMap.get(ye.LocalVideoTrack);if(!this.connection||!d||d.track!==n||this.state!==Ft.Connected)return void i();const{id:h,track:m}=d;await this.connection.updateSendParameters(h,m),i()}catch(d){a(d)}finally{c()}}),x(this,"handleReplaceMixingTrack",async(n,i,a,c)=>{if(!this.connection||this.state!==Ft.Connected)return void i();const d=ZA([n]);let h;R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(d.getTrackId(),"]")),typeof c=="boolean"&&c||(h=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,d),i()}catch(g){a(g)}finally{var m;(m=h)===null||m===void 0||m()}}),x(this,"handleReplaceTrack",async(n,i,a,c)=>{let d;R.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof c=="boolean"&&c||(d=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var h;const g=Array.from(this.localTrackMap.entries()).find(_=>{let[,{track:v}]=_;return n===v});if(!this.connection||!g||this.state!==Ft.Connected)return void i();if(await((h=this.connection)===null||h===void 0?void 0:h.replaceTrack(n,g[1].id)),this.isPlanB){const _=g[1];_.id=n._mediaStreamTrack.id,this.localTrackMap.set(g[0],_)}if(g[0]===ye.LocalVideoTrack&&!D("DISABLE_DUAL_STREAM_USE_ENCODING")&&vt().supportDualStreamEncoding){const _=this.localTrackMap.get(ye.LocalVideoLowTrack);if(_){const v=n._mediaStreamTrack.clone();_.track._originMediaStreamTrack.stop(),_.track._mediaStreamTrack=v,_.track._originMediaStreamTrack=v,await new we((y,b)=>{this.handleReplaceTrack(_.track,y,b,!0)})}}i()}catch(g){a(g)}finally{var m;(m=d)===null||m===void 0||m()}}),x(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),x(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),x(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),x(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),x(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new hB(this.store),this.bindStatsUploaderEvents(),this.mutex=new Cr("P2PChannel-mutex",this.store.clientId),this.isPlanB=!vt().supportUnifiedPlan||D("CHROME_FORCE_PLAN_B")&&nc(),this.shouldForwardP2PCreation=D("FORWARD_P2P_CREATION")&&vt().supportPCSetConfiguration&&Zj(),this.shouldForwardP2PCreation&&(this.connection=t_(this.store),this.emit(Fe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=Ft.New,this._forceTurn=tN(e),R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const i=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||i||t)&&((i||t)&&this.connection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=t_(this.store,e),this.emit(Fe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new de(L.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=D("NEW_ICE_RESTART")?Xc.FIRST_CONNECTION:Xc.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new de(L.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(!this.isPreallocation()||this.state!==Ft.Connected){this.store.peerConnectionStart();const t=await this.connection.connect(e);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ft.Connected,t}if(this.connection instanceof Ws&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),Le.reportApiInvoke(this.store.sessionId,{name:_n.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:rn.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(Fe.RequestReconnect)});await this.connection.updateRemoteConnect(e)}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(a=>{var c;let[d]=a;return ve(c=[ye.LocalVideoLowTrack,ye.LocalVideoTrack]).call(c,d)}),n=t.map(a=>{let[,{id:c}]=a;return c}),i=t.map(a=>{let[c]=a;return c});if(this.connection instanceof Ws||this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"){if(Le.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(i),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!ve(e).call(e,this.store.codec)){const a=["vp9","vp8","h264"].find(c=>ve(e).call(e,c));a&&(this.store.codec=a,R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(a,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;return this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof Ws&&this.connection.peerConnectionState!=="closed"&&ve(e=[Ft.New,Ft.Connected]).call(e,this.state)?this.connection.establishPromise:void 0}async publishDataChannel(e){if(!this.connection||this.state!==Ft.Connected){if(this.state===Ft.Disconnected)throw new de(L.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(n=>{var i;ve(i=this.pendingLocalDataChannels).call(i,n)||this.pendingLocalDataChannels.push(n)}),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(n=>{const i=Date.now();this.store.publish(n.id.toString(),"datachannel",i)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(n=>{this.localDataChannels.push(n);const i=Date.now();this.store.publish(n.id+"","datachannel",void 0,i)}),e.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(e,t,n){var i=this;return Li(function*(){const a=yield ht(i.mutex.lock("From P2PChannel.publish"));try{var c;const d=i.connection&&ve(c=["disconnected","failed"]).call(c,i.connection.peerConnectionState);if(!i.connection||i.state!==Ft.Connected||d){if(i.state===Ft.Disconnected)throw new de(L.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(e);const m=e.filter(g=>i.pendingLocalTracks.indexOf(g)===-1);return i.pendingLocalTracks=i.pendingLocalTracks.concat(m),void(d&&(i._isWaitPcToRePub=!0))}i.store.pubId=i.store.pubId+1,Jr.markPublishStart(i.store.clientId,i.store.pubId);const h=i.filterTobePublishedTracks(e,t,n);if(h.length===0)return void(yield ht(i.tryToUnmuteAudio(e)));yield*Mp(gB(i.doPublish(i.connection,h)))}finally{a()}})()}doPublish(e,t){var n=this;return Li(function*(){t.forEach(y=>{let{track:b,type:O}=y;const I=Date.now();n.store.publish(b.getTrackId(),O===ye.LocalAudioTrack?"audio":"video",I)}),n.bindLocalTrackEvents(t);const i=t.map(y=>{let{track:b}=y;return b}),a=yield ht(e.send(i,n.store.codec,n.store.audioCodec)),c=(yield ht(a.next())).value,d=n.createGatewayPublishMessage(t,c);let h;try{h=yield d}catch(y){throw a.throw(y),(y==null?void 0:y.code)===L.WS_ABORT&&t.forEach(b=>{let{track:O}=b;n.pendingLocalTracks.indexOf(O)===-1&&n.pendingLocalTracks.push(O)}),n.unbindLocalTrackEvents(t),y}const m=n.mapPubResToRemoteConfig(d,h,i),g=(yield ht(a.next(m))).value;if(n.state===Ft.Disconnected)throw new de(L.UNEXPECTED_ERROR,"PeerConnection already disconnected.");D("ENABLE_VIDEO_SEI");const _=D("ENABLE_ENCODED_TRANSFORM"),v=D("ENABLE_AUDIO_METADATA");i.forEach(async y=>{const b=y.getRTCRtpTransceiver();if(!b||!_)return;const{interceptLocalVideoFrame:O,interceptLocalAudioFrame:I}=ZS();y.trackMediaType===De.VIDEO?await O(b.sender,y):y.trackMediaType===De.AUDIO&&await I(b.sender,{metadata:v?()=>{const N=y.metadata.shift();return N&&N.value}:void 0})}),t.forEach(y=>{let{type:b}=y;n.statsCollector.addLocalStats(b)}),n.assignLocalTracks(t,g),n.statsUploader.startUploadOutboundStats(),t.forEach(y=>{let{track:b,type:O}=y;const I=Date.now();n.store.publish(b.getTrackId(),O===ye.LocalAudioTrack?"audio":"video",void 0,I)})})()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof sn))return R.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:i}=n,a=function(c,d){const h={};return c.height&&c.width&&(h.scaleResolutionDownBy=PA(c,d)),h.maxFramerate=c.framerate?Fi(c.framerate):void 0,h.maxBitrate=c.bitrate?1e3*c.bitrate:void 0,h}(e,i);if(i._encoderConfig||(i._encoderConfig={}),t!==ye.LocalVideoLowTrack||!D("DISABLE_DUAL_STREAM_USE_ENCODING")&&vt().supportDualStreamEncoding)a.scaleResolutionDownBy!=null&&(i._encoderConfig.scaleResolutionDownBy=a.scaleResolutionDownBy);else{const c=i._originMediaStreamTrack;if(!c.canvas)return R.warn("[".concat(i.getTrackId(),"] no canvas on track"));(function(d,h){const m=d.canvas;h.width&&(m.width=Fi(h.width)),h.height&&(m.height=Fi(h.height)),h.framerate&&(m.stopCapture&&m.stopCapture(),m.stopCapture=nA(()=>{!m.startCapture&&m.stopCapture&&m.stopCapture(),m.startCapture&&m.startCapture()},Fi(h.framerate)))})(c,e)}a.maxBitrate!=null&&(i._encoderConfig.bitrateMax=a.maxBitrate/1e3),a.maxFramerate!=null&&(i._encoderConfig.frameRate&&typeof i._encoderConfig.frameRate=="object"?i._encoderConfig.frameRate.max=a.maxFramerate:i._encoderConfig.frameRate={max:a.maxFramerate}),R.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),await this.connection.updateRtpSenderEncodings(i)}publishLowStream(e){var t=this;return Li(function*(){if(!t.connection||t.state!==Ft.Connected)return;const n=yield ht(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const a=t.localTrackMap.get(ye.LocalVideoTrack);if(!a)throw new de(L.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(ye.LocalVideoLowTrack))throw new de(L.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const c=[{track:t.getLowVideoTrack(a.track,e),type:ye.LocalVideoLowTrack}];if(yield*Mp(gB(t.doPublish(t.connection,c))),a.track.muted||!a.track.enabled){var i;const d=(i=t.localTrackMap.get(ye.LocalVideoLowTrack))===null||i===void 0?void 0:i.id;d!==void 0&&(yield ht(t.connection.muteLocal([d])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(R.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Zn(this,Fe.RequestRePublish,this.pendingLocalTracks),this.emit(Fe.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(R.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Zn(this,Fe.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:n,kind:i}=this.pendingRemoteTracks[t];(i!==De.AUDIO||n._audio_added_&&n._audioSSRC)&&(i!==De.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await Zn(this,Fe.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===De.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:n}=t;this.emit(Fe.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Ft.Connected)return void e.forEach(i=>{const a=this.pendingLocalTracks.indexOf(i);a!==-1&&this.pendingLocalTracks.splice(a,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(i=>i[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==Ft.Connected)return void e.forEach(n=>{const i=this.pendingLocalDataChannels.indexOf(n);i!==-1&&this.pendingLocalDataChannels.splice(i,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(n=>{const i=this.localDataChannels.indexOf(n);i!==-1&&this.localDataChannels.splice(i,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Ft.Connected)return;const e=this.localTrackMap.get(ye.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[ye.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(i=>{let[,{id:a}]=i;return a})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(i=>{let[a,{track:c}]=i;return{type:a,track:c}})),t.forEach(i=>{let[a]=i;this.statsCollector.removeLocalStats(a)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==Ft.Connected)throw new de(L.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter(i=>{var a;return!((a=this.remoteDataChannelMap.get(e))!==null&&a!==void 0&&a.get(i.id))});if(n.length!==0)return await this.connection.createDataChannels(e.uid,n),n.forEach(i=>{var a;this.remoteDataChannelMap.has(e)?(a=this.remoteDataChannelMap.get(e))===null||a===void 0||a.set(i.id,i):this.remoteDataChannelMap.set(e,new Map([[i.id,i]]));const c=this.pendingRemoteDataChannels.findIndex(d=>{let{user:h,id:m}=d;return h.uid===e.uid&&m===i.id});c!==-1&&this.pendingRemoteDataChannels.splice(c,1)}),n.map(i=>i.id)}async subscribe(e,t,n,i,a){var c;if(!this.connection||this.state!==Ft.Connected)throw new de(L.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(t))return;let d,h,m,g;const _=this.connection.getPreMedia(n);if(_)R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),m=_.transceiver,d=_.track,h=_.mid,g=_.player,_.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:_.firstVideoRender});else if(a){const b=a.find(I=>{let{stream_type:N}=I;return N===t});if(!b)throw new de(L.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const O=await this.connection.receive(t,b.ssrcs,String(e._uintid),b.attributes);(this.connection instanceof Ws||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(m=O.transceiver),d=O.track,h=O.id}else{const b=await this.connection.receive(t,[{ssrcId:n,rtx:i}],String(e._uintid),void 0);(this.connection instanceof Ws||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(m=b.transceiver),d=b.track,h=b.id}if(t===De.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(d):(e._audioTrack=new Zp(d,e.uid,e._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),m&&e._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(d):(e._videoTrack=new $p(d,e.uid,e._uintid,this.store,g),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(so.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once(so.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),g?e._videoTrack.once(so.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once(so.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),m&&e._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._videoTrack)),m&&D("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:b,interceptRemoteAudioFrame:O}=ZS();t==De.VIDEO?await b(m.receiver,{onSei:D("ENABLE_VIDEO_SEI")&&(I=>{var N;return(N=e._videoTrack)===null||N===void 0?void 0:N._onSei(I)}),onFirstFrame:I=>{var N;const k=Array.from(ri(N=this.remoteUserMap).call(N)).find(j=>j._videoSSRC===I.ssrc);k&&this.store.firstVideoFrameDecoded(k.uid,{firstReceivedEncodedFrame:Date.now(),frameType:I.type,rtpTimestamp:I.rtpTimestamp,framePayloadType:I.payloadType,frameDataLength:I.length,mimeType:I.mimeType})}}):t==De.AUDIO&&await O(m.receiver,{enableTopn:!!D("ENABLE_AUDIO_TOPN"),enableMetadata:!!D("ENABLE_AUDIO_METADATA"),enablePts:!!D("ENABLE_AUDIO_PTS"),onMetadata:I=>{this.safeEmit(Fe.AudioMetadata,I)},onPts:I=>{this.safeEmit(Fe.AudioPts,I)}})}const v=this.remoteUserMap.get(e);v?v.set(t,h):this.remoteUserMap.set(e,new Map([[t,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const y=this.pendingRemoteTracks.findIndex(b=>{let{user:O,kind:I}=b;return O.uid===e.uid&&t===I});y!==-1&&(this.pendingRemoteTracks.splice(y,1),this.emit(Fe.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Ft.Connected)throw new de(L.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(a=>{var c;let{user:d,mediaType:h}=a;return!((c=this.remoteUserMap.get(d))!==null&&c!==void 0&&c.has(h))});const t=[],n=new Map;e.forEach(a=>{if(!this.connection)return;const c=this.connection.getPreMedia(a.ssrcId);if(c){const{track:d,mid:h,transceiver:m,player:g}=c;n.set(a.ssrcId,{track:d,id:h,transceiver:m,player:g})}else t.push(a)});const i=await this.connection.batchReceive(t.map(a=>{let{user:c,mediaType:d,ssrcId:h,rtxSsrcId:m}=a;return{kind:d,ssrcMsg:[{ssrcId:h,rtx:m}],mslabel:String(c._uintid)}}));t.forEach((a,c)=>{n.set(a.ssrcId,i[c])});for(const{user:a,mediaType:c,ssrcId:d}of e){const h=n.get(d);if(!h)return void R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(a.uid," subscribe data,").concat(c,", ").concat(d));const{track:m,id:g,transceiver:_,player:v}=h;if(_&&D("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:O,interceptRemoteAudioFrame:I}=ZS();c==De.VIDEO?await O(_.receiver,{onSei:D("ENABLE_VIDEO_SEI")&&(N=>{var k;return(k=a._videoTrack)===null||k===void 0?void 0:k._onSei(N)}),onFirstFrame:N=>{var k;const j=Array.from(ri(k=this.remoteUserMap).call(k)).find(G=>G._videoSSRC===N.ssrc);j&&this.store.firstVideoFrameDecoded(j.uid,{firstReceivedEncodedFrame:Date.now(),frameType:N.type,rtpTimestamp:N.rtpTimestamp,framePayloadType:N.payloadType,frameDataLength:N.length,mimeType:N.mimeType})}}):c==De.AUDIO&&await I(_.receiver,{enableTopn:!!D("ENABLE_AUDIO_TOPN"),enableMetadata:!!D("ENABLE_AUDIO_METADATA"),enablePts:!!D("ENABLE_AUDIO_PTS"),onMetadata:N=>{this.safeEmit(Fe.AudioMetadata,N)},onPts:N=>{this.safeEmit(Fe.AudioPts,N)}})}if(c===De.AUDIO?(a._audioTrack?a._audioTrack._updateOriginMediaStreamTrack(m):(a._audioTrack=new Zp(m,a.uid,a._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(a._audioTrack.getTrackId()))),_&&a._audioTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(a,a._audioTrack)):(a._videoTrack?a._videoTrack._updateOriginMediaStreamTrack(m):(a._videoTrack=new $p(m,a.uid,a._uintid,this.store,v),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(a._videoTrack.getTrackId()))),_&&a._videoTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(a,a._videoTrack)),D("ENABLE_VIDEO_SEI")&&_){const{interceptRemoteVideoFrame:O,interceptRemoteAudioFrame:I}=ZS();c==De.VIDEO?await O(_.receiver,{onSei:N=>{var k;(k=a._videoTrack)===null||k===void 0||k._onSei(N)},onFirstFrame:N=>{var k;const j=Array.from(ri(k=this.remoteUserMap).call(k)).find(G=>G._videoSSRC===N.ssrc);j&&this.store.firstVideoFrameDecoded(j.uid,{firstReceivedEncodedFrame:Date.now(),frameType:N.type,rtpTimestamp:N.rtpTimestamp,framePayloadType:N.payloadType,frameDataLength:N.length,mimeType:N.mimeType})}}):c==De.AUDIO&&await I(_.receiver)}const y=this.remoteUserMap.get(a);y?y.set(c,g):this.remoteUserMap.set(a,new Map([[c,g]])),this.statsCollector.addRemoteStats(a.uid),this.statsUploader.startUploadInboundStats();const b=this.pendingRemoteTracks.findIndex(O=>{let{user:I,kind:N}=O;return I.uid===a.uid&&c===N});b!==-1&&(this.pendingRemoteTracks.splice(b,1),this.emit(Fe.MediaReconnectEnd,a.uid))}}async unsubscribe(e,t,n){const i=this.pendingRemoteTracks.filter(d=>{let{user:h,kind:m}=d;return t!==void 0?h.uid===e.uid&&t===m:h.uid===e.uid});if(i.forEach(d=>{const h=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(h,1)}),this.connection&&this.state===Ft.Connected||n||i.forEach(d=>{let{kind:h}=d;var m;if(h===De.AUDIO)(m=e._audioTrack)===null||m===void 0||m._destroy(),e._audioTrack=void 0;else if(h===De.VIDEO){var g;(g=e._videoTrack)===null||g===void 0||g._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Ft.Connected)return;const a=this.filterTobeUnSubscribedTracks(e,t);if(a.length===0)return;await this.connection.stopReceiving(a.map(d=>{let[,{id:h}]=d;return h}));const c=this.createUnsubscribeMessage(a);return this.withdrawRemoteTracks(a),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),a.forEach(d=>{let[h,{kind:m}]=d;var g,_;if(m===De.VIDEO&&h._videoSSRC&&((g=this.connection)===null||g===void 0||g.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===De.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),n||((_=h._videoTrack)===null||_===void 0||_._destroy(),h._videoTrack=void 0);else if(m===De.AUDIO){var v;this.unbindRemoteTrackEvents(h._audioTrack),!n&&((v=h._audioTrack)===null||v===void 0||v._destroy(),h._audioTrack=void 0)}}),c}async unsubscribeDataChannel(e,t){if(t.forEach(a=>{const c=this.pendingRemoteDataChannels.findIndex(d=>d.id===a.id);c!==-1&&this.pendingRemoteDataChannels.splice(c,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(n.length===0)return;t.forEach(a=>{a._close()});const i=this.remoteDataChannelMap.get(e);return n.forEach(a=>{i&&i.delete(a.id)}),i&&i.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map(a=>a.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:a,mediaType:c}of e){const d=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:g}=h;return c!==void 0?m.uid===a.uid&&c===g:m.uid===a.uid});d.forEach(h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),t=t.concat(d)}if(!this.connection||this.state!==Ft.Connected)return void t.forEach(a=>{let{user:c,kind:d}=a;var h;if(d===De.AUDIO)(h=c._audioTrack)===null||h===void 0||h._destroy(),c._audioTrack=void 0;else if(d===De.VIDEO){var m;(m=c._videoTrack)===null||m===void 0||m._destroy(),c._videoTrack=void 0}});const n=to(e).call(e,(a,c)=>{let{user:d,mediaType:h}=c;const m=this.filterTobeUnSubscribedTracks(d,h);return a.concat(m)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(a=>{let[,{id:c}]=a;return c}));const i=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(a=>{let[c,{kind:d}]=a;var h,m;if(d===De.VIDEO&&c._videoSSRC&&((h=this.connection)===null||h===void 0||h.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),d===De.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),(m=c._videoTrack)===null||m===void 0||m._destroy(),c._videoTrack=void 0;else if(d===De.AUDIO){var g;this.unbindRemoteTrackEvents(c._audioTrack),(g=c._audioTrack)===null||g===void 0||g._destroy(),c._audioTrack=void 0}}),i}isPreSubScribe(e){return!this.connection||this.state!==Ft.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void R.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void R.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const i=t===De.VIDEO?e._videoSSRC:e._audioSSRC;i!==void 0&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void R.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||R.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(ye.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(ye.LocalAudioTrack);if((t==null?void 0:t.track)instanceof sr){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[a]=i;return a!==ye.LocalAudioTrack}).filter(i=>{let[a]=i;return!(e&&a===ye.LocalVideoLowTrack)}).map(i=>{let[,{track:a}]=i;return a}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(e&&i===ye.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,i,a){if(e){const d=this.localTrackMap.get(ye.LocalAudioTrack),h=i?this.localTrackMap.get(ye.LocalVideoLowTrack):this.localTrackMap.get(ye.LocalVideoTrack);Le.publish(this.store.sessionId,{eventElapse:Jr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d==null?void 0:d.track.getTrackLabel(),videoName:h==null?void 0:h.track.getTrackLabel(),screenshare:(h==null?void 0:h.track._hints.indexOf(Bt.SCREEN_TRACK))!==-1,audio:!!d,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}else{var c;n||(n=[]);const d=n.find(m=>m instanceof Dn),h=i?(c=this.localTrackMap.get(ye.LocalVideoTrack))===null||c===void 0?void 0:c.track:n.find(m=>m instanceof sn);Le.publish(this.store.sessionId,{eventElapse:Jr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d==null?void 0:d.getTrackLabel(),videoName:h==null?void 0:h.getTrackLabel(),screenshare:(h==null?void 0:h._hints.indexOf(Bt.SCREEN_TRACK))!==-1,audio:!!d,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}}reportSubscribeEvent(e,t,n,i){const a=i===De.VIDEO?n._videoSSRC:n._audioSSRC;a&&Le.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===De.VIDEO,audio:i===De.AUDIO,peerid:n.uid,subscribeRequestid:a,p2pid:this.store.p2pId,eventElapse:Jr.measureFromSubscribeStart(this.store.clientId,a),preSsrc:this.isPreSubScribe(a)})}reset(){R.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Cr("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=t_(this.store),this.emit(Fe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(ye.LocalAudioTrack);if((e==null?void 0:e.track)instanceof sr){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Ft.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(ye.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(ye.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof sn||t&&t.track instanceof Dn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(ri(t=this.remoteUserMap).call(t)).find(i=>i.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(ye.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Tu(e).call(e,(n,i)=>n.level-i.level),e}async disconnectForReconnect(){this.connection&&(R.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Ft.Reconnecting,D("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=t_(this.store),this.emit(Fe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:i}]=e;switch(n){case ye.LocalVideoTrack:ve(t=i._hints).call(t,Bt.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case ye.LocalAudioTrack:i instanceof sr?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case ye.LocalVideoLowTrack:}}),this.emit(Fe.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(ri(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(t,i)}),this.emit(Fe.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,n]=e;Array.from(ri(n).call(n)).forEach(i=>{this.setPendingRemoteDataChannel(t,i)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),R.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:i,id:a}=n;if((e instanceof ad?e.uid:e)===i.uid&&a===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:i,kind:a}=n;if((e instanceof ad?e.uid:e)===i.uid&&t===a)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return Li(function*(){if(!t.connection||t.state!==Ft.Connected)return;const n=yield ht(t.mutex.lock("From P2PChannel.restartICE"));let i;try{i=yield ht(t.connection.restartICE(e));const c=yield ht(i.next());if(c.done)return;const d=c.value,h=yield d;switch(eN(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case Ir.UDP_TCP_RELAY:t._pcStatsUploadType=Xc.UDP_TCP_RESTART;break;case Ir.TCP_RELAY:t._pcStatsUploadType=Xc.TCP_RESTART;break;case Ir.RELAY:t._pcStatsUploadType=Xc.RELAY_RESTART;break;default:t._pcStatsUploadType=Xc.OLD_RESTART}t._isTryConnecting=!0,i.next(h)}catch(c){var a;(a=i)===null||a===void 0||a.throw(c)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(ye.LocalVideoTrack),n=this.localTrackMap.get(ye.LocalAudioTrack),i=e.videoSend.find(b=>b.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),a=e.audioSend.find(b=>b.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!i||!a)return 1;const c=Ss(this,Fe.NeedSignalRTT),d=i?i.rttMs:void 0,h=a?a.rttMs:void 0,m=d&&h?(d+h)/2:d||h,g=(m&&c?(m+c)/2:m||c)||0,_=100*e.sendPacketLossRate*.7/50+.3*g/1500,v=_<.17?1:_<.36?2:_<.59?3:_<.1?4:5,y=t==null?void 0:t.track;if(y&&y._encoderConfig&&y._hints.indexOf(Bt.SCREEN_TRACK)===-1){const b=y._encoderConfig.bitrateMax,O=e.bitrate.actualEncoded;if(b&&O){const I=(1e3*b-O)/(1e3*b);return n3[I<.15?0:I<.3?1:I<.45?2:I<.6?3:4][v]}}return v}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const a=i._audioSSRC,c=i._videoSSRC,d=e.audioRecv.find(O=>O.ssrc===a),h=e.videoRecv.find(O=>O.ssrc===c);if(!d&&!h)return void(t+=1);const m=Ss(this,Fe.NeedSignalRTT),g=e.rtt,_=(g&&m?(g+m)/2:g||m)||0,v=d?d.jitterMs:void 0,y=e.recvPacketLossRate;let b=.7*y*100/50+.3*_/1500;v&&(b=.6*y*100/50+.2*_/1500+.2*v/400),t+=b<.1?1:b<.17?2:b<.36?3:b<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new we((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}async replaceTrack(e,t){var n;if(R.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==Ft.Connected)return;const i=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return e===d});if(!i)return;const a=i[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:a}]),this.bindLocalTrackEvents([{track:t,type:a}]),i[1].track=t),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(t,i[1].id)),this.isPlanB){const c=i[1];c.id=t._mediaStreamTrack.id,this.localTrackMap.set(a,c)}if(a===ye.LocalVideoTrack&&!D("DISABLE_DUAL_STREAM_USE_ENCODING")&&vt().supportDualStreamEncoding){const c=this.localTrackMap.get(ye.LocalVideoLowTrack);if(c){const d=e._mediaStreamTrack.clone();c.track._originMediaStreamTrack.stop(),c.track._mediaStreamTrack=d,c.track._originMediaStreamTrack=d,await new we((h,m)=>{this.handleReplaceTrack(c.track,h,m,!0)})}}}filterTobePublishedTracks(e,t,n){const i=[],a=this.getAllTracks();e=Vp(e=e.filter(m=>a.indexOf(m)===-1));let c,d=!1;const h=this.localTrackMap.get(ye.LocalAudioTrack);for(const m of e){if(m instanceof sn&&(this.localTrackMap.has(ye.LocalVideoTrack)||d?new de(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:m,type:ye.LocalVideoTrack}),d=!0),t)){const g=this.getLowVideoTrack(m,n);i.push({track:g,type:ye.LocalVideoLowTrack})}if(m instanceof Dn)if(h){const g=h.track;if(g instanceof sr)$A([m]),g.addAudioTrack(m),this.bindLocalAudioTrackEvents(m,!0);else{const _=ZA([g,m]);R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(_.getTrackId(),"]")),this.replaceTrack(g,_)}}else c instanceof sr?($A([m]),c.addAudioTrack(m)):c||!m._useAudioElement&&vt().webAudioMediaStreamDest&&!m._bypassWebAudio?c=ZA(c?[m,c]:[m]):c=m}return c&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(c.getTrackId(),"]")),i.push({track:c,type:ye.LocalAudioTrack})),i}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Vp(e=e.filter(i=>n.indexOf(i)!==-1));for(const i of e){if(i instanceof Dn){const a=this.localTrackMap.get(ye.LocalAudioTrack);if(!a)continue;a.track instanceof sr?(a.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),a.track.trackList.length===0&&(t.push([ye.LocalAudioTrack,a]),a.track.close())):t.push([ye.LocalAudioTrack,a])}if(i instanceof sn){const a=this.localTrackMap.get(ye.LocalVideoTrack);if(!a)continue;t.push([ye.LocalVideoTrack,a]);const c=this.localTrackMap.get(ye.LocalVideoLowTrack);c&&t.push([ye.LocalVideoLowTrack,c])}}return t}filterTobePublishedDataChannels(e){return e=(e=Vp(e)).filter(t=>this.localDataChannels.findIndex(n=>n.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Vp(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:i}=t;switch(i){case ye.LocalVideoTrack:n.addListener(Me.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Me.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(Me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Me.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Me.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Me.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ye.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case ye.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof sr?e.trackList.forEach(n=>{n.addListener(Me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Me.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Me.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(Me.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Me.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:i}]=t;return{track:i,type:n}})),e.forEach(t=>{let{track:n,type:i}=t;switch(i){case ye.LocalVideoTrack:n.off(Me.GET_STATS,this.handleGetLocalVideoStats),n.off(Me.GET_RTC_STATS,this.handleGetRTCStats),n.off(Me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Me.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Me.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Me.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ye.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case ye.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof sr?e.trackList.forEach(t=>{t.off(Me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Me.GET_STATS,this.handleGetLocalAudioStats),t.off(Me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Me.GET_STATS,this.handleGetLocalAudioStats),e.off(Me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Me.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Me.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof $p&&t.addListener(Me.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof Zp&&t.addListener(Me.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Me.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(De.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(De.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,i)=>{var a;let c,d,{track:h,type:m}=n;switch(m){case ye.LocalAudioTrack:c=Ht.Audio,d={dtx:h instanceof Wg&&h._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ye.LocalVideoTrack:c=ve(a=h._hints).call(a,Bt.SCREEN_TRACK)?Ht.Screen:Ht.High,d=uc(uc({},_3(h)),{},{codec:this.store.codec,svc_mode:qg()});break;case ye.LocalVideoLowTrack:c=Ht.Low,d=uc(uc({},_3(h)),{},{codec:this.store.codec,svc_mode:qg()})}return{stream_type:c,attributes:d,ssrcs:t[i]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let i,[a,{track:c,ssrcs:d,id:h}]=t;switch(a){case ye.LocalVideoTrack:i=ve(n=c._hints).call(n,Bt.SCREEN_TRACK)?Ht.Screen:Ht.High;break;case ye.LocalAudioTrack:i=Ht.Audio;break;case ye.LocalVideoLowTrack:i=Ht.Low}return{stream_type:i,ssrcs:d,mid:h}})}assignLocalTracks(e,t){e.forEach((n,i)=>{let{track:a,type:c}=n;this.localTrackMap.set(c,{track:a,id:t[i].id,ssrcs:t[i].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Fe.PeerConnectionStateChange,t),t==="connecting"&&e instanceof Ws&&!pn()&&D("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},D("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Ws&&pB(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=Xc.DISCONNECTED_OR_FAILED,Ss(this,Fe.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map(a=>a.getTrackId()),i=this.pendingLocalDataChannels.map(a=>"dc_".concat(a.id));Le.reportApiInvoke(this.store.sessionId,{name:_n.REPUB_AFTER_PC_CONNECTED,options:n.concat(i),tag:rn.TRACER}).onSuccess(),this.republish()}if(D("NEW_ICE_RESTART")&&e instanceof Ws&&!pn()&&!this._forceTurn&&!this.store.useDcSignal){if(ve(u3).call(u3,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=a=>{eN(e)&&(R.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(a)),Ss(this,Fe.QueryClientConnectionState)==="CONNECTED"&&this.emit(Fe.RequestRestartICE,a))},i=()=>{eN(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),R.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Fe.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{mB(e,n,i)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&D("ICE_RESTART")&&Ss(this,Fe.QueryClientConnectionState)==="CONNECTED"&&this.emit(Fe.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Fe.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Fe.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Le.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:rn.TRACER}).onSuccess(),this.emit(Fe.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const i=Array.from(ri(n=this.remoteUserMap).call(n)).find(c=>c._audioSSRC===t);var a;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(a=i.audioTrack)===null||a===void 0||a.emit(so.FIRST_FRAME_DECODED),Le.firstRemoteFrame(this.store.sessionId,ir.FIRST_AUDIO_DECODE,En.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:Jr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const i=Array.from(ri(n=this.remoteUserMap).call(n)).find(a=>a._audioSSRC===t);i&&Le.firstRemoteFrame(this.store.sessionId,ir.FIRST_AUDIO_RECEIVED,En.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:Jr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,i)=>{var a;const c=Array.from(ri(a=this.remoteUserMap).call(a)).find(d=>d._videoSSRC===t);c&&this.store.firstVideoFrameDecoded(c.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,n,i)},e.onFirstVideoRender=t=>{var n;const i=Array.from(ri(n=this.remoteUserMap).call(n)).find(a=>a._videoSSRC===t);i&&(this.store.firstVideoFrameDecoded(i.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(i),this.emit(Fe.FirstVideoPreRender,i.uid,t))},e.onFirstVideoReceived=t=>{var n;const i=Array.from(ri(n=this.remoteUserMap).call(n)).find(a=>a._videoSSRC===t);i&&(this.store.firstVideoFrameDecoded(i.uid,{firstReceived:Date.now()}),Le.firstRemoteFrame(this.store.sessionId,ir.FIRST_VIDEO_RECEIVED,En.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:Jr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstVideoBufferReady=t=>{var n;const i=Array.from(ri(n=this.remoteUserMap).call(n)).find(a=>a._videoSSRC===t);i&&this.emit(Fe.FirstVideoBufferReady,i.uid,t)},e.onSelectedLocalCandidateChanged=(t,n)=>{const i=t.candidateType==="relay",a=n.candidateType==="relay";n.candidateType!=="unknown"&&i===a||this.emit(Fe.ConnectionTypeChange,i),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(sd(n))," -> ").concat(JSON.stringify(sd(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(sd(n))," -> ").concat(JSON.stringify(sd(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return uc(uc({},t),n)},e.onICECandidateError=t=>{this._iceError=t}}fallbackConnection(){R.debug("[".concat(this.store.clientId,"] [P2PChannel] try to fallback connection")),this.state===Ft.Connected?(R.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&this.resetConnection(this.connection),this.shouldForwardP2PCreation&&(this.connection=t_(this.store),this.emit(Fe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)))}resetConnection(e){e instanceof Ws&&function(t){pm.delete(t.id),pB(t)}(e),e.close(),this.emit(Fe.PeerConnectionStateChange,"closed"),function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(ye.LocalAudioTrack);if(e instanceof Dn&&(n==null?void 0:n.track)instanceof sr)return n.track.isActive||t.push([ye.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:c}]=a;return e===c});if(i&&(t.push(i),i[0]===ye.LocalVideoTrack)){const a=this.localTrackMap.get(ye.LocalVideoLowTrack);a&&t.push([ye.LocalVideoLowTrack,a])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(ye.LocalAudioTrack);if(e instanceof Dn&&(n==null?void 0:n.track)instanceof sr)return n.track.isActive&&t.push([ye.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:c}]=a;return e===c});if(i)if(i[0]===ye.LocalVideoTrack){t.push(i);const a=this.localTrackMap.get(ye.LocalVideoLowTrack);a&&t.push([ye.LocalVideoLowTrack,a])}else t.push(i);return t}createMuteMessage(e){return e.map(t=>{var n;let i,[a,{track:c,ssrcs:d,id:h}]=t;switch(a){case ye.LocalAudioTrack:i=Ht.Audio;break;case ye.LocalVideoTrack:i=ve(n=c._hints).call(n,Bt.SCREEN_TRACK)?Ht.Screen:Ht.High;break;case ye.LocalVideoLowTrack:i=Ht.Low}return{stream_type:i,ssrcs:d,mid:h}})}createUnmuteMessage(e){return e.map(t=>{var n;let i,[a,{track:c,ssrcs:d,id:h}]=t;switch(a){case ye.LocalAudioTrack:i=Ht.Audio;break;case ye.LocalVideoTrack:i=ve(n=c._hints).call(n,Bt.SCREEN_TRACK)?Ht.Screen:Ht.High;break;case ye.LocalVideoLowTrack:i=Ht.Low}return{stream_type:i,ssrcs:d,mid:h}})}filterTobeUnSubscribedTracks(e,t){const n=[],i=this.remoteUserMap.get(e);if(!i)return n;if(t){const a=i.get(t);if(!a)return n;n.push([e,{kind:t,id:a}])}else Array.from(i.entries()).forEach(a=>{let[c,d]=a;n.push([e,{kind:c,id:d}])});return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach(i=>{var a;(a=this.remoteDataChannelMap.get(e))!==null&&a!==void 0&&a.has(i.id)&&n.push(i)}),n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[i,{kind:a,id:c}]=n;switch(a){case De.VIDEO:return void(i._videoSSRC&&t.push({stream_type:De.VIDEO,ssrcId:i._videoSSRC}));case De.AUDIO:return void(i._audioSSRC&&t.push({stream_type:De.AUDIO,ssrcId:i._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(n=>{let[i,{kind:a}]=n;if(t.has(i)){let c=t.get(i);a===De.VIDEO?c|=fr.Video:c|=fr.Audio,t.set(i,c)}else a===De.VIDEO?t.set(i,fr.Video):t.set(i,fr.Audio)}),{users:Array.from(t.entries()).map(n=>{let[i,a]=n;return{stream_id:i.uid,stream_type:a}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:i}]=t;const a=this.remoteUserMap.get(n);a&&(a.delete(i),Array.from(a.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(ye.LocalVideoTrack),n=this.localTrackMap.get(ye.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new we((i,a)=>{this.handleUpdateVideoEncoder(t.track,i,a,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new we((i,a)=>{this.handleUpdateVideoEncoder(n.track,i,a,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return!(!this.connection||!("name"in this.connection)||this.connection.name!=="DataChannelConnection"||this.connection.peerConnectionState==="closed")||this.connection instanceof Ws&&this.connection.isPreallocation}isPreSub(){return(this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof Ws)&&this.connection.isPreSub()}isPreRender(){return this.connection instanceof Ws&&this.connection.isPreRender}mapPubResToRemoteConfig(e,t,n){return e.map((i,a)=>{var c;let{stream_type:d}=i;const h=(c=t.find(m=>{let{stream_type:g}=m;return d===g}))===null||c===void 0?void 0:c.attributes;if(h&&D("DISABLE_SCREEN_SHARE_REMB")){const m=n[a]._hints;(ve(m).call(m,Bt.SCREEN_TRACK)||ve(m).call(m,Bt.SCREEN_LOW_TRACK))&&(h.remb=!1,R.debug("disable remb for screen share, hints:",m))}return h})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof Dn){var t;const i=this.filterTobeUnmutedTracks(e[n]);if(i.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(i.map(c=>{let[,{id:d}]=c;return d})));const a=this.createUnmuteMessage(i);return void await cn(this,Fe.RequestUnmuteLocal,a)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Fe.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Fe.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await pr(fS(this.dtlsFailedCount,Kn)),this.emit(Fe.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await Zn(this,Fe.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Fe.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(ye.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof sn)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof sn).length>1)throw new de(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Dn).length>1&&(e.some(t=>t instanceof Dn&&t._bypassWebAudio)||!vt().webAudioMediaStreamDest))throw new de(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof sn&&this.pendingLocalTracks.some(n=>n instanceof sn))throw new de(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Dn&&this.pendingLocalTracks.some(n=>n instanceof Dn)&&(!vt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Dn&&n._bypassWebAudio)))throw new de(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const i=!D("DISABLE_DUAL_STREAM_USE_ENCODING")&&vt().supportDualStreamEncoding,a=uc(uc({},{width:160,height:120,framerate:15,bitrate:50}),t);let c;c=i?e._mediaStreamTrack.clone():nN(e,a);const d=Wt(8,"track-low-"),h=new sn(c,uc(uc({},i&&{scaleResolutionDownBy:PA(a,e)}),{},{frameRate:a.framerate,bitrateMax:a.bitrate,bitrateMin:a.bitrate}),void 0,void 0,d);return h.on(Bu.TRANSCEIVER_UPDATED,m=>{e._updateRtpTransceiver(m,Kp.LOW_STREAM)}),h._hints.push(Bt.LOW_STREAM),ve(n=e._hints).call(n,Bt.SCREEN_TRACK)&&h._hints.push(Bt.SCREEN_LOW_TRACK),e.on("sei-to-send",m=>{h.emit("sei-to-send",m)}),e.addListener(Me.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Ws){var a,c,d,h;const m=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:g,dtlsTransportState:_,peerConnectionState:v}=this.connection,{local:y,remote:b}=await this.connection.getSelectedCandidatePair();Le.pcStats(this.store.sessionId,{startTime:m,eventElapse:e-m||0,iceconnectionsate:g,dtlsstate:_,connectionstate:v,intSucc:t?1:2,error:this._iceError||i||"",selectedLocalCandidateProtocol:(a=y==null?void 0:y.protocol)!==null&&a!==void 0?a:"",selectedLocalCandidateType:(c=y.candidateType)!==null&&c!==void 0?c:"",selectedLocalCandidateAddress:"".concat(y.address,":").concat(y.port),selectedRemoteCandidateProtocol:(d=b.protocol)!==null&&d!==void 0?d:"",selectedRemoteCandidateType:(h=b.candidateType)!==null&&h!==void 0?h:"",selectedRemoteCandidateAddress:"".concat(b.address,":").concat(b.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){const t=this.store.keyMetrics,n=t.firstVideoFrameDecoded.find(_=>_.userId===e.uid);if(!n)return;const{isInternalUpload:i,isExternalUpload:a}=n;if(i&&a)return;const{subscribeEnd:c,firstPreRender:d,peerPublishDuration:h,peerPubStatusMs:m}=n;let{firstRender:g=0}=n;if(c&&(g||d)&&h&&m){n.isInternalUpload=!0;const{playEnd:_}=n;_&&(n.isExternalUpload=!0);const{firstPreRender:v=0}=n;g=v||g;const y=e.videoTrack,b={peer:e._uintid,width:(y==null?void 0:y._videoWidth)||0,height:(y==null?void 0:y._videoHeight)||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:h,peerPubStatusMs:m,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:n.userJoinNotify||0,videoAddNotify:n.videoAddNotify||0,subscribeStart:n.subscribeStart||0,subscribeEnd:n.subscribeEnd||0,firstReceived:n.firstReceived||0,firstDecoded:n.firstDecoded||0,firstPreRender:v||0,firstRender:_?Math.max(g,_):Math.max(g,c),playStart:n.playStart||0,playEnd:n.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:UV(this.store),firstReceivedEncodedFrame:n.firstReceivedEncodedFrame||0,frameType:n.frameType||"",rtpTimestamp:n.rtpTimestamp||0,framePayloadType:n.framePayloadType||0,frameDataLength:n.frameDataLength||0,mimeType:n.mimeType||""};Le.firstXLAPeerFirstVideoFrame(this.store.sessionId,b)}}reportVideoFirstFrameDecoded(e,t,n,i){var a;const c=Array.from(ri(a=this.remoteUserMap).call(a)).find(d=>d._videoSSRC===e);if(c){i||this.store.subscribe(c.uid,"video",void 0,void 0,void 0,void 0,Date.now());const d=this.store.keyMetrics,h=d.subscribe.find(m=>m.userId===c.uid&&m.type==="video");Le.firstRemoteVideoDecode(this.store.sessionId,ir.FIRST_VIDEO_DECODE,En.FIRST_VIDEO_DECODE,{peer:c._uintid,videowidth:t,videoheight:n,subscribeElapse:Jr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:d.requestAPEnd||0,apStart:d.requestAPStart||0,joinGwEnd:d.joinGatewayEnd||0,joinGwStart:d.joinGatewayStart||0,pcEnd:d.peerConnectionEnd||0,pcStart:d.peerConnectionStart||0,subscriberEnd:(h==null?void 0:h.subscribeEnd)||0,subscriberStart:(h==null?void 0:h.subscribeStart)||0,videoAddNotify:(h==null?void 0:h.streamAdded)||0,state:i?1:0,firstFrame:(h==null?void 0:h.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const i=this.remoteUserMap.get(e);if(!i)return!1;const a=i.get(t);if(!a)return!1;const c=await this.connection.getRemoteSSRC(a);return c!==void 0&&c!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===ye.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Kp.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Ie(St.prototype,"startP2PConnection",[mi],Object.getOwnPropertyDescriptor(St.prototype,"startP2PConnection"),St.prototype),Ie(St.prototype,"connect",[mi],Object.getOwnPropertyDescriptor(St.prototype,"connect"),St.prototype),Ie(St.prototype,"updateRemoteRTPCapabilities",[mi],Object.getOwnPropertyDescriptor(St.prototype,"updateRemoteRTPCapabilities"),St.prototype),Ie(St.prototype,"publishDataChannel",[mi],Object.getOwnPropertyDescriptor(St.prototype,"publishDataChannel"),St.prototype),Ie(St.prototype,"unpublish",[mi],Object.getOwnPropertyDescriptor(St.prototype,"unpublish"),St.prototype),Ie(St.prototype,"unpublishDataChannel",[mi],Object.getOwnPropertyDescriptor(St.prototype,"unpublishDataChannel"),St.prototype),Ie(St.prototype,"unpublishLowStream",[mi],Object.getOwnPropertyDescriptor(St.prototype,"unpublishLowStream"),St.prototype),Ie(St.prototype,"subscribeDataChannel",[mi],Object.getOwnPropertyDescriptor(St.prototype,"subscribeDataChannel"),St.prototype),Ie(St.prototype,"subscribe",[mi],Object.getOwnPropertyDescriptor(St.prototype,"subscribe"),St.prototype),Ie(St.prototype,"massSubscribe",[mi],Object.getOwnPropertyDescriptor(St.prototype,"massSubscribe"),St.prototype),Ie(St.prototype,"unsubscribe",[mi],Object.getOwnPropertyDescriptor(St.prototype,"unsubscribe"),St.prototype),Ie(St.prototype,"unsubscribeDataChannel",[mi],Object.getOwnPropertyDescriptor(St.prototype,"unsubscribeDataChannel"),St.prototype),Ie(St.prototype,"massUnsubscribe",[mi],Object.getOwnPropertyDescriptor(St.prototype,"massUnsubscribe"),St.prototype),Ie(St.prototype,"muteRemote",[mi],Object.getOwnPropertyDescriptor(St.prototype,"muteRemote"),St.prototype),Ie(St.prototype,"unmuteRemote",[mi],Object.getOwnPropertyDescriptor(St.prototype,"unmuteRemote"),St.prototype),Ie(St.prototype,"hasRemoteMediaWithLock",[mi],Object.getOwnPropertyDescriptor(St.prototype,"hasRemoteMediaWithLock"),St.prototype),Ie(St.prototype,"disconnectForReconnect",[mi],Object.getOwnPropertyDescriptor(St.prototype,"disconnectForReconnect"),St.prototype),Ie(St.prototype,"updateBitrateLimit",[mi],Object.getOwnPropertyDescriptor(St.prototype,"updateBitrateLimit"),St.prototype),Ie(St.prototype,"remoteMediaSsrcChanged",[mi],Object.getOwnPropertyDescriptor(St.prototype,"remoteMediaSsrcChanged"),St.prototype),St);function mi(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const a=this.mutex,c=await a.lock("From P2PChannel.".concat(t));try{for(var d=arguments.length,h=new Array(d),m=0;m<d;m++)h[m]=arguments[m];return await i.apply(this,h)}finally{c()}},n}function _B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function EB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?_B(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_B(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const Pae=Date.now(),Dae=20,sN=new Map,uT=new Map;async function vB(e){const t=sN.get(e),n=Array.isArray(t)&&t[t.length-1],i=uT.get(e);if(!n)return void(i.isSyncing=!1);const a={uid:n.uid,payload:n.payload};i.firstRecvTs===0&&(i.firstRecvTs=n.recvTs,i.firstSendTs=n.sendTs);const c=n.sendTs-i.firstSendTs,d=c-(Date.now()-i.firstRecvTs);d>0&&(i.firstRecvTs=Date.now()-c);let h=n.mediaDelay+d;h<=0?(t.pop(),yB(n.context,a),h=0):h=Math.min(h,Dae),setTimeout(()=>t.length&&vB(e),h)}function yB(e,t){e.safeEmit(ft.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function kae(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return yB(n,{uid:e.uid,payload:e.payload});const i="".concat(n.id,"-").concat(e.uid),a=sN.get(i)||[],c=a.findIndex(g=>e.sendTs>=g.sendTs),d=EB(EB({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});c===-1?a.push(d):a.splice(c,0,d),sN.set(i,a);let h=!1;var m;uT.has(i)?h=!((m=uT.get(i))===null||m===void 0||!m.isSyncing):uT.set(i,{isSyncing:h,firstRecvTs:0,firstSendTs:0}),h||vB(i)}const Lae=Pt().name;function SB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function TB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?SB(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):SB(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const mm="websdk_ng_cache_parameter",Mae=D("MAX_PRELOAD_ASYNC_LENGTH"),Uae=1e4,eh=new Map,th=[];let oN=null,aN=0,cN=0;const hT=new Map,bB=new Uint8Array([241,141,127,212,103,139,200,225,251,157,127,139,143,2,22,163]),jae=function(e,t){const n=[];let i=0;const a=async()=>{const c=n.shift();c&&await c(),n.length>0&&i<t?a():i--};return async function(){for(var c=arguments.length,d=new Array(c),h=0;h<c;h++)d[h]=arguments[h];return new we(async(m,g)=>{n.push(async()=>{try{const _=await e(...d);m(_)}catch(_){g(_)}}),i<t&&(i++,a())})}}(dN,Mae),lN=Mi.CancelToken.source();class Vae{constructor(){x(this,"_audioContext",null)}createMuteAudioTrack(){this._audioContext=new AudioContext;const t=this._audioContext.sampleRate,n=10*t,i=this._audioContext.createBuffer(2,n,t),a=this._audioContext.createBufferSource();a.buffer=i;const c=this._audioContext.createMediaStreamDestination();return a.connect(c),a.start(),c.stream.getAudioTracks()[0]}close(){this._audioContext&&(this._audioContext.close(),this._audioContext=null)}}async function dN(e,t,n,i,a,c,d){try{if(!D("ENABLE_PRELOAD"))return;if(!vt().supportWebCrypto)return void Zl(()=>{R.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new de(L.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Lr(n,"token",1,2047),Lr(e,"appid",1,2047),BS(t),i&&GS(i);const h=Uu();R.debug("preload channel ".concat(t,", uid is ").concat(i));const m={appId:e,cname:t,token:n||e,uid:typeof i!="string"?i:null,sid:h,proxyServer:a,role:d};let g,_;typeof i=="string"?(m.stringUid=i,[_,g]=await we.all([yae(i,{sid:h,appId:e},lN.token),q3(TB(TB({},m),{},{token:n||e,uid:0}),lN.token)]),m.uid=_.uid,g.gatewayInfo.uid=m.uid,g.gatewayInfo.res.uid=m.uid):(c&&(m.stringUid=c),g=await q3(m,lN.token));const v={sid:h,appId:e,cname:t,token:n||e,uid:m.stringUid||i,intUid:m.uid||g.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:_,ap:g};await hN(v),aN++}catch(h){throw cN++,function(m){oN||(oN=window.setTimeout(()=>{let _="";hT.forEach((v,y)=>{_+="".concat(y,": ").concat(v," ;")}),Le.reportApiInvoke(null,{name:_n.PRELOAD,options:{success:aN,failed:cN,err:_}}).onError(m),aN=0,cN=0,hT.clear(),oN=null},Uae));const g=hT.get(m.code)||0;hT.set(m.code,g+1)}(h),h}}async function uN(e){try{if(D("AP_REQUEST_DETAIL")||D("ENABLE_ROLE_SELECT_EDGE"))return;const t=RB(e);if(!t||e.cloudProxyServer!=="disabled")return;const n=await async function(i,a){try{const c=await window.crypto.subtle.importKey("raw",uV(a),"AES-GCM",!1,["decrypt"]),d=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:bB},c,Mu(i));return JSON.parse(window.atob(ed(new Uint8Array(d))))}catch{return}}(t,e.token||e.appId);if(!n||!function(i,a){return i.cname===a.cname&&i.appId===a.appId&&i.token===a.token?a.stringUid?i.stringUid===a.stringUid:typeof a.uid=="number"?i.uid===a.uid:i.uid==a.uid:!1}(n,e))return;if(n&&Date.now()-n.ts<D("AP_CACHE_LIFETIME"))return n}catch(t){R.warn("Error get preloadInfo",t.message)}}function RB(e){let t;try{if(t=IB(mm),!t)return;const n=JSON.parse(t),i=AB(e),a=function(d,h){for(let m=d.length-1;m>=0;m--)if(h(d[m]))return m;return-1}(n,d=>i in d);if(a===-1)return;const c=n.splice(a,1)[0];return pT(mm,JSON.stringify(n)),c[i]}catch(n){R.warn("Error delete preload info: ".concat(t),n.message),pT(mm,"")}}async function hN(e){let t;try{e.uid&&RB({appId:e.appId,cname:e.cname,token:e.token,uid:e.uid,stringUid:e.stringUid});const n=AB(e),i=await async function(c,d){try{const h=await window.crypto.subtle.importKey("raw",uV(d),"AES-GCM",!1,["encrypt"]),m=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:bB},h,Mu(window.btoa(JSON.stringify(c))));return ed(new Uint8Array(m))}catch{return}}(e,e.token||e.appId);if(!i)return;t=IB(mm);const a=t?JSON.parse(t):[];a.push({[n]:i}),a.length>D("AP_CACHE_NUM")&&a.shift(),pT(mm,JSON.stringify(a))}catch(n){R.warn("Error caching server parameters:",n.message),pT(mm,"")}}function pN(e){if(e){let t=eh.get(e);t&&(window.clearTimeout(t),t=null,eh.delete(e)),ve(th).call(th,e)||e.cloudProxyServer!=="disabled"||th.push(e)}if(eh.size<D("AP_CACHE_NUM")&&th.length>0){const t=th.shift();eh.set(t,window.setTimeout(async()=>{const{appId:n,cname:i,token:a,stringUid:c,uid:d,proxyServer:h,role:m}=t;try{await jae(n,i,a,d,h,c,m),eh.has(t)&&pN(t)}catch(g){R.warn("update preload failed",g.message),wB(t)}},D("AP_UPDATE_INTERVAL")))}}function wB(e){const t=th.indexOf(e);t!==-1&&th.splice(t,1);let n=eh.get(e);n&&(window.clearTimeout(n),n=null,eh.delete(e),pN())}function CB(e,t){const n=e.sua,i=e.ap;t&&n&&Le.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),Le.reportResourceTiming(e.ap.url,e.sid),Le.joinWebProxyAP(e.sid,{lts:i.requestTime,elapse:i.elapse,sucess:1,apServerAddr:i.url,turnServerAddrList:i.proxyInfo.addresses.map(a=>a.ip).join(","),eventType:"disabled",unilbsServerIds:[qn.CHOOSE_SERVER,qn.CLOUD_PROXY_FALLBACK].toString()}),Le.joinChooseServer(e.sid,{lts:i.requestTime,elapse:i.elapse,succ:!0,csAddr:i.url,opid:i.opid,serverList:i.gatewayInfo.gatewayAddrs.map(a=>a.address),ec:null,cid:i.gatewayInfo.cid.toString(),uid:i.gatewayInfo.uid.toString(),csIp:i.gatewayInfo.csIp,unilbsServerIds:[qn.CHOOSE_SERVER].toString(),isHttp3:i.isHttp3})}function IB(e){return window.atob(window.localStorage.getItem(e)||"")}function pT(e,t){window.localStorage.setItem(e,window.btoa(t))}function AB(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),EV(t)}function Fae(e){let t=function(){const n=Wae.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,i){let a=n.appId;a!==void 0&&(Yn(i,10),ld(i,a));let c=n.cid;c!==void 0&&(Yn(i,16),Yn(i,c));let d=n.cname;d!==void 0&&(Yn(i,26),ld(i,d));let h=n.deviceId;h!==void 0&&(Yn(i,34),ld(i,h));let m=n.elapse;m!==void 0&&(Yn(i,40),dd(i,m));let g=n.fileSize;g!==void 0&&(Yn(i,48),dd(i,fm(g)));let _=n.height;_!==void 0&&(Yn(i,56),dd(i,fm(_)));let v=n.jpg;v!==void 0&&(Yn(i,66),Yn(i,v.length),xB(i,v));let y=n.networkType;y!==void 0&&(Yn(i,72),dd(i,fm(y)));let b=n.osType;b!==void 0&&(Yn(i,80),dd(i,fm(b)));let O=n.requestId;O!==void 0&&(Yn(i,90),ld(i,O));let I=n.sdkVersion;I!==void 0&&(Yn(i,98),ld(i,I));let N=n.sequence;N!==void 0&&(Yn(i,104),dd(i,fm(N)));let k=n.sid;k!==void 0&&(Yn(i,114),ld(i,k));let j=n.timestamp;j!==void 0&&(Yn(i,120),dd(i,j));let G=n.uid;G!==void 0&&(Yn(i,128),Yn(i,G));let K=n.vid;K!==void 0&&(Yn(i,136),Yn(i,K));let X=n.width;X!==void 0&&(Yn(i,144),dd(i,fm(X)));let z=n.service;z!==void 0&&(Yn(i,152),Yn(i,z));let ne=n.callbackData;ne!==void 0&&(Yn(i,162),Yn(i,ne.length),xB(i,ne));let me=n.ticket;me!==void 0&&(Yn(i,170),ld(i,me));let Ee=n.vendorConfigs;Ee!==void 0&&(Yn(i,178),ld(i,Ee))}(e,t),function(n){let i=n.bytes,a=n.limit;return i.length===a?i:i.subarray(0,a)}(t)}function Bae(e){return function(n){let i={};e:for(;!zae(n);){let a=r_(n);switch(a>>>3){case 0:break e;case 1:i.code=r_(n);break;case 2:i.msg=OB(n,r_(n));break;case 3:i.requestId=OB(n,r_(n));break;case 4:i.timestamp=Hae(n,!1);break;default:Gae(n,7&a)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}function Gae(e,t){switch(t){case 0:for(;128&Fo(e););break;case 2:mN(e,r_(e));break;case 5:mN(e,4);break;case 1:mN(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function fm(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let Wae=[];function mN(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function zae(e){return e.offset>=e.limit}function mT(e,t){let n=e.bytes,i=e.offset,a=e.limit,c=i+t;if(c>n.length){let d=new Uint8Array(2*c);d.set(n),e.bytes=d}return e.offset=c,c>a&&(e.limit=c),i}function NB(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function xB(e,t){let n=mT(e,t.length);e.bytes.set(t,n)}function OB(e,t){let n=NB(e,t),i=String.fromCharCode,a=e.bytes,c="",d="";for(let h=0;h<t;h++){let m,g,_,v,y=a[h+n];128&y?(224&y)==192?h+1>=t?d+=c:(m=a[h+n+1],(192&m)!=128?d+=c:(v=(31&y)<<6|63&m,v<128?d+=c:(d+=i(v),h++))):(240&y)==224?h+2>=t?d+=c:(m=a[h+n+1],g=a[h+n+2],(49344&(m|g<<8))!=32896?d+=c:(v=(15&y)<<12|(63&m)<<6|63&g,v<2048||v>=55296&&v<=57343?d+=c:(d+=i(v),h+=2))):(248&y)==240?h+3>=t?d+=c:(m=a[h+n+1],g=a[h+n+2],_=a[h+n+3],(12632256&(m|g<<8|_<<16))!=8421504?d+=c:(v=(7&y)<<18|(63&m)<<12|(63&g)<<6|63&_,v<65536||v>1114111?d+=c:(v-=65536,d+=i(55296+(v>>10),56320+(1023&v)),h+=3))):d+=c:d+=i(y)}return d}function ld(e,t){let n=t.length,i=0;for(let d=0;d<n;d++){let h=t.charCodeAt(d);h>=55296&&h<=56319&&d+1<n&&(h=(h<<10)+t.charCodeAt(++d)-56613888),i+=h<128?1:h<2048?2:h<65536?3:4}Yn(e,i);let a=mT(e,i),c=e.bytes;for(let d=0;d<n;d++){let h=t.charCodeAt(d);h>=55296&&h<=56319&&d+1<n&&(h=(h<<10)+t.charCodeAt(++d)-56613888),h<128?c[a++]=h:(h<2048?c[a++]=h>>6&31|192:(h<65536?c[a++]=h>>12&15|224:(c[a++]=h>>18&7|240,c[a++]=h>>12&63|128),c[a++]=h>>6&63|128),c[a++]=63&h|128)}}function Fo(e){return e.bytes[NB(e,1)]}function PB(e,t){let n=mT(e,1);e.bytes[n]=t}function r_(e){let t,n=0,i=0;do t=Fo(e),n<32&&(i|=(127&t)<<n),n+=7;while(128&t);return i}function Yn(e,t){for(t>>>=0;t>=128;)PB(e,127&t|128),t>>>=7;PB(e,t)}function Hae(e,t){let n,i=0,a=0,c=0;return n=Fo(e),i=127&n,128&n&&(n=Fo(e),i|=(127&n)<<7,128&n&&(n=Fo(e),i|=(127&n)<<14,128&n&&(n=Fo(e),i|=(127&n)<<21,128&n&&(n=Fo(e),a=127&n,128&n&&(n=Fo(e),a|=(127&n)<<7,128&n&&(n=Fo(e),a|=(127&n)<<14,128&n&&(n=Fo(e),a|=(127&n)<<21,128&n&&(n=Fo(e),c=127&n,128&n&&(n=Fo(e),c|=(127&n)<<7))))))))),{low:i|a<<28,high:a>>>4|c<<24,unsigned:t}}function dd(e,t){let n=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,a=t.high>>>24,c=a===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:a<128?9:10,d=mT(e,c),h=e.bytes;switch(c){case 10:h[d+9]=a>>>7&1;case 9:h[d+8]=c!==9?128|a:127&a;case 8:h[d+7]=c!==8?i>>>21|128:i>>>21&127;case 7:h[d+6]=c!==7?i>>>14|128:i>>>14&127;case 6:h[d+5]=c!==6?i>>>7|128:i>>>7&127;case 5:h[d+4]=c!==5?128|i:127&i;case 4:h[d+3]=c!==4?n>>>21|128:n>>>21&127;case 3:h[d+2]=c!==3?n>>>14|128:n>>>14&127;case 2:h[d+1]=c!==2?n>>>7|128:n>>>7&127;case 1:h[d]=c!==1?128|n:127&n}}const DB={},kB={},fT=4294967296,Kae=fT*fT,LB=Kae/2;UB(0,!0);const MB=UB(0),qae=i_(0,-2147483648,!1),Yae=i_(-1,2147483647,!1);function UB(e,t){let n,i,a;return t?(a=0<=(e>>>=0)&&e<256)&&(i=kB[e],i)?i:(n=i_(e,0,!0),a&&(kB[e]=n),n):(a=-128<=(e|=0)&&e<128)&&(i=DB[e],i)?i:(n=i_(e,e<0?-1:0,!1),a&&(DB[e]=n),n)}function i_(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function jB(e,t){if(isNaN(e))return MB;{if(e<=-LB)return qae;if(e+1>=LB)return Yae}return e<0?MB:i_(e%fT|0,e/fT|0,t)}function VB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}class fN extends Sn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(_a.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var n;super(),x(this,"name","AgoraRTCImageModeration"),x(this,"_connectionState",co.CONNECTING),x(this,"_sequence",0),x(this,"_moderationStartTime",void 0),x(this,"_workerConnection",void 0),x(this,"_workerMessageLengthLimit",void 0),x(this,"_qualityRatio",void 0),x(this,"_connectInfo",void 0),x(this,"_cancelTokenSource",Mi.CancelToken.source()),x(this,"_retryConfig",void 0),x(this,"_moderationInterval",void 0),x(this,"_moderationTimer",null),x(this,"_moderationMode",1),x(this,"_quality",1),x(this,"_qualityTimer",null),x(this,"_ticket",void 0),x(this,"_moderationIntervalMinimum",void 0),x(this,"_uploadFailedNum",0),x(this,"_uploadNum",0),x(this,"_uploadTimer",null),x(this,"_extraInfo",void 0),x(this,"_vendor",""),x(this,"_encoder",new TextEncoder),x(this,"_moderationId",void 0),x(this,"inspectImage",()=>{if(this.connectionState!==co.CONNECTED)throw new se(L.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===co.CONNECTED?this.requestToInspectImage():R.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Wt(5,"image-moderation-"),this._workerMessageLengthLimit=D("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=D("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=D("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Hg("worker-"+this._moderationId,Kn),this.on(_a.STATE_CHANGE,(i,a)=>{R.debug("[".concat(this._moderationId,"] Moderation operation :").concat(rm[i]," ").concat(a||""))}),this.handleWorkerEvents()}async init(t,n){this.emit(_a.STATE_CHANGE,rm.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=n,new we((a,c)=>{this.on(_a.CONNECTION_STATE_CHANGE,(d,h)=>{d===co.CONNECTED&&a()}),this.requestAP(t,i,n).then(d=>{this.connectWorker(d)}).catch(d=>{c(d)})})}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),R.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===co.CONNECTED&&this.inspectImage()}async requestAP(t,n,i){const a=D("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),c=await function(m,g,_,v){let{appId:y,areaCode:b,cname:O,sid:I,token:N,uid:k}=g;cm++;const j="moderation_plugin",G={service_name:j,json_body:JSON.stringify({appId:y,areaCode:b,cname:O,command:"allocateEdge",requestId:cm,seq:cm,sid:I,appToken:N,ts:Date.now(),uid:k+""})};let K,X,z=m[0];return pa(async()=>{K=Date.now();const ne=await va(z,{data:G,cancelToken:_,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(X=Date.now()-K,ne.code!==0){const qe=new se(L.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+ne.code,{retry:!0,responseTime:X});throw R.error(qe.toString()),qe}const me=JSON.parse(ne.json_body);if(me.code!==200){const qe=new se(L.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(me.code,", reason: ").concat(me.reason),{code:me.code,responseTime:X});throw R.error(qe.toString()),qe}if(!me.servers||!Array.isArray(me.servers)||me.servers.length===0){const qe=new se(L.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:me.code,responseTime:X});throw R.error(qe.toString()),qe}if(!me.servers.some(qe=>!!qe.wss)){const qe=new se(L.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:me.code,responseTime:X});throw R.error(qe.toString()),qe}const Ee=D("IMAGE_MODERATION_WORKER_WSS");if(Ee)return{addressList:[Ee],workerToken:me.workerToken,vid:me.vid,responseTime:X};const Oe=D("IMAGE_MODERATION_WORKER_HOST");return{addressList:me.servers.map(qe=>{let{address:dt,wss:at}=qe;if(dt&&at)return"wss://".concat(dt.replace(/\./g,"-"),".").concat(Oe,":").concat(at,"/moderation")}).filter(qe=>!!qe),workerToken:me.workerToken,vid:me.vid,ticket:me.appTicket,responseTime:X}},(ne,me)=>(Le.apworkerEvent(I,{success:!0,sc:200,serviceName:j,responseDetail:JSON.stringify(ne.addressList),firstSuccess:me===0,responseTime:X,serverIp:m[me%m.length]}),!1),(ne,me)=>(Le.apworkerEvent(I,{success:!1,sc:ne.data&&ne.data.code||200,serviceName:j,responseTime:X,serverIp:m[me%m.length]}),!!(ne.code!==L.OPERATION_ABORTED&&ne.code!==L.UNEXPECTED_RESPONSE||ne.data&&ne.data.retry)&&(z=m[(me+1)%m.length],!0)),v)}(a,t,n,i);this.emit(_a.STATE_CHANGE,rm.AP_CONNECTED);const{addressList:d,ticket:h}=c;return this._ticket=h,d}async connectWorker(t){this.emit(_a.STATE_CHANGE,rm.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(ct.CONNECTED,async()=>{this.emit(_a.STATE_CHANGE,rm.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=co.CONNECTED}),this._workerConnection.on(ct.CLOSED,()=>{this.connectionState=co.CLOSED}),this._workerConnection.on(ct.FAILED,()=>{this.connectionState=co.CLOSED}),this._workerConnection.on(ct.RECONNECTING,()=>{this.connectionState=this.connectionState===co.CONNECTED?co.RECONNECTING:co.CONNECTING}),this._workerConnection.on(ct.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const n=Bae(new Uint8Array(t.data));D("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,R.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Le.reportApiInvoke(this._connectInfo.sid||null,{name:_n.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:rn.TRACER}).onError(new se(L.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},D("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else R.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(ct.WILL_RECONNECT,(t,n,i)=>{t==="recover"&&i(t),i("tryNext")}),this._workerConnection.on(ct.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=Ss(this,_a.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(D("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("Only the track being played can be inspected"));this._sequence++;const i=await this.generateRequestData(t,n);this._workerConnection.sendMessage(i,!0,!0)}else D("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("Only the track being published can be inspected")}async generateRequestData(t,n){let{appId:i,cname:a,cid:c,vid:d,sid:h,uid:m}=n;const g=Date.now(),_=await t.getCurrentFrameImage("image/jpeg",this.quality),v=await lF(_,i,a),y=this._sequence+"-"+c+"-"+m+"-"+g+"-"+Wt(12,""),b={appId:i,cid:c,cname:a,deviceId:"",elapse:fN.intToLong(Number(g-this._moderationStartTime)),fileSize:_.buffer.byteLength,height:_.height,width:_.width,jpg:v,networkType:6,osType:7,requestId:y,sdkVersion:"4.24.2",sequence:this._sequence,sid:h,timestamp:jB(g),uid:m,vid:d,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete b.callbackData;const O=Fae(b);if(O.byteLength<this._workerMessageLengthLimit){if(D("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const I=function(N){for(var k=1;k<arguments.length;k++){var j=arguments[k]!=null?arguments[k]:{};k%2?VB(Object(j),!0).forEach(function(G){x(N,G,j[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(j)):VB(Object(j)).forEach(function(G){Object.defineProperty(N,G,Object.getOwnPropertyDescriptor(j,G))})}return N}({},b);delete I.jpg,R.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(I))}return O}{const I=this.quality*this._qualityRatio;return this.quality=I,await this.generateRequestData(t,{appId:i,cname:a,cid:c,vid:d,sid:h,uid:m})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Mi.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=co.CLOSED,this.emit(_a.STATE_CHANGE,rm.CLOSED)}}function FB(e){if(nn(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new se(L.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new se(L.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const Xae={name:"ImageModeration",create:function(e){let{config:t}=e;return FB(t),new fN(t)}};var BB,GB,WB,zB,HB,KB,qB,YB,XB,JB,QB,$B,ZB,e5,t5,n5,r5,i5,s5,o5,a5,c5,l5,d5,u5,h5,p5,m5,f5,g5,_5,E5,v5,y5,S5,T5,b5,R5,w5,C5,I5,A5,Pe;function N5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function Bo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?N5(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N5(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}Cr.setLogger(R);let Jae=(BB=He(),GB=He({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof Xp))return[t];t=[t]}return t.map(n=>n?Object(n).toString():"null")}}),WB=He({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==Yp.DATA?(Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId())):[t.getChannelId()])}),zB=He({argsMap:(e,t,n,i)=>[typeof t=="object"?t.uid:t,n,i]}),HB=He({argsMap:(e,t,n)=>[t,n]}),KB=He({argsMap:(e,t)=>t.map(n=>{let{user:i,mediaType:a}=n;return[i==null?void 0:i.uid,a]})}),qB=He({argsMap:(e,t,n,i)=>[typeof t=="object"?t.uid:t,n,i]}),YB=He({argsMap:(e,t)=>t.map(n=>{let{user:i,mediaType:a}=n;return{uid:i==null?void 0:i.uid,mediaType:a}})}),XB=He(),JB=He(),QB=He(),$B=He(),ZB=He(),e5=He(),t5=He(),n5=He(),r5=He(),i5=He(),s5=He(),o5=He(),a5=He(),c5=He(),l5=He(),d5=He(),u5=He({argsMap:(e,t)=>[t]}),h5=He(),p5=He(),m5=He(),f5=He(),g5=He(),_5=He(),E5=He(),v5=He(),y5=He({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),S5=He(),T5=He(),b5=He(),R5=He(),w5=He(),C5=He(),I5=He({reportResult:!0}),A5=He(),Pe=class extends Sn{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),x(this,"store",void 0),x(this,"_uid",void 0),x(this,"_channelName",void 0),x(this,"_uintUid",void 0),x(this,"_users",[]),x(this,"_config",void 0),x(this,"_clientId",void 0),x(this,"_appId",void 0),x(this,"_sessionId",null),x(this,"_key",void 0),x(this,"_rtmConfig",{}),x(this,"_joinInfo",void 0),x(this,"_gateway",void 0),x(this,"_statsCollector",void 0),x(this,"_configDistribute",void 0),x(this,"_leaveMutex",void 0),x(this,"_publishMutex",void 0),x(this,"_renewTokenMutex",void 0),x(this,"_subscribeMutex",void 0),x(this,"_encryptionMode","none"),x(this,"_encryptionSecret",null),x(this,"_encryptionSalt",null),x(this,"_encryptDataStream",!1),x(this,"_encryptDataStreamKey",null),x(this,"_encryptDataStreamIv",null),x(this,"_proxyServer",void 0),x(this,"_turnServer",{servers:[],mode:"auto"}),x(this,"_cloudProxyServerMode","disabled"),x(this,"_isDualStreamEnabled",!1),x(this,"_defaultStreamFallbackType",void 0),x(this,"_lowStreamParameter",void 0),x(this,"_streamFallbackTypeCacheMap",new Map),x(this,"_remoteStreamTypeCacheMap",new Map),x(this,"_axiosCancelSource",Mi.CancelToken.source()),x(this,"_audioVolumeIndicationInterval",void 0),x(this,"_networkQualityInterval",void 0),x(this,"_userOfflineTimeout",void 0),x(this,"_streamRemovedTimeout",void 0),x(this,"_rteDetailInterval",void 0),x(this,"_liveTranscodeStreamingClient",void 0),x(this,"_liveRawStreamingClient",void 0),x(this,"_channelMediaRelayClient",void 0),x(this,"_networkQualitySensitivity","normal"),x(this,"_p2pChannel",void 0),x(this,"_useLocalAccessPoint",!1),x(this,"_setLocalAPVersion",void 0),x(this,"_joinAndNotLeaveYet",!1),x(this,"_numberOfJoinCount",0),x(this,"_joinResponse",null),x(this,"_remoteDefaultVideoStreamType",void 0),x(this,"_inspect",void 0),x(this,"_moderation",void 0),x(this,"_license",void 0),x(this,"_pendingPublishedUsers",[]),x(this,"ntpAlignErrorCount",0),x(this,"remoteInboundOffset",0),x(this,"_peerConnectionState",void 0),x(this,"_pendingRtpCapabilityChange",void 0),x(this,"_fallbackServerInfo",void 0),x(this,"_dualStreamMode",void 0),x(this,"_handleLocalTrackEnable",(a,c,d)=>{this.publish(a,!1).then(c).catch(d)}),x(this,"_handleLocalTrackDisable",(a,c,d)=>{this.unpublish(a).then(c).catch(d)}),x(this,"_handleUserOnline",a=>{if(D("BLOCK_LOCAL_CLIENT")&&qu(a.uid,this.channelName))return void R.debug("[".concat(a.uid,"] will be ignored in local"));this.isStringUID&&typeof a.uid!="string"&&R.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const c=this._users.find(d=>d.uid===a.uid);if(c)c._trust_in_room_=!0,c._is_pre_created&&(c._is_pre_created=!1,this.safeEmit(ft.USER_JOINED,c));else{const d=new ad(a.uid,a.uint_id||a.uid);this._users.push(d),R.debug("[".concat(this._clientId,"] user online"),a.uid),this.store.firstVideoFrameDecoded(d.uid,{userJoinNotify:Date.now()}),this.safeEmit(ft.USER_JOINED,d)}}),x(this,"_handleUserOffline",a=>{if(D("BLOCK_LOCAL_CLIENT")&&qu(a.uid,this.channelName))return;const c=this._users.find(d=>d.uid===a.uid);c&&(this._handleRemoveStream(a),this._handleRemoveDataChannels(a),c._audio_pre_subscribed||c._video_pre_subscribed?c._is_pre_created=!0:pS(this._users,c),this._remoteStreamTypeCacheMap.delete(c.uid),this._streamFallbackTypeCacheMap.delete(c.uid),R.debug("[".concat(this._clientId,"] user offline"),a.uid,"reason:",a.reason),this.safeEmit(ft.USER_LEAVED,c,a.reason))}),x(this,"_handleAddAudioOrVideoStream",(a,c,d,h,m,g,_,v)=>{if(D("BLOCK_LOCAL_CLIENT")&&qu(c,this.channelName))return;const y=this._users.find(I=>I.uid===c);if(!y)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug("[".concat(this._clientId,"] stream added with uid ").concat(c,", type ").concat(a)),this.store.subscribe(y.uid,a,void 0,void 0,void 0,Date.now()),a==="video"&&this.store.firstVideoFrameDecoded(y.uid,{videoAddNotify:Date.now()});const b=a==="audio"?y.hasAudio:y.hasVideo;y._uintid||(y._uintid=g||c),a==="audio"?y._trust_audio_stream_added_state_=!0:y._trust_video_stream_added_state_=!0,a==="audio"?(y._audio_added_=!0,d!==void 0&&(y._audioSSRC=d),h!==void 0&&(y._cname=h),_&&(y._audioOrtc=_)):(y._video_added_=!0,d!==void 0&&(y._videoSSRC=d),h!==void 0&&(y._cname=h),v!==void 0&&(y._rtxSsrcId=v),_&&(y._videoOrtc=_)),(a==="audio"?y.hasAudio:y.hasVideo)&&!b&&(R.info("[".concat(this._clientId,"] remote user ").concat(y.uid," published ").concat(a)),this.safeEmit(ft.USER_PUBLISHED,y,a)),a==="video"?Le.onGatewayStream(this._sessionId,ir.ON_ADD_VIDEO_STREAM,En.ON_ADD_VIDEO_STREAM,{peer:g||c,ssrc:y._videoSSRC}):Le.onGatewayStream(this._sessionId,ir.ON_ADD_AUDIO_STREAM,En.ON_ADD_AUDIO_STREAM,{peer:g||c,ssrc:y._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(y,a,d).then(I=>{if(I&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(a," for user ").concat(y.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Zu))return this._p2pChannel.unsubscribe(y,a,!0).then(()=>this._subscribe(y,a,!0).catch(N=>{R.error("[".concat(this._clientId,"] resubscribe error"),N.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(y,a)&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(a," for user ").concat(y.uid," after reconnect.")),this._subscribe(y,a,!0).catch(I=>{R.error("[".concat(this._clientId,"] resubscribe error"),I.toString())}));const O=this._getEncodingName(m);a==="video"&&(O==="unknown"?this.safeEmit(ft.AV1_DECODABLE_RESULT,!1):wr()||ni()||(O==null?void 0:O.toLocaleLowerCase())!==Vu.av1||vae().then(I=>{D("FLS_ENABLE_AV1_DECODE_DETECT")&&this.safeEmit(ft.AV1_DECODABLE_RESULT,I),I||this._gateway.downgradeCodec(O)}))}),x(this,"_handleRemoveStream",a=>{if(D("BLOCK_LOCAL_CLIENT")&&qu(a.uid,this.channelName))return;const c=this._users.find(h=>h.uid===a.uid);if(!c)return void R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));R.debug("[".concat(this._clientId,"] stream removed with uid ").concat(a.uid));let d=()=>{};c.hasAudio&&c.hasVideo?d=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(c.uid," unpublished audio track")),this.safeEmit(ft.USER_UNPUBLISHED,c,"audio"),R.info("[".concat(this._clientId,"] remote user ").concat(c.uid," unpublished video track")),this.safeEmit(ft.USER_UNPUBLISHED,c,"video")}:c.hasVideo?d=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(c.uid," unpublished video track")),this.safeEmit(ft.USER_UNPUBLISHED,c,"video")}:c.hasAudio&&(d=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(c.uid," unpublished audio track")),this.safeEmit(ft.USER_UNPUBLISHED,c,"audio")}),c._video_pre_subscribed||c._audio_pre_subscribed||(c._trust_audio_stream_added_state_=!0,c._trust_video_stream_added_state_=!0,c._audio_added_=!1,c._video_added_=!1,this._p2pChannel instanceof Zu&&this._p2pChannel.unsubscribe(c).then(h=>{if(h)return this._gateway.unsubscribe(h,c.uid)}),c._audioSSRC=void 0,c._videoSSRC=void 0,c._audioOrtc=void 0,c._videoOrtc=void 0,c._rtxSsrcId=void 0),Le.onGatewayStream(this._sessionId,ir.ON_REMOVE_STREAM,En.ON_REMOVE_STREAM,{peer:a.uint_id||a.uid}),d()}),x(this,"_handleSetStreamLocalEnable",(a,c,d)=>{if(D("BLOCK_LOCAL_CLIENT")&&qu(c,this.channelName))return;const h=this._users.find(_=>_.uid===c);if(!h)return void R.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));R.debug("[".concat(this._clientId,"] local ").concat(a," ").concat(d?"enabled":"disabled"," with uid ").concat(c));const m=a==="audio"?h.hasAudio:h.hasVideo;if(a==="audio"){h._trust_audio_enabled_state_=!0;const _=h._audio_enabled_;if(h._audio_enabled_=d,h._audio_enabled_===_)return;{const v=h._audio_enabled_?"enable-local-audio":"disable-local-audio";R.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(c,", msg: ").concat(v)),this.safeEmit(ft.USER_INFO_UPDATED,c,v)}}else{h._trust_video_enabled_state_=!0;const _=h._video_enabled_;if(h._video_enabled_=d,h._video_enabled_===_)return;{const v=h._video_enabled_?"enable-local-video":"disable-local-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(v)),this.safeEmit(ft.USER_INFO_UPDATED,c,v)}}const g=a==="audio"?h.hasAudio:h.hasVideo;return m!==g?!m&&g?(R.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(a)),void this.safeEmit(ft.USER_PUBLISHED,h,a)):(a==="video"&&h._videoTrack&&h._videoTrack._destroy(),a==="audio"&&h._audioTrack,this._p2pChannel.muteRemote(h,a),R.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(a)),void this.safeEmit(ft.USER_UNPUBLISHED,h,a)):void 0}),x(this,"_handleMuteStream",(a,c,d)=>{if(D("BLOCK_LOCAL_CLIENT")&&qu(a,this.channelName))return;R.debug("[".concat(this._clientId,"] receive mute message"),a,c,d);const h=this._users.find(_=>_.uid===a);if(!h)return void R.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(a));const m=c==="audio"?h.hasAudio:h.hasVideo;if(c==="audio"){h._trust_audio_mute_state_=!0;const _=h._audio_muted_;if(h._audio_muted_=d,h._audio_muted_===_)return;{const v=h._audio_muted_?"mute-audio":"unmute-audio";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(a,", msg: ").concat(v)),this.safeEmit(ft.USER_INFO_UPDATED,a,v)}}else{h._trust_video_mute_state_=!0;const _=h._video_muted_;if(h._video_muted_=d,h._video_muted_===_)return;{const v=h._video_muted_?"mute-video":"unmute-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(a,", msg: ").concat(v)),this.safeEmit(ft.USER_INFO_UPDATED,a,v)}}const g=c==="audio"?h.hasAudio:h.hasVideo;if(m!==g){if(!m&&g)return(c==="audio"?h._audioSSRC:h._videoSSRC)?(R.info("[".concat(this._clientId,"] remote user ").concat(a," published ").concat(c)),void this.safeEmit(ft.USER_PUBLISHED,h,c)):void R.warning("[".concat(this._clientId,"] remote user ").concat(a," receive ").concat(c," unmute message  before add stream message, ").concat(c," SSRC doesn't exist yet."));c==="video"&&h._videoTrack&&!h._video_pre_subscribed&&h._videoTrack._destroy(),c==="audio"&&h._audioTrack,this._p2pChannel.muteRemote(h,c),R.info("[".concat(this._clientId,"] remote user ").concat(a," unpublished ").concat(c)),this.safeEmit(ft.USER_UNPUBLISHED,h,c)}}),x(this,"_handleP2PLost",async a=>{R.debug("[".concat(this._clientId,"] receive p2p lost"),a),parseInt(a.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():R.warning("[".concat(this._clientId,"] P2PLost stream not found"),a)}),x(this,"_handleTokenWillExpire",()=>{R.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(ft.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),x(this,"_handleBeforeUnload",a=>{a.type==="beforeunload"&&a.returnValue!==void 0&&a.returnValue!==""||(this.leave(),R.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),x(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(ft.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const a={downlinkNetworkQuality:0,uplinkNetworkQuality:0};a.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),a.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(ft.NETWORK_QUALITY,a)}),x(this,"_handleP2PAddAudioOrVideoStream",(a,c,d,h)=>{const m=this._users.find(_=>_.uid===c);if(!m)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug("[".concat(this._clientId,"] stream added with uid ").concat(c,", type ").concat(a)),this.store.subscribe(m.uid,a,void 0,void 0,void 0,Date.now());const g=a==="audio"?m.hasAudio:m.hasVideo;a==="audio"?m._trust_audio_stream_added_state_=!0:m._trust_video_stream_added_state_=!0,a==="audio"?(m._audio_added_=!0,d!==void 0&&(m._audioSSRC=d),h!==void 0&&(m._audioMid=h)):(m._video_added_=!0,d!==void 0&&(m._videoSSRC=d),h!==void 0&&(m._videoMid=h)),(a==="audio"?m.hasAudio:m.hasVideo)&&!g&&(R.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published ").concat(a)),this.safeEmit(ft.USER_PUBLISHED,m,a)),this._p2pChannel.hasPendingRemoteMedia(m,a)&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(a," for user ").concat(m.uid," after reconnect.")),this._subscribe(m,a,!0).catch(_=>{R.error("[".concat(this._clientId,"] resubscribe error"),_.toString())}))}),this._config=e,this._clientId=t||Wt(5,"client-"),this.store=new class{constructor(a,c,d,h,m){rt(this,"state",void 0),this.state={codec:a,audioCodec:c,mode:d,clientId:h,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:ju.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,rteUrl:void 0,rteSid:void 0,autoSubscribe:!1,enableInstantMuteRestore:!1,networkQualityProbe:!1,useDcSignal:!!m}}dispatch(a){this.state=function(c,d){switch(d.type){case $e.SET_SESSION_ID:return be(be({},c),{},{sessionId:d.sessionId});case $e.SET_P2P_ID:return be(be({},c),{},{p2pId:d.p2pId});case $e.SET_UID:return be(be({},c),{},{uid:d.uid});case $e.SET_INT_UID:return be(be({},c),{},{intUid:d.intUid});case $e.SET_PUB_ID:return be(be({},c),{},{pubId:d.pubId});case $e.KEY_METRIC_CLIENT_CREATED:return be(be({},c),{},{keyMetrics:be(be({},c.keyMetrics),{},{clientCreated:d.metric})});case $e.KEY_METRIC_JOIN_START:return be(be({},c),{},{keyMetrics:be(be({},c.keyMetrics),{},{joinStart:d.metric})});case $e.KEY_METRIC_PRELOAD_START:return be(be({},c),{},{keyMetrics:be(be({},c.keyMetrics),{},{preloadStart:d.metric})});case $e.KEY_METRIC_PRELOAD_END:return be(be({},c),{},{keyMetrics:be(be({},c.keyMetrics),{},{preloadEnd:d.metric})});case $e.KEY_METRIC_JOIN_END:return be(be({},c),{},{keyMetrics:be(be({},c.keyMetrics),{},{joinEnd:d.metric})});case $e.KEY_METRIC_REQUEST_AP_START:return be(be({},c),{},{keyMetrics:be(be({},c.keyMetrics),{},{requestAPStart:d.metric})});case $e.KEY_METRIC_REQUEST_AP_END:return be(be({},c),{},{keyMetrics:be(be({},c.keyMetrics),{},{requestAPEnd:d.metric})});case $e.KEY_METRIC_REQUEST_SUA_END:return be(be({},c),{},{keyMetrics:be(be({},c.keyMetrics),{},{requestSUAEnd:d.metric})});case $e.KEY_METRIC_BEFORE_CONNECT:return be(be({},c),{},{keyMetrics:be(be({},c.keyMetrics),{},{beforeConnect:d.metric})});case $e.KEY_METRIC_PEER_RECEIVER:return be(be({},c),{},{keyMetrics:be(be({},c.keyMetrics),{},{peerReceiver:d.metric})});case $e.KEY_METRIC_SIGNAL_CONNECTED:return be(be({},c),{},{keyMetrics:be(be({},c.keyMetrics),{},{signalConnected:d.metric})});case $e.KEY_METRIC_JOIN_REQ:return be(be({},c),{},{keyMetrics:be(be({},c.keyMetrics),{},{joinReq:d.metric})});case $e.KEY_METRIC_JOIN_REP:return be(be({},c),{},{keyMetrics:be(be({},c.keyMetrics),{},{joinRep:d.metric})});case $e.KEY_METRIC_JOIN_GATEWAY_START:return be(be({},c),{},{keyMetrics:be(be({},c.keyMetrics),{},{joinGatewayStart:d.metric})});case $e.KEY_METRIC_JOIN_GATEWAY_END:return be(be({},c),{},{keyMetrics:be(be({},c.keyMetrics),{},{joinGatewayEnd:d.metric})});case $e.KEY_METRIC_PEER_CONNECTION_START:return be(be({},c),{},{keyMetrics:be(be({},c.keyMetrics),{},{peerConnectionStart:d.metric})});case $e.KEY_METRIC_PEER_CONNECTION_END:return be(be({},c),{},{keyMetrics:be(be({},c.keyMetrics),{},{peerConnectionEnd:d.metric})});case $e.KEY_METRIC_DESCRIPTION_START:return be(be({},c),{},{keyMetrics:be(be({},c.keyMetrics),{},{descriptionStart:d.metric})});case $e.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return be(be({},c),{},{keyMetrics:be(be({},c.keyMetrics),{},{signalChannelOpen:d.metric})});case $e.KEY_METRIC_ICE_CONNECTION_END:return be(be({},c),{},{keyMetrics:be(be({},c.keyMetrics),{},{iceConnectionEnd:d.metric})});case $e.KEY_METRIC_PUBLISH:{const h=c.keyMetrics.publish,m=h.findIndex(g=>g.trackId===d.metric.trackId);return m!==-1?(h[m]=be(be({},h[m]),d.metric),be(be({},c),{},{keyMetrics:be(be({},c.keyMetrics),{},{publish:[...h]})})):be(be({},c),{},{keyMetrics:be(be({},c.keyMetrics),{},{publish:[...c.keyMetrics.publish,d.metric]})})}case $e.KEY_METRIC_SUBSCRIBE:{const h=c.keyMetrics.subscribe,m=h.findIndex(g=>g.userId===d.metric.userId&&g.type===d.metric.type);return m!==-1?(h[m]=be(be({},h[m]),d.metric),be(be({},c),{},{keyMetrics:be(be({},c.keyMetrics),{},{subscribe:[...h]})})):be(be({},c),{},{keyMetrics:be(be({},c.keyMetrics),{},{subscribe:[...c.keyMetrics.subscribe,d.metric]})})}case $e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const h=c.keyMetrics.firstVideoFrameDecoded,m=h.findIndex(g=>g.userId===d.metric.userId);return m!==-1?(h[m]=be(be({},h[m]),d.metric),be(be({},c),{},{keyMetrics:be(be({},c.keyMetrics),{},{firstVideoFrameDecoded:[...h]})})):be(be({},c),{},{keyMetrics:be(be({},c.keyMetrics),{},{firstVideoFrameDecoded:[...c.keyMetrics.firstVideoFrameDecoded,d.metric]})})}case $e.RESET_FIRST_VIDEO_FRAME_DECODED:return c.keyMetrics.firstVideoFrameDecoded=[],c;case $e.SET_CLOUD_PROXY_SERVER_MODE:return c.cloudProxyServerMode=d.mode,c;case $e.RECORD_JOIN_CHANNEL_SERVICE:return typeof d.index!="number"?c.joinChannelServiceRecords=[...c.joinChannelServiceRecords,d.record]:(c.joinChannelServiceRecords[d.index]=be(be({},c.joinChannelServiceRecords[d.index]),d.record),c.joinChannelServiceRecords=[...c.joinChannelServiceRecords]),c;case $e.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return c.joinChannelServiceRecords=[],c;case $e.RESET_KEY_METRICS:return c.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},c;case $e.SET_USE_P2P:return be(be({},c),{},{useP2P:d.val});case $e.SET_TRANSPORT_TYPE:return be(be({},c),{},{p2pTransport:d.val});case $e.SET_RTE_URL:return be(be({},c),{},{rteUrl:d.rteUrl});case $e.SET_RTE_SID:return be(be({},c),{},{rteSid:d.rteSid});default:return c}}(this.state,a)}get useDcSignal(){return this.state.useDcSignal}set useDcSignal(a){this.state.useDcSignal=a}set autoSubscribe(a){this.state.autoSubscribe=a}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(a){this.state.enableInstantMuteRestore=a}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set networkQualityProbe(a){this.state.networkQualityProbe=a}get networkQualityProbe(){return this.state.networkQualityProbe}set sessionId(a){this.dispatch({type:$e.SET_SESSION_ID,sessionId:a})}get sessionId(){return this.state.sessionId}set rteUrl(a){this.dispatch({type:$e.SET_RTE_URL,rteUrl:a})}get rteUrl(){return this.state.rteUrl}set rteSid(a){this.dispatch({type:$e.SET_RTE_SID,rteSid:a})}get rteSid(){return this.state.rteSid}set cid(a){this.state.cid=a}get cid(){return this.state.cid}set codec(a){this.state.codec=a}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(a){this.dispatch({type:$e.SET_P2P_ID,p2pId:a})}get p2pId(){return this.state.p2pId}set dcId(a){this.dispatch({type:$e.SET_DC_ID,dcId:a})}get dcId(){return this.state.dcId}set uid(a){this.dispatch({type:$e.SET_UID,uid:a})}get uid(){return this.state.uid}set intUid(a){this.dispatch({type:$e.SET_INT_UID,intUid:a})}get intUid(){return this.state.intUid}set pubId(a){this.dispatch({type:$e.SET_PUB_ID,pubId:a})}get pubId(){return this.state.pubId}set cloudProxyServerMode(a){this.dispatch({type:$e.SET_CLOUD_PROXY_SERVER_MODE,mode:a})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(a){this.dispatch({type:$e.SET_USE_P2P,val:a})}get useP2P(){return this.state.useP2P}set p2pTransport(a){this.dispatch({type:$e.SET_TRANSPORT_TYPE,val:a})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(a){this.state.hasStartJoinChannel=a}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(a){this.state.isABTestSuccess=a}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:$e.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:$e.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:$e.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:$e.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:$e.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:$e.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:$e.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:$e.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:$e.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:$e.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:$e.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:$e.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:$e.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:$e.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:$e.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:$e.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:$e.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(a,c){this.dispatch({type:$e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:be({userId:a},c)})}descriptionStart(){this.dispatch({type:$e.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:$e.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:$e.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(a,c,d,h){this.dispatch({type:$e.KEY_METRIC_PUBLISH,metric:be(be({trackId:a,type:c},d&&{publishStart:d}),h&&{publishEnd:h})})}subscribe(a,c,d,h,m,g,_){this.dispatch({type:$e.KEY_METRIC_SUBSCRIBE,metric:be(be(be(be(be({userId:a,type:c},d&&{subscribeStart:d}),h&&{subscribeEnd:h}),m&&{firstFrame:m}),g&&{streamAdded:g}),_&&{firstDecoded:_})})}massSubscribe(a,c,d,h){a.forEach(m=>{this.dispatch({type:$e.KEY_METRIC_SUBSCRIBE,metric:be(be(be({userId:m.userId,type:m.type},c&&{subscribeStart:c}),d&&{subscribeEnd:d}),h&&{firstFrame:h})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(a,c){a.service==="gateway"&&Array.isArray(a.urls)&&(a.urls=a.urls.map(d=>d.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof c!="number"?(this.dispatch({type:$e.RECORD_JOIN_CHANNEL_SERVICE,record:be(be({},a),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(c<0||c>=this.state.joinChannelServiceRecords.length||this.dispatch({type:$e.RECORD_JOIN_CHANNEL_SERVICE,record:a,index:c}),c)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:$e.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:$e.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:$e.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId,D("SIGNAL_CHANNEL")===1),this._leaveMutex=new Cr("client-leave",this._clientId),this._publishMutex=new Cr("client-publish",this._clientId),this._renewTokenMutex=new Cr("client-renewtoken",this._clientId),this._subscribeMutex=new Cr("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),R.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(ro," build: ").concat(zI,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{NI(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(a){R.warning("[".concat(this._clientId,"] ").concat(a.toString()))}var i;this._statsCollector=new e_(this.store),this._statsCollector.onStatsException=(a,c,d)=>{R.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(a,", msg: ").concat(c,", uid: ").concat(d)),a===YA.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(h=>{h instanceof xS&&D("ENABLE_ENCODE_EXCEPTION")&&h.findClosestProfile()}),this.safeEmit(ft.EXCEPTION,{code:a,msg:c,uid:d})},this._statsCollector.onUploadPublishDuration=(a,c,d,h)=>{const m=this._users.find(g=>g.uid===a);m&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(m.uid,{peerPublishDuration:d,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(m)),Le.peerPublishStatus(this._sessionId,{subscribeElapse:h,audioPublishDuration:c,videoPublishDuration:d,peer:m._uintid}))},this._statsCollector.onVideoCodecChanged=a=>{if(D("VIDEO_STANDARD_BITRATE_VERSION")&&(a==="av1"||a==="h265"||a==="h264")){const c=this.localTracks.find(d=>d instanceof sn);c&&c._saveEncodeBitrateRatio!==1&&c.setSaveEncodeBitrateRatio(a==="h264"?D("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new pae(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Kn,httpRetryConfig:e.httpRetryConfig||Kn,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new Rae(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(i={store:this.store,statsCollector:this._statsCollector},Ea("P2PChannel").create(i)),this._handleP2PEvents()):this._p2pChannel=new Zu(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,i,a){let c=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],d=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Zt("JOIN_GATEWAY_USE_443PORT_ONLY",c),Zt("JOIN_GATEWAY_USE_DUAL_DOMAIN",d);const h=this._gateway.signal.websocket;return h instanceof NA&&(h.use443PortOnly=c,h.tryDoubleDomain=d),async function(m,g,_){lS.get(m)||lS.set(m,[]),dS.get(m)||dS.set(m,g),tc.get(m)||tc.set(m,0);const v=lS.get(m),y=dS.get(m);if(!v||!y)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(tc.get(m)===y){const k=Pg();v.push(k),await k.promise}tc.set(m,tc.get(m)+1);for(var b=arguments.length,O=new Array(b>3?b-3:0),I=3;I<b;I++)O[I-3]=arguments[I];const N=await _(...O);return tc.set(m,tc.get(m)-1),tc.get(m)===y-1&&v.length>0&&(v[0].resolve(),v.shift()),tc.get(m)===0&&(lS.set(m,[]),dS.set(m,0),tc.set(m,0)),N}("client.join",D("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,i,a)}async join(e,t,n,i,a){const c=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);const d=(gS||gS||(gS=(window.location.protocol.split(":")[0]||"").toUpperCase(),gS))==="HTTPS",h=yV()?window.isSecureContext:"Browser Not Support";(!yV()&&!d||!window.isSecureContext)&&R.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let m;Le.setAppId(e);try{if(!n&&n!==null)throw new se(L.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));if(n&&Lr(n,"token",1,2047),Lr(e,"appid",1,2047),BS(t),i&&GS(i),a)if(typeof a=="string")Lr(a,"optionalInfo",1,256),m=a;else{if(typeof a!="object")throw new se(L.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:N,enableInstantMuteRestore:k,networkQualityProbe:j}=a;N&&(Oo(N,"autoSubscribe"),R.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(N)),this.store.autoSubscribe=N),k&&(Oo(k,"enableInstantMuteRestore"),R.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(k)),this.store.enableInstantMuteRestore=k),j&&(Oo(j,"networkQualityProbe"),R.info("[".concat(this._clientId,"] join: networkQualityProbe: ").concat(j)),this.store.networkQualityProbe=j)}}}catch(N){throw Le.reportApiInvoke(Uu(),{name:_n.JOIN,options:[e,t,n,i],states:{isHttps:d,isSecureContext:h},tag:rn.TRACER}).onError(N),N}if(this._leaveMutex.isLocked&&(R.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),R.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const N=new se(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Le.reportApiInvoke(Uu(),{name:_n.JOIN,options:[e,t,n,i],states:{isHttps:d,isSecureContext:h},tag:rn.TRACER}).onError(N),N}this._gateway.state="CONNECTING",this.store.preloadStart();const g=await uN({appId:e,cname:t,uid:i,stringUid:typeof i=="string"?i:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new se(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const _=(g==null?void 0:g.sid)||Uu();R.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(c)),this._sessionId||(this._sessionId=_,this.store.sessionId=this._sessionId);const v=Le.reportApiInvoke(this._sessionId,{id:this._clientId,name:_n.JOIN,options:[e,t,n,i],states:{isHttps:d,isSecureContext:h},tag:rn.TRACER}),y=Bo(Bo(Bo({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof i!="string"?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:m,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!g},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:D("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(y.setLocalAPVersion=this._setLocalAPVersion),typeof i=="string"&&(y.stringUid=i,this._uintUid?(y.uid=this._uintUid,this._uintUid=void 0):y.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(y.aesmode=this._encryptionMode,y.aespassword=await(async N=>{const k=function(X){const z=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),ne=new Uint8Array(new ArrayBuffer(z.length));for(let me=0;me<z.length;me+=1)ne[me]=z.charCodeAt(me);return ne}(),j=await window.crypto.subtle.importKey("spki",k,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),G=II(N),K=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},j,G);return function(X){let z="";for(let ne=0;ne<X.length;ne+=1)z+=String.fromCharCode(X[ne]);return window.btoa(z)}(new Uint8Array(K))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new se(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(y.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const N=new TextEncoder,k=D("USE_PURE_ENCRYPTION_MASTER_KEY")?N.encode(y.appId+this._encryptionSecret+this._encryptionSecret):N.encode(y.appId+y.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(j,G,K){const X=await window.crypto.subtle.importKey("raw",G,"PBKDF2",!1,["deriveBits","deriveKey"]),z=j==="aes-128-gcm2"?128:256,ne=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:xV,hash:"SHA-256",salt:K},X,z+Hse);return new Uint8Array(ne).subarray(z/8)}(this._encryptionMode,k,Mu(this._encryptionSalt)),this._encryptDataStreamKey=await async function(j,G,K){const X=await window.crypto.subtle.importKey("raw",G,"PBKDF2",!1,["deriveBits","deriveKey"]),z=j==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:xV,hash:"SHA-256",salt:K},X,{name:"AES-GCM",length:z},!0,["encrypt","decrypt"])}(this._encryptionMode,k,Mu(this._encryptionSalt))}else h?R.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):R.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,R.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:y.stringUid});const b=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&b===this._sessionId&&Le.joinChannelTimeout(this._sessionId,5)},5e3);try{var O;let N;const k=y.cloudProxyServer;if(ve(O=["proxy3","proxy4","proxy5"]).call(O,k)){const z=D("PROXY_SERVER_TYPE3");Array.isArray(z)?y.proxyServer=z[0]:y.proxyServer=z}if(Le.setProxyServer(y.proxyServer),R.setProxyServer(y.proxyServer),this.store.requestAPStart(),g){if(R.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(y.stringUid?", ".concat(y.stringUid," => ").concat(g.intUid):""," ")),y.stringUid&&!y.uid&&(y.uid=g.intUid),N={gatewayInfo:g.ap.gatewayInfo},D("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&y.turnServer.mode==="auto")if(g.ap.proxyInfo.addresses.length===0)R.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const z=(await E3(g.ap.proxyInfo,g.ap.gatewayInfo.uid)).map(ne=>({turnServerURL:ne.address,tcpport:ne.tcpport||zr.tcpport,udpport:ne.udpport||zr.udpport,username:ne.username||zr.username,password:ne.password||zr.password,forceturn:!1,security:!0}));y.turnServer={mode:"manual",servers:z}}CB(g,y.stringUid)}else{if(y.stringUid&&!y.uid){let z;[z,N]=await we.all([K3(y.stringUid,y,this._axiosCancelSource.token,this._config.httpRetryConfig||Kn,this.store).finally(()=>{this.store.requestSUAEnd()}),H3(y,this._axiosCancelSource.token,this._config.httpRetryConfig||Kn,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),R.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(y.stringUid," => ").concat(z)),y.uid=z,N.gatewayInfo.uid=z,N.gatewayInfo.res.uid=z}else N=await H3(y,this._axiosCancelSource.token,this._config.httpRetryConfig||Kn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new se(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(y,this._axiosCancelSource.token),this._configDistribute.on(ga.UPDATE_BITRATE_LIMIT,z=>{this._p2pChannel.updateBitrateLimit(z)}),this._configDistribute.on(ga.UPDATE_CLIENT_ROLE_OPTIONS,z=>{this._setClientRoleOptions(z)}),this._configDistribute.on(ga.UPDATE_REMOTE_VIDEO_STREAM_TYPE,z=>{var ne;ve(ne=[0,1,4,5,6,7,8,9]).call(ne,z)&&(this.remoteUsers.forEach(me=>{this._remoteStreamTypeCacheMap.get(me.uid)!==z&&this.setRemoteVideoStreamType(me.uid,z)}),this.setRemoteDefaultVideoStreamType(z))}),this._configDistribute.on(ga.FALLBACK_TO_HLS,z=>{z&&this.safeEmit(ft.FALLBACK_TO_HLS,xI.CONFIG)}),this._configDistribute.on(ga.UPDATE_VOS_CONFIGURE,z=>{this._gateway.setConfigure(z).catch(ne=>{R.debug("[".concat(this._clientId,"] auto set vos config failed"),ne)})})},0),this._key=n||e;const j=N.gatewayInfo,G=y.uid?y.uid:j.uid;this._joinInfo=Bo(Bo({},y),{},{cid:j.cid,uid:G,vid:j.vid,apResponse:j.res,apGatewayAddress:j.apGatewayAddress,uni_lbs_ip:j.uni_lbs_ip,gatewayAddrs:j.gatewayAddrs}),this.store.intUid=G,this.store.cid=j.cid;const K=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new se(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));v.onSuccess(K),this._appId=e,this._channelName=y.cname,this._uid=K,this.store.uid=K,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),!wr()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(wr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const X=y.stringUid?"string uid: ".concat(y.stringUid,",uid: ").concat(y.uid):"uid: ".concat(this._uid);return R.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(X)),setTimeout(()=>{R.startUpload()},5e3),this.store.joinEnd(),I=this,ve(Ku).call(Ku,I)||Ku.push(I),this._cloudProxyServerMode==="disabled"&&vt().supportWebCrypto&&D("ENABLE_PRELOAD")&&pN(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0),this._sessionId&&Le.reportRteDetail(this._sessionId),this._rteDetailInterval=window.setInterval(()=>{this._sessionId&&Le.reportRteDetail(this._sessionId)},D("RTE_DETAIL_REPORT_INTERVAL")||6e4),K}catch(N){const k=Array.isArray(N)?N[0]:N;throw k&&k.code===L.OPERATION_ABORTED?R.warning("[".concat(this._clientId,"] join number: ").concat(c,", Joining channel failed, rollback"),k):R.error("[".concat(this._clientId,"] join number: ").concat(c,", Joining channel failed, rollback"),k),k.code!==L.OPERATION_ABORTED&&this._numberOfJoinCount===c&&(this._gateway.state="DISCONNECTED",this._reset()),v.onError(k),k}var I}async _joinGateway(){if(!this._joinInfo||!this._key)throw new se(L.INVALID_OPERATION);try{return await this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!D("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}catch(e){if(e.code===L.INIT_DATACHANNEL_TIMEOUT){if(this._gateway.leave(!0,Tt.FALLBACK),R.debug("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new se(L.INVALID_OPERATION);return Le.reportApiInvoke(this._sessionId,{name:_n.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:rn.TRACER}).onSuccess(),await this._joinGateway()}throw e}}async leave(){R.info("[".concat(this._clientId,"] Leaving channel"));const e=()=>{!wr()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(wr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(n){const i=Ku.indexOf(n);i!==-1&&Ku.splice(i,1)}(this),this._statsCollector.stopUpdateStats()};this.store.useDcSignal||e();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return R.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",Tt.LEAVE),R.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t(),this.store.useDcSignal&&e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof Xp))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new se(L.INVALID_PARAMS,"param list is empty");const n=e;if(this._gateway.role==="audience")throw new se(L.INVALID_OPERATION,"audience can not publish stream");for(const a of n){if(!(a instanceof Xp))throw new se(L.INVALID_PARAMS,"parameter is not local track");if(!a._enabled&&t)throw new se(L.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(a.getTrackId()))}R.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(a=>"".concat(a.getTrackId()," "))));const i=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach(a=>{const c=this._configDistribute.getBitrateLimit();a instanceof sn&&c&&a.setBitrateLimit(c.uplink)});try{await this._publishHighStream(n),R.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(a=>"".concat(a.getTrackId()," "))))}catch(a){throw R.error("[".concat(this._clientId,"] publish error"),a.toString()),a}finally{i()}}async _publishDataChannel(e){if(e==null)throw new se(L.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));nn(e.id,"id",0,65535,!0),Oo(e.ordered,"ordered"),Lr(e.metadata,"metadata",0,512),R.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(a=>a.id===e.id)!==-1)throw new se(L.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new se(L.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(L.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&D("FORCE_TURN")&&!D("TURN_ENABLE_TCP")&&!D("TURN_ENABLE_UDP"))throw new se(L.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(a){return M3(a,!1)}(e),i=await this._p2pChannel.publishDataChannel([n]);if(i.length>0){if(typeof n._originDataChannelId!="number")throw R.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new se(L.CREATE_DATACHANNEL_ERROR);try{await we.all(i.map(a=>this._uid&&this._gateway.publishDataChannel(this._uid,a,!0))),await n._waitTillOpen()}catch(a){if(a.code!==L.DISCONNECT_P2P)throw a}}return R.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw R.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new se(L.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof Xp))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);R.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(i=>"".concat(i.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const i=await this._p2pChannel.unpublish(t);i&&await this._gateway.sendExtensionMessage(Bn.UNPUBLISH,{unpubMsg:i},!0)}else{const i=await this._p2pChannel.unpublish(t);i&&await this._gateway.unpublish(i,this._uid),R.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(a=>"".concat(a.getTrackId()))))}}catch(i){throw R.error("[".concat(this._clientId,"] unpublish error"),i.toString()),i}finally{n&&n()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),R.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(n=>"".concat(n.id," "))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(e);n&&await this._gateway.unpublishDataChannel(n),R.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(i=>"".concat(i.id))))}catch(n){throw R.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof ad)){const i=this.remoteUsers.find(a=>a.uid===e);if(!i)throw new se(L.INVALID_REMOTE_USER,"user is not in the channel");e=i}return t==="datachannel"?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(Hn(t,"mediaType",["audio","video"]),this.store.useP2P)throw new se(L.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new se(L.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(L.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===De.AUDIO,i=t===De.VIDEO,a=await this._subscribeMutex.lock();try{const{ssrcId:c,ortc:d,rtxSsrcId:h,cname:m,uint_id:g}=await this._gateway.presubscribe(e,t,!0);if(c==null)throw new se(L.UNEXPECTED_RESPONSE,"no ssrc id");let _=this._users.find(y=>y.uid===e);_||(_=new ad(e,g||e),_._is_pre_created=!0,this._users.push(_)),m&&(_._cname=m),_._uintid||(_._uintid=g||e),n&&(_._audioSSRC=c,_._audio_pre_subscribed=!0,d&&(_._audioOrtc=d)),i&&(_._videoSSRC=c,_._video_pre_subscribed=!0,d&&(_._videoOrtc=d),h!=null&&(_._rtxSsrcId=h)),R.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(c)),await this._p2pChannel.subscribe(_,t,c,h,d);const v=n?_._audioTrack:_._videoTrack;if(!v)throw new se(L.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(_._trust_audio_stream_added_state_=!0,_._audio_added_=!0),i&&(_._trust_video_stream_added_state_=!0,_._video_added_=!0),v}catch(c){throw R.error("[".concat(this._clientId,"] presub user ").concat(e," error"),c),c}finally{a()}}async _subscribeDataChannel(e,t){var n;if(nn(t,"channelId",0,65535,!0),!this._joinInfo)throw new se(L.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(L.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(h=>h===e))throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new se(L.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new se(L.INVALID_REMOTE_USER,"user is not published");const a=(n=e._dataChannels)===null||n===void 0?void 0:n.find(h=>h.id===t);if(!a)throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new se(L.REMOTE_USER_IS_NOT_PUBLISHED);const c=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const h=await this._p2pChannel.subscribeDataChannel(e,[a]);if(h&&ve(h).call(h,a.id))try{var d;if(typeof a._originDataChannelId!="number")throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new se(L.CREATE_DATACHANNEL_ERROR);const m={id:a.id,datachannelId:a._originDataChannelId,ordered:a.ordered,maxRetransmits:a.maxRetransmits,metadata:(d=a.metadata)!==null&&d!==void 0?d:""};await this._gateway.subscribeDataChannel(e.uid,m,!0),await a._waitTillOpen()}catch(m){if((m==null?void 0:m.code)!==L.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[a]),m;await this._p2pChannel.unsubscribeDataChannel(e,[a]),this._p2pChannel.setPendingRemoteDataChannel(e,a.id)}return R.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),a}finally{c()}}async _p2pSubscribe(e,t,n){if(Hn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new se(L.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(L.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(c=>c===e)){const c=new se(L.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),c}if(!e.hasAudio&&!e.hasVideo){const c=new se(L.INVALID_REMOTE_USER,"user is not published");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),c}if(!n&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const c=new se(L.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),c}const a=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const d=t==="audio"?e._audioSSRC:e._videoSSRC,h=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,d,h)}catch(d){throw d}R.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(d=>{R.warning("[".concat(this._clientId,"] auto set fallback failed"),d)});const c=t==="audio"?e._audioTrack:e._videoTrack;if(!c)throw new se(L.UNEXPECTED_ERROR,"can not find remote track in user object");return c}catch(c){throw R.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),c),c}finally{a()}}async _subscribe(e,t,n){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(Hn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new se(L.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(L.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(g=>g===e)){const g=new se(L.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),g}if(!e.hasAudio&&!e.hasVideo){const g=new se(L.INVALID_REMOTE_USER,"user is not published");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),g}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const g=new se(L.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),g}let a=t==="audio"?e._audioSSRC:e._videoSSRC,c=t==="audio"?e._audioOrtc:e._videoOrtc,d=t==="video"?e._rtxSsrcId:void 0,h={stream_type:t==="audio"?De.AUDIO:De.VIDEO,ssrcId:a};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});const m=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const _=t==="audio"?e._audioSSRC:e._videoSSRC;_!==void 0&&_!==a&&(a=_,c=t==="audio"?e._audioOrtc:e._videoOrtc,d=t==="video"?e._rtxSsrcId:void 0,h={stream_type:t==="audio"?De.AUDIO:De.VIDEO,ssrcId:a}),Jr.markSubscribeStart(this.store.clientId,a),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,a,d,c);try{this._p2pChannel.isPreSubScribe(a)||await this._gateway.subscribe(e.uid,h,!0)}catch(v){if((v==null?void 0:v.code)!==L.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),v;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(_){throw this._p2pChannel.reportSubscribeEvent(!1,_==null?void 0:_.code,e,t),_}R.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(_=>{R.warning("[".concat(this._clientId,"] auto set fallback failed"),_)});const g=t==="audio"?e._audioTrack:e._videoTrack;if(!g)throw new se(L.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),g}catch(g){throw R.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),g),g}finally{m()}}async massSubscribe(e){if(Hc(e,"subscribeList"),!this._joinInfo)throw new se(L.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(L.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,i=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(h=>{let{user:m,mediaType:g}=h;return"user: ".concat(m==null?void 0:m.uid,", mediaType: ").concat(g)}).join("; ")));const a=(e=[...e]).map(h=>{let{user:m,mediaType:g}=h;return{user:m,mediaType:g}}),c=await this._p2pChannel.globalLock();try{var d;for(let m=e.length-1;m>=0;m--){const g=e[m],{user:_,mediaType:v}=g;if(Hn(v,"mediaType",["audio","video"]),!_){const I=new se(L.INVALID_PARAMS,"user property does not exist in subscribeList item");throw R.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),I}if(!this._users.find(I=>I===_)){const I=new se(L.INVALID_REMOTE_USER,"user is not in the channel");R.error("[".concat(this._clientId,"] can not massSubscribe ").concat(_.uid,", this user is not in the channel")),a[m].error=I,e.splice(m,1);continue}if(v==="audio"&&(!_.hasAudio||_._audioSSRC===void 0)||v==="video"&&(!_.hasVideo||_._videoSSRC===void 0)){const I=new se(L.REMOTE_USER_IS_NOT_PUBLISHED);R.error("[".concat(this._clientId,"] can not subscribe ").concat(_.uid," with mediaType ").concat(v,", remote user is not published")),a[m].error=I,e.splice(m,1);continue}const b=fr.Video|fr.LwoVideo,O=n.get(_);if(O){if(v==="video"?O&b:O&fr.Audio){e.splice(m,1),R.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(_.uid,", mediaType:").concat(v," twice"));continue}n.set(_,O|(v==="video"?b:fr.Audio))}else n.set(_,v==="video"?b:fr.Audio)}for(let m=e.length-1;m>=0;m--){const g=e[m],{user:_,mediaType:v}=g,y=fr.Video|fr.LwoVideo;if(this._p2pChannel.hasRemoteMedia(_,v)){await this._p2pChannel.unmuteRemoteNoLock(_,v);const b=n.get(_);n.set(_,v==="video"?b^y:b^fr.Audio),e.splice(m,1)}}this.store.massSubscribe(e.map(m=>({userId:m.user.uid,type:m.mediaType})),t);let h=to(d=Array.from(n.entries())).call(d,(m,g)=>{let[_,v]=g;if(v===0)return m;const y={stream_id:_.uid,stream_type:v};return v&fr.Audio&&(y.audio_ssrc=_._audioSSRC),v&fr.Video&&(y.video_ssrc=_._videoSSRC),m.push(y),m},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(g=>{let{user:_,mediaType:v}=g;return{user:_,mediaType:v,ssrcId:v===De.VIDEO?_._videoSSRC:_._audioSSRC,rtxSsrcId:v===De.VIDEO?_._rtxSsrcId:void 0}}));const m=new Map;if(h=h.filter(g=>g.video_ssrc&&!this._p2pChannel.isPreSubScribe(g.video_ssrc)||g.audio_ssrc&&!this._p2pChannel.isPreSubScribe(g.audio_ssrc)||!g.video_ssrc&&!g.audio_ssrc),h.length>0){const g=await this._gateway.subscribeAll(h,!0);((g==null?void 0:g.users)||[]).forEach(_=>{let{stream_id:v,video_error_code:y,audio_error_code:b,error_code:O}=_;(y||b||O)&&m.set(v,{video_error_code:y,audio_error_code:b,error_code:O})})}if(Array.from(m.entries()).length>0){const g=[];Array.from(m.entries()).forEach(_=>{let[v,y]=_;const b=this.remoteUsers.find(O=>O.uid===v);if(b){let O;y.error_code||y.video_error_code&&y.audio_error_code?O=void 0:y.video_error_code?O=De.VIDEO:y.audio_error_code&&(O=De.AUDIO),g.push({user:b,mediaType:O})}}),g.length>0&&await this._p2pChannel.massUnsubscribeNoLock(g)}for(const g of a){const _=m.get(g.user.uid);if(_){const v=_.error_code||g.mediaType==="audio"&&_.audio_error_code||g.mediaType==="video"&&_.video_error_code;if(v){const y=Xu(v);R.error("user:".concat(g.user.uid," mediaType:").concat(g.mediaType," has massSubscribe error ").concat(y.desc)),g.error=new se(L.SUBSCRIBE_FAILED,"code ".concat(v,": ").concat(y.desc))}}g.error||(g.mediaType==="video"?g.track=g.user.videoTrack:g.track=g.user.audioTrack)}return this.store.massSubscribe(a.filter(g=>!g.error).map(g=>({userId:g.user.uid,type:g.mediaType})),void 0,Date.now()),a.forEach(g=>{var _;Le.subscribe(this.store.sessionId,{succ:!!g.error,ec:((_=g.error)===null||_===void 0?void 0:_.code)||null,video:g.mediaType===De.VIDEO,audio:g.mediaType===De.AUDIO,peerid:g.user.uid,subscribeRequestid:g.mediaType===De.VIDEO?g.user._videoSSRC:g.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(g.user._videoSSRC)},!0)}),R.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(g=>{let{user:_,mediaType:v}=g;return"user: ".concat(_==null?void 0:_.uid,", mediaType: ").concat(v)}).join("; "))),a}catch(m){throw await this._p2pChannel.massUnsubscribeNoLock(e),m}}finally{c(),i()}}async unsubscribe(e,t,n){if(!(e instanceof ad)){const c=this.remoteUsers.find(d=>d.uid===e);if(!c)throw new se(L.INVALID_REMOTE_USER,"user is not in the channel");e=c}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&Hn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new se(L.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(c=>c===e)){const c=new se(L.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}R.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const a=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const c=await this._p2pChannel.unsubscribe(e,t);c&&await this._gateway.unsubscribe(c,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&pS(this._users,e),R.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(c){if(c.code===L.DISCONNECT_P2P)return void R.warning("disconnecting p2p, abort unsubscribe request.");throw R.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}finally{a()}}async _unsubscribeDataChannel(e,t){if(t&&nn(t,"id",0,65535,!0),!this._joinInfo)throw new se(L.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(a=>a===e)){const a=new se(L.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),a}let i;if(typeof t=="number"){const a=e._dataChannels.find(c=>c.id===t);a&&(i=[a])}else i=e._dataChannels;if(i===void 0){const a=new se(L.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),a}R.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i.map(a=>a.id)));try{const a=await this._p2pChannel.unsubscribeDataChannel(e,i);a&&await this._gateway.unsubscribeDataChannel(a,e.uid),R.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(a))}catch(a){if(a.code===L.DISCONNECT_P2P)return void R.warning("disconnecting p2p, abort unsubscribe request.");throw R.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),a.toString()),a}}async massUnsubscribe(e){if(Hc(e,"unsubscribeList"),!this._joinInfo)throw new se(L.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");R.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(n=>{let{user:i,mediaType:a}=n;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(a,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:i,mediaType:a}=e[n];if(!i){const h=new se(L.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw R.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),h}if(Hn(a,"mediaType",["video","audio",void 0]),!this._users.find(h=>h===i)){R.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),e.splice(n,1);continue}const d=fr.Video|fr.LwoVideo;if(t.has(i)){const h=t.get(i);let m;switch(a){case"video":m=h&d;break;case"audio":m=h&fr.Audio;break;default:m=h&(fr.Audio|d)}if(m){R.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(a," twice.")),e.splice(n,1);continue}a?a==="audio"?t.set(i,h|fr.Audio):a==="video"&&t.set(i,h|d):t.set(i,h|fr.Audio|d)}else a?a==="audio"?t.set(i,fr.Audio):a==="video"&&t.set(i,d):t.set(i,fr.Audio|d)}try{const n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),R.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(i=>{let{user:a,mediaType:c}=i;return"user: ".concat(a==null?void 0:a.uid,", mediaType: ").concat(c,";")}).join()))}catch(n){if(n.code===L.DISCONNECT_P2P)return void R.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw R.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(e){(function(n){if(!n)throw new de(L.INVALID_PARAMS);An(n.width)||wI(n.width,"streamParameter.width"),An(n.height)||wI(n.height,"streamParameter.height"),An(n.framerate)||wI(n.framerate,"streamParameter.framerate"),An(n.bitrate)||nn(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&R.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),R.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,ye.LocalVideoLowTrack)}async setDualStreamMode(e,t){Hn(e,"mode",[0,1,-1]);try{switch(t&&await this.setLowStreamParameter(t),this._dualStreamMode=e,this._joinInfo?this._gateway.setDualStreamMode(e).catch(n=>{R.warning("[".concat(this._clientId,"] set dual stream mode failed"),n.toString())}):R.debug("[".concat(this._clientId,"] haven't joined yet, cache dual stream mode ").concat(e)),e){case jp.AUTO_SIMULCAST_STREAM:R.info("[".concat(this._clientId,"] set dual stream mode to ").concat(e));break;case jp.DISABLE_SIMULCAST_STREM:return this.disableDualStream();case jp.ENABLE_SIMULCAST_STREAM:return this.enableDualStream()}}catch(n){throw R.error("[".concat(this._clientId,"] set dual stream mode error"),n.toString()),n}}async enableDualStream(){if(!vt().supportDualStream)throw Le.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new se(L.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new se(L.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw Le.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,this._dualStreamMode=jp.ENABLE_SIMULCAST_STREAM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(e=>{R.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),e.toString())}),Le.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),R.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)return this._isDualStreamEnabled=!1,void R.info("[".concat(this._clientId,"] disable dual stream before join"));if(this._p2pChannel.getLocalMedia(ye.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw Le.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,this._dualStreamMode=jp.DISABLE_SIMULCAST_STREM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(e=>{R.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),e.toString())}),Le.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),R.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(i){Hn(i,"role",["audience","host"])}(e),t&&NI(t),this.mode==="rtc"||this.mode==="p2p")throw R.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new se(L.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new se(L.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new se(L.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;if(this._joinInfo&&(this._joinInfo.role=e),e!==n&&D("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",Wr.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),R.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level)),n==="audience"&&e!=="audience"&&this._pendingRtpCapabilityChange&&this._p2pChannel instanceof Zu){const{video_codec:i}=this._pendingRtpCapabilityChange;this._p2pChannel.updateRemoteRTPCapabilities(i.map(a=>a.toLowerCase()).filter(a=>{var c;return ve(c=Object.keys(Vu)).call(c,a)}))}}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&NI(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{R.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(Lr(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new se(L.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new se(L.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,Le.setProxyServer(this._proxyServer),R.setProxyServer(this._proxyServer),R.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new se(L.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new se(L.INVALID_OPERATION,"You have already set the proxy")}if(Pu(e))return this._turnServer={servers:e,mode:"original-manual"},void R.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>cV(n)),this._turnServer={servers:e,mode:"manual"},R.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new se(L.INVALID_OPERATION,"you should set license before join channel");if(Lr(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new se(L.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,R.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new se(L.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new se(L.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new se(L.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new se(L.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new se(L.INVALID_OPERATION,"Stop proxy server after leave channel");Le.setProxyServer(),R.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new se(L.INVALID_PARAMS,"accessPoints is required.");Hc(e.accessPoints.serverList,"accessPoints.serverList"),Lr(e.accessPoints.domain,"accessPoints.domain");const t=(y,b)=>{nn(y,b,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new se(L.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");D("CLOSE_AFB_FOR_LOCAL_AP")&&(Zt("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Zt("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,a=e.accessPoints.domain,c=e.accessPoints.serverList.map(y=>i.test(y)?"".concat(y.replace(/\./g,"-"),".").concat(a):y),d=c.map(y=>"".concat(y,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Zt("WEBCS_DOMAIN",d),Zt("WEBCS_DOMAIN_BACKUP_LIST",d),Zt("GATEWAY_DOMAINS",[a]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Hc(e.report.hostname,"report.hostname"),Zt("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Zt("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Zt("EVENT_REPORT_DOMAIN",c[0]),Zt("EVENT_REPORT_BACKUP_DOMAIN",c[1]||c[0]));let h=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),h=e.report.port),Zt("STATS_COLLECTOR_PORT",h),e.report?Zt("ENABLE_EVENT_REPORT",!0):Zt("ENABLE_EVENT_REPORT",!1);let m="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Hc(e.log.hostname,"log.hostname"),m=e.log.hostname[0]):m=c[0];let g=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),g=e.log.port),Zt("LOG_UPLOAD_SERVER","".concat(m,":").concat(g));let _=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Hc(e.cds.hostname,"cds.hostname"),_=e.cds.hostname):_=c;let v=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),v=e.cds.port),Zt("CDS_AP",_.map(y=>"".concat(y,":").concat(v))),e.cds?Zt("ENABLE_CONFIG_DISTRIBUTE",!0):Zt("ENABLE_CONFIG_DISTRIBUTE",!1),R.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(Hc(e,"serverList"),Lr(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new se(L.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(i=>n.test(i)?"".concat(i.replace(/\./g,"-"),".").concat(t):i),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Zt("WEBCS_DOMAIN",e),Zt("WEBCS_DOMAIN_BACKUP_LIST",e),Zt("GATEWAY_DOMAINS",[t]),Zt("EVENT_REPORT_DOMAIN",e[0]),Zt("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Zt("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),R.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Hn(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw R.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else R.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){Hn(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const n=this._users.find(i=>i.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw R.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}R.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){Hn(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw R.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}R.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,i){(function(c){Hn(c,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Lr(t,"secret");const a=["aes-128-gcm2","aes-256-gcm2"];if(ve(a).call(a,e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new se(L.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new se(L.INVALID_PARAMS,"current encrypt mode does not need salt");if(i){if(Oo(i,"encryptDataStream"),!ve(a).call(a,e))throw new se(L.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||R.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=ed(n))}async renewToken(e){if(Lr(e,"token",1,2047),!this._key||!this._joinInfo)throw new se(L.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(D("USE_NEW_TOKEN")){R.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const i=await bae(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Kn);R.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:i})}else R.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});R.debug("[".concat(this._clientId,"] renewToken success"))}catch(i){throw this._key=t,this._joinInfo.token=t,R.error("[".concat(this._clientId,"] renewToken failed"),i.toString()),i}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?R.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(ft.VOLUME_INDICATOR,e)},D("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new se(L.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new se(L.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new se(L.LIVE_STREAMING_TASK_CONFLICT);const n=t?qc.TRANSCODE:qc.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(qc.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(e));if(!t.length)throw new se(L.INVALID_PARAMS,"can not find live streaming url to stop");await we.all(t.map(n=>n&&n.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){$3(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){$3(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof Zu&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new se(L.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const a=new TextEncoder;e.payload=a.encode(e.payload)}let i=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ve(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(i=!0,e.payload=await async function(a,c,d){var h;const m=to(h=Array.from(d)).call(h,(I,N)=>I+N,0),g={serverTs:0,seq:Kse++,length:d.length,checkSum:m},_=new Uint8Array(_V(m,2)),v=new ArrayBuffer(zp),y=new DataView(v);y.setUint32(0,g.serverTs),y.setUint16(4,g.seq),y.setUint16(6,g.length),y.setUint16(8,g.checkSum);const b=16-d.length%16;d=hV(d,new Uint8Array(b));const O=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:a,tagLength:NV,additionalData:_},c,d);return hV(new Uint8Array(v),new Uint8Array(O))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new se(L.INVALID_PARAMS,i?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Ve.DATA_STREAM,{payload:ed(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-Pae},!n)}sendMetadata(e){if(!this._joinInfo)throw new se(L.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new se(L.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Ve.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:ed(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(toe),!this._joinInfo)throw new se(L.INVALID_OPERATION,"can not send custom report, not joined");await Le.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const e=this._statsCollector.getRemoteNetworkQualityStats();if(D("DELETE_NEQ_AFTER_USER_LEAVE")){const t=this._users.map(n=>n.uid+"");Object.keys(e).forEach(n=>{ve(t).call(t,n)||delete e[n]})}return e}getNetworkQuality(){return this._statsCollector.getNetworkQuality()}async pickSVCLayer(e,t){Hn(t.spatialLayer,"spatialLayer",[0,1,2,3]),Hn(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw R.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(Oo(t,"apRTM"),nn(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,R.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(R.debug("[".concat(this._clientId,"] reset client")),function(e){const t=tm.indexOf(e);t!==-1&&tm.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._pendingRtpCapabilityChange=void 0,this._axiosCancelSource.cancel(),this._axiosCancelSource=Mi.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&wB(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0,this._sessionId&&Le.reportRteDetail(this._sessionId)),this._fallbackServerInfo=void 0,this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Le.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Cr("client-publish",this._clientId),this._subscribeMutex=new Cr("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var n;const i=e||Uu();e?R.debug("[".concat(this._clientId,"] new Session ").concat(i)):R.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i));const a=e?"":this._sessionId||"";this._sessionId=i,this.store.sessionId=i,Le.addSid(i);const c={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:a,clientRole:this.role==="audience"?2:1,rteUrl:this.store.rteUrl,rteSid:this.store.rteSid};Le.sessionInit(this._sessionId,Bo({cname:t.channel,appid:t.appId},c)),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new se(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(L.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&D("FORCE_TURN")&&!D("TURN_ENABLE_TCP")&&!D("TURN_ENABLE_UDP"))throw new se(L.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");R.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const i=(await n.next()).value;if(i){try{await this._gateway.sendExtensionMessage(Bn.PUBLISH,i,!0)}catch(a){throw n.throw(a),a}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const i=(await n.next()).value;if(i){var t;let a;try{a=await this._gateway.publish(this._uid,i,!0)}catch(c){if(c.code!==L.DISCONNECT_P2P)throw n.throw(c),c}await n.next(((t=a)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const a of e)a instanceof sn&&a._encoderConfig&&this._gateway.setVideoProfile(a._encoderConfig).catch(c=>{R.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!a.muted&&a.enabled||await this._p2pChannel.muteLocalTrack(a)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,e),(n==null?void 0:n.code)===L.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new se(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(L.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));R.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),i=(await n.next()).value;if(i){var t;let a;try{a=await this._gateway.publish(this._uid,i,!0)}catch(c){if(c.code!==L.DISCONNECT_P2P)throw n.throw(c),c}n.next(((t=a)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===L.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new se(L.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(i={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Ea("LiveStreaming").create(i));var i;return n.onLiveStreamError=(a,c)=>{Le.reportApiInvoke(this._sessionId,{name:_n.ON_LIVE_STREAM_ERROR,options:[a,c],tag:rn.TRACER}).onSuccess(),this.safeEmit(ft.LIVE_STREAMING_ERROR,a,c)},n.onLiveStreamWarning=(a,c)=>{Le.reportApiInvoke(this._sessionId,{name:_n.ON_LIVE_STREAM_WARNING,options:[a,c],tag:rn.TRACER}).onSuccess(),this.safeEmit(ft.LIVE_STREAMING_WARNING,a,c)},n.on(CA.REQUEST_WORKER_MANAGER_LIST,(a,c,d)=>{if(!this._joinInfo)return d(new se(L.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(h,m,g,_){const v=D("UAP_AP").slice(0,D("AJAX_REQUEST_CONCURRENT")).map(y=>m.proxyServer?"https://".concat(m.proxyServer,"/ap/?url=").concat(y+"/api/v1?action=uap"):"https://".concat(y,"/api/v1?action=uap"));return await gae(v,h,m,g,_)})(a,this._joinInfo,this._axiosCancelSource.token,Kn).then(c).catch(d)}),n};return e===qc.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new se(L.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),i=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},Ea("ChannelMediaRelay").create(e));i.on("state",a=>{a===Zi.RELAY_STATE_FAILURE&&i&&i.dispose(),this.safeEmit(ft.CHANNEL_MEDIA_RELAY_STATE,a)}),i.on("event",a=>{this.safeEmit(ft.CHANNEL_MEDIA_RELAY_EVENT,a)}),this._channelMediaRelayClient=i,this._statsCollector.onStatsChanged=(a,c)=>{var d;a==="resolution"&&((d=this._channelMediaRelayClient)===null||d===void 0||d.setVideoProfile(c))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:i}=e,a=[];if(t){const c=[];this._users.forEach(d=>{d._dataChannels.forEach(h=>{n.every(m=>m.uid!==d._uintid||m.stream_id!==h.id)&&c.push({uid:d._uintid,stream_id:h.id,ordered:h.ordered,max_retrans_times:h.maxRetransmits,metadata:h.metadata})})}),c.length>0&&this._handleUpdateDataChannel({added:[],deleted:c})}Array.isArray(n)&&n.length>0&&n.forEach(c=>{const{uid:d,stream_id:h,ordered:m,max_retrans_times:g,metadata:_}=c,v=this._users.find(y=>y._uintid===d);if(!v)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(R.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(d)),ve(a).call(a,v)||a.push(v),v._uintid||(v._uintid=d),v._dataChannels.findIndex(y=>y.id===c.stream_id)===-1){const y={id:h,ordered:!!m,maxRetransmits:g,metadata:_},b=function(O){return M3(O,!0)}(y);v._dataChannels.push(b),R.info("[".concat(this._clientId,"] remote user ").concat(v.uid," published datachannel")),t||this.safeEmit(ft.USER_PUBLISHED,v,"datachannel",y)}this._p2pChannel.hasPendingRemoteDataChannel(v,c.stream_id)&&(R.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(v.uid," after reconnect.")),this._subscribeDataChannel(v,c.stream_id).catch(y=>{R.error("[".concat(this._clientId,"] resubscribe datachannel error"),y.toString())}))}),t&&(this.safeEmit(ft.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach(c=>{const{uid:d,stream_id:h}=c,m=this._users.find(_=>_._uintid===d);if(!m)return void R.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const g=m._dataChannels.find(_=>_.id===c.stream_id);g&&(R.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(d)),this._p2pChannel.unsubscribeDataChannel(m,[g]).then(_=>{if(m._dataChannels=m._dataChannels.filter(v=>v!==g),_)return this._gateway.unsubscribeDataChannel(_,m.uid)}),R.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished datachannel ,id:").concat(g.id)),this.safeEmit(ft.USER_UNPUBLISHED,m,"datachannel",g._config))})}_getEncodingName(e){var t,n;if(!this._joinResponse)return;const i=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(!i)return;for(const h of i){var a;if(h.payloadType===e)return h==null||(a=h.rtpMap)===null||a===void 0?void 0:a.encodingName}const c=(n=this._joinResponse.ortc.rtpCapabilities.recv)===null||n===void 0?void 0:n.videoCodecs;if(c)for(const h of c){var d;if(h.payloadType===e)return h==null||(d=h.rtpMap)===null||d===void 0?void 0:d.encodingName}return e===0?"unknown":void 0}_handleRemoveDataChannels(e){const t=this._users.find(n=>n.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){R.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(i=>{this.safeEmit(ft.USER_UNPUBLISHED,t,"datachannel",i._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(i=>{if(i)return this._gateway.unsubscribeDataChannel(i,t.uid)}),n()}}else R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Fn.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void R.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach(i=>{const{value:a,type:c,expires:d}=t[i];d&&d<=n||c||vA()||!Object.prototype.hasOwnProperty.call(yS,i)||(Ms[i]=a,zt[i]=a,R.debug("Update gateway parameters from config distribute",i,a))})}catch(t){R.error("Error update config from local cache",t.message)}})()}),this._gateway.on(Fn.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Fn.CONNECTION_STATE_CHANGE,(e,t,n)=>{var i;if(n===Tt.FALLBACK)return;const a=()=>{this.safeEmit(ft.CONNECTION_STATE_CHANGE,e,t,n)};if(Le.reportApiInvoke(this._sessionId||((i=this._gateway.joinInfo)===null||i===void 0?void 0:i.sid)||null,{name:_n.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:rn.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),R.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void a();if(e==="RECONNECTING")this._users.forEach(d=>{d._trust_in_room_=!1,d._trust_audio_enabled_state_=!1,d._trust_video_enabled_state_=!1,d._trust_audio_mute_state_=!1,d._trust_video_mute_state_=!1,d._trust_audio_stream_added_state_=!1,d._trust_video_stream_added_state_=!1,d._is_pre_created||(d._audio_pre_subscribed||(d._audioSSRC=void 0,d._audioOrtc=void 0),d._video_pre_subscribed||(d._videoSSRC=void 0,d._videoOrtc=void 0,d._rtxSsrcId=void 0),d._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var c;this._streamFallbackTypeCacheMap.forEach((d,h)=>{this._gateway.setStreamFallbackOption(h,d).catch(m=>{R.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),m)})}),this._remoteStreamTypeCacheMap.forEach((d,h)=>{this._gateway.setRemoteVideoStreamType(h,d).catch(m=>{R.warning("[".concat(this._clientId,"] auto set remote stream type failed"),m)})}),D("VOS_CONFIGURE")&&Array.isArray(D("VOS_CONFIGURE"))&&D("VOS_CONFIGURE").length>0&&(this._gateway.setConfigure(D("VOS_CONFIGURE")).catch(d=>{R.debug("[".concat(this._clientId,"] auto set vos config failed"),d)}),R.debug("[".concat(this._clientId,"] ws connected auto set vos config"))),this._remoteDefaultVideoStreamType!==void 0&&((c=this._joinInfo)===null||c===void 0?void 0:c.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{R.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(d=>{R.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(d))}),this._dualStreamMode&&this._gateway.setDualStreamMode(this._dualStreamMode).catch(d=>{R.warning("[".concat(this._clientId,"] auto set dual stream mode failed"),d)}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(d=>!d._trust_in_room_).forEach(d=>{R.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(d.uid)),this._handleUserOffline({uid:d.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(d=>{d._trust_audio_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(d.uid)),this._handleMuteStream(d.uid,De.AUDIO,!1)),d._trust_video_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(d.uid)),this._handleMuteStream(d.uid,De.VIDEO,!1)),d._trust_audio_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(d.uid)),this._handleSetStreamLocalEnable("audio",d.uid,!0)),d._trust_video_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(d.uid)),this._handleSetStreamLocalEnable("video",d.uid,!0)),d._trust_video_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(d.uid)),this._handleResetAddStream(d,"video")),d._trust_audio_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(d.uid)),this._handleResetAddStream(d,"audio")),d._video_added_||d._audio_added_||(R.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(d.uid)),this._handleRemoveStream({uid:d.uid,uint_id:d._uintid}))}))},1e3))}a()}),this._gateway.on(Fn.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new se(L.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;if(this._fallbackServerInfo)n=this._fallbackServerInfo,this._fallbackServerInfo=void 0,this._joinInfo.preload=!1,Le.reportApiInvoke(this._sessionId,{name:_n.VOS_FALLBACK_CN,options:{cur:n.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!0},tag:rn.TRACER}).onSuccess(),R.info("[".concat(this._clientId,"] use fallback cn server info"));else{const a=await uN(Bo(Bo({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));a?(n=a.ap,CB(a),this._joinInfo.preload=!0):(n=await rT(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Kn,this.store),this._joinInfo.preload=!1)}this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const i=[];n.gatewayInfo.gatewayAddrs.forEach(a=>{let{address:c}=a;const[d,h]=c.split(":");this._joinInfo&&this._joinInfo.proxyServer?i.push({proxy:this._joinInfo.proxyServer,host:d,port:h}):i.push({host:d,port:h})}),e(i)}catch(n){t(n)}}),this._gateway.on(Fn.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(ft.NETWORK_QUALITY,e)}),this._gateway.on(Fn.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(ft.STREAM_TYPE_CHANGED,e,t),Le.reportApiInvoke(this._sessionId,{name:_n.STREAM_TYPE_CHANGE,options:[e,t],tag:rn.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(Fn.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(Fn.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{let i=await this._p2pChannel.getEstablishParams();i&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(i=await this._p2pChannel.startP2PConnection(e)),t(i)}catch(i){n(i)}}),this._gateway.on(Fn.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let n;this._joinResponse=e,e.attributes?n=e.attributes.userAttributes.preSubSsrcs:R.debug("no attributes in joinResponse");const i=C3(e.ortc,t,n);this._p2pChannel.connect(i)}),this._gateway.on(Fn.PRE_CONNECT_PC,async(e,t,n)=>{const{candidates:i,fingerprint:a,turnServer:c}=e;if(this._joinInfo&&i.length>0&&!this._p2pChannel.isPlanB){const{cert:h,cid:m}=this._joinInfo.apResponse,g="".concat(m,"_").concat(h);if(g.length<4||g.length>256)return void R.debug("[".concat(this._clientId,"] ufrag length is not valid, length: ").concat(g.length));await this._p2pChannel.startP2PConnection({turnServer:c,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var d;t(await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(m,"_").concat(h),icePwd:"".concat(m,"_").concat(h)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(d=D("FINGERPRINT"))!==null&&d!==void 0?d:a}]},candidates:i,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0}))}catch(_){_.code&&_.code===L.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:c,cloudProxyServer:this._joinInfo.cloudProxyServer},!0),n(_)}}}),this._gateway.on(Fn.VOS_FALLBACK,e=>{e==="fallback_hls"&&this.safeEmit(ft.FALLBACK_TO_HLS,xI.VOSERROR)}),this._gateway.on(Fn.RESET_SIGNAL,()=>{this._p2pChannel instanceof Zu&&this._p2pChannel.fallbackConnection(),this._handleGatewaySignalEvents()}),this._gateway.on(Fn.DATACHANNEL_FAILBACK,()=>{Le.reportApiInvoke(this._sessionId,{name:_n.DATACHANNEL_FAILBACK,options:{},tag:rn.TRACER}).onSuccess(),this._joinGateway()})}_handleGatewaySignalEvents(){this._gateway.signal.on(Ze.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Ze.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Ze.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(Ze.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(Ze.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(Ze.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Ze.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Ze.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Ze.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,De.AUDIO,!0)),this._gateway.signal.on(Ze.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,De.AUDIO,!1)),this._gateway.signal.on(Ze.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,De.VIDEO,!0)),this._gateway.signal.on(Ze.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,De.VIDEO,!1)),this._gateway.signal.on(Ze.RECEIVE_METADATA,e=>{const t=Mu(e.metadata);this.safeEmit(ft.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(Ze.ON_DATA_STREAM,async e=>{var t;if(!e)return;let n=Mu(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ve(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<zp)throw new se(L.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(zp));n=await async function(c,d,h){const m=h.subarray(0,zp),g=m.slice(8,zp),_=(g[0]<<8)+g[1],v=(m[6]<<8)+m[7],y=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:c,tagLength:NV,additionalData:new Uint8Array(_V(_,2))},d,h.subarray(zp));return new Uint8Array(y).subarray(0,v)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let i=0;if(e.ordered||e.syncWithAudio){const a=this._p2pChannel.getStats(),c=this.remoteUsers.find(h=>h.uid===e.uid),d=a==null?void 0:a.audioRecv.find(h=>h.ssrc===(c==null?void 0:c._audioSSRC));i=d==null?void 0:d.jitterBufferMs}(i==null||Number.isNaN(i))&&(i=0),kae(Bo(Bo({},e),{},{payload:n}),i,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Ze.ON_CRYPT_ERROR,()=>{Zl(()=>{R.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(ft.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Ze.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Ze.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{R.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Tt.TOKEN_EXPIRE),this.safeEmit(ft.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Ze.ON_STREAM_FALLBACK_UPDATE,e=>{R.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(ft.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Ze.ENABLE_MULTI_STREAM,e=>{this._dualStreamMode===jp.AUTO_SIMULCAST_STREAM&&this.enableDualStream().catch(t=>{R.debug("[".concat(this._clientId,"] set dual stream mode error"),t.toString())})}),this._gateway.signal.on(Ze.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),R.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(Ze.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(Ze.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Ue.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case Ve.PUBLISH:{if(!t)return;const a=t.ortc;if(a){var n,i;const c=a.some(m=>{let{stream_type:g}=m;return g===Ht.Audio}),d=a.some(m=>{let{stream_type:g}=m;return g!==Ht.Audio}),h=a.some(m=>{let{stream_type:g}=m;return g===Ht.Screen||g===Ht.ScreenLow});t.state==="offer"&&Le.publish(this._joinInfo.sid,{eventElapse:Jr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:L.TIMEOUT,audio:c,video:d,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:h,audioName:c?(n=a.find(m=>{let{stream_type:g}=m;return g===Ht.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:d?(i=a.find(m=>{let{stream_type:g}=m;return g!==Ht.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0})}break}case Ve.SUBSCRIBE:t&&Le.subscribe(this._joinInfo.sid,{succ:!1,ec:L.TIMEOUT,audio:t.stream_type===De.AUDIO,video:t.stream_type===De.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Jr.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(Ze.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(Ze.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;D("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(i=>!qu(i.string_id||i.stream_id,this.channelName)));const t=[],n=[];for(const i of e.users){let a=this._users.find(_=>_._uintid===i.stream_id);a?a._trust_in_room_=!0:(a=new ad(i.string_id||i.stream_id,i.stream_id),this._users.push(a),this.store.firstVideoFrameDecoded(a.uid,{userJoinNotify:Date.now()}),this.getListeners(ft.PUBLISHED_USER_LIST).length===0&&(R.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit(ft.USER_JOINED,a)));const c=fr.Audio&i.stream_type,d=(fr.Video|fr.LwoVideo)&i.stream_type,h=(65280&i.stream_type)!=0,m=c&&a.hasAudio,g=d&&a.hasVideo;d&&(a._trust_video_stream_added_state_=!0,a._video_added_=!0,a._videoSSRC=i.video_ssrc,a._rtxSsrcId=i.video_rtx),c&&(a._trust_audio_stream_added_state_=!0,a._audio_added_=!0,a._audioSSRC=i.audio_ssrc),c&&!m&&this.getListeners(ft.PUBLISHED_USER_LIST).length===0&&(R.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published audio")),this.safeEmit(ft.USER_PUBLISHED,a,"audio")),d&&!g&&this.getListeners(ft.PUBLISHED_USER_LIST).length===0&&(R.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published video")),this.safeEmit(ft.USER_PUBLISHED,a,"video")),(c&&!m||d&&!g||h)&&t.push(a),d&&this._p2pChannel.hasPendingRemoteMedia(a,"video")&&n.push({user:a,mediaType:"video"}),c&&this._p2pChannel.hasPendingRemoteMedia(a,"audio")&&n.push({user:a,mediaType:"audio"})}n.length>0&&(R.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(i=>"user: ".concat(i.user.uid,", mediaType: ").concat(i.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(i=>{R.error("[".concat(this._clientId,"] mass resubscribe error"),i.toString())})),this.getListeners(ft.PUBLISHED_USER_LIST).length>0?D("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(R.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(i=>i.uid).join(", "))),this.safeEmit(ft.PUBLISHED_USER_LIST,t)):R.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(i=>i.uid).join(", ")))}),this._gateway.signal.on(Ze.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;if(this._p2pChannel instanceof Zu){if(this.role==="audience"&&D("UPDATE_RTP_CAP_IN_HOST"))return this._pendingRtpCapabilityChange=e,void R.debug("[".concat(this._clientId,"] no need to change rtp capability because of audience, params: ").concat(JSON.stringify(e)));this._p2pChannel.updateRemoteRTPCapabilities(t.map(n=>n.toLowerCase()).filter(n=>{var i;return ve(i=Object.keys(Vu)).call(i,n)}))}}),this._gateway.signal.on(Ue.VOS_FALLBACK_PROMISE,async(e,t,n)=>{if(e==="FALLBACKCN"&&D("ENABLE_QUALITY_FALLBACK")){if(!this._joinInfo)return n(new se(L.UNEXPECTED_ERROR,"can not recover, no join info"));R.info("[".concat(this._clientId,"] try fallback to cn, start request new server info"));const a=this._joinInfo.apRequestDetail;try{this._joinInfo.apRequestDetail=e;const c=await rT(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Kn,this.store);if(D("QUALITY_FALLBACK_REHEARSAL"))return Le.reportApiInvoke(this._sessionId,{name:_n.VOS_FALLBACK_CN,options:{cur:c.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:rn.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=a,void n();this._fallbackServerInfo=c,t()}catch(c){var i;const d=c==null||(i=c.data)===null||i===void 0?void 0:i.desc;D("QUALITY_FALLBACK_REHEARSAL")?(Le.reportApiInvoke(this._sessionId,{name:_n.VOS_FALLBACK_CN,options:{cur:"failed, errorReason: "+d||"unknown",prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:rn.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=a):Array.isArray(d)&&ve(d).call(d,"request downgrade fallback")&&this.safeEmit(ft.FALLBACK_TO_HLS,xI.AP_ERROR),n(c)}}else n()})}_handleP2PEvents(){this._gateway.signal.on(Ze.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Bn.PUBLISH,(e,t,n)=>{const{uid:i}=e;e.forEach(a=>{const{kind:c,ssrcs:d,mid:h,isMuted:m}=a;this._handleP2PAddAudioOrVideoStream(c,i,d[0].ssrcId,h);const g=this._users.find(_=>_.uid===i);return g&&this.store.useP2P?this._p2pChannel.mockSubscribe(g,c,d[0].ssrcId,h).then(()=>{t()}).catch(n):t(),this._handleMuteStream(i,c,!!m)})}),this._gateway.signal.on(Bn.CALL,async(e,t,n)=>{if(this.store.useP2P)try{var i;t(await this._p2pChannel.startP2P({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},e))}catch(a){n(a)}}),this._gateway.signal.on(Ue.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(Bn.UNPUBLISH,async(e,t,n)=>{if(this.store.useP2P){const{unpubMsg:i,uid:a}=e,c=this._users.find(d=>d.uid===a);if(!c)return R.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(a)),void t();try{i.forEach(async d=>{let{stream_type:h}=d;const m=h===Ht.Audio?De.AUDIO:De.VIDEO;await this._p2pChannel.unsubscribe(c,m),this._handleMuteStream(a,m,!0)}),t()}catch(d){n(d)}}}),this._gateway.signal.on(Bn.CONTROL,async(e,t)=>{const{action:n}=e;switch(n){case id.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,De.VIDEO,!0);break;case id.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,De.AUDIO,!0);break;case id.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,De.VIDEO,!1);break;case id.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,De.AUDIO,!1)}}),this._gateway.signal.on(Bn.RESTART_ICE,async(e,t,n)=>{if(this.store.useP2P)try{const{direction:i,iceParameter:a}=e;i!==Ni.SEND_ONLY||a?t(await this._p2pChannel.restartICE(i,a)):(this._p2pChannel.handleDisconnect(i),t())}catch(i){n(i)}}),this._gateway.signal.on(Bn.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}}),this._p2pChannel.on(Fe.RequestP2PRestartICE,async(e,t,n)=>{try{const{direction:i}=e;t(await this._gateway.sendExtensionMessage(Bn.RESTART_ICE,e,i===Ni.SEND_ONLY))}catch(i){n(i)}}),this._p2pChannel.on(Fe.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Bn.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Fe.RequestP2PMuteLocal,async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(Bn.CONTROL,e,!0),t()}catch(i){n(i)}}),this._p2pChannel.on(Fe.RequestP2PUnmuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===L.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Fe.RequestP2PMuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===L.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Fe.StateChange,(e,t)=>{t===Ft.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Fe.PeerConnectionStateChange,e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(ft.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(Fe.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===L.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Fe.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===L.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Fe.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(Fe.RequestRePublishDataChannel,(e,t,n)=>{we.all(e.map(async i=>{const a=await this._p2pChannel.publishDataChannel([i]);try{a.forEach(c=>{this._uid&&this._gateway.publishDataChannel(this._uid,c,!0)})}catch(c){if(c.code!==L.DISCONNECT_P2P)throw c}})).then(t).catch(n)}),this._p2pChannel.on(Fe.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:i,kind:a}of e)a===De.VIDEO?await this.subscribe(i,"video"):await this.subscribe(i,"audio");t()}catch(i){n(i)}}),this._p2pChannel.on(Fe.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(Fe.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Fe.MediaReconnectStart,e=>{this.safeEmit(ft.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Fe.MediaReconnectEnd,e=>{this.safeEmit(ft.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Fe.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Fe.RequestRestartICE,async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const i=n.value;let a;try{a=await this._gateway.restartICE({iceParameters:i})}catch(d){return void t.throw(d)}const{iceParameters:c}=function(d){const h=d.iceParameters;return{iceParameters:{iceUfrag:h.iceUfrag,icePwd:h.icePwd}}}(a);await t.next({remoteIceParameters:c})}),this._p2pChannel.on(Fe.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Fe.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:a,gatewayAddress:c}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:i}),d=C3(a,c);await this._p2pChannel.connect(d),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Fe.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(Fe.P2PLost,()=>{this.safeEmit(ft.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Fe.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Fe.ConnectionTypeChange,e=>{this.safeEmit(ft.IS_USING_CLOUD_PROXY,e),this._gateway.setUsingProxy(e)}),this._p2pChannel.on(Fe.FirstVideoBufferReady,(e,t)=>{this.safeEmit(ft.FIRST_VIDEO_BUFFER_READY,e,t)}),this._p2pChannel.on(Fe.FirstVideoPreRender,(e,t)=>{this.safeEmit(ft.FIRST_VIDEO_PRE_RENDER,e,t)}),this._p2pChannel.on(Fe.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Fe.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(Fe.AudioMetadata,e=>{this.safeEmit(ft.AUDIO_METADATA,e)}),this._p2pChannel.on(Fe.AudioPts,e=>{this.safeEmit(ft.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new se(L.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new se(L.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(t={config:e},Ea("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:i,cname:a,sid:c,token:d,uid:h,cid:m,vid:g}=this._joinInfo;await n.init({appId:i,areaCode:"",cname:a,sid:c,token:d,uid:h,cid:m,vid:g?Number(g):0},Kn)}catch(n){throw Array.isArray(n)?n[0]:n}var t}handleVideoInspectEvents(e){e.on(Ar.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(ft.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===Mo.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(ft.CONTENT_INSPECT_ERROR,new se(L.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Ar.INSPECT_RESULT,(t,n)=>{var i;if((n==null?void 0:n.code)===L.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return R.debug("Stop inspect content because that has left channel"),this==null||(i=this._inspect)===null||i===void 0||i.close(),void(this._inspect=void 0);this.safeEmit(ft.CONTENT_INSPECT_RESULT,t,n)}),e.on(Ar.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new se(L.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Oo(e,"enabled"),e){if(!t)throw new se(L.INVALID_PARAMS,"config is required");if(FB(t),!this._joinInfo)throw new se(L.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const i=(n={config:t},Ea("ImageModeration").create(n));this._moderation=i,this.handleImageModerationEvents(i);const{appId:a,cname:c,sid:d,token:h,uid:m,cid:g,vid:_}=this._joinInfo;await i.init({appId:a,areaCode:"",cname:c,sid:d,token:h,uid:m,cid:g,vid:_?Number(_):0},Kn)}}catch(i){throw Array.isArray(i)?i[0]:i}}else{var n;if(!this._moderation)throw new se(L.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}handleImageModerationEvents(e){e.on(_a.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(ft.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===co.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new se(L.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(_a.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){Hn(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new se(L.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,R.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return R.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Oo(e,"enabled"),Zt("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_setRteInfo(e,t){this.store.rteUrl=e,this.store.rteSid=t}_isPreRender(){return"isPreRender"in this._p2pChannel&&this._p2pChannel.isPreRender()}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Ie(Pe.prototype,"leave",[BB],Object.getOwnPropertyDescriptor(Pe.prototype,"leave"),Pe.prototype),Ie(Pe.prototype,"publish",[GB],Object.getOwnPropertyDescriptor(Pe.prototype,"publish"),Pe.prototype),Ie(Pe.prototype,"unpublish",[WB],Object.getOwnPropertyDescriptor(Pe.prototype,"unpublish"),Pe.prototype),Ie(Pe.prototype,"subscribe",[zB],Object.getOwnPropertyDescriptor(Pe.prototype,"subscribe"),Pe.prototype),Ie(Pe.prototype,"presubscribe",[HB],Object.getOwnPropertyDescriptor(Pe.prototype,"presubscribe"),Pe.prototype),Ie(Pe.prototype,"massSubscribe",[KB],Object.getOwnPropertyDescriptor(Pe.prototype,"massSubscribe"),Pe.prototype),Ie(Pe.prototype,"unsubscribe",[qB],Object.getOwnPropertyDescriptor(Pe.prototype,"unsubscribe"),Pe.prototype),Ie(Pe.prototype,"massUnsubscribe",[YB],Object.getOwnPropertyDescriptor(Pe.prototype,"massUnsubscribe"),Pe.prototype),Ie(Pe.prototype,"setLowStreamParameter",[XB],Object.getOwnPropertyDescriptor(Pe.prototype,"setLowStreamParameter"),Pe.prototype),Ie(Pe.prototype,"setDualStreamMode",[JB],Object.getOwnPropertyDescriptor(Pe.prototype,"setDualStreamMode"),Pe.prototype),Ie(Pe.prototype,"enableDualStream",[QB],Object.getOwnPropertyDescriptor(Pe.prototype,"enableDualStream"),Pe.prototype),Ie(Pe.prototype,"disableDualStream",[$B],Object.getOwnPropertyDescriptor(Pe.prototype,"disableDualStream"),Pe.prototype),Ie(Pe.prototype,"setClientRole",[ZB],Object.getOwnPropertyDescriptor(Pe.prototype,"setClientRole"),Pe.prototype),Ie(Pe.prototype,"_setClientRoleOptions",[e5],Object.getOwnPropertyDescriptor(Pe.prototype,"_setClientRoleOptions"),Pe.prototype),Ie(Pe.prototype,"setProxyServer",[t5],Object.getOwnPropertyDescriptor(Pe.prototype,"setProxyServer"),Pe.prototype),Ie(Pe.prototype,"setTurnServer",[n5],Object.getOwnPropertyDescriptor(Pe.prototype,"setTurnServer"),Pe.prototype),Ie(Pe.prototype,"setLicense",[r5],Object.getOwnPropertyDescriptor(Pe.prototype,"setLicense"),Pe.prototype),Ie(Pe.prototype,"startProxyServer",[i5],Object.getOwnPropertyDescriptor(Pe.prototype,"startProxyServer"),Pe.prototype),Ie(Pe.prototype,"stopProxyServer",[s5],Object.getOwnPropertyDescriptor(Pe.prototype,"stopProxyServer"),Pe.prototype),Ie(Pe.prototype,"setLocalAccessPointsV2",[o5],Object.getOwnPropertyDescriptor(Pe.prototype,"setLocalAccessPointsV2"),Pe.prototype),Ie(Pe.prototype,"setLocalAccessPoints",[a5],Object.getOwnPropertyDescriptor(Pe.prototype,"setLocalAccessPoints"),Pe.prototype),Ie(Pe.prototype,"setRemoteDefaultVideoStreamType",[c5],Object.getOwnPropertyDescriptor(Pe.prototype,"setRemoteDefaultVideoStreamType"),Pe.prototype),Ie(Pe.prototype,"setRemoteVideoStreamType",[l5],Object.getOwnPropertyDescriptor(Pe.prototype,"setRemoteVideoStreamType"),Pe.prototype),Ie(Pe.prototype,"setStreamFallbackOption",[d5],Object.getOwnPropertyDescriptor(Pe.prototype,"setStreamFallbackOption"),Pe.prototype),Ie(Pe.prototype,"setEncryptionConfig",[u5],Object.getOwnPropertyDescriptor(Pe.prototype,"setEncryptionConfig"),Pe.prototype),Ie(Pe.prototype,"renewToken",[h5],Object.getOwnPropertyDescriptor(Pe.prototype,"renewToken"),Pe.prototype),Ie(Pe.prototype,"enableAudioVolumeIndicator",[p5],Object.getOwnPropertyDescriptor(Pe.prototype,"enableAudioVolumeIndicator"),Pe.prototype),Ie(Pe.prototype,"startLiveStreaming",[m5],Object.getOwnPropertyDescriptor(Pe.prototype,"startLiveStreaming"),Pe.prototype),Ie(Pe.prototype,"setLiveTranscoding",[f5],Object.getOwnPropertyDescriptor(Pe.prototype,"setLiveTranscoding"),Pe.prototype),Ie(Pe.prototype,"stopLiveStreaming",[g5],Object.getOwnPropertyDescriptor(Pe.prototype,"stopLiveStreaming"),Pe.prototype),Ie(Pe.prototype,"startChannelMediaRelay",[_5],Object.getOwnPropertyDescriptor(Pe.prototype,"startChannelMediaRelay"),Pe.prototype),Ie(Pe.prototype,"updateChannelMediaRelay",[E5],Object.getOwnPropertyDescriptor(Pe.prototype,"updateChannelMediaRelay"),Pe.prototype),Ie(Pe.prototype,"stopChannelMediaRelay",[v5],Object.getOwnPropertyDescriptor(Pe.prototype,"stopChannelMediaRelay"),Pe.prototype),Ie(Pe.prototype,"sendCustomReportMessage",[y5],Object.getOwnPropertyDescriptor(Pe.prototype,"sendCustomReportMessage"),Pe.prototype),Ie(Pe.prototype,"pickSVCLayer",[S5],Object.getOwnPropertyDescriptor(Pe.prototype,"pickSVCLayer"),Pe.prototype),Ie(Pe.prototype,"setRTMConfig",[T5],Object.getOwnPropertyDescriptor(Pe.prototype,"setRTMConfig"),Pe.prototype),Ie(Pe.prototype,"enableContentInspect",[b5],Object.getOwnPropertyDescriptor(Pe.prototype,"enableContentInspect"),Pe.prototype),Ie(Pe.prototype,"disableContentInspect",[R5],Object.getOwnPropertyDescriptor(Pe.prototype,"disableContentInspect"),Pe.prototype),Ie(Pe.prototype,"setImageModeration",[w5],Object.getOwnPropertyDescriptor(Pe.prototype,"setImageModeration"),Pe.prototype),Ie(Pe.prototype,"setP2PTransport",[C5],Object.getOwnPropertyDescriptor(Pe.prototype,"setP2PTransport"),Pe.prototype),Ie(Pe.prototype,"getJoinChannelServiceRecords",[I5],Object.getOwnPropertyDescriptor(Pe.prototype,"getJoinChannelServiceRecords"),Pe.prototype),Ie(Pe.prototype,"setPublishAudioFilterEnabled",[A5],Object.getOwnPropertyDescriptor(Pe.prototype,"setPublishAudioFilterEnabled"),Pe.prototype),Pe);function x5(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=Wt(5,"client-"),i=Le.reportApiInvoke(null,{id:n,name:_n.CREATE_CLIENT,options:[t],tag:rn.TRACER});try{(function(a){Hn(a.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Hn(a.mode,"config.mode",["rtc","live","p2p"]),a.audioCodec!==void 0&&Hn(a.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),a.proxyServer!==void 0&&Lr(a.proxyServer,"config.proxyServer",1,1e4),a.turnServer!==void 0&&cV(a.turnServer),a.httpRetryConfig!==void 0&&aV(a.httpRetryConfig),a.websocketRetryConfig!==void 0&&aV(a.websocketRetryConfig)})(t)}catch(a){throw i.onError(a),a}return(Yj(16,0,!0)||bI(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",R.debug("browser not support vp9, force use vp8")),Zt("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),i.onSuccess(),new Jae(Bo(Bo({forceWaitGatewayResponse:!0},t),{},{role:ve(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)}function Qae(){let e=!1;const t=Pt();return(t.name===Mt.CHROME&&Number(t.version)>=58&&(ua.engine.name!=="WebKit"||function(){const n=Pt();if(hS()){if(n.os===hr.MAC_OS)return!0;if(n.os===hr.IOS){const i=ua.os.version&&ua.os.version.split(".");if(i&&Number(i[0])===14&&i[1]&&Number(i[1])>=3||i&&Number(i[0])>14)return!0}}return!1}())||t.name===Mt.FIREFOX&&Number(t.version)>=56||t.name===Mt.OPERA&&Number(t.version)>=45||t.name===Mt.SAFARI&&Number(t.version)>=11||t.name==="WebKit"&&(ni()||xo())&&t.osVersion&&Number(t.osVersion.split(".")[0])>=11||Qj()||Pt().name===Mt.QQ)&&(e=!0),e}class s_{constructor(t,n){x(this,"id",0),x(this,"element",void 0),x(this,"peerPair",void 0),x(this,"context",void 0),x(this,"audioPlayerElement",void 0),x(this,"audioTrack",void 0),s_.count+=1,this.id=s_.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(i,a)=>{const c=a==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(c),i.iceGatheringState==="complete"?i.localDescription:new we(d=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&d(i.localDescription)}})},n=async(i,a)=>await i.setRemoteDescription(a);try{const i=await t(this.peerPair[0],"offer");await n(this.peerPair[1],i);const a=await t(this.peerPair[1],"answer");await n(this.peerPair[0],a)}catch(i){throw new se(L.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(a){throw new se(L.LOCAL_AEC_ERROR,a.toString()).print()}if(!n)throw new se(L.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=n.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){R.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var O5,gT;x(s_,"count",0);const $ae=window.AudioContext||window.webkitAudioContext,Zae=new(O5=He({report:Le}),Ie((gT=class{constructor(){x(this,"units",[]),x(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return R.debug("the system does not need to process local aec"),-1;this.context||(this.context=new $ae);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new s_(e,this.context),this.units.push(t)),t.startEchoCancellation(),R.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return Pt().name!==Mt.SAFARI}}).prototype,"processExternalMediaAEC",[O5],Object.getOwnPropertyDescriptor(gT.prototype,"processExternalMediaAEC"),gT.prototype),gT);function P5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function D5(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?P5(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P5(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const gN=window||document;function k5(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!gN)return;const n=er._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const i=a=>{if(!(a&&a.blockedURI&&(er.onSecurityPolicyViolation||er.getListeners(oc.SECURITY_POLICY_VIOLATION).length>0)))return;const c=a.blockedURI;D("CSP_DETECTED_HOSTNAME_LIST").some(d=>ve(c).call(c,d))&&(er.onSecurityPolicyViolation&&typeof er.onSecurityPolicyViolation=="function"&&er.onSecurityPolicyViolation(a),er.getListeners(oc.SECURITY_POLICY_VIOLATION).length>0&&er.safeEmit(oc.SECURITY_POLICY_VIOLATION,a))};n&&gN.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||er.getListeners(oc.SECURITY_POLICY_VIOLATION).length>0)&&gN.addEventListener("securitypolicyviolation",i),er._cspEventHandlerPointer=i}var ece=F,tce=NC,L5=RegExp.prototype,nce=function(e){return e===L5||ece(L5,e)?tce(e):e.flags},fi=u(nce);function gm(e){let t=e.length;for(;--t>=0;)e[t]=0}const _N=256,M5=286,o_=30,a_=15,EN=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),_T=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),rce=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),U5=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Qc=new Array(576);gm(Qc);const c_=new Array(60);gm(c_);const l_=new Array(512);gm(l_);const d_=new Array(256);gm(d_);const vN=new Array(29);gm(vN);const ET=new Array(o_);function yN(e,t,n,i,a){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=a,this.has_stree=e&&e.length}let j5,V5,F5;function SN(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}gm(ET);const B5=e=>e<256?l_[e]:l_[256+(e>>>7)],u_=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},zs=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,u_(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},hc=(e,t,n)=>{zs(e,n[2*t],n[2*t+1])},G5=(e,t)=>{let n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1},W5=(e,t,n)=>{const i=new Array(16);let a,c,d=0;for(a=1;a<=a_;a++)d=d+n[a-1]<<1,i[a]=d;for(c=0;c<=t;c++){let h=e[2*c+1];h!==0&&(e[2*c]=G5(i[h]++,h))}},z5=e=>{let t;for(t=0;t<M5;t++)e.dyn_ltree[2*t]=0;for(t=0;t<o_;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},H5=e=>{e.bi_valid>8?u_(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},K5=(e,t,n,i)=>{const a=2*t,c=2*n;return e[a]<e[c]||e[a]===e[c]&&i[t]<=i[n]},TN=(e,t,n)=>{const i=e.heap[n];let a=n<<1;for(;a<=e.heap_len&&(a<e.heap_len&&K5(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!K5(t,i,e.heap[a],e.depth));)e.heap[n]=e.heap[a],n=a,a<<=1;e.heap[n]=i},q5=(e,t,n)=>{let i,a,c,d,h=0;if(e.sym_next!==0)do i=255&e.pending_buf[e.sym_buf+h++],i+=(255&e.pending_buf[e.sym_buf+h++])<<8,a=e.pending_buf[e.sym_buf+h++],i===0?hc(e,a,t):(c=d_[a],hc(e,c+_N+1,t),d=EN[c],d!==0&&(a-=vN[c],zs(e,a,d)),i--,c=B5(i),hc(e,c,n),d=_T[c],d!==0&&(i-=ET[c],zs(e,i,d)));while(h<e.sym_next);hc(e,256,t)},bN=(e,t)=>{const n=t.dyn_tree,i=t.stat_desc.static_tree,a=t.stat_desc.has_stree,c=t.stat_desc.elems;let d,h,m,g=-1;for(e.heap_len=0,e.heap_max=573,d=0;d<c;d++)n[2*d]!==0?(e.heap[++e.heap_len]=g=d,e.depth[d]=0):n[2*d+1]=0;for(;e.heap_len<2;)m=e.heap[++e.heap_len]=g<2?++g:0,n[2*m]=1,e.depth[m]=0,e.opt_len--,a&&(e.static_len-=i[2*m+1]);for(t.max_code=g,d=e.heap_len>>1;d>=1;d--)TN(e,n,d);m=c;do d=e.heap[1],e.heap[1]=e.heap[e.heap_len--],TN(e,n,1),h=e.heap[1],e.heap[--e.heap_max]=d,e.heap[--e.heap_max]=h,n[2*m]=n[2*d]+n[2*h],e.depth[m]=(e.depth[d]>=e.depth[h]?e.depth[d]:e.depth[h])+1,n[2*d+1]=n[2*h+1]=m,e.heap[1]=m++,TN(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((_,v)=>{const y=v.dyn_tree,b=v.max_code,O=v.stat_desc.static_tree,I=v.stat_desc.has_stree,N=v.stat_desc.extra_bits,k=v.stat_desc.extra_base,j=v.stat_desc.max_length;let G,K,X,z,ne,me,Ee=0;for(z=0;z<=a_;z++)_.bl_count[z]=0;for(y[2*_.heap[_.heap_max]+1]=0,G=_.heap_max+1;G<573;G++)K=_.heap[G],z=y[2*y[2*K+1]+1]+1,z>j&&(z=j,Ee++),y[2*K+1]=z,K>b||(_.bl_count[z]++,ne=0,K>=k&&(ne=N[K-k]),me=y[2*K],_.opt_len+=me*(z+ne),I&&(_.static_len+=me*(O[2*K+1]+ne)));if(Ee!==0){do{for(z=j-1;_.bl_count[z]===0;)z--;_.bl_count[z]--,_.bl_count[z+1]+=2,_.bl_count[j]--,Ee-=2}while(Ee>0);for(z=j;z!==0;z--)for(K=_.bl_count[z];K!==0;)X=_.heap[--G],X>b||(y[2*X+1]!==z&&(_.opt_len+=(z-y[2*X+1])*y[2*X],y[2*X+1]=z),K--)}})(e,t),W5(n,g,e.bl_count)},Y5=(e,t,n)=>{let i,a,c=-1,d=t[1],h=0,m=7,g=4;for(d===0&&(m=138,g=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)a=d,d=t[2*(i+1)+1],++h<m&&a===d||(h<g?e.bl_tree[2*a]+=h:a!==0?(a!==c&&e.bl_tree[2*a]++,e.bl_tree[32]++):h<=10?e.bl_tree[34]++:e.bl_tree[36]++,h=0,c=a,d===0?(m=138,g=3):a===d?(m=6,g=3):(m=7,g=4))},X5=(e,t,n)=>{let i,a,c=-1,d=t[1],h=0,m=7,g=4;for(d===0&&(m=138,g=3),i=0;i<=n;i++)if(a=d,d=t[2*(i+1)+1],!(++h<m&&a===d)){if(h<g)do hc(e,a,e.bl_tree);while(--h!=0);else a!==0?(a!==c&&(hc(e,a,e.bl_tree),h--),hc(e,16,e.bl_tree),zs(e,h-3,2)):h<=10?(hc(e,17,e.bl_tree),zs(e,h-3,3)):(hc(e,18,e.bl_tree),zs(e,h-11,7));h=0,c=a,d===0?(m=138,g=3):a===d?(m=6,g=3):(m=7,g=4)}};let J5=!1;const Q5=(e,t,n,i)=>{zs(e,0+(i?1:0),3),H5(e),u_(e,n),u_(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var ice=e=>{J5||((()=>{let t,n,i,a,c;const d=new Array(16);for(i=0,a=0;a<28;a++)for(vN[a]=i,t=0;t<1<<EN[a];t++)d_[i++]=a;for(d_[i-1]=a,c=0,a=0;a<16;a++)for(ET[a]=c,t=0;t<1<<_T[a];t++)l_[c++]=a;for(c>>=7;a<o_;a++)for(ET[a]=c<<7,t=0;t<1<<_T[a]-7;t++)l_[256+c++]=a;for(n=0;n<=a_;n++)d[n]=0;for(t=0;t<=143;)Qc[2*t+1]=8,t++,d[8]++;for(;t<=255;)Qc[2*t+1]=9,t++,d[9]++;for(;t<=279;)Qc[2*t+1]=7,t++,d[7]++;for(;t<=287;)Qc[2*t+1]=8,t++,d[8]++;for(W5(Qc,287,d),t=0;t<o_;t++)c_[2*t+1]=5,c_[2*t]=G5(t,5);j5=new yN(Qc,EN,257,M5,a_),V5=new yN(c_,_T,0,o_,a_),F5=new yN(new Array(0),rce,0,19,7)})(),J5=!0),e.l_desc=new SN(e.dyn_ltree,j5),e.d_desc=new SN(e.dyn_dtree,V5),e.bl_desc=new SN(e.bl_tree,F5),e.bi_buf=0,e.bi_valid=0,z5(e)},sce=(e,t,n,i)=>{let a,c,d=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(h=>{let m,g=4093624447;for(m=0;m<=31;m++,g>>>=1)if(1&g&&h.dyn_ltree[2*m]!==0)return 0;if(h.dyn_ltree[18]!==0||h.dyn_ltree[20]!==0||h.dyn_ltree[26]!==0)return 1;for(m=32;m<_N;m++)if(h.dyn_ltree[2*m]!==0)return 1;return 0})(e)),bN(e,e.l_desc),bN(e,e.d_desc),d=(h=>{let m;for(Y5(h,h.dyn_ltree,h.l_desc.max_code),Y5(h,h.dyn_dtree,h.d_desc.max_code),bN(h,h.bl_desc),m=18;m>=3&&h.bl_tree[2*U5[m]+1]===0;m--);return h.opt_len+=3*(m+1)+5+5+4,m})(e),a=e.opt_len+3+7>>>3,c=e.static_len+3+7>>>3,c<=a&&(a=c)):a=c=n+5,n+4<=a&&t!==-1?Q5(e,t,n,i):e.strategy===4||c===a?(zs(e,2+(i?1:0),3),q5(e,Qc,c_)):(zs(e,4+(i?1:0),3),((h,m,g,_)=>{let v;for(zs(h,m-257,5),zs(h,g-1,5),zs(h,_-4,4),v=0;v<_;v++)zs(h,h.bl_tree[2*U5[v]+1],3);X5(h,h.dyn_ltree,m-1),X5(h,h.dyn_dtree,g-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,d+1),q5(e,e.dyn_ltree,e.dyn_dtree)),z5(e),i&&H5(e)},oce=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(d_[n]+_N+1)]++,e.dyn_dtree[2*B5(t)]++),e.sym_next===e.sym_end),ace=e=>{zs(e,2,3),hc(e,256,Qc),(t=>{t.bi_valid===16?(u_(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},cce={_tr_init:ice,_tr_stored_block:Q5,_tr_flush_block:sce,_tr_tally:oce,_tr_align:ace},h_=(e,t,n,i)=>{let a=65535&e|0,c=e>>>16&65535|0,d=0;for(;n!==0;){d=n>2e3?2e3:n,n-=d;do a=a+t[i++]|0,c=c+a|0;while(--d);a%=65521,c%=65521}return a|c<<16|0};const lce=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var xi=(e,t,n,i)=>{const a=lce,c=i+n;e^=-1;for(let d=i;d<c;d++)e=e>>>8^a[255&(e^t[d])];return-1^e},nh={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},vT={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:dce,_tr_stored_block:RN,_tr_flush_block:uce,_tr_tally:ud,_tr_align:hce}=cce,{Z_NO_FLUSH:hd,Z_PARTIAL_FLUSH:pce,Z_FULL_FLUSH:mce,Z_FINISH:Go,Z_BLOCK:$5,Z_OK:Gi,Z_STREAM_END:Z5,Z_STREAM_ERROR:pc,Z_DATA_ERROR:fce,Z_BUF_ERROR:wN,Z_DEFAULT_COMPRESSION:gce,Z_FILTERED:_ce,Z_HUFFMAN_ONLY:yT,Z_RLE:Ece,Z_FIXED:vce,Z_DEFAULT_STRATEGY:yce,Z_UNKNOWN:Sce,Z_DEFLATED:ST}=vT,CN=286,Tce=30,bce=19,Rce=2*CN+1,wce=15,rh=258,mc=262,_m=42,ih=113,p_=666,sh=(e,t)=>(e.msg=nh[t],t),e6=e=>2*e-(e>4?9:0),pd=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Cce=e=>{let t,n,i,a=e.w_size;t=e.hash_size,i=t;do n=e.head[--i],e.head[i]=n>=a?n-a:0;while(--t);t=a,i=t;do n=e.prev[--i],e.prev[i]=n>=a?n-a:0;while(--t)};let md=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const lo=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},uo=(e,t)=>{uce(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,lo(e.strm)},Un=(e,t)=>{e.pending_buf[e.pending++]=t},m_=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},IN=(e,t,n,i)=>{let a=e.avail_in;return a>i&&(a=i),a===0?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),n),e.state.wrap===1?e.adler=h_(e.adler,t,a,n):e.state.wrap===2&&(e.adler=xi(e.adler,t,a,n)),e.next_in+=a,e.total_in+=a,a)},t6=(e,t)=>{let n,i,a=e.max_chain_length,c=e.strstart,d=e.prev_length,h=e.nice_match;const m=e.strstart>e.w_size-mc?e.strstart-(e.w_size-mc):0,g=e.window,_=e.w_mask,v=e.prev,y=e.strstart+rh;let b=g[c+d-1],O=g[c+d];e.prev_length>=e.good_match&&(a>>=2),h>e.lookahead&&(h=e.lookahead);do if(n=t,g[n+d]===O&&g[n+d-1]===b&&g[n]===g[c]&&g[++n]===g[c+1]){c+=2,n++;do;while(g[++c]===g[++n]&&g[++c]===g[++n]&&g[++c]===g[++n]&&g[++c]===g[++n]&&g[++c]===g[++n]&&g[++c]===g[++n]&&g[++c]===g[++n]&&g[++c]===g[++n]&&c<y);if(i=rh-(y-c),c=y-rh,i>d){if(e.match_start=t,d=i,i>=h)break;b=g[c+d-1],O=g[c+d]}}while((t=v[t&_])>m&&--a!=0);return d<=e.lookahead?d:e.lookahead},Em=e=>{const t=e.w_size;let n,i,a;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-mc)&&(e.window.set(e.window.subarray(t,t+t-i),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Cce(e),i+=t),e.strm.avail_in===0)break;if(n=IN(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=n,e.lookahead+e.insert>=3)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=md(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=md(e,e.ins_h,e.window[a+3-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<mc&&e.strm.avail_in!==0)},n6=(e,t)=>{let n,i,a,c=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,d=0,h=e.strm.avail_in;do{if(n=65535,a=e.bi_valid+42>>3,e.strm.avail_out<a||(a=e.strm.avail_out-a,i=e.strstart-e.block_start,n>i+e.strm.avail_in&&(n=i+e.strm.avail_in),n>a&&(n=a),n<c&&(n===0&&t!==Go||t===hd||n!==i+e.strm.avail_in)))break;d=t===Go&&n===i+e.strm.avail_in?1:0,RN(e,0,0,d),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,lo(e.strm),i&&(i>n&&(i=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,n-=i),n&&(IN(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(d===0);return h-=e.strm.avail_in,h&&(h>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=h&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-h,e.strm.next_in),e.strstart),e.strstart+=h,e.insert+=h>e.w_size-e.insert?e.w_size-e.insert:h),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),d?4:t!==hd&&t!==Go&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(a=e.window_size-e.strstart,e.strm.avail_in>a&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,a+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),a>e.strm.avail_in&&(a=e.strm.avail_in),a&&(IN(e.strm,e.window,e.strstart,a),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.high_water<e.strstart&&(e.high_water=e.strstart),a=e.bi_valid+42>>3,a=e.pending_buf_size-a>65535?65535:e.pending_buf_size-a,c=a>e.w_size?e.w_size:a,i=e.strstart-e.block_start,(i>=c||(i||t===Go)&&t!==hd&&e.strm.avail_in===0&&i<=a)&&(n=i>a?a:i,d=t===Go&&e.strm.avail_in===0&&n===i?1:0,RN(e,e.block_start,n,d),e.block_start+=n,lo(e.strm)),d?3:1)},AN=(e,t)=>{let n,i;for(;;){if(e.lookahead<mc){if(Em(e),e.lookahead<mc&&t===hd)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=md(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-mc&&(e.match_length=t6(e,n)),e.match_length>=3)if(i=ud(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=md(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=md(e,e.ins_h,e.window[e.strstart+1]);else i=ud(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(uo(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Go?(uo(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(uo(e,!1),e.strm.avail_out===0)?1:2},vm=(e,t)=>{let n,i,a;for(;;){if(e.lookahead<mc){if(Em(e),e.lookahead<mc&&t===hd)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=md(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-mc&&(e.match_length=t6(e,n),e.match_length<=5&&(e.strategy===_ce||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-3,i=ud(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=a&&(e.ins_h=md(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(uo(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(i=ud(e,0,e.window[e.strstart-1]),i&&uo(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=ud(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Go?(uo(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(uo(e,!1),e.strm.avail_out===0)?1:2};function fc(e,t,n,i,a){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=a}const f_=[new fc(0,0,0,0,n6),new fc(4,4,8,4,AN),new fc(4,5,16,8,AN),new fc(4,6,32,32,AN),new fc(4,4,16,16,vm),new fc(8,16,32,32,vm),new fc(8,16,128,128,vm),new fc(8,32,128,256,vm),new fc(32,128,258,1024,vm),new fc(32,258,258,4096,vm)];function Ice(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ST,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Rce),this.dyn_dtree=new Uint16Array(2*(2*Tce+1)),this.bl_tree=new Uint16Array(2*(2*bce+1)),pd(this.dyn_ltree),pd(this.dyn_dtree),pd(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(wce+1),this.heap=new Uint16Array(2*CN+1),pd(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*CN+1),pd(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const g_=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==_m&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==ih&&t.status!==p_?1:0},r6=e=>{if(g_(e))return sh(e,pc);e.total_in=e.total_out=0,e.data_type=Sce;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?_m:ih,e.adler=t.wrap===2?0:1,t.last_flush=-2,dce(t),Gi},i6=e=>{const t=r6(e);return t===Gi&&(n=>{n.window_size=2*n.w_size,pd(n.head),n.max_lazy_match=f_[n.level].max_lazy,n.good_match=f_[n.level].good_length,n.nice_match=f_[n.level].nice_length,n.max_chain_length=f_[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(e.state),t},s6=(e,t,n,i,a,c)=>{if(!e)return pc;let d=1;if(t===gce&&(t=6),i<0?(d=0,i=-i):i>15&&(d=2,i-=16),a<1||a>9||n!==ST||i<8||i>15||t<0||t>9||c<0||c>vce||i===8&&d!==1)return sh(e,pc);i===8&&(i=9);const h=new Ice;return e.state=h,h.strm=e,h.status=_m,h.wrap=d,h.gzhead=null,h.w_bits=i,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=a+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+3-1)/3),h.window=new Uint8Array(2*h.w_size),h.head=new Uint16Array(h.hash_size),h.prev=new Uint16Array(h.w_size),h.lit_bufsize=1<<a+6,h.pending_buf_size=4*h.lit_bufsize,h.pending_buf=new Uint8Array(h.pending_buf_size),h.sym_buf=h.lit_bufsize,h.sym_end=3*(h.lit_bufsize-1),h.level=t,h.strategy=c,h.method=n,i6(e)};var Ace=(e,t)=>{if(g_(e)||t>$5||t<0)return e?sh(e,pc):pc;const n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===p_&&t!==Go)return sh(e,e.avail_out===0?wN:pc);const i=n.last_flush;if(n.last_flush=t,n.pending!==0){if(lo(e),e.avail_out===0)return n.last_flush=-1,Gi}else if(e.avail_in===0&&e6(t)<=e6(i)&&t!==Go)return sh(e,wN);if(n.status===p_&&e.avail_in!==0)return sh(e,wN);if(n.status===_m&&n.wrap===0&&(n.status=ih),n.status===_m){let a=ST+(n.w_bits-8<<4)<<8,c=-1;if(c=n.strategy>=yT||n.level<2?0:n.level<6?1:n.level===6?2:3,a|=c<<6,n.strstart!==0&&(a|=32),a+=31-a%31,m_(n,a),n.strstart!==0&&(m_(n,e.adler>>>16),m_(n,65535&e.adler)),e.adler=1,n.status=ih,lo(e),n.pending!==0)return n.last_flush=-1,Gi}if(n.status===57){if(e.adler=0,Un(n,31),Un(n,139),Un(n,8),n.gzhead)Un(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Un(n,255&n.gzhead.time),Un(n,n.gzhead.time>>8&255),Un(n,n.gzhead.time>>16&255),Un(n,n.gzhead.time>>24&255),Un(n,n.level===9?2:n.strategy>=yT||n.level<2?4:0),Un(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Un(n,255&n.gzhead.extra.length),Un(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=xi(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Un(n,0),Un(n,0),Un(n,0),Un(n,0),Un(n,0),Un(n,n.level===9?2:n.strategy>=yT||n.level<2?4:0),Un(n,3),n.status=ih,lo(e),n.pending!==0)return n.last_flush=-1,Gi}if(n.status===69){if(n.gzhead.extra){let a=n.pending,c=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+c>n.pending_buf_size;){let h=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+h),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>a&&(e.adler=xi(e.adler,n.pending_buf,n.pending-a,a)),n.gzindex+=h,lo(e),n.pending!==0)return n.last_flush=-1,Gi;a=0,c-=h}let d=new Uint8Array(n.gzhead.extra);n.pending_buf.set(d.subarray(n.gzindex,n.gzindex+c),n.pending),n.pending+=c,n.gzhead.hcrc&&n.pending>a&&(e.adler=xi(e.adler,n.pending_buf,n.pending-a,a)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let a,c=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>c&&(e.adler=xi(e.adler,n.pending_buf,n.pending-c,c)),lo(e),n.pending!==0)return n.last_flush=-1,Gi;c=0}a=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Un(n,a)}while(a!==0);n.gzhead.hcrc&&n.pending>c&&(e.adler=xi(e.adler,n.pending_buf,n.pending-c,c)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let a,c=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>c&&(e.adler=xi(e.adler,n.pending_buf,n.pending-c,c)),lo(e),n.pending!==0)return n.last_flush=-1,Gi;c=0}a=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Un(n,a)}while(a!==0);n.gzhead.hcrc&&n.pending>c&&(e.adler=xi(e.adler,n.pending_buf,n.pending-c,c))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(lo(e),n.pending!==0))return n.last_flush=-1,Gi;Un(n,255&e.adler),Un(n,e.adler>>8&255),e.adler=0}if(n.status=ih,lo(e),n.pending!==0)return n.last_flush=-1,Gi}if(e.avail_in!==0||n.lookahead!==0||t!==hd&&n.status!==p_){let a=n.level===0?n6(n,t):n.strategy===yT?((c,d)=>{let h;for(;;){if(c.lookahead===0&&(Em(c),c.lookahead===0)){if(d===hd)return 1;break}if(c.match_length=0,h=ud(c,0,c.window[c.strstart]),c.lookahead--,c.strstart++,h&&(uo(c,!1),c.strm.avail_out===0))return 1}return c.insert=0,d===Go?(uo(c,!0),c.strm.avail_out===0?3:4):c.sym_next&&(uo(c,!1),c.strm.avail_out===0)?1:2})(n,t):n.strategy===Ece?((c,d)=>{let h,m,g,_;const v=c.window;for(;;){if(c.lookahead<=rh){if(Em(c),c.lookahead<=rh&&d===hd)return 1;if(c.lookahead===0)break}if(c.match_length=0,c.lookahead>=3&&c.strstart>0&&(g=c.strstart-1,m=v[g],m===v[++g]&&m===v[++g]&&m===v[++g])){_=c.strstart+rh;do;while(m===v[++g]&&m===v[++g]&&m===v[++g]&&m===v[++g]&&m===v[++g]&&m===v[++g]&&m===v[++g]&&m===v[++g]&&g<_);c.match_length=rh-(_-g),c.match_length>c.lookahead&&(c.match_length=c.lookahead)}if(c.match_length>=3?(h=ud(c,1,c.match_length-3),c.lookahead-=c.match_length,c.strstart+=c.match_length,c.match_length=0):(h=ud(c,0,c.window[c.strstart]),c.lookahead--,c.strstart++),h&&(uo(c,!1),c.strm.avail_out===0))return 1}return c.insert=0,d===Go?(uo(c,!0),c.strm.avail_out===0?3:4):c.sym_next&&(uo(c,!1),c.strm.avail_out===0)?1:2})(n,t):f_[n.level].func(n,t);if(a!==3&&a!==4||(n.status=p_),a===1||a===3)return e.avail_out===0&&(n.last_flush=-1),Gi;if(a===2&&(t===pce?hce(n):t!==$5&&(RN(n,0,0,!1),t===mce&&(pd(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),lo(e),e.avail_out===0))return n.last_flush=-1,Gi}return t!==Go?Gi:n.wrap<=0?Z5:(n.wrap===2?(Un(n,255&e.adler),Un(n,e.adler>>8&255),Un(n,e.adler>>16&255),Un(n,e.adler>>24&255),Un(n,255&e.total_in),Un(n,e.total_in>>8&255),Un(n,e.total_in>>16&255),Un(n,e.total_in>>24&255)):(m_(n,e.adler>>>16),m_(n,65535&e.adler)),lo(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?Gi:Z5)},Nce=(e,t)=>{let n=t.length;if(g_(e))return pc;const i=e.state,a=i.wrap;if(a===2||a===1&&i.status!==_m||i.lookahead)return pc;if(a===1&&(e.adler=h_(e.adler,t,n,0)),i.wrap=0,n>=i.w_size){a===0&&(pd(i.head),i.strstart=0,i.block_start=0,i.insert=0);let m=new Uint8Array(i.w_size);m.set(t.subarray(n-i.w_size,n),0),t=m,n=i.w_size}const c=e.avail_in,d=e.next_in,h=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,Em(i);i.lookahead>=3;){let m=i.strstart,g=i.lookahead-2;do i.ins_h=md(i,i.ins_h,i.window[m+3-1]),i.prev[m&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=m,m++;while(--g);i.strstart=m,i.lookahead=2,Em(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=d,e.input=h,e.avail_in=c,i.wrap=a,Gi},__={deflateInit:(e,t)=>s6(e,t,ST,15,8,yce),deflateInit2:s6,deflateReset:i6,deflateResetKeep:r6,deflateSetHeader:(e,t)=>g_(e)||e.state.wrap!==2?pc:(e.state.gzhead=t,Gi),deflate:Ace,deflateEnd:e=>{if(g_(e))return pc;const t=e.state.status;return e.state=null,t===ih?sh(e,fce):Gi},deflateSetDictionary:Nce,deflateInfo:"pako deflate (from Nodeca project)"};const xce=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var TT={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const i in n)xce(n,i)&&(e[i]=n[i])}}return e},flattenChunks:e=>{let t=0;for(let i=0,a=e.length;i<a;i++)t+=e[i].length;const n=new Uint8Array(t);for(let i=0,a=0,c=e.length;i<c;i++){let d=e[i];n.set(d,a),a+=d.length}return n}};let o6=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o6=!1}const E_=new Uint8Array(256);for(let e=0;e<256;e++)E_[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;E_[254]=E_[254]=1;var v_={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,i,a,c,d=e.length,h=0;for(a=0;a<d;a++)n=e.charCodeAt(a),(64512&n)==55296&&a+1<d&&(i=e.charCodeAt(a+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),a++)),h+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(h),c=0,a=0;c<h;a++)n=e.charCodeAt(a),(64512&n)==55296&&a+1<d&&(i=e.charCodeAt(a+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),a++)),n<128?t[c++]=n:n<2048?(t[c++]=192|n>>>6,t[c++]=128|63&n):n<65536?(t[c++]=224|n>>>12,t[c++]=128|n>>>6&63,t[c++]=128|63&n):(t[c++]=240|n>>>18,t[c++]=128|n>>>12&63,t[c++]=128|n>>>6&63,t[c++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let i,a;const c=new Array(2*n);for(a=0,i=0;i<n;){let d=e[i++];if(d<128){c[a++]=d;continue}let h=E_[d];if(h>4)c[a++]=65533,i+=h-1;else{for(d&=h===2?31:h===3?15:7;h>1&&i<n;)d=d<<6|63&e[i++],h--;h>1?c[a++]=65533:d<65536?c[a++]=d:(d-=65536,c[a++]=55296|d>>10&1023,c[a++]=56320|1023&d)}}return((d,h)=>{if(h<65534&&d.subarray&&o6)return String.fromCharCode.apply(null,d.length===h?d:d.subarray(0,h));let m="";for(let g=0;g<h;g++)m+=String.fromCharCode(d[g]);return m})(c,a)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(192&e[n])==128;)n--;return n<0||n===0?t:n+E_[e[n]]>t?n:t}},a6=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const c6=Object.prototype.toString,{Z_NO_FLUSH:Oce,Z_SYNC_FLUSH:Pce,Z_FULL_FLUSH:Dce,Z_FINISH:kce,Z_OK:bT,Z_STREAM_END:Lce,Z_DEFAULT_COMPRESSION:Mce,Z_DEFAULT_STRATEGY:Uce,Z_DEFLATED:jce}=vT;function RT(e){this.options=TT.assign({level:Mce,method:jce,chunkSize:16384,windowBits:15,memLevel:8,strategy:Uce},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a6,this.strm.avail_out=0;let n=__.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==bT)throw new Error(nh[n]);if(t.header&&__.deflateSetHeader(this.strm,t.header),t.dictionary){let i;if(i=typeof t.dictionary=="string"?v_.string2buf(t.dictionary):c6.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,n=__.deflateSetDictionary(this.strm,i),n!==bT)throw new Error(nh[n]);this._dict_set=!0}}function l6(e,t){const n=new RT(t);if(n.push(e,!0),n.err)throw n.msg||nh[n.err];return n.result}RT.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize;let a,c;if(this.ended)return!1;for(c=t===~~t?t:t===!0?kce:Oce,typeof e=="string"?n.input=v_.string2buf(e):c6.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),(c===Pce||c===Dce)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(a=__.deflate(n,c),a===Lce)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),a=__.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===bT;if(n.avail_out!==0){if(c>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},RT.prototype.onData=function(e){this.chunks.push(e)},RT.prototype.onEnd=function(e){e===bT&&(this.result=TT.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Vce={deflate:l6,deflateRaw:function(e,t){return(t=t||{}).raw=!0,l6(e,t)}};const wT=16209;var Fce=function(e,t){let n,i,a,c,d,h,m,g,_,v,y,b,O,I,N,k,j,G,K,X,z,ne,me,Ee;const Oe=e.state;n=e.next_in,me=e.input,i=n+(e.avail_in-5),a=e.next_out,Ee=e.output,c=a-(t-e.avail_out),d=a+(e.avail_out-257),h=Oe.dmax,m=Oe.wsize,g=Oe.whave,_=Oe.wnext,v=Oe.window,y=Oe.hold,b=Oe.bits,O=Oe.lencode,I=Oe.distcode,N=(1<<Oe.lenbits)-1,k=(1<<Oe.distbits)-1;e:do{b<15&&(y+=me[n++]<<b,b+=8,y+=me[n++]<<b,b+=8),j=O[y&N];t:for(;;){if(G=j>>>24,y>>>=G,b-=G,G=j>>>16&255,G===0)Ee[a++]=65535&j;else{if(!(16&G)){if(!(64&G)){j=O[(65535&j)+(y&(1<<G)-1)];continue t}if(32&G){Oe.mode=16191;break e}e.msg="invalid literal/length code",Oe.mode=wT;break e}K=65535&j,G&=15,G&&(b<G&&(y+=me[n++]<<b,b+=8),K+=y&(1<<G)-1,y>>>=G,b-=G),b<15&&(y+=me[n++]<<b,b+=8,y+=me[n++]<<b,b+=8),j=I[y&k];n:for(;;){if(G=j>>>24,y>>>=G,b-=G,G=j>>>16&255,!(16&G)){if(!(64&G)){j=I[(65535&j)+(y&(1<<G)-1)];continue n}e.msg="invalid distance code",Oe.mode=wT;break e}if(X=65535&j,G&=15,b<G&&(y+=me[n++]<<b,b+=8,b<G&&(y+=me[n++]<<b,b+=8)),X+=y&(1<<G)-1,X>h){e.msg="invalid distance too far back",Oe.mode=wT;break e}if(y>>>=G,b-=G,G=a-c,X>G){if(G=X-G,G>g&&Oe.sane){e.msg="invalid distance too far back",Oe.mode=wT;break e}if(z=0,ne=v,_===0){if(z+=m-G,G<K){K-=G;do Ee[a++]=v[z++];while(--G);z=a-X,ne=Ee}}else if(_<G){if(z+=m+_-G,G-=_,G<K){K-=G;do Ee[a++]=v[z++];while(--G);if(z=0,_<K){G=_,K-=G;do Ee[a++]=v[z++];while(--G);z=a-X,ne=Ee}}}else if(z+=_-G,G<K){K-=G;do Ee[a++]=v[z++];while(--G);z=a-X,ne=Ee}for(;K>2;)Ee[a++]=ne[z++],Ee[a++]=ne[z++],Ee[a++]=ne[z++],K-=3;K&&(Ee[a++]=ne[z++],K>1&&(Ee[a++]=ne[z++]))}else{z=a-X;do Ee[a++]=Ee[z++],Ee[a++]=Ee[z++],Ee[a++]=Ee[z++],K-=3;while(K>2);K&&(Ee[a++]=Ee[z++],K>1&&(Ee[a++]=Ee[z++]))}break}}break}}while(n<i&&a<d);K=b>>3,n-=K,b-=K<<3,y&=(1<<b)-1,e.next_in=n,e.next_out=a,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=a<d?d-a+257:257-(a-d),Oe.hold=y,Oe.bits=b};const CT=15,Bce=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Gce=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Wce=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),zce=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var y_=(e,t,n,i,a,c,d,h)=>{const m=h.bits;let g,_,v,y,b,O,I=0,N=0,k=0,j=0,G=0,K=0,X=0,z=0,ne=0,me=0,Ee=null;const Oe=new Uint16Array(16),Qe=new Uint16Array(16);let qe,dt,at,Ut=null;for(I=0;I<=CT;I++)Oe[I]=0;for(N=0;N<i;N++)Oe[t[n+N]]++;for(G=m,j=CT;j>=1&&Oe[j]===0;j--);if(G>j&&(G=j),j===0)return a[c++]=20971520,a[c++]=20971520,h.bits=1,0;for(k=1;k<j&&Oe[k]===0;k++);for(G<k&&(G=k),z=1,I=1;I<=CT;I++)if(z<<=1,z-=Oe[I],z<0)return-1;if(z>0&&(e===0||j!==1))return-1;for(Qe[1]=0,I=1;I<CT;I++)Qe[I+1]=Qe[I]+Oe[I];for(N=0;N<i;N++)t[n+N]!==0&&(d[Qe[t[n+N]]++]=N);if(e===0?(Ee=Ut=d,O=20):e===1?(Ee=Bce,Ut=Gce,O=257):(Ee=Wce,Ut=zce,O=0),me=0,N=0,I=k,b=c,K=G,X=0,v=-1,ne=1<<G,y=ne-1,e===1&&ne>852||e===2&&ne>592)return 1;for(;;){qe=I-X,d[N]+1<O?(dt=0,at=d[N]):d[N]>=O?(dt=Ut[d[N]-O],at=Ee[d[N]-O]):(dt=96,at=0),g=1<<I-X,_=1<<K,k=_;do _-=g,a[b+(me>>X)+_]=qe<<24|dt<<16|at|0;while(_!==0);for(g=1<<I-1;me&g;)g>>=1;if(g!==0?(me&=g-1,me+=g):me=0,N++,--Oe[I]==0){if(I===j)break;I=t[n+d[N]]}if(I>G&&(me&y)!==v){for(X===0&&(X=G),b+=k,K=I-X,z=1<<K;K+X<j&&(z-=Oe[K+X],!(z<=0));)K++,z<<=1;if(ne+=1<<K,e===1&&ne>852||e===2&&ne>592)return 1;v=me&y,a[v]=G<<24|K<<16|b-c|0}}return me!==0&&(a[b+me]=I-X<<24|64<<16|0),h.bits=G,0};const{Z_FINISH:d6,Z_BLOCK:Hce,Z_TREES:IT,Z_OK:oh,Z_STREAM_END:Kce,Z_NEED_DICT:qce,Z_STREAM_ERROR:Wo,Z_DATA_ERROR:u6,Z_MEM_ERROR:h6,Z_BUF_ERROR:Yce,Z_DEFLATED:p6}=vT,AT=16180,NT=16190,$c=16191,NN=16192,xN=16194,xT=16199,OT=16200,ON=16206,xr=16209,m6=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Xce(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const ah=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<AT||t.mode>16211?1:0},f6=e=>{if(ah(e))return Wo;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=AT,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,oh},g6=e=>{if(ah(e))return Wo;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,f6(e)},_6=(e,t)=>{let n;if(ah(e))return Wo;const i=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Wo:(i.window!==null&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,g6(e))},E6=(e,t)=>{if(!e)return Wo;const n=new Xce;e.state=n,n.strm=e,n.window=null,n.mode=AT;const i=_6(e,t);return i!==oh&&(e.state=null),i};let PN,DN,v6=!0;const Jce=e=>{if(v6){PN=new Int32Array(512),DN=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(y_(1,e.lens,0,288,PN,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;y_(2,e.lens,0,32,DN,0,e.work,{bits:5}),v6=!1}e.lencode=PN,e.lenbits=9,e.distcode=DN,e.distbits=5},y6=(e,t,n,i)=>{let a;const c=e.state;return c.window===null&&(c.wsize=1<<c.wbits,c.wnext=0,c.whave=0,c.window=new Uint8Array(c.wsize)),i>=c.wsize?(c.window.set(t.subarray(n-c.wsize,n),0),c.wnext=0,c.whave=c.wsize):(a=c.wsize-c.wnext,a>i&&(a=i),c.window.set(t.subarray(n-i,n-i+a),c.wnext),(i-=a)?(c.window.set(t.subarray(n-i,n),0),c.wnext=i,c.whave=c.wsize):(c.wnext+=a,c.wnext===c.wsize&&(c.wnext=0),c.whave<c.wsize&&(c.whave+=a))),0};var Qce=(e,t)=>{let n,i,a,c,d,h,m,g,_,v,y,b,O,I,N,k,j,G,K,X,z,ne,me=0;const Ee=new Uint8Array(4);let Oe,Qe;const qe=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(ah(e)||!e.output||!e.input&&e.avail_in!==0)return Wo;n=e.state,n.mode===$c&&(n.mode=NN),d=e.next_out,a=e.output,m=e.avail_out,c=e.next_in,i=e.input,h=e.avail_in,g=n.hold,_=n.bits,v=h,y=m,ne=oh;e:for(;;)switch(n.mode){case AT:if(n.wrap===0){n.mode=NN;break}for(;_<16;){if(h===0)break e;h--,g+=i[c++]<<_,_+=8}if(2&n.wrap&&g===35615){n.wbits===0&&(n.wbits=15),n.check=0,Ee[0]=255&g,Ee[1]=g>>>8&255,n.check=xi(n.check,Ee,2,0),g=0,_=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&g)<<8)+(g>>8))%31){e.msg="incorrect header check",n.mode=xr;break}if((15&g)!==p6){e.msg="unknown compression method",n.mode=xr;break}if(g>>>=4,_-=4,z=8+(15&g),n.wbits===0&&(n.wbits=z),z>15||z>n.wbits){e.msg="invalid window size",n.mode=xr;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&g?16189:$c,g=0,_=0;break;case 16181:for(;_<16;){if(h===0)break e;h--,g+=i[c++]<<_,_+=8}if(n.flags=g,(255&fi(n))!==p6){e.msg="unknown compression method",n.mode=xr;break}if(57344&fi(n)){e.msg="unknown header flags set",n.mode=xr;break}n.head&&(n.head.text=g>>8&1),512&fi(n)&&4&n.wrap&&(Ee[0]=255&g,Ee[1]=g>>>8&255,n.check=xi(n.check,Ee,2,0)),g=0,_=0,n.mode=16182;case 16182:for(;_<32;){if(h===0)break e;h--,g+=i[c++]<<_,_+=8}n.head&&(n.head.time=g),512&fi(n)&&4&n.wrap&&(Ee[0]=255&g,Ee[1]=g>>>8&255,Ee[2]=g>>>16&255,Ee[3]=g>>>24&255,n.check=xi(n.check,Ee,4,0)),g=0,_=0,n.mode=16183;case 16183:for(;_<16;){if(h===0)break e;h--,g+=i[c++]<<_,_+=8}n.head&&(n.head.xflags=255&g,n.head.os=g>>8),512&fi(n)&&4&n.wrap&&(Ee[0]=255&g,Ee[1]=g>>>8&255,n.check=xi(n.check,Ee,2,0)),g=0,_=0,n.mode=16184;case 16184:if(1024&fi(n)){for(;_<16;){if(h===0)break e;h--,g+=i[c++]<<_,_+=8}n.length=g,n.head&&(n.head.extra_len=g),512&fi(n)&&4&n.wrap&&(Ee[0]=255&g,Ee[1]=g>>>8&255,n.check=xi(n.check,Ee,2,0)),g=0,_=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&fi(n)&&(b=n.length,b>h&&(b=h),b&&(n.head&&(z=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(c,c+b),z)),512&fi(n)&&4&n.wrap&&(n.check=xi(n.check,i,b,c)),h-=b,c+=b,n.length-=b),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&fi(n)){if(h===0)break e;b=0;do z=i[c+b++],n.head&&z&&n.length<65536&&(n.head.name+=String.fromCharCode(z));while(z&&b<h);if(512&fi(n)&&4&n.wrap&&(n.check=xi(n.check,i,b,c)),h-=b,c+=b,z)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&fi(n)){if(h===0)break e;b=0;do z=i[c+b++],n.head&&z&&n.length<65536&&(n.head.comment+=String.fromCharCode(z));while(z&&b<h);if(512&fi(n)&&4&n.wrap&&(n.check=xi(n.check,i,b,c)),h-=b,c+=b,z)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&fi(n)){for(;_<16;){if(h===0)break e;h--,g+=i[c++]<<_,_+=8}if(4&n.wrap&&g!==(65535&n.check)){e.msg="header crc mismatch",n.mode=xr;break}g=0,_=0}n.head&&(n.head.hcrc=fi(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=$c;break;case 16189:for(;_<32;){if(h===0)break e;h--,g+=i[c++]<<_,_+=8}e.adler=n.check=m6(g),g=0,_=0,n.mode=NT;case NT:if(n.havedict===0)return e.next_out=d,e.avail_out=m,e.next_in=c,e.avail_in=h,n.hold=g,n.bits=_,qce;e.adler=n.check=1,n.mode=$c;case $c:if(t===Hce||t===IT)break e;case NN:if(n.last){g>>>=7&_,_-=7&_,n.mode=ON;break}for(;_<3;){if(h===0)break e;h--,g+=i[c++]<<_,_+=8}switch(n.last=1&g,g>>>=1,_-=1,3&g){case 0:n.mode=16193;break;case 1:if(Jce(n),n.mode=xT,t===IT){g>>>=2,_-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=xr}g>>>=2,_-=2;break;case 16193:for(g>>>=7&_,_-=7&_;_<32;){if(h===0)break e;h--,g+=i[c++]<<_,_+=8}if((65535&g)!=(g>>>16^65535)){e.msg="invalid stored block lengths",n.mode=xr;break}if(n.length=65535&g,g=0,_=0,n.mode=xN,t===IT)break e;case xN:n.mode=16195;case 16195:if(b=n.length,b){if(b>h&&(b=h),b>m&&(b=m),b===0)break e;a.set(i.subarray(c,c+b),d),h-=b,c+=b,m-=b,d+=b,n.length-=b;break}n.mode=$c;break;case 16196:for(;_<14;){if(h===0)break e;h--,g+=i[c++]<<_,_+=8}if(n.nlen=257+(31&g),g>>>=5,_-=5,n.ndist=1+(31&g),g>>>=5,_-=5,n.ncode=4+(15&g),g>>>=4,_-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=xr;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;_<3;){if(h===0)break e;h--,g+=i[c++]<<_,_+=8}n.lens[qe[n.have++]]=7&g,g>>>=3,_-=3}for(;n.have<19;)n.lens[qe[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Oe={bits:n.lenbits},ne=y_(0,n.lens,0,19,n.lencode,0,n.work,Oe),n.lenbits=Oe.bits,ne){e.msg="invalid code lengths set",n.mode=xr;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;me=n.lencode[g&(1<<n.lenbits)-1],N=me>>>24,k=me>>>16&255,j=65535&me,!(N<=_);){if(h===0)break e;h--,g+=i[c++]<<_,_+=8}if(j<16)g>>>=N,_-=N,n.lens[n.have++]=j;else{if(j===16){for(Qe=N+2;_<Qe;){if(h===0)break e;h--,g+=i[c++]<<_,_+=8}if(g>>>=N,_-=N,n.have===0){e.msg="invalid bit length repeat",n.mode=xr;break}z=n.lens[n.have-1],b=3+(3&g),g>>>=2,_-=2}else if(j===17){for(Qe=N+3;_<Qe;){if(h===0)break e;h--,g+=i[c++]<<_,_+=8}g>>>=N,_-=N,z=0,b=3+(7&g),g>>>=3,_-=3}else{for(Qe=N+7;_<Qe;){if(h===0)break e;h--,g+=i[c++]<<_,_+=8}g>>>=N,_-=N,z=0,b=11+(127&g),g>>>=7,_-=7}if(n.have+b>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=xr;break}for(;b--;)n.lens[n.have++]=z}}if(n.mode===xr)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=xr;break}if(n.lenbits=9,Oe={bits:n.lenbits},ne=y_(1,n.lens,0,n.nlen,n.lencode,0,n.work,Oe),n.lenbits=Oe.bits,ne){e.msg="invalid literal/lengths set",n.mode=xr;break}if(n.distbits=6,n.distcode=n.distdyn,Oe={bits:n.distbits},ne=y_(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Oe),n.distbits=Oe.bits,ne){e.msg="invalid distances set",n.mode=xr;break}if(n.mode=xT,t===IT)break e;case xT:n.mode=OT;case OT:if(h>=6&&m>=258){e.next_out=d,e.avail_out=m,e.next_in=c,e.avail_in=h,n.hold=g,n.bits=_,Fce(e,y),d=e.next_out,a=e.output,m=e.avail_out,c=e.next_in,i=e.input,h=e.avail_in,g=n.hold,_=n.bits,n.mode===$c&&(n.back=-1);break}for(n.back=0;me=n.lencode[g&(1<<n.lenbits)-1],N=me>>>24,k=me>>>16&255,j=65535&me,!(N<=_);){if(h===0)break e;h--,g+=i[c++]<<_,_+=8}if(k&&!(240&k)){for(G=N,K=k,X=j;me=n.lencode[X+((g&(1<<G+K)-1)>>G)],N=me>>>24,k=me>>>16&255,j=65535&me,!(G+N<=_);){if(h===0)break e;h--,g+=i[c++]<<_,_+=8}g>>>=G,_-=G,n.back+=G}if(g>>>=N,_-=N,n.back+=N,n.length=j,k===0){n.mode=16205;break}if(32&k){n.back=-1,n.mode=$c;break}if(64&k){e.msg="invalid literal/length code",n.mode=xr;break}n.extra=15&k,n.mode=16201;case 16201:if(n.extra){for(Qe=n.extra;_<Qe;){if(h===0)break e;h--,g+=i[c++]<<_,_+=8}n.length+=g&(1<<n.extra)-1,g>>>=n.extra,_-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;me=n.distcode[g&(1<<n.distbits)-1],N=me>>>24,k=me>>>16&255,j=65535&me,!(N<=_);){if(h===0)break e;h--,g+=i[c++]<<_,_+=8}if(!(240&k)){for(G=N,K=k,X=j;me=n.distcode[X+((g&(1<<G+K)-1)>>G)],N=me>>>24,k=me>>>16&255,j=65535&me,!(G+N<=_);){if(h===0)break e;h--,g+=i[c++]<<_,_+=8}g>>>=G,_-=G,n.back+=G}if(g>>>=N,_-=N,n.back+=N,64&k){e.msg="invalid distance code",n.mode=xr;break}n.offset=j,n.extra=15&k,n.mode=16203;case 16203:if(n.extra){for(Qe=n.extra;_<Qe;){if(h===0)break e;h--,g+=i[c++]<<_,_+=8}n.offset+=g&(1<<n.extra)-1,g>>>=n.extra,_-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=xr;break}n.mode=16204;case 16204:if(m===0)break e;if(b=y-m,n.offset>b){if(b=n.offset-b,b>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=xr;break}b>n.wnext?(b-=n.wnext,O=n.wsize-b):O=n.wnext-b,b>n.length&&(b=n.length),I=n.window}else I=a,O=d-n.offset,b=n.length;b>m&&(b=m),m-=b,n.length-=b;do a[d++]=I[O++];while(--b);n.length===0&&(n.mode=OT);break;case 16205:if(m===0)break e;a[d++]=n.length,m--,n.mode=OT;break;case ON:if(n.wrap){for(;_<32;){if(h===0)break e;h--,g|=i[c++]<<_,_+=8}if(y-=m,e.total_out+=y,n.total+=y,4&n.wrap&&y&&(e.adler=n.check=fi(n)?xi(n.check,a,y,d-y):h_(n.check,a,y,d-y)),y=m,4&n.wrap&&(fi(n)?g:m6(g))!==n.check){e.msg="incorrect data check",n.mode=xr;break}g=0,_=0}n.mode=16207;case 16207:if(n.wrap&&fi(n)){for(;_<32;){if(h===0)break e;h--,g+=i[c++]<<_,_+=8}if(4&n.wrap&&g!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=xr;break}g=0,_=0}n.mode=16208;case 16208:ne=Kce;break e;case xr:ne=u6;break e;case 16210:return h6;default:return Wo}return e.next_out=d,e.avail_out=m,e.next_in=c,e.avail_in=h,n.hold=g,n.bits=_,(n.wsize||y!==e.avail_out&&n.mode<xr&&(n.mode<ON||t!==d6))&&y6(e,e.output,e.next_out,y-e.avail_out),v-=e.avail_in,y-=e.avail_out,e.total_in+=v,e.total_out+=y,n.total+=y,4&n.wrap&&y&&(e.adler=n.check=fi(n)?xi(n.check,a,y,e.next_out-y):h_(n.check,a,y,e.next_out-y)),e.data_type=n.bits+(n.last?64:0)+(n.mode===$c?128:0)+(n.mode===xT||n.mode===xN?256:0),(v===0&&y===0||t===d6)&&ne===oh&&(ne=Yce),ne},Zc={inflateReset:g6,inflateReset2:_6,inflateResetKeep:f6,inflateInit:e=>E6(e,15),inflateInit2:E6,inflate:Qce,inflateEnd:e=>{if(ah(e))return Wo;let t=e.state;return t.window&&(t.window=null),e.state=null,oh},inflateGetHeader:(e,t)=>{if(ah(e))return Wo;const n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,oh):Wo},inflateSetDictionary:(e,t)=>{const n=t.length;let i,a,c;return ah(e)?Wo:(i=e.state,i.wrap!==0&&i.mode!==NT?Wo:i.mode===NT&&(a=1,a=h_(a,t,n,0),a!==i.check)?u6:(c=y6(e,t,n,n),c?(i.mode=16210,h6):(i.havedict=1,oh)))},inflateInfo:"pako inflate (from Nodeca project)"},$ce=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const S6=Object.prototype.toString,{Z_NO_FLUSH:Zce,Z_FINISH:ele,Z_OK:S_,Z_STREAM_END:kN,Z_NEED_DICT:LN,Z_STREAM_ERROR:tle,Z_DATA_ERROR:T6,Z_MEM_ERROR:nle}=vT;function PT(e){this.options=TT.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a6,this.strm.avail_out=0;let n=Zc.inflateInit2(this.strm,t.windowBits);if(n!==S_)throw new Error(nh[n]);if(this.header=new $ce,Zc.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=v_.string2buf(t.dictionary):S6.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Zc.inflateSetDictionary(this.strm,t.dictionary),n!==S_)))throw new Error(nh[n])}function b6(e,t){const n=new PT(t);if(n.push(e),n.err)throw n.msg||nh[n.err];return n.result}PT.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize,a=this.options.dictionary;let c,d,h;if(this.ended)return!1;for(d=t===~~t?t:t===!0?ele:Zce,S6.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),c=Zc.inflate(n,d),c===LN&&a&&(c=Zc.inflateSetDictionary(n,a),c===S_?c=Zc.inflate(n,d):c===T6&&(c=LN));n.avail_in>0&&c===kN&&n.state.wrap>0&&e[n.next_in]!==0;)Zc.inflateReset(n),c=Zc.inflate(n,d);switch(c){case tle:case T6:case LN:case nle:return this.onEnd(c),this.ended=!0,!1}if(h=n.avail_out,n.next_out&&(n.avail_out===0||c===kN))if(this.options.to==="string"){let m=v_.utf8border(n.output,n.next_out),g=n.next_out-m,_=v_.buf2string(n.output,m);n.next_out=g,n.avail_out=i-g,g&&n.output.set(n.output.subarray(m,m+g),0),this.onData(_)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(c!==S_||h!==0){if(c===kN)return c=Zc.inflateEnd(this.strm),this.onEnd(c),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},PT.prototype.onData=function(e){this.chunks.push(e)},PT.prototype.onEnd=function(e){e===S_&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=TT.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var rle={inflate:b6,inflateRaw:function(e,t){return(t=t||{}).raw=!0,b6(e,t)}};const{deflate:ile,deflateRaw:sle}=Vce,{inflate:ole,inflateRaw:ale}=rle;var cle=ile,lle=sle,dle=ole,ule=ale,R6=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(R6||{});class hle{constructor(){x(this,"_sequence",0),x(this,"_startTime",Date.now()),x(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const h=new Uint8Array(4);h.set([1,0,0,0]);const m={id:0,length:4,data:h.buffer},g={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[m]};n.commonPacketHeader.extension=1,n.extension=g,n.payload=this.compress(t),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;D("SHOW_DATASTREAM2_LOG")&&R.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const i=new ArrayBuffer(n.commonPacketHeader.length),a=new Uint8Array(i),c=new DataView(i);let d=0;if(c.setUint16(d,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),d+=2,c.setUint32(d,n.commonPacketHeader.sequence,!0),d+=4,c.setUint16(d,n.commonStreamHeader,!0),d+=2,n.extension){const h=this.serializeExtension(n.extension);a.set(new Uint8Array(h),d),d+=h.byteLength}if(a.set(new Uint8Array(n.payload),d),d+=n.payload.byteLength,d!==n.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const n=new DataView(t);let i=0;const a=n.getUint16(i,!0);i+=2;const c={length:16383&a,reserved:(16384&a)>>14,extension:(32768&a)>>15,sequence:n.getUint16(i+2,!0)<<16|n.getUint16(i,!0)};let d,h;if(i+=4,D("SHOW_DATASTREAM2_LOG")&&R.debug("receive data header: ".concat(JSON.stringify(c))),n.getUint16(i,!0),i+=2,c.extension){h=this.deserializeExtension(t.slice(i)),i+=2+h.length,d=t.slice(i);let m=!1;if(h.datas.length>0){const g=h.datas.find(_=>_.id===0);g&&(m=(1&new DataView(g.data).getUint32(0,!0))==1)}d=m?this.decompress(d):d}else d=t.slice(8);return d}serializeExtension(t){const{profile:n,length:i,datas:a}=t,c=new ArrayBuffer(i+2),d=new Uint8Array(c),h=new DataView(c);let m=0;if(h.setUint8(m++,n),h.setUint8(m++,i),a.forEach(g=>{n?(h.setUint8(m++,g.id),h.setUint8(m++,g.length),d.set(new Uint8Array(g.data),m),m+=g.data.byteLength):(h.setUint8(m++,g.id|g.length<<4),d.set(new Uint8Array(g.data),m),m+=g.data.byteLength)}),m!==i+2)throw Error("serialize extension error, is ".concat(m,"!==").concat(i+2));return c}deserializeExtension(t){const n=new DataView(t);let i=0;const a=n.getUint8(i);i++;const c=n.getUint8(i);i++;const d=a===R6.TWO_BYTE,h=[],m=new DataView(t,2);let g=0;for(;g<c;){let _=0,v=0,y=new ArrayBuffer(0);d?(_=m.getUint8(g),g++,v=m.getUint8(g),g++):(_=15&m.getUint8(g),v=m.getUint8(g)>>4,g++),v>0&&(y=m.buffer.slice(g+2,g+2+v),g+=y.byteLength),h.push({id:_,length:v,data:y})}if(g!==c)throw Error("parse error");return{profile:a,length:c,datas:h}}decompress(t){return dle(new Uint8Array(t))}compress(t){return cle(new Uint8Array(t))}}const ple={name:"DataStream",create:(e,t)=>{const n=t?new _oe(e):new Eoe(e);return n.useDataStream(new hle),n}};class mle extends Sn{constructor(t,n,i){super(),x(this,"ws",void 0),x(this,"requestId",1),x(this,"heartBeatTimer",void 0),x(this,"joinInfo",void 0),x(this,"clientId",void 0),x(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),x(this,"onClose",a=>{this.emit("close"),this.dispose()}),x(this,"onMessage",a=>{const c=JSON.parse(a.data);if(!c||c.command!=="serverResponse"||!c.requestId)return c&&c.command==="serverStatus"&&c.serverStatus&&c.serverStatus.command?(this.emit("status",c.serverStatus),void this.emit(c.serverStatus.command,c.serverStatus)):void 0;this.emit("req_".concat(c.requestId),c)}),this.joinInfo=t,this.clientId=n,this.ws=new Hg("cross-channel-".concat(this.clientId),i),this.ws.on(ct.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(ct.CONNECTED,this.onOpen),this.ws.on(ct.ON_MESSAGE,this.onMessage),this.ws.on(ct.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new we((n,i)=>{const a=window.setTimeout(()=>{i(new se(L.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,c=>{window.clearTimeout(a),c.state&&c.state!==0?i(new se(L.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(a),i(new se(L.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new se(L.WS_DISCONNECT);const n=()=>new we((d,h)=>{this.ws.once(ct.CLOSED,()=>h(new se(L.WS_ABORT))),this.ws.once(ct.CONNECTED,d)});this.ws.state!=="connected"&&await n();const i=this.sendMessage(t),a=new we((d,h)=>{const m=()=>{h(new se(L.WS_ABORT))};this.ws.once(ct.RECONNECTING,m),this.ws.once(ct.CLOSED,m),this.once("req_".concat(i),d),pr(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(ct.RECONNECTING,m),this.ws.off(ct.CLOSED,m),h(new se(L.TIMEOUT,"cross channel ws request timeout"))})}),c=await a;if(!c||c.code!==200)throw new se(L.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(c)));return c}async connect(t){this.ws.removeAllListeners(ct.REQUEST_NEW_URLS),this.ws.on(ct.REQUEST_NEW_URLS,n=>{n(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class fle extends Sn{set state(t){t!==this._state&&(t!==Zi.RELAY_STATE_FAILURE&&(this.errorCode=nm.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,i,a,c){super(),x(this,"joinInfo",void 0),x(this,"sid",void 0),x(this,"clientId",void 0),x(this,"cancelToken",Mi.CancelToken.source()),x(this,"workerToken",void 0),x(this,"requestId",0),x(this,"signal",void 0),x(this,"prevChannelMediaConfig",void 0),x(this,"httpRetryConfig",void 0),x(this,"_resolution",void 0),x(this,"_state",Zi.RELAY_STATE_IDLE),x(this,"errorCode",nm.RELAY_OK),x(this,"onStatus",d=>{R.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(d))),d&&d.command&&(d.command==="onAudioPacketReceived"&&this.emit("event",Yc.PACKET_RECEIVED_AUDIO_FROM_SRC),d.command==="onVideoPacketReceived"&&this.emit("event",Yc.PACKET_RECEIVED_VIDEO_FROM_SRC),d.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=nm.SRC_TOKEN_EXPIRED,this.state=Zi.RELAY_STATE_FAILURE),d.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=nm.DEST_TOKEN_EXPIRED,this.state=Zi.RELAY_STATE_FAILURE))}),x(this,"onReconnect",async()=>{R.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Yc.NETWORK_DISCONNECTED),this.state=Zi.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(d=>{this.state!==Zi.RELAY_STATE_IDLE&&(R.error("auto restart channel media relay failed",d.toString()),this.errorCode=nm.SERVER_CONNECTION_LOST,this.state=Zi.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=n,this.sid=Uu(),this.signal=new mle(this.joinInfo,this.clientId,i),this.httpRetryConfig=a,this._resolution=c}async startChannelMediaRelay(t){if(this.state!==Zi.RELAY_STATE_IDLE)throw new se(L.INVALID_OPERATION);this.state=Zi.RELAY_STATE_CONNECTING,await this.connect(),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new se(L.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new se(L.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new se(L.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==Zi.RELAY_STATE_RUNNING)throw new se(L.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==Zi.RELAY_STATE_RUNNING)throw new se(L.INVALID_OPERATION);const n=this.genMessage(Vi.SetVideoProfile);await this.signal.request(n),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),R.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Zi.RELAY_STATE_IDLE,this.dispose()}dispose(){R.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Mi.CancelToken.source(),this.state=Zi.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await Tae(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",Yc.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(Vi.SetSdkProfile,t);await this.signal.request(n),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const i=this.genMessage(Vi.SetSourceChannel,t);await this.signal.request(i),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Yc.PACKET_JOINED_SRC_CHANNEL),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const a=this.genMessage(Vi.SetSourceUserId,t);await this.signal.request(a),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const c=this.genMessage(Vi.SetDestChannel,t);await this.signal.request(c),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Yc.PACKET_JOINED_DEST_CHANNEL),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const d=this.genMessage(Vi.StartPacketTransfer,t);await this.signal.request(d),this.emit("event",Yc.PACKET_SENT_TO_DEST_CHANNEL),this.state=Zi.RELAY_STATE_RUNNING,R.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const n=this.genMessage(Vi.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",Yc.PACKET_UPDATE_DEST_CHANNEL),R.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(Vi.StopPacketTransfer);await this.signal.request(t),R.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const i=[],a=[],c=[];this.requestId+=1;const d={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:ro,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};d.sdkVersion==="4.24.2"&&(d.sdkVersion="0.0.1");let h=null,m=null;switch(t){case Vi.SetSdkProfile:return d.clientRequest={command:"SetSdkProfile",type:"multi_channel"},d;case Vi.SetSourceChannel:if(m=n&&n.getSrcChannelMediaInfo(),!m)throw new se(L.UNEXPECTED_ERROR,"can not find source config");return d.clientRequest={command:"SetSourceChannel",uid:"0",channelName:m.channelName,token:m.token||this.joinInfo.appId},d;case Vi.SetSourceUserId:if(m=n&&n.getSrcChannelMediaInfo(),!m)throw new se(L.UNEXPECTED_ERROR,"can not find source config");return d.clientRequest={command:"SetSourceUserId",uid:m.uid+""},d;case Vi.SetDestChannel:if(h=n&&n.getDestChannelMediaInfo(),!h)throw new se(L.UNEXPECTED_ERROR,"can not find dest config");return h.forEach(g=>{i.push(g.channelName),a.push(g.uid+""),c.push(g.token||this.joinInfo.appId)}),d.clientRequest={command:"SetDestChannel",channelName:i,uid:a,token:c},d;case Vi.StartPacketTransfer:return d.clientRequest={command:"StartPacketTransfer"},d;case Vi.Reconnect:return d.clientRequest={command:"Reconnect"},d;case Vi.StopPacketTransfer:return d.clientRequest={command:"StopPacketTransfer"},d;case Vi.UpdateDestChannel:if(h=n&&n.getDestChannelMediaInfo(),!h)throw new se(L.UNEXPECTED_ERROR,"can not find dest config");return h.forEach(g=>{i.push(g.channelName),a.push(g.uid+""),c.push(g.token||this.joinInfo.appId)}),d.clientRequest={command:"UpdateDestChannel",channelName:i,uid:a,token:c},d;case Vi.SetVideoProfile:d.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return d}}const gle={name:"ChannelMediaRelay",create:function(e){return new fle(e.joinInfo,e.clientId,e.websocketRetryConfig||Kn,e.httpRetryConfig||Kn,e.resolution)}};function w6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function T_(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?w6(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w6(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class _le extends Sn{constructor(t,n,i,a){super(),x(this,"spec",void 0),x(this,"token",void 0),x(this,"websocket",void 0),x(this,"pingpongTimer",void 0),x(this,"reconnectMode","retry"),x(this,"serviceMode",void 0),x(this,"reqId",0),x(this,"commandReqId",0),x(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),x(this,"handleWebSocketMessage",c=>{if(!c.data)return;const d=JSON.parse(c.data);d.requestId?this.emit("@".concat(d.requestId,"-").concat(d.sid),d):(Le.workerEvent(this.spec.sid,{actionType:"status",serverCode:d.code,workerType:this.serviceMode===qc.TRANSCODE?1:2}),this.emit(nd.PUBLISH_STREAM_STATUS,d))}),this.spec=n,this.token=t,this.serviceMode=a,this.websocket=new Hg("live-streaming",i),this.websocket.on(ct.CONNECTED,this.handleWebSocketOpen),this.websocket.on(ct.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(ct.REQUEST_NEW_URLS,(c,d)=>{Zn(this,nd.REQUEST_NEW_ADDRESS).then(c).catch(d)}),this.websocket.on(ct.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,n,i,a){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const c=this.commandReqId,d=this.reqId;if(!d||!this.websocket)throw new se(L.UNEXPECTED_ERROR);const h=T_({command:t,sdkVersion:ro==="4.24.2"?"0.0.1":ro,seq:d,requestId:d,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new se(L.WS_DISCONNECT);const m=()=>new we((y,b)=>{this.websocket.once(ct.CLOSED,()=>b(new se(L.WS_ABORT))),this.websocket.once(ct.CONNECTED,y)});this.websocket.state!=="connected"&&await m(),h.clientRequest&&(h.clientRequest.workerToken=this.token);const g=new we((y,b)=>{const O=()=>{b(new se(L.WS_ABORT))};this.websocket.once(ct.RECONNECTING,O),this.websocket.once(ct.CLOSED,O),this.once("@".concat(d,"-").concat(this.spec.sid),I=>{y(I)})});a&&Le.workerEvent(this.spec.sid,T_(T_({},a),{},{requestId:c,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const _=Date.now();this.websocket.sendMessage(h);let v=null;try{v=await g}catch(y){if(this.websocket.state==="closed")throw y;return await m(),await this.request(t,n,i)}return a&&Le.workerEvent(this.spec.sid,T_(T_({},a),{},{requestId:c,actionType:"response",payload:JSON.stringify(v.serverResponse),serverCode:v.code,success:v.code===200,responseTime:Date.now()-_})),v.code!==200&&this.handleResponseError(v),v}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=ro==="4.24.2"?"0.0.1":ro;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case or.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void R.warning("live stream response already exists stream");case or.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case or.LIVE_STREAM_RESPONSE_BAD_STREAM:case or.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new se(L.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case or.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new se(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case or.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new se(L.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case or.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new se(L.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(nd.WARNING,n,t.serverResponse.url)}case or.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new se(L.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(nd.WARNING,n,t.serverResponse.url)}case or.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new se(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case or.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new se(L.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case or.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new se(L.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(nd.WARNING,n,t.serverResponse.url)}case or.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new se(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case or.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new se(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case or.LIVE_STREAM_RESPONSE_WORKER_LOST:case or.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new se(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case or.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new se(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new se(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case or.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case or.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case or.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case or.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new se(L.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Ug)},6e3)}}function C6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function ts(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?C6(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C6(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class Ele extends Sn{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Kn,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Kn;super(),x(this,"onLiveStreamWarning",void 0),x(this,"onLiveStreamError",void 0),x(this,"spec",void 0),x(this,"retryTimeout",1e4),x(this,"connection",void 0),x(this,"httpRetryConfig",void 0),x(this,"wsRetryConfig",void 0),x(this,"streamingTasks",new Map),x(this,"isStartingStreamingTask",!1),x(this,"taskMutex",new Cr("live-streaming")),x(this,"cancelToken",Mi.CancelToken.source()),x(this,"transcodingConfig",void 0),x(this,"uapResponse",void 0),x(this,"lastTaskId",1),x(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=i,this.wsRetryConfig=n}async setTranscodingConfig(t){const n=ts(ts({},tae),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(R.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(d=>ts(ts(ts({},eae),d),{},{zOrder:d.zOrder?d.zOrder+1:1}))),function(d){An(d.width)||nn(d.width,"config.width",0,1e4),An(d.height)||nn(d.height,"config.height",0,1e4),An(d.videoBitrate)||nn(d.videoBitrate,"config.videoBitrate",1,1e6),An(d.videoFrameRate)||nn(d.videoFrameRate,"config.videoFrameRate"),An(d.lowLatency)||Oo(d.lowLatency,"config.lowLatency"),An(d.audioSampleRate)||Hn(d.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),An(d.audioBitrate)||nn(d.audioBitrate,"config.audioBitrate",1,128),An(d.audioChannels)||Hn(d.audioChannels,"config.audioChannels",[1,2,3,4,5]),An(d.videoGop)||nn(d.videoGop,"config.videoGop"),An(d.videoCodecProfile)||Hn(d.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),An(d.userCount)||nn(d.userCount,"config.userCount",0,17),An(d.backgroundColor)||nn(d.backgroundColor,"config.backgroundColor",0,16777215),An(d.userConfigExtraInfo)||Lr(d.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),d.transcodingUsers&&!An(d.transcodingUsers)&&(Hc(d.transcodingUsers,"config.transcodingUsers"),d.transcodingUsers.forEach((h,m)=>{GS(h.uid),An(h.x)||nn(h.x,"transcodingUser[".concat(m,"].x"),0,1e4),An(h.y)||nn(h.y,"transcodingUser[".concat(m,"].y"),0,1e4),An(h.width)||nn(h.width,"transcodingUser[".concat(m,"].width"),0,1e4),An(h.height)||nn(h.height,"transcodingUser[".concat(m,"].height"),0,1e4),An(h.zOrder)||nn(h.zOrder-1,"transcodingUser[".concat(m,"].zOrder"),0,100),An(h.alpha)||nn(h.alpha,"transcodingUser[".concat(m,"].alpha"),0,1,!1)})),An(d.watermark)||wA(d.watermark,"watermark"),An(d.backgroundImage)||wA(d.backgroundImage,"backgroundImage"),d.images&&!An(d.images)&&(Hc(d.images,"config.images"),d.images.forEach((h,m)=>{wA(h,"images[".concat(m,"]"))}))}(n);const i=[];n.images&&i.push(...n.images.map(d=>ts(ts(ts({},RA),d),{},{zOrder:255}))),n.backgroundImage&&(i.push(ts(ts(ts({},RA),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(i.push(ts(ts(ts({},RA),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=i,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(d=>ts({},d)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const a=(n.userConfigs||[]).map(d=>typeof d.uid=="number"?we.resolve(d.uid):K3(d.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await we.all(a)).forEach((d,h)=>{n.userConfigs&&n.userConfigs[h]&&(n.userConfigs[h].uid=d)}),this.transcodingConfig=n,this.connection)try{var c;const d=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Es(c=this.streamingTasks).call(c)).map(h=>h.taskId).join("#")});R.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(d.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(d){if(!d.data||!d.data.retry)throw d;d.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(h=>{R.warning("[".concat(this.spec.clientId,"] live streaming receive error"),d.toString(),"try to republish",h.url),this.startLiveStreamingTask(h.url,h.mode,d).then(()=>{R.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(h.url," success"))}).catch(m=>{R.error("[".concat(this.spec.clientId,"] live streaming republish failed"),h.url,m.toString()),this.onLiveStreamError&&this.onLiveStreamError(h.url,m)})})}}async startLiveStreamingTask(t,n,i){if(!this.transcodingConfig&&n===qc.TRANSCODE)throw new se(L.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const a={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};R.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const c=await this.taskMutex.lock();if(!this.connection&&i)return void c();if(this.streamingTasks.get(t)&&!i)return c(),new se(L.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(h){throw c(),h}switch(n){case qc.TRANSCODE:a.transcodingConfig=ts({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(a.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const d=this.lastTaskId++;try{const h=new we((g,_)=>{pr(this.retryTimeout).then(()=>{if(i)return _(i);const v=this.statusError.get(t);return v?(this.statusError.delete(t),_(v)):void 0})}),m=await we.race([this.connection.request("request",{clientRequest:a},!0,{url:t,command:"PublishStream",workerType:n===qc.TRANSCODE?1:2,requestByUser:!i,tid:d.toString()}),h]);this.isStartingStreamingTask=!1,R.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(m.code)),this.streamingTasks.set(t,{clientRequest:a,mode:n,url:t,taskId:d}),c()}catch(h){if(c(),this.isStartingStreamingTask=!1,!h.data||!h.data.retry||i)throw h;return h.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,h)):await this.startLiveStreamingTask(t,n,h)}}stopLiveStreamingTask(t){return new we((n,i)=>{const a=this.streamingTasks.get(t);if(!a||!this.connection)return new se(L.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const c=a.mode;a.abortTask=()=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:a.url}},!1,{url:t,command:"UnPublishStream",workerType:c===qc.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(d=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(d.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(i)})}resetAllTask(){var t;const n=Array.from(Es(t=this.streamingTasks).call(t));this.terminate();for(const i of n)this.startLiveStreamingTask(i.url,i.mode).catch(a=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,a)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Mi.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new se(L.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await Zn(this,CA.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new _le(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(nd.WARNING,(i,a)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(a,i)),this.connection.on(nd.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(nd.REQUEST_NEW_ADDRESS,(i,a)=>{if(!this.connection)return a(new se(L.UNEXPECTED_ERROR,"can not get new live streaming address list"));Zn(this,CA.REQUEST_WORKER_MANAGER_LIST,t).then(c=>{this.uapResponse=c,i(c.addressList)}).catch(a)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",i=this.streamingTasks.get(n),a=t.reason;switch(t.code){case or.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case or.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case or.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case or.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const d=new se(L.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(i)return R.error(d.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,d);if(!this.isStartingStreamingTask)return;this.statusError.set(n,d)}case or.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const d=new se(L.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,a);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,d)}case or.LIVE_STREAM_RESPONSE_WORKER_LOST:case or.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var c;if(!this.connection)return;this.connection.tryNextAddress();const d=Array.from(Es(c=this.streamingTasks).call(c));for(const h of d)h.abortTask?h.abortTask():(R.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",h.url),this.startLiveStreamingTask(h.url,h.mode,new se(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{R.debug("[".concat(this.spec.clientId,"] republish live stream success"),h.url)}).catch(m=>{R.error(m.toString()),this.onLiveStreamError&&this.onLiveStreamError(h.url,m)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const vle={name:"LiveStreaming",create:function(e){return new Ele(e.joinInfo,e.websocketRetryConfig||Kn,e.httpRetryConfig||Kn)}};function yle(e){let t=N6();return function(n,i){let a=n.appId;a!==void 0&&(Yt(i,10),gc(i,a));let c=n.cid;c!==void 0&&(Yt(i,16),Yt(i,c));let d=n.cname;d!==void 0&&(Yt(i,26),gc(i,d));let h=n.deviceId;h!==void 0&&(Yt(i,34),gc(i,h));let m=n.elapse;m!==void 0&&(Yt(i,40),fd(i,m));let g=n.fileSize;g!==void 0&&(Yt(i,48),fd(i,ym(g)));let _=n.height;_!==void 0&&(Yt(i,56),fd(i,ym(_)));let v=n.jpg;v!==void 0&&(Yt(i,66),Yt(i,v.length),function(vn,ge){let Re=Sm(vn,ge.length);vn.bytes.set(ge,Re)}(i,v));let y=n.networkType;y!==void 0&&(Yt(i,72),fd(i,ym(y)));let b=n.osType;b!==void 0&&(Yt(i,80),fd(i,ym(b)));let O=n.requestId;O!==void 0&&(Yt(i,90),gc(i,O));let I=n.sdkVersion;I!==void 0&&(Yt(i,98),gc(i,I));let N=n.sequence;N!==void 0&&(Yt(i,104),fd(i,ym(N)));let k=n.sid;k!==void 0&&(Yt(i,114),gc(i,k));let j=n.timestamp;j!==void 0&&(Yt(i,120),fd(i,j));let G=n.uid;G!==void 0&&(Yt(i,128),Yt(i,G));let K=n.vid;K!==void 0&&(Yt(i,136),Yt(i,K));let X=n.width;X!==void 0&&(Yt(i,144),fd(i,ym(X)));let z=n.service;z!==void 0&&(Yt(i,152),Yt(i,z));let ne=n.callbackData;ne!==void 0&&(Yt(i,162),gc(i,ne));let me=n.jpgEncryption;me!==void 0&&(Yt(i,168),Yt(i,me));let Ee=n.requestType;Ee!==void 0&&(Yt(i,176),Yt(i,Ee));let Oe=n.scorePorn;Oe!==void 0&&(Yt(i,185),FN(i,Oe));let Qe=n.scoreSexy;Qe!==void 0&&(Yt(i,193),FN(i,Qe));let qe=n.scoreNeutral;qe!==void 0&&(Yt(i,201),FN(i,qe));let dt=n.scene;dt!==void 0&&(Yt(i,208),Yt(i,dt));let at=n.ossFilePrefix;at!==void 0&&(Yt(i,218),gc(i,at));let Ut=n.serviceVendor;if(Ut!==void 0)for(let vn of Ut){Yt(i,226);let ge=N6();ble(vn,ge),Yt(i,ge.limit),Ile(i,ge),Cle(ge)}}(e,t),function(n){let i=n.bytes,a=n.limit;return i.length===a?i:i.subarray(0,a)}(t)}function Sle(e){return function(n){let i={};e:for(;!x6(n);){let a=_c(n);switch(a>>>3){case 0:break e;case 1:i.code=_c(n);break;case 2:i.msg=O6(n,_c(n));break;case 3:{let c=Rle(n);i.data=Tle(n),n.limit=c;break}default:I6(n,7&a)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}function Tle(e){let t={};e:for(;!x6(e);){let n=_c(e);switch(n>>>3){case 0:break e;case 1:t.requestId=O6(e,_c(e));break;case 2:t.requestType=_c(e)>>>0;break;case 3:t.scorePorn=VN(e);break;case 4:t.scoreSexy=VN(e);break;case 5:t.scoreNeutral=VN(e);break;case 6:t.requestScene=_c(e)>>>0;break;case 7:t.scene=_c(e)>>>0;break;default:I6(e,7&n)}}return t}function ble(e,t){let n=e.service;n!==void 0&&(Yt(t,8),Yt(t,n));let i=e.vendor;i!==void 0&&(Yt(t,16),Yt(t,i));let a=e.token;a!==void 0&&(Yt(t,26),gc(t,a));let c=e.callbackUrl;c!==void 0&&(Yt(t,34),gc(t,c))}function Rle(e){let t=_c(e),n=e.limit;return e.limit=e.offset+t,n}function I6(e,t){switch(t){case 0:for(;128&P6(e););break;case 2:UN(e,_c(e));break;case 5:UN(e,4);break;case 1:UN(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let wle=new Float32Array(1);new Uint8Array(wle.buffer);let MN=new Float64Array(1),ns=new Uint8Array(MN.buffer);function ym(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let A6=[];function N6(){const e=A6.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function Cle(e){A6.push(e)}function UN(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function x6(e){return e.offset>=e.limit}function Sm(e,t){let n=e.bytes,i=e.offset,a=e.limit,c=i+t;if(c>n.length){let d=new Uint8Array(2*c);d.set(n),e.bytes=d}return e.offset=c,c>a&&(e.limit=c),i}function jN(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function O6(e,t){let n=jN(e,t),i=String.fromCharCode,a=e.bytes,c="",d="";for(let h=0;h<t;h++){let m,g,_,v,y=a[h+n];128&y?(224&y)==192?h+1>=t?d+=c:(m=a[h+n+1],(192&m)!=128?d+=c:(v=(31&y)<<6|63&m,v<128?d+=c:(d+=i(v),h++))):(240&y)==224?h+2>=t?d+=c:(m=a[h+n+1],g=a[h+n+2],(49344&(m|g<<8))!=32896?d+=c:(v=(15&y)<<12|(63&m)<<6|63&g,v<2048||v>=55296&&v<=57343?d+=c:(d+=i(v),h+=2))):(248&y)==240?h+3>=t?d+=c:(m=a[h+n+1],g=a[h+n+2],_=a[h+n+3],(12632256&(m|g<<8|_<<16))!=8421504?d+=c:(v=(7&y)<<18|(63&m)<<12|(63&g)<<6|63&_,v<65536||v>1114111?d+=c:(v-=65536,d+=i(55296+(v>>10),56320+(1023&v)),h+=3))):d+=c:d+=i(y)}return d}function gc(e,t){let n=t.length,i=0;for(let d=0;d<n;d++){let h=t.charCodeAt(d);h>=55296&&h<=56319&&d+1<n&&(h=(h<<10)+t.charCodeAt(++d)-56613888),i+=h<128?1:h<2048?2:h<65536?3:4}Yt(e,i);let a=Sm(e,i),c=e.bytes;for(let d=0;d<n;d++){let h=t.charCodeAt(d);h>=55296&&h<=56319&&d+1<n&&(h=(h<<10)+t.charCodeAt(++d)-56613888),h<128?c[a++]=h:(h<2048?c[a++]=h>>6&31|192:(h<65536?c[a++]=h>>12&15|224:(c[a++]=h>>18&7|240,c[a++]=h>>12&63|128),c[a++]=h>>6&63|128),c[a++]=63&h|128)}}function Ile(e,t){let n=Sm(e,t.limit),i=e.bytes,a=t.bytes;for(let c=0,d=t.limit;c<d;c++)i[c+n]=a[c]}function P6(e){return e.bytes[jN(e,1)]}function D6(e,t){let n=Sm(e,1);e.bytes[n]=t}function VN(e){let t=jN(e,8),n=e.bytes;return ns[0]=n[t++],ns[1]=n[t++],ns[2]=n[t++],ns[3]=n[t++],ns[4]=n[t++],ns[5]=n[t++],ns[6]=n[t++],ns[7]=n[t++],MN[0]}function FN(e,t){let n=Sm(e,8),i=e.bytes;MN[0]=t,i[n++]=ns[0],i[n++]=ns[1],i[n++]=ns[2],i[n++]=ns[3],i[n++]=ns[4],i[n++]=ns[5],i[n++]=ns[6],i[n++]=ns[7]}function _c(e){let t,n=0,i=0;do t=P6(e),n<32&&(i|=(127&t)<<n),n+=7;while(128&t);return i}function Yt(e,t){for(t>>>=0;t>=128;)D6(e,127&t|128),t>>>=7;D6(e,t)}function fd(e,t){let n=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,a=t.high>>>24,c=a===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:a<128?9:10,d=Sm(e,c),h=e.bytes;switch(c){case 10:h[d+9]=a>>>7&1;case 9:h[d+8]=c!==9?128|a:127&a;case 8:h[d+7]=c!==8?i>>>21|128:i>>>21&127;case 7:h[d+6]=c!==7?i>>>14|128:i>>>14&127;case 6:h[d+5]=c!==6?i>>>7|128:i>>>7&127;case 5:h[d+4]=c!==5?128|i:127&i;case 4:h[d+3]=c!==4?n>>>21|128:n>>>21&127;case 3:h[d+2]=c!==3?n>>>14|128:n>>>14&127;case 2:h[d+1]=c!==2?n>>>7|128:n>>>7&127;case 1:h[d]=c!==1?128|n:127&n}}function k6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}const Ale=new Map([["moderation",1],["supervise",2]]);class Nle extends Sn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Ar.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=to(n=t.map(i=>Ale.get(i)||0)).call(n,(i,a)=>i+a),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),x(this,"name","AgoraRTCVideoContentInspect"),x(this,"_connectionState",Mo.CONNECTING),x(this,"_innerConnectionState",void 0),x(this,"sequence",0),x(this,"inspectStartTime",void 0),x(this,"workerManagerConnection",void 0),x(this,"workerConnection",void 0),x(this,"workerMessageLengthLimit",void 0),x(this,"inspectIntervalMinimum",void 0),x(this,"qualityRatio",void 0),x(this,"_connectInfo",void 0),x(this,"_cancelTokenSource",Mi.CancelToken.source()),x(this,"_retryConfig",void 0),x(this,"wmSequence",0),x(this,"inspectInterval",void 0),x(this,"inspectTimer",null),x(this,"ossFilePrefix",void 0),x(this,"extraInfo",void 0),x(this,"_inspectType",void 0),x(this,"_inspectMode",void 0),x(this,"_quality",1),x(this,"qualityTimer",null),x(this,"_inspectId",void 0),x(this,"_needWorkUrlOnly",!1),x(this,"inspectImage",()=>{if(this.connectionState!==Mo.CONNECTED)throw new se(L.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Mo.CONNECTED?this.requestToInspectImage():R.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Wt(5,"inspect-"),this.workerMessageLengthLimit=D("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=D("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=D("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Hg("worker-manager-"+this._inspectId,Kn),this.on(Ar.STATE_CHANGE,(n,i)=>{this._innerConnectionState=n,R.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Uo[n]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Hg("worker-"+this._inspectId,Kn),this.handleWorkerEvents()}async init(t,n){this.emit(Ar.STATE_CHANGE,Uo.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=n,new we((a,c)=>{this.on(Ar.CONNECTION_STATE_CHANGE,(d,h)=>{h===Mo.CONNECTED&&a()}),this.requestAP(t,i,n).then(d=>{this.connectWorkerManager(d)}).catch(d=>{c(d)})})}async requestAP(t,n,i){const a=D("WEBCS_DOMAIN").map(h=>"https://".concat(h,"/api/v1")),c=await function(h,m,g,_){let{appId:v,areaCode:y,cname:b,sid:O,token:I,uid:N}=m;cm++;const k="image_moderation_api",j={service_name:k,json_body:JSON.stringify({appId:v,areaCode:y,cname:b,command:"allocateEdge",requestId:cm,seq:cm,sid:O,token:I,ts:Date.now(),uid:N+""})};let G,K,X=h[0];return pa(async()=>{G=Date.now();const z=await va(X,{data:j,cancelToken:g,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(K=Date.now()-G,z.code!==0){const qe=new se(L.UNEXPECTED_RESPONSE,"image inspect ap error, code"+z.code,{retry:!0,responseTime:K});throw R.error(qe.toString()),qe}const ne=JSON.parse(z.json_body);if(ne.code!==200){const qe=new se(L.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(ne.code,", reason: ").concat(ne.reason),{code:ne.code,responseTime:K});throw R.error(qe.toString()),qe}if(!ne.servers||!Array.isArray(ne.servers)||ne.servers.length===0){const qe=new se(L.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:ne.code,responseTime:K});throw R.error(qe.toString()),qe}const me=D("VIDEO_INSPECT_WORKER_MANAGER_WSS");if(me)return{addressList:[me],workerToken:ne.workerToken,vid:ne.vid,responseTime:K};const Ee=D("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Oe=D("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:ne.servers.map(qe=>{let{address:dt,wss:at}=qe;if(dt&&at)return"wss://".concat(dt.replace(/\./g,"-"),".").concat(Ee,":").concat(Oe||at)}).filter(qe=>!!qe),workerToken:ne.workerToken,vid:ne.vid,responseTime:K}},(z,ne)=>(Le.apworkerEvent(O,{success:!0,sc:200,serviceName:k,responseDetail:JSON.stringify(z.addressList),firstSuccess:ne===0,responseTime:K,serverIp:h[ne%h.length]}),!1),(z,ne)=>(Le.apworkerEvent(O,{success:!1,sc:z.data&&z.data.code||200,serviceName:k,responseTime:K,serverIp:h[ne%h.length]}),!!(z.code!==L.OPERATION_ABORTED&&z.code!==L.UNEXPECTED_RESPONSE||z.data&&z.data.retry)&&(X=h[(ne+1)%h.length],!0)),_)}(a,t,n,i);this.emit(Ar.STATE_CHANGE,Uo.AP_CONNECTED);const{addressList:d}=c;return this.wmSequence++,d}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(Ar.STATE_CHANGE,Uo.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(ct.CONNECTED,async()=>{this.emit(Ar.STATE_CHANGE,Uo.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(ct.CLOSED,()=>{this._innerConnectionState<Uo.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(ct.FAILED,()=>{this._innerConnectionState<Uo.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(ct.RECONNECTING,()=>{this._innerConnectionState<Uo.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(ct.ON_MESSAGE,async t=>{this.emit(Ar.STATE_CHANGE,Uo.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const i=JSON.parse(t.data);if(i.code!==200)throw R.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new se(L.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&n))throw R.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new se(L.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{const a=D("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,c=n.replace(/:\d+\/?$/,":".concat(a));this.emit(Ar.STATE_CHANGE,Uo.CONNECT_WORKER,c),this._needWorkUrlOnly?this.emit(Ar.REQUEST_NEW_WORKER_URL,c):await this.connectWorker(c)}}),this.workerManagerConnection.on(ct.WILL_RECONNECT,(t,n,i)=>{i(t)}),this.workerManagerConnection.on(ct.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}handleWorkerEvents(){this.workerConnection.on(ct.CONNECTED,async()=>{this.emit(Ar.STATE_CHANGE,Uo.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Mo.CONNECTED}),this.workerConnection.on(ct.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const i=Sle(new Uint8Array(t.data));if(D("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&R.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Ar.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var n;const a={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},c=to(n=Object.keys(a)).call(n,(h,m)=>a[h]>a[m]?h:m,"porn"),d=Object.keys(a).find(h=>h===c);this.emit(Ar.INSPECT_RESULT,d)}else this.emit(Ar.INSPECT_RESULT,void 0,new se(L.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(Ar.INSPECT_RESULT,void 0,new se(L.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else R.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Ar.INSPECT_RESULT,void 0,new se(L.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(ct.CLOSED,()=>{this.connectionState=Mo.CLOSED}),this.workerConnection.on(ct.FAILED,()=>{this.connectionState=Mo.CLOSED}),this.workerConnection.on(ct.RECONNECTING,()=>{this.connectionState=this.connectionState===Mo.CONNECTED?Mo.RECONNECTING:Mo.CONNECTING}),this.workerConnection.on(ct.WILL_RECONNECT,(t,n,i)=>{t==="recover"&&i(t),i("tryNext")}),this.workerConnection.on(ct.REQUEST_NEW_URLS,(t,n)=>{this.workerManagerConnection.close(),this.once(Ar.REQUEST_NEW_WORKER_URL,i=>{t([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{n(i)})})}async requestToInspectImage(){this.sequence++;const t=Ss(this,Ar.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(Ar.INSPECT_RESULT,void 0,new se(L.INVALID_OPERATION,"Only the track being played can be inspected"));const i=await this.generateRequestData(t,n);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(Ar.INSPECT_RESULT,void 0,new se(L.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:i,cname:a,cid:c,vid:d,sid:h,uid:m}=n;const g=Date.now(),_=await t.getCurrentFrameImage("image/jpeg",this.quality),v=await lF(_,i,a),y=this.sequence+"-"+c+"-"+m+"-"+g+"-"+Wt(12,""),b={appId:i,cid:c,cname:a,deviceId:"",elapse:(O=Number(g-this.inspectStartTime),{low:O|=0,high:O>>31,unsigned:O>=0}),fileSize:v.byteLength,jpgEncryption:2,height:_.height,width:_.width,jpg:v,networkType:6,osType:7,requestId:y,sdkVersion:"4.24.2",sequence:this.sequence,sid:h,timestamp:jB(g),uid:m,vid:d,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var O;this.extraInfo===void 0&&delete b.callbackData,this.ossFilePrefix===void 0&&delete b.ossFilePrefix;const I=yle(b);if(I.byteLength<this.workerMessageLengthLimit){if(D("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const N=function(k){for(var j=1;j<arguments.length;j++){var G=arguments[j]!=null?arguments[j]:{};j%2?k6(Object(G),!0).forEach(function(K){x(k,K,G[K])}):Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(G)):k6(Object(G)).forEach(function(K){Object.defineProperty(k,K,Object.getOwnPropertyDescriptor(G,K))})}return k}({},b);delete N.jpg,R.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(N))}return I}{const N=this.quality*this.qualityRatio;return this.quality=N,await this.generateRequestData(t,{appId:i,cname:a,cid:c,vid:d,sid:h,uid:m})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Mi.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Mo.CLOSED,this.emit(Ar.STATE_CHANGE,Uo.CLOSED)}}const xle={name:"ContentInspect",create:function(e){let{config:t}=e;return function(n){if(!n)throw new se(L.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new se(L.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const i=[...new Set(n.inspectType)];i.forEach(a=>{var c;if(!ve(c=["supervise","moderation"]).call(c,a))throw new se(L.INVALID_PARAMS,"".concat(a," is not a valid inspect type."))}),n.inspectType=i}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new se(L.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new Nle(t)}};var L6=u(qt.Object.getOwnPropertySymbols),Ole=Lt,Ple=Gl.indexOf,Dle=Gv,BN=$([].indexOf),M6=!!BN&&1/BN([1],1,-0)<0;Ole({target:"Array",proto:!0,forced:M6||!Dle("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return M6?BN(this,e,t)||0:Ple(this,e,t)}});var kle=eo("Array","indexOf"),Lle=F,Mle=kle,GN=Array.prototype,Ule=function(e){var t=e.indexOf;return e===GN||Lle(GN,e)&&t===GN.indexOf?Mle:t},U6=u(Ule);function jle(e,t){if(e==null)return{};var n,i,a=function(d,h){if(d==null)return{};var m={};for(var g in d)if({}.hasOwnProperty.call(d,g)){if(U6(h).call(h,g)!==-1)continue;m[g]=d[g]}return m}(e,t);if(L6){var c=L6(e);for(i=0;i<c.length;i++)n=c[i],U6(t).call(t,n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}let j6=class{get localCapabilities(){return mn(this._localCapabilities)}get rtpCapabilities(){return mn(this._rtpCapabilities)}get candidates(){return mn(this._candidates)}get iceParameters(){return mn(this._iceParameters)}get dtlsParameters(){return mn(this._dtlsParameters)}constructor(e){x(this,"sessionDesc",void 0),x(this,"_localCapabilities",void 0),x(this,"_rtpCapabilities",void 0),x(this,"_candidates",void 0),x(this,"_iceParameters",void 0),x(this,"_dtlsParameters",void 0),x(this,"setup",void 0),x(this,"currentMidIndex",void 0),x(this,"cname","o/i14u9pJrxRKAsu"),x(this,"firefoxSsrcMidMap",new Map),e=mn(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:a,localCapabilities:c,direction:d,setup:h,videoCodec:m,audioCodec:g}=e;let _;this.setup=h,_=d===Ni.RECEIVE_ONLY?Ci(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Ci(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=a,this._candidates=i,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=c;const v=d===Ni.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,y=d===Ni.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,b=d===Ni.RECEIVE_ONLY?a.send.videoCodecs:Qg(De.VIDEO,v,y,m),O=d===Ni.RECEIVE_ONLY?a.send.audioCodecs:Qg(De.AUDIO,v,y,g);for(const I of _.mediaDescriptions)I.attributes.iceUfrag=t.iceUfrag,I.attributes.icePwd=t.icePwd,I.attributes.fingerprints=n.fingerprints,I.attributes.candidates=i,I.attributes.setup=this.setup,I.media.mediaType==="application"&&(I.attributes.sctpPort="5000"),I.media.mediaType==="video"&&(I.media.fmts=b.map(N=>N.payloadType.toString(10)),I.attributes.payloads=b,I.attributes.extmaps=v.videoExtensions),I.media.mediaType==="audio"&&(I.media.fmts=O.map(N=>N.payloadType.toString(10)),I.attributes.payloads=O,I.attributes.extmaps=v.audioExtensions,am(I));this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}toString(){return Kc(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,n,i,a){n=n.replace(/ /g,"-");const{ssrcs:c,ssrcGroups:d}=Xg(t,this.cname,D("SYNC_GROUP")?n:void 0),h=this.findPreloadMediaDesc(c);if(h){if(pn()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,h.attributes.mid),a&&(a.twcc||a.remb)){const m=this.sessionDesc.mediaDescriptions.indexOf(h);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(h,a),{mid:h.attributes.mid,needExchangeSDP:!0}}return{mid:h.attributes.mid,needExchangeSDP:!1}}{const m=this.findAvailableMediaIndex(e,c,i);let g;return m===-1?(g=this.createOrRecycleSendMedia(e,c,d,"sendonly",i,a),this.updateBundleMids()):(g=mn(this.sessionDesc.mediaDescriptions[m]),g.attributes.direction="sendonly",g.attributes.ssrcs=c,g.attributes.ssrcGroups=d,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(g,a)),pn()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,g.attributes.mid),{needExchangeSDP:!0,mid:g.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,n){const i=[];return e.forEach(a=>{const c=a._mediaStreamTrack.kind,d=this.findAvailableRecvMediaIndex(c);let h,m=!1;d===-1?(m=!0,h=this.createOrRecycleRecvMedia(a,[],"recvonly",t,n),this.updateBundleMids()):(h=mn(this.sessionDesc.mediaDescriptions[d]),h.attributes.direction="recvonly"),i.push({mid:h.attributes.mid,needCreateTransceiver:m})}),i}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:i,port:a,type:c,relatedAddress:d,relatedPort:h,priority:m}=new RTCIceCandidate(e),g={foundation:t??"",componentId:"1",transport:n??"",priority:m?m+"":"",connectionAddress:i??"",port:a?a+"":"",type:c?c+"":"",relAddr:d??"",relPort:h?h+"":"",extension:{}};this.candidates.some(_=>_.priority===g.priority&&_.connectionAddress===g.connectionAddress&&_.port===g.port)||(this._candidates.push(g),this.sessionDesc.mediaDescriptions.forEach(_=>{_.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,i,a){const c=e._mediaStreamTrack.kind,d=this.rtpCapabilities.recv,h=Qg(c,d,this.localCapabilities.send,c===De.AUDIO?a:i),m=c===De.VIDEO?d.videoExtensions:d.audioExtensions,g="".concat(++this.currentMidIndex);let _={media:{mediaType:c,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:h.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};_=this.mungRecvMediaDsec(_,e);const v=this.findFirstClosedMedia(c);if(v){const y=this.sessionDesc.mediaDescriptions.indexOf(v);this.sessionDesc.mediaDescriptions[y]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>ve(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>ve(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const a=i.media.mediaType===e&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(pn()){if(a){const c=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(c||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!c||c!==i.attributes.mid)}return!1}return a&&i.attributes.mid===n})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const n=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&n})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=mn(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,n,i,a,c){const d=this.rtpCapabilities.send,h=e===De.VIDEO?d.videoCodecs:d.audioCodecs,m=e===De.VIDEO?d.videoExtensions:d.audioExtensions;pn()&&(a="".concat(++this.currentMidIndex));let g={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:h.map(v=>v.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:a}};g=this.mungSendMediaDesc(g,c);const _=this.findFirstClosedMedia(e);if(_){const v=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[v]=g}else this.sessionDesc.mediaDescriptions.push(g);return g}mungRecvMediaDsec(e,t,n){const i=mn(e);return kA(i),Ju(i,t),LA(i,t),A3(i),QS(i,n,this.localCapabilities.send),i}mungSendMediaDesc(e,t){const n=mn(e);return QS(n,t,this.localCapabilities.recv),am(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===e);if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=i}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>pn()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}};const Vle=["sdp"];var fn;function V6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function gd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?V6(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V6(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let F6=(fn=class xm extends d3{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,i){super(t,n),x(this,"direction",void 0),x(this,"name",void 0),x(this,"store",void 0),x(this,"spec",void 0),x(this,"peerConnection",void 0),x(this,"initialOffer",void 0),x(this,"transport",void 0),x(this,"statsFilter",void 0),x(this,"localCandidateCount",0),x(this,"_isInRestartIce",!1),x(this,"mutex",void 0),x(this,"onLocalCandidate",void 0),x(this,"remoteSDP",void 0),x(this,"pendingCandidates",[]),x(this,"localCapabilities",void 0),x(this,"isReady",!1),x(this,"restartCnt",0),x(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new Cr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(xm.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=i??Ni.SEND_ONLY,this.name=this.direction===Ni.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=vS(this.peerConnection,D("STATS_UPDATE_INTERVAL"),void 0,pn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const n=await UA();if(this.localCapabilities=Jg(n),t){const{sdp:i}=t,a=jle(t,Vle),c=function(){const _={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},v=Yg(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Vo(v,_,"videoExtensions",y,b,O),Vo(v,_,"videoCodecs",y,b,O),Vo(v,_,"audioExtensions",y,b,O),Vo(v,_,"audioCodecs",y,b,O),D("RAISE_H264_BASELINE_PRIORITY")){const I=O.videoCodecs.findIndex(N=>N.rtpMap&&N.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&N.fmtp&&N.fmtp.parameters["profile-level-id"]==="42001f");if(I!==-1){const N=O.videoCodecs.findIndex(k=>k.rtpMap&&k.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(N<I){R.debug("raising H264 baseline profile priority");const k=O.videoCodecs[I];O.videoCodecs.splice(I,1),O.videoCodecs.splice(N,0,k)}N!==-1&&D("FILTER_SEND_H264_BASELINE")&&(y.videoCodecs=y.videoCodecs.filter(k=>!(k.rtpMap&&k.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&k.fmtp&&k.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:y,recv:b,sendrecv:O}}({},{},i);this.remoteSDP=new j6({remoteIceParameters:a.iceParameters,remoteDtlsParameters:a.dtlsParameters,candidates:[],remoteRTPCapabilities:c,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const d=await this.peerConnection.createAnswer();if(!d.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const h=cc(d.sdp);await this.peerConnection.setLocalDescription(d);const m=await x3({},{},d.sdp);this.localCapabilities=Jg(m);const g=this.peerConnection.getTransceivers()[0];return g!=null&&g.receiver&&g.receiver.transport&&this.tryBindTransportEvents(g.receiver.transport),gd(gd({},h),{},{sdp:d.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const a=cc(i.sdp);return this.initialOffer=i,gd(gd({},a),{},{sdp:i.sdp})}}catch(n){throw new de(L.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:i,dtlsParameters:a}=t,c=await x3({},{},n);this.remoteSDP=new j6({remoteIceParameters:i,remoteDtlsParameters:a,candidates:[],remoteRTPCapabilities:c,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const d=this.peerConnection.getTransceivers()[0];d!=null&&d.sender&&d.sender.transport&&this.tryBindTransportEvents(d.sender.transport)}catch(n){throw new de(L.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new de(L.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(t,n,i){var a=this;return Li(function*(){const c=yield ht(a.mutex.lock("From P2PConnection.send"));try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=[],h=a.remoteSDP.receive(t,n,i);t.forEach((N,k)=>{if(h[k].needCreateTransceiver){const j=a.peerConnection.addTransceiver(N._mediaStreamTrack,{direction:"sendonly"});d.push(j),N._updateRtpTransceiver(j)}else{const j=a.peerConnection.getTransceivers().find(G=>G.mid===h[k].mid);if(!j)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(h[k].mid));d.push(j),N._updateRtpTransceiver(j)}}),pn()&&D("SIMULCAST")===!0&&(yield ht(a.applySimulcastForFirefox(d,t)));const m=h.map(N=>N.mid),g=yield ht(a.peerConnection.createOffer()),_=a.mungSendOfferSDP(g.sdp,t,m),v=Ci(_),y=m.map(N=>{const k=v.mediaDescriptions.find(j=>j.attributes.mid===N);if(!k)throw new Error("Cannot extract ssrc from mediaDescription.");return DA(k,D("USE_PUB_RTX"))}),b=d.map((N,k)=>{const j=m[k];return{localSSRC:y[k],id:j}});yield ht(a.peerConnection.setLocalDescription({type:"offer",sdp:_}));try{yield b}catch(N){const k=a.remoteSDP.toString();throw yield ht(a.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield ht(a.peerConnection.setRemoteDescription({type:"answer",sdp:k})),yield ht(a.stopSending(m,!0)),N}yield ht(a.applySimulcastEncodings(d,t)),yield ht(a.applySendEncodings(d,t));const O=a.remoteSDP.toString(),I=a.logSDPExchange(_,"offer","local","send");return I==null||I(O),yield ht(a.setRemoteDescription({type:"answer",sdp:O})),d.map((N,k)=>{const j=m[k];return{localSSRC:y[k],id:j}})}catch(d){throw d instanceof de?d:new de(L.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{c()}})()}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const a=this.peerConnection.getTransceivers().filter(m=>t.indexOf(m.mid)!==-1);if(a.length!==t.length)throw new Error("Transceivers' length (".concat(a.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));a.map(m=>{var g;m.direction="inactive",(g=m.stop)===null||g===void 0||g.call(m)});const c=await this.peerConnection.createOffer(),d=this.logSDPExchange(c.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(c),this.remoteSDP.stopReceiving(t);const h=this.remoteSDP.toString();d==null||d(h),await this.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new de(L.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(a.toString()))}finally{i&&i()}}async receive(t,n,i,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:c,needExchangeSDP:d}=this.remoteSDP.send(t,n,i,a);if(d){const m=this.remoteSDP.toString(),g=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const _=await this.peerConnection.createAnswer(),v=this.mungReceiveAnswerSDP(_.sdp,c,t);g==null||g(v||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:v}),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const h=this.peerConnection.getTransceivers().find(m=>m.mid===c);if(!h||h.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,mid:h.mid,transceiver:h}}catch(c){throw new de(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}}async mockReceive(t,n,i,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:c,needExchangeSDP:d}=this.remoteSDP.send(t,n,i,a);if(d){const h=this.remoteSDP.toString(),m=this.logSDPExchange(h,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:h});const g=await this.peerConnection.createAnswer(),_=this.mungReceiveAnswerSDP(g.sdp,c,t);m==null||m(_||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:_}),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(c){throw new de(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const a=await this.peerConnection.createAnswer();i==null||i(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(n){throw new de(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===ju.Auto&&(this.store.p2pTransport=ju.SdRtn,vt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(xm.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,vt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(xm.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:i}=cc(n.sdp);return this.store.descriptionStart(),this.direction===Ni.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),i}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Ni.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:i}=cc(n.sdp);return await this.peerConnection.setLocalDescription(n),i}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new de(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),a=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const c=this.remoteSDP.toString(),d=this.logSDPExchange(a,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),d==null||d(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new de(L.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter(a=>a.mid===t);i.length===1&&(this.isVP8Simulcast(n)?pn()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find(a=>a.mid===n);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:i,remote:a}=n.getSelectedCandidatePair();return{local:gd(gd({},Do),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:gd(gd({},Do),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,n;ve(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var n;t.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const a={iceServers:[]};var c;return t.iceServers?a.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Pu(t.turnServer.servers)?a.iceServers=t.turnServer.servers:(a.iceServers&&a.iceServers.push(...xm.turnServerConfigToIceServers(t.turnServer.servers,n,i)),D("USE_TURN_SERVER_OF_GATEWAY")&&a.iceServers&&t.turnServer.serversFromGateway&&a.iceServers.push(...xm.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,i)),ve(c=[ju.Relay,ju.SdRtn]).call(c,n)&&(a.iceTransportPolicy="relay"),D("FORCE_TURN_TCP")?a.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(d=>{d.forceturn&&(a.iceTransportPolicy="relay")}))),D("ENABLE_ENCODED_TRANSFORM")&&vt().supportWebRTCEncodedTransform&&(a.encodedInsertableStreams=!0),R.debug("P2PConnection p2pTransport is ".concat(n)),a}static turnServerConfigToIceServers(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const a=[],c=t.filter(h=>h.tcpport);R.debug("P2PConnection turnServers is ".concat(c,", current index is ").concat(i));const d=c.length>i?c[i]:c[0];switch(n){case ju.SdRtn:const h=t.filter(g=>{var _;return ve(_=g.username).call(_,"glb:")&&g.turnServerURL==g.turnServerURL}),m=h.length>i?h[i]:h[0];m&&(a.push({username:m.username,credential:m.password,credentialType:"password",urls:"turn:".concat(jo(m.turnServerURL),":").concat(m.tcpport,"?transport=udp")}),a.push({username:m.username,credential:m.password,credentialType:"password",urls:"turns:".concat(jo(m.turnServerURL),":").concat(m.tcpport,"?transport=tcp")}));break;case ju.Relay:d&&(a.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(d.turnServerURL,":").concat(d.tcpport,"?transport=udp")}),a.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(jo(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}));break;default:d&&(a.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(d.turnServerURL,":").concat(d.tcpport,"?transport=udp")}),a.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(jo(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}),a.push({username:d.username,credential:d.password,credentialType:"password",urls:"stun:".concat(d.turnServerURL,":").concat(d.tcpport)}))}return a}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var i;t!=null&&t.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,t.state))},t.onerror=i=>{var a;(a=this.onDTLSTransportError)===null||a===void 0||a.call(this,"error"in i?i.error:i)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const i=t==null?void 0:t.iceTransport.state;var a;i&&((a=this.onICETransportStateChange)===null||a===void 0||a.call(this,i))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:i,remote:a}=n.getSelectedCandidatePair()||{};if(i&&a){const c=i.address+":"+i.port,d=a.address+":"+a.port;R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(ac(c)),", remote ").concat(JSON.stringify(ac(d))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var i;if(n||(n=this.peerConnection.getSenders().find(_=>_.track===t._mediaStreamTrack)),!n)return R.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!vt().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const a={},c={};switch(t._optimizationMode){case"motion":a.degradationPreference="maintain-framerate";break;case"detail":a.degradationPreference="maintain-resolution";break;default:a.degradationPreference="balanced"}if(t._encoderConfig){var d;const{bitrateMax:_,frameRate:v,scaleResolutionDownBy:y}=t._encoderConfig;_&&(c.maxBitrate=1e3*_),ve(d=t._hints).call(d,Bt.LOW_STREAM)&&(v&&(c.maxFramerate=Fi(v)),y&&y>=1&&(c.scaleResolutionDownBy=y))}if(D("DSCP_TYPE")&&nc()){var h;const _=D("DSCP_TYPE");ve(h=["very-low","low","medium","high"]).call(h,_)&&(c.networkPriority=_)}const m=n.getParameters(),g=(i=m.encodings)===null||i===void 0?void 0:i[0];pn()&&!g&&(a.encodings=[c]),g&&Object.assign(g,c),Object.assign(m,a),R.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await n.setParameters(m)}async applySendEncodings(t,n){try{if(!vt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const a=t[i],c=n[i];c instanceof sn&&!this.isVP8Simulcast(c)&&await this.updateRtpSenderEncodings(c,a.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,i){const a=Ci(t);return n.forEach((c,d)=>{const h=i[d],m=a.mediaDescriptions.find(g=>g.attributes.mid===h);m&&(Ju(m,c),MA(m,c,this.store.codec))}),Kc(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var a;(a=this.onFirstVideoDecoded)===null||a===void 0||a.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let m=0;m<t.length;m++){var i,a,c,d,h;const g=t[m],_=n[m];if(_ instanceof sn&&!ve(i=_._hints).call(i,Bt.LOW_STREAM)&&(a=_._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=_._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=_._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=_._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1&&this.store.codec==="vp8"){const v={},y={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};v.encodings=[{rid:"m",active:!0,maxBitrate:y.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:y.high}];const b=g.sender.getParameters();await g.sender.setParameters(Object.assign(b,v))}}}async applySimulcastEncodings(t,n){if(!pn()&&t.length===n.length)for(let i=0;i<t.length;i++){const a=n[i];if(a instanceof sn&&this.isVP8Simulcast(a)){const c=t[i],d={},h={high:1e3*(a._encoderConfig.bitrateMax-50),medium:5e4};d.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:h.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:h.medium,scaleResolutionDownBy:4}];const m=c.sender.getParameters();await c.sender.setParameters(Object.assign(m,d))}}}isVP8Simulcast(t){var n,i,a,c,d;return!!(t instanceof sn&&D("SIMULCAST")&&this.store.codec==="vp8"&&!ve(n=t._hints).call(n,Bt.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((a=t._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(c=t._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((d=t._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1)}logSDPExchange(t,n,i,a){if(D("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(a,`
`),t),n==="offer"?c=>{this.logSDPExchange(c,"answer",i==="local"?"remote":"local",a)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(d=>{d.direction="inactive"});const i=await this.peerConnection.createOffer(),a=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const c=this.remoteSDP.toString();a==null||a(c),await this.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new de(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async d=>{d.direction="sendonly"});const i=await this.peerConnection.createOffer(),a=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);const c=this.remoteSDP.toString();a==null||a(c),await this.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new de(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(t,n){var i;if(n=n??((i=this.currentRemoteDescription)===null||i===void 0?void 0:i.sdp)){var a;const c=(a=Ci(n).mediaDescriptions.find(d=>d.attributes.mid===t))===null||a===void 0?void 0:a.attributes.ssrcs;return c==null?void 0:c[0].ssrcId}}async setRemoteDescription(t){var n;await this.peerConnection.setRemoteDescription(t),ve(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,n,i){const a=Ci(t),c=a.mediaDescriptions.find(d=>d.attributes.mid===n);return c&&i===De.AUDIO&&c.media.mediaType==="audio"&&am(c),Kc(a)}},Ie(fn.prototype,"establish",[zo],Object.getOwnPropertyDescriptor(fn.prototype,"establish"),fn.prototype),Ie(fn.prototype,"connect",[zo],Object.getOwnPropertyDescriptor(fn.prototype,"connect"),fn.prototype),Ie(fn.prototype,"receive",[zo],Object.getOwnPropertyDescriptor(fn.prototype,"receive"),fn.prototype),Ie(fn.prototype,"mockReceive",[zo],Object.getOwnPropertyDescriptor(fn.prototype,"mockReceive"),fn.prototype),Ie(fn.prototype,"stopReceiving",[zo],Object.getOwnPropertyDescriptor(fn.prototype,"stopReceiving"),fn.prototype),Ie(fn.prototype,"restartICE",[zo],Object.getOwnPropertyDescriptor(fn.prototype,"restartICE"),fn.prototype),Ie(fn.prototype,"close",[zo],Object.getOwnPropertyDescriptor(fn.prototype,"close"),fn.prototype),Ie(fn.prototype,"updateEncoderConfig",[zo],Object.getOwnPropertyDescriptor(fn.prototype,"updateEncoderConfig"),fn.prototype),Ie(fn.prototype,"updateSendParameters",[zo],Object.getOwnPropertyDescriptor(fn.prototype,"updateSendParameters"),fn.prototype),Ie(fn.prototype,"replaceTrack",[zo],Object.getOwnPropertyDescriptor(fn.prototype,"replaceTrack"),fn.prototype),Ie(fn.prototype,"muteLocal",[zo],Object.getOwnPropertyDescriptor(fn.prototype,"muteLocal"),fn.prototype),Ie(fn.prototype,"unmuteLocal",[zo],Object.getOwnPropertyDescriptor(fn.prototype,"unmuteLocal"),fn.prototype),fn);function zo(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const a=this.mutex,c=await a.lock("From P2PConnection.".concat(t));try{for(var d=arguments.length,h=new Array(d),m=0;m<d;m++)h[m]=arguments[m];return await i.apply(this,h)}finally{c()}},n}let Ta=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var B6,G6,W6,z6,H6,K6,q6,Y6,X6,J6,Q6,bn;function $6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function DT(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?$6(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$6(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let Fle=(B6=ba(Ta.SEND_ONLY),G6=ba(Ta.SEND_ONLY),W6=ba(),z6=ba(Ta.RECEIVE_ONLY),H6=ba(Ta.RECEIVE_ONLY),K6=ba(Ta.RECEIVE_ONLY),q6=ba(Ta.RECEIVE_ONLY),Y6=ba(Ta.RECEIVE_ONLY),X6=ba(Ta.RECEIVE_ONLY),J6=ba(),Q6=ba(Ta.RECEIVE_ONLY),bn=class extends Sn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Fe.StateChange,t,this._state)}constructor(e,t){super(),x(this,"isPlanB",!1),x(this,"store",void 0),x(this,"statsUploader",void 0),x(this,"sendConnection",void 0),x(this,"recvConnection",void 0),x(this,"localTrackMap",new Map),x(this,"remoteUserMap",new Map),x(this,"localDataChannels",[]),x(this,"pendingLocalTracks",[]),x(this,"pendingRemoteTracks",[]),x(this,"statsCollector",void 0),x(this,"dtlsFailedCount",0),x(this,"sendMutex",void 0),x(this,"recvMutex",void 0),x(this,"_state",Ft.Disconnected),x(this,"_restartStates",["disconnected","failed"]),x(this,"reconnectInterval",void 0),x(this,"uploadUnplinkStarted",!1),x(this,"uploadDownlinkStarted",!1),x(this,"uplinkStateUploadInterval",void 0),x(this,"downlinkStatsUploadInterval",void 0),x(this,"handleMuteLocalTrack",async(n,i,a)=>{const c=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Ft.Connected)return void a(new de(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const m=this.filterTobeMutedTracks(n);if(m.length===0)return void i();const g=m.find(b=>b[0]==="videoLowTrack");g&&g[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(m.map(b=>{let[,{id:O}]=b;return O}));let _=!1;var d,h;n.trackMediaType==="video"?_=!((d=this.localTrackMap.get(ye.LocalAudioTrack))===null||d===void 0||!d.track._muted):_=((h=this.localTrackMap.get(ye.LocalVideoTrack))===null||h===void 0?void 0:h.id)===void 0;const v=this.createMuteMessage(m);await cn(this,Fe.RequestMuteLocal,v);const y=n.trackMediaType==="video"?id.MUTE_LOCAL_VIDEO:id.MUTE_LOCAL_AUDIO;await cn(this,Fe.RequestP2PMuteLocal,{action:y,message:v,isMuteAll:_}),i()}catch(m){a(m)}finally{c()}}),x(this,"handleUnmuteLocalTrack",async(n,i,a)=>{const c=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Ft.Connected)return void a(new de(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const d=this.filterTobeUnmutedTracks(n);if(d.length===0)return void i();await this.sendConnection.unmuteLocal(d.map(g=>{let[,{id:_}]=g;return _}));const h=this.createUnmuteMessage(d),m=n.trackMediaType==="video"?id.UNMUTE_LOCAL_VIDEO:id.UNMUTE_LOCAL_AUDIO;await cn(this,Fe.RequestP2PMuteLocal,{action:m,message:h}),i()}catch(d){a(d)}finally{c()}}),x(this,"handleUpdateVideoEncoder",async(n,i,a,c)=>{let d;typeof c=="boolean"&&c||(d=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const m=this.localTrackMap.get(ye.LocalVideoTrack);if(!this.sendConnection||!m||m.track!==n||this.state!==Ft.Connected)return void i();const{id:g,track:_}=m;g&&(await this.sendConnection.updateSendParameters(g,_),await this.sendConnection.updateEncoderConfig(g,_),this.emit(Fe.UpdateVideoEncoder,_)),i()}catch(m){a(m)}finally{var h;(h=d)===null||h===void 0||h()}}),x(this,"handleUpdateVideoSendParameters",async(n,i,a)=>{const c=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const d=this.localTrackMap.get(ye.LocalVideoTrack);if(!this.sendConnection||!d||d.track!==n||this.state!==Ft.Connected)return void i();const{id:h,track:m}=d;h&&await this.sendConnection.updateSendParameters(h,m),i()}catch(d){a(d)}finally{c()}}),x(this,"handleReplaceTrack",async(n,i,a,c)=>{let d;R.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof c=="boolean"&&c||(d=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var h;const g=Array.from(this.localTrackMap.entries()).find(_=>{let[,{track:v}]=_;return n===v});if(!this.sendConnection||!g||g[1].id===void 0||this.state!==Ft.Connected)return void i();if(await((h=this.sendConnection)===null||h===void 0?void 0:h.replaceTrack(n,g[1].id)),g[0]===ye.LocalVideoTrack&&vt().supportDualStreamEncoding){const _=this.localTrackMap.get(ye.LocalVideoLowTrack);if(_){const v=n._mediaStreamTrack.clone();_.track._originMediaStreamTrack.stop(),_.track._mediaStreamTrack=v,_.track._originMediaStreamTrack=v,await new we((y,b)=>{this.handleReplaceTrack(_.track,y,b,!0)})}}i()}catch(g){a(g)}finally{var m;(m=d)===null||m===void 0||m()}}),x(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),x(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),x(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),x(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new hB(e),this.bindStatsUploaderEvents(),this.sendMutex=new Cr("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Cr("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},D("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new de(L.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new de(L.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new F6(e,this.store,Ni.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const i=await this.recvConnection.establish(t);return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}{this.state=Ft.New,this.sendConnection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new F6(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const i=await this.sendConnection.establish();return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new de(L.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ft.Connected}async addRemoteCandidate(e,t){if(t===Ni.RECEIVE_ONLY){if(!this.sendConnection)throw new de(L.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new de(L.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var i=this;return Li(function*(){const a=yield ht(i.sendMutex.lock("From P2PChannel.publish"));try{if(!i.sendConnection||i.state!==Ft.Connected){i.throwIfTrackTypeNotMatch(e);const g=e.filter(_=>i.pendingLocalTracks.indexOf(_)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(g))}i.store.pubId=i.store.pubId+1,Jr.markPublishStart(i.store.clientId,i.store.pubId);const c=i.filterTobePublishedTracks(e,t,n);if(c.length===0)return void(yield ht(i.tryToUnmuteAudio(e)));c.forEach(g=>{let{track:_,type:v}=g;const y=Date.now();i.store.publish(_.getTrackId(),v===ye.LocalAudioTrack?"audio":"video",y)}),i.bindLocalTrackEvents(c);const d=yield ht(i.sendConnection.send(c.map(g=>{let{track:_}=g;return _}),i.store.codec,i.store.audioCodec)),h=(yield ht(d.next())).value,m=i.createGatewayPublishMessage(c,h);try{yield m}catch(g){throw d.throw(g),(g==null?void 0:g.code)===L.WS_ABORT&&c.forEach(_=>{let{track:v}=_;i.pendingLocalTracks.indexOf(v)===-1&&i.pendingLocalTracks.push(v)}),i.unbindLocalTrackEvents(c),g}yield ht(d.next()),c.forEach(g=>{let{type:_}=g;i.statsCollector.addLocalStats(_)}),i.statsUploader.startUploadOutboundStats(),i.assignLocalTracks(c,h),c.forEach(g=>{let{track:_,type:v}=g;const y=Date.now();i.store.publish(_.getTrackId(),v===ye.LocalAudioTrack?"audio":"video",void 0,y)}),i.startUploadUplinkState()}finally{a()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Ft.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(a=>!ve(e).call(e,a)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(a=>a[0]==="videoLowTrack");n&&n[1].track.close();const i=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(a=>{let[,{id:c}]=a;return c})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(a=>{let[c,{track:d}]=a;return{type:c,track:d}})),t.forEach(a=>{let[c]=a;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Ft.Connected)return n&&n[1].track.close(),i;e.forEach(a=>{const c=this.pendingLocalTracks.indexOf(a);c!==-1&&this.pendingLocalTracks.splice(c,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],n=[];Array.from(this.localTrackMap.entries()).forEach(i=>{let[a,{track:c,ssrcs:d}]=i;const h={stream_type:Aae(c,a),ssrcs:d};c._muted||!c._enabled?t.push(h):n.push(h)}),t.length>0&&t.forEach(i=>{cn(this,Fe.RequestMuteLocal,[i])}),n.length>0&&n.forEach(i=>{cn(this,Fe.RequestUnmuteLocal,[i])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Li(function*(){throw new de(L.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(R.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Zn(this,Fe.RequestRePublish,this.pendingLocalTracks),this.emit(Fe.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new de(L.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,i){var a;if(!this.recvConnection)throw new de(L.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((a=this.remoteUserMap.get(e))!==null&&a!==void 0&&a.has(t))return;const{track:c,mid:d,transceiver:h}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),i);t===De.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(c):(e._audioTrack=new Zp(c,e.uid,e._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),h&&e._audioTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(c):(e._videoTrack=new $p(c,e.uid,e._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),h&&e._videoTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._videoTrack));const m=this.remoteUserMap.get(e);m?m.set(t,d):this.remoteUserMap.set(e,new Map([[t,d]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const g=this.pendingRemoteTracks.findIndex(_=>{let{user:v,kind:y}=_;return v.uid===e.uid&&t===y});g!==-1&&(this.pendingRemoteTracks.splice(g,1),this.emit(Fe.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,i){if(!this.recvConnection)throw new de(L.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),i)}async unsubscribe(e,t,n){const i=this.pendingRemoteTracks.filter(c=>{let{user:d,kind:h}=c;return t!==void 0?d.uid===e.uid&&t===h:d.uid===e.uid});if(i.forEach(c=>{const d=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(d,1)}),this.recvConnection||n||i.forEach(c=>{let{kind:d}=c;var h;if(d===De.AUDIO)(h=e._audioTrack)===null||h===void 0||h._destroy(),e._audioTrack=void 0;else if(d===De.VIDEO){var m;(m=e._videoTrack)===null||m===void 0||m._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const a=this.filterTobeUnSubscribedTracks(e,t);a.length!==0&&(await this.recvConnection.stopReceiving(a.map(c=>{let[,{id:d}]=c;return d})),this.withdrawRemoteTracks(a),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),a.forEach(c=>{let[d,{kind:h}]=c;var m,g;if(h===De.VIDEO&&d._videoSSRC&&((m=this.recvConnection)===null||m===void 0||m.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),h===De.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),n||((g=d._videoTrack)===null||g===void 0||g._destroy(),d._videoTrack=void 0);else if(h===De.AUDIO){var _;this.unbindRemoteTrackEvents(d._audioTrack),!n&&((_=d._audioTrack)===null||_===void 0||_._destroy(),d._audioTrack=void 0)}}),a.forEach(c=>{let[,{kind:d}]=c;cn(this,Fe.RequestP2PMuteRemote,d)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,n]=t;[De.VIDEO,De.AUDIO].forEach(i=>{n.has(i)?cn(this,Fe.RequestP2PUnmuteRemote,i):cn(this,Fe.RequestP2PMuteRemote,i)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new de(L.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new de(L.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new de(L.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new de(L.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const i=t===De.VIDEO?e._videoSSRC:e._audioSSRC;i!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||R.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(ye.LocalAudioTrack);if((t==null?void 0:t.track)instanceof sr){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[a]=i;return a!==ye.LocalAudioTrack}).filter(i=>{let[a]=i;return!(e&&a===ye.LocalVideoLowTrack)}).map(i=>{let[,{track:a}]=i;return a}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(e&&i===ye.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}reportPublishEvent(e,t,n,i,a){if(e){const d=this.localTrackMap.get(ye.LocalAudioTrack),h=i?this.localTrackMap.get(ye.LocalVideoLowTrack):this.localTrackMap.get(ye.LocalVideoTrack);Le.publish(this.store.sessionId,{eventElapse:Jr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d==null?void 0:d.track.getTrackLabel(),videoName:h==null?void 0:h.track.getTrackLabel(),screenshare:(h==null?void 0:h.track._hints.indexOf(Bt.SCREEN_TRACK))!==-1,audio:!!d,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}else{var c;n||(n=[]);const d=n.find(m=>m instanceof Dn),h=i?(c=this.localTrackMap.get(ye.LocalVideoTrack))===null||c===void 0?void 0:c.track:n.find(m=>m instanceof sn);Le.publish(this.store.sessionId,{eventElapse:Jr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d==null?void 0:d.getTrackLabel(),videoName:h==null?void 0:h.getTrackLabel(),screenshare:(h==null?void 0:h._hints.indexOf(Bt.SCREEN_TRACK))!==-1,audio:!!d,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}}reportSubscribeEvent(e,t,n,i){const a=i===De.VIDEO?n._videoSSRC:n._audioSSRC;a&&Le.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===De.VIDEO,audio:i===De.AUDIO,peerid:n.uid,subscribeRequestid:i===De.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:Jr.measureFromSubscribeStart(this.store.clientId,a)})}reset(){R.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Cr("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Cr("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(ye.LocalAudioTrack);if((e==null?void 0:e.track)instanceof sr){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Ft.Disconnected}getStats(e){var t,n;return e?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(ye.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(ye.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof sn||t&&t.track instanceof Dn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(ri(t=this.remoteUserMap).call(t)).find(i=>i.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(ye.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Tu(e).call(e,(n,i)=>n.level-i.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(R.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Ft.Reconnecting,D("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:i}]=e;switch(n){case ye.LocalVideoTrack:ve(t=i._hints).call(t,Bt.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case ye.LocalAudioTrack:i instanceof sr?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case ye.LocalVideoLowTrack:}}),this.emit(Fe.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(ri(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(t,i)}),this.emit(Fe.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),R.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:i,kind:a}=n;if((e instanceof ad?e.uid:e)===i.uid&&t===a)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,i;if(e===Ni.SEND_ONLY){if(!this.sendConnection)throw new de(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),i=this.sendConnection}else{if(!this.recvConnection)throw new de(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),i=this.recvConnection}try{if(t){const a=await i.restartICE(t);return i.isInRestartIce=!1,a}{const a=await i.restartICE();if(a){const c=await Zn(this,Fe.RequestP2PRestartICE,{direction:Ni.RECEIVE_ONLY,iceParameter:a});await i.restartICE(c),i.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(ye.LocalVideoTrack),n=this.localTrackMap.get(ye.LocalAudioTrack),i=e.videoSend.find(b=>{var O;return b.ssrc===(t==null||(O=t.ssrcs)===null||O===void 0?void 0:O[0].ssrcId)}),a=e.audioSend.find(b=>{var O;return b.ssrc===(n==null||(O=n.ssrcs)===null||O===void 0?void 0:O[0].ssrcId)});if(!i||!a)return 1;const c=Ss(this,Fe.NeedSignalRTT),d=i?i.rttMs:void 0,h=a?a.rttMs:void 0,m=d&&h?(d+h)/2:d||h,g=(m&&c?(m+c)/2:m||c)||0,_=100*e.sendPacketLossRate*.7/50+.3*g/1500,v=_<.17?1:_<.36?2:_<.59?3:_<.1?4:5,y=t==null?void 0:t.track;if(y&&y._encoderConfig&&y._hints.indexOf(Bt.SCREEN_TRACK)===-1){const b=y._encoderConfig.bitrateMax,O=e.bitrate.actualEncoded;if(b&&O){const I=(1e3*b-O)/(1e3*b);return n3[I<.15?0:I<.3?1:I<.45?2:I<.6?3:4][v]}}return v}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const a=i._audioSSRC,c=i._videoSSRC,d=e.audioRecv.find(O=>O.ssrc===a),h=e.videoRecv.find(O=>O.ssrc===c);if(!d&&!h)return void(t+=1);const m=Ss(this,Fe.NeedSignalRTT),g=e.rtt,_=(g&&m?(g+m)/2:g||m)||0,v=d?d.jitterMs:void 0,y=e.recvPacketLossRate;let b=.7*y*100/50+.3*_/1500;v&&(b=.6*y*100/50+.2*_/1500+.2*v/400),t+=b<.1?1:b<.17?2:b<.36?3:b<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new we((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const i=[],a=vt(),c=this.getAllTracks();e=Vp(e=e.filter(m=>c.indexOf(m)===-1));let d=!1,h=!1;for(const m of e){if(m instanceof sn&&(this.localTrackMap.has(ye.LocalVideoTrack)||d?new de(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:m,type:ye.LocalVideoTrack}),d=!0),t)){const g=this.getLowVideoTrack(m,n);i.push({track:g,type:ye.LocalVideoLowTrack})}if(m instanceof Dn){const g=this.localTrackMap.get(ye.LocalAudioTrack);if(g){if(!(g.track instanceof sr))throw new de(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new de(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");g.track.addAudioTrack(m),this.bindLocalAudioTrackEvents(m,!0)}else if(h){const _=i.find(v=>{let{type:y}=v;return y===ye.LocalAudioTrack});if(!(_.track instanceof sr))throw new de(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new de(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");_.track.addAudioTrack(m)}else{if(!a.webAudioMediaStreamDest||m instanceof sr||m._bypassWebAudio)i.push({track:m,type:ye.LocalAudioTrack});else{const _=new sr;_.addAudioTrack(m),i.push({track:_,type:ye.LocalAudioTrack})}h=!0}}}return i}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Vp(e=e.filter(i=>n.indexOf(i)!==-1));for(const i of e){if(i instanceof Dn){const a=this.localTrackMap.get(ye.LocalAudioTrack);if(!a)continue;a.track instanceof sr?(a.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),a.track.trackList.length===0&&(t.push([ye.LocalAudioTrack,a]),a.track.close())):t.push([ye.LocalAudioTrack,a])}if(i instanceof sn){const a=this.localTrackMap.get(ye.LocalVideoTrack);if(!a)continue;t.push([ye.LocalVideoTrack,a]);const c=this.localTrackMap.get(ye.LocalVideoLowTrack);c&&t.push([ye.LocalVideoLowTrack,c])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:i}=t;switch(i){case ye.LocalVideoTrack:n.addListener(Me.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Me.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Me.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Me.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ye.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case ye.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof sr?e.trackList.forEach(n=>{n.addListener(Me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Me.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Me.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(Me.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:i}]=t;return{track:i,type:n}})),e.forEach(t=>{let{track:n,type:i}=t;switch(i){case ye.LocalVideoTrack:n.off(Me.GET_STATS,this.handleGetLocalVideoStats),n.off(Me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Me.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Me.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Me.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ye.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case ye.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof sr?e.trackList.forEach(t=>{t.off(Me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Me.GET_STATS,this.handleGetLocalAudioStats),t.off(Me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Me.GET_STATS,this.handleGetLocalAudioStats),e.off(Me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Me.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof $p&&t.addListener(Me.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof Zp&&t.addListener(Me.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Me.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(De.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(De.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,i)=>{var a;let c,{track:d,type:h}=n;switch(h){case ye.LocalAudioTrack:c=Ht.Audio;break;case ye.LocalVideoTrack:c=ve(a=d._hints).call(a,Bt.SCREEN_TRACK)?Ht.Screen:Ht.High;break;case ye.LocalVideoLowTrack:c=Ht.Low}return{kind:h===ye.LocalAudioTrack?De.AUDIO:De.VIDEO,stream_type:c,mid:t[i].id,ssrcs:t[i].localSSRC,isMuted:d.muted||!d.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let i,[a,{track:c,ssrcs:d,id:h}]=t;switch(a){case ye.LocalVideoTrack:i=ve(n=c._hints).call(n,Bt.SCREEN_TRACK)?Ht.Screen:Ht.High;break;case ye.LocalAudioTrack:i=Ht.Audio;break;case ye.LocalVideoLowTrack:i=Ht.Low}return{stream_type:i,ssrcs:d,mid:h}})}assignLocalTracks(e,t){e.forEach((n,i)=>{let{track:a,type:c}=n;this.localTrackMap.set(c,{track:a,id:t[i].id,ssrcs:t[i].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Fe.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),ve(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&(t==="disconnected"&&await pr(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Le.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:rn.TRACER}).onSuccess(),this.emit(Fe.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const i=Array.from(ri(n=this.remoteUserMap).call(n)).find(c=>c._audioSSRC===t);var a;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(a=i.audioTrack)===null||a===void 0||a.emit(so.FIRST_FRAME_DECODED),Le.firstRemoteFrame(this.store.sessionId,ir.FIRST_AUDIO_DECODE,En.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:Jr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const i=Array.from(ri(n=this.remoteUserMap).call(n)).find(a=>a._audioSSRC===t);i&&Le.firstRemoteFrame(this.store.sessionId,ir.FIRST_AUDIO_RECEIVED,En.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:Jr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,i)=>{this.reportVideoFirstFrameDecoded(t,n,i)},e.onFirstVideoReceived=t=>{var n;const i=Array.from(ri(n=this.remoteUserMap).call(n)).find(a=>a._videoSSRC===t);i&&Le.firstRemoteFrame(this.store.sessionId,ir.FIRST_VIDEO_RECEIVED,En.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:Jr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const i=t.candidateType==="relay",a=n.candidateType==="relay";n.candidateType!=="unknown"&&i===a||this.emit(Fe.ConnectionTypeChange,i),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(sd(n))," -> ").concat(JSON.stringify(sd(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(sd(n))," -> ").concat(JSON.stringify(sd(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Fe.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===Ni.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,R.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Ni.SEND_ONLY?this.restartICE(e):Zn(this,Fe.RequestP2PRestartICE,{direction:Ni.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(ye.LocalAudioTrack);if(e instanceof Dn&&(n==null?void 0:n.track)instanceof sr)return n.track.isActive||t.push([ye.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:c}]=a;return e===c});if(i&&(t.push(i),i[0]===ye.LocalVideoTrack)){const a=this.localTrackMap.get(ye.LocalVideoLowTrack);a&&t.push([ye.LocalVideoLowTrack,a])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(ye.LocalAudioTrack);if(e instanceof Dn&&(n==null?void 0:n.track)instanceof sr)return n.track.isActive&&t.push([ye.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:c}]=a;return e===c});if(i)if(i[0]===ye.LocalVideoTrack){t.push(i);const a=this.localTrackMap.get(ye.LocalVideoLowTrack);a&&t.push([ye.LocalVideoLowTrack,a])}else t.push(i);return t}createMuteMessage(e){return e.map(t=>{var n;let i,[a,{track:c,ssrcs:d,id:h}]=t;switch(a){case ye.LocalAudioTrack:i=Ht.Audio;break;case ye.LocalVideoTrack:i=ve(n=c._hints).call(n,Bt.SCREEN_TRACK)?Ht.Screen:Ht.High;break;case ye.LocalVideoLowTrack:i=Ht.Low}return{stream_type:i,ssrcs:d,mid:h}})}createUnmuteMessage(e){return e.map(t=>{var n;let i,[a,{track:c,ssrcs:d,id:h}]=t;switch(a){case ye.LocalAudioTrack:i=Ht.Audio;break;case ye.LocalVideoTrack:i=ve(n=c._hints).call(n,Bt.SCREEN_TRACK)?Ht.Screen:Ht.High;break;case ye.LocalVideoLowTrack:i=Ht.Low}return{stream_type:i,ssrcs:d,mid:h}})}filterTobeUnSubscribedTracks(e,t){const n=[],i=this.remoteUserMap.get(e);if(!i)return n;if(t){const a=i.get(t);if(!a)return n;n.push([e,{kind:t,id:a}])}else Array.from(i.entries()).forEach(a=>{let[c,d]=a;n.push([e,{kind:c,id:d}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[i,{kind:a,id:c}]=n;switch(a){case De.VIDEO:return void(i._videoSSRC&&t.push({stream_type:De.VIDEO,ssrcId:i._videoSSRC}));case De.AUDIO:return void(i._audioSSRC&&t.push({stream_type:De.AUDIO,ssrcId:i._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:i}]=t;const a=this.remoteUserMap.get(n);a&&(a.delete(i),Array.from(a.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(ye.LocalVideoTrack),n=this.localTrackMap.get(ye.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new we((i,a)=>{this.handleUpdateVideoEncoder(t.track,i,a,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new we((i,a)=>{this.handleUpdateVideoEncoder(n.track,i,a,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Dn){const n=this.filterTobeUnmutedTracks(e[t]);if(n.length===0)continue;const i=this.createUnmuteMessage(n);return void await cn(this,Fe.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Fe.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Fe.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await pr(fS(this.dtlsFailedCount,Kn)),this.emit(Fe.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(ye.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof sn)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof sn).length>1)throw new de(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Dn).length>1&&(e.some(t=>t instanceof Dn&&t._bypassWebAudio)||!vt().webAudioMediaStreamDest))throw new de(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof sn&&this.pendingLocalTracks.some(n=>n instanceof sn))throw new de(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Dn&&this.pendingLocalTracks.some(n=>n instanceof Dn)&&(!vt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Dn&&n._bypassWebAudio)))throw new de(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!D("DISABLE_DUAL_STREAM_USE_ENCODING")&&vt().supportDualStreamEncoding,i=DT(DT({},{width:160,height:120,framerate:15,bitrate:50}),t);let a;a=n?e._mediaStreamTrack.clone():nN(e,i);const c=Wt(8,"track-low-"),d=new sn(a,DT(DT({},n&&{scaleResolutionDownBy:PA(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,c);return d.on(Bu.TRANSCEIVER_UPDATED,h=>{e._updateRtpTransceiver(h,Kp.LOW_STREAM)}),d._hints.push(Bt.LOW_STREAM),e.addListener(Me.NEED_CLOSE,()=>{d.close()}),d}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,i){var a;const c=Array.from(ri(a=this.remoteUserMap).call(a)).find(d=>d._videoSSRC===e);if(c){i||this.store.subscribe(c.uid,"video",void 0,void 0,void 0,void 0,Date.now());const d=this.store.keyMetrics,h=d.subscribe.find(m=>m.userId===c.uid&&m.type==="video");Le.firstRemoteVideoDecode(this.store.sessionId,ir.FIRST_VIDEO_DECODE,En.FIRST_VIDEO_DECODE,{peer:c._uintid,videowidth:t,videoheight:n,subscribeElapse:Jr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:d.requestAPEnd||0,apStart:d.requestAPStart||0,joinGwEnd:d.joinGatewayEnd||0,joinGwStart:d.joinGatewayStart||0,pcEnd:d.peerConnectionEnd||0,pcStart:d.peerConnectionStart||0,subscriberEnd:(h==null?void 0:h.subscribeEnd)||0,subscriberStart:(h==null?void 0:h.subscribeStart)||0,videoAddNotify:(h==null?void 0:h.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const i=this.remoteUserMap.get(e);if(!i)return!1;const a=i.get(t);if(!a)return!1;const c=await this.recvConnection.getRemoteSSRC(a);return c!==void 0&&c!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new de(L.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new de(L.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new de(L.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new de(L.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new de(L.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new de(L.NOT_SUPPORTED)}async preConnect(e){throw new de(L.NOT_SUPPORTED)}getEstablishParams(){throw new de(L.NOT_SUPPORTED)}async reSubscribe(e){throw new de(L.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new de(L.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===ye.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Kp.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Ie(bn.prototype,"p2pConnect",[B6],Object.getOwnPropertyDescriptor(bn.prototype,"p2pConnect"),bn.prototype),Ie(bn.prototype,"unpublish",[G6],Object.getOwnPropertyDescriptor(bn.prototype,"unpublish"),bn.prototype),Ie(bn.prototype,"unpublishLowStream",[W6],Object.getOwnPropertyDescriptor(bn.prototype,"unpublishLowStream"),bn.prototype),Ie(bn.prototype,"subscribe",[z6],Object.getOwnPropertyDescriptor(bn.prototype,"subscribe"),bn.prototype),Ie(bn.prototype,"mockSubscribe",[H6],Object.getOwnPropertyDescriptor(bn.prototype,"mockSubscribe"),bn.prototype),Ie(bn.prototype,"unsubscribe",[K6],Object.getOwnPropertyDescriptor(bn.prototype,"unsubscribe"),bn.prototype),Ie(bn.prototype,"muteRemote",[q6],Object.getOwnPropertyDescriptor(bn.prototype,"muteRemote"),bn.prototype),Ie(bn.prototype,"unmuteRemote",[Y6],Object.getOwnPropertyDescriptor(bn.prototype,"unmuteRemote"),bn.prototype),Ie(bn.prototype,"hasRemoteMediaWithLock",[X6],Object.getOwnPropertyDescriptor(bn.prototype,"hasRemoteMediaWithLock"),bn.prototype),Ie(bn.prototype,"disconnectForReconnect",[J6],Object.getOwnPropertyDescriptor(bn.prototype,"disconnectForReconnect"),bn.prototype),Ie(bn.prototype,"remoteMediaSsrcChanged",[Q6],Object.getOwnPropertyDescriptor(bn.prototype,"remoteMediaSsrcChanged"),bn.prototype),bn);function ba(e){return function(t,n,i){const a=t[n];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var c=arguments.length,d=new Array(c),h=0;h<c;h++)d[h]=arguments[h];switch(e){case Ta.SEND_ONLY:{const m=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await a.apply(this,d)}finally{m()}}case Ta.RECEIVE_ONLY:{const m=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await a.apply(this,d)}finally{m()}}default:{const m=await this.sendMutex.lock("From P2PChannel2.".concat(n)),g=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await a.apply(this,d)}finally{m(),g()}}}},i}}class ch extends Sn{constructor(t,n){super(),x(this,"signal",void 0),x(this,"token",void 0),x(this,"tokenTimeout",void 0),x(this,"tokenInterval",void 0),x(this,"_sequence",0),x(this,"userMap",new Map),x(this,"encoder",new TextEncoder),this.signal=t,this.token=n;const i=()=>{this.signal.connectionState===bt.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(i,1e3):this.tokenInterval=window.setTimeout(i,3*D("P2P_TOKEN_INTERVAL"))};i()}async send(t,n,i,a,c){var d;if(this.userMap.size===0)return;const h=Array.from(Es(d=this.userMap).call(d))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),a=a??Wt(6,""),c=c??this._sequence++;const m={_id:a,_type:t,_seq:c,_message:n,token:"".concat(this.token,"_").concat(h)};D("SHOW_P2P_LOG")&&R.debug("send message",m,"noNeedResponse : ".concat(i)),this.splitMessage(JSON.stringify(m)).forEach(_=>{this.signal.request(Ve.DATA_STREAM,{payload:ed(this.encoder.encode(_))})});const g=new we((_,v)=>{const y=window.setTimeout(()=>{this.off("res-@".concat(a,"_ack"),b),this.off("res-@".concat(a),I),this.off(im.ABORT,O),R.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(a)),this.userMap.size===0?v(new de(L.INVALID_REMOTE_USER)):v(new de(L.TIMEOUT))},D("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),b=()=>{y&&window.clearTimeout(y),this.off(im.ABORT,O),i&&_()},O=()=>{y&&window.clearTimeout(y),this.off("res-@".concat(a,"_ack"),b),this.off("res-@".concat(a),I),v(new de(L.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(a)))};this.once(im.ABORT,O),this.once("res-@".concat(a,"_ack"),b);const I=(k,j)=>{N=!0,y&&window.clearTimeout(y),this.off("res-@".concat(a,"_ack"),b),this.off(im.ABORT,O),k==="success"?_(j):v(new de(L.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(a)))};let N=!1;i||(this.once("res-@".concat(a),I),pr(D("SIGNAL_REQUEST_TIMEOUT")).then(()=>{N||R.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(a,", ").concat(m))}))});try{return await g}catch(_){if(_.code===L.TIMEOUT)return await this.send(t,n,i,a,c);throw _}}onMessage(t){var n;const{_uid:i}=t;let a,c=this.userMap.get(i);if(c)a=c.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Bn.CHECK)return;const{token:g}=t;a=new Map,c={uid:i,isStart:!0,token:g,splitMessageMap:a,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(i,c),this.signal.emit(Ze.ON_USER_ONLINE,{uid:i}),this.handleUserOnline()}if("id"in t&&"total"in t){var d;const{id:g,total:_}=t,v=(d=a.get(g))!==null&&d!==void 0?d:[];if(v.push(t),a.has(g)||a.set(g,v),v.length!==_)return;{const y=Tu(v).call(v,(b,O)=>b.index-O.index).map(b=>b.payload).join("");a.delete(g),(t=JSON.parse(y))._uid=i}}const{_type:h,token:m}=t;if(ve(n=[Bn.ACK,Bn.CHECK]).call(n,h))return h===Bn.CHECK&&this.handleCheckToken(c,m),void this.receiveMessage(t);m==="".concat(c.token,"_").concat(this.token)?this.handleReceivedMessage(t):R.debug('Receive unexpected message", '.concat(m,", cur_token: ").concat(c.token,"_").concat(this.token),t)}check(){const t={_id:Wt(6,""),token:this.token,_type:Bn.CHECK};D("SHOW_P2P_LOG")&&R.debug("send message",t),this.signal.request(Ve.DATA_STREAM,{payload:ed(this.encoder.encode(JSON.stringify(t)))})}ack(t){const n={_id:t,_type:Bn.ACK,token:this.token};D("SHOW_P2P_LOG")&&R.debug("send message",n),this.signal.request(Ve.DATA_STREAM,{payload:ed(this.encoder.encode(JSON.stringify(n)))})}response(t,n,i){this.send(Bn.RESPONSE,JSON.stringify({success:!i,message:n}),!0,t)}handleReceivedMessage(t){const n=()=>{this.userMap.forEach(g=>{const{receivedMessagesMap:_,nextExpectedSequenceNumber:v}=g;for(;_.has(v);){const y=_.get(v);_.delete(v),this.receiveMessage(y),g.nextExpectedSequenceNumber++}})};if(!t)return void n();const{_uid:i,_seq:a}=t,c=this.userMap.get(i),{receivedMessagesMap:d,isStart:h,nextExpectedSequenceNumber:m}=c;if(a<m)return this.ack(t._id),void R.debug("[external-signal] receive old message, seq: ".concat(a,", ").concat(t._message));d.set(a,t),h&&a===m&&(this.receiveMessage(t),d.delete(m),c.nextExpectedSequenceNumber++,n())}receiveMessage(t){const{_id:n,_type:i,_message:a,_uid:c}=t;if(D("SHOW_P2P_LOG")&&R.debug("receive message",t),n){let d;switch(t._type!==Bn.ACK&&(a&&(d=JSON.parse(a)),this.ack(t._id)),t._type){case Bn.CANDIDATE:case Bn.CONTROL:this.signal.emit(i,d,c);break;case Bn.PUBLISH:case Bn.UNPUBLISH:case Bn.RESTART_ICE:case Bn.CALL:d.uid=c,Zn(this.signal,i,d).then(h=>{this.response(t._id,h)}).catch(()=>{this.response(t._id,void 0,!0)});break;case Bn.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case Bn.RESPONSE:{const{success:h,message:m}=d;this.emit("res-@".concat(n),h?"success":"failed",m);break}}}}splitMessage(t){if(t.length<ch.MAX_MESSAGE_SIZE)return[t];const n=[],{remoteToken:i}=JSON.parse(t),a=Wt(6,"");let c=0,d=800;const h=Math.ceil(t.length/d);for(;t.length>0;){c++;const m={id:a,index:c,total:h,payload:t.slice(0,d),token:"".concat(this.token,"_").concat(i)};JSON.stringify(m).length>ch.MAX_MESSAGE_SIZE?d-=50:(n.push(m),t=t.slice(d))}return n.map(m=>JSON.stringify(m))}handleCheckToken(t,n){return t.token!==n?(R.debug("token changed, from ".concat(t.token," to ").concat(n)),this.reset(t.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{R.debug("token timeout, ".concat(n)),this.reset(t.uid)},D("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await Zn(this.signal,Bn.CALL,void 0),n=await this.send(Bn.CALL,t);this.signal.emit(Ue.P2P_CONNECTION,n,!0)}async reset(t,n){const i=this.userMap.get(t);i&&(this.emit(im.ABORT),this.signal.emit(Ze.ON_USER_OFFLINE,{uid:i.uid,reason:nae.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(R.debug("change local token from ".concat(n," to ").concat(n)),this.token=Wt(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(im.ABORT)}}x(ch,"MAX_SIZE",1),x(ch,"MAX_MESSAGE_SIZE",1024);class Ble extends Sn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===bt.CONNECTED?this.emit(Ue.WS_CONNECTED):t===bt.RECONNECTING?this.emit(Ue.WS_RECONNECTING,this._websocketReconnectReason):t===bt.CLOSED&&this.emit(Ue.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),x(this,"__name__","P2PSignal"),x(this,"_disconnectedReason",void 0),x(this,"_websocketReconnectReason",void 0),x(this,"_connectionState",bt.CLOSED),x(this,"reconnectToken",void 0),x(this,"p2pToken",void 0),x(this,"websocket",void 0),x(this,"openConnectionTime",void 0),x(this,"clientId",void 0),x(this,"lastMsgTime",Date.now()),x(this,"uploadCache",[]),x(this,"uploadCacheInterval",void 0),x(this,"rttRolling",new LI(5)),x(this,"pingpongTimer",void 0),x(this,"pingpongTimeoutCount",0),x(this,"joinResponse",void 0),x(this,"multiIpOption",void 0),x(this,"initError",void 0),x(this,"spec",void 0),x(this,"store",void 0),x(this,"_external_signal",void 0),x(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(Ue.ON_BINARY_DATA,i.data);const a=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(a,"_id")){const c="res-@".concat(a._id);this.emit(c,a._result,a._message)}else if(Object.prototype.hasOwnProperty.call(a,"_type")){switch(a._type){case Ze.ON_DATA_STREAM:return void this.handleDataStream(a._message);case Ze.MUTE_AUDIO:case Ze.MUTE_VIDEO:case Ze.ON_P2P_LOST:case Ze.ON_USER_ONLINE:return;case Ze.ON_USER_OFFLINE:const{uid:c}=a._message;return R.debug("[".concat(this.clientId,"] user-offline uid: ").concat(c)),void this._external_signal.reset(c)}if(this.emit(a._type,a._message),a._type===Ze.ON_NOTIFICATION&&this.handleNotification(a._message),a._type===Ze.ON_USER_BANNED)switch(a._message.error_code){case 14:this.close(Tt.UID_BANNED);break;case 15:this.close(Tt.IP_BANNED);break;case 16:this.close(Tt.CHANNEL_BANNED)}if(a._type===Ze.ON_USER_LICENSE_BANNED)switch(a._message.error_code){case We.ERR_LICENSE_MISSING:this.close(Tt.LICENSE_MISSING);break;case We.ERR_LICENSE_EXPIRED:this.close(Tt.LICENSE_EXPIRED);break;case We.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Tt.LICENSE_MINUTES_EXCEEDED);break;case We.ERR_LICENSE_PERIOD_INVALID:this.close(Tt.LICENSE_PERIOD_INVALID);break;case We.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Tt.LICENSE_MULTIPLE_SDK_SERVICE);break;case We.ERR_LICENSE_ILLEGAL:this.close(Tt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new NA("gateway-".concat(this.clientId),this.spec.retryConfig,!0,D("JOIN_GATEWAY_USE_DUAL_DOMAIN"),D("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===bt.CONNECTED&&this.reconnect("retry",Wr.OFFLINE)}),this.p2pToken=Wt(6,""),this._external_signal=new ch(this,this.p2pToken)}async request(t,n,i,a){const c=Wt(6,""),d={_id:c,_type:t,_message:n},h=this.websocket.connectionID,m=()=>new we((O,I)=>{if(this.connectionState===bt.CONNECTED)return O();const N=()=>{this.off(Ue.WS_CLOSED,k),O()},k=()=>{this.off(Ue.WS_CONNECTED,N),I(new de(L.WS_ABORT))};this.once(Ue.WS_CONNECTED,N),this.once(Ue.WS_CLOSED,k)});if(this.connectionState!==bt.CONNECTING&&this.connectionState!==bt.RECONNECTING||t===Ve.JOIN||t===Ve.REJOIN||await m(),this.websocket.sendMessage(d,!0),a)return;const g=new we((O,I)=>{let N=!1;const k=(G,K)=>{N=!0,O({isSuccess:G==="success",message:K||{}}),this.off(Ue.WS_CLOSED,j),this.off(Ue.WS_RECONNECTING,j),this.emit(Ue.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(c),k);const j=()=>{I(new de(L.WS_ABORT,"type: ".concat(t))),this.off(Ue.WS_CLOSED,j),this.off(Ue.WS_RECONNECTING,j),this.off("res-@".concat(c),k)};this.once(Ue.WS_CLOSED,j),this.once(Ue.WS_RECONNECTING,j),pr(D("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==h||N||(R.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Ue.REQUEST_TIMEOUT,t,n))})});let _=null;try{_=await g}catch(O){if(this.connectionState===bt.CLOSED||t===Ve.LEAVE)throw new de(L.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?O.throw():t===Ve.JOIN||t===Ve.REJOIN?null:(await m(),await this.request(t,n))}if(_.isSuccess)return _.message;const v=Number(_.message.error_code||_.message.code),y=Xu(v),b=new de(L.UNEXPECTED_RESPONSE,"".concat(y.desc,": ").concat(_.message.error_str),{code:v,data:_.message,desc:y.desc});return y.action==="success"?_.message:(R.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(v,", message: ").concat(y.desc,", action: ").concat(y.action)),v===We.ERR_TOO_MANY_BROADCASTERS?((t===Ve.JOIN||t===Ve.REJOIN)&&(this.initError=b,this.close()),b.throw()):y.action==="failed"?b.throw():y.action==="quit"?(this.initError=b,this.close(),b.throw()):(v===We.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Wr.MULTI_IP)):this.reconnect(y.action,Wr.SERVER_ERROR),t===Ve.JOIN||t===Ve.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new we(i=>{const a=c=>{(!n||n(c))&&(this.off(t,a),i(c))};this.on(t,a)})}uploadWRTCStats(t){if(!this.store.sessionId)return void R.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Yu.WRTC_STATS,n)}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const c=D("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>c&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==bt.CONNECTED)return;const d=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(d._type,d._message)},D("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const i={_type:t,_message:n};this.websocket.sendMessage(i)}async sendExtensionMessage(t,n,i){return await this._external_signal.send(t,n,i)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new we((n,i)=>{this.once(Ue.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Ue.WS_CLOSED,()=>i(this.initError||new de(L.WS_ABORT))),this.connectionState=bt.CONNECTING,this.websocket.init(t).catch(i)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||Tt.LEAVE,this.connectionState=bt.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Wt(6,""),this._external_signal.clear(),this._external_signal=new ch(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Ue.ABORT_P2P_EXECUTION);const t=await Zn(this,Ue.REQUEST_JOIN_INFO),n=await this.request(Ve.JOIN,t);if(!n)return this.emit(Ue.REPORT_JOIN_GATEWAY,L.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Ue.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=bt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){return!1}handleDataStream(t){try{var n;const i=Mu(t.payload),a=new TextDecoder().decode(i),c=JSON.parse(a);"total"in c&&"id"in c||ve(n=Object.values(Bn)).call(n,c._type)?(c._uid=t.uid,this._external_signal.onMessage(c)):this.emit(Ze.ON_DATA_STREAM,t)}catch{this.emit(Ze.ON_DATA_STREAM,t)}}handleNotification(t){R.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Xu(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?t.code===We.ERR_REPEAT_JOIN_CHANNEL&&D("IGNORE_UID_CHECK")?void this.close(Tt.UID_CONFLICT):(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Tt.UID_BANNED),void this.close()):void this.reconnect(n.action,Wr.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=D("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(R.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>D("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Wr.TIMEOUT):this.request(Ve.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),D("REPORT_STATS")&&this.send(Ve.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWebsocketEvents(){this.websocket.on(ct.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Ue.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(ct.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(ct.CLOSED,()=>{this.connectionState=bt.CLOSED}),this.websocket.on(ct.FAILED,()=>{this._disconnectedReason=Tt.NETWORK_ERROR,this.connectionState=bt.CLOSED}),this.websocket.on(ct.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===bt.CONNECTED?this.connectionState=bt.RECONNECTING:this.connectionState=bt.CONNECTING}),this.websocket.on(ct.WILL_RECONNECT,(t,n,i)=>{t!=="retry"?(R.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):R.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),i(t)}),this.websocket.on(ct.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(Ue.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof de&&t.code===L.UNEXPECTED_RESPONSE&&t.data.code===We.ERR_NO_AUTHORIZED)return R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Wr.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Wr.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(ct.REQUEST_NEW_URLS,(t,n)=>{Zn(this,Ue.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(ct.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ze.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const Gle={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new Fle(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new Ble(n,t)}};function Z6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function eG(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Z6(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z6(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class Wle{constructor(t){x(this,"sessionDesc",void 0),x(this,"localCapabilities",void 0),x(this,"rtpCapabilities",void 0),x(this,"candidates",void 0),x(this,"_originCandidates",void 0),x(this,"iceParameters",void 0),x(this,"dtlsParameters",void 0),x(this,"setup",void 0),x(this,"currentMidIndex",void 0),x(this,"cname",void 0),t=mn(t);const{iceParameters:n,dtlsParameters:i,candidates:a,rtpCapabilities:c,setup:d,localCapabilities:h,sdkCodec:m,cname:g}=t,_=Ci(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=c,this.candidates=a,this._originCandidates=mn(a),this.iceParameters=n,this.dtlsParameters=i,this.setup=d,this.localCapabilities=h,this.cname=g;for(let v=0;v<_.mediaDescriptions.length;v++){const y=_.mediaDescriptions[v];if(y.attributes.iceUfrag=n.iceUfrag,y.attributes.icePwd=n.icePwd,y.attributes.fingerprints=i.fingerprints,y.attributes.candidates=a,y.attributes.setup=d,y.media.mediaType==="video"){y.media.fmts=c.videoCodecs.map(I=>I.payloadType.toString(10));const b=c.videoCodecs.filter(I=>{var N,k;return(N=I.rtpMap)===null||N===void 0?void 0:ve(k=N.encodingName.toLowerCase()).call(k,m)}),O=c.videoCodecs.filter(I=>!ve(b).call(b,I));y.attributes.payloads=[...b,...O],y.attributes.extmaps=c.videoExtensions}y.media.mediaType==="audio"&&(y.media.fmts=c.audioCodecs.map(b=>b.payloadType.toString(10)),y.attributes.payloads=c.audioCodecs,y.attributes.extmaps=c.audioExtensions),_.mediaDescriptions[v]=this.mungMediaDesc(y)}this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}toString(){return Kc(this.sessionDesc)}send(t,n,i){const{ssrcs:a,ssrcGroups:c}=Xg(n,this.cname),d=this.sessionDesc.mediaDescriptions.find(g=>t===De.VIDEO?g.media.mediaType==="video":g.media.mediaType==="audio"),h=a[0].attributes.label,m=a[0].attributes.mslabel;return d.attributes.ssrcs=d.attributes.ssrcs.concat(a),d.attributes.ssrcGroups=d.attributes.ssrcGroups.concat(c),{id:h,mslabel:m}}batchSend(t){return t.map(n=>{let{kind:i,ssrcMsg:a}=n;return this.send(i,a,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(n=>{const i=[],a=[],c=[];n.attributes.ssrcs.forEach(d=>{ve(t).call(t,d.attributes.label||"")?c.push(d):i.push(d)}),n.attributes.ssrcGroups.forEach(d=>{var h;ve(h=c.map(m=>m.ssrcId)).call(h,d.ssrcIds[0])||a.push(d)}),n.attributes.ssrcs=i,n.attributes.ssrcGroups=a})}mute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(t,n,i){t.forEach((a,c)=>{const d=a._mediaStreamTrack,h=this.sessionDesc.mediaDescriptions.findIndex(g=>g.attributes.mid===d.kind),m=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[h],a);this.sessionDesc.mediaDescriptions[h]=m})}stopReceiving(t){}updateCandidates(t){const n=this._originCandidates.filter(a=>a.transport==="udp"),i=[];if(n.forEach(a=>{i.push(eG(eG({},a),{},{foundation:"tcpcandidate",priority:Number(a.priority)-1+"",transport:"tcp",port:Number(a.port)+90+""}))}),n.length!==0){switch(t){case Ir.TCP_RELAY:this.candidates=i;break;case Ir.UDP_TCP_RELAY:case Ir.RELAY:this.candidates=[...n,...i];break;default:this.candidates=n}for(const a of this.sessionDesc.mediaDescriptions)a.attributes.candidates=this.candidates}}restartICE(t){t=mn(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let i=0;i<t;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}mungRecvMediaDsec(t,n){const i=mn(t);return Ju(i,n),LA(i,n),i}updateRecvMedia(t,n){const i=this.sessionDesc.mediaDescriptions.findIndex(a=>a.attributes.mid===t);if(i!==-1){const a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=a}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,i){const a=this.sessionDesc.mediaDescriptions.find(d=>t===De.VIDEO?d.attributes.mid==="video":d.attributes.mid==="audio");if(a){const d=a.attributes.ssrcs.find(h=>h.attributes.label===n);var c;d&&(d.attributes.label=i,(c=d.attributes.msid)===null||c===void 0||c.replace(n,i))}}mungMediaDesc(t){const n=mn(t);return kA(n),function(i){const a=i.attributes.extmaps.find(c=>JS(c.extensionName));a&&i.attributes.extmaps.splice(i.attributes.extmaps.indexOf(a),1),i.attributes.payloads.forEach(c=>{const d=c.rtcpFeedbacks.findIndex(h=>h.type==="transport-cc");d!==-1&&c.rtcpFeedbacks.splice(d,1)})}(n),n}getSSRC(t){for(const n of this.sessionDesc.mediaDescriptions)for(const i of n.attributes.ssrcs)if(i.attributes.label===t)return[i]}}var ln;function tG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function kT(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?tG(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tG(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let zle=(ln=class z_ extends HS{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return ve(n=Object.keys(Vu)).call(n,t)}))]}constructor(t,n){super(t,n),x(this,"store",void 0),x(this,"peerConnection",void 0),x(this,"remoteSDP",void 0),x(this,"initialOffer",void 0),x(this,"statsFilter",void 0),x(this,"useRTX",!1),x(this,"localCapabilities",void 0),x(this,"localCandidateCount",0),x(this,"allCandidatesReceived",!1),x(this,"establishPromise",void 0),x(this,"mutex",void 0),this.store=n,this.mutex=new Cr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(z_.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=vS(this.peerConnection,D("STATS_UPDATE_INTERVAL"),void 0,pn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=cc(t.sdp),i=Yg(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:D("FILTER_VIDEO_FEC"),filterAudioFec:D("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=t,kT(kT({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:t.sdp})}catch(t){throw new de(L.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Wle(kT(kT({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new de(L.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(t,n){throw new de(L.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,n){var i=this;return Li(function*(){const a=yield ht(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=t.map(y=>i.peerConnection.addTrack(y._mediaStreamTrack)),d=yield ht(i.peerConnection.createOffer()),h=Ci(d.sdp),m=t.map(y=>{const b=y._mediaStreamTrack,O=h.mediaDescriptions.find(I=>I.attributes.mid===b.kind);if(!O)throw new Error("Cannot extract ssrc from mediaDescription.");return function(I,N,k){const j=I.attributes.ssrcs.filter(K=>K.attributes.label===N),G=I.attributes.ssrcGroups;if(j.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(G&&j.length>1){const K=G.find(X=>X.ssrcIds.indexOf(j[0].ssrcId)!==-1);return K?[{ssrcId:K.ssrcIds[0],rtx:k?K.ssrcIds[1]:void 0}]:[{ssrcId:j[0].ssrcId}]}return[{ssrcId:j[0].ssrcId}]}(O,b.id,i.useRTX)});let g;try{g=yield m}catch(y){throw c.forEach(b=>{wr()&&b.replaceTrack(null),i.peerConnection.removeTrack(b)}),y}const _=i.mungSendOfferSDP(d.sdp,t);i.remoteSDP.receive(t,n,g);const v=i.remoteSDP.toString();return yield ht(i.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield ht(i.applySendEncodings(c,t)),yield ht(i.peerConnection.setRemoteDescription({type:"answer",sdp:v})),t.map((y,b)=>{const O=y._mediaStreamTrack.id;return{localSSRC:m[b],id:O}})}catch(c){throw new de(L.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{a()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(c=>{var d;return t.indexOf(((d=c.track)===null||d===void 0?void 0:d.id)||"")!==-1});if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(c=>{wr()&&c.replaceTrack(null),this.peerConnection.removeTrack(c)});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(t);const a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new de(L.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,i,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:c,mslabel:d}=this.remoteSDP.send(t,n,a),h=new we((_,v)=>{const y=setTimeout(()=>{v(new Error("Cannot receive track, id: ".concat(c)))},1e4),b=O=>{const I=Pt();if((I.name==="Safari"&&Number(I.version)===11||ni())&&O.track.id!==c&&O.streams[0].id===d){var N;const k=O.streams[0].getTracks()[0];return(N=this.remoteSDP)===null||N===void 0||N.updateTrackLabel(t,c,O.track.id),this.peerConnection.removeEventListener("track",b),clearTimeout(y),void _(k)}if(O.track.id===c)return this.peerConnection.removeEventListener("track",b),clearTimeout(y),void _(O.track)};this.peerConnection.addEventListener("track",b)}),m=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:m});const g=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(g),{track:await h,id:c}}catch(c){throw new de(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(n){throw new de(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(i=>{var a;return t.indexOf(((a=i.track)===null||a===void 0?void 0:a.id)||"")!==-1});if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map(i=>{if(wr()&&i.track)i.track.enabled=!1;else{const a=i.getParameters();a.encodings.forEach(c=>c.active=!1),i.setParameters(a)}})}catch(n){throw new de(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(c=>{var d;return t.indexOf(((d=c.track)===null||d===void 0?void 0:d.id)||"")!==-1});if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async c=>{if(wr()&&c.track)c.track.enabled=!0;else{const d=c.getParameters();d.encodings.forEach(h=>h.active=!0),await c.setParameters(d)}});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);const a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new de(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return Li(function*(){const i=yield ht(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const a=vt().supportPCSetConfiguration;if(t===Ir.RELAY&&!a)return;if(a){const g=n.peerConnection.getConfiguration(),_=t===Ir.RELAY?"relay":"all";g.iceTransportPolicy!==_&&(R.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(g.iceTransportPolicy,"] to [").concat(_,"]")),g.iceTransportPolicy=_,n.peerConnection.setConfiguration(g))}t!==Ir.RELAY&&n.remoteSDP.updateCandidates(t);const c=yield ht(n.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=cc(c.sdp),{remoteIceParameters:h}=yield d.iceParameters;n.remoteSDP.restartICE(h);const m=n.remoteSDP.toString();yield ht(n.peerConnection.setLocalDescription(c)),yield ht(n.peerConnection.setRemoteDescription({type:"answer",sdp:m}))}catch(a){R.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),a)}finally{i()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),a=this.mungSendOfferSDP(i.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const c=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new de(L.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getSenders().filter(a=>{var c;return((c=a.track)===null||c===void 0?void 0:c.id)===t});i.length===1&&await this.applySendEncodings(i,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getSenders().find(a=>{var c;return((c=a.track)===null||c===void 0?void 0:c.id)===n});i&&await i.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,n){throw new de(L.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new de(L.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},D("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Pu(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...z_.turnServerConfigToIceServers(t.turnServer.servers)),D("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...z_.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(t,n){var i;if(n||(n=this.peerConnection.getSenders().find(g=>{var _;return((_=g.track)===null||_===void 0?void 0:_.id)===t._mediaStreamTrack.id})),!n)return R.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!vt().supportSetRtpSenderParameters)return R.warn("Browser not support set rtp-sender parameters");const a={},c={};if(t instanceof sn)switch(t._optimizationMode){case"motion":a.degradationPreference="maintain-framerate";break;case"detail":a.degradationPreference="maintain-resolution";break;default:a.degradationPreference="balanced"}if(D("DSCP_TYPE")&&nc()){var d;const g=D("DSCP_TYPE");ve(d=["very-low","low","medium","high"]).call(d,g)&&(c.networkPriority=g)}const h=n.getParameters(),m=(i=h.encodings)===null||i===void 0?void 0:i[0];m&&Object.assign(m,c),Object.assign(h,a),R.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),await n.setParameters(h)}async applySendEncodings(t,n){try{if(!vt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const a=t[i],c=n[i];a&&c&&await this.updateRtpSenderEncodings(c,a)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n){const i=Ci(t);return n.forEach((a,c)=>{const d=a._mediaStreamTrack,h=i.mediaDescriptions.find(m=>m.attributes.mid===d.kind);h&&Ju(h,a)}),Kc(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var a;(a=this.onFirstVideoDecoded)===null||a===void 0||a.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(t).map((c,d)=>{let{id:h,mslabel:m}=c;const{kind:g}=t[d];return new we((_,v)=>{const y=setTimeout(()=>{v(new Error("Cannot receive track, id: ".concat(h)))},1e4),b=O=>{const I=Pt();if(I.name==="Safari"&&Number(I.version)===11&&O.track.id!==h&&O.streams[0].id===m){var N;const k=O.streams[0].getTracks()[0];return(N=this.remoteSDP)===null||N===void 0||N.updateTrackLabel(g,h,O.track.id),this.peerConnection.removeEventListener("track",b),clearTimeout(y),void _({track:k,id:h})}if(O.track.id===h)return this.peerConnection.removeEventListener("track",b),clearTimeout(y),void _({track:O.track,id:h})};this.peerConnection.addEventListener("track",b)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const a=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(a),await we.all(n)}catch(n){throw new de(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(vt().supportPCSetConfiguration){const n=z_.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},Ie(ln.prototype,"connect",[ho],Object.getOwnPropertyDescriptor(ln.prototype,"connect"),ln.prototype),Ie(ln.prototype,"stopSending",[ho],Object.getOwnPropertyDescriptor(ln.prototype,"stopSending"),ln.prototype),Ie(ln.prototype,"receive",[ho],Object.getOwnPropertyDescriptor(ln.prototype,"receive"),ln.prototype),Ie(ln.prototype,"stopReceiving",[ho],Object.getOwnPropertyDescriptor(ln.prototype,"stopReceiving"),ln.prototype),Ie(ln.prototype,"muteRemote",[ho],Object.getOwnPropertyDescriptor(ln.prototype,"muteRemote"),ln.prototype),Ie(ln.prototype,"unmuteRemote",[ho],Object.getOwnPropertyDescriptor(ln.prototype,"unmuteRemote"),ln.prototype),Ie(ln.prototype,"muteLocal",[ho],Object.getOwnPropertyDescriptor(ln.prototype,"muteLocal"),ln.prototype),Ie(ln.prototype,"unmuteLocal",[ho],Object.getOwnPropertyDescriptor(ln.prototype,"unmuteLocal"),ln.prototype),Ie(ln.prototype,"close",[ho],Object.getOwnPropertyDescriptor(ln.prototype,"close"),ln.prototype),Ie(ln.prototype,"updateEncoderConfig",[ho],Object.getOwnPropertyDescriptor(ln.prototype,"updateEncoderConfig"),ln.prototype),Ie(ln.prototype,"updateSendParameters",[ho],Object.getOwnPropertyDescriptor(ln.prototype,"updateSendParameters"),ln.prototype),Ie(ln.prototype,"replaceTrack",[ho],Object.getOwnPropertyDescriptor(ln.prototype,"replaceTrack"),ln.prototype),Ie(ln.prototype,"getRemoteSSRC",[ho],Object.getOwnPropertyDescriptor(ln.prototype,"getRemoteSSRC"),ln.prototype),ln);function ho(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const a=this.mutex,c=await a.lock("Locking from P2PConnection.".concat(t));try{for(var d=arguments.length,h=new Array(d),m=0;m<d;m++)h[m]=arguments[m];return await i.apply(this,h)}finally{c()}},n}const Hle={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new zle(n,t)}},Kle={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!vt().supportWebRTCEncodedTransform)return void R.warning("browser not support audio encoded transform");if(PS.has(e)||!e.track)return;const n={track:e.track};if(zc()){if(!e.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let a=null;try{a=e.createEncodedStreams()}catch(d){return void R.error("create audio-encoded-streams error",d&&d.message)}const c=new TransformStream({transform(d,h){n.controller||(n.controller=h),e.track&&e.track.id!==n.track.id&&(R.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const m=t.metadata&&t.metadata();m?function(g,_){const{chunk:v,controller:y}=_,b=td.METADATA;v.data=function(O,I,N){const k=N.byteLength,j=k+hA+Y4,G=dA+uA+j,K=new ArrayBuffer(O.byteLength+G),X=new DataView(K);X.setUint8(0,q4),X.setUint16(1,j),X.setUint8(3,I),X.setUint16(4,k);for(let ne=0;ne<k;ne++)X.setUint8(6+ne,N[ne]);const z=new Uint8Array(X.buffer);return z.set(new Uint8Array(O),G),z.buffer}(v.data,b,g),y.enqueue(v)}(m,{chunk:d,controller:h}):h.enqueue(d)}});a.readable.pipeThrough(c).pipeTo(a.writable)}else if(wr()){if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const a=OS(),c=new MessageChannel;await new we(h=>a.onmessage=m=>{m.data==="registered"&&h(void 0)});const d=new RTCRtpScriptTransform(a,{name:"audio-metadata-tx",port:c.port2},[c.port2]);e.transform=d,await new we(h=>a.onmessage=m=>{m.data==="started"&&h(void 0)}),c.port1.onmessage=h=>{var m;if(h.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==n.track.id)R.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i);else if(h.data.getMetadata){const g=t.metadata&&t.metadata();g&&c.port1.postMessage({metadata:g})}},n.worker=a}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}const a=PS.get(e);if(a){PS.delete(e);try{var c,d;(c=a.controller)===null||c===void 0||c.terminate(),(d=a.worker)===null||d===void 0||d.terminate()}catch(h){R.warning(h&&h.message)}}}PS.set(e,n),e.track.addEventListener("ended",i)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!vt().supportWebRTCEncodedTransform)return void R.warning("browser not support audio encoded transform");if(jS.has(e))return;const n={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(zc()&&!ni()){if(!e.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");SI(Mt.CHROME,87,116)||(t.enableTopn=!1);let a=null;try{a=e.createEncodedStreams()}catch(d){return void R.error("create audio-encoded-streams error",d&&d.message)}const c=new TransformStream({transform(d,h){n.controller||(n.controller=h),e.track&&e.track.id!==n.track.id&&(R.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i)),t.enableTopn?function(m,g,_){var v;const y=pA(new DataView(g.data));if(!y)return _.enqueue(g);const b=m.track.id;boe.set(b,m.track);const O=(v=y.tlv.find(K=>K.tag===td.AUDIO_LEVEL))===null||v===void 0?void 0:v.value;let I=0;typeof O=="number"&&(I=127-O);const N=Math.round(Math.pow(10,I/60)-1),{selected:k,speaker:j}=function(K,X){let z=em.get(K);if(z||(z=function(ne){const me=new J4;return em.set(ne,me),ma||(ma=new Soe(D("TOPN_SILENCE_THRESHOLD")||500),ma.on("ActiveSpeakerChanged",Ee=>{Ee!=null&&(LS=Ee)})),ma.addSpeakers([me]),me}(K)),em.size<=Q4)return{selected:!0,speaker:z};if(!ma)throw new Error("no active speaker detector");return ma.levelChanged(z.id,X),Hu=ma.loudest.map(ne=>ne.id),LS&&!ve(Hu).call(Hu,LS)&&Hu.length>=Q4&&Hu.pop(),{selected:ve(Hu).call(Hu,z.id)||z.id===LS,speaker:z}}(m,N),G=function(K,X,z){const ne=fa.get(K)||new Toe(K,X);return ne.score=z,fa.set(K,ne),function(me){if(MS.set(me,!0),!US)return void(US=Date.now());const Ee=Date.now();Ee-US>1e3&&(MS.get(me)?MS.set(me,!1):($4(me),MS.delete(me)),US=Ee)}(K),ne}(b,m.track,j.energyScore);G.addSample(k),G.active&&(g.data=y.frame.buffer,_.enqueue(g))}(e,d,h):t.enableMetadata||t.enablePts?function(m,g,_,v){const y=new DataView(m.data),b=y.getUint8(0);let O;if(128&b&&b!==71){const k=function(j){if(j.byteLength<=0)return[];const G=[];let K=0;for(;K<j.byteLength;){const z=(128&j.getUint8(K))>>7,ne=127&j.getUint8(K);if(!(z&&K+4<=j.byteLength)){K++;break}{const me=j.getUint32(K,!1),Ee=(16776192&me)>>10,Oe=1023&me;G.push({pt:ne,ts_offset:Ee,length:Oe,data:new Uint8Array}),K+=4}}let X=j.byteLength-K;for(const z of G){if(z.length>X)return console.warn("Broken red payload"),[];z.length>0&&(z.data=new Uint8Array(j.buffer,j.byteOffset+K,z.length),K+=z.length,X-=z.length)}if(X>0){const z={pt:G.length>0?G[G.length-1].pt:0,ts_offset:0,length:X,data:new Uint8Array(j.buffer,j.byteOffset+K,X)};G.push(z)}return G}(y);if(k.length>0){const j=function(G){let K=0;for(let ne=0;ne<G.length;ne++)K+=ne<G.length-1?4:1,K+=G[ne].length;const X=new Uint8Array(K);let z=0;for(let ne=0;ne<G.length;ne++)if(ne<G.length-1){const me=(2147483648|(127&G[ne].pt)<<24|(262143&G[ne].ts_offset)<<10|1023&G[ne].length)>>>0;X[z++]=me>>24&255,X[z++]=me>>16&255,X[z++]=me>>8&255,X[z++]=255&me}else X[z++]=127&G[ne].pt;for(const ne of G)X.set(ne.data,z),z+=ne.length;return X}(k.map(G=>{const K=new Uint8Array(G.length);K.set(G.data);const X=pA(new DataView(K.buffer));return X!=null&&X.frame&&(G.data=X==null?void 0:X.frame),O=X,G}));m.data=j.buffer}}else O=pA(y),O&&(m.data=O.frame.buffer);if(g.enqueue(m),!O)return;const I=O.tlv.find(k=>k.tag===td.METADATA);I&&_&&I.value instanceof Uint8Array&&_(I.value);const N=O.tlv.find(k=>k.tag===td.AUDIO_64_BIT_PTS);N&&v&&N.value instanceof Uint8Array&&N.value.length==8&&v(new DataView(N.value.buffer).getBigUint64(0,!0))}(d,h,t.onMetadata,t.onPts):h.enqueue(d)}});a.readable.pipeThrough(c).pipeTo(a.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const a=OS(),c=new MessageChannel;await new we(h=>a.onmessage=m=>{m.data==="registered"&&h(void 0)});const d=new RTCRtpScriptTransform(a,{name:"audio-metadata-rx",port:c.port2},[c.port2]);e.transform=d,await new we(h=>a.onmessage=m=>{m.data==="started"&&h(void 0)}),c.port1.onmessage=h=>{var m;h.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==n.track.id?(R.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i)):h.data.metadata&&n.onMetadata?n.onMetadata(h.data.metadata):h.data.pts&&n.onPts&&n.onPts(h.data.pts)},n.worker=a}function i(){e.track.removeEventListener("ended",i),function(a){const c=jS.get(a);if(c){(function(m){const g=em.get(m);g&&(em.delete(m),ma&&(ma.removeSpeakers([g]),em.size===0&&(ma.destroy(),ma=null)))})(a),$4(a.track.id),jS.delete(a);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){R.warning(m&&m.message)}}}(e)}jS.set(e,n),e.track.addEventListener("ended",i)},interceptLocalVideoFrame:async function(e,t){if(!vt().supportWebRTCEncodedTransform)return void R.warning("browser not support video encoded transform");if(VS.has(e)||!e.track)return;const n={track:e.track};if(zc()){if(!e.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let a=null;try{a=e.createEncodedStreams()}catch(h){return void R.error("create video-encoded-streams error",h&&h.message)}const c=[];t.on("sei-to-send",h=>{c.push(h)});const d=new TransformStream({transform(h,m){n.controller||(n.controller=m),e.track&&e.track.id!==n.track.id&&(R.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const g=t3(new Uint8Array(h.data)),_=c.shift();if(_){const v=function(y,b,O){switch(O){case _A:return function(I,N){const k=e3(N),j=k.length,G=Math.floor(j/255),K=j%255,X=new Uint8Array(6+G+1+j+I.byteLength);X[0]=0,X[1]=0,X[2]=0,X[3]=1,X[4]=6,X[5]=101;let z=0;for(;z<G;)X[6+z]=255,z++;return X[6+z]=K,z++,X.set(k,6+z),X.set(new Uint8Array(I),6+z+j),X.buffer}(y,b);case EA:return function(I,N){const k=e3(N),j=k.length,G=Math.floor(j/255),K=j%255,X=new Uint8Array(7+G+1+j+1+I.byteLength);X[0]=0,X[1]=0,X[2]=0,X[3]=1,X[4]=78,X[5]=1,X[6]=101;let z=0;for(;z<G;)X[7+z]=255,z++;return X[7+z]=K,z++,X.set(k,7+z),z+=j,X[7+z]=128,z++,X.set(new Uint8Array(I),7+z),X.buffer}(y,b);default:return null}}(h.data,_,g);v&&(h.data=v)}m.enqueue(h)}});a.readable.pipeThrough(d).pipeTo(a.writable)}else{if(!wr())return;{if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const a=OS(),c=new MessageChannel;await new we(h=>a.onmessage=m=>{m.data==="registered"&&h(void 0)});const d=new RTCRtpScriptTransform(a,{name:"sei-tx",port:c.port2},[c.port2]);e.transform=d,await new we(h=>a.onmessage=m=>{m.data==="started"&&h(void 0)}),t.on("sei-to-send",h=>{c.port1.postMessage({sei:h})}),c.port1.onmessage=h=>{var m;h.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==n.track.id&&(R.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i))},n.worker=a}}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}const a=VS.get(e);if(a){VS.delete(e);try{var c,d;(c=a.controller)===null||c===void 0||c.terminate(),(d=a.worker)===null||d===void 0||d.terminate()}catch(h){R.warning(h&&h.message)}}}VS.set(e,n),e.track.addEventListener("ended",i)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!vt().supportWebRTCEncodedTransform)return void R.warning("browser not support video encoded transform");if(!e.track)return;if(zg.has(e)){const a=zg.get(e);return void(a&&(a.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(zc()){if(!e.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let a=null;try{a=e.createEncodedStreams()}catch(d){return void R.error("create video-encoded-streams error",d&&d.message)}const c=new TransformStream({transform(d,h){if(n.controller||(n.controller=h),!n.firstFrameInfo){var m;const _=d.getMetadata()||{};n.firstFrameInfo=hn({type:d.type,rtpTimestamp:d.timestamp,payloadType:_.payloadType||0,ssrc:_.synchronizationSource||0,length:d.data.byteLength},"mimeType"in _?{mimeType:_.mimeType}:{}),(m=t.onFirstFrame)===null||m===void 0||m.call(t,n.firstFrameInfo)}e.track&&e.track.id!==n.track.id&&(R.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const g=function(_,v){switch(v){case _A:return function(y){const b=new DataView(y.data);let O=0;for(;O+4<y.data.byteLength;){if(b.getUint8(O+0)===0&&b.getUint8(O+1)===0&&b.getUint8(O+2)===0&&b.getUint8(O+3)===1&&b.getUint8(O+4)===6){let I=O+6,N=0,k=0;for(;(k=b.getUint8(I++))===255;)N+=255;N+=k;const j=Z4(y.data,I,N);return new Uint8Array(j)}O++}return null}(_);case EA:return function(y){const b=new DataView(y.data);let O=0;for(;O+5<y.data.byteLength;){if(b.getUint8(O+0)===0&&b.getUint8(O+1)===0&&b.getUint8(O+2)===0&&b.getUint8(O+3)===1&&b.getUint8(O+4)===78&&b.getUint8(O+5)===1&&b.getUint8(O+6)===101){let I=O+7,N=0,k=0;for(;(k=b.getUint8(I++))===255;)N+=255;N+=k;const j=Z4(y.data,I,N);return new Uint8Array(j)}O++}return null}(_);default:return null}}(d,t3(new Uint8Array(d.data)));g&&n.onSei&&n.onSei(g),h.enqueue(d)}});a.readable.pipeThrough(c).pipeTo(a.writable)}else if(wr()){if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const a=OS(),c=new MessageChannel;await new we(h=>a.onmessage=m=>{m.data==="registered"&&h(void 0)});const d=new RTCRtpScriptTransform(a,{name:"sei-rx",port:c.port2},[c.port2]);e.transform=d,await new we(h=>a.onmessage=m=>{m.data==="started"&&h(void 0)}),c.port1.onmessage=h=>{var m;if(h.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==n.track.id)R.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i);else if(h.data.sei&&n.onSei)n.onSei(h.data.sei);else if(h.data.firstFrameInfo&&t.onFirstFrame){var g;(g=t.onFirstFrame)===null||g===void 0||g.call(t,h.data.firstFrameInfo)}},n.worker=a}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}(function(a){const c=zg.get(a);if(c){zg.delete(a);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){R.warning(m&&m.message)}}})(e)}zg.set(e,n),e.track.addEventListener("ended",i)}},qle={name:"InterceptFrame",create:()=>Kle};var Nt;function nG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function Ra(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?nG(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nG(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let Yle=(Nt=class Om extends HS{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return ve(n=Object.keys(Vu)).call(n,t)}))]}constructor(t,n,i){super(t,n),x(this,"id",Wt(5,"connection-")),x(this,"store",void 0),x(this,"peerConnection",void 0),x(this,"forceTurn",!1),x(this,"remoteSDP",void 0),x(this,"initialOffer",void 0),x(this,"transportEventReceiver",void 0),x(this,"statsFilter",void 0),x(this,"extension",{useXR:D("USE_XR")}),x(this,"localCapabilities",void 0),x(this,"remoteCodecs",void 0),x(this,"localCandidateCount",0),x(this,"allCandidatesReceived",!1),x(this,"isPreallocation",!1),x(this,"preMediaMap",new Map),x(this,"dataStreamChannelMap",new Map),x(this,"establishPromise",void 0),x(this,"recoveredDataChannelIds",[]),x(this,"currentDataChannelId",1),x(this,"supportAV1RtpSpec",!1),x(this,"mutex",void 0),x(this,"qualityLimitationReason",Gp.NONE),x(this,"isFirstConnected",!1),this.store=n,this.forceTurn=tN(t),this.mutex=new Cr("NVConnectionExtension-mutex",n.clientId),this.peerConnection=i,this.isFirstConnected=!1,this.statsFilter=vS(this.peerConnection,D("STATS_UPDATE_INTERVAL"),void 0,pn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void R.debug("[NVConnectionExtension] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const i=await this.peerConnection.createOffer(),a=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);const c=this.remoteSDP.toString();a==null||a(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}else R.debug("[NVConnectionExtension] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=cc(n.sdp),a=await UA({filterRTX:!D("USE_PUB_RTX")&&!D("USE_SUB_RTX"),filterVideoFec:D("FILTER_VIDEO_FEC"),filterAudioFec:D("FILTER_AUDIO_FEC"),filterVideoCodec:D("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:D("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:D("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=Jg(a),this.initialOffer=n,D("ENABLE_SVC")&&this.store.codec=="av1"){const d=await N3();var t;d&&(this.supportAV1RtpSpec=!0,(t=a.send)===null||t===void 0||t.videoExtensions.push(d))}let c;return n.sdp&&$S(n.sdp)&&(c=mn(a),S3(c)),Ra(Ra({},i),{},{rtpCapabilities:c||a,offerSDP:n.sdp})}catch(n){throw new de(L.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnectionExtension without initial offer.");this.initialOffer.sdp&&$S(this.initialOffer.sdp)&&T3(t.rtpCapabilities,this.localCapabilities),this.remoteSDP=new eB(Ra(Ra({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!D("ENABLE_PRE_SUB_WITH_PRE_PC")||!D("PRE_USE_LOCAL_CODECS"))&&Bg(this.store),!0),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const n=this.remoteSDP.toString(),i=jA(this.initialOffer.sdp,this.extension),a=this.logSDPExchange(i||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),a==null||a(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n});const c=this.peerConnection.getTransceivers()[0];if(c!=null&&c.receiver&&this.tryBindTransportEvents(c.receiver),Bg(this.store))if(t.preallocation&&D("ENABLE_PRE_SUB_WITH_PRE_PC")){const d=D("PRE_SUB_NUM"),{mids:h,preSSRCs:m}=this.remoteSDP.preloadRemoteMedia(d);await es(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] preload media, in pre pc,add preload ssrcs ").concat(m)),this.presetMedia(h,m)}else{const{preSSRCs:d=[]}=t,h=d.map(g=>g.ssrcMsg[0].ssrcId);if(d.length===0)return;const{mids:m}=this.remoteSDP.batchSend(d.map(g=>Object.assign({},g)));await es(this.peerConnection,this.remoteSDP,this.extension),R.debug("[NVConnectionExtension.connect] preload media, after join, add preload ssrcs ".concat(h)),this.presetMedia(m,h)}}catch(n){throw new de(L.EXCHANGE_SDP_FAILED,"NVConnectionExtension.connect failed; ".concat(n.toString()))}}presetMedia(t,n){t.forEach((i,a)=>{this.peerConnection.getTransceivers().forEach(c=>{if(c.mid!=null&&i===c.mid&&c.receiver.track){const d=c.receiver.track;let h;d.kind==="video"&&D("ENABLE_PRE_RENDER")&&(h=new NS({trackId:"track-".concat(d.kind,"-unknown-").concat(this.store.clientId,"_").concat(Wt(5,""))},!0),h.updateVideoTrack(d),h.onFirstVideoFrameRender=()=>{var m;const g=this.preMediaMap.get(n[a]);g&&(g.firstVideoRender=Date.now()),(m=this.onFirstVideoRender)===null||m===void 0||m.call(this,n[a])},h.onVideoBufferReady=()=>{var m;(m=this.onFirstVideoBufferReady)===null||m===void 0||m.call(this,n[a])},h.play(this.store.sessionId||void 0)),this.preMediaMap.set(n[a],{mid:i,track:d,player:h,transceiver:c})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateRemoteConnect before remote SDP created");let n=!1;const{rtpCapabilities:i}=t;if([,n]=this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const d=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);n=n||d}const{preSSRCs:a=[]}=t,c=a.map(d=>d.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(c)){const d=[],h=[];if(Array.from(this.preMediaMap.entries()).every(m=>{let[g,{mid:_,player:v,track:y}]=m;return d.push(_),h.push(g),this.preMediaMap.delete(g),v&&v.destroy(),!0}),d.length>0&&(this.remoteSDP.stopSending(d),await es(this.peerConnection,this.remoteSDP,this.extension),R.warn("[NVConnectionExtension.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(h)),Le.reportApiInvoke(this.store.sessionId,{name:_n.PRELOAD_MEDIA_FAILED,options:[a,h],tag:rn.TRACER}).onSuccess()),a.length>0){const{mids:m}=this.remoteSDP.batchSend(a.map(g=>Object.assign({},g)));await es(this.peerConnection,this.remoteSDP,this.extension),R.debug("[NVConnectionExtension.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(c)),this.presetMedia(m,c)}}n?(await es(this.peerConnection,this.remoteSDP,this.extension),R.debug("[NVConnectionExtension] updateRemoteConnect by exchanging SDP.")):R.debug("[NVConnectionExtension] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(n){throw new de(L.EXCHANGE_SDP_FAILED,"NVConnectionExtension.updateRemoteConnect failed; ".concat(n.toString()))}}send(t,n,i){var a=this;return Li(function*(){const c=yield ht(a.mutex.lock("From NVConnectionExtension.send"));try{if(!a.remoteSDP)throw new Error("Cannot call NVConnectionExtension.send before remote SDP created");const d=[],h=qg();t.forEach(N=>{const k=a.peerConnection.addTransceiver(N._mediaStreamTrack,Ra({direction:"sendonly"},N.trackMediaType==="video"&&a.supportAV1RtpSpec&&h?{sendEncodings:[{scalabilityMode:h}]}:{}));d.push(k),N._updateRtpTransceiver(k)}),pn()&&D("SIMULCAST")===!0&&(yield ht(a.applySimulcastForFirefox(d,t)));const m=yield ht(a.peerConnection.createOffer()),g=a.remoteSDP.predictReceivingMids(t.length),_=a.mungSendOfferSDP(m.sdp,t,g),v=Ci(_),y=g.map(N=>{const k=v.mediaDescriptions.find(j=>j.attributes.mid===N);if(!k)throw new Error("Cannot extract ssrc from mediaDescription.");return DA(k,D("USE_PUB_RTX"))});let b;try{b=yield y}catch(N){b=[],a.remoteSDP.receive(t,n,i,b);const k=a.remoteSDP.toString();throw yield ht(a.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield ht(a.peerConnection.setRemoteDescription({type:"answer",sdp:k})),yield ht(a.stopSending(g,!0)),N}a.remoteSDP.receive(t,n,i,b);const O=a.remoteSDP.toString(),I=a.logSDPExchange(_,"offer","local","send");return yield ht(a.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield ht(a.applySimulcastEncodings(d,t)),yield ht(a.applySendEncodings(d,t)),I==null||I(O),yield ht(a.peerConnection.setRemoteDescription({type:"answer",sdp:O})),d.map((N,k)=>{const j=g[k];return{localSSRC:y[k],id:j,transceiver:N}})}catch(d){throw d instanceof de?d:new de(L.EXCHANGE_SDP_FAILED,"NVConnectionExtension.send failed; ".concat(d.toString()))}finally{c()}})()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(t);if(i&&i.readyState==="open")R.debug("[NVConnectionExtension] Channels are already available and can be reused directly.");else{const c=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof c!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:c,negotiated:!0,ordered:!1,maxRetransmits:D("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,i)}n.forEach(c=>{c._updateOriginDataChannel(i)});const{needExchangeSDP:a}=this.remoteSDP.sendDataChannel();if(a){const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:c});const d=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(d),R.debug("[NVConnectionExtension] createDataChannels by exchanging SDP.")}else R.debug("[NVConnectionExtension] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof de?i:new de(L.EXCHANGE_SDP_FAILED,"NVConnectionExtension.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof de?n:new de(L.DATACHANNEL_FAILED,"NVConnectionExtension.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From NVConnectionExtension.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopSending before remote SDP created");const a=this.peerConnection.getTransceivers().filter(m=>t.indexOf(m.mid)!==-1);if(a.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVConnectionExtension.stopSending.");a.map(m=>{var g;um(this.id+m.mid,this),m.direction="inactive",(g=m.stop)===null||g===void 0||g.call(m)});const c=await this.peerConnection.createOffer(),d=this.logSDPExchange(c.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(c),this.remoteSDP.stopReceiving(t);const h=this.remoteSDP.toString();d==null||d(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new de(L.EXCHANGE_SDP_FAILED,"NVConnectionExtension.stopSending failed; ".concat(a.toString()))}finally{i&&i()}}async receive(t,n,i,a){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.receive ".concat(t," before remoteSDP created."));const{mid:c,needExchangeSDP:d}=this.remoteSDP.send(t,n,i,a);d&&(await es(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] receive ").concat(t," by exchanging SDP.")));const h=this.peerConnection.getTransceivers().find(m=>m.mid===c);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:c,transceiver:h}}catch(c){throw new de(L.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(c.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(t);return i&&(await es(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] batchReceive by exchanging SDP."))),n.map(a=>{const c=this.peerConnection.getTransceivers().find(d=>d.mid===a);if(!c)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,id:a,transceiver:c}})}catch(n){throw new de(L.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopReceiving before remote SDP created.");t.forEach(c=>{Array.from(this.preMediaMap.entries()).some(d=>{let[h,{mid:m,player:g}]=d;if(m===c)return this.preMediaMap.delete(h),g&&g.destroy(),!0})}),this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const a=await this.peerConnection.createAnswer();i==null||i(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(n){throw new de(L.EXCHANGE_SDP_FAILED,"NVConnectionExtension stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const a=await this.peerConnection.createAnswer();i==null||i(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(n){throw new de(L.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const a=await this.peerConnection.createAnswer();i==null||i(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(n){throw new de(L.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(d=>{d.direction="inactive"});const i=await this.peerConnection.createOffer(),a=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const c=this.remoteSDP.toString();a==null||a(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new de(L.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(d,h)=>{d.direction="sendonly"});const i=await this.peerConnection.createOffer(),a=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString();a==null||a(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new de(L.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return Li(function*(){const i=yield ht(n.mutex.lock("From NVConnectionExtension.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const a=vt().supportPCSetConfiguration,c=D("FORCE_TURN_TCP")||n.forceTurn;if(t===Ir.RELAY&&!a)return;if(a&&!c){const v=t===Ir.RELAY?"relay":"all",y=n.peerConnection.getConfiguration();y.iceTransportPolicy!==v&&(R.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(y.iceTransportPolicy,"] to [").concat(v,"]")),y.iceTransportPolicy=v,n.peerConnection.setConfiguration(y))}n.remoteSDP.updateCandidates(t);const d=yield ht(n.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=cc(d.sdp),{remoteIceParameters:m}=yield h.iceParameters;n.remoteSDP.restartICE(m);const g=n.remoteSDP.toString(),_=n.logSDPExchange(d.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield ht(n.peerConnection.setLocalDescription(d)),_==null||_(g),yield ht(n.peerConnection.setRemoteDescription({type:"answer",sdp:g}))}catch(a){R.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),a)}finally{i()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From NVConnectionExtension.extendCandidate");try{this.remoteSDP.updateCandidates(Ir.TCP_RELAY),await es(this.peerConnection,this.remoteSDP,this.extension)}catch(n){R.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{um(this.id+n.mid,this)}),this.preMediaMap.forEach(n=>{let{player:i}=n;i&&i.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Ra(Ra({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),a=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const c=this.remoteSDP.toString(),d=this.logSDPExchange(a,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),d==null||d(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new de(L.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter(a=>a.mid===t);i.length===1&&(this.isVP8Simulcast(n)?pn()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find(a=>a.mid===n);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:i,remote:a}=n.getSelectedCandidatePair();return{local:Ra(Ra({},Do),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:Ra(Ra({},Do),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;const i="code: ".concat(t.errorCode,", message: ").concat(t.errorText),a=t.port?"local: ".concat(t.port):"",c=ac(t.url||"");R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: NVConnectionExtension.onICECandidateError(").concat(i,"), url: ").concat(c||"",", host_candidate:").concat(a)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,i)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},D("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]},i=t.cloudProxyServer||"disabled";return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(Pu(t.turnServer.servers)?n.iceServers=t.turnServer.servers:D("NEW_TURN_MODE")&&n.iceServers&&i==="disabled"?(D("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...Om.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...Om.newTurnServerConfigToIceServers(t.turnServer.servers)),D("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...Om.turnServerConfigToIceServers(t.turnServer.servers)),D("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Om.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),D("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(n.iceTransportPolicy="relay")}))),D("ENABLE_ENCODED_TRANSFORM")&&vt().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(jo(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!D("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{const a=D("NEW_TURN_MODE");a===1?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}):a===2?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}):a===3?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(jo(i.turnServerURL),":443?transport=tcp")}):a===4&&(n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(jo(i.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var a;n!=null&&n.state&&((a=this.onDTLSTransportStateChange)===null||a===void 0||a.call(this,n.state))},n.onerror=a=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in a?a.error:a)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const a=n==null?void 0:n.iceTransport.state;var c;a&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,a))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:a,remote:c}=i.getSelectedCandidatePair()||{};if(a&&c){const d=a.address+":"+a.port,h=c.address+":"+c.port;R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(ac(d)),", remote ").concat(JSON.stringify(ac(h))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var i,a;if(n||(n=this.peerConnection.getSenders().find(N=>N.track===t._mediaStreamTrack)),!n)return R.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!vt().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},d={};switch(t._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;case"balanced":c.degradationPreference="balanced"}const h=v3(this.peerConnection,t._mediaStreamTrack),m=cF(t);if(oB(t)&&h&&n&&m&&this.getLocalVideoStats&&ve(i=["vp8","vp9"]).call(i,this.store.codec)){var g;const I=c.degradationPreference||(ve(g=t._hints).call(g,Bt.CUSTOM_TRACK)?D("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");aB(this.id+h.mid,m,this,I,N=>{n&&this.updateAdaptation(n,N)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var _;const{bitrateMax:I,frameRate:N,scaleResolutionDownBy:k}=t._encoderConfig;I&&(d.maxBitrate=1e3*I),(ve(_=t._hints).call(_,Bt.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(N&&(d.maxFramerate=Fi(N)),k&&k>=1&&(d.scaleResolutionDownBy=k))}const{maxFramerate:v}=D("ENCODER_CONFIG_LIMIT");if(v&&typeof v=="number"&&(d.maxFramerate=d.maxFramerate?Math.min(d.maxFramerate,v):v),D("DSCP_TYPE")&&nc()){var y;const I=D("DSCP_TYPE");ve(y=["very-low","low","medium","high"]).call(y,I)&&(d.networkPriority=I)}const b=n.getParameters(),O=(a=b.encodings)===null||a===void 0?void 0:a[0];pn()&&!O&&(c.encodings=[d]),O&&Object.assign(O,d),Object.assign(b,c),R.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(b.encodings))),await n.setParameters(b),await P3(this.store.codec,n,D("SVC_MODE"))}async updateAdaptation(t,n){var i,a;if(!t)return R.debug("[updateAdaptation] no rtpSender found");if(!vt().supportSetRtpSenderParameters)return R.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const c={},{bitrateMax:d,frameRate:h,scaleResolutionDownBy:m}=n;d&&(c.maxBitrate=1e3*d),h&&(c.maxFramerate=Fi(h)),m&&m>=1&&ve(i=["vp8","vp9"]).call(i,this.store.codec)&&(c.scaleResolutionDownBy=m);const g=t.getParameters(),_=(a=g.encodings)===null||a===void 0?void 0:a[0];_&&Object.assign(_,c),Object.assign(g,{});try{await t.setParameters(g),R.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(g.encodings)))}catch(v){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?R.debug("[updateAdaptation] peerConnection not connected}"):R.debug("[updateAdaptation] updateRtpSenderEncodings failed",v):R.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!vt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const a=t[i],c=n[i];c instanceof sn&&!this.isVP8Simulcast(c)&&await this.updateRtpSenderEncodings(c,a.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,i){const a=Ci(t);return n.forEach((c,d)=>{const h=i[d],m=a.mediaDescriptions.find(g=>g.attributes.mid===h);m&&(Ju(m,c),MA(m,c,this.store.codec))}),Kc(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var a;(a=this.onFirstVideoDecoded)===null||a===void 0||a.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let m=0;m<t.length;m++){var i,a,c,d,h;const g=t[m],_=n[m];if(_ instanceof sn&&!ve(i=_._hints).call(i,Bt.LOW_STREAM)&&(a=_._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=_._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=_._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=_._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1&&this.store.codec==="vp8"){const v={},y={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};v.encodings=[{rid:"m",active:!0,maxBitrate:y.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:y.high}];const b=g.sender.getParameters();await g.sender.setParameters(Object.assign(b,v))}}}async applySimulcastEncodings(t,n){if(!pn()&&t.length===n.length)for(let i=0;i<t.length;i++){const a=n[i];if(a instanceof sn&&this.isVP8Simulcast(a)){const c=t[i],d={},h={high:1e3*(a._encoderConfig.bitrateMax-50),medium:5e4};d.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:h.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:h.medium,scaleResolutionDownBy:4}];const m=c.sender.getParameters();await c.sender.setParameters(Object.assign(m,d))}}}isVP8Simulcast(t){var n,i,a,c,d;return!!(t instanceof sn&&D("SIMULCAST")&&this.store.codec==="vp8"&&!ve(n=t._hints).call(n,Bt.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((a=t._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(c=t._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((d=t._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1)}logSDPExchange(t,n,i,a){if(D("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during NVConnectionExtension.").concat(a,`
`),t),n==="offer"?c=>{this.logSDPExchange(c,"answer",i==="local"?"remote":"local",a)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(t){if(vt().supportPCSetConfiguration){const n=Om.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}t.isPreallocation&&(this.isPreallocation=!0)}},Ie(Nt.prototype,"updateRemoteRTPCapabilities",[Wi],Object.getOwnPropertyDescriptor(Nt.prototype,"updateRemoteRTPCapabilities"),Nt.prototype),Ie(Nt.prototype,"connect",[Wi],Object.getOwnPropertyDescriptor(Nt.prototype,"connect"),Nt.prototype),Ie(Nt.prototype,"updateRemoteConnect",[Wi],Object.getOwnPropertyDescriptor(Nt.prototype,"updateRemoteConnect"),Nt.prototype),Ie(Nt.prototype,"createDataChannels",[Wi],Object.getOwnPropertyDescriptor(Nt.prototype,"createDataChannels"),Nt.prototype),Ie(Nt.prototype,"receive",[Wi],Object.getOwnPropertyDescriptor(Nt.prototype,"receive"),Nt.prototype),Ie(Nt.prototype,"batchReceive",[Wi],Object.getOwnPropertyDescriptor(Nt.prototype,"batchReceive"),Nt.prototype),Ie(Nt.prototype,"stopReceiving",[Wi],Object.getOwnPropertyDescriptor(Nt.prototype,"stopReceiving"),Nt.prototype),Ie(Nt.prototype,"muteRemote",[Wi],Object.getOwnPropertyDescriptor(Nt.prototype,"muteRemote"),Nt.prototype),Ie(Nt.prototype,"unmuteRemote",[Wi],Object.getOwnPropertyDescriptor(Nt.prototype,"unmuteRemote"),Nt.prototype),Ie(Nt.prototype,"muteLocal",[Wi],Object.getOwnPropertyDescriptor(Nt.prototype,"muteLocal"),Nt.prototype),Ie(Nt.prototype,"unmuteLocal",[Wi],Object.getOwnPropertyDescriptor(Nt.prototype,"unmuteLocal"),Nt.prototype),Ie(Nt.prototype,"close",[Wi],Object.getOwnPropertyDescriptor(Nt.prototype,"close"),Nt.prototype),Ie(Nt.prototype,"updateEncoderConfig",[Wi],Object.getOwnPropertyDescriptor(Nt.prototype,"updateEncoderConfig"),Nt.prototype),Ie(Nt.prototype,"updateSendParameters",[Wi],Object.getOwnPropertyDescriptor(Nt.prototype,"updateSendParameters"),Nt.prototype),Ie(Nt.prototype,"replaceTrack",[Wi],Object.getOwnPropertyDescriptor(Nt.prototype,"replaceTrack"),Nt.prototype),Ie(Nt.prototype,"updateAdaptation",[Wi],Object.getOwnPropertyDescriptor(Nt.prototype,"updateAdaptation"),Nt.prototype),Ie(Nt.prototype,"getRemoteSSRC",[Wi],Object.getOwnPropertyDescriptor(Nt.prototype,"getRemoteSSRC"),Nt.prototype),Nt);function Wi(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const a=this.mutex,c=await a.lock("From NVConnectionExtension.".concat(t));try{for(var d=arguments.length,h=new Array(d),m=0;m<d;m++)h[m]=arguments[m];return await i.apply(this,h)}finally{c()}},n}var Xt;function rG(e){var t,n,i,a=2;for(typeof Symbol<"u"&&(n=nS,i=Symbol.iterator);a--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new LT(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function LT(e){function t(n){if(Object(n)!==n)return we.reject(new TypeError(n+" is not an object."));var i=n.done;return we.resolve(n.value).then(function(a){return{value:a,done:i}})}return LT=function(n){this.s=n,this.n=n.next},LT.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?we.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?we.reject(n):t(i.apply(this.s,arguments))}},new LT(e)}let Xle=(Xt=class P0 extends HS{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(t,n){super(t,n),x(this,"name","DataChannelConnection"),x(this,"store",void 0),x(this,"peerConnection",void 0),x(this,"cname",void 0),x(this,"mutex",new Cr("DataChannelConnection-mutex")),x(this,"dataChannel",void 0),x(this,"_p2pConnection",void 0),x(this,"establishPromise",void 0),x(this,"_nvMedia",void 0),this.store=n,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(P0.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new Yle(t,n,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}getPreMedia(t){var n;return(n=this._p2pConnection)===null||n===void 0?void 0:n.getPreMedia(t)}isPreSub(){var t,n;return(t=(n=this._p2pConnection)===null||n===void 0?void 0:n.isPreSub())!==null&&t!==void 0&&t}async establish(){return await this._p2pConnection.establish()}getP2PConnectionParams(){return this._p2pConnection.establishPromise}updateRtpSenderEncodings(t){return this._p2pConnection.updateRtpSenderEncodings(t)}async connect(t){return this.cname=t.cname,await this._p2pConnection.connect(t),await new we((n,i)=>{const a=setTimeout(()=>{this.closeSignal(),i(new se(L.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(t.candidates))))},D("DC_CONNECTION_TIMEOUT"));this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(a),void n()},this.dataChannel.onerror=c=>{this.closeSignal(),i(c)},this.dataChannel.addEventListener("close",()=>{i(new se(L.DATACHANNEL_CONNECTION_TIMEOUT))})}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(t,n){return this._p2pConnection.updateRemoteRTPCapabilities(t,n)}send(t,n,i){var a=this;return Li(function*(){const c=yield ht(a.mutex.lock("From DataChannelConnection.send"));try{return yield*Mp(rG(a._p2pConnection.send(t,n,i)))}finally{c()}})()}async stopSending(t,n){return this._p2pConnection.stopSending(t,n)}async createDataChannels(t,n){return this._p2pConnection.createDataChannels(t,n)}async stopDataChannels(t){return this._p2pConnection.stopDataChannels(t)}async receive(t,n,i,a){return this._nvMedia?(R.debug("[DataChannelConnection] receive ".concat(t," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(t,n,this.cname)):(R.debug("[DataChannelConnection] receive ".concat(t," by WebRTC.")),await this._p2pConnection.receive(t,n,i,a))}async batchReceive(t){return[...await this._p2pConnection.batchReceive(t)]}async stopReceiving(t){return await this._p2pConnection.stopReceiving(t)}async muteRemote(t){return await this._p2pConnection.muteRemote(t)}async unmuteRemote(t){return await this._p2pConnection.unmuteRemote(t)}async muteLocal(t){return await this._p2pConnection.muteLocal(t)}async unmuteLocal(t){return await this._p2pConnection.unmuteLocal(t)}restartICE(t){var n=this;return Li(function*(){return yield*Mp(rG(n._p2pConnection.restartICE(t)))})()}close(){var t;(t=this._nvMedia)===null||t===void 0||t.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(t){return this._p2pConnection.getRemoteVideoIsReady(t)}updateRemoteConnect(t){var n;return(n=this._nvMedia)===null||n===void 0||n.setRemoteRtpCapabilities(t),this._p2pConnection.updateRemoteConnect(t)}async updateEncoderConfig(t,n){return await this._p2pConnection.updateEncoderConfig(t,n)}async updateSendParameters(t,n){return await this._p2pConnection.updateSendParameters(t,n)}setStatsRemoteVideoIsReady(t,n){this._p2pConnection.setStatsRemoteVideoIsReady(t,n)}async replaceTrack(t,n){return await this._p2pConnection.replaceTrack(t,n)}async getRemoteSSRC(t){return this._p2pConnection.getRemoteSSRC(t)}logSDPExchange(t,n,i,a){if(D("SDP_LOGGING"))return R.upload("exchanging ".concat(i," ").concat(n," SDP during DataChannelConnection.").concat(a,`
`),t),n==="offer"?c=>{this.logSDPExchange(c,"answer",i==="local"?"remote":"local",a)}:void 0}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Pu(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...P0.turnServerConfigToIceServers(t.turnServer.servers)),D("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...P0.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),D("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),D("ENABLE_ENCODED_TRANSFORM")&&vt().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(jo(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!D("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=t=>{var n;return(n=this.onICEConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onConnectionStateChange=t=>{var n;return(n=this.onConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportStateChange=t=>{var n;return(n=this.onDTLSTransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportError=t=>{var n;return(n=this.onDTLSTransportError)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onICETransportStateChange=t=>{var n;return(n=this.onICETransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioReceived=t=>{var n;return(n=this.onFirstAudioReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoReceived=t=>{var n;return(n=this.onFirstVideoReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioDecoded=t=>{var n;return(n=this.onFirstAudioDecoded)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoRender=t=>{var n;return(n=this.onFirstVideoRender)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoBufferReady=t=>{var n;return(n=this.onFirstVideoBufferReady)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoDecoded=(t,n,i)=>{var a;return(a=this.onFirstVideoDecoded)===null||a===void 0?void 0:a.call(this,t,n,i)},this._p2pConnection.onFirstVideoDecodedTimeout=t=>{var n;return(n=this.onFirstVideoDecodedTimeout)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onSelectedLocalCandidateChanged=(t,n)=>{var i;return(i=this.onSelectedLocalCandidateChanged)===null||i===void 0?void 0:i.call(this,t,n)},this._p2pConnection.onSelectedRemoteCandidateChanged=(t,n)=>{var i;return(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0?void 0:i.call(this,t,n)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}setConfiguration(t){this._p2pConnection.setConfiguration(t)}},Ie(Xt.prototype,"connect",[Hs],Object.getOwnPropertyDescriptor(Xt.prototype,"connect"),Xt.prototype),Ie(Xt.prototype,"updateRemoteRTPCapabilities",[Hs],Object.getOwnPropertyDescriptor(Xt.prototype,"updateRemoteRTPCapabilities"),Xt.prototype),Ie(Xt.prototype,"createDataChannels",[Hs],Object.getOwnPropertyDescriptor(Xt.prototype,"createDataChannels"),Xt.prototype),Ie(Xt.prototype,"receive",[Hs],Object.getOwnPropertyDescriptor(Xt.prototype,"receive"),Xt.prototype),Ie(Xt.prototype,"stopReceiving",[Hs],Object.getOwnPropertyDescriptor(Xt.prototype,"stopReceiving"),Xt.prototype),Ie(Xt.prototype,"muteRemote",[Hs],Object.getOwnPropertyDescriptor(Xt.prototype,"muteRemote"),Xt.prototype),Ie(Xt.prototype,"unmuteRemote",[Hs],Object.getOwnPropertyDescriptor(Xt.prototype,"unmuteRemote"),Xt.prototype),Ie(Xt.prototype,"muteLocal",[Hs],Object.getOwnPropertyDescriptor(Xt.prototype,"muteLocal"),Xt.prototype),Ie(Xt.prototype,"unmuteLocal",[Hs],Object.getOwnPropertyDescriptor(Xt.prototype,"unmuteLocal"),Xt.prototype),Ie(Xt.prototype,"close",[Hs],Object.getOwnPropertyDescriptor(Xt.prototype,"close"),Xt.prototype),Ie(Xt.prototype,"updateEncoderConfig",[Hs],Object.getOwnPropertyDescriptor(Xt.prototype,"updateEncoderConfig"),Xt.prototype),Ie(Xt.prototype,"updateSendParameters",[Hs],Object.getOwnPropertyDescriptor(Xt.prototype,"updateSendParameters"),Xt.prototype),Ie(Xt.prototype,"replaceTrack",[Hs],Object.getOwnPropertyDescriptor(Xt.prototype,"replaceTrack"),Xt.prototype),Ie(Xt.prototype,"getRemoteSSRC",[Hs],Object.getOwnPropertyDescriptor(Xt.prototype,"getRemoteSSRC"),Xt.prototype),Xt);function Hs(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const a=this.mutex,c=await a.lock("From DataChannelConnection.".concat(t));try{for(var d=arguments.length,h=new Array(d),m=0;m<d;m++)h[m]=arguments[m];return await i.apply(this,h)}finally{c()}},n}function iG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}class Jle extends Sn{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;ve(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(ar.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(ar.CONNECTED):this._state==="closed"?this.emit(ar.CLOSED):this._state==="failed"&&this.emit(ar.FAILED))}constructor(t,n,i,a){super(),x(this,"connectionID",0),x(this,"currentURLIndex",0),x(this,"reconnectReason",void 0),x(this,"_reconnectMode","tryNext"),x(this,"_initMutex",void 0),x(this,"_name",void 0),x(this,"_state","closed"),x(this,"_reconnectInterrupter",void 0),x(this,"_url",void 0),x(this,"_retryConfig",void 0),x(this,"_reconnectCount",0),x(this,"_forceCloseTimeout",5e3),x(this,"_onlineReconnectListener",void 0),x(this,"_closeEstablishingTransmitter",()=>{}),x(this,"_store",void 0),x(this,"_joinChannelServiceRecordIndex",void 0),x(this,"_transmitter",void 0),x(this,"_useCompress",void 0),x(this,"_inflateLength",0),x(this,"_deflateLength",0),this._store=a,this._name=t,this._retryConfig=function(c){for(var d=1;d<arguments.length;d++){var h=arguments[d]!=null?arguments[d]:{};d%2?iG(Object(h),!0).forEach(function(m){x(c,m,h[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(h)):iG(Object(h)).forEach(function(m){Object.defineProperty(c,m,Object.getOwnPropertyDescriptor(h,m))})}return c}({},n),this._useCompress=i}resetReconnectCount(t){R.debug("".concat(this._name," reset reconnect count, reason: ").concat(t)),this._reconnectCount=0}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const i=this._transmitter;n?setTimeout(()=>i.close(),500):i.close(),this._transmitter=void 0}this.state=t?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(t,n){if(!this._transmitter)return void R.warning("[".concat(this._name,"] can not reconnect, no websocket"));var i;t!==void 0&&(this.reconnectMode=t),R.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((i=this._store)===null||i===void 0||i.recordJoinChannelService({status:"error",errors:[new Error(n)]},this._joinChannelServiceRecordIndex));const a=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),a&&a.bind(this._transmitter)({code:9999,reason:n})}getInflateData(){const t=this._inflateLength,n=this._deflateLength;return this.clearInflateData(),{inflateLength:t,deflateLength:n}}setInflateData(t){this._deflateLength=this._deflateLength+t.originLength,this._inflateLength=this._inflateLength+t.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}let wa=function(e){return e[e.Default=0]="Default",e[e.Ack=1]="Ack",e}({});class Qle{constructor(t,n,i){x(this,"version",1),x(this,"initialRTO",void 0),x(this,"maxBatchAckCount",void 0),x(this,"maxRTO",void 0),x(this,"initialRTT",void 0),x(this,"ID",void 0),x(this,"rtt",void 0),x(this,"packetNumber",1),x(this,"rtoRatioMap",new Map),x(this,"timeoutMap",new Map),x(this,"unorderedPacketQueue",[]),x(this,"batchAckPacketQueue",[]),x(this,"lastOrderedPacketNumber",0),x(this,"batchAckTimer",void 0),x(this,"sendImpl",void 0),x(this,"receiveImpl",void 0),this.sendImpl=t,this.receiveImpl=n,this.ID=Wt(7,"transmitter-"),this.initialRTO=(i==null?void 0:i.initialRTO)!==void 0?i.initialRTO:D("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(i==null?void 0:i.initialRTT)!==void 0?i.initialRTT:D("TRANSMITTER_INITIAL_RTT"),this.rtt=(i==null?void 0:i.initialRTT)!==void 0?i.initialRTT:D("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(i==null?void 0:i.maxBatchAckCount)!==void 0?i.maxBatchAckCount:D("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(i==null?void 0:i.maxRTO)!==void 0?i.maxRTO:D("TRANSMITTER_MAX_RTO")}packetize(t,n){return{type:wa.Default,version:this.version,packetNumber:n,payload:t}}serialize(t){switch(t.type){case wa.Default:{let n;typeof t.payload=="string"?n=new TextEncoder().encode(t.payload):n=t.payload;const i=new ArrayBuffer(n.length+15),a=new DataView(i);return a.setUint16(0,t.version),a.setUint8(2,t.type),a.setUint32(3,t.packetNumber),rV(a,7,BigInt(t.sendTs)),new Uint8Array(a.buffer).set(n,15),i}case wa.Ack:{const n=new ArrayBuffer(16),i=new DataView(n);return i.setUint16(0,t.version),i.setUint8(2,t.type),i.setUint32(3,t.maxAckPacketNumber),i.setUint8(7,t.shift),rV(i,8,BigInt(t.ackSendTs)),n}}}deserialize(t){const n=new DataView(t),i=n.getUint16(0),a=n.getUint8(2);switch(a){case wa.Default:{const c=n.getUint32(3),d=nV(n,7),h=t.slice(15),m=new Uint8Array(h);return{version:i,type:a,packetNumber:c,sendTs:Number(d),payload:m}}case wa.Ack:{const c=n.getUint32(3),d=n.getUint8(7),h=nV(n,8);return{version:i,type:a,maxAckPacketNumber:c,shift:d,ackSendTs:Number(h)}}default:throw R.error("[".concat(this.ID,"] Unrecognized packet type ").concat(a)),new Error("Unrecognized packet type ".concat(a))}}sendMessage(t){D("DC_DEBUG_LOG")&&typeof t=="string"&&R.debug("[".concat(this.ID,"] sending message packet"),JSON.parse(t));const n=this.packetize(t,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const i=this.calculateRTO(n),a=window.setTimeout(()=>{this.resendMessage(n)},i);this.timeoutMap.set(n.packetNumber,a),this.sendPacket(n)}onData(t){const n=this.deserialize(t);n.type===wa.Default?this.ack(n):n.type===wa.Ack&&(this.updateRTT(n,Math.round(performance.now())),this.clearRTO(n))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(t=>{let[n,i]=t;window.clearTimeout(i)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(t){const n=this.calculateRTO(t),i=window.setTimeout(()=>{D("DC_DEBUG_LOG")&&typeof t.payload=="string"&&R.debug("[".concat(this.ID,"] resending message packet"),JSON.parse(t.payload),"timeout: ".concat(n)),this.resendMessage(t)},n);this.timeoutMap.set(t.packetNumber,i),this.sendPacket(t)}calculateRTO(t){const n=this.rtoRatioMap.get(t.packetNumber);if(n===void 0)return this.rtoRatioMap.set(t.packetNumber,1),this.initialRTO;{const i=9*this.rtt/8*n;return this.rtoRatioMap.set(t.packetNumber,n+1),i>this.maxRTO?this.maxRTO:i}}updateRTT(t,n){const i=t.ackSendTs;this.rtt=this.rtt*(7/8)+(n-i-this.rtt)/8}ack(t){if(t.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(t):(this.batchAckPacketQueue.push(t),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(t.payload);;){const n=this.unorderedPacketQueue[0];if(!n){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(n.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(t.packetNumber<=this.lastOrderedPacketNumber){const n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:wa.Ack,version:this.version};D("DC_DEBUG_LOG")&&R.debug("[".concat(this.ID,"] sending ack packet"),n,"packetNumber: ".concat(t.packetNumber)),this.sendPacket(n)}else if(t.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[t.packetNumber-this.lastOrderedPacketNumber-2]=t;const n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:wa.Ack,version:this.version};D("DC_DEBUG_LOG")&&R.debug("[".concat(this.ID,"] sending ack packet"),n,"packetNumber: ".concat(t.packetNumber)),this.sendPacket(n)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const t={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:wa.Ack,version:this.version};D("DC_DEBUG_LOG")&&R.debug("[".concat(this.ID,"] sending batch ack packet"),t,"shift: ".concat(this.batchAckPacketQueue.length-1)),this.sendPacket(t),this.batchAckPacketQueue=[]}sendPacket(t){t.type===wa.Default&&(t.sendTs=Math.round(performance.now()));const n=this.serialize(t);this.sendImpl(n)}clearRTO(t){for(let n=t.maxAckPacketNumber-t.shift;n<=t.maxAckPacketNumber;n++){const i=this.timeoutMap.get(n);i!==void 0&&window.clearTimeout(i),this.timeoutMap.delete(n),this.rtoRatioMap.delete(n)}}}class sG extends Jle{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),x(this,"_initMutex",void 0),x(this,"_reconnectInterrupter",void 0),x(this,"_url",void 0),x(this,"_transmitter",void 0),x(this,"_addresses",void 0),x(this,"_reliableTransmission",void 0),x(this,"_textEncoder",void 0),x(this,"_textDecoder",void 0),this._textEncoder=new TextEncoder,this._textDecoder=new TextDecoder,this._initMutex=new Cr("datachannel");const{timeout:i,timeoutFactor:a}=n,c=Math.max(300,Math.floor(3*i/5)),d=Math.max(1.2,Math.floor(8*a)/10);wi.ONLINE&&(this._retryConfig.timeout=c,this._retryConfig.timeoutFactor=d),Nn.on(Du.NETWORK_STATE_CHANGE,(h,m)=>{h!==m&&(this.resetReconnectCount("network state change: ".concat(m," -> ").concat(h)),h===wi.ONLINE?(this._retryConfig.timeout=c,this._retryConfig.timeoutFactor=d):(this._retryConfig.timeout=i,this._retryConfig.timeoutFactor=a))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=n;const i=(a,c)=>{this._addresses=t,this.currentURLIndex=this._addresses.findIndex(h=>h.fingerprint||D("FINGERPRINT"));const d=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(d).then(a).catch(c),this.once(ar.CLOSED,()=>c(new se(L.WS_DISCONNECT))),this.once(ar.CONNECTED,()=>a())};return this._initMutex.lock().then(a=>new we((c,d)=>{i(c,d)}).then(()=>{a()}).catch(()=>{a()}))}async sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new se(L.WS_ABORT,"datachannel is not ready");try{n||(t=JSON.stringify(t));const i=this._textEncoder.encode(t),a=lle(i,{raw:!0});this._reliableTransmission.sendMessage(a)}catch(i){throw new se(L.WS_ERR,"send datachannel signal message error"+i.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(t){const n=JSON.stringify(t);return{compressed:n,compressedLength:n.length,origin:t}}sendMessageWithUint8Array(t){return{compressed:t,compressedLength:t.byteLength,origin:t}}createTransmitterConnection(t){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(t.ip,":").concat(t.port),new we((n,i)=>{var a;const c=()=>{R.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="recover",this.state="connected",this.resetReconnectCount("opened"),n()},d=async _=>{var v;if((v=this._closeEstablishingTransmitter)===null||v===void 0||v.call(this),R.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(_.code,", reason: ").concat(_.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=_.reason,this.state="reconnecting");const y=Ss(this,ar.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,b=await this.reconnectWithAction(y);if(this.state==="closed")return void R.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!b)return i(new se(L.WS_DISCONNECT,"datachannel reconnect failed: ".concat(_.code))),void this.close(!0);n()}else i(new se(L.WS_DISCONNECT,"datachannel close: ".concat(_.code))),this.close()},h=async _=>{try{var v;(v=this._reliableTransmission)===null||v===void 0||v.onData(_.data)}catch(y){console.log(y)}};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),R.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(t)));const m=(a=this._store)===null||a===void 0?void 0:a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),g=Date.now();Zn(this,ar.TO_CONNECT_DATACHANNEL).then(_=>{var v,y;if(!_)throw new Error("transmissonInfo not exist yet");const{transmitter:b,close:O}=_;this._transmitter=b,(v=this._store)===null||v===void 0||v.signalChannelOpen();const I=Date.now()-g;R.debug("[choose dc] dc open cost ".concat(I,"ms")),this._reliableTransmission=new Qle(N=>{var k;this._transmitter&&this._transmitter.readyState==="open"&&((k=this._transmitter)===null||k===void 0||k.send(N))},N=>{if(typeof N=="string")this.emit(ar.ON_MESSAGE,N);else{const k=ule(N,{raw:!0}).buffer,j=this._textDecoder.decode(k);this.emit(ar.ON_MESSAGE,j)}}),this._closeEstablishingTransmitter=()=>{var N;(N=this._reliableTransmission)===null||N===void 0||N.close(),this._reliableTransmission=void 0,O()},c&&c(),b.onclose=d,b.onmessage=h,(y=this._store)===null||y===void 0||y.recordJoinChannelService({endTs:Date.now(),status:"success"},m),this._joinChannelServiceRecordIndex=m}).catch(_=>{var v;if((v=this._store)===null||v===void 0||v.recordJoinChannelService({endTs:Date.now(),status:_ instanceof se&&_.code===L.WS_ABORT?"aborted":"error",errors:[_]},m),this.state!=="closed"){if(_ instanceof se&&_.code===L.WS_ERR){const y=new se(L.WS_ERR,"init datachannel failed! Error: ".concat(_.toString()));return R.error("[".concat(this._name,"]").concat(y)),void i(y)}d&&d(_)}else i(new se(L.WS_DISCONNECT,"datachannel is closed: ".concat(_.toString())))})})}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||Nn.networkState!==wi.OFFLINE||(this._onlineReconnectListener=Nn.onlineWaiter&&Nn.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let i=!0;if(this._reconnectInterrupter=()=>{i=!1},n){const h=fS(this._reconnectCount,this._retryConfig);R.debug("[".concat(this._name,"] wait ").concat(h,"ms to reconnect datachannel, mode: ").concat(t)),await we.race([pr(h),this._onlineReconnectListener||new we(()=>{})])}if(this.state==="closed"||!i)return!1;this._reconnectCount+=1;const a=async(h,m)=>{this.emit(ar.RECONNECT_CREATE_CONNECTION,m),await this.createTransmitterConnection(h)};try{if(t==="retry"){const h=this._addresses[this.currentURLIndex];await a(h,t)}else if(t==="tryNext"){this.currentURLIndex+=1;for(let m=this.currentURLIndex;m<this._addresses.length;m++){if(this._addresses[m].fingerprint||D("FINGERPRINT")){this.currentURLIndex=m;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return R.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);R.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const h=this._addresses[this.currentURLIndex];await a(h,t)}else t==="recover"&&(R.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(ar.FAILBACK));return!0}catch(h){var c,d;return R.error("[".concat(this._name,"] reconnect failed"),h.toString()),h!=null&&(c=h.data)!==null&&c!==void 0&&c.desc&&Array.isArray(h.data.desc)&&h.data.desc.length&&ve(d=h.data.desc).call(d,"dynamic key expired")?(this.emit(ar.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,n)}}}class $le extends Sn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===bt.CONNECTED?this.emit(Ue.WS_CONNECTED):t===bt.RECONNECTING?this.emit(Ue.WS_RECONNECTING,this._websocketReconnectReason):t===bt.CLOSED&&this.emit(Ue.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}processPendingNotifications(){this.pendingNotifications.length!==0&&(R.debug("[".concat(this.clientId,"] processing ").concat(this.pendingNotifications.length," pending notifications")),this.pendingNotifications.forEach(t=>{let{type:n,message:i}=t;this.emit(n,i),n===Ze.ON_NOTIFICATION&&this.handleNotification(i),n===Ze.ON_USER_BANNED&&this.handleUserBanned(i)}),this.pendingNotifications=[])}handleUserBanned(t){switch(t.error_code){case 14:this.close(Tt.UID_BANNED);break;case 15:this.close(Tt.IP_BANNED);break;case 16:this.close(Tt.CHANNEL_BANNED)}}constructor(t,n){super(),x(this,"__name__","DataChannelSignal"),x(this,"_disconnectedReason",void 0),x(this,"_websocketReconnectReason",void 0),x(this,"_connectionState",bt.CLOSED),x(this,"reconnectToken",void 0),x(this,"websocket",void 0),x(this,"openConnectionTime",void 0),x(this,"clientId",void 0),x(this,"lastMsgTime",Date.now()),x(this,"uploadCache",[]),x(this,"uploadCacheInterval",void 0),x(this,"rttRolling",new LI(5)),x(this,"pingpongTimer",void 0),x(this,"inflateDataTimer",void 0),x(this,"pingpongTimeoutCount",0),x(this,"ortc",void 0),x(this,"joinResponse",void 0),x(this,"multiIpOption",void 0),x(this,"initError",void 0),x(this,"spec",void 0),x(this,"store",void 0),x(this,"isJoining",!1),x(this,"pendingNotifications",[]),x(this,"onWebsocketMessage",i=>{if(i instanceof ArrayBuffer)return void this.emit(Ue.ON_BINARY_DATA,i);const a=JSON.parse(i);if(D("DC_DEBUG_LOG")&&R.debug("[datachannel-signal] received packet",a),this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(a,"_id")){const c="res-@".concat(a._id);this.emit(c,a._result,a._message)}else Object.prototype.hasOwnProperty.call(a,"_type")&&(this.isJoining?a._type===Ze.ON_NOTIFICATION||a._type===Ze.ON_USER_BANNED?(this.emit(a._type,a._message),a._type===Ze.ON_NOTIFICATION&&this.handleNotification(a._message),a._type===Ze.ON_USER_BANNED&&this.handleUserBanned(a._message)):(this.pendingNotifications.push({type:a._type,message:a._message}),R.debug("[".concat(this.clientId,"] cached notification during join: ").concat(a._type))):(this.emit(a._type,a._message),a._type===Ze.ON_NOTIFICATION&&this.handleNotification(a._message),a._type===Ze.ON_USER_BANNED&&this.handleUserBanned(a._message)))}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new sG("gateway-".concat(this.clientId),this.spec.retryConfig,!0,n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===bt.CONNECTED&&this.reconnect("retry",rd.OFFLINE)})}async request(t,n,i,a){const c=Wt(6,""),d={_id:c,_type:t,_message:n},h=this.websocket.connectionID,m=()=>new we((O,I)=>{if(this.connectionState===bt.CONNECTED)return O();const N=()=>{this.off(Ue.WS_CLOSED,k),O()},k=()=>{this.off(Ue.WS_CONNECTED,N),I(new se(L.WS_ABORT))};this.once(Ue.WS_CONNECTED,N),this.once(Ue.WS_CLOSED,k),t!==Ve.PUBLISH&&t!==Ve.SUBSCRIBE&&t!==Ve.UNSUBSCRIBE&&t!==Ve.UNPUBLISH&&t!==Ve.CONTROL&&t!==Ve.RESTART_ICE||this.once(Ue.DISCONNECT_P2P,()=>{I(new se(L.DISCONNECT_P2P))}),t!==Ve.PUBLISH&&t!==Ve.RESTART_ICE||this.once(Ue.ABORT_P2P_EXECUTION,()=>{I(new se(L.DISCONNECT_P2P))})});if(this.connectionState!==bt.CONNECTING&&this.connectionState!==bt.RECONNECTING||t===Ve.JOIN||t===Ve.REJOIN||await m(),t===Ve.LEAVE&&(this.websocket.unbindDcCloseEventListener(),a=!0),D("DC_DEBUG_LOG")&&R.debug("[datachannel-signal] sendMessage",d),await this.websocket.sendMessage(d,!0,!1),a)return;const g=new we((O,I)=>{let N=!1;const k=(G,K)=>{N=!0,O({isSuccess:G==="success",message:K||{}}),this.off(Ue.WS_CLOSED,j),this.off(Ue.WS_RECONNECTING,j),this.emit(Ue.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(c),k);const j=()=>{I(new se(L.WS_ABORT,"type: ".concat(t))),this.off(Ue.WS_CLOSED,j),this.off(Ue.WS_RECONNECTING,j),this.off("res-@".concat(c),k)};this.once(Ue.WS_CLOSED,j),this.once(Ue.WS_RECONNECTING,j),pr(D("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==h||N||(R.warning("dc request timeout, type: ".concat(t)),this.emit(Ue.REQUEST_TIMEOUT,t,n))})});let _=null;try{_=await g}catch(O){if(this.connectionState===bt.CLOSED||t===Ve.LEAVE)throw new se(L.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?O.throw():t===Ve.JOIN||t===Ve.REJOIN?null:(await m(),await this.request(t,n))}if(_.isSuccess)return _.message;const v=Number(_.message.error_code||_.message.code),y=Xu(v),b=new se(L.UNEXPECTED_RESPONSE,"".concat(y.desc,": ").concat(_.message.error_str),{code:v,data:_.message});return y.action==="success"?_.message:(R.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(v,", message: ").concat(y.desc,", action: ").concat(y.action)),v===We.ERR_TOO_MANY_BROADCASTERS?((t===Ve.JOIN||t===Ve.REJOIN)&&(this.initError=b,this.close()),b.throw()):y.action==="failed"?b.throw():y.action==="quit"?(this.initError=b,this.close(),b.throw()):(v===We.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",rd.MULTI_IP)):this.reconnect(y.action,rd.SERVER_ERROR),t===Ve.JOIN||t===Ve.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new we(i=>{const a=c=>{(!n||n(c))&&(this.off(t,a),i(c))};this.on(t,a)})}uploadWRTCStats(t){if(!this.store.sessionId)return void R.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Yu.WRTC_STATS,n)}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const c=D("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>c&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==bt.CONNECTED)return;const d=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(d._type,d._message)},D("UPLOAD_CACHE_INTERVAL")||2e3))}}async send(t,n){const i={_type:t,_message:n};await this.websocket.sendMessage(i)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new we((n,i)=>{this.once(Ue.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Ue.WS_CLOSED,()=>i(this.initError||new se(L.WS_ABORT))),this.connectionState=bt.CONNECTING,this.websocket.init(t).catch(i),this.websocket.once(ar.FAILBACK,()=>{i(new se(L.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{this.openConnectionTime===void 0&&(R.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),i(new se(L.INIT_DATACHANNEL_TIMEOUT)))},D("DC_JOIN_WITH_FAILBACK"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this.isJoining=!1,this.pendingNotifications=[],this._disconnectedReason=t||Tt.LEAVE,this.connectionState=bt.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),t===Tt.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new sG("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),D("DC_PINGPONG_INTERVAL")),!this.joinResponse){this.emit(Ue.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await Zn(this,Ue.REQUEST_JOIN_INFO);this.store.joinReq(),this.isJoining=!0,this.pendingNotifications=[];const n=await this.request(Ve.JOIN,t);if(this.store.joinRep(),this.ortc=t==null?void 0:t.ortc,!n)return this.emit(Ue.REPORT_JOIN_GATEWAY,L.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Ue.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=bt.CONNECTED,this.isJoining=!1,this.processPendingNotifications(),!0}async rejoin(){if(!this.reconnectToken)throw new se(L.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=ku(this,Ue.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(Ve.REJOIN,t);return!!n&&(this.connectionState=bt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),D("DC_PINGPONG_INTERVAL")),n.peers&&n.peers.forEach(i=>{this.emit(Ze.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(Ze.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(Ze.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(Ze.MUTE_AUDIO,{uid:i.uid}):this.emit(Ze.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(Ze.MUTE_VIDEO,{uid:i.uid}):this.emit(Ze.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(Ze.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(Ze.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(Ze.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(Ze.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(Ze.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){if(!this.ortc)return!1;const n={downgrade_codec:t,ortc:this.ortc};return!!await this.request(Ve.DOWNGRADE_CODEC,n)}handleNotification(t){R.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Xu(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Tt.UID_BANNED),void this.close()):void this.reconnect(n.action,rd.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1,D("DC_DEBUG_LOG")&&console.debug("[datachannel-signal] pingpongTimeoutCount: ".concat(this.pingpongTimeoutCount));const t=D("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(R.warning("[datachannel-signal] PINGPONG Timeout. Last Socket Message: ".concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>D("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("recover",rd.FALLBACK):this.request(Ve.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),D("REPORT_STATS")&&this.send(Ve.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleInflateData(){const{inflateLength:t,deflateLength:n}=this.websocket.getInflateData();t!==0&&n!==0&&this.upload(Yu.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(ar.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Ue.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(ar.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(ar.CLOSED,()=>{this.connectionState=bt.CLOSED}),this.websocket.on(ar.FAILED,()=>{this._disconnectedReason=Tt.NETWORK_ERROR,this.connectionState=bt.CLOSED}),this.websocket.on(ar.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===bt.CONNECTED?this.connectionState=bt.RECONNECTING:this.connectionState=bt.CONNECTING}),this.websocket.on(ar.WILL_RECONNECT,(t,n)=>{if(ku(this,Ue.IS_P2P_DISCONNECTED)&&t==="retry")return R.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(Ue.NEED_RENEW_SESSION),this.emit(Ue.DISCONNECT_P2P),n("tryNext");t!=="retry"&&(R.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(Ue.NEED_RENEW_SESSION),this.emit(Ue.DISCONNECT_P2P)),n(t)}),this.websocket.on(ar.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{R.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",rd.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Ue.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof se&&t.code===L.UNEXPECTED_RESPONSE&&t.data.code===We.ERR_NO_AUTHORIZED)return R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",rd.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",rd.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(ar.REQUEST_NEW_URLS,(t,n)=>{Zn(this,Ue.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(ar.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ze.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(ar.TO_CONNECT_DATACHANNEL,(t,n)=>{Zn(this,Ue.PRE_CONNECT_PC).then(t).catch(n)}),this.websocket.on(ar.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(Ue.DATACHANNEL_FAILBACK)})}}const Zle={name:"DataChannelConnection",create:function(e){let{store:t,spec:n}=e;return new Xle(n,t)}},ede={name:"DataChannelSignal",create:function(e){let{store:t,spec:n}=e;return new $le(n,t)}};BI(),Zt("PROCESS_ID","process-".concat(Wt(8,""),"-").concat(Wt(4,""),"-").concat(Wt(4,""),"-").concat(Wt(4,""),"-").concat(Wt(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void R.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();R.debug("Loading global parameters from cache",t),Object.keys(t).forEach(i=>{if(Object.prototype.hasOwnProperty.call(zt,i)){const{value:a,expires:c}=t[i];if(c&&c<=n)return;Ms[i]=a,zt[i]=a}})}catch(t){R.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(Ms.AREAS)&&Ms.AREAS.length>0&&GA(Ms.AREAS,!0);const oG=(e,t,n)=>{R.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),Zt(e,t,n)};lc(gle,!1),lc(vle,!1),lc(Xae,!1),lc(xle,!1),lc(ple,!1),lc(Gle,!1),lc(Hle,!1),lc(qle,!1),lc(Zle,!1),lc(ede,!1);const er=function(e){const t=new Sn,n=e,i={getListeners:t.getListeners.bind(t),on:(a,c)=>(function(d,h){d===oc.SECURITY_POLICY_VIOLATION&&k5(h,!0)}(a,c),t.on.bind(t)(a,c)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return D5(D5({},n),i)}({__TRACK_LIST__:Fu,VERSION:ro,BUILD:zI,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:oG,getParameter:D,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await async function(i){let a;return vt().supportUnifiedPlan?(i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"}),a=(await i.createOffer()).sdp):a=(await i.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,a}(t);if(!n)return e;t.close(),t=null,e=function(i){const a={video:[],audio:[]};return i.match(/ VP8/i)&&a.video.push("VP8"),i.match(/ VP9/i)&&a.video.push("VP9"),i.match(/ AV1/i)&&a.video.push("AV1"),i.match(/ H264/i)&&a.video.push("H264"),i.match(/ H265/i)&&a.video.push("H265"),i.match(/ opus/i)&&a.audio.push("OPUS"),i.match(/ PCMU/i)&&a.audio.push("PCMU"),i.match(/ PCMA/i)&&a.audio.push("PCMA"),i.match(/ G722/i)&&a.audio.push("G722"),a}(n)}catch(t){throw new se(L.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];const t=Le.reportApiInvoke(null,{name:_n.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:rn.TRACER}),n=function(){let c=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],d=!1;try{const h=window.RTCPeerConnection,m=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,g=window.WebSocket;d=!(!h||!g),c&&!m&&(d=!1),d&&Dg()&&Hj(75)&&new h().close()}catch(h){R.error("check system requirement failed: ",h),d=!1}return d}(e),i=Qae();R.debug("checkSystemRequirements, api:",n,"browser",i);const a=n&&i;return t.onSuccess(a),D("IGNORE_RTC_DEVICE_CHECK")?n:a},getDevices:function(e){return Bs.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Bs.getRecordingDevices(e)},getCameras:function(e){return Bs.getCamerasDevices(e)},getElectronScreenSources:JV,getPlaybackDevices:function(e){return Bs.getSpeakers(e)},createClient:x5,createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=D("CAMERA_CAPTURE_CONFIG"),n=Wt(8,"track-cam-"),i=Le.reportApiInvoke(null,{id:n,tag:rn.TRACER,name:_n.CREATE_CAM_VIDEO_TRACK,options:[hn({},e),t]});t&&(e.encoderConfig=t);const a=AS(e);let c=null;R.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{c=(await Fs({video:a},n)).getVideoTracks()[0]||null}catch(h){throw i.onError(h),h}if(!c){const h=new de(L.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(h),h.throw(R)}if(e.optimizationMode&&lA(n,c,e,Lo(e.encoderConfig)),D("USE_STANDARD_BITRATE_DEFAULT")){const h=Lo(e.encoderConfig);e.encoderConfig=h,delete h.bitrateMax,delete h.bitrateMin}const d=new xS(c,e,a,e.scalabiltyMode?RS(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return i.onSuccess(d.getTrackId()),R.info("create camera video success, trackId:",n),d},createCustomVideoTrack:function(e){const t=Wt(8,"track-cus-"),n=Le.reportApiInvoke(null,{id:t,tag:rn.TRACER,name:_n.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});D("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const i=new sn(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?RS(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[Bt.CUSTOM_TRACK]);return n.onSuccess(i.getTrackId()),R.info("create custom video track success with config",e,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof t=="object"?function(y){const b=oF(y);return VV()&&y.suppressLocalAudioPlayback&&(b.suppressLocalAudioPlayback=y.suppressLocalAudioPlayback),FV()&&y.restrictOwnAudio&&(b.restrictOwnAudio=!0),b}(t):void 0;n&&(t="auto");const i=Wt(8,"track-scr-v-"),a=Le.reportApiInvoke(null,{id:i,tag:rn.TRACER,name:_n.CREATE_SCREEN_VIDEO_TRACK,options:[hn({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const c=function(y){const b={};y.screenSourceType&&(b.mediaSource=y.screenSourceType),y.extensionId&&zc()&&(b.extensionId=y.extensionId);const{displaySurface:O,selfBrowserSurface:I,surfaceSwitching:N,systemAudio:k,preferCurrentTab:j,windowAudio:G,monitorTypeSurfaces:K}=y;(ha(107)||$l(107)||Ou(93))&&(O&&(Hn(O,"displaySurface",["browser","window","monitor"]),b.displaySurface=O),I?(Hn(I,"selfBrowserSurface",["exclude","include"]),b.selfBrowserSurface=I):b.selfBrowserSurface="include",N&&(Hn(N,"surfaceSwitching",["exclude","include"]),b.surfaceSwitching=N)),(ha(105)||$l(105)||Ou(91))&&k&&(Hn(k,"systemAudio",["exclude","include"]),b.systemAudio=k),(ha(94)||$l(94)||Ou(80))&&j&&(b.preferCurrentTab=!0),(ha(141)||$l(141)||Ou(125))&&G&&(Hn(G,"windowAudio",["exclude","system"]),b.windowAudio=G),(ha(119)||$l(119)||Ou(105))&&K&&(Hn(K,"monitorTypeSurfaces",["exclude","include"]),b.monitorTypeSurfaces=K),y.electronScreenSourceId&&(b.sourceId=y.electronScreenSourceId);const X=y.encoderConfig?JI(y.encoderConfig):null;return b.mandatory={chromeMediaSource:"desktop",maxWidth:X?X.width:void 0,maxHeight:X?X.height:void 0},X&&(X.frameRate&&(typeof X.frameRate=="number"?(b.mandatory.maxFrameRate=X.frameRate,b.mandatory.minFrameRate=X.frameRate):(b.mandatory.maxFrameRate=X.frameRate.max||X.frameRate.ideal||X.frameRate.exact||void 0,b.mandatory.minFrameRate=X.frameRate.min||X.frameRate.ideal||X.frameRate.exact||void 0),b.frameRate=X.frameRate),X.width&&(b.width=X.width),X.height&&(b.height=X.height)),b}(e);let d=null,h=null;const m=vt();if(!m.supportShareAudio&&t==="enable"){const y=new de(L.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return a.onError(y),y.throw(R)}R.info("start create screen video track with config",e,"withAudio",t,"trackId",i);const g=m.supportShareAudio&&t!=="disable";try{const y=await Fs({screen:c,screenAudio:g?n||!0:void 0},i);d=y.getVideoTracks()[0]||null,h=y.getAudioTracks()[0]||null}catch(y){throw a.onError(y),y}if(!d){const y=new de(L.UNEXPECTED_ERROR,"can not find track in media stream");return a.onError(y),y.throw(R)}if(!h&&t==="enable"){d&&d.stop();const y=new de(L.SHARE_AUDIO_NOT_ALLOWED);return a.onError(y),y.throw(R)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(lA(i,d,e,e.encoderConfig&&JI(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const _=new sn(d,e.encoderConfig?JI(e.encoderConfig):{},e.scalabiltyMode?RS(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i,[Bt.SCREEN_TRACK]);if(!h)return a.onSuccess(_.getTrackId()),R.info("create screen video track success","video:",_.getTrackId()),_;const v=new Dn(h,void 0,Wt(8,"track-scr-a-"),!1);return a.onSuccess([_.getTrackId(),v.getTrackId()]),R.info("create screen video track success","video:",_.getTrackId(),"audio:",v.getTrackId()),[_,v]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=D("CAMERA_CAPTURE_CONFIG"),i=Wt(8,"track-mic-"),a=Wt(8,"track-cam-"),c=Le.reportApiInvoke(null,{id:"".concat(i,"-").concat(a),tag:rn.TRACER,name:_n.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const d=AS(t),h=aF(e);let m=null,g=null;R.info("start create camera video track(".concat(a,") and microphone audio track(").concat(i,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const y=await Fs({audio:h,video:d},"".concat(i,"-").concat(a));m=y.getAudioTracks()[0],g=y.getVideoTracks()[0]}catch(y){throw c.onError(y),y}if(!m||!g){const y=new de(L.UNEXPECTED_ERROR,"can not find tracks in media stream");return c.onError(y),y.throw(R)}if(t.optimizationMode&&lA(a,g,t,Lo(t.encoderConfig)),D("USE_STANDARD_BITRATE_DEFAULT")){const y=Lo(t.encoderConfig);t.encoderConfig=y,delete y.bitrateMax,delete y.bitrateMin}const _=new Wg(m,e,h,i),v=new xS(g,t,d,t.scalabiltyMode?RS(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,a);return c.onSuccess([_.getTrackId(),v.getTrackId()]),R.info("create camera video track(".concat(a,") and microphone audio track(").concat(i,") success")),[_,v]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Wt(8,"track-mic-"),n=Le.reportApiInvoke(null,{id:t,tag:rn.TRACER,name:_n.CREATE_MIC_AUDIO_TRACK,options:[e]}),i=aF(e);let a=null;R.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{a=(await Fs({audio:i},t)).getAudioTracks()[0]||null}catch(d){throw n.onError(d),d}if(!a){const d=new de(L.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(d),d.throw(R)}const c=new Wg(a,e,i,t);return n.onSuccess(c.getTrackId()),R.info("create microphone audio track success, trackId:",t),c},createCustomAudioTrack:D4,createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:i}=e;let{source:a}=e;const c={source:a instanceof AudioBuffer?"AudioBuffer":a instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":a,cacheOnlineFile:n,encoderConfig:i},d=Wt(8,"track-buf-"),h=Le.reportApiInvoke(null,{id:d,tag:rn.TRACER,name:_n.CREATE_BUFFER_AUDIO_TRACK,options:[c]});if(D("DISABLE_WEBAUDIO"))throw new de(L.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");R.info("start create buffer source audio track with config",JSON.stringify(c),"trackId",d);const m=a;if(!(a instanceof AudioBuffer))try{a=await async function(v,y){let b=null;if(typeof v=="string"){const I=YF.get(v);if(I)return R.debug("use cached audio resource: ",v),I;try{b=(await pa(()=>Mi.get(v,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(N){throw new de(L.FETCH_AUDIO_FILE_FAILED,N.toString())}}else b=await new we((N,k)=>{const j=new FileReader;j.onload=G=>{G.target?N(G.target.result):k(new de(L.READ_LOCAL_AUDIO_FILE_ERROR))},j.onerror=()=>{k(new de(L.READ_LOCAL_AUDIO_FILE_ERROR))},j.readAsArrayBuffer(v)});const O=await function(I){const N=Jp();return new we((k,j)=>{N.decodeAudioData(I,G=>{k(G)},G=>{j(new de(L.DECODE_AUDIO_FILE_FAILED,G.toString()))})})}(b);return typeof v=="string"&&y&&YF.set(v,O),O}(a,n)}catch(v){return h.onError(v),v.throw(R)}const g=new goe(a),_=new foe(m,g,i?wS(i):{},d);return R.info("create buffer source audio track success, trackId:",d),h.onSuccess(_.getTrackId()),_},setAppType:function(e){if(R.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw R.debug("Invalid appType"),new se(L.INVALID_PARAMS,"invalid app type",e);Zt("APP_TYPE",Math.floor(e))},setLogLevel:function(e){R.setLogLevel(e)},enableLogUpload:function(){D("USE_NEW_LOG")?Zt("UPLOAD_LOG",!0):R.enableLogUpload()},disableLogUpload:function(){D("USE_NEW_LOG")?Zt("UPLOAD_LOG",!1):R.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new Q3},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Le.reportApiInvoke(null,{tag:rn.TRACER,name:_n.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Dn||e instanceof Zp)){const m=new se(L.INVALID_TRACK,"the parameter is not a audio track");return n.onError(m),m.throw()}t&&t<1e3&&(t=1e3);const i=e instanceof Dn?e.getTrackLabel():"remote_track",a=e.getVolumeLevel();let c=a,d=a;const h=Date.now();return new we(m=>{const g=setInterval(()=>{const _=e.getVolumeLevel();c=_>c?_:c,d=_<d?_:d;const v=c-d>1e-4,y=Date.now()-h;if(v||y>t){clearInterval(g);const b=v,O={duration:y,deviceLabel:i,maxVolumeLevel:c,result:b};R.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(O))),n.onSuccess(O),m(b)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Le.reportApiInvoke(null,{tag:rn.TRACER,name:_n.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof sn||e instanceof $p)){const v=new se(L.INVALID_TRACK,"the parameter is not a video track");return n.onError(v),v.throw()}t&&t<1e3&&(t=1e3);const i=e instanceof sn?e.getTrackLabel():"remote_track",a=e.getMediaStreamTrack(!0),c=document.createElement("video");c.style.width="1px",c.style.height="1px",c.setAttribute("muted",""),c.muted=!0,c.setAttribute("playsinline",""),c.controls=!1,(wr()||hS())&&(c.style.opacity="0.01",c.style.position="fixed",c.style.left="0",c.style.top="0",document.body.appendChild(c)),c.srcObject=new MediaStream([a]),c.play();const d=document.createElement("canvas");d.width=160,d.height=120;let h=0,m=0;try{const v=Date.now();h=await function(y,b,O,I){let N,k=0,j=null;return new we((G,K)=>{function X(){k>I&&N&&(N(),G(k));const z=O.getContext("2d");if(!z){const Ee=new se(L.UNEXPECTED_ERROR,"can not get canvas 2d context.");return R.error(Ee.toString()),void K(Ee)}z.drawImage(y,0,0,160,120);const ne=z.getImageData(0,0,O.width,O.height),me=Math.floor(ne.data.length/3);if(j){for(let Ee=0;Ee<me;Ee+=3)if(ne.data[Ee]!==j[Ee])return k+=1,void(j=ne.data);j=ne.data}else j=ne.data}setTimeout(()=>{N&&(N(),G(k))},b),N=nA(()=>{X()},30)})}(c,t,d,4),m=Date.now()-v}catch(v){throw n.onError(v),v}Lae===Mt.SAFARI&&(c.pause(),c.remove()),c.srcObject=null;const g=h>4,_={duration:m,changedPicNum:h,deviceLabel:i,result:g};return R.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(_))),n.onSuccess(_),g},setArea:GA,audioElementPlayCenter:pi,resumeAudioContext:function(){return pi.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){Zae.processExternalMediaAEC(e)},registerExtensions:function(e){const t=D("PLUGIN_INFO")||[];e.forEach(n=>{"name"in n&&!ve(t).call(t,n.name)&&t.push(n.name);const i=n;i.__registered__=!0,i.logger.hookLog=R.extLog,i.reporter.hookApiInvoke=Le.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(a=>{i.parameters[a]=D(a)})}),oG("PLUGIN_INFO",t)},ChannelMediaRelayError:nm,ChannelMediaRelayEvent:Yc,ChannelMediaRelayState:Zi,RemoteStreamFallbackType:loe,RemoteStreamType:coe,ConnectionDisconnectedReason:Tt,AudienceLatencyLevelType:Use,AREAS:jt,preload:async function(e,t,n,i){return dN(e,t,n,i)},startLastmileProbeTest:async function(e,t,n,i){let a={state:"unavailable"};await dN(e,t,n,i);const c=await uN({appId:e,cname:t,token:n||e,uid:i,cloudProxyServer:"disabled"});if(!c)return a;await hN(c);let d,h=x5({mode:"rtc",codec:"vp8"});try{d=await h.join(e,t,n,i,{networkQualityProbe:!0})}catch{return a}const m=new Vae,g=m.createMuteAudioTrack();let _=await D4({mediaStreamTrack:g});await h.publish([_]);let[v,y,b]=await new we((G,K)=>{const X=setTimeout(()=>{clearTimeout(X),G([!0,null,"audio"])},5e3);h.on("user-published",async(z,ne)=>{z.uid===d&&(clearTimeout(X),G([!1,z,ne]))})});if(v||!y)return await h.unpublish([_]),await h.leave(),_.close(),m.close(),a;await h.subscribe(y,b),await new we((G,K)=>{const X=setTimeout(()=>{clearTimeout(X),G(null)},5e3)});let O=h.getRTCStats(),I=h.getLocalAudioStats();const N=O.RTT,k=I.sendJitterMs,j=I.currentPacketLossRate;return a={state:"complete",rtt:N,packetLossRate:j,jitter:k,networkQuality:((G,K,X)=>{let z=1;if(X>0){let Qe=Math.log(100*X)/Math.log(2)+1;Qe=Math.min(5,Math.max(0,Qe)),z=1-Qe/5}let ne=1;if(G>0){let Qe=Math.log(G/40)/Math.log(2)+1;Qe=Math.min(5,Math.max(0,Qe)),ne=1-Qe/5}let me=1;if(K>0){let Qe=Math.log(K/10)/Math.log(2.5)+1;Qe=Math.min(5,Math.max(0,Qe)),me=1-Qe/5}const Ee=.5*z+.3*ne+.2*me;let Oe=0;return Oe=Ee>=.8?1:Ee>=.6?2:Ee>=.4?3:Ee>=.2?4:5,Oe})(N,k,j)},await h.unsubscribe(y),await h.unpublish([_]),await h.leave(),_.close(),m.close(),await hN(c),a}});return Object.defineProperties(er,{onAudioAutoplayFailed:{get:()=>ji.onAudioAutoplayFailed,set:e=>{ji.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>ji.onAutoplayFailed,set:e=>{ji.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>er._onSecurityPolicyViolation,set(e){er._onSecurityPolicyViolation=e,k5(e)}},__CLIENT_LIST__:{get:()=>D("SHOW_GLOBAL_CLIENT_LIST")?Ku:[]}}),Bs.on(Gu.CAMERA_DEVICE_CHANGED,e=>{R.info("camera device changed",JSON.stringify(e)),er.onCameraChanged&&er.onCameraChanged(e),er.safeEmit(oc.CAMERA_CHANGED,e)}),Bs.on(Gu.RECORDING_DEVICE_CHANGED,e=>{R.info("microphone device changed",JSON.stringify(e)),er.onMicrophoneChanged&&er.onMicrophoneChanged(e),er.safeEmit(oc.MICROPHONE_CHANGED,e)}),Bs.on(Gu.PLAYOUT_DEVICE_CHANGED,e=>{R.debug("playout device changed",JSON.stringify(e)),er.onPlaybackDeviceChanged&&er.onPlaybackDeviceChanged(e),er.safeEmit(oc.PLAYBACK_DEVICE_CHANGED,e)}),pi.onAutoplayFailed=()=>{R.info("detect audio element autoplay failed"),ji.onAudioAutoplayFailed&&ji.onAudioAutoplayFailed()},en.on("autoplay-failed",()=>{R.info("detect webaudio autoplay failed"),ji.onAudioAutoplayFailed&&ji.onAudioAutoplayFailed(),er.safeEmit(oc.AUTOPLAY_FAILED)}),en.on(Mr.STATE_CHANGE,(e,t)=>{R.info("audio context state changed: ".concat(t," => ").concat(e)),er.onAudioContextStateChanged&&er.onAudioContextStateChanged(e,t),er.safeEmit(oc.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),Nn.on(Du.NETWORK_STATE_CHANGE,(e,t)=>{R.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=er),er})})(mq);var STe=mq.exports;const a8=sP(STe),TTe="53d0ab9bafc84881a74ff97d94cf81db",bTe=s=>{let r=0;for(let o=0;o<s.length;o++){const l=s.charCodeAt(o);r=(r<<5)-r+l,r=r&r}return Math.abs(r)%1e9},RTe=({roomId:s,oderId:r,username:o,onUserJoined:l,onUserLeft:u,onError:f})=>{const[E,T]=ce.useState(!1),[w,A]=ce.useState(!1),[U,M]=ce.useState(!0),[F,Y]=ce.useState(0),[J,ae]=ce.useState(new Map),[he,ee]=ce.useState(null),W=ce.useRef(null),Z=ce.useRef(null),fe=ce.useRef(null);ce.useEffect(()=>{const $=a8.createClient({mode:"rtc",codec:"vp8"});return W.current=$,$.on("user-published",async(le,ue)=>{var ie;ue==="audio"&&(await $.subscribe(le,ue),(ie=le.audioTrack)==null||ie.play(),ae(tt=>{const Ot=new Map(tt);return Ot.set(le.uid.toString(),{oderId:le.uid.toString(),isSpeaking:!1,isMuted:!1,audioLevel:0}),Ot}),l==null||l(le))}),$.on("user-unpublished",(le,ue)=>{ue==="audio"&&ae(ie=>{const tt=new Map(ie),Ot=tt.get(le.uid.toString());return Ot&&tt.set(le.uid.toString(),{...Ot,isMuted:!0,isSpeaking:!1}),tt})}),$.on("user-left",le=>{ae(ue=>{const ie=new Map(ue);return ie.delete(le.uid.toString()),ie}),u==null||u(le)}),$.on("exception",le=>{console.error("Agora exception:",le)}),()=>{W.current&&(W.current.removeAllListeners(),W.current.leave()),Z.current&&Z.current.close(),fe.current&&clearInterval(fe.current)}},[l,u]);const pe=ce.useCallback(()=>{fe.current&&clearInterval(fe.current),fe.current=setInterval(()=>{if(Z.current&&!U){const $=Z.current.getVolumeLevel();Y($)}else Y(0);if(W.current){const $=W.current.remoteUsers;ae(le=>{const ue=new Map(le);return $.forEach(ie=>{var on;const tt=((on=ie.audioTrack)==null?void 0:on.getVolumeLevel())||0,Ot=ue.get(ie.uid.toString());Ot&&ue.set(ie.uid.toString(),{...Ot,audioLevel:tt,isSpeaking:tt>.1})}),ue})}},100)},[U]),Ce=ce.useCallback(async()=>{if(!(!W.current||E||w)){A(!0),ee(null);try{const $=bTe(r);console.log("Joining with numeric UID:",$,"from oderId:",r),await W.current.join(TTe,s,null,$);const le=await a8.createMicrophoneAudioTrack();Z.current=le,le.setEnabled(!1),await W.current.publish([le]),T(!0),M(!0),pe(),console.log("Successfully joined voice channel:",s)}catch($){console.error("Error joining voice channel:",$),ee($.message||"Fehler beim Beitreten zum Voice Chat"),f==null||f($)}finally{A(!1)}}},[s,r,E,w,pe,f]),te=ce.useCallback(async()=>{if(W.current)try{fe.current&&(clearInterval(fe.current),fe.current=null),Z.current&&(Z.current.close(),Z.current=null),await W.current.leave(),T(!1),M(!0),Y(0),ae(new Map),console.log("Left voice channel")}catch($){console.error("Error leaving voice channel:",$)}},[]),q=ce.useCallback(async()=>{if(!Z.current)return;const $=!U;Z.current.setEnabled(!$),M($),console.log("Mute toggled:",$?"muted":"unmuted")},[U]),re=ce.useCallback(async $=>{Z.current&&(Z.current.setEnabled(!$),M($))},[]);return{isConnected:E,isConnecting:w,isMuted:U,localAudioLevel:F,remoteUsers:J,error:he,joinChannel:Ce,leaveChannel:te,toggleMute:q,setMuted:re}},wTe=()=>{const s=ou(),r=ei(),{user:o}=vi(),[l,u]=ce.useState([]),[f,E]=ce.useState([]),[T,w]=ce.useState(null),[A,U]=ce.useState(!0),[M,F]=ce.useState(0),[Y,J]=ce.useState(null),[ae,he]=ce.useState(!1),[ee,W]=ce.useState(!0),[Z,fe]=ce.useState(!1),[pe,Ce]=ce.useState("all"),[te,q]=ce.useState(""),[re,$]=ce.useState("public"),[le,ue]=ce.useState(!1),{isConnected:ie,isConnecting:tt,localAudioLevel:Ot,error:on,joinChannel:It,leaveChannel:Ge,toggleMute:nt}=RTe({roomId:(T==null?void 0:T.id)||"",oderId:(o==null?void 0:o.id)||"",username:(o==null?void 0:o.username)||"",onError:xe=>{console.error("Voice chat error:",xe)}});ce.useEffect(()=>{const xe=Zr(Qt,"rooms"),_t=gl(xe,Ln=>{const kt=[];Ln.docs.forEach(qt=>{var ki;const Rt=qt.data();Rt.isActive!==!1&&kt.push({id:qt.id,name:Rt.name,type:Rt.type||"public",isAnonymous:Rt.isAnonymous||!1,participants:(Rt.participants||[]).map(di=>{var fs;return{id:di.oderId||di.id,oderId:di.oderId||di.id,username:di.username||"unknown",displayName:di.displayName||"Unbekannt",isSpeaking:di.isSpeaking||!1,isMuted:di.isMuted||!1,isAnonymous:di.isAnonymous||!1,level:di.level||1,joinedAt:((fs=di.joinedAt)==null?void 0:fs.toDate())||new Date}}),maxParticipants:Rt.maxParticipants||8,xpMultiplier:Rt.xpMultiplier||1,regionName:Rt.regionName,createdAt:((ki=Rt.createdAt)==null?void 0:ki.toDate())||new Date,createdBy:Rt.createdBy})}),kt.sort((qt,Rt)=>Rt.createdAt.getTime()-qt.createdAt.getTime()),u(kt),W(!1)},Ln=>{console.error("Error fetching rooms:",Ln),W(!1)});return()=>_t()},[]),ce.useEffect(()=>{const xe=Zr(Qt,"starEvents"),_t=gl(xe,Ln=>{const kt=[];Ln.docs.forEach(qt=>{var ki,di,fs;const Rt=qt.data();Rt.isActive!==!1&&kt.push({id:qt.id,hostId:Rt.hostId,hostUsername:Rt.hostUsername,hostDisplayName:Rt.hostDisplayName,hostTier:Rt.hostTier||"nova",title:Rt.title,description:Rt.description,category:Rt.category||"general",startedAt:(ki=Rt.startedAt)==null?void 0:ki.toDate(),scheduledAt:(di=Rt.scheduledAt)==null?void 0:di.toDate(),endedAt:(fs=Rt.endedAt)==null?void 0:fs.toDate(),maxCapacity:Rt.maxCapacity||100,currentListeners:Rt.currentListeners||0,peakListeners:Rt.peakListeners||0,stageParticipants:Rt.stageParticipants||[],handRaiseQueue:Rt.handRaiseQueue||[],starsReceived:Rt.starsReceived||0,chatMessages:Rt.chatMessages||0,isPublic:Rt.isPublic!==!1,isRecording:Rt.isRecording||!1,isPinned:Rt.isPinned||!1,xpMultiplier:Rt.xpMultiplier||2})}),kt.sort((qt,Rt)=>{var fs,Tr;const ki=((fs=qt.startedAt)==null?void 0:fs.getTime())||0;return(((Tr=Rt.startedAt)==null?void 0:Tr.getTime())||0)-ki}),E(kt)},Ln=>{console.error("Error fetching star events:",Ln)});return()=>_t()},[]),ce.useEffect(()=>{if(!T)return;const xe=Dr(Qt,"rooms",T.id),_t=gl(xe,Ln=>{var kt;if(Ln.exists()){const qt=Ln.data();if(!qt.isActive){w(null),U(!0),F(0);return}w({id:Ln.id,name:qt.name,type:qt.type||"public",isAnonymous:qt.isAnonymous||!1,participants:(qt.participants||[]).map(Rt=>{var ki;return{id:Rt.oderId||Rt.id,oderId:Rt.oderId||Rt.id,username:Rt.username||"unknown",displayName:Rt.displayName||"Unbekannt",isSpeaking:Rt.isSpeaking||!1,isMuted:Rt.isMuted||!1,isAnonymous:Rt.isAnonymous||!1,level:Rt.level||1,joinedAt:((ki=Rt.joinedAt)==null?void 0:ki.toDate())||new Date}}),maxParticipants:qt.maxParticipants||8,xpMultiplier:qt.xpMultiplier||1,regionName:qt.regionName,createdAt:((kt=qt.createdAt)==null?void 0:kt.toDate())||new Date,createdBy:qt.createdBy})}else w(null),U(!0),F(0)});return()=>_t()},[T==null?void 0:T.id]),ce.useEffect(()=>{const xe=s.state;(xe==null?void 0:xe.filter)==="stars"&&(Ce("stars"),window.history.replaceState({},document.title))},[s.state]),ce.useEffect(()=>{const xe=s.state;if(xe!=null&&xe.joinRoom){const _t=l.filter(Ln=>Ln.participants.length<Ln.maxParticipants);if(_t.length>0){const Ln=_t[Math.floor(Math.random()*_t.length)];pt(Ln,xe.mode==="anonymous")}window.history.replaceState({},document.title)}},[s.state,l]),ce.useEffect(()=>{if(M>0){const xe=setTimeout(()=>{F(M-1),M===1&&(U(!1),"vibrate"in navigator&&navigator.vibrate([50,30,50]))},1e3);return()=>clearTimeout(xe)}},[M]);const pt=async(xe,_t=!1)=>{if(!(o!=null&&o.id))return;if(xe.participants.some(qt=>qt.oderId===o.id)){w(xe),U(!0);return}const kt={oderId:o.id,username:o.username||"unknown",displayName:_t?"Wanderer":o.displayName||"Unbekannt",isSpeaking:!1,isMuted:!0,isAnonymous:_t||xe.isAnonymous,level:o.level||1,joinedAt:Wn.now()};try{const qt=Dr(Qt,"rooms",xe.id);await fo(qt,{participants:Iye(kt)}),w(xe),U(!0),F(4),"vibrate"in navigator&&navigator.vibrate([20,10,20])}catch(qt){console.error("Error joining room:",qt)}};ce.useEffect(()=>{T&&(o!=null&&o.id)&&!ie&&!tt&&It()},[T==null?void 0:T.id,o==null?void 0:o.id]);const ot=async()=>{if(await Ge(),!T||!(o!=null&&o.id)){w(null),U(!0),F(0);return}try{const xe=Dr(Qt,"rooms",T.id);if(T.participants.find(Ln=>Ln.oderId===o.id)){const Ln=T.participants.filter(kt=>kt.oderId!==o.id);await fo(xe,{participants:Ln.map(kt=>({oderId:kt.oderId,username:kt.username,displayName:kt.displayName,isSpeaking:kt.isSpeaking,isMuted:kt.isMuted,isAnonymous:kt.isAnonymous,level:kt.level,joinedAt:Wn.fromDate(kt.joinedAt)}))})}}catch(xe){console.error("Error leaving room:",xe)}w(null),U(!0),F(0)},[Et,un]=ce.useState(!1),[In,zn]=ce.useState(null),Sr=async()=>{if(!te.trim()||!(o!=null&&o.id)){zn("Bitte gib einen Raumnamen ein");return}un(!0),zn(null);try{const xe={name:te.trim(),type:re,isAnonymous:le,participants:[],maxParticipants:8,xpMultiplier:1,isActive:!0,createdAt:Wn.now(),createdBy:o.id};console.log("Creating room with data:",xe);const _t=await UE(Zr(Qt,"rooms"),xe);console.log("Room created with ID:",_t.id),he(!1),q(""),$("public"),ue(!1)}catch(xe){console.error("Error creating room:",xe),zn(xe.message||"Fehler beim Erstellen des Raums")}finally{un(!1)}},Je=async()=>{if(M>0||!T||!(o!=null&&o.id))return;await nt();const xe=!A;U(xe);try{const _t=Dr(Qt,"rooms",T.id),Ln=T.participants.map(kt=>kt.oderId===o.id?{...kt,isMuted:xe,isSpeaking:!xe,joinedAt:Wn.fromDate(kt.joinedAt)}:{...kt,joinedAt:Wn.fromDate(kt.joinedAt)});await fo(_t,{participants:Ln})}catch(_t){console.error("Error updating mute status:",_t)}},Kt=xe=>{console.log("Vote to remove:",xe),J(null)},lr=async()=>{if(!(o!=null&&o.id))return;const xe=[{name:"Caf-Ecke",type:"public",isAnonymous:!1,xpMultiplier:1},{name:"Nachteulen-Treff",type:"public",isAnonymous:!1,xpMultiplier:1.5},{name:"Anonyme Wanderer",type:"public",isAnonymous:!0,xpMultiplier:1},{name:"Gaming-Lounge",type:"public",isAnonymous:!1,xpMultiplier:2}];un(!0);try{for(const _t of xe)await UE(Zr(Qt,"rooms"),{..._t,participants:[],maxParticipants:8,isActive:!0,createdAt:Wn.now(),createdBy:o.id}),console.log(`Created test room: ${_t.name}`)}catch(_t){console.error("Error seeding rooms:",_t),zn("Fehler beim Erstellen der Test-Rume")}finally{un(!1)}},Qn=async()=>{fe(!0),await new Promise(xe=>setTimeout(xe,1e3)),fe(!1)},ms=l.filter(xe=>pe==="all"||pe==="stars"?!0:pe==="public"?xe.type==="public"&&!xe.isAnonymous:pe==="anonymous"?xe.isAnonymous:pe==="regional"?xe.type==="regional":!0),it=xe=>{const _t=Math.floor((Date.now()-xe.getTime())/6e4);return _t<60?`${_t}m`:`${Math.floor(_t/60)}h ${_t%60}m`},$n=f.filter(xe=>xe.startedAt&&!xe.endedAt),$s=l.reduce((xe,_t)=>xe+_t.participants.length,0);return ee?p.jsx("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white flex items-center justify-center",children:p.jsxs("div",{className:"text-center",children:[p.jsx(ws,{size:32,className:"animate-spin text-delulu-violet mx-auto mb-4"}),p.jsx("p",{className:"text-delulu-muted text-sm",children:"Lade Rume..."})]})}):p.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white safe-top pb-24",children:[T?p.jsxs("div",{className:"px-6 pt-6",children:[p.jsxs("div",{className:"flex items-center justify-between mb-6",children:[p.jsxs("div",{children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("h1",{className:"font-display text-xl font-bold text-delulu-text",children:T.name}),T.isAnonymous&&p.jsx("span",{className:"px-2 py-0.5 bg-purple-100 text-purple-600 text-[10px] font-bold rounded-full",children:"ANONYM"}),T.xpMultiplier>1&&p.jsxs("span",{className:"px-2 py-0.5 bg-amber-100 text-amber-600 text-[10px] font-bold rounded-full flex items-center gap-1",children:[p.jsx(hl,{size:10})," ",T.xpMultiplier,"x XP"]})]}),p.jsxs("p",{className:"text-sm text-delulu-muted",children:[T.participants.length," / ",T.maxParticipants," Teilnehmer"]})]}),p.jsx("button",{onClick:ot,className:"px-4 py-2 bg-red-100 text-red-600 rounded-xl font-semibold text-sm hover:bg-red-200 transition-colors",children:"Verlassen"})]}),M>0&&p.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-2xl p-4 mb-6 flex items-center gap-4",children:[p.jsx("div",{className:"w-12 h-12 rounded-xl bg-amber-100 flex items-center justify-center",children:p.jsx(Th,{size:24,className:"text-amber-600"})}),p.jsxs("div",{className:"flex-1",children:[p.jsx("p",{className:"font-semibold text-amber-800",children:"Bitte erst zuhren"}),p.jsxs("p",{className:"text-sm text-amber-600",children:["Du kannst in ",M," Sekunden sprechen"]})]}),p.jsx("div",{className:"w-12 h-12 rounded-full bg-amber-500 flex items-center justify-center text-white font-bold text-xl",children:M})]}),T.participants.length===0?p.jsxs("div",{className:"text-center py-12",children:[p.jsx("div",{className:"w-20 h-20 mx-auto rounded-2xl bg-gray-100 flex items-center justify-center mb-4",children:p.jsx(ai,{size:32,className:"text-gray-400"})}),p.jsx("h3",{className:"font-semibold text-delulu-text mb-2",children:"Raum ist leer"}),p.jsx("p",{className:"text-sm text-delulu-muted",children:"Du bist der Erste! Warte auf andere oder teile den Raum."})]}):p.jsx("div",{className:"grid grid-cols-2 gap-4 mb-6",children:T.participants.map(xe=>{const _t=!xe.isAnonymous&&!T.isAnonymous&&xe.oderId!==(o==null?void 0:o.id);return p.jsxs("div",{onClick:()=>{_t&&r(`/user/${xe.oderId}`)},className:`bg-white rounded-2xl p-4 shadow-sm relative ${xe.isSpeaking?"ring-2 ring-green-400 ring-offset-2":""} ${_t?"cursor-pointer hover:shadow-md active:scale-[0.98] transition-all":""}`,children:[xe.isSpeaking&&p.jsx("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center",children:p.jsx(ok,{size:12,className:"text-white"})}),_t&&p.jsx("div",{className:"absolute top-2 right-2",children:p.jsx(Ih,{size:12,className:"text-delulu-violet"})}),p.jsx("div",{className:`w-16 h-16 mx-auto rounded-full flex items-center justify-center mb-3 ${xe.isAnonymous?"bg-purple-100":"bg-delulu-violet/10"} ${xe.isSpeaking?"animate-pulse":""}`,children:xe.isAnonymous?p.jsx(_l,{size:24,className:"text-purple-500"}):p.jsx("span",{className:"text-2xl",children:""})}),p.jsx("p",{className:"font-semibold text-sm text-center text-delulu-text truncate",children:xe.isAnonymous?"Wanderer":xe.displayName}),p.jsxs("p",{className:"text-[10px] text-center text-delulu-muted",children:["Level ",xe.level]}),_t&&p.jsx("p",{className:"text-[10px] text-center text-delulu-violet mt-1 font-medium",children:"Profil ansehen "}),xe.isMuted&&p.jsx("div",{className:"absolute bottom-2 right-2",children:p.jsx(aTe,{size:14,className:"text-red-400"})}),xe.oderId!==(o==null?void 0:o.id)&&p.jsx("button",{onClick:Ln=>{Ln.stopPropagation(),J(xe.id)},className:"absolute top-2 left-2 w-6 h-6 rounded-full bg-gray-100 flex items-center justify-center text-gray-400 hover:bg-red-100 hover:text-red-500 transition-colors",children:p.jsx(n8,{size:12})})]},xe.id)})}),p.jsxs("div",{className:"fixed bottom-24 left-0 right-0 px-6",children:[on&&p.jsx("div",{className:"mb-2 p-2 bg-red-50 border border-red-200 rounded-xl text-center",children:p.jsx("p",{className:"text-xs text-red-600",children:on})}),p.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-lg",children:[p.jsx("div",{className:"flex items-center justify-center gap-2 mb-3",children:tt?p.jsxs(p.Fragment,{children:[p.jsx(ws,{size:14,className:"animate-spin text-amber-500"}),p.jsx("span",{className:"text-xs text-amber-600",children:"Verbinde..."})]}):ie?p.jsxs(p.Fragment,{children:[p.jsx(uq,{size:14,className:"text-green-500"}),p.jsx("span",{className:"text-xs text-green-600",children:"Voice verbunden"})]}):p.jsxs(p.Fragment,{children:[p.jsx(dq,{size:14,className:"text-gray-400"}),p.jsx("span",{className:"text-xs text-gray-500",children:"Voice nicht verbunden"})]})}),ie&&!A&&p.jsx("div",{className:"h-1 bg-gray-200 rounded-full mb-3 overflow-hidden",children:p.jsx("div",{className:"h-full bg-green-500 rounded-full transition-all duration-100",style:{width:`${Math.min(100,Ot*200)}%`}})}),p.jsxs("div",{className:"flex items-center justify-center gap-4",children:[p.jsx("button",{onClick:Je,disabled:M>0||!ie,className:`w-16 h-16 rounded-full flex items-center justify-center transition-all ${A||M>0?"bg-red-500 text-white":"bg-green-500 text-white scale-110"} disabled:opacity-50`,children:A||M>0?p.jsx(XSe,{size:28}):p.jsx(Cl,{size:28})}),p.jsxs("div",{className:"text-center",children:[p.jsx("p",{className:"font-semibold text-delulu-text",children:M>0?"Warte...":A?"Stumm":"Sprechen"}),p.jsx("p",{className:"text-xs text-delulu-muted",children:M>0?`${M}s`:ie?"Tippe zum Umschalten":"Warte auf Verbindung..."})]})]})]})]})]}):p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"px-6 pt-6 pb-4",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("h1",{className:"font-display text-2xl font-bold text-delulu-text",children:"Entdecken"}),p.jsx("p",{className:"text-sm text-delulu-muted",children:$s>0?`${$s} User in ${l.length} Rumen`:"Noch keine aktiven Rume"})]}),p.jsxs("div",{className:"flex gap-2",children:[p.jsx("button",{onClick:()=>he(!0),className:"w-10 h-10 rounded-xl bg-delulu-violet text-white shadow-sm flex items-center justify-center hover:bg-delulu-violet/90 transition-colors",children:p.jsx(Cb,{size:20})}),p.jsx("button",{onClick:Qn,disabled:Z,className:"w-10 h-10 rounded-xl bg-white shadow-sm flex items-center justify-center text-delulu-muted hover:text-delulu-violet transition-colors",children:p.jsx(ZSe,{size:20,className:Z?"animate-spin":""})})]})]})}),p.jsx("div",{className:"px-6 mb-4",children:p.jsx("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide pb-2",children:[{id:"all",label:"Alle",icon:ai},{id:"stars",label:"Stars",icon:ci,special:!0},{id:"public",label:"ffentlich",icon:jE},{id:"anonymous",label:"Anonym",icon:_l},{id:"regional",label:"Regional",icon:TR}].map(xe=>p.jsxs("button",{onClick:()=>Ce(xe.id),className:`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-semibold whitespace-nowrap transition-all ${pe===xe.id?xe.special?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-delulu-violet text-white shadow-lg":xe.special?"bg-purple-50 text-purple-600 hover:bg-purple-100":"bg-white text-delulu-muted hover:bg-gray-50"}`,children:[p.jsx(xe.icon,{size:16}),xe.label,xe.special&&$n.length>0&&p.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse"})]},xe.id))})}),(pe==="all"||pe==="stars")&&f.length>0&&p.jsxs("div",{className:"px-6 mb-6",children:[pe==="all"&&p.jsxs("div",{className:"flex items-center justify-between mb-3",children:[p.jsxs("h2",{className:"font-semibold text-delulu-text flex items-center gap-2",children:[p.jsx(ci,{size:18,className:"text-purple-500"}),"Star Events"]}),p.jsx("button",{onClick:()=>Ce("stars"),className:"text-sm text-purple-500 font-medium",children:"Alle anzeigen"})]}),p.jsx("div",{className:"space-y-4",children:f.map(xe=>{const _t=!!xe.startedAt&&!xe.endedAt,Ln=!!xe.scheduledAt&&!xe.startedAt;return p.jsx("div",{className:"relative",children:p.jsx(ETe,{tier:xe.hostTier,intensity:"normal",children:p.jsxs("div",{className:"bg-gradient-to-br from-gray-900/95 to-gray-800/95 rounded-2xl p-4 border border-purple-500/30",children:[p.jsxs("div",{className:"flex items-center justify-between mb-3",children:[_t?p.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-red-500/20 rounded-full",children:[p.jsxs("div",{className:"relative",children:[p.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-ping absolute"}),p.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full relative"})]}),p.jsx("span",{className:"text-[10px] font-bold text-red-400",children:"LIVE"})]}):Ln?p.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-blue-500/20 rounded-full",children:[p.jsx(Th,{size:12,className:"text-blue-400"}),p.jsx("span",{className:"text-[10px] font-bold text-blue-400",children:new Date(xe.scheduledAt).toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})})]}):null,xe.xpMultiplier>1&&p.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-amber-500/20 rounded-full",children:[p.jsx(hl,{size:12,className:"text-amber-400"}),p.jsxs("span",{className:"text-[10px] font-bold text-amber-400",children:[xe.xpMultiplier,"x XP"]})]})]}),p.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[p.jsxs("div",{className:"relative",children:[p.jsx("div",{className:"w-14 h-14 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 border-2",style:{borderColor:xe.hostTier==="galaxy"?"#EC4899":"#F59E0B",boxShadow:`0 0 20px ${xe.hostTier==="galaxy"?"rgba(236, 72, 153, 0.5)":"rgba(245, 158, 11, 0.5)"}`}}),p.jsx("div",{className:"absolute -bottom-1 -right-1",children:p.jsx(vf,{tier:xe.hostTier,size:"md"})})]}),p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsx("div",{className:"flex items-center gap-2",children:p.jsxs("h3",{className:"font-bold text-white",children:["@",xe.hostUsername]})}),p.jsx("p",{className:"text-sm text-gray-400",children:xe.hostDisplayName})]})]}),p.jsx("h4",{className:"font-semibold text-white mb-2",children:xe.title}),p.jsx("p",{className:"text-sm text-gray-400 mb-3",children:xe.description}),_t&&p.jsxs("div",{className:"flex items-center gap-4 mb-4 text-xs text-gray-500",children:[p.jsxs("span",{className:"flex items-center gap-1",children:[p.jsx(ai,{size:14}),xe.currentListeners.toLocaleString()," zuhren"]}),p.jsxs("span",{className:"flex items-center gap-1 text-amber-400",children:[p.jsx(ul,{size:14}),xe.starsReceived," Sterne"]}),xe.handRaiseQueue.length>0&&p.jsxs("span",{className:"flex items-center gap-1 text-purple-400",children:[p.jsx(aq,{size:14}),xe.handRaiseQueue.length," warten"]})]}),p.jsx("button",{onClick:()=>console.log("Join star event:",xe.id),className:`w-full py-3 rounded-xl font-semibold flex items-center justify-center gap-2 transition-all ${_t?"bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:opacity-90":"bg-gray-700 text-gray-300"}`,children:_t?p.jsxs(p.Fragment,{children:[p.jsx(Cl,{size:18}),"Jetzt reinhren"]}):p.jsxs(p.Fragment,{children:[p.jsx(Th,{size:18}),"Erinnerung setzen"]})})]})})},xe.id)})})]}),pe==="stars"&&f.length===0&&p.jsx("div",{className:"px-6 py-12",children:p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"w-20 h-20 mx-auto rounded-2xl bg-purple-50 flex items-center justify-center mb-4",children:p.jsx(ci,{size:32,className:"text-purple-400"})}),p.jsx("h3",{className:"font-semibold text-delulu-text mb-2",children:"Keine Star Events"}),p.jsx("p",{className:"text-sm text-delulu-muted max-w-xs mx-auto",children:"Aktuell sind keine Star Events live oder geplant. Schau spter nochmal vorbei!"})]})}),pe!=="stars"&&l.length>0&&p.jsx("div",{className:"px-6 mb-4",children:p.jsx("div",{className:"bg-gradient-to-r from-amber-400 to-orange-500 rounded-2xl p-4 text-white",children:p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:"w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center",children:p.jsx(hl,{size:24})}),p.jsxs("div",{className:"flex-1",children:[p.jsx("p",{className:"font-semibold",children:"Regional-Bonus aktiv!"}),p.jsx("p",{className:"text-sm text-white/80",children:"Bis zu 3x XP in bestimmten Zonen - geh raus und entdecke!"})]})]})})}),pe!=="stars"&&p.jsx("div",{className:"px-6 space-y-4",children:l.length===0?p.jsxs("div",{className:"text-center py-16",children:[p.jsx("div",{className:"w-24 h-24 mx-auto rounded-3xl bg-gradient-to-br from-delulu-soft to-white flex items-center justify-center mb-6 shadow-inner",children:p.jsx(sk,{size:40,className:"text-delulu-muted"})}),p.jsx("h3",{className:"font-display font-bold text-xl text-delulu-text mb-3",children:ak.empty.lounges}),p.jsx("p",{className:"text-sm text-delulu-muted mb-8 max-w-xs mx-auto leading-relaxed",children:"Sei der Erste und erstelle einen Raum, in dem sich deine Nachbarschaft treffen kann."}),p.jsxs("div",{className:"flex flex-col gap-3 items-center",children:[p.jsxs("button",{onClick:()=>he(!0),className:"inline-flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-delulu-violet to-purple-600 text-white rounded-2xl font-display font-bold shadow-lg hover:shadow-xl transition-all",children:[p.jsx(Cb,{size:20}),"Raum erstellen"]}),p.jsx("button",{onClick:lr,disabled:Et,className:"inline-flex items-center gap-2 px-6 py-3 bg-gray-100 text-gray-600 rounded-xl font-medium hover:bg-gray-200 transition-all disabled:opacity-50",children:Et?p.jsxs(p.Fragment,{children:[p.jsx(ws,{size:16,className:"animate-spin"}),"Erstelle..."]}):p.jsxs(p.Fragment,{children:[p.jsx(ci,{size:16}),"Test-Rume erstellen"]})})]})]}):ms.length===0?p.jsxs("div",{className:"text-center py-12",children:[p.jsx(ai,{size:48,className:"mx-auto text-gray-300 mb-4"}),p.jsx("p",{className:"font-semibold text-delulu-text mb-2",children:"Keine Rume gefunden"}),p.jsx("p",{className:"text-sm text-delulu-muted mb-4",children:"ndere den Filter oder erstelle einen neuen Raum"}),p.jsx("button",{onClick:()=>Ce("all"),className:"px-6 py-3 bg-delulu-violet text-white rounded-xl font-semibold",children:"Alle Rume anzeigen"})]}):ms.map(xe=>p.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm hover:shadow-md transition-shadow",children:[p.jsxs("div",{className:"flex items-start justify-between mb-3",children:[p.jsxs("div",{children:[p.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[p.jsx("h3",{className:"font-semibold text-delulu-text",children:xe.name}),xe.isAnonymous&&p.jsx(tu,{size:14,className:"text-purple-500"})]}),p.jsxs("div",{className:"flex items-center gap-3 text-xs text-delulu-muted",children:[p.jsxs("span",{className:"flex items-center gap-1",children:[p.jsx(ai,{size:12}),xe.participants.length,"/",xe.maxParticipants]}),p.jsxs("span",{className:"flex items-center gap-1",children:[p.jsx(Th,{size:12}),it(xe.createdAt)]})]})]}),xe.xpMultiplier>1&&p.jsxs("div",{className:"px-2 py-1 bg-amber-100 text-amber-600 rounded-lg text-xs font-bold flex items-center gap-1",children:[p.jsx(hl,{size:12}),xe.xpMultiplier,"x XP"]})]}),p.jsx("div",{className:"flex items-center gap-2 mb-4",children:xe.participants.length>0?p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"flex -space-x-2",children:[xe.participants.slice(0,4).map(_t=>p.jsx("div",{className:`w-8 h-8 rounded-full border-2 border-white flex items-center justify-center text-xs ${_t.isAnonymous?"bg-purple-100 text-purple-600":"bg-delulu-violet/10 text-delulu-violet"} ${_t.isSpeaking?"ring-2 ring-green-400":""}`,children:_t.isAnonymous?"?":_t.displayName[0]},_t.id)),xe.participants.length>4&&p.jsxs("div",{className:"w-8 h-8 rounded-full border-2 border-white bg-gray-100 flex items-center justify-center text-xs text-gray-500",children:["+",xe.participants.length-4]})]}),xe.participants.some(_t=>_t.isSpeaking)&&p.jsxs("div",{className:"flex items-center gap-1 text-green-600 text-xs",children:[p.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),p.jsx("span",{children:"Aktiv"})]})]}):p.jsx("p",{className:"text-xs text-delulu-muted italic",children:"Noch keine Teilnehmer"})}),p.jsxs("button",{onClick:()=>pt(xe,xe.isAnonymous),disabled:xe.participants.length>=xe.maxParticipants,className:"w-full py-3 rounded-xl bg-delulu-violet text-white font-semibold hover:bg-delulu-violet/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[p.jsx(Ih,{size:18}),xe.isAnonymous?"Anonym beitreten":"Beitreten"]})]},xe.id))})]}),ae&&p.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-6 bg-black/60 backdrop-blur-sm",children:p.jsxs("div",{className:"w-full max-w-sm bg-white rounded-3xl p-6 shadow-2xl",children:[p.jsx("h2",{className:"font-display text-xl font-bold text-delulu-text mb-6 text-center",children:"Raum erstellen"}),p.jsxs("div",{className:"space-y-4 mb-6",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-delulu-text mb-2",children:"Raumname"}),p.jsx("input",{type:"text",value:te,onChange:xe=>q(xe.target.value),placeholder:"z.B. Caf-Ecke",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-delulu-violet/30",maxLength:30})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-delulu-text mb-2",children:"Raumtyp"}),p.jsxs("div",{className:"flex gap-2",children:[p.jsxs("button",{onClick:()=>$("public"),className:`flex-1 py-3 rounded-xl font-semibold flex items-center justify-center gap-2 ${re==="public"?"bg-delulu-violet text-white":"bg-gray-100 text-gray-600"}`,children:[p.jsx(jE,{size:18}),"ffentlich"]}),p.jsxs("button",{onClick:()=>$("private"),className:`flex-1 py-3 rounded-xl font-semibold flex items-center justify-center gap-2 ${re==="private"?"bg-delulu-violet text-white":"bg-gray-100 text-gray-600"}`,children:[p.jsx(tu,{size:18}),"Privat"]})]})]}),p.jsxs("label",{className:"flex items-center gap-3 p-4 bg-purple-50 rounded-xl cursor-pointer",children:[p.jsx("input",{type:"checkbox",checked:le,onChange:xe=>ue(xe.target.checked),className:"w-5 h-5 rounded text-purple-500"}),p.jsxs("div",{children:[p.jsxs("p",{className:"font-medium text-delulu-text flex items-center gap-2",children:[p.jsx(_l,{size:16,className:"text-purple-500"}),"Anonymer Raum"]}),p.jsx("p",{className:"text-xs text-delulu-muted",children:'Alle Teilnehmer werden als "Wanderer" angezeigt'})]})]})]}),In&&p.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-xl",children:p.jsx("p",{className:"text-sm text-red-600",children:In})}),p.jsxs("div",{className:"flex gap-3",children:[p.jsx("button",{onClick:()=>{he(!1),zn(null)},disabled:Et,className:"flex-1 py-3 px-4 bg-gray-100 text-gray-600 rounded-xl font-semibold disabled:opacity-50",children:"Abbrechen"}),p.jsx("button",{onClick:Sr,disabled:!te.trim()||Et,className:"flex-1 py-3 px-4 bg-delulu-violet text-white rounded-xl font-semibold disabled:opacity-50 flex items-center justify-center gap-2",children:Et?p.jsxs(p.Fragment,{children:[p.jsx(ws,{size:18,className:"animate-spin"}),"Erstelle..."]}):"Erstellen"})]})]})}),Y&&p.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-6 bg-black/60 backdrop-blur-sm",children:p.jsxs("div",{className:"w-full max-w-sm bg-white rounded-3xl p-6 shadow-2xl",children:[p.jsxs("div",{className:"text-center mb-6",children:[p.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:p.jsx(ik,{size:32,className:"text-red-600"})}),p.jsx("h2",{className:"font-display text-xl font-bold text-delulu-text mb-2",children:"User melden?"}),p.jsx("p",{className:"text-sm text-delulu-muted",children:"Bei mehreren Meldungen wird der User aus dem Raum entfernt. Missbrauch dieser Funktion wird geahndet."})]}),p.jsxs("div",{className:"flex gap-3",children:[p.jsx("button",{onClick:()=>J(null),className:"flex-1 py-3 px-4 bg-gray-100 text-gray-600 rounded-xl font-semibold",children:"Abbrechen"}),p.jsxs("button",{onClick:()=>Kt(Y),className:"flex-1 py-3 px-4 bg-red-500 text-white rounded-xl font-semibold flex items-center justify-center gap-2",children:[p.jsx(n8,{size:18}),"Melden"]})]})]})})]})},CTe=()=>{const s=ei(),{user:r}=vi(),[o,l]=ce.useState("all"),[u,f]=ce.useState(""),[E,T]=ce.useState(!0),[w,A]=ce.useState([]),[U,M]=ce.useState(!0);ce.useEffect(()=>{if(!(r!=null&&r.id)){M(!1);return}const W=Zr(Qt,"conversations"),Z=qo(W,ds("participants","array-contains",r.id),G7("lastMessageAt","desc")),fe=gl(Z,async pe=>{var te,q,re,$;const Ce=[];for(const le of pe.docs){const ue=le.data(),ie=ue.participants.find(tt=>tt!==r.id);if(ie)try{const tt=await ef(Dr(Qt,"users",ie));if(!tt.exists())continue;const Ot=tt.data(),on=await ef(Dr(Qt,"friendships",`${r.id}_${ie}`)),It=await ef(Dr(Qt,"friendships",`${ie}_${r.id}`)),Ge=on.exists()||It.exists(),nt=((te=ue.unreadBy)==null?void 0:te[r.id])||0;Ce.push({id:le.id,oderId:ie,username:Ot.username||"unknown",displayName:Ot.displayName||Ot.username||"Unbekannt",avatarUrl:Ot.avatarUrl,isFriend:Ge,metAt:(q=ue.metAt)==null?void 0:q.toDate(),lastMessage:ue.lastMessage?{content:ue.lastMessage.content,createdAt:((re=ue.lastMessage.createdAt)==null?void 0:re.toDate())||new Date,isFromMe:ue.lastMessage.senderId===r.id}:void 0,unreadCount:nt,isOnline:Ot.isActive&&(($=Ot.lastSeen)==null?void 0:$.toDate())>new Date(Date.now()-5*60*1e3),level:Ot.level||1})}catch(tt){console.error("Error fetching user data:",tt)}}A(Ce),M(!1)},pe=>{console.error("Error fetching conversations:",pe),M(!1)});return()=>fe()},[r==null?void 0:r.id]);const Y=[...w.filter(W=>{if(u){const Z=u.toLowerCase();if(!W.username.toLowerCase().includes(Z)&&!W.displayName.toLowerCase().includes(Z))return!1}return o==="friends"?W.isFriend:o==="met"?!W.isFriend&&W.metAt:!0})].sort((W,Z)=>{var Ce,te;if(W.unreadCount!==Z.unreadCount)return Z.unreadCount-W.unreadCount;const fe=((Ce=W.lastMessage)==null?void 0:Ce.createdAt.getTime())||0;return(((te=Z.lastMessage)==null?void 0:te.createdAt.getTime())||0)-fe}),J=w.filter(W=>W.isFriend).length,ae=w.filter(W=>!W.isFriend&&W.metAt).length,he=w.reduce((W,Z)=>W+Z.unreadCount,0),ee=W=>{const fe=new Date().getTime()-W.getTime(),pe=Math.floor(fe/(1e3*60*60*24));return pe===0?W.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"}):pe===1?"Gestern":pe<7?W.toLocaleDateString("de-DE",{weekday:"short"}):W.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit"})};return U?p.jsx("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white flex items-center justify-center",children:p.jsxs("div",{className:"text-center",children:[p.jsx(ws,{size:32,className:"animate-spin text-delulu-violet mx-auto mb-4"}),p.jsx("p",{className:"text-delulu-muted text-sm",children:"Lade Nachrichten..."})]})}):p.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white safe-top pb-24",children:[p.jsxs("div",{className:"px-6 pt-6 pb-4",children:[p.jsx("div",{className:"flex items-center justify-between mb-4",children:p.jsxs("div",{children:[p.jsx("h1",{className:"font-display text-2xl font-bold text-delulu-text",children:"Nachrichten"}),p.jsx("p",{className:"text-sm text-delulu-muted",children:he>0?`${he} ungelesen`:"Keine neuen Nachrichten"})]})}),w.length>0&&p.jsxs("div",{className:"relative mb-4",children:[p.jsx(iP,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-delulu-muted"}),p.jsx("input",{type:"text",value:u,onChange:W=>f(W.target.value),placeholder:"Suche nach Kontakten...",className:"w-full pl-11 pr-4 py-3 bg-white rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-delulu-violet/30 shadow-sm"})]}),w.length>0&&p.jsx("div",{className:"flex gap-2",children:[{id:"all",label:"Alle",count:w.length},{id:"friends",label:"Freunde",count:J,icon:r8},{id:"met",label:"Getroffen",count:ae,icon:ai}].map(W=>p.jsxs("button",{onClick:()=>l(W.id),className:`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-semibold transition-all ${o===W.id?"bg-delulu-violet text-white shadow-lg":"bg-white text-delulu-muted hover:bg-gray-50"}`,children:[W.icon&&p.jsx(W.icon,{size:16}),W.label,p.jsx("span",{className:`px-1.5 py-0.5 rounded-full text-[10px] ${o===W.id?"bg-white/20":"bg-gray-100"}`,children:W.count})]},W.id))})]}),E&&w.length>0&&p.jsx("div",{className:"px-6 mb-4",children:p.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-2xl p-4 flex items-start gap-3",children:[p.jsx(Va,{size:20,className:"text-blue-500 flex-shrink-0 mt-0.5"}),p.jsxs("div",{className:"flex-1",children:[p.jsx("p",{className:"text-sm text-blue-800 font-medium",children:"Privatsphre geschtzt"}),p.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Du kannst nur mit Freunden oder Usern chatten, die du bereits in der App getroffen hast."})]}),p.jsx("button",{onClick:()=>T(!1),className:"text-blue-400 hover:text-blue-600",children:""})]})}),p.jsx("div",{className:"px-6",children:w.length===0?p.jsxs("div",{className:"text-center py-16",children:[p.jsx("div",{className:"w-24 h-24 mx-auto rounded-3xl bg-gradient-to-br from-delulu-soft to-white flex items-center justify-center mb-6 shadow-inner",children:p.jsx(Kh,{size:40,className:"text-delulu-muted"})}),p.jsx("h3",{className:"font-display font-bold text-xl text-delulu-text mb-3",children:ak.empty.messages}),p.jsx("p",{className:"text-sm text-delulu-muted mb-8 max-w-xs mx-auto leading-relaxed",children:"Triff Leute in Voice-Rumen oder fge Freunde hinzu, um Gesprche zu starten. Jede Begegnung kann der Anfang von etwas Groem sein."}),p.jsxs("button",{onClick:()=>s("/discover"),className:"inline-flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-delulu-violet to-purple-600 text-white rounded-2xl font-display font-bold shadow-lg hover:shadow-xl transition-all",children:[p.jsx(sk,{size:20}),"Rume entdecken"]})]}):Y.length===0?p.jsxs("div",{className:"text-center py-12",children:[p.jsx("div",{className:"w-20 h-20 mx-auto rounded-2xl bg-gray-100 flex items-center justify-center mb-4",children:p.jsx(iP,{size:32,className:"text-gray-400"})}),p.jsx("h3",{className:"font-semibold text-delulu-text mb-2",children:"Keine Ergebnisse"}),p.jsx("p",{className:"text-sm text-delulu-muted mb-6 max-w-xs mx-auto",children:"Versuche einen anderen Suchbegriff oder wechsle den Filter."}),p.jsx("button",{onClick:()=>{f(""),l("all")},className:"px-6 py-3 bg-delulu-violet text-white rounded-xl font-semibold",children:"Filter zurcksetzen"})]}):p.jsx("div",{className:"space-y-2",children:Y.map(W=>p.jsxs("button",{className:"w-full bg-white rounded-2xl p-4 flex items-center gap-4 text-left hover:shadow-md transition-shadow",children:[p.jsxs("div",{className:"relative",children:[p.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-delulu-violet to-purple-600 flex items-center justify-center font-display font-bold text-white text-lg",children:W.displayName.slice(0,2).toUpperCase()}),W.isOnline&&p.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-white"}),W.unreadCount>0&&p.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center",children:p.jsx("span",{className:"text-[10px] font-bold text-white",children:W.unreadCount>9?"9+":W.unreadCount})})]}),p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[p.jsx("p",{className:"font-semibold text-delulu-text truncate",children:W.displayName}),W.isFriend&&p.jsx(r8,{size:14,className:"text-green-500 flex-shrink-0"}),p.jsxs("span",{className:"text-[10px] text-delulu-muted",children:["Lv.",W.level]})]}),W.lastMessage?p.jsxs("p",{className:`text-sm truncate ${W.unreadCount>0?"text-delulu-text font-medium":"text-delulu-muted"}`,children:[W.lastMessage.isFromMe&&p.jsx("span",{className:"text-delulu-muted",children:"Du: "}),W.lastMessage.content]}):p.jsx("p",{className:"text-sm text-delulu-muted italic",children:W.isFriend?"Noch keine Nachrichten":`Getroffen ${ITe(W.metAt)}`})]}),p.jsxs("div",{className:"flex flex-col items-end gap-1",children:[W.lastMessage&&p.jsx("span",{className:"text-[10px] text-delulu-muted",children:ee(W.lastMessage.createdAt)}),p.jsx(_i,{size:18,className:"text-delulu-muted"})]})]},W.id))})})]})};function ITe(s){const o=new Date().getTime()-s.getTime(),l=Math.floor(o/(1e3*60*60*24));return l===0?"heute":l===1?"gestern":l<7?`vor ${l} Tagen`:`vor ${Math.floor(l/7)} Woche${l>=14?"n":""}`}const Nb=[{id:"pegasus",image:"/avatars/pegasus.png",name:"Pegasus"},{id:"sailor-boy",image:"/avatars/sailor-boy.png",name:"Sailor Boy"},{id:"sailor-girl",image:"/avatars/sailor-girl.png",name:"Sailor Girl"},{id:"sailor-boy-2",image:"/avatars/sailor-boy-2.png",name:"Sailor Shy"}],ATe=({selectedAvatar:s,onSelect:r,onClose:o})=>{var T;const{t:l}=Of(),[u,f]=ce.useState(s),E=()=>{r(u),o()};return p.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-end justify-center z-50 p-4",children:p.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-md p-6 animate-slide-up",children:[p.jsxs("div",{className:"text-center mb-6",children:[p.jsx("h2",{className:"font-display text-xl font-bold text-delulu-text",children:l("avatar.title")}),p.jsx("p",{className:"text-sm text-delulu-muted",children:l("avatar.subtitle")})]}),p.jsx("div",{className:"grid grid-cols-2 gap-4 mb-6",children:Nb.map(w=>p.jsxs("button",{onClick:()=>f(w.id),className:`relative aspect-square rounded-2xl bg-gradient-to-br from-delulu-soft to-white p-2 transition-all ${u===w.id?"scale-105 ring-4 ring-delulu-violet ring-offset-2 shadow-lg":"hover:scale-102 hover:shadow-md"}`,children:[p.jsx("img",{src:w.image,alt:w.name,className:"w-full h-full object-contain"}),u===w.id&&p.jsx("div",{className:"absolute -top-2 -right-2 w-7 h-7 bg-delulu-violet rounded-full flex items-center justify-center shadow-lg",children:p.jsx(Jo,{size:16,className:"text-white"})})]},w.id))}),p.jsx("div",{className:"text-center mb-6",children:p.jsxs("p",{className:"text-sm text-delulu-muted",children:[l("avatar.selected"),": ",p.jsx("span",{className:"font-semibold text-delulu-text",children:(T=Nb.find(w=>w.id===u))==null?void 0:T.name})]})}),p.jsxs("div",{className:"flex gap-3",children:[p.jsx("button",{onClick:o,className:"flex-1 py-3 rounded-xl border-2 border-delulu-soft font-semibold text-delulu-muted",children:l("common.cancel")}),p.jsx("button",{onClick:E,className:"flex-1 py-3 rounded-xl btn-primary text-white font-semibold",children:l("common.save")})]})]})})},NTe=({avatarId:s,size:r="md",className:o=""})=>{const l=Nb.find(f=>f.id===s)||Nb[0],u={sm:"w-10 h-10",md:"w-14 h-14",lg:"w-20 h-20",xl:"w-24 h-24"};return p.jsx("div",{className:`rounded-2xl bg-gradient-to-br from-delulu-soft to-white flex items-center justify-center p-1 ${u[r]} ${o}`,children:p.jsx("img",{src:l.image,alt:l.name,className:"w-full h-full object-contain"})})},c8=({compact:s=!1})=>{const{language:r,setLanguage:o,currentLanguage:l}=Of(),[u,f]=ce.useState(!1),E=T=>{o(T),f(!1)};return s?p.jsxs("div",{className:"relative",children:[p.jsxs("button",{onClick:()=>f(!u),className:"flex items-center gap-2 px-3 py-2 rounded-xl bg-delulu-soft hover:bg-delulu-soft/80 transition-colors",children:[p.jsx("span",{className:"text-lg",children:l.flag}),p.jsx(rq,{size:16,className:`text-delulu-muted transition-transform ${u?"rotate-180":""}`})]}),u&&p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>f(!1)}),p.jsx("div",{className:"absolute right-0 top-full mt-2 bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden z-50 min-w-[160px]",children:Object.entries(sl).map(([T,w])=>p.jsxs("button",{onClick:()=>E(T),className:`w-full flex items-center gap-3 px-4 py-3 hover:bg-delulu-soft transition-colors ${r===T?"bg-delulu-soft":""}`,children:[p.jsx("span",{className:"text-lg",children:w.flag}),p.jsx("span",{className:"font-medium text-delulu-text flex-1 text-left",children:w.native}),r===T&&p.jsx(Jo,{size:16,className:"text-delulu-violet"})]},T))})]})]}):p.jsx("div",{className:"space-y-2",children:Object.entries(sl).map(([T,w])=>p.jsxs("button",{onClick:()=>E(T),className:`w-full flex items-center gap-4 p-4 rounded-2xl transition-all ${r===T?"bg-delulu-violet/10 border-2 border-delulu-violet":"bg-delulu-soft border-2 border-transparent hover:border-delulu-violet/20"}`,children:[p.jsx("span",{className:"text-2xl",children:w.flag}),p.jsxs("div",{className:"flex-1 text-left",children:[p.jsx("p",{className:"font-semibold text-delulu-text",children:w.native}),p.jsx("p",{className:"text-xs text-delulu-muted",children:w.name})]}),r===T&&p.jsx("div",{className:"w-6 h-6 rounded-full bg-delulu-violet flex items-center justify-center",children:p.jsx(Jo,{size:14,className:"text-white"})})]},T))})},xTe=()=>{const{t:s}=Of(),r=ei(),{user:o,setUser:l,searchRadius:u,setSearchRadius:f,isVerifiedStar:E,starProfile:T}=vi(),{logout:w}=yR(),[A,U]=ce.useState(!1),[M,F]=ce.useState(!1),[Y,J]=ce.useState(!1),[ae,he]=ce.useState((o==null?void 0:o.displayName)||""),[ee,W]=ce.useState((o==null?void 0:o.bio)||""),[Z,fe]=ce.useState(!1),pe=(o==null?void 0:o.avatar)||"pegasus",Ce=(o==null?void 0:o.xp)||0,te=(o==null?void 0:o.level)||1,q=(o==null?void 0:o.currentStreak)||0,re=(o==null?void 0:o.trustScore)||3,$=(o==null?void 0:o.totalVoiceMinutes)||0,le=(o==null?void 0:o.friendCount)||0,ue=(o==null?void 0:o.friendRadarEnabled)??!0,ie=(o==null?void 0:o.isPremium)||!1,tt=(o==null?void 0:o.visibilityMode)||"public",Ot=(o==null?void 0:o.starsGivenToday)||0,on=ie?Jz.premiumStarsPerDay:Jz.freeStarsPerDay,It=Math.max(0,on-Ot),Ge=ck(te),nt=bR(q),pt=s8(te),ot=s8(te+1),Et=(Ce-pt)/(ot-pt)*100,un=async it=>{if(o)try{await fo(Dr(Qt,"users",o.id),{visibilityMode:it}),l({...o,visibilityMode:it})}catch($n){console.error("Failed to update visibility:",$n)}},In=async()=>{if(o)try{await fo(Dr(Qt,"users",o.id),{friendRadarEnabled:!ue}),l({...o,friendRadarEnabled:!ue})}catch(it){console.error("Failed to update friend radar:",it)}},zn=async it=>{if(f(it),!!o)try{await fo(Dr(Qt,"users",o.id),{searchRadius:it})}catch($n){console.error("Failed to update radius:",$n)}},Sr=async it=>{if(o)try{await fo(Dr(Qt,"users",o.id),{avatar:it}),l({...o,avatar:it})}catch($n){console.error("Failed to update avatar:",$n)}},Je=async()=>{if(o)try{await fo(Dr(Qt,"users",o.id),{displayName:ae,bio:ee}),l({...o,displayName:ae,bio:ee}),J(!1)}catch(it){console.error("Failed to update profile:",it)}},Kt=async()=>{fe(!0),await w()},Qn=[100,200,300,500,750,1e3,2e3,3e3,5e3].reduce((it,$n)=>Math.abs($n-u)<Math.abs(it-u)?$n:it),ms=it=>it>=1e3?`${it/1e3}km`:`${it}m`;return p.jsxs("div",{className:"px-4 py-6 pb-24 safe-top min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white",children:[p.jsxs("div",{className:"flex items-center justify-between mb-6",children:[p.jsx("h1",{className:"font-display text-2xl font-bold text-delulu-text",children:s("profile.title")}),p.jsx(c8,{compact:!0})]}),p.jsx("div",{className:"glass-card rounded-3xl p-6 mb-4",children:p.jsxs("div",{className:"flex flex-col items-center mb-4",children:[p.jsxs("button",{onClick:()=>U(!0),className:"relative mb-4",children:[p.jsx(NTe,{avatarId:pe,size:"xl",className:"shadow-lg"}),p.jsx("div",{className:"absolute -bottom-1 -right-1 w-8 h-8 bg-white rounded-full shadow-md flex items-center justify-center",children:p.jsx(t8,{size:14,className:"text-delulu-violet"})})]}),p.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-violet-500 to-purple-600 rounded-full text-white text-sm font-semibold mb-3 shadow-lg",children:[p.jsx("span",{children:Ge.emoji}),p.jsxs("span",{children:[s("level.level")," ",te]}),p.jsx("span",{className:"opacity-60",children:""}),p.jsx("span",{children:Ge.name})]}),p.jsxs("div",{className:"w-full max-w-[200px] mb-4",children:[p.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:p.jsx("div",{className:"h-full bg-gradient-to-r from-violet-500 to-purple-500 rounded-full transition-all duration-500",style:{width:`${Math.min(100,Math.max(0,Et))}%`}})}),p.jsxs("p",{className:"text-xs text-delulu-muted mt-1 text-center",children:[Ce," / ",ot," XP"]})]}),Y?p.jsxs("div",{className:"w-full space-y-3",children:[p.jsx("input",{type:"text",value:ae,onChange:it=>he(it.target.value),className:"w-full text-center font-display text-xl font-bold bg-delulu-soft rounded-xl px-4 py-2",placeholder:s("profile.editProfile")}),p.jsx("textarea",{value:ee,onChange:it=>W(it.target.value),placeholder:s("profile.bioPlaceholder"),maxLength:150,rows:2,className:"w-full bg-delulu-soft rounded-xl px-4 py-3 text-sm resize-none text-center"}),p.jsxs("div",{className:"flex gap-2",children:[p.jsx("button",{onClick:()=>J(!1),className:"flex-1 py-2 rounded-xl border-2 border-delulu-soft font-semibold text-delulu-muted text-sm",children:s("common.cancel")}),p.jsx("button",{onClick:Je,className:"flex-1 py-2 rounded-xl btn-primary text-white font-semibold text-sm",children:s("common.save")})]})]}):p.jsxs(p.Fragment,{children:[p.jsx("h2",{className:"font-display text-xl font-bold text-delulu-text",children:(o==null?void 0:o.displayName)||"Anonymous"}),p.jsxs("p",{className:"text-sm text-delulu-muted mb-2",children:["@",o==null?void 0:o.username]}),p.jsx("p",{className:"text-sm text-delulu-text/70 italic text-center px-4",children:(o==null?void 0:o.bio)||s("profile.noBio")}),p.jsxs("button",{onClick:()=>J(!0),className:"mt-3 flex items-center gap-2 text-sm text-delulu-violet font-medium",children:[p.jsx(t8,{size:14}),s("profile.editProfile")]})]})]})}),p.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[p.jsxs("div",{className:"glass-card rounded-2xl p-3 text-center",children:[p.jsx("p",{className:"text-xl font-bold gradient-text",children:le}),p.jsx("p",{className:"text-[10px] text-delulu-muted uppercase tracking-wide",children:s("profile.stats.friends")})]}),p.jsxs("div",{className:"glass-card rounded-2xl p-3 text-center",children:[p.jsxs("div",{className:"flex items-center justify-center gap-1",children:[p.jsx("span",{className:"text-yellow-500 text-sm",children:""}),p.jsx("p",{className:"text-xl font-bold gradient-text",children:re.toFixed(1)})]}),p.jsx("p",{className:"text-[10px] text-delulu-muted uppercase tracking-wide",children:s("profile.stats.trust")})]}),p.jsxs("div",{className:"glass-card rounded-2xl p-3 text-center",children:[p.jsx("p",{className:"text-xl font-bold gradient-text",children:$}),p.jsx("p",{className:"text-[10px] text-delulu-muted uppercase tracking-wide",children:s("profile.stats.voiceMin")})]})]}),E&&T&&p.jsxs("div",{className:"glass-card rounded-2xl p-4 mb-4 bg-gradient-to-br from-purple-50 to-pink-50 border border-purple-200",children:[p.jsxs("div",{className:"flex items-center justify-between mb-4",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(vf,{tier:T.nebulaTier,size:"lg",animated:!0}),p.jsxs("div",{children:[p.jsx("h3",{className:"font-bold text-delulu-text",children:"Creator Hub"}),p.jsx(pq,{category:T.category,size:"sm"})]})]}),p.jsx("button",{onClick:()=>r("/stars/dashboard"),className:"px-3 py-1.5 bg-purple-100 text-purple-600 rounded-lg text-xs font-semibold",children:"Dashboard "})]}),p.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[p.jsxs("div",{className:"bg-white/60 rounded-xl p-2 text-center",children:[p.jsx("p",{className:"text-lg font-bold text-purple-600",children:T.totalListeners.toLocaleString()}),p.jsx("p",{className:"text-[9px] text-gray-500",children:"Zuhrer"})]}),p.jsxs("div",{className:"bg-white/60 rounded-xl p-2 text-center",children:[p.jsx("p",{className:"text-lg font-bold text-amber-500",children:T.totalStarsReceived.toLocaleString()}),p.jsx("p",{className:"text-[9px] text-gray-500",children:"Sterne"})]}),p.jsxs("div",{className:"bg-white/60 rounded-xl p-2 text-center",children:[p.jsx("p",{className:"text-lg font-bold text-green-600",children:T.totalEventsHosted}),p.jsx("p",{className:"text-[9px] text-gray-500",children:"Events"})]})]}),p.jsxs("div",{className:"flex gap-2",children:[p.jsxs("button",{onClick:()=>r("/stars/event/new"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl text-sm font-semibold",children:[p.jsx(lq,{size:16}),"Live gehen"]}),p.jsxs("button",{onClick:()=>r("/stars/schedule"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 bg-white border border-purple-200 text-purple-600 rounded-xl text-sm font-semibold",children:[p.jsx(qd,{size:16}),"Event planen"]})]})]}),p.jsxs("div",{className:"glass-card rounded-2xl p-4 mb-4",children:[p.jsxs("div",{className:"flex items-center justify-between mb-3",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Qi,{size:18,className:"text-amber-500"}),p.jsx("span",{className:"font-semibold text-delulu-text text-sm",children:"Deine Sterne heute"})]}),p.jsxs("span",{className:"text-xs text-delulu-muted",children:[It," / ",on," brig"]})]}),p.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden mb-2",children:p.jsx("div",{className:"h-full bg-gradient-to-r from-amber-400 to-orange-500 rounded-full transition-all",style:{width:`${It/on*100}%`}})}),p.jsxs("div",{className:"flex items-center justify-between text-xs",children:[p.jsxs("span",{className:"text-delulu-muted",children:[Ot," Sterne heute vergeben"]}),!ie&&p.jsxs("button",{onClick:()=>r("/premium"),className:"text-purple-500 font-medium flex items-center gap-1",children:[p.jsx(ci,{size:12}),"Mehr mit Premium"]})]})]}),q>=2&&p.jsx("div",{className:"glass-card rounded-2xl p-4 mb-4 bg-gradient-to-r from-orange-400/10 to-red-400/10 border border-orange-200",children:p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("span",{className:"text-2xl animate-pulse",children:""}),p.jsxs("div",{className:"flex-1",children:[p.jsxs("p",{className:"font-semibold text-delulu-text",children:[q," ",s("streak.days")," ",s("streak.title"),"!"]}),p.jsxs("p",{className:"text-xs text-delulu-muted",children:[nt,"x ",s("streak.xpBoost")]})]})]})}),p.jsxs("div",{className:"glass-card rounded-2xl p-4 mb-4",children:[p.jsx("p",{className:"text-xs font-semibold text-delulu-muted uppercase tracking-wide mb-3",children:s("visibility.title")}),p.jsx("div",{className:"space-y-2",children:["public","friends","ghost"].map(it=>p.jsxs("button",{onClick:()=>un(it),className:`w-full flex items-center gap-3 p-3 rounded-xl transition-all ${tt===it?"bg-delulu-violet/10 border-2 border-delulu-violet":"bg-delulu-soft/50 border-2 border-transparent"}`,children:[p.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center ${tt===it?"bg-delulu-violet":"border-2 border-gray-300"}`,children:tt===it&&p.jsx("span",{className:"text-white text-xs",children:""})}),p.jsxs("div",{className:"flex-1 text-left",children:[p.jsx("p",{className:"font-medium text-delulu-text text-sm",children:s(`visibility.${it}.title`)}),p.jsx("p",{className:"text-xs text-delulu-muted",children:s(`visibility.${it}.description`)})]})]},it))})]}),p.jsx("div",{className:"glass-card rounded-2xl p-4 mb-4",children:p.jsxs("button",{onClick:In,className:"w-full flex items-center gap-4",children:[p.jsx("div",{className:"w-12 h-12 rounded-xl bg-delulu-violet/10 flex items-center justify-center",children:p.jsx(TR,{size:20,className:"text-delulu-violet"})}),p.jsxs("div",{className:"flex-1 text-left",children:[p.jsx("p",{className:"font-semibold text-delulu-text",children:s("friendRadar.title")}),p.jsx("p",{className:"text-xs text-delulu-muted",children:s("friendRadar.description")})]}),p.jsx("div",{className:`w-14 h-8 rounded-full p-1 transition-colors ${ue?"bg-delulu-violet":"bg-gray-300"}`,children:p.jsx("div",{className:`w-6 h-6 bg-white rounded-full shadow transition-transform ${ue?"translate-x-6":""}`})})]})}),p.jsxs("div",{className:"glass-card rounded-2xl p-4 mb-4",children:[p.jsxs("div",{className:"flex items-center justify-between mb-3",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:"w-12 h-12 rounded-xl bg-delulu-violet/10 flex items-center justify-center",children:p.jsx("span",{className:"text-xl",children:""})}),p.jsxs("div",{children:[p.jsx("p",{className:"font-semibold text-delulu-text",children:s("radius.title")}),p.jsx("p",{className:"text-xs text-delulu-muted",children:s("radius.description")})]})]}),p.jsx("span",{className:"text-xl font-bold gradient-text",children:ms(Qn)})]}),p.jsxs("div",{className:"px-2",children:[p.jsx("input",{type:"range",min:"100",max:"5000",step:"100",value:u,onChange:it=>zn(Number(it.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-delulu-violet"}),p.jsxs("div",{className:"flex justify-between text-xs text-delulu-muted mt-1",children:[p.jsx("span",{children:"100m"}),p.jsx("span",{children:"5km"})]})]})]}),!E&&p.jsxs("div",{className:"glass-card rounded-2xl p-5 mb-4 bg-gradient-to-br from-pink-50 to-purple-50 border border-pink-200",children:[p.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[p.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-pink-500 to-purple-500 flex items-center justify-center",children:p.jsx(Qi,{size:24,className:"text-white"})}),p.jsxs("div",{children:[p.jsx("h3",{className:"font-bold text-lg text-delulu-text",children:"Creator werden"}),p.jsx("p",{className:"text-xs text-delulu-muted",children:"Teile deine Stimme mit der Community"})]})]}),p.jsx("p",{className:"text-sm text-delulu-text/80 mb-4",children:"Werde ein verifizierter Star und hoste eigene Live-Events, verdiene Sterne und baue deine Community auf."}),p.jsxs("button",{onClick:()=>r("/stars/apply"),className:"w-full py-3 rounded-xl bg-gradient-to-r from-pink-500 to-purple-500 text-white font-semibold shadow-lg hover:shadow-xl transition-shadow flex items-center justify-center gap-2",children:[p.jsx(ci,{size:18}),"Jetzt bewerben"]})]}),!ie&&p.jsxs("div",{className:"glass-card rounded-2xl p-5 mb-4 bg-gradient-to-br from-violet-50 to-purple-50 border border-violet-200 relative overflow-hidden",children:[p.jsx("div",{className:"absolute top-3 right-3 px-3 py-1 bg-amber-100 text-amber-700 text-xs font-bold rounded-full",children:"Bald verfgbar"}),p.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[p.jsx(ci,{size:20,className:"text-violet-500"}),p.jsx("h3",{className:"font-bold text-lg gradient-text",children:s("premium.title")})]}),p.jsx("p",{className:"text-sm text-delulu-text/80 mb-4",children:s("premium.upsell")}),p.jsx("button",{disabled:!0,className:"w-full py-3 rounded-xl bg-gray-300 text-gray-500 font-semibold cursor-not-allowed",children:"Demnchst verfgbar"})]}),p.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden mb-4",children:[p.jsxs("button",{onClick:()=>F(!0),className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 transition-colors border-b border-gray-100",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(jE,{size:18,className:"text-delulu-muted"}),p.jsx("span",{className:"font-medium text-delulu-text",children:s("settings.language")})]}),p.jsx(_i,{size:18,className:"text-delulu-muted"})]}),p.jsxs("button",{className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 transition-colors border-b border-gray-100",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(Va,{size:18,className:"text-delulu-muted"}),p.jsx("span",{className:"font-medium text-delulu-text",children:s("settings.blockedUsers")})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{className:"text-sm text-delulu-muted",children:"0"}),p.jsx(_i,{size:18,className:"text-delulu-muted"})]})]}),p.jsxs("button",{className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 transition-colors border-b border-gray-100",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(oE,{size:18,className:"text-delulu-muted"}),p.jsx("span",{className:"font-medium text-delulu-text",children:s("settings.myStats")})]}),p.jsx(_i,{size:18,className:"text-delulu-muted"})]}),p.jsxs("button",{className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 transition-colors border-b border-gray-100",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(Kd,{size:18,className:"text-delulu-muted"}),p.jsx("span",{className:"font-medium text-delulu-text",children:s("settings.notifications")})]}),p.jsx(_i,{size:18,className:"text-delulu-muted"})]}),p.jsxs("button",{className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(SR,{size:18,className:"text-delulu-muted"}),p.jsx("span",{className:"font-medium text-delulu-text",children:s("settings.help")})]}),p.jsx(_i,{size:18,className:"text-delulu-muted"})]})]}),p.jsxs("button",{onClick:Kt,disabled:Z,className:"w-full p-4 flex items-center justify-center gap-3 text-red-500 font-medium rounded-2xl border-2 border-red-100 hover:bg-red-50 transition-colors disabled:opacity-50",children:[p.jsx(cq,{size:18}),s(Z?"profile.loggingOut":"profile.logout")]}),p.jsx("p",{className:"text-center text-xs text-delulu-muted mt-6",children:"delulu v2.0  butterbread "}),A&&p.jsx(ATe,{selectedAvatar:pe,onSelect:Sr,onClose:()=>U(!1)}),M&&p.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-end justify-center z-50 p-4",children:p.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-md p-6 animate-slide-up",children:[p.jsxs("div",{className:"flex items-center justify-between mb-4",children:[p.jsx("h2",{className:"font-display text-xl font-bold text-delulu-text",children:s("settings.language")}),p.jsx("button",{onClick:()=>F(!1),className:"w-10 h-10 rounded-xl bg-delulu-soft flex items-center justify-center",children:p.jsx(nu,{size:20,className:"text-delulu-muted"})})]}),p.jsx(c8,{})]})})]})},OTe=()=>{const s=ei(),{user:r}=vi(),[o,l]=ce.useState("overview"),[u,f]=ce.useState(!0),[E,T]=ce.useState({totalTalkTime:0,starsReceived:0,starsGiven:0,loungesVisited:0,friendsMade:0,voiceChatsJoined:0,weeklyActivity:[0,0,0,0,0,0,0],xpCurrent:0,xpRequired:1e3,trustScore:5,followers:0,following:0});ce.useEffect(()=>{(async()=>{if(!(r!=null&&r.id)){f(!1);return}try{const ae=await ef(Dr(Qt,"users",r.id)),he=ae.exists()?ae.data():{},ee=qo(Zr(Qt,"stars"),ds("toUserId","==",r.id)),W=await Rd(ee),Z=qo(Zr(Qt,"stars"),ds("fromUserId","==",r.id)),fe=await Rd(Z),pe=qo(Zr(Qt,"friendships"),ds("userId","==",r.id)),Ce=await Rd(pe),te=qo(Zr(Qt,"voiceChatHistory"),ds("userId","==",r.id)),q=await Rd(te),re=qo(Zr(Qt,"follows"),ds("followingId","==",r.id)),$=await Rd(re),le=qo(Zr(Qt,"follows"),ds("followerId","==",r.id)),ue=await Rd(le);let ie=0;q.docs.forEach(on=>{const It=on.data();It.duration&&(ie+=Math.floor(It.duration/60))});const Ot=(he.level||1)*500+500;T({totalTalkTime:ie,starsReceived:W.size,starsGiven:fe.size,loungesVisited:he.loungesVisited||0,friendsMade:Ce.size,voiceChatsJoined:q.size,weeklyActivity:he.weeklyActivity||[0,0,0,0,0,0,0],xpCurrent:he.xp||0,xpRequired:Ot,trustScore:he.trustScore||5,followers:$.size,following:ue.size})}catch(ae){console.error("Error fetching stats:",ae)}finally{f(!1)}})()},[r==null?void 0:r.id]);const w=(r==null?void 0:r.level)||1,A=ck(w),U=bR((r==null?void 0:r.currentStreak)||0),M=E.xpRequired>0?E.xpCurrent/E.xpRequired*100:0,Y=[{label:"Gesprochene Zeit",value:(J=>{const ae=Math.floor(J/60),he=J%60;return ae>0?`${ae}h ${he}m`:he>0?`${he}m`:"0m"})(E.totalTalkTime),subtext:E.totalTalkTime===0?"Noch keine Gesprche":void 0,icon:p.jsx(Cl,{size:20}),color:"from-violet-500 to-purple-600"},{label:"Sterne erhalten",value:E.starsReceived,subtext:`${E.starsGiven} verschenkt`,icon:p.jsx(Qi,{size:20}),color:"from-amber-400 to-orange-500"},{label:"Voice Chats",value:E.voiceChatsJoined,subtext:E.voiceChatsJoined===0?"Noch keinem beigetreten":void 0,icon:p.jsx(Rb,{size:20}),color:"from-blue-400 to-cyan-500"},{label:"Freundschaften",value:E.friendsMade,subtext:E.friendsMade===0?"Finde neue Freunde!":void 0,icon:p.jsx(ai,{size:20}),color:"from-green-400 to-emerald-500"}];return u?p.jsx("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white flex items-center justify-center",children:p.jsxs("div",{className:"text-center",children:[p.jsx(ws,{size:32,className:"animate-spin text-delulu-violet mx-auto mb-4"}),p.jsx("p",{className:"text-delulu-muted text-sm",children:"Lade Statistiken..."})]})}):p.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white safe-top safe-bottom pb-24",children:[p.jsxs("div",{className:"sticky top-0 z-20 bg-white/90 backdrop-blur-lg border-b border-gray-100",children:[p.jsxs("div",{className:"px-6 py-4 flex items-center gap-4",children:[p.jsx("button",{onClick:()=>s(-1),className:"w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-delulu-muted hover:bg-gray-200 transition-colors",children:p.jsx(Is,{size:20})}),p.jsxs("div",{className:"flex-1",children:[p.jsx("h1",{className:"font-display text-xl font-bold text-delulu-text",children:"Meine Statistiken"}),p.jsx("p",{className:"text-xs text-delulu-muted",children:"Deine Aktivitt im berblick"})]})]}),p.jsx("div",{className:"px-6 pb-3 flex gap-2",children:[{id:"overview",label:"bersicht",icon:oE},{id:"activity",label:"Aktivitt",icon:qd},{id:"social",label:"Sozial",icon:ai}].map(J=>p.jsxs("button",{onClick:()=>l(J.id),className:`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-semibold transition-all ${o===J.id?"bg-delulu-violet text-white shadow-lg":"bg-gray-100 text-delulu-muted hover:bg-gray-200"}`,children:[p.jsx(J.icon,{size:16}),J.label]},J.id))})]}),p.jsx("div",{className:"px-6 py-4",children:p.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-br from-delulu-violet to-purple-600 rounded-3xl p-6 text-white shadow-xl",children:[p.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2"}),p.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/5 rounded-full translate-y-1/2 -translate-x-1/2"}),p.jsxs("div",{className:"relative",children:[p.jsxs("div",{className:"flex items-start justify-between mb-4",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:"w-16 h-16 rounded-2xl bg-white/20 flex items-center justify-center text-3xl",children:A.emoji}),p.jsxs("div",{children:[p.jsx("p",{className:"text-white/70 text-sm",children:"Dein Level"}),p.jsxs("h2",{className:"font-display text-3xl font-bold",children:["Level ",w]}),p.jsx("p",{className:"text-white/80 text-sm",children:A.name})]})]}),U>1&&p.jsxs("div",{className:"flex items-center gap-1 px-3 py-1.5 bg-amber-400 text-amber-900 rounded-full",children:[p.jsx(sq,{size:14}),p.jsxs("span",{className:"text-sm font-bold",children:[U,"x XP"]})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"flex items-center justify-between text-sm",children:[p.jsxs("span",{className:"text-white/70",children:["Fortschritt zu Level ",w+1]}),p.jsxs("span",{className:"font-semibold",children:[E.xpCurrent," / ",E.xpRequired," XP"]})]}),p.jsx("div",{className:"h-3 bg-white/20 rounded-full overflow-hidden",children:p.jsx("div",{className:"h-full bg-gradient-to-r from-amber-400 to-yellow-300 rounded-full transition-all duration-500",style:{width:`${Math.min(M,100)}%`}})}),p.jsx("p",{className:"text-xs text-white/60",children:E.xpRequired-E.xpCurrent>0?`Noch ${E.xpRequired-E.xpCurrent} XP bis zum nchsten Level`:"Level Up bereit!"})]})]})]})}),o==="overview"&&p.jsx("div",{className:"px-6 space-y-4",children:E.totalTalkTime===0&&E.starsReceived===0&&E.voiceChatsJoined===0&&E.friendsMade===0?p.jsxs("div",{className:"text-center py-12",children:[p.jsx("div",{className:"w-24 h-24 mx-auto rounded-3xl bg-gradient-to-br from-delulu-soft to-white flex items-center justify-center mb-6 shadow-inner",children:p.jsx(oE,{size:40,className:"text-delulu-muted"})}),p.jsx("h3",{className:"font-display font-bold text-xl text-delulu-text mb-3",children:ak.empty.stats}),p.jsx("p",{className:"text-sm text-delulu-muted mb-8 max-w-xs mx-auto leading-relaxed",children:"Hier werden deine Statistiken angezeigt, sobald du anfngst die App zu nutzen. Tritt einem Voice Chat bei oder finde neue Freunde!"}),p.jsxs("button",{onClick:()=>s("/discover"),className:"inline-flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-delulu-violet to-purple-600 text-white rounded-2xl font-display font-bold shadow-lg",children:[p.jsx(Rb,{size:20}),"Rume entdecken"]})]}):p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"grid grid-cols-2 gap-3",children:Y.map((J,ae)=>p.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm hover:shadow-md transition-shadow",children:[p.jsx("div",{className:`w-10 h-10 rounded-xl bg-gradient-to-br ${J.color} flex items-center justify-center text-white mb-3`,children:J.icon}),p.jsx("p",{className:"text-2xl font-display font-bold text-delulu-text",children:J.value}),p.jsx("p",{className:"text-xs text-delulu-muted mt-1",children:J.label}),J.subtext&&p.jsx("p",{className:"text-[10px] text-delulu-muted mt-1",children:J.subtext})]},ae))}),p.jsx("div",{className:"bg-gradient-to-r from-delulu-violet/10 to-purple-100 rounded-2xl p-4",children:p.jsxs("p",{className:"text-sm text-delulu-text",children:[p.jsx("span",{className:"font-semibold",children:"Tipp:"})," Je mehr du mit anderen interagierst, desto mehr XP und Sterne verdienst du!"]})})]})}),o==="activity"&&p.jsxs("div",{className:"px-6 space-y-4",children:[p.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-sm",children:[p.jsxs("h3",{className:"font-display font-bold text-delulu-text mb-4 flex items-center gap-2",children:[p.jsx(oE,{size:18,className:"text-delulu-violet"}),"Wochenbersicht"]}),E.weeklyActivity.every(J=>J===0)?p.jsxs("div",{className:"text-center py-8",children:[p.jsx(qd,{size:32,className:"mx-auto text-gray-300 mb-3"}),p.jsx("p",{className:"text-sm text-delulu-muted",children:"Noch keine Aktivittsdaten vorhanden."}),p.jsx("p",{className:"text-xs text-delulu-muted mt-1",children:"Nutze die App regelmig, um deine Aktivitt zu tracken."})]}):p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"flex items-end justify-between h-32 gap-2",children:["Mo","Di","Mi","Do","Fr","Sa","So"].map((J,ae)=>{const he=Math.max(...E.weeklyActivity,1),ee=E.weeklyActivity[ae]/he*100,W=ae===(new Date().getDay()+6)%7;return p.jsxs("div",{className:"flex-1 flex flex-col items-center gap-2",children:[p.jsx("div",{className:"w-full bg-gray-100 rounded-lg overflow-hidden h-full flex flex-col justify-end",children:p.jsx("div",{className:`w-full rounded-t-lg transition-all duration-500 ${W?"bg-delulu-violet":"bg-delulu-violet/40"}`,style:{height:`${ee}%`}})}),p.jsx("span",{className:`text-xs ${W?"font-bold text-delulu-violet":"text-delulu-muted"}`,children:J})]},J)})}),p.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-gray-100",children:[p.jsxs("div",{children:[p.jsx("p",{className:"text-xs text-delulu-muted",children:"Gesamt diese Woche"}),p.jsxs("p",{className:"font-bold text-delulu-text",children:[E.weeklyActivity.reduce((J,ae)=>J+ae,0)," Minuten"]})]}),p.jsxs("div",{className:"text-right",children:[p.jsx("p",{className:"text-xs text-delulu-muted",children:"Durchschnitt"}),p.jsxs("p",{className:"font-bold text-delulu-violet",children:[(E.weeklyActivity.reduce((J,ae)=>J+ae,0)/7).toFixed(0),"min/Tag"]})]})]})]})]}),p.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-sm",children:[p.jsxs("h3",{className:"font-display font-bold text-delulu-text mb-4 flex items-center gap-2",children:[p.jsx(nTe,{size:18,className:"text-green-500"}),"Wochenziele"]}),p.jsx("div",{className:"space-y-4",children:[{label:"5 Voice Chats",current:Math.min(E.voiceChatsJoined,5),target:5,color:"bg-violet-500"},{label:"10 Sterne verschenken",current:Math.min(E.starsGiven,10),target:10,color:"bg-amber-500"},{label:"3 neue Freunde",current:Math.min(E.friendsMade,3),target:3,color:"bg-green-500"}].map((J,ae)=>p.jsxs("div",{children:[p.jsxs("div",{className:"flex items-center justify-between mb-2",children:[p.jsx("span",{className:"text-sm text-delulu-text",children:J.label}),p.jsxs("span",{className:`text-sm font-bold ${J.current>=J.target?"text-green-600":"text-delulu-muted"}`,children:[J.current,"/",J.target,J.current>=J.target&&" "]})]}),p.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:p.jsx("div",{className:`h-full ${J.color} rounded-full transition-all`,style:{width:`${Math.min(J.current/J.target*100,100)}%`}})})]},ae))})]})]}),o==="social"&&p.jsxs("div",{className:"px-6 space-y-4",children:[p.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[p.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-4",children:[p.jsx(Qi,{size:24,className:"text-amber-500 mb-2"}),p.jsx("p",{className:"text-2xl font-display font-bold text-amber-600",children:E.starsReceived}),p.jsx("p",{className:"text-xs text-amber-700/70",children:"Sterne erhalten"}),p.jsxs("p",{className:"text-[10px] text-amber-600 mt-1",children:["= ",E.starsReceived*15," XP verdient"]})]}),p.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-violet-50 rounded-2xl p-4",children:[p.jsx(sE,{size:24,className:"text-violet-500 mb-2"}),p.jsx("p",{className:"text-2xl font-display font-bold text-violet-600",children:E.starsGiven}),p.jsx("p",{className:"text-xs text-violet-700/70",children:"Sterne verschenkt"}),p.jsxs("p",{className:"text-[10px] text-violet-600 mt-1",children:["= ",E.starsGiven*5," XP ausgegeben"]})]})]}),p.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-sm",children:[p.jsxs("h3",{className:"font-display font-bold text-delulu-text mb-4 flex items-center gap-2",children:[p.jsx(hl,{size:18,className:"text-green-500"}),"Trust Score"]}),p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsxs("div",{className:"relative w-24 h-24",children:[p.jsxs("svg",{className:"w-full h-full -rotate-90",viewBox:"0 0 100 100",children:[p.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"#E5E7EB",strokeWidth:"12"}),p.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"#10B981",strokeWidth:"12",strokeLinecap:"round",strokeDasharray:`${E.trustScore/5*251.2} 251.2`})]}),p.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:p.jsx("span",{className:"text-2xl font-bold text-green-600",children:E.trustScore.toFixed(1)})})]}),p.jsxs("div",{className:"flex-1",children:[p.jsx("p",{className:"text-sm text-delulu-muted mb-2",children:"Dein Trust Score basiert auf:"}),p.jsxs("ul",{className:"space-y-1 text-xs text-delulu-text",children:[p.jsxs("li",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),"Positive Bewertungen"]}),p.jsxs("li",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),"Regelmige Aktivitt"]}),p.jsxs("li",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),"Keine Verste"]})]})]})]})]}),p.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-sm",children:[p.jsx("div",{className:"flex items-center justify-between mb-4",children:p.jsxs("h3",{className:"font-display font-bold text-delulu-text flex items-center gap-2",children:[p.jsx(ai,{size:18,className:"text-blue-500"}),"Freundesnetzwerk"]})}),p.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[p.jsxs("div",{children:[p.jsx("p",{className:"text-2xl font-bold text-delulu-text",children:E.friendsMade}),p.jsx("p",{className:"text-[10px] text-delulu-muted",children:"Freunde"})]}),p.jsxs("div",{children:[p.jsx("p",{className:"text-2xl font-bold text-blue-500",children:E.followers}),p.jsx("p",{className:"text-[10px] text-delulu-muted",children:"Follower"})]}),p.jsxs("div",{children:[p.jsx("p",{className:"text-2xl font-bold text-purple-500",children:E.following}),p.jsx("p",{className:"text-[10px] text-delulu-muted",children:"Folgst du"})]})]}),E.friendsMade===0&&E.followers===0&&E.following===0&&p.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100 text-center",children:p.jsx("p",{className:"text-xs text-delulu-muted",children:"Noch keine Verbindungen. Tritt Voice Chats bei, um Leute kennenzulernen!"})})]})]})]})},PTe=()=>{const s=ei(),{user:r}=vi(),[o,l]=ce.useState("all"),[u,f]=ce.useState([]),[E,T]=ce.useState([]),[w,A]=ce.useState(!0),[U,M]=ce.useState(null);ce.useEffect(()=>{if(!(r!=null&&r.id))return;const pe=Zr(Qt,"notifications"),Ce=gl(pe,te=>{const q=[];te.docs.forEach(re=>{var le;const $=re.data();$.toUserId===r.id&&q.push({id:re.id,type:$.type||"system",title:$.title||"",message:$.message||"",timestamp:((le=$.timestamp)==null?void 0:le.toDate())||new Date,isRead:$.isRead||!1,fromUserId:$.fromUserId,fromUsername:$.fromUsername,fromDisplayName:$.fromDisplayName})}),q.sort((re,$)=>$.timestamp.getTime()-re.timestamp.getTime()),T(q),A(!1)},te=>{console.error("Error fetching notifications:",te),A(!1)});return()=>Ce()},[r==null?void 0:r.id]),ce.useEffect(()=>{if(!(r!=null&&r.id))return;const pe=Zr(Qt,"friendRequests"),Ce=gl(pe,te=>{const q=[];te.docs.forEach(re=>{var le;const $=re.data();$.toUserId===r.id&&$.status==="pending"&&q.push({id:re.id,fromUserId:$.fromUserId,fromUsername:$.fromUsername||"unknown",fromDisplayName:$.fromDisplayName||"Unbekannt",fromLevel:$.fromLevel||1,message:$.message,createdAt:((le=$.createdAt)==null?void 0:le.toDate())||new Date})}),q.sort((re,$)=>$.createdAt.getTime()-re.createdAt.getTime()),f(q)},te=>{console.error("Error fetching friend requests:",te)});return()=>Ce()},[r==null?void 0:r.id]);const F=E.filter(pe=>!pe.isRead).length,Y=u.length,J=async pe=>{if(r!=null&&r.id){M(pe.id);try{await fo(Dr(Qt,"friendRequests",pe.id),{status:"accepted",acceptedAt:Wn.now()}),await UE(Zr(Qt,"friendships"),{users:[r.id,pe.fromUserId],createdAt:Wn.now()}),await UE(Zr(Qt,"notifications"),{toUserId:pe.fromUserId,type:"follow",title:"Freundschaft akzeptiert!",message:`${r.displayName||r.username} hat deine Anfrage angenommen`,timestamp:Wn.now(),isRead:!1,fromUserId:r.id,fromUsername:r.username,fromDisplayName:r.displayName})}catch(Ce){console.error("Error accepting request:",Ce)}finally{M(null)}}},ae=async pe=>{M(pe);try{await fo(Dr(Qt,"friendRequests",pe),{status:"declined",declinedAt:Wn.now()})}catch(Ce){console.error("Error declining request:",Ce)}finally{M(null)}},he=async pe=>{try{await fo(Dr(Qt,"notifications",pe),{isRead:!0})}catch(Ce){console.error("Error marking as read:",Ce)}},ee=async()=>{const pe=E.filter(Ce=>!Ce.isRead);try{await Promise.all(pe.map(Ce=>fo(Dr(Qt,"notifications",Ce.id),{isRead:!0})))}catch(Ce){console.error("Error marking all as read:",Ce)}},W=pe=>{switch(pe){case"star":return p.jsx(Qi,{size:16,className:"text-amber-500"});case"follow":return p.jsx(Ih,{size:16,className:"text-blue-500"});case"mention":return p.jsx(Kh,{size:16,className:"text-green-500"});case"lounge":return p.jsx(ai,{size:16,className:"text-purple-500"});case"system":return p.jsx(Kd,{size:16,className:"text-gray-500"})}},Z=pe=>{const Ce=Date.now()-pe.getTime(),te=Math.floor(Ce/6e4),q=Math.floor(Ce/36e5),re=Math.floor(Ce/864e5);return te<60?`${te}m`:q<24?`${q}h`:`${re}d`},fe=E.filter(pe=>o==="all"?!0:o==="stars"?pe.type==="star":o==="social"?["follow","lounge","mention"].includes(pe.type):!1);return w?p.jsx("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white flex items-center justify-center",children:p.jsxs("div",{className:"text-center",children:[p.jsx(ws,{size:32,className:"animate-spin text-delulu-violet mx-auto mb-4"}),p.jsx("p",{className:"text-delulu-muted text-sm",children:"Lade Benachrichtigungen..."})]})}):p.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white safe-top safe-bottom pb-24",children:[p.jsxs("div",{className:"sticky top-0 z-20 bg-white/90 backdrop-blur-lg border-b border-gray-100",children:[p.jsxs("div",{className:"px-6 py-4 flex items-center gap-4",children:[p.jsx("button",{onClick:()=>s(-1),className:"w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-delulu-muted hover:bg-gray-200 transition-colors",children:p.jsx(Is,{size:20})}),p.jsxs("div",{className:"flex-1",children:[p.jsx("h1",{className:"font-display text-xl font-bold text-delulu-text",children:"Benachrichtigungen"}),p.jsx("p",{className:"text-xs text-delulu-muted",children:F>0?`${F} ungelesen`:"Alles gelesen"})]}),F>0&&p.jsx("button",{onClick:ee,className:"text-xs text-delulu-violet font-semibold",children:"Alle lesen"})]}),p.jsx("div",{className:"px-6 pb-3 flex gap-2 overflow-x-auto scrollbar-hide",children:[{id:"all",label:"Alle",count:E.length},{id:"requests",label:"Anfragen",count:Y},{id:"stars",label:"Sterne",count:E.filter(pe=>pe.type==="star").length},{id:"social",label:"Sozial",count:E.filter(pe=>["follow","lounge"].includes(pe.type)).length}].map(pe=>p.jsxs("button",{onClick:()=>l(pe.id),className:`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-semibold whitespace-nowrap transition-all ${o===pe.id?"bg-delulu-violet text-white shadow-lg":"bg-gray-100 text-delulu-muted hover:bg-gray-200"}`,children:[pe.label,pe.count>0&&p.jsx("span",{className:`px-1.5 py-0.5 rounded-full text-[10px] ${o===pe.id?"bg-white/20":"bg-delulu-violet/10 text-delulu-violet"}`,children:pe.count})]},pe.id))})]}),(o==="all"||o==="requests")&&u.length>0&&p.jsxs("div",{className:"px-6 py-4",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[p.jsx(Ih,{size:18,className:"text-delulu-violet"}),p.jsx("h2",{className:"font-display font-bold text-delulu-text",children:"Freundschaftsanfragen"}),p.jsx("span",{className:"px-2 py-0.5 bg-red-100 text-red-600 text-xs font-bold rounded-full",children:Y})]}),p.jsx("div",{className:"space-y-3",children:u.map(pe=>{var Ce;return p.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:[p.jsxs("div",{className:"flex items-start gap-3",children:[p.jsx("div",{className:"w-12 h-12 rounded-full bg-delulu-violet/10 flex items-center justify-center text-lg",children:((Ce=pe.fromDisplayName[0])==null?void 0:Ce.toUpperCase())||"?"}),p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsx("p",{className:"font-semibold text-delulu-text truncate",children:pe.fromDisplayName}),p.jsxs("p",{className:"text-xs text-delulu-muted",children:["@",pe.fromUsername,"  Level ",pe.fromLevel]}),pe.message&&p.jsxs("p",{className:"text-sm text-delulu-text/70 mt-1 italic",children:['"',pe.message,'"']})]}),p.jsx("span",{className:"text-[10px] text-delulu-muted",children:Z(pe.createdAt)})]}),p.jsxs("div",{className:"flex gap-2 mt-3",children:[p.jsxs("button",{onClick:()=>ae(pe.id),disabled:U===pe.id,className:"flex-1 py-2 rounded-xl bg-gray-100 text-gray-600 font-semibold text-sm flex items-center justify-center gap-2 disabled:opacity-50",children:[p.jsx(nu,{size:16}),"Ablehnen"]}),p.jsxs("button",{onClick:()=>J(pe),disabled:U===pe.id,className:"flex-1 py-2 rounded-xl bg-delulu-violet text-white font-semibold text-sm flex items-center justify-center gap-2 disabled:opacity-50",children:[U===pe.id?p.jsx(ws,{size:16,className:"animate-spin"}):p.jsx(Jo,{size:16}),"Annehmen"]})]})]},pe.id)})})]}),o!=="requests"&&p.jsxs("div",{className:"px-6 py-4",children:[o==="all"&&u.length>0&&p.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[p.jsx(Kd,{size:18,className:"text-delulu-violet"}),p.jsx("h2",{className:"font-display font-bold text-delulu-text",children:"Aktivitten"})]}),fe.length===0?p.jsxs("div",{className:"text-center py-12",children:[p.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:p.jsx(Kd,{size:24,className:"text-gray-400"})}),p.jsx("p",{className:"font-semibold text-delulu-text mb-2",children:"Keine Benachrichtigungen"}),p.jsx("p",{className:"text-sm text-delulu-muted",children:"Neue Aktivitten erscheinen hier"})]}):p.jsx("div",{className:"space-y-2",children:fe.map(pe=>p.jsxs("div",{onClick:()=>!pe.isRead&&he(pe.id),className:`flex items-start gap-3 p-4 rounded-2xl transition-colors cursor-pointer ${pe.isRead?"bg-white hover:bg-gray-50":"bg-delulu-violet/5 hover:bg-delulu-violet/10"}`,children:[p.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${pe.isRead?"bg-gray-100":"bg-white shadow-sm"}`,children:W(pe.type)}),p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsxs("div",{className:"flex items-start justify-between gap-2",children:[p.jsx("h3",{className:`text-sm ${pe.isRead?"text-delulu-text":"font-semibold text-delulu-text"}`,children:pe.title}),p.jsx("span",{className:"text-[10px] text-delulu-muted whitespace-nowrap",children:Z(pe.timestamp)})]}),p.jsx("p",{className:"text-xs text-delulu-muted mt-0.5 truncate",children:pe.message})]}),!pe.isRead&&p.jsx("div",{className:"w-2 h-2 rounded-full bg-delulu-violet mt-2"})]},pe.id))})]}),o==="requests"&&u.length===0&&p.jsxs("div",{className:"text-center py-12 px-6",children:[p.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:p.jsx(Ih,{size:24,className:"text-gray-400"})}),p.jsx("h3",{className:"font-semibold text-delulu-text mb-2",children:"Keine Anfragen"}),p.jsx("p",{className:"text-sm text-delulu-muted",children:"Neue Freundschaftsanfragen erscheinen hier"})]})]})},DTe=()=>{const s=ei(),[r,o]=ce.useState("yearly"),[l,u]=ce.useState(!1),[f,E]=ce.useState(!1),[T,w]=ce.useState(!1),A=[{icon:p.jsx(hl,{size:20}),title:"1.5x XP Boost",description:"Verdiene 50% mehr XP bei jeder Aktivitt",isPremium:!0},{icon:p.jsx(Qi,{size:20}),title:"Unbegrenzte Sterne",description:"Verschenke so viele Sterne wie du mchtest",isPremium:!0},{icon:p.jsx(Oc,{size:20}),title:"Profilbesucher",description:"Sieh wer dein Profil besucht hat",isPremium:!0},{icon:p.jsx(Va,{size:20}),title:"Erweiterte Privatsphre",description:"Unsichtbarer Modus & Lesebesttigungen kontrollieren",isPremium:!0},{icon:p.jsx(ai,{size:20}),title:"Exklusive Lounges",description:"Zugang zu Premium-Only Voice Lounges",isPremium:!0},{icon:p.jsx(ul,{size:20}),title:"Premium Badge",description:"Zeige deinen Status mit einem goldenen Badge",isPremium:!0}],U=[{id:"monthly",name:"Monatlich",price:9.99,period:"/Monat"},{id:"yearly",name:"Jhrlich",price:4.99,period:"/Monat",savings:"50% sparen",popular:!0},{id:"lifetime",name:"Lifetime",price:149.99,period:"einmalig",savings:"Fr immer"}],M=async()=>{E(!0),"vibrate"in navigator&&navigator.vibrate([30,20,50]),await new Promise(F=>setTimeout(F,2e3)),E(!1),w(!0),"vibrate"in navigator&&navigator.vibrate([50,30,50,30,100]),setTimeout(()=>{s("/")},2500)};return p.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-amber-50 to-orange-50 safe-top safe-bottom pb-24",children:[p.jsxs("div",{className:"relative overflow-hidden",children:[p.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-amber-400 via-orange-500 to-amber-500"}),p.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent"}),p.jsxs("div",{className:"relative px-6 pt-4 pb-2 flex items-center justify-between",children:[p.jsx("button",{onClick:()=>s(-1),className:"w-10 h-10 rounded-xl bg-white/20 flex items-center justify-center text-white hover:bg-white/30 transition-colors",children:p.jsx(Is,{size:20})}),p.jsx("button",{onClick:()=>u(!l),className:"text-white/90 text-sm font-medium",children:"Vergleichen"})]}),p.jsxs("div",{className:"relative px-6 pt-4 pb-12 text-white text-center",children:[p.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-3xl bg-white/20 backdrop-blur flex items-center justify-center animate-pulse",children:p.jsx(ul,{size:40,className:"text-white"})}),p.jsx("h1",{className:"font-display text-3xl font-bold mb-2",children:"Catalyst Premium"}),p.jsx("p",{className:"text-white/80 text-sm max-w-xs mx-auto",children:"Entfessle dein volles Potenzial mit exklusiven Features"}),p.jsx("div",{className:"absolute top-8 left-8 w-3 h-3 bg-white/30 rounded-full animate-ping"}),p.jsx("div",{className:"absolute top-16 right-12 w-2 h-2 bg-white/20 rounded-full animate-bounce"}),p.jsx("div",{className:"absolute bottom-20 left-16 w-4 h-4 bg-white/20 rounded-full animate-pulse"})]})]}),p.jsx("div",{className:"px-6 -mt-6",children:p.jsxs("div",{className:"bg-white rounded-3xl shadow-xl p-6",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[p.jsx(ci,{size:20,className:"text-amber-500"}),p.jsx("h2",{className:"font-display font-bold text-lg text-delulu-text",children:"Premium Features"})]}),p.jsx("div",{className:"space-y-4",children:A.map((F,Y)=>p.jsxs("div",{className:"flex items-start gap-4",children:[p.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-amber-100 to-orange-100 flex items-center justify-center text-amber-600 flex-shrink-0",children:F.icon}),p.jsxs("div",{className:"flex-1",children:[p.jsx("h3",{className:"font-semibold text-delulu-text",children:F.title}),p.jsx("p",{className:"text-sm text-delulu-muted",children:F.description})]}),p.jsx("div",{className:"w-6 h-6 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0",children:p.jsx(Jo,{size:14,className:"text-green-600"})})]},Y))})]})}),p.jsxs("div",{className:"px-6 py-6",children:[p.jsx("h2",{className:"font-display font-bold text-lg text-delulu-text mb-4 text-center",children:"Whle deinen Plan"}),p.jsx("div",{className:"space-y-3",children:U.map(F=>p.jsxs("button",{onClick:()=>o(F.id),className:`relative w-full p-4 rounded-2xl border-2 transition-all duration-200 text-left ${r===F.id?"border-amber-400 bg-amber-50 shadow-lg scale-[1.02]":"border-gray-200 bg-white hover:border-amber-200"}`,children:[F.popular&&p.jsx("span",{className:"absolute -top-2 left-4 px-3 py-0.5 bg-gradient-to-r from-amber-400 to-orange-500 text-white text-[10px] font-bold rounded-full",children:"BELIEBT"}),p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("h3",{className:"font-semibold text-delulu-text",children:F.name}),F.savings&&p.jsx("span",{className:"text-xs text-green-600 font-medium",children:F.savings})]}),p.jsxs("div",{className:"text-right",children:[p.jsxs("span",{className:"font-display text-2xl font-bold text-delulu-text",children:["",F.price]}),p.jsx("span",{className:"text-sm text-delulu-muted",children:F.period})]})]}),p.jsx("div",{className:`absolute right-4 top-1/2 -translate-y-1/2 w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors ${r===F.id?"border-amber-500 bg-amber-500":"border-gray-300"}`,children:r===F.id&&p.jsx(Jo,{size:14,className:"text-white"})})]},F.id))})]}),p.jsx("div",{className:"px-6 pb-6",children:p.jsxs("div",{className:"bg-gradient-to-br from-violet-50 to-purple-50 rounded-2xl p-5",children:[p.jsxs("h3",{className:"font-semibold text-delulu-text mb-3 flex items-center gap-2",children:[p.jsx(oq,{size:18,className:"text-violet-500"}),"Was du bekommst"]}),p.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(hl,{size:14,className:"text-amber-500"}),p.jsx("span",{className:"text-delulu-text",children:"1.5x XP immer"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Qi,{size:14,className:"text-amber-500"}),p.jsx("span",{className:"text-delulu-text",children:" Sterne/Tag"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Oc,{size:14,className:"text-blue-500"}),p.jsx("span",{className:"text-delulu-text",children:"Profilbesucher"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Va,{size:14,className:"text-green-500"}),p.jsx("span",{className:"text-delulu-text",children:"Ghostmodus"})]})]})]})}),p.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-orange-50 via-orange-50 to-transparent safe-bottom",children:[p.jsx("button",{onClick:M,disabled:f,className:"w-full py-4 px-6 bg-gradient-to-r from-amber-400 via-orange-500 to-amber-500 text-white font-bold text-lg rounded-2xl shadow-lg shadow-orange-300/50 hover:shadow-xl hover:scale-[1.02] active:scale-[0.98] transition-all flex items-center justify-center gap-3 disabled:opacity-70 disabled:cursor-not-allowed disabled:scale-100",children:f?p.jsxs(p.Fragment,{children:[p.jsx(ws,{size:24,className:"animate-spin"}),"Wird verarbeitet..."]}):p.jsxs(p.Fragment,{children:[p.jsx(ul,{size:24}),"Premium aktivieren",p.jsx(_i,{size:20})]})}),p.jsx("p",{className:"text-center text-xs text-delulu-muted mt-3",children:"Jederzeit kndbar  7 Tage Geld-zurck-Garantie"})]}),T&&p.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-6 bg-black/60 backdrop-blur-sm",children:p.jsxs("div",{className:"w-full max-w-sm bg-white rounded-3xl shadow-2xl p-8 text-center animate-in zoom-in duration-300",children:[p.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-r from-amber-400 to-orange-500 flex items-center justify-center",children:p.jsx(ul,{size:40,className:"text-white"})}),p.jsx("h2",{className:"font-display font-bold text-2xl text-delulu-text mb-2",children:"Willkommen bei Catalyst! "}),p.jsx("p",{className:"text-delulu-muted mb-4",children:"Dein Premium-Abo ist jetzt aktiv. Geniee alle exklusiven Vorteile!"}),p.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-600",children:[p.jsx(Jo,{size:20}),p.jsx("span",{className:"font-semibold",children:"Zahlung erfolgreich"})]})]})}),l&&p.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center p-4 bg-black/60 backdrop-blur-sm",children:p.jsxs("div",{className:"w-full max-w-md bg-white rounded-t-3xl shadow-2xl overflow-hidden animate-in slide-in-from-bottom duration-300",children:[p.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[p.jsx("h2",{className:"font-display font-bold text-lg",children:"Plan-Vergleich"}),p.jsx("button",{onClick:()=>u(!1),className:"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center",children:p.jsx(nu,{size:18})})]}),p.jsx("div",{className:"p-6 max-h-[60vh] overflow-y-auto",children:p.jsxs("table",{className:"w-full text-sm",children:[p.jsx("thead",{children:p.jsxs("tr",{children:[p.jsx("th",{className:"text-left py-2",children:"Feature"}),p.jsx("th",{className:"text-center py-2",children:"Free"}),p.jsx("th",{className:"text-center py-2 text-amber-600",children:"Premium"})]})}),p.jsxs("tbody",{children:[p.jsxs("tr",{className:"border-t border-gray-100",children:[p.jsx("td",{className:"py-3",children:"XP Multiplier"}),p.jsx("td",{className:"text-center",children:"1x"}),p.jsx("td",{className:"text-center font-semibold text-amber-600",children:"1.5x"})]}),p.jsxs("tr",{className:"border-t border-gray-100",children:[p.jsx("td",{className:"py-3",children:"Sterne/Tag"}),p.jsx("td",{className:"text-center",children:"3"}),p.jsx("td",{className:"text-center font-semibold text-amber-600",children:""})]}),p.jsxs("tr",{className:"border-t border-gray-100",children:[p.jsx("td",{className:"py-3",children:"Profilbesucher"}),p.jsx("td",{className:"text-center text-red-500",children:""}),p.jsx("td",{className:"text-center text-green-500",children:""})]}),p.jsxs("tr",{className:"border-t border-gray-100",children:[p.jsx("td",{className:"py-3",children:"Premium Lounges"}),p.jsx("td",{className:"text-center text-red-500",children:""}),p.jsx("td",{className:"text-center text-green-500",children:""})]}),p.jsxs("tr",{className:"border-t border-gray-100",children:[p.jsx("td",{className:"py-3",children:"Ghostmodus"}),p.jsx("td",{className:"text-center text-red-500",children:""}),p.jsx("td",{className:"text-center text-green-500",children:""})]}),p.jsxs("tr",{className:"border-t border-gray-100",children:[p.jsx("td",{className:"py-3",children:"Premium Badge"}),p.jsx("td",{className:"text-center text-red-500",children:""}),p.jsx("td",{className:"text-center text-green-500",children:""})]}),p.jsxs("tr",{className:"border-t border-gray-100",children:[p.jsx("td",{className:"py-3",children:"Werbefrei"}),p.jsx("td",{className:"text-center text-red-500",children:""}),p.jsx("td",{className:"text-center text-green-500",children:""})]})]})]})})]})})]})},Ox=[{id:"harassment",label:"Belstigung",icon:p.jsx(ik,{size:16})},{id:"spam",label:"Spam / Werbung",icon:p.jsx(Kh,{size:16})},{id:"inappropriate",label:"Unangemessenes Verhalten",icon:p.jsx(iq,{size:16})},{id:"personal",label:"Persnliche Grnde",icon:p.jsx(Ah,{size:16})},{id:"other",label:"Sonstiges",icon:p.jsx(nq,{size:16})}],kTe=[{id:"b1",username:"toxic_user",displayName:"Toxic Person",blockedAt:new Date(Date.now()-7*24*60*60*1e3),reason:"harassment"},{id:"b2",username:"spammer99",displayName:"Spam Bot",blockedAt:new Date(Date.now()-30*24*60*60*1e3),reason:"spam"}],LTe=()=>{const s=ei(),{user:r,isVerifiedStar:o}=vi(),{language:l,setLanguage:u}=Of(),[f,E]=ce.useState(null),[T,w]=ce.useState((r==null?void 0:r.isGlobalAnonymous)||!1),[A,U]=ce.useState(!0),[M,F]=ce.useState(!0),[Y,J]=ce.useState(!0),[ae,he]=ce.useState(!0),[ee,W]=ce.useState(!0),[Z,fe]=ce.useState(!0),[pe,Ce]=ce.useState(!0),[te,q]=ce.useState(kTe),[re,$]=ce.useState(null),[le,ue]=ce.useState(!1),[ie,tt]=ce.useState(!1),[Ot,on]=ce.useState(""),[It,Ge]=ce.useState(!1),nt=(r==null?void 0:r.totalStarsReceived)||0,pt=(r==null?void 0:r.level)||1,ot=(r==null?void 0:r.totalVoiceMinutes)||0,Et=(r==null?void 0:r.positiveRatings)||0,un=(r==null?void 0:r.totalRatings)||1,In=Math.round(Et/un*100),zn={stars:Math.min(100,nt/Or.starsRequired*100),level:Math.min(100,pt/Or.levelRequired*100),voice:Math.min(100,ot/Or.voiceMinutesRequired*100),ratings:Math.min(100,In/Or.minPositiveRatings*100)},Sr=nt>=Or.starsRequired&&pt>=Or.levelRequired&&ot>=Or.voiceMinutesRequired&&In>=Or.minPositiveRatings,Je=it=>sl[it].native,Kt=it=>{q($n=>$n.filter($s=>$s.id!==it)),$(null),"vibrate"in navigator&&navigator.vibrate(10)},lr=()=>{console.log("Pausing account..."),ue(!1)},Qn=async()=>{Ot.toLowerCase()==="lschen"&&(Ge(!0),await new Promise(it=>setTimeout(it,2e3)),console.log("Deleting account..."),Ge(!1),tt(!1))},ms=it=>it.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"});return p.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white safe-top safe-bottom pb-24",children:[p.jsx("div",{className:"sticky top-0 z-20 bg-white/90 backdrop-blur-lg border-b border-gray-100",children:p.jsxs("div",{className:"px-6 py-4 flex items-center gap-4",children:[p.jsx("button",{onClick:()=>f?E(null):s(-1),className:"w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-delulu-muted hover:bg-gray-200 transition-colors",children:p.jsx(Is,{size:20})}),p.jsx("div",{className:"flex-1",children:p.jsxs("h1",{className:"font-display text-xl font-bold text-delulu-text",children:[f==="account"&&"Account",f==="privacy"&&"Privatsphre",f==="notifications"&&"Benachrichtigungen",f==="blocked"&&"Blockierte User",f==="danger"&&"Account-Einstellungen",f==="language"&&"Sprache",f==="creator"&&"Creator werden",f==="legal"&&"Rechtliches",!f&&"Einstellungen"]})})]})}),!f&&p.jsxs("div",{className:"px-6 py-4 space-y-4",children:[p.jsx("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:p.jsxs("button",{onClick:()=>s("/profile"),className:"w-full flex items-center gap-4 p-4 hover:bg-gray-50 transition-colors",children:[p.jsx("div",{className:"w-14 h-14 rounded-2xl bg-delulu-violet/10 flex items-center justify-center",children:r!=null&&r.avatarUrl?p.jsx("img",{src:r.avatarUrl,alt:"",className:"w-full h-full rounded-2xl object-cover"}):p.jsx(Ah,{size:24,className:"text-delulu-violet"})}),p.jsxs("div",{className:"flex-1 text-left",children:[p.jsx("h3",{className:"font-semibold text-delulu-text",children:(r==null?void 0:r.displayName)||"Dein Profil"}),p.jsxs("p",{className:"text-sm text-delulu-muted",children:["@",(r==null?void 0:r.username)||"username"]})]}),p.jsx(_i,{size:20,className:"text-delulu-muted"})]})}),p.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden divide-y divide-gray-100",children:[p.jsx(yc,{icon:p.jsx(tu,{size:20}),label:"Account & Sicherheit",sublabel:"Passwort, E-Mail",onClick:()=>E("account")}),p.jsx(yc,{icon:p.jsx(Va,{size:20}),label:"Privatsphre",sublabel:"Anonymitt, Sichtbarkeit",onClick:()=>E("privacy")}),p.jsx(yc,{icon:p.jsx(Kd,{size:20}),label:"Benachrichtigungen",sublabel:"Push, Sound, Filter",onClick:()=>E("notifications")}),p.jsx(yc,{icon:p.jsx(i8,{size:20}),label:"Blockierte User",sublabel:`${te.length} blockiert`,onClick:()=>E("blocked")})]}),!(r!=null&&r.isPremium)&&p.jsx("button",{onClick:()=>s("/premium"),className:"w-full bg-gradient-to-r from-amber-400 to-orange-500 rounded-2xl p-4 text-white text-left",children:p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(ul,{size:24}),p.jsxs("div",{className:"flex-1",children:[p.jsx("h3",{className:"font-semibold",children:"Catalyst Premium"}),p.jsx("p",{className:"text-sm text-white/80",children:"1.5x XP,  Sterne & mehr"})]}),p.jsx(_i,{size:20})]})}),!o&&p.jsx("button",{onClick:()=>E("creator"),className:"w-full bg-gradient-to-r from-purple-500/10 to-pink-500/10 border border-purple-500/30 rounded-2xl p-4 text-left",children:p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center",children:p.jsx(ci,{size:24,className:"text-white"})}),p.jsxs("div",{className:"flex-1",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("h3",{className:"font-semibold text-delulu-text",children:"Creator werden"}),Sr&&p.jsx("span",{className:"px-1.5 py-0.5 bg-green-100 rounded text-[10px] font-bold text-green-600",children:" Berechtigt"})]}),p.jsx("p",{className:"text-xs text-delulu-muted",children:Sr?"Jetzt bewerben!":"Dein Fortschritt zum Stars Programm"})]}),p.jsx(_i,{size:20,className:"text-delulu-muted"})]})}),o&&p.jsx("button",{onClick:()=>s("/stars/dashboard"),className:"w-full bg-gradient-to-r from-amber-500/20 to-orange-500/20 border border-amber-500/30 rounded-2xl p-4 text-left",children:p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center",children:p.jsx(Ib,{size:24,className:"text-white"})}),p.jsxs("div",{className:"flex-1",children:[p.jsx("h3",{className:"font-semibold text-delulu-text",children:"Star Dashboard"}),p.jsx("p",{className:"text-xs text-delulu-muted",children:"Analytics, Events & mehr"})]}),p.jsx(_i,{size:20,className:"text-delulu-muted"})]})}),p.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden divide-y divide-gray-100",children:[p.jsx(yc,{icon:p.jsx(SR,{size:20}),label:"Hilfe & FAQ",onClick:()=>s("/help")}),p.jsx(yc,{icon:p.jsx(jE,{size:20}),label:"Sprache",sublabel:Je(l),onClick:()=>E("language")}),p.jsx(yc,{icon:p.jsx(rP,{size:20}),label:"Rechtliches",sublabel:"Impressum & Datenschutz",onClick:()=>E("legal")})]}),p.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden divide-y divide-gray-100",children:[p.jsx(yc,{icon:p.jsx(e8,{size:20,className:"text-amber-500"}),label:"Account pausieren",sublabel:"Temporr deaktivieren",onClick:()=>ue(!0),dangerous:!0}),p.jsx(yc,{icon:p.jsx(O0,{size:20,className:"text-red-500"}),label:"Account lschen",sublabel:"Unwiderruflich",onClick:()=>tt(!0),dangerous:!0})]}),p.jsxs("button",{onClick:()=>console.log("Logout"),className:"w-full flex items-center justify-center gap-2 py-4 text-red-500 font-semibold",children:[p.jsx(cq,{size:20}),"Abmelden"]})]}),f==="account"&&p.jsxs("div",{className:"px-6 py-4 space-y-4",children:[p.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden divide-y divide-gray-100",children:[p.jsx(yc,{icon:p.jsx(tu,{size:20}),label:"Passwort ndern",onClick:()=>console.log("Change password")}),p.jsxs("div",{className:"p-4",children:[p.jsx("label",{className:"text-sm text-delulu-muted",children:"E-Mail Adresse"}),p.jsx("p",{className:"font-medium text-delulu-text mt-1",children:(r==null?void 0:r.email)||"user@example.com"})]})]}),p.jsx("div",{className:"p-4 bg-blue-50 rounded-2xl",children:p.jsxs("p",{className:"text-sm text-blue-700",children:[p.jsx("strong",{children:"Tipp:"})," Verwende ein starkes Passwort mit mindestens 12 Zeichen, Gro- und Kleinbuchstaben, Zahlen und Sonderzeichen."]})})]}),f==="privacy"&&p.jsxs("div",{className:"px-6 py-4 space-y-4",children:[p.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden divide-y divide-gray-100",children:[p.jsx(Sd,{icon:p.jsx(_l,{size:20}),label:"Globaler Anonym-Modus",sublabel:"Erscheine immer als anonymer User",value:T,onChange:w}),p.jsx(Sd,{icon:p.jsx(Oc,{size:20}),label:"Online-Status zeigen",sublabel:"Andere sehen, wann du aktiv bist",value:A,onChange:U}),p.jsx(Sd,{icon:p.jsx(Jo,{size:20}),label:"Lesebesttigungen",sublabel:"Zeige, wenn du Nachrichten gelesen hast",value:M,onChange:F})]}),T&&p.jsxs("div",{className:"p-4 bg-green-50 rounded-2xl flex items-start gap-3",children:[p.jsx(Va,{size:20,className:"text-green-600 flex-shrink-0 mt-0.5"}),p.jsxs("div",{children:[p.jsx("p",{className:"font-semibold text-green-800",children:"Anonymer Modus aktiv"}),p.jsxs("p",{className:"text-sm text-green-700 mt-1",children:['Dein Profilbild ist verschleiert. Du erscheinst als "',(r==null?void 0:r.anonymousAlias)||"Wanderer_"+Math.floor(Math.random()*9999),'".']})]})]})]}),f==="notifications"&&p.jsxs("div",{className:"px-6 py-4 space-y-4",children:[p.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden divide-y divide-gray-100",children:[p.jsx(Sd,{icon:p.jsx(Kd,{size:20}),label:"Push-Benachrichtigungen",sublabel:"Erhalte Benachrichtigungen auf dein Gert",value:Y,onChange:J}),p.jsx(Sd,{icon:p.jsx(ok,{size:20}),label:"Sounds",sublabel:"Tne bei Benachrichtigungen",value:ae,onChange:he})]}),p.jsx("h3",{className:"font-semibold text-delulu-text px-1",children:"Benachrichtige mich bei:"}),p.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden divide-y divide-gray-100",children:[p.jsx(Sd,{icon:p.jsx(Qi,{size:20,className:"text-amber-500"}),label:"Sterne erhalten",value:ee,onChange:W}),p.jsx(Sd,{icon:p.jsx(Ah,{size:20,className:"text-blue-500"}),label:"Neue Follower & Anfragen",value:Z,onChange:fe}),p.jsx(Sd,{icon:p.jsx(Ib,{size:20,className:"text-purple-500"}),label:"Star geht live",sublabel:"Benachrichtigung wenn Stars Events starten",value:pe,onChange:Ce})]})]}),f==="blocked"&&p.jsxs("div",{className:"px-6 py-4",children:[te.length===0?p.jsxs("div",{className:"text-center py-12",children:[p.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:p.jsx(i8,{size:24,className:"text-gray-400"})}),p.jsx("h3",{className:"font-semibold text-delulu-text mb-2",children:"Keine blockierten User"}),p.jsx("p",{className:"text-sm text-delulu-muted",children:"User, die du blockierst, erscheinen hier"})]}):p.jsx("div",{className:"space-y-3",children:te.map(it=>{var $n,$s;return p.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:[p.jsxs("div",{className:"flex items-start gap-3",children:[p.jsx("div",{className:"w-12 h-12 rounded-xl bg-gray-200 flex items-center justify-center",children:p.jsx(Ah,{size:20,className:"text-gray-500"})}),p.jsxs("div",{className:"flex-1",children:[p.jsx("h3",{className:"font-semibold text-delulu-text",children:it.displayName}),p.jsxs("p",{className:"text-sm text-delulu-muted",children:["@",it.username]}),p.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[p.jsxs("span",{className:"text-xs px-2 py-0.5 bg-red-100 text-red-600 rounded-full flex items-center gap-1",children:[($n=Ox.find(xe=>xe.id===it.reason))==null?void 0:$n.icon,($s=Ox.find(xe=>xe.id===it.reason))==null?void 0:$s.label]}),p.jsx("span",{className:"text-xs text-delulu-muted",children:ms(it.blockedAt)})]})]})]}),re===it.id?p.jsxs("div",{className:"mt-4 flex gap-2",children:[p.jsx("button",{onClick:()=>Kt(it.id),className:"flex-1 py-2 px-4 bg-green-500 text-white rounded-xl font-semibold text-sm",children:"Ja, entblocken"}),p.jsx("button",{onClick:()=>$(null),className:"flex-1 py-2 px-4 bg-gray-100 text-gray-600 rounded-xl font-semibold text-sm",children:"Abbrechen"})]}):p.jsx("button",{onClick:()=>$(it.id),className:"mt-4 w-full py-2 px-4 bg-gray-100 text-gray-600 rounded-xl font-semibold text-sm hover:bg-gray-200 transition-colors",children:"Entblocken"})]},it.id)})}),p.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-2xl",children:[p.jsxs("h4",{className:"font-semibold text-delulu-text mb-3 flex items-center gap-2",children:[p.jsx(nq,{size:16}),"Block-Grnde"]}),p.jsx("div",{className:"space-y-2",children:Ox.map(it=>p.jsxs("div",{className:"flex items-center gap-2 text-sm text-delulu-muted",children:[it.icon,p.jsx("span",{children:it.label})]},it.id))})]})]}),f==="language"&&p.jsxs("div",{className:"px-6 py-4 space-y-4",children:[p.jsx("p",{className:"text-sm text-delulu-muted",children:"Whle deine bevorzugte Sprache. Die App wird sofort in der gewhlten Sprache angezeigt."}),p.jsx("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden divide-y divide-gray-100",children:Object.keys(sl).map(it=>p.jsxs("button",{onClick:()=>u(it),className:"w-full flex items-center gap-4 p-4 hover:bg-gray-50 transition-colors text-left",children:[p.jsx("div",{className:"w-10 h-10 rounded-xl bg-delulu-violet/10 flex items-center justify-center text-lg",children:sl[it].flag}),p.jsxs("div",{className:"flex-1",children:[p.jsx("h3",{className:"font-semibold text-delulu-text",children:sl[it].native}),p.jsx("p",{className:"text-xs text-delulu-muted",children:sl[it].name})]}),l===it&&p.jsx(Jo,{size:20,className:"text-green-500"})]},it))})]}),f==="creator"&&p.jsxs("div",{className:"px-6 py-4 space-y-4",children:[Sr?p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"p-4 bg-green-50 rounded-2xl flex items-start gap-3",children:[p.jsx(rl,{size:24,className:"text-green-600 flex-shrink-0"}),p.jsxs("div",{children:[p.jsx("p",{className:"font-semibold text-green-800",children:"Du bist berechtigt!"}),p.jsx("p",{className:"text-sm text-green-700 mt-1",children:"Du erfllst alle Anforderungen und kannst dich jetzt als Creator bewerben."})]})]}),p.jsxs("button",{onClick:()=>s("/stars/apply"),className:"w-full py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl font-semibold flex items-center justify-center gap-2",children:[p.jsx(ci,{size:20}),"Jetzt als Creator bewerben"]})]}):p.jsxs(p.Fragment,{children:[p.jsx("p",{className:"text-sm text-delulu-muted",children:"Erflle die folgenden Anforderungen, um dich als Creator zu bewerben:"}),p.jsxs("div",{className:"bg-white rounded-2xl shadow-sm p-4 space-y-4",children:[p.jsxs("div",{children:[p.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[p.jsxs("span",{className:"flex items-center gap-2 text-delulu-muted",children:[p.jsx(Qi,{size:16,className:"text-amber-500"}),"Sterne erhalten"]}),p.jsxs("span",{className:nt>=Or.starsRequired?"text-green-500 font-medium":"text-delulu-muted",children:[nt," / ",Or.starsRequired]})]}),p.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:p.jsx("div",{className:`h-full rounded-full transition-all ${nt>=Or.starsRequired?"bg-green-500":"bg-amber-400"}`,style:{width:`${zn.stars}%`}})})]}),p.jsxs("div",{children:[p.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[p.jsxs("span",{className:"flex items-center gap-2 text-delulu-muted",children:[p.jsx(Ab,{size:16,className:"text-purple-500"}),"Level"]}),p.jsxs("span",{className:pt>=Or.levelRequired?"text-green-500 font-medium":"text-delulu-muted",children:[pt," / ",Or.levelRequired]})]}),p.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:p.jsx("div",{className:`h-full rounded-full transition-all ${pt>=Or.levelRequired?"bg-green-500":"bg-purple-400"}`,style:{width:`${zn.level}%`}})})]}),p.jsxs("div",{children:[p.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[p.jsxs("span",{className:"flex items-center gap-2 text-delulu-muted",children:[p.jsx(Th,{size:16,className:"text-blue-500"}),"Voice-Minuten"]}),p.jsxs("span",{className:ot>=Or.voiceMinutesRequired?"text-green-500 font-medium":"text-delulu-muted",children:[ot," / ",Or.voiceMinutesRequired]})]}),p.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:p.jsx("div",{className:`h-full rounded-full transition-all ${ot>=Or.voiceMinutesRequired?"bg-green-500":"bg-blue-400"}`,style:{width:`${zn.voice}%`}})})]}),p.jsxs("div",{children:[p.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[p.jsxs("span",{className:"flex items-center gap-2 text-delulu-muted",children:[p.jsx(ai,{size:16,className:"text-green-500"}),"Positive Bewertungen"]}),p.jsxs("span",{className:In>=Or.minPositiveRatings?"text-green-500 font-medium":"text-delulu-muted",children:[In,"% / ",Or.minPositiveRatings,"%"]})]}),p.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:p.jsx("div",{className:`h-full rounded-full transition-all ${In>=Or.minPositiveRatings?"bg-green-500":"bg-green-400"}`,style:{width:`${zn.ratings}%`}})})]})]}),p.jsx("div",{className:"p-4 bg-purple-50 rounded-2xl",children:p.jsxs("p",{className:"text-sm text-purple-800",children:[p.jsx("strong",{children:"Tipp:"})," Sei aktiv in Voice-Rumen, sammle Sterne von anderen Nutzern und erreiche ein hohes Level durch regelmige Nutzung!"]})})]}),p.jsxs("div",{className:"pt-4 border-t border-gray-200",children:[p.jsx("p",{className:"text-sm text-delulu-muted mb-3",children:"Oder bewerbe dich als Influencer/VIP, wenn du bereits eine Fangemeinde hast:"}),p.jsx("button",{onClick:()=>s("/stars/apply"),className:"w-full py-3 border-2 border-purple-300 text-purple-600 rounded-xl font-semibold",children:"Als Influencer bewerben "})]})]}),f==="legal"&&p.jsxs("div",{className:"px-6 py-4 space-y-4",children:[p.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden divide-y divide-gray-100",children:[p.jsxs("button",{onClick:()=>s("/impressum"),className:"w-full flex items-center gap-4 p-4 hover:bg-gray-50 transition-colors text-left",children:[p.jsx("div",{className:"w-10 h-10 rounded-xl bg-delulu-violet/10 flex items-center justify-center",children:p.jsx(rP,{size:20,className:"text-delulu-violet"})}),p.jsxs("div",{className:"flex-1",children:[p.jsx("h3",{className:"font-semibold text-delulu-text",children:"Impressum"}),p.jsx("p",{className:"text-sm text-delulu-muted",children:"Anbieterinformationen"})]}),p.jsx(_i,{size:20,className:"text-delulu-muted"})]}),p.jsxs("button",{onClick:()=>s("/datenschutz"),className:"w-full flex items-center gap-4 p-4 hover:bg-gray-50 transition-colors text-left",children:[p.jsx("div",{className:"w-10 h-10 rounded-xl bg-delulu-violet/10 flex items-center justify-center",children:p.jsx(Va,{size:20,className:"text-delulu-violet"})}),p.jsxs("div",{className:"flex-1",children:[p.jsx("h3",{className:"font-semibold text-delulu-text",children:"Datenschutz"}),p.jsx("p",{className:"text-sm text-delulu-muted",children:"Datenschutzerklrung"})]}),p.jsx(_i,{size:20,className:"text-delulu-muted"})]})]}),p.jsx("div",{className:"p-4 bg-gray-50 rounded-2xl text-center",children:p.jsxs("p",{className:"text-sm text-delulu-muted",children:["delulu App v1.0.0",p.jsx("br",{})," 2025 Butterbread UG"]})})]}),le&&p.jsx(l8,{onClose:()=>ue(!1),children:p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"w-16 h-16 bg-amber-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:p.jsx(e8,{size:32,className:"text-amber-600"})}),p.jsx("h2",{className:"font-display text-xl font-bold text-delulu-text mb-2",children:"Account pausieren?"}),p.jsx("p",{className:"text-sm text-delulu-muted mb-6",children:"Dein Profil wird fr andere unsichtbar. Du kannst jederzeit zurckkehren und all deine Daten bleiben erhalten."}),p.jsxs("div",{className:"flex gap-3",children:[p.jsx("button",{onClick:()=>ue(!1),className:"flex-1 py-3 px-4 bg-gray-100 text-gray-600 rounded-xl font-semibold",children:"Abbrechen"}),p.jsx("button",{onClick:lr,className:"flex-1 py-3 px-4 bg-amber-500 text-white rounded-xl font-semibold",children:"Pausieren"})]})]})}),ie&&p.jsx(l8,{onClose:()=>tt(!1),children:p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:p.jsx(O0,{size:32,className:"text-red-600"})}),p.jsx("h2",{className:"font-display text-xl font-bold text-delulu-text mb-2",children:"Account unwiderruflich lschen?"}),p.jsx("p",{className:"text-sm text-delulu-muted mb-6",children:"Alle deine Daten, Freundschaften, Sterne und XP werden permanent gelscht. Diese Aktion kann nicht rckgngig gemacht werden."}),p.jsxs("div",{className:"mb-6",children:[p.jsx("label",{className:"text-sm text-delulu-muted block mb-2",children:'Tippe "LSCHEN" zur Besttigung:'}),p.jsx("input",{type:"text",value:Ot,onChange:it=>on(it.target.value),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-red-500 focus:outline-none text-center font-mono",placeholder:"LSCHEN"})]}),p.jsxs("div",{className:"flex gap-3",children:[p.jsx("button",{onClick:()=>tt(!1),className:"flex-1 py-3 px-4 bg-gray-100 text-gray-600 rounded-xl font-semibold",children:"Abbrechen"}),p.jsx("button",{onClick:Qn,disabled:Ot.toLowerCase()!=="lschen"||It,className:"flex-1 py-3 px-4 bg-red-500 text-white rounded-xl font-semibold disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:It?p.jsx(ws,{size:18,className:"animate-spin"}):p.jsxs(p.Fragment,{children:[p.jsx(O0,{size:18}),"Lschen"]})})]})]})})]})},yc=({icon:s,label:r,sublabel:o,onClick:l,dangerous:u})=>p.jsxs("button",{onClick:l,className:"w-full flex items-center gap-4 p-4 hover:bg-gray-50 transition-colors text-left",children:[p.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${u?"bg-red-50 text-red-500":"bg-delulu-violet/10 text-delulu-violet"}`,children:s}),p.jsxs("div",{className:"flex-1",children:[p.jsx("h3",{className:`font-semibold ${u?"text-red-600":"text-delulu-text"}`,children:r}),o&&p.jsx("p",{className:"text-sm text-delulu-muted",children:o})]}),p.jsx(_i,{size:20,className:"text-delulu-muted"})]}),Sd=({icon:s,label:r,sublabel:o,value:l,onChange:u})=>p.jsxs("div",{className:"flex items-center gap-4 p-4",children:[p.jsx("div",{className:"w-10 h-10 rounded-xl bg-delulu-violet/10 flex items-center justify-center text-delulu-violet",children:s}),p.jsxs("div",{className:"flex-1",children:[p.jsx("h3",{className:"font-semibold text-delulu-text",children:r}),o&&p.jsx("p",{className:"text-sm text-delulu-muted",children:o})]}),p.jsx("button",{onClick:()=>u(!l),className:`relative w-12 h-7 rounded-full transition-colors ${l?"bg-delulu-violet":"bg-gray-200"}`,children:p.jsx("div",{className:`absolute top-1 w-5 h-5 rounded-full bg-white shadow-sm transition-transform ${l?"left-6":"left-1"}`})})]}),l8=({children:s,onClose:r})=>p.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-6 bg-black/60 backdrop-blur-sm",children:p.jsxs("div",{className:"relative w-full max-w-sm bg-white rounded-3xl p-6 shadow-2xl animate-in zoom-in-95",children:[p.jsx("button",{onClick:r,className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center",children:p.jsx(nu,{size:18})}),s]})}),Px=[{category:"allgemein",question:"Was ist delulu?",answer:'delulu ist eine hyperlocal Community-App, die Menschen in deiner Nhe per Voice-Chat verbindet. Tauche in die "Wolke" ein und triff neue Leute spontan und unkompliziert.'},{category:"allgemein",question:"Wie funktioniert die Wolke?",answer:"Die Wolke zeigt dir Rume mit aktiven Usern in deiner Umgebung. Tippe einfach auf die groe Wolke auf der Home-Seite, und du wirst automatisch mit jemandem verbunden, der gerade online ist."},{category:"allgemein",question:"Ist delulu kostenlos?",answer:"Ja! Die Grundfunktionen sind komplett kostenlos. Mit Catalyst Premium bekommst du zustzliche Features wie 1.5x XP, unbegrenzte Sterne und die Mglichkeit zu sehen, wer dein Profil besucht hat."},{category:"voice",question:"Wie starte ich einen Voice-Chat?",answer:"Gehe auf die Home-Seite und tippe auf die Wolke. Du wirst gefragt, ob du anonym oder ffentlich beitreten mchtest. Danach wirst du mit einem aktiven Raum verbunden."},{category:"voice",question:"Warum bin ich am Anfang stumm geschaltet?",answer:"Neue Teilnehmer haben eine kurze Redepause von 4 Sekunden. Das gibt dir Zeit, erst mal zuzuhren und den Kontext des Gesprchs zu verstehen, bevor du dich einbringst."},{category:"voice",question:"Kann ich aus einem Raum rausgeworfen werden?",answer:"Einzelne Personen knnen dich nicht kicken. Bei schlechtem Verhalten knnen andere User jedoch eine Abstimmung starten, um dich aus dem Raum zu entfernen."},{category:"sicherheit",question:"Was ist der Anonym-Modus?",answer:'Im Anonym-Modus wird dein Profilbild verschwommen angezeigt und du erscheinst unter einem zuflligen Alias wie "Wanderer_4821". Dein echter Username bleibt verborgen.'},{category:"sicherheit",question:"Wie blockiere ich jemanden?",answer:"Gehe zu Einstellungen  Blockierte User. Dort kannst du User blockieren und auch den Grund angeben (Belstigung, Spam, etc.). Blockierte User knnen dich nicht mehr sehen oder kontaktieren."},{category:"sicherheit",question:"Werden meine Gesprche aufgezeichnet?",answer:"Nein. Voice-Chats werden nicht aufgezeichnet oder gespeichert. Alle Gesprche sind live und ephemer - sobald du den Raum verlsst, sind sie weg."},{category:"xp",question:"Wie verdiene ich XP?",answer:"Du verdienst XP durch: Voice-Chats (pro Minute), Sterne erhalten (15 XP pro Stern), tgliche Logins (Streak-Bonus), und regionale Events (bis zu 3x XP in bestimmten Zonen)."},{category:"xp",question:"Was bringt mir ein hheres Level?",answer:'Mit jedem Level steigt dein Ansehen in der Community. Hhere Level bekommen spezielle Titel (z.B. "Socialite" ab Level 31), vergrerte Trust-Badges und Zugang zu exklusiven Features.'},{category:"xp",question:"Was sind Sterne und wie funktionieren sie?",answer:"Sterne sind virtuelle Geschenke, die du anderen Usern geben kannst. Jeder Stern ist 15 XP wert. Free User knnen 3 Sterne pro Tag verschenken, Premium User unbegrenzt viele."},{category:"freunde",question:"Wie fge ich Freunde hinzu?",answer:'Sende eine Freundschaftsanfrage ber das Profil eines Users. Freundschaft in delulu funktioniert nach dem "Handshake"-Prinzip - beide mssen besttigen.'},{category:"freunde",question:"Was ist der Unterschied zwischen Folgen und Freundschaft?",answer:"Folgen ist einseitig (wie auf Twitter) - du siehst Updates von jemandem. Freundschaft ist gegenseitig und schaltet zustzliche Features wie Direktnachrichten frei."},{category:"freunde",question:"Mit wem kann ich chatten?",answer:"Du kannst nur mit Freunden oder Usern chatten, die du bereits in der App getroffen hast. Das schtzt vor unerwnschten Nachrichten von Fremden."}],MTe=[{id:"allgemein",label:"Allgemein",icon:SR},{id:"voice",label:"Voice Chat",icon:Cl},{id:"sicherheit",label:"Sicherheit",icon:Va},{id:"xp",label:"XP & Level",icon:Qi},{id:"freunde",label:"Freundschaften",icon:ai}],UTe=()=>{const s=ei(),[r,o]=ce.useState(null),[l,u]=ce.useState(null),[f,E]=ce.useState(""),T=f?Px.filter(A=>A.question.toLowerCase().includes(f.toLowerCase())||A.answer.toLowerCase().includes(f.toLowerCase())):r?Px.filter(A=>A.category===r):Px,w=A=>{u(l===A?null:A)};return p.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white safe-top safe-bottom pb-24",children:[p.jsxs("div",{className:"sticky top-0 z-20 bg-white/90 backdrop-blur-lg border-b border-gray-100",children:[p.jsxs("div",{className:"px-6 py-4 flex items-center gap-4",children:[p.jsx("button",{onClick:()=>s(-1),className:"w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-delulu-muted hover:bg-gray-200 transition-colors",children:p.jsx(Is,{size:20})}),p.jsxs("div",{className:"flex-1",children:[p.jsx("h1",{className:"font-display text-xl font-bold text-delulu-text",children:"Hilfe & FAQ"}),p.jsx("p",{className:"text-xs text-delulu-muted",children:"Finde Antworten auf deine Fragen"})]})]}),p.jsx("div",{className:"px-6 pb-4",children:p.jsxs("div",{className:"relative",children:[p.jsx(iP,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-delulu-muted"}),p.jsx("input",{type:"text",value:f,onChange:A=>E(A.target.value),placeholder:"Suche in den FAQ...",className:"w-full pl-11 pr-4 py-3 bg-gray-100 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-delulu-violet/30"})]})})]}),!f&&p.jsx("div",{className:"px-6 py-4",children:p.jsxs("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide pb-2",children:[p.jsx("button",{onClick:()=>o(null),className:`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-semibold whitespace-nowrap transition-all ${r?"bg-gray-100 text-delulu-muted hover:bg-gray-200":"bg-delulu-violet text-white shadow-lg"}`,children:"Alle"}),MTe.map(A=>p.jsxs("button",{onClick:()=>o(A.id),className:`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-semibold whitespace-nowrap transition-all ${r===A.id?"bg-delulu-violet text-white shadow-lg":"bg-gray-100 text-delulu-muted hover:bg-gray-200"}`,children:[p.jsx(A.icon,{size:16}),A.label]},A.id))]})}),p.jsx("div",{className:"px-6 space-y-3",children:T.length===0?p.jsxs("div",{className:"text-center py-12",children:[p.jsx(SR,{size:48,className:"mx-auto text-gray-300 mb-4"}),p.jsx("p",{className:"text-delulu-muted",children:"Keine Ergebnisse gefunden"})]}):T.map((A,U)=>p.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:[p.jsxs("button",{onClick:()=>w(A.question),className:"w-full flex items-center justify-between p-4 text-left",children:[p.jsx("span",{className:"font-semibold text-delulu-text pr-4",children:A.question}),l===A.question?p.jsx(rq,{size:20,className:"text-delulu-violet flex-shrink-0"}):p.jsx(_i,{size:20,className:"text-delulu-muted flex-shrink-0"})]}),l===A.question&&p.jsx("div",{className:"px-4 pb-4 pt-0",children:p.jsx("div",{className:"bg-gray-50 rounded-xl p-4",children:p.jsx("p",{className:"text-sm text-delulu-text leading-relaxed",children:A.answer})})})]},U))}),p.jsx("div",{className:"px-6 py-8",children:p.jsxs("div",{className:"bg-gradient-to-br from-delulu-violet/10 to-purple-100 rounded-2xl p-6 text-center",children:[p.jsx(Kh,{size:32,className:"mx-auto text-delulu-violet mb-3"}),p.jsx("h3",{className:"font-display font-bold text-delulu-text mb-2",children:"Noch Fragen?"}),p.jsx("p",{className:"text-sm text-delulu-muted mb-4",children:"Unser Support-Team hilft dir gerne weiter"}),p.jsxs("div",{className:"flex flex-col gap-3",children:[p.jsxs("a",{href:"mailto:support@delulu.app",className:"flex items-center justify-center gap-2 py-3 px-4 bg-delulu-violet text-white rounded-xl font-semibold hover:bg-delulu-violet/90 transition-colors",children:[p.jsx(wb,{size:18}),"E-Mail schreiben"]}),p.jsxs("a",{href:"https://delulu.app/help",target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 py-3 px-4 bg-white text-delulu-text rounded-xl font-semibold hover:bg-gray-50 transition-colors border border-gray-200",children:[p.jsx(WSe,{size:18}),"Hilfe-Center besuchen"]})]})]})}),p.jsx("div",{className:"px-6 pb-8",children:p.jsxs("div",{className:"flex justify-center gap-6 text-xs text-delulu-muted",children:[p.jsx("a",{href:"/privacy",className:"hover:text-delulu-violet",children:"Datenschutz"}),p.jsx("a",{href:"/terms",className:"hover:text-delulu-violet",children:"AGB"}),p.jsx("a",{href:"/imprint",className:"hover:text-delulu-violet",children:"Impressum"})]})})]})},jTe=()=>{const s=ei(),[r]=Dpe(),{user:o}=vi(),l=(o==null?void 0:o.totalStarsReceived)||0,u=(o==null?void 0:o.level)||1,f=(o==null?void 0:o.totalVoiceMinutes)||0,E=(o==null?void 0:o.positiveRatings)||0,T=(o==null?void 0:o.totalRatings)||1,w=Math.round(E/T*100),A=ce.useMemo(()=>l>=Or.starsRequired&&u>=Or.levelRequired&&f>=Or.voiceMinutesRequired&&w>=Or.minPositiveRatings,[l,u,f,w]),U=r.get("path"),[M,F]=ce.useState(U==="community"&&A?"community":"vip"),[Y,J]=ce.useState("intro"),[ae,he]=ce.useState(!1),[ee,W]=ce.useState(M==="community"?"creator":null),[Z,fe]=ce.useState(""),[pe,Ce]=ce.useState(""),[te,q]=ce.useState([]),[re,$]=ce.useState([]),le=()=>p.jsxs("div",{className:"text-center px-4",children:[A&&p.jsxs("div",{className:"mb-6 p-1 bg-gray-800/50 rounded-xl flex",children:[p.jsx("button",{onClick:()=>F("vip"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${M==="vip"?"bg-purple-500 text-white":"text-gray-400 hover:text-white"}`,children:"VIP / Influencer"}),p.jsx("button",{onClick:()=>{F("community"),W("creator")},className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${M==="community"?"bg-green-500 text-white":"text-gray-400 hover:text-white"}`,children:"Community Creator"})]}),p.jsxs("div",{className:"relative w-32 h-32 mx-auto mb-8",children:[p.jsx("div",{className:`absolute inset-0 rounded-full animate-pulse ${M==="community"?"bg-gradient-to-br from-green-500/30 to-emerald-500/30":"bg-gradient-to-br from-purple-500/30 to-pink-500/30"}`}),p.jsx("div",{className:`absolute inset-2 rounded-full flex items-center justify-center ${M==="community"?"bg-gradient-to-br from-green-600 to-emerald-600":"bg-gradient-to-br from-purple-600 to-pink-600"}`,children:M==="community"?p.jsx(sE,{size:48,className:"text-white"}):p.jsx(ci,{size:48,className:"text-white"})}),[...Array(4)].map((Je,Kt)=>p.jsx("div",{className:`absolute w-3 h-3 rounded-full ${M==="community"?"bg-green-400":"bg-yellow-400"}`,style:{top:"50%",left:"50%",transform:`rotate(${Kt*90}deg) translateX(60px) translateY(-50%)`,animation:`orbit 4s linear infinite ${Kt*.25}s`}},Kt))]}),p.jsx("h1",{className:"text-3xl font-bold text-white mb-3",children:M==="community"?"Community Creator":"Stars Programm"}),p.jsx("p",{className:"text-gray-400 mb-8 max-w-sm mx-auto",children:M==="community"?p.jsx(p.Fragment,{children:"Du hast dich durch dein Engagement qualifiziert! Werde jetzt offizieller Community Creator."}):p.jsx(p.Fragment,{children:"Exklusiv fr Persnlichkeiten des ffentlichen Lebens. Erhalte das Nebula Badge und erweiterte Features."})}),M==="community"&&p.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-6 max-w-sm mx-auto",children:[p.jsxs("div",{className:"bg-green-500/10 border border-green-500/30 rounded-xl p-3",children:[p.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[p.jsx(Qi,{size:14,className:"text-amber-400"}),p.jsx("span",{className:"text-lg font-bold text-white",children:l})]}),p.jsx("p",{className:"text-[10px] text-gray-400",children:"Sterne erhalten"})]}),p.jsxs("div",{className:"bg-green-500/10 border border-green-500/30 rounded-xl p-3",children:[p.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[p.jsx(Cl,{size:14,className:"text-blue-400"}),p.jsx("span",{className:"text-lg font-bold text-white",children:f})]}),p.jsx("p",{className:"text-[10px] text-gray-400",children:"Voice-Minuten"})]}),p.jsxs("div",{className:"bg-green-500/10 border border-green-500/30 rounded-xl p-3",children:[p.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[p.jsx(ai,{size:14,className:"text-purple-400"}),p.jsxs("span",{className:"text-lg font-bold text-white",children:["Lvl ",u]})]}),p.jsx("p",{className:"text-[10px] text-gray-400",children:"Dein Level"})]}),p.jsxs("div",{className:"bg-green-500/10 border border-green-500/30 rounded-xl p-3",children:[p.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[p.jsx(rl,{size:14,className:"text-green-400"}),p.jsxs("span",{className:"text-lg font-bold text-white",children:[w,"%"]})]}),p.jsx("p",{className:"text-[10px] text-gray-400",children:"Positive Ratings"})]})]}),p.jsx("div",{className:"space-y-3 mb-8 text-left max-w-sm mx-auto",children:(M==="community"?[{icon:"",text:"Community Creator Badge"},{icon:"",text:"Voice-Rume hosten"},{icon:"",text:"Events planen & ankndigen"},{icon:"",text:"Analytics Dashboard"},{icon:"",text:"Schnelle Verifizierung"}]:[{icon:"",text:"Verifiziertes Nebula Badge"},{icon:"",text:"Erweiterte Moderationsrechte"},{icon:"",text:"Detaillierte Analytics"},{icon:"",text:"Priorisierte Sichtbarkeit"},{icon:"",text:"Voice Lift Feature"}]).map((Je,Kt)=>p.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-xl ${M==="community"?"bg-green-900/30 border border-green-500/20":"bg-gray-800/50"}`,children:[p.jsx("span",{className:"text-xl",children:Je.icon}),p.jsx("span",{className:"text-gray-300",children:Je.text})]},Kt))}),p.jsx("button",{onClick:()=>J(M==="community"?"social":"category"),className:`w-full py-4 rounded-xl text-white font-semibold text-lg hover:opacity-90 transition-opacity ${M==="community"?"bg-gradient-to-r from-green-500 to-emerald-500":"bg-gradient-to-r from-purple-500 to-pink-500"}`,children:M==="community"?"Weiter zur Bewerbung":"Jetzt bewerben"}),M==="community"&&p.jsxs("p",{className:"text-xs text-green-400 mt-4 flex items-center justify-center gap-1",children:[p.jsx(rl,{size:12}),"Du erfllst alle Voraussetzungen!"]}),p.jsx("p",{className:"text-xs text-gray-500 mt-4",children:"Deine Daten werden vertraulich behandelt und nur zur Verifizierung verwendet."}),p.jsx("style",{children:`
        @keyframes orbit {
          from { transform: rotate(0deg) translateX(60px) rotate(0deg); }
          to { transform: rotate(360deg) translateX(60px) rotate(-360deg); }
        }
      `})]}),ue=[{value:"influencer",label:"Influencer",emoji:"",desc:"Social Media Creator"},{value:"entrepreneur",label:"Unternehmer",emoji:"",desc:"Grnder & Business"},{value:"artist",label:"Knstler",emoji:"",desc:"Bildende Kunst"},{value:"musician",label:"Musiker",emoji:"",desc:"Musik & Audio"},{value:"athlete",label:"Sportler",emoji:"",desc:"Profisport"},{value:"actor",label:"Schauspieler",emoji:"",desc:"Film & Theater"},{value:"creator",label:"Creator",emoji:"",desc:"Content Creator"},{value:"journalist",label:"Journalist",emoji:"",desc:"Medien & Presse"},{value:"scientist",label:"Wissenschaftler",emoji:"",desc:"Forschung & Bildung"},{value:"other",label:"Andere",emoji:"",desc:"Persnlichkeit"}],ie=()=>p.jsxs("div",{className:"px-4",children:[p.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Whle deine Kategorie"}),p.jsx("p",{className:"text-gray-400 mb-6",children:"In welchem Bereich bist du aktiv?"}),p.jsx("div",{className:"grid grid-cols-2 gap-3 mb-6",children:ue.map(Je=>p.jsxs("button",{onClick:()=>W(Je.value),className:`p-4 rounded-xl text-left transition-all ${ee===Je.value?"bg-purple-500/20 border-2 border-purple-500":"bg-gray-800/50 border-2 border-transparent hover:border-gray-700"}`,children:[p.jsx("span",{className:"text-2xl mb-2 block",children:Je.emoji}),p.jsx("p",{className:"font-semibold text-white",children:Je.label}),p.jsx("p",{className:"text-xs text-gray-400",children:Je.desc})]},Je.value))}),p.jsxs("div",{className:"mb-6",children:[p.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Erzhl uns mehr ber dich"}),p.jsx("textarea",{value:Z,onChange:Je=>fe(Je.target.value),placeholder:"Warum solltest du verifiziert werden? Was machst du?",className:"w-full p-4 bg-gray-800/50 rounded-xl text-white placeholder-gray-500 resize-none h-32 focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),p.jsxs("div",{className:"mb-6",children:[p.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Geschtzte Follower-Anzahl (alle Plattformen)"}),p.jsx("input",{type:"number",value:pe,onChange:Je=>Ce(Je.target.value),placeholder:"z.B. 50000",className:"w-full p-4 bg-gray-800/50 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),p.jsx("button",{onClick:()=>J("social"),disabled:!ee||!Z||!pe,className:"w-full py-4 rounded-xl bg-gradient-to-r from-purple-500 to-pink-500 text-white font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:"Weiter"})]}),tt=[{value:"instagram",label:"Instagram",icon:qSe,color:"#E4405F"},{value:"tiktok",label:"TikTok",icon:JSe,color:"#000000"},{value:"youtube",label:"YouTube",icon:cTe,color:"#FF0000"},{value:"twitter",label:"X / Twitter",icon:rTe,color:"#1DA1F2"},{value:"linkedin",label:"LinkedIn",icon:YSe,color:"#0A66C2"},{value:"other",label:"Andere",icon:jE,color:"#6B7280"}],Ot=Je=>{te.find(Kt=>Kt.platform===Je)||q([...te,{platform:Je,url:"",username:""}])},on=(Je,Kt,lr)=>{q(te.map(Qn=>Qn.platform===Je?{...Qn,[Kt]:lr}:Qn))},It=Je=>{q(te.filter(Kt=>Kt.platform!==Je))},Ge=()=>p.jsxs("div",{className:"px-4",children:[p.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Social Media Profile"}),p.jsx("p",{className:"text-gray-400 mb-6",children:"Verlinke deine verifizierten Profile"}),p.jsx("div",{className:"space-y-3 mb-6",children:te.map(Je=>{const Kt=tt.find(Qn=>Qn.value===Je.platform),lr=Kt.icon;return p.jsxs("div",{className:"p-4 bg-gray-800/50 rounded-xl",children:[p.jsxs("div",{className:"flex items-center justify-between mb-3",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(lr,{size:20,style:{color:Kt.color}}),p.jsx("span",{className:"font-medium text-white",children:Kt.label})]}),p.jsx("button",{onClick:()=>It(Je.platform),className:"p-1 text-gray-500 hover:text-red-400",children:p.jsx(nu,{size:18})})]}),p.jsx("input",{type:"text",value:Je.username,onChange:Qn=>on(Je.platform,"username",Qn.target.value),placeholder:"@username",className:"w-full p-3 bg-gray-900/50 rounded-lg text-white placeholder-gray-500 text-sm mb-2 focus:outline-none focus:ring-1 focus:ring-purple-500"}),p.jsx("input",{type:"url",value:Je.url,onChange:Qn=>on(Je.platform,"url",Qn.target.value),placeholder:"https://...",className:"w-full p-3 bg-gray-900/50 rounded-lg text-white placeholder-gray-500 text-sm focus:outline-none focus:ring-1 focus:ring-purple-500"})]},Je.platform)})}),p.jsx("p",{className:"text-sm text-gray-400 mb-3",children:"Plattform hinzufgen:"}),p.jsx("div",{className:"flex flex-wrap gap-2 mb-8",children:tt.filter(Je=>!te.find(Kt=>Kt.platform===Je.value)).map(Je=>{const Kt=Je.icon;return p.jsxs("button",{onClick:()=>Ot(Je.value),className:"flex items-center gap-2 px-3 py-2 bg-gray-800/50 rounded-lg text-gray-400 hover:text-white hover:bg-gray-700/50 transition-colors",children:[p.jsx(Kt,{size:16}),p.jsx("span",{className:"text-sm",children:Je.label}),p.jsx(Cb,{size:14})]},Je.value)})}),p.jsx("button",{onClick:()=>J(M==="community"?"review":"documents"),disabled:te.length===0||te.some(Je=>!Je.url||!Je.username),className:`w-full py-4 rounded-xl text-white font-semibold disabled:opacity-50 disabled:cursor-not-allowed ${M==="community"?"bg-gradient-to-r from-green-500 to-emerald-500":"bg-gradient-to-r from-purple-500 to-pink-500"}`,children:M==="community"?"Zur berprfung":"Weiter"}),M==="community"&&p.jsxs("p",{className:"text-xs text-green-400 text-center mt-3 flex items-center justify-center gap-1",children:[p.jsx(rl,{size:12}),"Keine Dokumente erforderlich - du bist bereits verifiziert durch dein Engagement!"]})]}),nt=Je=>{const Kt=Je.target.files;Kt&&$([...re,...Array.from(Kt)])},pt=Je=>{$(re.filter((Kt,lr)=>lr!==Je))},ot=()=>p.jsxs("div",{className:"px-4",children:[p.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Verifikations-Dokumente"}),p.jsx("p",{className:"text-gray-400 mb-6",children:"Hilf uns, deine Identitt zu besttigen. Alle Daten werden vertraulich behandelt."}),p.jsxs("div",{className:"p-4 bg-purple-500/10 border border-purple-500/30 rounded-xl mb-6",children:[p.jsx("p",{className:"text-sm text-purple-300 font-medium mb-2",children:"Akzeptierte Dokumente:"}),p.jsxs("ul",{className:"text-sm text-gray-400 space-y-1",children:[p.jsx("li",{children:" Screenshot deiner verifizierten Social Media Profile"}),p.jsx("li",{children:" Presseartikel oder Interviews ber dich"}),p.jsx("li",{children:" Visitenkarte oder Firmennachweis"}),p.jsx("li",{children:" Ausweisdokument (wird nach Prfung gelscht)"})]})]}),p.jsxs("label",{className:"block mb-4",children:[p.jsxs("div",{className:"border-2 border-dashed border-gray-700 rounded-xl p-8 text-center cursor-pointer hover:border-purple-500 transition-colors",children:[p.jsx(iTe,{size:32,className:"mx-auto mb-3 text-gray-500"}),p.jsx("p",{className:"text-gray-400 mb-1",children:"Dokumente hochladen"}),p.jsx("p",{className:"text-xs text-gray-500",children:"PDF, JPG, PNG (max. 10MB)"})]}),p.jsx("input",{type:"file",accept:".pdf,.jpg,.jpeg,.png",multiple:!0,onChange:nt,className:"hidden"})]}),re.length>0&&p.jsx("div",{className:"space-y-2 mb-6",children:re.map((Je,Kt)=>p.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-800/50 rounded-lg",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[Je.type.includes("pdf")?p.jsx(rP,{size:20,className:"text-red-400"}):p.jsx(VSe,{size:20,className:"text-blue-400"}),p.jsx("span",{className:"text-sm text-gray-300 truncate max-w-[200px]",children:Je.name})]}),p.jsx("button",{onClick:()=>pt(Kt),className:"p-1 text-gray-500 hover:text-red-400",children:p.jsx(nu,{size:18})})]},Kt))}),p.jsx("button",{onClick:()=>J("review"),disabled:re.length===0,className:"w-full py-4 rounded-xl bg-gradient-to-r from-purple-500 to-pink-500 text-white font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:"Weiter zur berprfung"})]}),Et=async()=>{he(!0),await new Promise(Je=>setTimeout(Je,2e3)),he(!1),J("submitted")},un=()=>{var Je,Kt;return p.jsxs("div",{className:"px-4",children:[M==="community"&&p.jsxs("div",{className:"mb-4 p-3 bg-green-500/10 border border-green-500/30 rounded-xl flex items-center gap-3",children:[p.jsx(sE,{className:"text-green-400",size:24}),p.jsxs("div",{children:[p.jsx("p",{className:"text-green-400 font-medium text-sm",children:"Community Creator Bewerbung"}),p.jsx("p",{className:"text-gray-400 text-xs",children:"Schnelle Verifizierung durch Engagement"})]})]}),p.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"berprfe deine Angaben"}),p.jsx("p",{className:"text-gray-400 mb-6",children:"Stelle sicher, dass alles korrekt ist."}),p.jsxs("div",{className:"space-y-4 mb-8",children:[p.jsxs("div",{className:`p-4 rounded-xl ${M==="community"?"bg-green-900/30 border border-green-500/20":"bg-gray-800/50"}`,children:[p.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Kategorie"}),p.jsxs("p",{className:"text-white font-medium",children:[(Je=ue.find(lr=>lr.value===ee))==null?void 0:Je.emoji," ",(Kt=ue.find(lr=>lr.value===ee))==null?void 0:Kt.label]})]}),Z&&p.jsxs("div",{className:`p-4 rounded-xl ${M==="community"?"bg-green-900/30 border border-green-500/20":"bg-gray-800/50"}`,children:[p.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Beschreibung"}),p.jsx("p",{className:"text-gray-300 text-sm",children:Z})]}),M!=="community"&&pe&&p.jsxs("div",{className:"p-4 bg-gray-800/50 rounded-xl",children:[p.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Follower"}),p.jsx("p",{className:"text-white font-medium",children:parseInt(pe).toLocaleString()})]}),M==="community"&&p.jsxs("div",{className:"p-4 bg-green-900/30 border border-green-500/20 rounded-xl",children:[p.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Deine Community-Statistiken"}),p.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Qi,{size:14,className:"text-amber-400"}),p.jsxs("span",{className:"text-sm text-gray-300",children:[l," Sterne"]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Cl,{size:14,className:"text-blue-400"}),p.jsxs("span",{className:"text-sm text-gray-300",children:[f," Min"]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(ai,{size:14,className:"text-purple-400"}),p.jsxs("span",{className:"text-sm text-gray-300",children:["Level ",u]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(rl,{size:14,className:"text-green-400"}),p.jsxs("span",{className:"text-sm text-gray-300",children:[w,"% Positiv"]})]})]})]}),p.jsxs("div",{className:`p-4 rounded-xl ${M==="community"?"bg-green-900/30 border border-green-500/20":"bg-gray-800/50"}`,children:[p.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Social Media"}),p.jsx("div",{className:"space-y-2",children:te.map(lr=>{const Qn=tt.find(it=>it.value===lr.platform),ms=Qn.icon;return p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(ms,{size:16,style:{color:Qn.color}}),p.jsxs("span",{className:"text-sm text-gray-300",children:["@",lr.username]})]},lr.platform)})})]}),M!=="community"&&p.jsxs("div",{className:"p-4 bg-gray-800/50 rounded-xl",children:[p.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Dokumente"}),p.jsxs("p",{className:"text-gray-300 text-sm",children:[re.length," Datei(en) hochgeladen"]})]})]}),p.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"Mit dem Absenden besttigst du, dass alle Angaben wahrheitsgem sind und du unseren Nutzungsbedingungen zustimmst."}),p.jsx("button",{onClick:Et,disabled:ae,className:`w-full py-4 rounded-xl text-white font-semibold disabled:opacity-50 flex items-center justify-center gap-2 ${M==="community"?"bg-gradient-to-r from-green-500 to-emerald-500":"bg-gradient-to-r from-purple-500 to-pink-500"}`,children:ae?p.jsxs(p.Fragment,{children:[p.jsx(ws,{size:20,className:"animate-spin"}),"Wird eingereicht..."]}):"Bewerbung einreichen"})]})},In=()=>p.jsxs("div",{className:"px-4 text-center",children:[p.jsx("div",{className:"w-24 h-24 mx-auto mb-6 rounded-full flex items-center justify-center bg-green-500/20",children:M==="community"?p.jsx(sE,{size:48,className:"text-green-400"}):p.jsx(rl,{size:48,className:"text-green-400"})}),p.jsx("h2",{className:"text-2xl font-bold text-white mb-3",children:M==="community"?"Community Creator Bewerbung eingereicht!":"Bewerbung eingereicht!"}),p.jsx("p",{className:"text-gray-400 mb-8",children:M==="community"?p.jsx(p.Fragment,{children:"Deine Bewerbung wird bevorzugt behandelt! Du erhltst innerhalb von 24 Stunden eine Antwort."}):p.jsx(p.Fragment,{children:"Unser Team wird deine Bewerbung innerhalb von 2-5 Werktagen prfen. Du erhltst eine Benachrichtigung, sobald eine Entscheidung getroffen wurde."})}),p.jsx("div",{className:`p-4 rounded-xl mb-8 ${M==="community"?"bg-green-500/10 border border-green-500/30":"bg-amber-500/10 border border-amber-500/30"}`,children:p.jsxs("div",{className:"flex items-center gap-3",children:[M==="community"?p.jsx(rl,{size:20,className:"text-green-400"}):p.jsx(USe,{size:20,className:"text-amber-400"}),p.jsxs("div",{className:"text-left",children:[p.jsx("p",{className:`text-sm font-medium ${M==="community"?"text-green-300":"text-amber-300"}`,children:M==="community"?"Status: Bevorzugte Prfung":"Status: In Prfung"}),p.jsxs("p",{className:"text-xs text-gray-400",children:["Eingereicht am ",new Date().toLocaleDateString("de-DE")]})]})]})}),p.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"So wird dein Badge aussehen:"}),p.jsx("div",{className:"flex justify-center mb-8",children:p.jsx("div",{className:`flex items-center gap-3 px-4 py-3 rounded-xl ${M==="community"?"bg-green-900/30 border border-green-500/20":"bg-gray-800/50"}`,children:p.jsx(vf,{tier:"nebula",size:"lg",showLabel:!0})})}),p.jsx("button",{onClick:()=>s("/"),className:`w-full py-4 rounded-xl text-white font-semibold transition-colors ${M==="community"?"bg-gradient-to-r from-green-500 to-emerald-500 hover:opacity-90":"bg-gray-800 hover:bg-gray-700"}`,children:"Zurck zur App"})]}),zn=()=>{switch(Y){case"intro":return le();case"category":return ie();case"social":return Ge();case"documents":return ot();case"review":return un();case"submitted":return In()}},Sr=()=>{const Je=["intro","category","social","documents","review","submitted"];return(Je.indexOf(Y)+1)/Je.length*100};return p.jsxs("div",{className:"min-h-screen bg-gray-950 pb-8",children:[p.jsxs("div",{className:"sticky top-0 z-10 bg-gray-950/95 backdrop-blur-sm border-b border-gray-800",children:[p.jsxs("div",{className:"flex items-center justify-between p-4",children:[p.jsx("button",{onClick:()=>{if(Y==="intro"||Y==="submitted")s(-1);else{const Je=["intro","category","social","documents","review"],Kt=Je.indexOf(Y);Kt>0&&J(Je[Kt-1])}},className:"p-2 -m-2 text-gray-400 hover:text-white",children:p.jsx(Is,{size:24})}),p.jsx("span",{className:"text-sm text-gray-500",children:Y!=="intro"&&Y!=="submitted"&&`Schritt ${["category","social","documents","review"].indexOf(Y)+1}/4`}),p.jsx("div",{className:"w-8"})]}),Y!=="intro"&&Y!=="submitted"&&p.jsx("div",{className:"h-1 bg-gray-800",children:p.jsx("div",{className:"h-full bg-gradient-to-r from-purple-500 to-pink-500 transition-all duration-300",style:{width:`${Sr()}%`}})})]}),p.jsx("div",{className:"pt-6",children:zn()})]})},VTe=()=>{const s=ei(),{starProfile:r,user:o}=vi(),[l,u]=ce.useState("week"),f={userId:(o==null?void 0:o.id)||"",totalListeners:12847,uniqueListeners:8234,averageListenDuration:14.5,peakConcurrentListeners:2341,totalStarsReceived:4821,starsValue:481.2,averageEngagementRate:23.5,newFollowers:1234,followerGrowthRate:15.3,topSupporters:[{userId:"1",username:"superfan_23",displayName:"Super Fan",starsGiven:245,eventsAttended:12,totalListenTime:840},{userId:"2",username:"music_lover",displayName:"Music Lover",starsGiven:189,eventsAttended:10,totalListenTime:720},{userId:"3",username:"nightowl",displayName:"Night Owl",starsGiven:156,eventsAttended:8,totalListenTime:560},{userId:"4",username:"chatty_cathy",displayName:"Chatty Cathy",starsGiven:134,eventsAttended:11,totalListenTime:680},{userId:"5",username:"early_bird",displayName:"Early Bird",starsGiven:112,eventsAttended:9,totalListenTime:540}]},E=r||{userId:(o==null?void 0:o.id)||"",username:(o==null?void 0:o.username)||"star_user",displayName:(o==null?void 0:o.displayName)||"Star User",avatar:o==null?void 0:o.avatar,category:"creator",nebulaTier:"supernova",totalListeners:12847,totalStarsReceived:4821,totalEventsHosted:12,permissions:{canMuteParticipants:!0,canManageHandRaise:!0,canStartRecording:!0,canVoiceLiftUsers:!0,maxVoiceLiftSlots:5,maxEventCapacity:500,hasAdvancedAnalytics:!0,canExportData:!0}},T={day:"Heute",week:"Diese Woche",month:"Diesen Monat",all_time:"Gesamt"};return p.jsxs("div",{className:"min-h-screen bg-gray-950 pb-24",children:[p.jsx("div",{className:"sticky top-0 z-10 bg-gray-950/95 backdrop-blur-sm border-b border-gray-800",children:p.jsxs("div",{className:"flex items-center justify-between p-4",children:[p.jsx("button",{onClick:()=>s(-1),className:"p-2 -m-2 text-gray-400 hover:text-white",children:p.jsx(Is,{size:24})}),p.jsx("h1",{className:"text-lg font-bold text-white",children:"Stars Dashboard"}),p.jsx("button",{className:"p-2 -m-2 text-gray-400 hover:text-white",children:p.jsx(tTe,{size:20})})]})}),p.jsxs("div",{className:"p-4 space-y-6",children:[p.jsxs("div",{className:"relative bg-gradient-to-br from-purple-900/30 to-pink-900/30 rounded-2xl p-6 border border-purple-500/30",children:[p.jsx("div",{className:"absolute inset-0 rounded-2xl overflow-hidden",children:p.jsx("div",{className:"absolute inset-0 opacity-30",style:{background:"radial-gradient(circle at 30% 30%, rgba(139, 92, 246, 0.4), transparent 50%)"}})}),p.jsxs("div",{className:"relative flex items-start gap-4",children:[p.jsxs("div",{className:"relative",children:[p.jsx("div",{className:"w-20 h-20 rounded-full bg-cover bg-center border-3",style:{backgroundImage:E.avatar?`url(${E.avatar})`:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderColor:"#F59E0B",boxShadow:"0 0 30px rgba(245, 158, 11, 0.5)"}}),p.jsx("div",{className:"absolute -bottom-1 -right-1",children:p.jsx(vf,{tier:E.nebulaTier,size:"lg"})})]}),p.jsxs("div",{className:"flex-1",children:[p.jsx("div",{className:"flex items-center gap-2 mb-1",children:p.jsxs("h2",{className:"text-xl font-bold text-white",children:["@",E.username]})}),p.jsx("p",{className:"text-gray-400 mb-2",children:E.displayName}),p.jsx(pq,{category:E.category})]})]}),p.jsxs("div",{className:"relative grid grid-cols-3 gap-4 mt-6 pt-6 border-t border-gray-700/50",children:[p.jsxs("div",{className:"text-center",children:[p.jsx("p",{className:"text-2xl font-bold text-white",children:E.totalListeners.toLocaleString()}),p.jsx("p",{className:"text-xs text-gray-400",children:"Zuhrer"})]}),p.jsxs("div",{className:"text-center",children:[p.jsx("p",{className:"text-2xl font-bold text-amber-400",children:E.totalStarsReceived.toLocaleString()}),p.jsx("p",{className:"text-xs text-gray-400",children:"Sterne"})]}),p.jsxs("div",{className:"text-center",children:[p.jsx("p",{className:"text-2xl font-bold text-white",children:E.totalEventsHosted}),p.jsx("p",{className:"text-xs text-gray-400",children:"Events"})]})]})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[p.jsxs("button",{onClick:()=>s("/stars/event/new"),className:"flex items-center justify-center gap-2 p-4 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl text-white font-semibold",children:[p.jsx(lq,{size:20}),"Event starten"]}),p.jsxs("button",{onClick:()=>s("/stars/schedule"),className:"flex items-center justify-center gap-2 p-4 bg-gray-800/50 rounded-xl text-gray-300 font-medium border border-gray-700",children:[p.jsx(qd,{size:20}),"Planen"]})]}),p.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 -mx-4 px-4",children:["day","week","month","all_time"].map(w=>p.jsx("button",{onClick:()=>u(w),className:`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all ${l===w?"bg-purple-500 text-white":"bg-gray-800/50 text-gray-400 hover:bg-gray-700/50"}`,children:T[w]},w))}),p.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[p.jsx(wm,{icon:p.jsx(ai,{className:"text-blue-400"}),label:"Zuhrer",value:f.totalListeners.toLocaleString(),subvalue:`${f.uniqueListeners.toLocaleString()} unique`,trend:12.5}),p.jsx(wm,{icon:p.jsx(Qi,{className:"text-amber-400"}),label:"Sterne",value:f.totalStarsReceived.toLocaleString(),subvalue:`${f.starsValue.toFixed(2)}`,trend:8.3}),p.jsx(wm,{icon:p.jsx(Th,{className:"text-green-400"}),label:" Hrdauer",value:`${f.averageListenDuration}m`,subvalue:"pro Session",trend:3.2}),p.jsx(wm,{icon:p.jsx(Ab,{className:"text-purple-400"}),label:"Engagement",value:`${f.averageEngagementRate}%`,subvalue:"Interaktionsrate",trend:5.1}),p.jsx(wm,{icon:p.jsx(Oc,{className:"text-pink-400"}),label:"Peak",value:f.peakConcurrentListeners.toLocaleString(),subvalue:"gleichzeitig"}),p.jsx(wm,{icon:p.jsx(Ab,{className:"text-cyan-400"}),label:"Wachstum",value:`+${f.newFollowers.toLocaleString()}`,subvalue:`${f.followerGrowthRate}% `,trend:f.followerGrowthRate})]}),p.jsxs("div",{className:"bg-gray-800/30 rounded-2xl p-4 border border-gray-700/50",children:[p.jsxs("div",{className:"flex items-center justify-between mb-4",children:[p.jsxs("h3",{className:"font-semibold text-white flex items-center gap-2",children:[p.jsx(ul,{size:18,className:"text-amber-400"}),"Top Supporter"]}),p.jsx("button",{className:"text-sm text-purple-400",children:"Alle anzeigen"})]}),p.jsx("div",{className:"space-y-3",children:f.topSupporters.slice(0,5).map((w,A)=>p.jsx(FTe,{supporter:w,rank:A+1},w.userId))})]}),p.jsxs("div",{className:"bg-gray-800/30 rounded-2xl p-4 border border-gray-700/50",children:[p.jsxs("div",{className:"flex items-center justify-between mb-4",children:[p.jsxs("h3",{className:"font-semibold text-white flex items-center gap-2",children:[p.jsx(ci,{size:18,className:"text-purple-400"}),"Deine Star-Features"]}),p.jsx(vf,{tier:E.nebulaTier,size:"sm",showLabel:!0})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[p.jsx(Cm,{icon:p.jsx(ok,{size:16}),label:"Stummschalten",enabled:E.permissions.canMuteParticipants}),p.jsx(Cm,{icon:p.jsx(aq,{size:16}),label:"Hand-Management",enabled:E.permissions.canManageHandRaise}),p.jsx(Cm,{icon:p.jsx(ci,{size:16}),label:"Voice Lift",enabled:E.permissions.canVoiceLiftUsers,extra:`${E.permissions.maxVoiceLiftSlots} Slots`}),p.jsx(Cm,{icon:p.jsx(Cl,{size:16}),label:"Aufnahme",enabled:E.permissions.canStartRecording}),p.jsx(Cm,{icon:p.jsx(ai,{size:16}),label:"Kapazitt",enabled:!0,extra:`${E.permissions.maxEventCapacity}`}),p.jsx(Cm,{icon:p.jsx(oE,{size:16}),label:"Analytics",enabled:E.permissions.hasAdvancedAnalytics})]})]}),E.permissions.canExportData&&p.jsxs("button",{className:"w-full flex items-center justify-center gap-2 p-4 bg-gray-800/50 rounded-xl text-gray-300 border border-gray-700 hover:bg-gray-700/50 transition-colors",children:[p.jsx(GSe,{size:20}),"Analytics exportieren (CSV)"]})]})]})},wm=({icon:s,label:r,value:o,subvalue:l,trend:u})=>p.jsxs("div",{className:"bg-gray-800/30 rounded-xl p-4 border border-gray-700/50",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s,p.jsx("span",{className:"text-sm text-gray-400",children:r})]}),p.jsx("p",{className:"text-2xl font-bold text-white",children:o}),p.jsxs("div",{className:"flex items-center justify-between mt-1",children:[l&&p.jsx("span",{className:"text-xs text-gray-500",children:l}),u!==void 0&&p.jsxs("span",{className:`text-xs font-medium ${u>=0?"text-green-400":"text-red-400"}`,children:[u>=0?"+":"",u.toFixed(1),"%"]})]})]}),FTe=({supporter:s,rank:r})=>{const o=["text-amber-400","text-gray-400","text-orange-400"];return p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("span",{className:`w-6 text-center font-bold ${o[r-1]||"text-gray-500"}`,children:r}),p.jsx("div",{className:"w-10 h-10 rounded-full bg-cover bg-center",style:{backgroundImage:s.avatar?`url(${s.avatar})`:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}}),p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsxs("p",{className:"font-medium text-white truncate",children:["@",s.username]}),p.jsxs("p",{className:"text-xs text-gray-500",children:[s.eventsAttended," Events besucht"]})]}),p.jsx("div",{className:"text-right",children:p.jsxs("p",{className:"font-semibold text-amber-400 flex items-center gap-1",children:[p.jsx(Qi,{size:14}),s.starsGiven]})})]})},Cm=({icon:s,label:r,enabled:o,extra:l})=>p.jsxs("div",{className:`flex items-center gap-2 p-2 rounded-lg ${o?"bg-purple-500/10 text-purple-300":"bg-gray-800/30 text-gray-500"}`,children:[s,p.jsx("span",{className:"text-xs",children:r}),l&&p.jsx("span",{className:"text-[10px] ml-auto opacity-70",children:l})]}),BTe=[{id:"1",hostId:"user1",hostUsername:"max_official",hostDisplayName:"Max Mustermann",hostTier:"supernova",title:"Abend Q&A mit der Community",description:"Ich beantworte eure Fragen zu meinem neuen Projekt und mehr!",category:"qa",scheduledAt:new Date(Date.now()+2*60*60*1e3),estimatedDuration:60,interestedCount:234,status:"scheduled"},{id:"2",hostId:"user1",hostUsername:"max_official",hostDisplayName:"Max Mustermann",hostTier:"supernova",title:"Wochenend-Chill & Music",description:"Entspannter Samstag mit guter Musik und netten Gesprchen",category:"music",scheduledAt:new Date(Date.now()+48*60*60*1e3),estimatedDuration:120,interestedCount:89,status:"scheduled"}],bh={qa:{icon:Cl,label:"Q&A",color:"text-purple-400"},talk:{icon:Kh,label:"Talk",color:"text-blue-400"},interview:{icon:oTe,label:"Interview",color:"text-orange-400"},music:{icon:QSe,label:"Musik",color:"text-pink-400"},gaming:{icon:zSe,label:"Gaming",color:"text-green-400"},education:{icon:HSe,label:"Bildung",color:"text-indigo-400"},business:{icon:jSe,label:"Business",color:"text-yellow-400"},casual:{icon:BSe,label:"Casual",color:"text-cyan-400"},other:{icon:ci,label:"Sonstiges",color:"text-gray-400"}};function GTe(){const s=ei(),{isVerifiedStar:r}=vi(),[o,l]=ce.useState(BTe),[u,f]=ce.useState(!1),[E,T]=ce.useState(null);if(!r)return p.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center p-4",children:p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"w-16 h-16 bg-purple-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:p.jsx(qd,{className:"w-8 h-8 text-purple-400"})}),p.jsx("h2",{className:"text-xl font-bold mb-2",children:"Nur fr verifizierte Stars"}),p.jsx("p",{className:"text-gray-400 mb-6",children:"Event-Planung ist nur fr verifizierte Creator verfgbar."}),p.jsx("button",{onClick:()=>s("/stars/apply"),className:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl font-medium",children:"Star werden"})]})});const w=M=>{const F=new Date,Y=M.getTime()-F.getTime(),J=Math.floor(Y/(1e3*60*60)),ae=Math.floor(J/24);if(ae>0)return`In ${ae} Tag${ae>1?"en":""}`;if(J>0)return`In ${J} Stunde${J>1?"n":""}`;{const he=Math.floor(Y/6e4);return`In ${he} Minute${he>1?"n":""}`}},A=M=>{l(o.filter(F=>F.id!==M))},U=M=>{s("/discover")};return p.jsxs("div",{className:"min-h-screen bg-black text-white pb-24",children:[p.jsx("div",{className:"sticky top-0 z-50 bg-black/90 backdrop-blur-lg border-b border-white/10",children:p.jsxs("div",{className:"flex items-center justify-between p-4",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("button",{onClick:()=>s(-1),className:"p-2 hover:bg-white/10 rounded-xl transition-colors",children:p.jsx(Is,{className:"w-5 h-5"})}),p.jsxs("div",{children:[p.jsx("h1",{className:"text-lg font-bold",children:"Event-Planung"}),p.jsx("p",{className:"text-xs text-gray-400",children:"Plane deine nchsten Sessions"})]})]}),p.jsx("button",{onClick:()=>f(!0),className:"p-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl",children:p.jsx(Cb,{className:"w-5 h-5"})})]})}),p.jsxs("div",{className:"p-4 grid grid-cols-3 gap-3",children:[p.jsxs("div",{className:"bg-white/5 rounded-xl p-3 text-center",children:[p.jsx("div",{className:"text-2xl font-bold text-purple-400",children:o.length}),p.jsx("div",{className:"text-xs text-gray-400",children:"Geplant"})]}),p.jsxs("div",{className:"bg-white/5 rounded-xl p-3 text-center",children:[p.jsx("div",{className:"text-2xl font-bold text-pink-400",children:o.reduce((M,F)=>M+F.interestedCount,0)}),p.jsx("div",{className:"text-xs text-gray-400",children:"Interessiert"})]}),p.jsxs("div",{className:"bg-white/5 rounded-xl p-3 text-center",children:[p.jsx("div",{className:"text-2xl font-bold text-cyan-400",children:o.filter(M=>{const F=new Date(M.scheduledAt).getTime()-Date.now();return F<24*60*60*1e3&&F>0}).length}),p.jsx("div",{className:"text-xs text-gray-400",children:"Heute"})]})]}),p.jsxs("div",{className:"p-4 space-y-4",children:[p.jsxs("h2",{className:"text-lg font-bold flex items-center gap-2",children:[p.jsx(qd,{className:"w-5 h-5 text-purple-400"}),"Geplante Events"]}),o.length===0?p.jsxs("div",{className:"bg-white/5 rounded-2xl p-8 text-center",children:[p.jsx("div",{className:"w-16 h-16 bg-purple-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:p.jsx(qd,{className:"w-8 h-8 text-purple-400"})}),p.jsx("h3",{className:"font-bold mb-2",children:"Keine Events geplant"}),p.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Plane dein erstes Event, damit deine Follower wissen, wann du live gehst!"}),p.jsx("button",{onClick:()=>f(!0),className:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl font-medium",children:"Event erstellen"})]}):p.jsx("div",{className:"space-y-3",children:o.map(M=>{const F=bh[M.category].icon,Y=new Date(M.scheduledAt).getTime()-Date.now()<30*60*1e3;return p.jsxs("div",{className:`bg-white/5 rounded-2xl p-4 border ${Y?"border-purple-500/50":"border-transparent"}`,children:[p.jsxs("div",{className:"flex items-start justify-between mb-3",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:`w-10 h-10 rounded-xl bg-white/10 flex items-center justify-center ${bh[M.category].color}`,children:p.jsx(F,{className:"w-5 h-5"})}),p.jsxs("div",{children:[p.jsx("h3",{className:"font-bold",children:M.title}),p.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[p.jsx("span",{className:bh[M.category].color,children:bh[M.category].label}),p.jsx("span",{children:""}),p.jsxs("span",{children:[M.estimatedDuration," Min"]})]})]})]}),p.jsxs("div",{className:"flex gap-1",children:[p.jsx("button",{onClick:()=>T(M),className:"p-2 hover:bg-white/10 rounded-lg transition-colors",children:p.jsx($Se,{className:"w-4 h-4 text-gray-400"})}),p.jsx("button",{onClick:()=>A(M.id),className:"p-2 hover:bg-red-500/20 rounded-lg transition-colors",children:p.jsx(O0,{className:"w-4 h-4 text-red-400"})})]})]}),M.description&&p.jsx("p",{className:"text-sm text-gray-400 mb-3",children:M.description}),p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[p.jsx(Th,{className:"w-4 h-4 text-purple-400"}),p.jsx("span",{className:Y?"text-purple-400 font-medium":"text-gray-400",children:w(new Date(M.scheduledAt))})]}),p.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[p.jsx(Kd,{className:"w-4 h-4 text-pink-400"}),p.jsxs("span",{className:"text-gray-400",children:[M.interestedCount," interessiert"]})]})]}),Y&&p.jsxs("button",{onClick:()=>U(),className:"px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl text-sm font-medium flex items-center gap-2",children:[p.jsx(Ib,{className:"w-4 h-4"}),"Jetzt starten"]})]}),Y&&p.jsxs("div",{className:"mt-3 px-3 py-2 bg-purple-500/20 rounded-xl flex items-center gap-2",children:[p.jsx("div",{className:"w-2 h-2 bg-purple-400 rounded-full animate-pulse"}),p.jsx("span",{className:"text-sm text-purple-300",children:"Event startet bald!"})]})]},M.id)})})]}),p.jsx("div",{className:"p-4",children:p.jsxs("div",{className:"bg-gradient-to-br from-purple-500/10 to-pink-500/10 rounded-2xl p-4 border border-purple-500/20",children:[p.jsxs("h3",{className:"font-bold mb-2 flex items-center gap-2",children:[p.jsx(ci,{className:"w-5 h-5 text-purple-400"}),"Tipps fr bessere Events"]}),p.jsxs("ul",{className:"space-y-2 text-sm text-gray-400",children:[p.jsxs("li",{className:"flex items-start gap-2",children:[p.jsx(Jo,{className:"w-4 h-4 text-green-400 mt-0.5 shrink-0"}),"Plane Events mindestens 24h im Voraus"]}),p.jsxs("li",{className:"flex items-start gap-2",children:[p.jsx(Jo,{className:"w-4 h-4 text-green-400 mt-0.5 shrink-0"}),"Fge eine aussagekrftige Beschreibung hinzu"]}),p.jsxs("li",{className:"flex items-start gap-2",children:[p.jsx(Jo,{className:"w-4 h-4 text-green-400 mt-0.5 shrink-0"}),"Whle Zeiten, wenn deine Follower aktiv sind"]})]})]})}),u&&p.jsx(d8,{onClose:()=>f(!1),onSave:M=>{l([...o,M]),f(!1)}}),E&&p.jsx(d8,{event:E,onClose:()=>T(null),onSave:M=>{l(o.map(F=>F.id===M.id?M:F)),T(null)}})]})}function d8({event:s,onClose:r,onSave:o}){const{user:l,starProfile:u}=vi(),[f,E]=ce.useState((s==null?void 0:s.title)||""),[T,w]=ce.useState((s==null?void 0:s.description)||""),[A,U]=ce.useState((s==null?void 0:s.category)||"talk"),[M,F]=ce.useState(s!=null&&s.scheduledAt?new Date(s.scheduledAt).toISOString().split("T")[0]:new Date(Date.now()+24*60*60*1e3).toISOString().split("T")[0]),[Y,J]=ce.useState(s!=null&&s.scheduledAt?new Date(s.scheduledAt).toTimeString().slice(0,5):"19:00"),[ae,he]=ce.useState((s==null?void 0:s.estimatedDuration)||60),ee=()=>{if(!f.trim())return;const W=new Date(`${M}T${Y}:00`),Z={id:(s==null?void 0:s.id)||`event-${Date.now()}`,hostId:(l==null?void 0:l.id)||"",hostUsername:(l==null?void 0:l.username)||"",hostDisplayName:(l==null?void 0:l.displayName)||(l==null?void 0:l.username)||"",hostAvatar:l==null?void 0:l.avatar,hostTier:(u==null?void 0:u.nebulaTier)||"nebula",title:f,description:T,category:A,scheduledAt:W,estimatedDuration:ae,interestedCount:(s==null?void 0:s.interestedCount)||0,status:"scheduled"};o(Z)};return p.jsxs("div",{className:"fixed inset-0 z-50 flex items-end justify-center",children:[p.jsx("div",{className:"absolute inset-0 bg-black/80",onClick:r}),p.jsxs("div",{className:"relative w-full max-w-lg bg-gray-900 rounded-t-3xl max-h-[90vh] overflow-y-auto",children:[p.jsxs("div",{className:"sticky top-0 bg-gray-900 p-4 border-b border-white/10 flex items-center justify-between",children:[p.jsx("h2",{className:"text-lg font-bold",children:s?"Event bearbeiten":"Neues Event"}),p.jsx("button",{onClick:r,className:"p-2 hover:bg-white/10 rounded-xl",children:p.jsx(nu,{className:"w-5 h-5"})})]}),p.jsxs("div",{className:"p-4 space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Titel *"}),p.jsx("input",{type:"text",value:f,onChange:W=>E(W.target.value),placeholder:"z.B. Abend Q&A mit der Community",className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl focus:outline-none focus:border-purple-500",maxLength:50}),p.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[f.length,"/50"]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Beschreibung"}),p.jsx("textarea",{value:T,onChange:W=>w(W.target.value),placeholder:"Worum geht es in deinem Event?",className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl focus:outline-none focus:border-purple-500 resize-none h-24",maxLength:200}),p.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[T.length,"/200"]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Kategorie"}),p.jsx("div",{className:"grid grid-cols-3 gap-2",children:Object.entries(bh).map(([W,Z])=>{const fe=Z.icon;return p.jsxs("button",{onClick:()=>U(W),className:`p-3 rounded-xl border text-sm flex flex-col items-center gap-1 transition-all ${A===W?"border-purple-500 bg-purple-500/20":"border-white/10 bg-white/5 hover:bg-white/10"}`,children:[p.jsx(fe,{className:`w-5 h-5 ${Z.color}`}),p.jsx("span",{children:Z.label})]},W)})})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Datum"}),p.jsx("input",{type:"date",value:M,onChange:W=>F(W.target.value),min:new Date().toISOString().split("T")[0],className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl focus:outline-none focus:border-purple-500"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Uhrzeit"}),p.jsx("input",{type:"time",value:Y,onChange:W=>J(W.target.value),className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl focus:outline-none focus:border-purple-500"})]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Geplante Dauer"}),p.jsx("div",{className:"flex gap-2",children:[30,60,90,120].map(W=>p.jsxs("button",{onClick:()=>he(W),className:`flex-1 py-3 rounded-xl border text-sm transition-all ${ae===W?"border-purple-500 bg-purple-500/20":"border-white/10 bg-white/5 hover:bg-white/10"}`,children:[W," Min"]},W))})]}),p.jsxs("div",{className:"bg-white/5 rounded-xl p-4 border border-white/10",children:[p.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"Vorschau fr Follower"}),p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:`w-10 h-10 rounded-xl bg-white/10 flex items-center justify-center ${bh[A].color}`,children:(()=>{const W=bh[A].icon;return p.jsx(W,{className:"w-5 h-5"})})()}),p.jsxs("div",{children:[p.jsx("div",{className:"font-medium",children:f||"Event Titel"}),p.jsxs("div",{className:"text-xs text-gray-400",children:[new Date(`${M}T${Y}`).toLocaleDateString("de-DE",{weekday:"short",day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}),"  ",ae," Min"]})]})]})]}),p.jsx("button",{onClick:ee,disabled:!f.trim(),className:"w-full py-4 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl font-bold disabled:opacity-50 disabled:cursor-not-allowed",children:s?"nderungen speichern":"Event erstellen"})]})]})]})}const WTe=()=>{const{userId:s}=rpe(),r=ei(),{user:o}=vi(),[l,u]=ce.useState(null),[f,E]=ce.useState(!0),[T,w]=ce.useState(!1),[A,U]=ce.useState(!1),[M,F]=ce.useState(!1);ce.useEffect(()=>{(async()=>{var ee;if(s)try{const W=await ef(Dr(Qt,"users",s));if(W.exists()){const Z=W.data();u({id:W.id,username:Z.username||"unknown",displayName:Z.displayName||"Unbekannt",bio:Z.bio||"",avatar:Z.avatar,level:Z.level||1,xp:Z.xp||0,joinedAt:((ee=Z.createdAt)==null?void 0:ee.toDate())||new Date,isVerified:Z.isVerified||!1,isCreator:Z.isCreator||!1,friendsCount:Z.friendsCount||0,roomsJoined:Z.roomsJoined||0,minutesTalked:Z.minutesTalked||0})}}catch(W){console.error("Error fetching user:",W)}finally{E(!1)}})()},[s]),ce.useEffect(()=>{(async()=>{if(!(!s||!(o!=null&&o.id)))try{const ee=qo(Zr(Qt,"friends"),ds("users","array-contains",o.id)),Z=(await Rd(ee)).docs.some(Ce=>Ce.data().users.includes(s));w(Z);const fe=qo(Zr(Qt,"friendRequests"),ds("fromId","==",o.id),ds("toId","==",s),ds("status","==","pending")),pe=await Rd(fe);U(!pe.empty)}catch(ee){console.error("Error checking friendship:",ee)}})()},[s,o==null?void 0:o.id]);const Y=async()=>{if(!(!s||!(o!=null&&o.id)||M)){F(!0);try{await UE(Zr(Qt,"friendRequests"),{fromId:o.id,fromUsername:o.username,fromDisplayName:o.displayName,toId:s,toUsername:l==null?void 0:l.username,status:"pending",createdAt:Wn.now()}),U(!0)}catch(he){console.error("Error sending friend request:",he)}finally{F(!1)}}},J=()=>{r("/messages",{state:{openChat:s}})},ae=he=>he.toLocaleDateString("de-DE",{month:"long",year:"numeric"});return f?p.jsx("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white flex items-center justify-center",children:p.jsx(ws,{size:32,className:"animate-spin text-delulu-violet"})}):l?s===(o==null?void 0:o.id)?(r("/profile"),null):p.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white safe-top pb-24",children:[p.jsx("div",{className:"px-6 pt-6",children:p.jsx("button",{onClick:()=>r(-1),className:"w-10 h-10 rounded-xl bg-white shadow-sm flex items-center justify-center mb-6",children:p.jsx(Is,{size:20,className:"text-delulu-text"})})}),p.jsxs("div",{className:"px-6 text-center mb-6",children:[p.jsxs("div",{className:"relative inline-block mb-4",children:[p.jsx("div",{className:`w-28 h-28 rounded-full flex items-center justify-center text-4xl ${l.isCreator?"bg-gradient-to-br from-purple-500 to-pink-500 text-white":"bg-delulu-violet/10"}`,children:l.avatar||""}),l.isVerified&&p.jsx("div",{className:"absolute -bottom-1 -right-1 w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center border-4 border-white",children:p.jsx(xx,{size:16,className:"text-white"})}),l.isCreator&&p.jsx("div",{className:"absolute -top-1 -right-1 w-8 h-8 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center border-4 border-white",children:p.jsx(Qi,{size:14,className:"text-white"})})]}),p.jsx("h1",{className:"font-display text-2xl font-bold text-delulu-text mb-1",children:l.displayName}),p.jsxs("p",{className:"text-delulu-muted mb-2",children:["@",l.username]}),p.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-delulu-violet/10 rounded-full mb-4",children:[p.jsx(sE,{size:16,className:"text-delulu-violet"}),p.jsxs("span",{className:"font-semibold text-delulu-violet",children:["Level ",l.level]})]}),l.bio&&p.jsx("p",{className:"text-sm text-delulu-text max-w-xs mx-auto mb-4",children:l.bio}),p.jsxs("p",{className:"text-xs text-delulu-muted flex items-center justify-center gap-1",children:[p.jsx(qd,{size:12}),"Dabei seit ",ae(l.joinedAt)]})]}),p.jsx("div",{className:"px-6 mb-6",children:p.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[p.jsxs("div",{className:"bg-white rounded-2xl p-4 text-center shadow-sm",children:[p.jsx(ai,{size:20,className:"mx-auto text-delulu-violet mb-2"}),p.jsx("p",{className:"font-bold text-delulu-text",children:l.friendsCount}),p.jsx("p",{className:"text-xs text-delulu-muted",children:"Freunde"})]}),p.jsxs("div",{className:"bg-white rounded-2xl p-4 text-center shadow-sm",children:[p.jsx(Cl,{size:20,className:"mx-auto text-green-500 mb-2"}),p.jsx("p",{className:"font-bold text-delulu-text",children:l.roomsJoined}),p.jsx("p",{className:"text-xs text-delulu-muted",children:"Rume"})]}),p.jsxs("div",{className:"bg-white rounded-2xl p-4 text-center shadow-sm",children:[p.jsx(Qi,{size:20,className:"mx-auto text-amber-500 mb-2"}),p.jsxs("p",{className:"font-bold text-delulu-text",children:[Math.floor(l.minutesTalked/60),"h"]}),p.jsx("p",{className:"text-xs text-delulu-muted",children:"Gesprochen"})]})]})}),p.jsxs("div",{className:"px-6 space-y-3",children:[T?p.jsxs("div",{className:"flex gap-3",children:[p.jsxs("button",{onClick:J,className:"flex-1 py-4 bg-delulu-violet text-white rounded-2xl font-semibold flex items-center justify-center gap-2",children:[p.jsx(Kh,{size:20}),"Nachricht"]}),p.jsx("button",{className:"w-14 h-14 bg-gray-100 text-gray-500 rounded-2xl flex items-center justify-center",children:p.jsx(sTe,{size:20})})]}):A?p.jsxs("button",{disabled:!0,className:"w-full py-4 bg-gray-100 text-gray-500 rounded-2xl font-semibold flex items-center justify-center gap-2",children:[p.jsx(xx,{size:20}),"Anfrage gesendet"]}):p.jsxs("button",{onClick:Y,disabled:M,className:"w-full py-4 bg-delulu-violet text-white rounded-2xl font-semibold flex items-center justify-center gap-2 disabled:opacity-50",children:[M?p.jsx(ws,{size:20,className:"animate-spin"}):p.jsx(Ih,{size:20}),"Freund hinzufgen"]}),p.jsxs("button",{className:"w-full py-3 bg-gray-100 text-gray-500 rounded-xl font-medium flex items-center justify-center gap-2 text-sm",children:[p.jsx(iq,{size:16}),"Nutzer melden"]})]})]}):p.jsx("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white safe-top pb-24",children:p.jsxs("div",{className:"px-6 pt-6",children:[p.jsx("button",{onClick:()=>r(-1),className:"w-10 h-10 rounded-xl bg-white shadow-sm flex items-center justify-center mb-6",children:p.jsx(Is,{size:20,className:"text-delulu-text"})}),p.jsxs("div",{className:"text-center py-8",children:[p.jsx("div",{className:"w-28 h-28 mx-auto rounded-full bg-delulu-violet/10 flex items-center justify-center mb-4",children:p.jsx("span",{className:"text-4xl",children:""})}),p.jsx("h1",{className:"font-display text-xl font-bold text-delulu-text mb-2",children:"Delulu Nutzer"}),p.jsx("p",{className:"text-sm text-delulu-muted mb-6",children:"Profil wird geladen..."}),p.jsx("button",{onClick:Y,disabled:M||A,className:"w-full max-w-xs mx-auto py-4 bg-delulu-violet text-white rounded-2xl font-semibold flex items-center justify-center gap-2 disabled:opacity-50",children:M?p.jsx(ws,{size:20,className:"animate-spin"}):A?p.jsxs(p.Fragment,{children:[p.jsx(xx,{size:20}),"Anfrage gesendet"]}):p.jsxs(p.Fragment,{children:[p.jsx(Ih,{size:20}),"Freund hinzufgen"]})})]})]})})},Dx=()=>{const s=ei();return p.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white safe-top safe-bottom pb-24",children:[p.jsx("div",{className:"sticky top-0 z-20 bg-white/90 backdrop-blur-lg border-b border-gray-100",children:p.jsxs("div",{className:"px-6 py-4 flex items-center gap-4",children:[p.jsx("button",{onClick:()=>s(-1),className:"w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-delulu-muted hover:bg-gray-200 transition-colors",children:p.jsx(Is,{size:20})}),p.jsx("h1",{className:"font-display text-xl font-bold text-delulu-text",children:"Impressum"})]})}),p.jsxs("div",{className:"px-6 py-6 space-y-6",children:[p.jsxs("section",{children:[p.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"Angaben gem  5 TMG"}),p.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm space-y-2",children:[p.jsx("p",{className:"text-delulu-text font-medium",children:"Butterbread UG (haftungsbeschrnkt)"}),p.jsx("p",{className:"text-delulu-muted",children:"Musterstrae 123"}),p.jsx("p",{className:"text-delulu-muted",children:"12345 Musterstadt"}),p.jsx("p",{className:"text-delulu-muted",children:"Deutschland"})]})]}),p.jsxs("section",{children:[p.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"Kontakt"}),p.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm space-y-2",children:[p.jsxs("p",{className:"text-delulu-muted",children:[p.jsx("span",{className:"text-delulu-text",children:"E-Mail:"})," kontakt@delulu.app"]}),p.jsxs("p",{className:"text-delulu-muted",children:[p.jsx("span",{className:"text-delulu-text",children:"Telefon:"})," +49 (0) 123 456789"]})]})]}),p.jsxs("section",{children:[p.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"Vertreten durch"}),p.jsx("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:p.jsx("p",{className:"text-delulu-muted",children:"Geschftsfhrer: Jan Hundsdorff"})})]}),p.jsxs("section",{children:[p.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"Handelsregister"}),p.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm space-y-2",children:[p.jsxs("p",{className:"text-delulu-muted",children:[p.jsx("span",{className:"text-delulu-text",children:"Registergericht:"})," Amtsgericht Musterstadt"]}),p.jsxs("p",{className:"text-delulu-muted",children:[p.jsx("span",{className:"text-delulu-text",children:"Registernummer:"})," HRB 12345"]})]})]}),p.jsxs("section",{children:[p.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"Umsatzsteuer-ID"}),p.jsx("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:p.jsxs("p",{className:"text-delulu-muted",children:["Umsatzsteuer-Identifikationsnummer gem  27 a Umsatzsteuergesetz:",p.jsx("br",{}),"DE 123456789"]})})]}),p.jsxs("section",{children:[p.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"Verantwortlich fr den Inhalt nach  55 Abs. 2 RStV"}),p.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm space-y-2",children:[p.jsx("p",{className:"text-delulu-text font-medium",children:"Jan Hundsdorff"}),p.jsx("p",{className:"text-delulu-muted",children:"Musterstrae 123"}),p.jsx("p",{className:"text-delulu-muted",children:"12345 Musterstadt"})]})]}),p.jsxs("section",{children:[p.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"Streitschlichtung"}),p.jsx("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:p.jsxs("p",{className:"text-delulu-muted text-sm",children:["Die Europische Kommission stellt eine Plattform zur Online-Streitbeilegung (OS) bereit:",p.jsx("span",{className:"text-delulu-violet",children:" https://ec.europa.eu/consumers/odr"}),p.jsx("br",{}),p.jsx("br",{}),"Unsere E-Mail-Adresse finden Sie oben im Impressum.",p.jsx("br",{}),p.jsx("br",{}),"Wir sind nicht bereit oder verpflichtet, an Streitbeilegungsverfahren vor einer Verbraucherschlichtungsstelle teilzunehmen."]})})]}),p.jsx("div",{className:"text-center text-xs text-delulu-muted pt-4",children:"Stand: Januar 2025"})]})]})},kx=()=>{const s=ei();return p.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white safe-top safe-bottom pb-24",children:[p.jsx("div",{className:"sticky top-0 z-20 bg-white/90 backdrop-blur-lg border-b border-gray-100",children:p.jsxs("div",{className:"px-6 py-4 flex items-center gap-4",children:[p.jsx("button",{onClick:()=>s(-1),className:"w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-delulu-muted hover:bg-gray-200 transition-colors",children:p.jsx(Is,{size:20})}),p.jsx("h1",{className:"font-display text-xl font-bold text-delulu-text",children:"Datenschutzerklrung"})]})}),p.jsxs("div",{className:"px-6 py-6 space-y-6",children:[p.jsxs("section",{children:[p.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"1. Datenschutz auf einen Blick"}),p.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:[p.jsx("h3",{className:"font-medium text-delulu-text mb-2",children:"Allgemeine Hinweise"}),p.jsx("p",{className:"text-delulu-muted text-sm",children:"Die folgenden Hinweise geben einen einfachen berblick darber, was mit Ihren personenbezogenen Daten passiert, wenn Sie diese App nutzen. Personenbezogene Daten sind alle Daten, mit denen Sie persnlich identifiziert werden knnen."})]})]}),p.jsxs("section",{children:[p.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"2. Datenerfassung in der App"}),p.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm space-y-4",children:[p.jsxs("div",{children:[p.jsx("h3",{className:"font-medium text-delulu-text mb-2",children:"Welche Daten erfassen wir?"}),p.jsxs("p",{className:"text-delulu-muted text-sm",children:[" Registrierungsdaten (E-Mail, Benutzername, Passwort)",p.jsx("br",{})," Profilinformationen (Avatar, Bio, Display-Name)",p.jsx("br",{})," Nutzungsdaten (Level, XP, Voice-Minuten, Sterne)",p.jsx("br",{})," Standortdaten (bei aktivierter Standortfreigabe)",p.jsx("br",{})," Gerte-Informationen"]})]}),p.jsxs("div",{children:[p.jsx("h3",{className:"font-medium text-delulu-text mb-2",children:"Wie erfassen wir Ihre Daten?"}),p.jsx("p",{className:"text-delulu-muted text-sm",children:"Ihre Daten werden zum einen dadurch erhoben, dass Sie uns diese mitteilen (z.B. bei der Registrierung). Andere Daten werden automatisch beim Nutzen der App durch unsere IT-Systeme erfasst."})]})]})]}),p.jsxs("section",{children:[p.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"3. Standortdaten"}),p.jsx("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:p.jsxs("p",{className:"text-delulu-muted text-sm",children:["delulu nutzt Standortdaten, um Nutzer in deiner Nhe zu finden und Voice-Rume basierend auf der Region anzuzeigen. Die Standortfreigabe ist optional und kann jederzeit in den Einstellungen deaktiviert werden.",p.jsx("br",{}),p.jsx("br",{}),p.jsx("strong",{children:"Wichtig:"})," Wir speichern keine genauen GPS-Koordinaten, sondern nur eine ungefhre Region (z.B. Stadt oder Stadtteil)."]})})]}),p.jsxs("section",{children:[p.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"4. Voice-Chat Daten"}),p.jsx("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:p.jsxs("p",{className:"text-delulu-muted text-sm",children:["Voice-Chats werden ",p.jsx("strong",{children:"nicht"})," aufgezeichnet oder gespeichert. Alle Gesprche sind live und werden nach Beendigung nicht archiviert.",p.jsx("br",{}),p.jsx("br",{}),"Wir erfassen lediglich Metadaten wie Dauer der Teilnahme (zur XP-Berechnung) und Bewertungen durch andere Nutzer."]})})]}),p.jsxs("section",{children:[p.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"5. Ihre Rechte"}),p.jsx("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:p.jsxs("p",{className:"text-delulu-muted text-sm",children:["Sie haben jederzeit das Recht:",p.jsx("br",{}),p.jsx("br",{})," Auskunft ber Ihre gespeicherten Daten zu erhalten",p.jsx("br",{})," Berichtigung unrichtiger Daten zu verlangen",p.jsx("br",{})," Lschung Ihrer Daten zu verlangen",p.jsx("br",{})," Die Verarbeitung einzuschrnken",p.jsx("br",{})," Datenbertragbarkeit zu verlangen",p.jsx("br",{})," Widerspruch gegen die Verarbeitung einzulegen"]})})]}),p.jsxs("section",{children:[p.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"6. Datenlschung"}),p.jsx("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:p.jsx("p",{className:"text-delulu-muted text-sm",children:'ber die Einstellungen  "Account lschen" knnen Sie Ihre gesamten Daten unwiderruflich lschen. Nach Besttigung werden alle personenbezogenen Daten innerhalb von 30 Tagen vollstndig entfernt.'})})]}),p.jsxs("section",{children:[p.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"7. Kontakt"}),p.jsx("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:p.jsxs("p",{className:"text-delulu-muted text-sm",children:["Bei Fragen zum Datenschutz erreichen Sie uns unter:",p.jsx("br",{}),p.jsx("br",{}),p.jsx("strong",{children:"Butterbread UG (haftungsbeschrnkt)"}),p.jsx("br",{}),"Musterstrae 123",p.jsx("br",{}),"12345 Musterstadt",p.jsx("br",{}),p.jsx("br",{}),"E-Mail: datenschutz@delulu.app"]})})]}),p.jsxs("section",{children:[p.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"8. nderungen"}),p.jsx("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:p.jsx("p",{className:"text-delulu-muted text-sm",children:"Wir behalten uns vor, diese Datenschutzerklrung anzupassen, damit sie stets den aktuellen rechtlichen Anforderungen entspricht oder um nderungen unserer Leistungen umzusetzen. Fr Ihren erneuten Besuch gilt dann die neue Datenschutzerklrung."})})]}),p.jsx("div",{className:"text-center text-xs text-delulu-muted pt-4",children:"Stand: Januar 2025"})]})]})},zTe=[{to:"/",icon:KSe,label:"Home"},{to:"/discover",icon:sk,label:"Entdecken"},{to:"/messages",icon:Kh,label:"Nachrichten"},{to:"/profile",icon:Ah,label:"Profil"}],HTe=()=>p.jsx("nav",{className:"fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-lg border-t border-delulu-soft safe-bottom z-50",children:p.jsx("div",{className:"flex items-center justify-around h-16 max-w-lg mx-auto px-4",children:zTe.map(({to:s,icon:r,label:o})=>p.jsx(xpe,{to:s,className:({isActive:l})=>`flex flex-col items-center justify-center gap-1 px-4 py-2 rounded-xl transition-all ${l?"text-delulu-violet":"text-delulu-muted hover:text-delulu-text"}`,children:({isActive:l})=>p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:`relative ${l?"scale-110":""} transition-transform`,children:[p.jsx(r,{size:22,strokeWidth:l?2.5:2}),l&&p.jsx("div",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-1 h-1 bg-delulu-violet rounded-full"})]}),p.jsx("span",{className:"text-[10px] font-medium",children:o})]})},s))})}),KTe=()=>p.jsxs("div",{className:"min-h-screen min-h-[100dvh] bg-delulu-bg flex flex-col items-center justify-center",children:[p.jsxs("div",{className:"relative",children:[p.jsx("div",{className:"w-24 h-24 rounded-3xl bg-gradient-to-br from-delulu-violet to-delulu-violet-dark flex items-center justify-center shadow-lg",children:p.jsx("span",{className:"text-4xl",children:""})}),p.jsx("div",{className:"absolute inset-0 rounded-3xl bg-delulu-violet/30 pulse-ring"})]}),p.jsx("h1",{className:"font-display text-3xl font-bold mt-6 gradient-text",children:"delulu"}),p.jsx("p",{className:"text-delulu-muted text-sm mt-2",children:"Wird geladen..."})]});function qTe(){const{isAuthenticated:s,isLoading:r}=yR(),{user:o}=vi();return r?p.jsx(KTe,{}):s?(o==null?void 0:o.onboardingCompleted)===!0?p.jsxs("div",{className:"min-h-screen min-h-[100dvh] bg-delulu-bg pb-20",children:[p.jsxs(gx,{children:[p.jsx(nr,{path:"/",element:p.jsx(yTe,{})}),p.jsx(nr,{path:"/discover",element:p.jsx(wTe,{})}),p.jsx(nr,{path:"/messages",element:p.jsx(CTe,{})}),p.jsx(nr,{path:"/profile",element:p.jsx(xTe,{})}),p.jsx(nr,{path:"/statistics",element:p.jsx(OTe,{})}),p.jsx(nr,{path:"/notifications",element:p.jsx(PTe,{})}),p.jsx(nr,{path:"/premium",element:p.jsx(DTe,{})}),p.jsx(nr,{path:"/settings",element:p.jsx(LTe,{})}),p.jsx(nr,{path:"/help",element:p.jsx(UTe,{})}),p.jsx(nr,{path:"/stars/apply",element:p.jsx(jTe,{})}),p.jsx(nr,{path:"/stars/dashboard",element:p.jsx(VTe,{})}),p.jsx(nr,{path:"/stars/schedule",element:p.jsx(GTe,{})}),p.jsx(nr,{path:"/user/:userId",element:p.jsx(WTe,{})}),p.jsx(nr,{path:"/impressum",element:p.jsx(Dx,{})}),p.jsx(nr,{path:"/datenschutz",element:p.jsx(kx,{})}),p.jsx(nr,{path:"/onboarding",element:p.jsx(r0,{to:"/",replace:!0})}),p.jsx(nr,{path:"*",element:p.jsx(r0,{to:"/",replace:!0})})]}),p.jsx(HTe,{})]}):p.jsxs(gx,{children:[p.jsx(nr,{path:"/onboarding",element:p.jsx(uTe,{})}),p.jsx(nr,{path:"/impressum",element:p.jsx(Dx,{})}),p.jsx(nr,{path:"/datenschutz",element:p.jsx(kx,{})}),p.jsx(nr,{path:"*",element:p.jsx(r0,{to:"/onboarding",replace:!0})})]}):p.jsxs(gx,{children:[p.jsx(nr,{path:"/",element:p.jsx(kSe,{})}),p.jsx(nr,{path:"/login",element:p.jsx(lTe,{})}),p.jsx(nr,{path:"/register",element:p.jsx(dTe,{})}),p.jsx(nr,{path:"/impressum",element:p.jsx(Dx,{})}),p.jsx(nr,{path:"/datenschutz",element:p.jsx(kx,{})}),p.jsx(nr,{path:"*",element:p.jsx(r0,{to:"/",replace:!0})})]})}Lx.createRoot(document.getElementById("root")).render(p.jsx(dP.StrictMode,{children:p.jsx(Ipe,{children:p.jsx(qTe,{})})}));
