function yfe(s,n){for(var i=0;i<n.length;i++){const l=n[i];if(typeof l!="string"&&!Array.isArray(l)){for(const u in l)if(u!=="default"&&!(u in s)){const p=Object.getOwnPropertyDescriptor(l,u);p&&Object.defineProperty(s,u,p.get?p:{enumerable:!0,get:()=>l[u]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))l(u);new MutationObserver(u=>{for(const p of u)if(p.type==="childList")for(const g of p.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&l(g)}).observe(document,{childList:!0,subtree:!0});function i(u){const p={};return u.integrity&&(p.integrity=u.integrity),u.referrerPolicy&&(p.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?p.credentials="include":u.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function l(u){if(u.ep)return;u.ep=!0;const p=i(u);fetch(u.href,p)}})();const bfe="modulepreload",xfe=function(s){return"/"+s},OY={},eQ=function(n,i,l){let u=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const g=document.querySelector("meta[property=csp-nonce]"),y=(g==null?void 0:g.nonce)||(g==null?void 0:g.getAttribute("nonce"));u=Promise.allSettled(i.map(x=>{if(x=xfe(x),x in OY)return;OY[x]=!0;const C=x.endsWith(".css"),k=C?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${x}"]${k}`))return;const A=document.createElement("link");if(A.rel=C?"stylesheet":bfe,C||(A.as="script"),A.crossOrigin="",A.href=x,y&&A.setAttribute("nonce",y),document.head.appendChild(A),C)return new Promise((M,G)=>{A.addEventListener("load",M),A.addEventListener("error",()=>G(new Error(`Unable to preload CSS for ${x}`)))})}))}function p(g){const y=new Event("vite:preloadError",{cancelable:!0});if(y.payload=g,window.dispatchEvent(y),!y.defaultPrevented)throw g}return u.then(g=>{for(const y of g||[])y.status==="rejected"&&p(y.reason);return n().catch(p)})};var Gh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xV(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var tQ={exports:{}},vk={},nQ={exports:{}},yr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tT=Symbol.for("react.element"),wfe=Symbol.for("react.portal"),Sfe=Symbol.for("react.fragment"),Tfe=Symbol.for("react.strict_mode"),Rfe=Symbol.for("react.profiler"),Cfe=Symbol.for("react.provider"),Nfe=Symbol.for("react.context"),Ife=Symbol.for("react.forward_ref"),Afe=Symbol.for("react.suspense"),kfe=Symbol.for("react.memo"),Ofe=Symbol.for("react.lazy"),DY=Symbol.iterator;function Dfe(s){return s===null||typeof s!="object"?null:(s=DY&&s[DY]||s["@@iterator"],typeof s=="function"?s:null)}var rQ={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},sQ=Object.assign,iQ={};function Ty(s,n,i){this.props=s,this.context=n,this.refs=iQ,this.updater=i||rQ}Ty.prototype.isReactComponent={};Ty.prototype.setState=function(s,n){if(typeof s!="object"&&typeof s!="function"&&s!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,s,n,"setState")};Ty.prototype.forceUpdate=function(s){this.updater.enqueueForceUpdate(this,s,"forceUpdate")};function aQ(){}aQ.prototype=Ty.prototype;function wV(s,n,i){this.props=s,this.context=n,this.refs=iQ,this.updater=i||rQ}var SV=wV.prototype=new aQ;SV.constructor=wV;sQ(SV,Ty.prototype);SV.isPureReactComponent=!0;var PY=Array.isArray,oQ=Object.prototype.hasOwnProperty,TV={current:null},cQ={key:!0,ref:!0,__self:!0,__source:!0};function lQ(s,n,i){var l,u={},p=null,g=null;if(n!=null)for(l in n.ref!==void 0&&(g=n.ref),n.key!==void 0&&(p=""+n.key),n)oQ.call(n,l)&&!cQ.hasOwnProperty(l)&&(u[l]=n[l]);var y=arguments.length-2;if(y===1)u.children=i;else if(1<y){for(var x=Array(y),C=0;C<y;C++)x[C]=arguments[C+2];u.children=x}if(s&&s.defaultProps)for(l in y=s.defaultProps,y)u[l]===void 0&&(u[l]=y[l]);return{$$typeof:tT,type:s,key:p,ref:g,props:u,_owner:TV.current}}function Pfe(s,n){return{$$typeof:tT,type:s.type,key:n,ref:s.ref,props:s.props,_owner:s._owner}}function RV(s){return typeof s=="object"&&s!==null&&s.$$typeof===tT}function Lfe(s){var n={"=":"=0",":":"=2"};return"$"+s.replace(/[=:]/g,function(i){return n[i]})}var LY=/\/+/g;function FU(s,n){return typeof s=="object"&&s!==null&&s.key!=null?Lfe(""+s.key):n.toString(36)}function $A(s,n,i,l,u){var p=typeof s;(p==="undefined"||p==="boolean")&&(s=null);var g=!1;if(s===null)g=!0;else switch(p){case"string":case"number":g=!0;break;case"object":switch(s.$$typeof){case tT:case wfe:g=!0}}if(g)return g=s,u=u(g),s=l===""?"."+FU(g,0):l,PY(u)?(i="",s!=null&&(i=s.replace(LY,"$&/")+"/"),$A(u,n,i,"",function(C){return C})):u!=null&&(RV(u)&&(u=Pfe(u,i+(!u.key||g&&g.key===u.key?"":(""+u.key).replace(LY,"$&/")+"/")+s)),n.push(u)),1;if(g=0,l=l===""?".":l+":",PY(s))for(var y=0;y<s.length;y++){p=s[y];var x=l+FU(p,y);g+=$A(p,n,i,x,u)}else if(x=Dfe(s),typeof x=="function")for(s=x.call(s),y=0;!(p=s.next()).done;)p=p.value,x=l+FU(p,y++),g+=$A(p,n,i,x,u);else if(p==="object")throw n=String(s),Error("Objects are not valid as a React child (found: "+(n==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.");return g}function bA(s,n,i){if(s==null)return s;var l=[],u=0;return $A(s,l,"","",function(p){return n.call(i,p,u++)}),l}function jfe(s){if(s._status===-1){var n=s._result;n=n(),n.then(function(i){(s._status===0||s._status===-1)&&(s._status=1,s._result=i)},function(i){(s._status===0||s._status===-1)&&(s._status=2,s._result=i)}),s._status===-1&&(s._status=0,s._result=n)}if(s._status===1)return s._result.default;throw s._result}var Bo={current:null},JA={transition:null},Mfe={ReactCurrentDispatcher:Bo,ReactCurrentBatchConfig:JA,ReactCurrentOwner:TV};function dQ(){throw Error("act(...) is not supported in production builds of React.")}yr.Children={map:bA,forEach:function(s,n,i){bA(s,function(){n.apply(this,arguments)},i)},count:function(s){var n=0;return bA(s,function(){n++}),n},toArray:function(s){return bA(s,function(n){return n})||[]},only:function(s){if(!RV(s))throw Error("React.Children.only expected to receive a single React element child.");return s}};yr.Component=Ty;yr.Fragment=Sfe;yr.Profiler=Rfe;yr.PureComponent=wV;yr.StrictMode=Tfe;yr.Suspense=Afe;yr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Mfe;yr.act=dQ;yr.cloneElement=function(s,n,i){if(s==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+s+".");var l=sQ({},s.props),u=s.key,p=s.ref,g=s._owner;if(n!=null){if(n.ref!==void 0&&(p=n.ref,g=TV.current),n.key!==void 0&&(u=""+n.key),s.type&&s.type.defaultProps)var y=s.type.defaultProps;for(x in n)oQ.call(n,x)&&!cQ.hasOwnProperty(x)&&(l[x]=n[x]===void 0&&y!==void 0?y[x]:n[x])}var x=arguments.length-2;if(x===1)l.children=i;else if(1<x){y=Array(x);for(var C=0;C<x;C++)y[C]=arguments[C+2];l.children=y}return{$$typeof:tT,type:s.type,key:u,ref:p,props:l,_owner:g}};yr.createContext=function(s){return s={$$typeof:Nfe,_currentValue:s,_currentValue2:s,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},s.Provider={$$typeof:Cfe,_context:s},s.Consumer=s};yr.createElement=lQ;yr.createFactory=function(s){var n=lQ.bind(null,s);return n.type=s,n};yr.createRef=function(){return{current:null}};yr.forwardRef=function(s){return{$$typeof:Ife,render:s}};yr.isValidElement=RV;yr.lazy=function(s){return{$$typeof:Ofe,_payload:{_status:-1,_result:s},_init:jfe}};yr.memo=function(s,n){return{$$typeof:kfe,type:s,compare:n===void 0?null:n}};yr.startTransition=function(s){var n=JA.transition;JA.transition={};try{s()}finally{JA.transition=n}};yr.unstable_act=dQ;yr.useCallback=function(s,n){return Bo.current.useCallback(s,n)};yr.useContext=function(s){return Bo.current.useContext(s)};yr.useDebugValue=function(){};yr.useDeferredValue=function(s){return Bo.current.useDeferredValue(s)};yr.useEffect=function(s,n){return Bo.current.useEffect(s,n)};yr.useId=function(){return Bo.current.useId()};yr.useImperativeHandle=function(s,n,i){return Bo.current.useImperativeHandle(s,n,i)};yr.useInsertionEffect=function(s,n){return Bo.current.useInsertionEffect(s,n)};yr.useLayoutEffect=function(s,n){return Bo.current.useLayoutEffect(s,n)};yr.useMemo=function(s,n){return Bo.current.useMemo(s,n)};yr.useReducer=function(s,n,i){return Bo.current.useReducer(s,n,i)};yr.useRef=function(s){return Bo.current.useRef(s)};yr.useState=function(s){return Bo.current.useState(s)};yr.useSyncExternalStore=function(s,n,i){return Bo.current.useSyncExternalStore(s,n,i)};yr.useTransition=function(){return Bo.current.useTransition()};yr.version="18.3.1";nQ.exports=yr;var H=nQ.exports;const CV=xV(H),Ufe=yfe({__proto__:null,default:CV},[H]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vfe=H,Ffe=Symbol.for("react.element"),Bfe=Symbol.for("react.fragment"),zfe=Object.prototype.hasOwnProperty,Gfe=Vfe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Wfe={key:!0,ref:!0,__self:!0,__source:!0};function uQ(s,n,i){var l,u={},p=null,g=null;i!==void 0&&(p=""+i),n.key!==void 0&&(p=""+n.key),n.ref!==void 0&&(g=n.ref);for(l in n)zfe.call(n,l)&&!Wfe.hasOwnProperty(l)&&(u[l]=n[l]);if(s&&s.defaultProps)for(l in n=s.defaultProps,n)u[l]===void 0&&(u[l]=n[l]);return{$$typeof:Ffe,type:s,key:p,ref:g,props:u,_owner:Gfe.current}}vk.Fragment=Bfe;vk.jsx=uQ;vk.jsxs=uQ;tQ.exports=vk;var o=tQ.exports,V4={},hQ={exports:{}},Zc={},pQ={exports:{}},fQ={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(s){function n(ze,ut){var yt=ze.length;ze.push(ut);e:for(;0<yt;){var Xt=yt-1>>>1,jt=ze[Xt];if(0<u(jt,ut))ze[Xt]=ut,ze[yt]=jt,yt=Xt;else break e}}function i(ze){return ze.length===0?null:ze[0]}function l(ze){if(ze.length===0)return null;var ut=ze[0],yt=ze.pop();if(yt!==ut){ze[0]=yt;e:for(var Xt=0,jt=ze.length,Gt=jt>>>1;Xt<Gt;){var mn=2*(Xt+1)-1,Pt=ze[mn],Jt=mn+1,He=ze[Jt];if(0>u(Pt,yt))Jt<jt&&0>u(He,Pt)?(ze[Xt]=He,ze[Jt]=yt,Xt=Jt):(ze[Xt]=Pt,ze[mn]=yt,Xt=mn);else if(Jt<jt&&0>u(He,yt))ze[Xt]=He,ze[Jt]=yt,Xt=Jt;else break e}}return ut}function u(ze,ut){var yt=ze.sortIndex-ut.sortIndex;return yt!==0?yt:ze.id-ut.id}if(typeof performance=="object"&&typeof performance.now=="function"){var p=performance;s.unstable_now=function(){return p.now()}}else{var g=Date,y=g.now();s.unstable_now=function(){return g.now()-y}}var x=[],C=[],k=1,A=null,M=3,G=!1,B=!1,X=!1,Z=typeof setTimeout=="function"?setTimeout:null,q=typeof clearTimeout=="function"?clearTimeout:null,V=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ee(ze){for(var ut=i(C);ut!==null;){if(ut.callback===null)l(C);else if(ut.startTime<=ze)l(C),ut.sortIndex=ut.expirationTime,n(x,ut);else break;ut=i(C)}}function de(ze){if(X=!1,ee(ze),!B)if(i(x)!==null)B=!0,gt(ae);else{var ut=i(C);ut!==null&&Ye(de,ut.startTime-ze)}}function ae(ze,ut){B=!1,X&&(X=!1,q($),$=-1),G=!0;var yt=M;try{for(ee(ut),A=i(x);A!==null&&(!(A.expirationTime>ut)||ze&&!he());){var Xt=A.callback;if(typeof Xt=="function"){A.callback=null,M=A.priorityLevel;var jt=Xt(A.expirationTime<=ut);ut=s.unstable_now(),typeof jt=="function"?A.callback=jt:A===i(x)&&l(x),ee(ut)}else l(x);A=i(x)}if(A!==null)var Gt=!0;else{var mn=i(C);mn!==null&&Ye(de,mn.startTime-ut),Gt=!1}return Gt}finally{A=null,M=yt,G=!1}}var ye=!1,Q=null,$=-1,se=5,ce=-1;function he(){return!(s.unstable_now()-ce<se)}function ve(){if(Q!==null){var ze=s.unstable_now();ce=ze;var ut=!0;try{ut=Q(!0,ze)}finally{ut?ge():(ye=!1,Q=null)}}else ye=!1}var ge;if(typeof V=="function")ge=function(){V(ve)};else if(typeof MessageChannel<"u"){var qe=new MessageChannel,Dt=qe.port2;qe.port1.onmessage=ve,ge=function(){Dt.postMessage(null)}}else ge=function(){Z(ve,0)};function gt(ze){Q=ze,ye||(ye=!0,ge())}function Ye(ze,ut){$=Z(function(){ze(s.unstable_now())},ut)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(ze){ze.callback=null},s.unstable_continueExecution=function(){B||G||(B=!0,gt(ae))},s.unstable_forceFrameRate=function(ze){0>ze||125<ze?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):se=0<ze?Math.floor(1e3/ze):5},s.unstable_getCurrentPriorityLevel=function(){return M},s.unstable_getFirstCallbackNode=function(){return i(x)},s.unstable_next=function(ze){switch(M){case 1:case 2:case 3:var ut=3;break;default:ut=M}var yt=M;M=ut;try{return ze()}finally{M=yt}},s.unstable_pauseExecution=function(){},s.unstable_requestPaint=function(){},s.unstable_runWithPriority=function(ze,ut){switch(ze){case 1:case 2:case 3:case 4:case 5:break;default:ze=3}var yt=M;M=ze;try{return ut()}finally{M=yt}},s.unstable_scheduleCallback=function(ze,ut,yt){var Xt=s.unstable_now();switch(typeof yt=="object"&&yt!==null?(yt=yt.delay,yt=typeof yt=="number"&&0<yt?Xt+yt:Xt):yt=Xt,ze){case 1:var jt=-1;break;case 2:jt=250;break;case 5:jt=1073741823;break;case 4:jt=1e4;break;default:jt=5e3}return jt=yt+jt,ze={id:k++,callback:ut,priorityLevel:ze,startTime:yt,expirationTime:jt,sortIndex:-1},yt>Xt?(ze.sortIndex=yt,n(C,ze),i(x)===null&&ze===i(C)&&(X?(q($),$=-1):X=!0,Ye(de,yt-Xt))):(ze.sortIndex=jt,n(x,ze),B||G||(B=!0,gt(ae))),ze},s.unstable_shouldYield=he,s.unstable_wrapCallback=function(ze){var ut=M;return function(){var yt=M;M=ut;try{return ze.apply(this,arguments)}finally{M=yt}}}})(fQ);pQ.exports=fQ;var Hfe=pQ.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kfe=H,Jc=Hfe;function ft(s){for(var n="https://reactjs.org/docs/error-decoder.html?invariant="+s,i=1;i<arguments.length;i++)n+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+s+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var mQ=new Set,vS={};function P_(s,n){ZE(s,n),ZE(s+"Capture",n)}function ZE(s,n){for(vS[s]=n,s=0;s<n.length;s++)mQ.add(n[s])}var rp=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),F4=Object.prototype.hasOwnProperty,qfe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,jY={},MY={};function Yfe(s){return F4.call(MY,s)?!0:F4.call(jY,s)?!1:qfe.test(s)?MY[s]=!0:(jY[s]=!0,!1)}function Xfe(s,n,i,l){if(i!==null&&i.type===0)return!1;switch(typeof n){case"function":case"symbol":return!0;case"boolean":return l?!1:i!==null?!i.acceptsBooleans:(s=s.toLowerCase().slice(0,5),s!=="data-"&&s!=="aria-");default:return!1}}function $fe(s,n,i,l){if(n===null||typeof n>"u"||Xfe(s,n,i,l))return!0;if(l)return!1;if(i!==null)switch(i.type){case 3:return!n;case 4:return n===!1;case 5:return isNaN(n);case 6:return isNaN(n)||1>n}return!1}function zo(s,n,i,l,u,p,g){this.acceptsBooleans=n===2||n===3||n===4,this.attributeName=l,this.attributeNamespace=u,this.mustUseProperty=i,this.propertyName=s,this.type=n,this.sanitizeURL=p,this.removeEmptyString=g}var Ja={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(s){Ja[s]=new zo(s,0,!1,s,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(s){var n=s[0];Ja[n]=new zo(n,1,!1,s[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(s){Ja[s]=new zo(s,2,!1,s.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(s){Ja[s]=new zo(s,2,!1,s,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(s){Ja[s]=new zo(s,3,!1,s.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(s){Ja[s]=new zo(s,3,!0,s,null,!1,!1)});["capture","download"].forEach(function(s){Ja[s]=new zo(s,4,!1,s,null,!1,!1)});["cols","rows","size","span"].forEach(function(s){Ja[s]=new zo(s,6,!1,s,null,!1,!1)});["rowSpan","start"].forEach(function(s){Ja[s]=new zo(s,5,!1,s.toLowerCase(),null,!1,!1)});var NV=/[\-:]([a-z])/g;function IV(s){return s[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(s){var n=s.replace(NV,IV);Ja[n]=new zo(n,1,!1,s,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(s){var n=s.replace(NV,IV);Ja[n]=new zo(n,1,!1,s,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(s){var n=s.replace(NV,IV);Ja[n]=new zo(n,1,!1,s,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(s){Ja[s]=new zo(s,1,!1,s.toLowerCase(),null,!1,!1)});Ja.xlinkHref=new zo("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(s){Ja[s]=new zo(s,1,!1,s.toLowerCase(),null,!0,!0)});function AV(s,n,i,l){var u=Ja.hasOwnProperty(n)?Ja[n]:null;(u!==null?u.type!==0:l||!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N")&&($fe(n,i,u,l)&&(i=null),l||u===null?Yfe(n)&&(i===null?s.removeAttribute(n):s.setAttribute(n,""+i)):u.mustUseProperty?s[u.propertyName]=i===null?u.type===3?!1:"":i:(n=u.attributeName,l=u.attributeNamespace,i===null?s.removeAttribute(n):(u=u.type,i=u===3||u===4&&i===!0?"":""+i,l?s.setAttributeNS(l,n,i):s.setAttribute(n,i))))}var up=Kfe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,xA=Symbol.for("react.element"),CE=Symbol.for("react.portal"),NE=Symbol.for("react.fragment"),kV=Symbol.for("react.strict_mode"),B4=Symbol.for("react.profiler"),gQ=Symbol.for("react.provider"),_Q=Symbol.for("react.context"),OV=Symbol.for("react.forward_ref"),z4=Symbol.for("react.suspense"),G4=Symbol.for("react.suspense_list"),DV=Symbol.for("react.memo"),kf=Symbol.for("react.lazy"),vQ=Symbol.for("react.offscreen"),UY=Symbol.iterator;function Iw(s){return s===null||typeof s!="object"?null:(s=UY&&s[UY]||s["@@iterator"],typeof s=="function"?s:null)}var di=Object.assign,BU;function Bw(s){if(BU===void 0)try{throw Error()}catch(i){var n=i.stack.trim().match(/\n( *(at )?)/);BU=n&&n[1]||""}return`
`+BU+s}var zU=!1;function GU(s,n){if(!s||zU)return"";zU=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(n)if(n=function(){throw Error()},Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(n,[])}catch(C){var l=C}Reflect.construct(s,[],n)}else{try{n.call()}catch(C){l=C}s.call(n.prototype)}else{try{throw Error()}catch(C){l=C}s()}}catch(C){if(C&&l&&typeof C.stack=="string"){for(var u=C.stack.split(`
`),p=l.stack.split(`
`),g=u.length-1,y=p.length-1;1<=g&&0<=y&&u[g]!==p[y];)y--;for(;1<=g&&0<=y;g--,y--)if(u[g]!==p[y]){if(g!==1||y!==1)do if(g--,y--,0>y||u[g]!==p[y]){var x=`
`+u[g].replace(" at new "," at ");return s.displayName&&x.includes("<anonymous>")&&(x=x.replace("<anonymous>",s.displayName)),x}while(1<=g&&0<=y);break}}}finally{zU=!1,Error.prepareStackTrace=i}return(s=s?s.displayName||s.name:"")?Bw(s):""}function Jfe(s){switch(s.tag){case 5:return Bw(s.type);case 16:return Bw("Lazy");case 13:return Bw("Suspense");case 19:return Bw("SuspenseList");case 0:case 2:case 15:return s=GU(s.type,!1),s;case 11:return s=GU(s.type.render,!1),s;case 1:return s=GU(s.type,!0),s;default:return""}}function W4(s){if(s==null)return null;if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case NE:return"Fragment";case CE:return"Portal";case B4:return"Profiler";case kV:return"StrictMode";case z4:return"Suspense";case G4:return"SuspenseList"}if(typeof s=="object")switch(s.$$typeof){case _Q:return(s.displayName||"Context")+".Consumer";case gQ:return(s._context.displayName||"Context")+".Provider";case OV:var n=s.render;return s=s.displayName,s||(s=n.displayName||n.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case DV:return n=s.displayName||null,n!==null?n:W4(s.type)||"Memo";case kf:n=s._payload,s=s._init;try{return W4(s(n))}catch{}}return null}function Qfe(s){var n=s.type;switch(s.tag){case 24:return"Cache";case 9:return(n.displayName||"Context")+".Consumer";case 10:return(n._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return s=n.render,s=s.displayName||s.name||"",n.displayName||(s!==""?"ForwardRef("+s+")":"ForwardRef");case 7:return"Fragment";case 5:return n;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return W4(n);case 8:return n===kV?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n}return null}function om(s){switch(typeof s){case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function EQ(s){var n=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function Zfe(s){var n=EQ(s)?"checked":"value",i=Object.getOwnPropertyDescriptor(s.constructor.prototype,n),l=""+s[n];if(!s.hasOwnProperty(n)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var u=i.get,p=i.set;return Object.defineProperty(s,n,{configurable:!0,get:function(){return u.call(this)},set:function(g){l=""+g,p.call(this,g)}}),Object.defineProperty(s,n,{enumerable:i.enumerable}),{getValue:function(){return l},setValue:function(g){l=""+g},stopTracking:function(){s._valueTracker=null,delete s[n]}}}}function wA(s){s._valueTracker||(s._valueTracker=Zfe(s))}function yQ(s){if(!s)return!1;var n=s._valueTracker;if(!n)return!0;var i=n.getValue(),l="";return s&&(l=EQ(s)?s.checked?"true":"false":s.value),s=l,s!==i?(n.setValue(s),!0):!1}function v1(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}function H4(s,n){var i=n.checked;return di({},n,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??s._wrapperState.initialChecked})}function VY(s,n){var i=n.defaultValue==null?"":n.defaultValue,l=n.checked!=null?n.checked:n.defaultChecked;i=om(n.value!=null?n.value:i),s._wrapperState={initialChecked:l,initialValue:i,controlled:n.type==="checkbox"||n.type==="radio"?n.checked!=null:n.value!=null}}function bQ(s,n){n=n.checked,n!=null&&AV(s,"checked",n,!1)}function K4(s,n){bQ(s,n);var i=om(n.value),l=n.type;if(i!=null)l==="number"?(i===0&&s.value===""||s.value!=i)&&(s.value=""+i):s.value!==""+i&&(s.value=""+i);else if(l==="submit"||l==="reset"){s.removeAttribute("value");return}n.hasOwnProperty("value")?q4(s,n.type,i):n.hasOwnProperty("defaultValue")&&q4(s,n.type,om(n.defaultValue)),n.checked==null&&n.defaultChecked!=null&&(s.defaultChecked=!!n.defaultChecked)}function FY(s,n,i){if(n.hasOwnProperty("value")||n.hasOwnProperty("defaultValue")){var l=n.type;if(!(l!=="submit"&&l!=="reset"||n.value!==void 0&&n.value!==null))return;n=""+s._wrapperState.initialValue,i||n===s.value||(s.value=n),s.defaultValue=n}i=s.name,i!==""&&(s.name=""),s.defaultChecked=!!s._wrapperState.initialChecked,i!==""&&(s.name=i)}function q4(s,n,i){(n!=="number"||v1(s.ownerDocument)!==s)&&(i==null?s.defaultValue=""+s._wrapperState.initialValue:s.defaultValue!==""+i&&(s.defaultValue=""+i))}var zw=Array.isArray;function BE(s,n,i,l){if(s=s.options,n){n={};for(var u=0;u<i.length;u++)n["$"+i[u]]=!0;for(i=0;i<s.length;i++)u=n.hasOwnProperty("$"+s[i].value),s[i].selected!==u&&(s[i].selected=u),u&&l&&(s[i].defaultSelected=!0)}else{for(i=""+om(i),n=null,u=0;u<s.length;u++){if(s[u].value===i){s[u].selected=!0,l&&(s[u].defaultSelected=!0);return}n!==null||s[u].disabled||(n=s[u])}n!==null&&(n.selected=!0)}}function Y4(s,n){if(n.dangerouslySetInnerHTML!=null)throw Error(ft(91));return di({},n,{value:void 0,defaultValue:void 0,children:""+s._wrapperState.initialValue})}function BY(s,n){var i=n.value;if(i==null){if(i=n.children,n=n.defaultValue,i!=null){if(n!=null)throw Error(ft(92));if(zw(i)){if(1<i.length)throw Error(ft(93));i=i[0]}n=i}n==null&&(n=""),i=n}s._wrapperState={initialValue:om(i)}}function xQ(s,n){var i=om(n.value),l=om(n.defaultValue);i!=null&&(i=""+i,i!==s.value&&(s.value=i),n.defaultValue==null&&s.defaultValue!==i&&(s.defaultValue=i)),l!=null&&(s.defaultValue=""+l)}function zY(s){var n=s.textContent;n===s._wrapperState.initialValue&&n!==""&&n!==null&&(s.value=n)}function wQ(s){switch(s){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function X4(s,n){return s==null||s==="http://www.w3.org/1999/xhtml"?wQ(n):s==="http://www.w3.org/2000/svg"&&n==="foreignObject"?"http://www.w3.org/1999/xhtml":s}var SA,SQ=function(s){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(n,i,l,u){MSApp.execUnsafeLocalFunction(function(){return s(n,i,l,u)})}:s}(function(s,n){if(s.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in s)s.innerHTML=n;else{for(SA=SA||document.createElement("div"),SA.innerHTML="<svg>"+n.valueOf().toString()+"</svg>",n=SA.firstChild;s.firstChild;)s.removeChild(s.firstChild);for(;n.firstChild;)s.appendChild(n.firstChild)}});function ES(s,n){if(n){var i=s.firstChild;if(i&&i===s.lastChild&&i.nodeType===3){i.nodeValue=n;return}}s.textContent=n}var Qw={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},eme=["Webkit","ms","Moz","O"];Object.keys(Qw).forEach(function(s){eme.forEach(function(n){n=n+s.charAt(0).toUpperCase()+s.substring(1),Qw[n]=Qw[s]})});function TQ(s,n,i){return n==null||typeof n=="boolean"||n===""?"":i||typeof n!="number"||n===0||Qw.hasOwnProperty(s)&&Qw[s]?(""+n).trim():n+"px"}function RQ(s,n){s=s.style;for(var i in n)if(n.hasOwnProperty(i)){var l=i.indexOf("--")===0,u=TQ(i,n[i],l);i==="float"&&(i="cssFloat"),l?s.setProperty(i,u):s[i]=u}}var tme=di({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function $4(s,n){if(n){if(tme[s]&&(n.children!=null||n.dangerouslySetInnerHTML!=null))throw Error(ft(137,s));if(n.dangerouslySetInnerHTML!=null){if(n.children!=null)throw Error(ft(60));if(typeof n.dangerouslySetInnerHTML!="object"||!("__html"in n.dangerouslySetInnerHTML))throw Error(ft(61))}if(n.style!=null&&typeof n.style!="object")throw Error(ft(62))}}function J4(s,n){if(s.indexOf("-")===-1)return typeof n.is=="string";switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Q4=null;function PV(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Z4=null,zE=null,GE=null;function GY(s){if(s=sT(s)){if(typeof Z4!="function")throw Error(ft(280));var n=s.stateNode;n&&(n=wk(n),Z4(s.stateNode,s.type,n))}}function CQ(s){zE?GE?GE.push(s):GE=[s]:zE=s}function NQ(){if(zE){var s=zE,n=GE;if(GE=zE=null,GY(s),n)for(s=0;s<n.length;s++)GY(n[s])}}function IQ(s,n){return s(n)}function AQ(){}var WU=!1;function kQ(s,n,i){if(WU)return s(n,i);WU=!0;try{return IQ(s,n,i)}finally{WU=!1,(zE!==null||GE!==null)&&(AQ(),NQ())}}function yS(s,n){var i=s.stateNode;if(i===null)return null;var l=wk(i);if(l===null)return null;i=l[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(s=s.type,l=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!l;break e;default:s=!1}if(s)return null;if(i&&typeof i!="function")throw Error(ft(231,n,typeof i));return i}var e5=!1;if(rp)try{var Aw={};Object.defineProperty(Aw,"passive",{get:function(){e5=!0}}),window.addEventListener("test",Aw,Aw),window.removeEventListener("test",Aw,Aw)}catch{e5=!1}function nme(s,n,i,l,u,p,g,y,x){var C=Array.prototype.slice.call(arguments,3);try{n.apply(i,C)}catch(k){this.onError(k)}}var Zw=!1,E1=null,y1=!1,t5=null,rme={onError:function(s){Zw=!0,E1=s}};function sme(s,n,i,l,u,p,g,y,x){Zw=!1,E1=null,nme.apply(rme,arguments)}function ime(s,n,i,l,u,p,g,y,x){if(sme.apply(this,arguments),Zw){if(Zw){var C=E1;Zw=!1,E1=null}else throw Error(ft(198));y1||(y1=!0,t5=C)}}function L_(s){var n=s,i=s;if(s.alternate)for(;n.return;)n=n.return;else{s=n;do n=s,n.flags&4098&&(i=n.return),s=n.return;while(s)}return n.tag===3?i:null}function OQ(s){if(s.tag===13){var n=s.memoizedState;if(n===null&&(s=s.alternate,s!==null&&(n=s.memoizedState)),n!==null)return n.dehydrated}return null}function WY(s){if(L_(s)!==s)throw Error(ft(188))}function ame(s){var n=s.alternate;if(!n){if(n=L_(s),n===null)throw Error(ft(188));return n!==s?null:s}for(var i=s,l=n;;){var u=i.return;if(u===null)break;var p=u.alternate;if(p===null){if(l=u.return,l!==null){i=l;continue}break}if(u.child===p.child){for(p=u.child;p;){if(p===i)return WY(u),s;if(p===l)return WY(u),n;p=p.sibling}throw Error(ft(188))}if(i.return!==l.return)i=u,l=p;else{for(var g=!1,y=u.child;y;){if(y===i){g=!0,i=u,l=p;break}if(y===l){g=!0,l=u,i=p;break}y=y.sibling}if(!g){for(y=p.child;y;){if(y===i){g=!0,i=p,l=u;break}if(y===l){g=!0,l=p,i=u;break}y=y.sibling}if(!g)throw Error(ft(189))}}if(i.alternate!==l)throw Error(ft(190))}if(i.tag!==3)throw Error(ft(188));return i.stateNode.current===i?s:n}function DQ(s){return s=ame(s),s!==null?PQ(s):null}function PQ(s){if(s.tag===5||s.tag===6)return s;for(s=s.child;s!==null;){var n=PQ(s);if(n!==null)return n;s=s.sibling}return null}var LQ=Jc.unstable_scheduleCallback,HY=Jc.unstable_cancelCallback,ome=Jc.unstable_shouldYield,cme=Jc.unstable_requestPaint,ki=Jc.unstable_now,lme=Jc.unstable_getCurrentPriorityLevel,LV=Jc.unstable_ImmediatePriority,jQ=Jc.unstable_UserBlockingPriority,b1=Jc.unstable_NormalPriority,dme=Jc.unstable_LowPriority,MQ=Jc.unstable_IdlePriority,Ek=null,Wu=null;function ume(s){if(Wu&&typeof Wu.onCommitFiberRoot=="function")try{Wu.onCommitFiberRoot(Ek,s,void 0,(s.current.flags&128)===128)}catch{}}var zd=Math.clz32?Math.clz32:fme,hme=Math.log,pme=Math.LN2;function fme(s){return s>>>=0,s===0?32:31-(hme(s)/pme|0)|0}var TA=64,RA=4194304;function Gw(s){switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return s&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return s}}function x1(s,n){var i=s.pendingLanes;if(i===0)return 0;var l=0,u=s.suspendedLanes,p=s.pingedLanes,g=i&268435455;if(g!==0){var y=g&~u;y!==0?l=Gw(y):(p&=g,p!==0&&(l=Gw(p)))}else g=i&~u,g!==0?l=Gw(g):p!==0&&(l=Gw(p));if(l===0)return 0;if(n!==0&&n!==l&&!(n&u)&&(u=l&-l,p=n&-n,u>=p||u===16&&(p&4194240)!==0))return n;if(l&4&&(l|=i&16),n=s.entangledLanes,n!==0)for(s=s.entanglements,n&=l;0<n;)i=31-zd(n),u=1<<i,l|=s[i],n&=~u;return l}function mme(s,n){switch(s){case 1:case 2:case 4:return n+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function gme(s,n){for(var i=s.suspendedLanes,l=s.pingedLanes,u=s.expirationTimes,p=s.pendingLanes;0<p;){var g=31-zd(p),y=1<<g,x=u[g];x===-1?(!(y&i)||y&l)&&(u[g]=mme(y,n)):x<=n&&(s.expiredLanes|=y),p&=~y}}function n5(s){return s=s.pendingLanes&-1073741825,s!==0?s:s&1073741824?1073741824:0}function UQ(){var s=TA;return TA<<=1,!(TA&4194240)&&(TA=64),s}function HU(s){for(var n=[],i=0;31>i;i++)n.push(s);return n}function nT(s,n,i){s.pendingLanes|=n,n!==536870912&&(s.suspendedLanes=0,s.pingedLanes=0),s=s.eventTimes,n=31-zd(n),s[n]=i}function _me(s,n){var i=s.pendingLanes&~n;s.pendingLanes=n,s.suspendedLanes=0,s.pingedLanes=0,s.expiredLanes&=n,s.mutableReadLanes&=n,s.entangledLanes&=n,n=s.entanglements;var l=s.eventTimes;for(s=s.expirationTimes;0<i;){var u=31-zd(i),p=1<<u;n[u]=0,l[u]=-1,s[u]=-1,i&=~p}}function jV(s,n){var i=s.entangledLanes|=n;for(s=s.entanglements;i;){var l=31-zd(i),u=1<<l;u&n|s[l]&n&&(s[l]|=n),i&=~u}}var fs=0;function VQ(s){return s&=-s,1<s?4<s?s&268435455?16:536870912:4:1}var FQ,MV,BQ,zQ,GQ,r5=!1,CA=[],Hf=null,Kf=null,qf=null,bS=new Map,xS=new Map,Df=[],vme="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function KY(s,n){switch(s){case"focusin":case"focusout":Hf=null;break;case"dragenter":case"dragleave":Kf=null;break;case"mouseover":case"mouseout":qf=null;break;case"pointerover":case"pointerout":bS.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":xS.delete(n.pointerId)}}function kw(s,n,i,l,u,p){return s===null||s.nativeEvent!==p?(s={blockedOn:n,domEventName:i,eventSystemFlags:l,nativeEvent:p,targetContainers:[u]},n!==null&&(n=sT(n),n!==null&&MV(n)),s):(s.eventSystemFlags|=l,n=s.targetContainers,u!==null&&n.indexOf(u)===-1&&n.push(u),s)}function Eme(s,n,i,l,u){switch(n){case"focusin":return Hf=kw(Hf,s,n,i,l,u),!0;case"dragenter":return Kf=kw(Kf,s,n,i,l,u),!0;case"mouseover":return qf=kw(qf,s,n,i,l,u),!0;case"pointerover":var p=u.pointerId;return bS.set(p,kw(bS.get(p)||null,s,n,i,l,u)),!0;case"gotpointercapture":return p=u.pointerId,xS.set(p,kw(xS.get(p)||null,s,n,i,l,u)),!0}return!1}function WQ(s){var n=d_(s.target);if(n!==null){var i=L_(n);if(i!==null){if(n=i.tag,n===13){if(n=OQ(i),n!==null){s.blockedOn=n,GQ(s.priority,function(){BQ(i)});return}}else if(n===3&&i.stateNode.current.memoizedState.isDehydrated){s.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}s.blockedOn=null}function QA(s){if(s.blockedOn!==null)return!1;for(var n=s.targetContainers;0<n.length;){var i=s5(s.domEventName,s.eventSystemFlags,n[0],s.nativeEvent);if(i===null){i=s.nativeEvent;var l=new i.constructor(i.type,i);Q4=l,i.target.dispatchEvent(l),Q4=null}else return n=sT(i),n!==null&&MV(n),s.blockedOn=i,!1;n.shift()}return!0}function qY(s,n,i){QA(s)&&i.delete(n)}function yme(){r5=!1,Hf!==null&&QA(Hf)&&(Hf=null),Kf!==null&&QA(Kf)&&(Kf=null),qf!==null&&QA(qf)&&(qf=null),bS.forEach(qY),xS.forEach(qY)}function Ow(s,n){s.blockedOn===n&&(s.blockedOn=null,r5||(r5=!0,Jc.unstable_scheduleCallback(Jc.unstable_NormalPriority,yme)))}function wS(s){function n(u){return Ow(u,s)}if(0<CA.length){Ow(CA[0],s);for(var i=1;i<CA.length;i++){var l=CA[i];l.blockedOn===s&&(l.blockedOn=null)}}for(Hf!==null&&Ow(Hf,s),Kf!==null&&Ow(Kf,s),qf!==null&&Ow(qf,s),bS.forEach(n),xS.forEach(n),i=0;i<Df.length;i++)l=Df[i],l.blockedOn===s&&(l.blockedOn=null);for(;0<Df.length&&(i=Df[0],i.blockedOn===null);)WQ(i),i.blockedOn===null&&Df.shift()}var WE=up.ReactCurrentBatchConfig,w1=!0;function bme(s,n,i,l){var u=fs,p=WE.transition;WE.transition=null;try{fs=1,UV(s,n,i,l)}finally{fs=u,WE.transition=p}}function xme(s,n,i,l){var u=fs,p=WE.transition;WE.transition=null;try{fs=4,UV(s,n,i,l)}finally{fs=u,WE.transition=p}}function UV(s,n,i,l){if(w1){var u=s5(s,n,i,l);if(u===null)t4(s,n,l,S1,i),KY(s,l);else if(Eme(u,s,n,i,l))l.stopPropagation();else if(KY(s,l),n&4&&-1<vme.indexOf(s)){for(;u!==null;){var p=sT(u);if(p!==null&&FQ(p),p=s5(s,n,i,l),p===null&&t4(s,n,l,S1,i),p===u)break;u=p}u!==null&&l.stopPropagation()}else t4(s,n,l,null,i)}}var S1=null;function s5(s,n,i,l){if(S1=null,s=PV(l),s=d_(s),s!==null)if(n=L_(s),n===null)s=null;else if(i=n.tag,i===13){if(s=OQ(n),s!==null)return s;s=null}else if(i===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;s=null}else n!==s&&(s=null);return S1=s,null}function HQ(s){switch(s){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(lme()){case LV:return 1;case jQ:return 4;case b1:case dme:return 16;case MQ:return 536870912;default:return 16}default:return 16}}var Vf=null,VV=null,ZA=null;function KQ(){if(ZA)return ZA;var s,n=VV,i=n.length,l,u="value"in Vf?Vf.value:Vf.textContent,p=u.length;for(s=0;s<i&&n[s]===u[s];s++);var g=i-s;for(l=1;l<=g&&n[i-l]===u[p-l];l++);return ZA=u.slice(s,1<l?1-l:void 0)}function e1(s){var n=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&n===13&&(s=13)):s=n,s===10&&(s=13),32<=s||s===13?s:0}function NA(){return!0}function YY(){return!1}function el(s){function n(i,l,u,p,g){this._reactName=i,this._targetInst=u,this.type=l,this.nativeEvent=p,this.target=g,this.currentTarget=null;for(var y in s)s.hasOwnProperty(y)&&(i=s[y],this[y]=i?i(p):p[y]);return this.isDefaultPrevented=(p.defaultPrevented!=null?p.defaultPrevented:p.returnValue===!1)?NA:YY,this.isPropagationStopped=YY,this}return di(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=NA)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=NA)},persist:function(){},isPersistent:NA}),n}var Ry={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},FV=el(Ry),rT=di({},Ry,{view:0,detail:0}),wme=el(rT),KU,qU,Dw,yk=di({},rT,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:BV,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Dw&&(Dw&&s.type==="mousemove"?(KU=s.screenX-Dw.screenX,qU=s.screenY-Dw.screenY):qU=KU=0,Dw=s),KU)},movementY:function(s){return"movementY"in s?s.movementY:qU}}),XY=el(yk),Sme=di({},yk,{dataTransfer:0}),Tme=el(Sme),Rme=di({},rT,{relatedTarget:0}),YU=el(Rme),Cme=di({},Ry,{animationName:0,elapsedTime:0,pseudoElement:0}),Nme=el(Cme),Ime=di({},Ry,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Ame=el(Ime),kme=di({},Ry,{data:0}),$Y=el(kme),Ome={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Dme={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Pme={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Lme(s){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(s):(s=Pme[s])?!!n[s]:!1}function BV(){return Lme}var jme=di({},rT,{key:function(s){if(s.key){var n=Ome[s.key]||s.key;if(n!=="Unidentified")return n}return s.type==="keypress"?(s=e1(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?Dme[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:BV,charCode:function(s){return s.type==="keypress"?e1(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?e1(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),Mme=el(jme),Ume=di({},yk,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),JY=el(Ume),Vme=di({},rT,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:BV}),Fme=el(Vme),Bme=di({},Ry,{propertyName:0,elapsedTime:0,pseudoElement:0}),zme=el(Bme),Gme=di({},yk,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),Wme=el(Gme),Hme=[9,13,27,32],zV=rp&&"CompositionEvent"in window,eS=null;rp&&"documentMode"in document&&(eS=document.documentMode);var Kme=rp&&"TextEvent"in window&&!eS,qQ=rp&&(!zV||eS&&8<eS&&11>=eS),QY=" ",ZY=!1;function YQ(s,n){switch(s){case"keyup":return Hme.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function XQ(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var IE=!1;function qme(s,n){switch(s){case"compositionend":return XQ(n);case"keypress":return n.which!==32?null:(ZY=!0,QY);case"textInput":return s=n.data,s===QY&&ZY?null:s;default:return null}}function Yme(s,n){if(IE)return s==="compositionend"||!zV&&YQ(s,n)?(s=KQ(),ZA=VV=Vf=null,IE=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return qQ&&n.locale!=="ko"?null:n.data;default:return null}}var Xme={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function eX(s){var n=s&&s.nodeName&&s.nodeName.toLowerCase();return n==="input"?!!Xme[s.type]:n==="textarea"}function $Q(s,n,i,l){CQ(l),n=T1(n,"onChange"),0<n.length&&(i=new FV("onChange","change",null,i,l),s.push({event:i,listeners:n}))}var tS=null,SS=null;function $me(s){oZ(s,0)}function bk(s){var n=OE(s);if(yQ(n))return s}function Jme(s,n){if(s==="change")return n}var JQ=!1;if(rp){var XU;if(rp){var $U="oninput"in document;if(!$U){var tX=document.createElement("div");tX.setAttribute("oninput","return;"),$U=typeof tX.oninput=="function"}XU=$U}else XU=!1;JQ=XU&&(!document.documentMode||9<document.documentMode)}function nX(){tS&&(tS.detachEvent("onpropertychange",QQ),SS=tS=null)}function QQ(s){if(s.propertyName==="value"&&bk(SS)){var n=[];$Q(n,SS,s,PV(s)),kQ($me,n)}}function Qme(s,n,i){s==="focusin"?(nX(),tS=n,SS=i,tS.attachEvent("onpropertychange",QQ)):s==="focusout"&&nX()}function Zme(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return bk(SS)}function ege(s,n){if(s==="click")return bk(n)}function tge(s,n){if(s==="input"||s==="change")return bk(n)}function nge(s,n){return s===n&&(s!==0||1/s===1/n)||s!==s&&n!==n}var Hd=typeof Object.is=="function"?Object.is:nge;function TS(s,n){if(Hd(s,n))return!0;if(typeof s!="object"||s===null||typeof n!="object"||n===null)return!1;var i=Object.keys(s),l=Object.keys(n);if(i.length!==l.length)return!1;for(l=0;l<i.length;l++){var u=i[l];if(!F4.call(n,u)||!Hd(s[u],n[u]))return!1}return!0}function rX(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function sX(s,n){var i=rX(s);s=0;for(var l;i;){if(i.nodeType===3){if(l=s+i.textContent.length,s<=n&&l>=n)return{node:i,offset:n-s};s=l}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=rX(i)}}function ZQ(s,n){return s&&n?s===n?!0:s&&s.nodeType===3?!1:n&&n.nodeType===3?ZQ(s,n.parentNode):"contains"in s?s.contains(n):s.compareDocumentPosition?!!(s.compareDocumentPosition(n)&16):!1:!1}function eZ(){for(var s=window,n=v1();n instanceof s.HTMLIFrameElement;){try{var i=typeof n.contentWindow.location.href=="string"}catch{i=!1}if(i)s=n.contentWindow;else break;n=v1(s.document)}return n}function GV(s){var n=s&&s.nodeName&&s.nodeName.toLowerCase();return n&&(n==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||n==="textarea"||s.contentEditable==="true")}function rge(s){var n=eZ(),i=s.focusedElem,l=s.selectionRange;if(n!==i&&i&&i.ownerDocument&&ZQ(i.ownerDocument.documentElement,i)){if(l!==null&&GV(i)){if(n=l.start,s=l.end,s===void 0&&(s=n),"selectionStart"in i)i.selectionStart=n,i.selectionEnd=Math.min(s,i.value.length);else if(s=(n=i.ownerDocument||document)&&n.defaultView||window,s.getSelection){s=s.getSelection();var u=i.textContent.length,p=Math.min(l.start,u);l=l.end===void 0?p:Math.min(l.end,u),!s.extend&&p>l&&(u=l,l=p,p=u),u=sX(i,p);var g=sX(i,l);u&&g&&(s.rangeCount!==1||s.anchorNode!==u.node||s.anchorOffset!==u.offset||s.focusNode!==g.node||s.focusOffset!==g.offset)&&(n=n.createRange(),n.setStart(u.node,u.offset),s.removeAllRanges(),p>l?(s.addRange(n),s.extend(g.node,g.offset)):(n.setEnd(g.node,g.offset),s.addRange(n)))}}for(n=[],s=i;s=s.parentNode;)s.nodeType===1&&n.push({element:s,left:s.scrollLeft,top:s.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<n.length;i++)s=n[i],s.element.scrollLeft=s.left,s.element.scrollTop=s.top}}var sge=rp&&"documentMode"in document&&11>=document.documentMode,AE=null,i5=null,nS=null,a5=!1;function iX(s,n,i){var l=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;a5||AE==null||AE!==v1(l)||(l=AE,"selectionStart"in l&&GV(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),nS&&TS(nS,l)||(nS=l,l=T1(i5,"onSelect"),0<l.length&&(n=new FV("onSelect","select",null,n,i),s.push({event:n,listeners:l}),n.target=AE)))}function IA(s,n){var i={};return i[s.toLowerCase()]=n.toLowerCase(),i["Webkit"+s]="webkit"+n,i["Moz"+s]="moz"+n,i}var kE={animationend:IA("Animation","AnimationEnd"),animationiteration:IA("Animation","AnimationIteration"),animationstart:IA("Animation","AnimationStart"),transitionend:IA("Transition","TransitionEnd")},JU={},tZ={};rp&&(tZ=document.createElement("div").style,"AnimationEvent"in window||(delete kE.animationend.animation,delete kE.animationiteration.animation,delete kE.animationstart.animation),"TransitionEvent"in window||delete kE.transitionend.transition);function xk(s){if(JU[s])return JU[s];if(!kE[s])return s;var n=kE[s],i;for(i in n)if(n.hasOwnProperty(i)&&i in tZ)return JU[s]=n[i];return s}var nZ=xk("animationend"),rZ=xk("animationiteration"),sZ=xk("animationstart"),iZ=xk("transitionend"),aZ=new Map,aX="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function pm(s,n){aZ.set(s,n),P_(n,[s])}for(var QU=0;QU<aX.length;QU++){var ZU=aX[QU],ige=ZU.toLowerCase(),age=ZU[0].toUpperCase()+ZU.slice(1);pm(ige,"on"+age)}pm(nZ,"onAnimationEnd");pm(rZ,"onAnimationIteration");pm(sZ,"onAnimationStart");pm("dblclick","onDoubleClick");pm("focusin","onFocus");pm("focusout","onBlur");pm(iZ,"onTransitionEnd");ZE("onMouseEnter",["mouseout","mouseover"]);ZE("onMouseLeave",["mouseout","mouseover"]);ZE("onPointerEnter",["pointerout","pointerover"]);ZE("onPointerLeave",["pointerout","pointerover"]);P_("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));P_("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));P_("onBeforeInput",["compositionend","keypress","textInput","paste"]);P_("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));P_("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));P_("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ww="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),oge=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ww));function oX(s,n,i){var l=s.type||"unknown-event";s.currentTarget=i,ime(l,n,void 0,s),s.currentTarget=null}function oZ(s,n){n=(n&4)!==0;for(var i=0;i<s.length;i++){var l=s[i],u=l.event;l=l.listeners;e:{var p=void 0;if(n)for(var g=l.length-1;0<=g;g--){var y=l[g],x=y.instance,C=y.currentTarget;if(y=y.listener,x!==p&&u.isPropagationStopped())break e;oX(u,y,C),p=x}else for(g=0;g<l.length;g++){if(y=l[g],x=y.instance,C=y.currentTarget,y=y.listener,x!==p&&u.isPropagationStopped())break e;oX(u,y,C),p=x}}}if(y1)throw s=t5,y1=!1,t5=null,s}function Us(s,n){var i=n[u5];i===void 0&&(i=n[u5]=new Set);var l=s+"__bubble";i.has(l)||(cZ(n,s,2,!1),i.add(l))}function e4(s,n,i){var l=0;n&&(l|=4),cZ(i,s,l,n)}var AA="_reactListening"+Math.random().toString(36).slice(2);function RS(s){if(!s[AA]){s[AA]=!0,mQ.forEach(function(i){i!=="selectionchange"&&(oge.has(i)||e4(i,!1,s),e4(i,!0,s))});var n=s.nodeType===9?s:s.ownerDocument;n===null||n[AA]||(n[AA]=!0,e4("selectionchange",!1,n))}}function cZ(s,n,i,l){switch(HQ(n)){case 1:var u=bme;break;case 4:u=xme;break;default:u=UV}i=u.bind(null,n,i,s),u=void 0,!e5||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(u=!0),l?u!==void 0?s.addEventListener(n,i,{capture:!0,passive:u}):s.addEventListener(n,i,!0):u!==void 0?s.addEventListener(n,i,{passive:u}):s.addEventListener(n,i,!1)}function t4(s,n,i,l,u){var p=l;if(!(n&1)&&!(n&2)&&l!==null)e:for(;;){if(l===null)return;var g=l.tag;if(g===3||g===4){var y=l.stateNode.containerInfo;if(y===u||y.nodeType===8&&y.parentNode===u)break;if(g===4)for(g=l.return;g!==null;){var x=g.tag;if((x===3||x===4)&&(x=g.stateNode.containerInfo,x===u||x.nodeType===8&&x.parentNode===u))return;g=g.return}for(;y!==null;){if(g=d_(y),g===null)return;if(x=g.tag,x===5||x===6){l=p=g;continue e}y=y.parentNode}}l=l.return}kQ(function(){var C=p,k=PV(i),A=[];e:{var M=aZ.get(s);if(M!==void 0){var G=FV,B=s;switch(s){case"keypress":if(e1(i)===0)break e;case"keydown":case"keyup":G=Mme;break;case"focusin":B="focus",G=YU;break;case"focusout":B="blur",G=YU;break;case"beforeblur":case"afterblur":G=YU;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":G=XY;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":G=Tme;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":G=Fme;break;case nZ:case rZ:case sZ:G=Nme;break;case iZ:G=zme;break;case"scroll":G=wme;break;case"wheel":G=Wme;break;case"copy":case"cut":case"paste":G=Ame;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":G=JY}var X=(n&4)!==0,Z=!X&&s==="scroll",q=X?M!==null?M+"Capture":null:M;X=[];for(var V=C,ee;V!==null;){ee=V;var de=ee.stateNode;if(ee.tag===5&&de!==null&&(ee=de,q!==null&&(de=yS(V,q),de!=null&&X.push(CS(V,de,ee)))),Z)break;V=V.return}0<X.length&&(M=new G(M,B,null,i,k),A.push({event:M,listeners:X}))}}if(!(n&7)){e:{if(M=s==="mouseover"||s==="pointerover",G=s==="mouseout"||s==="pointerout",M&&i!==Q4&&(B=i.relatedTarget||i.fromElement)&&(d_(B)||B[sp]))break e;if((G||M)&&(M=k.window===k?k:(M=k.ownerDocument)?M.defaultView||M.parentWindow:window,G?(B=i.relatedTarget||i.toElement,G=C,B=B?d_(B):null,B!==null&&(Z=L_(B),B!==Z||B.tag!==5&&B.tag!==6)&&(B=null)):(G=null,B=C),G!==B)){if(X=XY,de="onMouseLeave",q="onMouseEnter",V="mouse",(s==="pointerout"||s==="pointerover")&&(X=JY,de="onPointerLeave",q="onPointerEnter",V="pointer"),Z=G==null?M:OE(G),ee=B==null?M:OE(B),M=new X(de,V+"leave",G,i,k),M.target=Z,M.relatedTarget=ee,de=null,d_(k)===C&&(X=new X(q,V+"enter",B,i,k),X.target=ee,X.relatedTarget=Z,de=X),Z=de,G&&B)t:{for(X=G,q=B,V=0,ee=X;ee;ee=_E(ee))V++;for(ee=0,de=q;de;de=_E(de))ee++;for(;0<V-ee;)X=_E(X),V--;for(;0<ee-V;)q=_E(q),ee--;for(;V--;){if(X===q||q!==null&&X===q.alternate)break t;X=_E(X),q=_E(q)}X=null}else X=null;G!==null&&cX(A,M,G,X,!1),B!==null&&Z!==null&&cX(A,Z,B,X,!0)}}e:{if(M=C?OE(C):window,G=M.nodeName&&M.nodeName.toLowerCase(),G==="select"||G==="input"&&M.type==="file")var ae=Jme;else if(eX(M))if(JQ)ae=tge;else{ae=Zme;var ye=Qme}else(G=M.nodeName)&&G.toLowerCase()==="input"&&(M.type==="checkbox"||M.type==="radio")&&(ae=ege);if(ae&&(ae=ae(s,C))){$Q(A,ae,i,k);break e}ye&&ye(s,M,C),s==="focusout"&&(ye=M._wrapperState)&&ye.controlled&&M.type==="number"&&q4(M,"number",M.value)}switch(ye=C?OE(C):window,s){case"focusin":(eX(ye)||ye.contentEditable==="true")&&(AE=ye,i5=C,nS=null);break;case"focusout":nS=i5=AE=null;break;case"mousedown":a5=!0;break;case"contextmenu":case"mouseup":case"dragend":a5=!1,iX(A,i,k);break;case"selectionchange":if(sge)break;case"keydown":case"keyup":iX(A,i,k)}var Q;if(zV)e:{switch(s){case"compositionstart":var $="onCompositionStart";break e;case"compositionend":$="onCompositionEnd";break e;case"compositionupdate":$="onCompositionUpdate";break e}$=void 0}else IE?YQ(s,i)&&($="onCompositionEnd"):s==="keydown"&&i.keyCode===229&&($="onCompositionStart");$&&(qQ&&i.locale!=="ko"&&(IE||$!=="onCompositionStart"?$==="onCompositionEnd"&&IE&&(Q=KQ()):(Vf=k,VV="value"in Vf?Vf.value:Vf.textContent,IE=!0)),ye=T1(C,$),0<ye.length&&($=new $Y($,s,null,i,k),A.push({event:$,listeners:ye}),Q?$.data=Q:(Q=XQ(i),Q!==null&&($.data=Q)))),(Q=Kme?qme(s,i):Yme(s,i))&&(C=T1(C,"onBeforeInput"),0<C.length&&(k=new $Y("onBeforeInput","beforeinput",null,i,k),A.push({event:k,listeners:C}),k.data=Q))}oZ(A,n)})}function CS(s,n,i){return{instance:s,listener:n,currentTarget:i}}function T1(s,n){for(var i=n+"Capture",l=[];s!==null;){var u=s,p=u.stateNode;u.tag===5&&p!==null&&(u=p,p=yS(s,i),p!=null&&l.unshift(CS(s,p,u)),p=yS(s,n),p!=null&&l.push(CS(s,p,u))),s=s.return}return l}function _E(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5);return s||null}function cX(s,n,i,l,u){for(var p=n._reactName,g=[];i!==null&&i!==l;){var y=i,x=y.alternate,C=y.stateNode;if(x!==null&&x===l)break;y.tag===5&&C!==null&&(y=C,u?(x=yS(i,p),x!=null&&g.unshift(CS(i,x,y))):u||(x=yS(i,p),x!=null&&g.push(CS(i,x,y)))),i=i.return}g.length!==0&&s.push({event:n,listeners:g})}var cge=/\r\n?/g,lge=/\u0000|\uFFFD/g;function lX(s){return(typeof s=="string"?s:""+s).replace(cge,`
`).replace(lge,"")}function kA(s,n,i){if(n=lX(n),lX(s)!==n&&i)throw Error(ft(425))}function R1(){}var o5=null,c5=null;function l5(s,n){return s==="textarea"||s==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var d5=typeof setTimeout=="function"?setTimeout:void 0,dge=typeof clearTimeout=="function"?clearTimeout:void 0,dX=typeof Promise=="function"?Promise:void 0,uge=typeof queueMicrotask=="function"?queueMicrotask:typeof dX<"u"?function(s){return dX.resolve(null).then(s).catch(hge)}:d5;function hge(s){setTimeout(function(){throw s})}function n4(s,n){var i=n,l=0;do{var u=i.nextSibling;if(s.removeChild(i),u&&u.nodeType===8)if(i=u.data,i==="/$"){if(l===0){s.removeChild(u),wS(n);return}l--}else i!=="$"&&i!=="$?"&&i!=="$!"||l++;i=u}while(i);wS(n)}function Yf(s){for(;s!=null;s=s.nextSibling){var n=s.nodeType;if(n===1||n===3)break;if(n===8){if(n=s.data,n==="$"||n==="$!"||n==="$?")break;if(n==="/$")return null}}return s}function uX(s){s=s.previousSibling;for(var n=0;s;){if(s.nodeType===8){var i=s.data;if(i==="$"||i==="$!"||i==="$?"){if(n===0)return s;n--}else i==="/$"&&n++}s=s.previousSibling}return null}var Cy=Math.random().toString(36).slice(2),Fu="__reactFiber$"+Cy,NS="__reactProps$"+Cy,sp="__reactContainer$"+Cy,u5="__reactEvents$"+Cy,pge="__reactListeners$"+Cy,fge="__reactHandles$"+Cy;function d_(s){var n=s[Fu];if(n)return n;for(var i=s.parentNode;i;){if(n=i[sp]||i[Fu]){if(i=n.alternate,n.child!==null||i!==null&&i.child!==null)for(s=uX(s);s!==null;){if(i=s[Fu])return i;s=uX(s)}return n}s=i,i=s.parentNode}return null}function sT(s){return s=s[Fu]||s[sp],!s||s.tag!==5&&s.tag!==6&&s.tag!==13&&s.tag!==3?null:s}function OE(s){if(s.tag===5||s.tag===6)return s.stateNode;throw Error(ft(33))}function wk(s){return s[NS]||null}var h5=[],DE=-1;function fm(s){return{current:s}}function Vs(s){0>DE||(s.current=h5[DE],h5[DE]=null,DE--)}function ks(s,n){DE++,h5[DE]=s.current,s.current=n}var cm={},vo=fm(cm),fc=fm(!1),y_=cm;function ey(s,n){var i=s.type.contextTypes;if(!i)return cm;var l=s.stateNode;if(l&&l.__reactInternalMemoizedUnmaskedChildContext===n)return l.__reactInternalMemoizedMaskedChildContext;var u={},p;for(p in i)u[p]=n[p];return l&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=n,s.__reactInternalMemoizedMaskedChildContext=u),u}function mc(s){return s=s.childContextTypes,s!=null}function C1(){Vs(fc),Vs(vo)}function hX(s,n,i){if(vo.current!==cm)throw Error(ft(168));ks(vo,n),ks(fc,i)}function lZ(s,n,i){var l=s.stateNode;if(n=n.childContextTypes,typeof l.getChildContext!="function")return i;l=l.getChildContext();for(var u in l)if(!(u in n))throw Error(ft(108,Qfe(s)||"Unknown",u));return di({},i,l)}function N1(s){return s=(s=s.stateNode)&&s.__reactInternalMemoizedMergedChildContext||cm,y_=vo.current,ks(vo,s),ks(fc,fc.current),!0}function pX(s,n,i){var l=s.stateNode;if(!l)throw Error(ft(169));i?(s=lZ(s,n,y_),l.__reactInternalMemoizedMergedChildContext=s,Vs(fc),Vs(vo),ks(vo,s)):Vs(fc),ks(fc,i)}var Bh=null,Sk=!1,r4=!1;function dZ(s){Bh===null?Bh=[s]:Bh.push(s)}function mge(s){Sk=!0,dZ(s)}function mm(){if(!r4&&Bh!==null){r4=!0;var s=0,n=fs;try{var i=Bh;for(fs=1;s<i.length;s++){var l=i[s];do l=l(!0);while(l!==null)}Bh=null,Sk=!1}catch(u){throw Bh!==null&&(Bh=Bh.slice(s+1)),LQ(LV,mm),u}finally{fs=n,r4=!1}}return null}var PE=[],LE=0,I1=null,A1=0,Fl=[],Bl=0,b_=null,Hh=1,Kh="";function a_(s,n){PE[LE++]=A1,PE[LE++]=I1,I1=s,A1=n}function uZ(s,n,i){Fl[Bl++]=Hh,Fl[Bl++]=Kh,Fl[Bl++]=b_,b_=s;var l=Hh;s=Kh;var u=32-zd(l)-1;l&=~(1<<u),i+=1;var p=32-zd(n)+u;if(30<p){var g=u-u%5;p=(l&(1<<g)-1).toString(32),l>>=g,u-=g,Hh=1<<32-zd(n)+u|i<<u|l,Kh=p+s}else Hh=1<<p|i<<u|l,Kh=s}function WV(s){s.return!==null&&(a_(s,1),uZ(s,1,0))}function HV(s){for(;s===I1;)I1=PE[--LE],PE[LE]=null,A1=PE[--LE],PE[LE]=null;for(;s===b_;)b_=Fl[--Bl],Fl[Bl]=null,Kh=Fl[--Bl],Fl[Bl]=null,Hh=Fl[--Bl],Fl[Bl]=null}var qc=null,Gc=null,Zs=!1,Fd=null;function hZ(s,n){var i=zl(5,null,null,0);i.elementType="DELETED",i.stateNode=n,i.return=s,n=s.deletions,n===null?(s.deletions=[i],s.flags|=16):n.push(i)}function fX(s,n){switch(s.tag){case 5:var i=s.type;return n=n.nodeType!==1||i.toLowerCase()!==n.nodeName.toLowerCase()?null:n,n!==null?(s.stateNode=n,qc=s,Gc=Yf(n.firstChild),!0):!1;case 6:return n=s.pendingProps===""||n.nodeType!==3?null:n,n!==null?(s.stateNode=n,qc=s,Gc=null,!0):!1;case 13:return n=n.nodeType!==8?null:n,n!==null?(i=b_!==null?{id:Hh,overflow:Kh}:null,s.memoizedState={dehydrated:n,treeContext:i,retryLane:1073741824},i=zl(18,null,null,0),i.stateNode=n,i.return=s,s.child=i,qc=s,Gc=null,!0):!1;default:return!1}}function p5(s){return(s.mode&1)!==0&&(s.flags&128)===0}function f5(s){if(Zs){var n=Gc;if(n){var i=n;if(!fX(s,n)){if(p5(s))throw Error(ft(418));n=Yf(i.nextSibling);var l=qc;n&&fX(s,n)?hZ(l,i):(s.flags=s.flags&-4097|2,Zs=!1,qc=s)}}else{if(p5(s))throw Error(ft(418));s.flags=s.flags&-4097|2,Zs=!1,qc=s}}}function mX(s){for(s=s.return;s!==null&&s.tag!==5&&s.tag!==3&&s.tag!==13;)s=s.return;qc=s}function OA(s){if(s!==qc)return!1;if(!Zs)return mX(s),Zs=!0,!1;var n;if((n=s.tag!==3)&&!(n=s.tag!==5)&&(n=s.type,n=n!=="head"&&n!=="body"&&!l5(s.type,s.memoizedProps)),n&&(n=Gc)){if(p5(s))throw pZ(),Error(ft(418));for(;n;)hZ(s,n),n=Yf(n.nextSibling)}if(mX(s),s.tag===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(ft(317));e:{for(s=s.nextSibling,n=0;s;){if(s.nodeType===8){var i=s.data;if(i==="/$"){if(n===0){Gc=Yf(s.nextSibling);break e}n--}else i!=="$"&&i!=="$!"&&i!=="$?"||n++}s=s.nextSibling}Gc=null}}else Gc=qc?Yf(s.stateNode.nextSibling):null;return!0}function pZ(){for(var s=Gc;s;)s=Yf(s.nextSibling)}function ty(){Gc=qc=null,Zs=!1}function KV(s){Fd===null?Fd=[s]:Fd.push(s)}var gge=up.ReactCurrentBatchConfig;function Pw(s,n,i){if(s=i.ref,s!==null&&typeof s!="function"&&typeof s!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(ft(309));var l=i.stateNode}if(!l)throw Error(ft(147,s));var u=l,p=""+s;return n!==null&&n.ref!==null&&typeof n.ref=="function"&&n.ref._stringRef===p?n.ref:(n=function(g){var y=u.refs;g===null?delete y[p]:y[p]=g},n._stringRef=p,n)}if(typeof s!="string")throw Error(ft(284));if(!i._owner)throw Error(ft(290,s))}return s}function DA(s,n){throw s=Object.prototype.toString.call(n),Error(ft(31,s==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":s))}function gX(s){var n=s._init;return n(s._payload)}function fZ(s){function n(q,V){if(s){var ee=q.deletions;ee===null?(q.deletions=[V],q.flags|=16):ee.push(V)}}function i(q,V){if(!s)return null;for(;V!==null;)n(q,V),V=V.sibling;return null}function l(q,V){for(q=new Map;V!==null;)V.key!==null?q.set(V.key,V):q.set(V.index,V),V=V.sibling;return q}function u(q,V){return q=Qf(q,V),q.index=0,q.sibling=null,q}function p(q,V,ee){return q.index=ee,s?(ee=q.alternate,ee!==null?(ee=ee.index,ee<V?(q.flags|=2,V):ee):(q.flags|=2,V)):(q.flags|=1048576,V)}function g(q){return s&&q.alternate===null&&(q.flags|=2),q}function y(q,V,ee,de){return V===null||V.tag!==6?(V=d4(ee,q.mode,de),V.return=q,V):(V=u(V,ee),V.return=q,V)}function x(q,V,ee,de){var ae=ee.type;return ae===NE?k(q,V,ee.props.children,de,ee.key):V!==null&&(V.elementType===ae||typeof ae=="object"&&ae!==null&&ae.$$typeof===kf&&gX(ae)===V.type)?(de=u(V,ee.props),de.ref=Pw(q,V,ee),de.return=q,de):(de=o1(ee.type,ee.key,ee.props,null,q.mode,de),de.ref=Pw(q,V,ee),de.return=q,de)}function C(q,V,ee,de){return V===null||V.tag!==4||V.stateNode.containerInfo!==ee.containerInfo||V.stateNode.implementation!==ee.implementation?(V=u4(ee,q.mode,de),V.return=q,V):(V=u(V,ee.children||[]),V.return=q,V)}function k(q,V,ee,de,ae){return V===null||V.tag!==7?(V=g_(ee,q.mode,de,ae),V.return=q,V):(V=u(V,ee),V.return=q,V)}function A(q,V,ee){if(typeof V=="string"&&V!==""||typeof V=="number")return V=d4(""+V,q.mode,ee),V.return=q,V;if(typeof V=="object"&&V!==null){switch(V.$$typeof){case xA:return ee=o1(V.type,V.key,V.props,null,q.mode,ee),ee.ref=Pw(q,null,V),ee.return=q,ee;case CE:return V=u4(V,q.mode,ee),V.return=q,V;case kf:var de=V._init;return A(q,de(V._payload),ee)}if(zw(V)||Iw(V))return V=g_(V,q.mode,ee,null),V.return=q,V;DA(q,V)}return null}function M(q,V,ee,de){var ae=V!==null?V.key:null;if(typeof ee=="string"&&ee!==""||typeof ee=="number")return ae!==null?null:y(q,V,""+ee,de);if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case xA:return ee.key===ae?x(q,V,ee,de):null;case CE:return ee.key===ae?C(q,V,ee,de):null;case kf:return ae=ee._init,M(q,V,ae(ee._payload),de)}if(zw(ee)||Iw(ee))return ae!==null?null:k(q,V,ee,de,null);DA(q,ee)}return null}function G(q,V,ee,de,ae){if(typeof de=="string"&&de!==""||typeof de=="number")return q=q.get(ee)||null,y(V,q,""+de,ae);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case xA:return q=q.get(de.key===null?ee:de.key)||null,x(V,q,de,ae);case CE:return q=q.get(de.key===null?ee:de.key)||null,C(V,q,de,ae);case kf:var ye=de._init;return G(q,V,ee,ye(de._payload),ae)}if(zw(de)||Iw(de))return q=q.get(ee)||null,k(V,q,de,ae,null);DA(V,de)}return null}function B(q,V,ee,de){for(var ae=null,ye=null,Q=V,$=V=0,se=null;Q!==null&&$<ee.length;$++){Q.index>$?(se=Q,Q=null):se=Q.sibling;var ce=M(q,Q,ee[$],de);if(ce===null){Q===null&&(Q=se);break}s&&Q&&ce.alternate===null&&n(q,Q),V=p(ce,V,$),ye===null?ae=ce:ye.sibling=ce,ye=ce,Q=se}if($===ee.length)return i(q,Q),Zs&&a_(q,$),ae;if(Q===null){for(;$<ee.length;$++)Q=A(q,ee[$],de),Q!==null&&(V=p(Q,V,$),ye===null?ae=Q:ye.sibling=Q,ye=Q);return Zs&&a_(q,$),ae}for(Q=l(q,Q);$<ee.length;$++)se=G(Q,q,$,ee[$],de),se!==null&&(s&&se.alternate!==null&&Q.delete(se.key===null?$:se.key),V=p(se,V,$),ye===null?ae=se:ye.sibling=se,ye=se);return s&&Q.forEach(function(he){return n(q,he)}),Zs&&a_(q,$),ae}function X(q,V,ee,de){var ae=Iw(ee);if(typeof ae!="function")throw Error(ft(150));if(ee=ae.call(ee),ee==null)throw Error(ft(151));for(var ye=ae=null,Q=V,$=V=0,se=null,ce=ee.next();Q!==null&&!ce.done;$++,ce=ee.next()){Q.index>$?(se=Q,Q=null):se=Q.sibling;var he=M(q,Q,ce.value,de);if(he===null){Q===null&&(Q=se);break}s&&Q&&he.alternate===null&&n(q,Q),V=p(he,V,$),ye===null?ae=he:ye.sibling=he,ye=he,Q=se}if(ce.done)return i(q,Q),Zs&&a_(q,$),ae;if(Q===null){for(;!ce.done;$++,ce=ee.next())ce=A(q,ce.value,de),ce!==null&&(V=p(ce,V,$),ye===null?ae=ce:ye.sibling=ce,ye=ce);return Zs&&a_(q,$),ae}for(Q=l(q,Q);!ce.done;$++,ce=ee.next())ce=G(Q,q,$,ce.value,de),ce!==null&&(s&&ce.alternate!==null&&Q.delete(ce.key===null?$:ce.key),V=p(ce,V,$),ye===null?ae=ce:ye.sibling=ce,ye=ce);return s&&Q.forEach(function(ve){return n(q,ve)}),Zs&&a_(q,$),ae}function Z(q,V,ee,de){if(typeof ee=="object"&&ee!==null&&ee.type===NE&&ee.key===null&&(ee=ee.props.children),typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case xA:e:{for(var ae=ee.key,ye=V;ye!==null;){if(ye.key===ae){if(ae=ee.type,ae===NE){if(ye.tag===7){i(q,ye.sibling),V=u(ye,ee.props.children),V.return=q,q=V;break e}}else if(ye.elementType===ae||typeof ae=="object"&&ae!==null&&ae.$$typeof===kf&&gX(ae)===ye.type){i(q,ye.sibling),V=u(ye,ee.props),V.ref=Pw(q,ye,ee),V.return=q,q=V;break e}i(q,ye);break}else n(q,ye);ye=ye.sibling}ee.type===NE?(V=g_(ee.props.children,q.mode,de,ee.key),V.return=q,q=V):(de=o1(ee.type,ee.key,ee.props,null,q.mode,de),de.ref=Pw(q,V,ee),de.return=q,q=de)}return g(q);case CE:e:{for(ye=ee.key;V!==null;){if(V.key===ye)if(V.tag===4&&V.stateNode.containerInfo===ee.containerInfo&&V.stateNode.implementation===ee.implementation){i(q,V.sibling),V=u(V,ee.children||[]),V.return=q,q=V;break e}else{i(q,V);break}else n(q,V);V=V.sibling}V=u4(ee,q.mode,de),V.return=q,q=V}return g(q);case kf:return ye=ee._init,Z(q,V,ye(ee._payload),de)}if(zw(ee))return B(q,V,ee,de);if(Iw(ee))return X(q,V,ee,de);DA(q,ee)}return typeof ee=="string"&&ee!==""||typeof ee=="number"?(ee=""+ee,V!==null&&V.tag===6?(i(q,V.sibling),V=u(V,ee),V.return=q,q=V):(i(q,V),V=d4(ee,q.mode,de),V.return=q,q=V),g(q)):i(q,V)}return Z}var ny=fZ(!0),mZ=fZ(!1),k1=fm(null),O1=null,jE=null,qV=null;function YV(){qV=jE=O1=null}function XV(s){var n=k1.current;Vs(k1),s._currentValue=n}function m5(s,n,i){for(;s!==null;){var l=s.alternate;if((s.childLanes&n)!==n?(s.childLanes|=n,l!==null&&(l.childLanes|=n)):l!==null&&(l.childLanes&n)!==n&&(l.childLanes|=n),s===i)break;s=s.return}}function HE(s,n){O1=s,qV=jE=null,s=s.dependencies,s!==null&&s.firstContext!==null&&(s.lanes&n&&(pc=!0),s.firstContext=null)}function Hl(s){var n=s._currentValue;if(qV!==s)if(s={context:s,memoizedValue:n,next:null},jE===null){if(O1===null)throw Error(ft(308));jE=s,O1.dependencies={lanes:0,firstContext:s}}else jE=jE.next=s;return n}var u_=null;function $V(s){u_===null?u_=[s]:u_.push(s)}function gZ(s,n,i,l){var u=n.interleaved;return u===null?(i.next=i,$V(n)):(i.next=u.next,u.next=i),n.interleaved=i,ip(s,l)}function ip(s,n){s.lanes|=n;var i=s.alternate;for(i!==null&&(i.lanes|=n),i=s,s=s.return;s!==null;)s.childLanes|=n,i=s.alternate,i!==null&&(i.childLanes|=n),i=s,s=s.return;return i.tag===3?i.stateNode:null}var Of=!1;function JV(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function _Z(s,n){s=s.updateQueue,n.updateQueue===s&&(n.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,effects:s.effects})}function Qh(s,n){return{eventTime:s,lane:n,tag:0,payload:null,callback:null,next:null}}function Xf(s,n,i){var l=s.updateQueue;if(l===null)return null;if(l=l.shared,Vr&2){var u=l.pending;return u===null?n.next=n:(n.next=u.next,u.next=n),l.pending=n,ip(s,i)}return u=l.interleaved,u===null?(n.next=n,$V(l)):(n.next=u.next,u.next=n),l.interleaved=n,ip(s,i)}function t1(s,n,i){if(n=n.updateQueue,n!==null&&(n=n.shared,(i&4194240)!==0)){var l=n.lanes;l&=s.pendingLanes,i|=l,n.lanes=i,jV(s,i)}}function _X(s,n){var i=s.updateQueue,l=s.alternate;if(l!==null&&(l=l.updateQueue,i===l)){var u=null,p=null;if(i=i.firstBaseUpdate,i!==null){do{var g={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};p===null?u=p=g:p=p.next=g,i=i.next}while(i!==null);p===null?u=p=n:p=p.next=n}else u=p=n;i={baseState:l.baseState,firstBaseUpdate:u,lastBaseUpdate:p,shared:l.shared,effects:l.effects},s.updateQueue=i;return}s=i.lastBaseUpdate,s===null?i.firstBaseUpdate=n:s.next=n,i.lastBaseUpdate=n}function D1(s,n,i,l){var u=s.updateQueue;Of=!1;var p=u.firstBaseUpdate,g=u.lastBaseUpdate,y=u.shared.pending;if(y!==null){u.shared.pending=null;var x=y,C=x.next;x.next=null,g===null?p=C:g.next=C,g=x;var k=s.alternate;k!==null&&(k=k.updateQueue,y=k.lastBaseUpdate,y!==g&&(y===null?k.firstBaseUpdate=C:y.next=C,k.lastBaseUpdate=x))}if(p!==null){var A=u.baseState;g=0,k=C=x=null,y=p;do{var M=y.lane,G=y.eventTime;if((l&M)===M){k!==null&&(k=k.next={eventTime:G,lane:0,tag:y.tag,payload:y.payload,callback:y.callback,next:null});e:{var B=s,X=y;switch(M=n,G=i,X.tag){case 1:if(B=X.payload,typeof B=="function"){A=B.call(G,A,M);break e}A=B;break e;case 3:B.flags=B.flags&-65537|128;case 0:if(B=X.payload,M=typeof B=="function"?B.call(G,A,M):B,M==null)break e;A=di({},A,M);break e;case 2:Of=!0}}y.callback!==null&&y.lane!==0&&(s.flags|=64,M=u.effects,M===null?u.effects=[y]:M.push(y))}else G={eventTime:G,lane:M,tag:y.tag,payload:y.payload,callback:y.callback,next:null},k===null?(C=k=G,x=A):k=k.next=G,g|=M;if(y=y.next,y===null){if(y=u.shared.pending,y===null)break;M=y,y=M.next,M.next=null,u.lastBaseUpdate=M,u.shared.pending=null}}while(!0);if(k===null&&(x=A),u.baseState=x,u.firstBaseUpdate=C,u.lastBaseUpdate=k,n=u.shared.interleaved,n!==null){u=n;do g|=u.lane,u=u.next;while(u!==n)}else p===null&&(u.shared.lanes=0);w_|=g,s.lanes=g,s.memoizedState=A}}function vX(s,n,i){if(s=n.effects,n.effects=null,s!==null)for(n=0;n<s.length;n++){var l=s[n],u=l.callback;if(u!==null){if(l.callback=null,l=i,typeof u!="function")throw Error(ft(191,u));u.call(l)}}}var iT={},Hu=fm(iT),IS=fm(iT),AS=fm(iT);function h_(s){if(s===iT)throw Error(ft(174));return s}function QV(s,n){switch(ks(AS,n),ks(IS,s),ks(Hu,iT),s=n.nodeType,s){case 9:case 11:n=(n=n.documentElement)?n.namespaceURI:X4(null,"");break;default:s=s===8?n.parentNode:n,n=s.namespaceURI||null,s=s.tagName,n=X4(n,s)}Vs(Hu),ks(Hu,n)}function ry(){Vs(Hu),Vs(IS),Vs(AS)}function vZ(s){h_(AS.current);var n=h_(Hu.current),i=X4(n,s.type);n!==i&&(ks(IS,s),ks(Hu,i))}function ZV(s){IS.current===s&&(Vs(Hu),Vs(IS))}var ai=fm(0);function P1(s){for(var n=s;n!==null;){if(n.tag===13){var i=n.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return n}else if(n.tag===19&&n.memoizedProps.revealOrder!==void 0){if(n.flags&128)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===s)break;for(;n.sibling===null;){if(n.return===null||n.return===s)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var s4=[];function e3(){for(var s=0;s<s4.length;s++)s4[s]._workInProgressVersionPrimary=null;s4.length=0}var n1=up.ReactCurrentDispatcher,i4=up.ReactCurrentBatchConfig,x_=0,oi=null,ea=null,ba=null,L1=!1,rS=!1,kS=0,_ge=0;function po(){throw Error(ft(321))}function t3(s,n){if(n===null)return!1;for(var i=0;i<n.length&&i<s.length;i++)if(!Hd(s[i],n[i]))return!1;return!0}function n3(s,n,i,l,u,p){if(x_=p,oi=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,n1.current=s===null||s.memoizedState===null?bge:xge,s=i(l,u),rS){p=0;do{if(rS=!1,kS=0,25<=p)throw Error(ft(301));p+=1,ba=ea=null,n.updateQueue=null,n1.current=wge,s=i(l,u)}while(rS)}if(n1.current=j1,n=ea!==null&&ea.next!==null,x_=0,ba=ea=oi=null,L1=!1,n)throw Error(ft(300));return s}function r3(){var s=kS!==0;return kS=0,s}function Uu(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ba===null?oi.memoizedState=ba=s:ba=ba.next=s,ba}function Kl(){if(ea===null){var s=oi.alternate;s=s!==null?s.memoizedState:null}else s=ea.next;var n=ba===null?oi.memoizedState:ba.next;if(n!==null)ba=n,ea=s;else{if(s===null)throw Error(ft(310));ea=s,s={memoizedState:ea.memoizedState,baseState:ea.baseState,baseQueue:ea.baseQueue,queue:ea.queue,next:null},ba===null?oi.memoizedState=ba=s:ba=ba.next=s}return ba}function OS(s,n){return typeof n=="function"?n(s):n}function a4(s){var n=Kl(),i=n.queue;if(i===null)throw Error(ft(311));i.lastRenderedReducer=s;var l=ea,u=l.baseQueue,p=i.pending;if(p!==null){if(u!==null){var g=u.next;u.next=p.next,p.next=g}l.baseQueue=u=p,i.pending=null}if(u!==null){p=u.next,l=l.baseState;var y=g=null,x=null,C=p;do{var k=C.lane;if((x_&k)===k)x!==null&&(x=x.next={lane:0,action:C.action,hasEagerState:C.hasEagerState,eagerState:C.eagerState,next:null}),l=C.hasEagerState?C.eagerState:s(l,C.action);else{var A={lane:k,action:C.action,hasEagerState:C.hasEagerState,eagerState:C.eagerState,next:null};x===null?(y=x=A,g=l):x=x.next=A,oi.lanes|=k,w_|=k}C=C.next}while(C!==null&&C!==p);x===null?g=l:x.next=y,Hd(l,n.memoizedState)||(pc=!0),n.memoizedState=l,n.baseState=g,n.baseQueue=x,i.lastRenderedState=l}if(s=i.interleaved,s!==null){u=s;do p=u.lane,oi.lanes|=p,w_|=p,u=u.next;while(u!==s)}else u===null&&(i.lanes=0);return[n.memoizedState,i.dispatch]}function o4(s){var n=Kl(),i=n.queue;if(i===null)throw Error(ft(311));i.lastRenderedReducer=s;var l=i.dispatch,u=i.pending,p=n.memoizedState;if(u!==null){i.pending=null;var g=u=u.next;do p=s(p,g.action),g=g.next;while(g!==u);Hd(p,n.memoizedState)||(pc=!0),n.memoizedState=p,n.baseQueue===null&&(n.baseState=p),i.lastRenderedState=p}return[p,l]}function EZ(){}function yZ(s,n){var i=oi,l=Kl(),u=n(),p=!Hd(l.memoizedState,u);if(p&&(l.memoizedState=u,pc=!0),l=l.queue,s3(wZ.bind(null,i,l,s),[s]),l.getSnapshot!==n||p||ba!==null&&ba.memoizedState.tag&1){if(i.flags|=2048,DS(9,xZ.bind(null,i,l,u,n),void 0,null),Sa===null)throw Error(ft(349));x_&30||bZ(i,n,u)}return u}function bZ(s,n,i){s.flags|=16384,s={getSnapshot:n,value:i},n=oi.updateQueue,n===null?(n={lastEffect:null,stores:null},oi.updateQueue=n,n.stores=[s]):(i=n.stores,i===null?n.stores=[s]:i.push(s))}function xZ(s,n,i,l){n.value=i,n.getSnapshot=l,SZ(n)&&TZ(s)}function wZ(s,n,i){return i(function(){SZ(n)&&TZ(s)})}function SZ(s){var n=s.getSnapshot;s=s.value;try{var i=n();return!Hd(s,i)}catch{return!0}}function TZ(s){var n=ip(s,1);n!==null&&Gd(n,s,1,-1)}function EX(s){var n=Uu();return typeof s=="function"&&(s=s()),n.memoizedState=n.baseState=s,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:OS,lastRenderedState:s},n.queue=s,s=s.dispatch=yge.bind(null,oi,s),[n.memoizedState,s]}function DS(s,n,i,l){return s={tag:s,create:n,destroy:i,deps:l,next:null},n=oi.updateQueue,n===null?(n={lastEffect:null,stores:null},oi.updateQueue=n,n.lastEffect=s.next=s):(i=n.lastEffect,i===null?n.lastEffect=s.next=s:(l=i.next,i.next=s,s.next=l,n.lastEffect=s)),s}function RZ(){return Kl().memoizedState}function r1(s,n,i,l){var u=Uu();oi.flags|=s,u.memoizedState=DS(1|n,i,void 0,l===void 0?null:l)}function Tk(s,n,i,l){var u=Kl();l=l===void 0?null:l;var p=void 0;if(ea!==null){var g=ea.memoizedState;if(p=g.destroy,l!==null&&t3(l,g.deps)){u.memoizedState=DS(n,i,p,l);return}}oi.flags|=s,u.memoizedState=DS(1|n,i,p,l)}function yX(s,n){return r1(8390656,8,s,n)}function s3(s,n){return Tk(2048,8,s,n)}function CZ(s,n){return Tk(4,2,s,n)}function NZ(s,n){return Tk(4,4,s,n)}function IZ(s,n){if(typeof n=="function")return s=s(),n(s),function(){n(null)};if(n!=null)return s=s(),n.current=s,function(){n.current=null}}function AZ(s,n,i){return i=i!=null?i.concat([s]):null,Tk(4,4,IZ.bind(null,n,s),i)}function i3(){}function kZ(s,n){var i=Kl();n=n===void 0?null:n;var l=i.memoizedState;return l!==null&&n!==null&&t3(n,l[1])?l[0]:(i.memoizedState=[s,n],s)}function OZ(s,n){var i=Kl();n=n===void 0?null:n;var l=i.memoizedState;return l!==null&&n!==null&&t3(n,l[1])?l[0]:(s=s(),i.memoizedState=[s,n],s)}function DZ(s,n,i){return x_&21?(Hd(i,n)||(i=UQ(),oi.lanes|=i,w_|=i,s.baseState=!0),n):(s.baseState&&(s.baseState=!1,pc=!0),s.memoizedState=i)}function vge(s,n){var i=fs;fs=i!==0&&4>i?i:4,s(!0);var l=i4.transition;i4.transition={};try{s(!1),n()}finally{fs=i,i4.transition=l}}function PZ(){return Kl().memoizedState}function Ege(s,n,i){var l=Jf(s);if(i={lane:l,action:i,hasEagerState:!1,eagerState:null,next:null},LZ(s))jZ(n,i);else if(i=gZ(s,n,i,l),i!==null){var u=Vo();Gd(i,s,l,u),MZ(i,n,l)}}function yge(s,n,i){var l=Jf(s),u={lane:l,action:i,hasEagerState:!1,eagerState:null,next:null};if(LZ(s))jZ(n,u);else{var p=s.alternate;if(s.lanes===0&&(p===null||p.lanes===0)&&(p=n.lastRenderedReducer,p!==null))try{var g=n.lastRenderedState,y=p(g,i);if(u.hasEagerState=!0,u.eagerState=y,Hd(y,g)){var x=n.interleaved;x===null?(u.next=u,$V(n)):(u.next=x.next,x.next=u),n.interleaved=u;return}}catch{}finally{}i=gZ(s,n,u,l),i!==null&&(u=Vo(),Gd(i,s,l,u),MZ(i,n,l))}}function LZ(s){var n=s.alternate;return s===oi||n!==null&&n===oi}function jZ(s,n){rS=L1=!0;var i=s.pending;i===null?n.next=n:(n.next=i.next,i.next=n),s.pending=n}function MZ(s,n,i){if(i&4194240){var l=n.lanes;l&=s.pendingLanes,i|=l,n.lanes=i,jV(s,i)}}var j1={readContext:Hl,useCallback:po,useContext:po,useEffect:po,useImperativeHandle:po,useInsertionEffect:po,useLayoutEffect:po,useMemo:po,useReducer:po,useRef:po,useState:po,useDebugValue:po,useDeferredValue:po,useTransition:po,useMutableSource:po,useSyncExternalStore:po,useId:po,unstable_isNewReconciler:!1},bge={readContext:Hl,useCallback:function(s,n){return Uu().memoizedState=[s,n===void 0?null:n],s},useContext:Hl,useEffect:yX,useImperativeHandle:function(s,n,i){return i=i!=null?i.concat([s]):null,r1(4194308,4,IZ.bind(null,n,s),i)},useLayoutEffect:function(s,n){return r1(4194308,4,s,n)},useInsertionEffect:function(s,n){return r1(4,2,s,n)},useMemo:function(s,n){var i=Uu();return n=n===void 0?null:n,s=s(),i.memoizedState=[s,n],s},useReducer:function(s,n,i){var l=Uu();return n=i!==void 0?i(n):n,l.memoizedState=l.baseState=n,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:n},l.queue=s,s=s.dispatch=Ege.bind(null,oi,s),[l.memoizedState,s]},useRef:function(s){var n=Uu();return s={current:s},n.memoizedState=s},useState:EX,useDebugValue:i3,useDeferredValue:function(s){return Uu().memoizedState=s},useTransition:function(){var s=EX(!1),n=s[0];return s=vge.bind(null,s[1]),Uu().memoizedState=s,[n,s]},useMutableSource:function(){},useSyncExternalStore:function(s,n,i){var l=oi,u=Uu();if(Zs){if(i===void 0)throw Error(ft(407));i=i()}else{if(i=n(),Sa===null)throw Error(ft(349));x_&30||bZ(l,n,i)}u.memoizedState=i;var p={value:i,getSnapshot:n};return u.queue=p,yX(wZ.bind(null,l,p,s),[s]),l.flags|=2048,DS(9,xZ.bind(null,l,p,i,n),void 0,null),i},useId:function(){var s=Uu(),n=Sa.identifierPrefix;if(Zs){var i=Kh,l=Hh;i=(l&~(1<<32-zd(l)-1)).toString(32)+i,n=":"+n+"R"+i,i=kS++,0<i&&(n+="H"+i.toString(32)),n+=":"}else i=_ge++,n=":"+n+"r"+i.toString(32)+":";return s.memoizedState=n},unstable_isNewReconciler:!1},xge={readContext:Hl,useCallback:kZ,useContext:Hl,useEffect:s3,useImperativeHandle:AZ,useInsertionEffect:CZ,useLayoutEffect:NZ,useMemo:OZ,useReducer:a4,useRef:RZ,useState:function(){return a4(OS)},useDebugValue:i3,useDeferredValue:function(s){var n=Kl();return DZ(n,ea.memoizedState,s)},useTransition:function(){var s=a4(OS)[0],n=Kl().memoizedState;return[s,n]},useMutableSource:EZ,useSyncExternalStore:yZ,useId:PZ,unstable_isNewReconciler:!1},wge={readContext:Hl,useCallback:kZ,useContext:Hl,useEffect:s3,useImperativeHandle:AZ,useInsertionEffect:CZ,useLayoutEffect:NZ,useMemo:OZ,useReducer:o4,useRef:RZ,useState:function(){return o4(OS)},useDebugValue:i3,useDeferredValue:function(s){var n=Kl();return ea===null?n.memoizedState=s:DZ(n,ea.memoizedState,s)},useTransition:function(){var s=o4(OS)[0],n=Kl().memoizedState;return[s,n]},useMutableSource:EZ,useSyncExternalStore:yZ,useId:PZ,unstable_isNewReconciler:!1};function Ud(s,n){if(s&&s.defaultProps){n=di({},n),s=s.defaultProps;for(var i in s)n[i]===void 0&&(n[i]=s[i]);return n}return n}function g5(s,n,i,l){n=s.memoizedState,i=i(l,n),i=i==null?n:di({},n,i),s.memoizedState=i,s.lanes===0&&(s.updateQueue.baseState=i)}var Rk={isMounted:function(s){return(s=s._reactInternals)?L_(s)===s:!1},enqueueSetState:function(s,n,i){s=s._reactInternals;var l=Vo(),u=Jf(s),p=Qh(l,u);p.payload=n,i!=null&&(p.callback=i),n=Xf(s,p,u),n!==null&&(Gd(n,s,u,l),t1(n,s,u))},enqueueReplaceState:function(s,n,i){s=s._reactInternals;var l=Vo(),u=Jf(s),p=Qh(l,u);p.tag=1,p.payload=n,i!=null&&(p.callback=i),n=Xf(s,p,u),n!==null&&(Gd(n,s,u,l),t1(n,s,u))},enqueueForceUpdate:function(s,n){s=s._reactInternals;var i=Vo(),l=Jf(s),u=Qh(i,l);u.tag=2,n!=null&&(u.callback=n),n=Xf(s,u,l),n!==null&&(Gd(n,s,l,i),t1(n,s,l))}};function bX(s,n,i,l,u,p,g){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(l,p,g):n.prototype&&n.prototype.isPureReactComponent?!TS(i,l)||!TS(u,p):!0}function UZ(s,n,i){var l=!1,u=cm,p=n.contextType;return typeof p=="object"&&p!==null?p=Hl(p):(u=mc(n)?y_:vo.current,l=n.contextTypes,p=(l=l!=null)?ey(s,u):cm),n=new n(i,p),s.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,n.updater=Rk,s.stateNode=n,n._reactInternals=s,l&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=u,s.__reactInternalMemoizedMaskedChildContext=p),n}function xX(s,n,i,l){s=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(i,l),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(i,l),n.state!==s&&Rk.enqueueReplaceState(n,n.state,null)}function _5(s,n,i,l){var u=s.stateNode;u.props=i,u.state=s.memoizedState,u.refs={},JV(s);var p=n.contextType;typeof p=="object"&&p!==null?u.context=Hl(p):(p=mc(n)?y_:vo.current,u.context=ey(s,p)),u.state=s.memoizedState,p=n.getDerivedStateFromProps,typeof p=="function"&&(g5(s,n,p,i),u.state=s.memoizedState),typeof n.getDerivedStateFromProps=="function"||typeof u.getSnapshotBeforeUpdate=="function"||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(n=u.state,typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount(),n!==u.state&&Rk.enqueueReplaceState(u,u.state,null),D1(s,i,u,l),u.state=s.memoizedState),typeof u.componentDidMount=="function"&&(s.flags|=4194308)}function sy(s,n){try{var i="",l=n;do i+=Jfe(l),l=l.return;while(l);var u=i}catch(p){u=`
Error generating stack: `+p.message+`
`+p.stack}return{value:s,source:n,stack:u,digest:null}}function c4(s,n,i){return{value:s,source:null,stack:i??null,digest:n??null}}function v5(s,n){try{console.error(n.value)}catch(i){setTimeout(function(){throw i})}}var Sge=typeof WeakMap=="function"?WeakMap:Map;function VZ(s,n,i){i=Qh(-1,i),i.tag=3,i.payload={element:null};var l=n.value;return i.callback=function(){U1||(U1=!0,N5=l),v5(s,n)},i}function FZ(s,n,i){i=Qh(-1,i),i.tag=3;var l=s.type.getDerivedStateFromError;if(typeof l=="function"){var u=n.value;i.payload=function(){return l(u)},i.callback=function(){v5(s,n)}}var p=s.stateNode;return p!==null&&typeof p.componentDidCatch=="function"&&(i.callback=function(){v5(s,n),typeof l!="function"&&($f===null?$f=new Set([this]):$f.add(this));var g=n.stack;this.componentDidCatch(n.value,{componentStack:g!==null?g:""})}),i}function wX(s,n,i){var l=s.pingCache;if(l===null){l=s.pingCache=new Sge;var u=new Set;l.set(n,u)}else u=l.get(n),u===void 0&&(u=new Set,l.set(n,u));u.has(i)||(u.add(i),s=Uge.bind(null,s,n,i),n.then(s,s))}function SX(s){do{var n;if((n=s.tag===13)&&(n=s.memoizedState,n=n!==null?n.dehydrated!==null:!0),n)return s;s=s.return}while(s!==null);return null}function TX(s,n,i,l,u){return s.mode&1?(s.flags|=65536,s.lanes=u,s):(s===n?s.flags|=65536:(s.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(n=Qh(-1,1),n.tag=2,Xf(i,n,1))),i.lanes|=1),s)}var Tge=up.ReactCurrentOwner,pc=!1;function jo(s,n,i,l){n.child=s===null?mZ(n,null,i,l):ny(n,s.child,i,l)}function RX(s,n,i,l,u){i=i.render;var p=n.ref;return HE(n,u),l=n3(s,n,i,l,p,u),i=r3(),s!==null&&!pc?(n.updateQueue=s.updateQueue,n.flags&=-2053,s.lanes&=~u,ap(s,n,u)):(Zs&&i&&WV(n),n.flags|=1,jo(s,n,l,u),n.child)}function CX(s,n,i,l,u){if(s===null){var p=i.type;return typeof p=="function"&&!p3(p)&&p.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(n.tag=15,n.type=p,BZ(s,n,p,l,u)):(s=o1(i.type,null,l,n,n.mode,u),s.ref=n.ref,s.return=n,n.child=s)}if(p=s.child,!(s.lanes&u)){var g=p.memoizedProps;if(i=i.compare,i=i!==null?i:TS,i(g,l)&&s.ref===n.ref)return ap(s,n,u)}return n.flags|=1,s=Qf(p,l),s.ref=n.ref,s.return=n,n.child=s}function BZ(s,n,i,l,u){if(s!==null){var p=s.memoizedProps;if(TS(p,l)&&s.ref===n.ref)if(pc=!1,n.pendingProps=l=p,(s.lanes&u)!==0)s.flags&131072&&(pc=!0);else return n.lanes=s.lanes,ap(s,n,u)}return E5(s,n,i,l,u)}function zZ(s,n,i){var l=n.pendingProps,u=l.children,p=s!==null?s.memoizedState:null;if(l.mode==="hidden")if(!(n.mode&1))n.memoizedState={baseLanes:0,cachePool:null,transitions:null},ks(UE,Bc),Bc|=i;else{if(!(i&1073741824))return s=p!==null?p.baseLanes|i:i,n.lanes=n.childLanes=1073741824,n.memoizedState={baseLanes:s,cachePool:null,transitions:null},n.updateQueue=null,ks(UE,Bc),Bc|=s,null;n.memoizedState={baseLanes:0,cachePool:null,transitions:null},l=p!==null?p.baseLanes:i,ks(UE,Bc),Bc|=l}else p!==null?(l=p.baseLanes|i,n.memoizedState=null):l=i,ks(UE,Bc),Bc|=l;return jo(s,n,u,i),n.child}function GZ(s,n){var i=n.ref;(s===null&&i!==null||s!==null&&s.ref!==i)&&(n.flags|=512,n.flags|=2097152)}function E5(s,n,i,l,u){var p=mc(i)?y_:vo.current;return p=ey(n,p),HE(n,u),i=n3(s,n,i,l,p,u),l=r3(),s!==null&&!pc?(n.updateQueue=s.updateQueue,n.flags&=-2053,s.lanes&=~u,ap(s,n,u)):(Zs&&l&&WV(n),n.flags|=1,jo(s,n,i,u),n.child)}function NX(s,n,i,l,u){if(mc(i)){var p=!0;N1(n)}else p=!1;if(HE(n,u),n.stateNode===null)s1(s,n),UZ(n,i,l),_5(n,i,l,u),l=!0;else if(s===null){var g=n.stateNode,y=n.memoizedProps;g.props=y;var x=g.context,C=i.contextType;typeof C=="object"&&C!==null?C=Hl(C):(C=mc(i)?y_:vo.current,C=ey(n,C));var k=i.getDerivedStateFromProps,A=typeof k=="function"||typeof g.getSnapshotBeforeUpdate=="function";A||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(y!==l||x!==C)&&xX(n,g,l,C),Of=!1;var M=n.memoizedState;g.state=M,D1(n,l,g,u),x=n.memoizedState,y!==l||M!==x||fc.current||Of?(typeof k=="function"&&(g5(n,i,k,l),x=n.memoizedState),(y=Of||bX(n,i,y,l,M,x,C))?(A||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(n.flags|=4194308)):(typeof g.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=l,n.memoizedState=x),g.props=l,g.state=x,g.context=C,l=y):(typeof g.componentDidMount=="function"&&(n.flags|=4194308),l=!1)}else{g=n.stateNode,_Z(s,n),y=n.memoizedProps,C=n.type===n.elementType?y:Ud(n.type,y),g.props=C,A=n.pendingProps,M=g.context,x=i.contextType,typeof x=="object"&&x!==null?x=Hl(x):(x=mc(i)?y_:vo.current,x=ey(n,x));var G=i.getDerivedStateFromProps;(k=typeof G=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(y!==A||M!==x)&&xX(n,g,l,x),Of=!1,M=n.memoizedState,g.state=M,D1(n,l,g,u);var B=n.memoizedState;y!==A||M!==B||fc.current||Of?(typeof G=="function"&&(g5(n,i,G,l),B=n.memoizedState),(C=Of||bX(n,i,C,l,M,B,x)||!1)?(k||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(l,B,x),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(l,B,x)),typeof g.componentDidUpdate=="function"&&(n.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof g.componentDidUpdate!="function"||y===s.memoizedProps&&M===s.memoizedState||(n.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||y===s.memoizedProps&&M===s.memoizedState||(n.flags|=1024),n.memoizedProps=l,n.memoizedState=B),g.props=l,g.state=B,g.context=x,l=C):(typeof g.componentDidUpdate!="function"||y===s.memoizedProps&&M===s.memoizedState||(n.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||y===s.memoizedProps&&M===s.memoizedState||(n.flags|=1024),l=!1)}return y5(s,n,i,l,p,u)}function y5(s,n,i,l,u,p){GZ(s,n);var g=(n.flags&128)!==0;if(!l&&!g)return u&&pX(n,i,!1),ap(s,n,p);l=n.stateNode,Tge.current=n;var y=g&&typeof i.getDerivedStateFromError!="function"?null:l.render();return n.flags|=1,s!==null&&g?(n.child=ny(n,s.child,null,p),n.child=ny(n,null,y,p)):jo(s,n,y,p),n.memoizedState=l.state,u&&pX(n,i,!0),n.child}function WZ(s){var n=s.stateNode;n.pendingContext?hX(s,n.pendingContext,n.pendingContext!==n.context):n.context&&hX(s,n.context,!1),QV(s,n.containerInfo)}function IX(s,n,i,l,u){return ty(),KV(u),n.flags|=256,jo(s,n,i,l),n.child}var b5={dehydrated:null,treeContext:null,retryLane:0};function x5(s){return{baseLanes:s,cachePool:null,transitions:null}}function HZ(s,n,i){var l=n.pendingProps,u=ai.current,p=!1,g=(n.flags&128)!==0,y;if((y=g)||(y=s!==null&&s.memoizedState===null?!1:(u&2)!==0),y?(p=!0,n.flags&=-129):(s===null||s.memoizedState!==null)&&(u|=1),ks(ai,u&1),s===null)return f5(n),s=n.memoizedState,s!==null&&(s=s.dehydrated,s!==null)?(n.mode&1?s.data==="$!"?n.lanes=8:n.lanes=1073741824:n.lanes=1,null):(g=l.children,s=l.fallback,p?(l=n.mode,p=n.child,g={mode:"hidden",children:g},!(l&1)&&p!==null?(p.childLanes=0,p.pendingProps=g):p=Ik(g,l,0,null),s=g_(s,l,i,null),p.return=n,s.return=n,p.sibling=s,n.child=p,n.child.memoizedState=x5(i),n.memoizedState=b5,s):a3(n,g));if(u=s.memoizedState,u!==null&&(y=u.dehydrated,y!==null))return Rge(s,n,g,l,y,u,i);if(p){p=l.fallback,g=n.mode,u=s.child,y=u.sibling;var x={mode:"hidden",children:l.children};return!(g&1)&&n.child!==u?(l=n.child,l.childLanes=0,l.pendingProps=x,n.deletions=null):(l=Qf(u,x),l.subtreeFlags=u.subtreeFlags&14680064),y!==null?p=Qf(y,p):(p=g_(p,g,i,null),p.flags|=2),p.return=n,l.return=n,l.sibling=p,n.child=l,l=p,p=n.child,g=s.child.memoizedState,g=g===null?x5(i):{baseLanes:g.baseLanes|i,cachePool:null,transitions:g.transitions},p.memoizedState=g,p.childLanes=s.childLanes&~i,n.memoizedState=b5,l}return p=s.child,s=p.sibling,l=Qf(p,{mode:"visible",children:l.children}),!(n.mode&1)&&(l.lanes=i),l.return=n,l.sibling=null,s!==null&&(i=n.deletions,i===null?(n.deletions=[s],n.flags|=16):i.push(s)),n.child=l,n.memoizedState=null,l}function a3(s,n){return n=Ik({mode:"visible",children:n},s.mode,0,null),n.return=s,s.child=n}function PA(s,n,i,l){return l!==null&&KV(l),ny(n,s.child,null,i),s=a3(n,n.pendingProps.children),s.flags|=2,n.memoizedState=null,s}function Rge(s,n,i,l,u,p,g){if(i)return n.flags&256?(n.flags&=-257,l=c4(Error(ft(422))),PA(s,n,g,l)):n.memoizedState!==null?(n.child=s.child,n.flags|=128,null):(p=l.fallback,u=n.mode,l=Ik({mode:"visible",children:l.children},u,0,null),p=g_(p,u,g,null),p.flags|=2,l.return=n,p.return=n,l.sibling=p,n.child=l,n.mode&1&&ny(n,s.child,null,g),n.child.memoizedState=x5(g),n.memoizedState=b5,p);if(!(n.mode&1))return PA(s,n,g,null);if(u.data==="$!"){if(l=u.nextSibling&&u.nextSibling.dataset,l)var y=l.dgst;return l=y,p=Error(ft(419)),l=c4(p,l,void 0),PA(s,n,g,l)}if(y=(g&s.childLanes)!==0,pc||y){if(l=Sa,l!==null){switch(g&-g){case 4:u=2;break;case 16:u=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:u=32;break;case 536870912:u=268435456;break;default:u=0}u=u&(l.suspendedLanes|g)?0:u,u!==0&&u!==p.retryLane&&(p.retryLane=u,ip(s,u),Gd(l,s,u,-1))}return h3(),l=c4(Error(ft(421))),PA(s,n,g,l)}return u.data==="$?"?(n.flags|=128,n.child=s.child,n=Vge.bind(null,s),u._reactRetry=n,null):(s=p.treeContext,Gc=Yf(u.nextSibling),qc=n,Zs=!0,Fd=null,s!==null&&(Fl[Bl++]=Hh,Fl[Bl++]=Kh,Fl[Bl++]=b_,Hh=s.id,Kh=s.overflow,b_=n),n=a3(n,l.children),n.flags|=4096,n)}function AX(s,n,i){s.lanes|=n;var l=s.alternate;l!==null&&(l.lanes|=n),m5(s.return,n,i)}function l4(s,n,i,l,u){var p=s.memoizedState;p===null?s.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:l,tail:i,tailMode:u}:(p.isBackwards=n,p.rendering=null,p.renderingStartTime=0,p.last=l,p.tail=i,p.tailMode=u)}function KZ(s,n,i){var l=n.pendingProps,u=l.revealOrder,p=l.tail;if(jo(s,n,l.children,i),l=ai.current,l&2)l=l&1|2,n.flags|=128;else{if(s!==null&&s.flags&128)e:for(s=n.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&AX(s,i,n);else if(s.tag===19)AX(s,i,n);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===n)break e;for(;s.sibling===null;){if(s.return===null||s.return===n)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}l&=1}if(ks(ai,l),!(n.mode&1))n.memoizedState=null;else switch(u){case"forwards":for(i=n.child,u=null;i!==null;)s=i.alternate,s!==null&&P1(s)===null&&(u=i),i=i.sibling;i=u,i===null?(u=n.child,n.child=null):(u=i.sibling,i.sibling=null),l4(n,!1,u,i,p);break;case"backwards":for(i=null,u=n.child,n.child=null;u!==null;){if(s=u.alternate,s!==null&&P1(s)===null){n.child=u;break}s=u.sibling,u.sibling=i,i=u,u=s}l4(n,!0,i,null,p);break;case"together":l4(n,!1,null,null,void 0);break;default:n.memoizedState=null}return n.child}function s1(s,n){!(n.mode&1)&&s!==null&&(s.alternate=null,n.alternate=null,n.flags|=2)}function ap(s,n,i){if(s!==null&&(n.dependencies=s.dependencies),w_|=n.lanes,!(i&n.childLanes))return null;if(s!==null&&n.child!==s.child)throw Error(ft(153));if(n.child!==null){for(s=n.child,i=Qf(s,s.pendingProps),n.child=i,i.return=n;s.sibling!==null;)s=s.sibling,i=i.sibling=Qf(s,s.pendingProps),i.return=n;i.sibling=null}return n.child}function Cge(s,n,i){switch(n.tag){case 3:WZ(n),ty();break;case 5:vZ(n);break;case 1:mc(n.type)&&N1(n);break;case 4:QV(n,n.stateNode.containerInfo);break;case 10:var l=n.type._context,u=n.memoizedProps.value;ks(k1,l._currentValue),l._currentValue=u;break;case 13:if(l=n.memoizedState,l!==null)return l.dehydrated!==null?(ks(ai,ai.current&1),n.flags|=128,null):i&n.child.childLanes?HZ(s,n,i):(ks(ai,ai.current&1),s=ap(s,n,i),s!==null?s.sibling:null);ks(ai,ai.current&1);break;case 19:if(l=(i&n.childLanes)!==0,s.flags&128){if(l)return KZ(s,n,i);n.flags|=128}if(u=n.memoizedState,u!==null&&(u.rendering=null,u.tail=null,u.lastEffect=null),ks(ai,ai.current),l)break;return null;case 22:case 23:return n.lanes=0,zZ(s,n,i)}return ap(s,n,i)}var qZ,w5,YZ,XZ;qZ=function(s,n){for(var i=n.child;i!==null;){if(i.tag===5||i.tag===6)s.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===n)break;for(;i.sibling===null;){if(i.return===null||i.return===n)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};w5=function(){};YZ=function(s,n,i,l){var u=s.memoizedProps;if(u!==l){s=n.stateNode,h_(Hu.current);var p=null;switch(i){case"input":u=H4(s,u),l=H4(s,l),p=[];break;case"select":u=di({},u,{value:void 0}),l=di({},l,{value:void 0}),p=[];break;case"textarea":u=Y4(s,u),l=Y4(s,l),p=[];break;default:typeof u.onClick!="function"&&typeof l.onClick=="function"&&(s.onclick=R1)}$4(i,l);var g;i=null;for(C in u)if(!l.hasOwnProperty(C)&&u.hasOwnProperty(C)&&u[C]!=null)if(C==="style"){var y=u[C];for(g in y)y.hasOwnProperty(g)&&(i||(i={}),i[g]="")}else C!=="dangerouslySetInnerHTML"&&C!=="children"&&C!=="suppressContentEditableWarning"&&C!=="suppressHydrationWarning"&&C!=="autoFocus"&&(vS.hasOwnProperty(C)?p||(p=[]):(p=p||[]).push(C,null));for(C in l){var x=l[C];if(y=u!=null?u[C]:void 0,l.hasOwnProperty(C)&&x!==y&&(x!=null||y!=null))if(C==="style")if(y){for(g in y)!y.hasOwnProperty(g)||x&&x.hasOwnProperty(g)||(i||(i={}),i[g]="");for(g in x)x.hasOwnProperty(g)&&y[g]!==x[g]&&(i||(i={}),i[g]=x[g])}else i||(p||(p=[]),p.push(C,i)),i=x;else C==="dangerouslySetInnerHTML"?(x=x?x.__html:void 0,y=y?y.__html:void 0,x!=null&&y!==x&&(p=p||[]).push(C,x)):C==="children"?typeof x!="string"&&typeof x!="number"||(p=p||[]).push(C,""+x):C!=="suppressContentEditableWarning"&&C!=="suppressHydrationWarning"&&(vS.hasOwnProperty(C)?(x!=null&&C==="onScroll"&&Us("scroll",s),p||y===x||(p=[])):(p=p||[]).push(C,x))}i&&(p=p||[]).push("style",i);var C=p;(n.updateQueue=C)&&(n.flags|=4)}};XZ=function(s,n,i,l){i!==l&&(n.flags|=4)};function Lw(s,n){if(!Zs)switch(s.tailMode){case"hidden":n=s.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?s.tail=null:i.sibling=null;break;case"collapsed":i=s.tail;for(var l=null;i!==null;)i.alternate!==null&&(l=i),i=i.sibling;l===null?n||s.tail===null?s.tail=null:s.tail.sibling=null:l.sibling=null}}function fo(s){var n=s.alternate!==null&&s.alternate.child===s.child,i=0,l=0;if(n)for(var u=s.child;u!==null;)i|=u.lanes|u.childLanes,l|=u.subtreeFlags&14680064,l|=u.flags&14680064,u.return=s,u=u.sibling;else for(u=s.child;u!==null;)i|=u.lanes|u.childLanes,l|=u.subtreeFlags,l|=u.flags,u.return=s,u=u.sibling;return s.subtreeFlags|=l,s.childLanes=i,n}function Nge(s,n,i){var l=n.pendingProps;switch(HV(n),n.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return fo(n),null;case 1:return mc(n.type)&&C1(),fo(n),null;case 3:return l=n.stateNode,ry(),Vs(fc),Vs(vo),e3(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(s===null||s.child===null)&&(OA(n)?n.flags|=4:s===null||s.memoizedState.isDehydrated&&!(n.flags&256)||(n.flags|=1024,Fd!==null&&(k5(Fd),Fd=null))),w5(s,n),fo(n),null;case 5:ZV(n);var u=h_(AS.current);if(i=n.type,s!==null&&n.stateNode!=null)YZ(s,n,i,l,u),s.ref!==n.ref&&(n.flags|=512,n.flags|=2097152);else{if(!l){if(n.stateNode===null)throw Error(ft(166));return fo(n),null}if(s=h_(Hu.current),OA(n)){l=n.stateNode,i=n.type;var p=n.memoizedProps;switch(l[Fu]=n,l[NS]=p,s=(n.mode&1)!==0,i){case"dialog":Us("cancel",l),Us("close",l);break;case"iframe":case"object":case"embed":Us("load",l);break;case"video":case"audio":for(u=0;u<Ww.length;u++)Us(Ww[u],l);break;case"source":Us("error",l);break;case"img":case"image":case"link":Us("error",l),Us("load",l);break;case"details":Us("toggle",l);break;case"input":VY(l,p),Us("invalid",l);break;case"select":l._wrapperState={wasMultiple:!!p.multiple},Us("invalid",l);break;case"textarea":BY(l,p),Us("invalid",l)}$4(i,p),u=null;for(var g in p)if(p.hasOwnProperty(g)){var y=p[g];g==="children"?typeof y=="string"?l.textContent!==y&&(p.suppressHydrationWarning!==!0&&kA(l.textContent,y,s),u=["children",y]):typeof y=="number"&&l.textContent!==""+y&&(p.suppressHydrationWarning!==!0&&kA(l.textContent,y,s),u=["children",""+y]):vS.hasOwnProperty(g)&&y!=null&&g==="onScroll"&&Us("scroll",l)}switch(i){case"input":wA(l),FY(l,p,!0);break;case"textarea":wA(l),zY(l);break;case"select":case"option":break;default:typeof p.onClick=="function"&&(l.onclick=R1)}l=u,n.updateQueue=l,l!==null&&(n.flags|=4)}else{g=u.nodeType===9?u:u.ownerDocument,s==="http://www.w3.org/1999/xhtml"&&(s=wQ(i)),s==="http://www.w3.org/1999/xhtml"?i==="script"?(s=g.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild)):typeof l.is=="string"?s=g.createElement(i,{is:l.is}):(s=g.createElement(i),i==="select"&&(g=s,l.multiple?g.multiple=!0:l.size&&(g.size=l.size))):s=g.createElementNS(s,i),s[Fu]=n,s[NS]=l,qZ(s,n,!1,!1),n.stateNode=s;e:{switch(g=J4(i,l),i){case"dialog":Us("cancel",s),Us("close",s),u=l;break;case"iframe":case"object":case"embed":Us("load",s),u=l;break;case"video":case"audio":for(u=0;u<Ww.length;u++)Us(Ww[u],s);u=l;break;case"source":Us("error",s),u=l;break;case"img":case"image":case"link":Us("error",s),Us("load",s),u=l;break;case"details":Us("toggle",s),u=l;break;case"input":VY(s,l),u=H4(s,l),Us("invalid",s);break;case"option":u=l;break;case"select":s._wrapperState={wasMultiple:!!l.multiple},u=di({},l,{value:void 0}),Us("invalid",s);break;case"textarea":BY(s,l),u=Y4(s,l),Us("invalid",s);break;default:u=l}$4(i,u),y=u;for(p in y)if(y.hasOwnProperty(p)){var x=y[p];p==="style"?RQ(s,x):p==="dangerouslySetInnerHTML"?(x=x?x.__html:void 0,x!=null&&SQ(s,x)):p==="children"?typeof x=="string"?(i!=="textarea"||x!=="")&&ES(s,x):typeof x=="number"&&ES(s,""+x):p!=="suppressContentEditableWarning"&&p!=="suppressHydrationWarning"&&p!=="autoFocus"&&(vS.hasOwnProperty(p)?x!=null&&p==="onScroll"&&Us("scroll",s):x!=null&&AV(s,p,x,g))}switch(i){case"input":wA(s),FY(s,l,!1);break;case"textarea":wA(s),zY(s);break;case"option":l.value!=null&&s.setAttribute("value",""+om(l.value));break;case"select":s.multiple=!!l.multiple,p=l.value,p!=null?BE(s,!!l.multiple,p,!1):l.defaultValue!=null&&BE(s,!!l.multiple,l.defaultValue,!0);break;default:typeof u.onClick=="function"&&(s.onclick=R1)}switch(i){case"button":case"input":case"select":case"textarea":l=!!l.autoFocus;break e;case"img":l=!0;break e;default:l=!1}}l&&(n.flags|=4)}n.ref!==null&&(n.flags|=512,n.flags|=2097152)}return fo(n),null;case 6:if(s&&n.stateNode!=null)XZ(s,n,s.memoizedProps,l);else{if(typeof l!="string"&&n.stateNode===null)throw Error(ft(166));if(i=h_(AS.current),h_(Hu.current),OA(n)){if(l=n.stateNode,i=n.memoizedProps,l[Fu]=n,(p=l.nodeValue!==i)&&(s=qc,s!==null))switch(s.tag){case 3:kA(l.nodeValue,i,(s.mode&1)!==0);break;case 5:s.memoizedProps.suppressHydrationWarning!==!0&&kA(l.nodeValue,i,(s.mode&1)!==0)}p&&(n.flags|=4)}else l=(i.nodeType===9?i:i.ownerDocument).createTextNode(l),l[Fu]=n,n.stateNode=l}return fo(n),null;case 13:if(Vs(ai),l=n.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(Zs&&Gc!==null&&n.mode&1&&!(n.flags&128))pZ(),ty(),n.flags|=98560,p=!1;else if(p=OA(n),l!==null&&l.dehydrated!==null){if(s===null){if(!p)throw Error(ft(318));if(p=n.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(ft(317));p[Fu]=n}else ty(),!(n.flags&128)&&(n.memoizedState=null),n.flags|=4;fo(n),p=!1}else Fd!==null&&(k5(Fd),Fd=null),p=!0;if(!p)return n.flags&65536?n:null}return n.flags&128?(n.lanes=i,n):(l=l!==null,l!==(s!==null&&s.memoizedState!==null)&&l&&(n.child.flags|=8192,n.mode&1&&(s===null||ai.current&1?na===0&&(na=3):h3())),n.updateQueue!==null&&(n.flags|=4),fo(n),null);case 4:return ry(),w5(s,n),s===null&&RS(n.stateNode.containerInfo),fo(n),null;case 10:return XV(n.type._context),fo(n),null;case 17:return mc(n.type)&&C1(),fo(n),null;case 19:if(Vs(ai),p=n.memoizedState,p===null)return fo(n),null;if(l=(n.flags&128)!==0,g=p.rendering,g===null)if(l)Lw(p,!1);else{if(na!==0||s!==null&&s.flags&128)for(s=n.child;s!==null;){if(g=P1(s),g!==null){for(n.flags|=128,Lw(p,!1),l=g.updateQueue,l!==null&&(n.updateQueue=l,n.flags|=4),n.subtreeFlags=0,l=i,i=n.child;i!==null;)p=i,s=l,p.flags&=14680066,g=p.alternate,g===null?(p.childLanes=0,p.lanes=s,p.child=null,p.subtreeFlags=0,p.memoizedProps=null,p.memoizedState=null,p.updateQueue=null,p.dependencies=null,p.stateNode=null):(p.childLanes=g.childLanes,p.lanes=g.lanes,p.child=g.child,p.subtreeFlags=0,p.deletions=null,p.memoizedProps=g.memoizedProps,p.memoizedState=g.memoizedState,p.updateQueue=g.updateQueue,p.type=g.type,s=g.dependencies,p.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),i=i.sibling;return ks(ai,ai.current&1|2),n.child}s=s.sibling}p.tail!==null&&ki()>iy&&(n.flags|=128,l=!0,Lw(p,!1),n.lanes=4194304)}else{if(!l)if(s=P1(g),s!==null){if(n.flags|=128,l=!0,i=s.updateQueue,i!==null&&(n.updateQueue=i,n.flags|=4),Lw(p,!0),p.tail===null&&p.tailMode==="hidden"&&!g.alternate&&!Zs)return fo(n),null}else 2*ki()-p.renderingStartTime>iy&&i!==1073741824&&(n.flags|=128,l=!0,Lw(p,!1),n.lanes=4194304);p.isBackwards?(g.sibling=n.child,n.child=g):(i=p.last,i!==null?i.sibling=g:n.child=g,p.last=g)}return p.tail!==null?(n=p.tail,p.rendering=n,p.tail=n.sibling,p.renderingStartTime=ki(),n.sibling=null,i=ai.current,ks(ai,l?i&1|2:i&1),n):(fo(n),null);case 22:case 23:return u3(),l=n.memoizedState!==null,s!==null&&s.memoizedState!==null!==l&&(n.flags|=8192),l&&n.mode&1?Bc&1073741824&&(fo(n),n.subtreeFlags&6&&(n.flags|=8192)):fo(n),null;case 24:return null;case 25:return null}throw Error(ft(156,n.tag))}function Ige(s,n){switch(HV(n),n.tag){case 1:return mc(n.type)&&C1(),s=n.flags,s&65536?(n.flags=s&-65537|128,n):null;case 3:return ry(),Vs(fc),Vs(vo),e3(),s=n.flags,s&65536&&!(s&128)?(n.flags=s&-65537|128,n):null;case 5:return ZV(n),null;case 13:if(Vs(ai),s=n.memoizedState,s!==null&&s.dehydrated!==null){if(n.alternate===null)throw Error(ft(340));ty()}return s=n.flags,s&65536?(n.flags=s&-65537|128,n):null;case 19:return Vs(ai),null;case 4:return ry(),null;case 10:return XV(n.type._context),null;case 22:case 23:return u3(),null;case 24:return null;default:return null}}var LA=!1,_o=!1,Age=typeof WeakSet=="function"?WeakSet:Set,zt=null;function ME(s,n){var i=s.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(l){vi(s,n,l)}else i.current=null}function S5(s,n,i){try{i()}catch(l){vi(s,n,l)}}var kX=!1;function kge(s,n){if(o5=w1,s=eZ(),GV(s)){if("selectionStart"in s)var i={start:s.selectionStart,end:s.selectionEnd};else e:{i=(i=s.ownerDocument)&&i.defaultView||window;var l=i.getSelection&&i.getSelection();if(l&&l.rangeCount!==0){i=l.anchorNode;var u=l.anchorOffset,p=l.focusNode;l=l.focusOffset;try{i.nodeType,p.nodeType}catch{i=null;break e}var g=0,y=-1,x=-1,C=0,k=0,A=s,M=null;t:for(;;){for(var G;A!==i||u!==0&&A.nodeType!==3||(y=g+u),A!==p||l!==0&&A.nodeType!==3||(x=g+l),A.nodeType===3&&(g+=A.nodeValue.length),(G=A.firstChild)!==null;)M=A,A=G;for(;;){if(A===s)break t;if(M===i&&++C===u&&(y=g),M===p&&++k===l&&(x=g),(G=A.nextSibling)!==null)break;A=M,M=A.parentNode}A=G}i=y===-1||x===-1?null:{start:y,end:x}}else i=null}i=i||{start:0,end:0}}else i=null;for(c5={focusedElem:s,selectionRange:i},w1=!1,zt=n;zt!==null;)if(n=zt,s=n.child,(n.subtreeFlags&1028)!==0&&s!==null)s.return=n,zt=s;else for(;zt!==null;){n=zt;try{var B=n.alternate;if(n.flags&1024)switch(n.tag){case 0:case 11:case 15:break;case 1:if(B!==null){var X=B.memoizedProps,Z=B.memoizedState,q=n.stateNode,V=q.getSnapshotBeforeUpdate(n.elementType===n.type?X:Ud(n.type,X),Z);q.__reactInternalSnapshotBeforeUpdate=V}break;case 3:var ee=n.stateNode.containerInfo;ee.nodeType===1?ee.textContent="":ee.nodeType===9&&ee.documentElement&&ee.removeChild(ee.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ft(163))}}catch(de){vi(n,n.return,de)}if(s=n.sibling,s!==null){s.return=n.return,zt=s;break}zt=n.return}return B=kX,kX=!1,B}function sS(s,n,i){var l=n.updateQueue;if(l=l!==null?l.lastEffect:null,l!==null){var u=l=l.next;do{if((u.tag&s)===s){var p=u.destroy;u.destroy=void 0,p!==void 0&&S5(n,i,p)}u=u.next}while(u!==l)}}function Ck(s,n){if(n=n.updateQueue,n=n!==null?n.lastEffect:null,n!==null){var i=n=n.next;do{if((i.tag&s)===s){var l=i.create;i.destroy=l()}i=i.next}while(i!==n)}}function T5(s){var n=s.ref;if(n!==null){var i=s.stateNode;switch(s.tag){case 5:s=i;break;default:s=i}typeof n=="function"?n(s):n.current=s}}function $Z(s){var n=s.alternate;n!==null&&(s.alternate=null,$Z(n)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(n=s.stateNode,n!==null&&(delete n[Fu],delete n[NS],delete n[u5],delete n[pge],delete n[fge])),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}function JZ(s){return s.tag===5||s.tag===3||s.tag===4}function OX(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||JZ(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function R5(s,n,i){var l=s.tag;if(l===5||l===6)s=s.stateNode,n?i.nodeType===8?i.parentNode.insertBefore(s,n):i.insertBefore(s,n):(i.nodeType===8?(n=i.parentNode,n.insertBefore(s,i)):(n=i,n.appendChild(s)),i=i._reactRootContainer,i!=null||n.onclick!==null||(n.onclick=R1));else if(l!==4&&(s=s.child,s!==null))for(R5(s,n,i),s=s.sibling;s!==null;)R5(s,n,i),s=s.sibling}function C5(s,n,i){var l=s.tag;if(l===5||l===6)s=s.stateNode,n?i.insertBefore(s,n):i.appendChild(s);else if(l!==4&&(s=s.child,s!==null))for(C5(s,n,i),s=s.sibling;s!==null;)C5(s,n,i),s=s.sibling}var za=null,Vd=!1;function If(s,n,i){for(i=i.child;i!==null;)QZ(s,n,i),i=i.sibling}function QZ(s,n,i){if(Wu&&typeof Wu.onCommitFiberUnmount=="function")try{Wu.onCommitFiberUnmount(Ek,i)}catch{}switch(i.tag){case 5:_o||ME(i,n);case 6:var l=za,u=Vd;za=null,If(s,n,i),za=l,Vd=u,za!==null&&(Vd?(s=za,i=i.stateNode,s.nodeType===8?s.parentNode.removeChild(i):s.removeChild(i)):za.removeChild(i.stateNode));break;case 18:za!==null&&(Vd?(s=za,i=i.stateNode,s.nodeType===8?n4(s.parentNode,i):s.nodeType===1&&n4(s,i),wS(s)):n4(za,i.stateNode));break;case 4:l=za,u=Vd,za=i.stateNode.containerInfo,Vd=!0,If(s,n,i),za=l,Vd=u;break;case 0:case 11:case 14:case 15:if(!_o&&(l=i.updateQueue,l!==null&&(l=l.lastEffect,l!==null))){u=l=l.next;do{var p=u,g=p.destroy;p=p.tag,g!==void 0&&(p&2||p&4)&&S5(i,n,g),u=u.next}while(u!==l)}If(s,n,i);break;case 1:if(!_o&&(ME(i,n),l=i.stateNode,typeof l.componentWillUnmount=="function"))try{l.props=i.memoizedProps,l.state=i.memoizedState,l.componentWillUnmount()}catch(y){vi(i,n,y)}If(s,n,i);break;case 21:If(s,n,i);break;case 22:i.mode&1?(_o=(l=_o)||i.memoizedState!==null,If(s,n,i),_o=l):If(s,n,i);break;default:If(s,n,i)}}function DX(s){var n=s.updateQueue;if(n!==null){s.updateQueue=null;var i=s.stateNode;i===null&&(i=s.stateNode=new Age),n.forEach(function(l){var u=Fge.bind(null,s,l);i.has(l)||(i.add(l),l.then(u,u))})}}function jd(s,n){var i=n.deletions;if(i!==null)for(var l=0;l<i.length;l++){var u=i[l];try{var p=s,g=n,y=g;e:for(;y!==null;){switch(y.tag){case 5:za=y.stateNode,Vd=!1;break e;case 3:za=y.stateNode.containerInfo,Vd=!0;break e;case 4:za=y.stateNode.containerInfo,Vd=!0;break e}y=y.return}if(za===null)throw Error(ft(160));QZ(p,g,u),za=null,Vd=!1;var x=u.alternate;x!==null&&(x.return=null),u.return=null}catch(C){vi(u,n,C)}}if(n.subtreeFlags&12854)for(n=n.child;n!==null;)ZZ(n,s),n=n.sibling}function ZZ(s,n){var i=s.alternate,l=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:if(jd(n,s),Mu(s),l&4){try{sS(3,s,s.return),Ck(3,s)}catch(X){vi(s,s.return,X)}try{sS(5,s,s.return)}catch(X){vi(s,s.return,X)}}break;case 1:jd(n,s),Mu(s),l&512&&i!==null&&ME(i,i.return);break;case 5:if(jd(n,s),Mu(s),l&512&&i!==null&&ME(i,i.return),s.flags&32){var u=s.stateNode;try{ES(u,"")}catch(X){vi(s,s.return,X)}}if(l&4&&(u=s.stateNode,u!=null)){var p=s.memoizedProps,g=i!==null?i.memoizedProps:p,y=s.type,x=s.updateQueue;if(s.updateQueue=null,x!==null)try{y==="input"&&p.type==="radio"&&p.name!=null&&bQ(u,p),J4(y,g);var C=J4(y,p);for(g=0;g<x.length;g+=2){var k=x[g],A=x[g+1];k==="style"?RQ(u,A):k==="dangerouslySetInnerHTML"?SQ(u,A):k==="children"?ES(u,A):AV(u,k,A,C)}switch(y){case"input":K4(u,p);break;case"textarea":xQ(u,p);break;case"select":var M=u._wrapperState.wasMultiple;u._wrapperState.wasMultiple=!!p.multiple;var G=p.value;G!=null?BE(u,!!p.multiple,G,!1):M!==!!p.multiple&&(p.defaultValue!=null?BE(u,!!p.multiple,p.defaultValue,!0):BE(u,!!p.multiple,p.multiple?[]:"",!1))}u[NS]=p}catch(X){vi(s,s.return,X)}}break;case 6:if(jd(n,s),Mu(s),l&4){if(s.stateNode===null)throw Error(ft(162));u=s.stateNode,p=s.memoizedProps;try{u.nodeValue=p}catch(X){vi(s,s.return,X)}}break;case 3:if(jd(n,s),Mu(s),l&4&&i!==null&&i.memoizedState.isDehydrated)try{wS(n.containerInfo)}catch(X){vi(s,s.return,X)}break;case 4:jd(n,s),Mu(s);break;case 13:jd(n,s),Mu(s),u=s.child,u.flags&8192&&(p=u.memoizedState!==null,u.stateNode.isHidden=p,!p||u.alternate!==null&&u.alternate.memoizedState!==null||(l3=ki())),l&4&&DX(s);break;case 22:if(k=i!==null&&i.memoizedState!==null,s.mode&1?(_o=(C=_o)||k,jd(n,s),_o=C):jd(n,s),Mu(s),l&8192){if(C=s.memoizedState!==null,(s.stateNode.isHidden=C)&&!k&&s.mode&1)for(zt=s,k=s.child;k!==null;){for(A=zt=k;zt!==null;){switch(M=zt,G=M.child,M.tag){case 0:case 11:case 14:case 15:sS(4,M,M.return);break;case 1:ME(M,M.return);var B=M.stateNode;if(typeof B.componentWillUnmount=="function"){l=M,i=M.return;try{n=l,B.props=n.memoizedProps,B.state=n.memoizedState,B.componentWillUnmount()}catch(X){vi(l,i,X)}}break;case 5:ME(M,M.return);break;case 22:if(M.memoizedState!==null){LX(A);continue}}G!==null?(G.return=M,zt=G):LX(A)}k=k.sibling}e:for(k=null,A=s;;){if(A.tag===5){if(k===null){k=A;try{u=A.stateNode,C?(p=u.style,typeof p.setProperty=="function"?p.setProperty("display","none","important"):p.display="none"):(y=A.stateNode,x=A.memoizedProps.style,g=x!=null&&x.hasOwnProperty("display")?x.display:null,y.style.display=TQ("display",g))}catch(X){vi(s,s.return,X)}}}else if(A.tag===6){if(k===null)try{A.stateNode.nodeValue=C?"":A.memoizedProps}catch(X){vi(s,s.return,X)}}else if((A.tag!==22&&A.tag!==23||A.memoizedState===null||A===s)&&A.child!==null){A.child.return=A,A=A.child;continue}if(A===s)break e;for(;A.sibling===null;){if(A.return===null||A.return===s)break e;k===A&&(k=null),A=A.return}k===A&&(k=null),A.sibling.return=A.return,A=A.sibling}}break;case 19:jd(n,s),Mu(s),l&4&&DX(s);break;case 21:break;default:jd(n,s),Mu(s)}}function Mu(s){var n=s.flags;if(n&2){try{e:{for(var i=s.return;i!==null;){if(JZ(i)){var l=i;break e}i=i.return}throw Error(ft(160))}switch(l.tag){case 5:var u=l.stateNode;l.flags&32&&(ES(u,""),l.flags&=-33);var p=OX(s);C5(s,p,u);break;case 3:case 4:var g=l.stateNode.containerInfo,y=OX(s);R5(s,y,g);break;default:throw Error(ft(161))}}catch(x){vi(s,s.return,x)}s.flags&=-3}n&4096&&(s.flags&=-4097)}function Oge(s,n,i){zt=s,eee(s)}function eee(s,n,i){for(var l=(s.mode&1)!==0;zt!==null;){var u=zt,p=u.child;if(u.tag===22&&l){var g=u.memoizedState!==null||LA;if(!g){var y=u.alternate,x=y!==null&&y.memoizedState!==null||_o;y=LA;var C=_o;if(LA=g,(_o=x)&&!C)for(zt=u;zt!==null;)g=zt,x=g.child,g.tag===22&&g.memoizedState!==null?jX(u):x!==null?(x.return=g,zt=x):jX(u);for(;p!==null;)zt=p,eee(p),p=p.sibling;zt=u,LA=y,_o=C}PX(s)}else u.subtreeFlags&8772&&p!==null?(p.return=u,zt=p):PX(s)}}function PX(s){for(;zt!==null;){var n=zt;if(n.flags&8772){var i=n.alternate;try{if(n.flags&8772)switch(n.tag){case 0:case 11:case 15:_o||Ck(5,n);break;case 1:var l=n.stateNode;if(n.flags&4&&!_o)if(i===null)l.componentDidMount();else{var u=n.elementType===n.type?i.memoizedProps:Ud(n.type,i.memoizedProps);l.componentDidUpdate(u,i.memoizedState,l.__reactInternalSnapshotBeforeUpdate)}var p=n.updateQueue;p!==null&&vX(n,p,l);break;case 3:var g=n.updateQueue;if(g!==null){if(i=null,n.child!==null)switch(n.child.tag){case 5:i=n.child.stateNode;break;case 1:i=n.child.stateNode}vX(n,g,i)}break;case 5:var y=n.stateNode;if(i===null&&n.flags&4){i=y;var x=n.memoizedProps;switch(n.type){case"button":case"input":case"select":case"textarea":x.autoFocus&&i.focus();break;case"img":x.src&&(i.src=x.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(n.memoizedState===null){var C=n.alternate;if(C!==null){var k=C.memoizedState;if(k!==null){var A=k.dehydrated;A!==null&&wS(A)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ft(163))}_o||n.flags&512&&T5(n)}catch(M){vi(n,n.return,M)}}if(n===s){zt=null;break}if(i=n.sibling,i!==null){i.return=n.return,zt=i;break}zt=n.return}}function LX(s){for(;zt!==null;){var n=zt;if(n===s){zt=null;break}var i=n.sibling;if(i!==null){i.return=n.return,zt=i;break}zt=n.return}}function jX(s){for(;zt!==null;){var n=zt;try{switch(n.tag){case 0:case 11:case 15:var i=n.return;try{Ck(4,n)}catch(x){vi(n,i,x)}break;case 1:var l=n.stateNode;if(typeof l.componentDidMount=="function"){var u=n.return;try{l.componentDidMount()}catch(x){vi(n,u,x)}}var p=n.return;try{T5(n)}catch(x){vi(n,p,x)}break;case 5:var g=n.return;try{T5(n)}catch(x){vi(n,g,x)}}}catch(x){vi(n,n.return,x)}if(n===s){zt=null;break}var y=n.sibling;if(y!==null){y.return=n.return,zt=y;break}zt=n.return}}var Dge=Math.ceil,M1=up.ReactCurrentDispatcher,o3=up.ReactCurrentOwner,Gl=up.ReactCurrentBatchConfig,Vr=0,Sa=null,Bi=null,Ya=0,Bc=0,UE=fm(0),na=0,PS=null,w_=0,Nk=0,c3=0,iS=null,hc=null,l3=0,iy=1/0,Fh=null,U1=!1,N5=null,$f=null,jA=!1,Ff=null,V1=0,aS=0,I5=null,i1=-1,a1=0;function Vo(){return Vr&6?ki():i1!==-1?i1:i1=ki()}function Jf(s){return s.mode&1?Vr&2&&Ya!==0?Ya&-Ya:gge.transition!==null?(a1===0&&(a1=UQ()),a1):(s=fs,s!==0||(s=window.event,s=s===void 0?16:HQ(s.type)),s):1}function Gd(s,n,i,l){if(50<aS)throw aS=0,I5=null,Error(ft(185));nT(s,i,l),(!(Vr&2)||s!==Sa)&&(s===Sa&&(!(Vr&2)&&(Nk|=i),na===4&&Pf(s,Ya)),gc(s,l),i===1&&Vr===0&&!(n.mode&1)&&(iy=ki()+500,Sk&&mm()))}function gc(s,n){var i=s.callbackNode;gme(s,n);var l=x1(s,s===Sa?Ya:0);if(l===0)i!==null&&HY(i),s.callbackNode=null,s.callbackPriority=0;else if(n=l&-l,s.callbackPriority!==n){if(i!=null&&HY(i),n===1)s.tag===0?mge(MX.bind(null,s)):dZ(MX.bind(null,s)),uge(function(){!(Vr&6)&&mm()}),i=null;else{switch(VQ(l)){case 1:i=LV;break;case 4:i=jQ;break;case 16:i=b1;break;case 536870912:i=MQ;break;default:i=b1}i=cee(i,tee.bind(null,s))}s.callbackPriority=n,s.callbackNode=i}}function tee(s,n){if(i1=-1,a1=0,Vr&6)throw Error(ft(327));var i=s.callbackNode;if(KE()&&s.callbackNode!==i)return null;var l=x1(s,s===Sa?Ya:0);if(l===0)return null;if(l&30||l&s.expiredLanes||n)n=F1(s,l);else{n=l;var u=Vr;Vr|=2;var p=ree();(Sa!==s||Ya!==n)&&(Fh=null,iy=ki()+500,m_(s,n));do try{jge();break}catch(y){nee(s,y)}while(!0);YV(),M1.current=p,Vr=u,Bi!==null?n=0:(Sa=null,Ya=0,n=na)}if(n!==0){if(n===2&&(u=n5(s),u!==0&&(l=u,n=A5(s,u))),n===1)throw i=PS,m_(s,0),Pf(s,l),gc(s,ki()),i;if(n===6)Pf(s,l);else{if(u=s.current.alternate,!(l&30)&&!Pge(u)&&(n=F1(s,l),n===2&&(p=n5(s),p!==0&&(l=p,n=A5(s,p))),n===1))throw i=PS,m_(s,0),Pf(s,l),gc(s,ki()),i;switch(s.finishedWork=u,s.finishedLanes=l,n){case 0:case 1:throw Error(ft(345));case 2:o_(s,hc,Fh);break;case 3:if(Pf(s,l),(l&130023424)===l&&(n=l3+500-ki(),10<n)){if(x1(s,0)!==0)break;if(u=s.suspendedLanes,(u&l)!==l){Vo(),s.pingedLanes|=s.suspendedLanes&u;break}s.timeoutHandle=d5(o_.bind(null,s,hc,Fh),n);break}o_(s,hc,Fh);break;case 4:if(Pf(s,l),(l&4194240)===l)break;for(n=s.eventTimes,u=-1;0<l;){var g=31-zd(l);p=1<<g,g=n[g],g>u&&(u=g),l&=~p}if(l=u,l=ki()-l,l=(120>l?120:480>l?480:1080>l?1080:1920>l?1920:3e3>l?3e3:4320>l?4320:1960*Dge(l/1960))-l,10<l){s.timeoutHandle=d5(o_.bind(null,s,hc,Fh),l);break}o_(s,hc,Fh);break;case 5:o_(s,hc,Fh);break;default:throw Error(ft(329))}}}return gc(s,ki()),s.callbackNode===i?tee.bind(null,s):null}function A5(s,n){var i=iS;return s.current.memoizedState.isDehydrated&&(m_(s,n).flags|=256),s=F1(s,n),s!==2&&(n=hc,hc=i,n!==null&&k5(n)),s}function k5(s){hc===null?hc=s:hc.push.apply(hc,s)}function Pge(s){for(var n=s;;){if(n.flags&16384){var i=n.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var l=0;l<i.length;l++){var u=i[l],p=u.getSnapshot;u=u.value;try{if(!Hd(p(),u))return!1}catch{return!1}}}if(i=n.child,n.subtreeFlags&16384&&i!==null)i.return=n,n=i;else{if(n===s)break;for(;n.sibling===null;){if(n.return===null||n.return===s)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function Pf(s,n){for(n&=~c3,n&=~Nk,s.suspendedLanes|=n,s.pingedLanes&=~n,s=s.expirationTimes;0<n;){var i=31-zd(n),l=1<<i;s[i]=-1,n&=~l}}function MX(s){if(Vr&6)throw Error(ft(327));KE();var n=x1(s,0);if(!(n&1))return gc(s,ki()),null;var i=F1(s,n);if(s.tag!==0&&i===2){var l=n5(s);l!==0&&(n=l,i=A5(s,l))}if(i===1)throw i=PS,m_(s,0),Pf(s,n),gc(s,ki()),i;if(i===6)throw Error(ft(345));return s.finishedWork=s.current.alternate,s.finishedLanes=n,o_(s,hc,Fh),gc(s,ki()),null}function d3(s,n){var i=Vr;Vr|=1;try{return s(n)}finally{Vr=i,Vr===0&&(iy=ki()+500,Sk&&mm())}}function S_(s){Ff!==null&&Ff.tag===0&&!(Vr&6)&&KE();var n=Vr;Vr|=1;var i=Gl.transition,l=fs;try{if(Gl.transition=null,fs=1,s)return s()}finally{fs=l,Gl.transition=i,Vr=n,!(Vr&6)&&mm()}}function u3(){Bc=UE.current,Vs(UE)}function m_(s,n){s.finishedWork=null,s.finishedLanes=0;var i=s.timeoutHandle;if(i!==-1&&(s.timeoutHandle=-1,dge(i)),Bi!==null)for(i=Bi.return;i!==null;){var l=i;switch(HV(l),l.tag){case 1:l=l.type.childContextTypes,l!=null&&C1();break;case 3:ry(),Vs(fc),Vs(vo),e3();break;case 5:ZV(l);break;case 4:ry();break;case 13:Vs(ai);break;case 19:Vs(ai);break;case 10:XV(l.type._context);break;case 22:case 23:u3()}i=i.return}if(Sa=s,Bi=s=Qf(s.current,null),Ya=Bc=n,na=0,PS=null,c3=Nk=w_=0,hc=iS=null,u_!==null){for(n=0;n<u_.length;n++)if(i=u_[n],l=i.interleaved,l!==null){i.interleaved=null;var u=l.next,p=i.pending;if(p!==null){var g=p.next;p.next=u,l.next=g}i.pending=l}u_=null}return s}function nee(s,n){do{var i=Bi;try{if(YV(),n1.current=j1,L1){for(var l=oi.memoizedState;l!==null;){var u=l.queue;u!==null&&(u.pending=null),l=l.next}L1=!1}if(x_=0,ba=ea=oi=null,rS=!1,kS=0,o3.current=null,i===null||i.return===null){na=1,PS=n,Bi=null;break}e:{var p=s,g=i.return,y=i,x=n;if(n=Ya,y.flags|=32768,x!==null&&typeof x=="object"&&typeof x.then=="function"){var C=x,k=y,A=k.tag;if(!(k.mode&1)&&(A===0||A===11||A===15)){var M=k.alternate;M?(k.updateQueue=M.updateQueue,k.memoizedState=M.memoizedState,k.lanes=M.lanes):(k.updateQueue=null,k.memoizedState=null)}var G=SX(g);if(G!==null){G.flags&=-257,TX(G,g,y,p,n),G.mode&1&&wX(p,C,n),n=G,x=C;var B=n.updateQueue;if(B===null){var X=new Set;X.add(x),n.updateQueue=X}else B.add(x);break e}else{if(!(n&1)){wX(p,C,n),h3();break e}x=Error(ft(426))}}else if(Zs&&y.mode&1){var Z=SX(g);if(Z!==null){!(Z.flags&65536)&&(Z.flags|=256),TX(Z,g,y,p,n),KV(sy(x,y));break e}}p=x=sy(x,y),na!==4&&(na=2),iS===null?iS=[p]:iS.push(p),p=g;do{switch(p.tag){case 3:p.flags|=65536,n&=-n,p.lanes|=n;var q=VZ(p,x,n);_X(p,q);break e;case 1:y=x;var V=p.type,ee=p.stateNode;if(!(p.flags&128)&&(typeof V.getDerivedStateFromError=="function"||ee!==null&&typeof ee.componentDidCatch=="function"&&($f===null||!$f.has(ee)))){p.flags|=65536,n&=-n,p.lanes|=n;var de=FZ(p,y,n);_X(p,de);break e}}p=p.return}while(p!==null)}iee(i)}catch(ae){n=ae,Bi===i&&i!==null&&(Bi=i=i.return);continue}break}while(!0)}function ree(){var s=M1.current;return M1.current=j1,s===null?j1:s}function h3(){(na===0||na===3||na===2)&&(na=4),Sa===null||!(w_&268435455)&&!(Nk&268435455)||Pf(Sa,Ya)}function F1(s,n){var i=Vr;Vr|=2;var l=ree();(Sa!==s||Ya!==n)&&(Fh=null,m_(s,n));do try{Lge();break}catch(u){nee(s,u)}while(!0);if(YV(),Vr=i,M1.current=l,Bi!==null)throw Error(ft(261));return Sa=null,Ya=0,na}function Lge(){for(;Bi!==null;)see(Bi)}function jge(){for(;Bi!==null&&!ome();)see(Bi)}function see(s){var n=oee(s.alternate,s,Bc);s.memoizedProps=s.pendingProps,n===null?iee(s):Bi=n,o3.current=null}function iee(s){var n=s;do{var i=n.alternate;if(s=n.return,n.flags&32768){if(i=Ige(i,n),i!==null){i.flags&=32767,Bi=i;return}if(s!==null)s.flags|=32768,s.subtreeFlags=0,s.deletions=null;else{na=6,Bi=null;return}}else if(i=Nge(i,n,Bc),i!==null){Bi=i;return}if(n=n.sibling,n!==null){Bi=n;return}Bi=n=s}while(n!==null);na===0&&(na=5)}function o_(s,n,i){var l=fs,u=Gl.transition;try{Gl.transition=null,fs=1,Mge(s,n,i,l)}finally{Gl.transition=u,fs=l}return null}function Mge(s,n,i,l){do KE();while(Ff!==null);if(Vr&6)throw Error(ft(327));i=s.finishedWork;var u=s.finishedLanes;if(i===null)return null;if(s.finishedWork=null,s.finishedLanes=0,i===s.current)throw Error(ft(177));s.callbackNode=null,s.callbackPriority=0;var p=i.lanes|i.childLanes;if(_me(s,p),s===Sa&&(Bi=Sa=null,Ya=0),!(i.subtreeFlags&2064)&&!(i.flags&2064)||jA||(jA=!0,cee(b1,function(){return KE(),null})),p=(i.flags&15990)!==0,i.subtreeFlags&15990||p){p=Gl.transition,Gl.transition=null;var g=fs;fs=1;var y=Vr;Vr|=4,o3.current=null,kge(s,i),ZZ(i,s),rge(c5),w1=!!o5,c5=o5=null,s.current=i,Oge(i),cme(),Vr=y,fs=g,Gl.transition=p}else s.current=i;if(jA&&(jA=!1,Ff=s,V1=u),p=s.pendingLanes,p===0&&($f=null),ume(i.stateNode),gc(s,ki()),n!==null)for(l=s.onRecoverableError,i=0;i<n.length;i++)u=n[i],l(u.value,{componentStack:u.stack,digest:u.digest});if(U1)throw U1=!1,s=N5,N5=null,s;return V1&1&&s.tag!==0&&KE(),p=s.pendingLanes,p&1?s===I5?aS++:(aS=0,I5=s):aS=0,mm(),null}function KE(){if(Ff!==null){var s=VQ(V1),n=Gl.transition,i=fs;try{if(Gl.transition=null,fs=16>s?16:s,Ff===null)var l=!1;else{if(s=Ff,Ff=null,V1=0,Vr&6)throw Error(ft(331));var u=Vr;for(Vr|=4,zt=s.current;zt!==null;){var p=zt,g=p.child;if(zt.flags&16){var y=p.deletions;if(y!==null){for(var x=0;x<y.length;x++){var C=y[x];for(zt=C;zt!==null;){var k=zt;switch(k.tag){case 0:case 11:case 15:sS(8,k,p)}var A=k.child;if(A!==null)A.return=k,zt=A;else for(;zt!==null;){k=zt;var M=k.sibling,G=k.return;if($Z(k),k===C){zt=null;break}if(M!==null){M.return=G,zt=M;break}zt=G}}}var B=p.alternate;if(B!==null){var X=B.child;if(X!==null){B.child=null;do{var Z=X.sibling;X.sibling=null,X=Z}while(X!==null)}}zt=p}}if(p.subtreeFlags&2064&&g!==null)g.return=p,zt=g;else e:for(;zt!==null;){if(p=zt,p.flags&2048)switch(p.tag){case 0:case 11:case 15:sS(9,p,p.return)}var q=p.sibling;if(q!==null){q.return=p.return,zt=q;break e}zt=p.return}}var V=s.current;for(zt=V;zt!==null;){g=zt;var ee=g.child;if(g.subtreeFlags&2064&&ee!==null)ee.return=g,zt=ee;else e:for(g=V;zt!==null;){if(y=zt,y.flags&2048)try{switch(y.tag){case 0:case 11:case 15:Ck(9,y)}}catch(ae){vi(y,y.return,ae)}if(y===g){zt=null;break e}var de=y.sibling;if(de!==null){de.return=y.return,zt=de;break e}zt=y.return}}if(Vr=u,mm(),Wu&&typeof Wu.onPostCommitFiberRoot=="function")try{Wu.onPostCommitFiberRoot(Ek,s)}catch{}l=!0}return l}finally{fs=i,Gl.transition=n}}return!1}function UX(s,n,i){n=sy(i,n),n=VZ(s,n,1),s=Xf(s,n,1),n=Vo(),s!==null&&(nT(s,1,n),gc(s,n))}function vi(s,n,i){if(s.tag===3)UX(s,s,i);else for(;n!==null;){if(n.tag===3){UX(n,s,i);break}else if(n.tag===1){var l=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&($f===null||!$f.has(l))){s=sy(i,s),s=FZ(n,s,1),n=Xf(n,s,1),s=Vo(),n!==null&&(nT(n,1,s),gc(n,s));break}}n=n.return}}function Uge(s,n,i){var l=s.pingCache;l!==null&&l.delete(n),n=Vo(),s.pingedLanes|=s.suspendedLanes&i,Sa===s&&(Ya&i)===i&&(na===4||na===3&&(Ya&130023424)===Ya&&500>ki()-l3?m_(s,0):c3|=i),gc(s,n)}function aee(s,n){n===0&&(s.mode&1?(n=RA,RA<<=1,!(RA&130023424)&&(RA=4194304)):n=1);var i=Vo();s=ip(s,n),s!==null&&(nT(s,n,i),gc(s,i))}function Vge(s){var n=s.memoizedState,i=0;n!==null&&(i=n.retryLane),aee(s,i)}function Fge(s,n){var i=0;switch(s.tag){case 13:var l=s.stateNode,u=s.memoizedState;u!==null&&(i=u.retryLane);break;case 19:l=s.stateNode;break;default:throw Error(ft(314))}l!==null&&l.delete(n),aee(s,i)}var oee;oee=function(s,n,i){if(s!==null)if(s.memoizedProps!==n.pendingProps||fc.current)pc=!0;else{if(!(s.lanes&i)&&!(n.flags&128))return pc=!1,Cge(s,n,i);pc=!!(s.flags&131072)}else pc=!1,Zs&&n.flags&1048576&&uZ(n,A1,n.index);switch(n.lanes=0,n.tag){case 2:var l=n.type;s1(s,n),s=n.pendingProps;var u=ey(n,vo.current);HE(n,i),u=n3(null,n,l,s,u,i);var p=r3();return n.flags|=1,typeof u=="object"&&u!==null&&typeof u.render=="function"&&u.$$typeof===void 0?(n.tag=1,n.memoizedState=null,n.updateQueue=null,mc(l)?(p=!0,N1(n)):p=!1,n.memoizedState=u.state!==null&&u.state!==void 0?u.state:null,JV(n),u.updater=Rk,n.stateNode=u,u._reactInternals=n,_5(n,l,s,i),n=y5(null,n,l,!0,p,i)):(n.tag=0,Zs&&p&&WV(n),jo(null,n,u,i),n=n.child),n;case 16:l=n.elementType;e:{switch(s1(s,n),s=n.pendingProps,u=l._init,l=u(l._payload),n.type=l,u=n.tag=zge(l),s=Ud(l,s),u){case 0:n=E5(null,n,l,s,i);break e;case 1:n=NX(null,n,l,s,i);break e;case 11:n=RX(null,n,l,s,i);break e;case 14:n=CX(null,n,l,Ud(l.type,s),i);break e}throw Error(ft(306,l,""))}return n;case 0:return l=n.type,u=n.pendingProps,u=n.elementType===l?u:Ud(l,u),E5(s,n,l,u,i);case 1:return l=n.type,u=n.pendingProps,u=n.elementType===l?u:Ud(l,u),NX(s,n,l,u,i);case 3:e:{if(WZ(n),s===null)throw Error(ft(387));l=n.pendingProps,p=n.memoizedState,u=p.element,_Z(s,n),D1(n,l,null,i);var g=n.memoizedState;if(l=g.element,p.isDehydrated)if(p={element:l,isDehydrated:!1,cache:g.cache,pendingSuspenseBoundaries:g.pendingSuspenseBoundaries,transitions:g.transitions},n.updateQueue.baseState=p,n.memoizedState=p,n.flags&256){u=sy(Error(ft(423)),n),n=IX(s,n,l,i,u);break e}else if(l!==u){u=sy(Error(ft(424)),n),n=IX(s,n,l,i,u);break e}else for(Gc=Yf(n.stateNode.containerInfo.firstChild),qc=n,Zs=!0,Fd=null,i=mZ(n,null,l,i),n.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(ty(),l===u){n=ap(s,n,i);break e}jo(s,n,l,i)}n=n.child}return n;case 5:return vZ(n),s===null&&f5(n),l=n.type,u=n.pendingProps,p=s!==null?s.memoizedProps:null,g=u.children,l5(l,u)?g=null:p!==null&&l5(l,p)&&(n.flags|=32),GZ(s,n),jo(s,n,g,i),n.child;case 6:return s===null&&f5(n),null;case 13:return HZ(s,n,i);case 4:return QV(n,n.stateNode.containerInfo),l=n.pendingProps,s===null?n.child=ny(n,null,l,i):jo(s,n,l,i),n.child;case 11:return l=n.type,u=n.pendingProps,u=n.elementType===l?u:Ud(l,u),RX(s,n,l,u,i);case 7:return jo(s,n,n.pendingProps,i),n.child;case 8:return jo(s,n,n.pendingProps.children,i),n.child;case 12:return jo(s,n,n.pendingProps.children,i),n.child;case 10:e:{if(l=n.type._context,u=n.pendingProps,p=n.memoizedProps,g=u.value,ks(k1,l._currentValue),l._currentValue=g,p!==null)if(Hd(p.value,g)){if(p.children===u.children&&!fc.current){n=ap(s,n,i);break e}}else for(p=n.child,p!==null&&(p.return=n);p!==null;){var y=p.dependencies;if(y!==null){g=p.child;for(var x=y.firstContext;x!==null;){if(x.context===l){if(p.tag===1){x=Qh(-1,i&-i),x.tag=2;var C=p.updateQueue;if(C!==null){C=C.shared;var k=C.pending;k===null?x.next=x:(x.next=k.next,k.next=x),C.pending=x}}p.lanes|=i,x=p.alternate,x!==null&&(x.lanes|=i),m5(p.return,i,n),y.lanes|=i;break}x=x.next}}else if(p.tag===10)g=p.type===n.type?null:p.child;else if(p.tag===18){if(g=p.return,g===null)throw Error(ft(341));g.lanes|=i,y=g.alternate,y!==null&&(y.lanes|=i),m5(g,i,n),g=p.sibling}else g=p.child;if(g!==null)g.return=p;else for(g=p;g!==null;){if(g===n){g=null;break}if(p=g.sibling,p!==null){p.return=g.return,g=p;break}g=g.return}p=g}jo(s,n,u.children,i),n=n.child}return n;case 9:return u=n.type,l=n.pendingProps.children,HE(n,i),u=Hl(u),l=l(u),n.flags|=1,jo(s,n,l,i),n.child;case 14:return l=n.type,u=Ud(l,n.pendingProps),u=Ud(l.type,u),CX(s,n,l,u,i);case 15:return BZ(s,n,n.type,n.pendingProps,i);case 17:return l=n.type,u=n.pendingProps,u=n.elementType===l?u:Ud(l,u),s1(s,n),n.tag=1,mc(l)?(s=!0,N1(n)):s=!1,HE(n,i),UZ(n,l,u),_5(n,l,u,i),y5(null,n,l,!0,s,i);case 19:return KZ(s,n,i);case 22:return zZ(s,n,i)}throw Error(ft(156,n.tag))};function cee(s,n){return LQ(s,n)}function Bge(s,n,i,l){this.tag=s,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zl(s,n,i,l){return new Bge(s,n,i,l)}function p3(s){return s=s.prototype,!(!s||!s.isReactComponent)}function zge(s){if(typeof s=="function")return p3(s)?1:0;if(s!=null){if(s=s.$$typeof,s===OV)return 11;if(s===DV)return 14}return 2}function Qf(s,n){var i=s.alternate;return i===null?(i=zl(s.tag,n,s.key,s.mode),i.elementType=s.elementType,i.type=s.type,i.stateNode=s.stateNode,i.alternate=s,s.alternate=i):(i.pendingProps=n,i.type=s.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=s.flags&14680064,i.childLanes=s.childLanes,i.lanes=s.lanes,i.child=s.child,i.memoizedProps=s.memoizedProps,i.memoizedState=s.memoizedState,i.updateQueue=s.updateQueue,n=s.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},i.sibling=s.sibling,i.index=s.index,i.ref=s.ref,i}function o1(s,n,i,l,u,p){var g=2;if(l=s,typeof s=="function")p3(s)&&(g=1);else if(typeof s=="string")g=5;else e:switch(s){case NE:return g_(i.children,u,p,n);case kV:g=8,u|=8;break;case B4:return s=zl(12,i,n,u|2),s.elementType=B4,s.lanes=p,s;case z4:return s=zl(13,i,n,u),s.elementType=z4,s.lanes=p,s;case G4:return s=zl(19,i,n,u),s.elementType=G4,s.lanes=p,s;case vQ:return Ik(i,u,p,n);default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case gQ:g=10;break e;case _Q:g=9;break e;case OV:g=11;break e;case DV:g=14;break e;case kf:g=16,l=null;break e}throw Error(ft(130,s==null?s:typeof s,""))}return n=zl(g,i,n,u),n.elementType=s,n.type=l,n.lanes=p,n}function g_(s,n,i,l){return s=zl(7,s,l,n),s.lanes=i,s}function Ik(s,n,i,l){return s=zl(22,s,l,n),s.elementType=vQ,s.lanes=i,s.stateNode={isHidden:!1},s}function d4(s,n,i){return s=zl(6,s,null,n),s.lanes=i,s}function u4(s,n,i){return n=zl(4,s.children!==null?s.children:[],s.key,n),n.lanes=i,n.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},n}function Gge(s,n,i,l,u){this.tag=n,this.containerInfo=s,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=HU(0),this.expirationTimes=HU(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=HU(0),this.identifierPrefix=l,this.onRecoverableError=u,this.mutableSourceEagerHydrationData=null}function f3(s,n,i,l,u,p,g,y,x){return s=new Gge(s,n,i,y,x),n===1?(n=1,p===!0&&(n|=8)):n=0,p=zl(3,null,null,n),s.current=p,p.stateNode=s,p.memoizedState={element:l,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},JV(p),s}function Wge(s,n,i){var l=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:CE,key:l==null?null:""+l,children:s,containerInfo:n,implementation:i}}function lee(s){if(!s)return cm;s=s._reactInternals;e:{if(L_(s)!==s||s.tag!==1)throw Error(ft(170));var n=s;do{switch(n.tag){case 3:n=n.stateNode.context;break e;case 1:if(mc(n.type)){n=n.stateNode.__reactInternalMemoizedMergedChildContext;break e}}n=n.return}while(n!==null);throw Error(ft(171))}if(s.tag===1){var i=s.type;if(mc(i))return lZ(s,i,n)}return n}function dee(s,n,i,l,u,p,g,y,x){return s=f3(i,l,!0,s,u,p,g,y,x),s.context=lee(null),i=s.current,l=Vo(),u=Jf(i),p=Qh(l,u),p.callback=n??null,Xf(i,p,u),s.current.lanes=u,nT(s,u,l),gc(s,l),s}function Ak(s,n,i,l){var u=n.current,p=Vo(),g=Jf(u);return i=lee(i),n.context===null?n.context=i:n.pendingContext=i,n=Qh(p,g),n.payload={element:s},l=l===void 0?null:l,l!==null&&(n.callback=l),s=Xf(u,n,g),s!==null&&(Gd(s,u,g,p),t1(s,u,g)),g}function B1(s){if(s=s.current,!s.child)return null;switch(s.child.tag){case 5:return s.child.stateNode;default:return s.child.stateNode}}function VX(s,n){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var i=s.retryLane;s.retryLane=i!==0&&i<n?i:n}}function m3(s,n){VX(s,n),(s=s.alternate)&&VX(s,n)}function Hge(){return null}var uee=typeof reportError=="function"?reportError:function(s){console.error(s)};function g3(s){this._internalRoot=s}kk.prototype.render=g3.prototype.render=function(s){var n=this._internalRoot;if(n===null)throw Error(ft(409));Ak(s,n,null,null)};kk.prototype.unmount=g3.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var n=s.containerInfo;S_(function(){Ak(null,s,null,null)}),n[sp]=null}};function kk(s){this._internalRoot=s}kk.prototype.unstable_scheduleHydration=function(s){if(s){var n=zQ();s={blockedOn:null,target:s,priority:n};for(var i=0;i<Df.length&&n!==0&&n<Df[i].priority;i++);Df.splice(i,0,s),i===0&&WQ(s)}};function _3(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function Ok(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11&&(s.nodeType!==8||s.nodeValue!==" react-mount-point-unstable "))}function FX(){}function Kge(s,n,i,l,u){if(u){if(typeof l=="function"){var p=l;l=function(){var C=B1(g);p.call(C)}}var g=dee(n,l,s,0,null,!1,!1,"",FX);return s._reactRootContainer=g,s[sp]=g.current,RS(s.nodeType===8?s.parentNode:s),S_(),g}for(;u=s.lastChild;)s.removeChild(u);if(typeof l=="function"){var y=l;l=function(){var C=B1(x);y.call(C)}}var x=f3(s,0,!1,null,null,!1,!1,"",FX);return s._reactRootContainer=x,s[sp]=x.current,RS(s.nodeType===8?s.parentNode:s),S_(function(){Ak(n,x,i,l)}),x}function Dk(s,n,i,l,u){var p=i._reactRootContainer;if(p){var g=p;if(typeof u=="function"){var y=u;u=function(){var x=B1(g);y.call(x)}}Ak(n,g,s,u)}else g=Kge(i,n,s,u,l);return B1(g)}FQ=function(s){switch(s.tag){case 3:var n=s.stateNode;if(n.current.memoizedState.isDehydrated){var i=Gw(n.pendingLanes);i!==0&&(jV(n,i|1),gc(n,ki()),!(Vr&6)&&(iy=ki()+500,mm()))}break;case 13:S_(function(){var l=ip(s,1);if(l!==null){var u=Vo();Gd(l,s,1,u)}}),m3(s,1)}};MV=function(s){if(s.tag===13){var n=ip(s,134217728);if(n!==null){var i=Vo();Gd(n,s,134217728,i)}m3(s,134217728)}};BQ=function(s){if(s.tag===13){var n=Jf(s),i=ip(s,n);if(i!==null){var l=Vo();Gd(i,s,n,l)}m3(s,n)}};zQ=function(){return fs};GQ=function(s,n){var i=fs;try{return fs=s,n()}finally{fs=i}};Z4=function(s,n,i){switch(n){case"input":if(K4(s,i),n=i.name,i.type==="radio"&&n!=null){for(i=s;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+n)+'][type="radio"]'),n=0;n<i.length;n++){var l=i[n];if(l!==s&&l.form===s.form){var u=wk(l);if(!u)throw Error(ft(90));yQ(l),K4(l,u)}}}break;case"textarea":xQ(s,i);break;case"select":n=i.value,n!=null&&BE(s,!!i.multiple,n,!1)}};IQ=d3;AQ=S_;var qge={usingClientEntryPoint:!1,Events:[sT,OE,wk,CQ,NQ,d3]},jw={findFiberByHostInstance:d_,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Yge={bundleType:jw.bundleType,version:jw.version,rendererPackageName:jw.rendererPackageName,rendererConfig:jw.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:up.ReactCurrentDispatcher,findHostInstanceByFiber:function(s){return s=DQ(s),s===null?null:s.stateNode},findFiberByHostInstance:jw.findFiberByHostInstance||Hge,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var MA=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!MA.isDisabled&&MA.supportsFiber)try{Ek=MA.inject(Yge),Wu=MA}catch{}}Zc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=qge;Zc.createPortal=function(s,n){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!_3(n))throw Error(ft(200));return Wge(s,n,null,i)};Zc.createRoot=function(s,n){if(!_3(s))throw Error(ft(299));var i=!1,l="",u=uee;return n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(l=n.identifierPrefix),n.onRecoverableError!==void 0&&(u=n.onRecoverableError)),n=f3(s,1,!1,null,null,i,!1,l,u),s[sp]=n.current,RS(s.nodeType===8?s.parentNode:s),new g3(n)};Zc.findDOMNode=function(s){if(s==null)return null;if(s.nodeType===1)return s;var n=s._reactInternals;if(n===void 0)throw typeof s.render=="function"?Error(ft(188)):(s=Object.keys(s).join(","),Error(ft(268,s)));return s=DQ(n),s=s===null?null:s.stateNode,s};Zc.flushSync=function(s){return S_(s)};Zc.hydrate=function(s,n,i){if(!Ok(n))throw Error(ft(200));return Dk(null,s,n,!0,i)};Zc.hydrateRoot=function(s,n,i){if(!_3(s))throw Error(ft(405));var l=i!=null&&i.hydratedSources||null,u=!1,p="",g=uee;if(i!=null&&(i.unstable_strictMode===!0&&(u=!0),i.identifierPrefix!==void 0&&(p=i.identifierPrefix),i.onRecoverableError!==void 0&&(g=i.onRecoverableError)),n=dee(n,null,s,1,i??null,u,!1,p,g),s[sp]=n.current,RS(s),l)for(s=0;s<l.length;s++)i=l[s],u=i._getVersion,u=u(i._source),n.mutableSourceEagerHydrationData==null?n.mutableSourceEagerHydrationData=[i,u]:n.mutableSourceEagerHydrationData.push(i,u);return new kk(n)};Zc.render=function(s,n,i){if(!Ok(n))throw Error(ft(200));return Dk(null,s,n,!1,i)};Zc.unmountComponentAtNode=function(s){if(!Ok(s))throw Error(ft(40));return s._reactRootContainer?(S_(function(){Dk(null,null,s,!1,function(){s._reactRootContainer=null,s[sp]=null})}),!0):!1};Zc.unstable_batchedUpdates=d3;Zc.unstable_renderSubtreeIntoContainer=function(s,n,i,l){if(!Ok(i))throw Error(ft(200));if(s==null||s._reactInternals===void 0)throw Error(ft(38));return Dk(s,n,i,!1,l)};Zc.version="18.3.1-next-f1338f8080-20240426";function hee(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(hee)}catch(s){console.error(s)}}hee(),hQ.exports=Zc;var Xge=hQ.exports,BX=Xge;V4.createRoot=BX.createRoot,V4.hydrateRoot=BX.hydrateRoot;/**
 * @remix-run/router v1.23.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function LS(){return LS=Object.assign?Object.assign.bind():function(s){for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(s[l]=i[l])}return s},LS.apply(this,arguments)}var Bf;(function(s){s.Pop="POP",s.Push="PUSH",s.Replace="REPLACE"})(Bf||(Bf={}));const zX="popstate";function $ge(s){s===void 0&&(s={});function n(l,u){let{pathname:p,search:g,hash:y}=l.location;return O5("",{pathname:p,search:g,hash:y},u.state&&u.state.usr||null,u.state&&u.state.key||"default")}function i(l,u){return typeof u=="string"?u:z1(u)}return Qge(n,i,null,s)}function ci(s,n){if(s===!1||s===null||typeof s>"u")throw new Error(n)}function v3(s,n){if(!s){typeof console<"u"&&console.warn(n);try{throw new Error(n)}catch{}}}function Jge(){return Math.random().toString(36).substr(2,8)}function GX(s,n){return{usr:s.state,key:s.key,idx:n}}function O5(s,n,i,l){return i===void 0&&(i=null),LS({pathname:typeof s=="string"?s:s.pathname,search:"",hash:""},typeof n=="string"?Ny(n):n,{state:i,key:n&&n.key||l||Jge()})}function z1(s){let{pathname:n="/",search:i="",hash:l=""}=s;return i&&i!=="?"&&(n+=i.charAt(0)==="?"?i:"?"+i),l&&l!=="#"&&(n+=l.charAt(0)==="#"?l:"#"+l),n}function Ny(s){let n={};if(s){let i=s.indexOf("#");i>=0&&(n.hash=s.substr(i),s=s.substr(0,i));let l=s.indexOf("?");l>=0&&(n.search=s.substr(l),s=s.substr(0,l)),s&&(n.pathname=s)}return n}function Qge(s,n,i,l){l===void 0&&(l={});let{window:u=document.defaultView,v5Compat:p=!1}=l,g=u.history,y=Bf.Pop,x=null,C=k();C==null&&(C=0,g.replaceState(LS({},g.state,{idx:C}),""));function k(){return(g.state||{idx:null}).idx}function A(){y=Bf.Pop;let Z=k(),q=Z==null?null:Z-C;C=Z,x&&x({action:y,location:X.location,delta:q})}function M(Z,q){y=Bf.Push;let V=O5(X.location,Z,q);C=k()+1;let ee=GX(V,C),de=X.createHref(V);try{g.pushState(ee,"",de)}catch(ae){if(ae instanceof DOMException&&ae.name==="DataCloneError")throw ae;u.location.assign(de)}p&&x&&x({action:y,location:X.location,delta:1})}function G(Z,q){y=Bf.Replace;let V=O5(X.location,Z,q);C=k();let ee=GX(V,C),de=X.createHref(V);g.replaceState(ee,"",de),p&&x&&x({action:y,location:X.location,delta:0})}function B(Z){let q=u.location.origin!=="null"?u.location.origin:u.location.href,V=typeof Z=="string"?Z:z1(Z);return V=V.replace(/ $/,"%20"),ci(q,"No window.location.(origin|href) available to create URL for href: "+V),new URL(V,q)}let X={get action(){return y},get location(){return s(u,g)},listen(Z){if(x)throw new Error("A history only accepts one active listener");return u.addEventListener(zX,A),x=Z,()=>{u.removeEventListener(zX,A),x=null}},createHref(Z){return n(u,Z)},createURL:B,encodeLocation(Z){let q=B(Z);return{pathname:q.pathname,search:q.search,hash:q.hash}},push:M,replace:G,go(Z){return g.go(Z)}};return X}var WX;(function(s){s.data="data",s.deferred="deferred",s.redirect="redirect",s.error="error"})(WX||(WX={}));function Zge(s,n,i){return i===void 0&&(i="/"),e_e(s,n,i)}function e_e(s,n,i,l){let u=typeof n=="string"?Ny(n):n,p=ay(u.pathname||"/",i);if(p==null)return null;let g=pee(s);t_e(g);let y=null;for(let x=0;y==null&&x<g.length;++x){let C=h_e(p);y=d_e(g[x],C)}return y}function pee(s,n,i,l){n===void 0&&(n=[]),i===void 0&&(i=[]),l===void 0&&(l="");let u=(p,g,y)=>{let x={relativePath:y===void 0?p.path||"":y,caseSensitive:p.caseSensitive===!0,childrenIndex:g,route:p};x.relativePath.startsWith("/")&&(ci(x.relativePath.startsWith(l),'Absolute route path "'+x.relativePath+'" nested under path '+('"'+l+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),x.relativePath=x.relativePath.slice(l.length));let C=Zf([l,x.relativePath]),k=i.concat(x);p.children&&p.children.length>0&&(ci(p.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+C+'".')),pee(p.children,n,k,C)),!(p.path==null&&!p.index)&&n.push({path:C,score:c_e(C,p.index),routesMeta:k})};return s.forEach((p,g)=>{var y;if(p.path===""||!((y=p.path)!=null&&y.includes("?")))u(p,g);else for(let x of fee(p.path))u(p,g,x)}),n}function fee(s){let n=s.split("/");if(n.length===0)return[];let[i,...l]=n,u=i.endsWith("?"),p=i.replace(/\?$/,"");if(l.length===0)return u?[p,""]:[p];let g=fee(l.join("/")),y=[];return y.push(...g.map(x=>x===""?p:[p,x].join("/"))),u&&y.push(...g),y.map(x=>s.startsWith("/")&&x===""?"/":x)}function t_e(s){s.sort((n,i)=>n.score!==i.score?i.score-n.score:l_e(n.routesMeta.map(l=>l.childrenIndex),i.routesMeta.map(l=>l.childrenIndex)))}const n_e=/^:[\w-]+$/,r_e=3,s_e=2,i_e=1,a_e=10,o_e=-2,HX=s=>s==="*";function c_e(s,n){let i=s.split("/"),l=i.length;return i.some(HX)&&(l+=o_e),n&&(l+=s_e),i.filter(u=>!HX(u)).reduce((u,p)=>u+(n_e.test(p)?r_e:p===""?i_e:a_e),l)}function l_e(s,n){return s.length===n.length&&s.slice(0,-1).every((l,u)=>l===n[u])?s[s.length-1]-n[n.length-1]:0}function d_e(s,n,i){let{routesMeta:l}=s,u={},p="/",g=[];for(let y=0;y<l.length;++y){let x=l[y],C=y===l.length-1,k=p==="/"?n:n.slice(p.length)||"/",A=D5({path:x.relativePath,caseSensitive:x.caseSensitive,end:C},k),M=x.route;if(!A)return null;Object.assign(u,A.params),g.push({params:u,pathname:Zf([p,A.pathname]),pathnameBase:__e(Zf([p,A.pathnameBase])),route:M}),A.pathnameBase!=="/"&&(p=Zf([p,A.pathnameBase]))}return g}function D5(s,n){typeof s=="string"&&(s={path:s,caseSensitive:!1,end:!0});let[i,l]=u_e(s.path,s.caseSensitive,s.end),u=n.match(i);if(!u)return null;let p=u[0],g=p.replace(/(.)\/+$/,"$1"),y=u.slice(1);return{params:l.reduce((C,k,A)=>{let{paramName:M,isOptional:G}=k;if(M==="*"){let X=y[A]||"";g=p.slice(0,p.length-X.length).replace(/(.)\/+$/,"$1")}const B=y[A];return G&&!B?C[M]=void 0:C[M]=(B||"").replace(/%2F/g,"/"),C},{}),pathname:p,pathnameBase:g,pattern:s}}function u_e(s,n,i){n===void 0&&(n=!1),i===void 0&&(i=!0),v3(s==="*"||!s.endsWith("*")||s.endsWith("/*"),'Route path "'+s+'" will be treated as if it were '+('"'+s.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+s.replace(/\*$/,"/*")+'".'));let l=[],u="^"+s.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(g,y,x)=>(l.push({paramName:y,isOptional:x!=null}),x?"/?([^\\/]+)?":"/([^\\/]+)"));return s.endsWith("*")?(l.push({paramName:"*"}),u+=s==="*"||s==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?u+="\\/*$":s!==""&&s!=="/"&&(u+="(?:(?=\\/|$))"),[new RegExp(u,n?void 0:"i"),l]}function h_e(s){try{return s.split("/").map(n=>decodeURIComponent(n).replace(/\//g,"%2F")).join("/")}catch(n){return v3(!1,'The URL path "'+s+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+n+").")),s}}function ay(s,n){if(n==="/")return s;if(!s.toLowerCase().startsWith(n.toLowerCase()))return null;let i=n.endsWith("/")?n.length-1:n.length,l=s.charAt(i);return l&&l!=="/"?null:s.slice(i)||"/"}const p_e=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,f_e=s=>p_e.test(s);function m_e(s,n){n===void 0&&(n="/");let{pathname:i,search:l="",hash:u=""}=typeof s=="string"?Ny(s):s,p;if(i)if(f_e(i))p=i;else{if(i.includes("//")){let g=i;i=i.replace(/\/\/+/g,"/"),v3(!1,"Pathnames cannot have embedded double slashes - normalizing "+(g+" -> "+i))}i.startsWith("/")?p=KX(i.substring(1),"/"):p=KX(i,n)}else p=n;return{pathname:p,search:v_e(l),hash:E_e(u)}}function KX(s,n){let i=n.replace(/\/+$/,"").split("/");return s.split("/").forEach(u=>{u===".."?i.length>1&&i.pop():u!=="."&&i.push(u)}),i.length>1?i.join("/"):"/"}function h4(s,n,i,l){return"Cannot include a '"+s+"' character in a manually specified "+("`to."+n+"` field ["+JSON.stringify(l)+"].  Please separate it out to the ")+("`to."+i+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function g_e(s){return s.filter((n,i)=>i===0||n.route.path&&n.route.path.length>0)}function E3(s,n){let i=g_e(s);return n?i.map((l,u)=>u===i.length-1?l.pathname:l.pathnameBase):i.map(l=>l.pathnameBase)}function y3(s,n,i,l){l===void 0&&(l=!1);let u;typeof s=="string"?u=Ny(s):(u=LS({},s),ci(!u.pathname||!u.pathname.includes("?"),h4("?","pathname","search",u)),ci(!u.pathname||!u.pathname.includes("#"),h4("#","pathname","hash",u)),ci(!u.search||!u.search.includes("#"),h4("#","search","hash",u)));let p=s===""||u.pathname==="",g=p?"/":u.pathname,y;if(g==null)y=i;else{let A=n.length-1;if(!l&&g.startsWith("..")){let M=g.split("/");for(;M[0]==="..";)M.shift(),A-=1;u.pathname=M.join("/")}y=A>=0?n[A]:"/"}let x=m_e(u,y),C=g&&g!=="/"&&g.endsWith("/"),k=(p||g===".")&&i.endsWith("/");return!x.pathname.endsWith("/")&&(C||k)&&(x.pathname+="/"),x}const Zf=s=>s.join("/").replace(/\/\/+/g,"/"),__e=s=>s.replace(/\/+$/,"").replace(/^\/*/,"/"),v_e=s=>!s||s==="?"?"":s.startsWith("?")?s:"?"+s,E_e=s=>!s||s==="#"?"":s.startsWith("#")?s:"#"+s;function y_e(s){return s!=null&&typeof s.status=="number"&&typeof s.statusText=="string"&&typeof s.internal=="boolean"&&"data"in s}const mee=["post","put","patch","delete"];new Set(mee);const b_e=["get",...mee];new Set(b_e);/**
 * React Router v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function jS(){return jS=Object.assign?Object.assign.bind():function(s){for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(s[l]=i[l])}return s},jS.apply(this,arguments)}const Pk=H.createContext(null),gee=H.createContext(null),hp=H.createContext(null),Lk=H.createContext(null),pp=H.createContext({outlet:null,matches:[],isDataRoute:!1}),_ee=H.createContext(null);function x_e(s,n){let{relative:i}=n===void 0?{}:n;Iy()||ci(!1);let{basename:l,navigator:u}=H.useContext(hp),{hash:p,pathname:g,search:y}=jk(s,{relative:i}),x=g;return l!=="/"&&(x=g==="/"?l:Zf([l,g])),u.createHref({pathname:x,search:y,hash:p})}function Iy(){return H.useContext(Lk)!=null}function fp(){return Iy()||ci(!1),H.useContext(Lk).location}function vee(s){H.useContext(hp).static||H.useLayoutEffect(s)}function zr(){let{isDataRoute:s}=H.useContext(pp);return s?L_e():w_e()}function w_e(){Iy()||ci(!1);let s=H.useContext(Pk),{basename:n,future:i,navigator:l}=H.useContext(hp),{matches:u}=H.useContext(pp),{pathname:p}=fp(),g=JSON.stringify(E3(u,i.v7_relativeSplatPath)),y=H.useRef(!1);return vee(()=>{y.current=!0}),H.useCallback(function(C,k){if(k===void 0&&(k={}),!y.current)return;if(typeof C=="number"){l.go(C);return}let A=y3(C,JSON.parse(g),p,k.relative==="path");s==null&&n!=="/"&&(A.pathname=A.pathname==="/"?n:Zf([n,A.pathname])),(k.replace?l.replace:l.push)(A,k.state,k)},[n,l,g,p,s])}function Eee(){let{matches:s}=H.useContext(pp),n=s[s.length-1];return n?n.params:{}}function jk(s,n){let{relative:i}=n===void 0?{}:n,{future:l}=H.useContext(hp),{matches:u}=H.useContext(pp),{pathname:p}=fp(),g=JSON.stringify(E3(u,l.v7_relativeSplatPath));return H.useMemo(()=>y3(s,JSON.parse(g),p,i==="path"),[s,g,p,i])}function S_e(s,n){return T_e(s,n)}function T_e(s,n,i,l){Iy()||ci(!1);let{navigator:u}=H.useContext(hp),{matches:p}=H.useContext(pp),g=p[p.length-1],y=g?g.params:{};g&&g.pathname;let x=g?g.pathnameBase:"/";g&&g.route;let C=fp(),k;if(n){var A;let Z=typeof n=="string"?Ny(n):n;x==="/"||(A=Z.pathname)!=null&&A.startsWith(x)||ci(!1),k=Z}else k=C;let M=k.pathname||"/",G=M;if(x!=="/"){let Z=x.replace(/^\//,"").split("/");G="/"+M.replace(/^\//,"").split("/").slice(Z.length).join("/")}let B=Zge(s,{pathname:G}),X=A_e(B&&B.map(Z=>Object.assign({},Z,{params:Object.assign({},y,Z.params),pathname:Zf([x,u.encodeLocation?u.encodeLocation(Z.pathname).pathname:Z.pathname]),pathnameBase:Z.pathnameBase==="/"?x:Zf([x,u.encodeLocation?u.encodeLocation(Z.pathnameBase).pathname:Z.pathnameBase])})),p,i,l);return n&&X?H.createElement(Lk.Provider,{value:{location:jS({pathname:"/",search:"",hash:"",state:null,key:"default"},k),navigationType:Bf.Pop}},X):X}function R_e(){let s=P_e(),n=y_e(s)?s.status+" "+s.statusText:s instanceof Error?s.message:JSON.stringify(s),i=s instanceof Error?s.stack:null,u={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return H.createElement(H.Fragment,null,H.createElement("h2",null,"Unexpected Application Error!"),H.createElement("h3",{style:{fontStyle:"italic"}},n),i?H.createElement("pre",{style:u},i):null,null)}const C_e=H.createElement(R_e,null);class N_e extends H.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,i){return i.location!==n.location||i.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:i.error,location:i.location,revalidation:n.revalidation||i.revalidation}}componentDidCatch(n,i){console.error("React Router caught the following error during render",n,i)}render(){return this.state.error!==void 0?H.createElement(pp.Provider,{value:this.props.routeContext},H.createElement(_ee.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function I_e(s){let{routeContext:n,match:i,children:l}=s,u=H.useContext(Pk);return u&&u.static&&u.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(u.staticContext._deepestRenderedBoundaryId=i.route.id),H.createElement(pp.Provider,{value:n},l)}function A_e(s,n,i,l){var u;if(n===void 0&&(n=[]),i===void 0&&(i=null),l===void 0&&(l=null),s==null){var p;if(!i)return null;if(i.errors)s=i.matches;else if((p=l)!=null&&p.v7_partialHydration&&n.length===0&&!i.initialized&&i.matches.length>0)s=i.matches;else return null}let g=s,y=(u=i)==null?void 0:u.errors;if(y!=null){let k=g.findIndex(A=>A.route.id&&(y==null?void 0:y[A.route.id])!==void 0);k>=0||ci(!1),g=g.slice(0,Math.min(g.length,k+1))}let x=!1,C=-1;if(i&&l&&l.v7_partialHydration)for(let k=0;k<g.length;k++){let A=g[k];if((A.route.HydrateFallback||A.route.hydrateFallbackElement)&&(C=k),A.route.id){let{loaderData:M,errors:G}=i,B=A.route.loader&&M[A.route.id]===void 0&&(!G||G[A.route.id]===void 0);if(A.route.lazy||B){x=!0,C>=0?g=g.slice(0,C+1):g=[g[0]];break}}}return g.reduceRight((k,A,M)=>{let G,B=!1,X=null,Z=null;i&&(G=y&&A.route.id?y[A.route.id]:void 0,X=A.route.errorElement||C_e,x&&(C<0&&M===0?(j_e("route-fallback"),B=!0,Z=null):C===M&&(B=!0,Z=A.route.hydrateFallbackElement||null)));let q=n.concat(g.slice(0,M+1)),V=()=>{let ee;return G?ee=X:B?ee=Z:A.route.Component?ee=H.createElement(A.route.Component,null):A.route.element?ee=A.route.element:ee=k,H.createElement(I_e,{match:A,routeContext:{outlet:k,matches:q,isDataRoute:i!=null},children:ee})};return i&&(A.route.ErrorBoundary||A.route.errorElement||M===0)?H.createElement(N_e,{location:i.location,revalidation:i.revalidation,component:X,error:G,children:V(),routeContext:{outlet:null,matches:q,isDataRoute:!0}}):V()},null)}var yee=function(s){return s.UseBlocker="useBlocker",s.UseRevalidator="useRevalidator",s.UseNavigateStable="useNavigate",s}(yee||{}),bee=function(s){return s.UseBlocker="useBlocker",s.UseLoaderData="useLoaderData",s.UseActionData="useActionData",s.UseRouteError="useRouteError",s.UseNavigation="useNavigation",s.UseRouteLoaderData="useRouteLoaderData",s.UseMatches="useMatches",s.UseRevalidator="useRevalidator",s.UseNavigateStable="useNavigate",s.UseRouteId="useRouteId",s}(bee||{});function k_e(s){let n=H.useContext(Pk);return n||ci(!1),n}function O_e(s){let n=H.useContext(gee);return n||ci(!1),n}function D_e(s){let n=H.useContext(pp);return n||ci(!1),n}function xee(s){let n=D_e(),i=n.matches[n.matches.length-1];return i.route.id||ci(!1),i.route.id}function P_e(){var s;let n=H.useContext(_ee),i=O_e(),l=xee();return n!==void 0?n:(s=i.errors)==null?void 0:s[l]}function L_e(){let{router:s}=k_e(yee.UseNavigateStable),n=xee(bee.UseNavigateStable),i=H.useRef(!1);return vee(()=>{i.current=!0}),H.useCallback(function(u,p){p===void 0&&(p={}),i.current&&(typeof u=="number"?s.navigate(u):s.navigate(u,jS({fromRouteId:n},p)))},[s,n])}const qX={};function j_e(s,n,i){qX[s]||(qX[s]=!0)}function M_e(s,n){s==null||s.v7_startTransition,s==null||s.v7_relativeSplatPath}function UA(s){let{to:n,replace:i,state:l,relative:u}=s;Iy()||ci(!1);let{future:p,static:g}=H.useContext(hp),{matches:y}=H.useContext(pp),{pathname:x}=fp(),C=zr(),k=y3(n,E3(y,p.v7_relativeSplatPath),x,u==="path"),A=JSON.stringify(k);return H.useEffect(()=>C(JSON.parse(A),{replace:i,state:l,relative:u}),[C,A,u,i,l]),null}function kn(s){ci(!1)}function U_e(s){let{basename:n="/",children:i=null,location:l,navigationType:u=Bf.Pop,navigator:p,static:g=!1,future:y}=s;Iy()&&ci(!1);let x=n.replace(/^\/*/,"/"),C=H.useMemo(()=>({basename:x,navigator:p,static:g,future:jS({v7_relativeSplatPath:!1},y)}),[x,y,p,g]);typeof l=="string"&&(l=Ny(l));let{pathname:k="/",search:A="",hash:M="",state:G=null,key:B="default"}=l,X=H.useMemo(()=>{let Z=ay(k,x);return Z==null?null:{location:{pathname:Z,search:A,hash:M,state:G,key:B},navigationType:u}},[x,k,A,M,G,B,u]);return X==null?null:H.createElement(hp.Provider,{value:C},H.createElement(Lk.Provider,{children:i,value:X}))}function p4(s){let{children:n,location:i}=s;return S_e(P5(n),i)}new Promise(()=>{});function P5(s,n){n===void 0&&(n=[]);let i=[];return H.Children.forEach(s,(l,u)=>{if(!H.isValidElement(l))return;let p=[...n,u];if(l.type===H.Fragment){i.push.apply(i,P5(l.props.children,p));return}l.type!==kn&&ci(!1),!l.props.index||!l.props.children||ci(!1);let g={id:l.props.id||p.join("-"),caseSensitive:l.props.caseSensitive,element:l.props.element,Component:l.props.Component,index:l.props.index,path:l.props.path,loader:l.props.loader,action:l.props.action,errorElement:l.props.errorElement,ErrorBoundary:l.props.ErrorBoundary,hasErrorBoundary:l.props.ErrorBoundary!=null||l.props.errorElement!=null,shouldRevalidate:l.props.shouldRevalidate,handle:l.props.handle,lazy:l.props.lazy};l.props.children&&(g.children=P5(l.props.children,p)),i.push(g)}),i}/**
 * React Router DOM v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function G1(){return G1=Object.assign?Object.assign.bind():function(s){for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(s[l]=i[l])}return s},G1.apply(this,arguments)}function wee(s,n){if(s==null)return{};var i={},l=Object.keys(s),u,p;for(p=0;p<l.length;p++)u=l[p],!(n.indexOf(u)>=0)&&(i[u]=s[u]);return i}function V_e(s){return!!(s.metaKey||s.altKey||s.ctrlKey||s.shiftKey)}function F_e(s,n){return s.button===0&&(!n||n==="_self")&&!V_e(s)}function L5(s){return s===void 0&&(s=""),new URLSearchParams(typeof s=="string"||Array.isArray(s)||s instanceof URLSearchParams?s:Object.keys(s).reduce((n,i)=>{let l=s[i];return n.concat(Array.isArray(l)?l.map(u=>[i,u]):[[i,l]])},[]))}function B_e(s,n){let i=L5(s);return n&&n.forEach((l,u)=>{i.has(u)||n.getAll(u).forEach(p=>{i.append(u,p)})}),i}const z_e=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],G_e=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],W_e="6";try{window.__reactRouterVersion=W_e}catch{}const H_e=H.createContext({isTransitioning:!1}),K_e="startTransition",YX=Ufe[K_e];function q_e(s){let{basename:n,children:i,future:l,window:u}=s,p=H.useRef();p.current==null&&(p.current=$ge({window:u,v5Compat:!0}));let g=p.current,[y,x]=H.useState({action:g.action,location:g.location}),{v7_startTransition:C}=l||{},k=H.useCallback(A=>{C&&YX?YX(()=>x(A)):x(A)},[x,C]);return H.useLayoutEffect(()=>g.listen(k),[g,k]),H.useEffect(()=>M_e(l),[l]),H.createElement(U_e,{basename:n,children:i,location:y.location,navigationType:y.action,navigator:g,future:l})}const Y_e=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",X_e=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,qh=H.forwardRef(function(n,i){let{onClick:l,relative:u,reloadDocument:p,replace:g,state:y,target:x,to:C,preventScrollReset:k,viewTransition:A}=n,M=wee(n,z_e),{basename:G}=H.useContext(hp),B,X=!1;if(typeof C=="string"&&X_e.test(C)&&(B=C,Y_e))try{let ee=new URL(window.location.href),de=C.startsWith("//")?new URL(ee.protocol+C):new URL(C),ae=ay(de.pathname,G);de.origin===ee.origin&&ae!=null?C=ae+de.search+de.hash:X=!0}catch{}let Z=x_e(C,{relative:u}),q=Q_e(C,{replace:g,state:y,target:x,preventScrollReset:k,relative:u,viewTransition:A});function V(ee){l&&l(ee),ee.defaultPrevented||q(ee)}return H.createElement("a",G1({},M,{href:B||Z,onClick:X||p?l:V,ref:i,target:x}))}),$_e=H.forwardRef(function(n,i){let{"aria-current":l="page",caseSensitive:u=!1,className:p="",end:g=!1,style:y,to:x,viewTransition:C,children:k}=n,A=wee(n,G_e),M=jk(x,{relative:A.relative}),G=fp(),B=H.useContext(gee),{navigator:X,basename:Z}=H.useContext(hp),q=B!=null&&Z_e(M)&&C===!0,V=X.encodeLocation?X.encodeLocation(M).pathname:M.pathname,ee=G.pathname,de=B&&B.navigation&&B.navigation.location?B.navigation.location.pathname:null;u||(ee=ee.toLowerCase(),de=de?de.toLowerCase():null,V=V.toLowerCase()),de&&Z&&(de=ay(de,Z)||de);const ae=V!=="/"&&V.endsWith("/")?V.length-1:V.length;let ye=ee===V||!g&&ee.startsWith(V)&&ee.charAt(ae)==="/",Q=de!=null&&(de===V||!g&&de.startsWith(V)&&de.charAt(V.length)==="/"),$={isActive:ye,isPending:Q,isTransitioning:q},se=ye?l:void 0,ce;typeof p=="function"?ce=p($):ce=[p,ye?"active":null,Q?"pending":null,q?"transitioning":null].filter(Boolean).join(" ");let he=typeof y=="function"?y($):y;return H.createElement(qh,G1({},A,{"aria-current":se,className:ce,ref:i,style:he,to:x,viewTransition:C}),typeof k=="function"?k($):k)});var j5;(function(s){s.UseScrollRestoration="useScrollRestoration",s.UseSubmit="useSubmit",s.UseSubmitFetcher="useSubmitFetcher",s.UseFetcher="useFetcher",s.useViewTransitionState="useViewTransitionState"})(j5||(j5={}));var XX;(function(s){s.UseFetcher="useFetcher",s.UseFetchers="useFetchers",s.UseScrollRestoration="useScrollRestoration"})(XX||(XX={}));function J_e(s){let n=H.useContext(Pk);return n||ci(!1),n}function Q_e(s,n){let{target:i,replace:l,state:u,preventScrollReset:p,relative:g,viewTransition:y}=n===void 0?{}:n,x=zr(),C=fp(),k=jk(s,{relative:g});return H.useCallback(A=>{if(F_e(A,i)){A.preventDefault();let M=l!==void 0?l:z1(C)===z1(k);x(s,{replace:M,state:u,preventScrollReset:p,relative:g,viewTransition:y})}},[C,x,k,l,u,i,s,p,g,y])}function aT(s){let n=H.useRef(L5(s)),i=H.useRef(!1),l=fp(),u=H.useMemo(()=>B_e(l.search,i.current?null:n.current),[l.search]),p=zr(),g=H.useCallback((y,x)=>{const C=L5(typeof y=="function"?y(u):y);i.current=!0,p("?"+C,x)},[p,u]);return[u,g]}function Z_e(s,n){n===void 0&&(n={});let i=H.useContext(H_e);i==null&&ci(!1);let{basename:l}=J_e(j5.useViewTransitionState),u=jk(s,{relative:n.relative});if(!i.isTransitioning)return!1;let p=ay(i.currentLocation.pathname,l)||i.currentLocation.pathname,g=ay(i.nextLocation.pathname,l)||i.nextLocation.pathname;return D5(u.pathname,g)!=null||D5(u.pathname,p)!=null}var $X={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const See=function(s){const n=[];let i=0;for(let l=0;l<s.length;l++){let u=s.charCodeAt(l);u<128?n[i++]=u:u<2048?(n[i++]=u>>6|192,n[i++]=u&63|128):(u&64512)===55296&&l+1<s.length&&(s.charCodeAt(l+1)&64512)===56320?(u=65536+((u&1023)<<10)+(s.charCodeAt(++l)&1023),n[i++]=u>>18|240,n[i++]=u>>12&63|128,n[i++]=u>>6&63|128,n[i++]=u&63|128):(n[i++]=u>>12|224,n[i++]=u>>6&63|128,n[i++]=u&63|128)}return n},e0e=function(s){const n=[];let i=0,l=0;for(;i<s.length;){const u=s[i++];if(u<128)n[l++]=String.fromCharCode(u);else if(u>191&&u<224){const p=s[i++];n[l++]=String.fromCharCode((u&31)<<6|p&63)}else if(u>239&&u<365){const p=s[i++],g=s[i++],y=s[i++],x=((u&7)<<18|(p&63)<<12|(g&63)<<6|y&63)-65536;n[l++]=String.fromCharCode(55296+(x>>10)),n[l++]=String.fromCharCode(56320+(x&1023))}else{const p=s[i++],g=s[i++];n[l++]=String.fromCharCode((u&15)<<12|(p&63)<<6|g&63)}}return n.join("")},Tee={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(s,n){if(!Array.isArray(s))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=n?this.byteToCharMapWebSafe_:this.byteToCharMap_,l=[];for(let u=0;u<s.length;u+=3){const p=s[u],g=u+1<s.length,y=g?s[u+1]:0,x=u+2<s.length,C=x?s[u+2]:0,k=p>>2,A=(p&3)<<4|y>>4;let M=(y&15)<<2|C>>6,G=C&63;x||(G=64,g||(M=64)),l.push(i[k],i[A],i[M],i[G])}return l.join("")},encodeString(s,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(s):this.encodeByteArray(See(s),n)},decodeString(s,n){return this.HAS_NATIVE_SUPPORT&&!n?atob(s):e0e(this.decodeStringToByteArray(s,n))},decodeStringToByteArray(s,n){this.init_();const i=n?this.charToByteMapWebSafe_:this.charToByteMap_,l=[];for(let u=0;u<s.length;){const p=i[s.charAt(u++)],y=u<s.length?i[s.charAt(u)]:0;++u;const C=u<s.length?i[s.charAt(u)]:64;++u;const A=u<s.length?i[s.charAt(u)]:64;if(++u,p==null||y==null||C==null||A==null)throw new t0e;const M=p<<2|y>>4;if(l.push(M),C!==64){const G=y<<4&240|C>>2;if(l.push(G),A!==64){const B=C<<6&192|A;l.push(B)}}}return l},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let s=0;s<this.ENCODED_VALS.length;s++)this.byteToCharMap_[s]=this.ENCODED_VALS.charAt(s),this.charToByteMap_[this.byteToCharMap_[s]]=s,this.byteToCharMapWebSafe_[s]=this.ENCODED_VALS_WEBSAFE.charAt(s),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[s]]=s,s>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(s)]=s,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(s)]=s)}}};class t0e extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const n0e=function(s){const n=See(s);return Tee.encodeByteArray(n,!0)},W1=function(s){return n0e(s).replace(/\./g,"")},Ree=function(s){try{return Tee.decodeString(s,!0)}catch(n){console.error("base64Decode failed: ",n)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r0e(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s0e=()=>r0e().__FIREBASE_DEFAULTS__,i0e=()=>{if(typeof process>"u"||typeof $X>"u")return;const s=$X.__FIREBASE_DEFAULTS__;if(s)return JSON.parse(s)},a0e=()=>{if(typeof document>"u")return;let s;try{s=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const n=s&&Ree(s[1]);return n&&JSON.parse(n)},Mk=()=>{try{return s0e()||i0e()||a0e()}catch(s){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${s}`);return}},Cee=s=>{var n,i;return(i=(n=Mk())===null||n===void 0?void 0:n.emulatorHosts)===null||i===void 0?void 0:i[s]},Nee=s=>{const n=Cee(s);if(!n)return;const i=n.lastIndexOf(":");if(i<=0||i+1===n.length)throw new Error(`Invalid host ${n} with no separate hostname and port!`);const l=parseInt(n.substring(i+1),10);return n[0]==="["?[n.substring(1,i-1),l]:[n.substring(0,i),l]},Iee=()=>{var s;return(s=Mk())===null||s===void 0?void 0:s.config},Aee=s=>{var n;return(n=Mk())===null||n===void 0?void 0:n[`_${s}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o0e{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((n,i)=>{this.resolve=n,this.reject=i})}wrapCallback(n){return(i,l)=>{i?this.reject(i):this.resolve(l),typeof n=="function"&&(this.promise.catch(()=>{}),n.length===1?n(i):n(i,l))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kee(s,n){if(s.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i={alg:"none",type:"JWT"},l=n||"demo-project",u=s.iat||0,p=s.sub||s.user_id;if(!p)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const g=Object.assign({iss:`https://securetoken.google.com/${l}`,aud:l,iat:u,exp:u+3600,auth_time:u,sub:p,user_id:p,firebase:{sign_in_provider:"custom",identities:{}}},s);return[W1(JSON.stringify(i)),W1(JSON.stringify(g)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eo(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function c0e(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Eo())}function l0e(){var s;const n=(s=Mk())===null||s===void 0?void 0:s.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function d0e(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function u0e(){const s=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof s=="object"&&s.id!==void 0}function h0e(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function p0e(){const s=Eo();return s.indexOf("MSIE ")>=0||s.indexOf("Trident/")>=0}function f0e(){return!l0e()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function m0e(){try{return typeof indexedDB=="object"}catch{return!1}}function g0e(){return new Promise((s,n)=>{try{let i=!0;const l="validate-browser-context-for-indexeddb-analytics-module",u=self.indexedDB.open(l);u.onsuccess=()=>{u.result.close(),i||self.indexedDB.deleteDatabase(l),s(!0)},u.onupgradeneeded=()=>{i=!1},u.onerror=()=>{var p;n(((p=u.error)===null||p===void 0?void 0:p.message)||"")}}catch(i){n(i)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _0e="FirebaseError";class th extends Error{constructor(n,i,l){super(i),this.code=n,this.customData=l,this.name=_0e,Object.setPrototypeOf(this,th.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,oT.prototype.create)}}class oT{constructor(n,i,l){this.service=n,this.serviceName=i,this.errors=l}create(n,...i){const l=i[0]||{},u=`${this.service}/${n}`,p=this.errors[n],g=p?v0e(p,l):"Error",y=`${this.serviceName}: ${g} (${u}).`;return new th(u,y,l)}}function v0e(s,n){return s.replace(E0e,(i,l)=>{const u=n[l];return u!=null?String(u):`<${l}?>`})}const E0e=/\{\$([^}]+)}/g;function y0e(s){for(const n in s)if(Object.prototype.hasOwnProperty.call(s,n))return!1;return!0}function MS(s,n){if(s===n)return!0;const i=Object.keys(s),l=Object.keys(n);for(const u of i){if(!l.includes(u))return!1;const p=s[u],g=n[u];if(JX(p)&&JX(g)){if(!MS(p,g))return!1}else if(p!==g)return!1}for(const u of l)if(!i.includes(u))return!1;return!0}function JX(s){return s!==null&&typeof s=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cT(s){const n=[];for(const[i,l]of Object.entries(s))Array.isArray(l)?l.forEach(u=>{n.push(encodeURIComponent(i)+"="+encodeURIComponent(u))}):n.push(encodeURIComponent(i)+"="+encodeURIComponent(l));return n.length?"&"+n.join("&"):""}function Hw(s){const n={};return s.replace(/^\?/,"").split("&").forEach(l=>{if(l){const[u,p]=l.split("=");n[decodeURIComponent(u)]=decodeURIComponent(p)}}),n}function Kw(s){const n=s.indexOf("?");if(!n)return"";const i=s.indexOf("#",n);return s.substring(n,i>0?i:void 0)}function b0e(s,n){const i=new x0e(s,n);return i.subscribe.bind(i)}class x0e{constructor(n,i){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=i,this.task.then(()=>{n(this)}).catch(l=>{this.error(l)})}next(n){this.forEachObserver(i=>{i.next(n)})}error(n){this.forEachObserver(i=>{i.error(n)}),this.close(n)}complete(){this.forEachObserver(n=>{n.complete()}),this.close()}subscribe(n,i,l){let u;if(n===void 0&&i===void 0&&l===void 0)throw new Error("Missing Observer.");w0e(n,["next","error","complete"])?u=n:u={next:n,error:i,complete:l},u.next===void 0&&(u.next=f4),u.error===void 0&&(u.error=f4),u.complete===void 0&&(u.complete=f4);const p=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?u.error(this.finalError):u.complete()}catch{}}),this.observers.push(u),p}unsubscribeOne(n){this.observers===void 0||this.observers[n]===void 0||(delete this.observers[n],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(n){if(!this.finalized)for(let i=0;i<this.observers.length;i++)this.sendOne(i,n)}sendOne(n,i){this.task.then(()=>{if(this.observers!==void 0&&this.observers[n]!==void 0)try{i(this.observers[n])}catch(l){typeof console<"u"&&console.error&&console.error(l)}})}close(n){this.finalized||(this.finalized=!0,n!==void 0&&(this.finalError=n),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function w0e(s,n){if(typeof s!="object"||s===null)return!1;for(const i of n)if(i in s&&typeof s[i]=="function")return!0;return!1}function f4(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function as(s){return s&&s._delegate?s._delegate:s}class lm{constructor(n,i,l){this.name=n,this.instanceFactory=i,this.type=l,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(n){return this.instantiationMode=n,this}setMultipleInstances(n){return this.multipleInstances=n,this}setServiceProps(n){return this.serviceProps=n,this}setInstanceCreatedCallback(n){return this.onInstanceCreated=n,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c_="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S0e{constructor(n,i){this.name=n,this.container=i,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(n){const i=this.normalizeInstanceIdentifier(n);if(!this.instancesDeferred.has(i)){const l=new o0e;if(this.instancesDeferred.set(i,l),this.isInitialized(i)||this.shouldAutoInitialize())try{const u=this.getOrInitializeService({instanceIdentifier:i});u&&l.resolve(u)}catch{}}return this.instancesDeferred.get(i).promise}getImmediate(n){var i;const l=this.normalizeInstanceIdentifier(n==null?void 0:n.identifier),u=(i=n==null?void 0:n.optional)!==null&&i!==void 0?i:!1;if(this.isInitialized(l)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:l})}catch(p){if(u)return null;throw p}else{if(u)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(n){if(n.name!==this.name)throw Error(`Mismatching Component ${n.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=n,!!this.shouldAutoInitialize()){if(R0e(n))try{this.getOrInitializeService({instanceIdentifier:c_})}catch{}for(const[i,l]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(i);try{const p=this.getOrInitializeService({instanceIdentifier:u});l.resolve(p)}catch{}}}}clearInstance(n=c_){this.instancesDeferred.delete(n),this.instancesOptions.delete(n),this.instances.delete(n)}async delete(){const n=Array.from(this.instances.values());await Promise.all([...n.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...n.filter(i=>"_delete"in i).map(i=>i._delete())])}isComponentSet(){return this.component!=null}isInitialized(n=c_){return this.instances.has(n)}getOptions(n=c_){return this.instancesOptions.get(n)||{}}initialize(n={}){const{options:i={}}=n,l=this.normalizeInstanceIdentifier(n.instanceIdentifier);if(this.isInitialized(l))throw Error(`${this.name}(${l}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const u=this.getOrInitializeService({instanceIdentifier:l,options:i});for(const[p,g]of this.instancesDeferred.entries()){const y=this.normalizeInstanceIdentifier(p);l===y&&g.resolve(u)}return u}onInit(n,i){var l;const u=this.normalizeInstanceIdentifier(i),p=(l=this.onInitCallbacks.get(u))!==null&&l!==void 0?l:new Set;p.add(n),this.onInitCallbacks.set(u,p);const g=this.instances.get(u);return g&&n(g,u),()=>{p.delete(n)}}invokeOnInitCallbacks(n,i){const l=this.onInitCallbacks.get(i);if(l)for(const u of l)try{u(n,i)}catch{}}getOrInitializeService({instanceIdentifier:n,options:i={}}){let l=this.instances.get(n);if(!l&&this.component&&(l=this.component.instanceFactory(this.container,{instanceIdentifier:T0e(n),options:i}),this.instances.set(n,l),this.instancesOptions.set(n,i),this.invokeOnInitCallbacks(l,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,l)}catch{}return l||null}normalizeInstanceIdentifier(n=c_){return this.component?this.component.multipleInstances?n:c_:n}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function T0e(s){return s===c_?void 0:s}function R0e(s){return s.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C0e{constructor(n){this.name=n,this.providers=new Map}addComponent(n){const i=this.getProvider(n.name);if(i.isComponentSet())throw new Error(`Component ${n.name} has already been registered with ${this.name}`);i.setComponent(n)}addOrOverwriteComponent(n){this.getProvider(n.name).isComponentSet()&&this.providers.delete(n.name),this.addComponent(n)}getProvider(n){if(this.providers.has(n))return this.providers.get(n);const i=new S0e(n,this);return this.providers.set(n,i),i}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Cr;(function(s){s[s.DEBUG=0]="DEBUG",s[s.VERBOSE=1]="VERBOSE",s[s.INFO=2]="INFO",s[s.WARN=3]="WARN",s[s.ERROR=4]="ERROR",s[s.SILENT=5]="SILENT"})(Cr||(Cr={}));const N0e={debug:Cr.DEBUG,verbose:Cr.VERBOSE,info:Cr.INFO,warn:Cr.WARN,error:Cr.ERROR,silent:Cr.SILENT},I0e=Cr.INFO,A0e={[Cr.DEBUG]:"log",[Cr.VERBOSE]:"log",[Cr.INFO]:"info",[Cr.WARN]:"warn",[Cr.ERROR]:"error"},k0e=(s,n,...i)=>{if(n<s.logLevel)return;const l=new Date().toISOString(),u=A0e[n];if(u)console[u](`[${l}]  ${s.name}:`,...i);else throw new Error(`Attempted to log a message with an invalid logType (value: ${n})`)};class b3{constructor(n){this.name=n,this._logLevel=I0e,this._logHandler=k0e,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(n){if(!(n in Cr))throw new TypeError(`Invalid value "${n}" assigned to \`logLevel\``);this._logLevel=n}setLogLevel(n){this._logLevel=typeof n=="string"?N0e[n]:n}get logHandler(){return this._logHandler}set logHandler(n){if(typeof n!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=n}get userLogHandler(){return this._userLogHandler}set userLogHandler(n){this._userLogHandler=n}debug(...n){this._userLogHandler&&this._userLogHandler(this,Cr.DEBUG,...n),this._logHandler(this,Cr.DEBUG,...n)}log(...n){this._userLogHandler&&this._userLogHandler(this,Cr.VERBOSE,...n),this._logHandler(this,Cr.VERBOSE,...n)}info(...n){this._userLogHandler&&this._userLogHandler(this,Cr.INFO,...n),this._logHandler(this,Cr.INFO,...n)}warn(...n){this._userLogHandler&&this._userLogHandler(this,Cr.WARN,...n),this._logHandler(this,Cr.WARN,...n)}error(...n){this._userLogHandler&&this._userLogHandler(this,Cr.ERROR,...n),this._logHandler(this,Cr.ERROR,...n)}}const O0e=(s,n)=>n.some(i=>s instanceof i);let QX,ZX;function D0e(){return QX||(QX=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function P0e(){return ZX||(ZX=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Oee=new WeakMap,M5=new WeakMap,Dee=new WeakMap,m4=new WeakMap,x3=new WeakMap;function L0e(s){const n=new Promise((i,l)=>{const u=()=>{s.removeEventListener("success",p),s.removeEventListener("error",g)},p=()=>{i(em(s.result)),u()},g=()=>{l(s.error),u()};s.addEventListener("success",p),s.addEventListener("error",g)});return n.then(i=>{i instanceof IDBCursor&&Oee.set(i,s)}).catch(()=>{}),x3.set(n,s),n}function j0e(s){if(M5.has(s))return;const n=new Promise((i,l)=>{const u=()=>{s.removeEventListener("complete",p),s.removeEventListener("error",g),s.removeEventListener("abort",g)},p=()=>{i(),u()},g=()=>{l(s.error||new DOMException("AbortError","AbortError")),u()};s.addEventListener("complete",p),s.addEventListener("error",g),s.addEventListener("abort",g)});M5.set(s,n)}let U5={get(s,n,i){if(s instanceof IDBTransaction){if(n==="done")return M5.get(s);if(n==="objectStoreNames")return s.objectStoreNames||Dee.get(s);if(n==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return em(s[n])},set(s,n,i){return s[n]=i,!0},has(s,n){return s instanceof IDBTransaction&&(n==="done"||n==="store")?!0:n in s}};function M0e(s){U5=s(U5)}function U0e(s){return s===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(n,...i){const l=s.call(g4(this),n,...i);return Dee.set(l,n.sort?n.sort():[n]),em(l)}:P0e().includes(s)?function(...n){return s.apply(g4(this),n),em(Oee.get(this))}:function(...n){return em(s.apply(g4(this),n))}}function V0e(s){return typeof s=="function"?U0e(s):(s instanceof IDBTransaction&&j0e(s),O0e(s,D0e())?new Proxy(s,U5):s)}function em(s){if(s instanceof IDBRequest)return L0e(s);if(m4.has(s))return m4.get(s);const n=V0e(s);return n!==s&&(m4.set(s,n),x3.set(n,s)),n}const g4=s=>x3.get(s);function F0e(s,n,{blocked:i,upgrade:l,blocking:u,terminated:p}={}){const g=indexedDB.open(s,n),y=em(g);return l&&g.addEventListener("upgradeneeded",x=>{l(em(g.result),x.oldVersion,x.newVersion,em(g.transaction),x)}),i&&g.addEventListener("blocked",x=>i(x.oldVersion,x.newVersion,x)),y.then(x=>{p&&x.addEventListener("close",()=>p()),u&&x.addEventListener("versionchange",C=>u(C.oldVersion,C.newVersion,C))}).catch(()=>{}),y}const B0e=["get","getKey","getAll","getAllKeys","count"],z0e=["put","add","delete","clear"],_4=new Map;function e$(s,n){if(!(s instanceof IDBDatabase&&!(n in s)&&typeof n=="string"))return;if(_4.get(n))return _4.get(n);const i=n.replace(/FromIndex$/,""),l=n!==i,u=z0e.includes(i);if(!(i in(l?IDBIndex:IDBObjectStore).prototype)||!(u||B0e.includes(i)))return;const p=async function(g,...y){const x=this.transaction(g,u?"readwrite":"readonly");let C=x.store;return l&&(C=C.index(y.shift())),(await Promise.all([C[i](...y),u&&x.done]))[0]};return _4.set(n,p),p}M0e(s=>({...s,get:(n,i,l)=>e$(n,i)||s.get(n,i,l),has:(n,i)=>!!e$(n,i)||s.has(n,i)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G0e{constructor(n){this.container=n}getPlatformInfoString(){return this.container.getProviders().map(i=>{if(W0e(i)){const l=i.getImmediate();return`${l.library}/${l.version}`}else return null}).filter(i=>i).join(" ")}}function W0e(s){const n=s.getComponent();return(n==null?void 0:n.type)==="VERSION"}const V5="@firebase/app",t$="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const op=new b3("@firebase/app"),H0e="@firebase/app-compat",K0e="@firebase/analytics-compat",q0e="@firebase/analytics",Y0e="@firebase/app-check-compat",X0e="@firebase/app-check",$0e="@firebase/auth",J0e="@firebase/auth-compat",Q0e="@firebase/database",Z0e="@firebase/data-connect",eve="@firebase/database-compat",tve="@firebase/functions",nve="@firebase/functions-compat",rve="@firebase/installations",sve="@firebase/installations-compat",ive="@firebase/messaging",ave="@firebase/messaging-compat",ove="@firebase/performance",cve="@firebase/performance-compat",lve="@firebase/remote-config",dve="@firebase/remote-config-compat",uve="@firebase/storage",hve="@firebase/storage-compat",pve="@firebase/firestore",fve="@firebase/vertexai-preview",mve="@firebase/firestore-compat",gve="firebase",_ve="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F5="[DEFAULT]",vve={[V5]:"fire-core",[H0e]:"fire-core-compat",[q0e]:"fire-analytics",[K0e]:"fire-analytics-compat",[X0e]:"fire-app-check",[Y0e]:"fire-app-check-compat",[$0e]:"fire-auth",[J0e]:"fire-auth-compat",[Q0e]:"fire-rtdb",[Z0e]:"fire-data-connect",[eve]:"fire-rtdb-compat",[tve]:"fire-fn",[nve]:"fire-fn-compat",[rve]:"fire-iid",[sve]:"fire-iid-compat",[ive]:"fire-fcm",[ave]:"fire-fcm-compat",[ove]:"fire-perf",[cve]:"fire-perf-compat",[lve]:"fire-rc",[dve]:"fire-rc-compat",[uve]:"fire-gcs",[hve]:"fire-gcs-compat",[pve]:"fire-fst",[mve]:"fire-fst-compat",[fve]:"fire-vertex","fire-js":"fire-js",[gve]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H1=new Map,Eve=new Map,B5=new Map;function n$(s,n){try{s.container.addComponent(n)}catch(i){op.debug(`Component ${n.name} failed to register with FirebaseApp ${s.name}`,i)}}function T_(s){const n=s.name;if(B5.has(n))return op.debug(`There were multiple attempts to register component ${n}.`),!1;B5.set(n,s);for(const i of H1.values())n$(i,s);for(const i of Eve.values())n$(i,s);return!0}function Uk(s,n){const i=s.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),s.container.getProvider(n)}function Wc(s){return s.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yve={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},tm=new oT("app","Firebase",yve);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bve{constructor(n,i,l){this._isDeleted=!1,this._options=Object.assign({},n),this._config=Object.assign({},i),this._name=i.name,this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled,this._container=l,this.container.addComponent(new lm("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(n){this.checkDestroyed(),this._automaticDataCollectionEnabled=n}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(n){this._isDeleted=n}checkDestroyed(){if(this.isDeleted)throw tm.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j_=_ve;function Pee(s,n={}){let i=s;typeof n!="object"&&(n={name:n});const l=Object.assign({name:F5,automaticDataCollectionEnabled:!1},n),u=l.name;if(typeof u!="string"||!u)throw tm.create("bad-app-name",{appName:String(u)});if(i||(i=Iee()),!i)throw tm.create("no-options");const p=H1.get(u);if(p){if(MS(i,p.options)&&MS(l,p.config))return p;throw tm.create("duplicate-app",{appName:u})}const g=new C0e(u);for(const x of B5.values())g.addComponent(x);const y=new bve(i,l,g);return H1.set(u,y),y}function w3(s=F5){const n=H1.get(s);if(!n&&s===F5&&Iee())return Pee();if(!n)throw tm.create("no-app",{appName:s});return n}function Ku(s,n,i){var l;let u=(l=vve[s])!==null&&l!==void 0?l:s;i&&(u+=`-${i}`);const p=u.match(/\s|\//),g=n.match(/\s|\//);if(p||g){const y=[`Unable to register library "${u}" with version "${n}":`];p&&y.push(`library name "${u}" contains illegal characters (whitespace or "/")`),p&&g&&y.push("and"),g&&y.push(`version name "${n}" contains illegal characters (whitespace or "/")`),op.warn(y.join(" "));return}T_(new lm(`${u}-version`,()=>({library:u,version:n}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xve="firebase-heartbeat-database",wve=1,US="firebase-heartbeat-store";let v4=null;function Lee(){return v4||(v4=F0e(xve,wve,{upgrade:(s,n)=>{switch(n){case 0:try{s.createObjectStore(US)}catch(i){console.warn(i)}}}}).catch(s=>{throw tm.create("idb-open",{originalErrorMessage:s.message})})),v4}async function Sve(s){try{const i=(await Lee()).transaction(US),l=await i.objectStore(US).get(jee(s));return await i.done,l}catch(n){if(n instanceof th)op.warn(n.message);else{const i=tm.create("idb-get",{originalErrorMessage:n==null?void 0:n.message});op.warn(i.message)}}}async function r$(s,n){try{const l=(await Lee()).transaction(US,"readwrite");await l.objectStore(US).put(n,jee(s)),await l.done}catch(i){if(i instanceof th)op.warn(i.message);else{const l=tm.create("idb-set",{originalErrorMessage:i==null?void 0:i.message});op.warn(l.message)}}}function jee(s){return`${s.name}!${s.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tve=1024,Rve=30*24*60*60*1e3;class Cve{constructor(n){this.container=n,this._heartbeatsCache=null;const i=this.container.getProvider("app").getImmediate();this._storage=new Ive(i),this._heartbeatsCachePromise=this._storage.read().then(l=>(this._heartbeatsCache=l,l))}async triggerHeartbeat(){var n,i;try{const u=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),p=s$();return((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((i=this._heartbeatsCache)===null||i===void 0?void 0:i.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===p||this._heartbeatsCache.heartbeats.some(g=>g.date===p)?void 0:(this._heartbeatsCache.heartbeats.push({date:p,agent:u}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(g=>{const y=new Date(g.date).valueOf();return Date.now()-y<=Rve}),this._storage.overwrite(this._heartbeatsCache))}catch(l){op.warn(l)}}async getHeartbeatsHeader(){var n;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const i=s$(),{heartbeatsToSend:l,unsentEntries:u}=Nve(this._heartbeatsCache.heartbeats),p=W1(JSON.stringify({version:2,heartbeats:l}));return this._heartbeatsCache.lastSentHeartbeatDate=i,u.length>0?(this._heartbeatsCache.heartbeats=u,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),p}catch(i){return op.warn(i),""}}}function s$(){return new Date().toISOString().substring(0,10)}function Nve(s,n=Tve){const i=[];let l=s.slice();for(const u of s){const p=i.find(g=>g.agent===u.agent);if(p){if(p.dates.push(u.date),i$(i)>n){p.dates.pop();break}}else if(i.push({agent:u.agent,dates:[u.date]}),i$(i)>n){i.pop();break}l=l.slice(1)}return{heartbeatsToSend:i,unsentEntries:l}}class Ive{constructor(n){this.app=n,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return m0e()?g0e().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const i=await Sve(this.app);return i!=null&&i.heartbeats?i:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(n){var i;if(await this._canUseIndexedDBPromise){const u=await this.read();return r$(this.app,{lastSentHeartbeatDate:(i=n.lastSentHeartbeatDate)!==null&&i!==void 0?i:u.lastSentHeartbeatDate,heartbeats:n.heartbeats})}else return}async add(n){var i;if(await this._canUseIndexedDBPromise){const u=await this.read();return r$(this.app,{lastSentHeartbeatDate:(i=n.lastSentHeartbeatDate)!==null&&i!==void 0?i:u.lastSentHeartbeatDate,heartbeats:[...u.heartbeats,...n.heartbeats]})}else return}}function i$(s){return W1(JSON.stringify({version:2,heartbeats:s})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ave(s){T_(new lm("platform-logger",n=>new G0e(n),"PRIVATE")),T_(new lm("heartbeat",n=>new Cve(n),"PRIVATE")),Ku(V5,t$,s),Ku(V5,t$,"esm2017"),Ku("fire-js","")}Ave("");function S3(s,n){var i={};for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&n.indexOf(l)<0&&(i[l]=s[l]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,l=Object.getOwnPropertySymbols(s);u<l.length;u++)n.indexOf(l[u])<0&&Object.prototype.propertyIsEnumerable.call(s,l[u])&&(i[l[u]]=s[l[u]]);return i}function Mee(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const kve=Mee,Uee=new oT("auth","Firebase",Mee());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K1=new b3("@firebase/auth");function Ove(s,...n){K1.logLevel<=Cr.WARN&&K1.warn(`Auth (${j_}): ${s}`,...n)}function c1(s,...n){K1.logLevel<=Cr.ERROR&&K1.error(`Auth (${j_}): ${s}`,...n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qc(s,...n){throw C3(s,...n)}function Wl(s,...n){return C3(s,...n)}function T3(s,n,i){const l=Object.assign(Object.assign({},kve()),{[n]:i});return new oT("auth","Firebase",l).create(n,{appName:s.name})}function qu(s){return T3(s,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function R3(s,n,i){const l=i;if(!(n instanceof l))throw l.name!==n.constructor.name&&Qc(s,"argument-error"),T3(s,"argument-error",`Type of ${n.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function C3(s,...n){if(typeof s!="string"){const i=n[0],l=[...n.slice(1)];return l[0]&&(l[0].appName=s.name),s._errorFactory.create(i,...l)}return Uee.create(s,...n)}function wn(s,n,...i){if(!s)throw C3(n,...i)}function Yh(s){const n="INTERNAL ASSERTION FAILED: "+s;throw c1(n),new Error(n)}function cp(s,n){s||Yh(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z5(){var s;return typeof self<"u"&&((s=self.location)===null||s===void 0?void 0:s.href)||""}function Dve(){return a$()==="http:"||a$()==="https:"}function a$(){var s;return typeof self<"u"&&((s=self.location)===null||s===void 0?void 0:s.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pve(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Dve()||u0e()||"connection"in navigator)?navigator.onLine:!0}function Lve(){if(typeof navigator>"u")return null;const s=navigator;return s.languages&&s.languages[0]||s.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lT{constructor(n,i){this.shortDelay=n,this.longDelay=i,cp(i>n,"Short delay should be less than long delay!"),this.isMobile=c0e()||h0e()}get(){return Pve()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N3(s,n){cp(s.emulator,"Emulator should always be set here");const{url:i}=s.emulator;return n?`${i}${n.startsWith("/")?n.slice(1):n}`:i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vee{static initialize(n,i,l){this.fetchImpl=n,i&&(this.headersImpl=i),l&&(this.responseImpl=l)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Yh("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Yh("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Yh("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jve={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mve=new lT(3e4,6e4);function nh(s,n){return s.tenantId&&!n.tenantId?Object.assign(Object.assign({},n),{tenantId:s.tenantId}):n}async function rh(s,n,i,l,u={}){return Fee(s,u,async()=>{let p={},g={};l&&(n==="GET"?g=l:p={body:JSON.stringify(l)});const y=cT(Object.assign({key:s.config.apiKey},g)).slice(1),x=await s._getAdditionalHeaders();x["Content-Type"]="application/json",s.languageCode&&(x["X-Firebase-Locale"]=s.languageCode);const C=Object.assign({method:n,headers:x},p);return d0e()||(C.referrerPolicy="no-referrer"),Vee.fetch()(Bee(s,s.config.apiHost,i,y),C)})}async function Fee(s,n,i){s._canInitEmulator=!1;const l=Object.assign(Object.assign({},jve),n);try{const u=new Vve(s),p=await Promise.race([i(),u.promise]);u.clearNetworkTimeout();const g=await p.json();if("needConfirmation"in g)throw VA(s,"account-exists-with-different-credential",g);if(p.ok&&!("errorMessage"in g))return g;{const y=p.ok?g.errorMessage:g.error.message,[x,C]=y.split(" : ");if(x==="FEDERATED_USER_ID_ALREADY_LINKED")throw VA(s,"credential-already-in-use",g);if(x==="EMAIL_EXISTS")throw VA(s,"email-already-in-use",g);if(x==="USER_DISABLED")throw VA(s,"user-disabled",g);const k=l[x]||x.toLowerCase().replace(/[_\s]+/g,"-");if(C)throw T3(s,k,C);Qc(s,k)}}catch(u){if(u instanceof th)throw u;Qc(s,"network-request-failed",{message:String(u)})}}async function dT(s,n,i,l,u={}){const p=await rh(s,n,i,l,u);return"mfaPendingCredential"in p&&Qc(s,"multi-factor-auth-required",{_serverResponse:p}),p}function Bee(s,n,i,l){const u=`${n}${i}?${l}`;return s.config.emulator?N3(s.config,u):`${s.config.apiScheme}://${u}`}function Uve(s){switch(s){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Vve{constructor(n){this.auth=n,this.timer=null,this.promise=new Promise((i,l)=>{this.timer=setTimeout(()=>l(Wl(this.auth,"network-request-failed")),Mve.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function VA(s,n,i){const l={appName:s.name};i.email&&(l.email=i.email),i.phoneNumber&&(l.phoneNumber=i.phoneNumber);const u=Wl(s,n,l);return u.customData._tokenResponse=i,u}function o$(s){return s!==void 0&&s.enterprise!==void 0}class Fve{constructor(n){if(this.siteKey="",this.recaptchaEnforcementState=[],n.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=n.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=n.recaptchaEnforcementState}getProviderEnforcementState(n){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const i of this.recaptchaEnforcementState)if(i.provider&&i.provider===n)return Uve(i.enforcementState);return null}isProviderEnabled(n){return this.getProviderEnforcementState(n)==="ENFORCE"||this.getProviderEnforcementState(n)==="AUDIT"}}async function Bve(s,n){return rh(s,"GET","/v2/recaptchaConfig",nh(s,n))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zve(s,n){return rh(s,"POST","/v1/accounts:delete",n)}async function zee(s,n){return rh(s,"POST","/v1/accounts:lookup",n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oS(s){if(s)try{const n=new Date(Number(s));if(!isNaN(n.getTime()))return n.toUTCString()}catch{}}async function Gve(s,n=!1){const i=as(s),l=await i.getIdToken(n),u=I3(l);wn(u&&u.exp&&u.auth_time&&u.iat,i.auth,"internal-error");const p=typeof u.firebase=="object"?u.firebase:void 0,g=p==null?void 0:p.sign_in_provider;return{claims:u,token:l,authTime:oS(E4(u.auth_time)),issuedAtTime:oS(E4(u.iat)),expirationTime:oS(E4(u.exp)),signInProvider:g||null,signInSecondFactor:(p==null?void 0:p.sign_in_second_factor)||null}}function E4(s){return Number(s)*1e3}function I3(s){const[n,i,l]=s.split(".");if(n===void 0||i===void 0||l===void 0)return c1("JWT malformed, contained fewer than 3 sections"),null;try{const u=Ree(i);return u?JSON.parse(u):(c1("Failed to decode base64 JWT payload"),null)}catch(u){return c1("Caught error parsing JWT payload as JSON",u==null?void 0:u.toString()),null}}function c$(s){const n=I3(s);return wn(n,"internal-error"),wn(typeof n.exp<"u","internal-error"),wn(typeof n.iat<"u","internal-error"),Number(n.exp)-Number(n.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VS(s,n,i=!1){if(i)return n;try{return await n}catch(l){throw l instanceof th&&Wve(l)&&s.auth.currentUser===s&&await s.auth.signOut(),l}}function Wve({code:s}){return s==="auth/user-disabled"||s==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hve{constructor(n){this.user=n,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(n){var i;if(n){const l=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),l}else{this.errorBackoff=3e4;const u=((i=this.user.stsTokenManager.expirationTime)!==null&&i!==void 0?i:0)-Date.now()-3e5;return Math.max(0,u)}}schedule(n=!1){if(!this.isRunning)return;const i=this.getInterval(n);this.timerId=setTimeout(async()=>{await this.iteration()},i)}async iteration(){try{await this.user.getIdToken(!0)}catch(n){(n==null?void 0:n.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G5{constructor(n,i){this.createdAt=n,this.lastLoginAt=i,this._initializeTime()}_initializeTime(){this.lastSignInTime=oS(this.lastLoginAt),this.creationTime=oS(this.createdAt)}_copy(n){this.createdAt=n.createdAt,this.lastLoginAt=n.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function q1(s){var n;const i=s.auth,l=await s.getIdToken(),u=await VS(s,zee(i,{idToken:l}));wn(u==null?void 0:u.users.length,i,"internal-error");const p=u.users[0];s._notifyReloadListener(p);const g=!((n=p.providerUserInfo)===null||n===void 0)&&n.length?Gee(p.providerUserInfo):[],y=qve(s.providerData,g),x=s.isAnonymous,C=!(s.email&&p.passwordHash)&&!(y!=null&&y.length),k=x?C:!1,A={uid:p.localId,displayName:p.displayName||null,photoURL:p.photoUrl||null,email:p.email||null,emailVerified:p.emailVerified||!1,phoneNumber:p.phoneNumber||null,tenantId:p.tenantId||null,providerData:y,metadata:new G5(p.createdAt,p.lastLoginAt),isAnonymous:k};Object.assign(s,A)}async function Kve(s){const n=as(s);await q1(n),await n.auth._persistUserIfCurrent(n),n.auth._notifyListenersIfCurrent(n)}function qve(s,n){return[...s.filter(l=>!n.some(u=>u.providerId===l.providerId)),...n]}function Gee(s){return s.map(n=>{var{providerId:i}=n,l=S3(n,["providerId"]);return{providerId:i,uid:l.rawId||"",displayName:l.displayName||null,email:l.email||null,phoneNumber:l.phoneNumber||null,photoURL:l.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Yve(s,n){const i=await Fee(s,{},async()=>{const l=cT({grant_type:"refresh_token",refresh_token:n}).slice(1),{tokenApiHost:u,apiKey:p}=s.config,g=Bee(s,u,"/v1/token",`key=${p}`),y=await s._getAdditionalHeaders();return y["Content-Type"]="application/x-www-form-urlencoded",Vee.fetch()(g,{method:"POST",headers:y,body:l})});return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}async function Xve(s,n){return rh(s,"POST","/v2/accounts:revokeToken",nh(s,n))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qE{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(n){wn(n.idToken,"internal-error"),wn(typeof n.idToken<"u","internal-error"),wn(typeof n.refreshToken<"u","internal-error");const i="expiresIn"in n&&typeof n.expiresIn<"u"?Number(n.expiresIn):c$(n.idToken);this.updateTokensAndExpiration(n.idToken,n.refreshToken,i)}updateFromIdToken(n){wn(n.length!==0,"internal-error");const i=c$(n);this.updateTokensAndExpiration(n,null,i)}async getToken(n,i=!1){return!i&&this.accessToken&&!this.isExpired?this.accessToken:(wn(this.refreshToken,n,"user-token-expired"),this.refreshToken?(await this.refresh(n,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(n,i){const{accessToken:l,refreshToken:u,expiresIn:p}=await Yve(n,i);this.updateTokensAndExpiration(l,u,Number(p))}updateTokensAndExpiration(n,i,l){this.refreshToken=i||null,this.accessToken=n||null,this.expirationTime=Date.now()+l*1e3}static fromJSON(n,i){const{refreshToken:l,accessToken:u,expirationTime:p}=i,g=new qE;return l&&(wn(typeof l=="string","internal-error",{appName:n}),g.refreshToken=l),u&&(wn(typeof u=="string","internal-error",{appName:n}),g.accessToken=u),p&&(wn(typeof p=="number","internal-error",{appName:n}),g.expirationTime=p),g}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(n){this.accessToken=n.accessToken,this.refreshToken=n.refreshToken,this.expirationTime=n.expirationTime}_clone(){return Object.assign(new qE,this.toJSON())}_performRefresh(){return Yh("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Af(s,n){wn(typeof s=="string"||typeof s>"u","internal-error",{appName:n})}class Xh{constructor(n){var{uid:i,auth:l,stsTokenManager:u}=n,p=S3(n,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Hve(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=i,this.auth=l,this.stsTokenManager=u,this.accessToken=u.accessToken,this.displayName=p.displayName||null,this.email=p.email||null,this.emailVerified=p.emailVerified||!1,this.phoneNumber=p.phoneNumber||null,this.photoURL=p.photoURL||null,this.isAnonymous=p.isAnonymous||!1,this.tenantId=p.tenantId||null,this.providerData=p.providerData?[...p.providerData]:[],this.metadata=new G5(p.createdAt||void 0,p.lastLoginAt||void 0)}async getIdToken(n){const i=await VS(this,this.stsTokenManager.getToken(this.auth,n));return wn(i,this.auth,"internal-error"),this.accessToken!==i&&(this.accessToken=i,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),i}getIdTokenResult(n){return Gve(this,n)}reload(){return Kve(this)}_assign(n){this!==n&&(wn(this.uid===n.uid,this.auth,"internal-error"),this.displayName=n.displayName,this.photoURL=n.photoURL,this.email=n.email,this.emailVerified=n.emailVerified,this.phoneNumber=n.phoneNumber,this.isAnonymous=n.isAnonymous,this.tenantId=n.tenantId,this.providerData=n.providerData.map(i=>Object.assign({},i)),this.metadata._copy(n.metadata),this.stsTokenManager._assign(n.stsTokenManager))}_clone(n){const i=new Xh(Object.assign(Object.assign({},this),{auth:n,stsTokenManager:this.stsTokenManager._clone()}));return i.metadata._copy(this.metadata),i}_onReload(n){wn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=n,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(n){this.reloadListener?this.reloadListener(n):this.reloadUserInfo=n}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(n,i=!1){let l=!1;n.idToken&&n.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(n),l=!0),i&&await q1(this),await this.auth._persistUserIfCurrent(this),l&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Wc(this.auth.app))return Promise.reject(qu(this.auth));const n=await this.getIdToken();return await VS(this,zve(this.auth,{idToken:n})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(n=>Object.assign({},n)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(n,i){var l,u,p,g,y,x,C,k;const A=(l=i.displayName)!==null&&l!==void 0?l:void 0,M=(u=i.email)!==null&&u!==void 0?u:void 0,G=(p=i.phoneNumber)!==null&&p!==void 0?p:void 0,B=(g=i.photoURL)!==null&&g!==void 0?g:void 0,X=(y=i.tenantId)!==null&&y!==void 0?y:void 0,Z=(x=i._redirectEventId)!==null&&x!==void 0?x:void 0,q=(C=i.createdAt)!==null&&C!==void 0?C:void 0,V=(k=i.lastLoginAt)!==null&&k!==void 0?k:void 0,{uid:ee,emailVerified:de,isAnonymous:ae,providerData:ye,stsTokenManager:Q}=i;wn(ee&&Q,n,"internal-error");const $=qE.fromJSON(this.name,Q);wn(typeof ee=="string",n,"internal-error"),Af(A,n.name),Af(M,n.name),wn(typeof de=="boolean",n,"internal-error"),wn(typeof ae=="boolean",n,"internal-error"),Af(G,n.name),Af(B,n.name),Af(X,n.name),Af(Z,n.name),Af(q,n.name),Af(V,n.name);const se=new Xh({uid:ee,auth:n,email:M,emailVerified:de,displayName:A,isAnonymous:ae,photoURL:B,phoneNumber:G,tenantId:X,stsTokenManager:$,createdAt:q,lastLoginAt:V});return ye&&Array.isArray(ye)&&(se.providerData=ye.map(ce=>Object.assign({},ce))),Z&&(se._redirectEventId=Z),se}static async _fromIdTokenResponse(n,i,l=!1){const u=new qE;u.updateFromServerResponse(i);const p=new Xh({uid:i.localId,auth:n,stsTokenManager:u,isAnonymous:l});return await q1(p),p}static async _fromGetAccountInfoResponse(n,i,l){const u=i.users[0];wn(u.localId!==void 0,"internal-error");const p=u.providerUserInfo!==void 0?Gee(u.providerUserInfo):[],g=!(u.email&&u.passwordHash)&&!(p!=null&&p.length),y=new qE;y.updateFromIdToken(l);const x=new Xh({uid:u.localId,auth:n,stsTokenManager:y,isAnonymous:g}),C={uid:u.localId,displayName:u.displayName||null,photoURL:u.photoUrl||null,email:u.email||null,emailVerified:u.emailVerified||!1,phoneNumber:u.phoneNumber||null,tenantId:u.tenantId||null,providerData:p,metadata:new G5(u.createdAt,u.lastLoginAt),isAnonymous:!(u.email&&u.passwordHash)&&!(p!=null&&p.length)};return Object.assign(x,C),x}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l$=new Map;function $h(s){cp(s instanceof Function,"Expected a class definition");let n=l$.get(s);return n?(cp(n instanceof s,"Instance stored in cache mismatched with class"),n):(n=new s,l$.set(s,n),n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wee{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(n,i){this.storage[n]=i}async _get(n){const i=this.storage[n];return i===void 0?null:i}async _remove(n){delete this.storage[n]}_addListener(n,i){}_removeListener(n,i){}}Wee.type="NONE";const d$=Wee;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l1(s,n,i){return`firebase:${s}:${n}:${i}`}class YE{constructor(n,i,l){this.persistence=n,this.auth=i,this.userKey=l;const{config:u,name:p}=this.auth;this.fullUserKey=l1(this.userKey,u.apiKey,p),this.fullPersistenceKey=l1("persistence",u.apiKey,p),this.boundEventHandler=i._onStorageEvent.bind(i),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(n){return this.persistence._set(this.fullUserKey,n.toJSON())}async getCurrentUser(){const n=await this.persistence._get(this.fullUserKey);return n?Xh._fromJSON(this.auth,n):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(n){if(this.persistence===n)return;const i=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=n,i)return this.setCurrentUser(i)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(n,i,l="authUser"){if(!i.length)return new YE($h(d$),n,l);const u=(await Promise.all(i.map(async C=>{if(await C._isAvailable())return C}))).filter(C=>C);let p=u[0]||$h(d$);const g=l1(l,n.config.apiKey,n.name);let y=null;for(const C of i)try{const k=await C._get(g);if(k){const A=Xh._fromJSON(n,k);C!==p&&(y=A),p=C;break}}catch{}const x=u.filter(C=>C._shouldAllowMigration);return!p._shouldAllowMigration||!x.length?new YE(p,n,l):(p=x[0],y&&await p._set(g,y.toJSON()),await Promise.all(i.map(async C=>{if(C!==p)try{await C._remove(g)}catch{}})),new YE(p,n,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u$(s){const n=s.toLowerCase();if(n.includes("opera/")||n.includes("opr/")||n.includes("opios/"))return"Opera";if(Yee(n))return"IEMobile";if(n.includes("msie")||n.includes("trident/"))return"IE";if(n.includes("edge/"))return"Edge";if(Hee(n))return"Firefox";if(n.includes("silk/"))return"Silk";if($ee(n))return"Blackberry";if(Jee(n))return"Webos";if(Kee(n))return"Safari";if((n.includes("chrome/")||qee(n))&&!n.includes("edge/"))return"Chrome";if(Xee(n))return"Android";{const i=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,l=s.match(i);if((l==null?void 0:l.length)===2)return l[1]}return"Other"}function Hee(s=Eo()){return/firefox\//i.test(s)}function Kee(s=Eo()){const n=s.toLowerCase();return n.includes("safari/")&&!n.includes("chrome/")&&!n.includes("crios/")&&!n.includes("android")}function qee(s=Eo()){return/crios\//i.test(s)}function Yee(s=Eo()){return/iemobile/i.test(s)}function Xee(s=Eo()){return/android/i.test(s)}function $ee(s=Eo()){return/blackberry/i.test(s)}function Jee(s=Eo()){return/webos/i.test(s)}function A3(s=Eo()){return/iphone|ipad|ipod/i.test(s)||/macintosh/i.test(s)&&/mobile/i.test(s)}function $ve(s=Eo()){var n;return A3(s)&&!!(!((n=window.navigator)===null||n===void 0)&&n.standalone)}function Jve(){return p0e()&&document.documentMode===10}function Qee(s=Eo()){return A3(s)||Xee(s)||Jee(s)||$ee(s)||/windows phone/i.test(s)||Yee(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zee(s,n=[]){let i;switch(s){case"Browser":i=u$(Eo());break;case"Worker":i=`${u$(Eo())}-${s}`;break;default:i=s}const l=n.length?n.join(","):"FirebaseCore-web";return`${i}/JsCore/${j_}/${l}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qve{constructor(n){this.auth=n,this.queue=[]}pushCallback(n,i){const l=p=>new Promise((g,y)=>{try{const x=n(p);g(x)}catch(x){y(x)}});l.onAbort=i,this.queue.push(l);const u=this.queue.length-1;return()=>{this.queue[u]=()=>Promise.resolve()}}async runMiddleware(n){if(this.auth.currentUser===n)return;const i=[];try{for(const l of this.queue)await l(n),l.onAbort&&i.push(l.onAbort)}catch(l){i.reverse();for(const u of i)try{u()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:l==null?void 0:l.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zve(s,n={}){return rh(s,"GET","/v2/passwordPolicy",nh(s,n))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eEe=6;class tEe{constructor(n){var i,l,u,p;const g=n.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(i=g.minPasswordLength)!==null&&i!==void 0?i:eEe,g.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=g.maxPasswordLength),g.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=g.containsLowercaseCharacter),g.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=g.containsUppercaseCharacter),g.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=g.containsNumericCharacter),g.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=g.containsNonAlphanumericCharacter),this.enforcementState=n.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(u=(l=n.allowedNonAlphanumericCharacters)===null||l===void 0?void 0:l.join(""))!==null&&u!==void 0?u:"",this.forceUpgradeOnSignin=(p=n.forceUpgradeOnSignin)!==null&&p!==void 0?p:!1,this.schemaVersion=n.schemaVersion}validatePassword(n){var i,l,u,p,g,y;const x={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(n,x),this.validatePasswordCharacterOptions(n,x),x.isValid&&(x.isValid=(i=x.meetsMinPasswordLength)!==null&&i!==void 0?i:!0),x.isValid&&(x.isValid=(l=x.meetsMaxPasswordLength)!==null&&l!==void 0?l:!0),x.isValid&&(x.isValid=(u=x.containsLowercaseLetter)!==null&&u!==void 0?u:!0),x.isValid&&(x.isValid=(p=x.containsUppercaseLetter)!==null&&p!==void 0?p:!0),x.isValid&&(x.isValid=(g=x.containsNumericCharacter)!==null&&g!==void 0?g:!0),x.isValid&&(x.isValid=(y=x.containsNonAlphanumericCharacter)!==null&&y!==void 0?y:!0),x}validatePasswordLengthOptions(n,i){const l=this.customStrengthOptions.minPasswordLength,u=this.customStrengthOptions.maxPasswordLength;l&&(i.meetsMinPasswordLength=n.length>=l),u&&(i.meetsMaxPasswordLength=n.length<=u)}validatePasswordCharacterOptions(n,i){this.updatePasswordCharacterOptionsStatuses(i,!1,!1,!1,!1);let l;for(let u=0;u<n.length;u++)l=n.charAt(u),this.updatePasswordCharacterOptionsStatuses(i,l>="a"&&l<="z",l>="A"&&l<="Z",l>="0"&&l<="9",this.allowedNonAlphanumericCharacters.includes(l))}updatePasswordCharacterOptionsStatuses(n,i,l,u,p){this.customStrengthOptions.containsLowercaseLetter&&(n.containsLowercaseLetter||(n.containsLowercaseLetter=i)),this.customStrengthOptions.containsUppercaseLetter&&(n.containsUppercaseLetter||(n.containsUppercaseLetter=l)),this.customStrengthOptions.containsNumericCharacter&&(n.containsNumericCharacter||(n.containsNumericCharacter=u)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(n.containsNonAlphanumericCharacter||(n.containsNonAlphanumericCharacter=p))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nEe{constructor(n,i,l,u){this.app=n,this.heartbeatServiceProvider=i,this.appCheckServiceProvider=l,this.config=u,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new h$(this),this.idTokenSubscription=new h$(this),this.beforeStateQueue=new Qve(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Uee,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=n.name,this.clientVersion=u.sdkClientVersion}_initializeWithPersistence(n,i){return i&&(this._popupRedirectResolver=$h(i)),this._initializationPromise=this.queue(async()=>{var l,u;if(!this._deleted&&(this.persistenceManager=await YE.create(this,n),!this._deleted)){if(!((l=this._popupRedirectResolver)===null||l===void 0)&&l._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(i),this.lastNotifiedUid=((u=this.currentUser)===null||u===void 0?void 0:u.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const n=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!n)){if(this.currentUser&&n&&this.currentUser.uid===n.uid){this._currentUser._assign(n),await this.currentUser.getIdToken();return}await this._updateCurrentUser(n,!0)}}async initializeCurrentUserFromIdToken(n){try{const i=await zee(this,{idToken:n}),l=await Xh._fromGetAccountInfoResponse(this,i,n);await this.directlySetCurrentUser(l)}catch(i){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",i),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(n){var i;if(Wc(this.app)){const g=this.app.settings.authIdToken;return g?new Promise(y=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(g).then(y,y))}):this.directlySetCurrentUser(null)}const l=await this.assertedPersistence.getCurrentUser();let u=l,p=!1;if(n&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const g=(i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId,y=u==null?void 0:u._redirectEventId,x=await this.tryRedirectSignIn(n);(!g||g===y)&&(x!=null&&x.user)&&(u=x.user,p=!0)}if(!u)return this.directlySetCurrentUser(null);if(!u._redirectEventId){if(p)try{await this.beforeStateQueue.runMiddleware(u)}catch(g){u=l,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(g))}return u?this.reloadAndSetCurrentUserOrClear(u):this.directlySetCurrentUser(null)}return wn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===u._redirectEventId?this.directlySetCurrentUser(u):this.reloadAndSetCurrentUserOrClear(u)}async tryRedirectSignIn(n){let i=null;try{i=await this._popupRedirectResolver._completeRedirectFn(this,n,!0)}catch{await this._setRedirectUser(null)}return i}async reloadAndSetCurrentUserOrClear(n){try{await q1(n)}catch(i){if((i==null?void 0:i.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(n)}useDeviceLanguage(){this.languageCode=Lve()}async _delete(){this._deleted=!0}async updateCurrentUser(n){if(Wc(this.app))return Promise.reject(qu(this));const i=n?as(n):null;return i&&wn(i.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(i&&i._clone(this))}async _updateCurrentUser(n,i=!1){if(!this._deleted)return n&&wn(this.tenantId===n.tenantId,this,"tenant-id-mismatch"),i||await this.beforeStateQueue.runMiddleware(n),this.queue(async()=>{await this.directlySetCurrentUser(n),this.notifyAuthListeners()})}async signOut(){return Wc(this.app)?Promise.reject(qu(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(n){return Wc(this.app)?Promise.reject(qu(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence($h(n))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(n){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const i=this._getPasswordPolicyInternal();return i.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):i.validatePassword(n)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const n=await Zve(this),i=new tEe(n);this.tenantId===null?this._projectPasswordPolicy=i:this._tenantPasswordPolicies[this.tenantId]=i}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(n){this._errorFactory=new oT("auth","Firebase",n())}onAuthStateChanged(n,i,l){return this.registerStateListener(this.authStateSubscription,n,i,l)}beforeAuthStateChanged(n,i){return this.beforeStateQueue.pushCallback(n,i)}onIdTokenChanged(n,i,l){return this.registerStateListener(this.idTokenSubscription,n,i,l)}authStateReady(){return new Promise((n,i)=>{if(this.currentUser)n();else{const l=this.onAuthStateChanged(()=>{l(),n()},i)}})}async revokeAccessToken(n){if(this.currentUser){const i=await this.currentUser.getIdToken(),l={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:n,idToken:i};this.tenantId!=null&&(l.tenantId=this.tenantId),await Xve(this,l)}}toJSON(){var n;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(n=this._currentUser)===null||n===void 0?void 0:n.toJSON()}}async _setRedirectUser(n,i){const l=await this.getOrInitRedirectPersistenceManager(i);return n===null?l.removeCurrentUser():l.setCurrentUser(n)}async getOrInitRedirectPersistenceManager(n){if(!this.redirectPersistenceManager){const i=n&&$h(n)||this._popupRedirectResolver;wn(i,this,"argument-error"),this.redirectPersistenceManager=await YE.create(this,[$h(i._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(n){var i,l;return this._isInitialized&&await this.queue(async()=>{}),((i=this._currentUser)===null||i===void 0?void 0:i._redirectEventId)===n?this._currentUser:((l=this.redirectUser)===null||l===void 0?void 0:l._redirectEventId)===n?this.redirectUser:null}async _persistUserIfCurrent(n){if(n===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(n))}_notifyListenersIfCurrent(n){n===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var n,i;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const l=(i=(n=this.currentUser)===null||n===void 0?void 0:n.uid)!==null&&i!==void 0?i:null;this.lastNotifiedUid!==l&&(this.lastNotifiedUid=l,this.authStateSubscription.next(this.currentUser))}registerStateListener(n,i,l,u){if(this._deleted)return()=>{};const p=typeof i=="function"?i:i.next.bind(i);let g=!1;const y=this._isInitialized?Promise.resolve():this._initializationPromise;if(wn(y,this,"internal-error"),y.then(()=>{g||p(this.currentUser)}),typeof i=="function"){const x=n.addObserver(i,l,u);return()=>{g=!0,x()}}else{const x=n.addObserver(i);return()=>{g=!0,x()}}}async directlySetCurrentUser(n){this.currentUser&&this.currentUser!==n&&this._currentUser._stopProactiveRefresh(),n&&this.isProactiveRefreshEnabled&&n._startProactiveRefresh(),this.currentUser=n,n?await this.assertedPersistence.setCurrentUser(n):await this.assertedPersistence.removeCurrentUser()}queue(n){return this.operations=this.operations.then(n,n),this.operations}get assertedPersistence(){return wn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(n){!n||this.frameworks.includes(n)||(this.frameworks.push(n),this.frameworks.sort(),this.clientVersion=Zee(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var n;const i={"X-Client-Version":this.clientVersion};this.app.options.appId&&(i["X-Firebase-gmpid"]=this.app.options.appId);const l=await((n=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||n===void 0?void 0:n.getHeartbeatsHeader());l&&(i["X-Firebase-Client"]=l);const u=await this._getAppCheckToken();return u&&(i["X-Firebase-AppCheck"]=u),i}async _getAppCheckToken(){var n;const i=await((n=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||n===void 0?void 0:n.getToken());return i!=null&&i.error&&Ove(`Error while retrieving App Check token: ${i.error}`),i==null?void 0:i.token}}function Yl(s){return as(s)}class h${constructor(n){this.auth=n,this.observer=null,this.addObserver=b0e(i=>this.observer=i)}get next(){return wn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Vk={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function rEe(s){Vk=s}function ete(s){return Vk.loadJS(s)}function sEe(){return Vk.recaptchaEnterpriseScript}function iEe(){return Vk.gapiScript}function aEe(s){return`__${s}${Math.floor(Math.random()*1e6)}`}const oEe="recaptcha-enterprise",cEe="NO_RECAPTCHA";class lEe{constructor(n){this.type=oEe,this.auth=Yl(n)}async verify(n="verify",i=!1){async function l(p){if(!i){if(p.tenantId==null&&p._agentRecaptchaConfig!=null)return p._agentRecaptchaConfig.siteKey;if(p.tenantId!=null&&p._tenantRecaptchaConfigs[p.tenantId]!==void 0)return p._tenantRecaptchaConfigs[p.tenantId].siteKey}return new Promise(async(g,y)=>{Bve(p,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(x=>{if(x.recaptchaKey===void 0)y(new Error("recaptcha Enterprise site key undefined"));else{const C=new Fve(x);return p.tenantId==null?p._agentRecaptchaConfig=C:p._tenantRecaptchaConfigs[p.tenantId]=C,g(C.siteKey)}}).catch(x=>{y(x)})})}function u(p,g,y){const x=window.grecaptcha;o$(x)?x.enterprise.ready(()=>{x.enterprise.execute(p,{action:n}).then(C=>{g(C)}).catch(()=>{g(cEe)})}):y(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((p,g)=>{l(this.auth).then(y=>{if(!i&&o$(window.grecaptcha))u(y,p,g);else{if(typeof window>"u"){g(new Error("RecaptchaVerifier is only supported in browser"));return}let x=sEe();x.length!==0&&(x+=y),ete(x).then(()=>{u(y,p,g)}).catch(C=>{g(C)})}}).catch(y=>{g(y)})})}}async function p$(s,n,i,l=!1){const u=new lEe(s);let p;try{p=await u.verify(i)}catch{p=await u.verify(i,!0)}const g=Object.assign({},n);return l?Object.assign(g,{captchaResp:p}):Object.assign(g,{captchaResponse:p}),Object.assign(g,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(g,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),g}async function Y1(s,n,i,l){var u;if(!((u=s._getRecaptchaConfig())===null||u===void 0)&&u.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const p=await p$(s,n,i,i==="getOobCode");return l(s,p)}else return l(s,n).catch(async p=>{if(p.code==="auth/missing-recaptcha-token"){console.log(`${i} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const g=await p$(s,n,i,i==="getOobCode");return l(s,g)}else return Promise.reject(p)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dEe(s,n){const i=Uk(s,"auth");if(i.isInitialized()){const u=i.getImmediate(),p=i.getOptions();if(MS(p,n??{}))return u;Qc(u,"already-initialized")}return i.initialize({options:n})}function uEe(s,n){const i=(n==null?void 0:n.persistence)||[],l=(Array.isArray(i)?i:[i]).map($h);n!=null&&n.errorMap&&s._updateErrorMap(n.errorMap),s._initializeWithPersistence(l,n==null?void 0:n.popupRedirectResolver)}function hEe(s,n,i){const l=Yl(s);wn(l._canInitEmulator,l,"emulator-config-failed"),wn(/^https?:\/\//.test(n),l,"invalid-emulator-scheme");const u=!1,p=tte(n),{host:g,port:y}=pEe(n),x=y===null?"":`:${y}`;l.config.emulator={url:`${p}//${g}${x}/`},l.settings.appVerificationDisabledForTesting=!0,l.emulatorConfig=Object.freeze({host:g,port:y,protocol:p.replace(":",""),options:Object.freeze({disableWarnings:u})}),fEe()}function tte(s){const n=s.indexOf(":");return n<0?"":s.substr(0,n+1)}function pEe(s){const n=tte(s),i=/(\/\/)?([^?#/]+)/.exec(s.substr(n.length));if(!i)return{host:"",port:null};const l=i[2].split("@").pop()||"",u=/^(\[[^\]]+\])(:|$)/.exec(l);if(u){const p=u[1];return{host:p,port:f$(l.substr(p.length+1))}}else{const[p,g]=l.split(":");return{host:p,port:f$(g)}}}function f$(s){if(!s)return null;const n=Number(s);return isNaN(n)?null:n}function fEe(){function s(){const n=document.createElement("p"),i=n.style;n.innerText="Running in emulator mode. Do not use with production credentials.",i.position="fixed",i.width="100%",i.backgroundColor="#ffffff",i.border=".1em solid #000000",i.color="#b50000",i.bottom="0px",i.left="0px",i.margin="0px",i.zIndex="10000",i.textAlign="center",n.classList.add("firebase-emulator-warning"),document.body.appendChild(n)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",s):s())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k3{constructor(n,i){this.providerId=n,this.signInMethod=i}toJSON(){return Yh("not implemented")}_getIdTokenResponse(n){return Yh("not implemented")}_linkToIdToken(n,i){return Yh("not implemented")}_getReauthenticationResolver(n){return Yh("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nte(s,n){return rh(s,"POST","/v1/accounts:resetPassword",nh(s,n))}async function mEe(s,n){return rh(s,"POST","/v1/accounts:signUp",n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gEe(s,n){return dT(s,"POST","/v1/accounts:signInWithPassword",nh(s,n))}async function _Ee(s,n){return rh(s,"POST","/v1/accounts:sendOobCode",nh(s,n))}async function vEe(s,n){return _Ee(s,n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EEe(s,n){return dT(s,"POST","/v1/accounts:signInWithEmailLink",nh(s,n))}async function yEe(s,n){return dT(s,"POST","/v1/accounts:signInWithEmailLink",nh(s,n))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FS extends k3{constructor(n,i,l,u=null){super("password",l),this._email=n,this._password=i,this._tenantId=u}static _fromEmailAndPassword(n,i){return new FS(n,i,"password")}static _fromEmailAndCode(n,i,l=null){return new FS(n,i,"emailLink",l)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(n){const i=typeof n=="string"?JSON.parse(n):n;if(i!=null&&i.email&&(i!=null&&i.password)){if(i.signInMethod==="password")return this._fromEmailAndPassword(i.email,i.password);if(i.signInMethod==="emailLink")return this._fromEmailAndCode(i.email,i.password,i.tenantId)}return null}async _getIdTokenResponse(n){switch(this.signInMethod){case"password":const i={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Y1(n,i,"signInWithPassword",gEe);case"emailLink":return EEe(n,{email:this._email,oobCode:this._password});default:Qc(n,"internal-error")}}async _linkToIdToken(n,i){switch(this.signInMethod){case"password":const l={idToken:i,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Y1(n,l,"signUpPassword",mEe);case"emailLink":return yEe(n,{idToken:i,email:this._email,oobCode:this._password});default:Qc(n,"internal-error")}}_getReauthenticationResolver(n){return this._getIdTokenResponse(n)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XE(s,n){return dT(s,"POST","/v1/accounts:signInWithIdp",nh(s,n))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bEe="http://localhost";class R_ extends k3{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(n){const i=new R_(n.providerId,n.signInMethod);return n.idToken||n.accessToken?(n.idToken&&(i.idToken=n.idToken),n.accessToken&&(i.accessToken=n.accessToken),n.nonce&&!n.pendingToken&&(i.nonce=n.nonce),n.pendingToken&&(i.pendingToken=n.pendingToken)):n.oauthToken&&n.oauthTokenSecret?(i.accessToken=n.oauthToken,i.secret=n.oauthTokenSecret):Qc("argument-error"),i}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(n){const i=typeof n=="string"?JSON.parse(n):n,{providerId:l,signInMethod:u}=i,p=S3(i,["providerId","signInMethod"]);if(!l||!u)return null;const g=new R_(l,u);return g.idToken=p.idToken||void 0,g.accessToken=p.accessToken||void 0,g.secret=p.secret,g.nonce=p.nonce,g.pendingToken=p.pendingToken||null,g}_getIdTokenResponse(n){const i=this.buildRequest();return XE(n,i)}_linkToIdToken(n,i){const l=this.buildRequest();return l.idToken=i,XE(n,l)}_getReauthenticationResolver(n){const i=this.buildRequest();return i.autoCreate=!1,XE(n,i)}buildRequest(){const n={requestUri:bEe,returnSecureToken:!0};if(this.pendingToken)n.pendingToken=this.pendingToken;else{const i={};this.idToken&&(i.id_token=this.idToken),this.accessToken&&(i.access_token=this.accessToken),this.secret&&(i.oauth_token_secret=this.secret),i.providerId=this.providerId,this.nonce&&!this.pendingToken&&(i.nonce=this.nonce),n.postBody=cT(i)}return n}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xEe(s){switch(s){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function wEe(s){const n=Hw(Kw(s)).link,i=n?Hw(Kw(n)).deep_link_id:null,l=Hw(Kw(s)).deep_link_id;return(l?Hw(Kw(l)).link:null)||l||i||n||s}class O3{constructor(n){var i,l,u,p,g,y;const x=Hw(Kw(n)),C=(i=x.apiKey)!==null&&i!==void 0?i:null,k=(l=x.oobCode)!==null&&l!==void 0?l:null,A=xEe((u=x.mode)!==null&&u!==void 0?u:null);wn(C&&k&&A,"argument-error"),this.apiKey=C,this.operation=A,this.code=k,this.continueUrl=(p=x.continueUrl)!==null&&p!==void 0?p:null,this.languageCode=(g=x.languageCode)!==null&&g!==void 0?g:null,this.tenantId=(y=x.tenantId)!==null&&y!==void 0?y:null}static parseLink(n){const i=wEe(n);try{return new O3(i)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ay{constructor(){this.providerId=Ay.PROVIDER_ID}static credential(n,i){return FS._fromEmailAndPassword(n,i)}static credentialWithLink(n,i){const l=O3.parseLink(i);return wn(l,"argument-error"),FS._fromEmailAndCode(n,l.code,l.tenantId)}}Ay.PROVIDER_ID="password";Ay.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Ay.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uT{constructor(n){this.providerId=n,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(n){this.defaultLanguageCode=n}setCustomParameters(n){return this.customParameters=n,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hT extends uT{constructor(){super(...arguments),this.scopes=[]}addScope(n){return this.scopes.includes(n)||this.scopes.push(n),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lf extends hT{constructor(){super("facebook.com")}static credential(n){return R_._fromParams({providerId:Lf.PROVIDER_ID,signInMethod:Lf.FACEBOOK_SIGN_IN_METHOD,accessToken:n})}static credentialFromResult(n){return Lf.credentialFromTaggedObject(n)}static credentialFromError(n){return Lf.credentialFromTaggedObject(n.customData||{})}static credentialFromTaggedObject({_tokenResponse:n}){if(!n||!("oauthAccessToken"in n)||!n.oauthAccessToken)return null;try{return Lf.credential(n.oauthAccessToken)}catch{return null}}}Lf.FACEBOOK_SIGN_IN_METHOD="facebook.com";Lf.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bd extends hT{constructor(){super("google.com"),this.addScope("profile")}static credential(n,i){return R_._fromParams({providerId:Bd.PROVIDER_ID,signInMethod:Bd.GOOGLE_SIGN_IN_METHOD,idToken:n,accessToken:i})}static credentialFromResult(n){return Bd.credentialFromTaggedObject(n)}static credentialFromError(n){return Bd.credentialFromTaggedObject(n.customData||{})}static credentialFromTaggedObject({_tokenResponse:n}){if(!n)return null;const{oauthIdToken:i,oauthAccessToken:l}=n;if(!i&&!l)return null;try{return Bd.credential(i,l)}catch{return null}}}Bd.GOOGLE_SIGN_IN_METHOD="google.com";Bd.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jf extends hT{constructor(){super("github.com")}static credential(n){return R_._fromParams({providerId:jf.PROVIDER_ID,signInMethod:jf.GITHUB_SIGN_IN_METHOD,accessToken:n})}static credentialFromResult(n){return jf.credentialFromTaggedObject(n)}static credentialFromError(n){return jf.credentialFromTaggedObject(n.customData||{})}static credentialFromTaggedObject({_tokenResponse:n}){if(!n||!("oauthAccessToken"in n)||!n.oauthAccessToken)return null;try{return jf.credential(n.oauthAccessToken)}catch{return null}}}jf.GITHUB_SIGN_IN_METHOD="github.com";jf.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mf extends hT{constructor(){super("twitter.com")}static credential(n,i){return R_._fromParams({providerId:Mf.PROVIDER_ID,signInMethod:Mf.TWITTER_SIGN_IN_METHOD,oauthToken:n,oauthTokenSecret:i})}static credentialFromResult(n){return Mf.credentialFromTaggedObject(n)}static credentialFromError(n){return Mf.credentialFromTaggedObject(n.customData||{})}static credentialFromTaggedObject({_tokenResponse:n}){if(!n)return null;const{oauthAccessToken:i,oauthTokenSecret:l}=n;if(!i||!l)return null;try{return Mf.credential(i,l)}catch{return null}}}Mf.TWITTER_SIGN_IN_METHOD="twitter.com";Mf.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SEe(s,n){return dT(s,"POST","/v1/accounts:signUp",nh(s,n))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C_{constructor(n){this.user=n.user,this.providerId=n.providerId,this._tokenResponse=n._tokenResponse,this.operationType=n.operationType}static async _fromIdTokenResponse(n,i,l,u=!1){const p=await Xh._fromIdTokenResponse(n,l,u),g=m$(l);return new C_({user:p,providerId:g,_tokenResponse:l,operationType:i})}static async _forOperation(n,i,l){await n._updateTokensIfNecessary(l,!0);const u=m$(l);return new C_({user:n,providerId:u,_tokenResponse:l,operationType:i})}}function m$(s){return s.providerId?s.providerId:"phoneNumber"in s?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X1 extends th{constructor(n,i,l,u){var p;super(i.code,i.message),this.operationType=l,this.user=u,Object.setPrototypeOf(this,X1.prototype),this.customData={appName:n.name,tenantId:(p=n.tenantId)!==null&&p!==void 0?p:void 0,_serverResponse:i.customData._serverResponse,operationType:l}}static _fromErrorAndOperation(n,i,l,u){return new X1(n,i,l,u)}}function rte(s,n,i,l){return(n==="reauthenticate"?i._getReauthenticationResolver(s):i._getIdTokenResponse(s)).catch(p=>{throw p.code==="auth/multi-factor-auth-required"?X1._fromErrorAndOperation(s,p,n,l):p})}async function TEe(s,n,i=!1){const l=await VS(s,n._linkToIdToken(s.auth,await s.getIdToken()),i);return C_._forOperation(s,"link",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function REe(s,n,i=!1){const{auth:l}=s;if(Wc(l.app))return Promise.reject(qu(l));const u="reauthenticate";try{const p=await VS(s,rte(l,u,n,s),i);wn(p.idToken,l,"internal-error");const g=I3(p.idToken);wn(g,l,"internal-error");const{sub:y}=g;return wn(s.uid===y,l,"user-mismatch"),C_._forOperation(s,u,p)}catch(p){throw(p==null?void 0:p.code)==="auth/user-not-found"&&Qc(l,"user-mismatch"),p}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ste(s,n,i=!1){if(Wc(s.app))return Promise.reject(qu(s));const l="signIn",u=await rte(s,l,n),p=await C_._fromIdTokenResponse(s,l,u);return i||await s._updateCurrentUser(p.user),p}async function CEe(s,n){return ste(Yl(s),n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D3{constructor(n,i){this.factorId=n,this.uid=i.mfaEnrollmentId,this.enrollmentTime=new Date(i.enrolledAt).toUTCString(),this.displayName=i.displayName}static _fromServerResponse(n,i){return"phoneInfo"in i?P3._fromServerResponse(n,i):"totpInfo"in i?L3._fromServerResponse(n,i):Qc(n,"internal-error")}}class P3 extends D3{constructor(n){super("phone",n),this.phoneNumber=n.phoneInfo}static _fromServerResponse(n,i){return new P3(i)}}class L3 extends D3{constructor(n){super("totp",n)}static _fromServerResponse(n,i){return new L3(i)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function j3(s){const n=Yl(s);n._getPasswordPolicyInternal()&&await n._updatePasswordPolicy()}async function NEe(s,n,i){const l=Yl(s);await Y1(l,{requestType:"PASSWORD_RESET",email:n,clientType:"CLIENT_TYPE_WEB"},"getOobCode",vEe)}async function IEe(s,n,i){await nte(as(s),{oobCode:n,newPassword:i}).catch(async l=>{throw l.code==="auth/password-does-not-meet-requirements"&&j3(s),l})}async function AEe(s,n){const i=as(s),l=await nte(i,{oobCode:n}),u=l.requestType;switch(wn(u,i,"internal-error"),u){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":wn(l.newEmail,i,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":wn(l.mfaInfo,i,"internal-error");default:wn(l.email,i,"internal-error")}let p=null;return l.mfaInfo&&(p=D3._fromServerResponse(Yl(i),l.mfaInfo)),{data:{email:(l.requestType==="VERIFY_AND_CHANGE_EMAIL"?l.newEmail:l.email)||null,previousEmail:(l.requestType==="VERIFY_AND_CHANGE_EMAIL"?l.email:l.newEmail)||null,multiFactorInfo:p},operation:u}}async function kEe(s,n){const{data:i}=await AEe(as(s),n);return i.email}async function ite(s,n,i){if(Wc(s.app))return Promise.reject(qu(s));const l=Yl(s),g=await Y1(l,{returnSecureToken:!0,email:n,password:i,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",SEe).catch(x=>{throw x.code==="auth/password-does-not-meet-requirements"&&j3(s),x}),y=await C_._fromIdTokenResponse(l,"signIn",g);return await l._updateCurrentUser(y.user),y}function OEe(s,n,i){return Wc(s.app)?Promise.reject(qu(s)):CEe(as(s),Ay.credential(n,i)).catch(async l=>{throw l.code==="auth/password-does-not-meet-requirements"&&j3(s),l})}function DEe(s,n,i,l){return as(s).onIdTokenChanged(n,i,l)}function PEe(s,n,i){return as(s).beforeAuthStateChanged(n,i)}function LEe(s,n,i,l){return as(s).onAuthStateChanged(n,i,l)}function ate(s){return as(s).signOut()}async function g$(s){return as(s).delete()}const $1="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ote{constructor(n,i){this.storageRetriever=n,this.type=i}_isAvailable(){try{return this.storage?(this.storage.setItem($1,"1"),this.storage.removeItem($1),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(n,i){return this.storage.setItem(n,JSON.stringify(i)),Promise.resolve()}_get(n){const i=this.storage.getItem(n);return Promise.resolve(i?JSON.parse(i):null)}_remove(n){return this.storage.removeItem(n),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jEe=1e3,MEe=10;class cte extends ote{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(n,i)=>this.onStorageEvent(n,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Qee(),this._shouldAllowMigration=!0}forAllChangedKeys(n){for(const i of Object.keys(this.listeners)){const l=this.storage.getItem(i),u=this.localCache[i];l!==u&&n(i,u,l)}}onStorageEvent(n,i=!1){if(!n.key){this.forAllChangedKeys((g,y,x)=>{this.notifyListeners(g,x)});return}const l=n.key;i?this.detachListener():this.stopPolling();const u=()=>{const g=this.storage.getItem(l);!i&&this.localCache[l]===g||this.notifyListeners(l,g)},p=this.storage.getItem(l);Jve()&&p!==n.newValue&&n.newValue!==n.oldValue?setTimeout(u,MEe):u()}notifyListeners(n,i){this.localCache[n]=i;const l=this.listeners[n];if(l)for(const u of Array.from(l))u(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((n,i,l)=>{this.onStorageEvent(new StorageEvent("storage",{key:n,oldValue:i,newValue:l}),!0)})},jEe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(n,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[n]||(this.listeners[n]=new Set,this.localCache[n]=this.storage.getItem(n)),this.listeners[n].add(i)}_removeListener(n,i){this.listeners[n]&&(this.listeners[n].delete(i),this.listeners[n].size===0&&delete this.listeners[n]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(n,i){await super._set(n,i),this.localCache[n]=JSON.stringify(i)}async _get(n){const i=await super._get(n);return this.localCache[n]=JSON.stringify(i),i}async _remove(n){await super._remove(n),delete this.localCache[n]}}cte.type="LOCAL";const UEe=cte;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lte extends ote{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(n,i){}_removeListener(n,i){}}lte.type="SESSION";const dte=lte;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VEe(s){return Promise.all(s.map(async n=>{try{return{fulfilled:!0,value:await n}}catch(i){return{fulfilled:!1,reason:i}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fk{constructor(n){this.eventTarget=n,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(n){const i=this.receivers.find(u=>u.isListeningto(n));if(i)return i;const l=new Fk(n);return this.receivers.push(l),l}isListeningto(n){return this.eventTarget===n}async handleEvent(n){const i=n,{eventId:l,eventType:u,data:p}=i.data,g=this.handlersMap[u];if(!(g!=null&&g.size))return;i.ports[0].postMessage({status:"ack",eventId:l,eventType:u});const y=Array.from(g).map(async C=>C(i.origin,p)),x=await VEe(y);i.ports[0].postMessage({status:"done",eventId:l,eventType:u,response:x})}_subscribe(n,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[n]||(this.handlersMap[n]=new Set),this.handlersMap[n].add(i)}_unsubscribe(n,i){this.handlersMap[n]&&i&&this.handlersMap[n].delete(i),(!i||this.handlersMap[n].size===0)&&delete this.handlersMap[n],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Fk.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M3(s="",n=10){let i="";for(let l=0;l<n;l++)i+=Math.floor(Math.random()*10);return s+i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FEe{constructor(n){this.target=n,this.handlers=new Set}removeMessageHandler(n){n.messageChannel&&(n.messageChannel.port1.removeEventListener("message",n.onMessage),n.messageChannel.port1.close()),this.handlers.delete(n)}async _send(n,i,l=50){const u=typeof MessageChannel<"u"?new MessageChannel:null;if(!u)throw new Error("connection_unavailable");let p,g;return new Promise((y,x)=>{const C=M3("",20);u.port1.start();const k=setTimeout(()=>{x(new Error("unsupported_event"))},l);g={messageChannel:u,onMessage(A){const M=A;if(M.data.eventId===C)switch(M.data.status){case"ack":clearTimeout(k),p=setTimeout(()=>{x(new Error("timeout"))},3e3);break;case"done":clearTimeout(p),y(M.data.response);break;default:clearTimeout(k),clearTimeout(p),x(new Error("invalid_response"));break}}},this.handlers.add(g),u.port1.addEventListener("message",g.onMessage),this.target.postMessage({eventType:n,eventId:C,data:i},[u.port2])}).finally(()=>{g&&this.removeMessageHandler(g)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yu(){return window}function BEe(s){Yu().location.href=s}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ute(){return typeof Yu().WorkerGlobalScope<"u"&&typeof Yu().importScripts=="function"}async function zEe(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function GEe(){var s;return((s=navigator==null?void 0:navigator.serviceWorker)===null||s===void 0?void 0:s.controller)||null}function WEe(){return ute()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hte="firebaseLocalStorageDb",HEe=1,J1="firebaseLocalStorage",pte="fbase_key";class pT{constructor(n){this.request=n}toPromise(){return new Promise((n,i)=>{this.request.addEventListener("success",()=>{n(this.request.result)}),this.request.addEventListener("error",()=>{i(this.request.error)})})}}function Bk(s,n){return s.transaction([J1],n?"readwrite":"readonly").objectStore(J1)}function KEe(){const s=indexedDB.deleteDatabase(hte);return new pT(s).toPromise()}function W5(){const s=indexedDB.open(hte,HEe);return new Promise((n,i)=>{s.addEventListener("error",()=>{i(s.error)}),s.addEventListener("upgradeneeded",()=>{const l=s.result;try{l.createObjectStore(J1,{keyPath:pte})}catch(u){i(u)}}),s.addEventListener("success",async()=>{const l=s.result;l.objectStoreNames.contains(J1)?n(l):(l.close(),await KEe(),n(await W5()))})})}async function _$(s,n,i){const l=Bk(s,!0).put({[pte]:n,value:i});return new pT(l).toPromise()}async function qEe(s,n){const i=Bk(s,!1).get(n),l=await new pT(i).toPromise();return l===void 0?null:l.value}function v$(s,n){const i=Bk(s,!0).delete(n);return new pT(i).toPromise()}const YEe=800,XEe=3;class fte{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await W5(),this.db)}async _withRetries(n){let i=0;for(;;)try{const l=await this._openDb();return await n(l)}catch(l){if(i++>XEe)throw l;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ute()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Fk._getInstance(WEe()),this.receiver._subscribe("keyChanged",async(n,i)=>({keyProcessed:(await this._poll()).includes(i.key)})),this.receiver._subscribe("ping",async(n,i)=>["keyChanged"])}async initializeSender(){var n,i;if(this.activeServiceWorker=await zEe(),!this.activeServiceWorker)return;this.sender=new FEe(this.activeServiceWorker);const l=await this.sender._send("ping",{},800);l&&!((n=l[0])===null||n===void 0)&&n.fulfilled&&!((i=l[0])===null||i===void 0)&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(n){if(!(!this.sender||!this.activeServiceWorker||GEe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:n},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const n=await W5();return await _$(n,$1,"1"),await v$(n,$1),!0}catch{}return!1}async _withPendingWrite(n){this.pendingWrites++;try{await n()}finally{this.pendingWrites--}}async _set(n,i){return this._withPendingWrite(async()=>(await this._withRetries(l=>_$(l,n,i)),this.localCache[n]=i,this.notifyServiceWorker(n)))}async _get(n){const i=await this._withRetries(l=>qEe(l,n));return this.localCache[n]=i,i}async _remove(n){return this._withPendingWrite(async()=>(await this._withRetries(i=>v$(i,n)),delete this.localCache[n],this.notifyServiceWorker(n)))}async _poll(){const n=await this._withRetries(u=>{const p=Bk(u,!1).getAll();return new pT(p).toPromise()});if(!n)return[];if(this.pendingWrites!==0)return[];const i=[],l=new Set;if(n.length!==0)for(const{fbase_key:u,value:p}of n)l.add(u),JSON.stringify(this.localCache[u])!==JSON.stringify(p)&&(this.notifyListeners(u,p),i.push(u));for(const u of Object.keys(this.localCache))this.localCache[u]&&!l.has(u)&&(this.notifyListeners(u,null),i.push(u));return i}notifyListeners(n,i){this.localCache[n]=i;const l=this.listeners[n];if(l)for(const u of Array.from(l))u(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),YEe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(n,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[n]||(this.listeners[n]=new Set,this._get(n)),this.listeners[n].add(i)}_removeListener(n,i){this.listeners[n]&&(this.listeners[n].delete(i),this.listeners[n].size===0&&delete this.listeners[n]),Object.keys(this.listeners).length===0&&this.stopPolling()}}fte.type="LOCAL";const $Ee=fte;new lT(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zk(s,n){return n?$h(n):(wn(s._popupRedirectResolver,s,"argument-error"),s._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U3 extends k3{constructor(n){super("custom","custom"),this.params=n}_getIdTokenResponse(n){return XE(n,this._buildIdpRequest())}_linkToIdToken(n,i){return XE(n,this._buildIdpRequest(i))}_getReauthenticationResolver(n){return XE(n,this._buildIdpRequest())}_buildIdpRequest(n){const i={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return n&&(i.idToken=n),i}}function JEe(s){return ste(s.auth,new U3(s),s.bypassAuthState)}function QEe(s){const{auth:n,user:i}=s;return wn(i,n,"internal-error"),REe(i,new U3(s),s.bypassAuthState)}async function ZEe(s){const{auth:n,user:i}=s;return wn(i,n,"internal-error"),TEe(i,new U3(s),s.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mte{constructor(n,i,l,u,p=!1){this.auth=n,this.resolver=l,this.user=u,this.bypassAuthState=p,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(i)?i:[i]}execute(){return new Promise(async(n,i)=>{this.pendingPromise={resolve:n,reject:i};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(l){this.reject(l)}})}async onAuthEvent(n){const{urlResponse:i,sessionId:l,postBody:u,tenantId:p,error:g,type:y}=n;if(g){this.reject(g);return}const x={auth:this.auth,requestUri:i,sessionId:l,tenantId:p||void 0,postBody:u||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(y)(x))}catch(C){this.reject(C)}}onError(n){this.reject(n)}getIdpTask(n){switch(n){case"signInViaPopup":case"signInViaRedirect":return JEe;case"linkViaPopup":case"linkViaRedirect":return ZEe;case"reauthViaPopup":case"reauthViaRedirect":return QEe;default:Qc(this.auth,"internal-error")}}resolve(n){cp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(n),this.unregisterAndCleanUp()}reject(n){cp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(n),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eye=new lT(2e3,1e4);async function gte(s,n,i){if(Wc(s.app))return Promise.reject(Wl(s,"operation-not-supported-in-this-environment"));const l=Yl(s);R3(s,n,uT);const u=zk(l,i);return new zf(l,"signInViaPopup",n,u).executeNotNull()}async function tye(s,n,i){const l=as(s);if(Wc(l.auth.app))return Promise.reject(Wl(l.auth,"operation-not-supported-in-this-environment"));R3(l.auth,n,uT);const u=zk(l.auth,i);return new zf(l.auth,"reauthViaPopup",n,u,l).executeNotNull()}class zf extends mte{constructor(n,i,l,u,p){super(n,i,u,p),this.provider=l,this.authWindow=null,this.pollId=null,zf.currentPopupAction&&zf.currentPopupAction.cancel(),zf.currentPopupAction=this}async executeNotNull(){const n=await this.execute();return wn(n,this.auth,"internal-error"),n}async onExecution(){cp(this.filter.length===1,"Popup operations only handle one event");const n=M3();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],n),this.authWindow.associatedEvent=n,this.resolver._originValidation(this.auth).catch(i=>{this.reject(i)}),this.resolver._isIframeWebStorageSupported(this.auth,i=>{i||this.reject(Wl(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var n;return((n=this.authWindow)===null||n===void 0?void 0:n.associatedEvent)||null}cancel(){this.reject(Wl(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,zf.currentPopupAction=null}pollUserCancellation(){const n=()=>{var i,l;if(!((l=(i=this.authWindow)===null||i===void 0?void 0:i.window)===null||l===void 0)&&l.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Wl(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(n,eye.get())};n()}}zf.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nye="pendingRedirect",d1=new Map;class rye extends mte{constructor(n,i,l=!1){super(n,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],i,void 0,l),this.eventId=null}async execute(){let n=d1.get(this.auth._key());if(!n){try{const l=await sye(this.resolver,this.auth)?await super.execute():null;n=()=>Promise.resolve(l)}catch(i){n=()=>Promise.reject(i)}d1.set(this.auth._key(),n)}return this.bypassAuthState||d1.set(this.auth._key(),()=>Promise.resolve(null)),n()}async onAuthEvent(n){if(n.type==="signInViaRedirect")return super.onAuthEvent(n);if(n.type==="unknown"){this.resolve(null);return}if(n.eventId){const i=await this.auth._redirectUserForId(n.eventId);if(i)return this.user=i,super.onAuthEvent(n);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function sye(s,n){const i=vte(n),l=_te(s);if(!await l._isAvailable())return!1;const u=await l._get(i)==="true";return await l._remove(i),u}async function iye(s,n){return _te(s)._set(vte(n),"true")}function aye(s,n){d1.set(s._key(),n)}function _te(s){return $h(s._redirectPersistence)}function vte(s){return l1(nye,s.config.apiKey,s.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oye(s,n,i){return cye(s,n,i)}async function cye(s,n,i){if(Wc(s.app))return Promise.reject(qu(s));const l=Yl(s);R3(s,n,uT),await l._initializationPromise;const u=zk(l,i);return await iye(u,l),u._openRedirect(l,n,"signInViaRedirect")}async function lye(s,n){return await Yl(s)._initializationPromise,Ete(s,n,!1)}async function Ete(s,n,i=!1){if(Wc(s.app))return Promise.reject(qu(s));const l=Yl(s),u=zk(l,n),g=await new rye(l,u,i).execute();return g&&!i&&(delete g.user._redirectEventId,await l._persistUserIfCurrent(g.user),await l._setRedirectUser(null,n)),g}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dye=10*60*1e3;class uye{constructor(n){this.auth=n,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(n){this.consumers.add(n),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,n)&&(this.sendToConsumer(this.queuedRedirectEvent,n),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(n){this.consumers.delete(n)}onEvent(n){if(this.hasEventBeenHandled(n))return!1;let i=!1;return this.consumers.forEach(l=>{this.isEventForConsumer(n,l)&&(i=!0,this.sendToConsumer(n,l),this.saveEventToCache(n))}),this.hasHandledPotentialRedirect||!hye(n)||(this.hasHandledPotentialRedirect=!0,i||(this.queuedRedirectEvent=n,i=!0)),i}sendToConsumer(n,i){var l;if(n.error&&!yte(n)){const u=((l=n.error.code)===null||l===void 0?void 0:l.split("auth/")[1])||"internal-error";i.onError(Wl(this.auth,u))}else i.onAuthEvent(n)}isEventForConsumer(n,i){const l=i.eventId===null||!!n.eventId&&n.eventId===i.eventId;return i.filter.includes(n.type)&&l}hasEventBeenHandled(n){return Date.now()-this.lastProcessedEventTime>=dye&&this.cachedEventUids.clear(),this.cachedEventUids.has(E$(n))}saveEventToCache(n){this.cachedEventUids.add(E$(n)),this.lastProcessedEventTime=Date.now()}}function E$(s){return[s.type,s.eventId,s.sessionId,s.tenantId].filter(n=>n).join("-")}function yte({type:s,error:n}){return s==="unknown"&&(n==null?void 0:n.code)==="auth/no-auth-event"}function hye(s){switch(s.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return yte(s);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pye(s,n={}){return rh(s,"GET","/v1/projects",n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fye=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,mye=/^https?/;async function gye(s){if(s.config.emulator)return;const{authorizedDomains:n}=await pye(s);for(const i of n)try{if(_ye(i))return}catch{}Qc(s,"unauthorized-domain")}function _ye(s){const n=z5(),{protocol:i,hostname:l}=new URL(n);if(s.startsWith("chrome-extension://")){const g=new URL(s);return g.hostname===""&&l===""?i==="chrome-extension:"&&s.replace("chrome-extension://","")===n.replace("chrome-extension://",""):i==="chrome-extension:"&&g.hostname===l}if(!mye.test(i))return!1;if(fye.test(s))return l===s;const u=s.replace(/\./g,"\\.");return new RegExp("^(.+\\."+u+"|"+u+")$","i").test(l)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vye=new lT(3e4,6e4);function y$(){const s=Yu().___jsl;if(s!=null&&s.H){for(const n of Object.keys(s.H))if(s.H[n].r=s.H[n].r||[],s.H[n].L=s.H[n].L||[],s.H[n].r=[...s.H[n].L],s.CP)for(let i=0;i<s.CP.length;i++)s.CP[i]=null}}function Eye(s){return new Promise((n,i)=>{var l,u,p;function g(){y$(),gapi.load("gapi.iframes",{callback:()=>{n(gapi.iframes.getContext())},ontimeout:()=>{y$(),i(Wl(s,"network-request-failed"))},timeout:vye.get()})}if(!((u=(l=Yu().gapi)===null||l===void 0?void 0:l.iframes)===null||u===void 0)&&u.Iframe)n(gapi.iframes.getContext());else if(!((p=Yu().gapi)===null||p===void 0)&&p.load)g();else{const y=aEe("iframefcb");return Yu()[y]=()=>{gapi.load?g():i(Wl(s,"network-request-failed"))},ete(`${iEe()}?onload=${y}`).catch(x=>i(x))}}).catch(n=>{throw u1=null,n})}let u1=null;function yye(s){return u1=u1||Eye(s),u1}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bye=new lT(5e3,15e3),xye="__/auth/iframe",wye="emulator/auth/iframe",Sye={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Tye=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Rye(s){const n=s.config;wn(n.authDomain,s,"auth-domain-config-required");const i=n.emulator?N3(n,wye):`https://${s.config.authDomain}/${xye}`,l={apiKey:n.apiKey,appName:s.name,v:j_},u=Tye.get(s.config.apiHost);u&&(l.eid=u);const p=s._getFrameworks();return p.length&&(l.fw=p.join(",")),`${i}?${cT(l).slice(1)}`}async function Cye(s){const n=await yye(s),i=Yu().gapi;return wn(i,s,"internal-error"),n.open({where:document.body,url:Rye(s),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Sye,dontclear:!0},l=>new Promise(async(u,p)=>{await l.restyle({setHideOnLeave:!1});const g=Wl(s,"network-request-failed"),y=Yu().setTimeout(()=>{p(g)},bye.get());function x(){Yu().clearTimeout(y),u(l)}l.ping(x).then(x,()=>{p(g)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nye={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Iye=500,Aye=600,kye="_blank",Oye="http://localhost";class b${constructor(n){this.window=n,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Dye(s,n,i,l=Iye,u=Aye){const p=Math.max((window.screen.availHeight-u)/2,0).toString(),g=Math.max((window.screen.availWidth-l)/2,0).toString();let y="";const x=Object.assign(Object.assign({},Nye),{width:l.toString(),height:u.toString(),top:p,left:g}),C=Eo().toLowerCase();i&&(y=qee(C)?kye:i),Hee(C)&&(n=n||Oye,x.scrollbars="yes");const k=Object.entries(x).reduce((M,[G,B])=>`${M}${G}=${B},`,"");if($ve(C)&&y!=="_self")return Pye(n||"",y),new b$(null);const A=window.open(n||"",y,k);wn(A,s,"popup-blocked");try{A.focus()}catch{}return new b$(A)}function Pye(s,n){const i=document.createElement("a");i.href=s,i.target=n;const l=document.createEvent("MouseEvent");l.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(l)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lye="__/auth/handler",jye="emulator/auth/handler",Mye=encodeURIComponent("fac");async function x$(s,n,i,l,u,p){wn(s.config.authDomain,s,"auth-domain-config-required"),wn(s.config.apiKey,s,"invalid-api-key");const g={apiKey:s.config.apiKey,appName:s.name,authType:i,redirectUrl:l,v:j_,eventId:u};if(n instanceof uT){n.setDefaultLanguage(s.languageCode),g.providerId=n.providerId||"",y0e(n.getCustomParameters())||(g.customParameters=JSON.stringify(n.getCustomParameters()));for(const[k,A]of Object.entries({}))g[k]=A}if(n instanceof hT){const k=n.getScopes().filter(A=>A!=="");k.length>0&&(g.scopes=k.join(","))}s.tenantId&&(g.tid=s.tenantId);const y=g;for(const k of Object.keys(y))y[k]===void 0&&delete y[k];const x=await s._getAppCheckToken(),C=x?`#${Mye}=${encodeURIComponent(x)}`:"";return`${Uye(s)}?${cT(y).slice(1)}${C}`}function Uye({config:s}){return s.emulator?N3(s,jye):`https://${s.authDomain}/${Lye}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y4="webStorageSupport";class Vye{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=dte,this._completeRedirectFn=Ete,this._overrideRedirectResult=aye}async _openPopup(n,i,l,u){var p;cp((p=this.eventManagers[n._key()])===null||p===void 0?void 0:p.manager,"_initialize() not called before _openPopup()");const g=await x$(n,i,l,z5(),u);return Dye(n,g,M3())}async _openRedirect(n,i,l,u){await this._originValidation(n);const p=await x$(n,i,l,z5(),u);return BEe(p),new Promise(()=>{})}_initialize(n){const i=n._key();if(this.eventManagers[i]){const{manager:u,promise:p}=this.eventManagers[i];return u?Promise.resolve(u):(cp(p,"If manager is not set, promise should be"),p)}const l=this.initAndGetManager(n);return this.eventManagers[i]={promise:l},l.catch(()=>{delete this.eventManagers[i]}),l}async initAndGetManager(n){const i=await Cye(n),l=new uye(n);return i.register("authEvent",u=>(wn(u==null?void 0:u.authEvent,n,"invalid-auth-event"),{status:l.onEvent(u.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[n._key()]={manager:l},this.iframes[n._key()]=i,l}_isIframeWebStorageSupported(n,i){this.iframes[n._key()].send(y4,{type:y4},u=>{var p;const g=(p=u==null?void 0:u[0])===null||p===void 0?void 0:p[y4];g!==void 0&&i(!!g),Qc(n,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(n){const i=n._key();return this.originValidationPromises[i]||(this.originValidationPromises[i]=gye(n)),this.originValidationPromises[i]}get _shouldInitProactively(){return Qee()||Kee()||A3()}}const Fye=Vye;var w$="@firebase/auth",S$="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bye{constructor(n){this.auth=n,this.internalListeners=new Map}getUid(){var n;return this.assertAuthConfigured(),((n=this.auth.currentUser)===null||n===void 0?void 0:n.uid)||null}async getToken(n){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(n)}:null}addAuthTokenListener(n){if(this.assertAuthConfigured(),this.internalListeners.has(n))return;const i=this.auth.onIdTokenChanged(l=>{n((l==null?void 0:l.stsTokenManager.accessToken)||null)});this.internalListeners.set(n,i),this.updateProactiveRefresh()}removeAuthTokenListener(n){this.assertAuthConfigured();const i=this.internalListeners.get(n);i&&(this.internalListeners.delete(n),i(),this.updateProactiveRefresh())}assertAuthConfigured(){wn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zye(s){switch(s){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Gye(s){T_(new lm("auth",(n,{options:i})=>{const l=n.getProvider("app").getImmediate(),u=n.getProvider("heartbeat"),p=n.getProvider("app-check-internal"),{apiKey:g,authDomain:y}=l.options;wn(g&&!g.includes(":"),"invalid-api-key",{appName:l.name});const x={apiKey:g,authDomain:y,clientPlatform:s,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Zee(s)},C=new nEe(l,u,p,x);return uEe(C,i),C},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,i,l)=>{n.getProvider("auth-internal").initialize()})),T_(new lm("auth-internal",n=>{const i=Yl(n.getProvider("auth").getImmediate());return(l=>new Bye(l))(i)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ku(w$,S$,zye(s)),Ku(w$,S$,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wye=5*60,Hye=Aee("authIdTokenMaxAge")||Wye;let T$=null;const Kye=s=>async n=>{const i=n&&await n.getIdTokenResult(),l=i&&(new Date().getTime()-Date.parse(i.issuedAtTime))/1e3;if(l&&l>Hye)return;const u=i==null?void 0:i.token;T$!==u&&(T$=u,await fetch(s,{method:u?"POST":"DELETE",headers:u?{Authorization:`Bearer ${u}`}:{}}))};function qye(s=w3()){const n=Uk(s,"auth");if(n.isInitialized())return n.getImmediate();const i=dEe(s,{popupRedirectResolver:Fye,persistence:[$Ee,UEe,dte]}),l=Aee("authTokenSyncURL");if(l&&typeof isSecureContext=="boolean"&&isSecureContext){const p=new URL(l,location.origin);if(location.origin===p.origin){const g=Kye(p.toString());PEe(i,g,()=>g(i.currentUser)),DEe(i,y=>g(y))}}const u=Cee("auth");return u&&hEe(i,`http://${u}`),i}function Yye(){var s,n;return(n=(s=document.getElementsByTagName("head"))===null||s===void 0?void 0:s[0])!==null&&n!==void 0?n:document}rEe({loadJS(s){return new Promise((n,i)=>{const l=document.createElement("script");l.setAttribute("src",s),l.onload=n,l.onerror=u=>{const p=Wl("internal-error");p.customData=u,i(p)},l.type="text/javascript",l.charset="UTF-8",Yye().appendChild(l)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Gye("Browser");var R$=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var __,bte;(function(){var s;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function n(Q,$){function se(){}se.prototype=$.prototype,Q.D=$.prototype,Q.prototype=new se,Q.prototype.constructor=Q,Q.C=function(ce,he,ve){for(var ge=Array(arguments.length-2),qe=2;qe<arguments.length;qe++)ge[qe-2]=arguments[qe];return $.prototype[he].apply(ce,ge)}}function i(){this.blockSize=-1}function l(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}n(l,i),l.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function u(Q,$,se){se||(se=0);var ce=Array(16);if(typeof $=="string")for(var he=0;16>he;++he)ce[he]=$.charCodeAt(se++)|$.charCodeAt(se++)<<8|$.charCodeAt(se++)<<16|$.charCodeAt(se++)<<24;else for(he=0;16>he;++he)ce[he]=$[se++]|$[se++]<<8|$[se++]<<16|$[se++]<<24;$=Q.g[0],se=Q.g[1],he=Q.g[2];var ve=Q.g[3],ge=$+(ve^se&(he^ve))+ce[0]+3614090360&4294967295;$=se+(ge<<7&4294967295|ge>>>25),ge=ve+(he^$&(se^he))+ce[1]+3905402710&4294967295,ve=$+(ge<<12&4294967295|ge>>>20),ge=he+(se^ve&($^se))+ce[2]+606105819&4294967295,he=ve+(ge<<17&4294967295|ge>>>15),ge=se+($^he&(ve^$))+ce[3]+3250441966&4294967295,se=he+(ge<<22&4294967295|ge>>>10),ge=$+(ve^se&(he^ve))+ce[4]+4118548399&4294967295,$=se+(ge<<7&4294967295|ge>>>25),ge=ve+(he^$&(se^he))+ce[5]+1200080426&4294967295,ve=$+(ge<<12&4294967295|ge>>>20),ge=he+(se^ve&($^se))+ce[6]+2821735955&4294967295,he=ve+(ge<<17&4294967295|ge>>>15),ge=se+($^he&(ve^$))+ce[7]+4249261313&4294967295,se=he+(ge<<22&4294967295|ge>>>10),ge=$+(ve^se&(he^ve))+ce[8]+1770035416&4294967295,$=se+(ge<<7&4294967295|ge>>>25),ge=ve+(he^$&(se^he))+ce[9]+2336552879&4294967295,ve=$+(ge<<12&4294967295|ge>>>20),ge=he+(se^ve&($^se))+ce[10]+4294925233&4294967295,he=ve+(ge<<17&4294967295|ge>>>15),ge=se+($^he&(ve^$))+ce[11]+2304563134&4294967295,se=he+(ge<<22&4294967295|ge>>>10),ge=$+(ve^se&(he^ve))+ce[12]+1804603682&4294967295,$=se+(ge<<7&4294967295|ge>>>25),ge=ve+(he^$&(se^he))+ce[13]+4254626195&4294967295,ve=$+(ge<<12&4294967295|ge>>>20),ge=he+(se^ve&($^se))+ce[14]+2792965006&4294967295,he=ve+(ge<<17&4294967295|ge>>>15),ge=se+($^he&(ve^$))+ce[15]+1236535329&4294967295,se=he+(ge<<22&4294967295|ge>>>10),ge=$+(he^ve&(se^he))+ce[1]+4129170786&4294967295,$=se+(ge<<5&4294967295|ge>>>27),ge=ve+(se^he&($^se))+ce[6]+3225465664&4294967295,ve=$+(ge<<9&4294967295|ge>>>23),ge=he+($^se&(ve^$))+ce[11]+643717713&4294967295,he=ve+(ge<<14&4294967295|ge>>>18),ge=se+(ve^$&(he^ve))+ce[0]+3921069994&4294967295,se=he+(ge<<20&4294967295|ge>>>12),ge=$+(he^ve&(se^he))+ce[5]+3593408605&4294967295,$=se+(ge<<5&4294967295|ge>>>27),ge=ve+(se^he&($^se))+ce[10]+38016083&4294967295,ve=$+(ge<<9&4294967295|ge>>>23),ge=he+($^se&(ve^$))+ce[15]+3634488961&4294967295,he=ve+(ge<<14&4294967295|ge>>>18),ge=se+(ve^$&(he^ve))+ce[4]+3889429448&4294967295,se=he+(ge<<20&4294967295|ge>>>12),ge=$+(he^ve&(se^he))+ce[9]+568446438&4294967295,$=se+(ge<<5&4294967295|ge>>>27),ge=ve+(se^he&($^se))+ce[14]+3275163606&4294967295,ve=$+(ge<<9&4294967295|ge>>>23),ge=he+($^se&(ve^$))+ce[3]+4107603335&4294967295,he=ve+(ge<<14&4294967295|ge>>>18),ge=se+(ve^$&(he^ve))+ce[8]+1163531501&4294967295,se=he+(ge<<20&4294967295|ge>>>12),ge=$+(he^ve&(se^he))+ce[13]+2850285829&4294967295,$=se+(ge<<5&4294967295|ge>>>27),ge=ve+(se^he&($^se))+ce[2]+4243563512&4294967295,ve=$+(ge<<9&4294967295|ge>>>23),ge=he+($^se&(ve^$))+ce[7]+1735328473&4294967295,he=ve+(ge<<14&4294967295|ge>>>18),ge=se+(ve^$&(he^ve))+ce[12]+2368359562&4294967295,se=he+(ge<<20&4294967295|ge>>>12),ge=$+(se^he^ve)+ce[5]+4294588738&4294967295,$=se+(ge<<4&4294967295|ge>>>28),ge=ve+($^se^he)+ce[8]+2272392833&4294967295,ve=$+(ge<<11&4294967295|ge>>>21),ge=he+(ve^$^se)+ce[11]+1839030562&4294967295,he=ve+(ge<<16&4294967295|ge>>>16),ge=se+(he^ve^$)+ce[14]+4259657740&4294967295,se=he+(ge<<23&4294967295|ge>>>9),ge=$+(se^he^ve)+ce[1]+2763975236&4294967295,$=se+(ge<<4&4294967295|ge>>>28),ge=ve+($^se^he)+ce[4]+1272893353&4294967295,ve=$+(ge<<11&4294967295|ge>>>21),ge=he+(ve^$^se)+ce[7]+4139469664&4294967295,he=ve+(ge<<16&4294967295|ge>>>16),ge=se+(he^ve^$)+ce[10]+3200236656&4294967295,se=he+(ge<<23&4294967295|ge>>>9),ge=$+(se^he^ve)+ce[13]+681279174&4294967295,$=se+(ge<<4&4294967295|ge>>>28),ge=ve+($^se^he)+ce[0]+3936430074&4294967295,ve=$+(ge<<11&4294967295|ge>>>21),ge=he+(ve^$^se)+ce[3]+3572445317&4294967295,he=ve+(ge<<16&4294967295|ge>>>16),ge=se+(he^ve^$)+ce[6]+76029189&4294967295,se=he+(ge<<23&4294967295|ge>>>9),ge=$+(se^he^ve)+ce[9]+3654602809&4294967295,$=se+(ge<<4&4294967295|ge>>>28),ge=ve+($^se^he)+ce[12]+3873151461&4294967295,ve=$+(ge<<11&4294967295|ge>>>21),ge=he+(ve^$^se)+ce[15]+530742520&4294967295,he=ve+(ge<<16&4294967295|ge>>>16),ge=se+(he^ve^$)+ce[2]+3299628645&4294967295,se=he+(ge<<23&4294967295|ge>>>9),ge=$+(he^(se|~ve))+ce[0]+4096336452&4294967295,$=se+(ge<<6&4294967295|ge>>>26),ge=ve+(se^($|~he))+ce[7]+1126891415&4294967295,ve=$+(ge<<10&4294967295|ge>>>22),ge=he+($^(ve|~se))+ce[14]+2878612391&4294967295,he=ve+(ge<<15&4294967295|ge>>>17),ge=se+(ve^(he|~$))+ce[5]+4237533241&4294967295,se=he+(ge<<21&4294967295|ge>>>11),ge=$+(he^(se|~ve))+ce[12]+1700485571&4294967295,$=se+(ge<<6&4294967295|ge>>>26),ge=ve+(se^($|~he))+ce[3]+2399980690&4294967295,ve=$+(ge<<10&4294967295|ge>>>22),ge=he+($^(ve|~se))+ce[10]+4293915773&4294967295,he=ve+(ge<<15&4294967295|ge>>>17),ge=se+(ve^(he|~$))+ce[1]+2240044497&4294967295,se=he+(ge<<21&4294967295|ge>>>11),ge=$+(he^(se|~ve))+ce[8]+1873313359&4294967295,$=se+(ge<<6&4294967295|ge>>>26),ge=ve+(se^($|~he))+ce[15]+4264355552&4294967295,ve=$+(ge<<10&4294967295|ge>>>22),ge=he+($^(ve|~se))+ce[6]+2734768916&4294967295,he=ve+(ge<<15&4294967295|ge>>>17),ge=se+(ve^(he|~$))+ce[13]+1309151649&4294967295,se=he+(ge<<21&4294967295|ge>>>11),ge=$+(he^(se|~ve))+ce[4]+4149444226&4294967295,$=se+(ge<<6&4294967295|ge>>>26),ge=ve+(se^($|~he))+ce[11]+3174756917&4294967295,ve=$+(ge<<10&4294967295|ge>>>22),ge=he+($^(ve|~se))+ce[2]+718787259&4294967295,he=ve+(ge<<15&4294967295|ge>>>17),ge=se+(ve^(he|~$))+ce[9]+3951481745&4294967295,Q.g[0]=Q.g[0]+$&4294967295,Q.g[1]=Q.g[1]+(he+(ge<<21&4294967295|ge>>>11))&4294967295,Q.g[2]=Q.g[2]+he&4294967295,Q.g[3]=Q.g[3]+ve&4294967295}l.prototype.u=function(Q,$){$===void 0&&($=Q.length);for(var se=$-this.blockSize,ce=this.B,he=this.h,ve=0;ve<$;){if(he==0)for(;ve<=se;)u(this,Q,ve),ve+=this.blockSize;if(typeof Q=="string"){for(;ve<$;)if(ce[he++]=Q.charCodeAt(ve++),he==this.blockSize){u(this,ce),he=0;break}}else for(;ve<$;)if(ce[he++]=Q[ve++],he==this.blockSize){u(this,ce),he=0;break}}this.h=he,this.o+=$},l.prototype.v=function(){var Q=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);Q[0]=128;for(var $=1;$<Q.length-8;++$)Q[$]=0;var se=8*this.o;for($=Q.length-8;$<Q.length;++$)Q[$]=se&255,se/=256;for(this.u(Q),Q=Array(16),$=se=0;4>$;++$)for(var ce=0;32>ce;ce+=8)Q[se++]=this.g[$]>>>ce&255;return Q};function p(Q,$){var se=y;return Object.prototype.hasOwnProperty.call(se,Q)?se[Q]:se[Q]=$(Q)}function g(Q,$){this.h=$;for(var se=[],ce=!0,he=Q.length-1;0<=he;he--){var ve=Q[he]|0;ce&&ve==$||(se[he]=ve,ce=!1)}this.g=se}var y={};function x(Q){return-128<=Q&&128>Q?p(Q,function($){return new g([$|0],0>$?-1:0)}):new g([Q|0],0>Q?-1:0)}function C(Q){if(isNaN(Q)||!isFinite(Q))return A;if(0>Q)return Z(C(-Q));for(var $=[],se=1,ce=0;Q>=se;ce++)$[ce]=Q/se|0,se*=4294967296;return new g($,0)}function k(Q,$){if(Q.length==0)throw Error("number format error: empty string");if($=$||10,2>$||36<$)throw Error("radix out of range: "+$);if(Q.charAt(0)=="-")return Z(k(Q.substring(1),$));if(0<=Q.indexOf("-"))throw Error('number format error: interior "-" character');for(var se=C(Math.pow($,8)),ce=A,he=0;he<Q.length;he+=8){var ve=Math.min(8,Q.length-he),ge=parseInt(Q.substring(he,he+ve),$);8>ve?(ve=C(Math.pow($,ve)),ce=ce.j(ve).add(C(ge))):(ce=ce.j(se),ce=ce.add(C(ge)))}return ce}var A=x(0),M=x(1),G=x(16777216);s=g.prototype,s.m=function(){if(X(this))return-Z(this).m();for(var Q=0,$=1,se=0;se<this.g.length;se++){var ce=this.i(se);Q+=(0<=ce?ce:4294967296+ce)*$,$*=4294967296}return Q},s.toString=function(Q){if(Q=Q||10,2>Q||36<Q)throw Error("radix out of range: "+Q);if(B(this))return"0";if(X(this))return"-"+Z(this).toString(Q);for(var $=C(Math.pow(Q,6)),se=this,ce="";;){var he=de(se,$).g;se=q(se,he.j($));var ve=((0<se.g.length?se.g[0]:se.h)>>>0).toString(Q);if(se=he,B(se))return ve+ce;for(;6>ve.length;)ve="0"+ve;ce=ve+ce}},s.i=function(Q){return 0>Q?0:Q<this.g.length?this.g[Q]:this.h};function B(Q){if(Q.h!=0)return!1;for(var $=0;$<Q.g.length;$++)if(Q.g[$]!=0)return!1;return!0}function X(Q){return Q.h==-1}s.l=function(Q){return Q=q(this,Q),X(Q)?-1:B(Q)?0:1};function Z(Q){for(var $=Q.g.length,se=[],ce=0;ce<$;ce++)se[ce]=~Q.g[ce];return new g(se,~Q.h).add(M)}s.abs=function(){return X(this)?Z(this):this},s.add=function(Q){for(var $=Math.max(this.g.length,Q.g.length),se=[],ce=0,he=0;he<=$;he++){var ve=ce+(this.i(he)&65535)+(Q.i(he)&65535),ge=(ve>>>16)+(this.i(he)>>>16)+(Q.i(he)>>>16);ce=ge>>>16,ve&=65535,ge&=65535,se[he]=ge<<16|ve}return new g(se,se[se.length-1]&-2147483648?-1:0)};function q(Q,$){return Q.add(Z($))}s.j=function(Q){if(B(this)||B(Q))return A;if(X(this))return X(Q)?Z(this).j(Z(Q)):Z(Z(this).j(Q));if(X(Q))return Z(this.j(Z(Q)));if(0>this.l(G)&&0>Q.l(G))return C(this.m()*Q.m());for(var $=this.g.length+Q.g.length,se=[],ce=0;ce<2*$;ce++)se[ce]=0;for(ce=0;ce<this.g.length;ce++)for(var he=0;he<Q.g.length;he++){var ve=this.i(ce)>>>16,ge=this.i(ce)&65535,qe=Q.i(he)>>>16,Dt=Q.i(he)&65535;se[2*ce+2*he]+=ge*Dt,V(se,2*ce+2*he),se[2*ce+2*he+1]+=ve*Dt,V(se,2*ce+2*he+1),se[2*ce+2*he+1]+=ge*qe,V(se,2*ce+2*he+1),se[2*ce+2*he+2]+=ve*qe,V(se,2*ce+2*he+2)}for(ce=0;ce<$;ce++)se[ce]=se[2*ce+1]<<16|se[2*ce];for(ce=$;ce<2*$;ce++)se[ce]=0;return new g(se,0)};function V(Q,$){for(;(Q[$]&65535)!=Q[$];)Q[$+1]+=Q[$]>>>16,Q[$]&=65535,$++}function ee(Q,$){this.g=Q,this.h=$}function de(Q,$){if(B($))throw Error("division by zero");if(B(Q))return new ee(A,A);if(X(Q))return $=de(Z(Q),$),new ee(Z($.g),Z($.h));if(X($))return $=de(Q,Z($)),new ee(Z($.g),$.h);if(30<Q.g.length){if(X(Q)||X($))throw Error("slowDivide_ only works with positive integers.");for(var se=M,ce=$;0>=ce.l(Q);)se=ae(se),ce=ae(ce);var he=ye(se,1),ve=ye(ce,1);for(ce=ye(ce,2),se=ye(se,2);!B(ce);){var ge=ve.add(ce);0>=ge.l(Q)&&(he=he.add(se),ve=ge),ce=ye(ce,1),se=ye(se,1)}return $=q(Q,he.j($)),new ee(he,$)}for(he=A;0<=Q.l($);){for(se=Math.max(1,Math.floor(Q.m()/$.m())),ce=Math.ceil(Math.log(se)/Math.LN2),ce=48>=ce?1:Math.pow(2,ce-48),ve=C(se),ge=ve.j($);X(ge)||0<ge.l(Q);)se-=ce,ve=C(se),ge=ve.j($);B(ve)&&(ve=M),he=he.add(ve),Q=q(Q,ge)}return new ee(he,Q)}s.A=function(Q){return de(this,Q).h},s.and=function(Q){for(var $=Math.max(this.g.length,Q.g.length),se=[],ce=0;ce<$;ce++)se[ce]=this.i(ce)&Q.i(ce);return new g(se,this.h&Q.h)},s.or=function(Q){for(var $=Math.max(this.g.length,Q.g.length),se=[],ce=0;ce<$;ce++)se[ce]=this.i(ce)|Q.i(ce);return new g(se,this.h|Q.h)},s.xor=function(Q){for(var $=Math.max(this.g.length,Q.g.length),se=[],ce=0;ce<$;ce++)se[ce]=this.i(ce)^Q.i(ce);return new g(se,this.h^Q.h)};function ae(Q){for(var $=Q.g.length+1,se=[],ce=0;ce<$;ce++)se[ce]=Q.i(ce)<<1|Q.i(ce-1)>>>31;return new g(se,Q.h)}function ye(Q,$){var se=$>>5;$%=32;for(var ce=Q.g.length-se,he=[],ve=0;ve<ce;ve++)he[ve]=0<$?Q.i(ve+se)>>>$|Q.i(ve+se+1)<<32-$:Q.i(ve+se);return new g(he,Q.h)}l.prototype.digest=l.prototype.v,l.prototype.reset=l.prototype.s,l.prototype.update=l.prototype.u,bte=l,g.prototype.add=g.prototype.add,g.prototype.multiply=g.prototype.j,g.prototype.modulo=g.prototype.A,g.prototype.compare=g.prototype.l,g.prototype.toNumber=g.prototype.m,g.prototype.toString=g.prototype.toString,g.prototype.getBits=g.prototype.i,g.fromNumber=C,g.fromString=k,__=g}).apply(typeof R$<"u"?R$:typeof self<"u"?self:typeof window<"u"?window:{});var FA=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var xte,qw,wte,h1,H5,Ste,Tte,Rte;(function(){var s,n=typeof Object.defineProperties=="function"?Object.defineProperty:function(T,F,J){return T==Array.prototype||T==Object.prototype||(T[F]=J.value),T};function i(T){T=[typeof globalThis=="object"&&globalThis,T,typeof window=="object"&&window,typeof self=="object"&&self,typeof FA=="object"&&FA];for(var F=0;F<T.length;++F){var J=T[F];if(J&&J.Math==Math)return J}throw Error("Cannot find global object")}var l=i(this);function u(T,F){if(F)e:{var J=l;T=T.split(".");for(var me=0;me<T.length-1;me++){var Oe=T[me];if(!(Oe in J))break e;J=J[Oe]}T=T[T.length-1],me=J[T],F=F(me),F!=me&&F!=null&&n(J,T,{configurable:!0,writable:!0,value:F})}}function p(T,F){T instanceof String&&(T+="");var J=0,me=!1,Oe={next:function(){if(!me&&J<T.length){var We=J++;return{value:F(We,T[We]),done:!1}}return me=!0,{done:!0,value:void 0}}};return Oe[Symbol.iterator]=function(){return Oe},Oe}u("Array.prototype.values",function(T){return T||function(){return p(this,function(F,J){return J})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var g=g||{},y=this||self;function x(T){var F=typeof T;return F=F!="object"?F:T?Array.isArray(T)?"array":F:"null",F=="array"||F=="object"&&typeof T.length=="number"}function C(T){var F=typeof T;return F=="object"&&T!=null||F=="function"}function k(T,F,J){return T.call.apply(T.bind,arguments)}function A(T,F,J){if(!T)throw Error();if(2<arguments.length){var me=Array.prototype.slice.call(arguments,2);return function(){var Oe=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Oe,me),T.apply(F,Oe)}}return function(){return T.apply(F,arguments)}}function M(T,F,J){return M=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?k:A,M.apply(null,arguments)}function G(T,F){var J=Array.prototype.slice.call(arguments,1);return function(){var me=J.slice();return me.push.apply(me,arguments),T.apply(this,me)}}function B(T,F){function J(){}J.prototype=F.prototype,T.aa=F.prototype,T.prototype=new J,T.prototype.constructor=T,T.Qb=function(me,Oe,We){for(var vt=Array(arguments.length-2),Ir=2;Ir<arguments.length;Ir++)vt[Ir-2]=arguments[Ir];return F.prototype[Oe].apply(me,vt)}}function X(T){const F=T.length;if(0<F){const J=Array(F);for(let me=0;me<F;me++)J[me]=T[me];return J}return[]}function Z(T,F){for(let J=1;J<arguments.length;J++){const me=arguments[J];if(x(me)){const Oe=T.length||0,We=me.length||0;T.length=Oe+We;for(let vt=0;vt<We;vt++)T[Oe+vt]=me[vt]}else T.push(me)}}class q{constructor(F,J){this.i=F,this.j=J,this.h=0,this.g=null}get(){let F;return 0<this.h?(this.h--,F=this.g,this.g=F.next,F.next=null):F=this.i(),F}}function V(T){return/^[\s\xa0]*$/.test(T)}function ee(){var T=y.navigator;return T&&(T=T.userAgent)?T:""}function de(T){return de[" "](T),T}de[" "]=function(){};var ae=ee().indexOf("Gecko")!=-1&&!(ee().toLowerCase().indexOf("webkit")!=-1&&ee().indexOf("Edge")==-1)&&!(ee().indexOf("Trident")!=-1||ee().indexOf("MSIE")!=-1)&&ee().indexOf("Edge")==-1;function ye(T,F,J){for(const me in T)F.call(J,T[me],me,T)}function Q(T,F){for(const J in T)F.call(void 0,T[J],J,T)}function $(T){const F={};for(const J in T)F[J]=T[J];return F}const se="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ce(T,F){let J,me;for(let Oe=1;Oe<arguments.length;Oe++){me=arguments[Oe];for(J in me)T[J]=me[J];for(let We=0;We<se.length;We++)J=se[We],Object.prototype.hasOwnProperty.call(me,J)&&(T[J]=me[J])}}function he(T){var F=1;T=T.split(":");const J=[];for(;0<F&&T.length;)J.push(T.shift()),F--;return T.length&&J.push(T.join(":")),J}function ve(T){y.setTimeout(()=>{throw T},0)}function ge(){var T=ut;let F=null;return T.g&&(F=T.g,T.g=T.g.next,T.g||(T.h=null),F.next=null),F}class qe{constructor(){this.h=this.g=null}add(F,J){const me=Dt.get();me.set(F,J),this.h?this.h.next=me:this.g=me,this.h=me}}var Dt=new q(()=>new gt,T=>T.reset());class gt{constructor(){this.next=this.g=this.h=null}set(F,J){this.h=F,this.g=J,this.next=null}reset(){this.next=this.g=this.h=null}}let Ye,ze=!1,ut=new qe,yt=()=>{const T=y.Promise.resolve(void 0);Ye=()=>{T.then(Xt)}};var Xt=()=>{for(var T;T=ge();){try{T.h.call(T.g)}catch(J){ve(J)}var F=Dt;F.j(T),100>F.h&&(F.h++,T.next=F.g,F.g=T)}ze=!1};function jt(){this.s=this.s,this.C=this.C}jt.prototype.s=!1,jt.prototype.ma=function(){this.s||(this.s=!0,this.N())},jt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Gt(T,F){this.type=T,this.g=this.target=F,this.defaultPrevented=!1}Gt.prototype.h=function(){this.defaultPrevented=!0};var mn=function(){if(!y.addEventListener||!Object.defineProperty)return!1;var T=!1,F=Object.defineProperty({},"passive",{get:function(){T=!0}});try{const J=()=>{};y.addEventListener("test",J,F),y.removeEventListener("test",J,F)}catch{}return T}();function Pt(T,F){if(Gt.call(this,T?T.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,T){var J=this.type=T.type,me=T.changedTouches&&T.changedTouches.length?T.changedTouches[0]:null;if(this.target=T.target||T.srcElement,this.g=F,F=T.relatedTarget){if(ae){e:{try{de(F.nodeName);var Oe=!0;break e}catch{}Oe=!1}Oe||(F=null)}}else J=="mouseover"?F=T.fromElement:J=="mouseout"&&(F=T.toElement);this.relatedTarget=F,me?(this.clientX=me.clientX!==void 0?me.clientX:me.pageX,this.clientY=me.clientY!==void 0?me.clientY:me.pageY,this.screenX=me.screenX||0,this.screenY=me.screenY||0):(this.clientX=T.clientX!==void 0?T.clientX:T.pageX,this.clientY=T.clientY!==void 0?T.clientY:T.pageY,this.screenX=T.screenX||0,this.screenY=T.screenY||0),this.button=T.button,this.key=T.key||"",this.ctrlKey=T.ctrlKey,this.altKey=T.altKey,this.shiftKey=T.shiftKey,this.metaKey=T.metaKey,this.pointerId=T.pointerId||0,this.pointerType=typeof T.pointerType=="string"?T.pointerType:Jt[T.pointerType]||"",this.state=T.state,this.i=T,T.defaultPrevented&&Pt.aa.h.call(this)}}B(Pt,Gt);var Jt={2:"touch",3:"pen",4:"mouse"};Pt.prototype.h=function(){Pt.aa.h.call(this);var T=this.i;T.preventDefault?T.preventDefault():T.returnValue=!1};var He="closure_listenable_"+(1e6*Math.random()|0),bt=0;function Wt(T,F,J,me,Oe){this.listener=T,this.proxy=null,this.src=F,this.type=J,this.capture=!!me,this.ha=Oe,this.key=++bt,this.da=this.fa=!1}function gn(T){T.da=!0,T.listener=null,T.proxy=null,T.src=null,T.ha=null}function xt(T){this.src=T,this.g={},this.h=0}xt.prototype.add=function(T,F,J,me,Oe){var We=T.toString();T=this.g[We],T||(T=this.g[We]=[],this.h++);var vt=cr(T,F,me,Oe);return-1<vt?(F=T[vt],J||(F.fa=!1)):(F=new Wt(F,this.src,We,!!me,Oe),F.fa=J,T.push(F)),F};function Sn(T,F){var J=F.type;if(J in T.g){var me=T.g[J],Oe=Array.prototype.indexOf.call(me,F,void 0),We;(We=0<=Oe)&&Array.prototype.splice.call(me,Oe,1),We&&(gn(F),T.g[J].length==0&&(delete T.g[J],T.h--))}}function cr(T,F,J,me){for(var Oe=0;Oe<T.length;++Oe){var We=T[Oe];if(!We.da&&We.listener==F&&We.capture==!!J&&We.ha==me)return Oe}return-1}var Or="closure_lm_"+(1e6*Math.random()|0),ms={};function Oi(T,F,J,me,Oe){if(Array.isArray(F)){for(var We=0;We<F.length;We++)Oi(T,F[We],J,me,Oe);return null}return J=Za(J),T&&T[He]?T.K(F,J,C(me)?!!me.capture:!1,Oe):xi(T,F,J,!1,me,Oe)}function xi(T,F,J,me,Oe,We){if(!F)throw Error("Invalid event type");var vt=C(Oe)?!!Oe.capture:!!Oe,Ir=Cs(T);if(Ir||(T[Or]=Ir=new xt(T)),J=Ir.add(F,J,me,vt,We),J.proxy)return J;if(me=Gr(),J.proxy=me,me.src=T,me.listener=J,T.addEventListener)mn||(Oe=vt),Oe===void 0&&(Oe=!1),T.addEventListener(F.toString(),me,Oe);else if(T.attachEvent)T.attachEvent(Ht(F.toString()),me);else if(T.addListener&&T.removeListener)T.addListener(me);else throw Error("addEventListener and attachEvent are unavailable.");return J}function Gr(){function T(J){return F.call(T.src,T.listener,J)}const F=wi;return T}function qt(T,F,J,me,Oe){if(Array.isArray(F))for(var We=0;We<F.length;We++)qt(T,F[We],J,me,Oe);else me=C(me)?!!me.capture:!!me,J=Za(J),T&&T[He]?(T=T.i,F=String(F).toString(),F in T.g&&(We=T.g[F],J=cr(We,J,me,Oe),-1<J&&(gn(We[J]),Array.prototype.splice.call(We,J,1),We.length==0&&(delete T.g[F],T.h--)))):T&&(T=Cs(T))&&(F=T.g[F.toString()],T=-1,F&&(T=cr(F,J,me,Oe)),(J=-1<T?F[T]:null)&&Jr(J))}function Jr(T){if(typeof T!="number"&&T&&!T.da){var F=T.src;if(F&&F[He])Sn(F.i,T);else{var J=T.type,me=T.proxy;F.removeEventListener?F.removeEventListener(J,me,T.capture):F.detachEvent?F.detachEvent(Ht(J),me):F.addListener&&F.removeListener&&F.removeListener(me),(J=Cs(F))?(Sn(J,T),J.h==0&&(J.src=null,F[Or]=null)):gn(T)}}}function Ht(T){return T in ms?ms[T]:ms[T]="on"+T}function wi(T,F){if(T.da)T=!0;else{F=new Pt(F,this);var J=T.listener,me=T.ha||T.src;T.fa&&Jr(T),T=J.call(me,F)}return T}function Cs(T){return T=T[Or],T instanceof xt?T:null}var gr="__closure_events_fn_"+(1e9*Math.random()>>>0);function Za(T){return typeof T=="function"?T:(T[gr]||(T[gr]=function(F){return T.handleEvent(F)}),T[gr])}function es(){jt.call(this),this.i=new xt(this),this.M=this,this.F=null}B(es,jt),es.prototype[He]=!0,es.prototype.removeEventListener=function(T,F,J,me){qt(this,T,F,J,me)};function Sr(T,F){var J,me=T.F;if(me)for(J=[];me;me=me.F)J.push(me);if(T=T.M,me=F.type||F,typeof F=="string")F=new Gt(F,T);else if(F instanceof Gt)F.target=F.target||T;else{var Oe=F;F=new Gt(me,T),ce(F,Oe)}if(Oe=!0,J)for(var We=J.length-1;0<=We;We--){var vt=F.g=J[We];Oe=Ki(vt,me,!0,F)&&Oe}if(vt=F.g=T,Oe=Ki(vt,me,!0,F)&&Oe,Oe=Ki(vt,me,!1,F)&&Oe,J)for(We=0;We<J.length;We++)vt=F.g=J[We],Oe=Ki(vt,me,!1,F)&&Oe}es.prototype.N=function(){if(es.aa.N.call(this),this.i){var T=this.i,F;for(F in T.g){for(var J=T.g[F],me=0;me<J.length;me++)gn(J[me]);delete T.g[F],T.h--}}this.F=null},es.prototype.K=function(T,F,J,me){return this.i.add(String(T),F,!1,J,me)},es.prototype.L=function(T,F,J,me){return this.i.add(String(T),F,!0,J,me)};function Ki(T,F,J,me){if(F=T.i.g[String(F)],!F)return!0;F=F.concat();for(var Oe=!0,We=0;We<F.length;++We){var vt=F[We];if(vt&&!vt.da&&vt.capture==J){var Ir=vt.listener,Si=vt.ha||vt.src;vt.fa&&Sn(T.i,vt),Oe=Ir.call(Si,me)!==!1&&Oe}}return Oe&&!me.defaultPrevented}function Go(T,F,J){if(typeof T=="function")J&&(T=M(T,J));else if(T&&typeof T.handleEvent=="function")T=M(T.handleEvent,T);else throw Error("Invalid listener argument");return 2147483647<Number(F)?-1:y.setTimeout(T,F||0)}function vc(T){T.g=Go(()=>{T.g=null,T.i&&(T.i=!1,vc(T))},T.l);const F=T.h;T.h=null,T.m.apply(null,F)}class Ec extends jt{constructor(F,J){super(),this.m=F,this.l=J,this.h=null,this.i=!1,this.g=null}j(F){this.h=arguments,this.g?this.i=!0:vc(this)}N(){super.N(),this.g&&(y.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ve(T){jt.call(this),this.h=T,this.g={}}B(Ve,jt);var Qt=[];function _n(T){ye(T.g,function(F,J){this.g.hasOwnProperty(J)&&Jr(F)},T),T.g={}}Ve.prototype.N=function(){Ve.aa.N.call(this),_n(this)},Ve.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Qe=y.JSON.stringify,Bt=y.JSON.parse,Ct=class{stringify(T){return y.JSON.stringify(T,void 0)}parse(T){return y.JSON.parse(T,void 0)}};function sn(){}sn.prototype.h=null;function Qn(T){return T.h||(T.h=T.i())}function qn(){}var Bs={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function qd(){Gt.call(this,"d")}B(qd,Gt);function Xl(){Gt.call(this,"c")}B(Xl,Gt);var bo={},F_=null;function yc(){return F_=F_||new es}bo.La="serverreachability";function vm(T){Gt.call(this,bo.La,T)}B(vm,Gt);function ih(T){const F=yc();Sr(F,new vm(F))}bo.STAT_EVENT="statevent";function B_(T,F){Gt.call(this,bo.STAT_EVENT,T),this.stat=F}B(B_,Gt);function Wr(T){const F=yc();Sr(F,new B_(F,T))}bo.Ma="timingevent";function gp(T,F){Gt.call(this,bo.Ma,T),this.size=F}B(gp,Gt);function ah(T,F){if(typeof T!="function")throw Error("Fn must not be null and must be a function");return y.setTimeout(function(){T()},F)}function xo(){this.g=!0}xo.prototype.xa=function(){this.g=!1};function z_(T,F,J,me,Oe,We){T.info(function(){if(T.g)if(We)for(var vt="",Ir=We.split("&"),Si=0;Si<Ir.length;Si++){var Vn=Ir[Si].split("=");if(1<Vn.length){var Hr=Vn[0];Vn=Vn[1];var pi=Hr.split("_");vt=2<=pi.length&&pi[1]=="type"?vt+(Hr+"="+Vn+"&"):vt+(Hr+"=redacted&")}}else vt=null;else vt=We;return"XMLHTTP REQ ("+me+") [attempt "+Oe+"]: "+F+`
`+J+`
`+vt})}function G_(T,F,J,me,Oe,We,vt){T.info(function(){return"XMLHTTP RESP ("+me+") [ attempt "+Oe+"]: "+F+`
`+J+`
`+We+" "+vt})}function $l(T,F,J,me){T.info(function(){return"XMLHTTP TEXT ("+F+"): "+W_(T,J)+(me?" "+me:"")})}function Vy(T,F){T.info(function(){return"TIMEOUT: "+F})}xo.prototype.info=function(){};function W_(T,F){if(!T.g)return F;if(!F)return null;try{var J=JSON.parse(F);if(J){for(T=0;T<J.length;T++)if(Array.isArray(J[T])){var me=J[T];if(!(2>me.length)){var Oe=me[1];if(Array.isArray(Oe)&&!(1>Oe.length)){var We=Oe[0];if(We!="noop"&&We!="stop"&&We!="close")for(var vt=1;vt<Oe.length;vt++)Oe[vt]=""}}}}return Qe(J)}catch{return F}}var oh={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},H_={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Em;function ch(){}B(ch,sn),ch.prototype.g=function(){return new XMLHttpRequest},ch.prototype.i=function(){return{}},Em=new ch;function bc(T,F,J,me){this.j=T,this.i=F,this.l=J,this.R=me||1,this.U=new Ve(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ym}function ym(){this.i=null,this.g="",this.h=!1}var _p={},vp={};function rl(T,F,J){T.L=1,T.v=Xd(Ho(F)),T.m=J,T.P=!0,K_(T,null)}function K_(T,F){T.F=Date.now(),Jl(T),T.A=Ho(T.v);var J=T.A,me=T.R;Array.isArray(me)||(me=[String(me)]),Nm(J.i,"t",me),T.C=0,J=T.j.J,T.h=new ym,T.g=Lm(T.j,J?F:null,!T.m),0<T.O&&(T.M=new Ec(M(T.Y,T,T.g),T.O)),F=T.U,J=T.g,me=T.ca;var Oe="readystatechange";Array.isArray(Oe)||(Oe&&(Qt[0]=Oe.toString()),Oe=Qt);for(var We=0;We<Oe.length;We++){var vt=Oi(J,Oe[We],me||F.handleEvent,!1,F.h||F);if(!vt)break;F.g[vt.key]=vt}F=T.H?$(T.H):{},T.m?(T.u||(T.u="POST"),F["Content-Type"]="application/x-www-form-urlencoded",T.g.ea(T.A,T.u,T.m,F)):(T.u="GET",T.g.ea(T.A,T.u,null,F)),ih(),z_(T.i,T.u,T.A,T.l,T.R,T.m)}bc.prototype.ca=function(T){T=T.target;const F=this.M;F&&qi(T)==3?F.j():this.Y(T)},bc.prototype.Y=function(T){try{if(T==this.g)e:{const pi=qi(this.g);var F=this.g.Ba();const Yo=this.g.Z();if(!(3>pi)&&(pi!=3||this.g&&(this.h.h||this.g.oa()||Om(this.g)))){this.J||pi!=4||F==7||(F==8||0>=Yo?ih(3):ih(2)),Ns(this);var J=this.g.Z();this.X=J;t:if(lh(this)){var me=Om(this.g);T="";var Oe=me.length,We=qi(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){sl(this),dh(this);var vt="";break t}this.h.i=new y.TextDecoder}for(F=0;F<Oe;F++)this.h.h=!0,T+=this.h.i.decode(me[F],{stream:!(We&&F==Oe-1)});me.length=0,this.h.g+=T,this.C=0,vt=this.h.g}else vt=this.g.oa();if(this.o=J==200,G_(this.i,this.u,this.A,this.l,this.R,pi,J),this.o){if(this.T&&!this.K){t:{if(this.g){var Ir,Si=this.g;if((Ir=Si.g?Si.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!V(Ir)){var Vn=Ir;break t}}Vn=null}if(J=Vn)$l(this.i,this.l,J,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ep(this,J);else{this.o=!1,this.s=3,Wr(12),sl(this),dh(this);break e}}if(this.P){J=!0;let Ca;for(;!this.J&&this.C<vt.length;)if(Ca=Wo(this,vt),Ca==vp){pi==4&&(this.s=4,Wr(14),J=!1),$l(this.i,this.l,null,"[Incomplete Response]");break}else if(Ca==_p){this.s=4,Wr(15),$l(this.i,this.l,vt,"[Invalid Chunk]"),J=!1;break}else $l(this.i,this.l,Ca,null),Ep(this,Ca);if(lh(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),pi!=4||vt.length!=0||this.h.h||(this.s=1,Wr(16),J=!1),this.o=this.o&&J,!J)$l(this.i,this.l,vt,"[Invalid Chunked Response]"),sl(this),dh(this);else if(0<vt.length&&!this.W){this.W=!0;var Hr=this.j;Hr.g==this&&Hr.ba&&!Hr.M&&(Hr.j.info("Great, no buffering proxy detected. Bytes received: "+vt.length),qo(Hr),Hr.M=!0,Wr(11))}}else $l(this.i,this.l,vt,null),Ep(this,vt);pi==4&&sl(this),this.o&&!this.J&&(pi==4?os(this.j,this):(this.o=!1,Jl(this)))}else Dm(this.g),J==400&&0<vt.indexOf("Unknown SID")?(this.s=3,Wr(12)):(this.s=0,Wr(13)),sl(this),dh(this)}}}catch{}finally{}};function lh(T){return T.g?T.u=="GET"&&T.L!=2&&T.j.Ca:!1}function Wo(T,F){var J=T.C,me=F.indexOf(`
`,J);return me==-1?vp:(J=Number(F.substring(J,me)),isNaN(J)?_p:(me+=1,me+J>F.length?vp:(F=F.slice(me,me+J),T.C=me+J,F)))}bc.prototype.cancel=function(){this.J=!0,sl(this)};function Jl(T){T.S=Date.now()+T.I,q_(T,T.I)}function q_(T,F){if(T.B!=null)throw Error("WatchDog timer not null");T.B=ah(M(T.ba,T),F)}function Ns(T){T.B&&(y.clearTimeout(T.B),T.B=null)}bc.prototype.ba=function(){this.B=null;const T=Date.now();0<=T-this.S?(Vy(this.i,this.A),this.L!=2&&(ih(),Wr(17)),sl(this),this.s=2,dh(this)):q_(this,this.S-T)};function dh(T){T.j.G==0||T.J||os(T.j,T)}function sl(T){Ns(T);var F=T.M;F&&typeof F.ma=="function"&&F.ma(),T.M=null,_n(T.U),T.g&&(F=T.g,T.g=null,F.abort(),F.ma())}function Ep(T,F){try{var J=T.j;if(J.G!=0&&(J.g==T||xm(J.h,T))){if(!T.K&&xm(J.h,T)&&J.G==3){try{var me=J.Da.g.parse(F)}catch{me=null}if(Array.isArray(me)&&me.length==3){var Oe=me;if(Oe[0]==0){e:if(!J.u){if(J.g)if(J.g.F+3e3<T.F)Qd(J),Ql(J);else break e;dl(J),Wr(18)}}else J.za=Oe[1],0<J.za-J.T&&37500>Oe[2]&&J.F&&J.v==0&&!J.C&&(J.C=ah(M(J.Za,J),6e3));if(1>=bm(J.h)&&J.ca){try{J.ca()}catch{}J.ca=void 0}}else ia(J,11)}else if((T.K||J.g==T)&&Qd(J),!V(F))for(Oe=J.Da.g.parse(F),F=0;F<Oe.length;F++){let Vn=Oe[F];if(J.T=Vn[0],Vn=Vn[1],J.G==2)if(Vn[0]=="c"){J.K=Vn[1],J.ia=Vn[2];const Hr=Vn[3];Hr!=null&&(J.la=Hr,J.j.info("VER="+J.la));const pi=Vn[4];pi!=null&&(J.Aa=pi,J.j.info("SVER="+J.Aa));const Yo=Vn[5];Yo!=null&&typeof Yo=="number"&&0<Yo&&(me=1.5*Yo,J.L=me,J.j.info("backChannelRequestTimeoutMs_="+me)),me=J;const Ca=T.g;if(Ca){const td=Ca.g?Ca.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(td){var We=me.h;We.g||td.indexOf("spdy")==-1&&td.indexOf("quic")==-1&&td.indexOf("h2")==-1||(We.j=We.l,We.g=new Set,We.h&&(bp(We,We.h),We.h=null))}if(me.D){const jm=Ca.g?Ca.g.getResponseHeader("X-HTTP-Session-Id"):null;jm&&(me.ya=jm,ts(me.I,me.D,jm))}}J.G=3,J.l&&J.l.ua(),J.ba&&(J.R=Date.now()-T.F,J.j.info("Handshake RTT: "+J.R+"ms")),me=J;var vt=T;if(me.qa=Sc(me,me.J?me.ia:null,me.W),vt.K){wm(me.h,vt);var Ir=vt,Si=me.L;Si&&(Ir.I=Si),Ir.B&&(Ns(Ir),Jl(Ir)),me.g=vt}else ll(me);0<J.i.length&&Zl(J)}else Vn[0]!="stop"&&Vn[0]!="close"||ia(J,7);else J.G==3&&(Vn[0]=="stop"||Vn[0]=="close"?Vn[0]=="stop"?ia(J,7):Rp(J):Vn[0]!="noop"&&J.l&&J.l.ta(Vn),J.v=0)}}ih(4)}catch{}}var Y_=class{constructor(T,F){this.g=T,this.map=F}};function yp(T){this.l=T||10,y.PerformanceNavigationTiming?(T=y.performance.getEntriesByType("navigation"),T=0<T.length&&(T[0].nextHopProtocol=="hq"||T[0].nextHopProtocol=="h2")):T=!!(y.chrome&&y.chrome.loadTimes&&y.chrome.loadTimes()&&y.chrome.loadTimes().wasFetchedViaSpdy),this.j=T?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function X_(T){return T.h?!0:T.g?T.g.size>=T.j:!1}function bm(T){return T.h?1:T.g?T.g.size:0}function xm(T,F){return T.h?T.h==F:T.g?T.g.has(F):!1}function bp(T,F){T.g?T.g.add(F):T.h=F}function wm(T,F){T.h&&T.h==F?T.h=null:T.g&&T.g.has(F)&&T.g.delete(F)}yp.prototype.cancel=function(){if(this.i=il(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const T of this.g.values())T.cancel();this.g.clear()}};function il(T){if(T.h!=null)return T.i.concat(T.h.D);if(T.g!=null&&T.g.size!==0){let F=T.i;for(const J of T.g.values())F=F.concat(J.D);return F}return X(T.i)}function uh(T){if(T.V&&typeof T.V=="function")return T.V();if(typeof Map<"u"&&T instanceof Map||typeof Set<"u"&&T instanceof Set)return Array.from(T.values());if(typeof T=="string")return T.split("");if(x(T)){for(var F=[],J=T.length,me=0;me<J;me++)F.push(T[me]);return F}F=[],J=0;for(me in T)F[J++]=T[me];return F}function Fy(T){if(T.na&&typeof T.na=="function")return T.na();if(!T.V||typeof T.V!="function"){if(typeof Map<"u"&&T instanceof Map)return Array.from(T.keys());if(!(typeof Set<"u"&&T instanceof Set)){if(x(T)||typeof T=="string"){var F=[];T=T.length;for(var J=0;J<T;J++)F.push(J);return F}F=[],J=0;for(const me in T)F[J++]=me;return F}}}function Nr(T,F){if(T.forEach&&typeof T.forEach=="function")T.forEach(F,void 0);else if(x(T)||typeof T=="string")Array.prototype.forEach.call(T,F,void 0);else for(var J=Fy(T),me=uh(T),Oe=me.length,We=0;We<Oe;We++)F.call(void 0,me[We],J&&J[We],T)}var hh=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Sm(T,F){if(T){T=T.split("&");for(var J=0;J<T.length;J++){var me=T[J].indexOf("="),Oe=null;if(0<=me){var We=T[J].substring(0,me);Oe=T[J].substring(me+1)}else We=T[J];F(We,Oe?decodeURIComponent(Oe.replace(/\+/g," ")):"")}}}function al(T){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,T instanceof al){this.h=T.h,ph(this,T.j),this.o=T.o,this.g=T.g,Yd(this,T.s),this.l=T.l;var F=T.i,J=new $d;J.i=F.i,F.g&&(J.g=new Map(F.g),J.h=F.h),$_(this,J),this.m=T.m}else T&&(F=String(T).match(hh))?(this.h=!1,ph(this,F[1]||"",!0),this.o=xc(F[2]||""),this.g=xc(F[3]||"",!0),Yd(this,F[4]),this.l=xc(F[5]||"",!0),$_(this,F[6]||"",!0),this.m=xc(F[7]||"")):(this.h=!1,this.i=new $d(null,this.h))}al.prototype.toString=function(){var T=[],F=this.j;F&&T.push(wo(F,Tm,!0),":");var J=this.g;return(J||F=="file")&&(T.push("//"),(F=this.o)&&T.push(wo(F,Tm,!0),"@"),T.push(encodeURIComponent(String(J)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),J=this.s,J!=null&&T.push(":",String(J))),(J=this.l)&&(this.g&&J.charAt(0)!="/"&&T.push("/"),T.push(wo(J,J.charAt(0)=="/"?J_:Rm,!0))),(J=this.i.toString())&&T.push("?",J),(J=this.m)&&T.push("#",wo(J,Q_)),T.join("")};function Ho(T){return new al(T)}function ph(T,F,J){T.j=J?xc(F,!0):F,T.j&&(T.j=T.j.replace(/:$/,""))}function Yd(T,F){if(F){if(F=Number(F),isNaN(F)||0>F)throw Error("Bad port number "+F);T.s=F}else T.s=null}function $_(T,F,J){F instanceof $d?(T.i=F,By(T.i,T.h)):(J||(F=wo(F,Cm)),T.i=new $d(F,T.h))}function ts(T,F,J){T.i.set(F,J)}function Xd(T){return ts(T,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),T}function xc(T,F){return T?F?decodeURI(T.replace(/%25/g,"%2525")):decodeURIComponent(T):""}function wo(T,F,J){return typeof T=="string"?(T=encodeURI(T).replace(F,xp),J&&(T=T.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),T):null}function xp(T){return T=T.charCodeAt(0),"%"+(T>>4&15).toString(16)+(T&15).toString(16)}var Tm=/[#\/\?@]/g,Rm=/[#\?:]/g,J_=/[#\?]/g,Cm=/[#\?@]/g,Q_=/#/g;function $d(T,F){this.h=this.g=null,this.i=T||null,this.j=!!F}function ol(T){T.g||(T.g=new Map,T.h=0,T.i&&Sm(T.i,function(F,J){T.add(decodeURIComponent(F.replace(/\+/g," ")),J)}))}s=$d.prototype,s.add=function(T,F){ol(this),this.i=null,T=Jd(this,T);var J=this.g.get(T);return J||this.g.set(T,J=[]),J.push(F),this.h+=1,this};function Z_(T,F){ol(T),F=Jd(T,F),T.g.has(F)&&(T.i=null,T.h-=T.g.get(F).length,T.g.delete(F))}function e0(T,F){return ol(T),F=Jd(T,F),T.g.has(F)}s.forEach=function(T,F){ol(this),this.g.forEach(function(J,me){J.forEach(function(Oe){T.call(F,Oe,me,this)},this)},this)},s.na=function(){ol(this);const T=Array.from(this.g.values()),F=Array.from(this.g.keys()),J=[];for(let me=0;me<F.length;me++){const Oe=T[me];for(let We=0;We<Oe.length;We++)J.push(F[me])}return J},s.V=function(T){ol(this);let F=[];if(typeof T=="string")e0(this,T)&&(F=F.concat(this.g.get(Jd(this,T))));else{T=Array.from(this.g.values());for(let J=0;J<T.length;J++)F=F.concat(T[J])}return F},s.set=function(T,F){return ol(this),this.i=null,T=Jd(this,T),e0(this,T)&&(this.h-=this.g.get(T).length),this.g.set(T,[F]),this.h+=1,this},s.get=function(T,F){return T?(T=this.V(T),0<T.length?String(T[0]):F):F};function Nm(T,F,J){Z_(T,F),0<J.length&&(T.i=null,T.g.set(Jd(T,F),X(J)),T.h+=J.length)}s.toString=function(){if(this.i)return this.i;if(!this.g)return"";const T=[],F=Array.from(this.g.keys());for(var J=0;J<F.length;J++){var me=F[J];const We=encodeURIComponent(String(me)),vt=this.V(me);for(me=0;me<vt.length;me++){var Oe=We;vt[me]!==""&&(Oe+="="+encodeURIComponent(String(vt[me]))),T.push(Oe)}}return this.i=T.join("&")};function Jd(T,F){return F=String(F),T.j&&(F=F.toLowerCase()),F}function By(T,F){F&&!T.j&&(ol(T),T.i=null,T.g.forEach(function(J,me){var Oe=me.toLowerCase();me!=Oe&&(Z_(this,me),Nm(this,Oe,J))},T)),T.j=F}function t0(T,F){const J=new xo;if(y.Image){const me=new Image;me.onload=G(Ko,J,"TestLoadImage: loaded",!0,F,me),me.onerror=G(Ko,J,"TestLoadImage: error",!1,F,me),me.onabort=G(Ko,J,"TestLoadImage: abort",!1,F,me),me.ontimeout=G(Ko,J,"TestLoadImage: timeout",!1,F,me),y.setTimeout(function(){me.ontimeout&&me.ontimeout()},1e4),me.src=T}else F(!1)}function zy(T,F){const J=new xo,me=new AbortController,Oe=setTimeout(()=>{me.abort(),Ko(J,"TestPingServer: timeout",!1,F)},1e4);fetch(T,{signal:me.signal}).then(We=>{clearTimeout(Oe),We.ok?Ko(J,"TestPingServer: ok",!0,F):Ko(J,"TestPingServer: server error",!1,F)}).catch(()=>{clearTimeout(Oe),Ko(J,"TestPingServer: error",!1,F)})}function Ko(T,F,J,me,Oe){try{Oe&&(Oe.onload=null,Oe.onerror=null,Oe.onabort=null,Oe.ontimeout=null),me(J)}catch{}}function Gy(){this.g=new Ct}function fh(T,F,J){const me=J||"";try{Nr(T,function(Oe,We){let vt=Oe;C(Oe)&&(vt=Qe(Oe)),F.push(me+We+"="+encodeURIComponent(vt))})}catch(Oe){throw F.push(me+"type="+encodeURIComponent("_badmap")),Oe}}function wp(T){this.l=T.Ub||null,this.j=T.eb||!1}B(wp,sn),wp.prototype.g=function(){return new Sp(this.l,this.j)},wp.prototype.i=function(T){return function(){return T}}({});function Sp(T,F){es.call(this),this.D=T,this.o=F,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}B(Sp,es),s=Sp.prototype,s.open=function(T,F){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=T,this.A=F,this.readyState=1,Tr(this)},s.send=function(T){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const F={headers:this.u,method:this.B,credentials:this.m,cache:void 0};T&&(F.body=T),(this.D||y).fetch(new Request(this.A,F)).then(this.Sa.bind(this),this.ga.bind(this))},s.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Dr(this)),this.readyState=0},s.Sa=function(T){if(this.g&&(this.l=T,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=T.headers,this.readyState=2,Tr(this)),this.g&&(this.readyState=3,Tr(this),this.g)))if(this.responseType==="arraybuffer")T.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof y.ReadableStream<"u"&&"body"in T){if(this.j=T.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;n0(this)}else T.text().then(this.Ra.bind(this),this.ga.bind(this))};function n0(T){T.j.read().then(T.Pa.bind(T)).catch(T.ga.bind(T))}s.Pa=function(T){if(this.g){if(this.o&&T.value)this.response.push(T.value);else if(!this.o){var F=T.value?T.value:new Uint8Array(0);(F=this.v.decode(F,{stream:!T.done}))&&(this.response=this.responseText+=F)}T.done?Dr(this):Tr(this),this.readyState==3&&n0(this)}},s.Ra=function(T){this.g&&(this.response=this.responseText=T,Dr(this))},s.Qa=function(T){this.g&&(this.response=T,Dr(this))},s.ga=function(){this.g&&Dr(this)};function Dr(T){T.readyState=4,T.l=null,T.j=null,T.v=null,Tr(T)}s.setRequestHeader=function(T,F){this.u.append(T,F)},s.getResponseHeader=function(T){return this.h&&this.h.get(T.toLowerCase())||""},s.getAllResponseHeaders=function(){if(!this.h)return"";const T=[],F=this.h.entries();for(var J=F.next();!J.done;)J=J.value,T.push(J[0]+": "+J[1]),J=F.next();return T.join(`\r
`)};function Tr(T){T.onreadystatechange&&T.onreadystatechange.call(T)}Object.defineProperty(Sp.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(T){this.m=T?"include":"same-origin"}});function r0(T){let F="";return ye(T,function(J,me){F+=me,F+=":",F+=J,F+=`\r
`}),F}function Im(T,F,J){e:{for(me in J){var me=!1;break e}me=!0}me||(J=r0(J),typeof T=="string"?J!=null&&encodeURIComponent(String(J)):ts(T,F,J))}function Is(T){es.call(this),this.headers=new Map,this.o=T||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}B(Is,es);var cl=/^https?$/i,eo=["POST","PUT"];s=Is.prototype,s.Ha=function(T){this.J=T},s.ea=function(T,F,J,me){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+T);F=F?F.toUpperCase():"GET",this.D=T,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Em.g(),this.v=this.o?Qn(this.o):Qn(Em),this.g.onreadystatechange=M(this.Ea,this);try{this.B=!0,this.g.open(F,String(T),!0),this.B=!1}catch(We){Am(this,We);return}if(T=J||"",J=new Map(this.headers),me)if(Object.getPrototypeOf(me)===Object.prototype)for(var Oe in me)J.set(Oe,me[Oe]);else if(typeof me.keys=="function"&&typeof me.get=="function")for(const We of me.keys())J.set(We,me.get(We));else throw Error("Unknown input type for opt_headers: "+String(me));me=Array.from(J.keys()).find(We=>We.toLowerCase()=="content-type"),Oe=y.FormData&&T instanceof y.FormData,!(0<=Array.prototype.indexOf.call(eo,F,void 0))||me||Oe||J.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[We,vt]of J)this.g.setRequestHeader(We,vt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{hi(this),this.u=!0,this.g.send(T),this.u=!1}catch(We){Am(this,We)}};function Am(T,F){T.h=!1,T.g&&(T.j=!0,T.g.abort(),T.j=!1),T.l=F,T.m=5,km(T),zs(T)}function km(T){T.A||(T.A=!0,Sr(T,"complete"),Sr(T,"error"))}s.abort=function(T){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=T||7,Sr(this,"complete"),Sr(this,"abort"),zs(this))},s.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),zs(this,!0)),Is.aa.N.call(this)},s.Ea=function(){this.s||(this.B||this.u||this.j?s0(this):this.bb())},s.bb=function(){s0(this)};function s0(T){if(T.h&&typeof g<"u"&&(!T.v[1]||qi(T)!=4||T.Z()!=2)){if(T.u&&qi(T)==4)Go(T.Ea,0,T);else if(Sr(T,"readystatechange"),qi(T)==4){T.h=!1;try{const vt=T.Z();e:switch(vt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var F=!0;break e;default:F=!1}var J;if(!(J=F)){var me;if(me=vt===0){var Oe=String(T.D).match(hh)[1]||null;!Oe&&y.self&&y.self.location&&(Oe=y.self.location.protocol.slice(0,-1)),me=!cl.test(Oe?Oe.toLowerCase():"")}J=me}if(J)Sr(T,"complete"),Sr(T,"success");else{T.m=6;try{var We=2<qi(T)?T.g.statusText:""}catch{We=""}T.l=We+" ["+T.Z()+"]",km(T)}}finally{zs(T)}}}}function zs(T,F){if(T.g){hi(T);const J=T.g,me=T.v[0]?()=>{}:null;T.g=null,T.v=null,F||Sr(T,"ready");try{J.onreadystatechange=me}catch{}}}function hi(T){T.I&&(y.clearTimeout(T.I),T.I=null)}s.isActive=function(){return!!this.g};function qi(T){return T.g?T.g.readyState:0}s.Z=function(){try{return 2<qi(this)?this.g.status:-1}catch{return-1}},s.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},s.Oa=function(T){if(this.g){var F=this.g.responseText;return T&&F.indexOf(T)==0&&(F=F.substring(T.length)),Bt(F)}};function Om(T){try{if(!T.g)return null;if("response"in T.g)return T.g.response;switch(T.H){case"":case"text":return T.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in T.g)return T.g.mozResponseArrayBuffer}return null}catch{return null}}function Dm(T){const F={};T=(T.g&&2<=qi(T)&&T.g.getAllResponseHeaders()||"").split(`\r
`);for(let me=0;me<T.length;me++){if(V(T[me]))continue;var J=he(T[me]);const Oe=J[0];if(J=J[1],typeof J!="string")continue;J=J.trim();const We=F[Oe]||[];F[Oe]=We,We.push(J)}Q(F,function(me){return me.join(", ")})}s.Ba=function(){return this.m},s.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ei(T,F,J){return J&&J.internalChannelParams&&J.internalChannelParams[T]||F}function Tp(T){this.Aa=0,this.i=[],this.j=new xo,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ei("failFast",!1,T),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ei("baseRetryDelayMs",5e3,T),this.cb=ei("retryDelaySeedMs",1e4,T),this.Wa=ei("forwardChannelMaxRetries",2,T),this.wa=ei("forwardChannelRequestTimeoutMs",2e4,T),this.pa=T&&T.xmlHttpFactory||void 0,this.Xa=T&&T.Tb||void 0,this.Ca=T&&T.useFetchStreams||!1,this.L=void 0,this.J=T&&T.supportsCrossDomainXhr||!1,this.K="",this.h=new yp(T&&T.concurrentRequestLimit),this.Da=new Gy,this.P=T&&T.fastHandshake||!1,this.O=T&&T.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=T&&T.Rb||!1,T&&T.xa&&this.j.xa(),T&&T.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&T&&T.detectBufferingProxy||!1,this.ja=void 0,T&&T.longPollingTimeout&&0<T.longPollingTimeout&&(this.ja=T.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}s=Tp.prototype,s.la=8,s.G=1,s.connect=function(T,F,J,me){Wr(0),this.W=T,this.H=F||{},J&&me!==void 0&&(this.H.OSID=J,this.H.OAID=me),this.F=this.X,this.I=Sc(this,null,this.W),Zl(this)};function Rp(T){if(Pm(T),T.G==3){var F=T.U++,J=Ho(T.I);if(ts(J,"SID",T.K),ts(J,"RID",F),ts(J,"TYPE","terminate"),mh(T,J),F=new bc(T,T.j,F),F.L=2,F.v=Xd(Ho(J)),J=!1,y.navigator&&y.navigator.sendBeacon)try{J=y.navigator.sendBeacon(F.v.toString(),"")}catch{}!J&&y.Image&&(new Image().src=F.v,J=!0),J||(F.g=Lm(F.j,null),F.g.ea(F.v)),F.F=Date.now(),Jl(F)}i0(T)}function Ql(T){T.g&&(qo(T),T.g.cancel(),T.g=null)}function Pm(T){Ql(T),T.u&&(y.clearTimeout(T.u),T.u=null),Qd(T),T.h.cancel(),T.s&&(typeof T.s=="number"&&y.clearTimeout(T.s),T.s=null)}function Zl(T){if(!X_(T.h)&&!T.s){T.s=!0;var F=T.Ga;Ye||yt(),ze||(Ye(),ze=!0),ut.add(F,T),T.B=0}}function Cp(T,F){return bm(T.h)>=T.h.j-(T.s?1:0)?!1:T.s?(T.i=F.D.concat(T.i),!0):T.G==1||T.G==2||T.B>=(T.Va?0:T.Wa)?!1:(T.s=ah(M(T.Ga,T,F),wc(T,T.B)),T.B++,!0)}s.Ga=function(T){if(this.s)if(this.s=null,this.G==1){if(!T){this.U=Math.floor(1e5*Math.random()),T=this.U++;const Oe=new bc(this,this.j,T);let We=this.o;if(this.S&&(We?(We=$(We),ce(We,this.S)):We=this.S),this.m!==null||this.O||(Oe.H=We,We=null),this.P)e:{for(var F=0,J=0;J<this.i.length;J++){t:{var me=this.i[J];if("__data__"in me.map&&(me=me.map.__data__,typeof me=="string")){me=me.length;break t}me=void 0}if(me===void 0)break;if(F+=me,4096<F){F=J;break e}if(F===4096||J===this.i.length-1){F=J+1;break e}}F=1e3}else F=1e3;F=Ra(this,Oe,F),J=Ho(this.I),ts(J,"RID",T),ts(J,"CVER",22),this.D&&ts(J,"X-HTTP-Session-Id",this.D),mh(this,J),We&&(this.O?F="headers="+encodeURIComponent(String(r0(We)))+"&"+F:this.m&&Im(J,this.m,We)),bp(this.h,Oe),this.Ua&&ts(J,"TYPE","init"),this.P?(ts(J,"$req",F),ts(J,"SID","null"),Oe.T=!0,rl(Oe,J,null)):rl(Oe,J,F),this.G=2}}else this.G==3&&(T?Di(this,T):this.i.length==0||X_(this.h)||Di(this))};function Di(T,F){var J;F?J=F.l:J=T.U++;const me=Ho(T.I);ts(me,"SID",T.K),ts(me,"RID",J),ts(me,"AID",T.T),mh(T,me),T.m&&T.o&&Im(me,T.m,T.o),J=new bc(T,T.j,J,T.B+1),T.m===null&&(J.H=T.o),F&&(T.i=F.D.concat(T.i)),F=Ra(T,J,1e3),J.I=Math.round(.5*T.wa)+Math.round(.5*T.wa*Math.random()),bp(T.h,J),rl(J,me,F)}function mh(T,F){T.H&&ye(T.H,function(J,me){ts(F,me,J)}),T.l&&Nr({},function(J,me){ts(F,me,J)})}function Ra(T,F,J){J=Math.min(T.i.length,J);var me=T.l?M(T.l.Na,T.l,T):null;e:{var Oe=T.i;let We=-1;for(;;){const vt=["count="+J];We==-1?0<J?(We=Oe[0].g,vt.push("ofs="+We)):We=0:vt.push("ofs="+We);let Ir=!0;for(let Si=0;Si<J;Si++){let Vn=Oe[Si].g;const Hr=Oe[Si].map;if(Vn-=We,0>Vn)We=Math.max(0,Oe[Si].g-100),Ir=!1;else try{fh(Hr,vt,"req"+Vn+"_")}catch{me&&me(Hr)}}if(Ir){me=vt.join("&");break e}}}return T=T.i.splice(0,J),F.D=T,me}function ll(T){if(!T.g&&!T.u){T.Y=1;var F=T.Fa;Ye||yt(),ze||(Ye(),ze=!0),ut.add(F,T),T.v=0}}function dl(T){return T.g||T.u||3<=T.v?!1:(T.Y++,T.u=ah(M(T.Fa,T),wc(T,T.v)),T.v++,!0)}s.Fa=function(){if(this.u=null,gh(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var T=2*this.R;this.j.info("BP detection timer enabled: "+T),this.A=ah(M(this.ab,this),T)}},s.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Wr(10),Ql(this),gh(this))};function qo(T){T.A!=null&&(y.clearTimeout(T.A),T.A=null)}function gh(T){T.g=new bc(T,T.j,"rpc",T.Y),T.m===null&&(T.g.H=T.o),T.g.O=0;var F=Ho(T.qa);ts(F,"RID","rpc"),ts(F,"SID",T.K),ts(F,"AID",T.T),ts(F,"CI",T.F?"0":"1"),!T.F&&T.ja&&ts(F,"TO",T.ja),ts(F,"TYPE","xmlhttp"),mh(T,F),T.m&&T.o&&Im(F,T.m,T.o),T.L&&(T.g.I=T.L);var J=T.g;T=T.ia,J.L=1,J.v=Xd(Ho(F)),J.m=null,J.P=!0,K_(J,T)}s.Za=function(){this.C!=null&&(this.C=null,Ql(this),dl(this),Wr(19))};function Qd(T){T.C!=null&&(y.clearTimeout(T.C),T.C=null)}function os(T,F){var J=null;if(T.g==F){Qd(T),qo(T),T.g=null;var me=2}else if(xm(T.h,F))J=F.D,wm(T.h,F),me=1;else return;if(T.G!=0){if(F.o)if(me==1){J=F.m?F.m.length:0,F=Date.now()-F.F;var Oe=T.B;me=yc(),Sr(me,new gp(me,J)),Zl(T)}else ll(T);else if(Oe=F.s,Oe==3||Oe==0&&0<F.X||!(me==1&&Cp(T,F)||me==2&&dl(T)))switch(J&&0<J.length&&(F=T.h,F.i=F.i.concat(J)),Oe){case 1:ia(T,5);break;case 4:ia(T,10);break;case 3:ia(T,6);break;default:ia(T,2)}}}function wc(T,F){let J=T.Ta+Math.floor(Math.random()*T.cb);return T.isActive()||(J*=2),J*F}function ia(T,F){if(T.j.info("Error code "+F),F==2){var J=M(T.fb,T),me=T.Xa;const Oe=!me;me=new al(me||"//www.google.com/images/cleardot.gif"),y.location&&y.location.protocol=="http"||ph(me,"https"),Xd(me),Oe?t0(me.toString(),J):zy(me.toString(),J)}else Wr(2);T.G=0,T.l&&T.l.sa(F),i0(T),Pm(T)}s.fb=function(T){T?(this.j.info("Successfully pinged google.com"),Wr(2)):(this.j.info("Failed to ping google.com"),Wr(1))};function i0(T){if(T.G=0,T.ka=[],T.l){const F=il(T.h);(F.length!=0||T.i.length!=0)&&(Z(T.ka,F),Z(T.ka,T.i),T.h.i.length=0,X(T.i),T.i.length=0),T.l.ra()}}function Sc(T,F,J){var me=J instanceof al?Ho(J):new al(J);if(me.g!="")F&&(me.g=F+"."+me.g),Yd(me,me.s);else{var Oe=y.location;me=Oe.protocol,F=F?F+"."+Oe.hostname:Oe.hostname,Oe=+Oe.port;var We=new al(null);me&&ph(We,me),F&&(We.g=F),Oe&&Yd(We,Oe),J&&(We.l=J),me=We}return J=T.D,F=T.ya,J&&F&&ts(me,J,F),ts(me,"VER",T.la),mh(T,me),me}function Lm(T,F,J){if(F&&!T.J)throw Error("Can't create secondary domain capable XhrIo object.");return F=T.Ca&&!T.pa?new Is(new wp({eb:J})):new Is(T.pa),F.Ha(T.J),F}s.isActive=function(){return!!this.l&&this.l.isActive(this)};function a0(){}s=a0.prototype,s.ua=function(){},s.ta=function(){},s.sa=function(){},s.ra=function(){},s.isActive=function(){return!0},s.Na=function(){};function vn(){}vn.prototype.g=function(T,F){return new aa(T,F)};function aa(T,F){es.call(this),this.g=new Tp(F),this.l=T,this.h=F&&F.messageUrlParams||null,T=F&&F.messageHeaders||null,F&&F.clientProtocolHeaderRequired&&(T?T["X-Client-Protocol"]="webchannel":T={"X-Client-Protocol":"webchannel"}),this.g.o=T,T=F&&F.initMessageHeaders||null,F&&F.messageContentType&&(T?T["X-WebChannel-Content-Type"]=F.messageContentType:T={"X-WebChannel-Content-Type":F.messageContentType}),F&&F.va&&(T?T["X-WebChannel-Client-Profile"]=F.va:T={"X-WebChannel-Client-Profile":F.va}),this.g.S=T,(T=F&&F.Sb)&&!V(T)&&(this.g.m=T),this.v=F&&F.supportsCrossDomainXhr||!1,this.u=F&&F.sendRawJson||!1,(F=F&&F.httpSessionIdParam)&&!V(F)&&(this.g.D=F,T=this.h,T!==null&&F in T&&(T=this.h,F in T&&delete T[F])),this.j=new Zd(this)}B(aa,es),aa.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},aa.prototype.close=function(){Rp(this.g)},aa.prototype.o=function(T){var F=this.g;if(typeof T=="string"){var J={};J.__data__=T,T=J}else this.u&&(J={},J.__data__=Qe(T),T=J);F.i.push(new Y_(F.Ya++,T)),F.G==3&&Zl(F)},aa.prototype.N=function(){this.g.l=null,delete this.j,Rp(this.g),delete this.g,aa.aa.N.call(this)};function _h(T){qd.call(this),T.__headers__&&(this.headers=T.__headers__,this.statusCode=T.__status__,delete T.__headers__,delete T.__status__);var F=T.__sm__;if(F){e:{for(const J in F){T=J;break e}T=void 0}(this.i=T)&&(T=this.i,F=F!==null&&T in F?F[T]:void 0),this.data=F}else this.data=T}B(_h,qd);function ed(){Xl.call(this),this.status=1}B(ed,Xl);function Zd(T){this.g=T}B(Zd,a0),Zd.prototype.ua=function(){Sr(this.g,"a")},Zd.prototype.ta=function(T){Sr(this.g,new _h(T))},Zd.prototype.sa=function(T){Sr(this.g,new ed)},Zd.prototype.ra=function(){Sr(this.g,"b")},vn.prototype.createWebChannel=vn.prototype.g,aa.prototype.send=aa.prototype.o,aa.prototype.open=aa.prototype.m,aa.prototype.close=aa.prototype.close,Rte=function(){return new vn},Tte=function(){return yc()},Ste=bo,H5={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},oh.NO_ERROR=0,oh.TIMEOUT=8,oh.HTTP_ERROR=6,h1=oh,H_.COMPLETE="complete",wte=H_,qn.EventType=Bs,Bs.OPEN="a",Bs.CLOSE="b",Bs.ERROR="c",Bs.MESSAGE="d",es.prototype.listen=es.prototype.K,qw=qn,Is.prototype.listenOnce=Is.prototype.L,Is.prototype.getLastError=Is.prototype.Ka,Is.prototype.getLastErrorCode=Is.prototype.Ba,Is.prototype.getStatus=Is.prototype.Z,Is.prototype.getResponseJson=Is.prototype.Oa,Is.prototype.getResponseText=Is.prototype.oa,Is.prototype.send=Is.prototype.ea,Is.prototype.setWithCredentials=Is.prototype.Ha,xte=Is}).apply(typeof FA<"u"?FA:typeof self<"u"?self:typeof window<"u"?window:{});const C$="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let go=class{constructor(n){this.uid=n}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(n){return n.uid===this.uid}};go.UNAUTHENTICATED=new go(null),go.GOOGLE_CREDENTIALS=new go("google-credentials-uid"),go.FIRST_PARTY=new go("first-party-uid"),go.MOCK_USER=new go("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ky="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N_=new b3("@firebase/firestore");function Mw(){return N_.logLevel}function $t(s,...n){if(N_.logLevel<=Cr.DEBUG){const i=n.map(V3);N_.debug(`Firestore (${ky}): ${s}`,...i)}}function lp(s,...n){if(N_.logLevel<=Cr.ERROR){const i=n.map(V3);N_.error(`Firestore (${ky}): ${s}`,...i)}}function oy(s,...n){if(N_.logLevel<=Cr.WARN){const i=n.map(V3);N_.warn(`Firestore (${ky}): ${s}`,...i)}}function V3(s){if(typeof s=="string")return s;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(i){return JSON.stringify(i)}(s)}catch{return s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rn(s="Unexpected state"){const n=`FIRESTORE (${ky}) INTERNAL ASSERTION FAILED: `+s;throw lp(n),new Error(n)}function Fr(s,n){s||Rn()}function Ln(s,n){return s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const st={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class kt extends th{constructor(n,i){super(n,i),this.code=n,this.message=i,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xu{constructor(){this.promise=new Promise((n,i)=>{this.resolve=n,this.reject=i})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cte{constructor(n,i){this.user=i,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${n}`)}}class Xye{getToken(){return Promise.resolve(null)}invalidateToken(){}start(n,i){n.enqueueRetryable(()=>i(go.UNAUTHENTICATED))}shutdown(){}}class $ye{constructor(n){this.token=n,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(n,i){this.changeListener=i,n.enqueueRetryable(()=>i(this.token.user))}shutdown(){this.changeListener=null}}class Jye{constructor(n){this.t=n,this.currentUser=go.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(n,i){Fr(this.o===void 0);let l=this.i;const u=x=>this.i!==l?(l=this.i,i(x)):Promise.resolve();let p=new Xu;this.o=()=>{this.i++,this.currentUser=this.u(),p.resolve(),p=new Xu,n.enqueueRetryable(()=>u(this.currentUser))};const g=()=>{const x=p;n.enqueueRetryable(async()=>{await x.promise,await u(this.currentUser)})},y=x=>{$t("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=x,this.o&&(this.auth.addAuthTokenListener(this.o),g())};this.t.onInit(x=>y(x)),setTimeout(()=>{if(!this.auth){const x=this.t.getImmediate({optional:!0});x?y(x):($t("FirebaseAuthCredentialsProvider","Auth not yet detected"),p.resolve(),p=new Xu)}},0),g()}getToken(){const n=this.i,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then(l=>this.i!==n?($t("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):l?(Fr(typeof l.accessToken=="string"),new Cte(l.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const n=this.auth&&this.auth.getUid();return Fr(n===null||typeof n=="string"),new go(n)}}class Qye{constructor(n,i,l){this.l=n,this.h=i,this.P=l,this.type="FirstParty",this.user=go.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const n=this.T();return n&&this.I.set("Authorization",n),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Zye{constructor(n,i,l){this.l=n,this.h=i,this.P=l}getToken(){return Promise.resolve(new Qye(this.l,this.h,this.P))}start(n,i){n.enqueueRetryable(()=>i(go.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class ebe{constructor(n){this.value=n,this.type="AppCheck",this.headers=new Map,n&&n.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class tbe{constructor(n){this.A=n,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(n,i){Fr(this.o===void 0);const l=p=>{p.error!=null&&$t("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${p.error.message}`);const g=p.token!==this.R;return this.R=p.token,$t("FirebaseAppCheckTokenProvider",`Received ${g?"new":"existing"} token.`),g?i(p.token):Promise.resolve()};this.o=p=>{n.enqueueRetryable(()=>l(p))};const u=p=>{$t("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=p,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(p=>u(p)),setTimeout(()=>{if(!this.appCheck){const p=this.A.getImmediate({optional:!0});p?u(p):$t("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const n=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(n).then(i=>i?(Fr(typeof i.token=="string"),this.R=i.token,new ebe(i.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nbe(s){const n=typeof self<"u"&&(self.crypto||self.msCrypto),i=new Uint8Array(s);if(n&&typeof n.getRandomValues=="function")n.getRandomValues(i);else for(let l=0;l<s;l++)i[l]=Math.floor(256*Math.random());return i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nte{static newId(){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=Math.floor(256/n.length)*n.length;let l="";for(;l.length<20;){const u=nbe(40);for(let p=0;p<u.length;++p)l.length<20&&u[p]<i&&(l+=n.charAt(u[p]%n.length))}return l}}function $r(s,n){return s<n?-1:s>n?1:0}function cy(s,n,i){return s.length===n.length&&s.every((l,u)=>i(l,n[u]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cn{constructor(n,i){if(this.seconds=n,this.nanoseconds=i,i<0)throw new kt(st.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new kt(st.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(n<-62135596800)throw new kt(st.INVALID_ARGUMENT,"Timestamp seconds out of range: "+n);if(n>=253402300800)throw new kt(st.INVALID_ARGUMENT,"Timestamp seconds out of range: "+n)}static now(){return cn.fromMillis(Date.now())}static fromDate(n){return cn.fromMillis(n.getTime())}static fromMillis(n){const i=Math.floor(n/1e3),l=Math.floor(1e6*(n-1e3*i));return new cn(i,l)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(n){return this.seconds===n.seconds?$r(this.nanoseconds,n.nanoseconds):$r(this.seconds,n.seconds)}isEqual(n){return n.seconds===this.seconds&&n.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const n=this.seconds- -62135596800;return String(n).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class In{constructor(n){this.timestamp=n}static fromTimestamp(n){return new In(n)}static min(){return new In(new cn(0,0))}static max(){return new In(new cn(253402300799,999999999))}compareTo(n){return this.timestamp._compareTo(n.timestamp)}isEqual(n){return this.timestamp.isEqual(n.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BS{constructor(n,i,l){i===void 0?i=0:i>n.length&&Rn(),l===void 0?l=n.length-i:l>n.length-i&&Rn(),this.segments=n,this.offset=i,this.len=l}get length(){return this.len}isEqual(n){return BS.comparator(this,n)===0}child(n){const i=this.segments.slice(this.offset,this.limit());return n instanceof BS?n.forEach(l=>{i.push(l)}):i.push(n),this.construct(i)}limit(){return this.offset+this.length}popFirst(n){return n=n===void 0?1:n,this.construct(this.segments,this.offset+n,this.length-n)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(n){return this.segments[this.offset+n]}isEmpty(){return this.length===0}isPrefixOf(n){if(n.length<this.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==n.get(i))return!1;return!0}isImmediateParentOf(n){if(this.length+1!==n.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==n.get(i))return!1;return!0}forEach(n){for(let i=this.offset,l=this.limit();i<l;i++)n(this.segments[i])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(n,i){const l=Math.min(n.length,i.length);for(let u=0;u<l;u++){const p=n.get(u),g=i.get(u);if(p<g)return-1;if(p>g)return 1}return n.length<i.length?-1:n.length>i.length?1:0}}class Ts extends BS{construct(n,i,l){return new Ts(n,i,l)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...n){const i=[];for(const l of n){if(l.indexOf("//")>=0)throw new kt(st.INVALID_ARGUMENT,`Invalid segment (${l}). Paths must not contain // in them.`);i.push(...l.split("/").filter(u=>u.length>0))}return new Ts(i)}static emptyPath(){return new Ts([])}}const rbe=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ha extends BS{construct(n,i,l){return new Ha(n,i,l)}static isValidIdentifier(n){return rbe.test(n)}canonicalString(){return this.toArray().map(n=>(n=n.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ha.isValidIdentifier(n)||(n="`"+n+"`"),n)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Ha(["__name__"])}static fromServerFormat(n){const i=[];let l="",u=0;const p=()=>{if(l.length===0)throw new kt(st.INVALID_ARGUMENT,`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);i.push(l),l=""};let g=!1;for(;u<n.length;){const y=n[u];if(y==="\\"){if(u+1===n.length)throw new kt(st.INVALID_ARGUMENT,"Path has trailing escape character: "+n);const x=n[u+1];if(x!=="\\"&&x!=="."&&x!=="`")throw new kt(st.INVALID_ARGUMENT,"Path has invalid escape sequence: "+n);l+=x,u+=2}else y==="`"?(g=!g,u++):y!=="."||g?(l+=y,u++):(p(),u++)}if(p(),g)throw new kt(st.INVALID_ARGUMENT,"Unterminated ` in path: "+n);return new Ha(i)}static emptyPath(){return new Ha([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class on{constructor(n){this.path=n}static fromPath(n){return new on(Ts.fromString(n))}static fromName(n){return new on(Ts.fromString(n).popFirst(5))}static empty(){return new on(Ts.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(n){return this.path.length>=2&&this.path.get(this.path.length-2)===n}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(n){return n!==null&&Ts.comparator(this.path,n.path)===0}toString(){return this.path.toString()}static comparator(n,i){return Ts.comparator(n.path,i.path)}static isDocumentKey(n){return n.length%2==0}static fromSegments(n){return new on(new Ts(n.slice()))}}function sbe(s,n){const i=s.toTimestamp().seconds,l=s.toTimestamp().nanoseconds+1,u=In.fromTimestamp(l===1e9?new cn(i+1,0):new cn(i,l));return new dm(u,on.empty(),n)}function ibe(s){return new dm(s.readTime,s.key,-1)}class dm{constructor(n,i,l){this.readTime=n,this.documentKey=i,this.largestBatchId=l}static min(){return new dm(In.min(),on.empty(),-1)}static max(){return new dm(In.max(),on.empty(),-1)}}function abe(s,n){let i=s.readTime.compareTo(n.readTime);return i!==0?i:(i=on.comparator(s.documentKey,n.documentKey),i!==0?i:$r(s.largestBatchId,n.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const obe="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class cbe{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(n){this.onCommittedListeners.push(n)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(n=>n())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fT(s){if(s.code!==st.FAILED_PRECONDITION||s.message!==obe)throw s;$t("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ht{constructor(n){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,n(i=>{this.isDone=!0,this.result=i,this.nextCallback&&this.nextCallback(i)},i=>{this.isDone=!0,this.error=i,this.catchCallback&&this.catchCallback(i)})}catch(n){return this.next(void 0,n)}next(n,i){return this.callbackAttached&&Rn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(n,this.result):new ht((l,u)=>{this.nextCallback=p=>{this.wrapSuccess(n,p).next(l,u)},this.catchCallback=p=>{this.wrapFailure(i,p).next(l,u)}})}toPromise(){return new Promise((n,i)=>{this.next(n,i)})}wrapUserFunction(n){try{const i=n();return i instanceof ht?i:ht.resolve(i)}catch(i){return ht.reject(i)}}wrapSuccess(n,i){return n?this.wrapUserFunction(()=>n(i)):ht.resolve(i)}wrapFailure(n,i){return n?this.wrapUserFunction(()=>n(i)):ht.reject(i)}static resolve(n){return new ht((i,l)=>{i(n)})}static reject(n){return new ht((i,l)=>{l(n)})}static waitFor(n){return new ht((i,l)=>{let u=0,p=0,g=!1;n.forEach(y=>{++u,y.next(()=>{++p,g&&p===u&&i()},x=>l(x))}),g=!0,p===u&&i()})}static or(n){let i=ht.resolve(!1);for(const l of n)i=i.next(u=>u?ht.resolve(u):l());return i}static forEach(n,i){const l=[];return n.forEach((u,p)=>{l.push(i.call(this,u,p))}),this.waitFor(l)}static mapArray(n,i){return new ht((l,u)=>{const p=n.length,g=new Array(p);let y=0;for(let x=0;x<p;x++){const C=x;i(n[C]).next(k=>{g[C]=k,++y,y===p&&l(g)},k=>u(k))}})}static doWhile(n,i){return new ht((l,u)=>{const p=()=>{n()===!0?i().next(()=>{p()},u):l()};p()})}}function lbe(s){const n=s.match(/Android ([\d.]+)/i),i=n?n[1].split(".").slice(0,2).join("."):"-1";return Number(i)}function mT(s){return s.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F3{constructor(n,i){this.previousValue=n,i&&(i.sequenceNumberHandler=l=>this.ie(l),this.se=l=>i.writeSequenceNumber(l))}ie(n){return this.previousValue=Math.max(n,this.previousValue),this.previousValue}next(){const n=++this.previousValue;return this.se&&this.se(n),n}}F3.oe=-1;function gT(s){return s==null}function Q1(s){return s===0&&1/s==-1/0}function dbe(s){return typeof s=="number"&&Number.isInteger(s)&&!Q1(s)&&s<=Number.MAX_SAFE_INTEGER&&s>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N$(s){let n=0;for(const i in s)Object.prototype.hasOwnProperty.call(s,i)&&n++;return n}function M_(s,n){for(const i in s)Object.prototype.hasOwnProperty.call(s,i)&&n(i,s[i])}function Ite(s){for(const n in s)if(Object.prototype.hasOwnProperty.call(s,n))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ui{constructor(n,i){this.comparator=n,this.root=i||Wa.EMPTY}insert(n,i){return new ui(this.comparator,this.root.insert(n,i,this.comparator).copy(null,null,Wa.BLACK,null,null))}remove(n){return new ui(this.comparator,this.root.remove(n,this.comparator).copy(null,null,Wa.BLACK,null,null))}get(n){let i=this.root;for(;!i.isEmpty();){const l=this.comparator(n,i.key);if(l===0)return i.value;l<0?i=i.left:l>0&&(i=i.right)}return null}indexOf(n){let i=0,l=this.root;for(;!l.isEmpty();){const u=this.comparator(n,l.key);if(u===0)return i+l.left.size;u<0?l=l.left:(i+=l.left.size+1,l=l.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(n){return this.root.inorderTraversal(n)}forEach(n){this.inorderTraversal((i,l)=>(n(i,l),!1))}toString(){const n=[];return this.inorderTraversal((i,l)=>(n.push(`${i}:${l}`),!1)),`{${n.join(", ")}}`}reverseTraversal(n){return this.root.reverseTraversal(n)}getIterator(){return new BA(this.root,null,this.comparator,!1)}getIteratorFrom(n){return new BA(this.root,n,this.comparator,!1)}getReverseIterator(){return new BA(this.root,null,this.comparator,!0)}getReverseIteratorFrom(n){return new BA(this.root,n,this.comparator,!0)}}class BA{constructor(n,i,l,u){this.isReverse=u,this.nodeStack=[];let p=1;for(;!n.isEmpty();)if(p=i?l(n.key,i):1,i&&u&&(p*=-1),p<0)n=this.isReverse?n.left:n.right;else{if(p===0){this.nodeStack.push(n);break}this.nodeStack.push(n),n=this.isReverse?n.right:n.left}}getNext(){let n=this.nodeStack.pop();const i={key:n.key,value:n.value};if(this.isReverse)for(n=n.left;!n.isEmpty();)this.nodeStack.push(n),n=n.right;else for(n=n.right;!n.isEmpty();)this.nodeStack.push(n),n=n.left;return i}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const n=this.nodeStack[this.nodeStack.length-1];return{key:n.key,value:n.value}}}class Wa{constructor(n,i,l,u,p){this.key=n,this.value=i,this.color=l??Wa.RED,this.left=u??Wa.EMPTY,this.right=p??Wa.EMPTY,this.size=this.left.size+1+this.right.size}copy(n,i,l,u,p){return new Wa(n??this.key,i??this.value,l??this.color,u??this.left,p??this.right)}isEmpty(){return!1}inorderTraversal(n){return this.left.inorderTraversal(n)||n(this.key,this.value)||this.right.inorderTraversal(n)}reverseTraversal(n){return this.right.reverseTraversal(n)||n(this.key,this.value)||this.left.reverseTraversal(n)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(n,i,l){let u=this;const p=l(n,u.key);return u=p<0?u.copy(null,null,null,u.left.insert(n,i,l),null):p===0?u.copy(null,i,null,null,null):u.copy(null,null,null,null,u.right.insert(n,i,l)),u.fixUp()}removeMin(){if(this.left.isEmpty())return Wa.EMPTY;let n=this;return n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.removeMin(),null),n.fixUp()}remove(n,i){let l,u=this;if(i(n,u.key)<0)u.left.isEmpty()||u.left.isRed()||u.left.left.isRed()||(u=u.moveRedLeft()),u=u.copy(null,null,null,u.left.remove(n,i),null);else{if(u.left.isRed()&&(u=u.rotateRight()),u.right.isEmpty()||u.right.isRed()||u.right.left.isRed()||(u=u.moveRedRight()),i(n,u.key)===0){if(u.right.isEmpty())return Wa.EMPTY;l=u.right.min(),u=u.copy(l.key,l.value,null,null,u.right.removeMin())}u=u.copy(null,null,null,null,u.right.remove(n,i))}return u.fixUp()}isRed(){return this.color}fixUp(){let n=this;return n.right.isRed()&&!n.left.isRed()&&(n=n.rotateLeft()),n.left.isRed()&&n.left.left.isRed()&&(n=n.rotateRight()),n.left.isRed()&&n.right.isRed()&&(n=n.colorFlip()),n}moveRedLeft(){let n=this.colorFlip();return n.right.left.isRed()&&(n=n.copy(null,null,null,null,n.right.rotateRight()),n=n.rotateLeft(),n=n.colorFlip()),n}moveRedRight(){let n=this.colorFlip();return n.left.left.isRed()&&(n=n.rotateRight(),n=n.colorFlip()),n}rotateLeft(){const n=this.copy(null,null,Wa.RED,null,this.right.left);return this.right.copy(null,null,this.color,n,null)}rotateRight(){const n=this.copy(null,null,Wa.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,n)}colorFlip(){const n=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,n,i)}checkMaxDepth(){const n=this.check();return Math.pow(2,n)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Rn();const n=this.left.check();if(n!==this.right.check())throw Rn();return n+(this.isRed()?0:1)}}Wa.EMPTY=null,Wa.RED=!0,Wa.BLACK=!1;Wa.EMPTY=new class{constructor(){this.size=0}get key(){throw Rn()}get value(){throw Rn()}get color(){throw Rn()}get left(){throw Rn()}get right(){throw Rn()}copy(n,i,l,u,p){return this}insert(n,i,l){return new Wa(n,i)}remove(n,i){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xa{constructor(n){this.comparator=n,this.data=new ui(this.comparator)}has(n){return this.data.get(n)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(n){return this.data.indexOf(n)}forEach(n){this.data.inorderTraversal((i,l)=>(n(i),!1))}forEachInRange(n,i){const l=this.data.getIteratorFrom(n[0]);for(;l.hasNext();){const u=l.getNext();if(this.comparator(u.key,n[1])>=0)return;i(u.key)}}forEachWhile(n,i){let l;for(l=i!==void 0?this.data.getIteratorFrom(i):this.data.getIterator();l.hasNext();)if(!n(l.getNext().key))return}firstAfterOrEqual(n){const i=this.data.getIteratorFrom(n);return i.hasNext()?i.getNext().key:null}getIterator(){return new I$(this.data.getIterator())}getIteratorFrom(n){return new I$(this.data.getIteratorFrom(n))}add(n){return this.copy(this.data.remove(n).insert(n,!0))}delete(n){return this.has(n)?this.copy(this.data.remove(n)):this}isEmpty(){return this.data.isEmpty()}unionWith(n){let i=this;return i.size<n.size&&(i=n,n=this),n.forEach(l=>{i=i.add(l)}),i}isEqual(n){if(!(n instanceof Xa)||this.size!==n.size)return!1;const i=this.data.getIterator(),l=n.data.getIterator();for(;i.hasNext();){const u=i.getNext().key,p=l.getNext().key;if(this.comparator(u,p)!==0)return!1}return!0}toArray(){const n=[];return this.forEach(i=>{n.push(i)}),n}toString(){const n=[];return this.forEach(i=>n.push(i)),"SortedSet("+n.toString()+")"}copy(n){const i=new Xa(this.comparator);return i.data=n,i}}class I${constructor(n){this.iter=n}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hc{constructor(n){this.fields=n,n.sort(Ha.comparator)}static empty(){return new Hc([])}unionWith(n){let i=new Xa(Ha.comparator);for(const l of this.fields)i=i.add(l);for(const l of n)i=i.add(l);return new Hc(i.toArray())}covers(n){for(const i of this.fields)if(i.isPrefixOf(n))return!0;return!1}isEqual(n){return cy(this.fields,n.fields,(i,l)=>i.isEqual(l))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ate extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qa{constructor(n){this.binaryString=n}static fromBase64String(n){const i=function(u){try{return atob(u)}catch(p){throw typeof DOMException<"u"&&p instanceof DOMException?new Ate("Invalid base64 string: "+p):p}}(n);return new Qa(i)}static fromUint8Array(n){const i=function(u){let p="";for(let g=0;g<u.length;++g)p+=String.fromCharCode(u[g]);return p}(n);return new Qa(i)}[Symbol.iterator](){let n=0;return{next:()=>n<this.binaryString.length?{value:this.binaryString.charCodeAt(n++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(i){return btoa(i)}(this.binaryString)}toUint8Array(){return function(i){const l=new Uint8Array(i.length);for(let u=0;u<i.length;u++)l[u]=i.charCodeAt(u);return l}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(n){return $r(this.binaryString,n.binaryString)}isEqual(n){return this.binaryString===n.binaryString}}Qa.EMPTY_BYTE_STRING=new Qa("");const ube=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function um(s){if(Fr(!!s),typeof s=="string"){let n=0;const i=ube.exec(s);if(Fr(!!i),i[1]){let u=i[1];u=(u+"000000000").substr(0,9),n=Number(u)}const l=new Date(s);return{seconds:Math.floor(l.getTime()/1e3),nanos:n}}return{seconds:Ai(s.seconds),nanos:Ai(s.nanos)}}function Ai(s){return typeof s=="number"?s:typeof s=="string"?Number(s):0}function I_(s){return typeof s=="string"?Qa.fromBase64String(s):Qa.fromUint8Array(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B3(s){var n,i;return((i=(((n=s==null?void 0:s.mapValue)===null||n===void 0?void 0:n.fields)||{}).__type__)===null||i===void 0?void 0:i.stringValue)==="server_timestamp"}function z3(s){const n=s.mapValue.fields.__previous_value__;return B3(n)?z3(n):n}function zS(s){const n=um(s.mapValue.fields.__local_write_time__.timestampValue);return new cn(n.seconds,n.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hbe{constructor(n,i,l,u,p,g,y,x,C){this.databaseId=n,this.appId=i,this.persistenceKey=l,this.host=u,this.ssl=p,this.forceLongPolling=g,this.autoDetectLongPolling=y,this.longPollingOptions=x,this.useFetchStreams=C}}class GS{constructor(n,i){this.projectId=n,this.database=i||"(default)"}static empty(){return new GS("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(n){return n instanceof GS&&n.projectId===this.projectId&&n.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zA={mapValue:{}};function A_(s){return"nullValue"in s?0:"booleanValue"in s?1:"integerValue"in s||"doubleValue"in s?2:"timestampValue"in s?3:"stringValue"in s?5:"bytesValue"in s?6:"referenceValue"in s?7:"geoPointValue"in s?8:"arrayValue"in s?9:"mapValue"in s?B3(s)?4:fbe(s)?9007199254740991:pbe(s)?10:11:Rn()}function Qu(s,n){if(s===n)return!0;const i=A_(s);if(i!==A_(n))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return s.booleanValue===n.booleanValue;case 4:return zS(s).isEqual(zS(n));case 3:return function(u,p){if(typeof u.timestampValue=="string"&&typeof p.timestampValue=="string"&&u.timestampValue.length===p.timestampValue.length)return u.timestampValue===p.timestampValue;const g=um(u.timestampValue),y=um(p.timestampValue);return g.seconds===y.seconds&&g.nanos===y.nanos}(s,n);case 5:return s.stringValue===n.stringValue;case 6:return function(u,p){return I_(u.bytesValue).isEqual(I_(p.bytesValue))}(s,n);case 7:return s.referenceValue===n.referenceValue;case 8:return function(u,p){return Ai(u.geoPointValue.latitude)===Ai(p.geoPointValue.latitude)&&Ai(u.geoPointValue.longitude)===Ai(p.geoPointValue.longitude)}(s,n);case 2:return function(u,p){if("integerValue"in u&&"integerValue"in p)return Ai(u.integerValue)===Ai(p.integerValue);if("doubleValue"in u&&"doubleValue"in p){const g=Ai(u.doubleValue),y=Ai(p.doubleValue);return g===y?Q1(g)===Q1(y):isNaN(g)&&isNaN(y)}return!1}(s,n);case 9:return cy(s.arrayValue.values||[],n.arrayValue.values||[],Qu);case 10:case 11:return function(u,p){const g=u.mapValue.fields||{},y=p.mapValue.fields||{};if(N$(g)!==N$(y))return!1;for(const x in g)if(g.hasOwnProperty(x)&&(y[x]===void 0||!Qu(g[x],y[x])))return!1;return!0}(s,n);default:return Rn()}}function WS(s,n){return(s.values||[]).find(i=>Qu(i,n))!==void 0}function ly(s,n){if(s===n)return 0;const i=A_(s),l=A_(n);if(i!==l)return $r(i,l);switch(i){case 0:case 9007199254740991:return 0;case 1:return $r(s.booleanValue,n.booleanValue);case 2:return function(p,g){const y=Ai(p.integerValue||p.doubleValue),x=Ai(g.integerValue||g.doubleValue);return y<x?-1:y>x?1:y===x?0:isNaN(y)?isNaN(x)?0:-1:1}(s,n);case 3:return A$(s.timestampValue,n.timestampValue);case 4:return A$(zS(s),zS(n));case 5:return $r(s.stringValue,n.stringValue);case 6:return function(p,g){const y=I_(p),x=I_(g);return y.compareTo(x)}(s.bytesValue,n.bytesValue);case 7:return function(p,g){const y=p.split("/"),x=g.split("/");for(let C=0;C<y.length&&C<x.length;C++){const k=$r(y[C],x[C]);if(k!==0)return k}return $r(y.length,x.length)}(s.referenceValue,n.referenceValue);case 8:return function(p,g){const y=$r(Ai(p.latitude),Ai(g.latitude));return y!==0?y:$r(Ai(p.longitude),Ai(g.longitude))}(s.geoPointValue,n.geoPointValue);case 9:return k$(s.arrayValue,n.arrayValue);case 10:return function(p,g){var y,x,C,k;const A=p.fields||{},M=g.fields||{},G=(y=A.value)===null||y===void 0?void 0:y.arrayValue,B=(x=M.value)===null||x===void 0?void 0:x.arrayValue,X=$r(((C=G==null?void 0:G.values)===null||C===void 0?void 0:C.length)||0,((k=B==null?void 0:B.values)===null||k===void 0?void 0:k.length)||0);return X!==0?X:k$(G,B)}(s.mapValue,n.mapValue);case 11:return function(p,g){if(p===zA.mapValue&&g===zA.mapValue)return 0;if(p===zA.mapValue)return 1;if(g===zA.mapValue)return-1;const y=p.fields||{},x=Object.keys(y),C=g.fields||{},k=Object.keys(C);x.sort(),k.sort();for(let A=0;A<x.length&&A<k.length;++A){const M=$r(x[A],k[A]);if(M!==0)return M;const G=ly(y[x[A]],C[k[A]]);if(G!==0)return G}return $r(x.length,k.length)}(s.mapValue,n.mapValue);default:throw Rn()}}function A$(s,n){if(typeof s=="string"&&typeof n=="string"&&s.length===n.length)return $r(s,n);const i=um(s),l=um(n),u=$r(i.seconds,l.seconds);return u!==0?u:$r(i.nanos,l.nanos)}function k$(s,n){const i=s.values||[],l=n.values||[];for(let u=0;u<i.length&&u<l.length;++u){const p=ly(i[u],l[u]);if(p)return p}return $r(i.length,l.length)}function dy(s){return K5(s)}function K5(s){return"nullValue"in s?"null":"booleanValue"in s?""+s.booleanValue:"integerValue"in s?""+s.integerValue:"doubleValue"in s?""+s.doubleValue:"timestampValue"in s?function(i){const l=um(i);return`time(${l.seconds},${l.nanos})`}(s.timestampValue):"stringValue"in s?s.stringValue:"bytesValue"in s?function(i){return I_(i).toBase64()}(s.bytesValue):"referenceValue"in s?function(i){return on.fromName(i).toString()}(s.referenceValue):"geoPointValue"in s?function(i){return`geo(${i.latitude},${i.longitude})`}(s.geoPointValue):"arrayValue"in s?function(i){let l="[",u=!0;for(const p of i.values||[])u?u=!1:l+=",",l+=K5(p);return l+"]"}(s.arrayValue):"mapValue"in s?function(i){const l=Object.keys(i.fields||{}).sort();let u="{",p=!0;for(const g of l)p?p=!1:u+=",",u+=`${g}:${K5(i.fields[g])}`;return u+"}"}(s.mapValue):Rn()}function O$(s,n){return{referenceValue:`projects/${s.projectId}/databases/${s.database}/documents/${n.path.canonicalString()}`}}function q5(s){return!!s&&"integerValue"in s}function G3(s){return!!s&&"arrayValue"in s}function D$(s){return!!s&&"nullValue"in s}function P$(s){return!!s&&"doubleValue"in s&&isNaN(Number(s.doubleValue))}function p1(s){return!!s&&"mapValue"in s}function pbe(s){var n,i;return((i=(((n=s==null?void 0:s.mapValue)===null||n===void 0?void 0:n.fields)||{}).__type__)===null||i===void 0?void 0:i.stringValue)==="__vector__"}function cS(s){if(s.geoPointValue)return{geoPointValue:Object.assign({},s.geoPointValue)};if(s.timestampValue&&typeof s.timestampValue=="object")return{timestampValue:Object.assign({},s.timestampValue)};if(s.mapValue){const n={mapValue:{fields:{}}};return M_(s.mapValue.fields,(i,l)=>n.mapValue.fields[i]=cS(l)),n}if(s.arrayValue){const n={arrayValue:{values:[]}};for(let i=0;i<(s.arrayValue.values||[]).length;++i)n.arrayValue.values[i]=cS(s.arrayValue.values[i]);return n}return Object.assign({},s)}function fbe(s){return(((s.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mo{constructor(n){this.value=n}static empty(){return new Mo({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let i=this.value;for(let l=0;l<n.length-1;++l)if(i=(i.mapValue.fields||{})[n.get(l)],!p1(i))return null;return i=(i.mapValue.fields||{})[n.lastSegment()],i||null}}set(n,i){this.getFieldsMap(n.popLast())[n.lastSegment()]=cS(i)}setAll(n){let i=Ha.emptyPath(),l={},u=[];n.forEach((g,y)=>{if(!i.isImmediateParentOf(y)){const x=this.getFieldsMap(i);this.applyChanges(x,l,u),l={},u=[],i=y.popLast()}g?l[y.lastSegment()]=cS(g):u.push(y.lastSegment())});const p=this.getFieldsMap(i);this.applyChanges(p,l,u)}delete(n){const i=this.field(n.popLast());p1(i)&&i.mapValue.fields&&delete i.mapValue.fields[n.lastSegment()]}isEqual(n){return Qu(this.value,n.value)}getFieldsMap(n){let i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(let l=0;l<n.length;++l){let u=i.mapValue.fields[n.get(l)];p1(u)&&u.mapValue.fields||(u={mapValue:{fields:{}}},i.mapValue.fields[n.get(l)]=u),i=u}return i.mapValue.fields}applyChanges(n,i,l){M_(i,(u,p)=>n[u]=p);for(const u of l)delete n[u]}clone(){return new Mo(cS(this.value))}}function kte(s){const n=[];return M_(s.fields,(i,l)=>{const u=new Ha([i]);if(p1(l)){const p=kte(l.mapValue).fields;if(p.length===0)n.push(u);else for(const g of p)n.push(u.child(g))}else n.push(u)}),new Hc(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xa{constructor(n,i,l,u,p,g,y){this.key=n,this.documentType=i,this.version=l,this.readTime=u,this.createTime=p,this.data=g,this.documentState=y}static newInvalidDocument(n){return new xa(n,0,In.min(),In.min(),In.min(),Mo.empty(),0)}static newFoundDocument(n,i,l,u){return new xa(n,1,i,In.min(),l,u,0)}static newNoDocument(n,i){return new xa(n,2,i,In.min(),In.min(),Mo.empty(),0)}static newUnknownDocument(n,i){return new xa(n,3,i,In.min(),In.min(),Mo.empty(),2)}convertToFoundDocument(n,i){return!this.createTime.isEqual(In.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=n),this.version=n,this.documentType=1,this.data=i,this.documentState=0,this}convertToNoDocument(n){return this.version=n,this.documentType=2,this.data=Mo.empty(),this.documentState=0,this}convertToUnknownDocument(n){return this.version=n,this.documentType=3,this.data=Mo.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=In.min(),this}setReadTime(n){return this.readTime=n,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(n){return n instanceof xa&&this.key.isEqual(n.key)&&this.version.isEqual(n.version)&&this.documentType===n.documentType&&this.documentState===n.documentState&&this.data.isEqual(n.data)}mutableCopy(){return new xa(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z1{constructor(n,i){this.position=n,this.inclusive=i}}function L$(s,n,i){let l=0;for(let u=0;u<s.position.length;u++){const p=n[u],g=s.position[u];if(p.field.isKeyField()?l=on.comparator(on.fromName(g.referenceValue),i.key):l=ly(g,i.data.field(p.field)),p.dir==="desc"&&(l*=-1),l!==0)break}return l}function j$(s,n){if(s===null)return n===null;if(n===null||s.inclusive!==n.inclusive||s.position.length!==n.position.length)return!1;for(let i=0;i<s.position.length;i++)if(!Qu(s.position[i],n.position[i]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HS{constructor(n,i="asc"){this.field=n,this.dir=i}}function mbe(s,n){return s.dir===n.dir&&s.field.isEqual(n.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ote{}class zi extends Ote{constructor(n,i,l){super(),this.field=n,this.op=i,this.value=l}static create(n,i,l){return n.isKeyField()?i==="in"||i==="not-in"?this.createKeyFieldInFilter(n,i,l):new _be(n,i,l):i==="array-contains"?new ybe(n,l):i==="in"?new bbe(n,l):i==="not-in"?new xbe(n,l):i==="array-contains-any"?new wbe(n,l):new zi(n,i,l)}static createKeyFieldInFilter(n,i,l){return i==="in"?new vbe(n,l):new Ebe(n,l)}matches(n){const i=n.data.field(this.field);return this.op==="!="?i!==null&&this.matchesComparison(ly(i,this.value)):i!==null&&A_(this.value)===A_(i)&&this.matchesComparison(ly(i,this.value))}matchesComparison(n){switch(this.op){case"<":return n<0;case"<=":return n<=0;case"==":return n===0;case"!=":return n!==0;case">":return n>0;case">=":return n>=0;default:return Rn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Kd extends Ote{constructor(n,i){super(),this.filters=n,this.op=i,this.ae=null}static create(n,i){return new Kd(n,i)}matches(n){return Dte(this)?this.filters.find(i=>!i.matches(n))===void 0:this.filters.find(i=>i.matches(n))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((n,i)=>n.concat(i.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Dte(s){return s.op==="and"}function Pte(s){return gbe(s)&&Dte(s)}function gbe(s){for(const n of s.filters)if(n instanceof Kd)return!1;return!0}function Y5(s){if(s instanceof zi)return s.field.canonicalString()+s.op.toString()+dy(s.value);if(Pte(s))return s.filters.map(n=>Y5(n)).join(",");{const n=s.filters.map(i=>Y5(i)).join(",");return`${s.op}(${n})`}}function Lte(s,n){return s instanceof zi?function(l,u){return u instanceof zi&&l.op===u.op&&l.field.isEqual(u.field)&&Qu(l.value,u.value)}(s,n):s instanceof Kd?function(l,u){return u instanceof Kd&&l.op===u.op&&l.filters.length===u.filters.length?l.filters.reduce((p,g,y)=>p&&Lte(g,u.filters[y]),!0):!1}(s,n):void Rn()}function jte(s){return s instanceof zi?function(i){return`${i.field.canonicalString()} ${i.op} ${dy(i.value)}`}(s):s instanceof Kd?function(i){return i.op.toString()+" {"+i.getFilters().map(jte).join(" ,")+"}"}(s):"Filter"}class _be extends zi{constructor(n,i,l){super(n,i,l),this.key=on.fromName(l.referenceValue)}matches(n){const i=on.comparator(n.key,this.key);return this.matchesComparison(i)}}class vbe extends zi{constructor(n,i){super(n,"in",i),this.keys=Mte("in",i)}matches(n){return this.keys.some(i=>i.isEqual(n.key))}}class Ebe extends zi{constructor(n,i){super(n,"not-in",i),this.keys=Mte("not-in",i)}matches(n){return!this.keys.some(i=>i.isEqual(n.key))}}function Mte(s,n){var i;return(((i=n.arrayValue)===null||i===void 0?void 0:i.values)||[]).map(l=>on.fromName(l.referenceValue))}class ybe extends zi{constructor(n,i){super(n,"array-contains",i)}matches(n){const i=n.data.field(this.field);return G3(i)&&WS(i.arrayValue,this.value)}}class bbe extends zi{constructor(n,i){super(n,"in",i)}matches(n){const i=n.data.field(this.field);return i!==null&&WS(this.value.arrayValue,i)}}class xbe extends zi{constructor(n,i){super(n,"not-in",i)}matches(n){if(WS(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const i=n.data.field(this.field);return i!==null&&!WS(this.value.arrayValue,i)}}class wbe extends zi{constructor(n,i){super(n,"array-contains-any",i)}matches(n){const i=n.data.field(this.field);return!(!G3(i)||!i.arrayValue.values)&&i.arrayValue.values.some(l=>WS(this.value.arrayValue,l))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sbe{constructor(n,i=null,l=[],u=[],p=null,g=null,y=null){this.path=n,this.collectionGroup=i,this.orderBy=l,this.filters=u,this.limit=p,this.startAt=g,this.endAt=y,this.ue=null}}function M$(s,n=null,i=[],l=[],u=null,p=null,g=null){return new Sbe(s,n,i,l,u,p,g)}function W3(s){const n=Ln(s);if(n.ue===null){let i=n.path.canonicalString();n.collectionGroup!==null&&(i+="|cg:"+n.collectionGroup),i+="|f:",i+=n.filters.map(l=>Y5(l)).join(","),i+="|ob:",i+=n.orderBy.map(l=>function(p){return p.field.canonicalString()+p.dir}(l)).join(","),gT(n.limit)||(i+="|l:",i+=n.limit),n.startAt&&(i+="|lb:",i+=n.startAt.inclusive?"b:":"a:",i+=n.startAt.position.map(l=>dy(l)).join(",")),n.endAt&&(i+="|ub:",i+=n.endAt.inclusive?"a:":"b:",i+=n.endAt.position.map(l=>dy(l)).join(",")),n.ue=i}return n.ue}function H3(s,n){if(s.limit!==n.limit||s.orderBy.length!==n.orderBy.length)return!1;for(let i=0;i<s.orderBy.length;i++)if(!mbe(s.orderBy[i],n.orderBy[i]))return!1;if(s.filters.length!==n.filters.length)return!1;for(let i=0;i<s.filters.length;i++)if(!Lte(s.filters[i],n.filters[i]))return!1;return s.collectionGroup===n.collectionGroup&&!!s.path.isEqual(n.path)&&!!j$(s.startAt,n.startAt)&&j$(s.endAt,n.endAt)}function X5(s){return on.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oy{constructor(n,i=null,l=[],u=[],p=null,g="F",y=null,x=null){this.path=n,this.collectionGroup=i,this.explicitOrderBy=l,this.filters=u,this.limit=p,this.limitType=g,this.startAt=y,this.endAt=x,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function Tbe(s,n,i,l,u,p,g,y){return new Oy(s,n,i,l,u,p,g,y)}function Gk(s){return new Oy(s)}function U$(s){return s.filters.length===0&&s.limit===null&&s.startAt==null&&s.endAt==null&&(s.explicitOrderBy.length===0||s.explicitOrderBy.length===1&&s.explicitOrderBy[0].field.isKeyField())}function Ute(s){return s.collectionGroup!==null}function lS(s){const n=Ln(s);if(n.ce===null){n.ce=[];const i=new Set;for(const p of n.explicitOrderBy)n.ce.push(p),i.add(p.field.canonicalString());const l=n.explicitOrderBy.length>0?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";(function(g){let y=new Xa(Ha.comparator);return g.filters.forEach(x=>{x.getFlattenedFilters().forEach(C=>{C.isInequality()&&(y=y.add(C.field))})}),y})(n).forEach(p=>{i.has(p.canonicalString())||p.isKeyField()||n.ce.push(new HS(p,l))}),i.has(Ha.keyField().canonicalString())||n.ce.push(new HS(Ha.keyField(),l))}return n.ce}function $u(s){const n=Ln(s);return n.le||(n.le=Rbe(n,lS(s))),n.le}function Rbe(s,n){if(s.limitType==="F")return M$(s.path,s.collectionGroup,n,s.filters,s.limit,s.startAt,s.endAt);{n=n.map(u=>{const p=u.dir==="desc"?"asc":"desc";return new HS(u.field,p)});const i=s.endAt?new Z1(s.endAt.position,s.endAt.inclusive):null,l=s.startAt?new Z1(s.startAt.position,s.startAt.inclusive):null;return M$(s.path,s.collectionGroup,n,s.filters,s.limit,i,l)}}function $5(s,n){const i=s.filters.concat([n]);return new Oy(s.path,s.collectionGroup,s.explicitOrderBy.slice(),i,s.limit,s.limitType,s.startAt,s.endAt)}function ek(s,n,i){return new Oy(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),n,i,s.startAt,s.endAt)}function Wk(s,n){return H3($u(s),$u(n))&&s.limitType===n.limitType}function Vte(s){return`${W3($u(s))}|lt:${s.limitType}`}function xE(s){return`Query(target=${function(i){let l=i.path.canonicalString();return i.collectionGroup!==null&&(l+=" collectionGroup="+i.collectionGroup),i.filters.length>0&&(l+=`, filters: [${i.filters.map(u=>jte(u)).join(", ")}]`),gT(i.limit)||(l+=", limit: "+i.limit),i.orderBy.length>0&&(l+=`, orderBy: [${i.orderBy.map(u=>function(g){return`${g.field.canonicalString()} (${g.dir})`}(u)).join(", ")}]`),i.startAt&&(l+=", startAt: ",l+=i.startAt.inclusive?"b:":"a:",l+=i.startAt.position.map(u=>dy(u)).join(",")),i.endAt&&(l+=", endAt: ",l+=i.endAt.inclusive?"a:":"b:",l+=i.endAt.position.map(u=>dy(u)).join(",")),`Target(${l})`}($u(s))}; limitType=${s.limitType})`}function Hk(s,n){return n.isFoundDocument()&&function(l,u){const p=u.key.path;return l.collectionGroup!==null?u.key.hasCollectionId(l.collectionGroup)&&l.path.isPrefixOf(p):on.isDocumentKey(l.path)?l.path.isEqual(p):l.path.isImmediateParentOf(p)}(s,n)&&function(l,u){for(const p of lS(l))if(!p.field.isKeyField()&&u.data.field(p.field)===null)return!1;return!0}(s,n)&&function(l,u){for(const p of l.filters)if(!p.matches(u))return!1;return!0}(s,n)&&function(l,u){return!(l.startAt&&!function(g,y,x){const C=L$(g,y,x);return g.inclusive?C<=0:C<0}(l.startAt,lS(l),u)||l.endAt&&!function(g,y,x){const C=L$(g,y,x);return g.inclusive?C>=0:C>0}(l.endAt,lS(l),u))}(s,n)}function Cbe(s){return s.collectionGroup||(s.path.length%2==1?s.path.lastSegment():s.path.get(s.path.length-2))}function Fte(s){return(n,i)=>{let l=!1;for(const u of lS(s)){const p=Nbe(u,n,i);if(p!==0)return p;l=l||u.field.isKeyField()}return 0}}function Nbe(s,n,i){const l=s.field.isKeyField()?on.comparator(n.key,i.key):function(p,g,y){const x=g.data.field(p),C=y.data.field(p);return x!==null&&C!==null?ly(x,C):Rn()}(s.field,n,i);switch(s.dir){case"asc":return l;case"desc":return-1*l;default:return Rn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dy{constructor(n,i){this.mapKeyFn=n,this.equalsFn=i,this.inner={},this.innerSize=0}get(n){const i=this.mapKeyFn(n),l=this.inner[i];if(l!==void 0){for(const[u,p]of l)if(this.equalsFn(u,n))return p}}has(n){return this.get(n)!==void 0}set(n,i){const l=this.mapKeyFn(n),u=this.inner[l];if(u===void 0)return this.inner[l]=[[n,i]],void this.innerSize++;for(let p=0;p<u.length;p++)if(this.equalsFn(u[p][0],n))return void(u[p]=[n,i]);u.push([n,i]),this.innerSize++}delete(n){const i=this.mapKeyFn(n),l=this.inner[i];if(l===void 0)return!1;for(let u=0;u<l.length;u++)if(this.equalsFn(l[u][0],n))return l.length===1?delete this.inner[i]:l.splice(u,1),this.innerSize--,!0;return!1}forEach(n){M_(this.inner,(i,l)=>{for(const[u,p]of l)n(u,p)})}isEmpty(){return Ite(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ibe=new ui(on.comparator);function dp(){return Ibe}const Bte=new ui(on.comparator);function Yw(...s){let n=Bte;for(const i of s)n=n.insert(i.key,i);return n}function zte(s){let n=Bte;return s.forEach((i,l)=>n=n.insert(i,l.overlayedDocument)),n}function p_(){return dS()}function Gte(){return dS()}function dS(){return new Dy(s=>s.toString(),(s,n)=>s.isEqual(n))}const Abe=new ui(on.comparator),kbe=new Xa(on.comparator);function xr(...s){let n=kbe;for(const i of s)n=n.add(i);return n}const Obe=new Xa($r);function Dbe(){return Obe}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K3(s,n){if(s.useProto3Json){if(isNaN(n))return{doubleValue:"NaN"};if(n===1/0)return{doubleValue:"Infinity"};if(n===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Q1(n)?"-0":n}}function Wte(s){return{integerValue:""+s}}function Hte(s,n){return dbe(n)?Wte(n):K3(s,n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kk{constructor(){this._=void 0}}function Pbe(s,n,i){return s instanceof KS?function(u,p){const g={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:u.seconds,nanos:u.nanoseconds}}}};return p&&B3(p)&&(p=z3(p)),p&&(g.fields.__previous_value__=p),{mapValue:g}}(i,n):s instanceof uy?qte(s,n):s instanceof qS?Yte(s,n):function(u,p){const g=Kte(u,p),y=V$(g)+V$(u.Pe);return q5(g)&&q5(u.Pe)?Wte(y):K3(u.serializer,y)}(s,n)}function Lbe(s,n,i){return s instanceof uy?qte(s,n):s instanceof qS?Yte(s,n):i}function Kte(s,n){return s instanceof YS?function(l){return q5(l)||function(p){return!!p&&"doubleValue"in p}(l)}(n)?n:{integerValue:0}:null}class KS extends Kk{}class uy extends Kk{constructor(n){super(),this.elements=n}}function qte(s,n){const i=Xte(n);for(const l of s.elements)i.some(u=>Qu(u,l))||i.push(l);return{arrayValue:{values:i}}}class qS extends Kk{constructor(n){super(),this.elements=n}}function Yte(s,n){let i=Xte(n);for(const l of s.elements)i=i.filter(u=>!Qu(u,l));return{arrayValue:{values:i}}}class YS extends Kk{constructor(n,i){super(),this.serializer=n,this.Pe=i}}function V$(s){return Ai(s.integerValue||s.doubleValue)}function Xte(s){return G3(s)&&s.arrayValue.values?s.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q3{constructor(n,i){this.field=n,this.transform=i}}function jbe(s,n){return s.field.isEqual(n.field)&&function(l,u){return l instanceof uy&&u instanceof uy||l instanceof qS&&u instanceof qS?cy(l.elements,u.elements,Qu):l instanceof YS&&u instanceof YS?Qu(l.Pe,u.Pe):l instanceof KS&&u instanceof KS}(s.transform,n.transform)}class Mbe{constructor(n,i){this.version=n,this.transformResults=i}}class Ka{constructor(n,i){this.updateTime=n,this.exists=i}static none(){return new Ka}static exists(n){return new Ka(void 0,n)}static updateTime(n){return new Ka(n)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(n){return this.exists===n.exists&&(this.updateTime?!!n.updateTime&&this.updateTime.isEqual(n.updateTime):!n.updateTime)}}function f1(s,n){return s.updateTime!==void 0?n.isFoundDocument()&&n.version.isEqual(s.updateTime):s.exists===void 0||s.exists===n.isFoundDocument()}class qk{}function $te(s,n){if(!s.hasLocalMutations||n&&n.fields.length===0)return null;if(n===null)return s.isNoDocument()?new Yk(s.key,Ka.none()):new _T(s.key,s.data,Ka.none());{const i=s.data,l=Mo.empty();let u=new Xa(Ha.comparator);for(let p of n.fields)if(!u.has(p)){let g=i.field(p);g===null&&p.length>1&&(p=p.popLast(),g=i.field(p)),g===null?l.delete(p):l.set(p,g),u=u.add(p)}return new gm(s.key,l,new Hc(u.toArray()),Ka.none())}}function Ube(s,n,i){s instanceof _T?function(u,p,g){const y=u.value.clone(),x=B$(u.fieldTransforms,p,g.transformResults);y.setAll(x),p.convertToFoundDocument(g.version,y).setHasCommittedMutations()}(s,n,i):s instanceof gm?function(u,p,g){if(!f1(u.precondition,p))return void p.convertToUnknownDocument(g.version);const y=B$(u.fieldTransforms,p,g.transformResults),x=p.data;x.setAll(Jte(u)),x.setAll(y),p.convertToFoundDocument(g.version,x).setHasCommittedMutations()}(s,n,i):function(u,p,g){p.convertToNoDocument(g.version).setHasCommittedMutations()}(0,n,i)}function uS(s,n,i,l){return s instanceof _T?function(p,g,y,x){if(!f1(p.precondition,g))return y;const C=p.value.clone(),k=z$(p.fieldTransforms,x,g);return C.setAll(k),g.convertToFoundDocument(g.version,C).setHasLocalMutations(),null}(s,n,i,l):s instanceof gm?function(p,g,y,x){if(!f1(p.precondition,g))return y;const C=z$(p.fieldTransforms,x,g),k=g.data;return k.setAll(Jte(p)),k.setAll(C),g.convertToFoundDocument(g.version,k).setHasLocalMutations(),y===null?null:y.unionWith(p.fieldMask.fields).unionWith(p.fieldTransforms.map(A=>A.field))}(s,n,i,l):function(p,g,y){return f1(p.precondition,g)?(g.convertToNoDocument(g.version).setHasLocalMutations(),null):y}(s,n,i)}function Vbe(s,n){let i=null;for(const l of s.fieldTransforms){const u=n.data.field(l.field),p=Kte(l.transform,u||null);p!=null&&(i===null&&(i=Mo.empty()),i.set(l.field,p))}return i||null}function F$(s,n){return s.type===n.type&&!!s.key.isEqual(n.key)&&!!s.precondition.isEqual(n.precondition)&&!!function(l,u){return l===void 0&&u===void 0||!(!l||!u)&&cy(l,u,(p,g)=>jbe(p,g))}(s.fieldTransforms,n.fieldTransforms)&&(s.type===0?s.value.isEqual(n.value):s.type!==1||s.data.isEqual(n.data)&&s.fieldMask.isEqual(n.fieldMask))}class _T extends qk{constructor(n,i,l,u=[]){super(),this.key=n,this.value=i,this.precondition=l,this.fieldTransforms=u,this.type=0}getFieldMask(){return null}}class gm extends qk{constructor(n,i,l,u,p=[]){super(),this.key=n,this.data=i,this.fieldMask=l,this.precondition=u,this.fieldTransforms=p,this.type=1}getFieldMask(){return this.fieldMask}}function Jte(s){const n=new Map;return s.fieldMask.fields.forEach(i=>{if(!i.isEmpty()){const l=s.data.field(i);n.set(i,l)}}),n}function B$(s,n,i){const l=new Map;Fr(s.length===i.length);for(let u=0;u<i.length;u++){const p=s[u],g=p.transform,y=n.data.field(p.field);l.set(p.field,Lbe(g,y,i[u]))}return l}function z$(s,n,i){const l=new Map;for(const u of s){const p=u.transform,g=i.data.field(u.field);l.set(u.field,Pbe(p,g,n))}return l}class Yk extends qk{constructor(n,i){super(),this.key=n,this.precondition=i,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Qte extends qk{constructor(n,i){super(),this.key=n,this.precondition=i,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fbe{constructor(n,i,l,u){this.batchId=n,this.localWriteTime=i,this.baseMutations=l,this.mutations=u}applyToRemoteDocument(n,i){const l=i.mutationResults;for(let u=0;u<this.mutations.length;u++){const p=this.mutations[u];p.key.isEqual(n.key)&&Ube(p,n,l[u])}}applyToLocalView(n,i){for(const l of this.baseMutations)l.key.isEqual(n.key)&&(i=uS(l,n,i,this.localWriteTime));for(const l of this.mutations)l.key.isEqual(n.key)&&(i=uS(l,n,i,this.localWriteTime));return i}applyToLocalDocumentSet(n,i){const l=Gte();return this.mutations.forEach(u=>{const p=n.get(u.key),g=p.overlayedDocument;let y=this.applyToLocalView(g,p.mutatedFields);y=i.has(u.key)?null:y;const x=$te(g,y);x!==null&&l.set(u.key,x),g.isValidDocument()||g.convertToNoDocument(In.min())}),l}keys(){return this.mutations.reduce((n,i)=>n.add(i.key),xr())}isEqual(n){return this.batchId===n.batchId&&cy(this.mutations,n.mutations,(i,l)=>F$(i,l))&&cy(this.baseMutations,n.baseMutations,(i,l)=>F$(i,l))}}class Y3{constructor(n,i,l,u){this.batch=n,this.commitVersion=i,this.mutationResults=l,this.docVersions=u}static from(n,i,l){Fr(n.mutations.length===l.length);let u=function(){return Abe}();const p=n.mutations;for(let g=0;g<p.length;g++)u=u.insert(p[g].key,l[g].version);return new Y3(n,i,l,u)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bbe{constructor(n,i){this.largestBatchId=n,this.mutation=i}getKey(){return this.mutation.key}isEqual(n){return n!==null&&this.mutation===n.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zbe{constructor(n,i){this.count=n,this.unchangedNames=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Vi,kr;function Zte(s){switch(s){default:return Rn();case st.CANCELLED:case st.UNKNOWN:case st.DEADLINE_EXCEEDED:case st.RESOURCE_EXHAUSTED:case st.INTERNAL:case st.UNAVAILABLE:case st.UNAUTHENTICATED:return!1;case st.INVALID_ARGUMENT:case st.NOT_FOUND:case st.ALREADY_EXISTS:case st.PERMISSION_DENIED:case st.FAILED_PRECONDITION:case st.ABORTED:case st.OUT_OF_RANGE:case st.UNIMPLEMENTED:case st.DATA_LOSS:return!0}}function ene(s){if(s===void 0)return lp("GRPC error has no .code"),st.UNKNOWN;switch(s){case Vi.OK:return st.OK;case Vi.CANCELLED:return st.CANCELLED;case Vi.UNKNOWN:return st.UNKNOWN;case Vi.DEADLINE_EXCEEDED:return st.DEADLINE_EXCEEDED;case Vi.RESOURCE_EXHAUSTED:return st.RESOURCE_EXHAUSTED;case Vi.INTERNAL:return st.INTERNAL;case Vi.UNAVAILABLE:return st.UNAVAILABLE;case Vi.UNAUTHENTICATED:return st.UNAUTHENTICATED;case Vi.INVALID_ARGUMENT:return st.INVALID_ARGUMENT;case Vi.NOT_FOUND:return st.NOT_FOUND;case Vi.ALREADY_EXISTS:return st.ALREADY_EXISTS;case Vi.PERMISSION_DENIED:return st.PERMISSION_DENIED;case Vi.FAILED_PRECONDITION:return st.FAILED_PRECONDITION;case Vi.ABORTED:return st.ABORTED;case Vi.OUT_OF_RANGE:return st.OUT_OF_RANGE;case Vi.UNIMPLEMENTED:return st.UNIMPLEMENTED;case Vi.DATA_LOSS:return st.DATA_LOSS;default:return Rn()}}(kr=Vi||(Vi={}))[kr.OK=0]="OK",kr[kr.CANCELLED=1]="CANCELLED",kr[kr.UNKNOWN=2]="UNKNOWN",kr[kr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",kr[kr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",kr[kr.NOT_FOUND=5]="NOT_FOUND",kr[kr.ALREADY_EXISTS=6]="ALREADY_EXISTS",kr[kr.PERMISSION_DENIED=7]="PERMISSION_DENIED",kr[kr.UNAUTHENTICATED=16]="UNAUTHENTICATED",kr[kr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",kr[kr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",kr[kr.ABORTED=10]="ABORTED",kr[kr.OUT_OF_RANGE=11]="OUT_OF_RANGE",kr[kr.UNIMPLEMENTED=12]="UNIMPLEMENTED",kr[kr.INTERNAL=13]="INTERNAL",kr[kr.UNAVAILABLE=14]="UNAVAILABLE",kr[kr.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gbe(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wbe=new __([4294967295,4294967295],0);function G$(s){const n=Gbe().encode(s),i=new bte;return i.update(n),new Uint8Array(i.digest())}function W$(s){const n=new DataView(s.buffer),i=n.getUint32(0,!0),l=n.getUint32(4,!0),u=n.getUint32(8,!0),p=n.getUint32(12,!0);return[new __([i,l],0),new __([u,p],0)]}class X3{constructor(n,i,l){if(this.bitmap=n,this.padding=i,this.hashCount=l,i<0||i>=8)throw new Xw(`Invalid padding: ${i}`);if(l<0)throw new Xw(`Invalid hash count: ${l}`);if(n.length>0&&this.hashCount===0)throw new Xw(`Invalid hash count: ${l}`);if(n.length===0&&i!==0)throw new Xw(`Invalid padding when bitmap length is 0: ${i}`);this.Ie=8*n.length-i,this.Te=__.fromNumber(this.Ie)}Ee(n,i,l){let u=n.add(i.multiply(__.fromNumber(l)));return u.compare(Wbe)===1&&(u=new __([u.getBits(0),u.getBits(1)],0)),u.modulo(this.Te).toNumber()}de(n){return(this.bitmap[Math.floor(n/8)]&1<<n%8)!=0}mightContain(n){if(this.Ie===0)return!1;const i=G$(n),[l,u]=W$(i);for(let p=0;p<this.hashCount;p++){const g=this.Ee(l,u,p);if(!this.de(g))return!1}return!0}static create(n,i,l){const u=n%8==0?0:8-n%8,p=new Uint8Array(Math.ceil(n/8)),g=new X3(p,u,i);return l.forEach(y=>g.insert(y)),g}insert(n){if(this.Ie===0)return;const i=G$(n),[l,u]=W$(i);for(let p=0;p<this.hashCount;p++){const g=this.Ee(l,u,p);this.Ae(g)}}Ae(n){const i=Math.floor(n/8),l=n%8;this.bitmap[i]|=1<<l}}class Xw extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xk{constructor(n,i,l,u,p){this.snapshotVersion=n,this.targetChanges=i,this.targetMismatches=l,this.documentUpdates=u,this.resolvedLimboDocuments=p}static createSynthesizedRemoteEventForCurrentChange(n,i,l){const u=new Map;return u.set(n,vT.createSynthesizedTargetChangeForCurrentChange(n,i,l)),new Xk(In.min(),u,new ui($r),dp(),xr())}}class vT{constructor(n,i,l,u,p){this.resumeToken=n,this.current=i,this.addedDocuments=l,this.modifiedDocuments=u,this.removedDocuments=p}static createSynthesizedTargetChangeForCurrentChange(n,i,l){return new vT(l,i,xr(),xr(),xr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m1{constructor(n,i,l,u){this.Re=n,this.removedTargetIds=i,this.key=l,this.Ve=u}}class tne{constructor(n,i){this.targetId=n,this.me=i}}class nne{constructor(n,i,l=Qa.EMPTY_BYTE_STRING,u=null){this.state=n,this.targetIds=i,this.resumeToken=l,this.cause=u}}class H${constructor(){this.fe=0,this.ge=q$(),this.pe=Qa.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(n){n.approximateByteSize()>0&&(this.we=!0,this.pe=n)}ve(){let n=xr(),i=xr(),l=xr();return this.ge.forEach((u,p)=>{switch(p){case 0:n=n.add(u);break;case 2:i=i.add(u);break;case 1:l=l.add(u);break;default:Rn()}}),new vT(this.pe,this.ye,n,i,l)}Ce(){this.we=!1,this.ge=q$()}Fe(n,i){this.we=!0,this.ge=this.ge.insert(n,i)}Me(n){this.we=!0,this.ge=this.ge.remove(n)}xe(){this.fe+=1}Oe(){this.fe-=1,Fr(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Hbe{constructor(n){this.Le=n,this.Be=new Map,this.ke=dp(),this.qe=K$(),this.Qe=new ui($r)}Ke(n){for(const i of n.Re)n.Ve&&n.Ve.isFoundDocument()?this.$e(i,n.Ve):this.Ue(i,n.key,n.Ve);for(const i of n.removedTargetIds)this.Ue(i,n.key,n.Ve)}We(n){this.forEachTarget(n,i=>{const l=this.Ge(i);switch(n.state){case 0:this.ze(i)&&l.De(n.resumeToken);break;case 1:l.Oe(),l.Se||l.Ce(),l.De(n.resumeToken);break;case 2:l.Oe(),l.Se||this.removeTarget(i);break;case 3:this.ze(i)&&(l.Ne(),l.De(n.resumeToken));break;case 4:this.ze(i)&&(this.je(i),l.De(n.resumeToken));break;default:Rn()}})}forEachTarget(n,i){n.targetIds.length>0?n.targetIds.forEach(i):this.Be.forEach((l,u)=>{this.ze(u)&&i(u)})}He(n){const i=n.targetId,l=n.me.count,u=this.Je(i);if(u){const p=u.target;if(X5(p))if(l===0){const g=new on(p.path);this.Ue(i,g,xa.newNoDocument(g,In.min()))}else Fr(l===1);else{const g=this.Ye(i);if(g!==l){const y=this.Ze(n),x=y?this.Xe(y,n,g):1;if(x!==0){this.je(i);const C=x===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(i,C)}}}}}Ze(n){const i=n.me.unchangedNames;if(!i||!i.bits)return null;const{bits:{bitmap:l="",padding:u=0},hashCount:p=0}=i;let g,y;try{g=I_(l).toUint8Array()}catch(x){if(x instanceof Ate)return oy("Decoding the base64 bloom filter in existence filter failed ("+x.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw x}try{y=new X3(g,u,p)}catch(x){return oy(x instanceof Xw?"BloomFilter error: ":"Applying bloom filter failed: ",x),null}return y.Ie===0?null:y}Xe(n,i,l){return i.me.count===l-this.nt(n,i.targetId)?0:2}nt(n,i){const l=this.Le.getRemoteKeysForTarget(i);let u=0;return l.forEach(p=>{const g=this.Le.tt(),y=`projects/${g.projectId}/databases/${g.database}/documents/${p.path.canonicalString()}`;n.mightContain(y)||(this.Ue(i,p,null),u++)}),u}rt(n){const i=new Map;this.Be.forEach((p,g)=>{const y=this.Je(g);if(y){if(p.current&&X5(y.target)){const x=new on(y.target.path);this.ke.get(x)!==null||this.it(g,x)||this.Ue(g,x,xa.newNoDocument(x,n))}p.be&&(i.set(g,p.ve()),p.Ce())}});let l=xr();this.qe.forEach((p,g)=>{let y=!0;g.forEachWhile(x=>{const C=this.Je(x);return!C||C.purpose==="TargetPurposeLimboResolution"||(y=!1,!1)}),y&&(l=l.add(p))}),this.ke.forEach((p,g)=>g.setReadTime(n));const u=new Xk(n,i,this.Qe,this.ke,l);return this.ke=dp(),this.qe=K$(),this.Qe=new ui($r),u}$e(n,i){if(!this.ze(n))return;const l=this.it(n,i.key)?2:0;this.Ge(n).Fe(i.key,l),this.ke=this.ke.insert(i.key,i),this.qe=this.qe.insert(i.key,this.st(i.key).add(n))}Ue(n,i,l){if(!this.ze(n))return;const u=this.Ge(n);this.it(n,i)?u.Fe(i,1):u.Me(i),this.qe=this.qe.insert(i,this.st(i).delete(n)),l&&(this.ke=this.ke.insert(i,l))}removeTarget(n){this.Be.delete(n)}Ye(n){const i=this.Ge(n).ve();return this.Le.getRemoteKeysForTarget(n).size+i.addedDocuments.size-i.removedDocuments.size}xe(n){this.Ge(n).xe()}Ge(n){let i=this.Be.get(n);return i||(i=new H$,this.Be.set(n,i)),i}st(n){let i=this.qe.get(n);return i||(i=new Xa($r),this.qe=this.qe.insert(n,i)),i}ze(n){const i=this.Je(n)!==null;return i||$t("WatchChangeAggregator","Detected inactive target",n),i}Je(n){const i=this.Be.get(n);return i&&i.Se?null:this.Le.ot(n)}je(n){this.Be.set(n,new H$),this.Le.getRemoteKeysForTarget(n).forEach(i=>{this.Ue(n,i,null)})}it(n,i){return this.Le.getRemoteKeysForTarget(n).has(i)}}function K$(){return new ui(on.comparator)}function q$(){return new ui(on.comparator)}const Kbe={asc:"ASCENDING",desc:"DESCENDING"},qbe={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ybe={and:"AND",or:"OR"};class Xbe{constructor(n,i){this.databaseId=n,this.useProto3Json=i}}function J5(s,n){return s.useProto3Json||gT(n)?n:{value:n}}function tk(s,n){return s.useProto3Json?`${new Date(1e3*n.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+n.nanoseconds).slice(-9)}Z`:{seconds:""+n.seconds,nanos:n.nanoseconds}}function rne(s,n){return s.useProto3Json?n.toBase64():n.toUint8Array()}function $be(s,n){return tk(s,n.toTimestamp())}function Yc(s){return Fr(!!s),In.fromTimestamp(function(i){const l=um(i);return new cn(l.seconds,l.nanos)}(s))}function $3(s,n){return Q5(s,n).canonicalString()}function Q5(s,n){const i=function(u){return new Ts(["projects",u.projectId,"databases",u.database])}(s).child("documents");return n===void 0?i:i.child(n)}function sne(s){const n=Ts.fromString(s);return Fr(dne(n)),n}function nk(s,n){return $3(s.databaseId,n.path)}function hS(s,n){const i=sne(n);if(i.get(1)!==s.databaseId.projectId)throw new kt(st.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+s.databaseId.projectId);if(i.get(3)!==s.databaseId.database)throw new kt(st.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+s.databaseId.database);return new on(ane(i))}function ine(s,n){return $3(s.databaseId,n)}function Jbe(s){const n=sne(s);return n.length===4?Ts.emptyPath():ane(n)}function Z5(s){return new Ts(["projects",s.databaseId.projectId,"databases",s.databaseId.database]).canonicalString()}function ane(s){return Fr(s.length>4&&s.get(4)==="documents"),s.popFirst(5)}function Y$(s,n,i){return{name:nk(s,n),fields:i.value.mapValue.fields}}function Qbe(s,n){return"found"in n?function(l,u){Fr(!!u.found),u.found.name,u.found.updateTime;const p=hS(l,u.found.name),g=Yc(u.found.updateTime),y=u.found.createTime?Yc(u.found.createTime):In.min(),x=new Mo({mapValue:{fields:u.found.fields}});return xa.newFoundDocument(p,g,y,x)}(s,n):"missing"in n?function(l,u){Fr(!!u.missing),Fr(!!u.readTime);const p=hS(l,u.missing),g=Yc(u.readTime);return xa.newNoDocument(p,g)}(s,n):Rn()}function Zbe(s,n){let i;if("targetChange"in n){n.targetChange;const l=function(C){return C==="NO_CHANGE"?0:C==="ADD"?1:C==="REMOVE"?2:C==="CURRENT"?3:C==="RESET"?4:Rn()}(n.targetChange.targetChangeType||"NO_CHANGE"),u=n.targetChange.targetIds||[],p=function(C,k){return C.useProto3Json?(Fr(k===void 0||typeof k=="string"),Qa.fromBase64String(k||"")):(Fr(k===void 0||k instanceof Buffer||k instanceof Uint8Array),Qa.fromUint8Array(k||new Uint8Array))}(s,n.targetChange.resumeToken),g=n.targetChange.cause,y=g&&function(C){const k=C.code===void 0?st.UNKNOWN:ene(C.code);return new kt(k,C.message||"")}(g);i=new nne(l,u,p,y||null)}else if("documentChange"in n){n.documentChange;const l=n.documentChange;l.document,l.document.name,l.document.updateTime;const u=hS(s,l.document.name),p=Yc(l.document.updateTime),g=l.document.createTime?Yc(l.document.createTime):In.min(),y=new Mo({mapValue:{fields:l.document.fields}}),x=xa.newFoundDocument(u,p,g,y),C=l.targetIds||[],k=l.removedTargetIds||[];i=new m1(C,k,x.key,x)}else if("documentDelete"in n){n.documentDelete;const l=n.documentDelete;l.document;const u=hS(s,l.document),p=l.readTime?Yc(l.readTime):In.min(),g=xa.newNoDocument(u,p),y=l.removedTargetIds||[];i=new m1([],y,g.key,g)}else if("documentRemove"in n){n.documentRemove;const l=n.documentRemove;l.document;const u=hS(s,l.document),p=l.removedTargetIds||[];i=new m1([],p,u,null)}else{if(!("filter"in n))return Rn();{n.filter;const l=n.filter;l.targetId;const{count:u=0,unchangedNames:p}=l,g=new zbe(u,p),y=l.targetId;i=new tne(y,g)}}return i}function one(s,n){let i;if(n instanceof _T)i={update:Y$(s,n.key,n.value)};else if(n instanceof Yk)i={delete:nk(s,n.key)};else if(n instanceof gm)i={update:Y$(s,n.key,n.data),updateMask:cxe(n.fieldMask)};else{if(!(n instanceof Qte))return Rn();i={verify:nk(s,n.key)}}return n.fieldTransforms.length>0&&(i.updateTransforms=n.fieldTransforms.map(l=>function(p,g){const y=g.transform;if(y instanceof KS)return{fieldPath:g.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(y instanceof uy)return{fieldPath:g.field.canonicalString(),appendMissingElements:{values:y.elements}};if(y instanceof qS)return{fieldPath:g.field.canonicalString(),removeAllFromArray:{values:y.elements}};if(y instanceof YS)return{fieldPath:g.field.canonicalString(),increment:y.Pe};throw Rn()}(0,l))),n.precondition.isNone||(i.currentDocument=function(u,p){return p.updateTime!==void 0?{updateTime:$be(u,p.updateTime)}:p.exists!==void 0?{exists:p.exists}:Rn()}(s,n.precondition)),i}function exe(s,n){return s&&s.length>0?(Fr(n!==void 0),s.map(i=>function(u,p){let g=u.updateTime?Yc(u.updateTime):Yc(p);return g.isEqual(In.min())&&(g=Yc(p)),new Mbe(g,u.transformResults||[])}(i,n))):[]}function txe(s,n){return{documents:[ine(s,n.path)]}}function nxe(s,n){const i={structuredQuery:{}},l=n.path;let u;n.collectionGroup!==null?(u=l,i.structuredQuery.from=[{collectionId:n.collectionGroup,allDescendants:!0}]):(u=l.popLast(),i.structuredQuery.from=[{collectionId:l.lastSegment()}]),i.parent=ine(s,u);const p=function(C){if(C.length!==0)return lne(Kd.create(C,"and"))}(n.filters);p&&(i.structuredQuery.where=p);const g=function(C){if(C.length!==0)return C.map(k=>function(M){return{field:wE(M.field),direction:ixe(M.dir)}}(k))}(n.orderBy);g&&(i.structuredQuery.orderBy=g);const y=J5(s,n.limit);return y!==null&&(i.structuredQuery.limit=y),n.startAt&&(i.structuredQuery.startAt=function(C){return{before:C.inclusive,values:C.position}}(n.startAt)),n.endAt&&(i.structuredQuery.endAt=function(C){return{before:!C.inclusive,values:C.position}}(n.endAt)),{_t:i,parent:u}}function rxe(s){let n=Jbe(s.parent);const i=s.structuredQuery,l=i.from?i.from.length:0;let u=null;if(l>0){Fr(l===1);const k=i.from[0];k.allDescendants?u=k.collectionId:n=n.child(k.collectionId)}let p=[];i.where&&(p=function(A){const M=cne(A);return M instanceof Kd&&Pte(M)?M.getFilters():[M]}(i.where));let g=[];i.orderBy&&(g=function(A){return A.map(M=>function(B){return new HS(SE(B.field),function(Z){switch(Z){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(B.direction))}(M))}(i.orderBy));let y=null;i.limit&&(y=function(A){let M;return M=typeof A=="object"?A.value:A,gT(M)?null:M}(i.limit));let x=null;i.startAt&&(x=function(A){const M=!!A.before,G=A.values||[];return new Z1(G,M)}(i.startAt));let C=null;return i.endAt&&(C=function(A){const M=!A.before,G=A.values||[];return new Z1(G,M)}(i.endAt)),Tbe(n,u,g,p,y,"F",x,C)}function sxe(s,n){const i=function(u){switch(u){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Rn()}}(n.purpose);return i==null?null:{"goog-listen-tags":i}}function cne(s){return s.unaryFilter!==void 0?function(i){switch(i.unaryFilter.op){case"IS_NAN":const l=SE(i.unaryFilter.field);return zi.create(l,"==",{doubleValue:NaN});case"IS_NULL":const u=SE(i.unaryFilter.field);return zi.create(u,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const p=SE(i.unaryFilter.field);return zi.create(p,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const g=SE(i.unaryFilter.field);return zi.create(g,"!=",{nullValue:"NULL_VALUE"});default:return Rn()}}(s):s.fieldFilter!==void 0?function(i){return zi.create(SE(i.fieldFilter.field),function(u){switch(u){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Rn()}}(i.fieldFilter.op),i.fieldFilter.value)}(s):s.compositeFilter!==void 0?function(i){return Kd.create(i.compositeFilter.filters.map(l=>cne(l)),function(u){switch(u){case"AND":return"and";case"OR":return"or";default:return Rn()}}(i.compositeFilter.op))}(s):Rn()}function ixe(s){return Kbe[s]}function axe(s){return qbe[s]}function oxe(s){return Ybe[s]}function wE(s){return{fieldPath:s.canonicalString()}}function SE(s){return Ha.fromServerFormat(s.fieldPath)}function lne(s){return s instanceof zi?function(i){if(i.op==="=="){if(P$(i.value))return{unaryFilter:{field:wE(i.field),op:"IS_NAN"}};if(D$(i.value))return{unaryFilter:{field:wE(i.field),op:"IS_NULL"}}}else if(i.op==="!="){if(P$(i.value))return{unaryFilter:{field:wE(i.field),op:"IS_NOT_NAN"}};if(D$(i.value))return{unaryFilter:{field:wE(i.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:wE(i.field),op:axe(i.op),value:i.value}}}(s):s instanceof Kd?function(i){const l=i.getFilters().map(u=>lne(u));return l.length===1?l[0]:{compositeFilter:{op:oxe(i.op),filters:l}}}(s):Rn()}function cxe(s){const n=[];return s.fields.forEach(i=>n.push(i.canonicalString())),{fieldPaths:n}}function dne(s){return s.length>=4&&s.get(0)==="projects"&&s.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gf{constructor(n,i,l,u,p=In.min(),g=In.min(),y=Qa.EMPTY_BYTE_STRING,x=null){this.target=n,this.targetId=i,this.purpose=l,this.sequenceNumber=u,this.snapshotVersion=p,this.lastLimboFreeSnapshotVersion=g,this.resumeToken=y,this.expectedCount=x}withSequenceNumber(n){return new Gf(this.target,this.targetId,this.purpose,n,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(n,i){return new Gf(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,n,null)}withExpectedCount(n){return new Gf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,n)}withLastLimboFreeSnapshotVersion(n){return new Gf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,n,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lxe{constructor(n){this.ct=n}}function dxe(s){const n=rxe({parent:s.parent,structuredQuery:s.structuredQuery});return s.limitType==="LAST"?ek(n,n.limit,"L"):n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uxe{constructor(){this.un=new hxe}addToCollectionParentIndex(n,i){return this.un.add(i),ht.resolve()}getCollectionParents(n,i){return ht.resolve(this.un.getEntries(i))}addFieldIndex(n,i){return ht.resolve()}deleteFieldIndex(n,i){return ht.resolve()}deleteAllFieldIndexes(n){return ht.resolve()}createTargetIndexes(n,i){return ht.resolve()}getDocumentsMatchingTarget(n,i){return ht.resolve(null)}getIndexType(n,i){return ht.resolve(0)}getFieldIndexes(n,i){return ht.resolve([])}getNextCollectionGroupToUpdate(n){return ht.resolve(null)}getMinOffset(n,i){return ht.resolve(dm.min())}getMinOffsetFromCollectionGroup(n,i){return ht.resolve(dm.min())}updateCollectionGroup(n,i,l){return ht.resolve()}updateIndexEntries(n,i){return ht.resolve()}}class hxe{constructor(){this.index={}}add(n){const i=n.lastSegment(),l=n.popLast(),u=this.index[i]||new Xa(Ts.comparator),p=!u.has(l);return this.index[i]=u.add(l),p}has(n){const i=n.lastSegment(),l=n.popLast(),u=this.index[i];return u&&u.has(l)}getEntries(n){return(this.index[n]||new Xa(Ts.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hy{constructor(n){this.Ln=n}next(){return this.Ln+=2,this.Ln}static Bn(){return new hy(0)}static kn(){return new hy(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pxe{constructor(){this.changes=new Dy(n=>n.toString(),(n,i)=>n.isEqual(i)),this.changesApplied=!1}addEntry(n){this.assertNotApplied(),this.changes.set(n.key,n)}removeEntry(n,i){this.assertNotApplied(),this.changes.set(n,xa.newInvalidDocument(n).setReadTime(i))}getEntry(n,i){this.assertNotApplied();const l=this.changes.get(i);return l!==void 0?ht.resolve(l):this.getFromCache(n,i)}getEntries(n,i){return this.getAllFromCache(n,i)}apply(n){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(n)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fxe{constructor(n,i){this.overlayedDocument=n,this.mutatedFields=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mxe{constructor(n,i,l,u){this.remoteDocumentCache=n,this.mutationQueue=i,this.documentOverlayCache=l,this.indexManager=u}getDocument(n,i){let l=null;return this.documentOverlayCache.getOverlay(n,i).next(u=>(l=u,this.remoteDocumentCache.getEntry(n,i))).next(u=>(l!==null&&uS(l.mutation,u,Hc.empty(),cn.now()),u))}getDocuments(n,i){return this.remoteDocumentCache.getEntries(n,i).next(l=>this.getLocalViewOfDocuments(n,l,xr()).next(()=>l))}getLocalViewOfDocuments(n,i,l=xr()){const u=p_();return this.populateOverlays(n,u,i).next(()=>this.computeViews(n,i,u,l).next(p=>{let g=Yw();return p.forEach((y,x)=>{g=g.insert(y,x.overlayedDocument)}),g}))}getOverlayedDocuments(n,i){const l=p_();return this.populateOverlays(n,l,i).next(()=>this.computeViews(n,i,l,xr()))}populateOverlays(n,i,l){const u=[];return l.forEach(p=>{i.has(p)||u.push(p)}),this.documentOverlayCache.getOverlays(n,u).next(p=>{p.forEach((g,y)=>{i.set(g,y)})})}computeViews(n,i,l,u){let p=dp();const g=dS(),y=function(){return dS()}();return i.forEach((x,C)=>{const k=l.get(C.key);u.has(C.key)&&(k===void 0||k.mutation instanceof gm)?p=p.insert(C.key,C):k!==void 0?(g.set(C.key,k.mutation.getFieldMask()),uS(k.mutation,C,k.mutation.getFieldMask(),cn.now())):g.set(C.key,Hc.empty())}),this.recalculateAndSaveOverlays(n,p).next(x=>(x.forEach((C,k)=>g.set(C,k)),i.forEach((C,k)=>{var A;return y.set(C,new fxe(k,(A=g.get(C))!==null&&A!==void 0?A:null))}),y))}recalculateAndSaveOverlays(n,i){const l=dS();let u=new ui((g,y)=>g-y),p=xr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(n,i).next(g=>{for(const y of g)y.keys().forEach(x=>{const C=i.get(x);if(C===null)return;let k=l.get(x)||Hc.empty();k=y.applyToLocalView(C,k),l.set(x,k);const A=(u.get(y.batchId)||xr()).add(x);u=u.insert(y.batchId,A)})}).next(()=>{const g=[],y=u.getReverseIterator();for(;y.hasNext();){const x=y.getNext(),C=x.key,k=x.value,A=Gte();k.forEach(M=>{if(!p.has(M)){const G=$te(i.get(M),l.get(M));G!==null&&A.set(M,G),p=p.add(M)}}),g.push(this.documentOverlayCache.saveOverlays(n,C,A))}return ht.waitFor(g)}).next(()=>l)}recalculateAndSaveOverlaysForDocumentKeys(n,i){return this.remoteDocumentCache.getEntries(n,i).next(l=>this.recalculateAndSaveOverlays(n,l))}getDocumentsMatchingQuery(n,i,l,u){return function(g){return on.isDocumentKey(g.path)&&g.collectionGroup===null&&g.filters.length===0}(i)?this.getDocumentsMatchingDocumentQuery(n,i.path):Ute(i)?this.getDocumentsMatchingCollectionGroupQuery(n,i,l,u):this.getDocumentsMatchingCollectionQuery(n,i,l,u)}getNextDocuments(n,i,l,u){return this.remoteDocumentCache.getAllFromCollectionGroup(n,i,l,u).next(p=>{const g=u-p.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(n,i,l.largestBatchId,u-p.size):ht.resolve(p_());let y=-1,x=p;return g.next(C=>ht.forEach(C,(k,A)=>(y<A.largestBatchId&&(y=A.largestBatchId),p.get(k)?ht.resolve():this.remoteDocumentCache.getEntry(n,k).next(M=>{x=x.insert(k,M)}))).next(()=>this.populateOverlays(n,C,p)).next(()=>this.computeViews(n,x,C,xr())).next(k=>({batchId:y,changes:zte(k)})))})}getDocumentsMatchingDocumentQuery(n,i){return this.getDocument(n,new on(i)).next(l=>{let u=Yw();return l.isFoundDocument()&&(u=u.insert(l.key,l)),u})}getDocumentsMatchingCollectionGroupQuery(n,i,l,u){const p=i.collectionGroup;let g=Yw();return this.indexManager.getCollectionParents(n,p).next(y=>ht.forEach(y,x=>{const C=function(A,M){return new Oy(M,null,A.explicitOrderBy.slice(),A.filters.slice(),A.limit,A.limitType,A.startAt,A.endAt)}(i,x.child(p));return this.getDocumentsMatchingCollectionQuery(n,C,l,u).next(k=>{k.forEach((A,M)=>{g=g.insert(A,M)})})}).next(()=>g))}getDocumentsMatchingCollectionQuery(n,i,l,u){let p;return this.documentOverlayCache.getOverlaysForCollection(n,i.path,l.largestBatchId).next(g=>(p=g,this.remoteDocumentCache.getDocumentsMatchingQuery(n,i,l,p,u))).next(g=>{p.forEach((x,C)=>{const k=C.getKey();g.get(k)===null&&(g=g.insert(k,xa.newInvalidDocument(k)))});let y=Yw();return g.forEach((x,C)=>{const k=p.get(x);k!==void 0&&uS(k.mutation,C,Hc.empty(),cn.now()),Hk(i,C)&&(y=y.insert(x,C))}),y})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gxe{constructor(n){this.serializer=n,this.hr=new Map,this.Pr=new Map}getBundleMetadata(n,i){return ht.resolve(this.hr.get(i))}saveBundleMetadata(n,i){return this.hr.set(i.id,function(u){return{id:u.id,version:u.version,createTime:Yc(u.createTime)}}(i)),ht.resolve()}getNamedQuery(n,i){return ht.resolve(this.Pr.get(i))}saveNamedQuery(n,i){return this.Pr.set(i.name,function(u){return{name:u.name,query:dxe(u.bundledQuery),readTime:Yc(u.readTime)}}(i)),ht.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _xe{constructor(){this.overlays=new ui(on.comparator),this.Ir=new Map}getOverlay(n,i){return ht.resolve(this.overlays.get(i))}getOverlays(n,i){const l=p_();return ht.forEach(i,u=>this.getOverlay(n,u).next(p=>{p!==null&&l.set(u,p)})).next(()=>l)}saveOverlays(n,i,l){return l.forEach((u,p)=>{this.ht(n,i,p)}),ht.resolve()}removeOverlaysForBatchId(n,i,l){const u=this.Ir.get(l);return u!==void 0&&(u.forEach(p=>this.overlays=this.overlays.remove(p)),this.Ir.delete(l)),ht.resolve()}getOverlaysForCollection(n,i,l){const u=p_(),p=i.length+1,g=new on(i.child("")),y=this.overlays.getIteratorFrom(g);for(;y.hasNext();){const x=y.getNext().value,C=x.getKey();if(!i.isPrefixOf(C.path))break;C.path.length===p&&x.largestBatchId>l&&u.set(x.getKey(),x)}return ht.resolve(u)}getOverlaysForCollectionGroup(n,i,l,u){let p=new ui((C,k)=>C-k);const g=this.overlays.getIterator();for(;g.hasNext();){const C=g.getNext().value;if(C.getKey().getCollectionGroup()===i&&C.largestBatchId>l){let k=p.get(C.largestBatchId);k===null&&(k=p_(),p=p.insert(C.largestBatchId,k)),k.set(C.getKey(),C)}}const y=p_(),x=p.getIterator();for(;x.hasNext()&&(x.getNext().value.forEach((C,k)=>y.set(C,k)),!(y.size()>=u)););return ht.resolve(y)}ht(n,i,l){const u=this.overlays.get(l.key);if(u!==null){const g=this.Ir.get(u.largestBatchId).delete(l.key);this.Ir.set(u.largestBatchId,g)}this.overlays=this.overlays.insert(l.key,new Bbe(i,l));let p=this.Ir.get(i);p===void 0&&(p=xr(),this.Ir.set(i,p)),this.Ir.set(i,p.add(l.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vxe{constructor(){this.sessionToken=Qa.EMPTY_BYTE_STRING}getSessionToken(n){return ht.resolve(this.sessionToken)}setSessionToken(n,i){return this.sessionToken=i,ht.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J3{constructor(){this.Tr=new Xa(ya.Er),this.dr=new Xa(ya.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(n,i){const l=new ya(n,i);this.Tr=this.Tr.add(l),this.dr=this.dr.add(l)}Rr(n,i){n.forEach(l=>this.addReference(l,i))}removeReference(n,i){this.Vr(new ya(n,i))}mr(n,i){n.forEach(l=>this.removeReference(l,i))}gr(n){const i=new on(new Ts([])),l=new ya(i,n),u=new ya(i,n+1),p=[];return this.dr.forEachInRange([l,u],g=>{this.Vr(g),p.push(g.key)}),p}pr(){this.Tr.forEach(n=>this.Vr(n))}Vr(n){this.Tr=this.Tr.delete(n),this.dr=this.dr.delete(n)}yr(n){const i=new on(new Ts([])),l=new ya(i,n),u=new ya(i,n+1);let p=xr();return this.dr.forEachInRange([l,u],g=>{p=p.add(g.key)}),p}containsKey(n){const i=new ya(n,0),l=this.Tr.firstAfterOrEqual(i);return l!==null&&n.isEqual(l.key)}}class ya{constructor(n,i){this.key=n,this.wr=i}static Er(n,i){return on.comparator(n.key,i.key)||$r(n.wr,i.wr)}static Ar(n,i){return $r(n.wr,i.wr)||on.comparator(n.key,i.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Exe{constructor(n,i){this.indexManager=n,this.referenceDelegate=i,this.mutationQueue=[],this.Sr=1,this.br=new Xa(ya.Er)}checkEmpty(n){return ht.resolve(this.mutationQueue.length===0)}addMutationBatch(n,i,l,u){const p=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const g=new Fbe(p,i,l,u);this.mutationQueue.push(g);for(const y of u)this.br=this.br.add(new ya(y.key,p)),this.indexManager.addToCollectionParentIndex(n,y.key.path.popLast());return ht.resolve(g)}lookupMutationBatch(n,i){return ht.resolve(this.Dr(i))}getNextMutationBatchAfterBatchId(n,i){const l=i+1,u=this.vr(l),p=u<0?0:u;return ht.resolve(this.mutationQueue.length>p?this.mutationQueue[p]:null)}getHighestUnacknowledgedBatchId(){return ht.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(n){return ht.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(n,i){const l=new ya(i,0),u=new ya(i,Number.POSITIVE_INFINITY),p=[];return this.br.forEachInRange([l,u],g=>{const y=this.Dr(g.wr);p.push(y)}),ht.resolve(p)}getAllMutationBatchesAffectingDocumentKeys(n,i){let l=new Xa($r);return i.forEach(u=>{const p=new ya(u,0),g=new ya(u,Number.POSITIVE_INFINITY);this.br.forEachInRange([p,g],y=>{l=l.add(y.wr)})}),ht.resolve(this.Cr(l))}getAllMutationBatchesAffectingQuery(n,i){const l=i.path,u=l.length+1;let p=l;on.isDocumentKey(p)||(p=p.child(""));const g=new ya(new on(p),0);let y=new Xa($r);return this.br.forEachWhile(x=>{const C=x.key.path;return!!l.isPrefixOf(C)&&(C.length===u&&(y=y.add(x.wr)),!0)},g),ht.resolve(this.Cr(y))}Cr(n){const i=[];return n.forEach(l=>{const u=this.Dr(l);u!==null&&i.push(u)}),i}removeMutationBatch(n,i){Fr(this.Fr(i.batchId,"removed")===0),this.mutationQueue.shift();let l=this.br;return ht.forEach(i.mutations,u=>{const p=new ya(u.key,i.batchId);return l=l.delete(p),this.referenceDelegate.markPotentiallyOrphaned(n,u.key)}).next(()=>{this.br=l})}On(n){}containsKey(n,i){const l=new ya(i,0),u=this.br.firstAfterOrEqual(l);return ht.resolve(i.isEqual(u&&u.key))}performConsistencyCheck(n){return this.mutationQueue.length,ht.resolve()}Fr(n,i){return this.vr(n)}vr(n){return this.mutationQueue.length===0?0:n-this.mutationQueue[0].batchId}Dr(n){const i=this.vr(n);return i<0||i>=this.mutationQueue.length?null:this.mutationQueue[i]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yxe{constructor(n){this.Mr=n,this.docs=function(){return new ui(on.comparator)}(),this.size=0}setIndexManager(n){this.indexManager=n}addEntry(n,i){const l=i.key,u=this.docs.get(l),p=u?u.size:0,g=this.Mr(i);return this.docs=this.docs.insert(l,{document:i.mutableCopy(),size:g}),this.size+=g-p,this.indexManager.addToCollectionParentIndex(n,l.path.popLast())}removeEntry(n){const i=this.docs.get(n);i&&(this.docs=this.docs.remove(n),this.size-=i.size)}getEntry(n,i){const l=this.docs.get(i);return ht.resolve(l?l.document.mutableCopy():xa.newInvalidDocument(i))}getEntries(n,i){let l=dp();return i.forEach(u=>{const p=this.docs.get(u);l=l.insert(u,p?p.document.mutableCopy():xa.newInvalidDocument(u))}),ht.resolve(l)}getDocumentsMatchingQuery(n,i,l,u){let p=dp();const g=i.path,y=new on(g.child("")),x=this.docs.getIteratorFrom(y);for(;x.hasNext();){const{key:C,value:{document:k}}=x.getNext();if(!g.isPrefixOf(C.path))break;C.path.length>g.length+1||abe(ibe(k),l)<=0||(u.has(k.key)||Hk(i,k))&&(p=p.insert(k.key,k.mutableCopy()))}return ht.resolve(p)}getAllFromCollectionGroup(n,i,l,u){Rn()}Or(n,i){return ht.forEach(this.docs,l=>i(l))}newChangeBuffer(n){return new bxe(this)}getSize(n){return ht.resolve(this.size)}}class bxe extends pxe{constructor(n){super(),this.cr=n}applyChanges(n){const i=[];return this.changes.forEach((l,u)=>{u.isValidDocument()?i.push(this.cr.addEntry(n,u)):this.cr.removeEntry(l)}),ht.waitFor(i)}getFromCache(n,i){return this.cr.getEntry(n,i)}getAllFromCache(n,i){return this.cr.getEntries(n,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xxe{constructor(n){this.persistence=n,this.Nr=new Dy(i=>W3(i),H3),this.lastRemoteSnapshotVersion=In.min(),this.highestTargetId=0,this.Lr=0,this.Br=new J3,this.targetCount=0,this.kr=hy.Bn()}forEachTarget(n,i){return this.Nr.forEach((l,u)=>i(u)),ht.resolve()}getLastRemoteSnapshotVersion(n){return ht.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(n){return ht.resolve(this.Lr)}allocateTargetId(n){return this.highestTargetId=this.kr.next(),ht.resolve(this.highestTargetId)}setTargetsMetadata(n,i,l){return l&&(this.lastRemoteSnapshotVersion=l),i>this.Lr&&(this.Lr=i),ht.resolve()}Kn(n){this.Nr.set(n.target,n);const i=n.targetId;i>this.highestTargetId&&(this.kr=new hy(i),this.highestTargetId=i),n.sequenceNumber>this.Lr&&(this.Lr=n.sequenceNumber)}addTargetData(n,i){return this.Kn(i),this.targetCount+=1,ht.resolve()}updateTargetData(n,i){return this.Kn(i),ht.resolve()}removeTargetData(n,i){return this.Nr.delete(i.target),this.Br.gr(i.targetId),this.targetCount-=1,ht.resolve()}removeTargets(n,i,l){let u=0;const p=[];return this.Nr.forEach((g,y)=>{y.sequenceNumber<=i&&l.get(y.targetId)===null&&(this.Nr.delete(g),p.push(this.removeMatchingKeysForTargetId(n,y.targetId)),u++)}),ht.waitFor(p).next(()=>u)}getTargetCount(n){return ht.resolve(this.targetCount)}getTargetData(n,i){const l=this.Nr.get(i)||null;return ht.resolve(l)}addMatchingKeys(n,i,l){return this.Br.Rr(i,l),ht.resolve()}removeMatchingKeys(n,i,l){this.Br.mr(i,l);const u=this.persistence.referenceDelegate,p=[];return u&&i.forEach(g=>{p.push(u.markPotentiallyOrphaned(n,g))}),ht.waitFor(p)}removeMatchingKeysForTargetId(n,i){return this.Br.gr(i),ht.resolve()}getMatchingKeysForTargetId(n,i){const l=this.Br.yr(i);return ht.resolve(l)}containsKey(n,i){return ht.resolve(this.Br.containsKey(i))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wxe{constructor(n,i){this.qr={},this.overlays={},this.Qr=new F3(0),this.Kr=!1,this.Kr=!0,this.$r=new vxe,this.referenceDelegate=n(this),this.Ur=new xxe(this),this.indexManager=new uxe,this.remoteDocumentCache=function(u){return new yxe(u)}(l=>this.referenceDelegate.Wr(l)),this.serializer=new lxe(i),this.Gr=new gxe(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(n){return this.indexManager}getDocumentOverlayCache(n){let i=this.overlays[n.toKey()];return i||(i=new _xe,this.overlays[n.toKey()]=i),i}getMutationQueue(n,i){let l=this.qr[n.toKey()];return l||(l=new Exe(i,this.referenceDelegate),this.qr[n.toKey()]=l),l}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(n,i,l){$t("MemoryPersistence","Starting transaction:",n);const u=new Sxe(this.Qr.next());return this.referenceDelegate.zr(),l(u).next(p=>this.referenceDelegate.jr(u).next(()=>p)).toPromise().then(p=>(u.raiseOnCommittedEvent(),p))}Hr(n,i){return ht.or(Object.values(this.qr).map(l=>()=>l.containsKey(n,i)))}}class Sxe extends cbe{constructor(n){super(),this.currentSequenceNumber=n}}class Q3{constructor(n){this.persistence=n,this.Jr=new J3,this.Yr=null}static Zr(n){return new Q3(n)}get Xr(){if(this.Yr)return this.Yr;throw Rn()}addReference(n,i,l){return this.Jr.addReference(l,i),this.Xr.delete(l.toString()),ht.resolve()}removeReference(n,i,l){return this.Jr.removeReference(l,i),this.Xr.add(l.toString()),ht.resolve()}markPotentiallyOrphaned(n,i){return this.Xr.add(i.toString()),ht.resolve()}removeTarget(n,i){this.Jr.gr(i.targetId).forEach(u=>this.Xr.add(u.toString()));const l=this.persistence.getTargetCache();return l.getMatchingKeysForTargetId(n,i.targetId).next(u=>{u.forEach(p=>this.Xr.add(p.toString()))}).next(()=>l.removeTargetData(n,i))}zr(){this.Yr=new Set}jr(n){const i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ht.forEach(this.Xr,l=>{const u=on.fromPath(l);return this.ei(n,u).next(p=>{p||i.removeEntry(u,In.min())})}).next(()=>(this.Yr=null,i.apply(n)))}updateLimboDocument(n,i){return this.ei(n,i).next(l=>{l?this.Xr.delete(i.toString()):this.Xr.add(i.toString())})}Wr(n){return 0}ei(n,i){return ht.or([()=>ht.resolve(this.Jr.containsKey(i)),()=>this.persistence.getTargetCache().containsKey(n,i),()=>this.persistence.Hr(n,i)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z3{constructor(n,i,l,u){this.targetId=n,this.fromCache=i,this.$i=l,this.Ui=u}static Wi(n,i){let l=xr(),u=xr();for(const p of i.docChanges)switch(p.type){case 0:l=l.add(p.doc.key);break;case 1:u=u.add(p.doc.key)}return new Z3(n,i.fromCache,l,u)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Txe{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(n){this._documentReadCount+=n}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rxe{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return f0e()?8:lbe(Eo())>0?6:4}()}initialize(n,i){this.Ji=n,this.indexManager=i,this.Gi=!0}getDocumentsMatchingQuery(n,i,l,u){const p={result:null};return this.Yi(n,i).next(g=>{p.result=g}).next(()=>{if(!p.result)return this.Zi(n,i,u,l).next(g=>{p.result=g})}).next(()=>{if(p.result)return;const g=new Txe;return this.Xi(n,i,g).next(y=>{if(p.result=y,this.zi)return this.es(n,i,g,y.size)})}).next(()=>p.result)}es(n,i,l,u){return l.documentReadCount<this.ji?(Mw()<=Cr.DEBUG&&$t("QueryEngine","SDK will not create cache indexes for query:",xE(i),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),ht.resolve()):(Mw()<=Cr.DEBUG&&$t("QueryEngine","Query:",xE(i),"scans",l.documentReadCount,"local documents and returns",u,"documents as results."),l.documentReadCount>this.Hi*u?(Mw()<=Cr.DEBUG&&$t("QueryEngine","The SDK decides to create cache indexes for query:",xE(i),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(n,$u(i))):ht.resolve())}Yi(n,i){if(U$(i))return ht.resolve(null);let l=$u(i);return this.indexManager.getIndexType(n,l).next(u=>u===0?null:(i.limit!==null&&u===1&&(i=ek(i,null,"F"),l=$u(i)),this.indexManager.getDocumentsMatchingTarget(n,l).next(p=>{const g=xr(...p);return this.Ji.getDocuments(n,g).next(y=>this.indexManager.getMinOffset(n,l).next(x=>{const C=this.ts(i,y);return this.ns(i,C,g,x.readTime)?this.Yi(n,ek(i,null,"F")):this.rs(n,C,i,x)}))})))}Zi(n,i,l,u){return U$(i)||u.isEqual(In.min())?ht.resolve(null):this.Ji.getDocuments(n,l).next(p=>{const g=this.ts(i,p);return this.ns(i,g,l,u)?ht.resolve(null):(Mw()<=Cr.DEBUG&&$t("QueryEngine","Re-using previous result from %s to execute query: %s",u.toString(),xE(i)),this.rs(n,g,i,sbe(u,-1)).next(y=>y))})}ts(n,i){let l=new Xa(Fte(n));return i.forEach((u,p)=>{Hk(n,p)&&(l=l.add(p))}),l}ns(n,i,l,u){if(n.limit===null)return!1;if(l.size!==i.size)return!0;const p=n.limitType==="F"?i.last():i.first();return!!p&&(p.hasPendingWrites||p.version.compareTo(u)>0)}Xi(n,i,l){return Mw()<=Cr.DEBUG&&$t("QueryEngine","Using full collection scan to execute query:",xE(i)),this.Ji.getDocumentsMatchingQuery(n,i,dm.min(),l)}rs(n,i,l,u){return this.Ji.getDocumentsMatchingQuery(n,l,u).next(p=>(i.forEach(g=>{p=p.insert(g.key,g)}),p))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cxe{constructor(n,i,l,u){this.persistence=n,this.ss=i,this.serializer=u,this.os=new ui($r),this._s=new Dy(p=>W3(p),H3),this.us=new Map,this.cs=n.getRemoteDocumentCache(),this.Ur=n.getTargetCache(),this.Gr=n.getBundleCache(),this.ls(l)}ls(n){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(n),this.indexManager=this.persistence.getIndexManager(n),this.mutationQueue=this.persistence.getMutationQueue(n,this.indexManager),this.localDocuments=new mxe(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(n){return this.persistence.runTransaction("Collect garbage","readwrite-primary",i=>n.collect(i,this.os))}}function Nxe(s,n,i,l){return new Cxe(s,n,i,l)}async function une(s,n){const i=Ln(s);return await i.persistence.runTransaction("Handle user change","readonly",l=>{let u;return i.mutationQueue.getAllMutationBatches(l).next(p=>(u=p,i.ls(n),i.mutationQueue.getAllMutationBatches(l))).next(p=>{const g=[],y=[];let x=xr();for(const C of u){g.push(C.batchId);for(const k of C.mutations)x=x.add(k.key)}for(const C of p){y.push(C.batchId);for(const k of C.mutations)x=x.add(k.key)}return i.localDocuments.getDocuments(l,x).next(C=>({hs:C,removedBatchIds:g,addedBatchIds:y}))})})}function Ixe(s,n){const i=Ln(s);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",l=>{const u=n.batch.keys(),p=i.cs.newChangeBuffer({trackRemovals:!0});return function(y,x,C,k){const A=C.batch,M=A.keys();let G=ht.resolve();return M.forEach(B=>{G=G.next(()=>k.getEntry(x,B)).next(X=>{const Z=C.docVersions.get(B);Fr(Z!==null),X.version.compareTo(Z)<0&&(A.applyToRemoteDocument(X,C),X.isValidDocument()&&(X.setReadTime(C.commitVersion),k.addEntry(X)))})}),G.next(()=>y.mutationQueue.removeMutationBatch(x,A))}(i,l,n,p).next(()=>p.apply(l)).next(()=>i.mutationQueue.performConsistencyCheck(l)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(l,u,n.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,function(y){let x=xr();for(let C=0;C<y.mutationResults.length;++C)y.mutationResults[C].transformResults.length>0&&(x=x.add(y.batch.mutations[C].key));return x}(n))).next(()=>i.localDocuments.getDocuments(l,u))})}function hne(s){const n=Ln(s);return n.persistence.runTransaction("Get last remote snapshot version","readonly",i=>n.Ur.getLastRemoteSnapshotVersion(i))}function Axe(s,n){const i=Ln(s),l=n.snapshotVersion;let u=i.os;return i.persistence.runTransaction("Apply remote event","readwrite-primary",p=>{const g=i.cs.newChangeBuffer({trackRemovals:!0});u=i.os;const y=[];n.targetChanges.forEach((k,A)=>{const M=u.get(A);if(!M)return;y.push(i.Ur.removeMatchingKeys(p,k.removedDocuments,A).next(()=>i.Ur.addMatchingKeys(p,k.addedDocuments,A)));let G=M.withSequenceNumber(p.currentSequenceNumber);n.targetMismatches.get(A)!==null?G=G.withResumeToken(Qa.EMPTY_BYTE_STRING,In.min()).withLastLimboFreeSnapshotVersion(In.min()):k.resumeToken.approximateByteSize()>0&&(G=G.withResumeToken(k.resumeToken,l)),u=u.insert(A,G),function(X,Z,q){return X.resumeToken.approximateByteSize()===0||Z.snapshotVersion.toMicroseconds()-X.snapshotVersion.toMicroseconds()>=3e8?!0:q.addedDocuments.size+q.modifiedDocuments.size+q.removedDocuments.size>0}(M,G,k)&&y.push(i.Ur.updateTargetData(p,G))});let x=dp(),C=xr();if(n.documentUpdates.forEach(k=>{n.resolvedLimboDocuments.has(k)&&y.push(i.persistence.referenceDelegate.updateLimboDocument(p,k))}),y.push(kxe(p,g,n.documentUpdates).next(k=>{x=k.Ps,C=k.Is})),!l.isEqual(In.min())){const k=i.Ur.getLastRemoteSnapshotVersion(p).next(A=>i.Ur.setTargetsMetadata(p,p.currentSequenceNumber,l));y.push(k)}return ht.waitFor(y).next(()=>g.apply(p)).next(()=>i.localDocuments.getLocalViewOfDocuments(p,x,C)).next(()=>x)}).then(p=>(i.os=u,p))}function kxe(s,n,i){let l=xr(),u=xr();return i.forEach(p=>l=l.add(p)),n.getEntries(s,l).next(p=>{let g=dp();return i.forEach((y,x)=>{const C=p.get(y);x.isFoundDocument()!==C.isFoundDocument()&&(u=u.add(y)),x.isNoDocument()&&x.version.isEqual(In.min())?(n.removeEntry(y,x.readTime),g=g.insert(y,x)):!C.isValidDocument()||x.version.compareTo(C.version)>0||x.version.compareTo(C.version)===0&&C.hasPendingWrites?(n.addEntry(x),g=g.insert(y,x)):$t("LocalStore","Ignoring outdated watch update for ",y,". Current version:",C.version," Watch version:",x.version)}),{Ps:g,Is:u}})}function Oxe(s,n){const i=Ln(s);return i.persistence.runTransaction("Get next mutation batch","readonly",l=>(n===void 0&&(n=-1),i.mutationQueue.getNextMutationBatchAfterBatchId(l,n)))}function Dxe(s,n){const i=Ln(s);return i.persistence.runTransaction("Allocate target","readwrite",l=>{let u;return i.Ur.getTargetData(l,n).next(p=>p?(u=p,ht.resolve(u)):i.Ur.allocateTargetId(l).next(g=>(u=new Gf(n,g,"TargetPurposeListen",l.currentSequenceNumber),i.Ur.addTargetData(l,u).next(()=>u))))}).then(l=>{const u=i.os.get(l.targetId);return(u===null||l.snapshotVersion.compareTo(u.snapshotVersion)>0)&&(i.os=i.os.insert(l.targetId,l),i._s.set(n,l.targetId)),l})}async function eV(s,n,i){const l=Ln(s),u=l.os.get(n),p=i?"readwrite":"readwrite-primary";try{i||await l.persistence.runTransaction("Release target",p,g=>l.persistence.referenceDelegate.removeTarget(g,u))}catch(g){if(!mT(g))throw g;$t("LocalStore",`Failed to update sequence numbers for target ${n}: ${g}`)}l.os=l.os.remove(n),l._s.delete(u.target)}function X$(s,n,i){const l=Ln(s);let u=In.min(),p=xr();return l.persistence.runTransaction("Execute query","readwrite",g=>function(x,C,k){const A=Ln(x),M=A._s.get(k);return M!==void 0?ht.resolve(A.os.get(M)):A.Ur.getTargetData(C,k)}(l,g,$u(n)).next(y=>{if(y)return u=y.lastLimboFreeSnapshotVersion,l.Ur.getMatchingKeysForTargetId(g,y.targetId).next(x=>{p=x})}).next(()=>l.ss.getDocumentsMatchingQuery(g,n,i?u:In.min(),i?p:xr())).next(y=>(Pxe(l,Cbe(n),y),{documents:y,Ts:p})))}function Pxe(s,n,i){let l=s.us.get(n)||In.min();i.forEach((u,p)=>{p.readTime.compareTo(l)>0&&(l=p.readTime)}),s.us.set(n,l)}class $${constructor(){this.activeTargetIds=Dbe()}fs(n){this.activeTargetIds=this.activeTargetIds.add(n)}gs(n){this.activeTargetIds=this.activeTargetIds.delete(n)}Vs(){const n={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(n)}}class Lxe{constructor(){this.so=new $$,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(n){}updateMutationState(n,i,l){}addLocalQueryTarget(n,i=!0){return i&&this.so.fs(n),this.oo[n]||"not-current"}updateQueryState(n,i,l){this.oo[n]=i}removeLocalQueryTarget(n){this.so.gs(n)}isLocalQueryTarget(n){return this.so.activeTargetIds.has(n)}clearQueryState(n){delete this.oo[n]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(n){return this.so.activeTargetIds.has(n)}start(){return this.so=new $$,Promise.resolve()}handleUserChange(n,i,l){}setOnlineState(n){}shutdown(){}writeSequenceNumber(n){}notifyBundleLoaded(n){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jxe{_o(n){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J${constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(n){this.ho.push(n)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){$t("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const n of this.ho)n(0)}lo(){$t("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const n of this.ho)n(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let GA=null;function b4(){return GA===null?GA=function(){return 268435456+Math.round(2147483648*Math.random())}():GA++,"0x"+GA.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mxe={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uxe{constructor(n){this.Io=n.Io,this.To=n.To}Eo(n){this.Ao=n}Ro(n){this.Vo=n}mo(n){this.fo=n}onMessage(n){this.po=n}close(){this.To()}send(n){this.Io(n)}yo(){this.Ao()}wo(){this.Vo()}So(n){this.fo(n)}bo(n){this.po(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mo="WebChannelConnection";class Vxe extends class{constructor(i){this.databaseInfo=i,this.databaseId=i.databaseId;const l=i.ssl?"https":"http",u=encodeURIComponent(this.databaseId.projectId),p=encodeURIComponent(this.databaseId.database);this.Do=l+"://"+i.host,this.vo=`projects/${u}/databases/${p}`,this.Co=this.databaseId.database==="(default)"?`project_id=${u}`:`project_id=${u}&database_id=${p}`}get Fo(){return!1}Mo(i,l,u,p,g){const y=b4(),x=this.xo(i,l.toUriEncodedString());$t("RestConnection",`Sending RPC '${i}' ${y}:`,x,u);const C={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(C,p,g),this.No(i,x,C,u).then(k=>($t("RestConnection",`Received RPC '${i}' ${y}: `,k),k),k=>{throw oy("RestConnection",`RPC '${i}' ${y} failed with error: `,k,"url: ",x,"request:",u),k})}Lo(i,l,u,p,g,y){return this.Mo(i,l,u,p,g)}Oo(i,l,u){i["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+ky}(),i["Content-Type"]="text/plain",this.databaseInfo.appId&&(i["X-Firebase-GMPID"]=this.databaseInfo.appId),l&&l.headers.forEach((p,g)=>i[g]=p),u&&u.headers.forEach((p,g)=>i[g]=p)}xo(i,l){const u=Mxe[i];return`${this.Do}/v1/${l}:${u}`}terminate(){}}{constructor(n){super(n),this.forceLongPolling=n.forceLongPolling,this.autoDetectLongPolling=n.autoDetectLongPolling,this.useFetchStreams=n.useFetchStreams,this.longPollingOptions=n.longPollingOptions}No(n,i,l,u){const p=b4();return new Promise((g,y)=>{const x=new xte;x.setWithCredentials(!0),x.listenOnce(wte.COMPLETE,()=>{try{switch(x.getLastErrorCode()){case h1.NO_ERROR:const k=x.getResponseJson();$t(mo,`XHR for RPC '${n}' ${p} received:`,JSON.stringify(k)),g(k);break;case h1.TIMEOUT:$t(mo,`RPC '${n}' ${p} timed out`),y(new kt(st.DEADLINE_EXCEEDED,"Request time out"));break;case h1.HTTP_ERROR:const A=x.getStatus();if($t(mo,`RPC '${n}' ${p} failed with status:`,A,"response text:",x.getResponseText()),A>0){let M=x.getResponseJson();Array.isArray(M)&&(M=M[0]);const G=M==null?void 0:M.error;if(G&&G.status&&G.message){const B=function(Z){const q=Z.toLowerCase().replace(/_/g,"-");return Object.values(st).indexOf(q)>=0?q:st.UNKNOWN}(G.status);y(new kt(B,G.message))}else y(new kt(st.UNKNOWN,"Server responded with status "+x.getStatus()))}else y(new kt(st.UNAVAILABLE,"Connection failed."));break;default:Rn()}}finally{$t(mo,`RPC '${n}' ${p} completed.`)}});const C=JSON.stringify(u);$t(mo,`RPC '${n}' ${p} sending request:`,u),x.send(i,"POST",C,l,15)})}Bo(n,i,l){const u=b4(),p=[this.Do,"/","google.firestore.v1.Firestore","/",n,"/channel"],g=Rte(),y=Tte(),x={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},C=this.longPollingOptions.timeoutSeconds;C!==void 0&&(x.longPollingTimeout=Math.round(1e3*C)),this.useFetchStreams&&(x.useFetchStreams=!0),this.Oo(x.initMessageHeaders,i,l),x.encodeInitMessageHeaders=!0;const k=p.join("");$t(mo,`Creating RPC '${n}' stream ${u}: ${k}`,x);const A=g.createWebChannel(k,x);let M=!1,G=!1;const B=new Uxe({Io:Z=>{G?$t(mo,`Not sending because RPC '${n}' stream ${u} is closed:`,Z):(M||($t(mo,`Opening RPC '${n}' stream ${u} transport.`),A.open(),M=!0),$t(mo,`RPC '${n}' stream ${u} sending:`,Z),A.send(Z))},To:()=>A.close()}),X=(Z,q,V)=>{Z.listen(q,ee=>{try{V(ee)}catch(de){setTimeout(()=>{throw de},0)}})};return X(A,qw.EventType.OPEN,()=>{G||($t(mo,`RPC '${n}' stream ${u} transport opened.`),B.yo())}),X(A,qw.EventType.CLOSE,()=>{G||(G=!0,$t(mo,`RPC '${n}' stream ${u} transport closed`),B.So())}),X(A,qw.EventType.ERROR,Z=>{G||(G=!0,oy(mo,`RPC '${n}' stream ${u} transport errored:`,Z),B.So(new kt(st.UNAVAILABLE,"The operation could not be completed")))}),X(A,qw.EventType.MESSAGE,Z=>{var q;if(!G){const V=Z.data[0];Fr(!!V);const ee=V,de=ee.error||((q=ee[0])===null||q===void 0?void 0:q.error);if(de){$t(mo,`RPC '${n}' stream ${u} received error:`,de);const ae=de.status;let ye=function(se){const ce=Vi[se];if(ce!==void 0)return ene(ce)}(ae),Q=de.message;ye===void 0&&(ye=st.INTERNAL,Q="Unknown error status: "+ae+" with message "+de.message),G=!0,B.So(new kt(ye,Q)),A.close()}else $t(mo,`RPC '${n}' stream ${u} received:`,V),B.bo(V)}}),X(y,Ste.STAT_EVENT,Z=>{Z.stat===H5.PROXY?$t(mo,`RPC '${n}' stream ${u} detected buffering proxy`):Z.stat===H5.NOPROXY&&$t(mo,`RPC '${n}' stream ${u} detected no buffering proxy`)}),setTimeout(()=>{B.wo()},0),B}}function x4(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $k(s){return new Xbe(s,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eF{constructor(n,i,l=1e3,u=1.5,p=6e4){this.ui=n,this.timerId=i,this.ko=l,this.qo=u,this.Qo=p,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(n){this.cancel();const i=Math.floor(this.Ko+this.zo()),l=Math.max(0,Date.now()-this.Uo),u=Math.max(0,i-l);u>0&&$t("ExponentialBackoff",`Backing off for ${u} ms (base delay: ${this.Ko} ms, delay with jitter: ${i} ms, last attempt: ${l} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,u,()=>(this.Uo=Date.now(),n())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pne{constructor(n,i,l,u,p,g,y,x){this.ui=n,this.Ho=l,this.Jo=u,this.connection=p,this.authCredentialsProvider=g,this.appCheckCredentialsProvider=y,this.listener=x,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new eF(n,i)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(n){this.u_(),this.stream.send(n)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(n,i){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,n!==4?this.t_.reset():i&&i.code===st.RESOURCE_EXHAUSTED?(lp(i.toString()),lp("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):i&&i.code===st.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=n,await this.listener.mo(i)}l_(){}auth(){this.state=1;const n=this.h_(this.Yo),i=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([l,u])=>{this.Yo===i&&this.P_(l,u)},l=>{n(()=>{const u=new kt(st.UNKNOWN,"Fetching auth token failed: "+l.message);return this.I_(u)})})}P_(n,i){const l=this.h_(this.Yo);this.stream=this.T_(n,i),this.stream.Eo(()=>{l(()=>this.listener.Eo())}),this.stream.Ro(()=>{l(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(u=>{l(()=>this.I_(u))}),this.stream.onMessage(u=>{l(()=>++this.e_==1?this.E_(u):this.onNext(u))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(n){return $t("PersistentStream",`close with error: ${n}`),this.stream=null,this.close(4,n)}h_(n){return i=>{this.ui.enqueueAndForget(()=>this.Yo===n?i():($t("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Fxe extends pne{constructor(n,i,l,u,p,g){super(n,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,l,u,g),this.serializer=p}T_(n,i){return this.connection.Bo("Listen",n,i)}E_(n){return this.onNext(n)}onNext(n){this.t_.reset();const i=Zbe(this.serializer,n),l=function(p){if(!("targetChange"in p))return In.min();const g=p.targetChange;return g.targetIds&&g.targetIds.length?In.min():g.readTime?Yc(g.readTime):In.min()}(n);return this.listener.d_(i,l)}A_(n){const i={};i.database=Z5(this.serializer),i.addTarget=function(p,g){let y;const x=g.target;if(y=X5(x)?{documents:txe(p,x)}:{query:nxe(p,x)._t},y.targetId=g.targetId,g.resumeToken.approximateByteSize()>0){y.resumeToken=rne(p,g.resumeToken);const C=J5(p,g.expectedCount);C!==null&&(y.expectedCount=C)}else if(g.snapshotVersion.compareTo(In.min())>0){y.readTime=tk(p,g.snapshotVersion.toTimestamp());const C=J5(p,g.expectedCount);C!==null&&(y.expectedCount=C)}return y}(this.serializer,n);const l=sxe(this.serializer,n);l&&(i.labels=l),this.a_(i)}R_(n){const i={};i.database=Z5(this.serializer),i.removeTarget=n,this.a_(i)}}class Bxe extends pne{constructor(n,i,l,u,p,g){super(n,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,l,u,g),this.serializer=p}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(n,i){return this.connection.Bo("Write",n,i)}E_(n){return Fr(!!n.streamToken),this.lastStreamToken=n.streamToken,Fr(!n.writeResults||n.writeResults.length===0),this.listener.f_()}onNext(n){Fr(!!n.streamToken),this.lastStreamToken=n.streamToken,this.t_.reset();const i=exe(n.writeResults,n.commitTime),l=Yc(n.commitTime);return this.listener.g_(l,i)}p_(){const n={};n.database=Z5(this.serializer),this.a_(n)}m_(n){const i={streamToken:this.lastStreamToken,writes:n.map(l=>one(this.serializer,l))};this.a_(i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zxe extends class{}{constructor(n,i,l,u){super(),this.authCredentials=n,this.appCheckCredentials=i,this.connection=l,this.serializer=u,this.y_=!1}w_(){if(this.y_)throw new kt(st.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(n,i,l,u){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([p,g])=>this.connection.Mo(n,Q5(i,l),u,p,g)).catch(p=>{throw p.name==="FirebaseError"?(p.code===st.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),p):new kt(st.UNKNOWN,p.toString())})}Lo(n,i,l,u,p){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([g,y])=>this.connection.Lo(n,Q5(i,l),u,g,y,p)).catch(g=>{throw g.name==="FirebaseError"?(g.code===st.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),g):new kt(st.UNKNOWN,g.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class Gxe{constructor(n,i){this.asyncQueue=n,this.onlineStateHandler=i,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(n){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${n.toString()}`),this.C_("Offline")))}set(n){this.x_(),this.S_=0,n==="Online"&&(this.D_=!1),this.C_(n)}C_(n){n!==this.state&&(this.state=n,this.onlineStateHandler(n))}F_(n){const i=`Could not reach Cloud Firestore backend. ${n}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(lp(i),this.D_=!1):$t("OnlineStateTracker",i)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wxe{constructor(n,i,l,u,p){this.localStore=n,this.datastore=i,this.asyncQueue=l,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=p,this.k_._o(g=>{l.enqueueAndForget(async()=>{U_(this)&&($t("RemoteStore","Restarting streams for network reachability change."),await async function(x){const C=Ln(x);C.L_.add(4),await ET(C),C.q_.set("Unknown"),C.L_.delete(4),await Jk(C)}(this))})}),this.q_=new Gxe(l,u)}}async function Jk(s){if(U_(s))for(const n of s.B_)await n(!0)}async function ET(s){for(const n of s.B_)await n(!1)}function fne(s,n){const i=Ln(s);i.N_.has(n.targetId)||(i.N_.set(n.targetId,n),sF(i)?rF(i):Py(i).r_()&&nF(i,n))}function tF(s,n){const i=Ln(s),l=Py(i);i.N_.delete(n),l.r_()&&mne(i,n),i.N_.size===0&&(l.r_()?l.o_():U_(i)&&i.q_.set("Unknown"))}function nF(s,n){if(s.Q_.xe(n.targetId),n.resumeToken.approximateByteSize()>0||n.snapshotVersion.compareTo(In.min())>0){const i=s.remoteSyncer.getRemoteKeysForTarget(n.targetId).size;n=n.withExpectedCount(i)}Py(s).A_(n)}function mne(s,n){s.Q_.xe(n),Py(s).R_(n)}function rF(s){s.Q_=new Hbe({getRemoteKeysForTarget:n=>s.remoteSyncer.getRemoteKeysForTarget(n),ot:n=>s.N_.get(n)||null,tt:()=>s.datastore.serializer.databaseId}),Py(s).start(),s.q_.v_()}function sF(s){return U_(s)&&!Py(s).n_()&&s.N_.size>0}function U_(s){return Ln(s).L_.size===0}function gne(s){s.Q_=void 0}async function Hxe(s){s.q_.set("Online")}async function Kxe(s){s.N_.forEach((n,i)=>{nF(s,n)})}async function qxe(s,n){gne(s),sF(s)?(s.q_.M_(n),rF(s)):s.q_.set("Unknown")}async function Yxe(s,n,i){if(s.q_.set("Online"),n instanceof nne&&n.state===2&&n.cause)try{await async function(u,p){const g=p.cause;for(const y of p.targetIds)u.N_.has(y)&&(await u.remoteSyncer.rejectListen(y,g),u.N_.delete(y),u.Q_.removeTarget(y))}(s,n)}catch(l){$t("RemoteStore","Failed to remove targets %s: %s ",n.targetIds.join(","),l),await rk(s,l)}else if(n instanceof m1?s.Q_.Ke(n):n instanceof tne?s.Q_.He(n):s.Q_.We(n),!i.isEqual(In.min()))try{const l=await hne(s.localStore);i.compareTo(l)>=0&&await function(p,g){const y=p.Q_.rt(g);return y.targetChanges.forEach((x,C)=>{if(x.resumeToken.approximateByteSize()>0){const k=p.N_.get(C);k&&p.N_.set(C,k.withResumeToken(x.resumeToken,g))}}),y.targetMismatches.forEach((x,C)=>{const k=p.N_.get(x);if(!k)return;p.N_.set(x,k.withResumeToken(Qa.EMPTY_BYTE_STRING,k.snapshotVersion)),mne(p,x);const A=new Gf(k.target,x,C,k.sequenceNumber);nF(p,A)}),p.remoteSyncer.applyRemoteEvent(y)}(s,i)}catch(l){$t("RemoteStore","Failed to raise snapshot:",l),await rk(s,l)}}async function rk(s,n,i){if(!mT(n))throw n;s.L_.add(1),await ET(s),s.q_.set("Offline"),i||(i=()=>hne(s.localStore)),s.asyncQueue.enqueueRetryable(async()=>{$t("RemoteStore","Retrying IndexedDB access"),await i(),s.L_.delete(1),await Jk(s)})}function _ne(s,n){return n().catch(i=>rk(s,i,n))}async function Qk(s){const n=Ln(s),i=hm(n);let l=n.O_.length>0?n.O_[n.O_.length-1].batchId:-1;for(;Xxe(n);)try{const u=await Oxe(n.localStore,l);if(u===null){n.O_.length===0&&i.o_();break}l=u.batchId,$xe(n,u)}catch(u){await rk(n,u)}vne(n)&&Ene(n)}function Xxe(s){return U_(s)&&s.O_.length<10}function $xe(s,n){s.O_.push(n);const i=hm(s);i.r_()&&i.V_&&i.m_(n.mutations)}function vne(s){return U_(s)&&!hm(s).n_()&&s.O_.length>0}function Ene(s){hm(s).start()}async function Jxe(s){hm(s).p_()}async function Qxe(s){const n=hm(s);for(const i of s.O_)n.m_(i.mutations)}async function Zxe(s,n,i){const l=s.O_.shift(),u=Y3.from(l,n,i);await _ne(s,()=>s.remoteSyncer.applySuccessfulWrite(u)),await Qk(s)}async function ewe(s,n){n&&hm(s).V_&&await async function(l,u){if(function(g){return Zte(g)&&g!==st.ABORTED}(u.code)){const p=l.O_.shift();hm(l).s_(),await _ne(l,()=>l.remoteSyncer.rejectFailedWrite(p.batchId,u)),await Qk(l)}}(s,n),vne(s)&&Ene(s)}async function Q$(s,n){const i=Ln(s);i.asyncQueue.verifyOperationInProgress(),$t("RemoteStore","RemoteStore received new credentials");const l=U_(i);i.L_.add(3),await ET(i),l&&i.q_.set("Unknown"),await i.remoteSyncer.handleCredentialChange(n),i.L_.delete(3),await Jk(i)}async function twe(s,n){const i=Ln(s);n?(i.L_.delete(2),await Jk(i)):n||(i.L_.add(2),await ET(i),i.q_.set("Unknown"))}function Py(s){return s.K_||(s.K_=function(i,l,u){const p=Ln(i);return p.w_(),new Fxe(l,p.connection,p.authCredentials,p.appCheckCredentials,p.serializer,u)}(s.datastore,s.asyncQueue,{Eo:Hxe.bind(null,s),Ro:Kxe.bind(null,s),mo:qxe.bind(null,s),d_:Yxe.bind(null,s)}),s.B_.push(async n=>{n?(s.K_.s_(),sF(s)?rF(s):s.q_.set("Unknown")):(await s.K_.stop(),gne(s))})),s.K_}function hm(s){return s.U_||(s.U_=function(i,l,u){const p=Ln(i);return p.w_(),new Bxe(l,p.connection,p.authCredentials,p.appCheckCredentials,p.serializer,u)}(s.datastore,s.asyncQueue,{Eo:()=>Promise.resolve(),Ro:Jxe.bind(null,s),mo:ewe.bind(null,s),f_:Qxe.bind(null,s),g_:Zxe.bind(null,s)}),s.B_.push(async n=>{n?(s.U_.s_(),await Qk(s)):(await s.U_.stop(),s.O_.length>0&&($t("RemoteStore",`Stopping write stream with ${s.O_.length} pending writes`),s.O_=[]))})),s.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iF{constructor(n,i,l,u,p){this.asyncQueue=n,this.timerId=i,this.targetTimeMs=l,this.op=u,this.removalCallback=p,this.deferred=new Xu,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(g=>{})}get promise(){return this.deferred.promise}static createAndSchedule(n,i,l,u,p){const g=Date.now()+l,y=new iF(n,i,g,u,p);return y.start(l),y}start(n){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),n)}skipDelay(){return this.handleDelayElapsed()}cancel(n){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new kt(st.CANCELLED,"Operation cancelled"+(n?": "+n:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(n=>this.deferred.resolve(n))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function aF(s,n){if(lp("AsyncQueue",`${n}: ${s}`),mT(s))return new kt(st.UNAVAILABLE,`${n}: ${s}`);throw s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $E{constructor(n){this.comparator=n?(i,l)=>n(i,l)||on.comparator(i.key,l.key):(i,l)=>on.comparator(i.key,l.key),this.keyedMap=Yw(),this.sortedSet=new ui(this.comparator)}static emptySet(n){return new $E(n.comparator)}has(n){return this.keyedMap.get(n)!=null}get(n){return this.keyedMap.get(n)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(n){const i=this.keyedMap.get(n);return i?this.sortedSet.indexOf(i):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal((i,l)=>(n(i),!1))}add(n){const i=this.delete(n.key);return i.copy(i.keyedMap.insert(n.key,n),i.sortedSet.insert(n,null))}delete(n){const i=this.get(n);return i?this.copy(this.keyedMap.remove(n),this.sortedSet.remove(i)):this}isEqual(n){if(!(n instanceof $E)||this.size!==n.size)return!1;const i=this.sortedSet.getIterator(),l=n.sortedSet.getIterator();for(;i.hasNext();){const u=i.getNext().key,p=l.getNext().key;if(!u.isEqual(p))return!1}return!0}toString(){const n=[];return this.forEach(i=>{n.push(i.toString())}),n.length===0?"DocumentSet ()":`DocumentSet (
  `+n.join(`  
`)+`
)`}copy(n,i){const l=new $E;return l.comparator=this.comparator,l.keyedMap=n,l.sortedSet=i,l}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z${constructor(){this.W_=new ui(on.comparator)}track(n){const i=n.doc.key,l=this.W_.get(i);l?n.type!==0&&l.type===3?this.W_=this.W_.insert(i,n):n.type===3&&l.type!==1?this.W_=this.W_.insert(i,{type:l.type,doc:n.doc}):n.type===2&&l.type===2?this.W_=this.W_.insert(i,{type:2,doc:n.doc}):n.type===2&&l.type===0?this.W_=this.W_.insert(i,{type:0,doc:n.doc}):n.type===1&&l.type===0?this.W_=this.W_.remove(i):n.type===1&&l.type===2?this.W_=this.W_.insert(i,{type:1,doc:l.doc}):n.type===0&&l.type===1?this.W_=this.W_.insert(i,{type:2,doc:n.doc}):Rn():this.W_=this.W_.insert(i,n)}G_(){const n=[];return this.W_.inorderTraversal((i,l)=>{n.push(l)}),n}}class py{constructor(n,i,l,u,p,g,y,x,C){this.query=n,this.docs=i,this.oldDocs=l,this.docChanges=u,this.mutatedKeys=p,this.fromCache=g,this.syncStateChanged=y,this.excludesMetadataChanges=x,this.hasCachedResults=C}static fromInitialDocuments(n,i,l,u,p){const g=[];return i.forEach(y=>{g.push({type:0,doc:y})}),new py(n,i,$E.emptySet(i),g,l,u,!0,!1,p)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(n){if(!(this.fromCache===n.fromCache&&this.hasCachedResults===n.hasCachedResults&&this.syncStateChanged===n.syncStateChanged&&this.mutatedKeys.isEqual(n.mutatedKeys)&&Wk(this.query,n.query)&&this.docs.isEqual(n.docs)&&this.oldDocs.isEqual(n.oldDocs)))return!1;const i=this.docChanges,l=n.docChanges;if(i.length!==l.length)return!1;for(let u=0;u<i.length;u++)if(i[u].type!==l[u].type||!i[u].doc.isEqual(l[u].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nwe{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(n=>n.J_())}}class rwe{constructor(){this.queries=eJ(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(i,l){const u=Ln(i),p=u.queries;u.queries=eJ(),p.forEach((g,y)=>{for(const x of y.j_)x.onError(l)})})(this,new kt(st.ABORTED,"Firestore shutting down"))}}function eJ(){return new Dy(s=>Vte(s),Wk)}async function oF(s,n){const i=Ln(s);let l=3;const u=n.query;let p=i.queries.get(u);p?!p.H_()&&n.J_()&&(l=2):(p=new nwe,l=n.J_()?0:1);try{switch(l){case 0:p.z_=await i.onListen(u,!0);break;case 1:p.z_=await i.onListen(u,!1);break;case 2:await i.onFirstRemoteStoreListen(u)}}catch(g){const y=aF(g,`Initialization of query '${xE(n.query)}' failed`);return void n.onError(y)}i.queries.set(u,p),p.j_.push(n),n.Z_(i.onlineState),p.z_&&n.X_(p.z_)&&lF(i)}async function cF(s,n){const i=Ln(s),l=n.query;let u=3;const p=i.queries.get(l);if(p){const g=p.j_.indexOf(n);g>=0&&(p.j_.splice(g,1),p.j_.length===0?u=n.J_()?0:1:!p.H_()&&n.J_()&&(u=2))}switch(u){case 0:return i.queries.delete(l),i.onUnlisten(l,!0);case 1:return i.queries.delete(l),i.onUnlisten(l,!1);case 2:return i.onLastRemoteStoreUnlisten(l);default:return}}function swe(s,n){const i=Ln(s);let l=!1;for(const u of n){const p=u.query,g=i.queries.get(p);if(g){for(const y of g.j_)y.X_(u)&&(l=!0);g.z_=u}}l&&lF(i)}function iwe(s,n,i){const l=Ln(s),u=l.queries.get(n);if(u)for(const p of u.j_)p.onError(i);l.queries.delete(n)}function lF(s){s.Y_.forEach(n=>{n.next()})}var tV,tJ;(tJ=tV||(tV={})).ea="default",tJ.Cache="cache";class dF{constructor(n,i,l){this.query=n,this.ta=i,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=l||{}}X_(n){if(!this.options.includeMetadataChanges){const l=[];for(const u of n.docChanges)u.type!==3&&l.push(u);n=new py(n.query,n.docs,n.oldDocs,l,n.mutatedKeys,n.fromCache,n.syncStateChanged,!0,n.hasCachedResults)}let i=!1;return this.na?this.ia(n)&&(this.ta.next(n),i=!0):this.sa(n,this.onlineState)&&(this.oa(n),i=!0),this.ra=n,i}onError(n){this.ta.error(n)}Z_(n){this.onlineState=n;let i=!1;return this.ra&&!this.na&&this.sa(this.ra,n)&&(this.oa(this.ra),i=!0),i}sa(n,i){if(!n.fromCache||!this.J_())return!0;const l=i!=="Offline";return(!this.options._a||!l)&&(!n.docs.isEmpty()||n.hasCachedResults||i==="Offline")}ia(n){if(n.docChanges.length>0)return!0;const i=this.ra&&this.ra.hasPendingWrites!==n.hasPendingWrites;return!(!n.syncStateChanged&&!i)&&this.options.includeMetadataChanges===!0}oa(n){n=py.fromInitialDocuments(n.query,n.docs,n.mutatedKeys,n.fromCache,n.hasCachedResults),this.na=!0,this.ta.next(n)}J_(){return this.options.source!==tV.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yne{constructor(n){this.key=n}}class bne{constructor(n){this.key=n}}class awe{constructor(n,i){this.query=n,this.Ta=i,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=xr(),this.mutatedKeys=xr(),this.Aa=Fte(n),this.Ra=new $E(this.Aa)}get Va(){return this.Ta}ma(n,i){const l=i?i.fa:new Z$,u=i?i.Ra:this.Ra;let p=i?i.mutatedKeys:this.mutatedKeys,g=u,y=!1;const x=this.query.limitType==="F"&&u.size===this.query.limit?u.last():null,C=this.query.limitType==="L"&&u.size===this.query.limit?u.first():null;if(n.inorderTraversal((k,A)=>{const M=u.get(k),G=Hk(this.query,A)?A:null,B=!!M&&this.mutatedKeys.has(M.key),X=!!G&&(G.hasLocalMutations||this.mutatedKeys.has(G.key)&&G.hasCommittedMutations);let Z=!1;M&&G?M.data.isEqual(G.data)?B!==X&&(l.track({type:3,doc:G}),Z=!0):this.ga(M,G)||(l.track({type:2,doc:G}),Z=!0,(x&&this.Aa(G,x)>0||C&&this.Aa(G,C)<0)&&(y=!0)):!M&&G?(l.track({type:0,doc:G}),Z=!0):M&&!G&&(l.track({type:1,doc:M}),Z=!0,(x||C)&&(y=!0)),Z&&(G?(g=g.add(G),p=X?p.add(k):p.delete(k)):(g=g.delete(k),p=p.delete(k)))}),this.query.limit!==null)for(;g.size>this.query.limit;){const k=this.query.limitType==="F"?g.last():g.first();g=g.delete(k.key),p=p.delete(k.key),l.track({type:1,doc:k})}return{Ra:g,fa:l,ns:y,mutatedKeys:p}}ga(n,i){return n.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations}applyChanges(n,i,l,u){const p=this.Ra;this.Ra=n.Ra,this.mutatedKeys=n.mutatedKeys;const g=n.fa.G_();g.sort((k,A)=>function(G,B){const X=Z=>{switch(Z){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Rn()}};return X(G)-X(B)}(k.type,A.type)||this.Aa(k.doc,A.doc)),this.pa(l),u=u!=null&&u;const y=i&&!u?this.ya():[],x=this.da.size===0&&this.current&&!u?1:0,C=x!==this.Ea;return this.Ea=x,g.length!==0||C?{snapshot:new py(this.query,n.Ra,p,g,n.mutatedKeys,x===0,C,!1,!!l&&l.resumeToken.approximateByteSize()>0),wa:y}:{wa:y}}Z_(n){return this.current&&n==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Z$,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(n){return!this.Ta.has(n)&&!!this.Ra.has(n)&&!this.Ra.get(n).hasLocalMutations}pa(n){n&&(n.addedDocuments.forEach(i=>this.Ta=this.Ta.add(i)),n.modifiedDocuments.forEach(i=>{}),n.removedDocuments.forEach(i=>this.Ta=this.Ta.delete(i)),this.current=n.current)}ya(){if(!this.current)return[];const n=this.da;this.da=xr(),this.Ra.forEach(l=>{this.Sa(l.key)&&(this.da=this.da.add(l.key))});const i=[];return n.forEach(l=>{this.da.has(l)||i.push(new bne(l))}),this.da.forEach(l=>{n.has(l)||i.push(new yne(l))}),i}ba(n){this.Ta=n.Ts,this.da=xr();const i=this.ma(n.documents);return this.applyChanges(i,!0)}Da(){return py.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class owe{constructor(n,i,l){this.query=n,this.targetId=i,this.view=l}}class cwe{constructor(n){this.key=n,this.va=!1}}class lwe{constructor(n,i,l,u,p,g){this.localStore=n,this.remoteStore=i,this.eventManager=l,this.sharedClientState=u,this.currentUser=p,this.maxConcurrentLimboResolutions=g,this.Ca={},this.Fa=new Dy(y=>Vte(y),Wk),this.Ma=new Map,this.xa=new Set,this.Oa=new ui(on.comparator),this.Na=new Map,this.La=new J3,this.Ba={},this.ka=new Map,this.qa=hy.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function dwe(s,n,i=!0){const l=Cne(s);let u;const p=l.Fa.get(n);return p?(l.sharedClientState.addLocalQueryTarget(p.targetId),u=p.view.Da()):u=await xne(l,n,i,!0),u}async function uwe(s,n){const i=Cne(s);await xne(i,n,!0,!1)}async function xne(s,n,i,l){const u=await Dxe(s.localStore,$u(n)),p=u.targetId,g=s.sharedClientState.addLocalQueryTarget(p,i);let y;return l&&(y=await hwe(s,n,p,g==="current",u.resumeToken)),s.isPrimaryClient&&i&&fne(s.remoteStore,u),y}async function hwe(s,n,i,l,u){s.Ka=(A,M,G)=>async function(X,Z,q,V){let ee=Z.view.ma(q);ee.ns&&(ee=await X$(X.localStore,Z.query,!1).then(({documents:Q})=>Z.view.ma(Q,ee)));const de=V&&V.targetChanges.get(Z.targetId),ae=V&&V.targetMismatches.get(Z.targetId)!=null,ye=Z.view.applyChanges(ee,X.isPrimaryClient,de,ae);return rJ(X,Z.targetId,ye.wa),ye.snapshot}(s,A,M,G);const p=await X$(s.localStore,n,!0),g=new awe(n,p.Ts),y=g.ma(p.documents),x=vT.createSynthesizedTargetChangeForCurrentChange(i,l&&s.onlineState!=="Offline",u),C=g.applyChanges(y,s.isPrimaryClient,x);rJ(s,i,C.wa);const k=new owe(n,i,g);return s.Fa.set(n,k),s.Ma.has(i)?s.Ma.get(i).push(n):s.Ma.set(i,[n]),C.snapshot}async function pwe(s,n,i){const l=Ln(s),u=l.Fa.get(n),p=l.Ma.get(u.targetId);if(p.length>1)return l.Ma.set(u.targetId,p.filter(g=>!Wk(g,n))),void l.Fa.delete(n);l.isPrimaryClient?(l.sharedClientState.removeLocalQueryTarget(u.targetId),l.sharedClientState.isActiveQueryTarget(u.targetId)||await eV(l.localStore,u.targetId,!1).then(()=>{l.sharedClientState.clearQueryState(u.targetId),i&&tF(l.remoteStore,u.targetId),nV(l,u.targetId)}).catch(fT)):(nV(l,u.targetId),await eV(l.localStore,u.targetId,!0))}async function fwe(s,n){const i=Ln(s),l=i.Fa.get(n),u=i.Ma.get(l.targetId);i.isPrimaryClient&&u.length===1&&(i.sharedClientState.removeLocalQueryTarget(l.targetId),tF(i.remoteStore,l.targetId))}async function mwe(s,n,i){const l=xwe(s);try{const u=await function(g,y){const x=Ln(g),C=cn.now(),k=y.reduce((G,B)=>G.add(B.key),xr());let A,M;return x.persistence.runTransaction("Locally write mutations","readwrite",G=>{let B=dp(),X=xr();return x.cs.getEntries(G,k).next(Z=>{B=Z,B.forEach((q,V)=>{V.isValidDocument()||(X=X.add(q))})}).next(()=>x.localDocuments.getOverlayedDocuments(G,B)).next(Z=>{A=Z;const q=[];for(const V of y){const ee=Vbe(V,A.get(V.key).overlayedDocument);ee!=null&&q.push(new gm(V.key,ee,kte(ee.value.mapValue),Ka.exists(!0)))}return x.mutationQueue.addMutationBatch(G,C,q,y)}).next(Z=>{M=Z;const q=Z.applyToLocalDocumentSet(A,X);return x.documentOverlayCache.saveOverlays(G,Z.batchId,q)})}).then(()=>({batchId:M.batchId,changes:zte(A)}))}(l.localStore,n);l.sharedClientState.addPendingMutation(u.batchId),function(g,y,x){let C=g.Ba[g.currentUser.toKey()];C||(C=new ui($r)),C=C.insert(y,x),g.Ba[g.currentUser.toKey()]=C}(l,u.batchId,i),await yT(l,u.changes),await Qk(l.remoteStore)}catch(u){const p=aF(u,"Failed to persist write");i.reject(p)}}async function wne(s,n){const i=Ln(s);try{const l=await Axe(i.localStore,n);n.targetChanges.forEach((u,p)=>{const g=i.Na.get(p);g&&(Fr(u.addedDocuments.size+u.modifiedDocuments.size+u.removedDocuments.size<=1),u.addedDocuments.size>0?g.va=!0:u.modifiedDocuments.size>0?Fr(g.va):u.removedDocuments.size>0&&(Fr(g.va),g.va=!1))}),await yT(i,l,n)}catch(l){await fT(l)}}function nJ(s,n,i){const l=Ln(s);if(l.isPrimaryClient&&i===0||!l.isPrimaryClient&&i===1){const u=[];l.Fa.forEach((p,g)=>{const y=g.view.Z_(n);y.snapshot&&u.push(y.snapshot)}),function(g,y){const x=Ln(g);x.onlineState=y;let C=!1;x.queries.forEach((k,A)=>{for(const M of A.j_)M.Z_(y)&&(C=!0)}),C&&lF(x)}(l.eventManager,n),u.length&&l.Ca.d_(u),l.onlineState=n,l.isPrimaryClient&&l.sharedClientState.setOnlineState(n)}}async function gwe(s,n,i){const l=Ln(s);l.sharedClientState.updateQueryState(n,"rejected",i);const u=l.Na.get(n),p=u&&u.key;if(p){let g=new ui(on.comparator);g=g.insert(p,xa.newNoDocument(p,In.min()));const y=xr().add(p),x=new Xk(In.min(),new Map,new ui($r),g,y);await wne(l,x),l.Oa=l.Oa.remove(p),l.Na.delete(n),uF(l)}else await eV(l.localStore,n,!1).then(()=>nV(l,n,i)).catch(fT)}async function _we(s,n){const i=Ln(s),l=n.batch.batchId;try{const u=await Ixe(i.localStore,n);Tne(i,l,null),Sne(i,l),i.sharedClientState.updateMutationState(l,"acknowledged"),await yT(i,u)}catch(u){await fT(u)}}async function vwe(s,n,i){const l=Ln(s);try{const u=await function(g,y){const x=Ln(g);return x.persistence.runTransaction("Reject batch","readwrite-primary",C=>{let k;return x.mutationQueue.lookupMutationBatch(C,y).next(A=>(Fr(A!==null),k=A.keys(),x.mutationQueue.removeMutationBatch(C,A))).next(()=>x.mutationQueue.performConsistencyCheck(C)).next(()=>x.documentOverlayCache.removeOverlaysForBatchId(C,k,y)).next(()=>x.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(C,k)).next(()=>x.localDocuments.getDocuments(C,k))})}(l.localStore,n);Tne(l,n,i),Sne(l,n),l.sharedClientState.updateMutationState(n,"rejected",i),await yT(l,u)}catch(u){await fT(u)}}function Sne(s,n){(s.ka.get(n)||[]).forEach(i=>{i.resolve()}),s.ka.delete(n)}function Tne(s,n,i){const l=Ln(s);let u=l.Ba[l.currentUser.toKey()];if(u){const p=u.get(n);p&&(i?p.reject(i):p.resolve(),u=u.remove(n)),l.Ba[l.currentUser.toKey()]=u}}function nV(s,n,i=null){s.sharedClientState.removeLocalQueryTarget(n);for(const l of s.Ma.get(n))s.Fa.delete(l),i&&s.Ca.$a(l,i);s.Ma.delete(n),s.isPrimaryClient&&s.La.gr(n).forEach(l=>{s.La.containsKey(l)||Rne(s,l)})}function Rne(s,n){s.xa.delete(n.path.canonicalString());const i=s.Oa.get(n);i!==null&&(tF(s.remoteStore,i),s.Oa=s.Oa.remove(n),s.Na.delete(i),uF(s))}function rJ(s,n,i){for(const l of i)l instanceof yne?(s.La.addReference(l.key,n),Ewe(s,l)):l instanceof bne?($t("SyncEngine","Document no longer in limbo: "+l.key),s.La.removeReference(l.key,n),s.La.containsKey(l.key)||Rne(s,l.key)):Rn()}function Ewe(s,n){const i=n.key,l=i.path.canonicalString();s.Oa.get(i)||s.xa.has(l)||($t("SyncEngine","New document in limbo: "+i),s.xa.add(l),uF(s))}function uF(s){for(;s.xa.size>0&&s.Oa.size<s.maxConcurrentLimboResolutions;){const n=s.xa.values().next().value;s.xa.delete(n);const i=new on(Ts.fromString(n)),l=s.qa.next();s.Na.set(l,new cwe(i)),s.Oa=s.Oa.insert(i,l),fne(s.remoteStore,new Gf($u(Gk(i.path)),l,"TargetPurposeLimboResolution",F3.oe))}}async function yT(s,n,i){const l=Ln(s),u=[],p=[],g=[];l.Fa.isEmpty()||(l.Fa.forEach((y,x)=>{g.push(l.Ka(x,n,i).then(C=>{var k;if((C||i)&&l.isPrimaryClient){const A=C?!C.fromCache:(k=i==null?void 0:i.targetChanges.get(x.targetId))===null||k===void 0?void 0:k.current;l.sharedClientState.updateQueryState(x.targetId,A?"current":"not-current")}if(C){u.push(C);const A=Z3.Wi(x.targetId,C);p.push(A)}}))}),await Promise.all(g),l.Ca.d_(u),await async function(x,C){const k=Ln(x);try{await k.persistence.runTransaction("notifyLocalViewChanges","readwrite",A=>ht.forEach(C,M=>ht.forEach(M.$i,G=>k.persistence.referenceDelegate.addReference(A,M.targetId,G)).next(()=>ht.forEach(M.Ui,G=>k.persistence.referenceDelegate.removeReference(A,M.targetId,G)))))}catch(A){if(!mT(A))throw A;$t("LocalStore","Failed to update sequence numbers: "+A)}for(const A of C){const M=A.targetId;if(!A.fromCache){const G=k.os.get(M),B=G.snapshotVersion,X=G.withLastLimboFreeSnapshotVersion(B);k.os=k.os.insert(M,X)}}}(l.localStore,p))}async function ywe(s,n){const i=Ln(s);if(!i.currentUser.isEqual(n)){$t("SyncEngine","User change. New user:",n.toKey());const l=await une(i.localStore,n);i.currentUser=n,function(p,g){p.ka.forEach(y=>{y.forEach(x=>{x.reject(new kt(st.CANCELLED,g))})}),p.ka.clear()}(i,"'waitForPendingWrites' promise is rejected due to a user change."),i.sharedClientState.handleUserChange(n,l.removedBatchIds,l.addedBatchIds),await yT(i,l.hs)}}function bwe(s,n){const i=Ln(s),l=i.Na.get(n);if(l&&l.va)return xr().add(l.key);{let u=xr();const p=i.Ma.get(n);if(!p)return u;for(const g of p){const y=i.Fa.get(g);u=u.unionWith(y.view.Va)}return u}}function Cne(s){const n=Ln(s);return n.remoteStore.remoteSyncer.applyRemoteEvent=wne.bind(null,n),n.remoteStore.remoteSyncer.getRemoteKeysForTarget=bwe.bind(null,n),n.remoteStore.remoteSyncer.rejectListen=gwe.bind(null,n),n.Ca.d_=swe.bind(null,n.eventManager),n.Ca.$a=iwe.bind(null,n.eventManager),n}function xwe(s){const n=Ln(s);return n.remoteStore.remoteSyncer.applySuccessfulWrite=_we.bind(null,n),n.remoteStore.remoteSyncer.rejectFailedWrite=vwe.bind(null,n),n}class sk{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(n){this.serializer=$k(n.databaseInfo.databaseId),this.sharedClientState=this.Wa(n),this.persistence=this.Ga(n),await this.persistence.start(),this.localStore=this.za(n),this.gcScheduler=this.ja(n,this.localStore),this.indexBackfillerScheduler=this.Ha(n,this.localStore)}ja(n,i){return null}Ha(n,i){return null}za(n){return Nxe(this.persistence,new Rxe,n.initialUser,this.serializer)}Ga(n){return new wxe(Q3.Zr,this.serializer)}Wa(n){return new Lxe}async terminate(){var n,i;(n=this.gcScheduler)===null||n===void 0||n.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}sk.provider={build:()=>new sk};class rV{async initialize(n,i){this.localStore||(this.localStore=n.localStore,this.sharedClientState=n.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!n.synchronizeTabs),this.sharedClientState.onlineStateHandler=l=>nJ(this.syncEngine,l,1),this.remoteStore.remoteSyncer.handleCredentialChange=ywe.bind(null,this.syncEngine),await twe(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(n){return function(){return new rwe}()}createDatastore(n){const i=$k(n.databaseInfo.databaseId),l=function(p){return new Vxe(p)}(n.databaseInfo);return function(p,g,y,x){return new zxe(p,g,y,x)}(n.authCredentials,n.appCheckCredentials,l,i)}createRemoteStore(n){return function(l,u,p,g,y){return new Wxe(l,u,p,g,y)}(this.localStore,this.datastore,n.asyncQueue,i=>nJ(this.syncEngine,i,0),function(){return J$.D()?new J$:new jxe}())}createSyncEngine(n,i){return function(u,p,g,y,x,C,k){const A=new lwe(u,p,g,y,x,C);return k&&(A.Qa=!0),A}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,n.initialUser,n.maxConcurrentLimboResolutions,i)}async terminate(){var n,i;await async function(u){const p=Ln(u);$t("RemoteStore","RemoteStore shutting down."),p.L_.add(5),await ET(p),p.k_.shutdown(),p.q_.set("Unknown")}(this.remoteStore),(n=this.datastore)===null||n===void 0||n.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()}}rV.provider={build:()=>new rV};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hF{constructor(n){this.observer=n,this.muted=!1}next(n){this.muted||this.observer.next&&this.Ya(this.observer.next,n)}error(n){this.muted||(this.observer.error?this.Ya(this.observer.error,n):lp("Uncaught Error in snapshot listener:",n.toString()))}Za(){this.muted=!0}Ya(n,i){setTimeout(()=>{this.muted||n(i)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wwe{constructor(n){this.datastore=n,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(n){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new kt(st.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const i=await async function(u,p){const g=Ln(u),y={documents:p.map(A=>nk(g.serializer,A))},x=await g.Lo("BatchGetDocuments",g.serializer.databaseId,Ts.emptyPath(),y,p.length),C=new Map;x.forEach(A=>{const M=Qbe(g.serializer,A);C.set(M.key.toString(),M)});const k=[];return p.forEach(A=>{const M=C.get(A.toString());Fr(!!M),k.push(M)}),k}(this.datastore,n);return i.forEach(l=>this.recordVersion(l)),i}set(n,i){this.write(i.toMutation(n,this.precondition(n))),this.writtenDocs.add(n.toString())}update(n,i){try{this.write(i.toMutation(n,this.preconditionForUpdate(n)))}catch(l){this.lastTransactionError=l}this.writtenDocs.add(n.toString())}delete(n){this.write(new Yk(n,this.precondition(n))),this.writtenDocs.add(n.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const n=this.readVersions;this.mutations.forEach(i=>{n.delete(i.key.toString())}),n.forEach((i,l)=>{const u=on.fromPath(l);this.mutations.push(new Qte(u,this.precondition(u)))}),await async function(l,u){const p=Ln(l),g={writes:u.map(y=>one(p.serializer,y))};await p.Mo("Commit",p.serializer.databaseId,Ts.emptyPath(),g)}(this.datastore,this.mutations),this.committed=!0}recordVersion(n){let i;if(n.isFoundDocument())i=n.version;else{if(!n.isNoDocument())throw Rn();i=In.min()}const l=this.readVersions.get(n.key.toString());if(l){if(!i.isEqual(l))throw new kt(st.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(n.key.toString(),i)}precondition(n){const i=this.readVersions.get(n.toString());return!this.writtenDocs.has(n.toString())&&i?i.isEqual(In.min())?Ka.exists(!1):Ka.updateTime(i):Ka.none()}preconditionForUpdate(n){const i=this.readVersions.get(n.toString());if(!this.writtenDocs.has(n.toString())&&i){if(i.isEqual(In.min()))throw new kt(st.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ka.updateTime(i)}return Ka.exists(!0)}write(n){this.ensureCommitNotCalled(),this.mutations.push(n)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Swe{constructor(n,i,l,u,p){this.asyncQueue=n,this.datastore=i,this.options=l,this.updateFunction=u,this.deferred=p,this._u=l.maxAttempts,this.t_=new eF(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const n=new wwe(this.datastore),i=this.cu(n);i&&i.then(l=>{this.asyncQueue.enqueueAndForget(()=>n.commit().then(()=>{this.deferred.resolve(l)}).catch(u=>{this.lu(u)}))}).catch(l=>{this.lu(l)})})}cu(n){try{const i=this.updateFunction(n);return!gT(i)&&i.catch&&i.then?i:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(i){return this.deferred.reject(i),null}}lu(n){this._u>0&&this.hu(n)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(n)}hu(n){if(n.name==="FirebaseError"){const i=n.code;return i==="aborted"||i==="failed-precondition"||i==="already-exists"||!Zte(i)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Twe{constructor(n,i,l,u,p){this.authCredentials=n,this.appCheckCredentials=i,this.asyncQueue=l,this.databaseInfo=u,this.user=go.UNAUTHENTICATED,this.clientId=Nte.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=p,this.authCredentials.start(l,async g=>{$t("FirestoreClient","Received user=",g.uid),await this.authCredentialListener(g),this.user=g}),this.appCheckCredentials.start(l,g=>($t("FirestoreClient","Received new app check token=",g),this.appCheckCredentialListener(g,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(n){this.authCredentialListener=n}setAppCheckTokenChangeListener(n){this.appCheckCredentialListener=n}terminate(){this.asyncQueue.enterRestrictedMode();const n=new Xu;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),n.resolve()}catch(i){const l=aF(i,"Failed to shutdown persistence");n.reject(l)}}),n.promise}}async function w4(s,n){s.asyncQueue.verifyOperationInProgress(),$t("FirestoreClient","Initializing OfflineComponentProvider");const i=s.configuration;await n.initialize(i);let l=i.initialUser;s.setCredentialChangeListener(async u=>{l.isEqual(u)||(await une(n.localStore,u),l=u)}),n.persistence.setDatabaseDeletedListener(()=>s.terminate()),s._offlineComponents=n}async function sJ(s,n){s.asyncQueue.verifyOperationInProgress();const i=await Rwe(s);$t("FirestoreClient","Initializing OnlineComponentProvider"),await n.initialize(i,s.configuration),s.setCredentialChangeListener(l=>Q$(n.remoteStore,l)),s.setAppCheckTokenChangeListener((l,u)=>Q$(n.remoteStore,u)),s._onlineComponents=n}async function Rwe(s){if(!s._offlineComponents)if(s._uninitializedComponentsProvider){$t("FirestoreClient","Using user provided OfflineComponentProvider");try{await w4(s,s._uninitializedComponentsProvider._offline)}catch(n){const i=n;if(!function(u){return u.name==="FirebaseError"?u.code===st.FAILED_PRECONDITION||u.code===st.UNIMPLEMENTED:!(typeof DOMException<"u"&&u instanceof DOMException)||u.code===22||u.code===20||u.code===11}(i))throw i;oy("Error using user provided cache. Falling back to memory cache: "+i),await w4(s,new sk)}}else $t("FirestoreClient","Using default OfflineComponentProvider"),await w4(s,new sk);return s._offlineComponents}async function pF(s){return s._onlineComponents||(s._uninitializedComponentsProvider?($t("FirestoreClient","Using user provided OnlineComponentProvider"),await sJ(s,s._uninitializedComponentsProvider._online)):($t("FirestoreClient","Using default OnlineComponentProvider"),await sJ(s,new rV))),s._onlineComponents}function Cwe(s){return pF(s).then(n=>n.syncEngine)}function Nwe(s){return pF(s).then(n=>n.datastore)}async function ik(s){const n=await pF(s),i=n.eventManager;return i.onListen=dwe.bind(null,n.syncEngine),i.onUnlisten=pwe.bind(null,n.syncEngine),i.onFirstRemoteStoreListen=uwe.bind(null,n.syncEngine),i.onLastRemoteStoreUnlisten=fwe.bind(null,n.syncEngine),i}function Iwe(s,n,i={}){const l=new Xu;return s.asyncQueue.enqueueAndForget(async()=>function(p,g,y,x,C){const k=new hF({next:M=>{k.Za(),g.enqueueAndForget(()=>cF(p,A));const G=M.docs.has(y);!G&&M.fromCache?C.reject(new kt(st.UNAVAILABLE,"Failed to get document because the client is offline.")):G&&M.fromCache&&x&&x.source==="server"?C.reject(new kt(st.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):C.resolve(M)},error:M=>C.reject(M)}),A=new dF(Gk(y.path),k,{includeMetadataChanges:!0,_a:!0});return oF(p,A)}(await ik(s),s.asyncQueue,n,i,l)),l.promise}function Awe(s,n,i={}){const l=new Xu;return s.asyncQueue.enqueueAndForget(async()=>function(p,g,y,x,C){const k=new hF({next:M=>{k.Za(),g.enqueueAndForget(()=>cF(p,A)),M.fromCache&&x.source==="server"?C.reject(new kt(st.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):C.resolve(M)},error:M=>C.reject(M)}),A=new dF(y,k,{includeMetadataChanges:!0,_a:!0});return oF(p,A)}(await ik(s),s.asyncQueue,n,i,l)),l.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nne(s){const n={};return s.timeoutSeconds!==void 0&&(n.timeoutSeconds=s.timeoutSeconds),n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iJ=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ine(s,n,i){if(!i)throw new kt(st.INVALID_ARGUMENT,`Function ${s}() cannot be called with an empty ${n}.`)}function kwe(s,n,i,l){if(n===!0&&l===!0)throw new kt(st.INVALID_ARGUMENT,`${s} and ${i} cannot be used together.`)}function aJ(s){if(!on.isDocumentKey(s))throw new kt(st.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${s} has ${s.length}.`)}function oJ(s){if(on.isDocumentKey(s))throw new kt(st.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${s} has ${s.length}.`)}function Zk(s){if(s===void 0)return"undefined";if(s===null)return"null";if(typeof s=="string")return s.length>20&&(s=`${s.substring(0,20)}...`),JSON.stringify(s);if(typeof s=="number"||typeof s=="boolean")return""+s;if(typeof s=="object"){if(s instanceof Array)return"an array";{const n=function(l){return l.constructor?l.constructor.name:null}(s);return n?`a custom ${n} object`:"an object"}}return typeof s=="function"?"a function":Rn()}function Fo(s,n){if("_delegate"in s&&(s=s._delegate),!(s instanceof n)){if(n.name===s.constructor.name)throw new kt(st.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=Zk(s);throw new kt(st.INVALID_ARGUMENT,`Expected type '${n.name}', but it was: ${i}`)}}return s}function Owe(s,n){if(n<=0)throw new kt(st.INVALID_ARGUMENT,`Function ${s}() requires a positive number, but it was: ${n}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cJ{constructor(n){var i,l;if(n.host===void 0){if(n.ssl!==void 0)throw new kt(st.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=n.host,this.ssl=(i=n.ssl)===null||i===void 0||i;if(this.credentials=n.credentials,this.ignoreUndefinedProperties=!!n.ignoreUndefinedProperties,this.localCache=n.localCache,n.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(n.cacheSizeBytes!==-1&&n.cacheSizeBytes<1048576)throw new kt(st.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=n.cacheSizeBytes}kwe("experimentalForceLongPolling",n.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",n.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!n.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:n.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!n.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Nne((l=n.experimentalLongPollingOptions)!==null&&l!==void 0?l:{}),function(p){if(p.timeoutSeconds!==void 0){if(isNaN(p.timeoutSeconds))throw new kt(st.INVALID_ARGUMENT,`invalid long polling timeout: ${p.timeoutSeconds} (must not be NaN)`);if(p.timeoutSeconds<5)throw new kt(st.INVALID_ARGUMENT,`invalid long polling timeout: ${p.timeoutSeconds} (minimum allowed value is 5)`);if(p.timeoutSeconds>30)throw new kt(st.INVALID_ARGUMENT,`invalid long polling timeout: ${p.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!n.useFetchStreams}isEqual(n){return this.host===n.host&&this.ssl===n.ssl&&this.credentials===n.credentials&&this.cacheSizeBytes===n.cacheSizeBytes&&this.experimentalForceLongPolling===n.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===n.experimentalAutoDetectLongPolling&&function(l,u){return l.timeoutSeconds===u.timeoutSeconds}(this.experimentalLongPollingOptions,n.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===n.ignoreUndefinedProperties&&this.useFetchStreams===n.useFetchStreams}}class eO{constructor(n,i,l,u){this._authCredentials=n,this._appCheckCredentials=i,this._databaseId=l,this._app=u,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new cJ({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new kt(st.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(n){if(this._settingsFrozen)throw new kt(st.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new cJ(n),n.credentials!==void 0&&(this._authCredentials=function(l){if(!l)return new Xye;switch(l.type){case"firstParty":return new Zye(l.sessionIndex||"0",l.iamToken||null,l.authTokenFactory||null);case"provider":return l.client;default:throw new kt(st.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(n.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(i){const l=iJ.get(i);l&&($t("ComponentProvider","Removing Datastore"),iJ.delete(i),l.terminate())}(this),Promise.resolve()}}function Dwe(s,n,i,l={}){var u;const p=(s=Fo(s,eO))._getSettings(),g=`${n}:${i}`;if(p.host!=="firestore.googleapis.com"&&p.host!==g&&oy("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),s._setSettings(Object.assign(Object.assign({},p),{host:g,ssl:!1})),l.mockUserToken){let y,x;if(typeof l.mockUserToken=="string")y=l.mockUserToken,x=go.MOCK_USER;else{y=kee(l.mockUserToken,(u=s._app)===null||u===void 0?void 0:u.options.projectId);const C=l.mockUserToken.sub||l.mockUserToken.user_id;if(!C)throw new kt(st.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");x=new go(C)}s._authCredentials=new $ye(new Cte(y,x))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mp{constructor(n,i,l){this.converter=i,this._query=l,this.type="query",this.firestore=n}withConverter(n){return new mp(this.firestore,n,this._query)}}class $a{constructor(n,i,l){this.converter=i,this._key=l,this.type="document",this.firestore=n}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new nm(this.firestore,this.converter,this._key.path.popLast())}withConverter(n){return new $a(this.firestore,n,this._key)}}class nm extends mp{constructor(n,i,l){super(n,i,Gk(l)),this._path=l,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const n=this._path.popLast();return n.isEmpty()?null:new $a(this.firestore,null,new on(n))}withConverter(n){return new nm(this.firestore,n,this._path)}}function xn(s,n,...i){if(s=as(s),Ine("collection","path",n),s instanceof eO){const l=Ts.fromString(n,...i);return oJ(l),new nm(s,null,l)}{if(!(s instanceof $a||s instanceof nm))throw new kt(st.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const l=s._path.child(Ts.fromString(n,...i));return oJ(l),new nm(s.firestore,null,l)}}function at(s,n,...i){if(s=as(s),arguments.length===1&&(n=Nte.newId()),Ine("doc","path",n),s instanceof eO){const l=Ts.fromString(n,...i);return aJ(l),new $a(s,null,new on(l))}{if(!(s instanceof $a||s instanceof nm))throw new kt(st.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const l=s._path.child(Ts.fromString(n,...i));return aJ(l),new $a(s.firestore,s instanceof nm?s.converter:null,new on(l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lJ{constructor(n=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new eF(this,"async_queue_retry"),this.Vu=()=>{const l=x4();l&&$t("AsyncQueue","Visibility state changed to "+l.visibilityState),this.t_.jo()},this.mu=n;const i=x4();i&&typeof i.addEventListener=="function"&&i.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(n){this.enqueue(n)}enqueueAndForgetEvenWhileRestricted(n){this.fu(),this.gu(n)}enterRestrictedMode(n){if(!this.Iu){this.Iu=!0,this.Au=n||!1;const i=x4();i&&typeof i.removeEventListener=="function"&&i.removeEventListener("visibilitychange",this.Vu)}}enqueue(n){if(this.fu(),this.Iu)return new Promise(()=>{});const i=new Xu;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(n().then(i.resolve,i.reject),i.promise)).then(()=>i.promise)}enqueueRetryable(n){this.enqueueAndForget(()=>(this.Pu.push(n),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(n){if(!mT(n))throw n;$t("AsyncQueue","Operation failed with retryable error: "+n)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(n){const i=this.mu.then(()=>(this.du=!0,n().catch(l=>{this.Eu=l,this.du=!1;const u=function(g){let y=g.message||"";return g.stack&&(y=g.stack.includes(g.message)?g.stack:g.message+`
`+g.stack),y}(l);throw lp("INTERNAL UNHANDLED ERROR: ",u),l}).then(l=>(this.du=!1,l))));return this.mu=i,i}enqueueAfterDelay(n,i,l){this.fu(),this.Ru.indexOf(n)>-1&&(i=0);const u=iF.createAndSchedule(this,n,i,l,p=>this.yu(p));return this.Tu.push(u),u}fu(){this.Eu&&Rn()}verifyOperationInProgress(){}async wu(){let n;do n=this.mu,await n;while(n!==this.mu)}Su(n){for(const i of this.Tu)if(i.timerId===n)return!0;return!1}bu(n){return this.wu().then(()=>{this.Tu.sort((i,l)=>i.targetTimeMs-l.targetTimeMs);for(const i of this.Tu)if(i.skipDelay(),n!=="all"&&i.timerId===n)break;return this.wu()})}Du(n){this.Ru.push(n)}yu(n){const i=this.Tu.indexOf(n);this.Tu.splice(i,1)}}function dJ(s){return function(i,l){if(typeof i!="object"||i===null)return!1;const u=i;for(const p of l)if(p in u&&typeof u[p]=="function")return!0;return!1}(s,["next","error","complete"])}class Zu extends eO{constructor(n,i,l,u){super(n,i,l,u),this.type="firestore",this._queue=new lJ,this._persistenceKey=(u==null?void 0:u.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const n=this._firestoreClient.terminate();this._queue=new lJ(n),this._firestoreClient=void 0,await n}}}function Pwe(s,n){const i=typeof s=="object"?s:w3(),l=typeof s=="string"?s:"(default)",u=Uk(i,"firestore").getImmediate({identifier:l});if(!u._initialized){const p=Nee("firestore");p&&Dwe(u,...p)}return u}function bT(s){if(s._terminated)throw new kt(st.FAILED_PRECONDITION,"The client has already been terminated.");return s._firestoreClient||Lwe(s),s._firestoreClient}function Lwe(s){var n,i,l;const u=s._freezeSettings(),p=function(y,x,C,k){return new hbe(y,x,C,k.host,k.ssl,k.experimentalForceLongPolling,k.experimentalAutoDetectLongPolling,Nne(k.experimentalLongPollingOptions),k.useFetchStreams)}(s._databaseId,((n=s._app)===null||n===void 0?void 0:n.options.appId)||"",s._persistenceKey,u);s._componentsProvider||!((i=u.localCache)===null||i===void 0)&&i._offlineComponentProvider&&(!((l=u.localCache)===null||l===void 0)&&l._onlineComponentProvider)&&(s._componentsProvider={_offline:u.localCache._offlineComponentProvider,_online:u.localCache._onlineComponentProvider}),s._firestoreClient=new Twe(s._authCredentials,s._appCheckCredentials,s._queue,p,s._componentsProvider&&function(y){const x=y==null?void 0:y._online.build();return{_offline:y==null?void 0:y._offline.build(x),_online:x}}(s._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k_{constructor(n){this._byteString=n}static fromBase64String(n){try{return new k_(Qa.fromBase64String(n))}catch(i){throw new kt(st.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}}static fromUint8Array(n){return new k_(Qa.fromUint8Array(n))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(n){return this._byteString.isEqual(n._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xT{constructor(...n){for(let i=0;i<n.length;++i)if(n[i].length===0)throw new kt(st.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ha(n)}isEqual(n){return this._internalPath.isEqual(n._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ly{constructor(n){this._methodName=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tO{constructor(n,i){if(!isFinite(n)||n<-90||n>90)throw new kt(st.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+n);if(!isFinite(i)||i<-180||i>180)throw new kt(st.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=n,this._long=i}get latitude(){return this._lat}get longitude(){return this._long}isEqual(n){return this._lat===n._lat&&this._long===n._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(n){return $r(this._lat,n._lat)||$r(this._long,n._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fF{constructor(n){this._values=(n||[]).map(i=>i)}toArray(){return this._values.map(n=>n)}isEqual(n){return function(l,u){if(l.length!==u.length)return!1;for(let p=0;p<l.length;++p)if(l[p]!==u[p])return!1;return!0}(this._values,n._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jwe=/^__.*__$/;class Mwe{constructor(n,i,l){this.data=n,this.fieldMask=i,this.fieldTransforms=l}toMutation(n,i){return this.fieldMask!==null?new gm(n,this.data,this.fieldMask,i,this.fieldTransforms):new _T(n,this.data,i,this.fieldTransforms)}}class Ane{constructor(n,i,l){this.data=n,this.fieldMask=i,this.fieldTransforms=l}toMutation(n,i){return new gm(n,this.data,this.fieldMask,i,this.fieldTransforms)}}function kne(s){switch(s){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Rn()}}class nO{constructor(n,i,l,u,p,g){this.settings=n,this.databaseId=i,this.serializer=l,this.ignoreUndefinedProperties=u,p===void 0&&this.vu(),this.fieldTransforms=p||[],this.fieldMask=g||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(n){return new nO(Object.assign(Object.assign({},this.settings),n),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(n){var i;const l=(i=this.path)===null||i===void 0?void 0:i.child(n),u=this.Fu({path:l,xu:!1});return u.Ou(n),u}Nu(n){var i;const l=(i=this.path)===null||i===void 0?void 0:i.child(n),u=this.Fu({path:l,xu:!1});return u.vu(),u}Lu(n){return this.Fu({path:void 0,xu:!0})}Bu(n){return ak(n,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(n){return this.fieldMask.find(i=>n.isPrefixOf(i))!==void 0||this.fieldTransforms.find(i=>n.isPrefixOf(i.field))!==void 0}vu(){if(this.path)for(let n=0;n<this.path.length;n++)this.Ou(this.path.get(n))}Ou(n){if(n.length===0)throw this.Bu("Document fields must not be empty");if(kne(this.Cu)&&jwe.test(n))throw this.Bu('Document fields cannot begin and end with "__"')}}class Uwe{constructor(n,i,l){this.databaseId=n,this.ignoreUndefinedProperties=i,this.serializer=l||$k(n)}Qu(n,i,l,u=!1){return new nO({Cu:n,methodName:i,qu:l,path:Ha.emptyPath(),xu:!1,ku:u},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function wT(s){const n=s._freezeSettings(),i=$k(s._databaseId);return new Uwe(s._databaseId,!!n.ignoreUndefinedProperties,i)}function mF(s,n,i,l,u,p={}){const g=s.Qu(p.merge||p.mergeFields?2:0,n,i,u);EF("Data must be an object, but it was:",g,l);const y=Pne(l,g);let x,C;if(p.merge)x=new Hc(g.fieldMask),C=g.fieldTransforms;else if(p.mergeFields){const k=[];for(const A of p.mergeFields){const M=sV(n,A,i);if(!g.contains(M))throw new kt(st.INVALID_ARGUMENT,`Field '${M}' is specified in your field mask but missing from your input data.`);jne(k,M)||k.push(M)}x=new Hc(k),C=g.fieldTransforms.filter(A=>x.covers(A.field))}else x=null,C=g.fieldTransforms;return new Mwe(new Mo(y),x,C)}class rO extends Ly{_toFieldTransform(n){if(n.Cu!==2)throw n.Cu===1?n.Bu(`${this._methodName}() can only appear at the top level of your update data`):n.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return n.fieldMask.push(n.path),null}isEqual(n){return n instanceof rO}}function Vwe(s,n,i){return new nO({Cu:3,qu:n.settings.qu,methodName:s._methodName,xu:i},n.databaseId,n.serializer,n.ignoreUndefinedProperties)}class gF extends Ly{_toFieldTransform(n){return new q3(n.path,new KS)}isEqual(n){return n instanceof gF}}class _F extends Ly{constructor(n,i){super(n),this.Ku=i}_toFieldTransform(n){const i=Vwe(this,n,!0),l=this.Ku.map(p=>jy(p,i)),u=new uy(l);return new q3(n.path,u)}isEqual(n){return n instanceof _F&&MS(this.Ku,n.Ku)}}class vF extends Ly{constructor(n,i){super(n),this.$u=i}_toFieldTransform(n){const i=new YS(n.serializer,Hte(n.serializer,this.$u));return new q3(n.path,i)}isEqual(n){return n instanceof vF&&this.$u===n.$u}}function One(s,n,i,l){const u=s.Qu(1,n,i);EF("Data must be an object, but it was:",u,l);const p=[],g=Mo.empty();M_(l,(x,C)=>{const k=yF(n,x,i);C=as(C);const A=u.Nu(k);if(C instanceof rO)p.push(k);else{const M=jy(C,A);M!=null&&(p.push(k),g.set(k,M))}});const y=new Hc(p);return new Ane(g,y,u.fieldTransforms)}function Dne(s,n,i,l,u,p){const g=s.Qu(1,n,i),y=[sV(n,l,i)],x=[u];if(p.length%2!=0)throw new kt(st.INVALID_ARGUMENT,`Function ${n}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let M=0;M<p.length;M+=2)y.push(sV(n,p[M])),x.push(p[M+1]);const C=[],k=Mo.empty();for(let M=y.length-1;M>=0;--M)if(!jne(C,y[M])){const G=y[M];let B=x[M];B=as(B);const X=g.Nu(G);if(B instanceof rO)C.push(G);else{const Z=jy(B,X);Z!=null&&(C.push(G),k.set(G,Z))}}const A=new Hc(C);return new Ane(k,A,g.fieldTransforms)}function Fwe(s,n,i,l=!1){return jy(i,s.Qu(l?4:3,n))}function jy(s,n){if(Lne(s=as(s)))return EF("Unsupported field value:",n,s),Pne(s,n);if(s instanceof Ly)return function(l,u){if(!kne(u.Cu))throw u.Bu(`${l._methodName}() can only be used with update() and set()`);if(!u.path)throw u.Bu(`${l._methodName}() is not currently supported inside arrays`);const p=l._toFieldTransform(u);p&&u.fieldTransforms.push(p)}(s,n),null;if(s===void 0&&n.ignoreUndefinedProperties)return null;if(n.path&&n.fieldMask.push(n.path),s instanceof Array){if(n.settings.xu&&n.Cu!==4)throw n.Bu("Nested arrays are not supported");return function(l,u){const p=[];let g=0;for(const y of l){let x=jy(y,u.Lu(g));x==null&&(x={nullValue:"NULL_VALUE"}),p.push(x),g++}return{arrayValue:{values:p}}}(s,n)}return function(l,u){if((l=as(l))===null)return{nullValue:"NULL_VALUE"};if(typeof l=="number")return Hte(u.serializer,l);if(typeof l=="boolean")return{booleanValue:l};if(typeof l=="string")return{stringValue:l};if(l instanceof Date){const p=cn.fromDate(l);return{timestampValue:tk(u.serializer,p)}}if(l instanceof cn){const p=new cn(l.seconds,1e3*Math.floor(l.nanoseconds/1e3));return{timestampValue:tk(u.serializer,p)}}if(l instanceof tO)return{geoPointValue:{latitude:l.latitude,longitude:l.longitude}};if(l instanceof k_)return{bytesValue:rne(u.serializer,l._byteString)};if(l instanceof $a){const p=u.databaseId,g=l.firestore._databaseId;if(!g.isEqual(p))throw u.Bu(`Document reference is for database ${g.projectId}/${g.database} but should be for database ${p.projectId}/${p.database}`);return{referenceValue:$3(l.firestore._databaseId||u.databaseId,l._key.path)}}if(l instanceof fF)return function(g,y){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:g.toArray().map(x=>{if(typeof x!="number")throw y.Bu("VectorValues must only contain numeric values.");return K3(y.serializer,x)})}}}}}}(l,u);throw u.Bu(`Unsupported field value: ${Zk(l)}`)}(s,n)}function Pne(s,n){const i={};return Ite(s)?n.path&&n.path.length>0&&n.fieldMask.push(n.path):M_(s,(l,u)=>{const p=jy(u,n.Mu(l));p!=null&&(i[l]=p)}),{mapValue:{fields:i}}}function Lne(s){return!(typeof s!="object"||s===null||s instanceof Array||s instanceof Date||s instanceof cn||s instanceof tO||s instanceof k_||s instanceof $a||s instanceof Ly||s instanceof fF)}function EF(s,n,i){if(!Lne(i)||!function(u){return typeof u=="object"&&u!==null&&(Object.getPrototypeOf(u)===Object.prototype||Object.getPrototypeOf(u)===null)}(i)){const l=Zk(i);throw l==="an object"?n.Bu(s+" a custom object"):n.Bu(s+" "+l)}}function sV(s,n,i){if((n=as(n))instanceof xT)return n._internalPath;if(typeof n=="string")return yF(s,n);throw ak("Field path arguments must be of type string or ",s,!1,void 0,i)}const Bwe=new RegExp("[~\\*/\\[\\]]");function yF(s,n,i){if(n.search(Bwe)>=0)throw ak(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,s,!1,void 0,i);try{return new xT(...n.split("."))._internalPath}catch{throw ak(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,s,!1,void 0,i)}}function ak(s,n,i,l,u){const p=l&&!l.isEmpty(),g=u!==void 0;let y=`Function ${n}() called with invalid data`;i&&(y+=" (via `toFirestore()`)"),y+=". ";let x="";return(p||g)&&(x+=" (found",p&&(x+=` in field ${l}`),g&&(x+=` in document ${u}`),x+=")"),new kt(st.INVALID_ARGUMENT,y+s+x)}function jne(s,n){return s.some(i=>i.isEqual(n))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ok{constructor(n,i,l,u,p){this._firestore=n,this._userDataWriter=i,this._key=l,this._document=u,this._converter=p}get id(){return this._key.path.lastSegment()}get ref(){return new $a(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const n=new zwe(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(n)}return this._userDataWriter.convertValue(this._document.data.value)}}get(n){if(this._document){const i=this._document.data.field(sO("DocumentSnapshot.get",n));if(i!==null)return this._userDataWriter.convertValue(i)}}}class zwe extends ok{data(){return super.data()}}function sO(s,n){return typeof n=="string"?yF(s,n):n instanceof xT?n._internalPath:n._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mne(s){if(s.limitType==="L"&&s.explicitOrderBy.length===0)throw new kt(st.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class bF{}class xF extends bF{}function Zr(s,n,...i){let l=[];n instanceof bF&&l.push(n),l=l.concat(i),function(p){const g=p.filter(x=>x instanceof wF).length,y=p.filter(x=>x instanceof iO).length;if(g>1||g>0&&y>0)throw new kt(st.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(l);for(const u of l)s=u._apply(s);return s}class iO extends xF{constructor(n,i,l){super(),this._field=n,this._op=i,this._value=l,this.type="where"}static _create(n,i,l){return new iO(n,i,l)}_apply(n){const i=this._parse(n);return Une(n._query,i),new mp(n.firestore,n.converter,$5(n._query,i))}_parse(n){const i=wT(n.firestore);return function(p,g,y,x,C,k,A){let M;if(C.isKeyField()){if(k==="array-contains"||k==="array-contains-any")throw new kt(st.INVALID_ARGUMENT,`Invalid Query. You can't perform '${k}' queries on documentId().`);if(k==="in"||k==="not-in"){hJ(A,k);const G=[];for(const B of A)G.push(uJ(x,p,B));M={arrayValue:{values:G}}}else M=uJ(x,p,A)}else k!=="in"&&k!=="not-in"&&k!=="array-contains-any"||hJ(A,k),M=Fwe(y,g,A,k==="in"||k==="not-in");return zi.create(C,k,M)}(n._query,"where",i,n.firestore._databaseId,this._field,this._op,this._value)}}function or(s,n,i){const l=n,u=sO("where",s);return iO._create(u,l,i)}class wF extends bF{constructor(n,i){super(),this.type=n,this._queryConstraints=i}static _create(n,i){return new wF(n,i)}_parse(n){const i=this._queryConstraints.map(l=>l._parse(n)).filter(l=>l.getFilters().length>0);return i.length===1?i[0]:Kd.create(i,this._getOperator())}_apply(n){const i=this._parse(n);return i.getFilters().length===0?n:(function(u,p){let g=u;const y=p.getFlattenedFilters();for(const x of y)Une(g,x),g=$5(g,x)}(n._query,i),new mp(n.firestore,n.converter,$5(n._query,i)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class SF extends xF{constructor(n,i){super(),this._field=n,this._direction=i,this.type="orderBy"}static _create(n,i){return new SF(n,i)}_apply(n){const i=function(u,p,g){if(u.startAt!==null)throw new kt(st.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(u.endAt!==null)throw new kt(st.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new HS(p,g)}(n._query,this._field,this._direction);return new mp(n.firestore,n.converter,function(u,p){const g=u.explicitOrderBy.concat([p]);return new Oy(u.path,u.collectionGroup,g,u.filters.slice(),u.limit,u.limitType,u.startAt,u.endAt)}(n._query,i))}}function fy(s,n="asc"){const i=n,l=sO("orderBy",s);return SF._create(l,i)}class TF extends xF{constructor(n,i,l){super(),this.type=n,this._limit=i,this._limitType=l}static _create(n,i,l){return new TF(n,i,l)}_apply(n){return new mp(n.firestore,n.converter,ek(n._query,this._limit,this._limitType))}}function VE(s){return Owe("limit",s),TF._create("limit",s,"F")}function uJ(s,n,i){if(typeof(i=as(i))=="string"){if(i==="")throw new kt(st.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ute(n)&&i.indexOf("/")!==-1)throw new kt(st.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${i}' contains a '/' character.`);const l=n.path.child(Ts.fromString(i));if(!on.isDocumentKey(l))throw new kt(st.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${l}' is not because it has an odd number of segments (${l.length}).`);return O$(s,new on(l))}if(i instanceof $a)return O$(s,i._key);throw new kt(st.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Zk(i)}.`)}function hJ(s,n){if(!Array.isArray(s)||s.length===0)throw new kt(st.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${n.toString()}' filters.`)}function Une(s,n){const i=function(u,p){for(const g of u)for(const y of g.getFlattenedFilters())if(p.indexOf(y.op)>=0)return y.op;return null}(s.filters,function(u){switch(u){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(n.op));if(i!==null)throw i===n.op?new kt(st.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${n.op.toString()}' filter.`):new kt(st.INVALID_ARGUMENT,`Invalid query. You cannot use '${n.op.toString()}' filters with '${i.toString()}' filters.`)}class Vne{convertValue(n,i="none"){switch(A_(n)){case 0:return null;case 1:return n.booleanValue;case 2:return Ai(n.integerValue||n.doubleValue);case 3:return this.convertTimestamp(n.timestampValue);case 4:return this.convertServerTimestamp(n,i);case 5:return n.stringValue;case 6:return this.convertBytes(I_(n.bytesValue));case 7:return this.convertReference(n.referenceValue);case 8:return this.convertGeoPoint(n.geoPointValue);case 9:return this.convertArray(n.arrayValue,i);case 11:return this.convertObject(n.mapValue,i);case 10:return this.convertVectorValue(n.mapValue);default:throw Rn()}}convertObject(n,i){return this.convertObjectMap(n.fields,i)}convertObjectMap(n,i="none"){const l={};return M_(n,(u,p)=>{l[u]=this.convertValue(p,i)}),l}convertVectorValue(n){var i,l,u;const p=(u=(l=(i=n.fields)===null||i===void 0?void 0:i.value.arrayValue)===null||l===void 0?void 0:l.values)===null||u===void 0?void 0:u.map(g=>Ai(g.doubleValue));return new fF(p)}convertGeoPoint(n){return new tO(Ai(n.latitude),Ai(n.longitude))}convertArray(n,i){return(n.values||[]).map(l=>this.convertValue(l,i))}convertServerTimestamp(n,i){switch(i){case"previous":const l=z3(n);return l==null?null:this.convertValue(l,i);case"estimate":return this.convertTimestamp(zS(n));default:return null}}convertTimestamp(n){const i=um(n);return new cn(i.seconds,i.nanos)}convertDocumentKey(n,i){const l=Ts.fromString(n);Fr(dne(l));const u=new GS(l.get(1),l.get(3)),p=new on(l.popFirst(5));return u.isEqual(i)||lp(`Document ${p} contains a document reference within a different database (${u.projectId}/${u.database}) which is not supported. It will be treated as a reference in the current database (${i.projectId}/${i.database}) instead.`),p}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RF(s,n,i){let l;return l=s?i&&(i.merge||i.mergeFields)?s.toFirestore(n,i):s.toFirestore(n):n,l}class Gwe extends Vne{constructor(n){super(),this.firestore=n}convertBytes(n){return new k_(n)}convertReference(n){const i=this.convertDocumentKey(n,this.firestore._databaseId);return new $a(this.firestore,null,i)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FE{constructor(n,i){this.hasPendingWrites=n,this.fromCache=i}isEqual(n){return this.hasPendingWrites===n.hasPendingWrites&&this.fromCache===n.fromCache}}class CF extends ok{constructor(n,i,l,u,p,g){super(n,i,l,u,g),this._firestore=n,this._firestoreImpl=n,this.metadata=p}exists(){return super.exists()}data(n={}){if(this._document){if(this._converter){const i=new g1(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(i,n)}return this._userDataWriter.convertValue(this._document.data.value,n.serverTimestamps)}}get(n,i={}){if(this._document){const l=this._document.data.field(sO("DocumentSnapshot.get",n));if(l!==null)return this._userDataWriter.convertValue(l,i.serverTimestamps)}}}class g1 extends CF{data(n={}){return super.data(n)}}class Fne{constructor(n,i,l,u){this._firestore=n,this._userDataWriter=i,this._snapshot=u,this.metadata=new FE(u.hasPendingWrites,u.fromCache),this.query=l}get docs(){const n=[];return this.forEach(i=>n.push(i)),n}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(n,i){this._snapshot.docs.forEach(l=>{n.call(i,new g1(this._firestore,this._userDataWriter,l.key,l,new FE(this._snapshot.mutatedKeys.has(l.key),this._snapshot.fromCache),this.query.converter))})}docChanges(n={}){const i=!!n.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new kt(st.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=function(u,p){if(u._snapshot.oldDocs.isEmpty()){let g=0;return u._snapshot.docChanges.map(y=>{const x=new g1(u._firestore,u._userDataWriter,y.doc.key,y.doc,new FE(u._snapshot.mutatedKeys.has(y.doc.key),u._snapshot.fromCache),u.query.converter);return y.doc,{type:"added",doc:x,oldIndex:-1,newIndex:g++}})}{let g=u._snapshot.oldDocs;return u._snapshot.docChanges.filter(y=>p||y.type!==3).map(y=>{const x=new g1(u._firestore,u._userDataWriter,y.doc.key,y.doc,new FE(u._snapshot.mutatedKeys.has(y.doc.key),u._snapshot.fromCache),u.query.converter);let C=-1,k=-1;return y.type!==0&&(C=g.indexOf(y.doc.key),g=g.delete(y.doc.key)),y.type!==1&&(g=g.add(y.doc),k=g.indexOf(y.doc.key)),{type:Wwe(y.type),doc:x,oldIndex:C,newIndex:k}})}}(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges}}function Wwe(s){switch(s){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Rn()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fr(s){s=Fo(s,$a);const n=Fo(s.firestore,Zu);return Iwe(bT(n),s._key).then(i=>Bne(n,s,i))}class aO extends Vne{constructor(n){super(),this.firestore=n}convertBytes(n){return new k_(n)}convertReference(n){const i=this.convertDocumentKey(n,this.firestore._databaseId);return new $a(this.firestore,null,i)}}function Ur(s){s=Fo(s,mp);const n=Fo(s.firestore,Zu),i=bT(n),l=new aO(n);return Mne(s._query),Awe(i,s._query).then(u=>new Fne(n,l,s,u))}function yo(s,n,i){s=Fo(s,$a);const l=Fo(s.firestore,Zu),u=RF(s.converter,n,i);return oO(l,[mF(wT(l),"setDoc",s._key,u,s.converter!==null,i).toMutation(s._key,Ka.none())])}function Kn(s,n,i,...l){s=Fo(s,$a);const u=Fo(s.firestore,Zu),p=wT(u);let g;return g=typeof(n=as(n))=="string"||n instanceof xT?Dne(p,"updateDoc",s._key,n,i,l):One(p,"updateDoc",s._key,n),oO(u,[g.toMutation(s._key,Ka.exists(!0))])}function Ga(s){return oO(Fo(s.firestore,Zu),[new Yk(s._key,Ka.none())])}function my(s,n){const i=Fo(s.firestore,Zu),l=at(s),u=RF(s.converter,n);return oO(i,[mF(wT(s.firestore),"addDoc",l._key,u,s.converter!==null,{}).toMutation(l._key,Ka.exists(!1))]).then(()=>l)}function qa(s,...n){var i,l,u;s=as(s);let p={includeMetadataChanges:!1,source:"default"},g=0;typeof n[g]!="object"||dJ(n[g])||(p=n[g],g++);const y={includeMetadataChanges:p.includeMetadataChanges,source:p.source};if(dJ(n[g])){const A=n[g];n[g]=(i=A.next)===null||i===void 0?void 0:i.bind(A),n[g+1]=(l=A.error)===null||l===void 0?void 0:l.bind(A),n[g+2]=(u=A.complete)===null||u===void 0?void 0:u.bind(A)}let x,C,k;if(s instanceof $a)C=Fo(s.firestore,Zu),k=Gk(s._key.path),x={next:A=>{n[g]&&n[g](Bne(C,s,A))},error:n[g+1],complete:n[g+2]};else{const A=Fo(s,mp);C=Fo(A.firestore,Zu),k=A._query;const M=new aO(C);x={next:G=>{n[g]&&n[g](new Fne(C,M,A,G))},error:n[g+1],complete:n[g+2]},Mne(s._query)}return function(M,G,B,X){const Z=new hF(X),q=new dF(G,Z,B);return M.asyncQueue.enqueueAndForget(async()=>oF(await ik(M),q)),()=>{Z.Za(),M.asyncQueue.enqueueAndForget(async()=>cF(await ik(M),q))}}(bT(C),k,y,x)}function oO(s,n){return function(l,u){const p=new Xu;return l.asyncQueue.enqueueAndForget(async()=>mwe(await Cwe(l),u,p)),p.promise}(bT(s),n)}function Bne(s,n,i){const l=i.docs.get(n._key),u=new aO(s);return new CF(s,u,n._key,l,new FE(i.hasPendingWrites,i.fromCache),n.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hwe={maxAttempts:5};function Uw(s,n){if((s=as(s)).firestore!==n)throw new kt(st.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kwe extends class{constructor(i,l){this._firestore=i,this._transaction=l,this._dataReader=wT(i)}get(i){const l=Uw(i,this._firestore),u=new Gwe(this._firestore);return this._transaction.lookup([l._key]).then(p=>{if(!p||p.length!==1)return Rn();const g=p[0];if(g.isFoundDocument())return new ok(this._firestore,u,g.key,g,l.converter);if(g.isNoDocument())return new ok(this._firestore,u,l._key,null,l.converter);throw Rn()})}set(i,l,u){const p=Uw(i,this._firestore),g=RF(p.converter,l,u),y=mF(this._dataReader,"Transaction.set",p._key,g,p.converter!==null,u);return this._transaction.set(p._key,y),this}update(i,l,u,...p){const g=Uw(i,this._firestore);let y;return y=typeof(l=as(l))=="string"||l instanceof xT?Dne(this._dataReader,"Transaction.update",g._key,l,u,p):One(this._dataReader,"Transaction.update",g._key,l),this._transaction.update(g._key,y),this}delete(i){const l=Uw(i,this._firestore);return this._transaction.delete(l._key),this}}{constructor(n,i){super(n,i),this._firestore=n}get(n){const i=Uw(n,this._firestore),l=new aO(this._firestore);return super.get(n).then(u=>new CF(this._firestore,l,i._key,u._document,new FE(!1,!1),i.converter))}}function qwe(s,n,i){s=Fo(s,Zu);const l=Object.assign(Object.assign({},Hwe),i);return function(p){if(p.maxAttempts<1)throw new kt(st.INVALID_ARGUMENT,"Max attempts must be at least 1")}(l),function(p,g,y){const x=new Xu;return p.asyncQueue.enqueueAndForget(async()=>{const C=await Nwe(p);new Swe(p.asyncQueue,C,y,g,x).au()}),x.promise}(bT(s),u=>n(new Kwe(s,u)),l)}function Uo(){return new gF("serverTimestamp")}function Ywe(...s){return new _F("arrayUnion",s)}function ta(s){return new vF("increment",s)}(function(n,i=!0){(function(u){ky=u})(j_),T_(new lm("firestore",(l,{instanceIdentifier:u,options:p})=>{const g=l.getProvider("app").getImmediate(),y=new Zu(new Jye(l.getProvider("auth-internal")),new tbe(l.getProvider("app-check-internal")),function(C,k){if(!Object.prototype.hasOwnProperty.apply(C.options,["projectId"]))throw new kt(st.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new GS(C.options.projectId,k)}(g,u),g);return p=Object.assign({useFetchStreams:i},p),y._setSettings(p),y},"PUBLIC").setMultipleInstances(!0)),Ku(C$,"4.7.3",n),Ku(C$,"4.7.3","esm2017")})();var Xwe="firebase",$we="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ku(Xwe,$we,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zne="firebasestorage.googleapis.com",Gne="storageBucket",Jwe=2*60*1e3,Qwe=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bi extends th{constructor(n,i,l=0){super(S4(n),`Firebase Storage: ${i} (${S4(n)})`),this.status_=l,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,bi.prototype)}get status(){return this.status_}set status(n){this.status_=n}_codeEquals(n){return S4(n)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(n){this.customData.serverResponse=n,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var yi;(function(s){s.UNKNOWN="unknown",s.OBJECT_NOT_FOUND="object-not-found",s.BUCKET_NOT_FOUND="bucket-not-found",s.PROJECT_NOT_FOUND="project-not-found",s.QUOTA_EXCEEDED="quota-exceeded",s.UNAUTHENTICATED="unauthenticated",s.UNAUTHORIZED="unauthorized",s.UNAUTHORIZED_APP="unauthorized-app",s.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",s.INVALID_CHECKSUM="invalid-checksum",s.CANCELED="canceled",s.INVALID_EVENT_NAME="invalid-event-name",s.INVALID_URL="invalid-url",s.INVALID_DEFAULT_BUCKET="invalid-default-bucket",s.NO_DEFAULT_BUCKET="no-default-bucket",s.CANNOT_SLICE_BLOB="cannot-slice-blob",s.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",s.NO_DOWNLOAD_URL="no-download-url",s.INVALID_ARGUMENT="invalid-argument",s.INVALID_ARGUMENT_COUNT="invalid-argument-count",s.APP_DELETED="app-deleted",s.INVALID_ROOT_OPERATION="invalid-root-operation",s.INVALID_FORMAT="invalid-format",s.INTERNAL_ERROR="internal-error",s.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(yi||(yi={}));function S4(s){return"storage/"+s}function NF(){const s="An unknown error occurred, please check the error payload for server response.";return new bi(yi.UNKNOWN,s)}function Zwe(s){return new bi(yi.OBJECT_NOT_FOUND,"Object '"+s+"' does not exist.")}function eSe(s){return new bi(yi.QUOTA_EXCEEDED,"Quota for bucket '"+s+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function tSe(){const s="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new bi(yi.UNAUTHENTICATED,s)}function nSe(){return new bi(yi.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function rSe(s){return new bi(yi.UNAUTHORIZED,"User does not have permission to access '"+s+"'.")}function sSe(){return new bi(yi.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function iSe(){return new bi(yi.CANCELED,"User canceled the upload/download.")}function aSe(s){return new bi(yi.INVALID_URL,"Invalid URL '"+s+"'.")}function oSe(s){return new bi(yi.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+s+"'.")}function cSe(){return new bi(yi.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Gne+"' property when initializing the app?")}function lSe(){return new bi(yi.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function dSe(){return new bi(yi.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function uSe(s){return new bi(yi.UNSUPPORTED_ENVIRONMENT,`${s} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function iV(s){return new bi(yi.INVALID_ARGUMENT,s)}function Wne(){return new bi(yi.APP_DELETED,"The Firebase app was deleted.")}function hSe(s){return new bi(yi.INVALID_ROOT_OPERATION,"The operation '"+s+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function pS(s,n){return new bi(yi.INVALID_FORMAT,"String does not match format '"+s+"': "+n)}function Vw(s){throw new bi(yi.INTERNAL_ERROR,"Internal error: "+s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kc{constructor(n,i){this.bucket=n,this.path_=i}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const n=encodeURIComponent;return"/b/"+n(this.bucket)+"/o/"+n(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(n,i){let l;try{l=Kc.makeFromUrl(n,i)}catch{return new Kc(n,"")}if(l.path==="")return l;throw oSe(n)}static makeFromUrl(n,i){let l=null;const u="([A-Za-z0-9.\\-_]+)";function p(de){de.path.charAt(de.path.length-1)==="/"&&(de.path_=de.path_.slice(0,-1))}const g="(/(.*))?$",y=new RegExp("^gs://"+u+g,"i"),x={bucket:1,path:3};function C(de){de.path_=decodeURIComponent(de.path)}const k="v[A-Za-z0-9_]+",A=i.replace(/[.]/g,"\\."),M="(/([^?#]*).*)?$",G=new RegExp(`^https?://${A}/${k}/b/${u}/o${M}`,"i"),B={bucket:1,path:3},X=i===zne?"(?:storage.googleapis.com|storage.cloud.google.com)":i,Z="([^?#]*)",q=new RegExp(`^https?://${X}/${u}/${Z}`,"i"),ee=[{regex:y,indices:x,postModify:p},{regex:G,indices:B,postModify:C},{regex:q,indices:{bucket:1,path:2},postModify:C}];for(let de=0;de<ee.length;de++){const ae=ee[de],ye=ae.regex.exec(n);if(ye){const Q=ye[ae.indices.bucket];let $=ye[ae.indices.path];$||($=""),l=new Kc(Q,$),ae.postModify(l);break}}if(l==null)throw aSe(n);return l}}class pSe{constructor(n){this.promise_=Promise.reject(n)}getPromise(){return this.promise_}cancel(n=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fSe(s,n,i){let l=1,u=null,p=null,g=!1,y=0;function x(){return y===2}let C=!1;function k(...Z){C||(C=!0,n.apply(null,Z))}function A(Z){u=setTimeout(()=>{u=null,s(G,x())},Z)}function M(){p&&clearTimeout(p)}function G(Z,...q){if(C){M();return}if(Z){M(),k.call(null,Z,...q);return}if(x()||g){M(),k.call(null,Z,...q);return}l<64&&(l*=2);let ee;y===1?(y=2,ee=0):ee=(l+Math.random())*1e3,A(ee)}let B=!1;function X(Z){B||(B=!0,M(),!C&&(u!==null?(Z||(y=2),clearTimeout(u),A(0)):Z||(y=1)))}return A(0),p=setTimeout(()=>{g=!0,X(!0)},i),X}function mSe(s){s(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gSe(s){return s!==void 0}function _Se(s){return typeof s=="object"&&!Array.isArray(s)}function IF(s){return typeof s=="string"||s instanceof String}function pJ(s){return AF()&&s instanceof Blob}function AF(){return typeof Blob<"u"}function fJ(s,n,i,l){if(l<n)throw iV(`Invalid value for '${s}'. Expected ${n} or greater.`);if(l>i)throw iV(`Invalid value for '${s}'. Expected ${i} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kF(s,n,i){let l=n;return i==null&&(l=`https://${n}`),`${i}://${l}/v0${s}`}function Hne(s){const n=encodeURIComponent;let i="?";for(const l in s)if(s.hasOwnProperty(l)){const u=n(l)+"="+n(s[l]);i=i+u+"&"}return i=i.slice(0,-1),i}var v_;(function(s){s[s.NO_ERROR=0]="NO_ERROR",s[s.NETWORK_ERROR=1]="NETWORK_ERROR",s[s.ABORT=2]="ABORT"})(v_||(v_={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vSe(s,n){const i=s>=500&&s<600,u=[408,429].indexOf(s)!==-1,p=n.indexOf(s)!==-1;return i||u||p}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ESe{constructor(n,i,l,u,p,g,y,x,C,k,A,M=!0){this.url_=n,this.method_=i,this.headers_=l,this.body_=u,this.successCodes_=p,this.additionalRetryCodes_=g,this.callback_=y,this.errorCallback_=x,this.timeout_=C,this.progressCallback_=k,this.connectionFactory_=A,this.retry=M,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((G,B)=>{this.resolve_=G,this.reject_=B,this.start_()})}start_(){const n=(l,u)=>{if(u){l(!1,new WA(!1,null,!0));return}const p=this.connectionFactory_();this.pendingConnection_=p;const g=y=>{const x=y.loaded,C=y.lengthComputable?y.total:-1;this.progressCallback_!==null&&this.progressCallback_(x,C)};this.progressCallback_!==null&&p.addUploadProgressListener(g),p.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&p.removeUploadProgressListener(g),this.pendingConnection_=null;const y=p.getErrorCode()===v_.NO_ERROR,x=p.getStatus();if(!y||vSe(x,this.additionalRetryCodes_)&&this.retry){const k=p.getErrorCode()===v_.ABORT;l(!1,new WA(!1,null,k));return}const C=this.successCodes_.indexOf(x)!==-1;l(!0,new WA(C,p))})},i=(l,u)=>{const p=this.resolve_,g=this.reject_,y=u.connection;if(u.wasSuccessCode)try{const x=this.callback_(y,y.getResponse());gSe(x)?p(x):p()}catch(x){g(x)}else if(y!==null){const x=NF();x.serverResponse=y.getErrorText(),this.errorCallback_?g(this.errorCallback_(y,x)):g(x)}else if(u.canceled){const x=this.appDelete_?Wne():iSe();g(x)}else{const x=sSe();g(x)}};this.canceled_?i(!1,new WA(!1,null,!0)):this.backoffId_=fSe(n,i,this.timeout_)}getPromise(){return this.promise_}cancel(n){this.canceled_=!0,this.appDelete_=n||!1,this.backoffId_!==null&&mSe(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class WA{constructor(n,i,l){this.wasSuccessCode=n,this.connection=i,this.canceled=!!l}}function ySe(s,n){n!==null&&n.length>0&&(s.Authorization="Firebase "+n)}function bSe(s,n){s["X-Firebase-Storage-Version"]="webjs/"+(n??"AppManager")}function xSe(s,n){n&&(s["X-Firebase-GMPID"]=n)}function wSe(s,n){n!==null&&(s["X-Firebase-AppCheck"]=n)}function SSe(s,n,i,l,u,p,g=!0){const y=Hne(s.urlParams),x=s.url+y,C=Object.assign({},s.headers);return xSe(C,n),ySe(C,i),bSe(C,p),wSe(C,l),new ESe(x,s.method,C,s.body,s.successCodes,s.additionalRetryCodes,s.handler,s.errorHandler,s.timeout,s.progressCallback,u,g)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TSe(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function RSe(...s){const n=TSe();if(n!==void 0){const i=new n;for(let l=0;l<s.length;l++)i.append(s[l]);return i.getBlob()}else{if(AF())return new Blob(s);throw new bi(yi.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function CSe(s,n,i){return s.webkitSlice?s.webkitSlice(n,i):s.mozSlice?s.mozSlice(n,i):s.slice?s.slice(n,i):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NSe(s){if(typeof atob>"u")throw uSe("base-64");return atob(s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zu={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class T4{constructor(n,i){this.data=n,this.contentType=i||null}}function ISe(s,n){switch(s){case zu.RAW:return new T4(Kne(n));case zu.BASE64:case zu.BASE64URL:return new T4(qne(s,n));case zu.DATA_URL:return new T4(kSe(n),OSe(n))}throw NF()}function Kne(s){const n=[];for(let i=0;i<s.length;i++){let l=s.charCodeAt(i);if(l<=127)n.push(l);else if(l<=2047)n.push(192|l>>6,128|l&63);else if((l&64512)===55296)if(!(i<s.length-1&&(s.charCodeAt(i+1)&64512)===56320))n.push(239,191,189);else{const p=l,g=s.charCodeAt(++i);l=65536|(p&1023)<<10|g&1023,n.push(240|l>>18,128|l>>12&63,128|l>>6&63,128|l&63)}else(l&64512)===56320?n.push(239,191,189):n.push(224|l>>12,128|l>>6&63,128|l&63)}return new Uint8Array(n)}function ASe(s){let n;try{n=decodeURIComponent(s)}catch{throw pS(zu.DATA_URL,"Malformed data URL.")}return Kne(n)}function qne(s,n){switch(s){case zu.BASE64:{const u=n.indexOf("-")!==-1,p=n.indexOf("_")!==-1;if(u||p)throw pS(s,"Invalid character '"+(u?"-":"_")+"' found: is it base64url encoded?");break}case zu.BASE64URL:{const u=n.indexOf("+")!==-1,p=n.indexOf("/")!==-1;if(u||p)throw pS(s,"Invalid character '"+(u?"+":"/")+"' found: is it base64 encoded?");n=n.replace(/-/g,"+").replace(/_/g,"/");break}}let i;try{i=NSe(n)}catch(u){throw u.message.includes("polyfill")?u:pS(s,"Invalid character found")}const l=new Uint8Array(i.length);for(let u=0;u<i.length;u++)l[u]=i.charCodeAt(u);return l}class Yne{constructor(n){this.base64=!1,this.contentType=null;const i=n.match(/^data:([^,]+)?,/);if(i===null)throw pS(zu.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const l=i[1]||null;l!=null&&(this.base64=DSe(l,";base64"),this.contentType=this.base64?l.substring(0,l.length-7):l),this.rest=n.substring(n.indexOf(",")+1)}}function kSe(s){const n=new Yne(s);return n.base64?qne(zu.BASE64,n.rest):ASe(n.rest)}function OSe(s){return new Yne(s).contentType}function DSe(s,n){return s.length>=n.length?s.substring(s.length-n.length)===n:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uf{constructor(n,i){let l=0,u="";pJ(n)?(this.data_=n,l=n.size,u=n.type):n instanceof ArrayBuffer?(i?this.data_=new Uint8Array(n):(this.data_=new Uint8Array(n.byteLength),this.data_.set(new Uint8Array(n))),l=this.data_.length):n instanceof Uint8Array&&(i?this.data_=n:(this.data_=new Uint8Array(n.length),this.data_.set(n)),l=n.length),this.size_=l,this.type_=u}size(){return this.size_}type(){return this.type_}slice(n,i){if(pJ(this.data_)){const l=this.data_,u=CSe(l,n,i);return u===null?null:new Uf(u)}else{const l=new Uint8Array(this.data_.buffer,n,i-n);return new Uf(l,!0)}}static getBlob(...n){if(AF()){const i=n.map(l=>l instanceof Uf?l.data_:l);return new Uf(RSe.apply(null,i))}else{const i=n.map(g=>IF(g)?ISe(zu.RAW,g).data:g.data_);let l=0;i.forEach(g=>{l+=g.byteLength});const u=new Uint8Array(l);let p=0;return i.forEach(g=>{for(let y=0;y<g.length;y++)u[p++]=g[y]}),new Uf(u,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xne(s){let n;try{n=JSON.parse(s)}catch{return null}return _Se(n)?n:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PSe(s){if(s.length===0)return null;const n=s.lastIndexOf("/");return n===-1?"":s.slice(0,n)}function LSe(s,n){const i=n.split("/").filter(l=>l.length>0).join("/");return s.length===0?i:s+"/"+i}function $ne(s){const n=s.lastIndexOf("/",s.length-2);return n===-1?s:s.slice(n+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jSe(s,n){return n}class Lo{constructor(n,i,l,u){this.server=n,this.local=i||n,this.writable=!!l,this.xform=u||jSe}}let HA=null;function MSe(s){return!IF(s)||s.length<2?s:$ne(s)}function Jne(){if(HA)return HA;const s=[];s.push(new Lo("bucket")),s.push(new Lo("generation")),s.push(new Lo("metageneration")),s.push(new Lo("name","fullPath",!0));function n(p,g){return MSe(g)}const i=new Lo("name");i.xform=n,s.push(i);function l(p,g){return g!==void 0?Number(g):g}const u=new Lo("size");return u.xform=l,s.push(u),s.push(new Lo("timeCreated")),s.push(new Lo("updated")),s.push(new Lo("md5Hash",null,!0)),s.push(new Lo("cacheControl",null,!0)),s.push(new Lo("contentDisposition",null,!0)),s.push(new Lo("contentEncoding",null,!0)),s.push(new Lo("contentLanguage",null,!0)),s.push(new Lo("contentType",null,!0)),s.push(new Lo("metadata","customMetadata",!0)),HA=s,HA}function USe(s,n){function i(){const l=s.bucket,u=s.fullPath,p=new Kc(l,u);return n._makeStorageReference(p)}Object.defineProperty(s,"ref",{get:i})}function VSe(s,n,i){const l={};l.type="file";const u=i.length;for(let p=0;p<u;p++){const g=i[p];l[g.local]=g.xform(l,n[g.server])}return USe(l,s),l}function Qne(s,n,i){const l=Xne(n);return l===null?null:VSe(s,l,i)}function FSe(s,n,i,l){const u=Xne(n);if(u===null||!IF(u.downloadTokens))return null;const p=u.downloadTokens;if(p.length===0)return null;const g=encodeURIComponent;return p.split(",").map(C=>{const k=s.bucket,A=s.fullPath,M="/b/"+g(k)+"/o/"+g(A),G=kF(M,i,l),B=Hne({alt:"media",token:C});return G+B})[0]}function BSe(s,n){const i={},l=n.length;for(let u=0;u<l;u++){const p=n[u];p.writable&&(i[p.server]=s[p.local])}return JSON.stringify(i)}class Zne{constructor(n,i,l,u){this.url=n,this.method=i,this.handler=l,this.timeout=u,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ere(s){if(!s)throw NF()}function zSe(s,n){function i(l,u){const p=Qne(s,u,n);return ere(p!==null),p}return i}function GSe(s,n){function i(l,u){const p=Qne(s,u,n);return ere(p!==null),FSe(p,u,s.host,s._protocol)}return i}function tre(s){function n(i,l){let u;return i.getStatus()===401?i.getErrorText().includes("Firebase App Check token is invalid")?u=nSe():u=tSe():i.getStatus()===402?u=eSe(s.bucket):i.getStatus()===403?u=rSe(s.path):u=l,u.status=i.getStatus(),u.serverResponse=l.serverResponse,u}return n}function WSe(s){const n=tre(s);function i(l,u){let p=n(l,u);return l.getStatus()===404&&(p=Zwe(s.path)),p.serverResponse=u.serverResponse,p}return i}function HSe(s,n,i){const l=n.fullServerUrl(),u=kF(l,s.host,s._protocol),p="GET",g=s.maxOperationRetryTime,y=new Zne(u,p,GSe(s,i),g);return y.errorHandler=WSe(n),y}function KSe(s,n){return s&&s.contentType||n&&n.type()||"application/octet-stream"}function qSe(s,n,i){const l=Object.assign({},i);return l.fullPath=s.path,l.size=n.size(),l.contentType||(l.contentType=KSe(null,n)),l}function YSe(s,n,i,l,u){const p=n.bucketOnlyServerUrl(),g={"X-Goog-Upload-Protocol":"multipart"};function y(){let ee="";for(let de=0;de<2;de++)ee=ee+Math.random().toString().slice(2);return ee}const x=y();g["Content-Type"]="multipart/related; boundary="+x;const C=qSe(n,l,u),k=BSe(C,i),A="--"+x+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+k+`\r
--`+x+`\r
Content-Type: `+C.contentType+`\r
\r
`,M=`\r
--`+x+"--",G=Uf.getBlob(A,l,M);if(G===null)throw lSe();const B={name:C.fullPath},X=kF(p,s.host,s._protocol),Z="POST",q=s.maxUploadRetryTime,V=new Zne(X,Z,zSe(s,i),q);return V.urlParams=B,V.headers=g,V.body=G.uploadData(),V.errorHandler=tre(n),V}class XSe{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=v_.NO_ERROR,this.sendPromise_=new Promise(n=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=v_.ABORT,n()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=v_.NETWORK_ERROR,n()}),this.xhr_.addEventListener("load",()=>{n()})})}send(n,i,l,u){if(this.sent_)throw Vw("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(i,n,!0),u!==void 0)for(const p in u)u.hasOwnProperty(p)&&this.xhr_.setRequestHeader(p,u[p].toString());return l!==void 0?this.xhr_.send(l):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Vw("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Vw("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Vw("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Vw("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(n){return this.xhr_.getResponseHeader(n)}addUploadProgressListener(n){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",n)}removeUploadProgressListener(n){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",n)}}class $Se extends XSe{initXhr(){this.xhr_.responseType="text"}}function nre(){return new $Se}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O_{constructor(n,i){this._service=n,i instanceof Kc?this._location=i:this._location=Kc.makeFromUrl(i,n.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(n,i){return new O_(n,i)}get root(){const n=new Kc(this._location.bucket,"");return this._newRef(this._service,n)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return $ne(this._location.path)}get storage(){return this._service}get parent(){const n=PSe(this._location.path);if(n===null)return null;const i=new Kc(this._location.bucket,n);return new O_(this._service,i)}_throwIfRoot(n){if(this._location.path==="")throw hSe(n)}}function JSe(s,n,i){s._throwIfRoot("uploadBytes");const l=YSe(s.storage,s._location,Jne(),new Uf(n,!0),i);return s.storage.makeRequestWithTokens(l,nre).then(u=>({metadata:u,ref:s}))}function QSe(s){s._throwIfRoot("getDownloadURL");const n=HSe(s.storage,s._location,Jne());return s.storage.makeRequestWithTokens(n,nre).then(i=>{if(i===null)throw dSe();return i})}function ZSe(s,n){const i=LSe(s._location.path,n),l=new Kc(s._location.bucket,i);return new O_(s.storage,l)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eTe(s){return/^[A-Za-z]+:\/\//.test(s)}function tTe(s,n){return new O_(s,n)}function rre(s,n){if(s instanceof OF){const i=s;if(i._bucket==null)throw cSe();const l=new O_(i,i._bucket);return n!=null?rre(l,n):l}else return n!==void 0?ZSe(s,n):s}function nTe(s,n){if(n&&eTe(n)){if(s instanceof OF)return tTe(s,n);throw iV("To use ref(service, url), the first argument must be a Storage instance.")}else return rre(s,n)}function mJ(s,n){const i=n==null?void 0:n[Gne];return i==null?null:Kc.makeFromBucketSpec(i,s)}function rTe(s,n,i,l={}){s.host=`${n}:${i}`,s._protocol="http";const{mockUserToken:u}=l;u&&(s._overrideAuthToken=typeof u=="string"?u:kee(u,s.app.options.projectId))}class OF{constructor(n,i,l,u,p){this.app=n,this._authProvider=i,this._appCheckProvider=l,this._url=u,this._firebaseVersion=p,this._bucket=null,this._host=zne,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Jwe,this._maxUploadRetryTime=Qwe,this._requests=new Set,u!=null?this._bucket=Kc.makeFromBucketSpec(u,this._host):this._bucket=mJ(this._host,this.app.options)}get host(){return this._host}set host(n){this._host=n,this._url!=null?this._bucket=Kc.makeFromBucketSpec(this._url,n):this._bucket=mJ(n,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(n){fJ("time",0,Number.POSITIVE_INFINITY,n),this._maxUploadRetryTime=n}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(n){fJ("time",0,Number.POSITIVE_INFINITY,n),this._maxOperationRetryTime=n}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const n=this._authProvider.getImmediate({optional:!0});if(n){const i=await n.getToken();if(i!==null)return i.accessToken}return null}async _getAppCheckToken(){const n=this._appCheckProvider.getImmediate({optional:!0});return n?(await n.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(n=>n.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(n){return new O_(this,n)}_makeRequest(n,i,l,u,p=!0){if(this._deleted)return new pSe(Wne());{const g=SSe(n,this._appId,l,u,i,this._firebaseVersion,p);return this._requests.add(g),g.getPromise().then(()=>this._requests.delete(g),()=>this._requests.delete(g)),g}}async makeRequestWithTokens(n,i){const[l,u]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(n,i,l,u).getPromise()}}const gJ="@firebase/storage",_J="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sre="storage";function aV(s,n,i){return s=as(s),JSe(s,n,i)}function oV(s){return s=as(s),QSe(s)}function cV(s,n){return s=as(s),nTe(s,n)}function ire(s=w3(),n){s=as(s);const l=Uk(s,sre).getImmediate({identifier:n}),u=Nee("storage");return u&&sTe(l,...u),l}function sTe(s,n,i,l={}){rTe(s,n,i,l)}function iTe(s,{instanceIdentifier:n}){const i=s.getProvider("app").getImmediate(),l=s.getProvider("auth-internal"),u=s.getProvider("app-check-internal");return new OF(i,l,u,n,j_)}function aTe(){T_(new lm(sre,iTe,"PUBLIC").setMultipleInstances(!0)),Ku(gJ,_J,""),Ku(gJ,_J,"esm2017")}aTe();const oTe={apiKey:"AIzaSyCMdQlzbrfXAVT6mB0tXuAUbj7-3QBOyLQ",authDomain:"butterbread-web.firebaseapp.com",projectId:"butterbread-web",storageBucket:"butterbread-web.firebasestorage.app",messagingSenderId:"1037775236421",appId:"1:1037775236421:web:d9525d697800c7ffc5e22c",measurementId:"G-TF57S4VYP9"},DF=Pee(oTe),Fi=qye(DF),Me=Pwe(DF),cTe=ire(DF),lTe={},vJ=s=>{let n;const i=new Set,l=(k,A)=>{const M=typeof k=="function"?k(n):k;if(!Object.is(M,n)){const G=n;n=A??(typeof M!="object"||M===null)?M:Object.assign({},n,M),i.forEach(B=>B(n,G))}},u=()=>n,x={setState:l,getState:u,getInitialState:()=>C,subscribe:k=>(i.add(k),()=>i.delete(k)),destroy:()=>{(lTe?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),i.clear()}},C=n=s(l,u,x);return x},dTe=s=>s?vJ(s):vJ;var are={exports:{}},ore={},cre={exports:{}},lre={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gy=H;function uTe(s,n){return s===n&&(s!==0||1/s===1/n)||s!==s&&n!==n}var hTe=typeof Object.is=="function"?Object.is:uTe,pTe=gy.useState,fTe=gy.useEffect,mTe=gy.useLayoutEffect,gTe=gy.useDebugValue;function _Te(s,n){var i=n(),l=pTe({inst:{value:i,getSnapshot:n}}),u=l[0].inst,p=l[1];return mTe(function(){u.value=i,u.getSnapshot=n,R4(u)&&p({inst:u})},[s,i,n]),fTe(function(){return R4(u)&&p({inst:u}),s(function(){R4(u)&&p({inst:u})})},[s]),gTe(i),i}function R4(s){var n=s.getSnapshot;s=s.value;try{var i=n();return!hTe(s,i)}catch{return!0}}function vTe(s,n){return n()}var ETe=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?vTe:_Te;lre.useSyncExternalStore=gy.useSyncExternalStore!==void 0?gy.useSyncExternalStore:ETe;cre.exports=lre;var yTe=cre.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cO=H,bTe=yTe;function xTe(s,n){return s===n&&(s!==0||1/s===1/n)||s!==s&&n!==n}var wTe=typeof Object.is=="function"?Object.is:xTe,STe=bTe.useSyncExternalStore,TTe=cO.useRef,RTe=cO.useEffect,CTe=cO.useMemo,NTe=cO.useDebugValue;ore.useSyncExternalStoreWithSelector=function(s,n,i,l,u){var p=TTe(null);if(p.current===null){var g={hasValue:!1,value:null};p.current=g}else g=p.current;p=CTe(function(){function x(G){if(!C){if(C=!0,k=G,G=l(G),u!==void 0&&g.hasValue){var B=g.value;if(u(B,G))return A=B}return A=G}if(B=A,wTe(k,G))return B;var X=l(G);return u!==void 0&&u(B,X)?(k=G,B):(k=G,A=X)}var C=!1,k,A,M=i===void 0?null:i;return[function(){return x(n())},M===null?void 0:function(){return x(M())}]},[n,i,l,u]);var y=STe(s,p[0],p[1]);return RTe(function(){g.hasValue=!0,g.value=y},[y]),NTe(y),y};are.exports=ore;var ITe=are.exports;const ATe=xV(ITe),dre={},{useDebugValue:kTe}=CV,{useSyncExternalStoreWithSelector:OTe}=ATe;let EJ=!1;const DTe=s=>s;function PTe(s,n=DTe,i){(dre?"production":void 0)!=="production"&&i&&!EJ&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),EJ=!0);const l=OTe(s.subscribe,s.getState,s.getServerState||s.getInitialState,n,i);return kTe(l),l}const LTe=s=>{(dre?"production":void 0)!=="production"&&typeof s!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const n=typeof s=="function"?dTe(s):s,i=(l,u)=>PTe(n,l,u);return Object.assign(i,n),i},ure=s=>LTe,jTe={};function hre(s,n){let i;try{i=s()}catch{return}return{getItem:u=>{var p;const g=x=>x===null?null:JSON.parse(x,void 0),y=(p=i.getItem(u))!=null?p:null;return y instanceof Promise?y.then(g):g(y)},setItem:(u,p)=>i.setItem(u,JSON.stringify(p,void 0)),removeItem:u=>i.removeItem(u)}}const XS=s=>n=>{try{const i=s(n);return i instanceof Promise?i:{then(l){return XS(l)(i)},catch(l){return this}}}catch(i){return{then(l){return this},catch(l){return XS(l)(i)}}}},MTe=(s,n)=>(i,l,u)=>{let p={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:Z=>Z,version:0,merge:(Z,q)=>({...q,...Z}),...n},g=!1;const y=new Set,x=new Set;let C;try{C=p.getStorage()}catch{}if(!C)return s((...Z)=>{console.warn(`[zustand persist middleware] Unable to update item '${p.name}', the given storage is currently unavailable.`),i(...Z)},l,u);const k=XS(p.serialize),A=()=>{const Z=p.partialize({...l()});let q;const V=k({state:Z,version:p.version}).then(ee=>C.setItem(p.name,ee)).catch(ee=>{q=ee});if(q)throw q;return V},M=u.setState;u.setState=(Z,q)=>{M(Z,q),A()};const G=s((...Z)=>{i(...Z),A()},l,u);let B;const X=()=>{var Z;if(!C)return;g=!1,y.forEach(V=>V(l()));const q=((Z=p.onRehydrateStorage)==null?void 0:Z.call(p,l()))||void 0;return XS(C.getItem.bind(C))(p.name).then(V=>{if(V)return p.deserialize(V)}).then(V=>{if(V)if(typeof V.version=="number"&&V.version!==p.version){if(p.migrate)return p.migrate(V.state,V.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return V.state}).then(V=>{var ee;return B=p.merge(V,(ee=l())!=null?ee:G),i(B,!0),A()}).then(()=>{q==null||q(B,void 0),g=!0,x.forEach(V=>V(B))}).catch(V=>{q==null||q(void 0,V)})};return u.persist={setOptions:Z=>{p={...p,...Z},Z.getStorage&&(C=Z.getStorage())},clearStorage:()=>{C==null||C.removeItem(p.name)},getOptions:()=>p,rehydrate:()=>X(),hasHydrated:()=>g,onHydrate:Z=>(y.add(Z),()=>{y.delete(Z)}),onFinishHydration:Z=>(x.add(Z),()=>{x.delete(Z)})},X(),B||G},UTe=(s,n)=>(i,l,u)=>{let p={storage:hre(()=>localStorage),partialize:X=>X,version:0,merge:(X,Z)=>({...Z,...X}),...n},g=!1;const y=new Set,x=new Set;let C=p.storage;if(!C)return s((...X)=>{console.warn(`[zustand persist middleware] Unable to update item '${p.name}', the given storage is currently unavailable.`),i(...X)},l,u);const k=()=>{const X=p.partialize({...l()});return C.setItem(p.name,{state:X,version:p.version})},A=u.setState;u.setState=(X,Z)=>{A(X,Z),k()};const M=s((...X)=>{i(...X),k()},l,u);u.getInitialState=()=>M;let G;const B=()=>{var X,Z;if(!C)return;g=!1,y.forEach(V=>{var ee;return V((ee=l())!=null?ee:M)});const q=((Z=p.onRehydrateStorage)==null?void 0:Z.call(p,(X=l())!=null?X:M))||void 0;return XS(C.getItem.bind(C))(p.name).then(V=>{if(V)if(typeof V.version=="number"&&V.version!==p.version){if(p.migrate)return[!0,p.migrate(V.state,V.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,V.state];return[!1,void 0]}).then(V=>{var ee;const[de,ae]=V;if(G=p.merge(ae,(ee=l())!=null?ee:M),i(G,!0),de)return k()}).then(()=>{q==null||q(G,void 0),G=l(),g=!0,x.forEach(V=>V(G))}).catch(V=>{q==null||q(void 0,V)})};return u.persist={setOptions:X=>{p={...p,...X},X.storage&&(C=X.storage)},clearStorage:()=>{C==null||C.removeItem(p.name)},getOptions:()=>p,rehydrate:()=>B(),hasHydrated:()=>g,onHydrate:X=>(y.add(X),()=>{y.delete(X)}),onFinishHydration:X=>(x.add(X),()=>{x.delete(X)})},p.skipHydration||B(),G||M},VTe=(s,n)=>"getStorage"in n||"serialize"in n||"deserialize"in n?((jTe?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),MTe(s,n)):UTe(s,n),pre=VTe,FTe=()=>{const s=localStorage.getItem("delulu-language");if(s&&["de","en","es","fr","pt"].includes(s))return s;const n=navigator.language.split("-")[0];return["de","en","es","fr","pt"].includes(n)?n:"en"},mr=ure()(pre(s=>({user:null,isAuthenticated:!1,isLoading:!0,location:null,locationError:null,locationPermission:null,nearbyUsers:[],searchRadius:500,isDiscovering:!1,chats:[],activeChat:null,language:FTe(),showXPToast:!1,xpToastAmount:0,xpToastReason:"",starProfile:null,starApplication:null,liveStarEvents:[],newsTicker:[],isVerifiedStar:!1,setUser:n=>s({user:n,isAuthenticated:!!n}),setLocation:n=>s({location:n}),setLocationError:n=>s({locationError:n}),setLocationPermission:n=>s({locationPermission:n}),setNearbyUsers:n=>s({nearbyUsers:n}),setSearchRadius:n=>s({searchRadius:n}),setIsDiscovering:n=>s({isDiscovering:n}),setChats:n=>s({chats:n}),setActiveChat:n=>s({activeChat:n}),setIsLoading:n=>s({isLoading:n}),setLanguage:n=>{localStorage.setItem("delulu-language",n),s({language:n})},showXPGain:(n,i)=>s({showXPToast:!0,xpToastAmount:n,xpToastReason:i}),hideXPToast:()=>s({showXPToast:!1}),logout:()=>s({user:null,isAuthenticated:!1,location:null,nearbyUsers:[],chats:[],activeChat:null,starProfile:null,starApplication:null,isVerifiedStar:!1}),setStarProfile:n=>s({starProfile:n,isVerifiedStar:!!n}),setStarApplication:n=>s({starApplication:n}),setLiveStarEvents:n=>s({liveStarEvents:n}),setNewsTicker:n=>s({newsTicker:n})}),{name:"delulu-store",storage:hre(()=>localStorage),partialize:s=>({user:s.user,isAuthenticated:s.isAuthenticated,language:s.language,searchRadius:s.searchRadius}),onRehydrateStorage:()=>s=>{var n;(n=s==null?void 0:s.user)!=null&&n.avatarUrl&&console.log("[Store] User rehydrated with avatar:",s.user.avatarUrl.slice(0,50)+"...")}})),JE={maintenanceMode:!1,maintenanceMessage:"Wir machen eine kurze Pause, um das System fr dich zu perfektionieren. Gleich geht's weiter! ",maintenanceStartedAt:null,maintenanceEstimatedEnd:null,features:{referralSystem:!0,premiumPurchases:!1,voiceChat:!0,anonymousMode:!0,starEvents:!0},limits:{maxUsersPerRoom:8,maxRoomsPerUser:3,maxDailyXP:1e3,maxLevel:500,referralLinksPerUser:5},levelConfig:{baseXP:100,exponent:1.5,maxLevel:500,prestigeUnlockLevel:500,communityPrestigeThreshold:400},referralConfig:{linksPerUser:5,xpPerReferral:500,premiumDaysPerReferral:7,socialMultiplierEnabled:!0},updatedAt:new Date,updatedBy:"system"},fre="system/config",mre=async(s,n)=>{try{const i=at(Me,fre);await yo(i,{...s,updatedAt:new Date,updatedBy:n},{merge:!0})}catch(i){throw i}},BTe=async(s,n,i,l)=>{const u={maintenanceMode:s,maintenanceStartedAt:s?new Date:null,maintenanceEstimatedEnd:s&&l?new Date(Date.now()+l*60*1e3):null};i&&(u.maintenanceMessage=i),await mre(u,n)},zTe=s=>{const n=at(Me,fre);return qa(n,i=>{var l,u,p;if(i.exists()){const g=i.data();s({...JE,...g,maintenanceStartedAt:((l=g.maintenanceStartedAt)==null?void 0:l.toDate())||null,maintenanceEstimatedEnd:((u=g.maintenanceEstimatedEnd)==null?void 0:u.toDate())||null,updatedAt:((p=g.updatedAt)==null?void 0:p.toDate())||new Date})}else s(JE)},i=>{console.warn("System config listener error, using defaults:",i.message),s(JE)})},yJ=()=>{const s="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";let n="";for(let i=0;i<5;i++)n+=s.charAt(Math.floor(Math.random()*s.length));return`DELULU-${n}`},GTe=()=>`ref_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,lO=async s=>{var g;const n=at(Me,"referrals",s),i=await fr(n);if(i.exists()){const y=i.data();return{...y,links:y.links.map(x=>{var C,k;return{...x,createdAt:((C=x.createdAt)==null?void 0:C.toDate())||new Date,usedAt:((k=x.usedAt)==null?void 0:k.toDate())||null}}),createdAt:((g=y.createdAt)==null?void 0:g.toDate())||new Date}}const l=[],u=new Set;for(let y=0;y<JE.referralConfig.linksPerUser;y++){let x=yJ();for(;u.has(x);)x=yJ();u.add(x),l.push({id:GTe(),code:x,createdAt:new Date,usedBy:null,usedAt:null,isActive:!0})}const p={userId:s,links:l,referredBy:null,referredByCode:null,totalReferrals:0,xpEarned:0,premiumDaysEarned:0,createdAt:new Date};return await yo(n,{...p,links:l.map(y=>({...y,createdAt:cn.fromDate(y.createdAt)})),createdAt:cn.fromDate(p.createdAt)}),p},gre=async s=>{var u;const n=at(Me,"referrals",s),i=await fr(n);if(!i.exists())return null;const l=i.data();return{...l,links:l.links.map(p=>{var g,y;return{...p,createdAt:((g=p.createdAt)==null?void 0:g.toDate())||new Date,usedAt:((y=p.usedAt)==null?void 0:y.toDate())||null}}),createdAt:((u=l.createdAt)==null?void 0:u.toDate())||new Date}},PF=async s=>{var u,p;const n=s.toUpperCase().trim(),i=xn(Me,"referrals"),l=await Ur(i);for(const g of l.docs){const C=(g.data().links||[]).find(k=>k.code===n&&k.isActive&&!k.usedBy);if(C)return{ownerId:g.id,link:{...C,createdAt:((u=C.createdAt)==null?void 0:u.toDate())||new Date,usedAt:((p=C.usedAt)==null?void 0:p.toDate())||null}}}return null},_re=async(s,n,i)=>{try{const l=await PF(s);if(!l)return{success:!1,error:"Ungltiger oder bereits verwendeter Code"};if(l.ownerId===n)return{success:!1,error:"Du kannst deinen eigenen Code nicht verwenden"};const u=at(Me,"referrals",l.ownerId),p=await fr(u);if(!p.exists())return{success:!1,error:"Referrer nicht gefunden"};const g=p.data(),y=JE.referralConfig,x=g.links.map(M=>M.code===s.toUpperCase().trim()?{...M,usedBy:n,usedAt:cn.fromDate(new Date),isActive:!1}:M);await Kn(u,{links:x,totalReferrals:ta(1),xpEarned:ta(y.xpPerReferral),premiumDaysEarned:ta(y.premiumDaysPerReferral)});const C=at(Me,"users",l.ownerId);await Kn(C,{xp:ta(y.xpPerReferral),referralCount:ta(1)});const k=at(Me,"referrals",n);await lO(n),await Kn(k,{referredBy:l.ownerId,referredByCode:s.toUpperCase().trim()});const A=at(Me,"users",n);return await Kn(A,{xp:ta(y.xpPerReferral/2)}),{success:!0,referrerId:l.ownerId,xpAwarded:y.xpPerReferral,premiumDaysAwarded:y.premiumDaysPerReferral}}catch{return{success:!1,error:"Fehler beim Einlsen des Codes"}}},ST=async s=>{const n=await gre(s);if(!n)return{totalLinks:0,usedLinks:0,availableLinks:0,totalReferrals:0,xpEarned:0,premiumDaysEarned:0};const i=n.links.filter(u=>u.usedBy!==null).length,l=n.links.filter(u=>u.isActive&&!u.usedBy).length;return{totalLinks:n.links.length,usedLinks:i,availableLinks:l,totalReferrals:n.totalReferrals,xpEarned:n.xpEarned,premiumDaysEarned:n.premiumDaysEarned}},vre=s=>`${window.location.origin}/register?ref=${encodeURIComponent(s)}`,Ere=async s=>{try{const n=vre(s);return await navigator.clipboard.writeText(n),!0}catch{return!1}},WTe=async(s,n)=>{const i=vre(s),l={title:"Komm zu delulu! ",text:`${n} ldt dich zu delulu ein - dem hyperlocal Community Network! Nutze meinen exklusiven Einladungslink:`,url:i};try{return navigator.share&&navigator.canShare(l)?(await navigator.share(l),!0):await Ere(s)}catch{return!1}},yre="delulu_avatar_cache",bre=168,lV="delulu_avatar_permanent",dO=()=>{try{const s=localStorage.getItem(yre);return s?JSON.parse(s):{}}catch{return{}}},LF=s=>{try{localStorage.setItem(yre,JSON.stringify(s))}catch{console.warn("Avatar cache storage full, clearing old entries"),HTe()}},HTe=()=>{const s=dO(),n=Date.now(),i=bre*60*60*1e3,l={};for(const[u,p]of Object.entries(s))n-p.timestamp<i&&(l[u]=p);LF(l)},KTe=s=>{const i=dO()[s];if(!i)return null;const l=Date.now(),u=bre*60*60*1e3;return l-i.timestamp>u,i.url},Wd=(s,n)=>{if(!n||!s)return;const i=dO();i[s]={url:n,timestamp:Date.now(),userId:s},LF(i)},qTe=async(s,n)=>{if(!(!n||!s))try{const l=await(await fetch(n)).blob(),u=new FileReader;return new Promise(p=>{u.onloadend=()=>{const g=u.result,y=dO();y[s]={url:n,blob:g,timestamp:Date.now(),userId:s},LF(y),p()},u.readAsDataURL(l)})}catch{Wd(s,n)}},jF="delulu_session_avatar",E_=s=>{try{sessionStorage.setItem(jF,s)}catch{}},xre=()=>{try{return sessionStorage.getItem(jF)}catch{return null}},YTe=()=>{try{sessionStorage.removeItem(jF)}catch{}},Zh=(s,n)=>{try{const i=JSON.parse(localStorage.getItem(lV)||"{}");i[s]={url:n.url||(n.type==="preset"?`/avatars/${n.presetId}.png`:""),type:n.type,presetId:n.presetId,userId:s,updatedAt:Date.now()},localStorage.setItem(lV,JSON.stringify(i))}catch(i){console.warn("Failed to store permanent avatar:",i)}},wre=s=>{try{return JSON.parse(localStorage.getItem(lV)||"{}")[s]||null}catch{return null}},KA=(s,n,i)=>{const l=xre();if(l)return{url:l,type:"custom"};const u=wre(s);if(u)return{url:u.url,type:u.type};const p=KTe(s);if(p)return{url:p,type:"custom"};if(n)return Zh(s,{url:n,type:"custom"}),Wd(s,n),{url:n,type:"custom"};if(i){const g=`/avatars/${i}.png`;return Zh(s,{type:"preset",presetId:i,url:g}),{url:g,type:"preset"}}return{url:"/avatars/pegasus.png",type:"default"}},bJ=["yunghundse@gmail.com","jan@butterbread.de","founder@delulu.app"],TT=()=>{const{user:s,isAuthenticated:n,isLoading:i,setUser:l,setIsLoading:u,logout:p}=mr();return H.useEffect(()=>{lye(Fi).then(M=>{M!=null&&M.user&&console.log("Google redirect login successful")}).catch(M=>{console.error("Redirect result error:",M)});const A=LEe(Fi,async M=>{var G,B;if(M){const X=await fr(at(Me,"users",M.uid));if(X.exists()){const Z=X.data(),q=bJ.includes(((G=M.email)==null?void 0:G.toLowerCase())||""),V=Z.avatarUrl||M.photoURL;if(V&&M.uid)Zh(M.uid,{url:V,type:"custom"}),Wd(M.uid,V),E_(V);else if(Z.avatar){const ee=`/avatars/${Z.avatar}.png`;Zh(M.uid,{type:"preset",presetId:Z.avatar,url:ee}),Wd(M.uid,ee)}l({...Z,id:M.uid,isAdmin:q})}else{const Z={email:M.email||"",username:`user_${M.uid.slice(0,8)}`,displayName:M.displayName||"Anonymous",avatarUrl:M.photoURL||null,visibilityMode:"anonymous",isActive:!0,lastSeen:new Date,createdAt:new Date},q={email:Z.email,username:Z.username,displayName:Z.displayName,visibilityMode:Z.visibilityMode,isActive:Z.isActive,lastSeen:Uo(),createdAt:Uo()};M.photoURL&&(q.avatarUrl=M.photoURL,Zh(M.uid,{url:M.photoURL,type:"custom"}),Wd(M.uid,M.photoURL),E_(M.photoURL)),await yo(at(Me,"users",M.uid),q);const V=bJ.includes(((B=M.email)==null?void 0:B.toLowerCase())||"");l({...Z,id:M.uid,isAdmin:V})}}else l(null);u(!1)});return()=>A()},[l,u]),{user:s,isAuthenticated:n,isLoading:i,signIn:async(A,M)=>{try{return await OEe(Fi,A,M),{success:!0}}catch(G){let B="Login fehlgeschlagen";return G.code==="auth/invalid-credential"||G.code==="auth/wrong-password"?B="E-Mail oder Passwort ist falsch":G.code==="auth/user-not-found"?B="Kein Account mit dieser E-Mail gefunden":G.code==="auth/invalid-email"?B="Ungltige E-Mail-Adresse":G.code==="auth/too-many-requests"?B="Zu viele Versuche. Bitte warte einen Moment.":G.code==="auth/user-disabled"&&(B="Dieser Account wurde deaktiviert"),{success:!1,error:B}}},signUp:async(A,M,G,B)=>{try{const X=await ite(Fi,A,M),Z={email:A,username:G,displayName:G,visibilityMode:"anonymous",isActive:!0,xp:0,level:1,lastSeen:Uo(),createdAt:Uo()};if(await yo(at(Me,"users",X.user.uid),Z),await lO(X.user.uid),B)try{await _re(B,X.user.uid,G)}catch(q){console.log("Referral processing failed:",q)}return{success:!0}}catch(X){let Z="Registrierung fehlgeschlagen";return X.code==="auth/email-already-in-use"?Z="Diese E-Mail ist bereits registriert":X.code==="auth/invalid-email"?Z="Ungltige E-Mail-Adresse":X.code==="auth/weak-password"?Z="Passwort muss mindestens 6 Zeichen haben":X.code==="auth/operation-not-allowed"&&(Z="Registrierung ist momentan nicht mglich"),{success:!1,error:Z}}},signInWithGoogle:async()=>{try{const A=new Bd;A.setCustomParameters({prompt:"select_account"});try{return await gte(Fi,A),{success:!0}}catch(M){if(M.code==="auth/popup-blocked"||M.code==="auth/popup-closed-by-user"||M.code==="auth/cancelled-popup-request")return console.log("Popup blocked, using redirect..."),await oye(Fi,A),{success:!0};throw M}}catch(A){let M="Google Login fehlgeschlagen";return A.code==="auth/popup-closed-by-user"?M="Login abgebrochen":A.code==="auth/account-exists-with-different-credential"?M="Ein Account mit dieser E-Mail existiert bereits":A.code==="auth/network-request-failed"&&(M="Netzwerkfehler - bitte prfe deine Verbindung"),{success:!1,error:M}}},resetPassword:async A=>{try{return await NEe(Fi,A),{success:!0}}catch(M){let G="Fehler beim Zurcksetzen des Passworts";return M.code==="auth/user-not-found"?G="Kein Account mit dieser E-Mail gefunden":M.code==="auth/invalid-email"&&(G="Ungltige E-Mail-Adresse"),{success:!1,error:G}}},logout:async()=>{try{return await ate(Fi),p(),{success:!0}}catch(A){return{success:!1,error:A.message}}}}},Sre=()=>{const s=H.useRef(null),n=H.useCallback(()=>(s.current||(s.current=new(window.AudioContext||window.webkitAudioContext)),s.current),[]),i=H.useCallback((k,A,M="sine",G=.3)=>{try{const B=n();B.state==="suspended"&&B.resume();const X=B.createOscillator(),Z=B.createGain();X.connect(Z),Z.connect(B.destination),X.type=M,X.frequency.setValueAtTime(k,B.currentTime),Z.gain.setValueAtTime(0,B.currentTime),Z.gain.linearRampToValueAtTime(G,B.currentTime+.02),Z.gain.linearRampToValueAtTime(0,B.currentTime+A),X.start(B.currentTime),X.stop(B.currentTime+A)}catch{}},[n]),l=H.useCallback(()=>{i(523.25,.1,"sine",.2),setTimeout(()=>i(659.25,.1,"sine",.2),80),setTimeout(()=>i(783.99,.15,"sine",.25),160)},[i]),u=H.useCallback(()=>{i(523.25,.1,"sine",.15),setTimeout(()=>i(392,.15,"sine",.1),100)},[i]),p=H.useCallback(()=>{i(440,.15,"square",.15),setTimeout(()=>i(440,.15,"square",.15),200),setTimeout(()=>i(440,.15,"square",.15),400)},[i]),g=H.useCallback(()=>{i(880,.08,"sine",.2),setTimeout(()=>i(1108.73,.12,"sine",.25),60)},[i]),y=H.useCallback(()=>{i(220,.2,"sawtooth",.1)},[i]),x=H.useCallback(k=>{k?(i(440,.08,"sine",.15),setTimeout(()=>i(330,.1,"sine",.1),50)):(i(330,.08,"sine",.15),setTimeout(()=>i(440,.1,"sine",.15),50))},[i]),C=H.useCallback(()=>{i(587.33,.1,"sine",.2),setTimeout(()=>i(880,.15,"sine",.25),100)},[i]);return{playJoinSound:l,playLeaveSound:u,playWarningSound:p,playXPSound:g,playErrorSound:y,playMuteSound:x,playNotificationSound:C}},Tre=()=>{const[s,n]=H.useState(JE),[i,l]=H.useState(!0);return H.useEffect(()=>{let u=!1;const p=setTimeout(()=>{i&&(console.warn("System config timeout - using defaults"),u=!0,l(!1))},3e3),g=zTe(y=>{u||(clearTimeout(p),n(y),l(!1))});return()=>{clearTimeout(p),g()}},[]),{config:s,isLoading:i,isMaintenanceMode:s.maintenanceMode,maintenanceMessage:s.maintenanceMessage,maintenanceEstimatedEnd:s.maintenanceEstimatedEnd,features:s.features,limits:s.limits,levelConfig:s.levelConfig,referralConfig:s.referralConfig}};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var XTe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $Te=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),ot=(s,n)=>{const i=H.forwardRef(({color:l="currentColor",size:u=24,strokeWidth:p=2,absoluteStrokeWidth:g,className:y="",children:x,...C},k)=>H.createElement("svg",{ref:k,...XTe,width:u,height:u,stroke:l,strokeWidth:g?Number(p)*24/Number(u):p,className:["lucide",`lucide-${$Te(s)}`,y].join(" "),...C},[...n.map(([A,M])=>H.createElement(A,M)),...Array.isArray(x)?x:[x]]));return i.displayName=`${s}`,i};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dV=ot("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MF=ot("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ql=ot("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sa=ot("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UF=ot("AtSign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fS=ot("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rre=ot("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mS=ot("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xc=ot("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JTe=ot("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VF=ot("Cake",[["path",{d:"M20 21v-8a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v8",key:"1w3rig"}],["path",{d:"M4 16s.5-1 2-1 2.5 2 4 2 2.5-2 4-2 2.5 2 4 2 2-1 2-1",key:"n2jgmb"}],["path",{d:"M2 21h20",key:"1nyx9w"}],["path",{d:"M7 8v3",key:"1qtyvj"}],["path",{d:"M12 8v3",key:"hwp4zt"}],["path",{d:"M17 8v3",key:"1i6e5u"}],["path",{d:"M7 4h0.01",key:"hsw7lv"}],["path",{d:"M12 4h0.01",key:"1e3d8f"}],["path",{d:"M17 4h0.01",key:"p7cxgy"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rm=ot("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QTe=ot("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vu=ot("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C4=ot("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zn=ot("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uO=ot("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gu=ot("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=ot("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gi=ot("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sm=ot("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZTe=ot("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uV=ot("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cre=ot("Compass",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76",key:"m9r19z"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FF=ot("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=ot("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hV=ot("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eRe=ot("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tRe=ot("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $c=ot("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ta=ot("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ck=ot("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nre=ot("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ire=ot("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nRe=ot("Gamepad2",[["line",{x1:"6",x2:"10",y1:"11",y2:"11",key:"1gktln"}],["line",{x1:"8",x2:"8",y1:"9",y2:"13",key:"qnk9ow"}],["line",{x1:"15",x2:"15.01",y1:"12",y2:"12",key:"krot7o"}],["line",{x1:"18",x2:"18.01",y1:"10",y2:"10",key:"1lcuu1"}],["path",{d:"M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z",key:"mfqc10"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xJ=ot("Ghost",[["path",{d:"M9 10h.01",key:"qbtxuw"}],["path",{d:"M15 10h.01",key:"1qmjsl"}],["path",{d:"M12 2a8 8 0 0 0-8 8v12l3-3 2.5 2.5L12 19l2.5 2.5L17 19l3 3V10a8 8 0 0 0-8-8z",key:"uwwb07"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ra=ot("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D_=ot("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rRe=ot("GraduationCap",[["path",{d:"M22 10v6M2 10l10-5 10 5-10 5z",key:"1ef52a"}],["path",{d:"M6 12v5c3 3 9 3 12 0v-5",key:"1f75yj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pV=ot("Hand",[["path",{d:"M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0",key:"aigmz7"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v2",key:"1n6bmn"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8",key:"a9iiix"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sRe=ot("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RT=ot("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Are=ot("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iRe=ot("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aRe=ot("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oRe=ot("Instagram",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wJ=ot("Laptop",[["path",{d:"M20 16V7a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v9m16 0H4m16 0 1.28 2.55a1 1 0 0 1-.9 1.45H3.62a1 1 0 0 1-.9-1.45L4 16",key:"tarvll"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SJ=ot("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cRe=ot("Linkedin",[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Br=ot("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hi=ot("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hO=ot("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _y=ot("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _c=ot("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V_=ot("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lRe=ot("Mic2",[["path",{d:"m12 8-9.04 9.06a2.82 2.82 0 1 0 3.98 3.98L16 12",key:"zoua8r"}],["circle",{cx:"17",cy:"7",r:"5",key:"1fomce"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TJ=ot("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eh=ot("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dRe=ot("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uRe=ot("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hRe=ot("Music2",[["circle",{cx:"8",cy:"18",r:"4",key:"1fc0mg"}],["path",{d:"M12 18V2l7 4",key:"g04rme"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pRe=ot("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N4=ot("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QE=ot("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fRe=ot("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kre=ot("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $S=ot("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mRe=ot("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fV=ot("Radar",[["path",{d:"M19.07 4.93A10 10 0 0 0 6.99 3.34",key:"z3du51"}],["path",{d:"M4 6h.01",key:"oypzma"}],["path",{d:"M2.29 9.62A10 10 0 1 0 21.31 8.35",key:"qzzz0"}],["path",{d:"M16.24 7.76A6 6 0 1 0 8.23 16.67",key:"1yjesh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M17.99 11.66A6 6 0 0 1 15.77 16.67",key:"1u2y91"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"m13.41 10.59 5.66-5.66",key:"mhq4k0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lk=ot("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gS=ot("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gRe=ot("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JS=ot("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QS=ot("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BF=ot("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _Re=ot("ShieldOff",[["path",{d:"M19.7 14a6.9 6.9 0 0 0 .3-2V5l-8-3-3.2 1.2",key:"342pvf"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M4.7 4.7 4 5v7c0 6 8 10 8 10a20.3 20.3 0 0 0 5.62-4.38",key:"p0ycf4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const li=ot("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ore=ot("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wr=ot("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=ot("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vRe=ot("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ERe=ot("Tablet",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["line",{x1:"12",x2:"12.01",y1:"18",y2:"18",key:"1dp563"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yRe=ot("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RJ=ot("ThumbsDown",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z",key:"s6e0r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bRe=ot("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jh=ot("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const im=ot("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mV=ot("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xRe=ot("Twitter",[["path",{d:"M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z",key:"pff0z6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wRe=ot("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const am=ot("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dre=ot("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CJ=ot("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SRe=ot("UserMinus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ep=ot("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dk=ot("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tp=ot("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rr=ot("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pre=ot("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pO=ot("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TRe=ot("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lre=ot("WifiOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 4.17-2.65",key:"11utq1"}],["path",{d:"M10.66 5c4.01-.36 8.14.9 11.34 3.76",key:"hxefdu"}],["path",{d:"M16.85 11.25a10 10 0 0 1 2.22 1.68",key:"q734kn"}],["path",{d:"M5 13a10 10 0 0 1 5.24-2.76",key:"piq4yl"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RRe=ot("Wifi",[["path",{d:"M5 13a10 10 0 0 1 14 0",key:"6v8j51"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CRe=ot("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=ot("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NRe=ot("Youtube",[["path",{d:"M2.5 17a24.12 24.12 0 0 1 0-10 2 2 0 0 1 1.4-1.4 49.56 49.56 0 0 1 16.2 0A2 2 0 0 1 21.5 7a24.12 24.12 0 0 1 0 10 2 2 0 0 1-1.4 1.4 49.55 49.55 0 0 1-16.2 0A2 2 0 0 1 2.5 17",key:"1q2vi4"}],["path",{d:"m10 15 5-3-5-3z",key:"1jp15x"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ei=ot("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),zc={de:{name:"German",flag:"",native:"Deutsch"},en:{name:"English",flag:"",native:"English"},es:{name:"Spanish",flag:"",native:"Espaol"},fr:{name:"French",flag:"",native:"Franais"},pt:{name:"Portuguese",flag:"",native:"Portugus"}},IRe={common:{save:{de:"Speichern",en:"Save",es:"Guardar",fr:"Enregistrer",pt:"Salvar"},cancel:{de:"Abbrechen",en:"Cancel",es:"Cancelar",fr:"Annuler",pt:"Cancelar"},confirm:{de:"Besttigen",en:"Confirm",es:"Confirmar",fr:"Confirmer",pt:"Confirmar"},delete:{de:"Lschen",en:"Delete",es:"Eliminar",fr:"Supprimer",pt:"Excluir"},edit:{de:"Bearbeiten",en:"Edit",es:"Editar",fr:"Modifier",pt:"Editar"},back:{de:"Zurck",en:"Back",es:"Atrs",fr:"Retour",pt:"Voltar"},next:{de:"Weiter",en:"Next",es:"Siguiente",fr:"Suivant",pt:"Prximo"},done:{de:"Fertig",en:"Done",es:"Hecho",fr:"Termin",pt:"Concludo"},loading:{de:"Ldt...",en:"Loading...",es:"Cargando...",fr:"Chargement...",pt:"Carregando..."},retry:{de:"Erneut versuchen",en:"Retry",es:"Reintentar",fr:"Ressayer",pt:"Tentar novamente"}},nav:{home:{de:"Home",en:"Home",es:"Inicio",fr:"Accueil",pt:"Incio"},discover:{de:"Entdecken",en:"Discover",es:"Descubrir",fr:"Dcouvrir",pt:"Descobrir"},messages:{de:"Nachrichten",en:"Messages",es:"Mensajes",fr:"Messages",pt:"Mensagens"},profile:{de:"Profil",en:"Profile",es:"Perfil",fr:"Profil",pt:"Perfil"}},profile:{title:{de:"Profil",en:"Profile",es:"Perfil",fr:"Profil",pt:"Perfil"},editProfile:{de:"Profil bearbeiten",en:"Edit Profile",es:"Editar perfil",fr:"Modifier le profil",pt:"Editar perfil"},bioPlaceholder:{de:"Erzhl was ber dich...",en:"Tell us about yourself...",es:"Cuntanos sobre ti...",fr:"Parlez-nous de vous...",pt:"Conte-nos sobre voc..."},noBio:{de:"Keine Bio. Ein Mensch der Geheimnisse.",en:"No bio. A person of mystery.",es:"Sin bio. Una persona misteriosa.",fr:"Pas de bio. Une personne mystrieuse.",pt:"Sem bio. Uma pessoa misteriosa."},stats:{friends:{de:"Freunde",en:"Friends",es:"Amigos",fr:"Amis",pt:"Amigos"},trust:{de:"Trust",en:"Trust",es:"Confianza",fr:"Confiance",pt:"Confiana"},voiceMin:{de:"Voice Min",en:"Voice Min",es:"Min de Voz",fr:"Min Vocal",pt:"Min de Voz"}},logout:{de:"Abmelden",en:"Log out",es:"Cerrar sesin",fr:"Dconnexion",pt:"Sair"},loggingOut:{de:"Wird abgemeldet...",en:"Logging out...",es:"Cerrando sesin...",fr:"Dconnexion...",pt:"Saindo..."}},level:{level:{de:"Level",en:"Level",es:"Nivel",fr:"Niveau",pt:"Nvel"},xpToNext:{de:"XP zum nchsten Level",en:"XP to next level",es:"XP para el siguiente nivel",fr:"XP pour le prochain niveau",pt:"XP para o prximo nvel"},titles:{newcomer:{de:"Newcomer",en:"Newcomer",es:"Novato",fr:"Nouveau",pt:"Novato"},dreamer:{de:"Dreamer",en:"Dreamer",es:"Soador",fr:"Rveur",pt:"Sonhador"},connector:{de:"Connector",en:"Connector",es:"Conector",fr:"Connecteur",pt:"Conector"},socialite:{de:"Socialite",en:"Socialite",es:"Socialit",fr:"Mondain",pt:"Socialite"},influencer:{de:"Influencer",en:"Influencer",es:"Influencer",fr:"Influenceur",pt:"Influenciador"},legend:{de:"Legend",en:"Legend",es:"Leyenda",fr:"Lgende",pt:"Lenda"}},levelUp:{de:"Du bist jetzt offiziell weniger irrelevant. Willkommen auf Level {level}.",en:"You're officially less irrelevant now. Welcome to Level {level}.",es:"Ahora eres oficialmente menos irrelevante. Bienvenido al Nivel {level}.",fr:"Tu es officiellement moins insignifiant maintenant. Bienvenue au Niveau {level}.",pt:"Voc agora  oficialmente menos irrelevante. Bem-vindo ao Nvel {level}."}},streak:{title:{de:"Streak",en:"Streak",es:"Racha",fr:"Srie",pt:"Sequncia"},days:{de:"Tage",en:"days",es:"das",fr:"jours",pt:"dias"},xpBoost:{de:"XP Boost",en:"XP Boost",es:"Bonus de XP",fr:"Bonus XP",pt:"Bnus de XP"},lost:{de:"Streak verloren. Das war wohl nichts. Aber hey, morgen ist ein neuer Tag.",en:"Streak lost. That didn't work out. But hey, tomorrow's a new day.",es:"Racha perdida. Eso no funcion. Pero oye, maana es un nuevo da.",fr:"Srie perdue. a n'a pas march. Mais bon, demain est un autre jour.",pt:"Sequncia perdida. No deu certo. Mas ei, amanh  um novo dia."},frozen:{de:"Streak eingefroren. Ausnahmsweise.",en:"Streak frozen. Just this once.",es:"Racha congelada. Solo por esta vez.",fr:"Srie gele. Exceptionnellement.",pt:"Sequncia congelada. S desta vez."}},visibility:{title:{de:"Wer darf dich sehen?",en:"Who can see you?",es:"Quin puede verte?",fr:"Qui peut te voir?",pt:"Quem pode te ver?"},public:{title:{de:"Alle in Reichweite",en:"Everyone nearby",es:"Todos cerca",fr:"Tout le monde  proximit",pt:"Todos por perto"},description:{de:"Jeder im Radius kann dich sehen",en:"Anyone in range can see you",es:"Cualquiera en el rango puede verte",fr:"Tout le monde dans le rayon peut te voir",pt:"Qualquer um no raio pode te ver"},hint:{de:"Alle sehen dich. Kein Verstecken.",en:"Everyone sees you. No hiding.",es:"Todos te ven. Sin esconderse.",fr:"Tout le monde te voit. Pas de cachette.",pt:"Todos te veem. Sem se esconder."}},friends:{title:{de:"Nur meine Freunde",en:"Only my friends",es:"Solo mis amigos",fr:"Seulement mes amis",pt:"Apenas meus amigos"},description:{de:"Fremde sehen dich nicht",en:"Strangers can't see you",es:"Los extraos no pueden verte",fr:"Les inconnus ne te voient pas",pt:"Estranhos no podem te ver"},hint:{de:"Nur deine Freunde sehen dich. Exklusivclub.",en:"Only your friends see you. Exclusive club.",es:"Solo tus amigos te ven. Club exclusivo.",fr:"Seuls tes amis te voient. Club exclusif.",pt:"S seus amigos te veem. Clube exclusivo."}},ghost:{title:{de:"Niemand (Ghost Mode) ",en:"Nobody (Ghost Mode) ",es:"Nadie (Modo Fantasma) ",fr:"Personne (Mode Fantme) ",pt:"Ningum (Modo Fantasma) "},description:{de:"Du bist komplett unsichtbar",en:"You're completely invisible",es:"Eres completamente invisible",fr:"Tu es compltement invisible",pt:"Voc est completamente invisvel"},hint:{de:"Ghost Mode aktiv. Du existierst nicht. Sehr dramatisch.",en:"Ghost Mode active. You don't exist. Very dramatic.",es:"Modo Fantasma activo. No existes. Muy dramtico.",fr:"Mode Fantme actif. Tu n'existes pas. Trs dramatique.",pt:"Modo Fantasma ativo. Voc no existe. Muito dramtico."}}},friendRadar:{title:{de:"Friend-Radar",en:"Friend Radar",es:"Radar de Amigos",fr:"Radar Amis",pt:"Radar de Amigos"},description:{de:"Benachrichtigung im 10km Radius",en:"Notification within 10km radius",es:"Notificacin en radio de 10km",fr:"Notification dans un rayon de 10km",pt:"Notificao em raio de 10km"},notification:{de:"{name} ist im 10km-Radius. Keine Sorge, er kann dich nicht hren  es sei denn, du willst es.",en:"{name} is within 10km. Don't worry, they can't hear you  unless you want them to.",es:"{name} est a 10km. No te preocupes, no pueden orte  a menos que quieras.",fr:"{name} est  10km. T'inquite, ils ne peuvent pas t'entendre  sauf si tu le veux.",pt:"{name} est a 10km. No se preocupe, eles no podem te ouvir  a menos que voc queira."},enabled:{de:"Friend-Radar aktiv",en:"Friend Radar active",es:"Radar de Amigos activo",fr:"Radar Amis actif",pt:"Radar de Amigos ativo"},disabled:{de:"Friend-Radar aus. Du willst also berrascht werden? Mutig.",en:"Friend Radar off. So you want to be surprised? Bold.",es:"Radar de Amigos apagado. Quieres sorpresas? Valiente.",fr:"Radar Amis dsactiv. Tu veux tre surpris? Audacieux.",pt:"Radar de Amigos desligado. Quer ser surpreendido? Corajoso."}},radius:{title:{de:"Suchradius",en:"Search Radius",es:"Radio de Bsqueda",fr:"Rayon de Recherche",pt:"Raio de Busca"},description:{de:"Wie weit siehst du andere?",en:"How far can you see others?",es:"Qu tan lejos puedes ver a otros?",fr:" quelle distance peux-tu voir les autres?",pt:"At onde voc pode ver os outros?"},hint:{max:{de:"Maximale Reichweite. Viel Spa mit dem Chaos.",en:"Maximum range. Have fun with the chaos.",es:"Alcance mximo. Divirtete con el caos.",fr:"Porte maximale. Amuse-toi avec le chaos.",pt:"Alcance mximo. Divirta-se com o caos."},min:{de:"Nur die Nchsten. Sehr... intim.",en:"Only the closest. Very... intimate.",es:"Solo los ms cercanos. Muy... ntimo.",fr:"Seulement les plus proches. Trs... intime.",pt:"Apenas os mais prximos. Muito... ntimo."},default:{de:"Sollte reichen.",en:"Should be enough.",es:"Debera ser suficiente.",fr:"a devrait suffire.",pt:"Deve ser suficiente."}},error:{de:"Nett versucht, aber die Physik lsst sich nicht austricksen. Wir kalibrieren den Radius neu.",en:"Nice try, but you can't trick physics. We're recalibrating the radius.",es:"Buen intento, pero no puedes engaar a la fsica. Recalibrando el radio.",fr:"Bien essay, mais tu ne peux pas tromper la physique. On recalibre le rayon.",pt:"Boa tentativa, mas voc no pode enganar a fsica. Recalibrando o raio."}},premium:{title:{de:"CATALYST",en:"CATALYST",es:"CATALYST",fr:"CATALYST",pt:"CATALYST"},upsell:{de:"Hr auf zu schleichen. Hol dir den Catalyst und sieh genau, wer in deiner Nhe ist, bevor sie dich sehen.",en:"Stop lurking. Get Catalyst and see exactly who is near you before they see you.",es:"Deja de acechar. Obtn Catalyst y ve exactamente quin est cerca antes de que te vean.",fr:"Arrte de rder. Prends Catalyst et vois exactement qui est prs de toi avant qu'ils te voient.",pt:"Pare de espreitar. Obtenha o Catalyst e veja exatamente quem est perto antes que te vejam."},upgrade:{de:"Jetzt upgraden",en:"Upgrade now",es:"Actualizar ahora",fr:"Mettre  niveau",pt:"Atualizar agora"},features:{xpBoost:{de:"1.5x XP Boost  permanent",en:"1.5x XP Boost  permanent",es:"1.5x Bonus de XP  permanente",fr:"1.5x Bonus XP  permanent",pt:"1.5x Bnus de XP  permanente"},exactDistance:{de:"Meter-genaue Distanzanzeige",en:"Meter-precise distance display",es:"Distancia precisa en metros",fr:"Distance prcise au mtre",pt:"Distncia precisa em metros"},profileStalker:{de:"Sieh wer dein Profil besucht",en:"See who viewed your profile",es:"Ve quin visit tu perfil",fr:"Vois qui a visit ton profil",pt:"Veja quem visitou seu perfil"},priorityListing:{de:"Immer oben in der Liste",en:"Always at the top of the list",es:"Siempre arriba en la lista",fr:"Toujours en haut de la liste",pt:"Sempre no topo da lista"}}},settings:{title:{de:"Einstellungen",en:"Settings",es:"Configuracin",fr:"Paramtres",pt:"Configuraes"},blockedUsers:{de:"Blockierte Nutzer",en:"Blocked Users",es:"Usuarios Bloqueados",fr:"Utilisateurs Bloqus",pt:"Usurios Bloqueados"},myStats:{de:"Meine Statistiken",en:"My Statistics",es:"Mis Estadsticas",fr:"Mes Statistiques",pt:"Minhas Estatsticas"},notifications:{de:"Benachrichtigungen",en:"Notifications",es:"Notificaciones",fr:"Notifications",pt:"Notificaes"},appDesign:{de:"App-Design",en:"App Design",es:"Diseo de la App",fr:"Design de l'App",pt:"Design do App"},language:{de:"Sprache",en:"Language",es:"Idioma",fr:"Langue",pt:"Idioma"},help:{de:"Hilfe & FAQ",en:"Help & FAQ",es:"Ayuda y FAQ",fr:"Aide et FAQ",pt:"Ajuda e FAQ"}},moderation:{shadowMuted:{de:"Deine Vibes sind gerade ziemlich toxic. Wir haben dich mal kurz stummgeschaltet, damit die anderen in Ruhe weiterreden knnen. Atme mal tief durch.",en:"Your vibes are pretty toxic right now. We've muted you for a bit so others can chat in peace. Take a deep breath.",es:"Tus vibes son bastante txicas ahora. Te silenciamos un rato para que otros puedan charlar en paz. Respira hondo.",fr:"Tes vibes sont assez toxiques l. On t'a mis en sourdine pour que les autres puissent discuter tranquilles. Respire un coup.",pt:"Suas vibes esto bem txicas agora. Te silenciamos um pouco para os outros conversarem em paz. Respire fundo."},tempBanned:{de:"OK, das war's erstmal fr dich. Du bist fr {hours}h auf Eis gelegt. Nutz die Zeit, um ber deine Lebensentscheidungen nachzudenken.",en:"OK, that's it for now. You're on ice for {hours}h. Use the time to reflect on your life choices.",es:"OK, eso es todo por ahora. Ests en hielo por {hours}h. Usa el tiempo para reflexionar sobre tus decisiones de vida.",fr:"OK, c'est fini pour l'instant. Tu es sur glace pour {hours}h. Profite pour rflchir  tes choix de vie.",pt:"OK,  isso por agora. Voc est no gelo por {hours}h. Use o tempo para refletir sobre suas escolhas de vida."},warning:{de:"Heads up: Noch ein Ausrutscher und du landest auf der Bank. Deine Entscheidung.",en:"Heads up: One more slip and you're benched. Your call.",es:"Aviso: Un error ms y ests en la banca. Tu decisin.",fr:"Attention: Un faux pas de plus et tu es sur le banc.  toi de voir.",pt:"Aviso: Mais um deslize e voc vai pro banco. Sua deciso."}},errors:{generic:{de:"Irgendwas ist schiefgelaufen. Wahrscheinlich nicht deine Schuld. Wahrscheinlich.",en:"Something went wrong. Probably not your fault. Probably.",es:"Algo sali mal. Probablemente no es tu culpa. Probablemente.",fr:"Quelque chose s'est mal pass. Probablement pas ta faute. Probablement.",pt:"Algo deu errado. Provavelmente no  sua culpa. Provavelmente."},network:{de:"Keine Verbindung. Das Internet hat dich verlassen, nicht wir.",en:"No connection. The internet left you, not us.",es:"Sin conexin. Internet te dej, no nosotros.",fr:"Pas de connexion. Internet t'a quitt, pas nous.",pt:"Sem conexo. A internet te deixou, no ns."},location:{de:"GPS-Signal verloren. Vielleicht stehst du in einem Bunker?",en:"GPS signal lost. Maybe you're in a bunker?",es:"Seal GPS perdida. Quizs ests en un bnker?",fr:"Signal GPS perdu. T'es peut-tre dans un bunker?",pt:"Sinal GPS perdido. Talvez voc esteja em um bunker?"}},empty:{friends:{de:"Noch keine Freunde. Das lsst sich ndern  geh raus und quatsch Leute an.",en:"No friends yet. That can change  go out and talk to people.",es:"An sin amigos. Eso puede cambiar  sal y habla con la gente.",fr:"Pas encore d'amis. a peut changer  sors et parle aux gens.",pt:"Ainda sem amigos. Isso pode mudar  saia e fale com as pessoas."},nearbyUsers:{de:"Niemand in Reichweite. Entweder bist du allein, oder alle verstecken sich vor dir.",en:"No one in range. Either you're alone, or everyone's hiding from you.",es:"Nadie en rango. O ests solo, o todos se esconden de ti.",fr:"Personne  porte. Soit t'es seul, soit tout le monde se cache de toi.",pt:"Ningum no alcance. Ou voc est sozinho, ou todos esto se escondendo de voc."},messages:{de:"Keine Nachrichten. Die Stille ist ohrenbetubend.",en:"No messages. The silence is deafening.",es:"Sin mensajes. El silencio es ensordecedor.",fr:"Pas de messages. Le silence est assourdissant.",pt:"Sem mensagens. O silncio  ensurdecedor."}},avatar:{title:{de:"Whle deinen Avatar",en:"Choose your avatar",es:"Elige tu avatar",fr:"Choisis ton avatar",pt:"Escolha seu avatar"},subtitle:{de:"Dein Avatar wird anderen angezeigt",en:"Your avatar will be shown to others",es:"Tu avatar se mostrar a otros",fr:"Ton avatar sera montr aux autres",pt:"Seu avatar ser mostrado aos outros"},selected:{de:"Ausgewhlt",en:"Selected",es:"Seleccionado",fr:"Slectionn",pt:"Selecionado"}},trust:{trusted:{de:"TRUSTED",en:"TRUSTED",es:"CONFIABLE",fr:"FIABLE",pt:"CONFIVEL"},reliable:{de:"RELIABLE",en:"RELIABLE",es:"FIABLE",fr:"SRIEUX",pt:"CONFIVEL"},neutral:{de:"NEUTRAL",en:"NEUTRAL",es:"NEUTRAL",fr:"NEUTRE",pt:"NEUTRO"},caution:{de:"VORSICHT",en:"CAUTION",es:"PRECAUCIN",fr:"ATTENTION",pt:"CUIDADO"}}};function tl(){const{language:s,setLanguage:n}=mr(),i=H.useCallback((u,p)=>{const g=u.split(".");let y=IRe;for(const x of g)if(y&&typeof y=="object"&&x in y)y=y[x];else return console.warn(`Translation not found: ${u}`),u;if(y&&typeof y=="object"&&s in y){let x=y[s];return p&&Object.entries(p).forEach(([C,k])=>{x=x.replace(new RegExp(`{${C}}`,"g"),String(k))}),x}return console.warn(`Translation not found for language ${s}: ${u}`),u},[s]),l=H.useCallback(u=>{n(u),localStorage.setItem("delulu-language",u)},[n]);return{t:i,language:s,setLanguage:l,languages:zc,currentLanguage:zc[s]}}const zF=({className:s="",size:n=200})=>o.jsxs("svg",{width:n,height:n*1.3,viewBox:"0 0 200 260",className:s,children:[o.jsx("ellipse",{cx:"100",cy:"20",rx:"45",ry:"8",fill:"none",stroke:"url(#haloGradient)",strokeWidth:"3",opacity:"0.8"}),o.jsx("ellipse",{cx:"100",cy:"75",rx:"40",ry:"35",fill:"url(#hairGradient)"}),o.jsx("circle",{cx:"70",cy:"60",r:"15",fill:"url(#hairGradient)"}),o.jsx("circle",{cx:"130",cy:"60",r:"15",fill:"url(#hairGradient)"}),o.jsx("circle",{cx:"60",cy:"80",r:"12",fill:"url(#hairGradient)"}),o.jsx("circle",{cx:"140",cy:"80",r:"12",fill:"url(#hairGradient)"}),o.jsx("ellipse",{cx:"100",cy:"45",rx:"35",ry:"10",fill:"white",stroke:"#2d3748",strokeWidth:"2"}),o.jsx("rect",{x:"70",y:"35",width:"60",height:"12",fill:"white",stroke:"#2d3748",strokeWidth:"2"}),o.jsx("text",{x:"100",y:"46",textAnchor:"middle",fontSize:"10",fill:"#4a5568",children:""}),o.jsx("ellipse",{cx:"100",cy:"95",rx:"35",ry:"32",fill:"#fce4c4"}),o.jsx("ellipse",{cx:"85",cy:"90",rx:"8",ry:"10",fill:"white"}),o.jsx("ellipse",{cx:"115",cy:"90",rx:"8",ry:"10",fill:"white"}),o.jsx("circle",{cx:"85",cy:"92",r:"5",fill:"#2d3748"}),o.jsx("circle",{cx:"115",cy:"92",r:"5",fill:"#2d3748"}),o.jsx("circle",{cx:"87",cy:"90",r:"2",fill:"white"}),o.jsx("circle",{cx:"117",cy:"90",r:"2",fill:"white"}),o.jsx("path",{d:"M75 82 Q85 78 92 82",fill:"none",stroke:"#2d3748",strokeWidth:"2"}),o.jsx("path",{d:"M108 82 Q115 78 125 82",fill:"none",stroke:"#2d3748",strokeWidth:"2"}),o.jsx("path",{d:"M92 108 Q100 105 108 108",fill:"none",stroke:"#2d3748",strokeWidth:"2"}),o.jsx("path",{d:"M65 130 Q60 160 65 200 L135 200 Q140 160 135 130 Z",fill:"#2d3748"}),o.jsx("path",{d:"M70 130 L100 155 L130 130",fill:"none",stroke:"#5a7fa8",strokeWidth:"3"}),o.jsx("rect",{x:"75",y:"125",width:"50",height:"15",fill:"#2d3748"}),o.jsx("path",{d:"M95 145 L100 165 L105 145 Z",fill:"#a8d5e5"}),o.jsx("circle",{cx:"100",cy:"142",r:"5",fill:"#a8d5e5"}),o.jsx("rect",{x:"60",y:"175",width:"20",height:"3",fill:"#5a7fa8"}),o.jsx("rect",{x:"60",y:"180",width:"20",height:"3",fill:"#5a7fa8"}),o.jsx("rect",{x:"120",y:"175",width:"20",height:"3",fill:"#5a7fa8"}),o.jsx("rect",{x:"120",y:"180",width:"20",height:"3",fill:"#5a7fa8"}),o.jsx("rect",{x:"50",y:"140",width:"18",height:"50",rx:"8",fill:"#2d3748"}),o.jsx("rect",{x:"132",y:"140",width:"18",height:"50",rx:"8",fill:"#2d3748"}),o.jsx("ellipse",{cx:"59",cy:"192",rx:"10",ry:"8",fill:"#fce4c4"}),o.jsx("ellipse",{cx:"141",cy:"192",rx:"10",ry:"8",fill:"#fce4c4"}),o.jsx("rect",{x:"75",y:"200",width:"20",height:"40",fill:"#2d3748"}),o.jsx("rect",{x:"105",y:"200",width:"20",height:"40",fill:"#2d3748"}),o.jsx("ellipse",{cx:"85",cy:"245",rx:"15",ry:"8",fill:"#1a202c"}),o.jsx("ellipse",{cx:"115",cy:"245",rx:"15",ry:"8",fill:"#1a202c"}),o.jsxs("defs",{children:[o.jsxs("linearGradient",{id:"haloGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[o.jsx("stop",{offset:"0%",stopColor:"#a8edea"}),o.jsx("stop",{offset:"50%",stopColor:"#e8d5f2"}),o.jsx("stop",{offset:"100%",stopColor:"#a8edea"})]}),o.jsxs("linearGradient",{id:"hairGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[o.jsx("stop",{offset:"0%",stopColor:"#a8edea"}),o.jsx("stop",{offset:"50%",stopColor:"#d4b8e8"}),o.jsx("stop",{offset:"100%",stopColor:"#f5d0e8"})]})]})]}),ZS=({className:s="",size:n=200})=>o.jsxs("svg",{width:n,height:n,viewBox:"0 0 200 200",className:s,children:[o.jsx("ellipse",{cx:"100",cy:"15",rx:"40",ry:"7",fill:"none",stroke:"url(#pegasusHalo)",strokeWidth:"3",opacity:"0.8"}),o.jsx("g",{transform:"translate(10, 80)",children:o.jsx("path",{d:"M50 30 Q30 10 10 25 Q25 20 35 30 Q20 15 5 35 Q25 25 40 40 Q30 30 20 50 Q35 35 50 50 Z",fill:"white",stroke:"#e2e8f0",strokeWidth:"1"})}),o.jsx("g",{transform:"translate(140, 80) scale(-1, 1)",children:o.jsx("path",{d:"M50 30 Q30 10 10 25 Q25 20 35 30 Q20 15 5 35 Q25 25 40 40 Q30 30 20 50 Q35 35 50 50 Z",fill:"white",stroke:"#e2e8f0",strokeWidth:"1"})}),o.jsx("ellipse",{cx:"100",cy:"120",rx:"35",ry:"30",fill:"white",stroke:"#e2e8f0",strokeWidth:"2"}),o.jsx("path",{d:"M70 100 Q70 130 75 145 L125 145 Q130 130 130 100 Z",fill:"#7dd3fc"}),o.jsx("ellipse",{cx:"100",cy:"65",rx:"28",ry:"25",fill:"white",stroke:"#e2e8f0",strokeWidth:"2"}),o.jsx("ellipse",{cx:"78",cy:"45",rx:"8",ry:"12",fill:"white",stroke:"#e2e8f0",strokeWidth:"1"}),o.jsx("ellipse",{cx:"78",cy:"45",rx:"4",ry:"8",fill:"#fce7f3"}),o.jsx("ellipse",{cx:"122",cy:"45",rx:"8",ry:"12",fill:"white",stroke:"#e2e8f0",strokeWidth:"1"}),o.jsx("ellipse",{cx:"122",cy:"45",rx:"4",ry:"8",fill:"#fce7f3"}),o.jsx("path",{d:"M85 35 Q95 25 100 35 Q105 25 115 35",fill:"none",stroke:"white",strokeWidth:"8"}),o.jsx("circle",{cx:"88",cy:"62",r:"12",fill:"none",stroke:"#4a5568",strokeWidth:"2"}),o.jsx("circle",{cx:"112",cy:"62",r:"12",fill:"none",stroke:"#4a5568",strokeWidth:"2"}),o.jsx("line",{x1:"100",y1:"62",x2:"100",y2:"62",stroke:"#4a5568",strokeWidth:"2"}),o.jsx("line",{x1:"76",y1:"60",x2:"70",y2:"55",stroke:"#4a5568",strokeWidth:"2"}),o.jsx("line",{x1:"124",y1:"60",x2:"130",y2:"55",stroke:"#4a5568",strokeWidth:"2"}),o.jsx("circle",{cx:"88",cy:"62",r:"6",fill:"#1a202c"}),o.jsx("circle",{cx:"112",cy:"62",r:"6",fill:"#1a202c"}),o.jsx("circle",{cx:"90",cy:"60",r:"2",fill:"white"}),o.jsx("circle",{cx:"114",cy:"60",r:"2",fill:"white"}),o.jsx("ellipse",{cx:"100",cy:"75",rx:"8",ry:"5",fill:"#fce7f3"}),o.jsx("circle",{cx:"96",cy:"74",r:"2",fill:"#d1d5db"}),o.jsx("circle",{cx:"104",cy:"74",r:"2",fill:"#d1d5db"}),o.jsx("path",{d:"M92 82 Q100 88 108 82",fill:"none",stroke:"#4a5568",strokeWidth:"2"}),o.jsx("rect",{x:"80",y:"145",width:"12",height:"35",rx:"6",fill:"white",stroke:"#e2e8f0",strokeWidth:"1"}),o.jsx("rect",{x:"108",y:"145",width:"12",height:"35",rx:"6",fill:"white",stroke:"#e2e8f0",strokeWidth:"1"}),o.jsx("ellipse",{cx:"86",cy:"182",rx:"8",ry:"5",fill:"#1a202c"}),o.jsx("ellipse",{cx:"114",cy:"182",rx:"8",ry:"5",fill:"#1a202c"}),o.jsx("path",{d:"M130 130 Q150 140 145 160 Q140 150 135 155 Q145 145 140 165",fill:"none",stroke:"white",strokeWidth:"6",strokeLinecap:"round"}),o.jsx("defs",{children:o.jsxs("linearGradient",{id:"pegasusHalo",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[o.jsx("stop",{offset:"0%",stopColor:"#a8edea"}),o.jsx("stop",{offset:"50%",stopColor:"#d4b8e8"}),o.jsx("stop",{offset:"100%",stopColor:"#a8edea"})]})})]}),jre=({className:s="",size:n=200})=>o.jsxs("svg",{width:n,height:n*1.3,viewBox:"0 0 200 260",className:s,children:[o.jsx("ellipse",{cx:"100",cy:"15",rx:"45",ry:"8",fill:"none",stroke:"url(#girlHalo)",strokeWidth:"3",opacity:"0.8"}),o.jsx("ellipse",{cx:"100",cy:"70",rx:"55",ry:"50",fill:"url(#girlHairGradient)"}),o.jsx("circle",{cx:"55",cy:"55",r:"20",fill:"url(#girlHairGradient)"}),o.jsx("circle",{cx:"145",cy:"55",r:"20",fill:"url(#girlHairGradient)"}),o.jsx("circle",{cx:"45",cy:"80",r:"18",fill:"url(#girlHairGradient)"}),o.jsx("circle",{cx:"155",cy:"80",r:"18",fill:"url(#girlHairGradient)"}),o.jsx("circle",{cx:"50",cy:"110",r:"15",fill:"url(#girlHairGradient)"}),o.jsx("circle",{cx:"150",cy:"110",r:"15",fill:"url(#girlHairGradient)"}),o.jsx("circle",{cx:"60",cy:"130",r:"12",fill:"url(#girlHairGradient)"}),o.jsx("circle",{cx:"140",cy:"130",r:"12",fill:"url(#girlHairGradient)"}),o.jsx("ellipse",{cx:"100",cy:"90",rx:"35",ry:"38",fill:"#fce4c4"}),o.jsx("ellipse",{cx:"82",cy:"85",rx:"12",ry:"14",fill:"white"}),o.jsx("ellipse",{cx:"118",cy:"85",rx:"12",ry:"14",fill:"white"}),o.jsx("circle",{cx:"82",cy:"88",r:"8",fill:"#4a5568"}),o.jsx("circle",{cx:"118",cy:"88",r:"8",fill:"#4a5568"}),o.jsx("circle",{cx:"85",cy:"85",r:"3",fill:"white"}),o.jsx("circle",{cx:"121",cy:"85",r:"3",fill:"white"}),o.jsx("path",{d:"M70 72 Q82 68 90 72",fill:"none",stroke:"#9ca3af",strokeWidth:"2"}),o.jsx("path",{d:"M110 72 Q118 68 130 72",fill:"none",stroke:"#9ca3af",strokeWidth:"2"}),o.jsx("ellipse",{cx:"100",cy:"98",rx:"3",ry:"2",fill:"#e8c4a8"}),o.jsx("ellipse",{cx:"100",cy:"110",rx:"6",ry:"4",fill:"#f5a5a5"}),o.jsx("path",{d:"M94 108 Q100 106 106 108",fill:"none",stroke:"#e88a8a",strokeWidth:"1"}),o.jsx("path",{d:"M75 140 L100 160 L125 140",fill:"white"}),o.jsx("circle",{cx:"100",cy:"148",r:"4",fill:"#a8edea"}),o.jsx("path",{d:"M88 152 L100 158 L88 164 Z",fill:"#a8edea"}),o.jsx("path",{d:"M112 152 L100 158 L112 164 Z",fill:"#a8edea"}),o.jsx("circle",{cx:"100",cy:"158",r:"3",fill:"#7dd3fc"}),o.jsx("path",{d:"M70 145 Q55 200 65 240 L135 240 Q145 200 130 145 Z",fill:"#2d3748"}),o.jsx("path",{d:"M70 145 Q100 155 130 145 L125 160 Q100 165 75 160 Z",fill:"#2d3748"}),o.jsx("path",{d:"M55 155 Q45 180 50 200",fill:"none",stroke:"#2d3748",strokeWidth:"18",strokeLinecap:"round"}),o.jsx("path",{d:"M145 155 Q155 180 150 200",fill:"none",stroke:"#2d3748",strokeWidth:"18",strokeLinecap:"round"}),o.jsx("ellipse",{cx:"50",cy:"205",rx:"10",ry:"8",fill:"#fce4c4"}),o.jsx("ellipse",{cx:"150",cy:"205",rx:"10",ry:"8",fill:"#fce4c4"}),o.jsx("rect",{x:"80",y:"235",width:"15",height:"15",fill:"#fce4c4"}),o.jsx("rect",{x:"105",y:"235",width:"15",height:"15",fill:"#fce4c4"}),o.jsx("ellipse",{cx:"87",cy:"252",rx:"12",ry:"6",fill:"#2d3748"}),o.jsx("ellipse",{cx:"113",cy:"252",rx:"12",ry:"6",fill:"#2d3748"}),o.jsxs("defs",{children:[o.jsxs("linearGradient",{id:"girlHalo",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[o.jsx("stop",{offset:"0%",stopColor:"#a8edea"}),o.jsx("stop",{offset:"50%",stopColor:"#e8d5f2"}),o.jsx("stop",{offset:"100%",stopColor:"#a8edea"})]}),o.jsxs("linearGradient",{id:"girlHairGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[o.jsx("stop",{offset:"0%",stopColor:"#a8edea"}),o.jsx("stop",{offset:"30%",stopColor:"#c4b5e8"}),o.jsx("stop",{offset:"70%",stopColor:"#e8c5d8"}),o.jsx("stop",{offset:"100%",stopColor:"#a8edea"})]})]})]}),Ju=({children:s,className:n="",delay:i=0})=>o.jsx("div",{className:`animate-bounce ${n}`,style:{animationDuration:"3s",animationDelay:`${i}s`,animationTimingFunction:"ease-in-out"},children:s}),ARe=()=>{const{language:s,setLanguage:n,languages:i}=tl(),[l,u]=H.useState(!1);H.useEffect(()=>{const y=localStorage.getItem("delulu-language");y&&["de","en","es","fr","pt"].includes(y)&&n(y)},[]);const p={de:{tagline:"Connect in the Clouds",subtitle:"Echte Begegnungen in deiner Nachbarschaft.",highlight:"Hyperlokal. Anonym. Algorithmus-frei.",start:"Jetzt starten",login:"Ich habe schon einen Account",radius:"Max 500m Radius",mode:"Anonym oder Offen",privacy:"Privacy First"},en:{tagline:"Connect in the Clouds",subtitle:"Real connections in your neighborhood.",highlight:"Hyperlocal. Anonymous. Algorithm-free.",start:"Get Started",login:"I already have an account",radius:"Max 500m Radius",mode:"Anonymous or Public",privacy:"Privacy First"},es:{tagline:"Conecta en las Nubes",subtitle:"Encuentros reales en tu vecindario.",highlight:"Hiperlocal. Annimo. Sin algoritmos.",start:"Comenzar",login:"Ya tengo una cuenta",radius:"Radio mx. 500m",mode:"Annimo o Pblico",privacy:"Privacidad Primero"},fr:{tagline:"Connectez dans les Nuages",subtitle:"De vraies rencontres dans votre quartier.",highlight:"Hyperlocal. Anonyme. Sans algorithme.",start:"Commencer",login:"J'ai dj un compte",radius:"Rayon max. 500m",mode:"Anonyme ou Public",privacy:"Confidentialit"},pt:{tagline:"Conecte nas Nuvens",subtitle:"Encontros reais no seu bairro.",highlight:"Hiperlocal. Annimo. Sem algoritmos.",start:"Comear",login:"J tenho uma conta",radius:"Raio mx. 500m",mode:"Annimo ou Pblico",privacy:"Privacidade"}},g=p[s]||p.de;return o.jsxs("div",{className:"min-h-screen min-h-[100dvh] bg-gradient-to-b from-violet-50 via-white to-purple-50 flex flex-col items-center justify-center px-6 py-12 relative overflow-hidden",children:[o.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[o.jsx("div",{className:"absolute top-10 right-10 w-72 h-72 bg-gradient-to-br from-violet-300/30 to-purple-400/20 rounded-full blur-3xl animate-pulse"}),o.jsx("div",{className:"absolute bottom-20 left-5 w-64 h-64 bg-gradient-to-tr from-pink-300/25 to-violet-300/20 rounded-full blur-3xl animate-pulse",style:{animationDelay:"1s"}}),o.jsx("div",{className:"absolute top-1/3 left-1/4 w-48 h-48 bg-gradient-to-r from-blue-200/20 to-purple-200/20 rounded-full blur-2xl animate-pulse",style:{animationDelay:"2s"}}),o.jsx("div",{className:"absolute top-20 left-10 text-4xl opacity-20 animate-bounce",style:{animationDuration:"3s"},children:""}),o.jsx("div",{className:"absolute top-40 right-20 text-3xl opacity-15 animate-bounce",style:{animationDuration:"4s",animationDelay:"0.5s"},children:""}),o.jsx("div",{className:"absolute bottom-40 left-20 text-2xl opacity-10 animate-bounce",style:{animationDuration:"3.5s",animationDelay:"1s"},children:""}),o.jsx("div",{className:"absolute bottom-10 left-4 opacity-40 hidden sm:block",children:o.jsx(Ju,{delay:.5,children:o.jsx(jre,{size:100})})})]}),o.jsxs("div",{className:"absolute top-6 right-6 z-20",children:[o.jsxs("button",{onClick:()=>u(!l),className:"flex items-center gap-2 px-4 py-2 bg-white/80 backdrop-blur-sm rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-all",children:[o.jsx("span",{className:"text-lg",children:i[s].flag}),o.jsx("span",{className:"text-sm font-medium text-gray-700",children:i[s].native}),o.jsx(uO,{size:16,className:`text-gray-400 transition-transform ${l?"rotate-180":""}`})]}),l&&o.jsx("div",{className:"absolute top-full right-0 mt-2 bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden min-w-[180px] animate-fade-in",children:Object.entries(i).map(([y,x])=>o.jsxs("button",{onClick:()=>{n(y),u(!1)},className:`w-full px-4 py-3 flex items-center gap-3 hover:bg-violet-50 transition-colors ${s===y?"bg-violet-100":""}`,children:[o.jsx("span",{className:"text-xl",children:x.flag}),o.jsx("span",{className:"font-medium text-gray-800",children:x.native}),s===y&&o.jsx("span",{className:"ml-auto text-violet-600",children:""})]},y))})]}),o.jsxs("div",{className:"relative z-10 text-center max-w-sm",children:[o.jsxs("div",{className:"relative mb-10",children:[o.jsx("div",{className:"absolute inset-0 w-32 h-32 mx-auto bg-violet-400/40 rounded-3xl blur-2xl"}),o.jsx("div",{className:"relative w-32 h-32 mx-auto rounded-3xl bg-gradient-to-br from-violet-500 via-purple-500 to-violet-600 flex items-center justify-center shadow-2xl shadow-violet-500/30",children:o.jsx("span",{className:"text-6xl drop-shadow-lg",children:""})})]}),o.jsx("h1",{className:"font-display text-6xl font-bold mb-3 tracking-tight",children:o.jsx("span",{className:"bg-gradient-to-r from-violet-600 via-purple-600 to-violet-700 bg-clip-text text-transparent",children:"delulu"})}),o.jsx("p",{className:"text-gray-800 text-xl font-display font-semibold mb-3",children:g.tagline}),o.jsxs("p",{className:"text-gray-500 mb-10 leading-relaxed",children:[g.subtitle,o.jsx("br",{}),o.jsx("span",{className:"font-semibold text-gray-700",children:g.highlight})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsx(qh,{to:"/register",className:"block w-full py-4 bg-gradient-to-r from-violet-600 to-purple-600 text-white font-display font-bold text-center rounded-2xl shadow-lg shadow-violet-500/30 hover:shadow-xl hover:shadow-violet-500/40 transition-all transform hover:scale-[1.02]",children:g.start}),o.jsx(qh,{to:"/login",className:"block w-full py-4 text-violet-600 font-display font-semibold text-center border-2 border-violet-200 rounded-2xl hover:border-violet-400 hover:bg-violet-50 transition-all",children:g.login})]}),o.jsxs("div",{className:"mt-12 grid grid-cols-3 gap-3",children:[o.jsxs("div",{className:"bg-white/60 backdrop-blur-sm rounded-2xl p-4 shadow-sm border border-gray-100",children:[o.jsx("div",{className:"text-2xl mb-2",children:""}),o.jsx("p",{className:"text-[11px] text-gray-600 font-medium leading-tight",children:g.radius})]}),o.jsxs("div",{className:"bg-white/60 backdrop-blur-sm rounded-2xl p-4 shadow-sm border border-gray-100",children:[o.jsx("div",{className:"text-2xl mb-2",children:""}),o.jsx("p",{className:"text-[11px] text-gray-600 font-medium leading-tight",children:g.mode})]}),o.jsxs("div",{className:"bg-white/60 backdrop-blur-sm rounded-2xl p-4 shadow-sm border border-gray-100",children:[o.jsx("div",{className:"text-2xl mb-2",children:""}),o.jsx("p",{className:"text-[11px] text-gray-600 font-medium leading-tight",children:g.privacy})]})]})]}),l&&o.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>u(!1)})]})},kRe=()=>{const[s,n]=H.useState(""),[i,l]=H.useState(""),[u,p]=H.useState(!1),[g,y]=H.useState(""),[x,C]=H.useState(!1),[k,A]=H.useState(!1),[M,G]=H.useState(!1),{signIn:B,signInWithGoogle:X,resetPassword:Z}=TT(),q=zr(),V=async ae=>{ae.preventDefault(),y(""),C(!0);const ye=await B(s,i);ye.success?q("/"):y(ye.error||"Login fehlgeschlagen"),C(!1)},ee=async()=>{y(""),C(!0);const ae=await X();ae.success?q("/"):y(ae.error||"Google Login fehlgeschlagen"),C(!1)},de=async ae=>{if(ae.preventDefault(),y(""),C(!0),!s){y("Bitte gib deine E-Mail-Adresse ein"),C(!1);return}const ye=await Z(s);ye.success?G(!0):y(ye.error||"Fehler beim Zurcksetzen"),C(!1)};return k?o.jsxs("div",{className:"min-h-screen min-h-[100dvh] bg-delulu-bg px-6 py-8 safe-top",children:[o.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[o.jsx("button",{onClick:()=>{A(!1),G(!1),y("")},className:"w-10 h-10 rounded-xl bg-white flex items-center justify-center shadow-sm",children:o.jsx(sa,{size:20,className:"text-delulu-text"})}),o.jsx("h1",{className:"font-display text-2xl font-bold text-delulu-text",children:"Passwort vergessen"})]}),M?o.jsxs("div",{className:"glass-card p-6 text-center",children:[o.jsx("div",{className:"w-16 h-16 mx-auto rounded-full bg-green-100 flex items-center justify-center mb-4",children:o.jsx(Vu,{size:32,className:"text-green-600"})}),o.jsx("h2",{className:"font-display text-xl font-bold text-delulu-text mb-2",children:"E-Mail gesendet!"}),o.jsxs("p",{className:"text-delulu-muted mb-6",children:["Wir haben dir eine E-Mail an ",o.jsx("strong",{children:s})," gesendet. Folge dem Link in der E-Mail, um dein Passwort zurckzusetzen."]}),o.jsx("p",{className:"text-sm text-delulu-muted mb-6",children:"Keine E-Mail erhalten? berprfe deinen Spam-Ordner oder versuche es erneut."}),o.jsx("button",{onClick:()=>{A(!1),G(!1)},className:"btn-primary w-full py-4 text-white font-display font-bold",children:"Zurck zum Login"})]}):o.jsxs("div",{className:"glass-card p-6",children:[o.jsx("p",{className:"text-delulu-muted mb-6",children:"Gib deine E-Mail-Adresse ein und wir senden dir einen Link zum Zurcksetzen deines Passworts."}),o.jsxs("form",{onSubmit:de,className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-delulu-muted mb-2",children:"E-Mail"}),o.jsxs("div",{className:"relative",children:[o.jsx(_y,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-delulu-muted"}),o.jsx("input",{type:"email",value:s,onChange:ae=>n(ae.target.value),placeholder:"deine@email.de",required:!0,className:"w-full pl-12 pr-4 py-3 bg-white border-2 border-delulu-soft rounded-xl focus:border-delulu-violet focus:outline-none transition-colors"})]})]}),g&&o.jsx("p",{className:"text-red-500 text-sm text-center",children:g}),o.jsx("button",{type:"submit",disabled:x,className:"btn-primary w-full py-4 text-white font-display font-bold disabled:opacity-70",children:x?"Wird gesendet...":"Link senden"})]})]})]}):o.jsxs("div",{className:"min-h-screen min-h-[100dvh] bg-delulu-bg px-6 py-8 safe-top",children:[o.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[o.jsx(qh,{to:"/",className:"w-10 h-10 rounded-xl bg-white flex items-center justify-center shadow-sm",children:o.jsx(sa,{size:20,className:"text-delulu-text"})}),o.jsx("h1",{className:"font-display text-2xl font-bold text-delulu-text",children:"Login"})]}),o.jsx("div",{className:"flex justify-center mb-4",children:o.jsx(Ju,{delay:0,children:o.jsx(ZS,{size:100})})}),o.jsx("div",{className:"glass-card p-6 mb-6",children:o.jsxs("form",{onSubmit:V,className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-delulu-muted mb-2",children:"E-Mail"}),o.jsxs("div",{className:"relative",children:[o.jsx(_y,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-delulu-muted"}),o.jsx("input",{type:"email",value:s,onChange:ae=>n(ae.target.value),placeholder:"deine@email.de",required:!0,className:"w-full pl-12 pr-4 py-3 bg-white border-2 border-delulu-soft rounded-xl focus:border-delulu-violet focus:outline-none transition-colors"})]})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("label",{className:"block text-sm font-medium text-delulu-muted",children:"Passwort"}),o.jsx("button",{type:"button",onClick:()=>A(!0),className:"text-sm text-delulu-violet font-medium hover:underline",children:"Passwort vergessen?"})]}),o.jsxs("div",{className:"relative",children:[o.jsx(Hi,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-delulu-muted"}),o.jsx("input",{type:u?"text":"password",value:i,onChange:ae=>l(ae.target.value),placeholder:"",required:!0,className:"w-full pl-12 pr-12 py-3 bg-white border-2 border-delulu-soft rounded-xl focus:border-delulu-violet focus:outline-none transition-colors"}),o.jsx("button",{type:"button",onClick:()=>p(!u),className:"absolute right-4 top-1/2 -translate-y-1/2 text-delulu-muted",children:u?o.jsx($c,{size:18}):o.jsx(Ta,{size:18})})]})]}),g&&o.jsx("p",{className:"text-red-500 text-sm text-center",children:g}),o.jsx("button",{type:"submit",disabled:x,className:"btn-primary w-full py-4 text-white font-display font-bold disabled:opacity-70",children:x?"Wird eingeloggt...":"Login"})]})}),o.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[o.jsx("div",{className:"flex-1 h-px bg-delulu-soft"}),o.jsx("span",{className:"text-sm text-delulu-muted",children:"oder"}),o.jsx("div",{className:"flex-1 h-px bg-delulu-soft"})]}),o.jsx("div",{className:"space-y-3",children:o.jsxs("button",{onClick:ee,disabled:x,className:"w-full py-4 bg-white border-2 border-delulu-soft rounded-xl font-medium flex items-center justify-center gap-3 hover:border-delulu-violet transition-colors disabled:opacity-70",children:[o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",children:[o.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),o.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),o.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),o.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Mit Google anmelden"]})}),o.jsxs("p",{className:"text-center text-delulu-muted mt-8",children:["Noch kein Account?"," ",o.jsx(qh,{to:"/register",className:"text-delulu-violet font-semibold",children:"Registrieren"})]})]})},Wi={maxSlots:200,reservedSlots:10,warningThreshold:50,criticalThreshold:20,documentId:"beta_counter_v1"},ORe=async()=>{var l,u,p;const s=at(Me,"system",Wi.documentId),n=await fr(s);if(n.exists()){const g=n.data();return{...g,lastRegistration:((l=g.lastRegistration)==null?void 0:l.toDate())||null,createdAt:((u=g.createdAt)==null?void 0:u.toDate())||new Date,updatedAt:((p=g.updatedAt)==null?void 0:p.toDate())||new Date}}const i={totalSlots:Wi.maxSlots,usedSlots:0,availableSlots:Wi.maxSlots,waitlistCount:0,lastRegistration:null,isOpen:!0,createdAt:new Date,updatedAt:new Date};return await yo(s,{...i,createdAt:cn.fromDate(i.createdAt),updatedAt:cn.fromDate(i.updatedAt)}),i},DRe=async()=>{var s,n,i;try{const l=at(Me,"system",Wi.documentId),u=await fr(l);if(!u.exists())return ORe();const p=u.data();return{totalSlots:p.totalSlots||Wi.maxSlots,usedSlots:p.usedSlots||0,availableSlots:p.availableSlots||Wi.maxSlots,waitlistCount:p.waitlistCount||0,lastRegistration:((s=p.lastRegistration)==null?void 0:s.toDate())||null,isOpen:p.isOpen!==!1,createdAt:((n=p.createdAt)==null?void 0:n.toDate())||new Date,updatedAt:((i=p.updatedAt)==null?void 0:i.toDate())||new Date}}catch(l){return console.error("Error getting beta counter:",l),{totalSlots:Wi.maxSlots,usedSlots:0,availableSlots:Wi.maxSlots,waitlistCount:0,lastRegistration:null,isOpen:!0,createdAt:new Date,updatedAt:new Date}}},PRe=async()=>{try{const s=at(Me,"system",Wi.documentId);return await qwe(Me,async i=>{const l=await i.get(s);if(!l.exists())throw new Error("Beta counter not initialized");const u=l.data(),p=u.availableSlots||0;if(p<=0)return{success:!1,slotsRemaining:0,needsWaitlist:!0};const g=(u.usedSlots||0)+1,y=p-1;return i.update(s,{usedSlots:g,availableSlots:y,lastRegistration:cn.fromDate(new Date),isOpen:y>0,updatedAt:cn.fromDate(new Date)}),{success:!0,slotsRemaining:y,position:g}})}catch(s){return console.error("Error claiming beta slot:",s),{success:!1,slotsRemaining:0,error:s.message||"Fehler beim Registrieren"}}},Mre=s=>{const n=at(Me,"system",Wi.documentId),i={totalSlots:Wi.maxSlots,usedSlots:0,availableSlots:Wi.maxSlots,waitlistCount:0,lastRegistration:null,isOpen:!0,createdAt:new Date,updatedAt:new Date};return qa(n,l=>{var p,g,y;if(!l.exists()){s(i);return}const u=l.data();s({totalSlots:u.totalSlots||Wi.maxSlots,usedSlots:u.usedSlots||0,availableSlots:u.availableSlots||Wi.maxSlots,waitlistCount:u.waitlistCount||0,lastRegistration:((p=u.lastRegistration)==null?void 0:p.toDate())||null,isOpen:u.isOpen!==!1,createdAt:((g=u.createdAt)==null?void 0:g.toDate())||new Date,updatedAt:((y=u.updatedAt)==null?void 0:y.toDate())||new Date})},l=>{console.warn("Beta counter listener error, using defaults:",l.message),s(i)})},LRe=async(s,n,i)=>{try{const l=await fr(at(Me,"waitlist",s));if(l.exists())return{success:!0,position:l.data().position};const p=(await DRe()).waitlistCount+1;await yo(at(Me,"waitlist",s),{email:s,username:n||null,referralCode:i||null,joinedAt:cn.fromDate(new Date),position:p,notified:!1});const g=at(Me,"system",Wi.documentId);return await Kn(g,{waitlistCount:p,updatedAt:cn.fromDate(new Date)}),{success:!0,position:p}}catch(l){return console.error("Error joining waitlist:",l),{success:!1,position:0,error:l.message||"Fehler beim Eintragen"}}},Ure=s=>s<=0?"closed":s<=Wi.criticalThreshold?"critical":s<=Wi.warningThreshold?"warning":"none",jRe=s=>{switch(Ure(s)){case"closed":return"#9CA3AF";case"critical":return"#EF4444";case"warning":return"#F59E0B";default:return"#A78BFA"}},MRe=s=>s<=0?{prefix:"",number:"0",suffix:"Pltze  Warteliste aktiv"}:{prefix:"Nur noch",number:s.toString(),suffix:`von ${Wi.maxSlots} Beta-Pltzen`},URe=({variant:s="hero",size:n="md",showWaitlist:i=!0,showProgress:l=!1,animated:u=!0,onWaitlistClick:p,onSlotsChange:g})=>{const[y,x]=H.useState(null),[C,k]=H.useState(0),A=H.useRef(0);if(H.useEffect(()=>{const X=Mre(Z=>{x(Z),g&&Z&&g(Z.availableSlots)});return()=>X()},[g]),H.useEffect(()=>{if(!y)return;const X=y.availableSlots,Z=A.current;if(Z===X){k(X);return}const q=1500,V=30,ee=(X-Z)/V,de=q/V;let ae=Z,ye=0;const Q=setInterval(()=>{ye++,ae+=ee,ye>=V?(k(X),A.current=X,clearInterval(Q)):k(Math.round(ae))},de);return()=>clearInterval(Q)},[y==null?void 0:y.availableSlots]),!y)return o.jsx("div",{className:"animate-pulse bg-gray-100 rounded-2xl h-24"});const M=Ure(y.availableSlots),G=jRe(y.availableSlots),B=MRe(y.availableSlots);return s==="hero"?o.jsxs("div",{className:"relative overflow-hidden rounded-3xl p-6 text-center",style:{background:`linear-gradient(135deg, ${G}15 0%, ${G}05 100%)`,border:`2px solid ${G}30`},children:[o.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[...Array(10)].map((X,Z)=>o.jsx("div",{className:"absolute w-1 h-1 rounded-full opacity-50",style:{backgroundColor:G,left:`${Math.random()*100}%`,top:`${Math.random()*100}%`,animation:`float ${3+Math.random()*2}s ease-in-out infinite`,animationDelay:`${Math.random()*2}s`}},Z))}),o.jsx("div",{className:"w-16 h-16 rounded-full mx-auto mb-4 flex items-center justify-center",style:{backgroundColor:`${G}20`},children:M==="closed"?o.jsx(Gi,{size:32,style:{color:G}}):M==="critical"?o.jsx(ql,{size:32,style:{color:G},className:"animate-pulse"}):o.jsx(rr,{size:32,style:{color:G}})}),o.jsxs("div",{className:"relative z-10",children:[o.jsx("p",{className:"text-sm text-gray-600 mb-2",children:B.prefix}),o.jsxs("div",{className:"flex items-center justify-center gap-3 mb-2",children:[o.jsx("span",{className:"text-6xl font-black tabular-nums",style:{color:G},children:C}),M==="critical"&&o.jsx(wr,{size:24,style:{color:G},className:"animate-pulse"})]}),o.jsx("p",{className:"text-sm text-gray-500",children:B.suffix}),o.jsx("div",{className:"mt-4 h-2 bg-gray-200 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full rounded-full transition-all duration-1000",style:{width:`${y.usedSlots/Wi.maxSlots*100}%`,backgroundColor:G}})}),M!=="none"&&o.jsx("p",{className:"mt-4 text-sm font-medium",style:{color:G},children:M==="closed"?" Die Beta ist voll!":M==="critical"?" Fast ausverkauft!":" Schnell sein!"})]}),M==="closed"&&i&&o.jsx("button",{onClick:p,className:"mt-6 w-full py-3 bg-gray-900 text-white font-semibold rounded-xl hover:bg-gray-800 transition-colors",children:"Auf die Warteliste"}),o.jsx("style",{children:`
          @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
          }
        `})]}):s==="compact"?o.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-2xl",style:{backgroundColor:`${G}10`,border:`1px solid ${G}20`},children:[o.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center",style:{backgroundColor:`${G}20`},children:M==="closed"?o.jsx(Gi,{size:24,style:{color:G}}):o.jsx(rr,{size:24,style:{color:G}})}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("p",{className:"font-bold text-lg",style:{color:G},children:[C," von ",Wi.maxSlots]}),o.jsx("p",{className:"text-xs text-gray-500",children:"Beta-Pltze verfgbar"})]}),M==="critical"&&o.jsx(wr,{size:20,style:{color:G},className:"animate-pulse"})]}):o.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium",style:{backgroundColor:`${G}15`,color:G},children:[M==="critical"?o.jsx(ql,{size:16,className:"animate-pulse"}):o.jsx(rr,{size:16}),o.jsx("span",{children:y.availableSlots>0?`${C} Beta-Pltze`:"Warteliste aktiv"})]})},VRe=()=>{const[s,n]=H.useState(""),[i,l]=H.useState(""),[u,p]=H.useState(""),[g,y]=H.useState(!1),[x,C]=H.useState(""),[k,A]=H.useState(!1),[M,G]=H.useState(!1),[B,X]=H.useState(!1),[Z,q]=H.useState(""),[V,ee]=H.useState(null),[de,ae]=H.useState(!1),[ye,Q]=H.useState(null),[$,se]=H.useState(!0),[ce]=aT(),[he,ve]=H.useState(""),[ge,qe]=H.useState(null),[Dt,gt]=H.useState(!1),{signUp:Ye,signInWithGoogle:ze}=TT(),ut=zr(),{language:yt,setLanguage:Xt,languages:jt}=tl();H.useEffect(()=>{const xt=Mre(Sn=>{Q(Sn),se(!1),Sn.isOpen||X(!0)});return()=>xt()},[]),H.useEffect(()=>{const xt=ce.get("ref");xt&&(ve(xt.toUpperCase()),Gt(xt))},[ce]);const Gt=async xt=>{if(!xt||xt.length<5){qe(null);return}gt(!0);try{const Sn=await PF(xt);qe(Sn!==null)}catch{qe(!1)}gt(!1)};H.useEffect(()=>{const xt=setTimeout(()=>{he.length>=5?Gt(he):qe(null)},500);return()=>clearTimeout(xt)},[he]);const mn=async xt=>{if(xt.preventDefault(),!Z)return;ae(!0);const Sn=await LRe(Z,s,he);Sn.success?ee(Sn.position):C(Sn.error||"Fehler beim Eintragen"),ae(!1)},Pt=H.useMemo(()=>{let xt=0;const Sn={length:u.length>=8,uppercase:/[A-Z]/.test(u),lowercase:/[a-z]/.test(u),number:/[0-9]/.test(u),special:/[!@#$%^&*(),.?":{}|<>]/.test(u)};return Sn.length&&xt++,Sn.uppercase&&xt++,Sn.lowercase&&xt++,Sn.number&&xt++,Sn.special&&xt++,{score:xt,checks:Sn,label:xt<=1?"Sehr schwach":xt===2?"Schwach":xt===3?"Mittel":xt===4?"Stark":"Sehr stark",color:xt<=1?"bg-red-500":xt===2?"bg-orange-500":xt===3?"bg-yellow-500":xt===4?"bg-green-500":"bg-emerald-500"}},[u]),Jt={de:{title:"Account erstellen",subtitle:"Werde Teil der Community",username:"Benutzername",email:"E-Mail Adresse",password:"Passwort",createAccount:"Account erstellen",creating:"Wird erstellt...",or:"oder",google:"Mit Google fortfahren",apple:"Mit Apple fortfahren",hasAccount:"Schon registriert?",login:"Anmelden",terms:"Mit der Registrierung akzeptierst du unsere",termsLink:"Nutzungsbedingungen",and:"und",privacyLink:"Datenschutzerklrung",pwStrength:"Passwortstrke",pwLength:"Min. 8 Zeichen",pwUpper:"Grobuchstabe",pwLower:"Kleinbuchstabe",pwNumber:"Zahl",pwSpecial:"Sonderzeichen",spotsLeft:"Pltze verfgbar",waitlist:"Warteliste",limitReached:"Maximale Anzahl erreicht! Du kannst dich auf die Warteliste setzen.",referralCode:"Einladungscode (optional)",referralValid:"Gltiger Einladungscode! +250 XP Bonus",referralInvalid:"Ungltiger Einladungscode"},en:{title:"Create Account",subtitle:"Join the community",username:"Username",email:"Email Address",password:"Password",createAccount:"Create Account",creating:"Creating...",or:"or",google:"Continue with Google",apple:"Continue with Apple",hasAccount:"Already registered?",login:"Sign In",terms:"By signing up, you agree to our",termsLink:"Terms of Service",and:"and",privacyLink:"Privacy Policy",pwStrength:"Password strength",pwLength:"Min. 8 characters",pwUpper:"Uppercase letter",pwLower:"Lowercase letter",pwNumber:"Number",pwSpecial:"Special character",spotsLeft:"spots available",waitlist:"Waitlist",limitReached:"Maximum capacity reached! You can join the waitlist.",referralCode:"Referral code (optional)",referralValid:"Valid referral code! +250 XP bonus",referralInvalid:"Invalid referral code"},es:{title:"Crear cuenta",subtitle:"nete a la comunidad",username:"Nombre de usuario",email:"Correo electrnico",password:"Contrasea",createAccount:"Crear cuenta",creating:"Creando...",or:"o",google:"Continuar con Google",apple:"Continuar con Apple",hasAccount:"Ya registrado?",login:"Iniciar sesin",terms:"Al registrarte, aceptas nuestros",termsLink:"Trminos de servicio",and:"y",privacyLink:"Poltica de privacidad",pwStrength:"Fortaleza",pwLength:"Mn. 8 caracteres",pwUpper:"Mayscula",pwLower:"Minscula",pwNumber:"Nmero",pwSpecial:"Carcter especial",spotsLeft:"lugares disponibles",waitlist:"Lista de espera",limitReached:"Capacidad mxima alcanzada! Puedes unirte a la lista de espera.",referralCode:"Cdigo de invitacin (opcional)",referralValid:"Cdigo vlido! +250 XP bonus",referralInvalid:"Cdigo invlido"},fr:{title:"Crer un compte",subtitle:"Rejoignez la communaut",username:"Nom d'utilisateur",email:"Adresse e-mail",password:"Mot de passe",createAccount:"Crer un compte",creating:"Cration...",or:"ou",google:"Continuer avec Google",apple:"Continuer avec Apple",hasAccount:"Dj inscrit?",login:"Se connecter",terms:"En vous inscrivant, vous acceptez nos",termsLink:"Conditions d'utilisation",and:"et",privacyLink:"Politique de confidentialit",pwStrength:"Force du mot de passe",pwLength:"Min. 8 caractres",pwUpper:"Majuscule",pwLower:"Minuscule",pwNumber:"Chiffre",pwSpecial:"Caractre spcial",spotsLeft:"places disponibles",waitlist:"Liste d'attente",limitReached:"Capacit maximale atteinte! Vous pouvez rejoindre la liste.",referralCode:"Code d'invitation (optionnel)",referralValid:"Code valide! +250 XP bonus",referralInvalid:"Code invalide"},pt:{title:"Criar conta",subtitle:"Junte-se  comunidade",username:"Nome de usurio",email:"Endereo de e-mail",password:"Senha",createAccount:"Criar conta",creating:"Criando...",or:"ou",google:"Continuar com Google",apple:"Continuar com Apple",hasAccount:"J registrado?",login:"Entrar",terms:"Ao se registrar, voc concorda com nossos",termsLink:"Termos de Servio",and:"e",privacyLink:"Poltica de Privacidade",pwStrength:"Fora da senha",pwLength:"Mn. 8 caracteres",pwUpper:"Maiscula",pwLower:"Minscula",pwNumber:"Nmero",pwSpecial:"Caractere especial",spotsLeft:"vagas disponveis",waitlist:"Lista de espera",limitReached:"Capacidade mxima atingida! Voc pode entrar na lista de espera.",referralCode:"Cdigo de convite (opcional)",referralValid:"Cdigo vlido! +250 XP bnus",referralInvalid:"Cdigo invlido"}},He=Jt[yt]||Jt.de,bt=ye?!ye.isOpen:!1,Wt=async xt=>{if(xt.preventDefault(),C(""),bt){X(!0);return}if(s.length<3){C("Username muss mindestens 3 Zeichen haben");return}if(Pt.score<3){C("Passwort ist zu schwach. Bitte whle ein strkeres Passwort.");return}A(!0);const Sn=await PRe();if(!Sn.success){if(Sn.slotsRemaining===0){X(!0),A(!1);return}C(Sn.error||"Keine Beta-Pltze mehr verfgbar"),A(!1);return}const cr=await Ye(i,u,s,ge?he:void 0);cr.success?ut("/"):C(cr.error||"Registrierung fehlgeschlagen"),A(!1)},gn=async()=>{if(bt){C(He.limitReached);return}C(""),A(!0);const xt=await ze();xt.success?ut("/"):C(xt.error||"Google Registrierung fehlgeschlagen"),A(!1)};return o.jsxs("div",{className:"min-h-screen min-h-[100dvh] bg-gradient-to-b from-violet-50 via-white to-purple-50 relative overflow-hidden",children:[o.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[o.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-violet-200/40 to-purple-300/30 rounded-full blur-3xl"}),o.jsx("div",{className:"absolute bottom-20 left-0 w-56 h-56 bg-gradient-to-tr from-pink-200/30 to-violet-200/30 rounded-full blur-3xl"}),o.jsx("div",{className:"absolute bottom-8 right-4 opacity-30 hidden sm:block",children:o.jsx(Ju,{delay:.3,children:o.jsx(jre,{size:90})})})]}),o.jsxs("div",{className:"absolute top-4 right-4 z-20",children:[o.jsxs("button",{onClick:()=>G(!M),className:"flex items-center gap-2 px-3 py-2 bg-white/80 backdrop-blur-sm rounded-xl shadow-sm border border-gray-100",children:[o.jsx("span",{children:jt[yt].flag}),o.jsx(uO,{size:14,className:`text-gray-400 transition-transform ${M?"rotate-180":""}`})]}),M&&o.jsx("div",{className:"absolute top-full right-0 mt-2 bg-white rounded-xl shadow-xl border border-gray-100 overflow-hidden min-w-[160px]",children:Object.entries(jt).map(([xt,Sn])=>o.jsxs("button",{onClick:()=>{Xt(xt),G(!1)},className:`w-full px-4 py-2.5 flex items-center gap-2 hover:bg-violet-50 text-sm ${yt===xt?"bg-violet-100":""}`,children:[o.jsx("span",{children:Sn.flag}),o.jsx("span",{children:Sn.native})]},xt))})]}),o.jsxs("div",{className:"relative z-10 px-6 py-8 safe-top",children:[o.jsx("div",{className:"flex items-center gap-4 mb-6",children:o.jsx(qh,{to:"/",className:"w-10 h-10 rounded-xl bg-white/80 backdrop-blur-sm flex items-center justify-center shadow-sm border border-gray-100",children:o.jsx(sa,{size:20,className:"text-gray-600"})})}),o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("div",{className:"w-20 h-20 mx-auto rounded-2xl bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center shadow-lg shadow-violet-500/30 mb-6",children:o.jsx("span",{className:"text-4xl",children:""})}),o.jsx("h1",{className:"font-display text-3xl font-bold text-gray-900 mb-2",children:He.title}),o.jsx("p",{className:"text-gray-500",children:He.subtitle}),!$&&o.jsx("div",{className:"mt-6",children:o.jsx(URe,{variant:"hero",showProgress:!0,animated:!0,onSlotsChange:xt=>{xt===0&&X(!0)}})})]}),B&&bt&&o.jsx("div",{className:"bg-gradient-to-br from-purple-50 to-violet-100 rounded-3xl p-6 shadow-xl border border-purple-200 mb-6",children:V?o.jsxs("div",{className:"text-center py-6",children:[o.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-gradient-to-br from-violet-500 to-purple-600 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-4xl",children:""})}),o.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Du bist auf der Warteliste!"}),o.jsxs("p",{className:"text-gray-600 mb-4",children:["Deine Position: ",o.jsxs("span",{className:"font-bold text-purple-600",children:["#",V]})]}),o.jsx("p",{className:"text-sm text-gray-500",children:"Wir benachrichtigen dich, sobald ein Platz frei wird."})]}):o.jsxs("form",{onSubmit:mn,className:"space-y-4",children:[o.jsxs("div",{className:"text-center mb-4",children:[o.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Die Beta ist voll! "}),o.jsx("p",{className:"text-gray-600 text-sm",children:"Sichere dir einen Platz auf der Warteliste"})]}),o.jsxs("div",{className:"relative",children:[o.jsx(_y,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"}),o.jsx("input",{type:"email",value:Z,onChange:xt=>q(xt.target.value),placeholder:"Deine E-Mail Adresse",required:!0,className:"w-full pl-12 pr-4 py-3.5 bg-white border-2 border-purple-200 rounded-xl focus:border-purple-500 focus:outline-none transition-all text-gray-900"})]}),o.jsx("button",{type:"submit",disabled:de,className:"w-full py-4 bg-gradient-to-r from-violet-600 to-purple-600 text-white font-bold rounded-xl shadow-lg flex items-center justify-center gap-2",children:de?o.jsx(Br,{size:20,className:"animate-spin"}):o.jsxs(o.Fragment,{children:[o.jsx("span",{children:"Auf Warteliste setzen"}),o.jsx("span",{children:""})]})}),o.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["Aktuell ",(ye==null?void 0:ye.waitlistCount)||0," Personen auf der Warteliste"]})]})}),o.jsx("div",{className:`bg-white/80 backdrop-blur-sm rounded-3xl p-6 shadow-xl shadow-gray-200/50 border border-gray-100 mb-6 ${bt?"hidden":""}`,children:o.jsxs("form",{onSubmit:Wt,className:"space-y-5",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:He.username}),o.jsxs("div",{className:"relative",children:[o.jsx(tp,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"}),o.jsx("input",{type:"text",value:s,onChange:xt=>n(xt.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"")),required:!0,maxLength:20,className:"w-full pl-12 pr-4 py-3.5 bg-gray-50 border-2 border-transparent rounded-xl focus:border-violet-500 focus:bg-white focus:outline-none transition-all text-gray-900"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:He.email}),o.jsxs("div",{className:"relative",children:[o.jsx(_y,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"}),o.jsx("input",{type:"email",value:i,onChange:xt=>l(xt.target.value),required:!0,className:"w-full pl-12 pr-4 py-3.5 bg-gray-50 border-2 border-transparent rounded-xl focus:border-violet-500 focus:bg-white focus:outline-none transition-all text-gray-900"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:He.password}),o.jsxs("div",{className:"relative",children:[o.jsx(Hi,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"}),o.jsx("input",{type:g?"text":"password",value:u,onChange:xt=>p(xt.target.value),required:!0,className:"w-full pl-12 pr-12 py-3.5 bg-gray-50 border-2 border-transparent rounded-xl focus:border-violet-500 focus:bg-white focus:outline-none transition-all text-gray-900"}),o.jsx("button",{type:"button",onClick:()=>y(!g),className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:g?o.jsx($c,{size:18}):o.jsx(Ta,{size:18})})]}),u&&o.jsxs("div",{className:"mt-3 space-y-2",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"flex-1 h-2 bg-gray-200 rounded-full overflow-hidden",children:o.jsx("div",{className:`h-full ${Pt.color} transition-all duration-300`,style:{width:`${Pt.score/5*100}%`}})}),o.jsx("span",{className:"text-xs font-medium text-gray-500",children:Pt.label})]}),o.jsx("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[{key:"length",label:He.pwLength},{key:"uppercase",label:He.pwUpper},{key:"lowercase",label:He.pwLower},{key:"number",label:He.pwNumber},{key:"special",label:He.pwSpecial}].map(xt=>o.jsxs("div",{className:`flex items-center gap-1.5 ${Pt.checks[xt.key]?"text-green-600":"text-gray-400"}`,children:[Pt.checks[xt.key]?o.jsx(zn,{size:12}):o.jsx(Rs,{size:12}),xt.label]},xt.key))})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:He.referralCode}),o.jsxs("div",{className:"relative",children:[o.jsx(ra,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"}),o.jsx("input",{type:"text",value:he,onChange:xt=>ve(xt.target.value.toUpperCase()),placeholder:"DELULU-XXXXX",maxLength:12,className:`w-full pl-12 pr-12 py-3.5 bg-gray-50 border-2 rounded-xl focus:outline-none transition-all text-gray-900 font-mono ${ge===!0?"border-green-500 bg-green-50":ge===!1?"border-red-300 bg-red-50":"border-transparent focus:border-violet-500 focus:bg-white"}`}),o.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2",children:Dt?o.jsx(Br,{size:18,className:"animate-spin text-gray-400"}):ge===!0?o.jsx(zn,{size:18,className:"text-green-500"}):ge===!1?o.jsx(Rs,{size:18,className:"text-red-500"}):null})]}),ge===!0&&o.jsxs("p",{className:"mt-1.5 text-sm text-green-600 flex items-center gap-1",children:[o.jsx(zn,{size:14}),He.referralValid]}),ge===!1&&he.length>=5&&o.jsxs("p",{className:"mt-1.5 text-sm text-red-500 flex items-center gap-1",children:[o.jsx(Rs,{size:14}),He.referralInvalid]})]}),x&&o.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-100 rounded-xl",children:[o.jsx(MF,{size:18,className:"text-red-500 flex-shrink-0"}),o.jsx("p",{className:"text-red-600 text-sm",children:x})]}),o.jsx("button",{type:"submit",disabled:k||bt,className:"w-full py-4 bg-gradient-to-r from-violet-600 to-purple-600 text-white font-display font-bold rounded-xl shadow-lg shadow-violet-500/30 hover:shadow-xl transition-all disabled:opacity-60 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:k?o.jsxs(o.Fragment,{children:[o.jsx(Br,{size:20,className:"animate-spin"}),He.creating]}):He.createAccount})]})}),o.jsxs("div",{className:`flex items-center gap-4 mb-6 ${bt?"hidden":""}`,children:[o.jsx("div",{className:"flex-1 h-px bg-gray-200"}),o.jsx("span",{className:"text-sm text-gray-400",children:He.or}),o.jsx("div",{className:"flex-1 h-px bg-gray-200"})]}),o.jsxs("div",{className:`space-y-3 mb-8 ${bt?"hidden":""}`,children:[o.jsxs("button",{onClick:gn,disabled:k||bt,className:"w-full py-3.5 bg-white border-2 border-gray-200 rounded-xl font-medium flex items-center justify-center gap-3 hover:border-gray-300 hover:bg-gray-50 transition-all disabled:opacity-60",children:[o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",children:[o.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),o.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),o.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),o.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),o.jsx("span",{className:"text-gray-700",children:He.google})]}),o.jsxs("button",{disabled:!0,className:"w-full py-3.5 bg-black text-white rounded-xl font-medium flex items-center justify-center gap-3 opacity-50 cursor-not-allowed",children:[o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"white",children:o.jsx("path",{d:"M17.05 20.28c-.98.95-2.05.8-3.08.35-1.09-.46-2.09-.48-3.24 0-1.44.62-2.2.44-3.06-.35C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09l.01-.01zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z"})}),o.jsx("span",{children:He.apple}),o.jsx("span",{className:"text-xs opacity-60",children:"(Coming soon)"})]})]}),o.jsxs("p",{className:"text-center text-gray-500",children:[He.hasAccount," ",o.jsx(qh,{to:"/login",className:"text-violet-600 font-semibold hover:underline",children:He.login})]}),o.jsxs("p",{className:"text-xs text-gray-400 text-center mt-6 px-4 leading-relaxed",children:[He.terms," ",o.jsx(qh,{to:"/impressum",className:"text-violet-500 hover:underline",children:He.termsLink})," ",He.and," ",o.jsx(qh,{to:"/datenschutz",className:"text-violet-500 hover:underline",children:He.privacyLink}),"."]})]}),M&&o.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>G(!1)})]})};var uk={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */uk.exports;(function(s,n){(function(){var i,l="4.17.23",u=200,p="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",g="Expected a function",y="Invalid `variable` option passed into `_.template`",x="__lodash_hash_undefined__",C=500,k="__lodash_placeholder__",A=1,M=2,G=4,B=1,X=2,Z=1,q=2,V=4,ee=8,de=16,ae=32,ye=64,Q=128,$=256,se=512,ce=30,he="...",ve=800,ge=16,qe=1,Dt=2,gt=3,Ye=1/0,ze=9007199254740991,ut=17976931348623157e292,yt=NaN,Xt=4294967295,jt=Xt-1,Gt=Xt>>>1,mn=[["ary",Q],["bind",Z],["bindKey",q],["curry",ee],["curryRight",de],["flip",se],["partial",ae],["partialRight",ye],["rearg",$]],Pt="[object Arguments]",Jt="[object Array]",He="[object AsyncFunction]",bt="[object Boolean]",Wt="[object Date]",gn="[object DOMException]",xt="[object Error]",Sn="[object Function]",cr="[object GeneratorFunction]",Or="[object Map]",ms="[object Number]",Oi="[object Null]",xi="[object Object]",Gr="[object Promise]",qt="[object Proxy]",Jr="[object RegExp]",Ht="[object Set]",wi="[object String]",Cs="[object Symbol]",gr="[object Undefined]",Za="[object WeakMap]",es="[object WeakSet]",Sr="[object ArrayBuffer]",Ki="[object DataView]",Go="[object Float32Array]",vc="[object Float64Array]",Ec="[object Int8Array]",Ve="[object Int16Array]",Qt="[object Int32Array]",_n="[object Uint8Array]",Qe="[object Uint8ClampedArray]",Bt="[object Uint16Array]",Ct="[object Uint32Array]",sn=/\b__p \+= '';/g,Qn=/\b(__p \+=) '' \+/g,qn=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Bs=/&(?:amp|lt|gt|quot|#39);/g,qd=/[&<>"']/g,Xl=RegExp(Bs.source),bo=RegExp(qd.source),F_=/<%-([\s\S]+?)%>/g,yc=/<%([\s\S]+?)%>/g,vm=/<%=([\s\S]+?)%>/g,ih=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,B_=/^\w*$/,Wr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,gp=/[\\^$.*+?()[\]{}|]/g,ah=RegExp(gp.source),xo=/^\s+/,z_=/\s/,G_=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,$l=/\{\n\/\* \[wrapped with (.+)\] \*/,Vy=/,? & /,W_=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,oh=/[()=,{}\[\]\/\s]/,H_=/\\(\\)?/g,Em=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ch=/\w*$/,bc=/^[-+]0x[0-9a-f]+$/i,ym=/^0b[01]+$/i,_p=/^\[object .+?Constructor\]$/,vp=/^0o[0-7]+$/i,rl=/^(?:0|[1-9]\d*)$/,K_=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,lh=/($^)/,Wo=/['\n\r\u2028\u2029\\]/g,Jl="\\ud800-\\udfff",q_="\\u0300-\\u036f",Ns="\\ufe20-\\ufe2f",dh="\\u20d0-\\u20ff",sl=q_+Ns+dh,Ep="\\u2700-\\u27bf",Y_="a-z\\xdf-\\xf6\\xf8-\\xff",yp="\\xac\\xb1\\xd7\\xf7",X_="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",bm="\\u2000-\\u206f",xm=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",bp="A-Z\\xc0-\\xd6\\xd8-\\xde",wm="\\ufe0e\\ufe0f",il=yp+X_+bm+xm,uh="[']",Fy="["+Jl+"]",Nr="["+il+"]",hh="["+sl+"]",Sm="\\d+",al="["+Ep+"]",Ho="["+Y_+"]",ph="[^"+Jl+il+Sm+Ep+Y_+bp+"]",Yd="\\ud83c[\\udffb-\\udfff]",$_="(?:"+hh+"|"+Yd+")",ts="[^"+Jl+"]",Xd="(?:\\ud83c[\\udde6-\\uddff]){2}",xc="[\\ud800-\\udbff][\\udc00-\\udfff]",wo="["+bp+"]",xp="\\u200d",Tm="(?:"+Ho+"|"+ph+")",Rm="(?:"+wo+"|"+ph+")",J_="(?:"+uh+"(?:d|ll|m|re|s|t|ve))?",Cm="(?:"+uh+"(?:D|LL|M|RE|S|T|VE))?",Q_=$_+"?",$d="["+wm+"]?",ol="(?:"+xp+"(?:"+[ts,Xd,xc].join("|")+")"+$d+Q_+")*",Z_="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",e0="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Nm=$d+Q_+ol,Jd="(?:"+[al,Xd,xc].join("|")+")"+Nm,By="(?:"+[ts+hh+"?",hh,Xd,xc,Fy].join("|")+")",t0=RegExp(uh,"g"),zy=RegExp(hh,"g"),Ko=RegExp(Yd+"(?="+Yd+")|"+By+Nm,"g"),Gy=RegExp([wo+"?"+Ho+"+"+J_+"(?="+[Nr,wo,"$"].join("|")+")",Rm+"+"+Cm+"(?="+[Nr,wo+Tm,"$"].join("|")+")",wo+"?"+Tm+"+"+J_,wo+"+"+Cm,e0,Z_,Sm,Jd].join("|"),"g"),fh=RegExp("["+xp+Jl+sl+wm+"]"),wp=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Sp=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],n0=-1,Dr={};Dr[Go]=Dr[vc]=Dr[Ec]=Dr[Ve]=Dr[Qt]=Dr[_n]=Dr[Qe]=Dr[Bt]=Dr[Ct]=!0,Dr[Pt]=Dr[Jt]=Dr[Sr]=Dr[bt]=Dr[Ki]=Dr[Wt]=Dr[xt]=Dr[Sn]=Dr[Or]=Dr[ms]=Dr[xi]=Dr[Jr]=Dr[Ht]=Dr[wi]=Dr[Za]=!1;var Tr={};Tr[Pt]=Tr[Jt]=Tr[Sr]=Tr[Ki]=Tr[bt]=Tr[Wt]=Tr[Go]=Tr[vc]=Tr[Ec]=Tr[Ve]=Tr[Qt]=Tr[Or]=Tr[ms]=Tr[xi]=Tr[Jr]=Tr[Ht]=Tr[wi]=Tr[Cs]=Tr[_n]=Tr[Qe]=Tr[Bt]=Tr[Ct]=!0,Tr[xt]=Tr[Sn]=Tr[Za]=!1;var r0={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},Im={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Is={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},cl={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},eo=parseFloat,Am=parseInt,km=typeof Gh=="object"&&Gh&&Gh.Object===Object&&Gh,s0=typeof self=="object"&&self&&self.Object===Object&&self,zs=km||s0||Function("return this")(),hi=n&&!n.nodeType&&n,qi=hi&&!0&&s&&!s.nodeType&&s,Om=qi&&qi.exports===hi,Dm=Om&&km.process,ei=function(){try{var Ie=qi&&qi.require&&qi.require("util").types;return Ie||Dm&&Dm.binding&&Dm.binding("util")}catch{}}(),Tp=ei&&ei.isArrayBuffer,Rp=ei&&ei.isDate,Ql=ei&&ei.isMap,Pm=ei&&ei.isRegExp,Zl=ei&&ei.isSet,Cp=ei&&ei.isTypedArray;function Di(Ie,$e,Ge){switch(Ge.length){case 0:return Ie.call($e);case 1:return Ie.call($e,Ge[0]);case 2:return Ie.call($e,Ge[0],Ge[1]);case 3:return Ie.call($e,Ge[0],Ge[1],Ge[2])}return Ie.apply($e,Ge)}function mh(Ie,$e,Ge,Mt){for(var On=-1,Pr=Ie==null?0:Ie.length;++On<Pr;){var Ti=Ie[On];$e(Mt,Ti,Ge(Ti),Ie)}return Mt}function Ra(Ie,$e){for(var Ge=-1,Mt=Ie==null?0:Ie.length;++Ge<Mt&&$e(Ie[Ge],Ge,Ie)!==!1;);return Ie}function ll(Ie,$e){for(var Ge=Ie==null?0:Ie.length;Ge--&&$e(Ie[Ge],Ge,Ie)!==!1;);return Ie}function dl(Ie,$e){for(var Ge=-1,Mt=Ie==null?0:Ie.length;++Ge<Mt;)if(!$e(Ie[Ge],Ge,Ie))return!1;return!0}function qo(Ie,$e){for(var Ge=-1,Mt=Ie==null?0:Ie.length,On=0,Pr=[];++Ge<Mt;){var Ti=Ie[Ge];$e(Ti,Ge,Ie)&&(Pr[On++]=Ti)}return Pr}function gh(Ie,$e){var Ge=Ie==null?0:Ie.length;return!!Ge&&ed(Ie,$e,0)>-1}function Qd(Ie,$e,Ge){for(var Mt=-1,On=Ie==null?0:Ie.length;++Mt<On;)if(Ge($e,Ie[Mt]))return!0;return!1}function os(Ie,$e){for(var Ge=-1,Mt=Ie==null?0:Ie.length,On=Array(Mt);++Ge<Mt;)On[Ge]=$e(Ie[Ge],Ge,Ie);return On}function wc(Ie,$e){for(var Ge=-1,Mt=$e.length,On=Ie.length;++Ge<Mt;)Ie[On+Ge]=$e[Ge];return Ie}function ia(Ie,$e,Ge,Mt){var On=-1,Pr=Ie==null?0:Ie.length;for(Mt&&Pr&&(Ge=Ie[++On]);++On<Pr;)Ge=$e(Ge,Ie[On],On,Ie);return Ge}function i0(Ie,$e,Ge,Mt){var On=Ie==null?0:Ie.length;for(Mt&&On&&(Ge=Ie[--On]);On--;)Ge=$e(Ge,Ie[On],On,Ie);return Ge}function Sc(Ie,$e){for(var Ge=-1,Mt=Ie==null?0:Ie.length;++Ge<Mt;)if($e(Ie[Ge],Ge,Ie))return!0;return!1}var Lm=J("length");function a0(Ie){return Ie.split("")}function vn(Ie){return Ie.match(W_)||[]}function aa(Ie,$e,Ge){var Mt;return Ge(Ie,function(On,Pr,Ti){if($e(On,Pr,Ti))return Mt=Pr,!1}),Mt}function _h(Ie,$e,Ge,Mt){for(var On=Ie.length,Pr=Ge+(Mt?1:-1);Mt?Pr--:++Pr<On;)if($e(Ie[Pr],Pr,Ie))return Pr;return-1}function ed(Ie,$e,Ge){return $e===$e?RO(Ie,$e,Ge):_h(Ie,T,Ge)}function Zd(Ie,$e,Ge,Mt){for(var On=Ge-1,Pr=Ie.length;++On<Pr;)if(Mt(Ie[On],$e))return On;return-1}function T(Ie){return Ie!==Ie}function F(Ie,$e){var Ge=Ie==null?0:Ie.length;return Ge?vt(Ie,$e)/Ge:yt}function J(Ie){return function($e){return $e==null?i:$e[Ie]}}function me(Ie){return function($e){return Ie==null?i:Ie[$e]}}function Oe(Ie,$e,Ge,Mt,On){return On(Ie,function(Pr,Ti,ns){Ge=Mt?(Mt=!1,Pr):$e(Ge,Pr,Ti,ns)}),Ge}function We(Ie,$e){var Ge=Ie.length;for(Ie.sort($e);Ge--;)Ie[Ge]=Ie[Ge].value;return Ie}function vt(Ie,$e){for(var Ge,Mt=-1,On=Ie.length;++Mt<On;){var Pr=$e(Ie[Mt]);Pr!==i&&(Ge=Ge===i?Pr:Ge+Pr)}return Ge}function Ir(Ie,$e){for(var Ge=-1,Mt=Array(Ie);++Ge<Ie;)Mt[Ge]=$e(Ge);return Mt}function Si(Ie,$e){return os($e,function(Ge){return[Ge,Ie[Ge]]})}function Vn(Ie){return Ie&&Ie.slice(0,AT(Ie)+1).replace(xo,"")}function Hr(Ie){return function($e){return Ie($e)}}function pi(Ie,$e){return os($e,function(Ge){return Ie[Ge]})}function Yo(Ie,$e){return Ie.has($e)}function Ca(Ie,$e){for(var Ge=-1,Mt=Ie.length;++Ge<Mt&&ed($e,Ie[Ge],0)>-1;);return Ge}function td(Ie,$e){for(var Ge=Ie.length;Ge--&&ed($e,Ie[Ge],0)>-1;);return Ge}function jm(Ie,$e){for(var Ge=Ie.length,Mt=0;Ge--;)Ie[Ge]===$e&&++Mt;return Mt}var bO=me(r0),xO=me(Im);function So(Ie){return"\\"+cl[Ie]}function wO(Ie,$e){return Ie==null?i:Ie[$e]}function Np(Ie){return fh.test(Ie)}function SO(Ie){return wp.test(Ie)}function TO(Ie){for(var $e,Ge=[];!($e=Ie.next()).done;)Ge.push($e.value);return Ge}function Mm(Ie){var $e=-1,Ge=Array(Ie.size);return Ie.forEach(function(Mt,On){Ge[++$e]=[On,Mt]}),Ge}function IT(Ie,$e){return function(Ge){return Ie($e(Ge))}}function eu(Ie,$e){for(var Ge=-1,Mt=Ie.length,On=0,Pr=[];++Ge<Mt;){var Ti=Ie[Ge];(Ti===$e||Ti===k)&&(Ie[Ge]=k,Pr[On++]=Ge)}return Pr}function Um(Ie){var $e=-1,Ge=Array(Ie.size);return Ie.forEach(function(Mt){Ge[++$e]=Mt}),Ge}function Wy(Ie){var $e=-1,Ge=Array(Ie.size);return Ie.forEach(function(Mt){Ge[++$e]=[Mt,Mt]}),Ge}function RO(Ie,$e,Ge){for(var Mt=Ge-1,On=Ie.length;++Mt<On;)if(Ie[Mt]===$e)return Mt;return-1}function CO(Ie,$e,Ge){for(var Mt=Ge+1;Mt--;)if(Ie[Mt]===$e)return Mt;return Mt}function nd(Ie){return Np(Ie)?tu(Ie):Lm(Ie)}function Tc(Ie){return Np(Ie)?IO(Ie):a0(Ie)}function AT(Ie){for(var $e=Ie.length;$e--&&z_.test(Ie.charAt($e)););return $e}var NO=me(Is);function tu(Ie){for(var $e=Ko.lastIndex=0;Ko.test(Ie);)++$e;return $e}function IO(Ie){return Ie.match(Ko)||[]}function AO(Ie){return Ie.match(Gy)||[]}var Na=function Ie($e){$e=$e==null?zs:Ip.defaults(zs.Object(),$e,Ip.pick(zs,Sp));var Ge=$e.Array,Mt=$e.Date,On=$e.Error,Pr=$e.Function,Ti=$e.Math,ns=$e.Object,Hy=$e.RegExp,kO=$e.String,to=$e.TypeError,Ap=Ge.prototype,OO=Pr.prototype,ke=ns.prototype,o0=$e["__core-js_shared__"],c0=OO.toString,Kr=ke.hasOwnProperty,DO=0,Ky=function(){var _=/[^.]+$/.exec(o0&&o0.keys&&o0.keys.IE_PROTO||"");return _?"Symbol(src)_1."+_:""}(),Vm=ke.toString,PO=c0.call(ns),LO=zs._,jO=Hy("^"+c0.call(Kr).replace(gp,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),vh=Om?$e.Buffer:i,Xo=$e.Symbol,l0=$e.Uint8Array,kT=vh?vh.allocUnsafe:i,Eh=IT(ns.getPrototypeOf,ns),d0=ns.create,Fm=ke.propertyIsEnumerable,u0=Ap.splice,OT=Xo?Xo.isConcatSpreadable:i,Bm=Xo?Xo.iterator:i,yh=Xo?Xo.toStringTag:i,kp=function(){try{var _=du(ns,"defineProperty");return _({},"",{}),_}catch{}}(),MO=$e.clearTimeout!==zs.clearTimeout&&$e.clearTimeout,DT=Mt&&Mt.now!==zs.Date.now&&Mt.now,To=$e.setTimeout!==zs.setTimeout&&$e.setTimeout,h0=Ti.ceil,nu=Ti.floor,qy=ns.getOwnPropertySymbols,UO=vh?vh.isBuffer:i,PT=$e.isFinite,LT=Ap.join,VO=IT(ns.keys,ns),Ri=Ti.max,oa=Ti.min,Yy=Mt.now,FO=$e.parseInt,Xy=Ti.random,jT=Ap.reverse,$y=du($e,"DataView"),Op=du($e,"Map"),Dp=du($e,"Promise"),Pp=du($e,"Set"),zm=du($e,"WeakMap"),Gm=du(ns,"create"),p0=zm&&new zm,Lp={},MT=ld($y),Jy=ld(Op),BO=ld(Dp),Qy=ld(Pp),zO=ld(zm),f0=Xo?Xo.prototype:i,Wm=f0?f0.valueOf:i,UT=f0?f0.toString:i;function ue(_){if(Ws(_)&&!Dn(_)&&!(_ instanceof lr)){if(_ instanceof $o)return _;if(Kr.call(_,"__wrapped__"))return SR(_)}return new $o(_)}var jp=function(){function _(){}return function(b){if(!gs(b))return{};if(d0)return d0(b);_.prototype=b;var N=new _;return _.prototype=i,N}}();function m0(){}function $o(_,b){this.__wrapped__=_,this.__actions__=[],this.__chain__=!!b,this.__index__=0,this.__values__=i}ue.templateSettings={escape:F_,evaluate:yc,interpolate:vm,variable:"",imports:{_:ue}},ue.prototype=m0.prototype,ue.prototype.constructor=ue,$o.prototype=jp(m0.prototype),$o.prototype.constructor=$o;function lr(_){this.__wrapped__=_,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Xt,this.__views__=[]}function GO(){var _=new lr(this.__wrapped__);return _.__actions__=Ia(this.__actions__),_.__dir__=this.__dir__,_.__filtered__=this.__filtered__,_.__iteratees__=Ia(this.__iteratees__),_.__takeCount__=this.__takeCount__,_.__views__=Ia(this.__views__),_}function WO(){if(this.__filtered__){var _=new lr(this);_.__dir__=-1,_.__filtered__=!0}else _=this.clone(),_.__dir__*=-1;return _}function g0(){var _=this.__wrapped__.value(),b=this.__dir__,N=Dn(_),U=b<0,re=N?_.length:0,pe=gR(0,re,this.__views__),xe=pe.start,Se=pe.end,Ae=Se-xe,et=U?Se:xe-1,it=this.__iteratees__,ct=it.length,wt=0,Yt=oa(Ae,this.__takeCount__);if(!N||!U&&re==Ae&&Yt==Ae)return zp(_,this.__actions__);var dn=[];e:for(;Ae--&&wt<Yt;){et+=b;for(var un=-1,En=_[et];++un<ct;){var sr=it[un],ir=sr.iteratee,Xi=sr.type,$i=ir(En);if(Xi==Dt)En=$i;else if(!$i){if(Xi==qe)continue e;break e}}dn[wt++]=En}return dn}lr.prototype=jp(m0.prototype),lr.prototype.constructor=lr;function ul(_){var b=-1,N=_==null?0:_.length;for(this.clear();++b<N;){var U=_[b];this.set(U[0],U[1])}}function Zy(){this.__data__=Gm?Gm(null):{},this.size=0}function HO(_){var b=this.has(_)&&delete this.__data__[_];return this.size-=b?1:0,b}function KO(_){var b=this.__data__;if(Gm){var N=b[_];return N===x?i:N}return Kr.call(b,_)?b[_]:i}function qO(_){var b=this.__data__;return Gm?b[_]!==i:Kr.call(b,_)}function VT(_,b){var N=this.__data__;return this.size+=this.has(_)?0:1,N[_]=Gm&&b===i?x:b,this}ul.prototype.clear=Zy,ul.prototype.delete=HO,ul.prototype.get=KO,ul.prototype.has=qO,ul.prototype.set=VT;function hl(_){var b=-1,N=_==null?0:_.length;for(this.clear();++b<N;){var U=_[b];this.set(U[0],U[1])}}function eb(){this.__data__=[],this.size=0}function YO(_){var b=this.__data__,N=v0(b,_);if(N<0)return!1;var U=b.length-1;return N==U?b.pop():u0.call(b,N,1),--this.size,!0}function XO(_){var b=this.__data__,N=v0(b,_);return N<0?i:b[N][1]}function Hm(_){return v0(this.__data__,_)>-1}function $O(_,b){var N=this.__data__,U=v0(N,_);return U<0?(++this.size,N.push([_,b])):N[U][1]=b,this}hl.prototype.clear=eb,hl.prototype.delete=YO,hl.prototype.get=XO,hl.prototype.has=Hm,hl.prototype.set=$O;function rd(_){var b=-1,N=_==null?0:_.length;for(this.clear();++b<N;){var U=_[b];this.set(U[0],U[1])}}function JO(){this.size=0,this.__data__={hash:new ul,map:new(Op||hl),string:new ul}}function QO(_){var b=M0(this,_).delete(_);return this.size-=b?1:0,b}function ZO(_){return M0(this,_).get(_)}function eD(_){return M0(this,_).has(_)}function FT(_,b){var N=M0(this,_),U=N.size;return N.set(_,b),this.size+=N.size==U?0:1,this}rd.prototype.clear=JO,rd.prototype.delete=QO,rd.prototype.get=ZO,rd.prototype.has=eD,rd.prototype.set=FT;function bh(_){var b=-1,N=_==null?0:_.length;for(this.__data__=new rd;++b<N;)this.add(_[b])}function tD(_){return this.__data__.set(_,x),this}function nD(_){return this.__data__.has(_)}bh.prototype.add=bh.prototype.push=tD,bh.prototype.has=nD;function Ro(_){var b=this.__data__=new hl(_);this.size=b.size}function rD(){this.__data__=new hl,this.size=0}function sD(_){var b=this.__data__,N=b.delete(_);return this.size=b.size,N}function _0(_){return this.__data__.get(_)}function iD(_){return this.__data__.has(_)}function aD(_,b){var N=this.__data__;if(N instanceof hl){var U=N.__data__;if(!Op||U.length<u-1)return U.push([_,b]),this.size=++N.size,this;N=this.__data__=new rd(U)}return N.set(_,b),this.size=N.size,this}Ro.prototype.clear=rD,Ro.prototype.delete=sD,Ro.prototype.get=_0,Ro.prototype.has=iD,Ro.prototype.set=aD;function BT(_,b){var N=Dn(_),U=!N&&mu(_),re=!N&&!U&&dd(_),pe=!N&&!U&&!re&&tf(_),xe=N||U||re||pe,Se=xe?Ir(_.length,kO):[],Ae=Se.length;for(var et in _)(b||Kr.call(_,et))&&!(xe&&(et=="length"||re&&(et=="offset"||et=="parent")||pe&&(et=="buffer"||et=="byteLength"||et=="byteOffset")||gl(et,Ae)))&&Se.push(et);return Se}function zT(_){var b=_.length;return b?_[C0(0,b-1)]:i}function oD(_,b){return z0(Ia(_),id(b,0,_.length))}function cD(_){return z0(Ia(_))}function Mp(_,b,N){(N!==i&&!Io(_[b],N)||N===i&&!(b in _))&&sd(_,b,N)}function Up(_,b,N){var U=_[b];(!(Kr.call(_,b)&&Io(U,N))||N===i&&!(b in _))&&sd(_,b,N)}function v0(_,b){for(var N=_.length;N--;)if(Io(_[N][0],b))return N;return-1}function lD(_,b,N,U){return Rc(_,function(re,pe,xe){b(U,re,N(re),xe)}),U}function tb(_,b){return _&&da(b,Li(b),_)}function dD(_,b){return _&&da(b,ua(b),_)}function sd(_,b,N){b=="__proto__"&&kp?kp(_,b,{configurable:!0,enumerable:!0,value:N,writable:!0}):_[b]=N}function nb(_,b){for(var N=-1,U=b.length,re=Ge(U),pe=_==null;++N<U;)re[N]=pe?i:ug(_,b[N]);return re}function id(_,b,N){return _===_&&(N!==i&&(_=_<=N?_:N),b!==i&&(_=_>=b?_:b)),_}function no(_,b,N,U,re,pe){var xe,Se=b&A,Ae=b&M,et=b&G;if(N&&(xe=re?N(_,U,re,pe):N(_)),xe!==i)return xe;if(!gs(_))return _;var it=Dn(_);if(it){if(xe=VD(_),!Se)return Ia(_,xe)}else{var ct=Pi(_),wt=ct==Sn||ct==cr;if(dd(_))return O0(_,Se);if(ct==xi||ct==Pt||wt&&!re){if(xe=Ae||wt?{}:Rb(_),!Se)return Ae?AD(_,dD(xe,_)):gb(_,tb(xe,_))}else{if(!Tr[ct])return re?_:{};xe=F0(_,ct,Se)}}pe||(pe=new Ro);var Yt=pe.get(_);if(Yt)return Yt;pe.set(_,xe),_C(_)?_.forEach(function(En){xe.add(no(En,b,N,En,_,pe))}):mC(_)&&_.forEach(function(En,sr){xe.set(sr,no(En,b,N,sr,_,pe))});var dn=et?Ae?xb:Qm:Ae?ua:Li,un=it?i:dn(_);return Ra(un||_,function(En,sr){un&&(sr=En,En=_[sr]),Up(xe,sr,no(En,b,N,sr,_,pe))}),xe}function GT(_){var b=Li(_);return function(N){return E0(N,_,b)}}function E0(_,b,N){var U=N.length;if(_==null)return!U;for(_=ns(_);U--;){var re=N[U],pe=b[re],xe=_[re];if(xe===i&&!(re in _)||!pe(xe))return!1}return!0}function rb(_,b,N){if(typeof _!="function")throw new to(g);return eg(function(){_.apply(i,N)},b)}function Vp(_,b,N,U){var re=-1,pe=gh,xe=!0,Se=_.length,Ae=[],et=b.length;if(!Se)return Ae;N&&(b=os(b,Hr(N))),U?(pe=Qd,xe=!1):b.length>=u&&(pe=Yo,xe=!1,b=new bh(b));e:for(;++re<Se;){var it=_[re],ct=N==null?it:N(it);if(it=U||it!==0?it:0,xe&&ct===ct){for(var wt=et;wt--;)if(b[wt]===ct)continue e;Ae.push(it)}else pe(b,ct,U)||Ae.push(it)}return Ae}var Rc=_b(pl),Fp=_b(sb,!0);function uD(_,b){var N=!0;return Rc(_,function(U,re,pe){return N=!!b(U,re,pe),N}),N}function y0(_,b,N){for(var U=-1,re=_.length;++U<re;){var pe=_[U],xe=b(pe);if(xe!=null&&(Se===i?xe===xe&&!Ao(xe):N(xe,Se)))var Se=xe,Ae=pe}return Ae}function WT(_,b,N,U){var re=_.length;for(N=Gn(N),N<0&&(N=-N>re?0:re+N),U=U===i||U>re?re:Gn(U),U<0&&(U+=re),U=N>U?0:yC(U);N<U;)_[N++]=b;return _}function HT(_,b){var N=[];return Rc(_,function(U,re,pe){b(U,re,pe)&&N.push(U)}),N}function Yi(_,b,N,U,re){var pe=-1,xe=_.length;for(N||(N=_R),re||(re=[]);++pe<xe;){var Se=_[pe];b>0&&N(Se)?b>1?Yi(Se,b-1,N,U,re):wc(re,Se):U||(re[re.length]=Se)}return re}var b0=vb(),KT=vb(!0);function pl(_,b){return _&&b0(_,b,Li)}function sb(_,b){return _&&KT(_,b,Li)}function x0(_,b){return qo(b,function(N){return vl(_[N])})}function xh(_,b){b=ad(b,_);for(var N=0,U=b.length;_!=null&&N<U;)_=_[Nc(b[N++])];return N&&N==U?_:i}function qT(_,b,N){var U=b(_);return Dn(_)?U:wc(U,N(_))}function ca(_){return _==null?_===i?gr:Oi:yh&&yh in ns(_)?UD(_):HD(_)}function ru(_,b){return _>b}function hD(_,b){return _!=null&&Kr.call(_,b)}function pD(_,b){return _!=null&&b in ns(_)}function fD(_,b,N){return _>=oa(b,N)&&_<Ri(b,N)}function w0(_,b,N){for(var U=N?Qd:gh,re=_[0].length,pe=_.length,xe=pe,Se=Ge(pe),Ae=1/0,et=[];xe--;){var it=_[xe];xe&&b&&(it=os(it,Hr(b))),Ae=oa(it.length,Ae),Se[xe]=!N&&(b||re>=120&&it.length>=120)?new bh(xe&&it):i}it=_[0];var ct=-1,wt=Se[0];e:for(;++ct<re&&et.length<Ae;){var Yt=it[ct],dn=b?b(Yt):Yt;if(Yt=N||Yt!==0?Yt:0,!(wt?Yo(wt,dn):U(et,dn,N))){for(xe=pe;--xe;){var un=Se[xe];if(!(un?Yo(un,dn):U(_[xe],dn,N)))continue e}wt&&wt.push(dn),et.push(Yt)}}return et}function mD(_,b,N,U){return pl(_,function(re,pe,xe){b(U,N(re),pe,xe)}),U}function Bp(_,b,N){b=ad(b,_),_=xR(_,b);var U=_==null?_:_[Nc(No(b))];return U==null?i:Di(U,_,N)}function YT(_){return Ws(_)&&ca(_)==Pt}function gD(_){return Ws(_)&&ca(_)==Sr}function _D(_){return Ws(_)&&ca(_)==Wt}function su(_,b,N,U,re){return _===b?!0:_==null||b==null||!Ws(_)&&!Ws(b)?_!==_&&b!==b:vD(_,b,N,U,su,re)}function vD(_,b,N,U,re,pe){var xe=Dn(_),Se=Dn(b),Ae=xe?Jt:Pi(_),et=Se?Jt:Pi(b);Ae=Ae==Pt?xi:Ae,et=et==Pt?xi:et;var it=Ae==xi,ct=et==xi,wt=Ae==et;if(wt&&dd(_)){if(!dd(b))return!1;xe=!0,it=!1}if(wt&&!it)return pe||(pe=new Ro),xe||tf(_)?mR(_,b,N,U,re,pe):jD(_,b,Ae,N,U,re,pe);if(!(N&B)){var Yt=it&&Kr.call(_,"__wrapped__"),dn=ct&&Kr.call(b,"__wrapped__");if(Yt||dn){var un=Yt?_.value():_,En=dn?b.value():b;return pe||(pe=new Ro),re(un,En,N,U,pe)}}return wt?(pe||(pe=new Ro),MD(_,b,N,U,re,pe)):!1}function ED(_){return Ws(_)&&Pi(_)==Or}function ib(_,b,N,U){var re=N.length,pe=re,xe=!U;if(_==null)return!pe;for(_=ns(_);re--;){var Se=N[re];if(xe&&Se[2]?Se[1]!==_[Se[0]]:!(Se[0]in _))return!1}for(;++re<pe;){Se=N[re];var Ae=Se[0],et=_[Ae],it=Se[1];if(xe&&Se[2]){if(et===i&&!(Ae in _))return!1}else{var ct=new Ro;if(U)var wt=U(et,it,Ae,_,b,ct);if(!(wt===i?su(it,et,B|X,U,ct):wt))return!1}}return!0}function XT(_){if(!gs(_)||BD(_))return!1;var b=vl(_)?jO:_p;return b.test(ld(_))}function yD(_){return Ws(_)&&ca(_)==Jr}function bD(_){return Ws(_)&&Pi(_)==Ht}function ab(_){return Ws(_)&&rv(_.length)&&!!Dr[ca(_)]}function $T(_){return typeof _=="function"?_:_==null?so:typeof _=="object"?Dn(_)?ZT(_[0],_[1]):QT(_):YC(_)}function S0(_){if(!uu(_))return VO(_);var b=[];for(var N in ns(_))Kr.call(_,N)&&N!="constructor"&&b.push(N);return b}function xD(_){if(!gs(_))return WD(_);var b=uu(_),N=[];for(var U in _)U=="constructor"&&(b||!Kr.call(_,U))||N.push(U);return N}function T0(_,b){return _<b}function JT(_,b){var N=-1,U=ka(_)?Ge(_.length):[];return Rc(_,function(re,pe,xe){U[++N]=b(re,pe,xe)}),U}function QT(_){var b=U0(_);return b.length==1&&b[0][2]?yR(b[0][0],b[0][1]):function(N){return N===_||ib(N,_,b)}}function ZT(_,b){return Yp(_)&&ER(b)?yR(Nc(_),b):function(N){var U=ug(N,_);return U===i&&U===b?cx(N,_):su(b,U,B|X)}}function R0(_,b,N,U,re){_!==b&&b0(b,function(pe,xe){if(re||(re=new Ro),gs(pe))wD(_,b,xe,N,R0,U,re);else{var Se=U?U(Ib(_,xe),pe,xe+"",_,b,re):i;Se===i&&(Se=pe),Mp(_,xe,Se)}},ua)}function wD(_,b,N,U,re,pe,xe){var Se=Ib(_,N),Ae=Ib(b,N),et=xe.get(Ae);if(et){Mp(_,N,et);return}var it=pe?pe(Se,Ae,N+"",_,b,xe):i,ct=it===i;if(ct){var wt=Dn(Ae),Yt=!wt&&dd(Ae),dn=!wt&&!Yt&&tf(Ae);it=Ae,wt||Yt||dn?Dn(Se)?it=Se:Gs(Se)?it=Ia(Se):Yt?(ct=!1,it=O0(Ae,!0)):dn?(ct=!1,it=lR(Ae,!0)):it=[]:dg(Ae)||mu(Ae)?(it=Se,mu(Se)?it=bC(Se):(!gs(Se)||vl(Se))&&(it=Rb(Ae))):ct=!1}ct&&(xe.set(Ae,it),re(it,Ae,U,pe,xe),xe.delete(Ae)),Mp(_,N,it)}function eR(_,b){var N=_.length;if(N)return b+=b<0?N:0,gl(b,N)?_[b]:i}function ob(_,b,N){b.length?b=os(b,function(pe){return Dn(pe)?function(xe){return xh(xe,pe.length===1?pe[0]:pe)}:pe}):b=[so];var U=-1;b=os(b,Hr(ln()));var re=JT(_,function(pe,xe,Se){var Ae=os(b,function(et){return et(pe)});return{criteria:Ae,index:++U,value:pe}});return We(re,function(pe,xe){return Wp(pe,xe,N)})}function SD(_,b){return tR(_,b,function(N,U){return cx(_,U)})}function tR(_,b,N){for(var U=-1,re=b.length,pe={};++U<re;){var xe=b[U],Se=xh(_,xe);N(Se,xe)&&iu(pe,ad(xe,_),Se)}return pe}function nR(_){return function(b){return xh(b,_)}}function cb(_,b,N,U){var re=U?Zd:ed,pe=-1,xe=b.length,Se=_;for(_===b&&(b=Ia(b)),N&&(Se=os(_,Hr(N)));++pe<xe;)for(var Ae=0,et=b[pe],it=N?N(et):et;(Ae=re(Se,it,Ae,U))>-1;)Se!==_&&u0.call(Se,Ae,1),u0.call(_,Ae,1);return _}function Km(_,b){for(var N=_?b.length:0,U=N-1;N--;){var re=b[N];if(N==U||re!==pe){var pe=re;gl(re)?u0.call(_,re,1):ou(_,re)}}return _}function C0(_,b){return _+nu(Xy()*(b-_+1))}function qm(_,b,N,U){for(var re=-1,pe=Ri(h0((b-_)/(N||1)),0),xe=Ge(pe);pe--;)xe[U?pe:++re]=_,_+=N;return xe}function lb(_,b){var N="";if(!_||b<1||b>ze)return N;do b%2&&(N+=_),b=nu(b/2),b&&(_+=_);while(b);return N}function Zn(_,b){return kb(B0(_,b,so),_+"")}function TD(_){return zT(nf(_))}function RD(_,b){var N=nf(_);return z0(N,id(b,0,N.length))}function iu(_,b,N,U){if(!gs(_))return _;b=ad(b,_);for(var re=-1,pe=b.length,xe=pe-1,Se=_;Se!=null&&++re<pe;){var Ae=Nc(b[re]),et=N;if(Ae==="__proto__"||Ae==="constructor"||Ae==="prototype")return _;if(re!=xe){var it=Se[Ae];et=U?U(it,Ae,Se):i,et===i&&(et=gs(it)?it:gl(b[re+1])?[]:{})}Up(Se,Ae,et),Se=Se[Ae]}return _}var rR=p0?function(_,b){return p0.set(_,b),_}:so,sR=kp?function(_,b){return kp(_,"toString",{configurable:!0,enumerable:!1,value:lv(b),writable:!0})}:so;function db(_){return z0(nf(_))}function ro(_,b,N){var U=-1,re=_.length;b<0&&(b=-b>re?0:re+b),N=N>re?re:N,N<0&&(N+=re),re=b>N?0:N-b>>>0,b>>>=0;for(var pe=Ge(re);++U<re;)pe[U]=_[U+b];return pe}function CD(_,b){var N;return Rc(_,function(U,re,pe){return N=b(U,re,pe),!N}),!!N}function N0(_,b,N){var U=0,re=_==null?U:_.length;if(typeof b=="number"&&b===b&&re<=Gt){for(;U<re;){var pe=U+re>>>1,xe=_[pe];xe!==null&&!Ao(xe)&&(N?xe<=b:xe<b)?U=pe+1:re=pe}return re}return ub(_,b,so,N)}function ub(_,b,N,U){var re=0,pe=_==null?0:_.length;if(pe===0)return 0;b=N(b);for(var xe=b!==b,Se=b===null,Ae=Ao(b),et=b===i;re<pe;){var it=nu((re+pe)/2),ct=N(_[it]),wt=ct!==i,Yt=ct===null,dn=ct===ct,un=Ao(ct);if(xe)var En=U||dn;else et?En=dn&&(U||wt):Se?En=dn&&wt&&(U||!Yt):Ae?En=dn&&wt&&!Yt&&(U||!un):Yt||un?En=!1:En=U?ct<=b:ct<b;En?re=it+1:pe=it}return oa(pe,jt)}function iR(_,b){for(var N=-1,U=_.length,re=0,pe=[];++N<U;){var xe=_[N],Se=b?b(xe):xe;if(!N||!Io(Se,Ae)){var Ae=Se;pe[re++]=xe===0?0:xe}}return pe}function aR(_){return typeof _=="number"?_:Ao(_)?yt:+_}function la(_){if(typeof _=="string")return _;if(Dn(_))return os(_,la)+"";if(Ao(_))return UT?UT.call(_):"";var b=_+"";return b=="0"&&1/_==-Ye?"-0":b}function au(_,b,N){var U=-1,re=gh,pe=_.length,xe=!0,Se=[],Ae=Se;if(N)xe=!1,re=Qd;else if(pe>=u){var et=b?null:PD(_);if(et)return Um(et);xe=!1,re=Yo,Ae=new bh}else Ae=b?[]:Se;e:for(;++U<pe;){var it=_[U],ct=b?b(it):it;if(it=N||it!==0?it:0,xe&&ct===ct){for(var wt=Ae.length;wt--;)if(Ae[wt]===ct)continue e;b&&Ae.push(ct),Se.push(it)}else re(Ae,ct,N)||(Ae!==Se&&Ae.push(ct),Se.push(it))}return Se}function ou(_,b){b=ad(b,_);var N=-1,U=b.length;if(!U)return!0;for(var re=_==null||typeof _!="object"&&typeof _!="function";++N<U;){var pe=b[N];if(typeof pe=="string"){if(pe==="__proto__"&&!Kr.call(_,"__proto__"))return!1;if(pe==="constructor"&&N+1<U&&typeof b[N+1]=="string"&&b[N+1]==="prototype"){if(re&&N===0)continue;return!1}}}var xe=xR(_,b);return xe==null||delete xe[Nc(No(b))]}function I0(_,b,N,U){return iu(_,b,N(xh(_,b)),U)}function wh(_,b,N,U){for(var re=_.length,pe=U?re:-1;(U?pe--:++pe<re)&&b(_[pe],pe,_););return N?ro(_,U?0:pe,U?pe+1:re):ro(_,U?pe+1:0,U?re:pe)}function zp(_,b){var N=_;return N instanceof lr&&(N=N.value()),ia(b,function(U,re){return re.func.apply(re.thisArg,wc([U],re.args))},N)}function Gp(_,b,N){var U=_.length;if(U<2)return U?au(_[0]):[];for(var re=-1,pe=Ge(U);++re<U;)for(var xe=_[re],Se=-1;++Se<U;)Se!=re&&(pe[re]=Vp(pe[re]||xe,_[Se],b,N));return au(Yi(pe,1),b,N)}function oR(_,b,N){for(var U=-1,re=_.length,pe=b.length,xe={};++U<re;){var Se=U<pe?b[U]:i;N(xe,_[U],Se)}return xe}function A0(_){return Gs(_)?_:[]}function hb(_){return typeof _=="function"?_:so}function ad(_,b){return Dn(_)?_:Yp(_,b)?[_]:Db(qr(_))}var ND=Zn;function cu(_,b,N){var U=_.length;return N=N===i?U:N,!b&&N>=U?_:ro(_,b,N)}var k0=MO||function(_){return zs.clearTimeout(_)};function O0(_,b){if(b)return _.slice();var N=_.length,U=kT?kT(N):new _.constructor(N);return _.copy(U),U}function pb(_){var b=new _.constructor(_.byteLength);return new l0(b).set(new l0(_)),b}function ID(_,b){var N=b?pb(_.buffer):_.buffer;return new _.constructor(N,_.byteOffset,_.byteLength)}function cR(_){var b=new _.constructor(_.source,ch.exec(_));return b.lastIndex=_.lastIndex,b}function fb(_){return Wm?ns(Wm.call(_)):{}}function lR(_,b){var N=b?pb(_.buffer):_.buffer;return new _.constructor(N,_.byteOffset,_.length)}function Cc(_,b){if(_!==b){var N=_!==i,U=_===null,re=_===_,pe=Ao(_),xe=b!==i,Se=b===null,Ae=b===b,et=Ao(b);if(!Se&&!et&&!pe&&_>b||pe&&xe&&Ae&&!Se&&!et||U&&xe&&Ae||!N&&Ae||!re)return 1;if(!U&&!pe&&!et&&_<b||et&&N&&re&&!U&&!pe||Se&&N&&re||!xe&&re||!Ae)return-1}return 0}function Wp(_,b,N){for(var U=-1,re=_.criteria,pe=b.criteria,xe=re.length,Se=N.length;++U<xe;){var Ae=Cc(re[U],pe[U]);if(Ae){if(U>=Se)return Ae;var et=N[U];return Ae*(et=="desc"?-1:1)}}return _.index-b.index}function lu(_,b,N,U){for(var re=-1,pe=_.length,xe=N.length,Se=-1,Ae=b.length,et=Ri(pe-xe,0),it=Ge(Ae+et),ct=!U;++Se<Ae;)it[Se]=b[Se];for(;++re<xe;)(ct||re<pe)&&(it[N[re]]=_[re]);for(;et--;)it[Se++]=_[re++];return it}function mb(_,b,N,U){for(var re=-1,pe=_.length,xe=-1,Se=N.length,Ae=-1,et=b.length,it=Ri(pe-Se,0),ct=Ge(it+et),wt=!U;++re<it;)ct[re]=_[re];for(var Yt=re;++Ae<et;)ct[Yt+Ae]=b[Ae];for(;++xe<Se;)(wt||re<pe)&&(ct[Yt+N[xe]]=_[re++]);return ct}function Ia(_,b){var N=-1,U=_.length;for(b||(b=Ge(U));++N<U;)b[N]=_[N];return b}function da(_,b,N,U){var re=!N;N||(N={});for(var pe=-1,xe=b.length;++pe<xe;){var Se=b[pe],Ae=U?U(N[Se],_[Se],Se,N,_):i;Ae===i&&(Ae=_[Se]),re?sd(N,Se,Ae):Up(N,Se,Ae)}return N}function gb(_,b){return da(_,Sb(_),b)}function AD(_,b){return da(_,Zm(_),b)}function Ym(_,b){return function(N,U){var re=Dn(N)?mh:lD,pe=b?b():{};return re(N,_,ln(U,2),pe)}}function Hp(_){return Zn(function(b,N){var U=-1,re=N.length,pe=re>1?N[re-1]:i,xe=re>2?N[2]:i;for(pe=_.length>3&&typeof pe=="function"?(re--,pe):i,xe&&Aa(N[0],N[1],xe)&&(pe=re<3?i:pe,re=1),b=ns(b);++U<re;){var Se=N[U];Se&&_(b,Se,U,pe)}return b})}function _b(_,b){return function(N,U){if(N==null)return N;if(!ka(N))return _(N,U);for(var re=N.length,pe=b?re:-1,xe=ns(N);(b?pe--:++pe<re)&&U(xe[pe],pe,xe)!==!1;);return N}}function vb(_){return function(b,N,U){for(var re=-1,pe=ns(b),xe=U(b),Se=xe.length;Se--;){var Ae=xe[_?Se:++re];if(N(pe[Ae],Ae,pe)===!1)break}return b}}function kD(_,b,N){var U=b&Z,re=Xm(_);function pe(){var xe=this&&this!==zs&&this instanceof pe?re:_;return xe.apply(U?N:this,arguments)}return pe}function od(_){return function(b){b=qr(b);var N=Np(b)?Tc(b):i,U=N?N[0]:b.charAt(0),re=N?cu(N,1).join(""):b.slice(1);return U[_]()+re}}function Kp(_){return function(b){return ia(cv(LC(b).replace(t0,"")),_,"")}}function Xm(_){return function(){var b=arguments;switch(b.length){case 0:return new _;case 1:return new _(b[0]);case 2:return new _(b[0],b[1]);case 3:return new _(b[0],b[1],b[2]);case 4:return new _(b[0],b[1],b[2],b[3]);case 5:return new _(b[0],b[1],b[2],b[3],b[4]);case 6:return new _(b[0],b[1],b[2],b[3],b[4],b[5]);case 7:return new _(b[0],b[1],b[2],b[3],b[4],b[5],b[6])}var N=jp(_.prototype),U=_.apply(N,b);return gs(U)?U:N}}function OD(_,b,N){var U=Xm(_);function re(){for(var pe=arguments.length,xe=Ge(pe),Se=pe,Ae=qp(re);Se--;)xe[Se]=arguments[Se];var et=pe<3&&xe[0]!==Ae&&xe[pe-1]!==Ae?[]:eu(xe,Ae);if(pe-=et.length,pe<N)return hR(_,b,D0,re.placeholder,i,xe,et,i,i,N-pe);var it=this&&this!==zs&&this instanceof re?U:_;return Di(it,this,xe)}return re}function dR(_){return function(b,N,U){var re=ns(b);if(!ka(b)){var pe=ln(N,3);b=Li(b),N=function(Se){return pe(re[Se],Se,re)}}var xe=_(b,N,U);return xe>-1?re[pe?b[xe]:xe]:i}}function Eb(_){return cd(function(b){var N=b.length,U=N,re=$o.prototype.thru;for(_&&b.reverse();U--;){var pe=b[U];if(typeof pe!="function")throw new to(g);if(re&&!xe&&j0(pe)=="wrapper")var xe=new $o([],!0)}for(U=xe?U:N;++U<N;){pe=b[U];var Se=j0(pe),Ae=Se=="wrapper"?wb(pe):i;Ae&&Cb(Ae[0])&&Ae[1]==(Q|ee|ae|$)&&!Ae[4].length&&Ae[9]==1?xe=xe[j0(Ae[0])].apply(xe,Ae[3]):xe=pe.length==1&&Cb(pe)?xe[Se]():xe.thru(pe)}return function(){var et=arguments,it=et[0];if(xe&&et.length==1&&Dn(it))return xe.plant(it).value();for(var ct=0,wt=N?b[ct].apply(this,et):it;++ct<N;)wt=b[ct].call(this,wt);return wt}})}function D0(_,b,N,U,re,pe,xe,Se,Ae,et){var it=b&Q,ct=b&Z,wt=b&q,Yt=b&(ee|de),dn=b&se,un=wt?i:Xm(_);function En(){for(var sr=arguments.length,ir=Ge(sr),Xi=sr;Xi--;)ir[Xi]=arguments[Xi];if(Yt)var $i=qp(En),io=jm(ir,$i);if(U&&(ir=lu(ir,U,re,Yt)),pe&&(ir=mb(ir,pe,xe,Yt)),sr-=io,Yt&&sr<et){var ti=eu(ir,$i);return hR(_,b,D0,En.placeholder,N,ir,ti,Se,Ae,et-sr)}var Ac=ct?N:this,hd=wt?Ac[_]:_;return sr=ir.length,Se?ir=Nb(ir,Se):dn&&sr>1&&ir.reverse(),it&&Ae<sr&&(ir.length=Ae),this&&this!==zs&&this instanceof En&&(hd=un||Xm(hd)),hd.apply(Ac,ir)}return En}function P0(_,b){return function(N,U){return mD(N,_,b(U),{})}}function $m(_,b){return function(N,U){var re;if(N===i&&U===i)return b;if(N!==i&&(re=N),U!==i){if(re===i)return U;typeof N=="string"||typeof U=="string"?(N=la(N),U=la(U)):(N=aR(N),U=aR(U)),re=_(N,U)}return re}}function yb(_){return cd(function(b){return b=os(b,Hr(ln())),Zn(function(N){var U=this;return _(b,function(re){return Di(re,U,N)})})})}function Jm(_,b){b=b===i?" ":la(b);var N=b.length;if(N<2)return N?lb(b,_):b;var U=lb(b,h0(_/nd(b)));return Np(b)?cu(Tc(U),0,_).join(""):U.slice(0,_)}function DD(_,b,N,U){var re=b&Z,pe=Xm(_);function xe(){for(var Se=-1,Ae=arguments.length,et=-1,it=U.length,ct=Ge(it+Ae),wt=this&&this!==zs&&this instanceof xe?pe:_;++et<it;)ct[et]=U[et];for(;Ae--;)ct[et++]=arguments[++Se];return Di(wt,re?N:this,ct)}return xe}function uR(_){return function(b,N,U){return U&&typeof U!="number"&&Aa(b,N,U)&&(N=U=i),b=ud(b),N===i?(N=b,b=0):N=ud(N),U=U===i?b<N?1:-1:ud(U),qm(b,N,U,_)}}function L0(_){return function(b,N){return typeof b=="string"&&typeof N=="string"||(b=Jo(b),N=Jo(N)),_(b,N)}}function hR(_,b,N,U,re,pe,xe,Se,Ae,et){var it=b&ee,ct=it?xe:i,wt=it?i:xe,Yt=it?pe:i,dn=it?i:pe;b|=it?ae:ye,b&=~(it?ye:ae),b&V||(b&=-4);var un=[_,b,re,Yt,ct,dn,wt,Se,Ae,et],En=N.apply(i,un);return Cb(_)&&Ab(En,un),En.placeholder=U,Ob(En,_,b)}function bb(_){var b=Ti[_];return function(N,U){if(N=Jo(N),U=U==null?0:oa(Gn(U),292),U&&PT(N)){var re=(qr(N)+"e").split("e"),pe=b(re[0]+"e"+(+re[1]+U));return re=(qr(pe)+"e").split("e"),+(re[0]+"e"+(+re[1]-U))}return b(N)}}var PD=Pp&&1/Um(new Pp([,-0]))[1]==Ye?function(_){return new Pp(_)}:hg;function pR(_){return function(b){var N=Pi(b);return N==Or?Mm(b):N==Ht?Wy(b):Si(b,_(b))}}function fl(_,b,N,U,re,pe,xe,Se){var Ae=b&q;if(!Ae&&typeof _!="function")throw new to(g);var et=U?U.length:0;if(et||(b&=-97,U=re=i),xe=xe===i?xe:Ri(Gn(xe),0),Se=Se===i?Se:Gn(Se),et-=re?re.length:0,b&ye){var it=U,ct=re;U=re=i}var wt=Ae?i:wb(_),Yt=[_,b,N,U,re,it,ct,pe,xe,Se];if(wt&&bR(Yt,wt),_=Yt[0],b=Yt[1],N=Yt[2],U=Yt[3],re=Yt[4],Se=Yt[9]=Yt[9]===i?Ae?0:_.length:Ri(Yt[9]-et,0),!Se&&b&(ee|de)&&(b&=-25),!b||b==Z)var dn=kD(_,b,N);else b==ee||b==de?dn=OD(_,b,Se):(b==ae||b==(Z|ae))&&!re.length?dn=DD(_,b,N,U):dn=D0.apply(i,Yt);var un=wt?rR:Ab;return Ob(un(dn,Yt),_,b)}function ml(_,b,N,U){return _===i||Io(_,ke[N])&&!Kr.call(U,N)?b:_}function fR(_,b,N,U,re,pe){return gs(_)&&gs(b)&&(pe.set(b,_),R0(_,b,i,fR,pe),pe.delete(b)),_}function LD(_){return dg(_)?i:_}function mR(_,b,N,U,re,pe){var xe=N&B,Se=_.length,Ae=b.length;if(Se!=Ae&&!(xe&&Ae>Se))return!1;var et=pe.get(_),it=pe.get(b);if(et&&it)return et==b&&it==_;var ct=-1,wt=!0,Yt=N&X?new bh:i;for(pe.set(_,b),pe.set(b,_);++ct<Se;){var dn=_[ct],un=b[ct];if(U)var En=xe?U(un,dn,ct,b,_,pe):U(dn,un,ct,_,b,pe);if(En!==i){if(En)continue;wt=!1;break}if(Yt){if(!Sc(b,function(sr,ir){if(!Yo(Yt,ir)&&(dn===sr||re(dn,sr,N,U,pe)))return Yt.push(ir)})){wt=!1;break}}else if(!(dn===un||re(dn,un,N,U,pe))){wt=!1;break}}return pe.delete(_),pe.delete(b),wt}function jD(_,b,N,U,re,pe,xe){switch(N){case Ki:if(_.byteLength!=b.byteLength||_.byteOffset!=b.byteOffset)return!1;_=_.buffer,b=b.buffer;case Sr:return!(_.byteLength!=b.byteLength||!pe(new l0(_),new l0(b)));case bt:case Wt:case ms:return Io(+_,+b);case xt:return _.name==b.name&&_.message==b.message;case Jr:case wi:return _==b+"";case Or:var Se=Mm;case Ht:var Ae=U&B;if(Se||(Se=Um),_.size!=b.size&&!Ae)return!1;var et=xe.get(_);if(et)return et==b;U|=X,xe.set(_,b);var it=mR(Se(_),Se(b),U,re,pe,xe);return xe.delete(_),it;case Cs:if(Wm)return Wm.call(_)==Wm.call(b)}return!1}function MD(_,b,N,U,re,pe){var xe=N&B,Se=Qm(_),Ae=Se.length,et=Qm(b),it=et.length;if(Ae!=it&&!xe)return!1;for(var ct=Ae;ct--;){var wt=Se[ct];if(!(xe?wt in b:Kr.call(b,wt)))return!1}var Yt=pe.get(_),dn=pe.get(b);if(Yt&&dn)return Yt==b&&dn==_;var un=!0;pe.set(_,b),pe.set(b,_);for(var En=xe;++ct<Ae;){wt=Se[ct];var sr=_[wt],ir=b[wt];if(U)var Xi=xe?U(ir,sr,wt,b,_,pe):U(sr,ir,wt,_,b,pe);if(!(Xi===i?sr===ir||re(sr,ir,N,U,pe):Xi)){un=!1;break}En||(En=wt=="constructor")}if(un&&!En){var $i=_.constructor,io=b.constructor;$i!=io&&"constructor"in _&&"constructor"in b&&!(typeof $i=="function"&&$i instanceof $i&&typeof io=="function"&&io instanceof io)&&(un=!1)}return pe.delete(_),pe.delete(b),un}function cd(_){return kb(B0(_,i,AR),_+"")}function Qm(_){return qT(_,Li,Sb)}function xb(_){return qT(_,ua,Zm)}var wb=p0?function(_){return p0.get(_)}:hg;function j0(_){for(var b=_.name+"",N=Lp[b],U=Kr.call(Lp,b)?N.length:0;U--;){var re=N[U],pe=re.func;if(pe==null||pe==_)return re.name}return b}function qp(_){var b=Kr.call(ue,"placeholder")?ue:_;return b.placeholder}function ln(){var _=ue.iteratee||px;return _=_===px?$T:_,arguments.length?_(arguments[0],arguments[1]):_}function M0(_,b){var N=_.__data__;return vR(b)?N[typeof b=="string"?"string":"hash"]:N.map}function U0(_){for(var b=Li(_),N=b.length;N--;){var U=b[N],re=_[U];b[N]=[U,re,ER(re)]}return b}function du(_,b){var N=wO(_,b);return XT(N)?N:i}function UD(_){var b=Kr.call(_,yh),N=_[yh];try{_[yh]=i;var U=!0}catch{}var re=Vm.call(_);return U&&(b?_[yh]=N:delete _[yh]),re}var Sb=qy?function(_){return _==null?[]:(_=ns(_),qo(qy(_),function(b){return Fm.call(_,b)}))}:mx,Zm=qy?function(_){for(var b=[];_;)wc(b,Sb(_)),_=Eh(_);return b}:mx,Pi=ca;($y&&Pi(new $y(new ArrayBuffer(1)))!=Ki||Op&&Pi(new Op)!=Or||Dp&&Pi(Dp.resolve())!=Gr||Pp&&Pi(new Pp)!=Ht||zm&&Pi(new zm)!=Za)&&(Pi=function(_){var b=ca(_),N=b==xi?_.constructor:i,U=N?ld(N):"";if(U)switch(U){case MT:return Ki;case Jy:return Or;case BO:return Gr;case Qy:return Ht;case zO:return Za}return b});function gR(_,b,N){for(var U=-1,re=N.length;++U<re;){var pe=N[U],xe=pe.size;switch(pe.type){case"drop":_+=xe;break;case"dropRight":b-=xe;break;case"take":b=oa(b,_+xe);break;case"takeRight":_=Ri(_,b-xe);break}}return{start:_,end:b}}function V0(_){var b=_.match($l);return b?b[1].split(Vy):[]}function Tb(_,b,N){b=ad(b,_);for(var U=-1,re=b.length,pe=!1;++U<re;){var xe=Nc(b[U]);if(!(pe=_!=null&&N(_,xe)))break;_=_[xe]}return pe||++U!=re?pe:(re=_==null?0:_.length,!!re&&rv(re)&&gl(xe,re)&&(Dn(_)||mu(_)))}function VD(_){var b=_.length,N=new _.constructor(b);return b&&typeof _[0]=="string"&&Kr.call(_,"index")&&(N.index=_.index,N.input=_.input),N}function Rb(_){return typeof _.constructor=="function"&&!uu(_)?jp(Eh(_)):{}}function F0(_,b,N){var U=_.constructor;switch(b){case Sr:return pb(_);case bt:case Wt:return new U(+_);case Ki:return ID(_,N);case Go:case vc:case Ec:case Ve:case Qt:case _n:case Qe:case Bt:case Ct:return lR(_,N);case Or:return new U;case ms:case wi:return new U(_);case Jr:return cR(_);case Ht:return new U;case Cs:return fb(_)}}function FD(_,b){var N=b.length;if(!N)return _;var U=N-1;return b[U]=(N>1?"& ":"")+b[U],b=b.join(N>2?", ":" "),_.replace(G_,`{
/* [wrapped with `+b+`] */
`)}function _R(_){return Dn(_)||mu(_)||!!(OT&&_&&_[OT])}function gl(_,b){var N=typeof _;return b=b??ze,!!b&&(N=="number"||N!="symbol"&&rl.test(_))&&_>-1&&_%1==0&&_<b}function Aa(_,b,N){if(!gs(N))return!1;var U=typeof b;return(U=="number"?ka(N)&&gl(b,N.length):U=="string"&&b in N)?Io(N[b],_):!1}function Yp(_,b){if(Dn(_))return!1;var N=typeof _;return N=="number"||N=="symbol"||N=="boolean"||_==null||Ao(_)?!0:B_.test(_)||!ih.test(_)||b!=null&&_ in ns(b)}function vR(_){var b=typeof _;return b=="string"||b=="number"||b=="symbol"||b=="boolean"?_!=="__proto__":_===null}function Cb(_){var b=j0(_),N=ue[b];if(typeof N!="function"||!(b in lr.prototype))return!1;if(_===N)return!0;var U=wb(N);return!!U&&_===U[0]}function BD(_){return!!Ky&&Ky in _}var zD=o0?vl:gx;function uu(_){var b=_&&_.constructor,N=typeof b=="function"&&b.prototype||ke;return _===N}function ER(_){return _===_&&!gs(_)}function yR(_,b){return function(N){return N==null?!1:N[_]===b&&(b!==i||_ in ns(N))}}function GD(_){var b=Z0(_,function(U){return N.size===C&&N.clear(),U}),N=b.cache;return b}function bR(_,b){var N=_[1],U=b[1],re=N|U,pe=re<(Z|q|Q),xe=U==Q&&N==ee||U==Q&&N==$&&_[7].length<=b[8]||U==(Q|$)&&b[7].length<=b[8]&&N==ee;if(!(pe||xe))return _;U&Z&&(_[2]=b[2],re|=N&Z?0:V);var Se=b[3];if(Se){var Ae=_[3];_[3]=Ae?lu(Ae,Se,b[4]):Se,_[4]=Ae?eu(_[3],k):b[4]}return Se=b[5],Se&&(Ae=_[5],_[5]=Ae?mb(Ae,Se,b[6]):Se,_[6]=Ae?eu(_[5],k):b[6]),Se=b[7],Se&&(_[7]=Se),U&Q&&(_[8]=_[8]==null?b[8]:oa(_[8],b[8])),_[9]==null&&(_[9]=b[9]),_[0]=b[0],_[1]=re,_}function WD(_){var b=[];if(_!=null)for(var N in ns(_))b.push(N);return b}function HD(_){return Vm.call(_)}function B0(_,b,N){return b=Ri(b===i?_.length-1:b,0),function(){for(var U=arguments,re=-1,pe=Ri(U.length-b,0),xe=Ge(pe);++re<pe;)xe[re]=U[b+re];re=-1;for(var Se=Ge(b+1);++re<b;)Se[re]=U[re];return Se[b]=N(xe),Di(_,this,Se)}}function xR(_,b){return b.length<2?_:xh(_,ro(b,0,-1))}function Nb(_,b){for(var N=_.length,U=oa(b.length,N),re=Ia(_);U--;){var pe=b[U];_[U]=gl(pe,N)?re[pe]:i}return _}function Ib(_,b){if(!(b==="constructor"&&typeof _[b]=="function")&&b!="__proto__")return _[b]}var Ab=wR(rR),eg=To||function(_,b){return zs.setTimeout(_,b)},kb=wR(sR);function Ob(_,b,N){var U=b+"";return kb(_,FD(U,KD(V0(U),N)))}function wR(_){var b=0,N=0;return function(){var U=Yy(),re=ge-(U-N);if(N=U,re>0){if(++b>=ve)return arguments[0]}else b=0;return _.apply(i,arguments)}}function z0(_,b){var N=-1,U=_.length,re=U-1;for(b=b===i?U:b;++N<b;){var pe=C0(N,re),xe=_[pe];_[pe]=_[N],_[N]=xe}return _.length=b,_}var Db=GD(function(_){var b=[];return _.charCodeAt(0)===46&&b.push(""),_.replace(Wr,function(N,U,re,pe){b.push(re?pe.replace(H_,"$1"):U||N)}),b});function Nc(_){if(typeof _=="string"||Ao(_))return _;var b=_+"";return b=="0"&&1/_==-Ye?"-0":b}function ld(_){if(_!=null){try{return c0.call(_)}catch{}try{return _+""}catch{}}return""}function KD(_,b){return Ra(mn,function(N){var U="_."+N[0];b&N[1]&&!gh(_,U)&&_.push(U)}),_.sort()}function SR(_){if(_ instanceof lr)return _.clone();var b=new $o(_.__wrapped__,_.__chain__);return b.__actions__=Ia(_.__actions__),b.__index__=_.__index__,b.__values__=_.__values__,b}function tg(_,b,N){(N?Aa(_,b,N):b===i)?b=1:b=Ri(Gn(b),0);var U=_==null?0:_.length;if(!U||b<1)return[];for(var re=0,pe=0,xe=Ge(h0(U/b));re<U;)xe[pe++]=ro(_,re,re+=b);return xe}function TR(_){for(var b=-1,N=_==null?0:_.length,U=0,re=[];++b<N;){var pe=_[b];pe&&(re[U++]=pe)}return re}function ng(){var _=arguments.length;if(!_)return[];for(var b=Ge(_-1),N=arguments[0],U=_;U--;)b[U-1]=arguments[U];return wc(Dn(N)?Ia(N):[N],Yi(b,1))}var Xp=Zn(function(_,b){return Gs(_)?Vp(_,Yi(b,1,Gs,!0)):[]}),RR=Zn(function(_,b){var N=No(b);return Gs(N)&&(N=i),Gs(_)?Vp(_,Yi(b,1,Gs,!0),ln(N,2)):[]}),Pb=Zn(function(_,b){var N=No(b);return Gs(N)&&(N=i),Gs(_)?Vp(_,Yi(b,1,Gs,!0),i,N):[]});function G0(_,b,N){var U=_==null?0:_.length;return U?(b=N||b===i?1:Gn(b),ro(_,b<0?0:b,U)):[]}function qD(_,b,N){var U=_==null?0:_.length;return U?(b=N||b===i?1:Gn(b),b=U-b,ro(_,0,b<0?0:b)):[]}function YD(_,b){return _&&_.length?wh(_,ln(b,3),!0,!0):[]}function XD(_,b){return _&&_.length?wh(_,ln(b,3),!0):[]}function CR(_,b,N,U){var re=_==null?0:_.length;return re?(N&&typeof N!="number"&&Aa(_,b,N)&&(N=0,U=re),WT(_,b,N,U)):[]}function NR(_,b,N){var U=_==null?0:_.length;if(!U)return-1;var re=N==null?0:Gn(N);return re<0&&(re=Ri(U+re,0)),_h(_,ln(b,3),re)}function IR(_,b,N){var U=_==null?0:_.length;if(!U)return-1;var re=U-1;return N!==i&&(re=Gn(N),re=N<0?Ri(U+re,0):oa(re,U-1)),_h(_,ln(b,3),re,!0)}function AR(_){var b=_==null?0:_.length;return b?Yi(_,1):[]}function Lb(_){var b=_==null?0:_.length;return b?Yi(_,Ye):[]}function hu(_,b){var N=_==null?0:_.length;return N?(b=b===i?1:Gn(b),Yi(_,b)):[]}function $D(_){for(var b=-1,N=_==null?0:_.length,U={};++b<N;){var re=_[b];U[re[0]]=re[1]}return U}function pu(_){return _&&_.length?_[0]:i}function kR(_,b,N){var U=_==null?0:_.length;if(!U)return-1;var re=N==null?0:Gn(N);return re<0&&(re=Ri(U+re,0)),ed(_,b,re)}function Co(_){var b=_==null?0:_.length;return b?ro(_,0,-1):[]}var JD=Zn(function(_){var b=os(_,A0);return b.length&&b[0]===_[0]?w0(b):[]}),QD=Zn(function(_){var b=No(_),N=os(_,A0);return b===No(N)?b=i:N.pop(),N.length&&N[0]===_[0]?w0(N,ln(b,2)):[]}),OR=Zn(function(_){var b=No(_),N=os(_,A0);return b=typeof b=="function"?b:i,b&&N.pop(),N.length&&N[0]===_[0]?w0(N,i,b):[]});function ZD(_,b){return _==null?"":LT.call(_,b)}function No(_){var b=_==null?0:_.length;return b?_[b-1]:i}function DR(_,b,N){var U=_==null?0:_.length;if(!U)return-1;var re=U;return N!==i&&(re=Gn(N),re=re<0?Ri(U+re,0):oa(re,U-1)),b===b?CO(_,b,re):_h(_,T,re,!0)}function eP(_,b){return _&&_.length?eR(_,Gn(b)):i}var PR=Zn(LR);function LR(_,b){return _&&_.length&&b&&b.length?cb(_,b):_}function tP(_,b,N){return _&&_.length&&b&&b.length?cb(_,b,ln(N,2)):_}function nP(_,b,N){return _&&_.length&&b&&b.length?cb(_,b,i,N):_}var jb=cd(function(_,b){var N=_==null?0:_.length,U=nb(_,b);return Km(_,os(b,function(re){return gl(re,N)?+re:re}).sort(Cc)),U});function Mb(_,b){var N=[];if(!(_&&_.length))return N;var U=-1,re=[],pe=_.length;for(b=ln(b,3);++U<pe;){var xe=_[U];b(xe,U,_)&&(N.push(xe),re.push(U))}return Km(_,re),N}function Ub(_){return _==null?_:jT.call(_)}function Vb(_,b,N){var U=_==null?0:_.length;return U?(N&&typeof N!="number"&&Aa(_,b,N)?(b=0,N=U):(b=b==null?0:Gn(b),N=N===i?U:Gn(N)),ro(_,b,N)):[]}function rP(_,b){return N0(_,b)}function jR(_,b,N){return ub(_,b,ln(N,2))}function sP(_,b){var N=_==null?0:_.length;if(N){var U=N0(_,b);if(U<N&&Io(_[U],b))return U}return-1}function Fb(_,b){return N0(_,b,!0)}function rg(_,b,N){return ub(_,b,ln(N,2),!0)}function MR(_,b){var N=_==null?0:_.length;if(N){var U=N0(_,b,!0)-1;if(Io(_[U],b))return U}return-1}function Bb(_){return _&&_.length?iR(_):[]}function zb(_,b){return _&&_.length?iR(_,ln(b,2)):[]}function UR(_){var b=_==null?0:_.length;return b?ro(_,1,b):[]}function VR(_,b,N){return _&&_.length?(b=N||b===i?1:Gn(b),ro(_,0,b<0?0:b)):[]}function W0(_,b,N){var U=_==null?0:_.length;return U?(b=N||b===i?1:Gn(b),b=U-b,ro(_,b<0?0:b,U)):[]}function FR(_,b){return _&&_.length?wh(_,ln(b,3),!1,!0):[]}function iP(_,b){return _&&_.length?wh(_,ln(b,3)):[]}var aP=Zn(function(_){return au(Yi(_,1,Gs,!0))}),BR=Zn(function(_){var b=No(_);return Gs(b)&&(b=i),au(Yi(_,1,Gs,!0),ln(b,2))}),zR=Zn(function(_){var b=No(_);return b=typeof b=="function"?b:i,au(Yi(_,1,Gs,!0),i,b)});function $p(_){return _&&_.length?au(_):[]}function Gb(_,b){return _&&_.length?au(_,ln(b,2)):[]}function Wb(_,b){return b=typeof b=="function"?b:i,_&&_.length?au(_,i,b):[]}function sg(_){if(!(_&&_.length))return[];var b=0;return _=qo(_,function(N){if(Gs(N))return b=Ri(N.length,b),!0}),Ir(b,function(N){return os(_,J(N))})}function Hb(_,b){if(!(_&&_.length))return[];var N=sg(_);return b==null?N:os(N,function(U){return Di(b,i,U)})}var GR=Zn(function(_,b){return Gs(_)?Vp(_,b):[]}),oP=Zn(function(_){return Gp(qo(_,Gs))}),cP=Zn(function(_){var b=No(_);return Gs(b)&&(b=i),Gp(qo(_,Gs),ln(b,2))}),Jp=Zn(function(_){var b=No(_);return b=typeof b=="function"?b:i,Gp(qo(_,Gs),i,b)}),lP=Zn(sg);function WR(_,b){return oR(_||[],b||[],Up)}function Kb(_,b){return oR(_||[],b||[],iu)}var dP=Zn(function(_){var b=_.length,N=b>1?_[b-1]:i;return N=typeof N=="function"?(_.pop(),N):i,Hb(_,N)});function HR(_){var b=ue(_);return b.__chain__=!0,b}function uP(_,b){return b(_),_}function H0(_,b){return b(_)}var qb=cd(function(_){var b=_.length,N=b?_[0]:0,U=this.__wrapped__,re=function(pe){return nb(pe,_)};return b>1||this.__actions__.length||!(U instanceof lr)||!gl(N)?this.thru(re):(U=U.slice(N,+N+(b?1:0)),U.__actions__.push({func:H0,args:[re],thisArg:i}),new $o(U,this.__chain__).thru(function(pe){return b&&!pe.length&&pe.push(i),pe}))});function KR(){return HR(this)}function qR(){return new $o(this.value(),this.__chain__)}function YR(){this.__values__===i&&(this.__values__=EC(this.value()));var _=this.__index__>=this.__values__.length,b=_?i:this.__values__[this.__index__++];return{done:_,value:b}}function K0(){return this}function Yb(_){for(var b,N=this;N instanceof m0;){var U=SR(N);U.__index__=0,U.__values__=i,b?re.__wrapped__=U:b=U;var re=U;N=N.__wrapped__}return re.__wrapped__=_,b}function q0(){var _=this.__wrapped__;if(_ instanceof lr){var b=_;return this.__actions__.length&&(b=new lr(this)),b=b.reverse(),b.__actions__.push({func:H0,args:[Ub],thisArg:i}),new $o(b,this.__chain__)}return this.thru(Ub)}function Y0(){return zp(this.__wrapped__,this.__actions__)}var XR=Ym(function(_,b,N){Kr.call(_,N)?++_[N]:sd(_,N,1)});function Qp(_,b,N){var U=Dn(_)?dl:uD;return N&&Aa(_,b,N)&&(b=i),U(_,ln(b,3))}function Sh(_,b){var N=Dn(_)?qo:HT;return N(_,ln(b,3))}var hP=dR(NR),ig=dR(IR);function pP(_,b){return Yi(X0(_,b),1)}function fP(_,b){return Yi(X0(_,b),Ye)}function mP(_,b,N){return N=N===i?1:Gn(N),Yi(X0(_,b),N)}function $R(_,b){var N=Dn(_)?Ra:Rc;return N(_,ln(b,3))}function Xb(_,b){var N=Dn(_)?ll:Fp;return N(_,ln(b,3))}var $b=Ym(function(_,b,N){Kr.call(_,N)?_[N].push(b):sd(_,N,[b])});function JR(_,b,N,U){_=ka(_)?_:nf(_),N=N&&!U?Gn(N):0;var re=_.length;return N<0&&(N=Ri(re+N,0)),sv(_)?N<=re&&_.indexOf(b,N)>-1:!!re&&ed(_,b,N)>-1}var gP=Zn(function(_,b,N){var U=-1,re=typeof b=="function",pe=ka(_)?Ge(_.length):[];return Rc(_,function(xe){pe[++U]=re?Di(b,xe,N):Bp(xe,b,N)}),pe}),QR=Ym(function(_,b,N){sd(_,N,b)});function X0(_,b){var N=Dn(_)?os:JT;return N(_,ln(b,3))}function ag(_,b,N,U){return _==null?[]:(Dn(b)||(b=b==null?[]:[b]),N=U?i:N,Dn(N)||(N=N==null?[]:[N]),ob(_,b,N))}var _l=Ym(function(_,b,N){_[N?0:1].push(b)},function(){return[[],[]]});function ZR(_,b,N){var U=Dn(_)?ia:Oe,re=arguments.length<3;return U(_,ln(b,4),N,re,Rc)}function _P(_,b,N){var U=Dn(_)?i0:Oe,re=arguments.length<3;return U(_,ln(b,4),N,re,Fp)}function vP(_,b){var N=Dn(_)?qo:HT;return N(_,ev(ln(b,3)))}function Jb(_){var b=Dn(_)?zT:TD;return b(_)}function eC(_,b,N){(N?Aa(_,b,N):b===i)?b=1:b=Gn(b);var U=Dn(_)?oD:RD;return U(_,b)}function tC(_){var b=Dn(_)?cD:db;return b(_)}function EP(_){if(_==null)return 0;if(ka(_))return sv(_)?nd(_):_.length;var b=Pi(_);return b==Or||b==Ht?_.size:S0(_).length}function $0(_,b,N){var U=Dn(_)?Sc:CD;return N&&Aa(_,b,N)&&(b=i),U(_,ln(b,3))}var fu=Zn(function(_,b){if(_==null)return[];var N=b.length;return N>1&&Aa(_,b[0],b[1])?b=[]:N>2&&Aa(b[0],b[1],b[2])&&(b=[b[0]]),ob(_,Yi(b,1),[])}),J0=DT||function(){return zs.Date.now()};function og(_,b){if(typeof b!="function")throw new to(g);return _=Gn(_),function(){if(--_<1)return b.apply(this,arguments)}}function nC(_,b,N){return b=N?i:b,b=_&&b==null?_.length:b,fl(_,Q,i,i,i,i,b)}function rC(_,b){var N;if(typeof b!="function")throw new to(g);return _=Gn(_),function(){return--_>0&&(N=b.apply(this,arguments)),_<=1&&(b=i),N}}var Qb=Zn(function(_,b,N){var U=Z;if(N.length){var re=eu(N,qp(Qb));U|=ae}return fl(_,U,b,N,re)}),sC=Zn(function(_,b,N){var U=Z|q;if(N.length){var re=eu(N,qp(sC));U|=ae}return fl(b,U,_,N,re)});function Q0(_,b,N){b=N?i:b;var U=fl(_,ee,i,i,i,i,i,b);return U.placeholder=Q0.placeholder,U}function iC(_,b,N){b=N?i:b;var U=fl(_,de,i,i,i,i,i,b);return U.placeholder=iC.placeholder,U}function aC(_,b,N){var U,re,pe,xe,Se,Ae,et=0,it=!1,ct=!1,wt=!0;if(typeof _!="function")throw new to(g);b=Jo(b)||0,gs(N)&&(it=!!N.leading,ct="maxWait"in N,pe=ct?Ri(Jo(N.maxWait)||0,b):pe,wt="trailing"in N?!!N.trailing:wt);function Yt(ti){var Ac=U,hd=re;return U=re=i,et=ti,xe=_.apply(hd,Ac),xe}function dn(ti){return et=ti,Se=eg(sr,b),it?Yt(ti):xe}function un(ti){var Ac=ti-Ae,hd=ti-et,tN=b-Ac;return ct?oa(tN,pe-hd):tN}function En(ti){var Ac=ti-Ae,hd=ti-et;return Ae===i||Ac>=b||Ac<0||ct&&hd>=pe}function sr(){var ti=J0();if(En(ti))return ir(ti);Se=eg(sr,un(ti))}function ir(ti){return Se=i,wt&&U?Yt(ti):(U=re=i,xe)}function Xi(){Se!==i&&k0(Se),et=0,U=Ae=re=Se=i}function $i(){return Se===i?xe:ir(J0())}function io(){var ti=J0(),Ac=En(ti);if(U=arguments,re=this,Ae=ti,Ac){if(Se===i)return dn(Ae);if(ct)return k0(Se),Se=eg(sr,b),Yt(Ae)}return Se===i&&(Se=eg(sr,b)),xe}return io.cancel=Xi,io.flush=$i,io}var yP=Zn(function(_,b){return rb(_,1,b)}),oC=Zn(function(_,b,N){return rb(_,Jo(b)||0,N)});function Zb(_){return fl(_,se)}function Z0(_,b){if(typeof _!="function"||b!=null&&typeof b!="function")throw new to(g);var N=function(){var U=arguments,re=b?b.apply(this,U):U[0],pe=N.cache;if(pe.has(re))return pe.get(re);var xe=_.apply(this,U);return N.cache=pe.set(re,xe)||pe,xe};return N.cache=new(Z0.Cache||rd),N}Z0.Cache=rd;function ev(_){if(typeof _!="function")throw new to(g);return function(){var b=arguments;switch(b.length){case 0:return!_.call(this);case 1:return!_.call(this,b[0]);case 2:return!_.call(this,b[0],b[1]);case 3:return!_.call(this,b[0],b[1],b[2])}return!_.apply(this,b)}}function bP(_){return rC(2,_)}var cC=ND(function(_,b){b=b.length==1&&Dn(b[0])?os(b[0],Hr(ln())):os(Yi(b,1),Hr(ln()));var N=b.length;return Zn(function(U){for(var re=-1,pe=oa(U.length,N);++re<pe;)U[re]=b[re].call(this,U[re]);return Di(_,this,U)})}),cg=Zn(function(_,b){var N=eu(b,qp(cg));return fl(_,ae,i,b,N)}),ex=Zn(function(_,b){var N=eu(b,qp(ex));return fl(_,ye,i,b,N)}),lC=cd(function(_,b){return fl(_,$,i,i,i,b)});function tv(_,b){if(typeof _!="function")throw new to(g);return b=b===i?b:Gn(b),Zn(_,b)}function dC(_,b){if(typeof _!="function")throw new to(g);return b=b==null?0:Ri(Gn(b),0),Zn(function(N){var U=N[b],re=cu(N,0,b);return U&&wc(re,U),Di(_,this,re)})}function xP(_,b,N){var U=!0,re=!0;if(typeof _!="function")throw new to(g);return gs(N)&&(U="leading"in N?!!N.leading:U,re="trailing"in N?!!N.trailing:re),aC(_,b,{leading:U,maxWait:b,trailing:re})}function tx(_){return nC(_,1)}function wP(_,b){return cg(hb(b),_)}function SP(){if(!arguments.length)return[];var _=arguments[0];return Dn(_)?_:[_]}function lg(_){return no(_,G)}function nx(_,b){return b=typeof b=="function"?b:i,no(_,G,b)}function uC(_){return no(_,A|G)}function rx(_,b){return b=typeof b=="function"?b:i,no(_,A|G,b)}function sx(_,b){return b==null||E0(_,b,Li(b))}function Io(_,b){return _===b||_!==_&&b!==b}var TP=L0(ru),RP=L0(function(_,b){return _>=b}),mu=YT(function(){return arguments}())?YT:function(_){return Ws(_)&&Kr.call(_,"callee")&&!Fm.call(_,"callee")},Dn=Ge.isArray,hC=Tp?Hr(Tp):gD;function ka(_){return _!=null&&rv(_.length)&&!vl(_)}function Gs(_){return Ws(_)&&ka(_)}function CP(_){return _===!0||_===!1||Ws(_)&&ca(_)==bt}var dd=UO||gx,NP=Rp?Hr(Rp):_D;function Zp(_){return Ws(_)&&_.nodeType===1&&!dg(_)}function ef(_){if(_==null)return!0;if(ka(_)&&(Dn(_)||typeof _=="string"||typeof _.splice=="function"||dd(_)||tf(_)||mu(_)))return!_.length;var b=Pi(_);if(b==Or||b==Ht)return!_.size;if(uu(_))return!S0(_).length;for(var N in _)if(Kr.call(_,N))return!1;return!0}function ix(_,b){return su(_,b)}function pC(_,b,N){N=typeof N=="function"?N:i;var U=N?N(_,b):i;return U===i?su(_,b,i,N):!!U}function nv(_){if(!Ws(_))return!1;var b=ca(_);return b==xt||b==gn||typeof _.message=="string"&&typeof _.name=="string"&&!dg(_)}function IP(_){return typeof _=="number"&&PT(_)}function vl(_){if(!gs(_))return!1;var b=ca(_);return b==Sn||b==cr||b==He||b==qt}function fC(_){return typeof _=="number"&&_==Gn(_)}function rv(_){return typeof _=="number"&&_>-1&&_%1==0&&_<=ze}function gs(_){var b=typeof _;return _!=null&&(b=="object"||b=="function")}function Ws(_){return _!=null&&typeof _=="object"}var mC=Ql?Hr(Ql):ED;function AP(_,b){return _===b||ib(_,b,U0(b))}function kP(_,b,N){return N=typeof N=="function"?N:i,ib(_,b,U0(b),N)}function OP(_){return gC(_)&&_!=+_}function DP(_){if(zD(_))throw new On(p);return XT(_)}function PP(_){return _===null}function LP(_){return _==null}function gC(_){return typeof _=="number"||Ws(_)&&ca(_)==ms}function dg(_){if(!Ws(_)||ca(_)!=xi)return!1;var b=Eh(_);if(b===null)return!0;var N=Kr.call(b,"constructor")&&b.constructor;return typeof N=="function"&&N instanceof N&&c0.call(N)==PO}var ax=Pm?Hr(Pm):yD;function jP(_){return fC(_)&&_>=-ze&&_<=ze}var _C=Zl?Hr(Zl):bD;function sv(_){return typeof _=="string"||!Dn(_)&&Ws(_)&&ca(_)==wi}function Ao(_){return typeof _=="symbol"||Ws(_)&&ca(_)==Cs}var tf=Cp?Hr(Cp):ab;function vC(_){return _===i}function MP(_){return Ws(_)&&Pi(_)==Za}function UP(_){return Ws(_)&&ca(_)==es}var VP=L0(T0),FP=L0(function(_,b){return _<=b});function EC(_){if(!_)return[];if(ka(_))return sv(_)?Tc(_):Ia(_);if(Bm&&_[Bm])return TO(_[Bm]());var b=Pi(_),N=b==Or?Mm:b==Ht?Um:nf;return N(_)}function ud(_){if(!_)return _===0?_:0;if(_=Jo(_),_===Ye||_===-Ye){var b=_<0?-1:1;return b*ut}return _===_?_:0}function Gn(_){var b=ud(_),N=b%1;return b===b?N?b-N:b:0}function yC(_){return _?id(Gn(_),0,Xt):0}function Jo(_){if(typeof _=="number")return _;if(Ao(_))return yt;if(gs(_)){var b=typeof _.valueOf=="function"?_.valueOf():_;_=gs(b)?b+"":b}if(typeof _!="string")return _===0?_:+_;_=Vn(_);var N=ym.test(_);return N||vp.test(_)?Am(_.slice(2),N?2:8):bc.test(_)?yt:+_}function bC(_){return da(_,ua(_))}function BP(_){return _?id(Gn(_),-ze,ze):_===0?_:0}function qr(_){return _==null?"":la(_)}var zP=Hp(function(_,b){if(uu(b)||ka(b)){da(b,Li(b),_);return}for(var N in b)Kr.call(b,N)&&Up(_,N,b[N])}),xC=Hp(function(_,b){da(b,ua(b),_)}),iv=Hp(function(_,b,N,U){da(b,ua(b),_,U)}),GP=Hp(function(_,b,N,U){da(b,Li(b),_,U)}),WP=cd(nb);function wC(_,b){var N=jp(_);return b==null?N:tb(N,b)}var HP=Zn(function(_,b){_=ns(_);var N=-1,U=b.length,re=U>2?b[2]:i;for(re&&Aa(b[0],b[1],re)&&(U=1);++N<U;)for(var pe=b[N],xe=ua(pe),Se=-1,Ae=xe.length;++Se<Ae;){var et=xe[Se],it=_[et];(it===i||Io(it,ke[et])&&!Kr.call(_,et))&&(_[et]=pe[et])}return _}),KP=Zn(function(_){return _.push(i,fR),Di(CC,i,_)});function qP(_,b){return aa(_,ln(b,3),pl)}function YP(_,b){return aa(_,ln(b,3),sb)}function XP(_,b){return _==null?_:b0(_,ln(b,3),ua)}function SC(_,b){return _==null?_:KT(_,ln(b,3),ua)}function ox(_,b){return _&&pl(_,ln(b,3))}function TC(_,b){return _&&sb(_,ln(b,3))}function $P(_){return _==null?[]:x0(_,Li(_))}function JP(_){return _==null?[]:x0(_,ua(_))}function ug(_,b,N){var U=_==null?i:xh(_,b);return U===i?N:U}function QP(_,b){return _!=null&&Tb(_,b,hD)}function cx(_,b){return _!=null&&Tb(_,b,pD)}var ZP=P0(function(_,b,N){b!=null&&typeof b.toString!="function"&&(b=Vm.call(b)),_[b]=N},lv(so)),e2=P0(function(_,b,N){b!=null&&typeof b.toString!="function"&&(b=Vm.call(b)),Kr.call(_,b)?_[b].push(N):_[b]=[N]},ln),RC=Zn(Bp);function Li(_){return ka(_)?BT(_):S0(_)}function ua(_){return ka(_)?BT(_,!0):xD(_)}function t2(_,b){var N={};return b=ln(b,3),pl(_,function(U,re,pe){sd(N,b(U,re,pe),U)}),N}function n2(_,b){var N={};return b=ln(b,3),pl(_,function(U,re,pe){sd(N,re,b(U,re,pe))}),N}var r2=Hp(function(_,b,N){R0(_,b,N)}),CC=Hp(function(_,b,N,U){R0(_,b,N,U)}),NC=cd(function(_,b){var N={};if(_==null)return N;var U=!1;b=os(b,function(pe){return pe=ad(pe,_),U||(U=pe.length>1),pe}),da(_,xb(_),N),U&&(N=no(N,A|M|G,LD));for(var re=b.length;re--;)ou(N,b[re]);return N});function s2(_,b){return av(_,ev(ln(b)))}var IC=cd(function(_,b){return _==null?{}:SD(_,b)});function av(_,b){if(_==null)return{};var N=os(xb(_),function(U){return[U]});return b=ln(b),tR(_,N,function(U,re){return b(U,re[0])})}function i2(_,b,N){b=ad(b,_);var U=-1,re=b.length;for(re||(re=1,_=i);++U<re;){var pe=_==null?i:_[Nc(b[U])];pe===i&&(U=re,pe=N),_=vl(pe)?pe.call(_):pe}return _}function a2(_,b,N){return _==null?_:iu(_,b,N)}function AC(_,b,N,U){return U=typeof U=="function"?U:i,_==null?_:iu(_,b,N,U)}var kC=pR(Li),lx=pR(ua);function OC(_,b,N){var U=Dn(_),re=U||dd(_)||tf(_);if(b=ln(b,4),N==null){var pe=_&&_.constructor;re?N=U?new pe:[]:gs(_)?N=vl(pe)?jp(Eh(_)):{}:N={}}return(re?Ra:pl)(_,function(xe,Se,Ae){return b(N,xe,Se,Ae)}),N}function o2(_,b){return _==null?!0:ou(_,b)}function c2(_,b,N){return _==null?_:I0(_,b,hb(N))}function l2(_,b,N,U){return U=typeof U=="function"?U:i,_==null?_:I0(_,b,hb(N),U)}function nf(_){return _==null?[]:pi(_,Li(_))}function d2(_){return _==null?[]:pi(_,ua(_))}function u2(_,b,N){return N===i&&(N=b,b=i),N!==i&&(N=Jo(N),N=N===N?N:0),b!==i&&(b=Jo(b),b=b===b?b:0),id(Jo(_),b,N)}function DC(_,b,N){return b=ud(b),N===i?(N=b,b=0):N=ud(N),_=Jo(_),fD(_,b,N)}function dx(_,b,N){if(N&&typeof N!="boolean"&&Aa(_,b,N)&&(b=N=i),N===i&&(typeof b=="boolean"?(N=b,b=i):typeof _=="boolean"&&(N=_,_=i)),_===i&&b===i?(_=0,b=1):(_=ud(_),b===i?(b=_,_=0):b=ud(b)),_>b){var U=_;_=b,b=U}if(N||_%1||b%1){var re=Xy();return oa(_+re*(b-_+eo("1e-"+((re+"").length-1))),b)}return C0(_,b)}var PC=Kp(function(_,b,N){return b=b.toLowerCase(),_+(N?Ue(b):b)});function Ue(_){return ov(qr(_).toLowerCase())}function LC(_){return _=qr(_),_&&_.replace(K_,bO).replace(zy,"")}function h2(_,b,N){_=qr(_),b=la(b);var U=_.length;N=N===i?U:id(Gn(N),0,U);var re=N;return N-=b.length,N>=0&&_.slice(N,re)==b}function p2(_){return _=qr(_),_&&bo.test(_)?_.replace(qd,xO):_}function f2(_){return _=qr(_),_&&ah.test(_)?_.replace(gp,"\\$&"):_}var m2=Kp(function(_,b,N){return _+(N?"-":"")+b.toLowerCase()}),ux=Kp(function(_,b,N){return _+(N?" ":"")+b.toLowerCase()}),g2=od("toLowerCase");function _2(_,b,N){_=qr(_),b=Gn(b);var U=b?nd(_):0;if(!b||U>=b)return _;var re=(b-U)/2;return Jm(nu(re),N)+_+Jm(h0(re),N)}function Oa(_,b,N){_=qr(_),b=Gn(b);var U=b?nd(_):0;return b&&U<b?_+Jm(b-U,N):_}function jC(_,b,N){_=qr(_),b=Gn(b);var U=b?nd(_):0;return b&&U<b?Jm(b-U,N)+_:_}function v2(_,b,N){return N||b==null?b=0:b&&(b=+b),FO(qr(_).replace(xo,""),b||0)}function MC(_,b,N){return(N?Aa(_,b,N):b===i)?b=1:b=Gn(b),lb(qr(_),b)}function E2(){var _=arguments,b=qr(_[0]);return _.length<3?b:b.replace(_[1],_[2])}var hx=Kp(function(_,b,N){return _+(N?"_":"")+b.toLowerCase()});function UC(_,b,N){return N&&typeof N!="number"&&Aa(_,b,N)&&(b=N=i),N=N===i?Xt:N>>>0,N?(_=qr(_),_&&(typeof b=="string"||b!=null&&!ax(b))&&(b=la(b),!b&&Np(_))?cu(Tc(_),0,N):_.split(b,N)):[]}var VC=Kp(function(_,b,N){return _+(N?" ":"")+ov(b)});function y2(_,b,N){return _=qr(_),N=N==null?0:id(Gn(N),0,_.length),b=la(b),_.slice(N,N+b.length)==b}function b2(_,b,N){var U=ue.templateSettings;N&&Aa(_,b,N)&&(b=i),_=qr(_),b=iv({},b,U,ml);var re=iv({},b.imports,U.imports,ml),pe=Li(re),xe=pi(re,pe),Se,Ae,et=0,it=b.interpolate||lh,ct="__p += '",wt=Hy((b.escape||lh).source+"|"+it.source+"|"+(it===vm?Em:lh).source+"|"+(b.evaluate||lh).source+"|$","g"),Yt="//# sourceURL="+(Kr.call(b,"sourceURL")?(b.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++n0+"]")+`
`;_.replace(wt,function(En,sr,ir,Xi,$i,io){return ir||(ir=Xi),ct+=_.slice(et,io).replace(Wo,So),sr&&(Se=!0,ct+=`' +
__e(`+sr+`) +
'`),$i&&(Ae=!0,ct+=`';
`+$i+`;
__p += '`),ir&&(ct+=`' +
((__t = (`+ir+`)) == null ? '' : __t) +
'`),et=io+En.length,En}),ct+=`';
`;var dn=Kr.call(b,"variable")&&b.variable;if(!dn)ct=`with (obj) {
`+ct+`
}
`;else if(oh.test(dn))throw new On(y);ct=(Ae?ct.replace(sn,""):ct).replace(Qn,"$1").replace(qn,"$1;"),ct="function("+(dn||"obj")+`) {
`+(dn?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Se?", __e = _.escape":"")+(Ae?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+ct+`return __p
}`;var un=GC(function(){return Pr(pe,Yt+"return "+ct).apply(i,xe)});if(un.source=ct,nv(un))throw un;return un}function FC(_){return qr(_).toLowerCase()}function x2(_){return qr(_).toUpperCase()}function w2(_,b,N){if(_=qr(_),_&&(N||b===i))return Vn(_);if(!_||!(b=la(b)))return _;var U=Tc(_),re=Tc(b),pe=Ca(U,re),xe=td(U,re)+1;return cu(U,pe,xe).join("")}function BC(_,b,N){if(_=qr(_),_&&(N||b===i))return _.slice(0,AT(_)+1);if(!_||!(b=la(b)))return _;var U=Tc(_),re=td(U,Tc(b))+1;return cu(U,0,re).join("")}function S2(_,b,N){if(_=qr(_),_&&(N||b===i))return _.replace(xo,"");if(!_||!(b=la(b)))return _;var U=Tc(_),re=Ca(U,Tc(b));return cu(U,re).join("")}function T2(_,b){var N=ce,U=he;if(gs(b)){var re="separator"in b?b.separator:re;N="length"in b?Gn(b.length):N,U="omission"in b?la(b.omission):U}_=qr(_);var pe=_.length;if(Np(_)){var xe=Tc(_);pe=xe.length}if(N>=pe)return _;var Se=N-nd(U);if(Se<1)return U;var Ae=xe?cu(xe,0,Se).join(""):_.slice(0,Se);if(re===i)return Ae+U;if(xe&&(Se+=Ae.length-Se),ax(re)){if(_.slice(Se).search(re)){var et,it=Ae;for(re.global||(re=Hy(re.source,qr(ch.exec(re))+"g")),re.lastIndex=0;et=re.exec(it);)var ct=et.index;Ae=Ae.slice(0,ct===i?Se:ct)}}else if(_.indexOf(la(re),Se)!=Se){var wt=Ae.lastIndexOf(re);wt>-1&&(Ae=Ae.slice(0,wt))}return Ae+U}function zC(_){return _=qr(_),_&&Xl.test(_)?_.replace(Bs,NO):_}var R2=Kp(function(_,b,N){return _+(N?" ":"")+b.toUpperCase()}),ov=od("toUpperCase");function cv(_,b,N){return _=qr(_),b=N?i:b,b===i?SO(_)?AO(_):vn(_):_.match(b)||[]}var GC=Zn(function(_,b){try{return Di(_,i,b)}catch(N){return nv(N)?N:new On(N)}}),C2=cd(function(_,b){return Ra(b,function(N){N=Nc(N),sd(_,N,Qb(_[N],_))}),_});function WC(_){var b=_==null?0:_.length,N=ln();return _=b?os(_,function(U){if(typeof U[1]!="function")throw new to(g);return[N(U[0]),U[1]]}):[],Zn(function(U){for(var re=-1;++re<b;){var pe=_[re];if(Di(pe[0],this,U))return Di(pe[1],this,U)}})}function N2(_){return GT(no(_,A))}function lv(_){return function(){return _}}function HC(_,b){return _==null||_!==_?b:_}var gu=Eb(),KC=Eb(!0);function so(_){return _}function px(_){return $T(typeof _=="function"?_:no(_,A))}function I2(_){return QT(no(_,A))}function A2(_,b){return ZT(_,no(b,A))}var qC=Zn(function(_,b){return function(N){return Bp(N,_,b)}}),k2=Zn(function(_,b){return function(N){return Bp(_,N,b)}});function fx(_,b,N){var U=Li(b),re=x0(b,U);N==null&&!(gs(b)&&(re.length||!U.length))&&(N=b,b=_,_=this,re=x0(b,Li(b)));var pe=!(gs(N)&&"chain"in N)||!!N.chain,xe=vl(_);return Ra(re,function(Se){var Ae=b[Se];_[Se]=Ae,xe&&(_.prototype[Se]=function(){var et=this.__chain__;if(pe||et){var it=_(this.__wrapped__),ct=it.__actions__=Ia(this.__actions__);return ct.push({func:Ae,args:arguments,thisArg:_}),it.__chain__=et,it}return Ae.apply(_,wc([this.value()],arguments))})}),_}function O2(){return zs._===this&&(zs._=LO),this}function hg(){}function D2(_){return _=Gn(_),Zn(function(b){return eR(b,_)})}var Th=yb(os),P2=yb(dl),L2=yb(Sc);function YC(_){return Yp(_)?J(Nc(_)):nR(_)}function j2(_){return function(b){return _==null?i:xh(_,b)}}var XC=uR(),$C=uR(!0);function mx(){return[]}function gx(){return!1}function M2(){return{}}function dv(){return""}function U2(){return!0}function _x(_,b){if(_=Gn(_),_<1||_>ze)return[];var N=Xt,U=oa(_,Xt);b=ln(b),_-=Xt;for(var re=Ir(U,b);++N<_;)b(N);return re}function JC(_){return Dn(_)?os(_,Nc):Ao(_)?[_]:Ia(Db(qr(_)))}function vx(_){var b=++DO;return qr(_)+b}var V2=$m(function(_,b){return _+b},0),uv=bb("ceil"),Ic=$m(function(_,b){return _/b},1),pg=bb("floor");function QC(_){return _&&_.length?y0(_,so,ru):i}function ZC(_,b){return _&&_.length?y0(_,ln(b,2),ru):i}function F2(_){return F(_,so)}function B2(_,b){return F(_,ln(b,2))}function z2(_){return _&&_.length?y0(_,so,T0):i}function G2(_,b){return _&&_.length?y0(_,ln(b,2),T0):i}var Ex=$m(function(_,b){return _*b},1),eN=bb("round"),yx=$m(function(_,b){return _-b},0);function W2(_){return _&&_.length?vt(_,so):0}function H2(_,b){return _&&_.length?vt(_,ln(b,2)):0}return ue.after=og,ue.ary=nC,ue.assign=zP,ue.assignIn=xC,ue.assignInWith=iv,ue.assignWith=GP,ue.at=WP,ue.before=rC,ue.bind=Qb,ue.bindAll=C2,ue.bindKey=sC,ue.castArray=SP,ue.chain=HR,ue.chunk=tg,ue.compact=TR,ue.concat=ng,ue.cond=WC,ue.conforms=N2,ue.constant=lv,ue.countBy=XR,ue.create=wC,ue.curry=Q0,ue.curryRight=iC,ue.debounce=aC,ue.defaults=HP,ue.defaultsDeep=KP,ue.defer=yP,ue.delay=oC,ue.difference=Xp,ue.differenceBy=RR,ue.differenceWith=Pb,ue.drop=G0,ue.dropRight=qD,ue.dropRightWhile=YD,ue.dropWhile=XD,ue.fill=CR,ue.filter=Sh,ue.flatMap=pP,ue.flatMapDeep=fP,ue.flatMapDepth=mP,ue.flatten=AR,ue.flattenDeep=Lb,ue.flattenDepth=hu,ue.flip=Zb,ue.flow=gu,ue.flowRight=KC,ue.fromPairs=$D,ue.functions=$P,ue.functionsIn=JP,ue.groupBy=$b,ue.initial=Co,ue.intersection=JD,ue.intersectionBy=QD,ue.intersectionWith=OR,ue.invert=ZP,ue.invertBy=e2,ue.invokeMap=gP,ue.iteratee=px,ue.keyBy=QR,ue.keys=Li,ue.keysIn=ua,ue.map=X0,ue.mapKeys=t2,ue.mapValues=n2,ue.matches=I2,ue.matchesProperty=A2,ue.memoize=Z0,ue.merge=r2,ue.mergeWith=CC,ue.method=qC,ue.methodOf=k2,ue.mixin=fx,ue.negate=ev,ue.nthArg=D2,ue.omit=NC,ue.omitBy=s2,ue.once=bP,ue.orderBy=ag,ue.over=Th,ue.overArgs=cC,ue.overEvery=P2,ue.overSome=L2,ue.partial=cg,ue.partialRight=ex,ue.partition=_l,ue.pick=IC,ue.pickBy=av,ue.property=YC,ue.propertyOf=j2,ue.pull=PR,ue.pullAll=LR,ue.pullAllBy=tP,ue.pullAllWith=nP,ue.pullAt=jb,ue.range=XC,ue.rangeRight=$C,ue.rearg=lC,ue.reject=vP,ue.remove=Mb,ue.rest=tv,ue.reverse=Ub,ue.sampleSize=eC,ue.set=a2,ue.setWith=AC,ue.shuffle=tC,ue.slice=Vb,ue.sortBy=fu,ue.sortedUniq=Bb,ue.sortedUniqBy=zb,ue.split=UC,ue.spread=dC,ue.tail=UR,ue.take=VR,ue.takeRight=W0,ue.takeRightWhile=FR,ue.takeWhile=iP,ue.tap=uP,ue.throttle=xP,ue.thru=H0,ue.toArray=EC,ue.toPairs=kC,ue.toPairsIn=lx,ue.toPath=JC,ue.toPlainObject=bC,ue.transform=OC,ue.unary=tx,ue.union=aP,ue.unionBy=BR,ue.unionWith=zR,ue.uniq=$p,ue.uniqBy=Gb,ue.uniqWith=Wb,ue.unset=o2,ue.unzip=sg,ue.unzipWith=Hb,ue.update=c2,ue.updateWith=l2,ue.values=nf,ue.valuesIn=d2,ue.without=GR,ue.words=cv,ue.wrap=wP,ue.xor=oP,ue.xorBy=cP,ue.xorWith=Jp,ue.zip=lP,ue.zipObject=WR,ue.zipObjectDeep=Kb,ue.zipWith=dP,ue.entries=kC,ue.entriesIn=lx,ue.extend=xC,ue.extendWith=iv,fx(ue,ue),ue.add=V2,ue.attempt=GC,ue.camelCase=PC,ue.capitalize=Ue,ue.ceil=uv,ue.clamp=u2,ue.clone=lg,ue.cloneDeep=uC,ue.cloneDeepWith=rx,ue.cloneWith=nx,ue.conformsTo=sx,ue.deburr=LC,ue.defaultTo=HC,ue.divide=Ic,ue.endsWith=h2,ue.eq=Io,ue.escape=p2,ue.escapeRegExp=f2,ue.every=Qp,ue.find=hP,ue.findIndex=NR,ue.findKey=qP,ue.findLast=ig,ue.findLastIndex=IR,ue.findLastKey=YP,ue.floor=pg,ue.forEach=$R,ue.forEachRight=Xb,ue.forIn=XP,ue.forInRight=SC,ue.forOwn=ox,ue.forOwnRight=TC,ue.get=ug,ue.gt=TP,ue.gte=RP,ue.has=QP,ue.hasIn=cx,ue.head=pu,ue.identity=so,ue.includes=JR,ue.indexOf=kR,ue.inRange=DC,ue.invoke=RC,ue.isArguments=mu,ue.isArray=Dn,ue.isArrayBuffer=hC,ue.isArrayLike=ka,ue.isArrayLikeObject=Gs,ue.isBoolean=CP,ue.isBuffer=dd,ue.isDate=NP,ue.isElement=Zp,ue.isEmpty=ef,ue.isEqual=ix,ue.isEqualWith=pC,ue.isError=nv,ue.isFinite=IP,ue.isFunction=vl,ue.isInteger=fC,ue.isLength=rv,ue.isMap=mC,ue.isMatch=AP,ue.isMatchWith=kP,ue.isNaN=OP,ue.isNative=DP,ue.isNil=LP,ue.isNull=PP,ue.isNumber=gC,ue.isObject=gs,ue.isObjectLike=Ws,ue.isPlainObject=dg,ue.isRegExp=ax,ue.isSafeInteger=jP,ue.isSet=_C,ue.isString=sv,ue.isSymbol=Ao,ue.isTypedArray=tf,ue.isUndefined=vC,ue.isWeakMap=MP,ue.isWeakSet=UP,ue.join=ZD,ue.kebabCase=m2,ue.last=No,ue.lastIndexOf=DR,ue.lowerCase=ux,ue.lowerFirst=g2,ue.lt=VP,ue.lte=FP,ue.max=QC,ue.maxBy=ZC,ue.mean=F2,ue.meanBy=B2,ue.min=z2,ue.minBy=G2,ue.stubArray=mx,ue.stubFalse=gx,ue.stubObject=M2,ue.stubString=dv,ue.stubTrue=U2,ue.multiply=Ex,ue.nth=eP,ue.noConflict=O2,ue.noop=hg,ue.now=J0,ue.pad=_2,ue.padEnd=Oa,ue.padStart=jC,ue.parseInt=v2,ue.random=dx,ue.reduce=ZR,ue.reduceRight=_P,ue.repeat=MC,ue.replace=E2,ue.result=i2,ue.round=eN,ue.runInContext=Ie,ue.sample=Jb,ue.size=EP,ue.snakeCase=hx,ue.some=$0,ue.sortedIndex=rP,ue.sortedIndexBy=jR,ue.sortedIndexOf=sP,ue.sortedLastIndex=Fb,ue.sortedLastIndexBy=rg,ue.sortedLastIndexOf=MR,ue.startCase=VC,ue.startsWith=y2,ue.subtract=yx,ue.sum=W2,ue.sumBy=H2,ue.template=b2,ue.times=_x,ue.toFinite=ud,ue.toInteger=Gn,ue.toLength=yC,ue.toLower=FC,ue.toNumber=Jo,ue.toSafeInteger=BP,ue.toString=qr,ue.toUpper=x2,ue.trim=w2,ue.trimEnd=BC,ue.trimStart=S2,ue.truncate=T2,ue.unescape=zC,ue.uniqueId=vx,ue.upperCase=R2,ue.upperFirst=ov,ue.each=$R,ue.eachRight=Xb,ue.first=pu,fx(ue,function(){var _={};return pl(ue,function(b,N){Kr.call(ue.prototype,N)||(_[N]=b)}),_}(),{chain:!1}),ue.VERSION=l,Ra(["bind","bindKey","curry","curryRight","partial","partialRight"],function(_){ue[_].placeholder=ue}),Ra(["drop","take"],function(_,b){lr.prototype[_]=function(N){N=N===i?1:Ri(Gn(N),0);var U=this.__filtered__&&!b?new lr(this):this.clone();return U.__filtered__?U.__takeCount__=oa(N,U.__takeCount__):U.__views__.push({size:oa(N,Xt),type:_+(U.__dir__<0?"Right":"")}),U},lr.prototype[_+"Right"]=function(N){return this.reverse()[_](N).reverse()}}),Ra(["filter","map","takeWhile"],function(_,b){var N=b+1,U=N==qe||N==gt;lr.prototype[_]=function(re){var pe=this.clone();return pe.__iteratees__.push({iteratee:ln(re,3),type:N}),pe.__filtered__=pe.__filtered__||U,pe}}),Ra(["head","last"],function(_,b){var N="take"+(b?"Right":"");lr.prototype[_]=function(){return this[N](1).value()[0]}}),Ra(["initial","tail"],function(_,b){var N="drop"+(b?"":"Right");lr.prototype[_]=function(){return this.__filtered__?new lr(this):this[N](1)}}),lr.prototype.compact=function(){return this.filter(so)},lr.prototype.find=function(_){return this.filter(_).head()},lr.prototype.findLast=function(_){return this.reverse().find(_)},lr.prototype.invokeMap=Zn(function(_,b){return typeof _=="function"?new lr(this):this.map(function(N){return Bp(N,_,b)})}),lr.prototype.reject=function(_){return this.filter(ev(ln(_)))},lr.prototype.slice=function(_,b){_=Gn(_);var N=this;return N.__filtered__&&(_>0||b<0)?new lr(N):(_<0?N=N.takeRight(-_):_&&(N=N.drop(_)),b!==i&&(b=Gn(b),N=b<0?N.dropRight(-b):N.take(b-_)),N)},lr.prototype.takeRightWhile=function(_){return this.reverse().takeWhile(_).reverse()},lr.prototype.toArray=function(){return this.take(Xt)},pl(lr.prototype,function(_,b){var N=/^(?:filter|find|map|reject)|While$/.test(b),U=/^(?:head|last)$/.test(b),re=ue[U?"take"+(b=="last"?"Right":""):b],pe=U||/^find/.test(b);re&&(ue.prototype[b]=function(){var xe=this.__wrapped__,Se=U?[1]:arguments,Ae=xe instanceof lr,et=Se[0],it=Ae||Dn(xe),ct=function(sr){var ir=re.apply(ue,wc([sr],Se));return U&&wt?ir[0]:ir};it&&N&&typeof et=="function"&&et.length!=1&&(Ae=it=!1);var wt=this.__chain__,Yt=!!this.__actions__.length,dn=pe&&!wt,un=Ae&&!Yt;if(!pe&&it){xe=un?xe:new lr(this);var En=_.apply(xe,Se);return En.__actions__.push({func:H0,args:[ct],thisArg:i}),new $o(En,wt)}return dn&&un?_.apply(this,Se):(En=this.thru(ct),dn?U?En.value()[0]:En.value():En)})}),Ra(["pop","push","shift","sort","splice","unshift"],function(_){var b=Ap[_],N=/^(?:push|sort|unshift)$/.test(_)?"tap":"thru",U=/^(?:pop|shift)$/.test(_);ue.prototype[_]=function(){var re=arguments;if(U&&!this.__chain__){var pe=this.value();return b.apply(Dn(pe)?pe:[],re)}return this[N](function(xe){return b.apply(Dn(xe)?xe:[],re)})}}),pl(lr.prototype,function(_,b){var N=ue[b];if(N){var U=N.name+"";Kr.call(Lp,U)||(Lp[U]=[]),Lp[U].push({name:b,func:N})}}),Lp[D0(i,q).name]=[{name:"wrapper",func:i}],lr.prototype.clone=GO,lr.prototype.reverse=WO,lr.prototype.value=g0,ue.prototype.at=qb,ue.prototype.chain=KR,ue.prototype.commit=qR,ue.prototype.next=YR,ue.prototype.plant=Yb,ue.prototype.reverse=q0,ue.prototype.toJSON=ue.prototype.valueOf=ue.prototype.value=Y0,ue.prototype.first=ue.prototype.head,Bm&&(ue.prototype[Bm]=K0),ue},Ip=Na();qi?((qi.exports=Ip)._=Ip,hi._=Ip):zs._=Ip}).call(Gh)})(uk,uk.exports);var Vre=uk.exports;const FRe=()=>{const s=zr(),[n]=aT(),{user:i,setUser:l,language:u,setLanguage:p}=mr();tl();const[g,y]=H.useState("language"),[x,C]=H.useState(!1),[k,A]=H.useState(!1),[M,G]=H.useState(!1),[B,X]=H.useState(!1),[Z,q]=H.useState(!0),[V,ee]=H.useState(0),[de,ae]=H.useState(""),[ye,Q]=H.useState(!1),[$,se]=H.useState("idle"),[ce,he]=H.useState(null),[ve,ge]=H.useState(null),[qe,Dt]=H.useState((i==null?void 0:i.username)||""),[gt,Ye]=H.useState((i==null?void 0:i.displayName)||""),[ze,ut]=H.useState(""),[yt,Xt]=H.useState(""),[jt,Gt]=H.useState(""),[mn,Pt]=H.useState(""),[Jt,He]=H.useState(""),[bt,Wt]=H.useState(!1),[gn,xt]=H.useState(!1),[Sn,cr]=H.useState(null),[Or,ms]=H.useState(null),Oi=new Date().getFullYear(),xi=Array.from({length:80},(Qe,Bt)=>Oi-18-Bt),Gr=Array.from({length:31},(Qe,Bt)=>Bt+1),qt=[{value:1,label:"Januar"},{value:2,label:"Februar"},{value:3,label:"Mrz"},{value:4,label:"April"},{value:5,label:"Mai"},{value:6,label:"Juni"},{value:7,label:"Juli"},{value:8,label:"August"},{value:9,label:"September"},{value:10,label:"Oktober"},{value:11,label:"November"},{value:12,label:"Dezember"}];H.useEffect(()=>{const Qe=n.get("ref")||n.get("code")||n.get("invite");if(Qe){const Bt=Qe.trim().toUpperCase().replace(/\s+/g,"");ae(Bt),Jr(Bt)}},[n]);const Jr=async Qe=>{var Ct;const Bt=Qe.trim().toUpperCase().replace(/\s+/g,"");if(!Bt||Bt.length<5){se("idle"),he(null);return}Q(!0),he(null);try{const sn=await PF(Bt);if(sn){const{ownerId:Qn,link:qn}=sn;Qn===(i==null?void 0:i.id)?(se("invalid"),he(" Du kannst deinen eigenen Code nicht verwenden")):qn.usedBy?(se("invalid"),he(" Dieser Code wurde bereits eingelst")):qn.isActive===!1?(se("invalid"),he(" Dieser Code wurde deaktiviert")):(se("valid"),ge(Qn),he(null))}else se("invalid"),he(" Code nicht gefunden oder bereits vollstndig eingelst")}catch(sn){console.error("Error checking invite code:",sn),se("invalid"),(sn==null?void 0:sn.code)==="unavailable"||(Ct=sn==null?void 0:sn.message)!=null&&Ct.includes("network")?he(" Server nicht erreichbar - bitte spter erneut versuchen"):(sn==null?void 0:sn.code)==="permission-denied"?he(" Zugriff verweigert - Code konnte nicht geprft werden"):he(" Verbindungsfehler - bitte erneut versuchen")}finally{Q(!1)}},Ht=Qe=>{const Ct=Qe.trim().toUpperCase().replace(/[^A-Z0-9-\s]/g,"").replace(/\s+/g,"");ae(Ct),se("idle"),he(null),Ct.length>=5&&Jr(Ct)},wi=H.useCallback(Vre.debounce(async Qe=>{if(!Qe||Qe.length<3){cr(null),ms(Qe.length>0?"Mindestens 3 Zeichen":null);return}if(Qe.length>20){cr(!1),ms("Maximal 20 Zeichen");return}if(!/^[a-z0-9_]+$/.test(Qe)){cr(!1),ms("Nur Kleinbuchstaben, Zahlen & Unterstriche");return}if(["admin","delulu","support","help","system","mod","moderator"].includes(Qe)){cr(!1),ms("Dieser Username ist reserviert");return}xt(!0),ms(null);try{const Ct=xn(Me,"users"),sn=Zr(Ct,or("username","==",Qe)),Qn=await Ur(sn),qn=Qn.empty||Qn.docs.every(Bs=>Bs.id===(i==null?void 0:i.id));cr(qn),qn||ms("Username bereits vergeben")}catch(Ct){console.error("Error checking username:",Ct),ms("Prfung fehlgeschlagen"),cr(null)}finally{xt(!1)}},500),[i==null?void 0:i.id]),Cs=Qe=>{const Bt=Qe.toLowerCase().replace(/[^a-z0-9_]/g,"");Dt(Bt),cr(null),ms(null),Bt&&wi(Bt)},gr=[{icon:o.jsx(sm,{size:64,className:"text-delulu-violet"}),title:"Willkommen in der Wolke",description:"delulu verbindet dich mit Menschen in deiner Nhe ber Voice-Chat. Tippe auf die Wolke um loszulegen."},{icon:o.jsx(_c,{size:64,className:"text-green-500"}),title:"Hyperlokal",description:"Du siehst nur Menschen im Umkreis von max. 500m. Echte Nachbarn, echte Gesprche."},{icon:o.jsx(Ta,{size:64,className:"text-purple-500"}),title:"Anonym oder Offen",description:'Du entscheidest bei jedem Chat ob du als du selbst oder als "Wanderer" anonym bleibst.'},{icon:o.jsx(Hi,{size:64,className:"text-blue-500"}),title:"Privacy First",description:"Deine Daten gehren dir. Kein Tracking, keine Algorithmen. Du hast die volle Kontrolle."},{icon:o.jsx(rr,{size:64,className:"text-amber-500"}),title:"Community Regeln",description:"Respekt ist Pflicht. Belstigung, Hate Speech und unangemessenes Verhalten fhren zum Ausschluss."}],Za=Qe=>{p(Qe),localStorage.setItem("delulu-language",Qe)},es=()=>{y("invite")},Sr=()=>{y("age")},Ki=()=>{x&&y("terms")},Go=()=>{k&&M&&B&&y(Z?"tutorial":"profile")},vc=()=>{V<gr.length-1?ee(V+1):y("profile")},Ec=()=>{y("profile")},Ve=()=>{if(!yt||!jt||!mn)return!1;const Qe=parseInt(yt),Bt=parseInt(jt),Ct=parseInt(mn),sn=new Date(Ct,Bt-1,Qe);if(sn.getDate()!==Qe||sn.getMonth()!==Bt-1||sn.getFullYear()!==Ct)return!1;const Qn=new Date;return Qn.getFullYear()-Ct-(Qn.getMonth()<Bt-1||Qn.getMonth()===Bt-1&&Qn.getDate()<Qe?1:0)>=18},Qt=async()=>{if(!(!i||!qe.trim()||!Sn||!Ve())){Wt(!0);try{const Qe=new Date(parseInt(mn),parseInt(jt)-1,parseInt(yt)),Bt={username:qe.trim().toLowerCase().replace(/\s+/g,"_"),displayName:gt.trim()||qe.trim(),bio:ze.trim(),birthDate:Qe,birthDay:parseInt(yt),birthMonth:parseInt(jt),birthYear:parseInt(mn),showBirthdateOnProfile:!0,city:Jt.trim(),language:u,onboardingCompleted:!0,onboardingCompletedAt:new Date,isOver18Verified:!0,termsAcceptedAt:new Date,privacyAcceptedAt:new Date,communityGuidelinesAcceptedAt:new Date,usernameLastChanged:new Date,usernameChangeCount:0};if(await Kn(at(Me,"users",i.id),Bt),$==="valid"&&de&&ve)try{(await _re(de,i.id,qe)).success&&console.log("Referral code applied successfully")}catch(Ct){console.error("Error applying referral code:",Ct)}else try{await lO(i.id)}catch(Ct){console.error("Error initializing referrals:",Ct)}l({...i,...Bt}),s("/")}catch(Qe){console.error("Error saving profile:",Qe)}finally{Wt(!1)}}},_n=qe.trim()&&Sn&&!gn&&Ve();return o.jsxs("div",{className:"min-h-screen bg-delulu-bg flex flex-col",children:[o.jsx("div",{className:"px-6 pt-6",children:o.jsx("div",{className:"flex gap-2",children:["language","invite","age","terms","tutorial","profile"].map((Qe,Bt)=>o.jsx("div",{className:`h-1 flex-1 rounded-full transition-colors ${["language","invite","age","terms","tutorial","profile"].indexOf(g)>=Bt?"bg-delulu-violet":"bg-gray-200"}`},Qe))})}),g==="language"&&o.jsxs("div",{className:"flex-1 flex flex-col px-6 py-8",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"flex items-center justify-center gap-3 mb-6",children:o.jsx("div",{className:"w-16 h-16 rounded-full bg-delulu-violet/10 flex items-center justify-center",children:o.jsx(D_,{size:32,className:"text-delulu-violet"})})}),o.jsx("h1",{className:"font-display text-2xl font-bold text-delulu-text text-center mb-2",children:"Whle deine Sprache"}),o.jsx("p",{className:"text-delulu-muted text-center mb-6",children:"Choose your language"}),o.jsx("div",{className:"space-y-3",children:Object.keys(zc).map(Qe=>o.jsxs("button",{onClick:()=>Za(Qe),className:`w-full flex items-center gap-4 p-4 rounded-2xl border-2 transition-all ${u===Qe?"border-delulu-violet bg-delulu-violet/5":"border-gray-200 hover:border-gray-300"}`,children:[o.jsx("span",{className:"text-2xl",children:zc[Qe].flag}),o.jsxs("div",{className:"flex-1 text-left",children:[o.jsx("p",{className:"font-semibold text-delulu-text",children:zc[Qe].native}),o.jsx("p",{className:"text-xs text-delulu-muted",children:zc[Qe].name})]}),u===Qe&&o.jsx(zn,{size:20,className:"text-delulu-violet"})]},Qe))})]}),o.jsx("button",{onClick:es,className:"w-full py-4 bg-delulu-violet text-white font-bold rounded-xl transition-opacity",children:"Weiter"})]}),g==="invite"&&o.jsxs("div",{className:"flex-1 flex flex-col px-6 py-8",children:[o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[o.jsx("button",{onClick:()=>y("language"),className:"p-2 -m-2",children:o.jsx(Gu,{size:24,className:"text-delulu-muted"})}),o.jsx("h1",{className:"font-display text-2xl font-bold text-delulu-text",children:"Einladungscode"})]}),o.jsx("div",{className:"flex items-center justify-center mb-6",children:o.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center shadow-lg shadow-purple-500/30",children:o.jsx(ra,{size:40,className:"text-white"})})}),o.jsx("p",{className:"text-delulu-muted text-center mb-6",children:"Hast du einen Einladungscode von einem Freund erhalten? Gib ihn hier ein um Bonus-XP zu erhalten!"}),o.jsxs("div",{className:"mb-6",children:[o.jsx("label",{className:"block text-sm font-semibold text-delulu-text mb-2",children:"Einladungscode (optional)"}),o.jsxs("div",{className:"relative",children:[o.jsx(bRe,{size:20,className:"absolute left-4 top-1/2 -translate-y-1/2 text-delulu-muted"}),o.jsx("input",{type:"text",value:de,onChange:Qe=>Ht(Qe.target.value),placeholder:"z.B. DELULU-ABC12",maxLength:15,className:`w-full pl-12 pr-12 py-4 border-2 rounded-xl focus:outline-none transition-colors font-mono text-lg tracking-wider ${$==="valid"?"border-green-400 bg-green-50 focus:border-green-500":$==="invalid"?"border-red-300 bg-red-50 focus:border-red-500":"border-gray-200 focus:border-delulu-violet"}`}),o.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2",children:ye?o.jsx(Br,{size:20,className:"text-gray-400 animate-spin"}):$==="valid"?o.jsx(zn,{size:20,className:"text-green-500"}):$==="invalid"?o.jsx(Rs,{size:20,className:"text-red-500"}):null})]}),ce&&o.jsx("p",{className:"text-red-500 text-sm mt-2",children:ce}),$==="valid"&&o.jsx("div",{className:"mt-3 p-3 bg-green-100 rounded-xl border border-green-200",children:o.jsxs("p",{className:"text-green-800 text-sm font-medium flex items-center gap-2",children:[o.jsx(wr,{size:16}),"Code gltig! Du erhltst 125 Bonus-XP bei der Registrierung."]})})]}),o.jsx("div",{className:"p-4 bg-purple-50 rounded-2xl",children:o.jsxs("p",{className:"text-sm text-purple-800",children:[o.jsx("strong",{children:" Tipp:"})," Ohne Einladungscode kannst du dich trotzdem registrieren. Nach der Registrierung erhltst du eigene Einladungscodes zum Teilen!"]})})]}),o.jsx("button",{onClick:Sr,className:"w-full py-4 bg-delulu-violet text-white font-bold rounded-xl transition-opacity flex items-center justify-center gap-2",children:$==="valid"?o.jsxs(o.Fragment,{children:[o.jsx(zn,{size:20}),"Weiter mit Code"]}):"Weiter ohne Code"})]}),g==="age"&&o.jsxs("div",{className:"flex-1 flex flex-col px-6 py-8",children:[o.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-center",children:[o.jsx("div",{className:"w-20 h-20 rounded-full bg-amber-100 flex items-center justify-center mb-6",children:o.jsx(ql,{size:40,className:"text-amber-600"})}),o.jsx("h1",{className:"font-display text-2xl font-bold text-delulu-text mb-4",children:"Altersverifikation"}),o.jsx("p",{className:"text-delulu-muted mb-8 max-w-sm",children:"delulu ist eine Plattform fr Erwachsene. Du musst mindestens 18 Jahre alt sein um die App zu nutzen."}),o.jsxs("label",{className:"flex items-start gap-3 p-4 bg-white rounded-xl border-2 border-gray-200 cursor-pointer mb-6 text-left max-w-sm",children:[o.jsx("input",{type:"checkbox",checked:x,onChange:Qe=>C(Qe.target.checked),className:"mt-1 w-5 h-5 rounded border-gray-300 text-delulu-violet focus:ring-delulu-violet"}),o.jsxs("div",{children:[o.jsx("p",{className:"font-semibold text-delulu-text",children:"Ich besttige, dass ich 18 Jahre oder lter bin"}),o.jsx("p",{className:"text-sm text-delulu-muted mt-1",children:"Falsche Angaben fhren zur sofortigen Sperrung des Accounts."})]})]}),o.jsx("p",{className:"text-xs text-delulu-muted max-w-sm",children:"Bei Verdacht auf Minderjhrigkeit kann eine ID-Verifikation angefordert werden."})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:()=>y("invite"),className:"py-4 px-6 border-2 border-gray-200 text-delulu-muted font-semibold rounded-xl",children:o.jsx(Gu,{size:20})}),o.jsx("button",{onClick:Ki,disabled:!x,className:"flex-1 py-4 bg-delulu-violet text-white font-bold rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-opacity",children:"Weiter"})]})]}),g==="terms"&&o.jsxs("div",{className:"flex-1 flex flex-col px-6 py-8",children:[o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[o.jsx("button",{onClick:()=>y("age"),className:"p-2 -m-2",children:o.jsx(Gu,{size:24,className:"text-delulu-muted"})}),o.jsx("h1",{className:"font-display text-2xl font-bold text-delulu-text",children:"Nutzungsbedingungen"})]}),o.jsx("p",{className:"text-delulu-muted mb-6",children:"Bitte lies und akzeptiere unsere Richtlinien um fortzufahren."}),o.jsxs("div",{className:"space-y-4 mb-6",children:[o.jsxs("label",{className:"flex items-start gap-3 p-4 bg-white rounded-xl border-2 border-gray-200 cursor-pointer",children:[o.jsx("input",{type:"checkbox",checked:k,onChange:Qe=>A(Qe.target.checked),className:"mt-1 w-5 h-5 rounded border-gray-300 text-delulu-violet focus:ring-delulu-violet"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("p",{className:"font-semibold text-delulu-text",children:"AGB akzeptieren"}),o.jsxs("p",{className:"text-sm text-delulu-muted",children:["Ich habe die"," ",o.jsx("a",{href:"/impressum",className:"text-delulu-violet underline",children:"Allgemeinen Geschftsbedingungen"})," ","gelesen und akzeptiere diese."]})]})]}),o.jsxs("label",{className:"flex items-start gap-3 p-4 bg-white rounded-xl border-2 border-gray-200 cursor-pointer",children:[o.jsx("input",{type:"checkbox",checked:M,onChange:Qe=>G(Qe.target.checked),className:"mt-1 w-5 h-5 rounded border-gray-300 text-delulu-violet focus:ring-delulu-violet"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("p",{className:"font-semibold text-delulu-text",children:"Datenschutz akzeptieren"}),o.jsxs("p",{className:"text-sm text-delulu-muted",children:["Ich habe die"," ",o.jsx("a",{href:"/datenschutz",className:"text-delulu-violet underline",children:"Datenschutzerklrung"})," ","gelesen und akzeptiere diese."]})]})]}),o.jsxs("label",{className:"flex items-start gap-3 p-4 bg-white rounded-xl border-2 border-gray-200 cursor-pointer",children:[o.jsx("input",{type:"checkbox",checked:B,onChange:Qe=>X(Qe.target.checked),className:"mt-1 w-5 h-5 rounded border-gray-300 text-delulu-violet focus:ring-delulu-violet"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("p",{className:"font-semibold text-delulu-text",children:"Community-Regeln akzeptieren"}),o.jsx("p",{className:"text-sm text-delulu-muted",children:"Ich verpflichte mich zu respektvollem Umgang. Belstigung, Hate Speech und unangemessenes Verhalten sind verboten."})]})]})]}),o.jsxs("label",{className:"flex items-center gap-3 p-4 bg-purple-50 rounded-xl cursor-pointer",children:[o.jsx("input",{type:"checkbox",checked:Z,onChange:Qe=>q(Qe.target.checked),className:"w-5 h-5 rounded border-gray-300 text-delulu-violet focus:ring-delulu-violet"}),o.jsxs("div",{children:[o.jsx("p",{className:"font-semibold text-delulu-text",children:"App-Einfhrung anzeigen"}),o.jsx("p",{className:"text-sm text-delulu-muted",children:"Kurze Erklrung wie delulu funktioniert"})]})]})]}),o.jsx("button",{onClick:Go,disabled:!k||!M||!B,className:"w-full py-4 bg-delulu-violet text-white font-bold rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-opacity",children:"Weiter"})]}),g==="tutorial"&&o.jsxs("div",{className:"flex-1 flex flex-col px-6 py-8",children:[o.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-center",children:[o.jsx("div",{className:"mb-8",children:gr[V].icon}),o.jsx("h2",{className:"font-display text-2xl font-bold text-delulu-text mb-4",children:gr[V].title}),o.jsx("p",{className:"text-delulu-muted max-w-sm mb-8",children:gr[V].description}),o.jsx("div",{className:"flex gap-2",children:gr.map((Qe,Bt)=>o.jsx("div",{className:`w-2 h-2 rounded-full transition-colors ${Bt===V?"bg-delulu-violet w-6":"bg-gray-300"}`},Bt))})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:Ec,className:"flex-1 py-4 border-2 border-gray-200 text-delulu-muted font-semibold rounded-xl",children:"berspringen"}),o.jsx("button",{onClick:vc,className:"flex-1 py-4 bg-delulu-violet text-white font-bold rounded-xl flex items-center justify-center gap-2",children:V<gr.length-1?o.jsxs(o.Fragment,{children:["Weiter ",o.jsx(As,{size:20})]}):o.jsxs(o.Fragment,{children:["Los geht's ",o.jsx(wr,{size:20})]})})]})]}),g==="profile"&&o.jsxs("div",{className:"flex-1 flex flex-col px-6 py-8 overflow-y-auto",children:[o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[o.jsx("button",{onClick:()=>y("tutorial"),className:"p-2 -m-2",children:o.jsx(Gu,{size:24,className:"text-delulu-muted"})}),o.jsx("h1",{className:"font-display text-2xl font-bold text-delulu-text",children:"Dein Profil"})]}),o.jsx("p",{className:"text-delulu-muted mb-6",children:"Richte dein Profil ein. Du kannst diese Angaben spter jederzeit ndern."}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-delulu-text mb-2",children:"Benutzername *"}),o.jsxs("div",{className:"relative",children:[o.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-delulu-muted",children:"@"}),o.jsx("input",{type:"text",value:qe,onChange:Qe=>Cs(Qe.target.value),placeholder:"dein_name",maxLength:20,className:`w-full pl-8 pr-12 py-3 border-2 rounded-xl focus:outline-none transition-colors ${Or?"border-red-300 focus:border-red-500":Sn?"border-green-300 focus:border-green-500":"border-gray-200 focus:border-delulu-violet"}`}),o.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2",children:gn?o.jsx(Br,{size:20,className:"text-gray-400 animate-spin"}):Sn===!0?o.jsx(zn,{size:20,className:"text-green-500"}):Sn===!1?o.jsx(Rs,{size:20,className:"text-red-500"}):null})]}),Or&&o.jsx("p",{className:"text-red-500 text-xs mt-1",children:Or}),Sn&&o.jsxs("p",{className:"text-green-600 text-xs mt-1",children:[" @",qe," ist verfgbar"]}),o.jsx("p",{className:"text-xs text-delulu-muted mt-1",children:"Einzigartig, nur Kleinbuchstaben, Zahlen & Unterstriche"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-delulu-text mb-2",children:"Anzeigename"}),o.jsx("input",{type:"text",value:gt,onChange:Qe=>Ye(Qe.target.value),placeholder:"Wie sollen dich andere sehen?",maxLength:30,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-delulu-violet focus:outline-none"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-delulu-text mb-2",children:"Geburtsdatum *"}),o.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[o.jsxs("select",{value:yt,onChange:Qe=>Xt(Qe.target.value),className:"px-3 py-3 border-2 border-gray-200 rounded-xl focus:border-delulu-violet focus:outline-none bg-white",children:[o.jsx("option",{value:"",children:"Tag"}),Gr.map(Qe=>o.jsx("option",{value:Qe,children:Qe},Qe))]}),o.jsxs("select",{value:jt,onChange:Qe=>Gt(Qe.target.value),className:"px-3 py-3 border-2 border-gray-200 rounded-xl focus:border-delulu-violet focus:outline-none bg-white",children:[o.jsx("option",{value:"",children:"Monat"}),qt.map(Qe=>o.jsx("option",{value:Qe.value,children:Qe.label},Qe.value))]}),o.jsxs("select",{value:mn,onChange:Qe=>Pt(Qe.target.value),className:"px-3 py-3 border-2 border-gray-200 rounded-xl focus:border-delulu-violet focus:outline-none bg-white",children:[o.jsx("option",{value:"",children:"Jahr"}),xi.map(Qe=>o.jsx("option",{value:Qe,children:Qe},Qe))]})]}),yt&&jt&&mn&&!Ve()&&o.jsx("p",{className:"text-red-500 text-xs mt-1",children:"Du musst mindestens 18 Jahre alt sein"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-delulu-text mb-2",children:"Stadt / Region"}),o.jsx("input",{type:"text",value:Jt,onChange:Qe=>He(Qe.target.value),placeholder:"z.B. Berlin, Mnchen...",maxLength:50,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-delulu-violet focus:outline-none"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-delulu-text mb-2",children:"ber dich"}),o.jsx("textarea",{value:ze,onChange:Qe=>ut(Qe.target.value),placeholder:"Erzhl etwas ber dich... (optional)",maxLength:200,rows:3,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-delulu-violet focus:outline-none resize-none"}),o.jsxs("p",{className:"text-xs text-delulu-muted mt-1 text-right",children:[ze.length,"/200"]})]})]})]}),o.jsx("button",{onClick:Qt,disabled:!_n||bt,className:"w-full py-4 bg-delulu-violet text-white font-bold rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-opacity flex items-center justify-center gap-2 mt-6",children:bt?o.jsxs(o.Fragment,{children:[o.jsx(Br,{size:20,className:"animate-spin"}),"Speichern..."]}):o.jsxs(o.Fragment,{children:[o.jsx(Vu,{size:20}),"Profil speichern & starten"]})})]})]})},BRe=()=>{const{location:s,locationError:n,locationPermission:i,setLocation:l,setLocationError:u,setLocationPermission:p}=mr(),g=H.useCallback(async(C,k,A)=>{const M=Fi.currentUser;if(M)try{await yo(at(Me,"user_locations",M.uid),{userId:M.uid,latitude:C,longitude:k,accuracy:A,updatedAt:Uo(),expiresAt:new Date(Date.now()+15*60*1e3)})}catch(G){console.error("Failed to update location:",G)}},[]),y=H.useCallback(async()=>{if(!navigator.geolocation)return u("Geolocation wird nicht untersttzt"),!1;try{const C=await navigator.permissions.query({name:"geolocation"});return p(C.state),C.state==="denied"?(u("Standort-Zugriff verweigert"),!1):!0}catch{return!0}},[p,u]),x=H.useCallback(()=>navigator.geolocation?navigator.geolocation.watchPosition(k=>{const A={latitude:k.coords.latitude,longitude:k.coords.longitude,accuracy:k.coords.accuracy,timestamp:new Date(k.timestamp)};l(A),u(null),p("granted"),g(A.latitude,A.longitude,A.accuracy)},k=>{switch(k.code){case k.PERMISSION_DENIED:u("Standort-Zugriff verweigert"),p("denied");break;case k.POSITION_UNAVAILABLE:u("Standort nicht verfgbar");break;case k.TIMEOUT:u("Standort-Anfrage Timeout");break;default:u("Unbekannter Fehler")}},{enableHighAccuracy:!0,maximumAge:1e4,timeout:1e4}):(u("Geolocation wird nicht untersttzt"),null),[l,u,p,g]);return H.useEffect(()=>{let C=null;return(async()=>{await y()&&(C=x())})(),()=>{C!==null&&navigator.geolocation.clearWatch(C)}},[y,x]),{location:s,error:n,permission:i,requestPermission:y}},GF={empty:{messages:"Keine Nachrichten. Die Stille ist ohrenbetubend.",lounges:"Keine Lounges in der Nhe. Zeit, selbst eine zu erstellen?",stats:"Noch keine Stats. Fang an zu reden, dann gibts auch was zu zeigen."}},fO=s=>s>=76?{name:"Legend",emoji:""}:s>=51?{name:"Influencer",emoji:""}:s>=31?{name:"Socialite",emoji:""}:s>=16?{name:"Connector",emoji:""}:s>=6?{name:"Dreamer",emoji:""}:{name:"Newcomer",emoji:""},mO=s=>s>=30?2:s>=14?1.8:s>=7?1.6:s>=6?1.5:s>=5?1.4:s>=4?1.3:s>=3?1.2:s>=2?1.1:1,hk=s=>Math.floor(Math.pow(s,1.5)*100),zRe=({onToggle:s})=>{var k;const{user:n,setUser:i}=mr(),[l,u]=H.useState((n==null?void 0:n.isGlobalAnonymous)||!1),[p,g]=H.useState(!1),[y,x]=H.useState(!1);H.useEffect(()=>{(n==null?void 0:n.isGlobalAnonymous)!==void 0&&u(n.isGlobalAnonymous)},[n==null?void 0:n.isGlobalAnonymous]);const C=async()=>{if(!(n!=null&&n.id)||y)return;const A=!l;u(A),x(!0),"vibrate"in navigator&&navigator.vibrate(A?[20,10,20]:10);try{await Kn(at(Me,"users",n.id),{isGlobalAnonymous:A,lastAnonymityChange:new Date}),i({...n,isGlobalAnonymous:A}),s==null||s(A)}catch(M){console.error("Failed to save anonymity mode:",M),u(!A)}finally{x(!1)}};return o.jsxs("div",{className:"relative flex items-center gap-3",children:[o.jsxs("div",{className:"relative",children:[o.jsxs("div",{className:`
            w-12 h-12 rounded-2xl overflow-hidden transition-all duration-300
            ${l?"ring-2 ring-green-400 ring-offset-2 shadow-lg shadow-green-400/30":"ring-1 ring-gray-200"}
          `,children:[n!=null&&n.avatarUrl?o.jsx("img",{src:n.avatarUrl,alt:"",className:`w-full h-full object-cover transition-all duration-300 ${l?"blur-md scale-110":""}`}):o.jsx("div",{className:`
              w-full h-full bg-gradient-to-br from-delulu-violet to-purple-600
              flex items-center justify-center text-white text-xl font-bold
              transition-all duration-300
              ${l?"blur-sm":""}
            `,children:((k=n==null?void 0:n.displayName)==null?void 0:k.charAt(0))||"?"}),l&&o.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20",children:o.jsx(li,{size:20,className:"text-white drop-shadow-lg"})})]}),o.jsx("div",{className:`
            absolute -bottom-1 -right-1 w-5 h-5 rounded-full
            flex items-center justify-center
            transition-all duration-300
            ${l?"bg-green-500 shadow-lg shadow-green-500/50":"bg-gray-400"}
          `,children:l?o.jsx($c,{size:10,className:"text-white"}):o.jsx(Ta,{size:10,className:"text-white"})})]}),o.jsxs("button",{onClick:C,disabled:y,onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),className:`
          relative flex items-center gap-2 px-3 py-2 rounded-xl
          font-semibold text-sm transition-all duration-300
          disabled:opacity-70
          ${l?"bg-green-100 text-green-700 border border-green-200 shadow-sm":"bg-gray-100 text-gray-500 border border-gray-200 hover:bg-gray-50"}
        `,children:[y?o.jsx(Br,{size:16,className:"animate-spin"}):o.jsx("div",{className:`
            relative w-8 h-5 rounded-full transition-colors duration-300
            ${l?"bg-green-500":"bg-gray-300"}
          `,children:o.jsx("div",{className:`
              absolute top-0.5 w-4 h-4 rounded-full bg-white shadow-sm
              transition-transform duration-300
              ${l?"left-3.5":"left-0.5"}
            `})}),o.jsx("span",{className:"hidden sm:inline",children:l?"Anonym":"Sichtbar"})]}),p&&o.jsxs("div",{className:"absolute top-full left-0 mt-2 p-3 bg-gray-900 text-white text-xs rounded-xl shadow-xl z-50 w-48 animate-in fade-in slide-in-from-top-2",children:[o.jsx("p",{className:"font-semibold mb-1",children:l?" Anonymer Modus":" Sichtbarer Modus"}),o.jsx("p",{className:"text-gray-300",children:l?"Dein Profilbild ist verschleiert. Andere sehen nur deinen Alias.":"Dein Profil ist vollstndig sichtbar fr andere User."}),o.jsx("p",{className:"text-gray-400 text-[10px] mt-2",children:"Diese Einstellung bleibt gespeichert"})]})]})},GRe=({currentStreak:s,longestStreak:n=0,onClaim:i,canClaim:l=!1})=>{const{t:u}=tl(),p=mO(s),g=[7,14,30,60,100].find(C=>C>s)||100,y=s/g*100,x=C=>C>=100?" Legend Box":C>=60?" Diamond Box":C>=30?" Royal Box":C>=14?" Premium Box":C>=7?" Bonus Box":" XP Bonus";return o.jsxs("div",{className:"relative overflow-hidden",children:[o.jsxs("div",{className:"glass-card p-4 border-2 border-orange-200 bg-gradient-to-r from-orange-50 to-amber-50",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"w-14 h-14 rounded-2xl bg-gradient-to-br from-orange-400 to-red-500 flex items-center justify-center shadow-lg",children:o.jsx(Ire,{size:28,className:"text-white"})}),o.jsx("div",{className:"absolute inset-0 rounded-2xl bg-orange-400/30 animate-pulse"})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-baseline gap-2",children:[o.jsx("span",{className:"font-display text-3xl font-black text-orange-600",children:s}),o.jsx("span",{className:"text-sm font-semibold text-orange-500",children:u("profile.stats.streak")})]}),o.jsxs("p",{className:"text-xs text-orange-600/70",children:["Best: ",n," Tage"]})]})]}),o.jsxs("div",{className:"text-right",children:[o.jsxs("div",{className:"inline-flex items-center gap-1 bg-gradient-to-r from-amber-400 to-orange-500 text-white px-3 py-1.5 rounded-xl shadow-lg",children:[o.jsx(Ei,{size:14,className:"fill-white"}),o.jsxs("span",{className:"font-bold text-sm",children:[p,"x XP"]})]}),l&&o.jsxs("button",{onClick:i,className:"mt-2 flex items-center gap-1 text-xs font-semibold text-amber-600 hover:text-amber-700 transition-colors",children:[o.jsx(ra,{size:12}),o.jsx("span",{children:"Bonus abholen!"})]})]})]}),o.jsxs("div",{className:"mt-4",children:[o.jsxs("div",{className:"flex items-center justify-between text-xs mb-1.5",children:[o.jsx("span",{className:"text-orange-600/70",children:"Nchste Belohnung"}),o.jsxs("span",{className:"font-semibold text-orange-600",children:[x(g)," @ Tag ",g]})]}),o.jsx("div",{className:"h-2 bg-orange-100 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full bg-gradient-to-r from-orange-400 to-amber-500 rounded-full transition-all duration-500",style:{width:`${Math.min(y,100)}%`}})}),o.jsxs("div",{className:"flex justify-between text-[10px] text-orange-500/60 mt-1",children:[o.jsxs("span",{children:["Tag ",s]}),o.jsxs("span",{children:["Tag ",g]})]})]})]}),s>=7&&o.jsx("div",{className:"absolute -top-2 -right-2 text-2xl animate-bounce",children:""}),s>=30&&o.jsx("div",{className:"absolute -top-2 -left-2 text-xl animate-bounce",style:{animationDelay:"0.2s"},children:""})]})},WRe=({isOpen:s,onClose:n,onChoose:i,chatType:l,targetName:u="Chat"})=>{const{user:p}=mr(),[g,y]=H.useState(null),[x,C]=H.useState(!0);if(!s)return null;const k={dm:"Direktnachricht",lounge:"Lounge",voice:"Voice Chat"},A=()=>{g&&i(g)};return o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:o.jsxs("div",{className:"relative w-full max-w-md bg-white rounded-3xl shadow-2xl overflow-hidden animate-in zoom-in-95 duration-200",children:[o.jsxs("div",{className:"relative bg-gradient-to-br from-delulu-violet to-purple-600 p-6 text-white",children:[o.jsx("button",{onClick:n,className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-white/20 flex items-center justify-center hover:bg-white/30 transition-colors",children:o.jsx(Rs,{size:18})}),o.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-2xl bg-white/20 flex items-center justify-center",children:o.jsx(li,{size:24})}),o.jsxs("div",{children:[o.jsx("h2",{className:"font-display text-xl font-bold",children:"Identitt whlen"}),o.jsxs("p",{className:"text-white/80 text-sm",children:["Wie mchtest du ",k[l]," beitreten?"]})]})]}),u&&o.jsx("div",{className:"mt-2 px-3 py-1.5 bg-white/10 rounded-lg inline-block",children:o.jsxs("span",{className:"text-sm",children:[" ",u]})})]}),o.jsxs("div",{className:"p-6 space-y-4",children:[o.jsx("button",{onClick:()=>y("anonymous"),className:`w-full p-5 rounded-2xl border-2 text-left transition-all duration-200 ${g==="anonymous"?"border-delulu-violet bg-delulu-violet/5 shadow-lg scale-[1.02]":"border-gray-200 hover:border-delulu-violet/50 hover:bg-gray-50"}`,children:o.jsxs("div",{className:"flex items-start gap-4",children:[o.jsx("div",{className:`w-14 h-14 rounded-2xl flex items-center justify-center ${g==="anonymous"?"bg-delulu-violet text-white":"bg-gray-100 text-gray-500"}`,children:o.jsx($c,{size:24})}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("h3",{className:"font-display font-bold text-lg text-delulu-text",children:"Anonym"}),o.jsx("span",{className:"px-2 py-0.5 bg-green-100 text-green-700 text-[10px] font-semibold rounded-full",children:"EMPFOHLEN"})]}),o.jsxs("p",{className:"text-sm text-delulu-muted mt-1",children:["Dein Profilbild wird verschleiert und du erscheinst als",o.jsxs("span",{className:"font-semibold text-delulu-violet ml-1",children:['"',(p==null?void 0:p.anonymousAlias)||"Wanderer_"+Math.floor(Math.random()*9999),'"']})]}),o.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[o.jsx(Hi,{size:12,className:"text-green-600"}),o.jsx("span",{className:"text-xs text-green-600 font-medium",children:"Echte Identitt geschtzt"})]})]}),g==="anonymous"&&o.jsx("div",{className:"w-6 h-6 rounded-full bg-delulu-violet flex items-center justify-center",children:o.jsx(wr,{size:14,className:"text-white"})})]})}),o.jsx("button",{onClick:()=>y("public"),className:`w-full p-5 rounded-2xl border-2 text-left transition-all duration-200 ${g==="public"?"border-delulu-violet bg-delulu-violet/5 shadow-lg scale-[1.02]":"border-gray-200 hover:border-delulu-violet/50 hover:bg-gray-50"}`,children:o.jsxs("div",{className:"flex items-start gap-4",children:[o.jsx("div",{className:`w-14 h-14 rounded-2xl flex items-center justify-center ${g==="public"?"bg-delulu-violet text-white":"bg-gray-100 text-gray-500"}`,children:p!=null&&p.avatarUrl?o.jsx("img",{src:p.avatarUrl,alt:"",className:"w-full h-full rounded-2xl object-cover"}):o.jsx(tp,{size:24})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"font-display font-bold text-lg text-delulu-text",children:"ffentlich"}),o.jsxs("p",{className:"text-sm text-delulu-muted mt-1",children:["Du erscheinst als",o.jsxs("span",{className:"font-semibold text-delulu-text ml-1",children:["@",(p==null?void 0:p.username)||"dein_name"]})," ","mit deinem echten Profilbild"]}),o.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[o.jsx(Ta,{size:12,className:"text-amber-600"}),o.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Profil vollstndig sichtbar"})]})]}),g==="public"&&o.jsx("div",{className:"w-6 h-6 rounded-full bg-delulu-violet flex items-center justify-center",children:o.jsx(wr,{size:14,className:"text-white"})})]})}),o.jsxs("label",{className:"flex items-center gap-3 py-3 cursor-pointer",children:[o.jsxs("div",{className:"relative",children:[o.jsx("input",{type:"checkbox",checked:x,onChange:M=>C(M.target.checked),className:"sr-only peer"}),o.jsx("div",{className:"w-10 h-6 bg-gray-200 rounded-full peer-checked:bg-delulu-violet transition-colors"}),o.jsx("div",{className:"absolute top-1 left-1 w-4 h-4 bg-white rounded-full shadow transition-transform peer-checked:translate-x-4"})]}),o.jsx("span",{className:"text-sm text-delulu-muted",children:"Auswahl fr diesen Chat merken (24h)"})]})]}),o.jsxs("div",{className:"p-6 pt-0",children:[o.jsxs("button",{onClick:A,disabled:!g,className:`
              w-full py-4 px-6 rounded-2xl font-bold text-lg
              flex items-center justify-center gap-2
              transition-all duration-200
              ${g?"bg-gradient-to-r from-delulu-violet to-purple-600 text-white shadow-lg hover:shadow-xl hover:scale-[1.02] active:scale-[0.98]":"bg-gray-200 text-gray-400 cursor-not-allowed"}
            `,children:[g==="anonymous"?o.jsxs(o.Fragment,{children:[o.jsx($c,{size:20}),"Anonym beitreten"]}):g==="public"?o.jsxs(o.Fragment,{children:[o.jsx(Ta,{size:20}),"ffentlich beitreten"]}):"Bitte whlen",g&&o.jsx(As,{size:20})]}),o.jsx("p",{className:"text-center text-xs text-delulu-muted mt-4",children:"Du kannst deine Identitt jederzeit in den Einstellungen ndern"})]})]})})},Fre={nebula:{label:"Verified",labelDe:"Verifiziert",icon:wr,primaryColor:"#8B5CF6",secondaryColor:"#A78BFA",glowColor:"rgba(139, 92, 246, 0.6)",gradient:"from-purple-500 via-violet-500 to-purple-600"},supernova:{label:"Supernova",labelDe:"Supernova",icon:Fs,primaryColor:"#F59E0B",secondaryColor:"#FBBF24",glowColor:"rgba(245, 158, 11, 0.6)",gradient:"from-amber-400 via-yellow-500 to-orange-500"},galaxy:{label:"Galaxy",labelDe:"Galaxie",icon:Ei,primaryColor:"#EC4899",secondaryColor:"#F472B6",glowColor:"rgba(236, 72, 153, 0.6)",gradient:"from-pink-500 via-rose-500 to-fuchsia-500"},universe:{label:"Universe",labelDe:"Universum",icon:hs,primaryColor:"#06B6D4",secondaryColor:"#22D3EE",glowColor:"rgba(6, 182, 212, 0.6)",gradient:"from-cyan-400 via-teal-500 to-emerald-500"},founder:{label:"Founder",labelDe:"Grnder",icon:li,primaryColor:"#FFD700",secondaryColor:"#FFF8DC",glowColor:"rgba(255, 215, 0, 0.8)",gradient:"from-yellow-300 via-amber-400 to-yellow-500"}},HRe={sm:{badge:"w-4 h-4",icon:10,text:"text-[10px]"},md:{badge:"w-5 h-5",icon:12,text:"text-xs"},lg:{badge:"w-6 h-6",icon:14,text:"text-sm"},xl:{badge:"w-8 h-8",icon:18,text:"text-base"}},vy=({tier:s,size:n="md",showLabel:i=!1,animated:l=!0,className:u=""})=>{const p=Fre[s],g=HRe[n],y=p.icon;return o.jsxs("div",{className:`inline-flex items-center gap-1.5 ${u}`,children:[o.jsxs("div",{className:"relative",children:[l&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:`absolute inset-0 ${g.badge} rounded-full opacity-60`,style:{background:`radial-gradient(circle, ${p.glowColor} 0%, transparent 70%)`,animation:"nebulaPulse 2s ease-in-out infinite"}}),o.jsx("div",{className:"absolute inset-[-2px] rounded-full",style:{background:`conic-gradient(from 0deg, ${p.primaryColor}, ${p.secondaryColor}, ${p.primaryColor})`,animation:"nebulaRotate 3s linear infinite",opacity:.4}})]}),o.jsx("div",{className:`relative ${g.badge} rounded-full flex items-center justify-center bg-gradient-to-br ${p.gradient} shadow-lg`,style:{boxShadow:l?`0 0 12px ${p.glowColor}`:"none"},children:o.jsx(y,{size:g.icon,className:"text-white drop-shadow-md",strokeWidth:2.5})}),l&&s!=="nebula"&&o.jsx("div",{className:"absolute inset-0 pointer-events-none",children:[...Array(3)].map((x,C)=>o.jsx("div",{className:"absolute w-1 h-1 bg-white rounded-full opacity-80",style:{top:`${20+C*25}%`,left:`${10+C*30}%`,animation:`sparkle ${1.5+C*.3}s ease-in-out infinite ${C*.2}s`}},C))})]}),i&&o.jsx("span",{className:`font-semibold ${g.text} bg-gradient-to-r ${p.gradient} bg-clip-text text-transparent`,children:p.label}),o.jsx("style",{children:`
        @keyframes nebulaPulse {
          0%, 100% { transform: scale(1); opacity: 0.6; }
          50% { transform: scale(1.4); opacity: 0.3; }
        }

        @keyframes nebulaRotate {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }

        @keyframes sparkle {
          0%, 100% { opacity: 0; transform: scale(0); }
          50% { opacity: 1; transform: scale(1); }
        }
      `})]})},KRe=({tier:s,children:n,intensity:i="normal",className:l=""})=>{const u=Fre[s],p={subtle:{blur:"20px",opacity:.3},normal:{blur:"30px",opacity:.5},intense:{blur:"40px",opacity:.7}},{blur:g,opacity:y}=p[i];return o.jsxs("div",{className:`relative ${l}`,children:[o.jsx("div",{className:"absolute inset-[-10px] rounded-full pointer-events-none",style:{background:`radial-gradient(circle, ${u.glowColor} 0%, transparent 70%)`,filter:`blur(${g})`,opacity:y,animation:"auraBreath 3s ease-in-out infinite"}}),o.jsx("div",{className:"relative z-10",children:n}),o.jsx("style",{children:`
        @keyframes auraBreath {
          0%, 100% { transform: scale(1); opacity: ${y}; }
          50% { transform: scale(1.1); opacity: ${y*.6}; }
        }
      `})]})},qRe={influencer:{en:"Influencer",de:"Influencer",emoji:""},entrepreneur:{en:"Entrepreneur",de:"Unternehmer",emoji:""},artist:{en:"Artist",de:"Knstler",emoji:""},athlete:{en:"Athlete",de:"Sportler",emoji:""},musician:{en:"Musician",de:"Musiker",emoji:""},actor:{en:"Actor",de:"Schauspieler",emoji:""},journalist:{en:"Journalist",de:"Journalist",emoji:""},politician:{en:"Politician",de:"Politiker",emoji:""},scientist:{en:"Scientist",de:"Wissenschaftler",emoji:""},creator:{en:"Creator",de:"Creator",emoji:""},other:{en:"Public Figure",de:"Persnlichkeit",emoji:""}},Bre=({category:s,size:n="md"})=>{const i=qRe[s];return o.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-gray-800/60 border border-gray-700/50 ${n==="sm"?"text-[10px]":"text-xs"}`,children:[o.jsx("span",{children:i.emoji}),o.jsx("span",{className:"text-gray-300",children:i.de})]})},NJ={de:"Wanderer",en:"Wanderer",es:"Caminante",fr:"Voyageur",pt:"Andarilho"},YRe=()=>{var Dt,gt;const s=zr(),{user:n,isVerifiedStar:i}=mr(),{location:l}=BRe(),{language:u}=tl(),[p,g]=H.useState((n==null?void 0:n.isGlobalAnonymous)||!1),[y,x]=H.useState(!1),[C,k]=H.useState(!1),[A,M]=H.useState(0),[G,B]=H.useState(0),[X,Z]=H.useState([]),[q,V]=H.useState([]),[ee,de]=H.useState([]),[ae,ye]=H.useState(0),Q=(n==null?void 0:n.isPremium)||!1;H.useEffect(()=>{if(!l){B(0),Z([]);return}const Ye=xn(Me,"users"),ze=Zr(Ye,or("isActive","==",!0),VE(50)),ut=qa(ze,yt=>{const Xt=[];yt.docs.forEach(jt=>{var Or;const Gt=jt.data();if(jt.id===(n==null?void 0:n.id)||!Gt.location)return;const mn=l.latitude,Pt=l.longitude,Jt=Gt.location.latitude,He=Gt.location.longitude;if(!Jt||!He)return;const bt=6371e3,Wt=(Jt-mn)*Math.PI/180,gn=(He-Pt)*Math.PI/180,xt=Math.sin(Wt/2)*Math.sin(Wt/2)+Math.cos(mn*Math.PI/180)*Math.cos(Jt*Math.PI/180)*Math.sin(gn/2)*Math.sin(gn/2),Sn=2*Math.atan2(Math.sqrt(xt),Math.sqrt(1-xt));bt*Sn<=500&&Xt.push({id:jt.id,username:Gt.username,displayName:Gt.displayName||Gt.username,avatar:Gt.photoURL,level:Gt.level||1,lastSeen:((Or=Gt.lastSeen)==null?void 0:Or.toDate())||new Date})}),B(Xt.length),Z(Xt.slice(0,6))},()=>{B(0),Z([])});return()=>ut()},[l,n==null?void 0:n.id]),H.useEffect(()=>{if(!(n!=null&&n.id)||!Q){V([]);return}const Ye=xn(Me,"profileVisits"),ze=Zr(Ye,or("visitedUserId","==",n.id),fy("visitedAt","desc"),VE(6)),ut=qa(ze,async yt=>{var jt;const Xt=[];for(const Gt of yt.docs){const mn=Gt.data(),Pt=await Ur(Zr(xn(Me,"users"),or("__name__","==",mn.visitorId),VE(1)));if(!Pt.empty){const Jt=Pt.docs[0].data();Xt.push({id:mn.visitorId,username:Jt.username,displayName:Jt.displayName||Jt.username,avatar:Jt.photoURL,visitedAt:((jt=mn.visitedAt)==null?void 0:jt.toDate())||new Date})}}V(Xt)},()=>{V([])});return()=>ut()},[n==null?void 0:n.id,Q]),H.useEffect(()=>{const Ye=xn(Me,"starEvents"),ze=Zr(Ye,or("isLive","==",!0),fy("startedAt","desc"),VE(5)),ut=qa(ze,yt=>{const Xt=yt.docs.map(jt=>{var mn;const Gt=jt.data();return{id:jt.id,type:"star_live",title:`${Gt.hostDisplayName} ist LIVE`,subtitle:Gt.title,starId:Gt.hostId,starUsername:Gt.hostUsername,starTier:Gt.hostTier||"nebula",eventId:jt.id,priority:10,createdAt:((mn=Gt.startedAt)==null?void 0:mn.toDate())||new Date,expiresAt:new Date(Date.now()+36e5)}});de(Xt)},()=>de([]));return()=>ut()},[]),H.useEffect(()=>{if(!(n!=null&&n.id))return;const Ye=xn(Me,"notifications"),ze=Zr(Ye,or("userId","==",n.id),or("read","==",!1)),ut=qa(ze,yt=>{ye(yt.size)},()=>ye(0));return()=>ut()},[n==null?void 0:n.id]),H.useEffect(()=>{if(ee.length<=1)return;const Ye=setInterval(()=>{M(ze=>(ze+1)%ee.length)},4e3);return()=>clearInterval(Ye)},[ee.length]);const $=(n==null?void 0:n.level)||1,se=(n==null?void 0:n.currentStreak)||0,ce=fO($),he=mO(se),ve=()=>p?NJ[u]||NJ.de:(n==null?void 0:n.username)||(n==null?void 0:n.displayName)||"du",ge=async()=>{k(!0),"vibrate"in navigator&&navigator.vibrate([20,10,30]),await new Promise(Ye=>setTimeout(Ye,1200)),k(!1),G===0?s("/discover",{state:{createRoom:!0}}):x(!0)},qe=Ye=>{x(!1),s("/discover",{state:{joinRoom:!0,mode:Ye}}),"vibrate"in navigator&&navigator.vibrate([30,20,50])};return o.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-violet-100 via-purple-50 to-pink-50 safe-top pb-24",children:[o.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[o.jsx("div",{className:"absolute top-0 right-0 w-96 h-96 bg-gradient-to-br from-violet-300/30 to-purple-400/20 rounded-full blur-3xl"}),o.jsx("div",{className:"absolute bottom-40 left-0 w-80 h-80 bg-gradient-to-tr from-pink-300/20 to-violet-300/20 rounded-full blur-3xl"}),o.jsx("div",{className:"absolute top-1/3 right-1/4 w-64 h-64 bg-gradient-to-r from-cyan-200/20 to-purple-200/20 rounded-full blur-2xl"})]}),o.jsxs("div",{className:"relative z-10 px-6 pt-6 pb-4",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(zRe,{onToggle:g}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("button",{onClick:()=>s("/notifications"),className:"relative w-10 h-10 rounded-xl bg-white/80 backdrop-blur-sm shadow-sm flex items-center justify-center text-gray-600 hover:text-violet-600 transition-colors",children:[o.jsx(Xc,{size:20}),ae>0&&o.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center",children:ae>9?"9+":ae})]}),o.jsx("button",{onClick:()=>s("/settings"),className:"w-10 h-10 rounded-xl bg-white/80 backdrop-blur-sm shadow-sm flex items-center justify-center text-gray-600 hover:text-violet-600 transition-colors",children:o.jsx(QS,{size:20})})]})]}),o.jsxs("div",{className:"mt-4",children:[o.jsx("h1",{className:"font-display text-2xl font-bold text-gray-900",children:p?o.jsxs(o.Fragment,{children:["Hallo, ",ve()," "]}):o.jsxs(o.Fragment,{children:["Hey @",ve(),"! "]})}),o.jsxs("p",{className:"text-sm text-gray-500 flex items-center gap-2",children:[o.jsxs("span",{children:[ce.emoji," Level ",$]}),he>1&&o.jsxs("span",{className:"text-amber-500 font-semibold",children:[" ",he,"x XP"]})]})]})]}),se>=2&&o.jsx("div",{className:"relative z-10 px-6 mb-4",children:o.jsx(GRe,{currentStreak:se,longestStreak:(n==null?void 0:n.longestStreak)||se,canClaim:!1})}),ee.length>0&&o.jsx("div",{className:"relative z-10 px-6 mb-4",children:o.jsx("button",{onClick:()=>s("/discover",{state:{filter:"stars"}}),className:"w-full",children:o.jsxs("div",{className:"relative bg-gradient-to-r from-purple-900/90 to-pink-900/90 rounded-2xl p-3 border border-purple-500/30 overflow-hidden",children:[o.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_top_left,_var(--tw-gradient-stops))] from-purple-500/30 via-transparent to-transparent animate-pulse"}),o.jsxs("div",{className:"relative flex items-center gap-3",children:[o.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-red-500/20 rounded-full",children:[o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-ping absolute"}),o.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full relative"})]}),o.jsx("span",{className:"text-[10px] font-bold text-red-400",children:"LIVE"})]}),o.jsx("div",{className:"flex-1 min-w-0",children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(vy,{tier:((Dt=ee[A])==null?void 0:Dt.starTier)||"nebula",size:"sm",animated:!1}),o.jsx("p",{className:"text-sm font-semibold text-white truncate",children:(gt=ee[A])==null?void 0:gt.title})]})}),o.jsx(As,{size:20,className:"text-gray-400"})]})]})})}),o.jsx("div",{className:"relative z-10 px-6 mb-6",children:o.jsx("button",{onClick:ge,disabled:C||!l,className:"relative w-full",children:o.jsxs("div",{className:"bg-gradient-to-br from-violet-500 via-purple-500 to-pink-500 rounded-3xl p-6 shadow-2xl shadow-violet-500/30 overflow-hidden",children:[o.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-white/20 via-transparent to-transparent"}),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent -translate-x-full animate-shimmer"}),o.jsxs("div",{className:"relative flex items-center gap-4",children:[o.jsx("div",{className:`w-20 h-20 rounded-2xl bg-white/20 backdrop-blur-sm flex items-center justify-center ${C?"animate-pulse":""}`,children:C?o.jsx(Br,{size:36,className:"text-white animate-spin"}):o.jsx("span",{className:"text-5xl",children:""})}),o.jsxs("div",{className:"flex-1 text-left",children:[o.jsx("h2",{className:"font-display text-2xl font-bold text-white",children:C?"Suche...":"Quick Start"}),o.jsx("p",{className:"text-white/80 text-sm",children:C?"Verbinde dich mit einem Wlkchen":G>0?`${G} aktiv in deiner Nhe`:"Starte ein neues Wlkchen"})]}),o.jsx("div",{className:"w-12 h-12 rounded-full bg-white/20 flex items-center justify-center",children:o.jsx(Ei,{size:24,className:"text-white"})})]}),o.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[o.jsx("div",{className:"flex items-center gap-2",children:l?G>0?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),o.jsx("span",{className:"text-xs text-white/80",children:"Cloud aktiv"})]}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),o.jsx("span",{className:"text-xs text-white/80",children:"Niemand in der Nhe"})]}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-2 h-2 bg-orange-400 rounded-full animate-pulse"}),o.jsx("span",{className:"text-xs text-white/80",children:"Standort wird ermittelt..."})]})}),o.jsxs("div",{className:"flex items-center gap-1 text-white/60",children:[o.jsx(_c,{size:12}),o.jsx("span",{className:"text-xs",children:"500m Radius"})]})]})]})})}),o.jsxs("div",{className:"relative z-10 px-6 mb-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"w-8 h-8 rounded-lg bg-cyan-100 flex items-center justify-center",children:o.jsx(_c,{size:16,className:"text-cyan-600"})}),o.jsx("h3",{className:"font-display font-bold text-gray-900",children:"In deiner Nhe"})]}),o.jsxs("span",{className:"text-xs text-gray-400",children:[G," online"]})]}),X.length>0?o.jsx("div",{className:"grid grid-cols-3 gap-3",children:X.map(Ye=>o.jsxs("button",{onClick:()=>s(`/user/${Ye.id}`),className:"bg-white/80 backdrop-blur-sm rounded-2xl p-3 text-center hover:shadow-md transition-all",children:[o.jsx("div",{className:"w-12 h-12 mx-auto rounded-full bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center text-white font-bold text-lg mb-2",children:Ye.avatar?o.jsx("img",{src:Ye.avatar,alt:"",className:"w-full h-full rounded-full object-cover"}):Ye.displayName.charAt(0).toUpperCase()}),o.jsxs("p",{className:"text-xs font-medium text-gray-900 truncate",children:["@",Ye.username]}),o.jsxs("p",{className:"text-[10px] text-gray-400",children:["Level ",Ye.level]})]},Ye.id))}):o.jsxs("div",{className:"bg-white/60 backdrop-blur-sm rounded-2xl p-6 text-center",children:[o.jsx(Ju,{delay:0,children:o.jsx(ZS,{size:80,className:"mx-auto mb-2"})}),o.jsx("p",{className:"text-sm text-gray-500",children:"Noch niemand in deiner Nhe entdeckt"})]})]}),o.jsxs("div",{className:"relative z-10 px-6 mb-6",children:[o.jsx("div",{className:"flex items-center justify-between mb-3",children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"w-8 h-8 rounded-lg bg-violet-100 flex items-center justify-center",children:o.jsx(Ta,{size:16,className:"text-violet-600"})}),o.jsx("h3",{className:"font-display font-bold text-gray-900",children:"Profilbesucher"}),!Q&&o.jsxs("div",{className:"flex items-center gap-1 px-2 py-0.5 bg-amber-100 rounded-full",children:[o.jsx(hs,{size:10,className:"text-amber-600"}),o.jsx("span",{className:"text-[10px] text-amber-700 font-semibold",children:"Premium"})]})]})}),Q?q.length>0?o.jsx("div",{className:"grid grid-cols-3 gap-3",children:q.map(Ye=>o.jsxs("button",{onClick:()=>s(`/user/${Ye.id}`),className:"bg-white/80 backdrop-blur-sm rounded-2xl p-3 text-center hover:shadow-md transition-all",children:[o.jsx("div",{className:"w-12 h-12 mx-auto rounded-full bg-gradient-to-br from-violet-400 to-purple-500 flex items-center justify-center text-white font-bold text-lg mb-2",children:Ye.avatar?o.jsx("img",{src:Ye.avatar,alt:"",className:"w-full h-full rounded-full object-cover"}):Ye.displayName.charAt(0).toUpperCase()}),o.jsxs("p",{className:"text-xs font-medium text-gray-900 truncate",children:["@",Ye.username]}),o.jsxs("p",{className:"text-[10px] text-gray-400 flex items-center justify-center gap-1",children:[o.jsx(Gi,{size:8}),XRe(Ye.visitedAt)]})]},Ye.id))}):o.jsxs("div",{className:"bg-white/60 backdrop-blur-sm rounded-2xl p-6 text-center",children:[o.jsx(Ta,{size:32,className:"mx-auto mb-2 text-gray-300"}),o.jsx("p",{className:"text-sm text-gray-500",children:"Noch keine Besucher"})]}):o.jsx("button",{onClick:()=>s("/premium"),className:"w-full bg-gradient-to-br from-violet-100 to-purple-100 rounded-2xl p-4 border-2 border-dashed border-violet-200 hover:border-violet-400 transition-colors",children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"w-12 h-12 rounded-xl bg-violet-200 flex items-center justify-center",children:o.jsx(Hi,{size:20,className:"text-violet-600"})}),o.jsxs("div",{className:"text-left flex-1",children:[o.jsx("p",{className:"font-semibold text-gray-900",children:"Wer hat dein Profil besucht?"}),o.jsx("p",{className:"text-xs text-gray-500",children:"Mit Premium siehst du alle Besucher"})]}),o.jsx(hs,{size:20,className:"text-amber-500"})]})})]}),o.jsx("div",{className:"relative z-10 px-6 mb-4",children:o.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[o.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-4 text-center shadow-sm",children:[o.jsx("p",{className:"font-display text-2xl font-bold bg-gradient-to-r from-violet-600 to-purple-600 bg-clip-text text-transparent",children:$}),o.jsx("p",{className:"text-[10px] text-gray-500",children:"Level"})]}),o.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-4 text-center shadow-sm",children:[o.jsx("p",{className:"font-display text-2xl font-bold text-amber-500",children:(n==null?void 0:n.xp)||0}),o.jsx("p",{className:"text-[10px] text-gray-500",children:"XP"})]}),o.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-4 text-center shadow-sm",children:[o.jsx("p",{className:"font-display text-2xl font-bold text-green-600",children:(n==null?void 0:n.totalStarsReceived)||0}),o.jsx("p",{className:"text-[10px] text-gray-500",children:"Sterne"})]})]})}),!Q&&o.jsx("div",{className:"relative z-10 px-6 mb-4",children:o.jsxs("button",{onClick:()=>s("/premium"),className:"relative w-full overflow-hidden bg-gradient-to-r from-amber-400 via-orange-500 to-amber-500 rounded-2xl p-5 shadow-lg text-left",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full animate-shimmer"}),o.jsxs("div",{className:"relative flex items-center gap-4",children:[o.jsx("div",{className:"w-14 h-14 rounded-2xl bg-white/20 backdrop-blur flex items-center justify-center",children:o.jsx(hs,{size:28,className:"text-white"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"font-display font-bold text-white text-lg",children:"Catalyst Premium"}),o.jsx("p",{className:"text-white/80 text-sm",children:"1.5x XP  Profilbesucher  mehr"})]})]})]})}),i&&o.jsx("div",{className:"relative z-10 px-6 mb-4",children:o.jsx("button",{onClick:()=>s("/stars/dashboard"),className:"w-full bg-gradient-to-r from-amber-500/20 to-orange-500/20 border border-amber-500/30 rounded-2xl p-4 text-left",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center",children:o.jsx(lk,{size:24,className:"text-white"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"font-semibold text-gray-900",children:"Dein Star Dashboard"}),o.jsx("p",{className:"text-xs text-gray-500",children:"Analytics, Events & mehr"})]}),o.jsx(As,{size:20,className:"text-gray-400"})]})})}),o.jsx("div",{className:"relative z-10 px-6 mb-4",children:o.jsxs("button",{onClick:()=>s("/statistics"),className:"w-full bg-white/80 backdrop-blur-sm rounded-2xl p-4 flex items-center gap-3 shadow-sm hover:shadow-md transition-all",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-violet-100 flex items-center justify-center",children:o.jsx(im,{size:20,className:"text-violet-600"})}),o.jsxs("div",{className:"flex-1 text-left",children:[o.jsx("p",{className:"font-semibold text-gray-900",children:"Deine Statistiken"}),o.jsx("p",{className:"text-xs text-gray-500",children:"XP, Level, Aktivitt & mehr"})]}),o.jsx(As,{size:20,className:"text-gray-400"})]})}),o.jsx(WRe,{isOpen:y,onClose:()=>x(!1),onChoose:qe,chatType:"voice",targetName:"zuflligen Raum"})]})};function XRe(s){const n=Math.floor((new Date().getTime()-s.getTime())/1e3);return n<60?"gerade eben":n<3600?`${Math.floor(n/60)}m`:n<86400?`${Math.floor(n/3600)}h`:`${Math.floor(n/86400)}d`}var zre={exports:{}};(function(s,n){(function(i,l){s.exports=l()})(Gh,function(){function i(e,t){return t.forEach(function(r){r&&typeof r!="string"&&!Array.isArray(r)&&Object.keys(r).forEach(function(a){if(a!=="default"&&!(a in e)){var c=Object.getOwnPropertyDescriptor(r,a);Object.defineProperty(e,a,c.get?c:{enumerable:!0,get:function(){return r[a]}})}})}),Object.freeze(e)}var l=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Gh<"u"?Gh:typeof self<"u"?self:{};function u(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var p=function(e){try{return!!e()}catch{return!0}},g=!p(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),y=g,x=Function.prototype,C=x.call,k=y&&x.bind.bind(C,C),A=y?k:function(e){return function(){return C.apply(e,arguments)}},M=A({}.isPrototypeOf),G=function(e){return e&&e.Math===Math&&e},B=G(typeof globalThis=="object"&&globalThis)||G(typeof window=="object"&&window)||G(typeof self=="object"&&self)||G(typeof l=="object"&&l)||G(typeof l=="object"&&l)||function(){return this}()||Function("return this")(),X=g,Z=Function.prototype,q=Z.apply,V=Z.call,ee=typeof Reflect=="object"&&Reflect.apply||(X?V.bind(q):function(){return V.apply(q,arguments)}),de=A,ae=de({}.toString),ye=de("".slice),Q=function(e){return ye(ae(e),8,-1)},$=Q,se=A,ce=function(e){if($(e)==="Function")return se(e)},he=typeof document=="object"&&document.all,ve=he===void 0&&he!==void 0?function(e){return typeof e=="function"||e===he}:function(e){return typeof e=="function"},ge={},qe=!p(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),Dt=g,gt=Function.prototype.call,Ye=Dt?gt.bind(gt):function(){return gt.apply(gt,arguments)},ze={},ut={}.propertyIsEnumerable,yt=Object.getOwnPropertyDescriptor,Xt=yt&&!ut.call({1:2},1);ze.f=Xt?function(e){var t=yt(this,e);return!!t&&t.enumerable}:ut;var jt,Gt,mn=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Pt=p,Jt=Q,He=Object,bt=A("".split),Wt=Pt(function(){return!He("z").propertyIsEnumerable(0)})?function(e){return Jt(e)==="String"?bt(e,""):He(e)}:He,gn=function(e){return e==null},xt=gn,Sn=TypeError,cr=function(e){if(xt(e))throw new Sn("Can't call method on "+e);return e},Or=Wt,ms=cr,Oi=function(e){return Or(ms(e))},xi=ve,Gr=function(e){return typeof e=="object"?e!==null:xi(e)},qt={},Jr=qt,Ht=B,wi=ve,Cs=function(e){return wi(e)?e:void 0},gr=function(e,t){return arguments.length<2?Cs(Jr[e])||Cs(Ht[e]):Jr[e]&&Jr[e][t]||Ht[e]&&Ht[e][t]},Za=B.navigator,es=Za&&Za.userAgent,Sr=es?String(es):"",Ki=B,Go=Sr,vc=Ki.process,Ec=Ki.Deno,Ve=vc&&vc.versions||Ec&&Ec.version,Qt=Ve&&Ve.v8;Qt&&(Gt=(jt=Qt.split("."))[0]>0&&jt[0]<4?1:+(jt[0]+jt[1])),!Gt&&Go&&(!(jt=Go.match(/Edge\/(\d+)/))||jt[1]>=74)&&(jt=Go.match(/Chrome\/(\d+)/))&&(Gt=+jt[1]);var _n=Gt,Qe=_n,Bt=p,Ct=B.String,sn=!!Object.getOwnPropertySymbols&&!Bt(function(){var e=Symbol("symbol detection");return!Ct(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Qe&&Qe<41}),Qn=sn&&!Symbol.sham&&typeof Symbol.iterator=="symbol",qn=gr,Bs=ve,qd=M,Xl=Object,bo=Qn?function(e){return typeof e=="symbol"}:function(e){var t=qn("Symbol");return Bs(t)&&qd(t.prototype,Xl(e))},F_=String,yc=function(e){try{return F_(e)}catch{return"Object"}},vm=ve,ih=yc,B_=TypeError,Wr=function(e){if(vm(e))return e;throw new B_(ih(e)+" is not a function")},gp=Wr,ah=gn,xo=function(e,t){var r=e[t];return ah(r)?void 0:gp(r)},z_=Ye,G_=ve,$l=Gr,Vy=TypeError,W_={exports:{}},oh=B,H_=Object.defineProperty,Em=B,ch=function(e,t){try{H_(oh,e,{value:t,configurable:!0,writable:!0})}catch{oh[e]=t}return t},bc="__core-js_shared__",ym=W_.exports=Em[bc]||ch(bc,{});(ym.versions||(ym.versions=[])).push({version:"3.46.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.46.0/LICENSE",source:"https://github.com/zloirock/core-js"});var _p=W_.exports,vp=_p,rl=function(e,t){return vp[e]||(vp[e]=t||{})},K_=cr,lh=Object,Wo=function(e){return lh(K_(e))},Jl=Wo,q_=A({}.hasOwnProperty),Ns=Object.hasOwn||function(e,t){return q_(Jl(e),t)},dh=A,sl=0,Ep=Math.random(),Y_=dh(1.1.toString),yp=function(e){return"Symbol("+(e===void 0?"":e)+")_"+Y_(++sl+Ep,36)},X_=rl,bm=Ns,xm=yp,bp=sn,wm=Qn,il=B.Symbol,uh=X_("wks"),Fy=wm?il.for||il:il&&il.withoutSetter||xm,Nr=function(e){return bm(uh,e)||(uh[e]=bp&&bm(il,e)?il[e]:Fy("Symbol."+e)),uh[e]},hh=Ye,Sm=Gr,al=bo,Ho=xo,ph=function(e,t){var r,a;if(G_(r=e.toString)&&!$l(a=z_(r,e))||G_(r=e.valueOf)&&!$l(a=z_(r,e)))return a;throw new Vy("Can't convert object to primitive value")},Yd=TypeError,$_=Nr("toPrimitive"),ts=function(e,t){if(!Sm(e)||al(e))return e;var r,a=Ho(e,$_);if(a){if(r=hh(a,e,t),!Sm(r)||al(r))return r;throw new Yd("Can't convert object to primitive value")}return ph(e)},Xd=bo,xc=function(e){var t=ts(e,"string");return Xd(t)?t:t+""},wo=Gr,xp=B.document,Tm=wo(xp)&&wo(xp.createElement),Rm=function(e){return Tm?xp.createElement(e):{}},J_=Rm,Cm=!qe&&!p(function(){return Object.defineProperty(J_("div"),"a",{get:function(){return 7}}).a!==7}),Q_=qe,$d=Ye,ol=ze,Z_=mn,e0=Oi,Nm=xc,Jd=Ns,By=Cm,t0=Object.getOwnPropertyDescriptor;ge.f=Q_?t0:function(e,t){if(e=e0(e),t=Nm(t),By)try{return t0(e,t)}catch{}if(Jd(e,t))return Z_(!$d(ol.f,e,t),e[t])};var zy=p,Ko=ve,Gy=/#|\.prototype\./,fh=function(e,t){var r=Sp[wp(e)];return r===Dr||r!==n0&&(Ko(t)?zy(t):!!t)},wp=fh.normalize=function(e){return String(e).replace(Gy,".").toLowerCase()},Sp=fh.data={},n0=fh.NATIVE="N",Dr=fh.POLYFILL="P",Tr=fh,r0=Wr,Im=g,Is=ce(ce.bind),cl=function(e,t){return r0(e),t===void 0?e:Im?Is(e,t):function(){return e.apply(t,arguments)}},eo={},Am=qe&&p(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),km=Gr,s0=String,zs=TypeError,hi=function(e){if(km(e))return e;throw new zs(s0(e)+" is not an object")},qi=qe,Om=Cm,Dm=Am,ei=hi,Tp=xc,Rp=TypeError,Ql=Object.defineProperty,Pm=Object.getOwnPropertyDescriptor,Zl="enumerable",Cp="configurable",Di="writable";eo.f=qi?Dm?function(e,t,r){if(ei(e),t=Tp(t),ei(r),typeof e=="function"&&t==="prototype"&&"value"in r&&Di in r&&!r[Di]){var a=Pm(e,t);a&&a[Di]&&(e[t]=r.value,r={configurable:Cp in r?r[Cp]:a[Cp],enumerable:Zl in r?r[Zl]:a[Zl],writable:!1})}return Ql(e,t,r)}:Ql:function(e,t,r){if(ei(e),t=Tp(t),ei(r),Om)try{return Ql(e,t,r)}catch{}if("get"in r||"set"in r)throw new Rp("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var mh=eo,Ra=mn,ll=qe?function(e,t,r){return mh.f(e,t,Ra(1,r))}:function(e,t,r){return e[t]=r,e},dl=B,qo=ee,gh=ce,Qd=ve,os=ge.f,wc=Tr,ia=qt,i0=cl,Sc=ll,Lm=Ns,a0=function(e){var t=function(r,a,c){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,a)}return new e(r,a,c)}return qo(e,this,arguments)};return t.prototype=e.prototype,t},vn=function(e,t){var r,a,c,d,h,f,m,v,E,w=e.target,S=e.global,R=e.stat,j=e.proto,D=S?dl:R?dl[w]:dl[w]&&dl[w].prototype,P=S?ia:ia[w]||Sc(ia,w,{})[w],W=P.prototype;for(d in t)a=!(r=wc(S?d:w+(R?".":"#")+d,e.forced))&&D&&Lm(D,d),f=P[d],a&&(m=e.dontCallGetSet?(E=os(D,d))&&E.value:D[d]),h=a&&m?m:t[d],(r||j||typeof f!=typeof h)&&(v=e.bind&&a?i0(h,dl):e.wrap&&a?a0(h):j&&Qd(h)?gh(h):h,(e.sham||h&&h.sham||f&&f.sham)&&Sc(v,"sham",!0),Sc(P,d,v),j&&(Lm(ia,c=w+"Prototype")||Sc(ia,c,{}),Sc(ia[c],d,h),e.real&&W&&(r||!W[d])&&Sc(W,d,h)))},aa=Math.ceil,_h=Math.floor,ed=Math.trunc||function(e){var t=+e;return(t>0?_h:aa)(t)},Zd=ed,T=function(e){var t=+e;return t!=t||t===0?0:Zd(t)},F=T,J=Math.max,me=Math.min,Oe=function(e,t){var r=F(e);return r<0?J(r+t,0):me(r,t)},We=T,vt=Math.min,Ir=function(e){var t=We(e);return t>0?vt(t,9007199254740991):0},Si=Ir,Vn=function(e){return Si(e.length)},Hr=Oi,pi=Oe,Yo=Vn,Ca=function(e){return function(t,r,a){var c=Hr(t),d=Yo(c);if(d===0)return!e&&-1;var h,f=pi(a,d);if(e&&r!=r){for(;d>f;)if((h=c[f++])!=h)return!0}else for(;d>f;f++)if((e||f in c)&&c[f]===r)return e||f||0;return!e&&-1}},td={includes:Ca(!0),indexOf:Ca(!1)},jm=td.includes;vn({target:"Array",proto:!0,forced:p(function(){return!Array(1).includes()})},{includes:function(e){return jm(this,e,arguments.length>1?arguments[1]:void 0)}});var bO=B,xO=qt,So=function(e,t){var r=xO[e+"Prototype"],a=r&&r[t];if(a)return a;var c=bO[e],d=c&&c.prototype;return d&&d[t]},wO=So("Array","includes"),Np=Gr,SO=Q,TO=Nr("match"),Mm=function(e){var t;return Np(e)&&((t=e[TO])!==void 0?!!t:SO(e)==="RegExp")},IT=Mm,eu=TypeError,Um={};Um[Nr("toStringTag")]="z";var Wy=String(Um)==="[object z]",RO=Wy,CO=ve,nd=Q,Tc=Nr("toStringTag"),AT=Object,NO=nd(function(){return arguments}())==="Arguments",tu=RO?nd:function(e){var t,r,a;return e===void 0?"Undefined":e===null?"Null":typeof(r=function(c,d){try{return c[d]}catch{}}(t=AT(e),Tc))=="string"?r:NO?nd(t):(a=nd(t))==="Object"&&CO(t.callee)?"Arguments":a},IO=tu,AO=String,Na=function(e){if(IO(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return AO(e)},Ip=Nr("match"),Ie=vn,$e=function(e){if(IT(e))throw new eu("The method doesn't accept regular expressions");return e},Ge=cr,Mt=Na,On=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[Ip]=!1,"/./"[e](t)}catch{}}return!1},Pr=A("".indexOf);Ie({target:"String",proto:!0,forced:!On("includes")},{includes:function(e){return!!~Pr(Mt(Ge(this)),Mt($e(e)),arguments.length>1?arguments[1]:void 0)}});var Ti=So("String","includes"),ns=M,Hy=wO,kO=Ti,to=Array.prototype,Ap=String.prototype,OO=function(e){var t=e.includes;return e===to||ns(to,e)&&t===to.includes?Hy:typeof e=="string"||e===Ap||ns(Ap,e)&&t===Ap.includes?kO:t},ke=u(OO),o0=Wr,c0=Wo,Kr=Wt,DO=Vn,Ky=TypeError,Vm="Reduce of empty array with no initial value",PO=function(e){return function(t,r,a,c){var d=c0(t),h=Kr(d),f=DO(d);if(o0(r),f===0&&a<2)throw new Ky(Vm);var m=e?f-1:0,v=e?-1:1;if(a<2)for(;;){if(m in h){c=h[m],m+=v;break}if(m+=v,e?m<0:f<=m)throw new Ky(Vm)}for(;e?m>=0:f>m;m+=v)m in h&&(c=r(c,h[m],m,d));return c}},LO={left:PO(!1)},jO=p,vh=function(e,t){var r=[][e];return!!r&&jO(function(){r.call(null,t||function(){return 1},1)})},Xo=B,l0=Sr,kT=Q,Eh=function(e){return l0.slice(0,e.length)===e},d0=Eh("Bun/")?"BUN":Eh("Cloudflare-Workers")?"CLOUDFLARE":Eh("Deno/")?"DENO":Eh("Node.js/")?"NODE":Xo.Bun&&typeof Bun.version=="string"?"BUN":Xo.Deno&&typeof Deno.version=="object"?"DENO":kT(Xo.process)==="process"?"NODE":Xo.window&&Xo.document?"BROWSER":"REST",Fm=d0==="NODE",u0=LO.left;vn({target:"Array",proto:!0,forced:!Fm&&_n>79&&_n<83||!vh("reduce")},{reduce:function(e){var t=arguments.length;return u0(this,e,t,t>1?arguments[1]:void 0)}});var OT=So("Array","reduce"),Bm=M,yh=OT,kp=Array.prototype,MO=function(e){var t=e.reduce;return e===kp||Bm(kp,e)&&t===kp.reduce?yh:t},DT=MO,To=u(DT),h0=Q,nu=Array.isArray||function(e){return h0(e)==="Array"},qy=vn,UO=nu,PT=A([].reverse),LT=[1,2];qy({target:"Array",proto:!0,forced:String(LT)===String(LT.reverse())},{reverse:function(){return UO(this)&&(this.length=this.length),PT(this)}});var VO=So("Array","reverse"),Ri=M,oa=VO,Yy=Array.prototype,FO=function(e){var t=e.reverse;return e===Yy||Ri(Yy,e)&&t===Yy.reverse?oa:t},Xy=FO,jT=u(Xy),$y=yp,Op=rl("keys"),Dp=function(e){return Op[e]||(Op[e]=$y(e))},Pp=!p(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),zm=Ns,Gm=ve,p0=Wo,Lp=Pp,MT=Dp("IE_PROTO"),Jy=Object,BO=Jy.prototype,Qy=Lp?Jy.getPrototypeOf:function(e){var t=p0(e);if(zm(t,MT))return t[MT];var r=t.constructor;return Gm(r)&&t instanceof r?r.prototype:t instanceof Jy?BO:null},zO=A,f0=Wr,Wm=Gr,UT=function(e){return Wm(e)||e===null},ue=String,jp=TypeError,m0=function(e,t,r){try{return zO(f0(Object.getOwnPropertyDescriptor(e,t)[r]))}catch{}},$o=Gr,lr=cr,GO=function(e){if(UT(e))return e;throw new jp("Can't set "+ue(e)+" as a prototype")},WO=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=m0(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch{}return function(a,c){return lr(a),GO(c),$o(a)&&(t?e(a,c):a.__proto__=c),a}}():void 0),g0={},ul={},Zy=Ns,HO=Oi,KO=td.indexOf,qO=ul,VT=A([].push),hl=function(e,t){var r,a=HO(e),c=0,d=[];for(r in a)!Zy(qO,r)&&Zy(a,r)&&VT(d,r);for(;t.length>c;)Zy(a,r=t[c++])&&(~KO(d,r)||VT(d,r));return d},eb=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],YO=hl,XO=eb.concat("length","prototype");g0.f=Object.getOwnPropertyNames||function(e){return YO(e,XO)};var Hm={};Hm.f=Object.getOwnPropertySymbols;var $O=gr,rd=g0,JO=Hm,QO=hi,ZO=A([].concat),eD=$O("Reflect","ownKeys")||function(e){var t=rd.f(QO(e)),r=JO.f;return r?ZO(t,r(e)):t},FT=Ns,bh=eD,tD=ge,nD=eo,Ro={},rD=hl,sD=eb,_0=Object.keys||function(e){return rD(e,sD)},iD=qe,aD=Am,BT=eo,zT=hi,oD=Oi,cD=_0;Ro.f=iD&&!aD?Object.defineProperties:function(e,t){zT(e);for(var r,a=oD(t),c=cD(t),d=c.length,h=0;d>h;)BT.f(e,r=c[h++],a[r]);return e};var Mp,Up=gr("document","documentElement"),v0=hi,lD=Ro,tb=eb,dD=ul,sd=Up,nb=Rm,id="prototype",no="script",GT=Dp("IE_PROTO"),E0=function(){},rb=function(e){return"<"+no+">"+e+"</"+no+">"},Vp=function(e){e.write(rb("")),e.close();var t=e.parentWindow.Object;return e=null,t},Rc=function(){try{Mp=new ActiveXObject("htmlfile")}catch{}var e,t,r;Rc=typeof document<"u"?document.domain&&Mp?Vp(Mp):(t=nb("iframe"),r="java"+no+":",t.style.display="none",sd.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(rb("document.F=Object")),e.close(),e.F):Vp(Mp);for(var a=tb.length;a--;)delete Rc[id][tb[a]];return Rc()};dD[GT]=!0;var Fp=Object.create||function(e,t){var r;return e!==null?(E0[id]=v0(e),r=new E0,E0[id]=null,r[GT]=e):r=Rc(),t===void 0?r:lD.f(r,t)},uD=Gr,y0=ll,WT=Error,HT=A("".replace),Yi=String(new WT("zxcasd").stack),b0=/\n\s*at [^:]*:[^\n]*/,KT=b0.test(Yi),pl=mn,sb=!p(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",pl(1,7)),e.stack!==7)}),x0=ll,xh=function(e,t){if(KT&&typeof e=="string"&&!WT.prepareStackTrace)for(;t--;)e=HT(e,b0,"");return e},qT=sb,ca=Error.captureStackTrace,ru={},hD=ru,pD=Nr("iterator"),fD=Array.prototype,w0=function(e){return e!==void 0&&(hD.Array===e||fD[pD]===e)},mD=tu,Bp=xo,YT=gn,gD=ru,_D=Nr("iterator"),su=function(e){if(!YT(e))return Bp(e,_D)||Bp(e,"@@iterator")||gD[mD(e)]},vD=Ye,ED=Wr,ib=hi,XT=yc,yD=su,bD=TypeError,ab=function(e,t){var r=arguments.length<2?yD(e):t;if(ED(r))return ib(vD(r,e));throw new bD(XT(e)+" is not iterable")},$T=Ye,S0=hi,xD=xo,T0=function(e,t,r){var a,c;S0(e);try{if(!(a=xD(e,"return"))){if(t==="throw")throw r;return r}a=$T(a,e)}catch(d){c=!0,a=d}if(t==="throw")throw r;if(c)throw a;return S0(a),r},JT=cl,QT=Ye,ZT=hi,R0=yc,wD=w0,eR=Vn,ob=M,SD=ab,tR=su,nR=T0,cb=TypeError,Km=function(e,t){this.stopped=e,this.result=t},C0=Km.prototype,qm=function(e,t,r){var a,c,d,h,f,m,v,E=r&&r.that,w=!(!r||!r.AS_ENTRIES),S=!(!r||!r.IS_RECORD),R=!(!r||!r.IS_ITERATOR),j=!(!r||!r.INTERRUPTED),D=JT(t,E),P=function(Y){return a&&nR(a,"normal"),new Km(!0,Y)},W=function(Y){return w?(ZT(Y),j?D(Y[0],Y[1],P):D(Y[0],Y[1])):j?D(Y,P):D(Y)};if(S)a=e.iterator;else if(R)a=e;else{if(!(c=tR(e)))throw new cb(R0(e)+" is not iterable");if(wD(c)){for(d=0,h=eR(e);h>d;d++)if((f=W(e[d]))&&ob(C0,f))return f;return new Km(!1)}a=SD(e,c)}for(m=S?e.next:a.next;!(v=QT(m,a)).done;){try{f=W(v.value)}catch(Y){nR(a,"throw",Y)}if(typeof f=="object"&&f&&ob(C0,f))return f}return new Km(!1)},lb=Na,Zn=vn,TD=M,RD=Qy,iu=WO,rR=function(e,t,r){for(var a=bh(t),c=nD.f,d=tD.f,h=0;h<a.length;h++){var f=a[h];FT(e,f)||r&&FT(r,f)||c(e,f,d(t,f))}},sR=Fp,db=ll,ro=mn,CD=function(e,t){uD(t)&&"cause"in t&&y0(e,"cause",t.cause)},N0=function(e,t,r,a){qT&&(ca?ca(e,t):x0(e,"stack",xh(r,a)))},ub=qm,iR=function(e,t){return e===void 0?arguments.length<2?"":t:lb(e)},aR=Nr("toStringTag"),la=Error,au=[].push,ou=function(e,t){var r,a=TD(I0,this);iu?r=iu(new la,a?RD(this):I0):(r=a?this:sR(I0),db(r,aR,"Error")),t!==void 0&&db(r,"message",iR(t)),N0(r,ou,r.stack,1),arguments.length>2&&CD(r,arguments[2]);var c=[];return ub(e,au,{that:c}),db(r,"errors",c),r};iu?iu(ou,la):rR(ou,la,{name:!0});var I0=ou.prototype=sR(la.prototype,{constructor:ro(1,ou),message:ro(1,""),name:ro(1,"AggregateError")});Zn({global:!0},{AggregateError:ou});var wh,zp,Gp,oR=ve,A0=B.WeakMap,hb=oR(A0)&&/native code/.test(String(A0)),ad=B,ND=Gr,cu=ll,k0=Ns,O0=_p,pb=Dp,ID=ul,cR="Object already initialized",fb=ad.TypeError,lR=ad.WeakMap;if(hb||O0.state){var Cc=O0.state||(O0.state=new lR);Cc.get=Cc.get,Cc.has=Cc.has,Cc.set=Cc.set,wh=function(e,t){if(Cc.has(e))throw new fb(cR);return t.facade=e,Cc.set(e,t),t},zp=function(e){return Cc.get(e)||{}},Gp=function(e){return Cc.has(e)}}else{var Wp=pb("state");ID[Wp]=!0,wh=function(e,t){if(k0(e,Wp))throw new fb(cR);return t.facade=e,cu(e,Wp,t),t},zp=function(e){return k0(e,Wp)?e[Wp]:{}},Gp=function(e){return k0(e,Wp)}}var lu,mb,Ia,da={set:wh,get:zp,has:Gp,enforce:function(e){return Gp(e)?zp(e):wh(e,{})},getterFor:function(e){return function(t){var r;if(!ND(t)||(r=zp(t)).type!==e)throw new fb("Incompatible receiver, "+e+" required");return r}}},gb=qe,AD=Ns,Ym=Function.prototype,Hp=gb&&Object.getOwnPropertyDescriptor,_b=AD(Ym,"name"),vb={PROPER:_b&&(function(){}).name==="something",CONFIGURABLE:_b&&(!gb||gb&&Hp(Ym,"name").configurable)},kD=ll,od=function(e,t,r,a){return a&&a.enumerable?e[t]=r:kD(e,t,r),e},Kp=p,Xm=ve,OD=Gr,dR=Fp,Eb=Qy,D0=od,P0=Nr("iterator"),$m=!1;[].keys&&("next"in(Ia=[].keys())?(mb=Eb(Eb(Ia)))!==Object.prototype&&(lu=mb):$m=!0);var yb=!OD(lu)||Kp(function(){var e={};return lu[P0].call(e)!==e});Xm((lu=yb?{}:dR(lu))[P0])||D0(lu,P0,function(){return this});var Jm={IteratorPrototype:lu,BUGGY_SAFARI_ITERATORS:$m},DD=tu,uR=Wy?{}.toString:function(){return"[object "+DD(this)+"]"},L0=Wy,hR=eo.f,bb=ll,PD=Ns,pR=uR,fl=Nr("toStringTag"),ml=function(e,t,r,a){var c=r?e:e&&e.prototype;c&&(PD(c,fl)||hR(c,fl,{configurable:!0,value:t}),a&&!L0&&bb(c,"toString",pR))},fR=Jm.IteratorPrototype,LD=Fp,mR=mn,jD=ml,MD=ru,cd=function(){return this},Qm=function(e,t,r,a){var c=t+" Iterator";return e.prototype=LD(fR,{next:mR(+!a,r)}),jD(e,c,!1,!0),MD[c]=cd,e},xb=vn,wb=Ye,j0=vb,qp=Qm,ln=Qy,M0=ml,U0=od,du=ru,UD=Jm,Sb=j0.PROPER,Zm=UD.BUGGY_SAFARI_ITERATORS,Pi=Nr("iterator"),gR="keys",V0="values",Tb="entries",VD=function(){return this},Rb=function(e,t,r,a,c,d,h){qp(r,t,a);var f,m,v,E=function(W){if(W===c&&D)return D;if(!Zm&&W&&W in R)return R[W];switch(W){case gR:case V0:case Tb:return function(){return new r(this,W)}}return function(){return new r(this)}},w=t+" Iterator",S=!1,R=e.prototype,j=R[Pi]||R["@@iterator"]||c&&R[c],D=!Zm&&j||E(c),P=t==="Array"&&R.entries||j;if(P&&(f=ln(P.call(new e)))!==Object.prototype&&f.next&&(M0(f,w,!0,!0),du[w]=VD),Sb&&c===V0&&j&&j.name!==V0&&(S=!0,D=function(){return wb(j,this)}),c)if(m={values:E(V0),keys:d?D:E(gR),entries:E(Tb)},h)for(v in m)(Zm||S||!(v in R))&&U0(R,v,m[v]);else xb({target:t,proto:!0,forced:Zm||S},m);return h&&R[Pi]!==D&&U0(R,Pi,D,{}),du[t]=D,m},F0=function(e,t){return{value:e,done:t}},FD=Oi,_R=ru,gl=da;eo.f;var Aa=Rb,Yp=F0,vR="Array Iterator",Cb=gl.set,BD=gl.getterFor(vR);Aa(Array,"Array",function(e,t){Cb(this,{type:vR,target:FD(e),index:0,kind:t})},function(){var e=BD(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=null,Yp(void 0,!0);switch(e.kind){case"keys":return Yp(r,!1);case"values":return Yp(t[r],!1)}return Yp([r,t[r]],!1)},"values"),_R.Arguments=_R.Array;var zD=eo,uu=function(e,t,r){return zD.f(e,t,r)},ER=gr,yR=uu,GD=qe,bR=Nr("species"),WD=M,HD=TypeError,B0=function(e,t){if(WD(t,e))return e;throw new HD("Incorrect invocation")},xR=ve,Nb=_p,Ib=A(Function.toString);xR(Nb.inspectSource)||(Nb.inspectSource=function(e){return Ib(e)});var Ab=Nb.inspectSource,eg=A,kb=p,Ob=ve,wR=tu,z0=Ab,Db=function(){},Nc=gr("Reflect","construct"),ld=/^\s*(?:class|function)\b/,KD=eg(ld.exec),SR=!ld.test(Db),tg=function(e){if(!Ob(e))return!1;try{return Nc(Db,[],e),!0}catch{return!1}},TR=function(e){if(!Ob(e))return!1;switch(wR(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return SR||!!KD(ld,z0(e))}catch{return!0}};TR.sham=!0;var ng,Xp,RR,Pb,G0=!Nc||kb(function(){var e;return tg(tg.call)||!tg(Object)||!tg(function(){e=!0})||e})?TR:tg,qD=G0,YD=yc,XD=TypeError,CR=hi,NR=function(e){if(qD(e))return e;throw new XD(YD(e)+" is not a constructor")},IR=gn,AR=Nr("species"),Lb=function(e,t){var r,a=CR(e).constructor;return a===void 0||IR(r=CR(a)[AR])?t:NR(r)},hu=A([].slice),$D=TypeError,pu=function(e,t){if(e<t)throw new $D("Not enough arguments");return e},kR=/(?:ipad|iphone|ipod).*applewebkit/i.test(Sr),Co=B,JD=ee,QD=cl,OR=ve,ZD=Ns,No=p,DR=Up,eP=hu,PR=Rm,LR=pu,tP=kR,nP=Fm,jb=Co.setImmediate,Mb=Co.clearImmediate,Ub=Co.process,Vb=Co.Dispatch,rP=Co.Function,jR=Co.MessageChannel,sP=Co.String,Fb=0,rg={},MR="onreadystatechange";No(function(){ng=Co.location});var Bb=function(e){if(ZD(rg,e)){var t=rg[e];delete rg[e],t()}},zb=function(e){return function(){Bb(e)}},UR=function(e){Bb(e.data)},VR=function(e){Co.postMessage(sP(e),ng.protocol+"//"+ng.host)};jb&&Mb||(jb=function(e){LR(arguments.length,1);var t=OR(e)?e:rP(e),r=eP(arguments,1);return rg[++Fb]=function(){JD(t,void 0,r)},Xp(Fb),Fb},Mb=function(e){delete rg[e]},nP?Xp=function(e){Ub.nextTick(zb(e))}:Vb&&Vb.now?Xp=function(e){Vb.now(zb(e))}:jR&&!tP?(Pb=(RR=new jR).port2,RR.port1.onmessage=UR,Xp=QD(Pb.postMessage,Pb)):Co.addEventListener&&OR(Co.postMessage)&&!Co.importScripts&&ng&&ng.protocol!=="file:"&&!No(VR)?(Xp=VR,Co.addEventListener("message",UR,!1)):Xp=MR in PR("script")?function(e){DR.appendChild(PR("script"))[MR]=function(){DR.removeChild(this),Bb(e)}}:function(e){setTimeout(zb(e),0)});var W0={set:jb,clear:Mb},FR=B,iP=qe,aP=Object.getOwnPropertyDescriptor,BR=function(e){if(!iP)return FR[e];var t=aP(FR,e);return t&&t.value},zR=function(){this.head=null,this.tail=null};zR.prototype={add:function(e){var t={item:e,next:null},r=this.tail;r?r.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var $p,Gb,Wb,sg,Hb,GR=zR,oP=/ipad|iphone|ipod/i.test(Sr)&&typeof Pebble<"u",cP=/web0s(?!.*chrome)/i.test(Sr),Jp=B,lP=BR,WR=cl,Kb=W0.set,dP=GR,HR=kR,uP=oP,H0=cP,qb=Fm,KR=Jp.MutationObserver||Jp.WebKitMutationObserver,qR=Jp.document,YR=Jp.process,K0=Jp.Promise,Yb=lP("queueMicrotask");if(!Yb){var q0=new dP,Y0=function(){var e,t;for(qb&&(e=YR.domain)&&e.exit();t=q0.get();)try{t()}catch(r){throw q0.head&&$p(),r}e&&e.enter()};HR||qb||H0||!KR||!qR?!uP&&K0&&K0.resolve?((sg=K0.resolve(void 0)).constructor=K0,Hb=WR(sg.then,sg),$p=function(){Hb(Y0)}):qb?$p=function(){YR.nextTick(Y0)}:(Kb=WR(Kb,Jp),$p=function(){Kb(Y0)}):(Gb=!0,Wb=qR.createTextNode(""),new KR(Y0).observe(Wb,{characterData:!0}),$p=function(){Wb.data=Gb=!Gb}),Yb=function(e){q0.head||$p(),q0.add(e)}}var XR=Yb,Qp=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Sh=B.Promise,hP=B,ig=Sh,pP=ve,fP=Tr,mP=Ab,$R=Nr,Xb=d0,$b=_n,JR=ig&&ig.prototype,gP=$R("species"),QR=pP(hP.PromiseRejectionEvent),X0=fP("Promise",function(){var e=mP(ig),t=e!==String(ig);if(!t&&$b===66||!JR.catch||!JR.finally)return!0;if(!$b||$b<51||!/native code/.test(e)){var r=new ig(function(c){c(1)}),a=function(c){c(function(){},function(){})};if((r.constructor={})[gP]=a,!(r.then(function(){})instanceof a))return!0}return!(t||Xb!=="BROWSER"&&Xb!=="DENO"||QR)}),ag={CONSTRUCTOR:X0,REJECTION_EVENT:QR},_l={},ZR=Wr,_P=TypeError,vP=function(e){var t,r;this.promise=new e(function(a,c){if(t!==void 0||r!==void 0)throw new _P("Bad Promise constructor");t=a,r=c}),this.resolve=ZR(t),this.reject=ZR(r)};_l.f=function(e){return new vP(e)};var Jb,eC,tC,EP=vn,$0=Fm,fu=B,J0=qt,og=Ye,nC=od,rC=ml,Qb=function(e){var t=ER(e);GD&&t&&!t[bR]&&yR(t,bR,{configurable:!0,get:function(){return this}})},sC=Wr,Q0=ve,iC=Gr,aC=B0,yP=Lb,oC=W0.set,Zb=XR,Z0=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},ev=Qp,bP=GR,cC=da,cg=Sh,ex=ag,lC=_l,tv="Promise",dC=ex.CONSTRUCTOR,xP=ex.REJECTION_EVENT,tx=cC.getterFor(tv),wP=cC.set,SP=cg&&cg.prototype,lg=cg,nx=SP,uC=fu.TypeError,rx=fu.document,sx=fu.process,Io=lC.f,TP=Io,RP=!!(rx&&rx.createEvent&&fu.dispatchEvent),mu="unhandledrejection",Dn=function(e){var t;return!(!iC(e)||!Q0(t=e.then))&&t},hC=function(e,t){var r,a,c,d=t.value,h=t.state===1,f=h?e.ok:e.fail,m=e.resolve,v=e.reject,E=e.domain;try{f?(h||(t.rejection===2&&NP(t),t.rejection=1),f===!0?r=d:(E&&E.enter(),r=f(d),E&&(E.exit(),c=!0)),r===e.promise?v(new uC("Promise-chain cycle")):(a=Dn(r))?og(a,r,m,v):m(r)):v(d)}catch(w){E&&!c&&E.exit(),v(w)}},ka=function(e,t){e.notified||(e.notified=!0,Zb(function(){for(var r,a=e.reactions;r=a.get();)hC(r,e);e.notified=!1,t&&!e.rejection&&CP(e)}))},Gs=function(e,t,r){var a,c;RP?((a=rx.createEvent("Event")).promise=t,a.reason=r,a.initEvent(e,!1,!0),fu.dispatchEvent(a)):a={promise:t,reason:r},!xP&&(c=fu["on"+e])?c(a):e===mu&&Z0("Unhandled promise rejection",r)},CP=function(e){og(oC,fu,function(){var t,r=e.facade,a=e.value;if(dd(e)&&(t=ev(function(){$0?sx.emit("unhandledRejection",a,r):Gs(mu,r,a)}),e.rejection=$0||dd(e)?2:1,t.error))throw t.value})},dd=function(e){return e.rejection!==1&&!e.parent},NP=function(e){og(oC,fu,function(){var t=e.facade;$0?sx.emit("rejectionHandled",t):Gs("rejectionhandled",t,e.value)})},Zp=function(e,t,r){return function(a){e(t,a,r)}},ef=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,ka(e,!0))},ix=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw new uC("Promise can't be resolved itself");var a=Dn(t);a?Zb(function(){var c={done:!1};try{og(a,t,Zp(ix,c,e),Zp(ef,c,e))}catch(d){ef(c,d,e)}}):(e.value=t,e.state=1,ka(e,!1))}catch(c){ef({done:!1},c,e)}}};dC&&(nx=(lg=function(e){aC(this,nx),sC(e),og(Jb,this);var t=tx(this);try{e(Zp(ix,t),Zp(ef,t))}catch(r){ef(t,r)}}).prototype,(Jb=function(e){wP(this,{type:tv,done:!1,notified:!1,parent:!1,reactions:new bP,rejection:!1,state:0,value:null})}).prototype=nC(nx,"then",function(e,t){var r=tx(this),a=Io(yP(this,lg));return r.parent=!0,a.ok=!Q0(e)||e,a.fail=Q0(t)&&t,a.domain=$0?sx.domain:void 0,r.state===0?r.reactions.add(a):Zb(function(){hC(a,r)}),a.promise}),eC=function(){var e=new Jb,t=tx(e);this.promise=e,this.resolve=Zp(ix,t),this.reject=Zp(ef,t)},lC.f=Io=function(e){return e===lg||e===tC?new eC(e):TP(e)}),EP({global:!0,wrap:!0,forced:dC},{Promise:lg}),tC=J0.Promise,rC(lg,tv,!1,!0),Qb(tv);var pC=Nr("iterator"),nv=!1;try{var IP=0,vl={next:function(){return{done:!!IP++}},return:function(){nv=!0}};vl[pC]=function(){return this},Array.from(vl,function(){throw 2})}catch{}var fC=Sh,rv=function(e,t){try{if(!t&&!nv)return!1}catch{return!1}var r=!1;try{var a={};a[pC]=function(){return{next:function(){return{done:r=!0}}}},e(a)}catch{}return r},gs=ag.CONSTRUCTOR||!rv(function(e){fC.all(e).then(void 0,function(){})}),Ws=Ye,mC=Wr,AP=_l,kP=Qp,OP=qm;vn({target:"Promise",stat:!0,forced:gs},{all:function(e){var t=this,r=AP.f(t),a=r.resolve,c=r.reject,d=kP(function(){var h=mC(t.resolve),f=[],m=0,v=1;OP(e,function(E){var w=m++,S=!1;v++,Ws(h,t,E).then(function(R){S||(S=!0,f[w]=R,--v||a(f))},c)}),--v||a(f)});return d.error&&c(d.value),r.promise}});var DP=vn,PP=ag.CONSTRUCTOR;Sh&&Sh.prototype,DP({target:"Promise",proto:!0,forced:PP,real:!0},{catch:function(e){return this.then(void 0,e)}});var LP=Ye,gC=Wr,dg=_l,ax=Qp,jP=qm;vn({target:"Promise",stat:!0,forced:gs},{race:function(e){var t=this,r=dg.f(t),a=r.reject,c=ax(function(){var d=gC(t.resolve);jP(e,function(h){LP(d,t,h).then(r.resolve,a)})});return c.error&&a(c.value),r.promise}});var _C=_l;vn({target:"Promise",stat:!0,forced:ag.CONSTRUCTOR},{reject:function(e){var t=_C.f(this);return(0,t.reject)(e),t.promise}});var sv=hi,Ao=Gr,tf=_l,vC=function(e,t){if(sv(e),Ao(t)&&t.constructor===e)return t;var r=tf.f(e);return(0,r.resolve)(t),r.promise},MP=vn,UP=Sh,VP=ag.CONSTRUCTOR,FP=vC,EC=gr("Promise"),ud=!VP;MP({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return FP(ud&&this===EC?UP:this,e)}});var Gn=Ye,yC=Wr,Jo=_l,bC=Qp,BP=qm;vn({target:"Promise",stat:!0,forced:gs},{allSettled:function(e){var t=this,r=Jo.f(t),a=r.resolve,c=r.reject,d=bC(function(){var h=yC(t.resolve),f=[],m=0,v=1;BP(e,function(E){var w=m++,S=!1;v++,Gn(h,t,E).then(function(R){S||(S=!0,f[w]={status:"fulfilled",value:R},--v||a(f))},function(R){S||(S=!0,f[w]={status:"rejected",reason:R},--v||a(f))})}),--v||a(f)});return d.error&&c(d.value),r.promise}});var qr=Ye,zP=Wr,xC=gr,iv=_l,GP=Qp,WP=qm,wC="No one promise resolved";vn({target:"Promise",stat:!0,forced:gs},{any:function(e){var t=this,r=xC("AggregateError"),a=iv.f(t),c=a.resolve,d=a.reject,h=GP(function(){var f=zP(t.resolve),m=[],v=0,E=1,w=!1;WP(e,function(S){var R=v++,j=!1;E++,qr(f,t,S).then(function(D){j||w||(w=!0,c(D))},function(D){j||w||(j=!0,m[R]=D,--E||d(new r(m,wC)))})}),--E||d(new r(m,wC))});return h.error&&d(h.value),a.promise}});var HP=vn,KP=ee,qP=hu,YP=_l,XP=Wr,SC=Qp,ox=B.Promise,TC=!1;HP({target:"Promise",stat:!0,forced:!ox||!ox.try||SC(function(){ox.try(function(e){TC=e===8},8)}).error||!TC},{try:function(e){var t=arguments.length>1?qP(arguments,1):[],r=YP.f(this),a=SC(function(){return KP(XP(e),void 0,t)});return(a.error?r.reject:r.resolve)(a.value),r.promise}});var $P=_l;vn({target:"Promise",stat:!0},{withResolvers:function(){var e=$P.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var JP=vn,ug=Sh,QP=p,cx=gr,ZP=ve,e2=Lb,RC=vC,Li=ug&&ug.prototype;JP({target:"Promise",proto:!0,real:!0,forced:!!ug&&QP(function(){Li.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=e2(this,cx("Promise")),r=ZP(e);return this.then(r?function(a){return RC(t,e()).then(function(){return a})}:e,r?function(a){return RC(t,e()).then(function(){throw a})}:e)}});var ua=A,t2=T,n2=Na,r2=cr,CC=ua("".charAt),NC=ua("".charCodeAt),s2=ua("".slice),IC=function(e){return function(t,r){var a,c,d=n2(r2(t)),h=t2(r),f=d.length;return h<0||h>=f?e?"":void 0:(a=NC(d,h))<55296||a>56319||h+1===f||(c=NC(d,h+1))<56320||c>57343?e?CC(d,h):a:e?s2(d,h,h+2):c-56320+(a-55296<<10)+65536}},av={codeAt:IC(!1),charAt:IC(!0)},i2=av.charAt,a2=Na,AC=da,kC=Rb,lx=F0,OC="String Iterator",o2=AC.set,c2=AC.getterFor(OC);kC(String,"String",function(e){o2(this,{type:OC,string:a2(e),index:0})},function(){var e,t=c2(this),r=t.string,a=t.index;return a>=r.length?lx(void 0,!0):(e=i2(r,a),t.index+=e.length,lx(e,!1))});var l2=qt.Promise,nf={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},d2=B,u2=ml,DC=ru;for(var dx in nf)u2(d2[dx],dx),DC[dx]=DC.Array;var PC=l2,Ue=u(PC),LC=So("Array","values"),h2=tu,p2=Ns,f2=M,m2=LC,ux=Array.prototype,g2={DOMTokenList:!0,NodeList:!0},_2=function(e){var t=e.values;return e===ux||f2(ux,e)&&t===ux.values||p2(g2,h2(e))?m2:t},Oa=u(_2),jC=yc,v2=TypeError,MC=hu,E2=Math.floor,hx=function(e,t){var r=e.length;if(r<8)for(var a,c,d=1;d<r;){for(c=d,a=e[d];c&&t(e[c-1],a)>0;)e[c]=e[--c];c!==d++&&(e[c]=a)}else for(var h=E2(r/2),f=hx(MC(e,0,h),t),m=hx(MC(e,h),t),v=f.length,E=m.length,w=0,S=0;w<v||S<E;)e[w+S]=w<v&&S<E?t(f[w],m[S])<=0?f[w++]:m[S++]:w<v?f[w++]:m[S++];return e},UC=hx,VC=Sr.match(/firefox\/(\d+)/i),y2=!!VC&&+VC[1],b2=/MSIE|Trident/.test(Sr),FC=Sr.match(/AppleWebKit\/(\d+)\./),x2=!!FC&&+FC[1],w2=vn,BC=A,S2=Wr,T2=Wo,zC=Vn,R2=function(e,t){if(!delete e[t])throw new v2("Cannot delete property "+jC(t)+" of "+jC(e))},ov=Na,cv=p,GC=UC,C2=vh,WC=y2,N2=b2,lv=_n,HC=x2,gu=[],KC=BC(gu.sort),so=BC(gu.push),px=cv(function(){gu.sort(void 0)}),I2=cv(function(){gu.sort(null)}),A2=C2("sort"),qC=!cv(function(){if(lv)return lv<70;if(!(WC&&WC>3)){if(N2)return!0;if(HC)return HC<603;var e,t,r,a,c="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(a=0;a<47;a++)gu.push({k:t+a,v:r})}for(gu.sort(function(d,h){return h.v-d.v}),a=0;a<gu.length;a++)t=gu[a].k.charAt(0),c.charAt(c.length-1)!==t&&(c+=t);return c!=="DGBEFHACIJK"}});w2({target:"Array",proto:!0,forced:px||!I2||!A2||!qC},{sort:function(e){e!==void 0&&S2(e);var t=T2(this);if(qC)return e===void 0?KC(t):KC(t,e);var r,a,c=[],d=zC(t);for(a=0;a<d;a++)a in t&&so(c,t[a]);for(GC(c,function(h){return function(f,m){return m===void 0?-1:f===void 0?1:h!==void 0?+h(f,m)||0:ov(f)>ov(m)?1:-1}}(e)),r=zC(c),a=0;a<r;)t[a]=c[a++];for(;a<d;)R2(t,a++);return t}});var k2=So("Array","sort"),fx=M,O2=k2,hg=Array.prototype,D2=function(e){var t=e.sort;return e===hg||fx(hg,e)&&t===hg.sort?O2:t},Th=u(D2),P2=vn,L2=A,YC=Oe,j2=RangeError,XC=String.fromCharCode,$C=String.fromCodePoint,mx=L2([].join);P2({target:"String",stat:!0,forced:!!$C&&$C.length!==1},{fromCodePoint:function(e){for(var t,r=[],a=arguments.length,c=0;a>c;){if(t=+arguments[c++],YC(t,1114111)!==t)throw new j2(t+" is not a valid code point");r[c]=t<65536?XC(t):XC(55296+((t-=65536)>>10),t%1024+56320)}return mx(r,"")}});var gx=p,M2=Nr("iterator"),dv=!gx(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,r=new URLSearchParams("a=1&a=2&b=3"),a="";return e.pathname="c%20d",t.forEach(function(c,d){t.delete("b"),a+=d+c}),r.delete("a",2),r.delete("b",void 0),!e.toJSON||!r.has("a",1)||r.has("a",2)||!r.has("a",void 0)||r.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[M2]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||a!=="a1c3"||new URL("https://x",void 0).host!=="x"}),U2=od,_x=vn,JC=B,vx=BR,V2=gr,uv=Ye,Ic=A,pg=qe,QC=dv,ZC=od,F2=uu,B2=function(e,t,r){for(var a in t)r&&r.unsafe&&e[a]?e[a]=t[a]:U2(e,a,t[a],r);return e},z2=ml,G2=Qm,Ex=da,eN=B0,yx=ve,W2=Ns,H2=cl,_=tu,b=hi,N=Gr,U=Na,re=Fp,pe=mn,xe=ab,Se=su,Ae=F0,et=pu,it=UC,ct=Nr("iterator"),wt="URLSearchParams",Yt=wt+"Iterator",dn=Ex.set,un=Ex.getterFor(wt),En=Ex.getterFor(Yt),sr=vx("fetch"),ir=vx("Request"),Xi=vx("Headers"),$i=ir&&ir.prototype,io=Xi&&Xi.prototype,ti=JC.TypeError,Ac=JC.encodeURIComponent,hd=String.fromCharCode,tN=V2("String","fromCodePoint"),yse=parseInt,nN=Ic("".charAt),aB=Ic([].join),rf=Ic([].push),oB=Ic("".replace),bse=Ic([].shift),cB=Ic([].splice),lB=Ic("".split),dB=Ic("".slice),xse=Ic(/./.exec),wse=/\+/g,Sse=/^[0-9a-f]+$/i,uB=function(e,t){var r=dB(e,t,t+2);return xse(Sse,r)?yse(r,16):NaN},Tse=function(e){for(var t=0,r=128;r>0&&e&r;r>>=1)t++;return t},Rse=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},hB=function(e){for(var t=(e=oB(e,wse," ")).length,r="",a=0;a<t;){var c=nN(e,a);if(c==="%"){if(nN(e,a+1)==="%"||a+3>t){r+="%",a++;continue}var d=uB(e,a+1);if(d!=d){r+=c,a++;continue}a+=2;var h=Tse(d);if(h===0)c=hd(d);else{if(h===1||h>4){r+="",a++;continue}for(var f=[d],m=1;m<h&&!(++a+3>t||nN(e,a)!=="%");){var v=uB(e,a+1);if(v!=v){a+=3;break}if(v>191||v<128)break;rf(f,v),a+=2,m++}if(f.length!==h){r+="";continue}var E=Rse(f);E===null?r+="":c=tN(E)}}r+=c,a++}return r},Cse=/[!'()~]|%20/g,Nse={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Ise=function(e){return Nse[e]},pB=function(e){return oB(Ac(e),Cse,Ise)},K2=G2(function(e,t){dn(this,{type:Yt,target:un(e).entries,index:0,kind:t})},wt,function(){var e=En(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=null,Ae(void 0,!0);var a=t[r];switch(e.kind){case"keys":return Ae(a.key,!1);case"values":return Ae(a.value,!1)}return Ae([a.key,a.value],!1)},!0),fB=function(e){this.entries=[],this.url=null,e!==void 0&&(N(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?nN(e,0)==="?"?dB(e,1):e:U(e)))};fB.prototype={type:wt,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,a,c,d,h,f,m=this.entries,v=Se(e);if(v)for(r=(t=xe(e,v)).next;!(a=uv(r,t)).done;){if(d=(c=xe(b(a.value))).next,(h=uv(d,c)).done||(f=uv(d,c)).done||!uv(d,c).done)throw new ti("Expected sequence with length 2");rf(m,{key:U(h.value),value:U(f.value)})}else for(var E in e)W2(e,E)&&rf(m,{key:E,value:U(e[E])})},parseQuery:function(e){if(e)for(var t,r,a=this.entries,c=lB(e,"&"),d=0;d<c.length;)(t=c[d++]).length&&(r=lB(t,"="),rf(a,{key:hB(bse(r)),value:hB(aB(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],a=0;a<t.length;)e=t[a++],rf(r,pB(e.key)+"="+pB(e.value));return aB(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var rN=function(){eN(this,hv);var e=dn(this,new fB(arguments.length>0?arguments[0]:void 0));pg||(this.size=e.entries.length)},hv=rN.prototype;if(B2(hv,{append:function(e,t){var r=un(this);et(arguments.length,2),rf(r.entries,{key:U(e),value:U(t)}),pg||this.length++,r.updateURL()},delete:function(e){for(var t=un(this),r=et(arguments.length,1),a=t.entries,c=U(e),d=r<2?void 0:arguments[1],h=d===void 0?d:U(d),f=0;f<a.length;){var m=a[f];if(m.key!==c||h!==void 0&&m.value!==h)f++;else if(cB(a,f,1),h!==void 0)break}pg||(this.size=a.length),t.updateURL()},get:function(e){var t=un(this).entries;et(arguments.length,1);for(var r=U(e),a=0;a<t.length;a++)if(t[a].key===r)return t[a].value;return null},getAll:function(e){var t=un(this).entries;et(arguments.length,1);for(var r=U(e),a=[],c=0;c<t.length;c++)t[c].key===r&&rf(a,t[c].value);return a},has:function(e){for(var t=un(this).entries,r=et(arguments.length,1),a=U(e),c=r<2?void 0:arguments[1],d=c===void 0?c:U(c),h=0;h<t.length;){var f=t[h++];if(f.key===a&&(d===void 0||f.value===d))return!0}return!1},set:function(e,t){var r=un(this);et(arguments.length,1);for(var a,c=r.entries,d=!1,h=U(e),f=U(t),m=0;m<c.length;m++)(a=c[m]).key===h&&(d?cB(c,m--,1):(d=!0,a.value=f));d||rf(c,{key:h,value:f}),pg||(this.size=c.length),r.updateURL()},sort:function(){var e=un(this);it(e.entries,function(t,r){return t.key>r.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,r=un(this).entries,a=H2(e,arguments.length>1?arguments[1]:void 0),c=0;c<r.length;)a((t=r[c++]).value,t.key,this)},keys:function(){return new K2(this,"keys")},values:function(){return new K2(this,"values")},entries:function(){return new K2(this,"entries")}},{enumerable:!0}),ZC(hv,ct,hv.entries,{}),ZC(hv,"toString",function(){return un(this).serialize()},{enumerable:!0}),pg&&F2(hv,"size",{get:function(){return un(this).entries.length},configurable:!0,enumerable:!0}),z2(rN,wt),_x({global:!0,forced:!QC},{URLSearchParams:rN}),!QC&&yx(Xi)){var Ase=Ic(io.has),kse=Ic(io.set),mB=function(e){if(N(e)){var t,r=e.body;if(_(r)===wt)return t=e.headers?new Xi(e.headers):new Xi,Ase(t,"content-type")||kse(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),re(e,{body:pe(0,U(r)),headers:pe(0,t)})}return e};if(yx(sr)&&_x({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return sr(e,arguments.length>1?mB(arguments[1]):{})}}),yx(ir)){var q2=function(e){return eN(this,$i),new ir(e,arguments.length>1?mB(arguments[1]):{})};$i.constructor=q2,q2.prototype=$i,_x({global:!0,dontCallGetSet:!0,forced:!0},{Request:q2})}}var El,Ose={URLSearchParams:rN,getState:un},Dse=qt.URLSearchParams,gB=qe,Pse=A,Lse=Ye,jse=p,Y2=_0,Mse=Hm,Use=ze,Vse=Wo,Fse=Wt,pv=Object.assign,_B=Object.defineProperty,Bse=Pse([].concat),zse=!pv||jse(function(){if(gB&&pv({b:1},pv(_B({},"a",{enumerable:!0,get:function(){_B(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},r=Symbol("assign detection"),a="abcdefghijklmnopqrst";return e[r]=7,a.split("").forEach(function(c){t[c]=c}),pv({},e)[r]!==7||Y2(pv({},t)).join("")!==a})?function(e,t){for(var r=Vse(e),a=arguments.length,c=1,d=Mse.f,h=Use.f;a>c;)for(var f,m=Fse(arguments[c++]),v=d?Bse(Y2(m),d(m)):Y2(m),E=v.length,w=0;E>w;)f=v[w++],gB&&!Lse(h,m,f)||(r[f]=m[f]);return r}:pv,Gse=hi,Wse=T0,Hse=qe,Kse=eo,qse=mn,X2=function(e,t,r){Hse?Kse.f(e,t,qse(0,r)):e[t]=r},Yse=cl,Xse=Ye,$se=Wo,Jse=function(e,t,r,a){try{return a?t(Gse(r)[0],r[1]):t(r)}catch(c){Wse(e,"throw",c)}},Qse=w0,Zse=G0,eie=Vn,vB=X2,tie=ab,nie=su,EB=Array,fg=A,$2=2147483647,rie=/[^\0-\u007E]/,yB=/[.\u3002\uFF0E\uFF61]/g,bB="Overflow: input needs wider integers to process",xB=RangeError,sie=fg(yB.exec),fv=Math.floor,J2=String.fromCharCode,wB=fg("".charCodeAt),SB=fg([].join),sf=fg([].push),iie=fg("".replace),aie=fg("".split),oie=fg("".toLowerCase),TB=function(e){return e+22+75*(e<26)},cie=function(e,t,r){var a=0;for(e=r?fv(e/700):e>>1,e+=fv(e/t);e>455;)e=fv(e/35),a+=36;return fv(a+36*e/(e+38))},lie=function(e){var t=[];e=function(W){for(var Y=[],ne=0,le=W.length;ne<le;){var fe=wB(W,ne++);if(fe>=55296&&fe<=56319&&ne<le){var ie=wB(W,ne++);(64512&ie)==56320?sf(Y,((1023&fe)<<10)+(1023&ie)+65536):(sf(Y,fe),ne--)}else sf(Y,fe)}return Y}(e);var r,a,c=e.length,d=128,h=0,f=72;for(r=0;r<e.length;r++)(a=e[r])<128&&sf(t,J2(a));var m=t.length,v=m;for(m&&sf(t,"-");v<c;){var E=$2;for(r=0;r<e.length;r++)(a=e[r])>=d&&a<E&&(E=a);var w=v+1;if(E-d>fv(($2-h)/w))throw new xB(bB);for(h+=(E-d)*w,d=E,r=0;r<e.length;r++){if((a=e[r])<d&&++h>$2)throw new xB(bB);if(a===d){for(var S=h,R=36;;){var j=R<=f?1:R>=f+26?26:R-f;if(S<j)break;var D=S-j,P=36-j;sf(t,J2(TB(j+D%P))),S=fv(D/P),R+=36}sf(t,J2(TB(S))),f=cie(h,w,v===m),h=0,v++}}h++,d++}return SB(t,"")},die=vn,Q2=qe,uie=dv,Z2=B,RB=cl,yl=A,sN=od,bl=uu,hie=B0,eL=Ns,tL=zse,mv=function(e){var t=$se(e),r=Zse(this),a=arguments.length,c=a>1?arguments[1]:void 0,d=c!==void 0;d&&(c=Yse(c,a>2?arguments[2]:void 0));var h,f,m,v,E,w,S=nie(t),R=0;if(!S||this===EB&&Qse(S))for(h=eie(t),f=r?new this(h):EB(h);h>R;R++)w=d?c(t[R],R):t[R],vB(f,R,w);else for(f=r?new this:[],E=(v=tie(t,S)).next;!(m=Xse(E,v)).done;R++)w=d?Jse(v,c,[m.value,R],!0):m.value,vB(f,R,w);return f.length=R,f},pd=hu,pie=av.codeAt,fie=function(e){var t,r,a=[],c=aie(iie(oie(e),yB,"."),".");for(t=0;t<c.length;t++)r=c[t],sf(a,sie(rie,r)?"xn--"+lie(r):r);return SB(a,".")},Rh=Na,mie=ml,gie=pu,CB=Ose,NB=da,_ie=NB.set,iN=NB.getterFor("URL"),vie=CB.URLSearchParams,Eie=CB.getState,bx=Z2.URL,nL=Z2.TypeError,aN=Z2.parseInt,yie=Math.floor,IB=Math.pow,xl=yl("".charAt),fd=yl(/./.exec),xx=yl([].join),bie=yl(1.1.toString),xie=yl([].pop),gv=yl([].push),rL=yl("".replace),wie=yl([].shift),Sie=yl("".split),wx=yl("".slice),oN=yl("".toLowerCase),Tie=yl([].unshift),sL="Invalid scheme",mg="Invalid host",AB="Invalid port",kB=/[a-z]/i,Rie=/[\d+-.a-z]/i,iL=/\d/,Cie=/^0x/i,Nie=/^[0-7]+$/,Iie=/^\d+$/,OB=/^[\da-f]+$/i,Aie=/[\0\t\n\r #%/:<>?@[\\\]^|]/,kie=/[\0\t\n\r #/:<>?@[\\\]^|]/,Oie=/^[\u0000-\u0020]+/,Die=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Pie=/[\t\n\r]/g,Sx=function(e){var t,r,a,c;if(typeof e=="number"){for(t=[],r=0;r<4;r++)Tie(t,e%256),e=yie(e/256);return xx(t,".")}if(typeof e=="object"){for(t="",a=function(d){for(var h=null,f=1,m=null,v=0,E=0;E<8;E++)d[E]!==0?(v>f&&(h=m,f=v),m=null,v=0):(m===null&&(m=E),++v);return v>f?m:h}(e),r=0;r<8;r++)c&&e[r]===0||(c&&(c=!1),a===r?(t+=r?":":"::",c=!0):(t+=bie(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},cN={},DB=tL({},cN,{" ":1,'"':1,"<":1,">":1,"`":1}),PB=tL({},DB,{"#":1,"?":1,"{":1,"}":1}),aL=tL({},PB,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),af=function(e,t){var r=pie(e,0);return r>32&&r<127&&!eL(t,e)?e:encodeURIComponent(e)},lN={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Tx=function(e,t){var r;return e.length===2&&fd(kB,xl(e,0))&&((r=xl(e,1))===":"||!t&&r==="|")},LB=function(e){var t;return e.length>1&&Tx(wx(e,0,2))&&(e.length===2||(t=xl(e,2))==="/"||t==="\\"||t==="?"||t==="#")},Lie=function(e){return e==="."||oN(e)==="%2e"},oL={},jB={},cL={},MB={},UB={},lL={},VB={},FB={},dN={},uN={},dL={},uL={},hL={},pL={},BB={},fL={},_v={},_u={},zB={},gg={},Ch={},mL=function(e,t,r){var a,c,d,h=Rh(e);if(t){if(c=this.parse(h))throw new nL(c);this.searchParams=null}else{if(r!==void 0&&(a=new mL(r,!0)),c=this.parse(h,null,a))throw new nL(c);(d=Eie(new vie)).bindURL(this),this.searchParams=d}};mL.prototype={type:"URL",parse:function(e,t,r){var a,c,d,h,f,m=this,v=t||oL,E=0,w="",S=!1,R=!1,j=!1;for(e=Rh(e),t||(m.scheme="",m.username="",m.password="",m.host=null,m.port=null,m.path=[],m.query=null,m.fragment=null,m.cannotBeABaseURL=!1,e=rL(e,Oie,""),e=rL(e,Die,"$1")),e=rL(e,Pie,""),a=mv(e);E<=a.length;){switch(c=a[E],v){case oL:if(!c||!fd(kB,c)){if(t)return sL;v=cL;continue}w+=oN(c),v=jB;break;case jB:if(c&&(fd(Rie,c)||c==="+"||c==="-"||c==="."))w+=oN(c);else{if(c!==":"){if(t)return sL;w="",v=cL,E=0;continue}if(t&&(m.isSpecial()!==eL(lN,w)||w==="file"&&(m.includesCredentials()||m.port!==null)||m.scheme==="file"&&!m.host))return;if(m.scheme=w,t)return void(m.isSpecial()&&lN[m.scheme]===m.port&&(m.port=null));w="",m.scheme==="file"?v=pL:m.isSpecial()&&r&&r.scheme===m.scheme?v=MB:m.isSpecial()?v=FB:a[E+1]==="/"?(v=UB,E++):(m.cannotBeABaseURL=!0,gv(m.path,""),v=zB)}break;case cL:if(!r||r.cannotBeABaseURL&&c!=="#")return sL;if(r.cannotBeABaseURL&&c==="#"){m.scheme=r.scheme,m.path=pd(r.path),m.query=r.query,m.fragment="",m.cannotBeABaseURL=!0,v=Ch;break}v=r.scheme==="file"?pL:lL;continue;case MB:if(c!=="/"||a[E+1]!=="/"){v=lL;continue}v=dN,E++;break;case UB:if(c==="/"){v=uN;break}v=_u;continue;case lL:if(m.scheme=r.scheme,c===El)m.username=r.username,m.password=r.password,m.host=r.host,m.port=r.port,m.path=pd(r.path),m.query=r.query;else if(c==="/"||c==="\\"&&m.isSpecial())v=VB;else if(c==="?")m.username=r.username,m.password=r.password,m.host=r.host,m.port=r.port,m.path=pd(r.path),m.query="",v=gg;else{if(c!=="#"){m.username=r.username,m.password=r.password,m.host=r.host,m.port=r.port,m.path=pd(r.path),m.path.length--,v=_u;continue}m.username=r.username,m.password=r.password,m.host=r.host,m.port=r.port,m.path=pd(r.path),m.query=r.query,m.fragment="",v=Ch}break;case VB:if(!m.isSpecial()||c!=="/"&&c!=="\\"){if(c!=="/"){m.username=r.username,m.password=r.password,m.host=r.host,m.port=r.port,v=_u;continue}v=uN}else v=dN;break;case FB:if(v=dN,c!=="/"||xl(w,E+1)!=="/")continue;E++;break;case dN:if(c!=="/"&&c!=="\\"){v=uN;continue}break;case uN:if(c==="@"){S&&(w="%40"+w),S=!0,d=mv(w);for(var D=0;D<d.length;D++){var P=d[D];if(P!==":"||j){var W=af(P,aL);j?m.password+=W:m.username+=W}else j=!0}w=""}else if(c===El||c==="/"||c==="?"||c==="#"||c==="\\"&&m.isSpecial()){if(S&&w==="")return"Invalid authority";E-=mv(w).length+1,w="",v=dL}else w+=c;break;case dL:case uL:if(t&&m.scheme==="file"){v=fL;continue}if(c!==":"||R){if(c===El||c==="/"||c==="?"||c==="#"||c==="\\"&&m.isSpecial()){if(m.isSpecial()&&w==="")return mg;if(t&&w===""&&(m.includesCredentials()||m.port!==null))return;if(h=m.parseHost(w))return h;if(w="",v=_v,t)return;continue}c==="["?R=!0:c==="]"&&(R=!1),w+=c}else{if(w==="")return mg;if(h=m.parseHost(w))return h;if(w="",v=hL,t===uL)return}break;case hL:if(!fd(iL,c)){if(c===El||c==="/"||c==="?"||c==="#"||c==="\\"&&m.isSpecial()||t){if(w!==""){var Y=aN(w,10);if(Y>65535)return AB;m.port=m.isSpecial()&&Y===lN[m.scheme]?null:Y,w=""}if(t)return;v=_v;continue}return AB}w+=c;break;case pL:if(m.scheme="file",c==="/"||c==="\\")v=BB;else{if(!r||r.scheme!=="file"){v=_u;continue}switch(c){case El:m.host=r.host,m.path=pd(r.path),m.query=r.query;break;case"?":m.host=r.host,m.path=pd(r.path),m.query="",v=gg;break;case"#":m.host=r.host,m.path=pd(r.path),m.query=r.query,m.fragment="",v=Ch;break;default:LB(xx(pd(a,E),""))||(m.host=r.host,m.path=pd(r.path),m.shortenPath()),v=_u;continue}}break;case BB:if(c==="/"||c==="\\"){v=fL;break}r&&r.scheme==="file"&&!LB(xx(pd(a,E),""))&&(Tx(r.path[0],!0)?gv(m.path,r.path[0]):m.host=r.host),v=_u;continue;case fL:if(c===El||c==="/"||c==="\\"||c==="?"||c==="#"){if(!t&&Tx(w))v=_u;else if(w===""){if(m.host="",t)return;v=_v}else{if(h=m.parseHost(w))return h;if(m.host==="localhost"&&(m.host=""),t)return;w="",v=_v}continue}w+=c;break;case _v:if(m.isSpecial()){if(v=_u,c!=="/"&&c!=="\\")continue}else if(t||c!=="?")if(t||c!=="#"){if(c!==El&&(v=_u,c!=="/"))continue}else m.fragment="",v=Ch;else m.query="",v=gg;break;case _u:if(c===El||c==="/"||c==="\\"&&m.isSpecial()||!t&&(c==="?"||c==="#")){if((f=oN(f=w))===".."||f==="%2e."||f===".%2e"||f==="%2e%2e"?(m.shortenPath(),c==="/"||c==="\\"&&m.isSpecial()||gv(m.path,"")):Lie(w)?c==="/"||c==="\\"&&m.isSpecial()||gv(m.path,""):(m.scheme==="file"&&!m.path.length&&Tx(w)&&(m.host&&(m.host=""),w=xl(w,0)+":"),gv(m.path,w)),w="",m.scheme==="file"&&(c===El||c==="?"||c==="#"))for(;m.path.length>1&&m.path[0]==="";)wie(m.path);c==="?"?(m.query="",v=gg):c==="#"&&(m.fragment="",v=Ch)}else w+=af(c,PB);break;case zB:c==="?"?(m.query="",v=gg):c==="#"?(m.fragment="",v=Ch):c!==El&&(m.path[0]+=af(c,cN));break;case gg:t||c!=="#"?c!==El&&(c==="'"&&m.isSpecial()?m.query+="%27":m.query+=c==="#"?"%23":af(c,cN)):(m.fragment="",v=Ch);break;case Ch:c!==El&&(m.fragment+=af(c,DB))}E++}},parseHost:function(e){var t,r,a;if(xl(e,0)==="["){if(xl(e,e.length-1)!=="]"||(t=function(c){var d,h,f,m,v,E,w,S=[0,0,0,0,0,0,0,0],R=0,j=null,D=0,P=function(){return xl(c,D)};if(P()===":"){if(xl(c,1)!==":")return;D+=2,j=++R}for(;P();){if(R===8)return;if(P()!==":"){for(d=h=0;h<4&&fd(OB,P());)d=16*d+aN(P(),16),D++,h++;if(P()==="."){if(h===0||(D-=h,R>6))return;for(f=0;P();){if(m=null,f>0){if(!(P()==="."&&f<4))return;D++}if(!fd(iL,P()))return;for(;fd(iL,P());){if(v=aN(P(),10),m===null)m=v;else{if(m===0)return;m=10*m+v}if(m>255)return;D++}S[R]=256*S[R]+m,++f!=2&&f!==4||R++}if(f!==4)return;break}if(P()===":"){if(D++,!P())return}else if(P())return;S[R++]=d}else{if(j!==null)return;D++,j=++R}}if(j!==null)for(E=R-j,R=7;R!==0&&E>0;)w=S[R],S[R--]=S[j+E-1],S[j+--E]=w;else if(R!==8)return;return S}(wx(e,1,-1)),!t))return mg;this.host=t}else if(this.isSpecial()){if(e=fie(e),fd(Aie,e)||(t=function(c){var d,h,f,m,v,E,w,S=Sie(c,".");if(S.length&&S[S.length-1]===""&&S.length--,(d=S.length)>4)return c;for(h=[],f=0;f<d;f++){if((m=S[f])==="")return c;if(v=10,m.length>1&&xl(m,0)==="0"&&(v=fd(Cie,m)?16:8,m=wx(m,v===8?1:2)),m==="")E=0;else{if(!fd(v===10?Iie:v===8?Nie:OB,m))return c;E=aN(m,v)}gv(h,E)}for(f=0;f<d;f++)if(E=h[f],f===d-1){if(E>=IB(256,5-d))return null}else if(E>255)return null;for(w=xie(h),f=0;f<h.length;f++)w+=h[f]*IB(256,3-f);return w}(e),t===null))return mg;this.host=t}else{if(fd(kie,e))return mg;for(t="",r=mv(e),a=0;a<r.length;a++)t+=af(r[a],cN);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return eL(lN,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&Tx(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,a=e.password,c=e.host,d=e.port,h=e.path,f=e.query,m=e.fragment,v=t+":";return c!==null?(v+="//",e.includesCredentials()&&(v+=r+(a?":"+a:"")+"@"),v+=Sx(c),d!==null&&(v+=":"+d)):t==="file"&&(v+="//"),v+=e.cannotBeABaseURL?h[0]:h.length?"/"+xx(h,"/"):"",f!==null&&(v+="?"+f),m!==null&&(v+="#"+m),v},setHref:function(e){var t=this.parse(e);if(t)throw new nL(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new vv(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+Sx(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Rh(e)+":",oL)},getUsername:function(){return this.username},setUsername:function(e){var t=mv(Rh(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=af(t[r],aL)}},getPassword:function(){return this.password},setPassword:function(e){var t=mv(Rh(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=af(t[r],aL)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?Sx(e):Sx(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,dL)},getHostname:function(){var e=this.host;return e===null?"":Sx(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,uL)},getPort:function(){var e=this.port;return e===null?"":Rh(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Rh(e))===""?this.port=null:this.parse(e,hL))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+xx(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,_v))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Rh(e))===""?this.query=null:(xl(e,0)==="?"&&(e=wx(e,1)),this.query="",this.parse(e,gg)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Rh(e))!==""?(xl(e,0)==="#"&&(e=wx(e,1)),this.fragment="",this.parse(e,Ch)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var vv=function(e){var t=hie(this,ko),r=gie(arguments.length,1)>1?arguments[1]:void 0,a=_ie(t,new mL(e,!1,r));Q2||(t.href=a.serialize(),t.origin=a.getOrigin(),t.protocol=a.getProtocol(),t.username=a.getUsername(),t.password=a.getPassword(),t.host=a.getHost(),t.hostname=a.getHostname(),t.port=a.getPort(),t.pathname=a.getPathname(),t.search=a.getSearch(),t.searchParams=a.getSearchParams(),t.hash=a.getHash())},ko=vv.prototype,wl=function(e,t){return{get:function(){return iN(this)[e]()},set:t&&function(r){return iN(this)[t](r)},configurable:!0,enumerable:!0}};if(Q2&&(bl(ko,"href",wl("serialize","setHref")),bl(ko,"origin",wl("getOrigin")),bl(ko,"protocol",wl("getProtocol","setProtocol")),bl(ko,"username",wl("getUsername","setUsername")),bl(ko,"password",wl("getPassword","setPassword")),bl(ko,"host",wl("getHost","setHost")),bl(ko,"hostname",wl("getHostname","setHostname")),bl(ko,"port",wl("getPort","setPort")),bl(ko,"pathname",wl("getPathname","setPathname")),bl(ko,"search",wl("getSearch","setSearch")),bl(ko,"searchParams",wl("getSearchParams")),bl(ko,"hash",wl("getHash","setHash"))),sN(ko,"toJSON",function(){return iN(this).serialize()},{enumerable:!0}),sN(ko,"toString",function(){return iN(this).serialize()},{enumerable:!0}),bx){var GB=bx.createObjectURL,WB=bx.revokeObjectURL;GB&&sN(vv,"createObjectURL",RB(GB,bx)),WB&&sN(vv,"revokeObjectURL",RB(WB,bx))}mie(vv,"URL"),die({global:!0,forced:!uie,sham:!Q2},{URL:vv});var jie=vn,HB=p,Mie=pu,KB=Na,Uie=dv,gL=gr("URL"),Vie=Uie&&HB(function(){gL.canParse()}),Fie=HB(function(){return gL.canParse.length!==1});jie({target:"URL",stat:!0,forced:!Vie||Fie},{canParse:function(e){var t=Mie(arguments.length,1),r=KB(e),a=t<2||arguments[1]===void 0?void 0:KB(arguments[1]);try{return!!new gL(r,a)}catch{return!1}}});var Bie=vn,zie=pu,qB=Na,Gie=dv,Wie=gr("URL");Bie({target:"URL",stat:!0,forced:!Gie},{parse:function(e){var t=zie(arguments.length,1),r=qB(e),a=t<2||arguments[1]===void 0?void 0:qB(arguments[1]);try{return new Wie(r,a)}catch{return null}}});var hN=u(qt.URL);let YB=!0,XB=!0;function pN(e,t,r){const a=e.match(t);return a&&a.length>=r&&parseInt(a[r],10)}function _g(e,t,r){if(!e.RTCPeerConnection)return;const a=e.RTCPeerConnection.prototype,c=a.addEventListener;a.addEventListener=function(h,f){if(h!==t)return c.apply(this,arguments);const m=v=>{const E=r(v);E&&(f.handleEvent?f.handleEvent(E):f(E))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(f,m),c.apply(this,[h,m])};const d=a.removeEventListener;a.removeEventListener=function(h,f){if(h!==t||!this._eventMap||!this._eventMap[t])return d.apply(this,arguments);if(!this._eventMap[t].has(f))return d.apply(this,arguments);const m=this._eventMap[t].get(f);return this._eventMap[t].delete(f),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,d.apply(this,[h,m])},Object.defineProperty(a,"on"+t,{get(){return this["_on"+t]},set(h){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),h&&this.addEventListener(t,this["_on"+t]=h)},enumerable:!0,configurable:!0})}function Hie(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(YB=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Kie(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(XB=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function $B(){if(typeof window=="object"){if(YB)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function _L(e,t){XB&&console.warn(e+" is deprecated, please use "+t+" instead.")}function JB(e){return Object.prototype.toString.call(e)==="[object Object]"}function QB(e){var t;return JB(e)?To(t=Object.keys(e)).call(t,function(r,a){const c=JB(e[a]),d=c?QB(e[a]):e[a],h=c&&!Object.keys(d).length;return d===void 0||h?r:Object.assign(r,{[a]:d})},{}):e}function vL(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach(a=>{a.endsWith("Id")?vL(e,e.get(t[a]),r):a.endsWith("Ids")&&t[a].forEach(c=>{vL(e,e.get(c),r)})}))}function ZB(e,t,r){const a=r?"outbound-rtp":"inbound-rtp",c=new Map;if(t===null)return c;const d=[];return e.forEach(h=>{h.type==="track"&&h.trackIdentifier===t.id&&d.push(h)}),d.forEach(h=>{e.forEach(f=>{f.type===a&&f.trackId===h.id&&vL(e,f,c)})}),c}const e6=$B;function t6(e,t){const r=e&&e.navigator;if(!r.mediaDevices)return;const a=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const f={};return Object.keys(h).forEach(m=>{if(m==="require"||m==="advanced"||m==="mediaSource")return;const v=typeof h[m]=="object"?h[m]:{ideal:h[m]};v.exact!==void 0&&typeof v.exact=="number"&&(v.min=v.max=v.exact);const E=function(w,S){return w?w+S.charAt(0).toUpperCase()+S.slice(1):S==="deviceId"?"sourceId":S};if(v.ideal!==void 0){f.optional=f.optional||[];let w={};typeof v.ideal=="number"?(w[E("min",m)]=v.ideal,f.optional.push(w),w={},w[E("max",m)]=v.ideal,f.optional.push(w)):(w[E("",m)]=v.ideal,f.optional.push(w))}v.exact!==void 0&&typeof v.exact!="number"?(f.mandatory=f.mandatory||{},f.mandatory[E("",m)]=v.exact):["min","max"].forEach(w=>{v[w]!==void 0&&(f.mandatory=f.mandatory||{},f.mandatory[E(w,m)]=v[w])})}),h.advanced&&(f.optional=(f.optional||[]).concat(h.advanced)),f},c=function(h,f){if(t.version>=61)return f(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const m=function(v,E,w){E in v&&!(w in v)&&(v[w]=v[E],delete v[E])};m((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),m(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=a(h.audio)}if(h&&typeof h.video=="object"){let m=h.video.facingMode;m=m&&(typeof m=="object"?m:{ideal:m});const v=t.version<66;if(m&&(m.exact==="user"||m.exact==="environment"||m.ideal==="user"||m.ideal==="environment")&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||v)){let E;if(delete h.video.facingMode,m.exact==="environment"||m.ideal==="environment"?E=["back","rear"]:m.exact!=="user"&&m.ideal!=="user"||(E=["front"]),E)return r.mediaDevices.enumerateDevices().then(w=>{w=w.filter(R=>R.kind==="videoinput");let S=w.find(R=>E.some(j=>{var D;return ke(D=R.label.toLowerCase()).call(D,j)}));return!S&&w.length&&ke(E).call(E,"back")&&(S=w[w.length-1]),S&&(h.video.deviceId=m.exact?{exact:S.deviceId}:{ideal:S.deviceId}),h.video=a(h.video),e6("chrome: "+JSON.stringify(h)),f(h)})}h.video=a(h.video)}return e6("chrome: "+JSON.stringify(h)),f(h)},d=function(h){return t.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=(function(h,f,m){c(h,v=>{r.webkitGetUserMedia(v,f,E=>{m&&m(d(E))})})}).bind(r),r.mediaDevices.getUserMedia){const h=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(f){return c(f,m=>h(m).then(v=>{if(m.audio&&!v.getAudioTracks().length||m.video&&!v.getVideoTracks().length)throw v.getTracks().forEach(E=>{E.stop()}),new DOMException("","NotFoundError");return v},v=>Ue.reject(d(v))))}}}function n6(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function r6(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",a=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.track.id):{track:a.track};const d=new Event("track");d.track=a.track,d.receiver=c,d.transceiver={receiver:c},d.streams=[r.stream],this.dispatchEvent(d)}),r.stream.getTracks().forEach(a=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.id):{track:a};const d=new Event("track");d.track=a,d.receiver=c,d.transceiver={receiver:c},d.streams=[r.stream],this.dispatchEvent(d)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else _g(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function s6(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(c,d){return{track:d,get dtmf(){return this._dtmf===void 0&&(d.kind==="audio"?this._dtmf=c.createDTMFSender(d):this._dtmf=null),this._dtmf},_pc:c}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(h,f){let m=c.apply(this,arguments);return m||(m=t(this,h),this._senders.push(m)),m};const d=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(h){d.apply(this,arguments);const f=this._senders.indexOf(h);f!==-1&&this._senders.splice(f,1)}}const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],r.apply(this,[c]),c.getTracks().forEach(d=>{this._senders.push(t(this,d))})};const a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],a.apply(this,[c]),c.getTracks().forEach(d=>{const h=this._senders.find(f=>f.track===d);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(a=>a._pc=this),r},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function i6(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[r,a,c]=arguments;if(arguments.length>0&&typeof r=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof r!="function"))return t.apply(this,[]);const d=function(f){const m={};return f.result().forEach(v=>{const E={id:v.id,timestamp:v.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[v.type]||v.type};v.names().forEach(w=>{E[w]=v.stat(w)}),m[E.id]=E}),m},h=function(f){return new Map(Object.keys(f).map(m=>[m,f[m]]))};if(arguments.length>=2){const f=function(m){a(h(d(m)))};return t.apply(this,[f,r])}return new Ue((f,m)=>{t.apply(this,[function(v){f(h(d(v)))},m])}).then(a,c)}}function a6(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){const c=r.apply(this,[]);return c.forEach(d=>d._pc=this),c});const a=e.RTCPeerConnection.prototype.addTrack;a&&(e.RTCPeerConnection.prototype.addTrack=function(){const c=a.apply(this,arguments);return c._pc=this,c}),e.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(d=>ZB(d,c.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){const a=r.apply(this,[]);return a.forEach(c=>c._pc=this),a}),_g(e,"track",a=>(a.receiver._pc=a.srcElement,a)),e.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then(c=>ZB(c,a.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const r=arguments[0];let a,c,d;return this.getSenders().forEach(h=>{h.track===r&&(a?d=!0:a=h)}),this.getReceivers().forEach(h=>(h.track===r&&(c?d=!0:c=h),h.track===r)),d||a&&c?Ue.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():c?c.getStats():Ue.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function o6(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(d=>this._shimmedLocalStreams[d][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(d,h){if(!h)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const f=t.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(f)===-1&&this._shimmedLocalStreams[h.id].push(f):this._shimmedLocalStreams[h.id]=[h,f],f};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(d){this._shimmedLocalStreams=this._shimmedLocalStreams||{},d.getTracks().forEach(m=>{if(this.getSenders().find(E=>E.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();r.apply(this,arguments);const f=this.getSenders().filter(m=>h.indexOf(m)===-1);this._shimmedLocalStreams[d.id]=[d].concat(f)};const a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],a.apply(this,arguments)};const c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const f=this._shimmedLocalStreams[h].indexOf(d);f!==-1&&this._shimmedLocalStreams[h].splice(f,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function c6(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return o6(e);const r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const m=r.apply(this);return this._reverseStreams=this._reverseStreams||{},m.map(v=>this._reverseStreams[v.id])};const a=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(m){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(v=>{if(this.getSenders().find(w=>w.track===v))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){const v=new e.MediaStream(m.getTracks());this._streams[m.id]=v,this._reverseStreams[v.id]=m,m=v}a.apply(this,[m])};const c=e.RTCPeerConnection.prototype.removeStream;function d(m,v){let E=v.sdp;return Object.keys(m._reverseStreams||[]).forEach(w=>{const S=m._reverseStreams[w],R=m._streams[S.id];E=E.replace(new RegExp(R.id,"g"),S.id)}),new RTCSessionDescription({type:v.type,sdp:E})}e.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},e.RTCPeerConnection.prototype.addTrack=function(m,v){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const E=[].slice.call(arguments,1);if(E.length!==1||!E[0].getTracks().find(R=>R===m))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(R=>R.track===m))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const S=this._streams[v.id];if(S)S.addTrack(m),Ue.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const R=new e.MediaStream([m]);this._streams[v.id]=R,this._reverseStreams[R.id]=v,this.addStream(R)}return this.getSenders().find(R=>R.track===m)},["createOffer","createAnswer"].forEach(function(m){const v=e.RTCPeerConnection.prototype[m],E={[m](){const w=arguments;return arguments.length&&typeof arguments[0]=="function"?v.apply(this,[S=>{const R=d(this,S);w[0].apply(null,[R])},S=>{w[1]&&w[1].apply(null,S)},arguments[2]]):v.apply(this,arguments).then(S=>d(this,S))}};e.RTCPeerConnection.prototype[m]=E[m]});const h=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(m,v){let E=v.sdp;return Object.keys(m._reverseStreams||[]).forEach(w=>{const S=m._reverseStreams[w],R=m._streams[S.id];E=E.replace(new RegExp(S.id,"g"),R.id)}),new RTCSessionDescription({type:v.type,sdp:E})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const f=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const m=f.get.apply(this);return m.type===""?m:d(this,m)}}),e.RTCPeerConnection.prototype.removeTrack=function(m){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(m._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let v;this._streams=this._streams||{},Object.keys(this._streams).forEach(E=>{this._streams[E].getTracks().find(w=>m.track===w)&&(v=this._streams[E])}),v&&(v.getTracks().length===1?this.removeStream(this._reverseStreams[v.id]):v.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}function EL(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const a=e.RTCPeerConnection.prototype[r],c={[r](){return arguments[0]=new(r==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};e.RTCPeerConnection.prototype[r]=c[r]})}function l6(e,t){_g(e,"negotiationneeded",r=>{const a=r.target;if(!(t.version<72||a.getConfiguration&&a.getConfiguration().sdpSemantics==="plan-b")||a.signalingState==="stable")return r})}var d6=Object.freeze({__proto__:null,fixNegotiationNeeded:l6,shimAddTrackRemoveTrack:c6,shimAddTrackRemoveTrackWithNative:o6,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(a=>{const c=r.video&&r.video.width,d=r.video&&r.video.height,h=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:h||3}},c&&(r.video.mandatory.maxWidth=c),d&&(r.video.mandatory.maxHeight=d),e.navigator.mediaDevices.getUserMedia(r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:s6,shimGetStats:i6,shimGetUserMedia:t6,shimMediaStream:n6,shimOnTrack:r6,shimPeerConnection:EL,shimSenderReceiverGetStats:a6});function u6(e,t){const r=e&&e.navigator,a=e&&e.MediaStreamTrack;if(r.getUserMedia=function(c,d,h){_L("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(c).then(d,h)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const c=function(h,f,m){f in h&&!(m in h)&&(h[m]=h[f],delete h[f])},d=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),d(h)},a&&a.prototype.getSettings){const h=a.prototype.getSettings;a.prototype.getSettings=function(){const f=h.apply(this,arguments);return c(f,"mozAutoGainControl","autoGainControl"),c(f,"mozNoiseSuppression","noiseSuppression"),f}}if(a&&a.prototype.applyConstraints){const h=a.prototype.applyConstraints;a.prototype.applyConstraints=function(f){return this.kind==="audio"&&typeof f=="object"&&(f=JSON.parse(JSON.stringify(f)),c(f,"autoGainControl","mozAutoGainControl"),c(f,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[f])}}}}function h6(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function yL(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const d=e.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};e.RTCPeerConnection.prototype[c]=h[c]});const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[c,d,h]=arguments;return a.apply(this,[c||null]).then(f=>{if(t.version<53&&!d)try{f.forEach(m=>{m.type=r[m.type]||m.type})}catch(m){if(m.name!=="TypeError")throw m;f.forEach((v,E)=>{f.set(E,Object.assign({},v,{type:r[v.type]||v.type}))})}return f}).then(d,h)}}function p6(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const a=t.apply(this,[]);return a.forEach(c=>c._pc=this),a});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const a=r.apply(this,arguments);return a._pc=this,a}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Ue.resolve(new Map)}}function f6(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=t.apply(this,[]);return r.forEach(a=>a._pc=this),r}),_g(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function m6(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){_L("removeStream","removeTrack"),this.getSenders().forEach(r=>{var a;r.track&&ke(a=t.getTracks()).call(a,r.track)&&this.removeTrack(r)})})}function g6(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function _6(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const a=r.length>0;a&&r.forEach(d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(parseFloat(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(parseFloat(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=t.apply(this,arguments);if(a){const{sender:d}=c,h=d.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=r,d.sendEncodings=r,this.setParametersPromises.push(d.setParameters(h).then(()=>{delete d.sendEncodings}).catch(()=>{delete d.sendEncodings})))}return c})}function v6(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const r=t.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function E6(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Ue.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function y6(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Ue.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var b6=Object.freeze({__proto__:null,shimAddTransceiver:_6,shimCreateAnswer:y6,shimCreateOffer:E6,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,Ue.reject(a)}return r.video===!0?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})},shimGetParameters:v6,shimGetUserMedia:u6,shimOnTrack:h6,shimPeerConnection:yL,shimRTCDataChannel:g6,shimReceiverGetStats:f6,shimRemoveStream:m6,shimSenderGetStats:p6});function x6(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(r){var a;this._localStreams||(this._localStreams=[]),ke(a=this._localStreams).call(a,r)||this._localStreams.push(r),r.getAudioTracks().forEach(c=>t.call(this,c,r)),r.getVideoTracks().forEach(c=>t.call(this,c,r))},e.RTCPeerConnection.prototype.addTrack=function(r){for(var a=arguments.length,c=new Array(a>1?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];return c&&c.forEach(h=>{var f;this._localStreams?ke(f=this._localStreams).call(f,h)||this._localStreams.push(h):this._localStreams=[h]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(t);if(r===-1)return;this._localStreams.splice(r,1);const a=t.getTracks();this.getSenders().forEach(c=>{ke(a).call(a,c.track)&&this.removeTrack(c)})})}}function w6(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach(c=>{var d;if(this._remoteStreams||(this._remoteStreams=[]),ke(d=this._remoteStreams).call(d,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(c=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(c)>=0)return;r._remoteStreams.push(c);const d=new Event("addstream");d.stream=c,r.dispatchEvent(d)})}),t.apply(r,arguments)}}}function S6(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,r=t.createOffer,a=t.createAnswer,c=t.setLocalDescription,d=t.setRemoteDescription,h=t.addIceCandidate;t.createOffer=function(m,v){const E=arguments.length>=2?arguments[2]:arguments[0],w=r.apply(this,[E]);return v?(w.then(m,v),Ue.resolve()):w},t.createAnswer=function(m,v){const E=arguments.length>=2?arguments[2]:arguments[0],w=a.apply(this,[E]);return v?(w.then(m,v),Ue.resolve()):w};let f=function(m,v,E){const w=c.apply(this,[m]);return E?(w.then(v,E),Ue.resolve()):w};t.setLocalDescription=f,f=function(m,v,E){const w=d.apply(this,[m]);return E?(w.then(v,E),Ue.resolve()):w},t.setRemoteDescription=f,f=function(m,v,E){const w=h.apply(this,[m]);return E?(w.then(v,E),Ue.resolve()):w},t.addIceCandidate=f}function T6(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const r=t.mediaDevices,a=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=c=>a(R6(c))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(r,a,c){t.mediaDevices.getUserMedia(r).then(a,c)}).bind(t))}function R6(e){return e&&e.video!==void 0?Object.assign({},e,{video:QB(e.video)}):e}function C6(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(r,a){if(r&&r.iceServers){const c=[];for(let d=0;d<r.iceServers.length;d++){let h=r.iceServers[d];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(_L("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(r.iceServers[d])}r.iceServers=c}return new t(r,a)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function N6(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function I6(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(r){if(r){r.offerToReceiveAudio!==void 0&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const a=this.getTransceivers().find(d=>d.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):r.offerToReceiveAudio!==!0||a||this.addTransceiver("audio",{direction:"recvonly"}),r.offerToReceiveVideo!==void 0&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const c=this.getTransceivers().find(d=>d.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):r.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function A6(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var k6=Object.freeze({__proto__:null,shimAudioContext:A6,shimCallbacksAPI:S6,shimConstraints:R6,shimCreateOfferLegacy:I6,shimGetUserMedia:T6,shimLocalStreamsAPI:x6,shimRTCIceServerUrls:C6,shimRemoteStreamsAPI:w6,shimTrackEventTransceiver:N6}),O6=`	
\v\f\r \u2028\u2029\uFEFF`,qie=cr,Yie=Na,bL=O6,D6=A("".replace),Xie=RegExp("^["+bL+"]+"),$ie=RegExp("(^|[^"+bL+"])["+bL+"]+$"),Jie=function(e){return function(t){var r=Yie(qie(t));return 1&e&&(r=D6(r,Xie,"")),2&e&&(r=D6(r,$ie,"$1")),r}},Qie={trim:Jie(3)},Zie=vb.PROPER,eae=p,P6=O6,tae=Qie.trim;vn({target:"String",proto:!0,forced:function(e){return eae(function(){return!!P6[e]()||""[e]()!==""||Zie&&P6[e].name!==e})}("trim")},{trim:function(){return tae(this)}});var nae=So("String","trim"),rae=M,sae=nae,xL=String.prototype,iae=function(e){var t=e.trim;return typeof e=="string"||e===xL||rae(xL,e)&&t===xL.trim?sae:t},ha=u(iae),L6={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(r){return r.trim().split(`
`).map(a=>a.trim())},t.splitSections=function(r){return r.split(`
m=`).map((a,c)=>(c>0?"m="+a:a).trim()+`\r
`)},t.getDescription=function(r){const a=t.splitSections(r);return a&&a[0]},t.getMediaSections=function(r){const a=t.splitSections(r);return a.shift(),a},t.matchPrefix=function(r,a){return t.splitLines(r).filter(c=>c.indexOf(a)===0)},t.parseCandidate=function(r){let a;a=r.indexOf("a=candidate:")===0?r.substring(12).split(" "):r.substring(10).split(" ");const c={foundation:a[0],component:{1:"rtp",2:"rtcp"}[a[1]]||a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]};for(let d=8;d<a.length;d+=2)switch(a[d]){case"raddr":c.relatedAddress=a[d+1];break;case"rport":c.relatedPort=parseInt(a[d+1],10);break;case"tcptype":c.tcpType=a[d+1];break;case"ufrag":c.ufrag=a[d+1],c.usernameFragment=a[d+1];break;default:c[a[d]]===void 0&&(c[a[d]]=a[d+1])}return c},t.writeCandidate=function(r){const a=[];a.push(r.foundation);const c=r.component;c==="rtp"?a.push(1):c==="rtcp"?a.push(2):a.push(c),a.push(r.protocol.toUpperCase()),a.push(r.priority),a.push(r.address||r.ip),a.push(r.port);const d=r.type;return a.push("typ"),a.push(d),d!=="host"&&r.relatedAddress&&r.relatedPort&&(a.push("raddr"),a.push(r.relatedAddress),a.push("rport"),a.push(r.relatedPort)),r.tcpType&&r.protocol.toLowerCase()==="tcp"&&(a.push("tcptype"),a.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(a.push("ufrag"),a.push(r.usernameFragment||r.ufrag)),"candidate:"+a.join(" ")},t.parseIceOptions=function(r){return r.substring(14).split(" ")},t.parseRtpMap=function(r){let a=r.substring(9).split(" ");const c={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),c.name=a[0],c.clockRate=parseInt(a[1],10),c.channels=a.length===3?parseInt(a[2],10):1,c.numChannels=c.channels,c},t.writeRtpMap=function(r){let a=r.payloadType;r.preferredPayloadType!==void 0&&(a=r.preferredPayloadType);const c=r.channels||r.numChannels||1;return"a=rtpmap:"+a+" "+r.name+"/"+r.clockRate+(c!==1?"/"+c:"")+`\r
`},t.parseExtmap=function(r){const a=r.substring(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1],attributes:a.slice(2).join(" ")}},t.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&r.direction!=="sendrecv"?"/"+r.direction:"")+" "+r.uri+(r.attributes?" "+r.attributes:"")+`\r
`},t.parseFmtp=function(r){const a={};let c;const d=r.substring(r.indexOf(" ")+1).split(";");for(let h=0;h<d.length;h++)c=d[h].trim().split("="),a[c[0].trim()]=c[1];return a},t.writeFmtp=function(r){let a="",c=r.payloadType;if(r.preferredPayloadType!==void 0&&(c=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){const d=[];Object.keys(r.parameters).forEach(h=>{r.parameters[h]!==void 0?d.push(h+"="+r.parameters[h]):d.push(h)}),a+="a=fmtp:"+c+" "+d.join(";")+`\r
`}return a},t.parseRtcpFb=function(r){const a=r.substring(r.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},t.writeRtcpFb=function(r){let a="",c=r.payloadType;return r.preferredPayloadType!==void 0&&(c=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(d=>{a+="a=rtcp-fb:"+c+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+`\r
`}),a},t.parseSsrcMedia=function(r){const a=r.indexOf(" "),c={ssrc:parseInt(r.substring(7,a),10)},d=r.indexOf(":",a);return d>-1?(c.attribute=r.substring(a+1,d),c.value=r.substring(d+1)):c.attribute=r.substring(a+1),c},t.parseSsrcGroup=function(r){const a=r.substring(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(c=>parseInt(c,10))}},t.getMid=function(r){const a=t.matchPrefix(r,"a=mid:")[0];if(a)return a.substring(6)},t.parseFingerprint=function(r){const a=r.substring(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1].toUpperCase()}},t.getDtlsParameters=function(r,a){return{role:"auto",fingerprints:t.matchPrefix(r+a,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(r,a){let c="a=setup:"+a+`\r
`;return r.fingerprints.forEach(d=>{c+="a=fingerprint:"+d.algorithm+" "+d.value+`\r
`}),c},t.parseCryptoLine=function(r){const a=r.substring(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},t.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+(typeof r.keyParams=="object"?t.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(r){if(r.indexOf("inline:")!==0)return null;const a=r.substring(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},t.getCryptoParameters=function(r,a){return t.matchPrefix(r+a,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(r,a){const c=t.matchPrefix(r+a,"a=ice-ufrag:")[0],d=t.matchPrefix(r+a,"a=ice-pwd:")[0];return c&&d?{usernameFragment:c.substring(12),password:d.substring(10)}:null},t.writeIceParameters=function(r){let a="a=ice-ufrag:"+r.usernameFragment+`\r
a=ice-pwd:`+r.password+`\r
`;return r.iceLite&&(a+=`a=ice-lite\r
`),a},t.parseRtpParameters=function(r){const a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=t.splitLines(r)[0].split(" ");a.profile=c[2];for(let h=3;h<c.length;h++){const f=c[h],m=t.matchPrefix(r,"a=rtpmap:"+f+" ")[0];if(m){const v=t.parseRtpMap(m),E=t.matchPrefix(r,"a=fmtp:"+f+" ");switch(v.parameters=E.length?t.parseFmtp(E[0]):{},v.rtcpFeedback=t.matchPrefix(r,"a=rtcp-fb:"+f+" ").map(t.parseRtcpFb),a.codecs.push(v),v.name.toUpperCase()){case"RED":case"ULPFEC":a.fecMechanisms.push(v.name.toUpperCase())}}}t.matchPrefix(r,"a=extmap:").forEach(h=>{a.headerExtensions.push(t.parseExtmap(h))});const d=t.matchPrefix(r,"a=rtcp-fb:* ").map(t.parseRtcpFb);return a.codecs.forEach(h=>{d.forEach(f=>{h.rtcpFeedback.find(m=>m.type===f.type&&m.parameter===f.parameter)||h.rtcpFeedback.push(f)})}),a},t.writeRtpDescription=function(r,a){let c="";c+="m="+r+" ",c+=a.codecs.length>0?"9":"0",c+=" "+(a.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=a.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,a.codecs.forEach(h=>{c+=t.writeRtpMap(h),c+=t.writeFmtp(h),c+=t.writeRtcpFb(h)});let d=0;return a.codecs.forEach(h=>{h.maxptime>d&&(d=h.maxptime)}),d>0&&(c+="a=maxptime:"+d+`\r
`),a.headerExtensions&&a.headerExtensions.forEach(h=>{c+=t.writeExtmap(h)}),c},t.parseRtpEncodingParameters=function(r){const a=[],c=t.parseRtpParameters(r),d=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,f=t.matchPrefix(r,"a=ssrc:").map(S=>t.parseSsrcMedia(S)).filter(S=>S.attribute==="cname"),m=f.length>0&&f[0].ssrc;let v;const E=t.matchPrefix(r,"a=ssrc-group:FID").map(S=>S.substring(17).split(" ").map(R=>parseInt(R,10)));E.length>0&&E[0].length>1&&E[0][0]===m&&(v=E[0][1]),c.codecs.forEach(S=>{if(S.name.toUpperCase()==="RTX"&&S.parameters.apt){let R={ssrc:m,codecPayloadType:parseInt(S.parameters.apt,10)};m&&v&&(R.rtx={ssrc:v}),a.push(R),d&&(R=JSON.parse(JSON.stringify(R)),R.fec={ssrc:m,mechanism:h?"red+ulpfec":"red"},a.push(R))}}),a.length===0&&m&&a.push({ssrc:m});let w=t.matchPrefix(r,"b=");return w.length&&(w=w[0].indexOf("b=TIAS:")===0?parseInt(w[0].substring(7),10):w[0].indexOf("b=AS:")===0?1e3*parseInt(w[0].substring(5),10)*.95-16e3:void 0,a.forEach(S=>{S.maxBitrate=w})),a},t.parseRtcpParameters=function(r){const a={},c=t.matchPrefix(r,"a=ssrc:").map(f=>t.parseSsrcMedia(f)).filter(f=>f.attribute==="cname")[0];c&&(a.cname=c.value,a.ssrc=c.ssrc);const d=t.matchPrefix(r,"a=rtcp-rsize");a.reducedSize=d.length>0,a.compound=d.length===0;const h=t.matchPrefix(r,"a=rtcp-mux");return a.mux=h.length>0,a},t.writeRtcpParameters=function(r){let a="";return r.reducedSize&&(a+=`a=rtcp-rsize\r
`),r.mux&&(a+=`a=rtcp-mux\r
`),r.ssrc!==void 0&&r.cname&&(a+="a=ssrc:"+r.ssrc+" cname:"+r.cname+`\r
`),a},t.parseMsid=function(r){let a;const c=t.matchPrefix(r,"a=msid:");if(c.length===1)return a=c[0].substring(7).split(" "),{stream:a[0],track:a[1]};const d=t.matchPrefix(r,"a=ssrc:").map(h=>t.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return d.length>0?(a=d[0].value.split(" "),{stream:a[0],track:a[1]}):void 0},t.parseSctpDescription=function(r){const a=t.parseMLine(r),c=t.matchPrefix(r,"a=max-message-size:");let d;c.length>0&&(d=parseInt(c[0].substring(19),10)),isNaN(d)&&(d=65536);const h=t.matchPrefix(r,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:a.fmt,maxMessageSize:d};const f=t.matchPrefix(r,"a=sctpmap:");if(f.length>0){const m=f[0].substring(10).split(" ");return{port:parseInt(m[0],10),protocol:m[1],maxMessageSize:d}}},t.writeSctpDescription=function(r,a){let c=[];return c=r.protocol!=="DTLS/SCTP"?["m="+r.kind+" 9 "+r.protocol+" "+a.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+a.port+`\r
`]:["m="+r.kind+" 9 "+r.protocol+" "+a.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+a.port+" "+a.protocol+` 65535\r
`],a.maxMessageSize!==void 0&&c.push("a=max-message-size:"+a.maxMessageSize+`\r
`),c.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(r,a,c){let d;const h=a!==void 0?a:2;return d=r||t.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+d+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(r,a){const c=t.splitLines(r);for(let d=0;d<c.length;d++)switch(c[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[d].substring(2)}return a?t.getDirection(a):"sendrecv"},t.getKind=function(r){return t.splitLines(r)[0].split(" ")[0].substring(2)},t.isRejected=function(r){return r.split(" ",2)[1]==="0"},t.parseMLine=function(r){const a=t.splitLines(r)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},t.parseOLine=function(r){const a=t.matchPrefix(r,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},t.isValidSDP=function(r){if(typeof r!="string"||r.length===0)return!1;const a=t.splitLines(r);for(let c=0;c<a.length;c++)if(a[c].length<2||a[c].charAt(1)!=="=")return!1;return!0},e.exports=t})(L6);var j6=L6.exports,Ev=u(j6),aae=i({__proto__:null,default:Ev},[j6]);function fN(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&((r=JSON.parse(JSON.stringify(r))).candidate=r.candidate.substr(2)),r.candidate&&r.candidate.length){const a=new t(r),c=Ev.parseCandidate(r.candidate),d=Object.assign(a,c);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new t(r)},e.RTCIceCandidate.prototype=t.prototype,_g(e,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new e.RTCIceCandidate(r.candidate),writable:"false"}),r))}function wL(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||_g(e,"icecandidate",t=>{if(t.candidate){const r=Ev.parseCandidate(t.candidate.candidate);r.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r.priority>>24])}return t})}function mN(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const r=function(f){if(!f||!f.sdp)return!1;const m=Ev.splitSections(f.sdp);return m.shift(),m.some(v=>{const E=Ev.parseMLine(v);return E&&E.kind==="application"&&E.protocol.indexOf("SCTP")!==-1})},a=function(f){const m=f.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(m===null||m.length<2)return-1;const v=parseInt(m[1],10);return v!=v?-1:v},c=function(f){let m=65536;return t.browser==="firefox"&&(m=t.version<57?f===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),m},d=function(f,m){let v=65536;t.browser==="firefox"&&t.version===57&&(v=65535);const E=Ev.matchPrefix(f.sdp,"a=max-message-size:");return E.length>0?v=parseInt(E[0].substr(19),10):t.browser==="firefox"&&m!==-1&&(v=2147483637),v},h=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:f}=this.getConfiguration();f==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){const f=a(arguments[0]),m=c(f),v=d(arguments[0],f);let E;E=m===0&&v===0?Number.POSITIVE_INFINITY:m===0||v===0?Math.max(m,v):Math.min(m,v);const w={};Object.defineProperty(w,"maxMessageSize",{get:()=>E}),this._sctp=w}return h.apply(this,arguments)}}function gN(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(a,c){const d=a.send;a.send=function(){const h=arguments[0],f=h.length||h.size||h.byteLength;if(a.readyState==="open"&&c.sctp&&f>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return d.apply(a,arguments)}}const r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const a=r.apply(this,arguments);return t(a,this),a},_g(e,"datachannel",a=>(t(a.channel,a.target),a))}function SL(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{const a=t[r];t[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const d=c.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;const h=new Event("connectionstatechange",c);d.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),a.apply(this,arguments)}})}function TL(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&a.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=a.sdp.split(`
`).filter(d=>ha(d).call(d)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&a instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:a.type,sdp:c}):a.sdp=c}return r.apply(this,arguments)}}function _N(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.addIceCandidate;r&&r.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Ue.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Ue.resolve())})}function vN(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.setLocalDescription;r&&r.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if(typeof a!="object"||a.type&&a.sdp)return r.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer"}return a.sdp||a.type!=="offer"&&a.type!=="answer"?r.apply(this,[a]):(a.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>r.apply(this,[c]))})}var oae=Object.freeze({__proto__:null,removeExtmapAllowMixed:TL,shimAddIceCandidateNullOrEmpty:_N,shimConnectionState:SL,shimMaxMessageSize:mN,shimParameterlessSetLocalDescription:vN,shimRTCIceCandidate:fN,shimRTCIceCandidateRelayProtocol:wL,shimSendThrowTypeError:gN});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const r=$B,a=function(d){const h={browser:null,version:null};if(d===void 0||!d.navigator)return h.browser="Not a browser.",h;const{navigator:f}=d;if(f.mozGetUserMedia)h.browser="firefox",h.version=pN(f.userAgent,/Firefox\/(\d+)\./,1);else if(f.webkitGetUserMedia||d.isSecureContext===!1&&d.webkitRTCPeerConnection)h.browser="chrome",h.version=pN(f.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!d.RTCPeerConnection||!f.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=pN(f.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=d.RTCRtpTransceiver&&"currentDirection"in d.RTCRtpTransceiver.prototype}return h}(e),c={browserDetails:a,commonShim:oae,extractVersion:pN,disableLog:Hie,disableWarnings:Kie,sdp:aae};switch(a.browser){case"chrome":if(!d6||!EL||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),c;if(a.version===null)return r("Chrome shim can not determine version, not shimming."),c;r("adapter.js shimming chrome."),c.browserShim=d6,_N(e,a),vN(e),t6(e,a),n6(e),EL(e,a),r6(e),c6(e,a),s6(e),i6(e),a6(e),l6(e,a),fN(e),wL(e),SL(e),mN(e,a),gN(e),TL(e,a);break;case"firefox":if(!b6||!yL||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),c;r("adapter.js shimming firefox."),c.browserShim=b6,_N(e,a),vN(e),u6(e,a),yL(e,a),h6(e),m6(e),p6(e),f6(e),g6(e),_6(e),v6(e),E6(e),y6(e),fN(e),SL(e),mN(e,a),gN(e);break;case"safari":if(!k6||!t.shimSafari)return r("Safari shim is not included in this adapter release."),c;r("adapter.js shimming safari."),c.browserShim=k6,_N(e,a),vN(e),C6(e),I6(e),S6(e),x6(e),w6(e),N6(e),T6(e),A6(e),fN(e),wL(e),mN(e,a),gN(e),TL(e,a);break;default:r("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var cae=p,M6=B.RegExp,lae=!cae(function(){var e=!0;try{M6(".","d")}catch{e=!1}var t={},r="",a=e?"dgimsy":"gimsy",c=function(f,m){Object.defineProperty(t,f,{get:function(){return r+=m,!0}})},d={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var h in e&&(d.hasIndices="d"),d)c(h,d[h]);return Object.getOwnPropertyDescriptor(M6.prototype,"flags").get.call(t)!==a||r!==a}),dae=hi,uae=Ye,hae=Ns,pae=M,U6={correct:lae},fae=function(){var e=dae(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},mae=RegExp.prototype,RL=U6.correct?function(e){return e.flags}:function(e){return U6.correct||!pae(mae,e)||hae(e,"flags")?e.flags:uae(fae,e)},CL=A,gae=Math.floor,NL=CL("".charAt),_ae=CL("".replace),IL=CL("".slice),vae=/\$([$&'`]|\d{1,2})/g,Eae=vn,yae=Ye,AL=A,V6=cr,bae=ve,xae=Gr,wae=Mm,yv=Na,Sae=xo,Tae=RL,Rae=function(e,t,r,a,c,d){var h=r+e.length,f=a.length,m=vae;return _ae(d,m,function(v,E){var w;switch(NL(E,0)){case"$":return"$";case"&":return e;case"`":return IL(t,0,r);case"'":return IL(t,h);case"<":w=c[IL(E,1,-1)];break;default:var S=+E;if(S===0)return v;if(S>f){var R=gae(S/10);return R===0?v:R<=f?a[R-1]===void 0?NL(E,1):a[R-1]+NL(E,1):v}w=a[S-1]}return w===void 0?"":w})},Cae=Nr("replace"),Nae=TypeError,kL=AL("".indexOf),Iae=AL("".replace),F6=AL("".slice),Aae=Math.max;Eae({target:"String",proto:!0},{replaceAll:function(e,t){var r,a,c,d,h,f,m,v,E,w,S=V6(this),R=0,j="";if(xae(e)){if((r=wae(e))&&(a=yv(V6(Tae(e))),!~kL(a,"g")))throw new Nae("`.replaceAll` does not allow non-global regexes");if(c=Sae(e,Cae))return yae(c,e,S,t);if(r)return Iae(yv(S),e,t)}for(d=yv(S),h=yv(e),(f=bae(t))||(t=yv(t)),m=h.length,v=Aae(1,m),E=kL(d,h);E!==-1;)w=f?yv(t(h,E,d)):Rae(h,d,E,[],void 0,t),j+=F6(d,R,E)+w,R=E+m,E=E+v>d.length?-1:kL(d,h,E+v);return R<d.length&&(j+=F6(d,R)),j}});var kae=So("String","replaceAll"),Oae=M,Dae=kae,OL=String.prototype,Pae=function(e){var t=e.replaceAll;return typeof e=="string"||e===OL||Oae(OL,e)&&t===OL.replaceAll?Dae:t},Lae=u(Pae),DL=B;vn({global:!0,forced:DL.globalThis!==DL},{globalThis:DL});var B6=u(B),PL={exports:{}};(function(e,t){(function(r,a){var c="function",d="undefined",h="object",f="string",m="major",v="model",E="name",w="type",S="vendor",R="version",j="architecture",D="console",P="mobile",W="tablet",Y="smarttv",ne="wearable",le="embedded",fe="Amazon",ie="Apple",_e="ASUS",Te="BlackBerry",Ne="Browser",Ke="Chrome",St="Firefox",Et="Google",Vt="Honor",Ot="Huawei",Cn="LG",Er="Microsoft",Re="Motorola",je="Nvidia",Ze="OnePlus",Ce="Opera",O="OPPO",te="Samsung",oe="Sharp",Pe="Sony",Nt="Xiaomi",nr="Zebra",Ms="Facebook",Fc="Chromium OS",Cf="Mac OS",vA=" Browser",mE=function(Es){for(var Ss={},pr=0;pr<Es.length;pr++)Ss[Es[pr].toUpperCase()]=Es[pr];return Ss},EA=function(Es,Ss){return typeof Es===f&&e_(Ss).indexOf(e_(Es))!==-1},e_=function(Es){return Es.toLowerCase()},Nw=function(Es,Ss){if(typeof Es===f)return Es=Es.replace(/^\s\s*/,""),typeof Ss===d?Es:Es.substring(0,500)},t_=function(Es,Ss){for(var pr,ho,Pd,is,Vh,fn,Ld=0;Ld<Ss.length&&!Vh;){var n_=Ss[Ld],ju=Ss[Ld+1];for(pr=ho=0;pr<n_.length&&!Vh&&n_[pr];)if(Vh=n_[pr++].exec(Es))for(Pd=0;Pd<ju.length;Pd++)fn=Vh[++ho],typeof(is=ju[Pd])===h&&is.length>0?is.length===2?typeof is[1]==c?this[is[0]]=is[1].call(this,fn):this[is[0]]=is[1]:is.length===3?typeof is[1]!==c||is[1].exec&&is[1].test?this[is[0]]=fn?fn.replace(is[1],is[2]):a:this[is[0]]=fn?is[1].call(this,fn,is[2]):a:is.length===4&&(this[is[0]]=fn?is[3].call(this,fn.replace(is[1],is[2])):a):this[is]=fn||a;Ld+=2}},Nf=function(Es,Ss){for(var pr in Ss)if(typeof Ss[pr]===h&&Ss[pr].length>0){for(var ho=0;ho<Ss[pr].length;ho++)if(EA(Ss[pr][ho],Es))return pr==="?"?a:pr}else if(EA(Ss[pr],Es))return pr==="?"?a:pr;return Ss.hasOwnProperty("*")?Ss["*"]:Es},AY={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},kY={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[R,[E,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[R,[E,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[E,R],[/opios[\/ ]+([\w\.]+)/i],[R,[E,Ce+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[R,[E,Ce+" GX"]],[/\bopr\/([\w\.]+)/i],[R,[E,Ce]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[R,[E,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[R,[E,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[E,R],[/quark(?:pc)?\/([-\w\.]+)/i],[R,[E,"Quark"]],[/\bddg\/([\w\.]+)/i],[R,[E,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[R,[E,"UC"+Ne]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[R,[E,"WeChat"]],[/konqueror\/([\w\.]+)/i],[R,[E,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[R,[E,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[R,[E,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[R,[E,"Smart Lenovo "+Ne]],[/(avast|avg)\/([\w\.]+)/i],[[E,/(.+)/,"$1 Secure "+Ne],R],[/\bfocus\/([\w\.]+)/i],[R,[E,St+" Focus"]],[/\bopt\/([\w\.]+)/i],[R,[E,Ce+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[R,[E,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[R,[E,"Dolphin"]],[/coast\/([\w\.]+)/i],[R,[E,Ce+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[R,[E,"MIUI"+vA]],[/fxios\/([\w\.-]+)/i],[R,[E,St]],[/\bqihoobrowser\/?([\w\.]*)/i],[R,[E,"360"]],[/\b(qq)\/([\w\.]+)/i],[[E,/(.+)/,"$1Browser"],R],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[E,/(.+)/,"$1"+vA],R],[/samsungbrowser\/([\w\.]+)/i],[R,[E,te+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[R,[E,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[E,"Sogou Mobile"],R],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[E,R],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[E],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[R,E],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[E,Ms],R],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[E,R],[/\bgsa\/([\w\.]+) .*safari\//i],[R,[E,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[R,[E,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[R,[E,Ke+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[E,Ke+" WebView"],R],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[R,[E,"Android "+Ne]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[E,R],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[R,[E,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[R,E],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[E,[R,Nf,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[E,R],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[E,"Netscape"],R],[/(wolvic|librewolf)\/([\w\.]+)/i],[E,R],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[R,[E,St+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[E,[R,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[E,[R,/master.|lts./,""]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[j,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[j,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[j,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[j,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[j,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[j,/ower/,"",e_]],[/ sun4\w[;\)]/i],[[j,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[j,e_]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[v,[S,te],[w,W]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[v,[S,te],[w,P]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[v,[S,ie],[w,P]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[v,[S,ie],[w,W]],[/(macintosh);/i],[v,[S,ie]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[v,[S,oe],[w,P]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[v,[S,Vt],[w,W]],[/honor([-\w ]+)[;\)]/i],[v,[S,Vt],[w,P]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[v,[S,Ot],[w,W]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[v,[S,Ot],[w,P]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[v,/_/g," "],[S,Nt],[w,W]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[v,/_/g," "],[S,Nt],[w,P]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[v,[S,O],[w,P]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[v,[S,Nf,{OnePlus:["304","403","203"],"*":O}],[w,W]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[v,[S,"Vivo"],[w,P]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[v,[S,"Realme"],[w,P]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[v,[S,Re],[w,P]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[v,[S,Re],[w,W]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[v,[S,Cn],[w,W]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv|watch)\w+)/i,/\blg-?([\d\w]+) bui/i],[v,[S,Cn],[w,P]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[v,[S,"Lenovo"],[w,W]],[/(nokia) (t[12][01])/i],[S,v,[w,W]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[v,/_/g," "],[w,P],[S,"Nokia"]],[/(pixel (c|tablet))\b/i],[v,[S,Et],[w,W]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[v,[S,Et],[w,P]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[v,[S,Pe],[w,P]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[v,"Xperia Tablet"],[S,Pe],[w,W]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[v,[S,Ze],[w,P]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[v,[S,fe],[w,W]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[v,/(.+)/g,"Fire Phone $1"],[S,fe],[w,P]],[/(playbook);[-\w\),; ]+(rim)/i],[v,S,[w,W]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[v,[S,Te],[w,P]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[v,[S,_e],[w,W]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[v,[S,_e],[w,P]],[/(nexus 9)/i],[v,[S,"HTC"],[w,W]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[S,[v,/_/g," "],[w,P]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[v,[S,"TCL"],[w,W]],[/(itel) ((\w+))/i],[[S,e_],v,[w,Nf,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[v,[S,"Acer"],[w,W]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[v,[S,"Meizu"],[w,P]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[v,[S,"Ulefone"],[w,P]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[v,[S,"Energizer"],[w,P]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[v,[S,"Cat"],[w,P]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[v,[S,"Smartfren"],[w,P]],[/droid.+; (a(?:015|06[35]|142p?))/i],[v,[S,"Nothing"],[w,P]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[v,[S,"Archos"],[w,W]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[v,[S,"Archos"],[w,P]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[S,v,[w,W]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (hmd|imo) ([\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[S,v,[w,P]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[S,v,[w,W]],[/(surface duo)/i],[v,[S,Er],[w,W]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[v,[S,"Fairphone"],[w,P]],[/(u304aa)/i],[v,[S,"AT&T"],[w,P]],[/\bsie-(\w*)/i],[v,[S,"Siemens"],[w,P]],[/\b(rct\w+) b/i],[v,[S,"RCA"],[w,W]],[/\b(venue[\d ]{2,7}) b/i],[v,[S,"Dell"],[w,W]],[/\b(q(?:mv|ta)\w+) b/i],[v,[S,"Verizon"],[w,W]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[v,[S,"Barnes & Noble"],[w,W]],[/\b(tm\d{3}\w+) b/i],[v,[S,"NuVision"],[w,W]],[/\b(k88) b/i],[v,[S,"ZTE"],[w,W]],[/\b(nx\d{3}j) b/i],[v,[S,"ZTE"],[w,P]],[/\b(gen\d{3}) b.+49h/i],[v,[S,"Swiss"],[w,P]],[/\b(zur\d{3}) b/i],[v,[S,"Swiss"],[w,W]],[/\b((zeki)?tb.*\b) b/i],[v,[S,"Zeki"],[w,W]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[S,"Dragon Touch"],v,[w,W]],[/\b(ns-?\w{0,9}) b/i],[v,[S,"Insignia"],[w,W]],[/\b((nxa|next)-?\w{0,9}) b/i],[v,[S,"NextBook"],[w,W]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[S,"Voice"],v,[w,P]],[/\b(lvtel\-)?(v1[12]) b/i],[[S,"LvTel"],v,[w,P]],[/\b(ph-1) /i],[v,[S,"Essential"],[w,P]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[v,[S,"Envizen"],[w,W]],[/\b(trio[-\w\. ]+) b/i],[v,[S,"MachSpeed"],[w,W]],[/\btu_(1491) b/i],[v,[S,"Rotor"],[w,W]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[v,[S,je],[w,W]],[/(sprint) (\w+)/i],[S,v,[w,P]],[/(kin\.[onetw]{3})/i],[[v,/\./g," "],[S,Er],[w,P]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[v,[S,nr],[w,W]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[v,[S,nr],[w,P]],[/smart-tv.+(samsung)/i],[S,[w,Y]],[/hbbtv.+maple;(\d+)/i],[[v,/^/,"SmartTV"],[S,te],[w,Y]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[S,Cn],[w,Y]],[/(apple) ?tv/i],[S,[v,ie+" TV"],[w,Y]],[/crkey/i],[[v,Ke+"cast"],[S,Et],[w,Y]],[/droid.+aft(\w+)( bui|\))/i],[v,[S,fe],[w,Y]],[/(shield \w+ tv)/i],[v,[S,je],[w,Y]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[v,[S,oe],[w,Y]],[/(bravia[\w ]+)( bui|\))/i],[v,[S,Pe],[w,Y]],[/(mi(tv|box)-?\w+) bui/i],[v,[S,Nt],[w,Y]],[/Hbbtv.*(technisat) (.*);/i],[S,v,[w,Y]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[S,Nw],[v,Nw],[w,Y]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[v,[w,Y]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[w,Y]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[S,v,[w,D]],[/droid.+; (shield)( bui|\))/i],[v,[S,je],[w,D]],[/(playstation \w+)/i],[v,[S,Pe],[w,D]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[v,[S,Er],[w,D]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[v,[S,te],[w,ne]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[S,v,[w,ne]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[v,[S,O],[w,ne]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[v,[S,ie],[w,ne]],[/(opwwe\d{3})/i],[v,[S,Ze],[w,ne]],[/(moto 360)/i],[v,[S,Re],[w,ne]],[/(smartwatch 3)/i],[v,[S,Pe],[w,ne]],[/(g watch r)/i],[v,[S,Cn],[w,ne]],[/droid.+; (wt63?0{2,3})\)/i],[v,[S,nr],[w,ne]],[/droid.+; (glass) \d/i],[v,[S,Et],[w,ne]],[/(pico) (4|neo3(?: link|pro)?)/i],[S,v,[w,ne]],[/; (quest( \d| pro)?)/i],[v,[S,Ms],[w,ne]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[S,[w,le]],[/(aeobc)\b/i],[v,[S,fe],[w,le]],[/(homepod).+mac os/i],[v,[S,ie],[w,le]],[/windows iot/i],[[w,le]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[v,[w,P]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[v,[w,W]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[w,W]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[w,P]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[v,[S,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[R,[E,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[E,R],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[R,[E,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[E,R],[/ladybird\//i],[[E,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[R,E]],os:[[/microsoft (windows) (vista|xp)/i],[E,R],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[E,[R,Nf,AY]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[R,Nf,AY],[E,"Windows"]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[R,/_/g,"."],[E,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[E,Cf],[R,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[R,E],[/(ubuntu) ([\w\.]+) like android/i],[[E,/(.+)/,"$1 Touch"],R],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/; ]?([\d\.]*)/i],[E,R],[/\(bb(10);/i],[R,[E,Te]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[R,[E,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[R,[E,St+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[R,[E,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[R,[E,"watchOS"]],[/crkey\/([\d\.]+)/i],[R,[E,Ke+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[E,Fc],R],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[E,R],[/(sunos) ?([\w\.\d]*)/i],[[E,"Solaris"],R],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[E,R]]},Dd=function(Es,Ss){if(typeof Es===h&&(Ss=Es,Es=a),!(this instanceof Dd))return new Dd(Es,Ss).getResult();var pr=typeof r!==d&&r.navigator?r.navigator:a,ho=Es||(pr&&pr.userAgent?pr.userAgent:""),Pd=pr&&pr.userAgentData?pr.userAgentData:a,is=Ss?function(fn,Ld){var n_={};for(var ju in fn)Ld[ju]&&Ld[ju].length%2==0?n_[ju]=Ld[ju].concat(fn[ju]):n_[ju]=fn[ju];return n_}(kY,Ss):kY,Vh=pr&&pr.userAgent==ho;return this.getBrowser=function(){var fn={};return fn[E]=a,fn[R]=a,t_.call(fn,ho,is.browser),fn[m]=function(Ld){return typeof Ld===f?Ld.replace(/[^\d\.]/g,"").split(".")[0]:a}(fn[R]),Vh&&pr&&pr.brave&&typeof pr.brave.isBrave==c&&(fn[E]="Brave"),fn},this.getCPU=function(){var fn={};return fn[j]=a,t_.call(fn,ho,is.cpu),fn},this.getDevice=function(){var fn={};return fn[S]=a,fn[v]=a,fn[w]=a,t_.call(fn,ho,is.device),Vh&&!fn[w]&&Pd&&Pd.mobile&&(fn[w]=P),Vh&&fn[v]=="Macintosh"&&pr&&typeof pr.standalone!==d&&pr.maxTouchPoints&&pr.maxTouchPoints>2&&(fn[v]="iPad",fn[w]=W),fn},this.getEngine=function(){var fn={};return fn[E]=a,fn[R]=a,t_.call(fn,ho,is.engine),fn},this.getOS=function(){var fn={};return fn[E]=a,fn[R]=a,t_.call(fn,ho,is.os),Vh&&!fn[E]&&Pd&&Pd.platform&&Pd.platform!="Unknown"&&(fn[E]=Pd.platform.replace(/chrome os/i,Fc).replace(/macos/i,Cf)),fn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ho},this.setUA=function(fn){return ho=typeof fn===f&&fn.length>500?Nw(fn,500):fn,this},this.setUA(ho),this};Dd.VERSION="0.7.41",Dd.BROWSER=mE([E,R,m]),Dd.CPU=mE([j]),Dd.DEVICE=mE([v,S,w,D,P,Y,W,ne,le]),Dd.ENGINE=Dd.OS=mE([E,R]),e.exports&&(t=e.exports=Dd),t.UAParser=Dd;var gE=typeof r!==d&&(r.jQuery||r.Zepto);if(gE&&!gE.ua){var yA=new Dd;gE.ua=yA.getResult(),gE.ua.get=function(){return yA.getUA()},gE.ua.set=function(Es){yA.setUA(Es);var Ss=yA.getResult();for(var pr in Ss)gE.ua[pr]=Ss[pr]}}})(typeof window=="object"?window:l)})(PL,PL.exports);var jae=u(PL.exports),z6=W0.clear;vn({global:!0,bind:!0,forced:B.clearImmediate!==z6},{clearImmediate:z6});var G6=B,Mae=ee,Uae=ve,Vae=d0,Fae=Sr,Bae=hu,zae=pu,Gae=G6.Function,Wae=/MSIE .\./.test(Fae)||Vae==="BUN"&&function(){var e=G6.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")}(),Hae=vn,W6=B,H6=W0.set,Kae=function(e,t){var r=1;return Wae?function(a,c){var d=zae(arguments.length,1)>r,h=Uae(a)?a:Gae(a),f=d?Bae(arguments,r):[],m=d?function(){Mae(h,this,f)}:h;return e(m)}:e},K6=W6.setImmediate?Kae(H6):H6;Hae({global:!0,bind:!0,forced:W6.setImmediate!==K6},{setImmediate:K6});var q6=u(qt.setImmediate),qae=B,Yae=XR,Xae=Wr,$ae=pu,Jae=qe;vn({global:!0,dontCallGetSet:!0,forced:p(function(){return Jae&&Object.getOwnPropertyDescriptor(qae,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){$ae(arguments.length,1),Yae(Xae(e))}});var Y6=u(qt.queueMicrotask);function X6(e,t){return function(){return e.apply(t,arguments)}}const{toString:Qae}=Object.prototype,{getPrototypeOf:LL}=Object,{iterator:EN,toStringTag:$6}=Symbol,yN=(jL=Object.create(null),e=>{const t=Qae.call(e);return jL[t]||(jL[t]=t.slice(8,-1).toLowerCase())});var jL;const md=e=>(e=e.toLowerCase(),t=>yN(t)===e),bN=e=>t=>typeof t===e,{isArray:bv}=Array,xv=bN("undefined");function Rx(e){return e!==null&&!xv(e)&&e.constructor!==null&&!xv(e.constructor)&&Qo(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const J6=md("ArrayBuffer"),Zae=bN("string"),Qo=bN("function"),Q6=bN("number"),Cx=e=>e!==null&&typeof e=="object",xN=e=>{if(yN(e)!=="object")return!1;const t=LL(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||$6 in e||EN in e)},eoe=md("Date"),toe=md("File"),noe=md("Blob"),roe=md("FileList"),soe=md("URLSearchParams"),[ioe,aoe,ooe,coe]=["ReadableStream","Request","Response","Headers"].map(md);function Nx(e,t){let r,a,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),bv(e))for(r=0,a=e.length;r<a;r++)t.call(null,e[r],r,e);else{if(Rx(e))return;const d=c?Object.getOwnPropertyNames(e):Object.keys(e),h=d.length;let f;for(r=0;r<h;r++)f=d[r],t.call(null,e[f],f,e)}}function Z6(e,t){if(Rx(e))return null;t=t.toLowerCase();const r=Object.keys(e);let a,c=r.length;for(;c-- >0;)if(a=r[c],t===a.toLowerCase())return a;return null}const vg=B6!==void 0?B6:typeof self<"u"?self:typeof window<"u"?window:Gh,e8=e=>!xv(e)&&e!==vg,loe=(ML=typeof Uint8Array<"u"&&LL(Uint8Array),e=>ML&&e instanceof ML);var ML;const doe=md("HTMLFormElement"),t8=(e=>{let{hasOwnProperty:t}=e;return(r,a)=>t.call(r,a)})(Object.prototype),uoe=md("RegExp"),n8=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),a={};Nx(r,(c,d)=>{let h;(h=t(c,d,e))!==!1&&(a[d]=h||c)}),Object.defineProperties(e,a)},hoe=md("AsyncFunction"),r8=(s8=typeof q6=="function",i8=Qo(vg.postMessage),s8?q6:i8?(UL="axios@".concat(Math.random()),wN=[],vg.addEventListener("message",e=>{let{source:t,data:r}=e;t===vg&&r===UL&&wN.length&&wN.shift()()},!1),e=>{wN.push(e),vg.postMessage(UL,"*")}):e=>setTimeout(e));var s8,i8,UL,wN;const poe=Y6!==void 0?Y6.bind(vg):typeof process<"u"&&process.nextTick||r8;var Be={isArray:bv,isArrayBuffer:J6,isBuffer:Rx,isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Qo(e.append)&&((t=yN(e))==="formdata"||t==="object"&&Qo(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&J6(e.buffer),t},isString:Zae,isNumber:Q6,isBoolean:e=>e===!0||e===!1,isObject:Cx,isPlainObject:xN,isEmptyObject:e=>{if(!Cx(e)||Rx(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},isReadableStream:ioe,isRequest:aoe,isResponse:ooe,isHeaders:coe,isUndefined:xv,isDate:eoe,isFile:toe,isBlob:noe,isRegExp:uoe,isFunction:Qo,isStream:e=>Cx(e)&&Qo(e.pipe),isURLSearchParams:soe,isTypedArray:loe,isFileList:roe,forEach:Nx,merge:function e(){const{caseless:t,skipUndefined:r}=e8(this)&&this||{},a={},c=(d,h)=>{const f=t&&Z6(a,h)||h;xN(a[f])&&xN(d)?a[f]=e(a[f],d):xN(d)?a[f]=e({},d):bv(d)?a[f]=d.slice():r&&xv(d)||(a[f]=d)};for(let d=0,h=arguments.length;d<h;d++)arguments[d]&&Nx(arguments[d],c);return a},extend:function(e,t,r){let{allOwnKeys:a}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Nx(t,(c,d)=>{r&&Qo(c)?e[d]=X6(c,r):e[d]=c},{allOwnKeys:a}),e},trim:e=>ha(e)?ha(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,r,a)=>{e.prototype=Object.create(t.prototype,a),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},toFlatObject:(e,t,r,a)=>{let c,d,h;const f={};if(t=t||{},e==null)return t;do{for(c=Object.getOwnPropertyNames(e),d=c.length;d-- >0;)h=c[d],a&&!a(h,e,t)||f[h]||(t[h]=e[h],f[h]=!0);e=r!==!1&&LL(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:yN,kindOfTest:md,endsWith:(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;const a=e.indexOf(t,r);return a!==-1&&a===r},toArray:e=>{if(!e)return null;if(bv(e))return e;let t=e.length;if(!Q6(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},forEachEntry:(e,t)=>{const r=(e&&e[EN]).call(e);let a;for(;(a=r.next())&&!a.done;){const c=a.value;t.call(e,c[0],c[1])}},matchAll:(e,t)=>{let r;const a=[];for(;(r=e.exec(t))!==null;)a.push(r);return a},isHTMLForm:doe,hasOwnProperty:t8,hasOwnProp:t8,reduceDescriptors:n8,freezeMethods:e=>{n8(e,(t,r)=>{if(Qo(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const a=e[r];Qo(a)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")}))})},toObjectSet:(e,t)=>{const r={},a=c=>{c.forEach(d=>{r[d]=!0})};return bv(e)?a(e):a(String(e).split(t)),r},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,a){return r.toUpperCase()+a}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:Z6,global:vg,isContextDefined:e8,isSpecCompliantForm:function(e){return!!(e&&Qo(e.append)&&e[$6]==="FormData"&&e[EN])},toJSONObject:e=>{const t=new Array(10),r=(a,c)=>{if(Cx(a)){if(t.indexOf(a)>=0)return;if(Rx(a))return a;if(!("toJSON"in a)){t[c]=a;const d=bv(a)?[]:{};return Nx(a,(h,f)=>{const m=r(h,c+1);!xv(m)&&(d[f]=m)}),t[c]=void 0,d}}return a};return r(e,0)},isAsyncFn:hoe,isThenable:e=>e&&(Cx(e)||Qo(e))&&Qo(e.then)&&Qo(e.catch),setImmediate:r8,asap:poe,isIterable:e=>e!=null&&Qo(e[EN])};function Yn(e,t,r,a,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),a&&(this.request=a),c&&(this.response=c,this.status=c.status?c.status:null)}Be.inherits(Yn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Be.toJSONObject(this.config),code:this.code,status:this.status}}});const a8=Yn.prototype,o8={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{o8[e]={value:e}}),Object.defineProperties(Yn,o8),Object.defineProperty(a8,"isAxiosError",{value:!0}),Yn.from=(e,t,r,a,c,d)=>{const h=Object.create(a8);Be.toFlatObject(e,h,function(v){return v!==Error.prototype},v=>v!=="isAxiosError");const f=e&&e.message?e.message:"Error",m=t==null&&e?e.code:t;return Yn.call(h,f,m,r,a,c),e&&h.cause==null&&Object.defineProperty(h,"cause",{value:e,configurable:!0}),h.name=e&&e.name||"Error",d&&Object.assign(h,d),h};function VL(e){return Be.isPlainObject(e)||Be.isArray(e)}function c8(e){return Be.endsWith(e,"[]")?e.slice(0,-2):e}function l8(e,t,r){return e?e.concat(t).map(function(a,c){return a=c8(a),!r&&c?"["+a+"]":a}).join(r?".":""):t}const foe=Be.toFlatObject(Be,{},null,function(e){return/^is[A-Z]/.test(e)});function SN(e,t,r){if(!Be.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const a=(r=Be.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(S,R){return!Be.isUndefined(R[S])})).metaTokens,c=r.visitor||v,d=r.dots,h=r.indexes,f=(r.Blob||typeof Blob<"u"&&Blob)&&Be.isSpecCompliantForm(t);if(!Be.isFunction(c))throw new TypeError("visitor must be a function");function m(S){if(S===null)return"";if(Be.isDate(S))return S.toISOString();if(Be.isBoolean(S))return S.toString();if(!f&&Be.isBlob(S))throw new Yn("Blob is not supported. Use a Buffer instead.");return Be.isArrayBuffer(S)||Be.isTypedArray(S)?f&&typeof Blob=="function"?new Blob([S]):Buffer.from(S):S}function v(S,R,j){let D=S;if(S&&!j&&typeof S=="object"){if(Be.endsWith(R,"{}"))R=a?R:R.slice(0,-2),S=JSON.stringify(S);else if(Be.isArray(S)&&function(P){return Be.isArray(P)&&!P.some(VL)}(S)||(Be.isFileList(S)||Be.endsWith(R,"[]"))&&(D=Be.toArray(S)))return R=c8(R),D.forEach(function(P,W){!Be.isUndefined(P)&&P!==null&&t.append(h===!0?l8([R],W,d):h===null?R:R+"[]",m(P))}),!1}return!!VL(S)||(t.append(l8(j,R,d),m(S)),!1)}const E=[],w=Object.assign(foe,{defaultVisitor:v,convertValue:m,isVisitable:VL});if(!Be.isObject(e))throw new TypeError("data must be an object");return function S(R,j){if(!Be.isUndefined(R)){if(E.indexOf(R)!==-1)throw Error("Circular reference detected in "+j.join("."));E.push(R),Be.forEach(R,function(D,P){(!(Be.isUndefined(D)||D===null)&&c.call(t,D,Be.isString(P)?ha(P).call(P):P,j,w))===!0&&S(D,j?j.concat(P):[P])}),E.pop()}}(e),t}function d8(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(r){return t[r]})}function FL(e,t){this._pairs=[],e&&SN(e,this,t)}const u8=FL.prototype;function moe(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function h8(e,t,r){if(!t)return e;const a=r&&r.encode||moe;Be.isFunction(r)&&(r={serialize:r});const c=r&&r.serialize;let d;if(d=c?c(t,r):Be.isURLSearchParams(t)?t.toString():new FL(t,r).toString(a),d){const h=e.indexOf("#");h!==-1&&(e=e.slice(0,h)),e+=(e.indexOf("?")===-1?"?":"&")+d}return e}u8.append=function(e,t){this._pairs.push([e,t])},u8.toString=function(e){const t=e?function(r){return e.call(this,r,d8)}:d8;return this._pairs.map(function(r){return t(r[0])+"="+t(r[1])},"").join("&")};var p8=class{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Be.forEach(this.handlers,function(t){t!==null&&e(t)})}},f8={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},m8={exports:{}},goe=vn,_oe=qe,g8=eo.f;goe({target:"Object",stat:!0,forced:Object.defineProperty!==g8,sham:!_oe},{defineProperty:g8});var _8=qt.Object,voe=m8.exports=function(e,t,r){return _8.defineProperty(e,t,r)};_8.defineProperty.sham&&(voe.sham=!0);var v8=u(m8.exports),Eoe=TypeError,E8=nu,yoe=G0,boe=Gr,xoe=Nr("species"),y8=Array,woe=function(e){var t;return E8(e)&&(t=e.constructor,(yoe(t)&&(t===y8||E8(t.prototype))||boe(t)&&(t=t[xoe])===null)&&(t=void 0)),t===void 0?y8:t},b8=function(e,t){return new(woe(e))(t===0?0:t)},Soe=p,Toe=_n,Roe=Nr("species"),x8=function(e){return Toe>=51||!Soe(function(){var t=[];return(t.constructor={})[Roe]=function(){return{foo:1}},t[e](Boolean).foo!==1})},Coe=vn,Noe=p,Ioe=nu,Aoe=Gr,koe=Wo,Ooe=Vn,w8=function(e){if(e>9007199254740991)throw Eoe("Maximum allowed index exceeded");return e},S8=X2,Doe=b8,Poe=x8,Loe=_n,T8=Nr("isConcatSpreadable"),joe=Loe>=51||!Noe(function(){var e=[];return e[T8]=!1,e.concat()[0]!==e}),Moe=function(e){if(!Aoe(e))return!1;var t=e[T8];return t!==void 0?!!t:Ioe(e)};Coe({target:"Array",proto:!0,forced:!joe||!Poe("concat")},{concat:function(e){var t,r,a,c,d,h=koe(this),f=Doe(h,0),m=0;for(t=-1,a=arguments.length;t<a;t++)if(Moe(d=t===-1?h:arguments[t]))for(c=Ooe(d),w8(m+c),r=0;r<c;r++,m++)r in d&&S8(f,m,d[r]);else w8(m+1),S8(f,m++,d);return f.length=m,f}});var R8={},Uoe=Q,Voe=Oi,C8=g0.f,Foe=hu,N8=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];R8.f=function(e){return N8&&Uoe(e)==="Window"?function(t){try{return C8(t)}catch{return Foe(N8)}}(e):C8(Voe(e))};var wv={},Boe=Nr;wv.f=Boe;var I8=qt,zoe=Ns,Goe=wv,Woe=eo.f,ni=function(e){var t=I8.Symbol||(I8.Symbol={});zoe(t,e)||Woe(t,e,{value:Goe.f(e)})},Hoe=Ye,Koe=gr,qoe=Nr,Yoe=od,A8=function(){var e=Koe("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,a=qoe("toPrimitive");t&&!t[a]&&Yoe(t,a,function(c){return Hoe(r,this)},{})},Xoe=cl,$oe=Wt,Joe=Wo,Qoe=Vn,Zoe=b8,k8=A([].push),ece=function(e){var t=e===1,r=e===2,a=e===3,c=e===4,d=e===6,h=e===7,f=e===5||d;return function(m,v,E,w){for(var S,R,j=Joe(m),D=$oe(j),P=Qoe(D),W=Xoe(v,E),Y=0,ne=w||Zoe,le=t?ne(m,P):r||h?ne(m,0):void 0;P>Y;Y++)if((f||Y in D)&&(R=W(S=D[Y],Y,j),e))if(t)le[Y]=R;else if(R)switch(e){case 3:return!0;case 5:return S;case 6:return Y;case 2:k8(le,S)}else switch(e){case 4:return!1;case 7:k8(le,S)}return d?-1:a||c?c:le}},O8={forEach:ece(0)},TN=vn,Ix=B,BL=Ye,tce=A,Sv=qe,Tv=sn,nce=p,pa=Ns,rce=M,zL=hi,RN=Oi,GL=xc,sce=Na,WL=mn,Rv=Fp,D8=_0,ice=g0,P8=R8,ace=Hm,L8=ge,j8=eo,oce=Ro,M8=ze,U8=od,cce=uu,HL=rl,V8=ul,F8=yp,lce=Nr,dce=wv,uce=ni,hce=A8,pce=ml,B8=da,CN=O8.forEach,Zo=Dp("hidden"),NN="Symbol",Ax="prototype",fce=B8.set,z8=B8.getterFor(NN),gd=Object[Ax],Eg=Ix.Symbol,IN=Eg&&Eg[Ax],mce=Ix.RangeError,gce=Ix.TypeError,KL=Ix.QObject,G8=L8.f,yg=j8.f,W8=P8.f,_ce=M8.f,H8=tce([].push),Nh=HL("symbols"),kx=HL("op-symbols"),vce=HL("wks"),qL=!KL||!KL[Ax]||!KL[Ax].findChild,K8=function(e,t,r){var a=G8(gd,t);a&&delete gd[t],yg(e,t,r),a&&e!==gd&&yg(gd,t,a)},YL=Sv&&nce(function(){return Rv(yg({},"a",{get:function(){return yg(this,"a",{value:7}).a}})).a!==7})?K8:yg,XL=function(e,t){var r=Nh[e]=Rv(IN);return fce(r,{type:NN,tag:e,description:t}),Sv||(r.description=t),r},AN=function(e,t,r){e===gd&&AN(kx,t,r),zL(e);var a=GL(t);return zL(r),pa(Nh,a)?(r.enumerable?(pa(e,Zo)&&e[Zo][a]&&(e[Zo][a]=!1),r=Rv(r,{enumerable:WL(0,!1)})):(pa(e,Zo)||yg(e,Zo,WL(1,Rv(null))),e[Zo][a]=!0),YL(e,a,r)):yg(e,a,r)},$L=function(e,t){zL(e);var r=RN(t),a=D8(r).concat($8(r));return CN(a,function(c){Sv&&!BL(q8,r,c)||AN(e,c,r[c])}),e},q8=function(e){var t=GL(e),r=BL(_ce,this,t);return!(this===gd&&pa(Nh,t)&&!pa(kx,t))&&(!(r||!pa(this,t)||!pa(Nh,t)||pa(this,Zo)&&this[Zo][t])||r)},Y8=function(e,t){var r=RN(e),a=GL(t);if(r!==gd||!pa(Nh,a)||pa(kx,a)){var c=G8(r,a);return!c||!pa(Nh,a)||pa(r,Zo)&&r[Zo][a]||(c.enumerable=!0),c}},X8=function(e){var t=W8(RN(e)),r=[];return CN(t,function(a){pa(Nh,a)||pa(V8,a)||H8(r,a)}),r},$8=function(e){var t=e===gd,r=W8(t?kx:RN(e)),a=[];return CN(r,function(c){!pa(Nh,c)||t&&!pa(gd,c)||H8(a,Nh[c])}),a};Tv||(Eg=function(){if(rce(IN,this))throw new gce("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?sce(arguments[0]):void 0,t=F8(e),r=function(a){var c=this===void 0?Ix:this;c===gd&&BL(r,kx,a),pa(c,Zo)&&pa(c[Zo],t)&&(c[Zo][t]=!1);var d=WL(1,a);try{YL(c,t,d)}catch(h){if(!(h instanceof mce))throw h;K8(c,t,d)}};return Sv&&qL&&YL(gd,t,{configurable:!0,set:r}),XL(t,e)},U8(IN=Eg[Ax],"toString",function(){return z8(this).tag}),U8(Eg,"withoutSetter",function(e){return XL(F8(e),e)}),M8.f=q8,j8.f=AN,oce.f=$L,L8.f=Y8,ice.f=P8.f=X8,ace.f=$8,dce.f=function(e){return XL(lce(e),e)},Sv&&cce(IN,"description",{configurable:!0,get:function(){return z8(this).description}})),TN({global:!0,wrap:!0,forced:!Tv,sham:!Tv},{Symbol:Eg}),CN(D8(vce),function(e){uce(e)}),TN({target:NN,stat:!0,forced:!Tv},{useSetter:function(){qL=!0},useSimple:function(){qL=!1}}),TN({target:"Object",stat:!0,forced:!Tv,sham:!Sv},{create:function(e,t){return t===void 0?Rv(e):$L(Rv(e),t)},defineProperty:AN,defineProperties:$L,getOwnPropertyDescriptor:Y8}),TN({target:"Object",stat:!0,forced:!Tv},{getOwnPropertyNames:X8}),hce(),pce(Eg,NN),V8[Zo]=!0;var J8=sn&&!!Symbol.for&&!!Symbol.keyFor,Ece=vn,yce=gr,bce=Ns,xce=Na,Q8=rl,wce=J8,JL=Q8("string-to-symbol-registry"),Sce=Q8("symbol-to-string-registry");Ece({target:"Symbol",stat:!0,forced:!wce},{for:function(e){var t=xce(e);if(bce(JL,t))return JL[t];var r=yce("Symbol")(t);return JL[t]=r,Sce[r]=t,r}});var Tce=vn,Rce=Ns,Cce=bo,Nce=yc,Ice=J8,Z8=rl("symbol-to-string-registry");Tce({target:"Symbol",stat:!0,forced:!Ice},{keyFor:function(e){if(!Cce(e))throw new TypeError(Nce(e)+" is not a symbol");if(Rce(Z8,e))return Z8[e]}});var ez=nu,Ace=ve,tz=Q,kce=Na,nz=A([].push),Oce=vn,rz=gr,sz=ee,Dce=Ye,Ox=A,iz=p,az=ve,oz=bo,cz=hu,Pce=function(e){if(Ace(e))return e;if(ez(e)){for(var t=e.length,r=[],a=0;a<t;a++){var c=e[a];typeof c=="string"?nz(r,c):typeof c!="number"&&tz(c)!=="Number"&&tz(c)!=="String"||nz(r,kce(c))}var d=r.length,h=!0;return function(f,m){if(h)return h=!1,m;if(ez(this))return m;for(var v=0;v<d;v++)if(r[v]===f)return m}}},Lce=sn,jce=String,of=rz("JSON","stringify"),kN=Ox(/./.exec),lz=Ox("".charAt),Mce=Ox("".charCodeAt),Uce=Ox("".replace),Vce=Ox(1.1.toString),Fce=/[\uD800-\uDFFF]/g,dz=/^[\uD800-\uDBFF]$/,uz=/^[\uDC00-\uDFFF]$/,hz=!Lce||iz(function(){var e=rz("Symbol")("stringify detection");return of([e])!=="[null]"||of({a:e})!=="{}"||of(Object(e))!=="{}"}),pz=iz(function(){return of("\uDF06\uD834")!=='"\\udf06\\ud834"'||of("\uDEAD")!=='"\\udead"'}),Bce=function(e,t){var r=cz(arguments),a=Pce(t);if(az(a)||e!==void 0&&!oz(e))return r[1]=function(c,d){if(az(a)&&(d=Dce(a,this,jce(c),d)),!oz(d))return d},sz(of,null,r)},zce=function(e,t,r){var a=lz(r,t-1),c=lz(r,t+1);return kN(dz,e)&&!kN(uz,c)||kN(uz,e)&&!kN(dz,a)?"\\u"+Vce(Mce(e,0),16):e};of&&Oce({target:"JSON",stat:!0,forced:hz||pz},{stringify:function(e,t,r){var a=cz(arguments),c=sz(hz?Bce:of,null,a);return pz&&typeof c=="string"?Uce(c,Fce,zce):c}});var fz=Hm,Gce=Wo;vn({target:"Object",stat:!0,forced:!sn||p(function(){fz.f(1)})},{getOwnPropertySymbols:function(e){var t=fz.f;return t?t(Gce(e)):[]}}),ni("asyncDispose"),ni("asyncIterator"),ni("dispose"),ni("hasInstance"),ni("isConcatSpreadable"),ni("iterator"),ni("match"),ni("matchAll"),ni("replace"),ni("search"),ni("species"),ni("split");var Wce=A8;ni("toPrimitive"),Wce();var Hce=gr,Kce=ml;ni("toStringTag"),Kce(Hce("Symbol"),"Symbol"),ni("unscopables"),ml(B.JSON,"JSON",!0);var qce=qt.Symbol,Yce=Nr,Xce=eo.f,mz=Yce("metadata"),gz=Function.prototype;gz[mz]===void 0&&Xce(gz,mz,{value:null}),ni("metadata");var $ce=qce,Jce=A,QL=gr("Symbol"),Qce=QL.keyFor,Zce=Jce(QL.prototype.valueOf),_z=QL.isRegisteredSymbol||function(e){try{return Qce(Zce(e))!==void 0}catch{return!1}};vn({target:"Symbol",stat:!0},{isRegisteredSymbol:_z});for(var ele=rl,vz=gr,tle=A,nle=bo,rle=Nr,ON=vz("Symbol"),Ez=ON.isWellKnownSymbol,yz=vz("Object","getOwnPropertyNames"),sle=tle(ON.prototype.valueOf),bz=ele("wks"),ZL=0,xz=yz(ON),ile=xz.length;ZL<ile;ZL++)try{var wz=xz[ZL];nle(ON[wz])&&rle(wz)}catch{}var Sz=function(e){if(Ez&&Ez(e))return!0;try{for(var t=sle(e),r=0,a=yz(bz),c=a.length;r<c;r++)if(bz[a[r]]==t)return!0}catch{}return!1};vn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:Sz}),ni("customMatcher"),ni("observable"),vn({target:"Symbol",stat:!0},{isRegistered:_z}),vn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:Sz}),ni("matcher"),ni("metadataKey"),ni("patternMatch"),ni("replaceAll");var Cv=u($ce),Tz=u(wv.f("iterator"));function Dx(e){return Dx=typeof Cv=="function"&&typeof Tz=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Cv=="function"&&t.constructor===Cv&&t!==Cv.prototype?"symbol":typeof t},Dx(e)}var ale=u(wv.f("toPrimitive"));function ole(e){var t=function(r,a){if(Dx(r)!="object"||!r)return r;var c=r[ale];if(c!==void 0){var d=c.call(r,a);if(Dx(d)!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(r)}(e,"string");return Dx(t)=="symbol"?t:t+""}function L(e,t,r){return(t=ole(t))in e?v8(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Rz=u(Dse),cle={isBrowser:!0,classes:{URLSearchParams:Rz!==void 0?Rz:FL,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const ej=typeof window<"u"&&typeof document<"u",tj=typeof navigator=="object"&&navigator||void 0,lle=ej&&(!tj||["ReactNative","NativeScript","NS"].indexOf(tj.product)<0),dle=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",ule=ej&&window.location.href||"http://localhost";function Cz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function Nz(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Cz(Object(r),!0).forEach(function(a){L(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Cz(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}var ao=Nz(Nz({},Object.freeze({__proto__:null,hasBrowserEnv:ej,hasStandardBrowserEnv:lle,hasStandardBrowserWebWorkerEnv:dle,navigator:tj,origin:ule})),cle);function Iz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function hle(e,t){return SN(e,new ao.classes.URLSearchParams,function(r){for(var a=1;a<arguments.length;a++){var c=arguments[a]!=null?arguments[a]:{};a%2?Iz(Object(c),!0).forEach(function(d){L(r,d,c[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(c)):Iz(Object(c)).forEach(function(d){Object.defineProperty(r,d,Object.getOwnPropertyDescriptor(c,d))})}return r}({visitor:function(r,a,c,d){return ao.isNode&&Be.isBuffer(r)?(this.append(a,r.toString("base64")),!1):d.defaultVisitor.apply(this,arguments)}},t))}var ple=av.charAt,Az=Ye,fle=hi,mle=ve,gle=Q,_le=/./.exec,vle=TypeError,Ele=vn,kz=Ye,Oz=ce,yle=Qm,DN=F0,Dz=cr,Pz=Ir,Px=Na,ble=hi,xle=Gr,wle=Q,Sle=Mm,Lz=RL,Tle=xo,Rle=p,Cle=Lb,Nle=function(e,t,r){return t+(r?ple(e,t).length:1)},Ile=function(e,t){var r=e.exec;if(mle(r)){var a=Az(r,e,t);return a!==null&&fle(a),a}if(gle(e)==="RegExp")return Az(_le,e,t);throw new vle("RegExp#exec called on incompatible receiver")},jz=da,Ale=Nr("matchAll"),Mz="RegExp String",Uz=Mz+" Iterator",kle=jz.set,Ole=jz.getterFor(Uz),Dle=TypeError,nj=Oz("".indexOf),PN=Oz("".matchAll),rj=!!PN&&!Rle(function(){PN("a",/./)}),Ple=yle(function(e,t,r,a){kle(this,{type:Uz,regexp:e,string:t,global:r,unicode:a,done:!1})},Mz,function(){var e=Ole(this);if(e.done)return DN(void 0,!0);var t=e.regexp,r=e.string,a=Ile(t,r);return a===null?(e.done=!0,DN(void 0,!0)):e.global?(Px(a[0])===""&&(t.lastIndex=Nle(r,Pz(t.lastIndex),e.unicode)),DN(a,!1)):(e.done=!0,DN(a,!1))}),Vz=function(e){var t,r,a,c=ble(this),d=Px(e),h=Cle(c,RegExp),f=Px(Lz(c));return t=new h(h===RegExp?c.source:c,f),r=!!~nj(f,"g"),a=!!~nj(f,"u"),t.lastIndex=Pz(c.lastIndex),new Ple(t,d,r,a)};Ele({target:"String",proto:!0,forced:rj},{matchAll:function(e){var t,r,a,c,d=Dz(this);if(xle(e)){if(Sle(e)&&(t=Px(Dz(Lz(e))),!~nj(t,"g")))throw new Dle("`.matchAll` does not allow non-global regexes");if(rj)return PN(d,e);if((a=Tle(e,Ale))===void 0&&wle(e)==="RegExp"&&(a=Vz),a)return kz(a,e,d)}else if(rj)return PN(d,e);return r=Px(d),c=new RegExp(e,"g"),kz(Vz,c,r)}});var Lle=So("String","matchAll"),jle=M,Mle=Lle,sj=String.prototype,Ule=function(e){var t=e.matchAll;return typeof e=="string"||e===sj||jle(sj,e)&&t===sj.matchAll?Mle:t},Vle=u(Ule);function Fz(e){function t(r,a,c,d){let h=r[d++];if(h==="__proto__")return!0;const f=Number.isFinite(+h),m=d>=r.length;return h=!h&&Be.isArray(c)?c.length:h,m?(Be.hasOwnProp(c,h)?c[h]=[c[h],a]:c[h]=a,!f):(c[h]&&Be.isObject(c[h])||(c[h]=[]),t(r,a,c[h],d)&&Be.isArray(c[h])&&(c[h]=function(v){const E={},w=Object.keys(v);let S;const R=w.length;let j;for(S=0;S<R;S++)j=w[S],E[j]=v[j];return E}(c[h])),!f)}if(Be.isFormData(e)&&Be.isFunction(e.entries)){const r={};return Be.forEachEntry(e,(a,c)=>{t(function(d){return Vle(Be).call(Be,/\w+|\[(\w*)]/g,d).map(h=>h[0]==="[]"?"":h[1]||h[0])}(a),c,r,0)}),r}return null}const ij={transitional:f8,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",a=r.indexOf("application/json")>-1,c=Be.isObject(e);if(c&&Be.isHTMLForm(e)&&(e=new FormData(e)),Be.isFormData(e))return a?JSON.stringify(Fz(e)):e;if(Be.isArrayBuffer(e)||Be.isBuffer(e)||Be.isStream(e)||Be.isFile(e)||Be.isBlob(e)||Be.isReadableStream(e))return e;if(Be.isArrayBufferView(e))return e.buffer;if(Be.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let d;if(c){if(r.indexOf("application/x-www-form-urlencoded")>-1)return hle(e,this.formSerializer).toString();if((d=Be.isFileList(e))||r.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return SN(d?{"files[]":e}:e,h&&new h,this.formSerializer)}}return c||a?(t.setContentType("application/json",!1),function(h,f,m){if(Be.isString(h))try{return(f||JSON.parse)(h),ha(Be).call(Be,h)}catch(v){if(v.name!=="SyntaxError")throw v}return(m||JSON.stringify)(h)}(e)):e}],transformResponse:[function(e){const t=this.transitional||ij.transitional,r=t&&t.forcedJSONParsing,a=this.responseType==="json";if(Be.isResponse(e)||Be.isReadableStream(e))return e;if(e&&Be.isString(e)&&(r&&!this.responseType||a)){const c=!(t&&t.silentJSONParsing)&&a;try{return JSON.parse(e,this.parseReviver)}catch(d){if(c)throw d.name==="SyntaxError"?Yn.from(d,Yn.ERR_BAD_RESPONSE,this,null,this.response):d}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ao.classes.FormData,Blob:ao.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Be.forEach(["delete","get","head","post","put","patch"],e=>{ij.headers[e]={}});var aj=ij;const Fle=Be.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Bz=Symbol("internals");function Lx(e){var t;return e&&ha(t=String(e)).call(t).toLowerCase()}function LN(e){return e===!1||e==null?e:Be.isArray(e)?e.map(LN):String(e)}function oj(e,t,r,a,c){return Be.isFunction(a)?a.call(this,t,r):(c&&(t=r),Be.isString(t)?Be.isString(a)?t.indexOf(a)!==-1:Be.isRegExp(a)?a.test(t):void 0:void 0)}class jN{constructor(t){t&&this.set(t)}set(t,r,a){const c=this;function d(m,v,E){const w=Lx(v);if(!w)throw new Error("header name must be a non-empty string");const S=Be.findKey(c,w);(!S||c[S]===void 0||E===!0||E===void 0&&c[S]!==!1)&&(c[S||v]=LN(m))}const h=(m,v)=>Be.forEach(m,(E,w)=>d(E,w,v));if(Be.isPlainObject(t)||t instanceof this.constructor)h(t,r);else if(Be.isString(t)&&(t=ha(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(ha(f=t).call(f)))h((m=>{const v={};let E,w,S;return m&&m.split(`
`).forEach(function(R){var j,D;S=R.indexOf(":"),E=ha(j=R.substring(0,S)).call(j).toLowerCase(),w=ha(D=R.substring(S+1)).call(D),!E||v[E]&&Fle[E]||(E==="set-cookie"?v[E]?v[E].push(w):v[E]=[w]:v[E]=v[E]?v[E]+", "+w:w)}),v})(t),r);else if(Be.isObject(t)&&Be.isIterable(t)){let m,v,E={};for(const w of t){if(!Be.isArray(w))throw TypeError("Object iterator must return a key-value pair");E[v=w[0]]=(m=E[v])?Be.isArray(m)?[...m,w[1]]:[m,w[1]]:w[1]}h(E,r)}else t!=null&&d(r,t,a);var f;return this}get(t,r){if(t=Lx(t)){const a=Be.findKey(this,t);if(a){const c=this[a];if(!r)return c;if(r===!0)return function(d){const h=Object.create(null),f=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let m;for(;m=f.exec(d);)h[m[1]]=m[2];return h}(c);if(Be.isFunction(r))return r.call(this,c,a);if(Be.isRegExp(r))return r.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=Lx(t)){const a=Be.findKey(this,t);return!(!a||this[a]===void 0||r&&!oj(0,this[a],a,r))}return!1}delete(t,r){const a=this;let c=!1;function d(h){if(h=Lx(h)){const f=Be.findKey(a,h);!f||r&&!oj(0,a[f],f,r)||(delete a[f],c=!0)}}return Be.isArray(t)?t.forEach(d):d(t),c}clear(t){const r=Object.keys(this);let a=r.length,c=!1;for(;a--;){const d=r[a];t&&!oj(0,this[d],d,t,!0)||(delete this[d],c=!0)}return c}normalize(t){const r=this,a={};return Be.forEach(this,(c,d)=>{var h;const f=Be.findKey(a,d);if(f)return r[f]=LN(c),void delete r[d];const m=t?function(v){return ha(v).call(v).toLowerCase().replace(/([a-z\d])(\w*)/g,(E,w,S)=>w.toUpperCase()+S)}(d):ha(h=String(d)).call(h);m!==d&&delete r[d],r[m]=LN(c),a[m]=!0}),this}concat(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return this.constructor.concat(this,...r)}toJSON(t){const r=Object.create(null);return Be.forEach(this,(a,c)=>{a!=null&&a!==!1&&(r[c]=t&&Be.isArray(a)?a.join(", "):a)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[r,a]=t;return r+": "+a}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const r=new this(t);for(var a=arguments.length,c=new Array(a>1?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];return c.forEach(h=>r.set(h)),r}static accessor(t){const r=(this[Bz]=this[Bz]={accessors:{}}).accessors,a=this.prototype;function c(d){const h=Lx(d);r[h]||(function(f,m){const v=Be.toCamelCase(" "+m);["get","set","has"].forEach(E=>{Object.defineProperty(f,E+v,{value:function(w,S,R){return this[E].call(this,m,w,S,R)},configurable:!0})})}(a,d),r[h]=!0)}return Be.isArray(t)?t.forEach(c):c(t),this}}jN.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Be.reduceDescriptors(jN.prototype,(e,t)=>{let{value:r}=e,a=t[0].toUpperCase()+t.slice(1);return{get:()=>r,set(c){this[a]=c}}}),Be.freezeMethods(jN);var _d=jN;function cj(e,t){const r=this||aj,a=t||r,c=_d.from(a.headers);let d=a.data;return Be.forEach(e,function(h){d=h.call(r,d,c.normalize(),t?t.status:void 0)}),c.normalize(),d}function zz(e){return!(!e||!e.__CANCEL__)}function Nv(e,t,r){Yn.call(this,e??"canceled",Yn.ERR_CANCELED,t,r),this.name="CanceledError"}function Gz(e,t,r){const a=r.config.validateStatus;r.status&&a&&!a(r.status)?t(new Yn("Request failed with status code "+r.status,[Yn.ERR_BAD_REQUEST,Yn.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}Be.inherits(Nv,Yn,{__CANCEL__:!0});const MN=function(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,a=0;const c=function(d,h){d=d||10;const f=new Array(d),m=new Array(d);let v,E=0,w=0;return h=h!==void 0?h:1e3,function(S){const R=Date.now(),j=m[w];v||(v=R),f[E]=S,m[E]=R;let D=w,P=0;for(;D!==E;)P+=f[D++],D%=d;if(E=(E+1)%d,E===w&&(w=(w+1)%d),R-v<h)return;const W=j&&R-j;return W?Math.round(1e3*P/W):void 0}}(50,250);return function(d,h){let f,m,v=0,E=1e3/h;const w=function(S){v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),f=null,m&&(clearTimeout(m),m=null),d(...S)};return[function(){const S=Date.now(),R=S-v;for(var j=arguments.length,D=new Array(j),P=0;P<j;P++)D[P]=arguments[P];R>=E?w(D,S):(f=D,m||(m=setTimeout(()=>{m=null,w(f)},E-R)))},()=>f&&w(f)]}(d=>{const h=d.loaded,f=d.lengthComputable?d.total:void 0,m=h-a,v=c(m);a=h,e({loaded:h,total:f,progress:f?h/f:void 0,bytes:m,rate:v||void 0,estimated:v&&f&&h<=f?(f-h)/v:void 0,event:d,lengthComputable:f!=null,[t?"download":"upload"]:!0})},r)},Wz=(e,t)=>{const r=e!=null;return[a=>t[0]({lengthComputable:r,total:e,loaded:a}),t[1]]},Hz=e=>function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return Be.asap(()=>e(...r))};var Ble=ao.hasStandardBrowserEnv?((e,t)=>r=>(r=new hN(r,ao.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new hN(ao.origin),ao.navigator&&/(msie|trident)/i.test(ao.navigator.userAgent)):()=>!0,zle=ao.hasStandardBrowserEnv?{write(e,t,r,a,c,d,h){if(typeof document>"u")return;const f=["".concat(e,"=").concat(encodeURIComponent(t))];Be.isNumber(r)&&f.push("expires=".concat(new Date(r).toUTCString())),Be.isString(a)&&f.push("path=".concat(a)),Be.isString(c)&&f.push("domain=".concat(c)),d===!0&&f.push("secure"),Be.isString(h)&&f.push("SameSite=".concat(h)),document.cookie=f.join("; ")},read(e){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read:()=>null,remove(){}};function Kz(e,t,r){let a=!function(c){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(c)}(t);return e&&(a||r==0)?function(c,d){return d?c.replace(/\/?\/$/,"")+"/"+d.replace(/^\/+/,""):c}(e,t):t}function qz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function lj(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?qz(Object(r),!0).forEach(function(a){L(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qz(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}const Yz=e=>e instanceof _d?lj({},e):e;function bg(e,t){t=t||{};const r={};function a(v,E,w,S){return Be.isPlainObject(v)&&Be.isPlainObject(E)?Be.merge.call({caseless:S},v,E):Be.isPlainObject(E)?Be.merge({},E):Be.isArray(E)?E.slice():E}function c(v,E,w,S){return Be.isUndefined(E)?Be.isUndefined(v)?void 0:a(void 0,v,0,S):a(v,E,0,S)}function d(v,E){if(!Be.isUndefined(E))return a(void 0,E)}function h(v,E){return Be.isUndefined(E)?Be.isUndefined(v)?void 0:a(void 0,v):a(void 0,E)}function f(v,E,w){return w in t?a(v,E):w in e?a(void 0,v):void 0}const m={url:d,method:d,data:d,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:f,headers:(v,E,w)=>c(Yz(v),Yz(E),0,!0)};return Be.forEach(Object.keys(lj(lj({},e),t)),function(v){const E=m[v]||c,w=E(e[v],t[v],v);Be.isUndefined(w)&&E!==f||(r[v]=w)}),r}var Xz=e=>{const t=bg({},e);let{data:r,withXSRFToken:a,xsrfHeaderName:c,xsrfCookieName:d,headers:h,auth:f}=t;if(t.headers=h=_d.from(h),t.url=h8(Kz(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),f&&h.set("Authorization","Basic "+btoa((f.username||"")+":"+(f.password?unescape(encodeURIComponent(f.password)):""))),Be.isFormData(r)){if(ao.hasStandardBrowserEnv||ao.hasStandardBrowserWebWorkerEnv)h.setContentType(void 0);else if(Be.isFunction(r.getHeaders)){const m=r.getHeaders(),v=["content-type","content-length"];Object.entries(m).forEach(E=>{let[w,S]=E;ke(v).call(v,w.toLowerCase())&&h.set(w,S)})}}if(ao.hasStandardBrowserEnv&&(a&&Be.isFunction(a)&&(a=a(t)),a||a!==!1&&Ble(t.url))){const m=c&&d&&zle.read(d);m&&h.set(c,m)}return t},Gle=typeof XMLHttpRequest<"u"&&function(e){return new Ue(function(t,r){const a=Xz(e);let c=a.data;const d=_d.from(a.headers).normalize();let h,f,m,v,E,{responseType:w,onUploadProgress:S,onDownloadProgress:R}=a;function j(){v&&v(),E&&E(),a.cancelToken&&a.cancelToken.unsubscribe(h),a.signal&&a.signal.removeEventListener("abort",h)}let D=new XMLHttpRequest;function P(){if(!D)return;const Y=_d.from("getAllResponseHeaders"in D&&D.getAllResponseHeaders());Gz(function(ne){t(ne),j()},function(ne){r(ne),j()},{data:w&&w!=="text"&&w!=="json"?D.response:D.responseText,status:D.status,statusText:D.statusText,headers:Y,config:e,request:D}),D=null}D.open(a.method.toUpperCase(),a.url,!0),D.timeout=a.timeout,"onloadend"in D?D.onloadend=P:D.onreadystatechange=function(){D&&D.readyState===4&&(D.status!==0||D.responseURL&&D.responseURL.indexOf("file:")===0)&&setTimeout(P)},D.onabort=function(){D&&(r(new Yn("Request aborted",Yn.ECONNABORTED,e,D)),D=null)},D.onerror=function(Y){const ne=new Yn(Y&&Y.message?Y.message:"Network Error",Yn.ERR_NETWORK,e,D);ne.event=Y||null,r(ne),D=null},D.ontimeout=function(){let Y=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const ne=a.transitional||f8;a.timeoutErrorMessage&&(Y=a.timeoutErrorMessage),r(new Yn(Y,ne.clarifyTimeoutError?Yn.ETIMEDOUT:Yn.ECONNABORTED,e,D)),D=null},c===void 0&&d.setContentType(null),"setRequestHeader"in D&&Be.forEach(d.toJSON(),function(Y,ne){D.setRequestHeader(ne,Y)}),Be.isUndefined(a.withCredentials)||(D.withCredentials=!!a.withCredentials),w&&w!=="json"&&(D.responseType=a.responseType),R&&([m,E]=MN(R,!0),D.addEventListener("progress",m)),S&&D.upload&&([f,v]=MN(S),D.upload.addEventListener("progress",f),D.upload.addEventListener("loadend",v)),(a.cancelToken||a.signal)&&(h=Y=>{D&&(r(!Y||Y.type?new Nv(null,e,D):Y),D.abort(),D=null)},a.cancelToken&&a.cancelToken.subscribe(h),a.signal&&(a.signal.aborted?h():a.signal.addEventListener("abort",h)));const W=function(Y){const ne=/^([-+\w]{1,25})(:?\/\/|:)/.exec(Y);return ne&&ne[1]||""}(a.url);W&&ao.protocols.indexOf(W)===-1?r(new Yn("Unsupported protocol "+W+":",Yn.ERR_BAD_REQUEST,e)):D.send(c||null)})},Wle=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let a,c=new AbortController;const d=function(v){if(!a){a=!0,f();const E=v instanceof Error?v:this.reason;c.abort(E instanceof Yn?E:new Nv(E instanceof Error?E.message:E))}};let h=t&&setTimeout(()=>{h=null,d(new Yn("timeout ".concat(t," of ms exceeded"),Yn.ETIMEDOUT))},t);const f=()=>{e&&(h&&clearTimeout(h),h=null,e.forEach(v=>{v.unsubscribe?v.unsubscribe(d):v.removeEventListener("abort",d)}),e=null)};e.forEach(v=>v.addEventListener("abort",d));const{signal:m}=c;return m.unsubscribe=()=>Be.asap(f),m}},dj=u(PC),$z=wv.f("asyncIterator"),Hle=u($z);function uj(e,t){this.v=e,this.k=t}function Da(e){return function(){return new jx(e.apply(this,arguments))}}function jx(e){var t,r;function a(d,h){try{var f=e[d](h),m=f.value,v=m instanceof uj;dj.resolve(v?m.v:m).then(function(E){if(v){var w=d==="return"?"return":"next";if(!m.k||E.done)return a(w,E);E=e[w](E).value}c(f.done?"return":"normal",E)},function(E){a("throw",E)})}catch(E){c("throw",E)}}function c(d,h){switch(d){case"return":t.resolve({value:h,done:!0});break;case"throw":t.reject(h);break;default:t.resolve({value:h,done:!1})}(t=t.next)?a(t.key,t.arg):r=null}this._invoke=function(d,h){return new dj(function(f,m){var v={key:d,arg:h,resolve:f,reject:m,next:null};r?r=r.next=v:(t=r=v,a(d,h))})},typeof e.return!="function"&&(this.return=void 0)}function Ft(e){return new uj(e,0)}function Iv(e){var t={},r=!1;function a(c,d){return r=!0,d=new dj(function(h){h(e[c](d))}),{done:!1,value:new uj(d,1)}}return t[Cv!==void 0&&Tz||"@@iterator"]=function(){return this},t.next=function(c){return r?(r=!1,c):a("next",c)},typeof e.throw=="function"&&(t.throw=function(c){if(r)throw r=!1,c;return a("throw",c)}),typeof e.return=="function"&&(t.return=function(c){return r?(r=!1,c):a("return",c)}),t}jx.prototype[typeof Cv=="function"&&Hle||"@@asyncIterator"]=function(){return this},jx.prototype.next=function(e){return this._invoke("next",e)},jx.prototype.throw=function(e){return this._invoke("throw",e)},jx.prototype.return=function(e){return this._invoke("return",e)};var UN=u($z);function hj(e){var t,r,a,c=2;for(typeof Symbol<"u"&&(r=UN,a=Symbol.iterator);c--;){if(r&&(t=e[r])!=null)return t.call(e);if(a&&(t=e[a])!=null)return new VN(t.call(e));r="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function VN(e){function t(r){if(Object(r)!==r)return Ue.reject(new TypeError(r+" is not an object."));var a=r.done;return Ue.resolve(r.value).then(function(c){return{value:c,done:a}})}return VN=function(r){this.s=r,this.n=r.next},VN.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var a=this.s.return;return a===void 0?Ue.resolve({value:r,done:!0}):t(a.apply(this.s,arguments))},throw:function(r){var a=this.s.return;return a===void 0?Ue.reject(r):t(a.apply(this.s,arguments))}},new VN(e)}const Kle=function*(e,t){let r=e.byteLength;if(!t||r<t)return void(yield e);let a,c=0;for(;c<r;)a=c+t,yield e.slice(c,a),c=a},qle=function(){var e=Da(function*(t,r){var a,c=!1,d=!1;try{for(var h,f=hj(Yle(t));c=!(h=yield Ft(f.next())).done;c=!1){const m=h.value;yield*Iv(hj(Kle(m,r)))}}catch(m){d=!0,a=m}finally{try{c&&f.return!=null&&(yield Ft(f.return()))}finally{if(d)throw a}}});return function(t,r){return e.apply(this,arguments)}}(),Yle=function(){var e=Da(function*(t){if(t[UN])return void(yield*Iv(hj(t)));const r=t.getReader();try{for(;;){const{done:a,value:c}=yield Ft(r.read());if(a)break;yield c}}finally{yield Ft(r.cancel())}});return function(t){return e.apply(this,arguments)}}(),Jz=(e,t,r,a)=>{const c=qle(e,t);let d,h=0,f=m=>{d||(d=!0,a&&a(m))};return new ReadableStream({async pull(m){try{const{done:v,value:E}=await c.next();if(v)return f(),void m.close();let w=E.byteLength;if(r){let S=h+=w;r(S)}m.enqueue(new Uint8Array(E))}catch(v){throw f(v),v}},cancel:m=>(f(m),c.return())},{highWaterMark:2})};function Qz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function Zz(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Qz(Object(r),!0).forEach(function(a){L(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qz(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}const{isFunction:FN}=Be,Xle=(e=>{let{Request:t,Response:r}=e;return{Request:t,Response:r}})(Be.global),{ReadableStream:eG,TextEncoder:tG}=Be.global,nG=function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];return!!e(...r)}catch{return!1}},$le=e=>{e=Be.merge.call({skipUndefined:!0},Xle,e);const{fetch:t,Request:r,Response:a}=e,c=t?FN(t):typeof fetch=="function",d=FN(r),h=FN(a);if(!c)return!1;const f=c&&FN(eG),m=c&&(typeof tG=="function"?(v=new tG,j=>v.encode(j)):async j=>new Uint8Array(await new r(j).arrayBuffer()));var v;const E=d&&f&&nG(()=>{let j=!1;const D=new r(ao.origin,{body:new eG,method:"POST",get duplex(){return j=!0,"half"}}).headers.has("Content-Type");return j&&!D}),w=h&&f&&nG(()=>Be.isReadableStream(new a("").body)),S={stream:w&&(j=>j.body)};c&&["text","arrayBuffer","blob","formData","stream"].forEach(j=>{!S[j]&&(S[j]=(D,P)=>{let W=D&&D[j];if(W)return W.call(D);throw new Yn("Response type '".concat(j,"' is not supported"),Yn.ERR_NOT_SUPPORT,P)})});const R=async(j,D)=>{const P=Be.toFiniteNumber(j.getContentLength());return P??(async W=>W==null?0:Be.isBlob(W)?W.size:Be.isSpecCompliantForm(W)?(await new r(ao.origin,{method:"POST",body:W}).arrayBuffer()).byteLength:Be.isArrayBufferView(W)||Be.isArrayBuffer(W)?W.byteLength:(Be.isURLSearchParams(W)&&(W+=""),Be.isString(W)?(await m(W)).byteLength:void 0))(D)};return async j=>{let{url:D,method:P,data:W,signal:Y,cancelToken:ne,timeout:le,onDownloadProgress:fe,onUploadProgress:ie,responseType:_e,headers:Te,withCredentials:Ne="same-origin",fetchOptions:Ke}=Xz(j),St=t||fetch;_e=_e?(_e+"").toLowerCase():"text";let Et=Wle([Y,ne&&ne.toAbortSignal()],le),Vt=null;const Ot=Et&&Et.unsubscribe&&(()=>{Et.unsubscribe()});let Cn;try{if(ie&&E&&P!=="get"&&P!=="head"&&(Cn=await R(Te,W))!==0){let O,te=new r(D,{method:"POST",body:W,duplex:"half"});if(Be.isFormData(W)&&(O=te.headers.get("content-type"))&&Te.setContentType(O),te.body){const[oe,Pe]=Wz(Cn,MN(Hz(ie)));W=Jz(te.body,65536,oe,Pe)}}Be.isString(Ne)||(Ne=Ne?"include":"omit");const Er=d&&"credentials"in r.prototype,Re=Zz(Zz({},Ke),{},{signal:Et,method:P.toUpperCase(),headers:Te.normalize().toJSON(),body:W,duplex:"half",credentials:Er?Ne:void 0});Vt=d&&new r(D,Re);let je=await(d?St(Vt,Ke):St(D,Re));const Ze=w&&(_e==="stream"||_e==="response");if(w&&(fe||Ze&&Ot)){const O={};["status","statusText","headers"].forEach(Nt=>{O[Nt]=je[Nt]});const te=Be.toFiniteNumber(je.headers.get("content-length")),[oe,Pe]=fe&&Wz(te,MN(Hz(fe),!0))||[];je=new a(Jz(je.body,65536,oe,()=>{Pe&&Pe(),Ot&&Ot()}),O)}_e=_e||"text";let Ce=await S[Be.findKey(S,_e)||"text"](je,j);return!Ze&&Ot&&Ot(),await new Ue((O,te)=>{Gz(O,te,{data:Ce,headers:_d.from(je.headers),status:je.status,statusText:je.statusText,config:j,request:Vt})})}catch(Er){throw Ot&&Ot(),Er&&Er.name==="TypeError"&&/Load failed|fetch/i.test(Er.message)?Object.assign(new Yn("Network Error",Yn.ERR_NETWORK,j,Vt),{cause:Er.cause||Er}):Yn.from(Er,Er&&Er.code,j,Vt)}}},Jle=new Map,rG=e=>{let t=e&&e.env||{};const{fetch:r,Request:a,Response:c}=t,d=[a,c,r];let h,f,m=d.length,v=Jle;for(;m--;)h=d[m],f=v.get(h),f===void 0&&v.set(h,f=m?new Map:$le(t)),v=f;return f};rG();const pj={http:null,xhr:Gle,fetch:{get:rG}};Be.forEach(pj,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const sG=e=>"- ".concat(e),Qle=e=>Be.isFunction(e)||e===null||e===!1;var iG={getAdapter:function(e,t){e=Be.isArray(e)?e:[e];const{length:r}=e;let a,c;const d={};for(let h=0;h<r;h++){let f;if(a=e[h],c=a,!Qle(a)&&(c=pj[(f=String(a)).toLowerCase()],c===void 0))throw new Yn("Unknown adapter '".concat(f,"'"));if(c&&(Be.isFunction(c)||(c=c.get(t))))break;d[f||"#"+h]=c}if(!c){const h=Object.entries(d).map(f=>{let[m,v]=f;return"adapter ".concat(m," ")+(v===!1?"is not supported by the environment":"is not available in the build")});throw new Yn("There is no suitable adapter to dispatch the request "+(r?h.length>1?`since :
`+h.map(sG).join(`
`):" "+sG(h[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return c},adapters:pj};function fj(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Nv(null,e)}function aG(e){return fj(e),e.headers=_d.from(e.headers),e.data=cj.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),iG.getAdapter(e.adapter||aj.adapter,e)(e).then(function(t){return fj(e),t.data=cj.call(e,e.transformResponse,t),t.headers=_d.from(t.headers),t},function(t){return zz(t)||(fj(e),t&&t.response&&(t.response.data=cj.call(e,e.transformResponse,t.response),t.response.headers=_d.from(t.response.headers))),Ue.reject(t)})}const oG="1.13.2",BN={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{BN[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});const cG={};BN.transitional=function(e,t,r){function a(c,d){return"[Axios v"+oG+"] Transitional option '"+c+"'"+d+(r?". "+r:"")}return(c,d,h)=>{if(e===!1)throw new Yn(a(d," has been removed"+(t?" in "+t:"")),Yn.ERR_DEPRECATED);return t&&!cG[d]&&(cG[d]=!0,console.warn(a(d," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(c,d,h)}},BN.spelling=function(e){return(t,r)=>(console.warn("".concat(r," is likely a misspelling of ").concat(e)),!0)};var zN={assertOptions:function(e,t,r){if(typeof e!="object")throw new Yn("options must be an object",Yn.ERR_BAD_OPTION_VALUE);const a=Object.keys(e);let c=a.length;for(;c-- >0;){const d=a[c],h=t[d];if(h){const f=e[d],m=f===void 0||h(f,d,e);if(m!==!0)throw new Yn("option "+d+" must be "+m,Yn.ERR_BAD_OPTION_VALUE)}else if(r!==!0)throw new Yn("Unknown option "+d,Yn.ERR_BAD_OPTION)}},validators:BN};const vu=zN.validators;let GN=class{constructor(e){this.defaults=e||{},this.interceptors={request:new p8,response:new p8}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const c=a.stack?a.stack.replace(/^.+\n/,""):"";try{r.stack?c&&!String(r.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+c):r.stack=c}catch{}}throw r}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=bg(this.defaults,t);const{transitional:r,paramsSerializer:a,headers:c}=t;r!==void 0&&zN.assertOptions(r,{silentJSONParsing:vu.transitional(vu.boolean),forcedJSONParsing:vu.transitional(vu.boolean),clarifyTimeoutError:vu.transitional(vu.boolean)},!1),a!=null&&(Be.isFunction(a)?t.paramsSerializer={serialize:a}:zN.assertOptions(a,{encode:vu.function,serialize:vu.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),zN.assertOptions(t,{baseUrl:vu.spelling("baseURL"),withXsrfToken:vu.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let d=c&&Be.merge(c.common,c[t.method]);c&&Be.forEach(["delete","get","head","post","put","patch","common"],R=>{delete c[R]}),t.headers=_d.concat(d,c);const h=[];let f=!0;this.interceptors.request.forEach(function(R){typeof R.runWhen=="function"&&R.runWhen(t)===!1||(f=f&&R.synchronous,h.unshift(R.fulfilled,R.rejected))});const m=[];let v;this.interceptors.response.forEach(function(R){m.push(R.fulfilled,R.rejected)});let E,w=0;if(!f){const R=[aG.bind(this),void 0];for(R.unshift(...h),R.push(...m),E=R.length,v=Ue.resolve(t);w<E;)v=v.then(R[w++],R[w++]);return v}E=h.length;let S=t;for(;w<E;){const R=h[w++],j=h[w++];try{S=R(S)}catch(D){j.call(this,D);break}}try{v=aG.call(this,S)}catch(R){return Ue.reject(R)}for(w=0,E=m.length;w<E;)v=v.then(m[w++],m[w++]);return v}getUri(e){return h8(Kz((e=bg(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Be.forEach(["delete","get","head","options"],function(e){GN.prototype[e]=function(t,r){return this.request(bg(r||{},{method:e,url:t,data:(r||{}).data}))}}),Be.forEach(["post","put","patch"],function(e){function t(r){return function(a,c,d){return this.request(bg(d||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:c}))}}GN.prototype[e]=t(),GN.prototype[e+"Form"]=t(!0)});var WN=GN;class mj{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Ue(function(c){r=c});const a=this;this.promise.then(c=>{if(!a._listeners)return;let d=a._listeners.length;for(;d-- >0;)a._listeners[d](c);a._listeners=null}),this.promise.then=c=>{let d;const h=new Ue(f=>{a.subscribe(f),d=f}).then(c);return h.cancel=function(){a.unsubscribe(d)},h},t(function(c,d,h){a.reason||(a.reason=new Nv(c,d,h),r(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=a=>{t.abort(a)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new mj(function(a){t=a}),cancel:t}}}var Zle=mj;const gj={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(gj).forEach(e=>{let[t,r]=e;gj[r]=t});var ede=gj;const ji=function e(t){const r=new WN(t),a=X6(WN.prototype.request,r);return Be.extend(a,WN.prototype,r,{allOwnKeys:!0}),Be.extend(a,r,null,{allOwnKeys:!0}),a.create=function(c){return e(bg(t,c))},a}(aj);ji.Axios=WN,ji.CanceledError=Nv,ji.CancelToken=Zle,ji.isCancel=zz,ji.VERSION=oG,ji.toFormData=SN,ji.AxiosError=Yn,ji.Cancel=ji.CanceledError,ji.all=function(e){return Ue.all(e)},ji.spread=function(e){return function(t){return e.apply(null,t)}},ji.isAxiosError=function(e){return Be.isObject(e)&&e.isAxiosError===!0},ji.mergeConfig=bg,ji.AxiosHeaders=_d,ji.formToJSON=e=>Fz(Be.isHTMLForm(e)?new FormData(e):e),ji.getAdapter=iG.getAdapter,ji.HttpStatusCode=ede,ji.default=ji;var Pa=ji;const tde=()=>{};function Mx(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:tde};return e.promise=new Ue((t,r)=>{e.resolve=a=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(a),e.value=a)},e.reject=a=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,r(a))}}),e}const HN=new Map,KN=new Map,Eu=new Map;let Os=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Tn=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const lG=new jae;let vd=lG.getResult(),_j=null;function yn(e){if(!_j){vd=lG.getResult();const t=function(f){if(f.engine.name==="Blink"&&f.browser.name!=="WeChat")return Tn.CHROME;switch(f.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Tn.CHROME;case"Safari":case"Mobile Safari":return Tn.SAFARI;case"Edge":return Tn.EDGE;case"Firefox":return Tn.FIREFOX;case"QQ":case"QQBrowser":return Tn.QQ;case"Opera":return Tn.OPERA;case"WeChat":return Tn.WECHAT;default:return f.browser.name||""}}(vd),r=dG(vd),a=function(f){return f.os.name==="Windows"?f.os.version?f.os.name+" "+f.os.version:f.os.name:f.os.name||""}(vd),c=vd.os.version,d=dG(vd,!1),h=vd.device.type;if(!(t&&r&&a&&c))return{name:t,version:r,os:a,osVersion:c,browserVersion:d,deviceType:h};_j={name:t,version:r,os:a,osVersion:c,browserVersion:d,deviceType:h}}return _j}function dG(e){let t,r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",r?t.split(".")[0]:t}function qN(){return yn().os}function uG(){const e=yn();return"".concat(e.os," ").concat(e.osVersion)}function YN(){const e=yn();return!!(vd.engine.name==="WebKit"&&e.os===Os.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Tn.SAFARI||Mi()&&e.name!==Tn.SAFARI)}function Ih(){return yn().name===Tn.CHROME}function Hs(){return yn().name===Tn.SAFARI}function hG(){const e=yn();if(e.name!==Tn.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function pG(){return yn().name===Tn.EDGE}function dr(){return yn().name===Tn.FIREFOX}function Mi(){return yn().os===Os.IOS}function Ed(e){const t=yn();return!(t.name!==Tn.CHROME||!t.osVersion)&&Number(t.version)>=e}function fG(e){const t=yn();return!(t.name!==Tn.CHROME||!t.osVersion)&&Number(t.version)<e}function vj(e,t,r){const a=yn();return!(a.name!==e||!a.osVersion)&&(r?Number(a.version)>=t&&Number(a.version)<=r:Number(a.version)===t)}function cf(e){const t=yn();return!(t.name!==Tn.EDGE||!t.osVersion)&&Number(t.version)>=e}function Ej(e){const t=yn();return!(t.name!==Tn.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function mG(e){const t=yn();return!(t.name!==Tn.SAFARI||!t.osVersion)&&Number(t.version)>=e}function gG(e,t,r){const a=yn();if(a.os!==Os.IOS||!a.osVersion)return!1;const c=a.osVersion.split(".");return r?t&&Number(c[0])===e&&Number(c[1])>t||Number(c[0])>e:t?Number(c[0])===e&&Number(c[1])>=t||Number(c[0])>e:Number(c[0])>=e}function _G(e,t,r){const a=yn();if(a.os!==Os.IOS||!a.osVersion)return!1;const c=a.osVersion.split(".");return r?t&&Number(c[0])===e&&Number(c[1])<t||Number(c[0])<e:t?Number(c[0])===e&&Number(c[1])<=t||Number(c[0])<e:Number(c[0])<=e}function yj(e,t,r){const a=yn();if(a.name!==Tn.SAFARI||!a.osVersion||!a.browserVersion)return!1;const c=a.browserVersion.split(".");return r?t&&Number(c[0])===e&&Number(c[1])<t||Number(c[0])<e:t?Number(c[0])===e&&Number(c[1])<=t||Number(c[0])<e:Number(c[0])<=e}function xg(e){const t=yn();return!(t.name!==Tn.OPERA||!t.osVersion)&&Number(t.version)>=e}function vG(){const e=yn();if(e.os!==Os.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function Av(){const e=yn();if(e.os!==Os.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function bj(){const e=yn();if(e.os!==Os.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function EG(){const e=yn();if(e.os!==Os.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Sl(){return Hs()&&navigator.maxTouchPoints>0}function yG(){return yn().name===Tn.WECHAT}function bG(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function xG(){const e=qN();return function(){const{deviceType:t}=yn();return t==="mobile"||t==="tablet"}()||e===Os.ANDROID||e===Os.IOS||e===Os.HARMONY_OS}function yu(){const e=yn();return e.name!==Tn.EDGE&&e.name!==Tn.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Ux(){return qN()===Os.ANDROID}function Vx(){const e=yn();return Ux()&&(e.name===Tn.CHROME||e.name===Tn.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function It(e,t,r){return(t=function(a){var c=function(d,h){if(typeof d!="object"||!d)return d;var f=d[Symbol.toPrimitive];if(f!==void 0){var m=f.call(d,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(a);return typeof c=="symbol"?c:c+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function wG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function Le(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?wG(Object(r),!0).forEach(function(a){It(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wG(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}let K=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),we=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(t),It(this,"code",void 0),It(this,"message",void 0),It(this,"data",void 0),It(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=r}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Tl(e,t){if(typeof e!="boolean")throw new we(K.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function cs(e,t,r){if(!ke(r).call(r,e))throw new we(K.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(r)))}function Xn(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<r||e>a||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(e))throw new we(K.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(r,", ").concat(a,"]. integer only"))}function xj(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new we(K.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&Xn(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&Xn(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&Xn(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&Xn(e.ideal,"".concat(t,".ideal"),1,1/0)}else Xn(e,t,1,1/0)}function ri(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new we(K.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!SG(e,r,a,c))throw new we(K.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(r,",").concat(a,"].").concat(c?" ASCII characters only.":""))}function Ah(e,t){if(!Array.isArray(e))throw new we(K.INVALID_PARAMS,"".concat(t," should be an array"))}function Lr(e){return e==null}function SG(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,a=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=r&&e.length>=t&&(!a||function(c){if(typeof c!="string")return!1;for(let d=0;d<c.length;d+=1){const h=c.charCodeAt(d);if(h<0||h>255)return!1}return!0}(e))}function TG(e,t,r){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,r);const a=e.getUint32(t,r),c=e.getUint32(t+4,r),d=0,h=+!r;return BigInt(a*h+c*d)<<BigInt(32)|BigInt(a*d+c*h)}function RG(e,t,r,a){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,r,a);const c=Number(r>>BigInt(32)),d=Number(r&BigInt(4294967295));e.setUint32(t,c,a),e.setUint32(t+4,d,a)}var Fx=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(Fx||{}),wj=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(wj||{});const CG=new class{constructor(){It(this,"_clientSize",null),It(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),It(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),It(this,"getStyle",e=>window.getComputedStyle(e,null)),It(this,"checkCssVisibleProperty",e=>{var t;let r=!0;const a=this.getStyle(e),{display:c,visibility:d,opacity:h,filter:f}=a;return(c==="none"||ke(t=["hidden","collapse"]).call(t,d)||Number(h)<.1)&&(r=!1),!!r&&(f&&f.split(" ").filter(m=>{var v;const E=m.split("(")[0];return ke(v=["brightness","blur","opacity"]).call(v,E)}).map(m=>{const[v,E]=m.split(/\(|\)/);return[v,Number(E.match(/^[0-9\.]+/))]}).forEach(m=>{const[v,E]=m;switch(v){case"brightness":(E<.1||E>3)&&(r=!1);break;case"blur":E>3&&(r=!1);break;case"opacity":E<.1&&(r=!1)}}),r)}),It(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let r=!0,a=!0;const c=h=>t(h);let d=e;for(;d&&a;)c(d)||(r=!1,a=!1),d=d.parentElement,d||(a=!1);return r}),It(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),It(this,"getSizeAboutClient",e=>{const{width:t,height:r,left:a,right:c,top:d,bottom:h}=e.getBoundingClientRect(),f=this.getClientWidth(),m=this.getClientHeight();return{width:t,height:r,left:a,right:c,top:d,bottom:h,clientWidth:f,clientHeight:m,clientMin:Math.min(f,m)}}),It(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:r}=this._clientSize;return this.checkSizeIsVisible(e,t,r)}),It(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),It(this,"checkCoverForAPoint",(e,t,r)=>{const a=this.elementFromPoint(e,t);return a!==null&&a!==r}),It(this,"getPointPositionList",()=>{const{width:e,height:t,left:r,top:a}=this._clientSize,c=e/6,d=t/6,h=[],f=10**6;for(let m=0;m<5;m++)for(let v=0;v<5;v++){const E=(r*f+(m===0?.1:m===4?(c*m*f-1e5)/f:c*m)*f)/f,w=(a*f+(v===0?.1:v===4?(d*v*f-1e5)/f:d*v)*f)/f;h.push({x:E,y:w})}return[...h]}),It(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),It(this,"checkSizeIsVisible",(e,t,r)=>(e>50||r/e<=10)&&(t>50||r/t<=10)),It(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:r,bottom:a,clientHeight:c,clientWidth:d,clientMin:h}=this._clientSize;let f,m,v,E;if(e<0)f=0;else{if(!(e<d))return!1;f=e}if(t<0)return!1;if(m=t<d?t:d,r<0)v=0;else{if(!(r<c))return!1;v=r}if(a<0)return!1;E=a<c?a:c;const w=m-f,S=E-v;return this.checkSizeIsVisible(w,S,h)}),It(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),It(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Fx.COVERED);{const t=this.checkActualSize(),r=this.checkSizeOfPartInClient();return t&&!r?this.returnHiddenResult(Fx.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Fx.SIZE)}}return this.returnHiddenResult(Fx.STYLE)}return this.returnHiddenResult(wj.UNMOUNTED)}return this.returnHiddenResult(wj.INVALID_HTML_ELEMENT)}),It(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function Sj(e){return new TextEncoder().encode(e)}const NG=function(e,t){const r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r},Tj=async e=>function(t,r){let a="";return new Uint8Array(t).forEach(c=>{a+=c.toString(r).padStart(2,"0")}),a}(await crypto.subtle.digest("SHA-256",Sj(e)),16);let br=class{constructor(){It(this,"_events",{}),It(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);const r=this._events[e];this._indexOfListener(r,t)===-1&&r.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const r=this._events[e];this._indexOfListener(r,t)===-1&&r.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const r=this._events[e],a=this._indexOfListener(r,t);a!==-1&&r.splice(a,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map(d=>d);for(var r=arguments.length,a=new Array(r>1?r-1:0),c=1;c<r;c++)a[c-1]=arguments[c];for(let d=0;d<t.length;d+=1){const h=t[d];h.once&&this.off(e,h.listener),h.listener.apply(this,a||[])}}safeEmit(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];[...this._events[e]||[]].forEach(c=>{c.once&&this.off(e,c.listener);try{c.listener.apply(this,r)}catch(d){console.error("safeEmit event:".concat(e," error ").concat(d==null?void 0:d.toString()))}})}_indexOfListener(e,t){let r=e.length;for(;r--;)if(e[r].listener===t)return r;return-1}},Bx=null;function IG(){if(Bx)return Bx;if(window.electron)return Bx=window.electron;if(!window.require)return null;try{return Bx=window.require("electron"),Bx}catch{return null}}let _r=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e.VOS_FALLBACK_CN="vosFallbackCN",e.DATACHANNEL_FAILBACK="datachannelFailback",e}({}),$n=function(e){return e.TRACER="tracer",e}({});function AG(e){return Xn(e.timeout,"config.timeout",0,1e5),Xn(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Xn(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Xn(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let nde=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),nn=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.FALLBACK_TO_HLS="FALLBACK_TO_HLS",e.UID_CONFLICT="UID_CONFLICT",e}({});function wg(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function kG(e){return ri(e.turnServerURL,"turnServerURL"),ri(e.username,"username"),ri(e.password,"password"),e.udpport&&Xn(e.udpport,"udpport",1,99999,!0),e.forceturn&&Tl(e.forceturn,"forceturn"),e.security&&Tl(e.security,"security"),e.tcpport&&Xn(e.tcpport,"tcpport",1,99999,!0),!0}let kv=function(e){return e[e.AUTO_SIMULCAST_STREAM=-1]="AUTO_SIMULCAST_STREAM",e[e.DISABLE_SIMULCAST_STREM=0]="DISABLE_SIMULCAST_STREM",e[e.ENABLE_SIMULCAST_STREAM=1]="ENABLE_SIMULCAST_STREAM",e}({});function Rj(e){return e.level!==void 0&&cs(e.level,"level",[1,2,3]),e.delay!==void 0&&Xn(e.delay,"delay",0,3e3,!0),!0}let Kt=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e.FALLBACK_TO_HLS="fallback-to-hls",e.FIRST_VIDEO_BUFFER_READY="first-video-buffer-ready",e.FIRST_VIDEO_PRE_RENDER="first-video-pre-render",e.AV1_DECODABLE_RESULT="av1-decodable-result",e}({}),Cj=function(e){return e.CONFIG="config",e.VOSERROR="vos_error",e.AP_ERROR="ap_error",e}({}),fi=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),fa=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Sg=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function _s(e,t){for(var r=arguments.length,a=new Array(r>2?r-2:0),c=2;c<r;c++)a[c-2]=arguments[c];return e.getListeners(t).length===0?Ue.reject(new we(K.UNEXPECTED_ERROR,"can not emit promise")):new Ue((d,h)=>{e.emit(t,...a,d,h)})}function er(e,t){if(e.getListeners(t).length===0)return Ue.resolve();for(var r=arguments.length,a=new Array(r>2?r-2:0),c=2;c<r;c++)a[c-2]=arguments[c];return _s(e,t,...a)}function Oo(e,t){if(e.getListeners(t).length===0)return null;for(var r=arguments.length,a=new Array(r>2?r-2:0),c=2;c<r;c++)a[c-2]=arguments[c];return Tg(e,t,...a)}function Tg(e,t){let r=null,a=null;for(var c=arguments.length,d=new Array(c>2?c-2:0),h=2;h<c;h++)d[h-2]=arguments[h];if(e.emit(t,...d,f=>{r=f},f=>{a=f}),a!==null)throw a;if(r===null)throw new we(K.UNEXPECTED_ERROR,"handler is not sync");return r}const jr=new class extends br{set networkState(e){this.emit(Sg.NETWORK_STATE_CHANGE,e,this._networkState),e===fa.ONLINE?this.emit(Sg.ONLINE):e===fa.OFFLINE&&(this.onlineWaiter=new Ue(t=>{this.once(Sg.ONLINE,()=>{this.onlineWaiter=void 0,t(fa.ONLINE)})}),this.emit(Sg.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===fa.ONLINE}constructor(){super(),It(this,"_moduleName","network-indicator"),It(this,"_networkState",fa.ONLINE),It(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=fa.ONLINE}),window.addEventListener("offline",()=>{this.networkState=fa.OFFLINE})}},La=[];for(let e=0;e<256;++e)La.push((e+256).toString(16).slice(1));const OG=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);let Nj;const rde=new Uint8Array(16);function sde(){return OG?OG():function(r,a,c){var d,h,f,m;const v=(d=(h=(r=r||{}).random)!==null&&h!==void 0?h:(f=(m=r).rng)===null||f===void 0?void 0:f.call(m))!==null&&d!==void 0?d:function(){if(!Nj){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Nj=crypto.getRandomValues.bind(crypto)}return Nj(rde)}();if(v.length<16)throw new Error("Random bytes length must be >= 16");if(v[6]=15&v[6]|64,v[8]=63&v[8]|128,a){if((c=c||0)<0||c+16>a.length)throw new RangeError("UUID byte range ".concat(c,":").concat(c+15," is out of buffer bounds"));for(let E=0;E<16;++E)a[c+E]=v[E];return a}return function(E){let w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(La[E[w+0]]+La[E[w+1]]+La[E[w+2]]+La[E[w+3]]+"-"+La[E[w+4]]+La[E[w+5]]+"-"+La[E[w+6]]+La[E[w+7]]+"-"+La[E[w+8]]+La[E[w+9]]+"-"+La[E[w+10]]+La[E[w+11]]+La[E[w+12]]+La[E[w+13]]+La[E[w+14]]+La[E[w+15]]).toLowerCase()}(v)}(e,t,void 0);var e,t}function XN(e,t){const r=e.indexOf(t);r!==-1&&e.splice(r,1)}function Ov(e){const t=[];return e.forEach(r=>{t.indexOf(r)===-1&&t.push(r)}),t}function $N(e){Ue!==void 0?Ue.resolve().then(e):setTimeout(e,0)}function ur(e){return JSON.parse(JSON.stringify(e))}function Rg(e){try{return ur(e)}catch{return e}}const DG={};function lf(e,t){DG[t]||(DG[t]=!0,e())}function Cg(e){const t=window.atob(e),r=new Uint8Array(new ArrayBuffer(t.length));for(let a=0;a<t.length;a+=1)r[a]=t.charCodeAt(a);return r}function df(e){let t="";for(let r=0;r<e.length;r+=1)t+=String.fromCharCode(e[r]);return window.btoa(t)}function PG(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,r=new TextEncoder().encode(e);if(r.length>t)r=r.slice(0,t);else if(r.length<t){const a=new Uint8Array(t);a.set(r),r=a}return r}function LG(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const a=To(t).call(t,(h,f)=>h+f.length,0),c=new Uint8Array(new ArrayBuffer(a));let d=0;return t.forEach(h=>{c.set(h,d),d+=h.length}),c}function bu(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function jG(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(r=>{t+=typeof r=="string"?bu(r):r.size}),t+138}function ide(e){const t=new we(K.TIMEOUT,"timeout");return new Ue((r,a)=>{window.setTimeout(()=>a(t),e)})}function Ds(e){return new Ue(t=>{window.setTimeout(t,e)})}function jn(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const r=Math.random().toString(16).substr(2,e).toLowerCase();return r.length===e?"".concat(t).concat(r):"".concat(t).concat(r)+jn(e-r.length,"")}function Ng(){let e,t=!1;try{var r;e=Lae(r=sde()).call(r,"-","")}catch{t=!0}return!t&&e&&e.length===32||(e=jn(32,"")),e.toUpperCase()}const zx=()=>{},MG=new class{constructor(){It(this,"fnMap",new Map)}throttleByKey(e,t,r,a){for(var c=arguments.length,d=new Array(c>4?c-4:0),h=4;h<c;h++)d[h-4]=arguments[h];if(this.fnMap.has(t)){const f=this.fnMap.get(t);if(f.threshold!==r){f.fn(...f.args),clearTimeout(f.timer);const m=window.setTimeout(()=>{const v=this.fnMap.get(t);v&&v.fn(...v.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:m,args:d,skipFn:a})}else f.skipFn&&f.skipFn(...f.args),this.fnMap.set(t,Le(Le({},f),{},{fn:e,args:d,skipFn:a}))}else{const f=window.setTimeout(()=>{const m=this.fnMap.get(t);m&&m.fn(...m.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:f,args:d,skipFn:a})}}},UG=MG.throttleByKey.bind(MG);function VG(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function Ij(e,t){if(!VG(e)||!VG(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const r=[...e];for(let a=0;a<t.length;a++)r[a]=Ij(e[a],t[a]);return r}{const r=Le({},e);for(const a in t)Object.prototype.hasOwnProperty.call(t,a)&&(Object.prototype.hasOwnProperty.call(e,a)?r[a]=Ij(e[a],t[a]):r[a]=t[a]);return r}}function FG(e,t){let r=[0];if(r=new Array(t).fill(0),e===0)return r;let a=0;for(;e>0&&(r[a]=255&e,e>>=8,a++,a!==t););return r}function Dv(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function Aj(e,t){try{return typeof e=="object"&&typeof t=="object"&&JSON.stringify(e)===JSON.stringify(t)}catch{return!1}}function kj(e){return To(e).call(e,(t,r)=>t+r,0)}function BG(e){const t="0123456789abcdef";function r(ne){let le,fe="";for(le=0;le<=3;le++)fe+=t.charAt(ne>>8*le+4&15)+t.charAt(ne>>8*le&15);return fe}function a(ne,le){const fe=(65535&ne)+(65535&le);return(ne>>16)+(le>>16)+(fe>>16)<<16|65535&fe}function c(ne,le,fe,ie,_e,Te){return a(function(Ne,Ke){return Ne<<Ke|Ne>>>32-Ke}(a(a(le,ne),a(ie,Te)),_e),fe)}function d(ne,le,fe,ie,_e,Te,Ne){return c(le&fe|~le&ie,ne,le,_e,Te,Ne)}function h(ne,le,fe,ie,_e,Te,Ne){return c(le&ie|fe&~ie,ne,le,_e,Te,Ne)}function f(ne,le,fe,ie,_e,Te,Ne){return c(le^fe^ie,ne,le,_e,Te,Ne)}function m(ne,le,fe,ie,_e,Te,Ne){return c(fe^(le|~ie),ne,le,_e,Te,Ne)}const v=function(ne){let le;const fe=1+(ne.length+8>>6),ie=new Array(16*fe);for(le=0;le<16*fe;le++)ie[le]=0;for(le=0;le<ne.length;le++)ie[le>>2]|=ne.charCodeAt(le)<<le%4*8;return ie[le>>2]|=128<<le%4*8,ie[16*fe-2]=8*ne.length,ie}(e);let E,w,S,R,j,D=1732584193,P=-271733879,W=-1732584194,Y=271733878;for(E=0;E<v.length;E+=16)w=D,S=P,R=W,j=Y,D=d(D,P,W,Y,v[E+0],7,-680876936),Y=d(Y,D,P,W,v[E+1],12,-389564586),W=d(W,Y,D,P,v[E+2],17,606105819),P=d(P,W,Y,D,v[E+3],22,-1044525330),D=d(D,P,W,Y,v[E+4],7,-176418897),Y=d(Y,D,P,W,v[E+5],12,1200080426),W=d(W,Y,D,P,v[E+6],17,-1473231341),P=d(P,W,Y,D,v[E+7],22,-45705983),D=d(D,P,W,Y,v[E+8],7,1770035416),Y=d(Y,D,P,W,v[E+9],12,-1958414417),W=d(W,Y,D,P,v[E+10],17,-42063),P=d(P,W,Y,D,v[E+11],22,-1990404162),D=d(D,P,W,Y,v[E+12],7,1804603682),Y=d(Y,D,P,W,v[E+13],12,-40341101),W=d(W,Y,D,P,v[E+14],17,-1502002290),P=d(P,W,Y,D,v[E+15],22,1236535329),D=h(D,P,W,Y,v[E+1],5,-165796510),Y=h(Y,D,P,W,v[E+6],9,-1069501632),W=h(W,Y,D,P,v[E+11],14,643717713),P=h(P,W,Y,D,v[E+0],20,-373897302),D=h(D,P,W,Y,v[E+5],5,-701558691),Y=h(Y,D,P,W,v[E+10],9,38016083),W=h(W,Y,D,P,v[E+15],14,-660478335),P=h(P,W,Y,D,v[E+4],20,-405537848),D=h(D,P,W,Y,v[E+9],5,568446438),Y=h(Y,D,P,W,v[E+14],9,-1019803690),W=h(W,Y,D,P,v[E+3],14,-187363961),P=h(P,W,Y,D,v[E+8],20,1163531501),D=h(D,P,W,Y,v[E+13],5,-1444681467),Y=h(Y,D,P,W,v[E+2],9,-51403784),W=h(W,Y,D,P,v[E+7],14,1735328473),P=h(P,W,Y,D,v[E+12],20,-1926607734),D=f(D,P,W,Y,v[E+5],4,-378558),Y=f(Y,D,P,W,v[E+8],11,-2022574463),W=f(W,Y,D,P,v[E+11],16,1839030562),P=f(P,W,Y,D,v[E+14],23,-35309556),D=f(D,P,W,Y,v[E+1],4,-1530992060),Y=f(Y,D,P,W,v[E+4],11,1272893353),W=f(W,Y,D,P,v[E+7],16,-155497632),P=f(P,W,Y,D,v[E+10],23,-1094730640),D=f(D,P,W,Y,v[E+13],4,681279174),Y=f(Y,D,P,W,v[E+0],11,-358537222),W=f(W,Y,D,P,v[E+3],16,-722521979),P=f(P,W,Y,D,v[E+6],23,76029189),D=f(D,P,W,Y,v[E+9],4,-640364487),Y=f(Y,D,P,W,v[E+12],11,-421815835),W=f(W,Y,D,P,v[E+15],16,530742520),P=f(P,W,Y,D,v[E+2],23,-995338651),D=m(D,P,W,Y,v[E+0],6,-198630844),Y=m(Y,D,P,W,v[E+7],10,1126891415),W=m(W,Y,D,P,v[E+14],15,-1416354905),P=m(P,W,Y,D,v[E+5],21,-57434055),D=m(D,P,W,Y,v[E+12],6,1700485571),Y=m(Y,D,P,W,v[E+3],10,-1894986606),W=m(W,Y,D,P,v[E+10],15,-1051523),P=m(P,W,Y,D,v[E+1],21,-2054922799),D=m(D,P,W,Y,v[E+8],6,1873313359),Y=m(Y,D,P,W,v[E+15],10,-30611744),W=m(W,Y,D,P,v[E+6],15,-1560198380),P=m(P,W,Y,D,v[E+13],21,1309151649),D=m(D,P,W,Y,v[E+4],6,-145523070),Y=m(Y,D,P,W,v[E+11],10,-1120210379),W=m(W,Y,D,P,v[E+2],15,718787259),P=m(P,W,Y,D,v[E+9],21,-343485551),D=a(D,w),P=a(P,S),W=a(W,R),Y=a(Y,j);return r(D)+r(P)+r(W)+r(Y)}let ade=1,zG=console,Ks=class{static setLogger(e){zG=e}constructor(e,t){It(this,"id",void 0),It(this,"lockingPromise",Ue.resolve()),It(this,"locks",0),It(this,"name",""),It(this,"lockId",void 0),this.lockId=ade++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const r=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),a=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");zG.debug("".concat(r," ").concat(a))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const r=new Ue(c=>{t=()=>{this.locks-=1,this.logger("unlocked",e),c()}}),a=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>r),a}};function Pv(e,t){return function(r,a,c){const d=c.value;if(typeof d!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[t];if(!h)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const f=await h.lock("From ".concat(e,".").concat(a));try{for(var m=arguments.length,v=new Array(m),E=0;E<m;E++)v[E]=arguments[E];return await d.apply(this,v)}finally{f()}},c}}const ls={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function JN(e,t){const r=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,r)}function yd(e,t,r,a){const c=Object.assign({},ls,a);let d=c.timeout;const h=async()=>{await function(v){return new Ue(E=>{window.setTimeout(E,v)})}(d),d*=c.timeoutFactor,d=Math.min(c.maxRetryTimeout,d)};let f=!1;const m=new Ue(async(v,E)=>{t=t||(()=>!1),r=r||(()=>!0);for(let w=0;w<c.maxRetryCount;w+=1){if(f)return E(new we(K.OPERATION_ABORTED));try{const S=await e();if(!t(S,w)||w+1===c.maxRetryCount)return v(S);await h()}catch(S){if(!r(S,w)||w+1===c.maxRetryCount)return E(S);await h()}}});return m.cancel=()=>f=!0,m}let QN,Oj=class{constructor(e){It(this,"input",[]),It(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:To(e=this.input).call(e,(t,r)=>t+r)/this.input.length}},ZN=0,Dj=0;function Pj(e,t,r,a){return new Ue((c,d)=>{t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),ZN+=bu(t.data)):r&&(t.data.size?ZN+=t.data.size:t.data instanceof FormData?ZN+=jG(t.data):ZN+=bu(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Pa.request(t).then(h=>{typeof h.data=="string"?Dj+=bu(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?Dj+=h.data.byteLength:Dj+=bu(JSON.stringify(h.data)),c(h.data)}).catch(h=>{Pa.isCancel(h)?d(new we(K.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new we(K.NETWORK_TIMEOUT,h.message)):h.response?d(new we(K.NETWORK_RESPONSE_ERROR,h.response.status)):d(new we(K.NETWORK_ERROR,h.message))})})}async function ode(e,t){const r=new Blob([t.data],{type:"buffer"});return await Pj(e,Le(Le({},t),{},{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0)}const GG=()=>window.isSecureContext!==void 0;function Rl(e){if(Array.isArray(e))return e.map(r=>r);if(!WG(e))return e;const t={};for(const r in e){const a=e[r];WG(a)||Array.isArray(a)?t[r]=Rl(a):t[r]=a}return t}function WG(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let Lj=class{constructor(e){It(this,"input",[]),It(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Cl={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Gx={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],transport:{bytesSent:0,bytesReceived:0,packetsSent:0,packetsReceived:0},selectedCandidatePair:{id:"unknown",localCandidate:Cl,remoteCandidate:Cl},updateInterval:0},HG={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},KG={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},qG={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},YG={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let jj=class{constructor(e,t){It(this,"onFirstVideoReceived",void 0),It(this,"onFirstVideoDecoded",void 0),It(this,"onFirstAudioReceived",void 0),It(this,"onFirstVideoDecodedTimeout",void 0),It(this,"onFirstAudioDecoded",void 0),It(this,"onSelectedLocalCandidateChanged",void 0),It(this,"onSelectedRemoteCandidateChanged",void 0),It(this,"videoIsReady",!1),It(this,"videoIsReady2",{}),It(this,"pc",void 0),It(this,"options",void 0),It(this,"intervalTimer",void 0),It(this,"stats",Rl(Gx)),It(this,"isFirstVideoReceived",{}),It(this,"isFirstVideoDecoded",{}),It(this,"isFirstAudioReceived",{}),It(this,"isFirstAudioDecoded",{}),It(this,"isFirstVideoDecodedTimeout",{}),It(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Ue(e=>{e({local:Le({},Cl),remote:Le({},Cl)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,r=["videoSend","audioSend","videoRecv","audioRecv"];let a=0,c=0,d=0,h=0;for(const f of r)e[f].forEach((m,v)=>{if(!this.lossRateWindowStats[t-1][f][v]||!this.lossRateWindowStats[0][f][v])return;const E=this.lossRateWindowStats[t-1][f][v].packets-this.lossRateWindowStats[0][f][v].packets,w=this.lossRateWindowStats[t-1][f][v].packetsLost-this.lossRateWindowStats[0][f][v].packetsLost;f==="videoSend"||f==="audioSend"?(a+=E,d+=w):(c+=E,h+=w),Number.isNaN(E)||Number.isNaN(E)?m.packetLostRate=0:m.packetLostRate=E<=0||w<=0?0:w/(E+w)});e.sendPacketLossRate=a<=0||d<=0?0:d/(a+d),e.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},cde=class extends jj{constructor(){super(...arguments),It(this,"_stats",Gx),It(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=Rl(Gx);const r=t.filter(c=>c.type==="ssrc");this.processSSRCStats(r);const a=t.find(c=>c.type==="VideoBwe");a&&this.processBandwidthStats(a),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var r;const a=ke(r=t.id).call(r,"send");switch("".concat(t.mediaType,"_").concat(a?"send":"recv")){case"video_send":{const c=Rl(KG);c.codec=t.googCodecName,c.adaptionChangeReason="none",t.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(t.googAvgEncodeMs),c.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},c.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},c.firsCount=Number(t.googFirReceived),c.nacksCount=Number(t.googNacksReceived),c.plisCount=Number(t.googPlisReceived),c.frameCount=Number(t.framesEncoded),c.bytes=Number(t.bytesSent),c.packets=Number(t.packetsSent),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=Rl(HG),d=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(c.codec=t.googCodecName,c.targetDelayMs=Number(t.googTargetDelayMs),c.renderDelayMs=Number(t.googRenderDelayMs),c.currentDelayMs=Number(t.googCurrentDelayMs),c.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),c.decodeMs=Number(t.googDecodeMs),c.maxDecodeMs=Number(t.googMaxDecodeMs),c.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},c.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},c.decodeFrameRate=Number(t.googFrameRateDecoded),c.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},c.jitterBufferMs=Number(t.googJitterBufferMs),c.firsCount=Number(t.googFirsSent),c.nacksCount=Number(t.googNacksSent),c.plisCount=Number(t.googPlisSent),c.framesDecodeCount=Number(t.framesDecoded),c.bytes=Number(t.bytesReceived),c.packets=Number(t.packetsReceived),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),d){const h=d.stats,f=Date.now()-d.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(d.lts=Date.now(),c.framesDecodeInterval=f,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):c.framesDecodeCount<d.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:Le({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=Rl(YG);c.codec=t.googCodecName,c.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,c.decodingCNG=Number(t.googDecodingCNG),c.decodingCTN=Number(t.googDecodingCTN),c.decodingCTSG=Number(t.googDecodingCTSG),c.decodingNormal=Number(t.googDecodingNormal),c.decodingPLC=Number(t.googDecodingPLC),c.decodingPLCCNG=Number(t.googDecodingPLCCNG),c.expandRate=Number(t.googExpandRate),c.accelerateRate=Number(t.googAccelerateRate),c.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),c.speechExpandRate=Number(t.googSpeechExpandRate),c.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),c.jitterBufferMs=Number(t.googJitterBufferMs),c.jitterMs=Number(t.googJitterReceived),c.bytes=Number(t.bytesReceived),c.packets=Number(t.packetsReceived),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),c.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=Rl(qG);c.codec=t.googCodecName,c.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,c.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(t.bytesSent),c.packets=Number(t.packetsSent),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.rttMs=Number(t.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new Ue((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(r=>{const a={id:r.id,timestamp:r.timestamp.valueOf().toString(),type:r.type};r.names().forEach(c=>{a[c]=r.stat(c)}),t.push(a)}),t}},Lv=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),eI=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),Mj=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),ec=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var jv=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(jv||{});function Wx(e,t,r,a){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:jv.kNone;if(!t)return;const d=Number(t[r]);if(typeof d!="number")return;const h=Number(t[a]);if(typeof h!="number")return;if(!e)return h?d/h*c:void 0;const f=Number(e[r]);if(typeof f!="number")return;const m=Number(e[a]);if(typeof m!="number")return;const v=h-m;return v?(d-f)/v*c:void 0}let XG=class extends jj{constructor(){super(...arguments),It(this,"_stats",Gx),It(this,"report",void 0),It(this,"lastDecodeVideoReceiverStats",new Map),It(this,"lastVideoFramesRecv",new Map),It(this,"lastVideoFramesSent",new Map),It(this,"lastVideoFramesDecode",new Map),It(this,"lastVideoFramesOutput",new Map),It(this,"lastVideoJBDelay",new Map),It(this,"lastAudioJBDelay",new Map),It(this,"mediaBytesSent",new Map),It(this,"mediaBytesRetransmit",new Map),It(this,"mediaBytesTargetEncode",new Map),It(this,"lastDecodeAudioReceiverStats",new Map),It(this,"lastAudioConcealment",new Map),It(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Rl(Gx),this.report.forEach(e=>{switch(e.type){case ec.OUTBOUND:case ec.INBOUND:{const t=e.mediaType||e.kind,r=!t&&"frameWidth"in e,a=!t&&!("frameWidth"in e);e.type===ec.OUTBOUND?t==="audio"||a?this.processAudioOutboundStats(e):(t==="video"||r)&&this.processVideoOutboundStats(e):e.type===ec.INBOUND&&(t==="audio"||a?this.processAudioInboundStats(e):(t==="video"||r)&&this.processVideoInboundStats(e));break}case ec.TRANSPORT:{this.processTransportStats(e);const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case ec.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:Le({},Cl),remote:Le({},Cl)};return e.forEach(r=>{let a;if(r.type===ec.TRANSPORT&&(a=e.get(r.selectedCandidatePairId)),r.type===ec.CANDIDATE_PAIR&&r.selected&&(a=r),a){const c=(d,h)=>{d.type=h.type,d.id=h.id,h.address&&(d.address=h.address),h.candidateType&&(d.candidateType=h.candidateType),h.port&&(d.port=h.port),h.priority&&(d.priority=h.priority),h.protocol&&(d.protocol=h.protocol),h.relayProtocol&&(d.relayProtocol=h.relayProtocol)};if(a.localCandidateId){const d=e.get(a.localCandidateId);d&&c(t.local,d)}if(a.remoteCandidateId){const d=e.get(a.remoteCandidateId);d&&c(t.remote,d)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===ec.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===ec.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===ec.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Le({},t),Le({},this.stats.selectedCandidatePair.localCandidate)),e.type===ec.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Le({},t),Le({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(a=>a.ssrc===e.ssrc);t||(t=Rl(YG),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount,t.estimatedPlayoutTimestamp=e.estimatedPlayoutTimestamp;const r=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=Wx(r,t,"totalProcessingDelay","jitterBufferEmittedCount",jv.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,r,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,Le({},t))}calculateAudioFreeze(e,t,r){const a=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&a!=null){const c=a.lts,d=r.timestamp,h=d-c;if(h<=0)return;const f=e.concealedSamples-t.concealedSamples-0,m=a.nonSilent+f,v=e.totalSamplesReceived-t.totalSamplesReceived;if(v<=0)return;const E=80*v/h,w=200*v/h,S=h/v;let R=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,m>E&&(a.plc80>0?(e.freezeSamples80+=f,e.freezeMs80+=Math.round(f*S)):(e.freezeSamples80+=m,e.freezeMs80+=Math.round(m*S)),R=a.plc80+1);let j=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,m>w&&(a.plc200>0?(e.freezeSamples200+=f,e.freezeMs200+=Math.round(f*S)):(e.freezeSamples200+=m,e.freezeMs200+=Math.round(m*S)),j=a.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:f,lts:d,plc80:R,plc200:j})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:r.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(h=>h.ssrc===e.ssrc);t||(t=Rl(HG),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.estimatedPlayoutTimestamp=e.estimatedPlayoutTimestamp;const r=this.lastDecodeVideoReceiverStats.get(t.ssrc),a=this.lastVideoFramesDecode.get(t.ssrc),c=this.lastVideoFramesOutput.get(t.ssrc),d=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const h=t.decodedFrame?t.decodedFrame.width:0,f=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,h,f),this.isFirstVideoDecoded[t.ssrc]=!0}if(r){const h=r.stats,f=d-r.lts;t.framesDecodeFreezeTime=h.framesDecodeFreezeTime,t.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&f>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(r.lts=Date.now(),t.framesDecodeInterval=f,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<h.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(r.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-r.qpSum)/(e.framesDecoded-r.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=Wx(r==null?void 0:r.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=Wx(r==null?void 0:r.stats,t,"totalProcessingDelay","framesDecodeCount",jv.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=Wx(r==null?void 0:r.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",jv.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=Wx(r==null?void 0:r.stats,t,"totalInterFrameDelay","framesDecodeCount",jv.kMillisecondsFromSeconds),a&&d-a.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-a.count)/((d-a.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:d,rate:t.decodeFrameRate})):a?t.decodeFrameRate=a.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:d,rate:0}),t.framesDroppedCount&&e.framesReceived&&(c&&d-c.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-c.count)/((d-c.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:d,rate:Math.max(t.outputFrameRate,0)})):c?t.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:d,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:Le({},t),lts:r?r.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(a=>a.ssrc===e.ssrc);t||(t=Rl(KG),this._stats.videoSend.push(t));const r=this.mediaBytesSent.get(e.ssrc);if(r)r.add(e.bytesSent);else{const a=new Lj(10);a.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,a)}if(e.retransmittedBytesSent!==void 0){const a=this.mediaBytesRetransmit.get(e.ssrc);if(a)a.add(e.retransmittedBytesSent);else{const c=new Lj(10);c.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,c)}}if(e.totalEncodedBytesTarget){const a=this.mediaBytesTargetEncode.get(e.ssrc);if(a)a.add(e.totalEncodedBytesTarget);else{const c=new Lj(10);c.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,c)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const a=this.lastEncoderMs.get(e.ssrc);if(!a||a.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const c=e.framesEncoded-a.lastFrameCount,d=e.totalEncodeTime-a.lastEncoderTime;t.avgEncodeMs=1e3*d/c}}if(e.framesEncoded&&e.qpSum){const a=this.lastEncoderMs.get(e.ssrc);!a||a.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-a.lastQpSum)/(e.framesEncoded-a.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const a=this.findRemoteStatsId(e.ssrc,ec.REMOTE_INBOUND);a&&this.processRemoteInboundStats(a,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(r=>r.ssrc===e.ssrc);if(t||(t=Rl(qG),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const r=this.findRemoteStatsId(e.ssrc,ec.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}processTransportStats(e){this._stats.transport.bytesReceived=e.bytesReceived||this._stats.transport.bytesReceived,this._stats.transport.bytesSent=e.bytesSent||this._stats.transport.bytesSent,this._stats.transport.packetsReceived=e.packetsReceived||this._stats.transport.packetsReceived,this._stats.transport.packetsSent=e.packetsSent||this._stats.transport.packetsSent}findRemoteStatsId(e,t){var r;const a=Array.from(Oa(r=this.report).call(r)).find(c=>c.type===t&&c.ssrc===e);return a?a.id:null}processVideoMediaSource(e,t){const r=this.report.get(e);r&&r.width&&r.height&&r.framesPerSecond&&(t.inputFrame={width:r.width,height:r.height,frameRate:r.framesPerSecond})}processAudioMediaSource(e,t){const r=this.report.get(e);r&&(t.inputLevel=r.audioLevel)}processVideoTrackSenderStats(e,t,r){var a,c,d,h;const f=t?this.report.get(t):void 0,m=(a=f==null?void 0:f.framesSent)!==null&&a!==void 0?a:e.framesSent;if(typeof m!="number")return;let v=(c=f==null?void 0:f.frameWidth)!==null&&c!==void 0?c:e.frameWidth,E=(d=f==null?void 0:f.frameHeight)!==null&&d!==void 0?d:e.frameHeight,w=(h=f==null?void 0:f.framesPerSecond)!==null&&h!==void 0?h:e.framesPerSecond;if(typeof v=="number"&&typeof E=="number"||(v=0,E=0),w==null){const S=Date.now(),R=this.lastVideoFramesSent.get(r.ssrc);R&&S-R.lts>=800?(w=Math.round((m-R.count)/((S-R.lts)/1e3)),this.lastVideoFramesSent.set(r.ssrc,{count:m,lts:S,rate:w})):R?w=R.rate:this.lastVideoFramesSent.set(r.ssrc,{count:m,lts:S,rate:0})}r.sentFrame={width:v,height:E,frameRate:Math.max(0,w)}}processVideoTrackReceiverStats(e,t,r){var a,c,d,h,f;const m=t?this.report.get(t):void 0,v=(a=m==null?void 0:m.framesReceived)!==null&&a!==void 0?a:e.framesReceived,E=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:e.frameWidth,w=(d=m==null?void 0:m.frameHeight)!==null&&d!==void 0?d:e.frameHeight,S=(h=m==null?void 0:m.jitterBufferDelay)!==null&&h!==void 0?h:e.jitterBufferDelay,R=(f=m==null?void 0:m.jitterBufferEmittedCount)!==null&&f!==void 0?f:e.jitterBufferEmittedCount;if(typeof v=="number"){const j=this.lastVideoFramesRecv.get(r.ssrc),D=Date.now();r.framesReceivedCount=v;let P=0;j&&D-j.lts>=800?(P=Math.round((v-j.count)/((D-j.lts)/1e3)),this.lastVideoFramesRecv.set(r.ssrc,{count:v,lts:D,rate:P})):j?P=j.rate:this.lastVideoFramesRecv.set(r.ssrc,{count:v,lts:D,rate:0}),r.receivedFrame={width:E||0,height:w||0,frameRate:P||0},r.decodedFrame={width:E||0,height:w||0,frameRate:r.decodeFrameRate||0},r.outputFrame={width:E||0,height:w||0,frameRate:r.outputFrameRate||r.decodeFrameRate||0}}if(S&&R){const j=this.lastVideoJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let D=j.jitterBufferMs;const P=R-j.jitterBufferEmittedCount;P>0&&(D=1e3*(S-j.jitterBufferDelay)/P),r.jitterBufferMs=D,r.currentDelayMs=Math.round(D),this.lastVideoJBDelay.set(r.ssrc,{jitterBufferDelay:S,jitterBufferEmittedCount:R,jitterBufferMs:r.currentDelayMs})}}processAudioTrackSenderStats(e,t,r){var a,c,d,h;const f=t?this.report.get(t):void 0,m=(a=(c=f==null?void 0:f.echoReturnLoss)!==null&&c!==void 0?c:e.echoReturnLoss)!==null&&a!==void 0?a:0,v=(d=(h=f==null?void 0:f.echoReturnLossEnhancement)!==null&&h!==void 0?h:e.echoReturnLossEnhancement)!==null&&d!==void 0?d:0;r.aecReturnLoss=m,r.aecReturnLossEnhancement=v}processAudioTrackReceiverStats(e,t,r){var a,c,d,h,f,m,v,E,w;const S=t?this.report.get(t):void 0,R=(a=S==null?void 0:S.removedSamplesForAcceleration)!==null&&a!==void 0?a:e.removedSamplesForAcceleration,j=(c=S==null?void 0:S.totalSamplesReceived)!==null&&c!==void 0?c:e.totalSamplesReceived,D=(d=S==null?void 0:S.jitterBufferDelay)!==null&&d!==void 0?d:e.jitterBufferDelay,P=(h=S==null?void 0:S.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount,W=(f=S==null?void 0:S.audioLevel)!==null&&f!==void 0?f:e==null?void 0:e.audioLevel,Y=(m=S==null?void 0:S.totalSamplesDuration)!==null&&m!==void 0?m:e==null?void 0:e.totalSamplesDuration,ne=(v=S==null?void 0:S.concealedSamples)!==null&&v!==void 0?v:e.concealedSamples,le=(E=S==null?void 0:S.silentConcealedSamples)!==null&&E!==void 0?E:e.silentConcealedSamples,fe=(w=S==null?void 0:S.concealmentEvents)!==null&&w!==void 0?w:e.concealmentEvents;if(typeof j=="number"&&(r.totalSamplesReceived=j),typeof le=="number"&&(r.silentConcealedSamples=le),typeof fe=="number"&&(r.concealmentEvents=fe),typeof ne=="number"&&(r.concealedSamples=ne),R&&j&&(r.accelerateRate=R/j),D&&P){const _e=this.lastAudioJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let Te=_e.jitterBufferMs;const Ne=P-_e.jitterBufferEmittedCount;Ne>0&&(Te=1e3*(D-_e.jitterBufferDelay)/Ne),r.jitterBufferMs=Math.round(Te),this.lastAudioJBDelay.set(r.ssrc,{jitterBufferDelay:D,jitterBufferEmittedCount:P,jitterBufferMs:r.jitterBufferMs})}r.outputLevel=W;let ie=1920;Y&&j&&(ie=j/Y/50,r.receivedFrames=Math.round(j/ie)),ne&&(r.droppedFrames=Math.round(ne/ie))}processRemoteInboundStats(e,t){const r=this.report.get(e);r&&(t.packetsLost=r.packetsLost,r.roundTripTime&&(t.rttMs=1e3*r.roundTripTime),r.jitter&&(t.jitterMs=1e3*r.jitter),r.timestamp&&(t.timestamp=r.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const r=t.mimeType.match(/\/(.*)$/);return r&&r[1]?r[1]:""}updateSendBitrate(){let e=0,t=null,r=null;this.mediaBytesSent.forEach(c=>{e+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{t=t===null?c.diffMean():t+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()});const a=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*a/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),r!==null&&(this._stats.bitrate.targetEncoded=8*r/(this.options.updateInterval/1e3))}},lde=class extends jj{updateStats(){return Ue.resolve()}};function tI(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const d=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return d?d<76?new cde(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:c}):new XG(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const f=h.getStats();return!!(f instanceof Ue||function(m){return!!m&&(typeof m=="object"||typeof m=="function")&&typeof m.then=="function"}(f))}(e)?new XG(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:c}):new lde(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:c})}const $G="websdk_ng_install_id";function Uj(){try{if(z("INSTALL_ID"))return z("INSTALL_ID");let e=window.localStorage.getItem($G);return e||(e=Ng(),window.localStorage.setItem($G,e)),Wn("INSTALL_ID",e),e}catch{return}}const kc=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const r=t[1],a=t[2];return"".concat(r,".").concat(a)}return"4.0.0.999"}("4.24.2"),Vj=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let Ig=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const mi=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),r=["t","s","t"];r.splice(1,0,"e");const a=r.join(""),c=[];for(let f=0;f<6;f++)c.push("1");const d=c.join(""),h={};return h[e]=a,h[t]=d,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=mi;const nI={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},Fj={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},Bj="v4.24.2-0-g002485b1-dirty(12/12/2025, 5:26:54 PM)",zj={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",TURN_DOMAINS:["edge.agora.io"],USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,FLS_FALLBACK_TIMEOUT:3e4,RTE_DETAIL_REPORT_INTERVAL:6e4,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0,UPDATE_RTP_CAP_IN_HOST:!1,IOS_BG_TAG:!0,IOS_AUTO_RESTART_BG_TAG:!0,IGNORE_UID_CHECK:!1,ENABLE_UP_SPS_PPS:!1,ENABLE_DOWN_SPS_PPS:!1,NO_EDGES_RETRY:!0,BUFFER_READY_FRAMES:3,FLS_SYNC_AV_PLAY_LIMIT:0,FLS_BUFFER_WAIT_TIME:1500,VOS_CONFIGURE:void 0,ENABLE_QUALITY_FALLBACK:!1,QUALITY_FALLBACK_REHEARSAL:!0,ENABLE_FLS_AV1_FIRST:!1,ENABLE_AP_MULTI_IP:!0,FLS_ENABLE_AV1_DETECT:!0,FLS_ENABLE_AV1_DECODE_DETECT:!0},Mn=Le(Le(Le(Le({},zj),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_MANAGER_WSS:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_WSS:"",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,DC_JOIN_WITH_FAILBACK:4e3,DC_CONNECTION_TIMEOUT:2e3,DC_PINGPONG_INTERVAL:2e3,DC_DEBUG_LOG:!1,UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:Fj,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},nI),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,REMOTE_VIDEO_STREAM_TYPE:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_FORCE_HLS:!1,MAX_WEBAUDIO_VOLUME:300,ENABLE_VOS_FALLBACK:!1,ENABLE_FALLBACK_TO_HLS:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!0,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1,IGNORE_RTC_DEVICE_CHECK:!1,FLS_AUTOPLAY_EMITS:!1,ENABLE_DUAL_STREAM_FLAG:!1,FORBID_MODIFY_LOCAL_OFFER_SDP:!1,RESERVE_MID_1_MLINE:!1});function Wn(e,t,r){var a,c,d;ke(a=Object.keys(Mn)).call(a,e)&&(!r&&ke(c=Object.keys(tc)).call(c,e)||(Mn[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(Mn.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(d=!!t,Mn.USE_NEW_NETWORK_CONFIG=d,d&&(Mn.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Mn.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Mn.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Mn.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Mn.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Mn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Mn.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(Mn.ENABLE_INSTANT_VIDEO=!0,Mn.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(Mn.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(Mn.NEW_TURN_MODE||(Mn.NEW_TURN_MODE=4))))}function z(e){if(e==="TURN_DOMAINS"){const t=Mn.TURN_DOMAINS;return ke(t).call(t,z("TURN_DOMAIN"))?t:[z("TURN_DOMAIN")].concat(t)}return Mn[e]}Vj||(Mn.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Mn.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Mn.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Mn.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Mn.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Mn.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Mn.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Mn.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Mn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Mn.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Mn.AREAS=["NORTH_AMERICA","OVERSEA"]);let JG=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const tc={};var Tt=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_RTE_URL="SET_RTE_URL",e.SET_RTE_SID="SET_RTE_SID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(Tt||{});let Ag=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const QG=128,dde=96,ZG=1e3,Mv=10;let ude=0;var eW=(()=>{var e={8:(a,c,d)=>{d.r(c),d.d(c,{Parser:()=>Ne,Printer:()=>Ot,parse:()=>je,print:()=>Ze});const h=`
`,f="".concat("\r").concat(h),m=" ";let v;function E(Ce){return Ce>="0"&&Ce<="9"}function w(Ce){return Ce>="!"&&Ce<="~"}function S(Ce){return w(Ce)||Ce>=""&&Ce<=""}function R(Ce){return Ce==="!"||Ce>="#"&&Ce<="'"||Ce>="*"&&Ce<="+"||Ce>="-"&&Ce<="."||Ce>="0"&&Ce<="9"||Ce>="A"&&Ce<="Z"||Ce>="^"&&Ce<="~"}function j(Ce){return Ce>="1"&&Ce<="9"}function D(Ce){return Ce>="A"&&Ce<="Z"||Ce>="a"&&Ce<="z"}function P(Ce){return Ce==="d"||Ce==="h"||Ce==="m"||Ce==="s"}function W(Ce){return Ce>""&&Ce<"	"||Ce>"\v"&&Ce<"\f"||Ce>""&&Ce<""}function Y(Ce){return D(Ce)||E(Ce)||Ce==="+"||Ce==="/"}function ne(Ce){return E(Ce)||D(Ce)||Ce==="+"||Ce==="/"||Ce==="-"||Ce==="_"}function le(Ce){return D(Ce)||E(Ce)||Ce==="+"||Ce==="/"}function fe(Ce,O){var te=Object.keys(Ce);if(Object.getOwnPropertySymbols){var oe=Object.getOwnPropertySymbols(Ce);O&&(oe=oe.filter(function(Pe){return Object.getOwnPropertyDescriptor(Ce,Pe).enumerable})),te.push.apply(te,oe)}return te}function ie(Ce){for(var O=1;O<arguments.length;O++){var te=arguments[O]!=null?arguments[O]:{};O%2?fe(Object(te),!0).forEach(function(oe){_e(Ce,oe,te[oe])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Ce,Object.getOwnPropertyDescriptors(te)):fe(Object(te)).forEach(function(oe){Object.defineProperty(Ce,oe,Object.getOwnPropertyDescriptor(te,oe))})}return Ce}function _e(Ce,O,te){return O in Ce?Object.defineProperty(Ce,O,{value:te,enumerable:!0,configurable:!0,writable:!0}):Ce[O]=te,Ce}(function(Ce){Ce.VERSION="v",Ce.ORIGIN="o",Ce.SESSION_NAME="s",Ce.INFORMATION="i",Ce.URI="u",Ce.EMAIL="e",Ce.PHONE="p",Ce.CONNECTION="c",Ce.BANDWIDTH="b",Ce.TIME="t",Ce.REPEAT="r",Ce.ZONE_ADJUSTMENTS="z",Ce.KEY="k",Ce.ATTRIBUTE="a",Ce.MEDIA="m"})(v||(v={}));class Te{consumeText(O,te){let oe=te;for(;oe<O.length;){const Pe=O[oe];if(Pe==="\0"||Pe==="\r"||Pe===h)break;oe+=1}if(oe-te==0)throw new Error("Invalid text, at ".concat(O));return oe}consumeUnicastAddress(O,te,oe){return this.consumeTill(O,te,m)}consumeOneOrMore(O,te,oe){let Pe=te;for(;oe(O[Pe]);)Pe++;if(Pe-te==0)throw new Error("Invalid rule at ".concat(te,"."));return Pe}consumeSpace(O,te){if(O[te]===m)return te+1;throw new Error("Invalid space at ".concat(te,"."))}consumeIP4Address(O,te){let oe=te;for(let Pe=0;Pe<4;Pe++)if(oe=this.consumeDecimalUChar(O,oe),Pe!==3){if(O[oe]!==".")throw new Error("Invalid IP4 address.");oe++}return oe}consumeDecimalUChar(O,te){let oe=te;for(let Nt=0;Nt<3&&E(O[oe]);Nt++,oe++);if(oe-te==0)throw new Error("Invalid decimal uchar.");const Pe=parseInt(O.slice(te,oe));if(Pe>=0&&Pe<=255)return oe;throw new Error("Invalid decimal uchar")}consumeIP6Address(O,te){let oe=this.consumeHexpart(O,te);return O[oe]===":"&&(oe+=1,oe=this.consumeIP4Address(O,oe)),oe}consumeHexpart(O,te){let oe=te;if(O[oe]===":"&&O[oe+1]===":"){oe+=2;try{oe=this.consumeHexseq(O,oe)}catch{}return oe}if(oe=this.consumeHexseq(O,oe),O[oe]===":"&&O[oe+1]===":"){oe+=2;try{oe=this.consumeHexseq(O,oe)}catch{}return oe}return oe}consumeHexseq(O,te){let oe=te;for(;oe=this.consumeHex4(O,oe),O[oe]===":"&&O[oe+1]!==":";)oe+=1;return oe}consumeHex4(O,te){let oe=0;for(;oe<4;oe++)if(!((Pe=O[te+oe])>="0"&&Pe<="9"||Pe>="a"&&Pe<="f"||Pe>="A"&&Pe<="F")){if(oe===0)throw new Error("Invalid hex 4");break}var Pe;return te+oe}consumeFQDN(O,te){let oe=te;for(;E(O[oe])||D(O[oe])||O[oe]==="-"||O[oe]===".";)oe+=1;if(oe-te<4)throw new Error("Invalid FQDN");return oe}consumeExtnAddr(O,te){return this.consumeOneOrMore(O,te,S)}consumeMulticastAddress(O,te,oe){switch(oe){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(O,te);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(O,te);default:try{return this.consumeFQDN(O,te)}catch{return this.consumeExtnAddr(O,te)}}}consumeIP6MulticastAddress(O,te){const oe=this.consumeHexpart(O,te);return O[oe]==="/"?this.consumeInteger(O,oe+1):oe}consumeIP4MulticastAddress(O,te){let oe=te+3;const Pe=O.slice(te,oe),Nt=parseInt(Pe);if(Nt<224||Nt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let nr=0;nr<3;nr++){if(O[oe]!==".")throw new Error("Invalid IP4 multicast address.");oe+=1,oe=this.consumeDecimalUChar(O,oe)}return O[oe]==="/"&&(oe+=1),oe=this.consumeTTL(O,oe),O[oe]==="/"&&(oe=this.consumeInteger(O,oe)),oe}consumeInteger(O,te){if(!j(O[te]))throw new Error("Invalid integer.");for(te+=1;E(O[te]);)te+=1;return te}consumeTTL(O,te){if(O[te]==="0")return te+1;if(!j(O[te]))throw new Error("Invalid TTL.");te+=1;for(let oe=0;oe<2&&E(O[te]);oe++)te+=1;return te}consumeToken(O,te){return this.consumeOneOrMore(O,te,R)}consumeTime(O,te){let oe=te;if(O[oe]==="0")return oe+1;for(j(O[oe])&&(oe+=1);E(O[oe]);)oe++;if(oe-te<10)throw new Error("Invalid time");return oe}consumeAddress(O,te){return this.consumeTill(O,te,m)}consumeTypedTime(O,te){let oe=te;return oe=this.consumeOneOrMore(O,oe,E),P(O[oe])?oe+1:oe}consumeRepeatInterval(O,te){if(!j(O[te]))throw new Error("Invalid repeat interval");for(te+=1;E(O[te]);)te+=1;return P(O[te])&&(te+=1),te}consumePort(O,te){return this.consumeOneOrMore(O,te,E)}consume(O,te,oe){for(let Pe=0;Pe<oe.length;Pe++){if(te+Pe>=O.length)throw new Error("consume exceeding value length");if(O[te+Pe]!==oe[Pe])throw new Error("consume ".concat(oe," failed at ").concat(Pe))}return te+oe.length}consumeTill(O,te,oe){let Pe=te;for(;Pe<O.length&&(typeof oe!="string"||O[Pe]!==oe)&&(typeof oe!="function"||!oe(O[Pe]));)Pe++;return Pe}}class Ne extends Te{constructor(){super(),_e(this,"records",[]),_e(this,"currentLine",0)}parse(O){const te=this.probeEOL(O);this.records=O.split(te).filter(Nf=>!!ha(Nf).call(Nf)).map(this.parseLine),this.currentLine=0;const oe=this.parseVersion(),Pe=this.parseOrigin(),Nt=this.parseSessionName(),nr=this.parseInformation(),Ms=this.parseUri(),Fc=this.parseEmail(),Cf=this.parsePhone(),vA=this.parseConnection(),mE=this.parseBandWidth(),EA=this.parseTimeFields(),e_=this.parseKey(),Nw=this.parseSessionAttribute(),t_=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:oe,origin:Pe,sessionName:Nt,information:nr,uri:Ms,emails:Fc,phones:Cf,connection:vA,bandwidths:mE,timeFields:EA,key:e_,attributes:Nw,mediaDescriptions:t_}}getCurrentRecord(){const O=this.records[this.currentLine];if(!O)throw new Error("Record doesn't exit.");return O}probeEOL(O){for(let te=0;te<O.length;te++)if(O[te]===h)return O[te-1]==="\r"?f:h;throw new Error("Invalid newline character.")}parseLine(O,te){if(O.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const oe=O[0];if(O[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:oe,value:O.slice(2),line:te,cur:0}}parseSessionAttribute(){const O=new St;for(;this.currentLine<this.records.length;){const te=this.getCurrentRecord();if(te.type!==v.ATTRIBUTE)break;const oe={attField:this.extractOneOrMore(te,Pe=>R(Pe)&&Pe!==":"),_cur:0};te.value[te.cur]===":"&&(te.cur+=1,oe.attValue=this.extractOneOrMore(te,W)),O.parse(oe),this.currentLine++}return O.digest()}parseMediaAttributes(O){const te=new Et(O);for(;this.currentLine<this.records.length;){const oe=this.getCurrentRecord();if(oe.type!==v.ATTRIBUTE)break;const Pe={attField:this.extractOneOrMore(oe,Nt=>R(Nt)&&Nt!==":"),_cur:0};oe.value[oe.cur]===":"&&(oe.cur+=1,Pe.attValue=this.extractOneOrMore(oe,W)),te.parse(Pe),this.currentLine++}return te.digest()}parseKey(){const O=this.getCurrentRecord();if(O.type===v.KEY){if(O.value==="prompt"||O.value==="clear:"||O.value==="base64:"||O.value==="uri:")return O.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const O=this.getCurrentRecord();if(O.type===v.ZONE_ADJUSTMENTS){const te=[];for(;;)try{const oe=this.extract(O,this.consumeTime);this.consumeSpaceForRecord(O);let Pe=!1;O.value[O.cur]==="-"&&(Pe=!0,O.cur+=1);const Nt=this.extract(O,this.consumeTypedTime);te.push({time:oe,typedTime:Nt,back:Pe})}catch{break}if(te.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,te}return[]}parseRepeat(){const O=[];for(;;){const te=this.getCurrentRecord();if(te.type!==v.REPEAT)break;{const oe=this.extract(te,this.consumeRepeatInterval),Pe=this.parseTypedTime(te);O.push({repeatInterval:oe,typedTimes:Pe}),this.currentLine++}}return O}parseTypedTime(O){const te=[];for(;;)try{this.consumeSpaceForRecord(O),te.push(this.extract(O,this.consumeTypedTime))}catch{break}if(te.length===0)throw new Error("Invalid typed time.");return te}parseTime(){const O=this.getCurrentRecord(),te=this.extract(O,this.consumeTime);this.consumeSpaceForRecord(O);const oe=this.extract(O,this.consumeTime);return this.currentLine++,{startTime:te,stopTime:oe}}parseBandWidth(){const O=[];for(;this.currentLine<this.records.length;){const te=this.getCurrentRecord();if(te.type!==v.BANDWIDTH)break;{const oe=this.extractOneOrMore(te,R);if(te.value[te.cur]!==":")throw new Error("Invalid bandwidth field.");te.cur++;const Pe=this.extractOneOrMore(te,E);O.push({bwtype:oe,bandwidth:Pe}),this.currentLine++}}return O}parseVersion(){const O=this.getCurrentRecord();if(O.type!==v.VERSION)throw new Error("first sdp record must be version");const te=O.value.slice(0,this.consumeOneOrMore(O.value,0,E));if(te.length!==O.value.length)throw new Error('invalid proto version, "v='.concat(O.value,'"'));return this.currentLine++,te}parseOrigin(){const O=this.getCurrentRecord();if(O.type!==v.ORIGIN)throw new Error("second line of sdp must be origin");const te=this.extractOneOrMore(O,S);this.consumeSpaceForRecord(O);const oe=this.extractOneOrMore(O,E);this.consumeSpaceForRecord(O);const Pe=this.extractOneOrMore(O,E);this.consumeSpaceForRecord(O);const Nt=this.extractOneOrMore(O,R);this.consumeSpaceForRecord(O);const nr=this.extractOneOrMore(O,R);this.consumeSpaceForRecord(O);const Ms=this.extract(O,this.consumeUnicastAddress);return this.currentLine++,{username:te,sessId:oe,sessVersion:Pe,nettype:Nt,addrtype:nr,unicastAddress:Ms}}parseSessionName(){const O=this.getCurrentRecord();if(O.type===v.SESSION_NAME){const te=this.extract(O,this.consumeText);return this.currentLine++,te}}parseInformation(){const O=this.getCurrentRecord();if(O.type!==v.INFORMATION)return;const te=this.extract(O,this.consumeText);return this.currentLine++,te}parseUri(){const O=this.getCurrentRecord();if(O.type===v.URI)return this.currentLine++,O.value}parseEmail(){const O=[];for(;;){const te=this.getCurrentRecord();if(te.type!==v.EMAIL)break;O.push(te.value),this.currentLine++}return O}parsePhone(){const O=[];for(;;){const te=this.getCurrentRecord();if(te.type!==v.PHONE)break;O.push(te.value),this.currentLine++}return O}parseConnection(){const O=this.getCurrentRecord();if(O.type===v.CONNECTION){const te=this.extractOneOrMore(O,R);this.consumeSpaceForRecord(O);const oe=this.extractOneOrMore(O,R);this.consumeSpaceForRecord(O);const Pe=this.extract(O,this.consumeAddress);return this.currentLine++,{nettype:te,addrtype:oe,address:Pe}}}parseMedia(){const O=this.getCurrentRecord(),te=this.extract(O,this.consumeToken);this.consumeSpaceForRecord(O);let oe=this.extract(O,this.consumePort);O.value[O.cur]==="/"&&(O.cur+=1,oe+=this.extract(O,this.consumeInteger)),this.consumeSpaceForRecord(O);const Pe=[];for(Pe.push(this.extract(O,this.consumeToken));O.value[O.cur]==="/";)O.cur+=1,Pe.push(this.extract(O,this.consumeToken));if(Pe.length===0)throw new Error("Invalid proto");const Nt=this.parseFmt(O);return this.currentLine++,{mediaType:te,port:oe,protos:Pe,fmts:Nt}}parseTimeFields(){const O=[];for(;this.getCurrentRecord().type===v.TIME;){const te=this.parseTime(),oe=this.parseRepeat(),Pe=this.parseZone();O.push({time:te,repeats:oe,zones:Pe})}return O}parseMediaDescription(){const O=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.MEDIA;){const te=this.parseMedia(),oe=this.parseInformation(),Pe=this.parseConnections(),Nt=this.parseBandWidth(),nr=this.parseKey(),Ms=this.parseMediaAttributes(te);O.push({media:te,information:oe,connections:Pe,bandwidths:Nt,key:nr,attributes:Ms})}return O}parseConnections(){const O=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.CONNECTION;)O.push(this.parseConnection());return O}parseFmt(O){const te=[];for(;;)try{this.consumeSpaceForRecord(O),te.push(this.extract(O,this.consumeToken))}catch{break}if(te.length===0)throw new Error("Invalid fmts");return te}extract(O,te){for(var oe=arguments.length,Pe=new Array(oe>2?oe-2:0),Nt=2;Nt<oe;Nt++)Pe[Nt-2]=arguments[Nt];const nr=te.call(this,O.value,O.cur,...Pe),Ms=O.value.slice(O.cur,nr);return O.cur=nr,Ms}extractOneOrMore(O,te){const oe=this.consumeOneOrMore(O.value,O.cur,te),Pe=O.value.slice(O.cur,oe);return O.cur=oe,Pe}consumeSpaceForRecord(O){if(O.value[O.cur]!==m)throw new Error("Invalid space at ".concat(O.cur,"."));O.cur+=1}}class Ke extends Te{constructor(){super(...arguments),_e(this,"attributes",void 0),_e(this,"digested",!1)}extractOneOrMore(O,te,oe){const Pe=this.consumeOneOrMore(O.attValue,O._cur,te),Nt=O.attValue.slice(O._cur,Pe),[nr,Ms]=oe||[];if(typeof nr=="number"&&Nt.length<nr)throw new Error("error in length, should be more or equal than ".concat(nr," characters."));if(typeof Ms=="number"&&Nt.length>Ms)throw new Error("error in length, should be less or equal than ".concat(Ms," characters."));return O._cur=Pe,Nt}consumeAttributeSpace(O){if(O.attValue[O._cur]!==m)throw new Error("Invalid space at ".concat(O._cur,"."));O._cur+=1}extract(O,te){if(!O.attValue)throw new Error("Nothing to extract from attValue.");for(var oe=arguments.length,Pe=new Array(oe>2?oe-2:0),Nt=2;Nt<oe;Nt++)Pe[Nt-2]=arguments[Nt];const nr=te.call(this,O.attValue,O._cur,...Pe),Ms=O.attValue.slice(O._cur,nr);return O._cur=nr,Ms}atEnd(O){if(!O.attValue)throw new Error;return O._cur>=O.attValue.length}peekChar(O){if(!O.attValue)throw new Error;return O.attValue[O._cur]}peek(O,te){if(!O.attValue)throw new Error;for(let oe=0;oe<te.length;oe++)if(te[oe]!==O.attValue[O._cur+oe])return!1;return!0}parseIceUfrag(O){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(O,Y,[4,256])}parseIcePwd(O){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(O,Y,[22,256])}parseIceOptions(O){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const te=[];for(;!this.atEnd(O);){te.push(this.extractOneOrMore(O,Y));try{this.consumeAttributeSpace(O)}catch(oe){if(this.atEnd(O))break;throw oe}}this.attributes.iceOptions=te}parseFingerprint(O){const te=this.extract(O,this.consumeToken);this.consumeAttributeSpace(O);const oe=this.extract(O,this.consumeTill);this.attributes.fingerprints.push({hashFunction:te,fingerprint:oe})}parseExtmap(O){const te=this.extractOneOrMore(O,E);let oe;this.peekChar(O)==="/"&&(this.extract(O,this.consume,"/"),oe=this.extract(O,this.consumeToken)),this.consumeAttributeSpace(O);const Pe=this.extract(O,this.consumeTill,m),Nt=ie(ie({entry:parseInt(te,10)},oe&&{direction:oe}),{},{extensionName:Pe});this.peekChar(O)===m&&(this.consumeAttributeSpace(O),Nt.extensionAttributes=this.extract(O,this.consumeTill)),this.attributes.extmaps.push(Nt)}parseSetup(O){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const te=this.extract(O,this.consumeTill);if(te!=="active"&&te!=="passive"&&te!=="actpass"&&te!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=te}}class St extends Ke{constructor(){super(...arguments),_e(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(O){if(this.digested)throw new Error("already digested");try{switch(O.attField){case"group":this.parseGroup(O);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(O);break;case"ice-pwd":this.parseIcePwd(O);break;case"ice-options":this.parseIceOptions(O);break;case"fingerprint":this.parseFingerprint(O);break;case"setup":this.parseSetup(O);break;case"tls-id":this.parseTlsId(O);break;case"identity":this.parseIdentity(O);break;case"extmap":this.parseExtmap(O);break;case"msid-semantic":this.parseMsidSemantic(O);break;default:O.ignored=!0,this.attributes.unrecognized.push(O)}}catch(te){throw console.error("parsing session attribute ".concat(O.attField,' error, "a=').concat(O.attField,":").concat(O.attValue,'"')),te}if(!O.ignored&&O.attValue&&!this.atEnd(O))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(O){const te=this.extract(O,this.consumeToken),oe=[];for(;!this.atEnd(O)&&this.peekChar(O)===m;)this.consumeAttributeSpace(O),oe.push(this.extract(O,this.consumeToken));this.attributes.groups.push({semantic:te,identificationTag:oe})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(O){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(O,ne)}parseIdentity(O){const te=this.extractOneOrMore(O,le),oe=[];for(;!this.atEnd(O)&&this.peekChar(O)===m;){this.consumeAttributeSpace(O);const Pe=this.extract(O,this.consumeToken);this.extract(O,this.consume,"=");const Nt=this.extractOneOrMore(O,nr=>nr!==m&&W(nr));oe.push({name:Pe,value:Nt})}this.attributes.identities.push({assertionValue:te,extensions:oe})}parseMsidSemantic(O){this.peekChar(O)===m&&this.consumeAttributeSpace(O);const te={semantic:this.extract(O,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(O)}catch{break}if(this.peekChar(O)==="*"){this.extract(O,this.consume,"*"),te.applyForAll=!0;break}{const oe=this.extract(O,this.consumeTill,m);te.identifierList.push(oe)}}this.attributes.msidSemantic=te}}class Et extends Ke{constructor(O){super(),_e(this,"attributes",void 0),O.protos.indexOf("RTP")!==-1||O.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(O){if(this.digested)throw new Error("already digested");try{switch(O.attField){case"extmap":this.parseExtmap(O);break;case"setup":this.parseSetup(O);break;case"ice-ufrag":this.parseIceUfrag(O);break;case"ice-pwd":this.parseIcePwd(O);break;case"ice-options":this.parseIceOptions(O);break;case"candidate":this.parseCandidate(O);break;case"remote-candidate":this.parseRemoteCandidate(O);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(O);break;case"rtpmap":this.parseRtpmap(O);break;case"ptime":this.parsePtime(O);break;case"maxptime":this.parseMaxPtime(O);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(O);break;case"ssrc":this.parseSSRC(O);break;case"fmtp":this.parseFmtp(O);break;case"rtcp-fb":this.parseRtcpFb(O);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(O);break;case"mid":this.parseMid(O);break;case"msid":this.parseMsid(O);break;case"imageattr":this.parseImageAttr(O);break;case"rid":this.parseRid(O);break;case"simulcast":this.parseSimulcast(O);break;case"sctp-port":this.parseSctpPort(O);break;case"max-message-size":this.parseMaxMessageSize(O);break;case"ssrc-group":this.parseSSRCGroup(O);break;default:O.ignored=!0,this.attributes.unrecognized.push(O)}}catch(te){throw console.error("parsing media attribute ".concat(O.attField,' error, "a=').concat(O.attField,":").concat(O.attValue,'"')),te}if(!O.ignored&&O.attValue&&!this.atEnd(O))throw new Error("attribute parsing error")}parseCandidate(O){const te=this.extractOneOrMore(O,Y,[1,32]);this.consumeAttributeSpace(O);const oe=this.extractOneOrMore(O,E,[1,5]);this.consumeAttributeSpace(O);const Pe=this.extract(O,this.consumeToken);this.consumeAttributeSpace(O);const Nt=this.extractOneOrMore(O,E,[1,10]);this.consumeAttributeSpace(O);const nr=this.extract(O,this.consumeAddress);this.consumeAttributeSpace(O);const Ms=this.extract(O,this.consumePort);this.consumeAttributeSpace(O),this.extract(O,this.consume,"typ"),this.consumeAttributeSpace(O);const Fc={foundation:te,componentId:oe,transport:Pe,priority:Nt,connectionAddress:nr,port:Ms,type:this.extract(O,this.consumeToken),extension:{}};for(this.peek(O," raddr")&&(this.extract(O,this.consume," raddr"),this.consumeAttributeSpace(O),Fc.relAddr=this.extract(O,this.consumeAddress)),this.peek(O," rport")&&(this.extract(O,this.consume," rport"),this.consumeAttributeSpace(O),Fc.relPort=this.extract(O,this.consumePort));this.peekChar(O)===m;){this.consumeAttributeSpace(O);const Cf=this.extract(O,this.consumeToken);this.consumeAttributeSpace(O),Fc.extension[Cf]=this.extractOneOrMore(O,w)}this.attributes.candidates.push(Fc)}parseRemoteCandidate(O){const te=[];for(;;){const oe=this.extractOneOrMore(O,E,[1,5]);this.consumeAttributeSpace(O);const Pe=this.extract(O,this.consumeAddress);this.consumeAttributeSpace(O);const Nt=this.extract(O,this.consumePort);te.push({componentId:oe,connectionAddress:Pe,port:Nt});try{this.consumeAttributeSpace(O)}catch{break}}this.attributes.remoteCandidatesList.push(te)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(O){const te=this.extract(O,this.consumeToken);this.consumeAttributeSpace(O);const oe=this.extract(O,this.consumeTill,"/");this.extract(O,this.consume,"/");const Pe={encodingName:oe,clockRate:this.extractOneOrMore(O,E)};this.atEnd(O)||this.peekChar(O)!=="/"||(this.extract(O,this.consume,"/"),Pe.encodingParameters=parseInt(this.extract(O,this.consumeTill),10));const Nt=this.attributes.payloads.find(nr=>nr.payloadType===parseInt(te,10));Nt?Nt.rtpMap=Pe:this.attributes.payloads.push({payloadType:parseInt(te,10),rtpMap:Pe,rtcpFeedbacks:[]})}parsePtime(O){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(O,this.consumeTill)}parseMaxPtime(O){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(O,this.consumeTill)}parseDirection(O){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=O.attField}parseSSRC(O){const te=this.extractOneOrMore(O,E);this.consumeAttributeSpace(O);const oe=this.extract(O,this.consumeTill,":");let Pe;this.peekChar(O)===":"&&(this.extract(O,this.consume,":"),Pe=this.extract(O,this.consumeTill));const Nt=this.attributes.ssrcs.find(nr=>nr.ssrcId===parseInt(te,10));Nt?Nt.attributes[oe]=Pe:this.attributes.ssrcs.push({ssrcId:parseInt(te,10),attributes:{[oe]:Pe}})}parseFmtp(O){const te=this.extract(O,this.consumeTill,m);this.consumeAttributeSpace(O);const oe=this.extract(O,this.consumeTill),Pe={};oe.split(";").forEach(nr=>{let[Ms,Fc]=nr.split("=");Ms=ha(Ms).call(Ms);const Cf=typeof Fc=="string"?ha(Fc).call(Fc):null;typeof Ms=="string"&&Ms.length>0&&(Pe[Ms]=Cf)});const Nt=this.attributes.payloads.find(nr=>nr.payloadType===parseInt(te,10));Nt?Nt.fmtp={parameters:Pe}:this.attributes.payloads.push({payloadType:parseInt(te,10),rtcpFeedbacks:[],fmtp:{parameters:Pe}})}parseFmtParameters(O){const te={},oe=this.extract(O,this.consumeTill,"=");O._cur++;const Pe=this.extract(O,this.consumeTill,";");for(te[oe]=Pe;O.attValue[O._cur]===";";){const Nt=this.extract(O,this.consumeTill,"=");O._cur++;const nr=this.extract(O,this.consumeTill,";");te[Nt]=nr}return te}parseRtcpFb(O){let te="";te=this.peekChar(O)==="*"?this.extract(O,this.consume,"*"):this.extract(O,this.consumeTill,m),this.consumeAttributeSpace(O);const oe=this.extract(O,this.consumeTill,m);let Pe;if(oe==="trr-int")Pe={type:oe,interval:this.extract(O,this.consumeTill)};else{const Nt={type:oe};this.peekChar(O)===m&&(this.consumeAttributeSpace(O),Nt.parameter=this.extract(O,this.consumeToken),this.peekChar(O)===m&&(Nt.additional=this.extract(O,this.consumeTill))),Pe=Nt}if(te==="*")this.attributes.rtcpFeedbackWildcards.push(Pe);else{const Nt=this.attributes.payloads.find(nr=>nr.payloadType===parseInt(te,10));Nt?Nt.rtcpFeedbacks.push(Pe):this.attributes.payloads.push({payloadType:parseInt(te,10),rtcpFeedbacks:[Pe]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(O){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const te={port:this.extract(O,this.consumePort)};this.peekChar(O)===m&&(this.consumeAttributeSpace(O),te.netType=this.extractOneOrMore(O,R),this.consumeAttributeSpace(O),te.addressType=this.extractOneOrMore(O,R),this.consumeAttributeSpace(O),te.address=this.extract(O,this.consumeAddress)),this.attributes.rtcp=te}parseMsid(O){const te={id:this.extractOneOrMore(O,R,[1,64])};this.peekChar(O)===m&&(this.consumeAttributeSpace(O),te.appdata=this.extractOneOrMore(O,R,[1,64])),this.attributes.msids.push(te)}parseImageAttr(O){this.attributes.imageattr.push(O.attValue)}parseRid(O){const te=this.extractOneOrMore(O,Pe=>D(Pe)||E(Pe)||Pe==="_"||Pe==="-");this.consumeAttributeSpace(O);const oe={id:te,direction:this.extract(O,this.consumeToken),params:[]};if(this.peekChar(O)===m){if(this.consumeAttributeSpace(O),this.peek(O,"pt=")){this.extract(O,this.consume,"pt=");const Pe=[];for(;;){const Nt=this.extract(O,this.consumeToken);Pe.push(Nt);try{this.extract(O,this.consume,",")}catch{break}}oe.payloads=Pe,this.peekChar(O)===m&&this.extract(O,this.consume,m)}for(;;){const Pe=this.extract(O,this.consumeToken);switch(Pe){case"depend":{const Nt={type:Pe,rids:this.extract(O,this.consume,"=").split(",")};oe.params.push(Nt);break}default:{const Nt={type:Pe};this.peekChar(O)==="="&&(this.extract(O,this.consume,"="),Nt.val=this.extract(O,this.consumeTill,";")),oe.params.push(Nt)}}try{this.extract(O,this.consume,";")}catch{break}}}this.attributes.rids.push(oe)}parseSimulcast(O){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=O.attValue,this.extract(O,this.consumeTill)}parseSctpPort(O){this.attributes.sctpPort=this.extractOneOrMore(O,E,[1,5])}parseMaxMessageSize(O){this.attributes.maxMessageSize=this.extractOneOrMore(O,E,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(O){this.attributes.mid=this.extract(O,this.consumeToken)}parseSSRCGroup(O){const te=this.extract(O,this.consumeToken),oe=[];for(;;)try{this.consumeAttributeSpace(O);const Pe=this.extract(O,this.consumeInteger);oe.push(parseInt(Pe,10))}catch{break}this.attributes.ssrcGroups.push({semantic:te,ssrcIds:oe})}}function Vt(Ce,O,te){return O in Ce?Object.defineProperty(Ce,O,{value:te,enumerable:!0,configurable:!0,writable:!0}):Ce[O]=te,Ce}class Ot{constructor(){Vt(this,"eol",f)}print(O,te){let oe="";return te&&(this.eol=te),oe+=this.printVersion(O.version),oe+=this.printOrigin(O.origin),oe+=this.printSessionName(O.sessionName),oe+=this.printInformation(O.information),oe+=this.printUri(O.uri),oe+=this.printEmail(O.emails),oe+=this.printPhone(O.phones),oe+=this.printConnection(O.connection),oe+=this.printBandwidth(O.bandwidths),oe+=this.printTimeFields(O.timeFields),oe+=this.printKey(O.key),oe+=this.printSessionAttributes(O.attributes),oe+=this.printMediaDescription(O.mediaDescriptions),oe}printVersion(O){return"v=".concat(O).concat(this.eol)}printOrigin(O){return"o=".concat(O.username," ").concat(O.sessId," ").concat(O.sessVersion," ").concat(O.nettype," ").concat(O.addrtype," ").concat(O.unicastAddress).concat(this.eol)}printSessionName(O){return O?"s=".concat(O).concat(this.eol):""}printInformation(O){return O?"i=".concat(O).concat(this.eol):""}printUri(O){return O?"u=".concat(O).concat(this.eol):""}printEmail(O){let te="";for(const oe of O)te+="e=".concat(oe).concat(this.eol);return te}printPhone(O){let te="";for(const oe of O)te+="e=".concat(oe).concat(this.eol);return te}printConnection(O){return O?"c=".concat(O.nettype," ").concat(O.addrtype," ").concat(O.address).concat(this.eol):""}printBandwidth(O){let te="";for(const oe of O)te+="b=".concat(oe.bwtype,":").concat(oe.bandwidth).concat(this.eol);return te}printTimeFields(O){let te="";for(const oe of O){te+="t=".concat(oe.time.startTime," ").concat(oe.time.startTime).concat(this.eol);for(const Pe of oe.repeats)te+="r=".concat(Pe.repeatInterval," ").concat(Pe.typedTimes.join(" ")).concat(this.eol);oe.zoneAdjustments&&(te+="z=",te+="z=".concat(oe.zoneAdjustments.map(Pe=>"".concat(Pe.time," ").concat(Pe.back?"-":""," ").concat(Pe.typedTime)).join(" ")).concat(this.eol),te+=this.eol)}return te}printKey(O){return O?"k=".concat(O).concat(this.eol):""}printAttributes(O){let te="";for(const oe of O)te+="a=".concat(oe.attField).concat(oe.attValue?":".concat(oe.attValue):"").concat(this.eol);return te}printMediaDescription(O){let te="";for(const oe of O)te+=this.printMedia(oe.media),te+=this.printInformation(oe.information),te+=this.printConnections(oe.connections),te+=this.printBandwidth(oe.bandwidths),te+=this.printKey(oe.key),te+=this.printMediaAttributes(oe);return te}printConnections(O){let te="";for(const oe of O)te+=this.printConnection(oe);return te}printMedia(O){return"m=".concat(O.mediaType," ").concat(O.port," ").concat(O.protos.join("/")," ").concat(O.fmts.join(" ")).concat(this.eol)}printSessionAttributes(O){return new Er(this.eol).print(O)}printMediaAttributes(O){return new Re(this.eol).print(O)}}class Cn{constructor(O){Vt(this,"eol",void 0),this.eol=O}printIceUfrag(O){return O===void 0?"":"a=ice-ufrag:".concat(O).concat(this.eol)}printIcePwd(O){return O===void 0?"":"a=ice-pwd:".concat(O).concat(this.eol)}printIceOptions(O){return O===void 0?"":"a=ice-options:".concat(O.join(m)).concat(this.eol)}printFingerprints(O){return O.length>0?O.map(te=>"a=fingerprint:".concat(te.hashFunction).concat(m).concat(te.fingerprint)).join(this.eol)+this.eol:""}printExtmap(O){return O.map(te=>"a=extmap:".concat(te.entry).concat(te.direction?"/".concat(te.direction):"").concat(m).concat(te.extensionName).concat(te.extensionAttributes?"".concat(m).concat(te.extensionAttributes):"").concat(this.eol)).join("")}printSetup(O){return O===void 0?"":"a=setup:".concat(O).concat(this.eol)}printUnrecognized(O){return O.map(te=>"a=".concat(te.attField).concat(te.attValue?":".concat(te.attValue):"").concat(this.eol)).join("")}}class Er extends Cn{print(O){let te="";return te+=this.printGroups(O.groups),te+=this.printMsidSemantic(O.msidSemantic),te+=this.printIceLite(O.iceLite),te+=this.printIceUfrag(O.iceUfrag),te+=this.printIcePwd(O.icePwd),te+=this.printIceOptions(O.iceOptions),te+=this.printFingerprints(O.fingerprints),te+=this.printSetup(O.setup),te+=this.printTlsId(O.tlsId),te+=this.printIdentity(O.identities),te+=this.printExtmap(O.extmaps),te+=this.printUnrecognized(O.unrecognized),te}printGroups(O){let te="";return O.length>0&&(te+=O.map(oe=>"a=group:".concat(oe.semantic).concat(oe.identificationTag.map(Pe=>"".concat(m).concat(Pe)).join("")).concat(this.eol)).join("")),te}printIceLite(O){return O===void 0?"":"a=ice-lite"+this.eol}printTlsId(O){return O?"a=tls-id:".concat(O).concat(this.eol):""}printIdentity(O){return O.length===0?"":O.map(te=>"a=identity:".concat(te.assertionValue).concat(te.extensions.map(oe=>"".concat(m).concat(oe.name).concat(oe.value?"=".concat(oe.value):"")))).join(this.eol)+this.eol}printMsidSemantic(O){if(!O)return"";let te="a=msid-semantic:".concat(O.semantic);return O.applyForAll?te+="".concat(m,"*"):O.identifierList.length>0&&(te+=O.identifierList.map(oe=>"".concat(m).concat(oe))),te+this.eol}}class Re extends Cn{print(O){const te=O.attributes;let oe="";return oe+=this.printRTCP(te.rtcp),oe+=this.printIceUfrag(te.iceUfrag),oe+=this.printIcePwd(te.icePwd),oe+=this.printIceOptions(te.iceOptions),oe+=this.printCandidates(te.candidates),oe+=this.printRemoteCandidatesList(te.remoteCandidatesList),oe+=this.printEndOfCandidates(te.endOfCandidates),oe+=this.printFingerprints(te.fingerprints),oe+=this.printSetup(te.setup),oe+=this.printMid(te.mid),oe+=this.printExtmap(te.extmaps),oe+=this.printRTPRelated(te),oe+=this.printPtime(te.ptime),oe+=this.printMaxPtime(te.maxPtime),oe+=this.printDirection(te.direction),oe+=this.printSSRCGroups(te.ssrcGroups),oe+=this.printSSRC(te.ssrcs),oe+=this.printRTCPMux(te.rtcpMux),oe+=this.printRTCPMuxOnly(te.rtcpMuxOnly),oe+=this.printRTCPRsize(te.rtcpRsize),oe+=this.printMSId(te.msids),oe+=this.printImageattr(te.imageattr),oe+=this.printRid(te.rids),oe+=this.printSimulcast(te.simulcast),oe+=this.printSCTPPort(te.sctpPort),oe+=this.printMaxMessageSize(te.maxMessageSize),oe+=this.printUnrecognized(te.unrecognized),oe}printCandidates(O){return O.map(te=>"a=candidate:".concat(te.foundation).concat(m).concat(te.componentId).concat(m).concat(te.transport).concat(m).concat(te.priority).concat(m).concat(te.connectionAddress).concat(m).concat(te.port).concat(m,"typ").concat(m).concat(te.type).concat(te.relAddr?"".concat(m,"raddr").concat(m).concat(te.relAddr):"").concat(te.relPort?"".concat(m,"rport").concat(m).concat(te.relPort):"").concat(Object.keys(te.extension).map(oe=>"".concat(m).concat(oe).concat(m).concat(te.extension[oe])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(O){return O.map(te=>"a=remote-candidates:".concat(te.join(m)).concat(this.eol)).join("")}printEndOfCandidates(O){return O===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(O){if(!O.payloads)return"";const te=O.payloads;let oe="";oe+=O.rtcpFeedbackWildcards.map(Pe=>this.printRTCPFeedback("*",Pe)).join("");for(const Pe of te)oe+=this.printRtpMap(Pe.payloadType,Pe.rtpMap),oe+=this.printFmtp(Pe.payloadType,Pe.fmtp),oe+=Pe.rtcpFeedbacks.map(Nt=>this.printRTCPFeedback(Pe.payloadType,Nt)).join("");return oe}printFmtp(O,te){if(!te)return"";const oe=Object.keys(te.parameters);return oe.length===1&&te.parameters[oe[0]]===null?"a=fmtp:".concat(O).concat(m).concat(oe[0]).concat(this.eol):"a=fmtp:".concat(O).concat(m).concat(Object.keys(te.parameters).map(Pe=>"".concat(Pe,"=").concat(te.parameters[Pe])).join(";")).concat(this.eol)}printRtpMap(O,te){return te?"a=rtpmap:".concat(O).concat(m).concat(te.encodingName,"/").concat(te.clockRate).concat(te.encodingParameters?"/".concat(te.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(O,te){let oe="a=rtcp-fb:".concat(O).concat(m),Pe=te;return Pe.type==="trr-int"?oe+="ttr-int".concat(m).concat(Pe.interval):(oe+="".concat(Pe.type),Pe.parameter&&(oe+="".concat(m).concat(Pe.parameter),Pe.additional&&(oe+="".concat(m).concat(Pe.additional)))),oe+this.eol}printPtime(O){return O===void 0?"":"a=ptime:".concat(O).concat(this.eol)}printMaxPtime(O){return O===void 0?"":"a=maxptime:".concat(O).concat(this.eol)}printDirection(O){return O===void 0?"":"a=".concat(O).concat(this.eol)}printSSRC(O){return O.map(te=>Object.keys(te.attributes).map(oe=>"a=ssrc:".concat(te.ssrcId.toString(10)).concat(m).concat(oe).concat(te.attributes[oe]?":".concat(te.attributes[oe]):"").concat(this.eol)).join("")).join("")}printRTCPMux(O){return O===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(O){return O===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(O){return O===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(O){if(O===void 0)return"";let te="a=rtcp:".concat(O.port);return O.netType&&(te+="".concat(m).concat(O.netType)),O.addressType&&(te+="".concat(m).concat(O.addressType)),O.address&&(te+="".concat(m).concat(O.address)),te+this.eol}printMSId(O){return O.map(te=>"a=msid:".concat(te.id).concat(te.appdata?"".concat(m).concat(te.appdata):"").concat(this.eol)).join("")}printImageattr(O){return O.map(te=>"a=imageattr:".concat(te).concat(this.eol)).join("")}printRid(O){return O.map(te=>{let oe="a=rid:".concat(te.id).concat(m).concat(te.direction);return te.payloads&&(oe+="".concat(m,"pt=").concat(te.payloads.join(","))),te.params.length>0&&(oe+="".concat(m).concat(te.params.map(Pe=>Pe.type==="depend"?"depend=".concat(Pe.rids.join(",")):"".concat(Pe.type,"=").concat(Pe.val)).join(";"))),oe+this.eol}).join("")}printSimulcast(O){return O===void 0?"":"a=simulcast:".concat(O).concat(this.eol)}printSCTPPort(O){return O===void 0?"":"a=sctp-port:".concat(O).concat(this.eol)}printMaxMessageSize(O){return O===void 0?"":"a=max-message-size:".concat(O).concat(this.eol)}printMid(O){return O===void 0?"":"a=mid:".concat(O).concat(this.eol)}printSSRCGroups(O){return O.map(te=>"a=ssrc-group:".concat(te.semantic).concat(te.ssrcIds.map(oe=>"".concat(m).concat(oe.toString(10))).join("")).concat(this.eol)).join("")}}function je(Ce){return new Ne().parse(Ce)}function Ze(Ce,O){return new Ot().print(Ce,O)}}},t={};function r(a){if(t[a])return t[a].exports;var c=t[a]={exports:{}};return e[a](c,c.exports,r),c.exports}return r.d=(a,c)=>{for(var d in c)r.o(c,d)&&!r.o(a,d)&&Object.defineProperty(a,d,{enumerable:!0,get:c[d]})},r.o=(a,c)=>Object.prototype.hasOwnProperty.call(a,c),r.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},r(8)})();function ma(e){return eW.parse(e)}function kh(e,t){return eW.print(e,t)}var hde=So("Array","keys"),pde=tu,fde=Ns,mde=M,gde=hde,Gj=Array.prototype,_de={DOMTokenList:!0,NodeList:!0},vde=function(e){var t=e.keys;return e===Gj||mde(Gj,e)&&t===Gj.keys||fde(_de,pde(e))?gde:t},Ui=u(vde);function Mr(e,t,r){return(t=function(a){var c=function(d,h){if(typeof d!="object"||!d)return d;var f=d[Symbol.toPrimitive];if(f!==void 0){var m=f.call(d,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(a);return typeof c=="symbol"?c:c+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function tW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function Ut(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?tW(Object(r),!0).forEach(function(a){Mr(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tW(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}function rI(e,t){return rI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,a){return r.__proto__=a,r},rI(e,t)}function Wj(){Wj=function(c,d){return new r(c,void 0,d)};var e=RegExp.prototype,t=new WeakMap;function r(c,d,h){var f=RegExp(c,d);return t.set(f,h||t.get(c)),rI(f,r.prototype)}function a(c,d){var h,f=t.get(d);return To(h=Object.keys(f)).call(h,function(m,v){var E=f[v];if(typeof E=="number")m[v]=c[E];else{for(var w=0;c[E[w]]===void 0&&w+1<E.length;)w++;m[v]=c[E[w]]}return m},Object.create(null))}return function(c,d){if(typeof d!="function"&&d!==null)throw new TypeError("Super expression must either be null or a function");c.prototype=Object.create(d&&d.prototype,{constructor:{value:c,writable:!0,configurable:!0}}),Object.defineProperty(c,"prototype",{writable:!1}),d&&rI(c,d)}(r,RegExp),r.prototype.exec=function(c){var d=e.exec.call(this,c);if(d){d.groups=a(d,this);var h=d.indices;h&&(h.groups=a(h,this))}return d},r.prototype[Symbol.replace]=function(c,d){if(typeof d=="string"){var h=t.get(this);return e[Symbol.replace].call(this,c,d.replace(/\$<([^>]+)(>|$)/g,function(m,v,E){if(E==="")return m;var w=h[v];return Array.isArray(w)?"$"+w.join("$"):typeof w=="number"?"$"+w:""}))}if(typeof d=="function"){var f=this;return e[Symbol.replace].call(this,c,function(){var m=arguments;return typeof m[m.length-1]!="object"&&(m=[].slice.call(m)).push(a(m,f)),d.apply(this,m)})}return e[Symbol.replace].call(this,c,d)},Wj.apply(this,arguments)}const nW=new class extends br{constructor(){super(...arguments),Mr(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class Ede{constructor(t){Mr(this,"logger",void 0),Mr(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];this.logger.debug(...this.prefixLists,...r)}info(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];this.logger.info(...this.prefixLists,...r)}warning(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];this.logger.warning(...this.prefixLists,...r)}error(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];this.logger.error(...this.prefixLists,...r)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function Hj(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function rW(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const Oc={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},sI=Date.now(),Hx=e=>{for(const t in Oc)if(Object.prototype.hasOwnProperty.call(Oc,t)&&Oc[t]===e)return t;return"DEFAULT"},I=new class{constructor(){Mr(this,"proxyServerURL",void 0),Mr(this,"logLevel",Oc.DEBUG),Mr(this,"uploadState","collecting"),Mr(this,"uploadLogWaitingList",[]),Mr(this,"uploadLogUploadingList",[]),Mr(this,"uploadErrorCount",0),Mr(this,"currentLogID",0),Mr(this,"url",void 0),Mr(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const a=[Oc.DEBUG].concat(t);this.log.apply(this,a)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const a=[Oc.INFO].concat(t);this.log.apply(this,a)}warning(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const a=[Oc.WARNING].concat(t);this.log.apply(this,a)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const a=[Oc.ERROR].concat(t);this.log.apply(this,a)}upload(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const a=[Oc.DEBUG].concat(t);this.uploadLog.apply(this,a)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Wn("UPLOAD_LOG",!0)}disableLogUpload(){Wn("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new Ede(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-sI<100)return void setTimeout(()=>{this.log(...t)},Date.now()-sI);const a=Math.max(0,Math.min(4,t[0]));if(t[0]=Hj()+" Agora-SDK [".concat(Hx(a),"]:"),this.appendLogToWaitingList(a,...t),a<this.logLevel)return;const c=Hj()+" %cAgora-SDK [".concat(Hx(a),"]:");let d=[];if(!z("USE_NEW_LOG"))switch(a){case Oc.DEBUG:d=[c,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,d);break;case Oc.INFO:d=[c,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,d);break;case Oc.WARNING:d=[c,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,d);break;case Oc.ERROR:d=[c,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,d)}}uploadLog(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-sI<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-sI);const a=Math.max(0,Math.min(4,t[0]));t[0]=Hj()+" Agora-SDK [".concat(Hx(a),"]:"),this.appendLogToWaitingList(a,...t)}appendLogToWaitingList(e){if(!z("UPLOAD_LOG"))return;for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];Array.isArray(r[0])?r[0][0]=rW()+" Agora-SDK [".concat(Hx(e),"]:"):r[0]=rW()+" Agora-SDK [".concat(Hx(e),"]:");let c="";r.forEach(d=>{typeof d=="object"&&(d=JSON.stringify(d)),c+="".concat(d," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:kc,process_id:z("PROCESS_ID"),payload:JSON.stringify(e)};return yd(async()=>{const r=await Pa.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(z("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(z("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(r.data!=="OK"){const a=new Error("unexpected upload log response");throw a.response=r,a}},()=>(this.uploadLogUploadingList=[],!1),r=>{const a={status:-1,message:r.message,errorRange:e.map(c=>c.log_item_id)};return r.response?(a.status=r.response.status,a.data=r.response.data,a.headers=r.response.headers):r.request&&(a.status=r.request.status),nW.reportLogUploadError(a),!0},{timeout:z("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:z("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,z("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),z("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),z("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),z("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var sW;function yde(e){return ri(e.reportId,"params.reportId",0,100,!1),ri(e.category,"params.category",0,100,!1),ri(e.event,"params.event",0,100,!1),ri(e.label,"params.label",0,100,!1),Xn(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(sW={}).FREE="free",sW.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const bde={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let ys=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.RTE_DETAIL="rte_detail_stats",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),vr=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.RTE_DETAIL="io.agora.pb.Wrtc.RteDetailStats",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let xde=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function mt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,r,a){const c=a.value;if(typeof c=="function"){const d=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);a.value=function(){for(var h,f=arguments.length,m=new Array(f),v=0;v<f;v++)m[v]=arguments[v];let E=m;if(e.argsMap)try{E=e.argsMap(this,...m)}catch(S){I.warning(S),E=[]}try{JSON.stringify(E)}catch{I.warning("arguments for method ".concat(d,".").concat(String(r)," not serializable for apiInvoke.")),E=[]}const w=(e.report||tt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(d,".").concat(String(r)),options:E,tag:$n.TRACER,reportResult:e.reportResult},e.throttleTime);try{const S=c.apply(this,m);return S instanceof Ue?S.then(R=>(w.onSuccess(e.reportResult&&R),R)).catch(R=>{throw w.onError(R),R}):(w.onSuccess(e.reportResult&&S),S)}catch(S){throw w.onError(S),S}}}return a}}const tt=new class{constructor(){Mr(this,"baseInfoMap",new Map),Mr(this,"proxyServer",void 0),Mr(this,"eventUploadTimer",void 0),Mr(this,"setSessionIdTimer",void 0),Mr(this,"url",void 0),Mr(this,"sids",new Set),Mr(this,"backupUrl",void 0),Mr(this,"_appId",void 0),Mr(this,"_aid",0),Mr(this,"keyEventUploadPendingItems",[]),Mr(this,"normalEventUploadPendingItems",[]),Mr(this,"apiInvokeUploadPendingItems",[]),Mr(this,"apiInvokeCount",0),Mr(this,"apiInvokeLoggedCount",0),Mr(this,"ltsList",[]),Mr(this,"lastSendNormalEventTime",Date.now()),Mr(this,"customReportCounterTimer",void 0),Mr(this,"customReportCount",0),Mr(this,"extApiInvoke",async e=>{for(const t of e){const r=Ut(Ut({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:$n.TRACER});this.sendApiInvoke(r)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),z("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),z("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[r,a]=t;return r+a}),16)||0}reportApiInvoke(e,t,r){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const a=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,d=!!z("SHOW_REPORT_INVOKER_LOG"),h=!!z("SHOW_REPORT_USER_INVOKER_LOG"),f=d||h&&t.id;f&&(this.apiInvokeLoggedCount+=1);const m=this.apiInvokeLoggedCount;function v(R,j){if(f){let D="[apiInvoke-".concat(m,"]");if(t.id&&(D+="[".concat(t.id,"]")),t.name&&(D+="[".concat(t.name,"]"),t.name===_r.JOIN))return I.info("".concat(D," ").concat(R));I.info("".concat(D," ").concat(R),R==="start"?t.options:j||"")}}const E=()=>({tag:t.tag,invokeId:c,sid:e,name:t.name,apiInvokeTime:a,options:t.options,states:t.states||null});v("start");let w=!1;Ds(t.timeout).then(()=>{w||(this.sendApiInvoke(Ut(Ut({},E()),{},{error:K.API_INVOKE_TIMEOUT,success:!1})),v("timeout"))});const S=new we(K.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:R=>{const j=()=>{if(w)throw S;return w=!0,this.sendApiInvoke(Ut(Ut({},E()),{},{success:!0},t.reportResult&&{result:R})),v("onSuccess"),R};return r?UG(j,t.name+"Success",r,()=>w=!0):j()},onError:R=>{const j=()=>{if(w)throw R;w=!0,this.sendApiInvoke(Ut(Ut({},E()),{},{success:!1,error:R})),v("onFailure",R.toString())};return r?UG(j,t.name+"Error",r,()=>w=!0):j()}}}_send(e,t,r){this.send({type:e,data:t},r)}_sendApiInvoke(e){return this.sendApiInvoke(e)}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const r=Date.now(),a=this.createBaseInfo(e,r);a.cname=t.cname,a.rteUrl=t.rteUrl;const c=Object.assign({},{willUploadConsoleLog:z("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:Vj?"global":"oversea",areas:z("AREAS")&&z("AREAS").join(",")},t.extend),{stringUid:d,channelProfile:h,channelMode:f,isABTestSuccess:m,lsid:v,clientRole:E}=t,w=Date.now(),S=Ut(Ut({},a),{},{eventType:ys.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:Bj,lts:w,elapse:w-r,extend:JSON.stringify(c),mode:t.mode,process:z("PROCESS_ID"),appType:z("APP_TYPE"),success:!0,version:kc,stringUid:d,channelProfile:h,channelMode:f,isABTestSuccess:m,lsid:v,clientType:ke(R=window.navigator.userAgent).call(R,"AgoraWebView")?42:20,clientRole:E,serviceId:z("PROCESS_ID"),extensionID:z("PLUGIN_INFO").join(",")||"",rteUrl:t.rteUrl,rteSid:t.rteSid});var R;this.send({type:vr.SESSION,data:S},!0)}reportRteDetail(e){const t=this.baseInfoMap.get(e);if(!t)return;const r=t.info,a=Date.now(),c=Ut(Ut({},r),{},{eventType:ys.RTE_DETAIL,lts:a,success:!0,elapse:a-t.startTime,vid:r.vid===void 0?0:Number(r.vid),ua:navigator.userAgent});this.send({type:vr.RTE_DETAIL,data:c},!0)}joinChooseServer(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info;t.vid&&(a.vid=t.vid);const c=Date.now(),d=Ut(Ut({},a),{},{role:t.role,eventType:ys.JOIN_CHOOSE_SERVER,lts:c,eventElapse:t.elapse||c-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:c-r.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,ua:navigator.userAgent,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:vr.JOIN_CHOOSE_SERVER,data:d},!0)}reqUserAccount(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now(),d=Ut(Ut({},a),{},{eventType:ys.REQ_USER_ACCOUNT,lts:c,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||c-r.startTime,eventElapse:c-t.lts,extend:JSON.stringify(t.extend)});this.send({type:vr.REQ_USER_ACCOUNT,data:d},!0)}joinGateway(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info;t.vid&&(a.vid=t.vid),a.uid=t.uid,a.cid=t.cid;const c=Date.now(),{firstSuccess:d,addr:h,isProxy:f}=t,m=c-r.startTime,v=Ut(Ut({},a),{},{eventType:ys.JOIN_GATEWAY,lts:c,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:m,eventElapse:c-t.lts,firstSuccess:d,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:Uj(),isABTestSuccess:t.isABTestSuccess?1:0,gatewayIp:null,gatewayPort:null,isProxy:f?1:0}),E=v.success?1:0;if(t.succ&&(r.lastJoinSuccessTime=c),h)if(v.signalChannel==="1"){const w=Wj(/(\d+\.\d+\.\d+\.\d+):(\d+)/,{ip:1,port:2}),S=h.match(w);v.gatewayIp=S&&S.groups?S.groups.ip:"",v.gatewayPort=S&&S.groups?S.groups.port:""}else if(f){const w=h.match(/h=(\d{1,3}-){3}\d{1,3}/g),S=h.match(/p=[0-9]{1,6}/g);v.gatewayIp=w&&w.length?w[0].split("=")[1].replace(/-/g,"."):"",v.gatewayPort=S&&S.length?S[0].split("=")[1]:""}else{const w=h.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),S=h.match(/(:|p=)[0-9]{1,6}/g);v.gatewayIp=w&&w.length?w[0].split("//")[1].replace(/-/g,"."):"",v.gatewayPort=S&&S.length?S[0].split(/:|p=/g)[1]:""}if(d)this.send({type:vr.JOIN_GATEWAY,data:v},!0);else{let w={isSuccess:E,port:v.gatewayPort};delete v.success,delete v.eventType,delete v.firstSuccess,delete v.gatewayPort,v.vid=Number(v.vid);const S=Object.assign({},v,w,{eventType:ys.REJOIN_GATEWAY});this.send({type:vr.RE_JOIN_GATEWAY,data:S},!0)}}joinChannelTimeout(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=Date.now(),c=Ut(Ut({},r.info),{},{lts:a,timeout:t,elapse:a-r.startTime});this.send({type:vr.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now(),d=Ut(Ut({},a),{},{eventType:ys.PUBLISH,lts:c,eventElapse:t.eventElapse,elapse:c-r.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:vr.PUBLISH,data:d},!0)}subscribe(e,t,r){const a=this.baseInfoMap.get(e);if(!a)return;const c=a.info,d=Date.now(),h=Ut(Ut({},c),{},{eventType:ys.SUBSCRIBE,lts:d,eventElapse:t.eventElapse,elapse:d-a.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},r&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?h.peerSuid=t.peerid:h.peer=t.peerid,this.send({type:vr.SUBSCRIBE,data:h},!0)}wsCompressorInit(e){var t;const r=[...Ui(t=this.baseInfoMap).call(t)],a=r.length?r[0]:"UnableToGetSid",c=this.baseInfoMap.get(a);if(!c)return;const d=c.info,h=Date.now(),f=Ut(Ut({},d),{},{eventType:ys.WS_COMPRESSOR_INIT,lts:h,eventElapse:e.eventElapse,elapse:h-c.startTime,status:e.status?1:2});this.send({type:vr.WS_COMPRESSOR_INIT,data:f},!0)}firstXLAPeerFirstVideoFrame(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now(),d=t.peerPubStatusMs-(r.lastJoinSuccessTime||c),h=Ut(Ut({},a),{},{elapse:c-r.startTime,eventType:ys.XLA_PEER_FIRST_VIDEO_FRAME,lts:c,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:d,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>d?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0,firstReceivedEncodedFrame:t.firstReceivedEncodedFrame?Math.max(t.firstReceivedEncodedFrame-t.joinChannelStart,0):void 0,frameType:t.frameType||"",rtpTimestamp:t.rtpTimestamp||0,framePayloadType:t.framePayloadType||0,frameDataLength:t.frameDataLength||0,mimeType:t.mimeType||""});this.send({type:vr.XLA_PEER_FIRST_VIDEO_FRAME,data:h},!0)}firstRemoteVideoDecode(e,t,r,a){const c=this.baseInfoMap.get(e);if(!c)return;const d=c.info,h=Date.now(),f=Ut(Ut(Ut({},d),a),{},{elapse:h-c.startTime,eventType:t,lts:h,firstDecodeFrame:Math.max((a.firstFrame||h)-c.startTime,0),apEnd:Math.max(a.apEnd-c.startTime,0),apStart:Math.max(a.apStart-c.startTime,0),joinGwEnd:Math.max(a.joinGwEnd-c.startTime,0),joinGwStart:Math.max(a.joinGwStart-c.startTime,0),pcEnd:Math.max(a.pcEnd-c.startTime,0),pcStart:Math.max(a.pcStart-c.startTime,0),subscriberEnd:Math.max(a.subscriberEnd-c.startTime,0),subscriberStart:Math.max(a.subscriberStart-c.startTime,0),videoAddNotify:Math.max(a.videoAddNotify-c.startTime,0)});this.send({type:r,data:f},!0)}firstRemoteFrame(e,t,r,a){const c=this.baseInfoMap.get(e);if(!c)return;const d=c.info,h=Date.now(),f=Ut(Ut(Ut({},d),a),{},{elapse:h-c.startTime,eventType:t,lts:h});this.send({type:r,data:f},!0)}abTest(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now(),d=Ut(Ut(Ut({},a),t),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:c-r.startTime,eventType:ys.AB_TEST,lts:c});this.send({type:vr.AB_TEST,data:d},!0)}pcStats(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now(),d=Ut(Ut(Ut({},a),t),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:c-r.startTime,eventType:ys.PC_STATS,lts:c,preallocation:t.preallocation?1:0});this.send({type:vr.PC_STATS,data:d},!0)}updateRemoteRTPCapabilities(e,t){if(e){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now(),d=Ut(Ut(Ut({},a),t),{},{vid:a.vid===void 0?0:Number(a.vid),eventType:ys.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:vr.UPDATE_REMOTE_RTPCAPABILITIES,data:d},!0)}}onGatewayStream(e,t,r,a){const c=this.baseInfoMap.get(e);if(!c)return;const d=c.info,h=Date.now(),f=Ut(Ut(Ut({},d),a),{},{eventType:t,lts:h});this.send({type:r,data:f},!0)}streamSwitch(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now(),d=Ut(Ut({},a),{},{eventType:ys.STREAM_SWITCH,lts:c,isDual:t.isdual,elapse:c-r.startTime,success:t.succ});this.send({type:vr.STREAM_SWITCH,data:d},!0)}requestProxyAppCenter(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now(),d=Ut(Ut({},a),{},{eventType:ys.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-t.lts,elapse:c-r.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:vr.REQUEST_PROXY_APPCENTER,data:d},!0)}requestProxyWorkerManager(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now(),d=Ut(Ut({},a),{},{eventType:ys.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-t.lts,elapse:c-r.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:vr.REQUEST_PROXY_WORKER_MANAGER,data:d},!0)}setProxyServer(e){this.proxyServer=e,e?I.debug("reportProxyServerurl: ".concat(e)):I.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now(),d=Ut(Ut({},a),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:c,elapse:c-r.startTime,joinChannelSuccessElapse:c-(r.lastJoinSuccessTime||c),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:vr.PEER_PUBLISH_STATUS,data:d},!0)}workerEvent(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now();(function(d,h,f){const m=d[h];if(!m||typeof m!="string")return[d];d[h]="";const v=bu(JSON.stringify(d));let E=0;const w=[];let S=0;for(let R=0;R<m.length;R++)S+=m.charCodeAt(R)<=127?1:3,S<=f-v||(w[w.length]=Le(Le({},d),{},{[h]:m.substring(E,R)}),E=R,S=m.charCodeAt(R)<=127?1:3);return E!==m.length-1&&(w[w.length]=Le(Le({},d),{},{[h]:m.substring(E)})),w})(Ut(Ut(Ut({},a),t),{},{elapse:c-r.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(d=>this.send({type:vr.WORKER_EVENT,data:d},!0))}apworkerEvent(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now(),d=Ut(Ut(Ut({},a),t),{},{elapse:c-r.startTime,lts:c});this.send({type:vr.AP_WORKER_EVENT,data:d},!0)}joinWebProxyAP(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now(),d=Ut(Ut(Ut({},a),t),{},{elapse:c-r.startTime,lts:c,extend:t.extend||void 0});this.send({type:vr.JOIN_WEB_PROXY_AP,data:d},!0)}WebSocketQuit(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now(),d=Ut(Ut(Ut({},a),t),{},{elapse:c-r.startTime,lts:c});this.send({type:vr.WEBSOCKET_QUIT,data:d},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>z("CUSTOM_REPORT_LIMIT"))throw new we(K.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const r=Date.now(),a=t.map(c=>({type:vr.USER_ANALYTICS,data:Ut(Ut({sid:e},c),{},{lts:r})}));try{z("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(a):await this.postDataToStatsCollector(a)}catch(c){throw I.error("send custom report message failed",c.toString()),new we(K.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(e){const t=z("NOT_REPORT_EVENT");if(e.tag&&ke(t)&&ke(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const r=this.baseInfoMap.get(e.sid);if(!r)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:a,uid:c,cid:d}=r.info;let h;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof we){const{code:m,message:v}=e.error;h=m||v||e.error.toString()}else h=e.error.toString();const f={invokeId:e.invokeId,sid:e.sid,cname:a,cid:d,uid:c,lts:e.lts,success:e.success,elapse:e.lts-r.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?h:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:vr.API_INVOKE,data:f},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find(r=>r!==null);t&&e.forEach(r=>{r&&(r.sid=t,this.sendApiInvoke(Object.assign({},r)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>z("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const r=[],a=[];for(;e.length;){const d=e.shift();r.length<20?r.push(d):a.push(d)}e.push(...a);for(const d of[...r]){var c;this.ltsList.indexOf(d.data.lts)!==-1?(d.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(d.data.lts)):(this.ltsList.push(d.data.lts),Th(c=this.ltsList).call(c,(h,f)=>h-f))}return t||(this.lastSendNormalEventTime=Date.now()),z("ENABLE_EVENT_REPORT")&&r.length&&(z("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(r):this.postDataToStatsCollector(r)).catch((d=>h=>{z("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(d):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(d),this.normalEventUploadPendingItems.length>z("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-z("NORMAL_EVENT_QUEUE_CAPACITY")),I.warning("report: drop normal events"))))})(r)),e}async postDataToStatsCollector2(e){jr.networkState===fa.OFFLINE&&await Ue.race([jr.onlineWaiter,Ds(2*ls.maxRetryTimeout)]);const t=c=>{let d=new Uint8Array;return c.forEach(h=>{const f=Sj(JSON.stringify(h.data)),m=new ArrayBuffer(5),v=(w=>{let S=0;return Object.entries(vr).forEach(R=>{let[j,D]=R;D===w.type&&(S=xde[j])}),S})(h),E=new DataView(m);E.setUint16(0,f.byteLength,!0),E.setUint8(2,255&v),E.setUint8(3,v>>>8&255),E.setUint8(4,v>>>16&255),d=NG(d,new Uint8Array(m)),d=NG(d,f)}),d},r="event";let a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(z("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(r):"https://".concat(z("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(r);for(let c=0;c<2;c+=1){c===1&&(a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(z("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(r):"https://".concat(z("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(r));try{await Pj(a,{timeout:1e4,data:t(e),headers:Ut(Ut({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(d){if(c===1)throw d;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=(f=>{const m=f&&f.data.sid&&this.baseInfoMap.get(f.data.sid);return m&&m.info.vid&&+m.info.vid||0})(e[0]),a=r?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(f=>JSON.stringify(f)),vid:r,aid:a};jr.networkState===fa.OFFLINE&&await Ue.race([jr.onlineWaiter,Ds(2*ls.maxRetryTimeout)]);const d=t?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(z("EVENT_REPORT_DOMAIN"),"&p=").concat(z("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(z("EVENT_REPORT_DOMAIN"),":").concat(z("STATS_COLLECTOR_PORT")).concat(d));for(let f=0;f<2;f+=1){f===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(z("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(z("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(z("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(z("STATS_COLLECTOR_PORT")).concat(d)));try{t?await ode(h,{timeout:1e4,data:c}):await Pj(h,{timeout:1e4,data:c})}catch(m){if(f===1)throw m;continue}return}}createBaseInfo(e,t){const r=Object.assign({},bde);return r.sid=e,this.baseInfoMap.set(e,{info:r,startTime:t}),r}reportResourceTiming(e,t){const r=performance.getEntriesByName(e),a=r[r.length-1];a&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:a,tag:$n.TRACER}).onSuccess()}};nW.on("REPORT_LOG_UPLOAD",e=>{e.networkState=jr.networkState,tt.reportApiInvoke(null,{name:"logUploadError",options:e,tag:$n.TRACER}).onSuccess("logUploadError")});let Ee=class extends we{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Mr(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,I)}throw(){super.throw(I)}};const Ps={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1,supportSuppressLocalAudioPlayback:!1,supportRestrictOwnAudio:!1};function Zt(){return Ps}function iW(){return"setSinkId"in HTMLAudioElement.prototype&&(!z("RESTRICTION_SET_PLAYBACK_DEVICE")||(Ih()||pG())&&!xG())}function iI(){return!Ps.supportUnifiedPlan||z("CHROME_FORCE_PLAN_B")&&yu()}function Kx(e){return!(dr()||fG(87)||iI()||!z("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||z("FORCE_DISABLE_AUTO_SUB")))}function aW(e){return z("ENABLE_INSTANT_VIDEO")?z("ENABLE_INSTANT_VIDEO"):!(e==null||!e.autoSubscribe||z("FORCE_DISABLE_AUTO_SUB"))}function oW(){return navigator.mediaDevices&&"getSupportedConstraints"in navigator.mediaDevices}function cW(){if(oW()){const e=navigator.mediaDevices.getSupportedConstraints();return!(!("suppressLocalAudioPlayback"in e)||!e.suppressLocalAudioPlayback)}return Ed(141)||cf(141)||xg(141)}function lW(){if(oW()){const e=navigator.mediaDevices.getSupportedConstraints();return!(!("restrictOwnAudio"in e)||!e.restrictOwnAudio)}return Ed(141)||cf(141)||xg(125)}let si=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Uv(e,t,r){return{sampleRate:e,stereo:t,bitrate:r}}function bn(e,t,r,a,c){return{width:e,height:t,frameRate:r,bitrateMin:a,bitrateMax:c}}function Nl(e,t,r,a,c){return{width:{max:e},height:{max:t},frameRate:r,bitrateMin:a,bitrateMax:c}}function Kj(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const wde={"90p":bn(160,90),"90p_1":bn(160,90),"120p":bn(160,120,15,30,65),"120p_1":bn(160,120,15,30,65),"120p_3":bn(120,120,15,30,50),"120p_4":bn(212,120),"180p":bn(320,180,15,30,140),"180p_1":bn(320,180,15,30,140),"180p_3":bn(180,180,15,30,100),"180p_4":bn(240,180,15,30,120),"240p":bn(320,240,15,40,200),"240p_1":bn(320,240,15,40,200),"240p_3":bn(240,240,15,40,140),"240p_4":bn(424,240,15,40,220),"360p":bn(640,360,15,80,400),"360p_1":bn(640,360,15,80,400),"360p_3":bn(360,360,15,80,260),"360p_4":bn(640,360,30,80,600),"360p_6":bn(360,360,30,80,400),"360p_7":bn(480,360,15,80,320),"360p_8":bn(480,360,30,80,490),"360p_9":bn(640,360,15,80,800),"360p_10":bn(640,360,24,80,800),"360p_11":bn(640,360,24,80,1e3),"480p":bn(640,480,15,100,500),"480p_1":bn(640,480,15,100,500),"480p_2":bn(640,480,30,100,1e3),"480p_3":bn(480,480,15,100,400),"480p_4":bn(640,480,30,100,750),"480p_6":bn(480,480,30,100,600),"480p_8":bn(848,480,15,100,610),"480p_9":bn(848,480,30,100,930),"480p_10":bn(640,480,10,100,400),"720p":bn(1280,720,15,120,1130),"720p_auto":bn(1280,720,30,900,3e3),"720p_1":bn(1280,720,15,120,1130),"720p_2":bn(1280,720,30,120,2e3),"720p_3":bn(1280,720,30,120,1710),"720p_5":bn(960,720,15,120,910),"720p_6":bn(960,720,30,120,1380),"1080p":bn(1920,1080,15,120,2080),"1080p_1":bn(1920,1080,15,120,2080),"1080p_2":bn(1920,1080,30,120,3e3),"1080p_3":bn(1920,1080,30,120,3150),"1080p_5":bn(1920,1080,60,120,4780),"1440p":bn(2560,1440,30,120,4850),"1440p_1":bn(2560,1440,30,120,4850),"1440p_2":bn(2560,1440,60,120,7350),"4k":bn(3840,2160,30,120,8910),"4k_1":bn(3840,2160,30,120,8910),"4k_3":bn(3840,2160,60,120,13500)},Sde={"480p":Nl(640,480,5),"480p_1":Nl(640,480,5),"480p_2":Nl(640,480,30),"480p_3":Nl(640,480,15),"720p":Nl(1280,720,5),"720p_auto":bn(1280,720,30,900,3e3),"720p_1":Nl(1280,720,5),"720p_2":Nl(1280,720,30),"720p_3":Nl(1280,720,15),"1080p":Nl(1920,1080,5),"1080p_1":Nl(1920,1080,5),"1080p_2":Nl(1920,1080,30),"1080p_3":Nl(1920,1080,15)},Tde={"1SL1TL":Kj(1,1),"3SL3TL":Kj(3,3),"2SL3TL":Kj(2,3)};function Il(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},wde[e]):e}function qj(e){return typeof e=="string"?Object.assign({},Sde[e]):e}function aI(e){return typeof e=="string"?Object.assign({},Tde[e]):e}const Rde={speech_low_quality:Uv(16e3,!1),speech_standard:Uv(32e3,!1,18),music_standard:Uv(48e3,!1),standard_stereo:Uv(48e3,!0,56),high_quality:Uv(48e3,!1,128),high_quality_stereo:Uv(48e3,!0,192)};function oI(e){return typeof e=="string"?Object.assign({},Rde[e]):e}const kg=[];function dW(e){return cs(e,"mediaSource",["screen","window","application"]),!0}let nt=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),Pn=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),Vv=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),Cde=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),Nde=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),Og=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),Fv=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),Dc=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e}({}),Bv=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),nc=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const Yj={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},Xj={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},uW={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Ide={uplinkNetworkQuality:0,downlinkNetworkQuality:0},hW={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let ga=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),rc=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),qx=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),Dg=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Ci=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),xu=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const $j={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let cI=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function an(e,t,r,a,c){var d,h,f={};return Object.keys(a).forEach(function(m){f[m]=a[m]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=To(d=jT(h=r.slice()).call(h)).call(d,function(m,v){return v(e,t,m)||m},f),c&&f.initializer!==void 0&&(f.value=f.initializer?f.initializer.call(c):void 0,f.initializer=void 0),f.initializer===void 0?(Object.defineProperty(e,t,f),null):f}function be(e,t,r){return(t=function(a){var c=function(d,h){if(typeof d!="object"||!d)return d;var f=d[Symbol.toPrimitive];if(f!==void 0){var m=f.call(d,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(a);return typeof c=="symbol"?c:c+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function ar(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?pW(Object(r),!0).forEach(function(a){be(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pW(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}class fW extends br{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(Og.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,r){super(),be(this,"trackMediaType",void 0),be(this,"_ID",void 0),be(this,"_rtpTransceiver",void 0),be(this,"_lowRtpTransceiver",void 0),be(this,"_hints",[]),be(this,"_isClosed",!1),be(this,"_originMediaStreamTrack",void 0),be(this,"mediaStreamTrack",void 0),be(this,"_external",{}),this._ID=r||jn(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(a){ke(kg).call(kg,a)||kg.push(a)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||lf(()=>{var r;tt.reportApiInvoke(null,{name:_r.GET_MEDIA_STREAM_TRACK,options:[],tag:$n.TRACER}).onSuccess(((r=this._mediaStreamTrack)===null||r===void 0?void 0:r.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===Vv.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const r=kg.indexOf(t);r!==-1&&kg.splice(r,1)}(this),this.emit(Fv.CLOSED),this.removeAllListeners(Og.SEI_RECEIVED)}_updateRtpTransceiver(t,r){if(r===Vv.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(Og.TRANSCEIVER_UPDATED,t,r)}}class zv extends fW{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,r){super(t,r),be(this,"_enabled",!0),be(this,"_muted",!1),be(this,"_isExternalTrack",!1),be(this,"_isClosed",!1),be(this,"_enabledMutex",void 0),be(this,"processor",void 0),be(this,"_processorContext",void 0),be(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Ks("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,r;return(t=(r=this._originMediaStreamTrack)===null||r===void 0?void 0:r.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,I.debug("[".concat(this.getTrackId(),"] close")),this.emit(nt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,r){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=a,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await er(this,nt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){I.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Fv.TRACK_ENDED)}stateCheck(t,r){if(I.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(r,"]")),Tl(r,t),this._enabled&&this._muted&&t==="enabled"&&r===!1)throw new we(K.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",I);if(!this._enabled&&!this._muted&&t==="muted"&&r===!0)throw new we(K.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",I)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Ue.resolve([])}}const mW=window.AudioContext||window.webkitAudioContext;let Jj,sc=null;const Hn=new class extends br{constructor(){super(...arguments),be(this,"prevState",void 0),be(this,"curState",void 0),be(this,"currentTime",void 0),be(this,"currentTimeStuckAt",void 0),be(this,"interruptDetectorTrack",void 0),be(this,"onLocalAudioTrackMute",()=>{I.info("ios15-interruption-start"),this.emit(si.IOS_15_16_INTERRUPTION_START)}),be(this,"onLocalAudioTrackUnmute",async()=>{I.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?I.info("ios15-interruption-end-canceled"):(sc&&await sc.suspend(),this.emit(si.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){I.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){I.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Gv(){if(!sc){if(function(){if(!mW)return void I.error("your browser is not support web audio");I.info("create audio context");const e=ar({},z("WEBAUDIO_INIT_OPTIONS"));I.debug("audio context init option:",JSON.stringify(e)),sc=new mW(e),Hn.curState=sc.state,sc.onstatechange=()=>{Hn.prevState=Hn.curState,Hn.curState=sc?sc.state:void 0;const{prevState:t,curState:r}=Hn,a=r==="running",c=r==="interrupted",d=t==="running",h=t==="suspended",f=t==="interrupted",m=yn().osVersion;(Mi()||Sl())&&d&&c&&(I.info("ios".concat(m,"-interruption-start")),Hn.emit(si.IOS_INTERRUPTION_START)),(Mi()||Sl())&&(h||f)&&a&&(I.info("ios".concat(m,"-interruption-end")),Hn.emit(si.IOS_INTERRUPTION_END)),t!==r&&Hn.emit(si.STATE_CHANGE,r,t)},setInterval(()=>{var t;const r=(t=sc)===null||t===void 0?void 0:t.currentTime;Hn.currentTime!==r?(Hn.currentTimeStuckAt&&(I.debug("AudioContext current time resume at ".concat(r)),Hn.currentTimeStuckAt=void 0),Hn.currentTime=r):(r!==Hn.currentTimeStuckAt&&(tt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:r},tag:$n.TRACER}).onSuccess(),I.warning("AudioContext current time stuck at ".concat(r))),Hn.currentTimeStuckAt=r)},5e3),async function(t){const r=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let a,c,d=!1,h=!1,f=!1;function m(W){t.state==="running"?v(!1):Mi()||Sl()?t.state==="suspended"&&(v(!0),W&&t.resume().then(E,E)):t.state!=="closed"&&(v(!0),W&&t.resume().then(E,E))}function v(W){if(d!==W){d=W;for(let Y=0,ne=r;Y<ne.length;Y+=1){const le=ne[Y];W?window.addEventListener(le,w,{capture:!0,passive:!0}):window.removeEventListener(le,w,{capture:!0,passive:!0})}}}function E(){m(!1)}function w(){m(!0)}function S(){let W;try{W=a.play(),W?W.then(D,D):(a.addEventListener("playing",D),a.addEventListener("abort",D),a.addEventListener("error",D))}catch{D()}}function R(W){f||(a.paused?W?(j(!1),f=!0,S()):j(!0):j(!1))}function j(W){if(h!==W){h=W;for(let Y=0,ne=r;Y<ne.length;Y++){const le=ne[Y];W?window.addEventListener(le,P,{capture:!0,passive:!0}):window.removeEventListener(le,P,{capture:!0,passive:!0})}}}function D(){a.removeEventListener("playing",D),a.removeEventListener("abort",D),a.removeEventListener("error",D),f=!1,R(!1)}function P(){R(!0)}if(Mi()&&z("IOS_BG_TAG")){const W=t.createMediaStreamDestination(),Y=document.createElement("div");Y.innerHTML="<audio x-webkit-airplay='deny'></audio>",a=Y.children.item(0),a.controls=!1,a.disableRemotePlayback=!0,a.preload="auto",a.srcObject=W.stream,c=()=>{if(z("IOS_AUTO_RESTART_BG_TAG")&&a&&a.srcObject&&!f&&(!a.paused||h!==!0)){a.paused||a.pause();try{f=!0,S()}catch{f=!1}return!0}},R(!0)}return Hn.on(si.STATE_CHANGE,function(){m(!0)}),m(!1),c}(sc).then(t=>{Jj=t})}(),!sc)throw new we(K.NOT_SUPPORTED,"can not create audio context");return sc}return sc}function Pg(e){if(function(){if(Qj!==null)return Qj;const a=Gv(),c=a.createBufferSource(),d=a.createGain(),h=a.createGain();c.connect(d),c.connect(h),c.disconnect(d);let f=!1;try{c.disconnect(d)}catch{f=!0}return c.disconnect(),Qj=f,f}())return;const t=e.connect,r=e.disconnect;e.connect=(a,c,d)=>{var h;return e._inputNodes||(e._inputNodes=[]),ke(h=e._inputNodes).call(h,a)||(a instanceof AudioNode?(e._inputNodes.push(a),t.call(e,a,c,d)):t.call(e,a,c)),e},e.disconnect=(a,c,d)=>{r.call(e),a?XN(e._inputNodes,a):e._inputNodes=[];for(const h of e._inputNodes)t.call(e,h)}}let Qj=null;function Zj(e,t){let r=!1;const a=1/t;if(z("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{r?window.clearInterval(c):e(performance.now()/1e3)},1e3*a)}else{const c=Gv();let d=c.createGain();d.gain.value=0,d.connect(c.destination);const h=()=>{if(r)return void(d=null);const f=c.createOscillator();f.onended=h,f.connect(d),f.start(0),f.stop(c.currentTime+a),e(c.currentTime)};h()}return()=>{r=!0}}class gW{constructor(){be(this,"context",void 0),be(this,"analyserNode",void 0),be(this,"sourceNode",void 0),this.context=Gv(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Mi()||Sl()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const a=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(a);for(let c=0;c<t.length;++c)t[c]=a[c]/128-1}const r=To(t).call(t,(a,c)=>a+c*c,0)/t.length;return Math.max(10*Math.log10(r)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,r;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(r=this.sourceNode)===null||r===void 0||r.connect(this.analyserNode)}catch{I.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class _W extends br{get processSourceNode(){return this.sourceNode}set processedNode(t){var r;if(!this.isDestroyed&&this._processedNode!==t){try{var a;(a=this.sourceNode)===null||a===void 0||a.disconnect(this.outputNode)}catch{}(r=this._processedNode)===null||r===void 0||r.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),be(this,"outputNode",void 0),be(this,"outputTrack",void 0),be(this,"isPlayed",!1),be(this,"sourceNode",void 0),be(this,"context",void 0),be(this,"audioBufferNode",void 0),be(this,"destNode",void 0),be(this,"audioOutputLevel",0),be(this,"volumeLevelAnalyser",void 0),be(this,"_processedNode",void 0),be(this,"playNode",void 0),be(this,"isDestroyed",!1),be(this,"onNoAudioInput",void 0),be(this,"isNoAudioInput",!1),be(this,"_noAudioInputCount",0),this.context=Gv(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Pg(this.outputNode),this.volumeLevelAnalyser=new gW}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=r=>{this.emit(nc.ON_AUDIO_BUFFER,function(a){for(let c=0;c<a.outputBuffer.numberOfChannels;c+=1){const d=a.outputBuffer.getChannelData(c);for(let h=0;h<d.length;h+=1)d[h]=0}return a.inputBuffer}(r))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Zt().webAudioMediaStreamDest)throw new we(K.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&$N(()=>{Hn.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Mi()||Sl()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const r=this.volumeLevelAnalyser.getAnalyserNode();let a;r.getFloatTimeDomainData?(a=new Float32Array(r.fftSize),r.getFloatTimeDomainData(a)):(a=new Uint8Array(r.fftSize),r.getByteTimeDomainData(a));let c=!1;for(let d=0;d<a.length;d++)a[d]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await Ds(200),await this.checkHasAudioInput(t?t+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,r;(t=this.processedNode)===null||t===void 0||t.disconnect(),(r=this.sourceNode)===null||r===void 0||r.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class eM extends _W{get isFreeze(){return!1}constructor(t,r,a){var c;if(super(),be(this,"sourceNode",void 0),be(this,"track",void 0),be(this,"clonedTrack",void 0),be(this,"audioElement",void 0),be(this,"isCurrentTrackCloned",!1),be(this,"isRemoteTrack",!1),be(this,"originVolumeLevelAnalyser",void 0),be(this,"rebuildWebAudio",async()=>{if(I.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void I.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>I.info("resume success")),I.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const f=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?f.stop():this.isCurrentTrackCloned=!0;const m=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(m),Pg(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const v=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(v,this.context.currentTime),Pg(this.outputNode),this.emit(nc.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=m,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new we(K.UNEXPECTED_ERROR);this.track=t;const d=new MediaStream([this.track]);if(this.isRemoteTrack=!!r,this.sourceNode=this.context.createMediaStreamSource(d),Pg(this.sourceNode),a){const f=a.clone();f.enabled=!0,this.clonedTrack=f,I.debug("create an unmuted track ".concat(f.id," from the original track ").concat(a.id," to get the volume"));const m=this.context.createMediaStreamSource(new MediaStream([f]));Pg(m),this.originVolumeLevelAnalyser=new gW,this.originVolumeLevelAnalyser.updateSource(m)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=d;const h=yn();r&&h.os===Os.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(Hn.on(si.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(f=>{f||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const r=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(r),Pg(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(nc.UPDATE_SOURCE),this.audioElement.srcObject=r}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),Hn.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const r=t.clone();r.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=r),I.debug("create an unmuted track ".concat(r.id," from the original track ").concat(t.id," to get the volume"));const a=this.context.createMediaStreamSource(new MediaStream([r]));Pg(a),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(a)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function vW(e,t,r){const a=(d,h)=>d?typeof d!="number"?d.max||d.exact||d.ideal||d.min||h:d:h,c={audio:!!r&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:a(t.height,1080),maxWidth:a(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(c.video.mandatory.maxFrameRate=t.frameRate.max,c.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(c.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function Ade(e,t){const r=await EW(e.mediaSource),{sourceId:a,audio:c}=await function(d){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Ue((f,m)=>{const v=document.createElement("div");v.innerText="share screen",v.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const E=document.createElement("div");E.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const w=document.createElement("div");w.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",w.setAttribute("style","height: 12%;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const R=document.createElement("div");R.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const j=document.createElement("button");j.innerHTML="cancel",j.setAttribute("style","width: 85px;"),j.onclick=()=>{document.body.removeChild(W);const Y=new Error("NotAllowedError");Y.name="NotAllowedError",m(Y)};let D=h;const P=document.createElement("div");if(h){const Y=document.createElement("input");Y.setAttribute("type","checkbox");const ne=document.createElement("span");Y.setAttribute("style","margin-right: 6px;"),ne.innerText="Share audio",Y.checked=D,Y.onchange=()=>{D=Y.checked},P.appendChild(Y),P.appendChild(ne)}R.appendChild(P),R.appendChild(j),E.appendChild(w),E.appendChild(S),E.appendChild(R);const W=document.createElement("div");W.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),W.appendChild(v),W.appendChild(E),document.body.appendChild(W),d.map(Y=>{if(Y.id){const ne=document.createElement("div");ne.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let le=Y.thumbnail;try{const{width:fe}=le.getSize();fe>1920&&(le=le.resize({width:1920}))}catch(fe){throw fe&&fe.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),fe}ne.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+le.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+Y.name.replace(/[\u00A0-\u9999<>\&]/g,function(fe){return"&#"+fe.charCodeAt(0)+";"})+"</span>",ne.onclick=()=>{document.body.removeChild(W),f({sourceId:Y.id,audio:D})},S.appendChild(ne)}})})}(r,t);return await vW(a,e,c)}async function EW(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const r=IG();if(!r)throw console.error("failed to fetch electron, please mount it to window"),new we(K.ELECTRON_IS_NULL);let a=null;try{var c;a=((c=r.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:t}))||r.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{a=null}a&&a.then||(a=new Ue((d,h)=>{r.desktopCapturer.getSources({types:t},(f,m)=>{f?h(f):d(m)})}));try{return await a}catch(d){throw new we(K.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,d.toString())}}const tM=new Ks("safari");let yW=!1,bW=!1;async function ic(e,t){let r=0,a=null;for(;r<2;)try{a=await kde(e,t,r>0);break}catch(c){if(c instanceof we)throw I.error("[".concat(t,"] ").concat(c.toString())),c;const d=lI(c.name||c.code||c,c.message);if(d.code===K.MEDIA_OPTION_INVALID){I.debug("[".concat(t,"] detect media option invalid, retry")),r+=1,await Ds(500);continue}throw I.error("[".concat(t,"] ").concat(d.toString())),d}if(!a)throw new we(K.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return a}async function kde(e,t,r){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new we(K.NOT_SUPPORTED,"can not find getUserMedia");r&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const a=Zt(),c=new MediaStream;if(e.audioSource&&c.addTrack(e.audioSource),e.videoSource&&c.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return I.debug("Using Video Source/ Audio Source"),c;if(e.screen)if(IG())e.screen.sourceId?Wv(c,await vW(e.screen.sourceId,e.screen,!!e.screenAudio)):Wv(c,await Ade(e.screen,!!e.screenAudio));else if(Ih()&&e.screen.extensionId&&e.screen.mandatory){if(!a.getStreamFromExtension)throw new we(K.NOT_SUPPORTED,"This browser does not support screen sharing");I.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const S=await(h=e.screen.extensionId,f=t,new Ue((R,j)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},D=>{if(!D||!D.streamId)return I.error("[".concat(f,"] No response from Chrome Plugin. Plugin not installed properly"),D),void j(new we(K.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));R(D.streamId)})}catch(D){I.error("[".concat(f,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),D.toString()),j(new we(K.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=S,Wv(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(a.getDisplayMedia){var d;e.screen.mediaSource&&dW(e.screen.mediaSource);const S={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(d=e.screen.displaySurface)!==null&&d!==void 0?d:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:R,surfaceSwitching:j,systemAudio:D,preferCurrentTab:P,windowAudio:W,monitorTypeSurfaces:Y}=e.screen,ne={selfBrowserSurface:R,surfaceSwitching:j,systemAudio:D,preferCurrentTab:P,windowAudio:W,monitorTypeSurfaces:Y};!R&&delete ne.selfBrowserSurface,!j&&delete ne.surfaceSwitching,!D&&delete ne.systemAudio,!P&&delete ne.preferCurrentTab,!W&&delete ne.windowAudio,!Y&&delete ne.monitorTypeSurfaces,I.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:S,audio:e.screenAudio,controls:ne})),Wv(c,await navigator.mediaDevices.getDisplayMedia(ar({video:S,audio:e.screenAudio},ne)))}else{if(!dr())throw I.error("[".concat(t,"] This browser does not support screenSharing")),new we(K.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&dW(e.screen.mediaSource);const S={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};I.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(S))),Wv(c,await navigator.mediaDevices.getUserMedia(S))}}var h,f;if(!e.video&&!e.audio)return c;let m={video:e.video,audio:e.audio},v=z("MEDIA_DEVICE_CONSTRAINTS");if(v)try{typeof v=="string"&&(v=JSON.parse(v)),m=Ij(m,v)}catch{}I.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(m)),yn();let E,w=null;(Hs()||Mi()||YN())&&(w=await tM.lock());try{E=await navigator.mediaDevices.getUserMedia(m)}catch(S){throw w&&w(),S}return m.audio&&(yW=!0),m.video&&(bW=!0),Wv(c,E),w&&w(),c}function lI(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new we(K.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new we(K.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new we(K.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new we(K.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new we(K.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new we(K.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return I.error("getUserMedia unexpected error",e),new we(K.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function Wv(e,t){const r=e.getVideoTracks()[0],a=e.getAudioTracks()[0],c=t.getVideoTracks()[0],d=t.getAudioTracks()[0];d&&(a&&e.removeTrack(a),e.addTrack(d)),c&&(r&&e.removeTrack(r),e.addTrack(c))}const ac=new class extends br{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Dg.STATE_CHANGE,e),this._state=e)}constructor(){super(),be(this,"_state",qx.IDLE),be(this,"isAccessMicrophonePermission",!1),be(this,"isAccessCameraPermission",!1),be(this,"lastAccessMicrophonePermission",!1),be(this,"lastAccessCameraPermission",!1),be(this,"checkdeviceMatched",!1),be(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(z("ENUMERATE_DEVICES_INTERVAL")||(Ux()||qN()===Os.HARMONY_OS)&&yu())&&this.updateDevicesInfo()},z("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>I.error(e.toString()))}async enumerateDevices(e,t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new we(K.NOT_SUPPORTED,"enumerateDevices() not supported.");const a=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(a);let d=!this.isAccessMicrophonePermission&&e,h=!this.isAccessCameraPermission&&t;c.audio&&(d=!1),c.video&&(h=!1);let f=null,m=null,v=null;if(!r&&(d||h)){if(tM.isLocked&&(I.debug("[device manager] wait GUM lock"),(await tM.lock())(),I.debug("[device manager] GUM unlock")),yW&&(d=!1,this.isAccessMicrophonePermission=!0),bW&&(h=!1,this.isAccessCameraPermission=!0),I.debug("[device manager] check media device permissions",e,t,d,h),d&&h){try{v=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(E){const w=lI(E.name||E.code||E,E.message);if(w.code===K.PERMISSION_DENIED)throw w;I.warning("getUserMedia failed in getDevices",w)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(d){try{f=await navigator.mediaDevices.getUserMedia({audio:e})}catch(E){const w=lI(E.name||E.code||E,E.message);if(w.code===K.PERMISSION_DENIED)throw w;I.warning("getUserMedia failed in getDevices",w)}this.isAccessMicrophonePermission=!0}else if(h){try{m=await navigator.mediaDevices.getUserMedia({video:t})}catch(E){const w=lI(E.name||E.code||E,E.message);if(w.code===K.PERMISSION_DENIED)throw w;I.warning("getUserMedia failed in getDevices",w)}this.isAccessCameraPermission=!0}I.debug("[device manager] mic permission",e,"cam permission",t)}try{const E=await navigator.mediaDevices.enumerateDevices();return f&&f.getTracks().forEach(w=>w.stop()),m&&m.getTracks().forEach(w=>w.stop()),v&&v.getTracks().forEach(w=>w.stop()),f=null,m=null,v=null,E}catch(E){return f&&f.getTracks().forEach(w=>w.stop()),m&&m.getTracks().forEach(w=>w.stop()),v&&v.getTracks().forEach(w=>w.stop()),f=null,m=null,v=null,new we(K.ENUMERATE_DEVICES_FAILED,E.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(r=>{r.device.label===e&&(t=r.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(r=>r.deviceId===e);if(!t)throw new we(K.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=qx.INITING;try{await this.updateDevicesInfo(),this.state=qx.INITEND}catch(e){throw this.state=qx.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")?(I.warning("Device Detection functionality cannot start properly.",e.toString()),e):new we(K.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.")}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),r=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=e.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),d=e.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&d?d.groupId===c.groupId?I.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is the same group")):I.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is not the same group")):I.debug("[device-check] default input or output not found")}const a=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(c=>{if(!c.deviceId)return;const d=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((d?d.state:"INACTIVE")!=="ACTIVE"){const h={initAt:t,updateAt:t,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),r.push(h)}d&&(d.updateAt=t)}),this.deviceInfoMap.forEach((c,d)=>{c.state==="ACTIVE"&&c.updateAt!==t&&(c.state="INACTIVE",r.push(c))}),this.state!==qx.INITEND)return a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));r.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Dg.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Dg.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Dg.PLAYOUT_DEVICE_CHANGED,c)}}),a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(c=>c.kind==="audioinput"),r=e.filter(c=>c.kind==="videoinput"),a={audio:!1,video:!1};for(const c of t)if(c.label&&c.deviceId){a.audio=!0;break}for(const c of r)if(c.label&&c.deviceId){a.video=!0;break}return a}};let nM=!1;const ja=new class extends br{constructor(){super(...arguments),be(this,"onAutoplayFailed",void 0),be(this,"onAudioAutoplayFailed",void 0)}};function xW(){if(nM)return z("FLS_AUTOPLAY_EMITS")?(ja.onAutoplayFailed&&ja.onAutoplayFailed(),ja.emit("autoplay-failed")):void 0;{const e=t=>{t.preventDefault(),nM=!1,Vx()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};nM=!0,Vx()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),I.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),ja.onAutoplayFailed?ja.onAutoplayFailed():ja.onAudioAutoplayFailed?I.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):I.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),ja.emit("autoplay-failed")}}function wW(e,t,r,a){if(!e)return;const c=tt.getBaseInfoBySessionId(e);if(!c)return;const d=c.info,h=Date.now(),f=ar(ar({},d),{},{vid:d.vid===void 0?0:Number(d.vid),lts:h,elapse:h-c.startTime,cbRegistered:ja.onAutoplayFailed||ja.onAudioAutoplayFailed?1:-1,errorMsg:r,mediaType:t,trackId:a,extend:void 0});tt.send({type:vr.AUTOPLAY_FAILED,data:f},!0)}const Ode=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Ji=new class{constructor(){be(this,"onAutoplayFailed",void 0),be(this,"elementMap",new Map),be(this,"elementStateMap",new Map),be(this,"elementsNeedToResume",[]),be(this,"sinkIdMap",new Map),be(this,"autoResumeAfterInterruption",e=>Ue.all(Array.from(this.elementMap.entries()).map(async t=>{let[r,a]=t;const c=this.elementStateMap.get(r),d=a.srcObject.getAudioTracks()[0],h=d&&d.readyState;if(I.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(e)),h==="live"){if(e)return a.pause(),a.play();if(Hn.curState==="running")return Av()?(a.pause(),a.play()):c&&c==="paused"?a.play():void 0}}))),be(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,r]=e;const a=r.srcObject.getAudioTracks()[0];a&&a.readyState==="live"&&(I.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),r.pause(),r.play())})}),this.autoResumeAudioElement(),Hn.on(si.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Hn.on(si.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Hn.on(si.STATE_CHANGE,()=>{Mi()&&Hn.prevState==="suspended"&&Hn.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const r=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),r)try{await r.setSinkId(t)}catch(a){throw new we(K.PERMISSION_DENIED,"can not set sink id: "+a.toString())}}play(e,t,r,a){if(this.elementMap.has(t))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,c),this.elementMap.set(t,c),this.elementStateMap.set(t,Ci.INIT),this.setVolume(t,r);const d=this.sinkIdMap.get(t);if(d)try{c.setSinkId(d).catch(f=>{I.warning("[".concat(t,"] set sink id failed"),f.toString())})}catch(f){I.warning("[".concat(t,"] set sink id failed"),f.toString())}const h=c.play();h&&h.then&&h.catch(f=>{a&&wW(a,"audio",f.message,t),I.warning("audio element play warning",f.toString()),this.elementMap.has(t)&&f.name==="NotAllowedError"&&(I.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),$N(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),xW()}))})}updateTrack(e,t){const r=this.elementMap.get(e);r&&(r.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const r=this.elementMap.get(e);r&&(t=Math.max(0,Math.min(100,t)),r.volume=t/100)}getVolume(e){const t=this.elementMap.get(e);return t?t.volume:0}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const r=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(r,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){Ode.forEach(r=>{t.addEventListener(r,a=>{const c=this.elementStateMap.get(e),d=a.type==="pause"?"paused":a.type;if(I.debug("[".concat(e,"] audio-element-status change ").concat(c," => ").concat(d)),a.type==="error"){const h=t==null?void 0:t.error;h&&I.error("[".concat(e,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(e,d)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(r=>{I.debug("Auto resume audio element success")}).catch(r=>{I.warning("Auto resume audio element failed!",r)})}),this.elementsNeedToResume=[]};new Ue(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Vx()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Yr(){return function(e,t,r){const a=r.value;return typeof a=="function"&&(r.value=function(){this._isClosed&&new we(K.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",I);for(var c=arguments.length,d=new Array(c),h=0;h<c;h++)d[h]=arguments[h];const f=a.apply(this,d);return f instanceof Ue?new Ue((m,v)=>{f.then(m).catch(v)}):f}),r}}class SW extends br{constructor(t){super(),be(this,"name","VideoProcessorDestination"),be(this,"ID","0"),be(this,"_source",void 0),be(this,"videoContext",void 0),be(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new we(K.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new we(K.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(ga.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(ga.ON_TRACK,void 0)}}class TW extends br{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,r){super(),be(this,"constraintsMap",new Map),be(this,"statsRegistry",[]),be(this,"usageRegistry",[]),be(this,"trackId",void 0),be(this,"direction",void 0),be(this,"_chained",!1),this.trackId=t,this.direction=r}async getConstraints(){return await _s(this,rc.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,r){var a;return I.info("processor ".concat(r.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(r,t),er(this,rc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Oa(a=this.constraintsMap).call(a)))}async requestRevertConstraints(t){var r;if(this.constraintsMap.has(t))return I.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),er(this,rc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Oa(r=this.constraintsMap).call(r)))}registerStats(t,r,a){this.statsRegistry.find(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:r,cb:a})}unregisterStats(t,r){const a=this.statsRegistry.findIndex(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r);a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){const t=[];for(const{processorID:r,processorName:a,type:c,cb:d}of this.statsRegistry)try{const h=d();t.push({processorID:r,processorName:a,type:c,stats:h})}catch(h){I.error(new we(K.UNEXPECTED_ERROR,h.message))}return t}registerUsage(t,r){this.usageRegistry.find(a=>a.processorID===t.ID&&a.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:r})}unregisterUsage(t){const r=this.usageRegistry.findIndex(a=>a.processorID===t.ID&&a.processorName===t.name);r!==-1&&this.usageRegistry.splice(r,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:r}of this.usageRegistry)try{let a=r();a instanceof Ue&&(a=await a),t.push(ar(ar({},a),{},{direction:this.direction}))}catch(a){I.error("gather extension usage error",a)}return t}getDirection(){return this.direction}}class RW extends br{constructor(t){super(),be(this,"name","AudioProcessorDestination"),be(this,"ID","0"),be(this,"inputTrack",void 0),be(this,"inputNode",void 0),be(this,"audioProcessorContext",void 0),be(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new we(K.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new we(K.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(ga.ON_TRACK,void 0),this.emit(ga.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(ga.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(ga.ON_NODE,this.inputNode))}}class CW extends br{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,r,a){super(),be(this,"constraintsMap",new Map),be(this,"statsRegistry",[]),be(this,"audioContext",void 0),be(this,"trackId",void 0),be(this,"direction",void 0),be(this,"usageRegistry",[]),be(this,"_chained",!1),this.audioContext=t,this.trackId=r,this.direction=a}async getConstraints(){return _s(this,rc.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,r){var a;return I.info("processor ".concat(r.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(r,t),er(this,rc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Oa(a=this.constraintsMap).call(a)))}async requestRevertConstraints(t){var r;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),er(this,rc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Oa(r=this.constraintsMap).call(r)))}registerStats(t,r,a){this.statsRegistry.find(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:r,cb:a})}unregisterStats(t,r){const a=this.statsRegistry.findIndex(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r);a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){const t=[];for(const{processorID:r,processorName:a,type:c,cb:d}of this.statsRegistry)try{const h=d();t.push({processorID:r,processorName:a,type:c,stats:h})}catch(h){I.error(new we(K.UNEXPECTED_ERROR,h.message))}return t}registerUsage(t,r){this.usageRegistry.find(a=>a.processorID===t.ID&&a.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:r})}unregisterUsage(t){const r=this.usageRegistry.findIndex(a=>a.processorID===t.ID&&a.processorName===t.name);r!==-1&&this.usageRegistry.splice(r,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:r}of this.usageRegistry)try{let a=r();a instanceof Ue&&(a=await a),t.push(ar(ar({},a),{},{direction:this.direction}))}catch(a){I.error("gather extension usage error",a)}return t}getDirection(){return this.direction}}class rM extends br{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),be(this,"context",void 0),be(this,"processSourceNode",void 0),be(this,"outputTrack",void 0),be(this,"processedNode",void 0),be(this,"clonedTrack",void 0),be(this,"outputNode",void 0),this.outputNode=new Dde}setVolume(){}createOutputTrack(){throw new we(K.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Dde{disconnect(){}connect(){}}function NW(e){return new Ue((t,r)=>{let a=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const d=Mi()?"canplay":"playing";c.addEventListener(d,()=>{const h=c.videoWidth,f=c.videoHeight;!h&&dr()||(a=!0,c.srcObject=null,c.remove(),t([h,f]))}),c.srcObject=new MediaStream([e]),c.play().catch(zx),setTimeout(()=>{a||(c.srcObject=null,c.remove(),t([c.videoWidth,c.videoHeight]))},4e3)})}function dI(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const r=Il(e.encoderConfig);return r.width!=null&&(t.width=r.width),r.height!=null&&(t.height=r.height),!bG()&&r.frameRate&&(t.frameRate=r.frameRate),pG()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),dr()&&(t.frameRate={ideal:30,max:30}),t}function IW(e){const t={};return bG()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,Ih()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function AW(e){const t=IW(e);if(e.encoderConfig){const r=oI(e.encoderConfig);t.channelCount=r.stereo?2:1,t.sampleRate=r.sampleRate,t.sampleSize=r.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),Ux()&&(t.sampleRate=void 0),t}const kW=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:r,width:a,height:c}=e.getMediaStreamTrackSettings();let{frameRate:d=r,width:h=a,height:f=c}=t;if(!d||!h||!f)return;h=Dv(h),f=Dv(f),d=Dv(d);const{max:m,min:v}=function(R,j,D){const P=200*Math.pow(D/15,.6)*Math.pow(R*j/640/360,.75);return{min:Math.floor(P),max:Math.floor(4*P)}}(h,f,d),{bitrateMax:E,bitrateMin:w}=t||{};E||I.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(f,", fps: ").concat(d,"] => [brMax: ").concat(E,", brMin: ").concat(w,"]"));const{maxFramerate:S}=z("ENCODER_CONFIG_LIMIT");return S&&typeof S=="number"&&(d=Math.min(d,S)),{frameRate:d,bitrateMax:E||m,bitrateMin:w||v,scaleResolutionDownBy:1,scale:0}},OW=async(e,t,r)=>await(async(a,c,d)=>{const h=function(v){const E=[];for(let w=0;w<v.length;w+=2)E.push(parseInt(v.slice(w,w+2),16));return Uint8Array.from(E)}(BG(""+c+d)).slice(0,16),f=h.slice(0,12),m=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:f},m,a))})(e.buffer,t,r),sM=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new Ue((r,a)=>{t.toBlob(async c=>{if(t.remove(),c){const d=await DW(c);r({buffer:d,width:t.width,height:t.height})}else a(new we(K.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},DW=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var PW,LW,jW,MW,UW,VW,FW,BW,zW,GW,WW,HW,KW,qW,YW,XW,$W,JW,Ar,QW,ZW,e9,t9,n9,r9,wu,s9,i9,a9,o9,c9,l9,d9,u9,h9,p9,f9,m9,g9,gi;let Xr=(PW=mt({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),LW=mt({argsMap:(e,t)=>[e.getTrackId(),t]}),jW=Yr(),MW=Pv("LocalAudioTrack","_enabledMutex"),UW=mt({argsMap:(e,t)=>[e.getTrackId(),t]}),VW=Yr(),FW=Pv("LocalAudioTrack","_enabledMutex"),BW=mt({argsMap:(e,t)=>[e.getTrackId(),t]}),zW=Yr(),GW=Yr(),WW=Yr(),HW=mt({argsMap:e=>[e.getTrackId()]}),KW=Yr(),qW=mt({argsMap:e=>[e.getTrackId()]}),YW=Yr(),XW=mt({argsMap:e=>[e.getTrackId()]}),$W=mt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),JW=mt({argsMap:e=>[e.getTrackId()]}),an((Ar=class extends zv{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Ji.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,r,a){super(e,r),be(this,"trackMediaType",Bv.AUDIO),be(this,"_encoderConfig",void 0),be(this,"_trackSource",void 0),be(this,"metadata",[]),be(this,"_enabled",!0),be(this,"_volume",100),be(this,"_useAudioElement",!0),be(this,"_bypassWebAudio",!1),be(this,"processor",void 0),be(this,"_processorContext",void 0),be(this,"_processorDestination",void 0),be(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!a,this._trackSource=new rM,z("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),z("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Hs()&&!sc?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){Xn(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Ji.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void I.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,er(this,nt.NEED_REPLACE_TRACK,this).then(()=>{I.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(r=>{I.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),r)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!iW())throw new we(K.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ji.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,r){return this._setEnabled(e,t,r)}async _setEnabled(e,t,r){if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(I.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{r||(this._enabled=!0),await er(this,nt.NEED_ENABLE_TRACK,this),I.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(a){throw r||(this._enabled=!1),I.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}}else{this._originMediaStreamTrack.enabled=!1,r||(this._enabled=!1);try{await er(this,nt.NEED_DISABLE_TRACK,this)}catch(a){throw r||(this._enabled=!0),I.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,I.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await er(this,nt.NEED_MUTE_TRACK,this):await er(this,nt.NEED_UNMUTE_TRACK,this))}getStats(){return lf(()=>{I.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Oo(this,nt.GET_STATS)||ar({},Yj)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(nc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(nc.ON_AUDIO_BUFFER),this._source.on(nc.ON_AUDIO_BUFFER,r=>e(r))}play(){I.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(I.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Ji.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){I.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Ji.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];I.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ji.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await er(this,nt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return Ue.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new we(K.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new we(K.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(ga.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await er(this,nt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await er(this,nt.NEED_REPLACE_TRACK,this))}),e.on(ga.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(ga.ON_TRACK),e.removeAllListeners(ga.ON_NODE)}bindProcessorContextEvents(e){e.on(rc.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(rc.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof rM&&(this._trackSource=new eM(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new CW(this._source.context,this.getTrackId(),"local"),t=new RW(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(nc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Ji.stop(this.getTrackId()),this._source.play()),er(this,nt.NEED_REPLACE_MIXING_TRACK,this).then(()=>{I.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(r=>{I.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),r)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[PW],Object.getOwnPropertyDescriptor(Ar.prototype,"setVolume"),Ar.prototype),an(Ar.prototype,"setPlaybackDevice",[LW,jW],Object.getOwnPropertyDescriptor(Ar.prototype,"setPlaybackDevice"),Ar.prototype),an(Ar.prototype,"setEnabled",[MW,UW,VW],Object.getOwnPropertyDescriptor(Ar.prototype,"setEnabled"),Ar.prototype),an(Ar.prototype,"setMuted",[FW,BW,zW],Object.getOwnPropertyDescriptor(Ar.prototype,"setMuted"),Ar.prototype),an(Ar.prototype,"getStats",[GW],Object.getOwnPropertyDescriptor(Ar.prototype,"getStats"),Ar.prototype),an(Ar.prototype,"setAudioFrameCallback",[WW],Object.getOwnPropertyDescriptor(Ar.prototype,"setAudioFrameCallback"),Ar.prototype),an(Ar.prototype,"play",[HW,KW],Object.getOwnPropertyDescriptor(Ar.prototype,"play"),Ar.prototype),an(Ar.prototype,"stop",[qW,YW],Object.getOwnPropertyDescriptor(Ar.prototype,"stop"),Ar.prototype),an(Ar.prototype,"close",[XW],Object.getOwnPropertyDescriptor(Ar.prototype,"close"),Ar.prototype),an(Ar.prototype,"pipe",[$W],Object.getOwnPropertyDescriptor(Ar.prototype,"pipe"),Ar.prototype),an(Ar.prototype,"unpipe",[JW],Object.getOwnPropertyDescriptor(Ar.prototype,"unpipe"),Ar.prototype),Ar),Yx=(QW=mt({argsMap:(e,t)=>[e.getTrackId(),t]}),ZW=Yr(),e9=Pv("MicrophoneAudioTrack","_enabledMutex"),t9=mt({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),n9=Yr(),r9=mt({argsMap:e=>[e.getTrackId()]}),an((wu=class extends Xr{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,r,a){super(e,t.encoderConfig?oI(t.encoderConfig):{},a,z("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),be(this,"_config",void 0),be(this,"_deviceName","default"),be(this,"_constraints",void 0),be(this,"_originalConstraints",void 0),be(this,"_enabled",!0),this._config=t,this._constraints=r,this._originalConstraints=r,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(Av()||bj())&&Hn.bindInterruptDetectorTrack(this)}async setDevice(e){if(I.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await ac.getDeviceById(e),r={};r.audio=ar({},this._constraints),r.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let a=null;try{a=await ic(r,this.getTrackId())}catch(c){throw I.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),a=await ic({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw I.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await ac.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw I.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}I.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,r){if(t)return I.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(I.info("[".concat(this.getTrackId(),"] start setEnabled"),e),z("AUTO_RESET_AUDIO_ROUTE")&&(Mi()||Sl())){const h=navigator.audioSession;h&&(e||(h.type="playback"),h.type="auto")}if(!e){var a;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(a=this._source.clonedTrack)===null||a===void 0||a.stop(),r||(this._enabled=!1);try{await er(this,nt.NEED_DISABLE_TRACK,this)}catch(h){throw I.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=ar({},this._constraints),d=ac.searchDeviceIdByName(this._deviceName);d&&!c.deviceId&&(c.deviceId=d);try{r||(this._enabled=!0);const h=await ic({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await er(this,nt.NEED_ENABLE_TRACK,this)}catch(h){throw r||(this._enabled=!1),I.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}I.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Av()||bj())&&Hn.unbindInterruptDetectorTrack(this),kg.some(e=>function(t){return"__className__"in t&&t.__className__==="MicrophoneAudioTrack"}(e))||Jj&&Jj()&&(tt.reportApiInvoke(null,{name:"BG_AUDIO_TAG_RESTART",options:{},tag:$n.TRACER}).onSuccess(),I.debug("restart background audio tag success"))}onTrackEnded(){if((Mi()||Sl())&&this._enabled&&!this._isClosed&&Hn.duringInterruption){const e=async()=>{Hn.off(si.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(I.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Hn.on(si.IOS_INTERRUPTION_END,e)}else I.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Fv.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,r=ac.searchDeviceIdByName(this._deviceName);if(r&&!t.deviceId&&(t.deviceId=r),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const a=await ic({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(rc.REQUEST_UPDATE_CONSTRAINTS,async(t,r,a)=>{try{const c=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(c),r()}catch(c){a(c)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(rc.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[QW,ZW],Object.getOwnPropertyDescriptor(wu.prototype,"setDevice"),wu.prototype),an(wu.prototype,"setEnabled",[e9,t9,n9],Object.getOwnPropertyDescriptor(wu.prototype,"setEnabled"),wu.prototype),an(wu.prototype,"close",[r9],Object.getOwnPropertyDescriptor(wu.prototype,"close"),wu.prototype),wu),Pde=(s9=mt({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),i9=Yr(),a9=mt({argsMap:e=>[e.getTrackId()]}),o9=Yr(),c9=mt({argsMap:e=>[e.getTrackId()]}),l9=Yr(),d9=mt({argsMap:e=>[e.getTrackId()]}),u9=Yr(),h9=mt({argsMap:e=>[e.getTrackId()]}),p9=Yr(),f9=mt({argsMap:e=>[e.getTrackId()]}),m9=mt({argsMap:e=>[e.getTrackId()]}),g9=Yr(),an((gi=class extends Xr{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,r,a){super(t.createOutputTrack(),r,a),be(this,"source",void 0),be(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(nc.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(Fv.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){Xn(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[s9,i9],Object.getOwnPropertyDescriptor(gi.prototype,"startProcessAudioBuffer"),gi.prototype),an(gi.prototype,"pauseProcessAudioBuffer",[a9,o9],Object.getOwnPropertyDescriptor(gi.prototype,"pauseProcessAudioBuffer"),gi.prototype),an(gi.prototype,"seekAudioBuffer",[c9,l9],Object.getOwnPropertyDescriptor(gi.prototype,"seekAudioBuffer"),gi.prototype),an(gi.prototype,"resumeProcessAudioBuffer",[d9,u9],Object.getOwnPropertyDescriptor(gi.prototype,"resumeProcessAudioBuffer"),gi.prototype),an(gi.prototype,"stopProcessAudioBuffer",[h9,p9],Object.getOwnPropertyDescriptor(gi.prototype,"stopProcessAudioBuffer"),gi.prototype),an(gi.prototype,"close",[f9],Object.getOwnPropertyDescriptor(gi.prototype,"close"),gi.prototype),an(gi.prototype,"setAudioBufferPlaybackSpeed",[m9,g9],Object.getOwnPropertyDescriptor(gi.prototype,"setAudioBufferPlaybackSpeed"),gi.prototype),gi);class bs extends Xr{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=Gv().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,jn(8,"track-mix-")),be(this,"trackList",void 0),be(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(I.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):I.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){I.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}XN(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(r=>{r._encoderConfig&&((r._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=r._encoderConfig.bitrate),(r._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=r._encoderConfig.sampleRate),(r._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=r._encoderConfig.sampleSize),r._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(r=>{r instanceof bs?r.emit(Og.TRANSCEIVER_UPDATED,t):r._updateRtpTransceiver(t)}))}}class Lde extends _W{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(nc.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),be(this,"audioBuffer",void 0),be(this,"sourceNode",void 0),be(this,"startPlayTime",0),be(this,"startPlayOffset",0),be(this,"pausePlayTime",0),be(this,"options",void 0),be(this,"currentLoopCount",0),be(this,"currentPlaybackSpeed",100),be(this,"_currentState","stopped"),this.audioBuffer=t,this.options=r,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):I.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const _9=new Map;function v9(e,t){if(e.length===0||t.length===0)return 1/0;const r=kj(e),a=kj(t);return Math.floor(a/r)}class iM{get rendFrameRate(){const t=Math.max(1,v9(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:Ci.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(I.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var r;t!==this._videoState&&(this._videoState=t,(r=this.onVideoStateChanged)===null||r===void 0||r.call(this,this.videoState))}constructor(t){be(this,"trackId",void 0),be(this,"config",void 0),be(this,"onFirstVideoFrameDecoded",void 0),be(this,"onFirstVideoFrameRender",void 0),be(this,"onVideoBufferReady",void 0),be(this,"onVideoStateChanged",void 0),be(this,"freezeTimeCounterList",[]),be(this,"renderFreezeAccTime",0),be(this,"renderFreezeAccTime2",0),be(this,"isKeepLastFrame",!1),be(this,"isDestroyed",!1),be(this,"timeUpdatedCount",0),be(this,"freezeTime",0),be(this,"playbackTime",0),be(this,"lastTimeUpdatedTime",0),be(this,"autoplayFailed",!1),be(this,"videoTrack",void 0),be(this,"videoElement",void 0),be(this,"cacheVideoElement",void 0),be(this,"cancelRVFId",void 0),be(this,"internal",!1),be(this,"_render_interframe_delays",[]),be(this,"_render_interframe_delays_sizes",[]),be(this,"_videoState",xu.VideoStateStopped),be(this,"videoElementCheckInterval",void 0),be(this,"videoElementFreezeTimeout",void 0),be(this,"_videoElementStatus",Ci.NONE),be(this,"_isInPage",!0),be(this,"isGettingVideoDimensions",!1),be(this,"startGetVideoDimensions",()=>{const r=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return I.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(r,500)};!this.isGettingVideoDimensions&&r()}),be(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Hn.curState==="running"&&(I.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(uG())),EG()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),be(this,"handleVideoEvents",r=>{switch(r.type){case"play":case"playing":r.type==="play"&&I.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=Ci.PLAYING;break;case"loadeddata":if(this.videoState=xu.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Ci.CANPLAY;break;case"stalled":this.videoElementStatus=Ci.STALLED;break;case"suspend":this.videoElementStatus=Ci.SUSPEND;break;case"pause":this.videoElementStatus=Ci.PAUSED,Mi()||Sl()||Hs()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(I.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Ci.WAITING;break;case"abort":this.videoElementStatus=Ci.ABORT;break;case"ended":this.videoElementStatus=Ci.ENDED;break;case"emptied":this.videoElementStatus=Ci.EMPTIED;break;case"error":{const a=this.videoElement.error;a&&(this.videoElementStatus=Ci.ERROR,I.error("[".concat(this.trackId,"] media error: ").concat(a.message," (").concat(a.code,")")));break}case"timeupdate":{const a=performance.now();if(this.timeUpdatedCount+=1,this.onVideoBufferReady&&this.timeUpdatedCount>z("BUFFER_READY_FRAMES")&&this.onVideoBufferReady(),this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=a);const c=a-this.lastTimeUpdatedTime,d=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=a,Do.lastVisibleTime<Do.lastHiddenTime||d<Do.lastHiddenTime||d<Do.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(c>z("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),be(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(I.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(uG())),EG()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),Hn.on(si.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Hn.on(si.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const r=this.videoElement.play();r&&r.catch&&r.catch(c=>{t&&wW(t,"video",c.message,this.trackId),c.name==="NotAllowedError"?(I.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):I.warning("[".concat(this.trackId,"] play warning: "),c)});const a=yn();if((a.name==="Safari"&&Number(a.version)===15||Av())&&r&&r.then){const c=()=>{this.config.mirror&&!this.config.noStyle&&(this.videoElement.style.transform="rotateY(180deg)")};r.then(c).catch(c)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const r=t.getContext("2d");if(!r)return I.error("create canvas context failed!"),new ImageData(2,2);r.drawImage(this.videoElement,0,0,t.width,t.height);const a=r.getImageData(0,0,t.width,t.height);return t.remove(),a}async getCurrentFrameToUint8Array(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const a=document.createElement("canvas");a.width=this.videoElement.videoWidth,a.height=this.videoElement.videoHeight;const c=a.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,a.width,a.height),new Ue((d,h)=>{a.toBlob(async f=>{if(a.remove(),f){const m=await DW(f);d({buffer:m,width:a.width,height:a.height})}else h(new we(K.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,r<0?.1:r>1?1:r)})):await sM(t)}destroy(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.isDestroyed=!0,Hn.off(si.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Hn.off(si.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),t?this.videoElement.pause():this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=xu.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Ci.INIT,!this.videoElementCheckInterval&&(E9.forEach(d=>{this.videoElement.addEventListener(d,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(d){return d!==document.body&&document.body.contains(d)}(this.videoElement)},1e3),z("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,r;let d;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(f,z("VIDEO_FREEZE_DURATION")))},f=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===xu.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=xu.VideoStateFrozen:document.addEventListener("visibilitychange",h))},m=(v,E)=>{if(this.videoElementStatus===Ci.PLAYING){if(d){const R=E.presentationTime-d.presentationTime,j=E.presentedFrames-d.presentedFrames;this._render_interframe_delays_sizes.push(j),this._render_interframe_delays.push(R);const D=kj(this._render_interframe_delays_sizes),P=D-this._render_interframe_delays_sizes[0];if(D>30&&P>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===xu.VideoStateStarting&&(this.videoState=xu.VideoStateDecoding),this.videoState===xu.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(f,z("VIDEO_FREEZE_DURATION"))),R<z("VIDEO_FREEZE_DURATION")&&this.videoState===xu.VideoStateFrozen&&(this.videoState=xu.VideoStateDecoding),R>z("VIDEO_FREEZE_DURATION")&&Do.lastVisibleTime>=Do.lastHiddenTime&&d.timestamp>Do.lastVisibleTime&&d.timestamp>Do.lastHiddenTime){const W=Math.min(66,v9(this._render_interframe_delays_sizes,this._render_interframe_delays)),Y=Math.max(0,R-(j-1)*W);this.renderFreezeAccTime2+=Y>W?Y:0,this.renderFreezeAccTime+=R}}d=ar(ar({},E),{},{timestamp:v})}else this.isSkipCalcRenderFreezeTime()&&(d=ar(ar({},E),{},{timestamp:v}));var w,S;z("ENABLE_VIDEO_FRAME_CALLBACK")&&(this.cancelRVFId=(w=(S=this.videoElement).requestVideoFrameCallback)===null||w===void 0?void 0:w.call(S,m))};this.cancelRVFId=(t=(r=this.videoElement).requestVideoFrameCallback)===null||t===void 0?void 0:t.call(r,m)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Ux()&&!z("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const a=yn();this.config.noStyle||(a.name==="Safari"&&Number(a.version)===15||Av()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover"),this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,dr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,dr()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(d=>{I.debug("[".concat(this.trackId,"] playback interrupted"),d.toString())})}resetVideoElement(){var t,r;E9.forEach(a=>{this.videoElement&&this.videoElement.removeEventListener(a,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.cancelRVFId&&this.videoElement&&((t=(r=this.videoElement).cancelVideoFrameCallback)===null||t===void 0||t.call(r,this.cancelRVFId),this.cancelRVFId=void 0),this.videoElementStatus=Ci.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===Ci.DESTROYED||this.internal}handleAutoPlayFailed(){const t=r=>{r.preventDefault(),this.videoElement.play().then(()=>{I.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(a=>{I.error(a)}),this.autoplayFailed=!1,Vx()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Vx()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),xW()}}const E9=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class uI extends iM{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),be(this,"container",void 0),be(this,"slot",void 0),this.slot=t.element,this.internal=r,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const r=t.element;var a;!this.internal||this.slot?(r!==this.slot&&(this.destroy(),this.slot=r),this.createElements()):(this.slot=r,r&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(a=this.slot)===null||a===void 0||a.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var r;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,a):await sM(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",z("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var y9,b9,x9,w9,S9,T9,R9,C9,N9,I9,A9,k9,O9,D9,P9,L9,j9,M9,U9,V9,F9,B9,z9,G9,W9,H9,K9,q9,en,Y9,X9,$9,J9,Q9,Z9,eH,tH,oc;let Jn=(y9=mt({argsMap:(e,t,r)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),b9=Yr(),x9=mt({argsMap:e=>[e.getTrackId()]}),w9=Pv("LocalVideoTrack","_enabledMutex"),S9=mt({argsMap:(e,t)=>[e.getTrackId(),t]}),T9=Yr(),R9=Pv("LocalVideoTrack","_enabledMutex"),C9=mt({argsMap:(e,t)=>[e.getTrackId(),t]}),N9=Yr(),I9=mt({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),A9=Yr(),k9=mt({argsMap:(e,t)=>[e.getTrackId(),t]}),O9=Yr(),D9=Yr(),P9=mt({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),L9=Yr(),j9=Yr(),M9=Yr(),U9=mt({argsMap:e=>[e.getTrackId()]}),V9=Yr(),F9=Yr(),B9=Yr(),z9=Yr(),G9=Yr(),W9=mt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),H9=mt({argsMap:e=>[e.getTrackId()]}),K9=mt({argsMap:e=>[e.getTrackId()]}),q9=mt({argsMap:(e,t,r)=>[e.getTrackId(),t.label,r]}),en=class Gre extends zv{get videoHeight(){if(Hs()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(Hs()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Ci.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,r,a,c,d,h){if(super(t,d),be(this,"trackMediaType",Bv.VIDEO),be(this,"_player",void 0),be(this,"isUseScaleResolutionDownBy",!1),be(this,"_videoVisibleTimer",null),be(this,"_previousVideoVisibleStatus",void 0),be(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),be(this,"_encoderConfig",void 0),be(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),be(this,"_optimizationMode",void 0),be(this,"_saveEncodeBitrateRatio",1),be(this,"_videoHeight",void 0),be(this,"_videoWidth",void 0),be(this,"_forceBitrateLimit",void 0),be(this,"_enabled",!0),be(this,"_processorDestination",void 0),be(this,"_processorContext",void 0),Hs()){const{width:f,height:m}=t.getSettings();this._videoWidth=f,this._videoHeight=m}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=a,this._optimizationMode=c,this._hints=h||[],r&&this._hints.indexOf(Pn.CUSTOM_TRACK)!==-1?this._encoderConfig=ur(r):this._encoderConfig=r,this._hints.indexOf(Pn.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(vj(Tn.CHROME,115)&&qN().indexOf("Windows")!==-1){const f=function(m,v){if("VideoFrame"in window&&"TransformStream"in window&&Zt().supportWebRTCInsertableStream){const E=new MediaStreamTrackProcessor(m),w=new MediaStreamTrackGenerator({kind:"video"});let S,R,j=Date.now();const D=()=>{P&&(clearInterval(P),P=void 0),S&&(S.close(),S=void 0),m.stop(),R=void 0,w.removeEventListener("ended",D)};let P=window.setInterval(()=>{if(R&&S&&Date.now()-j>1e3)try{w.readyState==="live"?R.enqueue(S.clone()):D()}catch{D()}},1e3);const W=new TransformStream({transform:(Y,ne)=>{w.readyState==="live"?(R=ne,j=Date.now(),S===void 0?(S=Y,ne.enqueue(Y.clone())):(ne.enqueue(S),S=Y)):Y.close()}});return w.addEventListener("ended",D),E.readable.pipeThrough(W).pipeTo(w.writable),w}}(t);f&&(I.info("local screen video track begin to inject frame"),this._mediaStreamTrack=f)}r&&this._hints.indexOf(Pn.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(r),this._processorContext=new TW(this.getTrackId(),"local"),this._processorDestination=new SW(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const c=document.getElementById(t);c?t=c:(I.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}I.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const a=ar(ar(ar({},this._getDefaultPlayerConfig()),r),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(a):(t instanceof HTMLVideoElement?this._player=new iM(a):this._player=new uI(a),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(Fv.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},z("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,I.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(I.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await er(this,nt.NEED_DISABLE_TRACK,this)}catch(a){throw I.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}return r||(this._enabled=!1),void I.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await er(this,nt.NEED_ENABLE_TRACK,this)}catch(a){throw I.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}I.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,I.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await er(this,nt.NEED_MUTE_TRACK,this):await er(this,nt.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),I.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await er(this,nt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(I)}}}async setEncoderConfiguration(t,r){if(!this._enabled)throw new we(K.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=Il(t),z("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const a=dI({encoderConfig:t});(Hs()||Mi()||Sl())&&(a.deviceId=void 0),I.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(a));try{await this._originMediaStreamTrack.applyConstraints(a),this.updateMediaStreamTrackResolution()}catch(c){const d=new we(K.UNEXPECTED_ERROR,c.toString());throw I.error("[".concat(this.getTrackId(),"] applyConstraints error"),d.toString()),d}}this._encoderConfig=t,this._hints.indexOf(Pn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await er(this,nt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(a){return a.throw(I)}}getStats(){return lf(()=>{I.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Oo(this,nt.GET_STATS)||ar({},Xj)}async setBeautyEffect(t){I.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,r):await sM(t)}async findClosestProfile(){const{width:t,height:r,frameRate:a}=this.getMediaStreamTrackSettings(),{width:c,height:d,frameRate:h}=this._encoderConfig||{},f=Dv(this._videoWidth||t||c||0),m=Dv(this._videoHeight||r||d||0),v=function(E,w,S){if(!Array.isArray(z("VIDEO_ENCODER_CONFIG_LIST"))||z("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const R=Math.min(E,w);return!(R>=480)&&ar(ar({},z("VIDEO_ENCODER_CONFIG_LIST").find(j=>j.height>R)),{},{frameRate:S})}(f,m,Dv(a||h||15));if(v)return I.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(f,"x").concat(m," => ").concat(JSON.stringify(v))),this.setEncoderConfiguration(v)}async setBitrateLimit(t){I.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void I.error(K.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const r=this._optimizationMode;try{this._optimizationMode=t,await er(this,nt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(a){throw this._optimizationMode=r,I.error("[".concat(this.getTrackId(),"] set optimization mode failed"),a.toString()),a}I.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return I.error(K.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,I.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){NW(this._originMediaStreamTrack).then(t=>{let[r,a]=t;this._videoHeight=a,this._videoWidth=r}).catch(zx)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new we(K.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");I.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=Il(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(Pn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await er(this,nt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(I)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:r,frameRate:a}=this.getMediaStreamTrackSettings();if(!t||!r||!a)return;const{bitrateMax:c,bitrateMin:d}=this._encoderConfig;if(d==null||c==null){const{max:h,min:f}=function(m,v,E,w,S){const R=z("BITRATE_ADAPTER_TYPE");if(R==="DEFAULT_BITRATE")return{min:w,max:S};if(S===void 0){const j=Math.floor(200*Math.pow(E/15,.6)*Math.pow(m*v/640/360,.75));S=R==="STANDARD_BITRATE"?4*j:2*j,w=w??j}else w=w??Math.floor(S/10);return{min:w,max:S}}(t,r,a,d,c);if(this._encoderConfig.bitrateMin=f,this._encoderConfig.bitrateMax=h,z("VIDEO_STANDARD_BITRATE_VERSION")&&d==null&&c==null){const[m,v]=function(E,w,S){const R=4*Math.floor(2e5*Math.pow(S/15,.6)*Math.pow(E*w/230400,.75)),j=E*w,D=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),P=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let W=Oa(D).call(D).next().value,Y=1;if(D.has(j))W=D.get(j);else{var ne;const Ke=Th(ne=Array.from(D.entries())).call(ne,(Et,Vt)=>{let[Ot]=Et,[Cn]=Vt;return Ot-Cn}),St=Ke.find(Et=>{let[Vt]=Et;return Vt>j});if(St){const Et=Ke.indexOf(St);if(Et>0){const Vt=Ke[Et-1],Ot=(j-Vt[0])/(St[0]-Vt[0]);W=Vt[1]+Ot*(St[1]-Vt[1])}else W=St[1]}else W=Ke[Ke.length-1][1]}if(P.has(j))Y=P.get(j);else{var le;const Ke=Th(le=Array.from(P.entries())).call(le,(Et,Vt)=>{let[Ot]=Et,[Cn]=Vt;return Ot-Cn}),St=Ke.find(Et=>{let[Vt]=Et;return Vt>j});if(St){const Et=Ke.indexOf(St);if(Et>0){const Vt=Ke[Et-1],Ot=(j-Vt[0])/(St[0]-Vt[0]);Y=Vt[1]+Ot*(St[1]-Vt[1])}else Y=St[1]}else Y=Ke[Ke.length-1][1]}const fe=z("VIDEO_NEW_BITRATE_RATIO");fe&&fe>0&&(W=fe/100);const ie=Math.floor(R*W),_e=Math.floor(65e4*Math.pow(E*w/230400,.5)*Math.pow(S/15,.69));let Te=ie;const Ne=z("VIDEO_STANDARD_BITRATE_VERSION");return Ne&&Ne>0&&(Ne===1?Te=R:Ne===2?Te=ie:Ne===3&&(Te=_e)),[Math.floor(Te/1e3),Y]}(t,r,a);this._encoderConfig.bitrateMax=m,this._encoderConfig.bitrateMin=f?Math.min(f,m):m,this._saveEncodeBitrateRatio=v,I.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(r,", fps: ").concat(a,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else I.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(r,", fps: ").concat(a,"] => [brMax: ").concat(h,", brMin: ").concat(f,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,r;const a=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),c={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:a==null?void 0:a.parentElement},{element:d,slot:h}=c;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const f=CG.checkOneElementVisible(d),m=Object.assign({},f);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const v=tt.reportApiInvoke(null,{tag:$n.TRACER,name:_r.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?v.onSuccess("Video is visible"):v.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(a){throw new we(K.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new we(K.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;t&&(a=ar(ar({},a),Il(t))),a=Rg(a);const c=jn(8,"track-video-cloned-"),d=new Gre(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,a,Rg(this._scalabilityMode),this._optimizationMode,c,Rg(this._hints));return t&&a&&d.setEncoderConfiguration(a),I.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(r)),d}async replaceTrack(t,r){if(!(t instanceof MediaStreamTrack))throw new we(K.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new we(K.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,r,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(lf(()=>{tt.reportApiInvoke(null,{name:_r.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:$n.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!z("ENABLE_VIDEO_SEI")||!z("ENABLE_ENCODED_TRANSFORM"))return void I.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new we(K.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const r=this.getRTCRtpTransceiver();if(!r)return void I.warning("Video track is not published, SEI can not be send");const a=r.sender.getParameters();if(a.codecs.length===0)return;const c=a.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"||c==="video/h265"?this.safeEmit("sei-to-send",t):I.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(ga.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await er(this,nt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await er(this,nt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ga.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(rc.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(rc.REQUEST_CONSTRAINTS)}},an(en.prototype,"play",[y9,b9],Object.getOwnPropertyDescriptor(en.prototype,"play"),en.prototype),an(en.prototype,"stop",[x9],Object.getOwnPropertyDescriptor(en.prototype,"stop"),en.prototype),an(en.prototype,"setEnabled",[w9,S9,T9],Object.getOwnPropertyDescriptor(en.prototype,"setEnabled"),en.prototype),an(en.prototype,"setMuted",[R9,C9,N9],Object.getOwnPropertyDescriptor(en.prototype,"setMuted"),en.prototype),an(en.prototype,"setSaveEncodeBitrateRatio",[I9,A9],Object.getOwnPropertyDescriptor(en.prototype,"setSaveEncodeBitrateRatio"),en.prototype),an(en.prototype,"setEncoderConfiguration",[k9,O9],Object.getOwnPropertyDescriptor(en.prototype,"setEncoderConfiguration"),en.prototype),an(en.prototype,"getStats",[D9],Object.getOwnPropertyDescriptor(en.prototype,"getStats"),en.prototype),an(en.prototype,"setBeautyEffect",[P9,L9],Object.getOwnPropertyDescriptor(en.prototype,"setBeautyEffect"),en.prototype),an(en.prototype,"getCurrentFrameData",[j9],Object.getOwnPropertyDescriptor(en.prototype,"getCurrentFrameData"),en.prototype),an(en.prototype,"getCurrentFrameImage",[M9],Object.getOwnPropertyDescriptor(en.prototype,"getCurrentFrameImage"),en.prototype),an(en.prototype,"findClosestProfile",[U9,V9],Object.getOwnPropertyDescriptor(en.prototype,"findClosestProfile"),en.prototype),an(en.prototype,"setBitrateLimit",[F9],Object.getOwnPropertyDescriptor(en.prototype,"setBitrateLimit"),en.prototype),an(en.prototype,"setOptimizationMode",[B9],Object.getOwnPropertyDescriptor(en.prototype,"setOptimizationMode"),en.prototype),an(en.prototype,"setScalabiltyMode",[z9],Object.getOwnPropertyDescriptor(en.prototype,"setScalabiltyMode"),en.prototype),an(en.prototype,"updateMediaStreamTrackResolution",[G9],Object.getOwnPropertyDescriptor(en.prototype,"updateMediaStreamTrackResolution"),en.prototype),an(en.prototype,"pipe",[W9],Object.getOwnPropertyDescriptor(en.prototype,"pipe"),en.prototype),an(en.prototype,"unpipe",[H9],Object.getOwnPropertyDescriptor(en.prototype,"unpipe"),en.prototype),an(en.prototype,"close",[K9],Object.getOwnPropertyDescriptor(en.prototype,"close"),en.prototype),an(en.prototype,"replaceTrack",[q9],Object.getOwnPropertyDescriptor(en.prototype,"replaceTrack"),en.prototype),en),hI=(Y9=mt({argsMap:(e,t)=>[e.getTrackId(),t]}),X9=Yr(),$9=Pv("CameraVideoTrack","_enabledMutex"),J9=mt({argsMap:(e,t)=>[e.getTrackId(),t]}),Q9=Yr(),Z9=mt({argsMap:(e,t)=>[e.getTrackId(),t]}),eH=Yr(),tH=mt({argsMap:e=>[e.getTrackId()]}),oc=class Wre extends Jn{get __className__(){return"CameraVideoTrack"}constructor(t,r,a,c,d,h){super(t,Il(r.encoderConfig),c,d,h),be(this,"_config",void 0),be(this,"_originalConstraints",void 0),be(this,"_constraints",void 0),be(this,"_enabled",!0),be(this,"_deviceName","default"),be(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Av()||bj())&&!function(){const f=yn();if(f.os!==Os.IOS||!f.osVersion)return!1;const m=f.osVersion.split(".");return Number(m[0])===15&&Number(m[1])>=2}()&&yG()&&this._enabled&&!this._isClosed&&(I.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=r,this._originalConstraints=a,this._constraints=a,this._deviceName=t.label,this._encoderConfig=Il(this._config.encoderConfig),Hn.on(si.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Hn.on(si.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(I.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const r=await ac.getDeviceById(t),a={};a.video=ar({},this._constraints),a.video.deviceId={exact:t},a.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await ic(a,this.getTrackId())}catch(d){throw I.error("[".concat(this.getTrackId(),"] setDevice failed"),d.toString()),c=await ic({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),d}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=r.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(r){throw I.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await ac.getDeviceById(t);this._deviceName=r.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(r){throw I.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}I.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){I.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const r={video:ar(ar({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let a=null;try{a=await ic(r,this.getTrackId())}catch(c){throw I.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),a=await ic({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=ar({},r.video),I.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(I.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const a=await ic({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1)}await er(this,nt.NEED_ENABLE_TRACK,this)}catch(a){throw I.error("[".concat(this.getTrackId(),"] setEnabled true error"),a.toString()),a}this.updateMediaStreamTrackResolution(),I.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),r||(this._enabled=!1);try{await er(this,nt.NEED_DISABLE_TRACK,this)}catch(a){throw I.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}I.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,r){if(!this._enabled)throw new we(K.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=Il(t),z("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const a=ur(this._config);a.encoderConfig=t;const c=dI(a);(Hs()||Mi()||Sl())&&(c.deviceId=void 0),I.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(d){const h=new we(K.UNEXPECTED_ERROR,d.toString());throw I.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=a,this._constraints=c,this._originalConstraints=c,this._encoderConfig=t,this._hints.indexOf(Pn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await er(this,nt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(d){return d.throw(I)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Mi()||Sl())&&this._enabled&&!this._isClosed&&Hn.duringInterruption){const t=async()=>{Hn.off(si.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(I.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Hn.on(si.IOS_INTERRUPTION_END,t)}else I.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Fv.TRACK_ENDED)}async renewMediaStreamTrack(t){const r=t||this._constraints,a=ac.searchDeviceIdByName(this._deviceName);if(a&&!r.deviceId&&(r.deviceId={exact:a}),this._enabled){const c=await ic({video:r},this.getTrackId());this._constraints=r,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Hn.off(si.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Hn.off(si.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;t&&(a=ar(ar({},a),Il(t))),a=Rg(a);const c=jn(8,"track-cam-cloned-"),d=new Wre(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,Rg(ar(ar({},this._config),{},{encoderConfig:a})),Rg(this._constraints),Rg(this._scalabilityMode),this._optimizationMode,c);return t&&a&&d.setEncoderConfiguration(a),I.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(r)),d}bindProcessorContextEvents(){this.processorContext.on(rc.REQUEST_UPDATE_CONSTRAINTS,async(t,r,a)=>{try{const c=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(c),r()}catch(c){a(c)}}),this.processorContext.on(rc.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},an(oc.prototype,"setDevice",[Y9,X9],Object.getOwnPropertyDescriptor(oc.prototype,"setDevice"),oc.prototype),an(oc.prototype,"setEnabled",[$9,J9,Q9],Object.getOwnPropertyDescriptor(oc.prototype,"setEnabled"),oc.prototype),an(oc.prototype,"setEncoderConfiguration",[Z9,eH],Object.getOwnPropertyDescriptor(oc.prototype,"setEncoderConfiguration"),oc.prototype),an(oc.prototype,"close",[tH],Object.getOwnPropertyDescriptor(oc.prototype,"close"),oc.prototype),oc);function nH(e){const t=jn(8,"track-cus-"),r=tt.reportApiInvoke(null,{id:t,tag:$n.TRACER,name:_r.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),a=new Xr(e.mediaStreamTrack,e.encoderConfig?oI(e.encoderConfig):{},t,!1);return I.info("create custom audio track success with config",e,"trackId",a.getTrackId()),r.onSuccess(a.getTrackId()),a}function aM(e,t,r,a){r.optimizationMode&&(a&&a.width&&a.height?(r.encoderConfig=ar(ar({},a),{},{bitrateMin:a.bitrateMin,bitrateMax:a.bitrateMax}),r.optimizationMode!=="motion"&&r.optimizationMode!=="detail"||(t.contentHint=r.optimizationMode,t.contentHint===r.optimizationMode?I.debug("[".concat(e,"] set content hint to"),r.optimizationMode):I.debug("[".concat(e,"] set content hint failed")))):I.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var rH,sH,iH,aH,Pc,oH,cH,lH,dH,uH,hH,pH,_i;class fH extends fW{getUserId(){return this._userId}constructor(t,r,a,c){super(t,"track-".concat(t.kind,"-").concat(r,"-").concat(c.clientId,"_").concat(jn(5,""))),be(this,"_userId",void 0),be(this,"_uintId",void 0),be(this,"_isDestroyed",!1),be(this,"store",void 0),be(this,"processor",void 0),be(this,"processorContext",void 0),this._userId=r,this._uintId=a,this.store=c}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,I.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Hv=(rH=mt({argsMap:(e,t,r)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),sH=mt({argsMap:e=>[e.getTrackId()]}),iH=mt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),aH=mt({argsMap:e=>[e.getTrackId()]}),an((Pc=class extends fH{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Ci.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,r,a,c){super(e,t,r,a),be(this,"_videoVisibleTimer",null),be(this,"_previousVideoVisibleStatus",void 0),be(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),be(this,"trackMediaType",Bv.VIDEO),be(this,"_videoWidth",void 0),be(this,"_videoHeight",void 0),be(this,"_player",void 0),be(this,"_prePlayer",void 0),be(this,"processorDestination",void 0),be(this,"processorContext",void 0),this._prePlayer=c,this.updateMediaStreamTrackResolution(),this.processorContext=new TW(this.getTrackId(),"remote"),this.processorDestination=new SW(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return lf(()=>{I.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Oo(this,nt.GET_STATS)||ar({},hW)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(Dc.PLAY_START),typeof e=="string"){const a=document.getElementById(e);a?e=a:(I.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}I.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const r=ar(ar({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(r);else{let a=!1,c=!1;e instanceof HTMLVideoElement?(this._player=new iM(r),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,c=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,a=this._player.videoState>0,this._player.updateConfig(r)):this._player=new uI(r),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Dc.FIRST_FRAME_DECODED),c&&this.safeEmit(Dc.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=d=>{this.safeEmit(Dc.VIDEO_STATE_CHANGED,d)},a&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const a=this.getVideoElementVisibleStatus();this.safeEmit(Dc.VIDEO_ELEMENT_VISIBLE_STATUS,a)}catch{}},z("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(Dc.PLAY_END)}stop(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(e),this._player=void 0,I.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){NW(this._originMediaStreamTrack).then(e=>{let[t,r]=e;this._videoHeight=r,this._videoWidth=t}).catch(zx)}_updatePlayerSource(){I.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const r=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),a={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:r==null?void 0:r.parentElement},{element:c,slot:d}=a;if(this.isPlaying&&c instanceof HTMLVideoElement&&d instanceof HTMLElement){const h=CG.checkOneElementVisible(c),f=Object.assign({},h);if(f.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=f.visible;const m=tt.reportApiInvoke(null,{tag:$n.TRACER,name:_r.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});f.visible?m.onSuccess("Video is visible"):m.onSuccess("Invisible because of ".concat(f.reason))}return f}return}catch(r){throw new we(K.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new we(K.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ga.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ga.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Og.SEI_RECEIVED,e)}}).prototype,"play",[rH],Object.getOwnPropertyDescriptor(Pc.prototype,"play"),Pc.prototype),an(Pc.prototype,"stop",[sH],Object.getOwnPropertyDescriptor(Pc.prototype,"stop"),Pc.prototype),an(Pc.prototype,"pipe",[iH],Object.getOwnPropertyDescriptor(Pc.prototype,"pipe"),Pc.prototype),an(Pc.prototype,"unpipe",[aH],Object.getOwnPropertyDescriptor(Pc.prototype,"unpipe"),Pc.prototype),Pc),Kv=(oH=mt({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),cH=mt({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),lH=mt({argsMap:(e,t)=>[e.getTrackId(),t]}),dH=mt({argsMap:e=>[e.getTrackId()]}),uH=mt({argsMap:e=>[e.getTrackId()]}),hH=mt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),pH=mt({argsMap:e=>[e.getTrackId()]}),an((_i=class extends fH{get isPlaying(){return this._useAudioElement?Ji.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,r,a){super(e,t,r,a),be(this,"trackMediaType",Bv.AUDIO),be(this,"_source",void 0),be(this,"_useAudioElement",!0),be(this,"_volume",100),be(this,"processorContext",void 0),be(this,"processorDestination",void 0),be(this,"_played",!1),be(this,"_bypassWebAudio",!1),z("DISABLE_WEBAUDIO")?(this._source=new rM,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new eM(e,!0),z("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(nc.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Dc.FIRST_FRAME_DECODED)}),this.processorContext=new CW(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new RW(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(nc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(nc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(nc.ON_AUDIO_BUFFER),this._source.on(nc.ON_AUDIO_BUFFER,r=>e(r))}setVolume(e){this._volume=e,this._useAudioElement?Ji.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}setAmplifiedVolume(e){this._useAudioElement&&this._played&&(Ji.stop(this.getTrackId()),this._source.play()),this._useAudioElement=!1,e=Math.min(e,z("MAX_WEBAUDIO_VOLUME")),this._volume=e,this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!iW())throw new we(K.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ji.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getVolume(){return this._useAudioElement?Ji.getVolume(this.getTrackId()):this._source instanceof eM?this._source.getAudioVolume():0}getStats(){return lf(()=>{I.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Oo(this,nt.GET_STATS)||ar({},uW)}play(){I.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(I.debug("[".concat(this.getTrackId(),"] use audio element to play")),Ji.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):(I.debug("[".concat(this.getTrackId(),"] use audio context to play")),this._source.play())}stop(){I.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Ji.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];I.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ji.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new we(K.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new we(K.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new we(K.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ga.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(ga.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ga.ON_TRACK),this.processorDestination.removeAllListeners(ga.ON_NODE)}}).prototype,"setVolume",[oH],Object.getOwnPropertyDescriptor(_i.prototype,"setVolume"),_i.prototype),an(_i.prototype,"setAmplifiedVolume",[cH],Object.getOwnPropertyDescriptor(_i.prototype,"setAmplifiedVolume"),_i.prototype),an(_i.prototype,"setPlaybackDevice",[lH],Object.getOwnPropertyDescriptor(_i.prototype,"setPlaybackDevice"),_i.prototype),an(_i.prototype,"play",[dH],Object.getOwnPropertyDescriptor(_i.prototype,"play"),_i.prototype),an(_i.prototype,"stop",[uH],Object.getOwnPropertyDescriptor(_i.prototype,"stop"),_i.prototype),an(_i.prototype,"pipe",[hH],Object.getOwnPropertyDescriptor(_i.prototype,"pipe"),_i.prototype),an(_i.prototype,"unpipe",[pH],Object.getOwnPropertyDescriptor(_i.prototype,"unpipe"),_i.prototype),_i);const Do=new class extends br{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),be(this,"_lastHiddenTime",0),be(this,"_lastVisibleTime",0),be(this,"needUploadStats",[]),be(this,"isCollectingStats",!1),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),this.isCollectingStats&&this.needUploadStats.push(document.visibilityState==="visible"?1:0),I.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}startCollectStats(){this.isCollectingStats=!0,this.needUploadStats.push(this.visibility==="visible"?1:0)}stopCollectStats(){this.isCollectingStats=!1,this.needUploadStats.length=0}};class mH extends br{constructor(t,r){super(),be(this,"trackMediaType",Bv.DATA),be(this,"_version",1),be(this,"_type",3),be(this,"_config",void 0),be(this,"_originDataChannel",void 0),be(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),be(this,"_dataStreamPacketHandler",{serialize:a=>a,deserialize:a=>a}),be(this,"_datachannelEventMap",new Map),this._config=t,r&&(this._originDataChannel=r,this._bandDataChannelEvents(r)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return z("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,r;return(t=(r=this._originDataChannel)===null||r===void 0?void 0:r.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,r;return(t=(r=this._originDataChannel)===null||r===void 0?void 0:r.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new Ue((t,r)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const a=setTimeout(()=>{var c;r(new we(K.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(a),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(a),new we(K.DATACHANNEL_CONNECTION_TIMEOUT)}}else r(new we(K.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[cI.OPEN,cI.CLOSE,cI.ERROR].forEach(r=>{const a=()=>{this.emit(r)};this._datachannelEventMap.set(r,a),t.addEventListener(r,a)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(r=>{let[a,c]=r;t.removeEventListener(a,c)}),this._datachannelEventMap.clear()}}class jde extends mH{constructor(t){super(t),be(this,"_messageListener",void 0),this._messageListener=r=>{if(r.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const a=r.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(a).getUint8(3);if(c!==this.id)return void(z("SHOW_DATASTREAM2_LOG")&&I.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let d=r.data.slice(this._dataStreamPacketHeader.byteLength);d=this._dataStreamPacketHandler.deserialize(d),this.emit(cI.MESSAGE,d)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Mde extends mH{send(t){if(this._originDataChannel){let r=t;r=this._dataStreamPacketHandler.serialize(t);const a=new Uint8Array(this._dataStreamPacketHeader.byteLength+r.byteLength);a.set(new Uint8Array(this._dataStreamPacketHeader),0),a.set(new Uint8Array(r),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(a.buffer)}}}function pI(){const e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcixuPVtdLHI9W107bGV0IGg9bnVsbDtlLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9dD0+e3QuZGF0YS5zZWkmJm4ucHVzaCh0LmRhdGEuc2VpKSx0LmRhdGEubWV0YWRhdGEmJnIucHVzaCh0LmRhdGEubWV0YWRhdGEpfSxzZWxmLnBvc3RNZXNzYWdlKCJzdGFydGVkIik7Y29uc3QgcD1lLnJlYWRhYmxlLmdldFJlYWRlcigpLFU9ZS53cml0YWJsZS5nZXRXcml0ZXIoKTsic2VpLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KG4udmFsdWUuZGF0YSkpLHI9YShuLnZhbHVlLHQpO2lmKHImJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtzZWk6cn0pLCFoKXtjb25zdCB0PW4udmFsdWUuZ2V0TWV0YWRhdGEoKXx8e307aD17dHlwZTpuLnZhbHVlLnR5cGUscnRwVGltZXN0YW1wOm4udmFsdWUudGltZXN0YW1wLHBheWxvYWRUeXBlOnQucGF5bG9hZFR5cGV8fDAsc3NyYzp0LnN5bmNocm9uaXphdGlvblNvdXJjZXx8MCxsZW5ndGg6bi52YWx1ZS5kYXRhLmJ5dGVMZW5ndGgsLi4uIm1pbWVUeXBlImluIHQ/e21pbWVUeXBlOnQubWltZVR5cGV9Ont9fSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7Zmlyc3RGcmFtZUluZm86aH0pfX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToic2VpLXR4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigoYT0+e2lmKCFhLmRvbmUpe2lmKGEudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KGEudmFsdWUuZGF0YSkpLGU9bi5zaGlmdCgpO2lmKGUpe2NvbnN0IG49byhhLnZhbHVlLmRhdGEsZSx0KTtuJiYoYS52YWx1ZS5kYXRhPW4pfX1VLndyaXRlKGEudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtwLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PW5ldyBEYXRhVmlldyhuLnZhbHVlLmRhdGEpLGE9dC5nZXRVaW50OCgwKTtsZXQgcjtpZigwIT0oMTI4JmEpJiY3MSE9PWEpe2NvbnN0IGU9ZnVuY3Rpb24odCl7aWYodC5ieXRlTGVuZ3RoPD0wKXJldHVybltdO2NvbnN0IGU9W107bGV0IG49MDtmb3IoO248dC5ieXRlTGVuZ3RoOyl7Y29uc3QgYT0oMTI4JnQuZ2V0VWludDgobikpPj43LHI9MTI3JnQuZ2V0VWludDgobik7aWYoIShhJiZuKzQ8PXQuYnl0ZUxlbmd0aCkpe24rKzticmVha317Y29uc3QgYT10LmdldFVpbnQzMihuLCExKSxvPSgxNjc3NjE5MiZhKT4+MTAsaT0xMDIzJmE7ZS5wdXNoKHtwdDpyLHRzX29mZnNldDpvLGxlbmd0aDppLGRhdGE6bmV3IFVpbnQ4QXJyYXl9KSxuKz00fX1sZXQgYT10LmJ5dGVMZW5ndGgtbjtmb3IoY29uc3QgciBvZiBlKXtpZihyLmxlbmd0aD5hKXJldHVybiBjb25zb2xlLndhcm4oIkJyb2tlbiByZWQgcGF5bG9hZCIpLFtdO3IubGVuZ3RoPjAmJihyLmRhdGE9bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sci5sZW5ndGgpLG4rPXIubGVuZ3RoLGEtPXIubGVuZ3RoKX1pZihhPjApe2NvbnN0IHI9e3B0OmUubGVuZ3RoPjA/ZVtlLmxlbmd0aC0xXS5wdDowLHRzX29mZnNldDowLGxlbmd0aDphLGRhdGE6bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sYSl9O2UucHVzaChyKX1yZXR1cm4gZX0odCk7aWYoZS5sZW5ndGg+MCl7Y29uc3QgdD1mdW5jdGlvbih0KXtsZXQgZT0wO2ZvcihsZXQgbj0wO248dC5sZW5ndGg7bisrKWUrPW48dC5sZW5ndGgtMT80OjEsZSs9dFtuXS5sZW5ndGg7Y29uc3Qgbj1uZXcgVWludDhBcnJheShlKTtsZXQgYT0wO2ZvcihsZXQgZT0wO2U8dC5sZW5ndGg7ZSsrKWlmKGU8dC5sZW5ndGgtMSl7Y29uc3Qgcj0oMjE0NzQ4MzY0OHwoMTI3JnRbZV0ucHQpPDwyNHwoMjYyMTQzJnRbZV0udHNfb2Zmc2V0KTw8MTB8MTAyMyZ0W2VdLmxlbmd0aCk+Pj4wO25bYSsrXT1yPj4yNCYyNTUsblthKytdPXI+PjE2JjI1NSxuW2ErK109cj4+OCYyNTUsblthKytdPTI1NSZyfWVsc2UgblthKytdPTEyNyZ0W2VdLnB0O2Zvcihjb25zdCBlIG9mIHQpbi5zZXQoZS5kYXRhLGEpLGErPWUubGVuZ3RoO3JldHVybiBufShlLm1hcCgodD0+e2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>hN.revokeObjectURL(e),0),new Worker(hN.createObjectURL(e))}const gH=71,oM=1,cM=2,lM=1,_H=2;var uf=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(uf||{});function dM(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=e.getUint8(0);if(r!==gH)return;const a=e.getUint16(1),c=oM+cM+a,d=new Uint8Array(e.byteLength-c);d.set(new Uint8Array(e.buffer,c,e.byteLength-c));const h={m:r,tlvLen:a,tlv:[],frame:d};let f=oM+cM;for(;f<c;){const m=e.getUint8(f),v=e.getUint16(f+lM),E=lM+_H;if(m===uf.AUDIO_LEVEL){let w=e.getUint8(f+E);for(let S=1;S<v;S++)w=w<<8|e.getUint8(f+E+S);h.tlv.push({tag:m,length:v,value:t?127^w>>1:127&w})}else if(m===uf.METADATA||m===uf.AUDIO_64_BIT_PTS){const w=new Uint8Array(v);for(let S=0;S<v;S++)w[S]=e.getUint8(f+E+S);h.tlv.push({tag:m,length:v,value:w})}f+=E+v}return h}const fI=new Map,mI=127,Lg=1e-10,uM=139/13,gI=new Map;function hM(e,t,r){const a="".concat(e,"-").concat(t,"-").concat(r);let c=0;return gI.has(a)?c=gI.get(a):(c=Math.log(function(h,f){const m=h-f;f<m&&(f=m);let v=1;for(let E=h,w=1;E>f;E--,w++)v=v*E/w;return v}(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(r)+r*e,gI.set(a,c)),c<Lg&&(c=Lg),c}function vH(e,t,r){const a=t.length,c=e.length/a;let d=!1;for(let h=0,f=0;h<a;h++){let m=0;for(let v=f+c;f<v;f++)e[f]>r&&m++;t[h]!==m&&(t[h]=m,d=!0)}return d}window.cache=gI;let Ude=0;class EH{constructor(t){be(this,"id",void 0),be(this,"immediates",[]),be(this,"lastNonSilence",-1),be(this,"immediateSpeechActivityScore",Lg),be(this,"lastLevelChangedTime",Date.now()),be(this,"levels",[]),be(this,"longs",[]),be(this,"longSpeechActivityScore",Lg),be(this,"mediums",[]),be(this,"mediumSpeechActivityScore",Lg),be(this,"minLevel",0),be(this,"nextMinLevel",0),be(this,"nextMinLevelWindowLength",0),be(this,"energyScore",0),this.id=t||"".concat(Ude++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,r=this.levels,a=this.minLevel+uM;let c=!1;for(let d=0;d<t.length;++d){let h=r[d];h<a&&(h=0);const f=Math.floor(h/uM);t[d]!==f&&(t[d]=f,c=!0)}return c}computeLongs(){return vH(this.mediums,this.longs,4)}computeMediums(){return vH(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=hM(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=hM(this.longs[0],10,47),this.longSpeechActivityScore>Lg&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=hM(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(jT(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,r){if(this.lastLevelChangedTime<=r){this.lastLevelChangedTime=r;let a=t;return t<0&&(a=0),t>mI&&(a=mI),this.levels.unshift(a),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(a),a>=this.minLevel+uM?a:a/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let r=Math.sqrt(this.minLevel*this.nextMinLevel);r<0?r=0:r>mI&&(r=mI),this.minLevel=r,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Vde{constructor(t){be(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const r=this.algorithm.runInDecisionMaker(this);r<=0?t=!0:setTimeout(this.execute.bind(this),r)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class pM{constructor(t,r,a){be(this,"isDominant",void 0),be(this,"energyRanking",void 0),be(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=r,this.energyScore=a}}class Fde extends br{constructor(t){super(),be(this,"dominantId",null),be(this,"lastDecisionTime",0),be(this,"lastLevelChangedTime",0),be(this,"lastLevelIdleTime",0),be(this,"relativeSpeechActivities",[]),be(this,"speakers",new Map),be(this,"enableSilence",!1),be(this,"timeoutToSilenceInterval",0),be(this,"decisionMaker",null),be(this,"loudest",[]),be(this,"numLoudestToTrack",3),be(this,"energyExpireTimeMs",250),be(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,r=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,r!=null&&(this.energyExpireTimeMs=r),a!=null&&(this.energyAlphaPct=a),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(r=>r.id===t)}levelChanged(t,r){const a=Date.now(),c=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<a&&(this.lastLevelChangedTime=a,this.maybeStartDecisionMaker());const d=c.levelChanged(r,a);return this.updateLoudestList(c,d,a)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(r=>{this.speakers.has(r.id)||this.speakers.set(r.id,r)})}removeSpeakers(t){t.forEach(r=>{this.speakers.delete(r.id)})}getOrCreateSpeaker(t){let r=this.speakers.get(t);return r||(r=new EH(t),this.speakers.set(t,r),this.maybeStartDecisionMaker()),r}updateLoudestList(t,r,a){const c=t.id===this.dominantId;if(r<0){let m=0;for(;m<this.loudest.length&&this.loudest[m]!==t;)++m;return new pM(c,m,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*r+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new pM(c,0,t.energyScore);const d=a-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const m=this.loudest[h];if(m.getLastLevelChangedTime()<d&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(m.id!==t.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let f=0;for(;f<this.loudest.length&&!(this.loudest[f].energyScore<t.energyScore);)++f;return f<this.numLoudestToTrack&&(this.loudest.splice(f,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new pM(c,f,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Vde(this),this.decisionMaker.execute())}makeDecision(t){let r=null,a=null;const c=this.speakers.size;let d=null;if(c===0)d=null;else if(c===1){var h;const f=Oa(h=this.speakers).call(h).next().value;this.enableSilence&&f&&(d=f.id,f.evaluateSpeechActivityScores(t),t-f.lastNonSilence>this.timeoutToSilenceInterval&&(d=null))}else{let f=this.dominantId==null?null:this.speakers.get(this.dominantId);if(f==null){const E=this.speakers.entries().next();E.value&&(d=E.value[0],f=E.value[1])}else d=f.id;f!=null&&f.evaluateSpeechActivityScores(t);const m=this.relativeSpeechActivities;let v=2;for(const E of this.speakers.entries()){const[w,S]=E;if(S===f)continue;S.evaluateSpeechActivityScores(t);for(let P=0;P<m.length;++P){const W=f==null?Lg:f.getSpeechActivityScore(P);m[P]=Math.log(S.getSpeechActivityScore(P)/W)}const R=m[0],j=m[1],D=m[2];R>3&&j>2&&D>0&&j>v&&(v=j,d=w)}this.enableSilence&&f!=null&&d===f.id&&t-f.lastNonSilence>this.timeoutToSilenceInterval&&(d=null)}d==null&&!this.enableSilence||d===this.dominantId||(r=this.dominantId,this.dominantId=d,a=this.dominantId),a==null&&!this.enableSilence||a===r||this.emit("ActiveSpeakerChanged",a)}_runInDecisionMaker(){const t=Date.now(),r=300-(t-this.lastLevelIdleTime);let a=0;r<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):a=r;let c=300-(t-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=t,this.makeDecision(t),c=300-(Date.now()-t)),c>0&&a>c&&(a=c),a}timeoutIdleLevels(t){const r=[];for(const c of Oa(a=this.speakers).call(a)){var a;const d=t-c.getLastLevelChangedTime();36e5<d&&(this.dominantId==null||c.id!==this.dominantId)?r.push(c.id):300<d&&c.levelTimedOut()}r.forEach(c=>this.speakers.delete(c))}}const qv=new Map;let bd=null,_I=null;const yH=3;let jg=[];const xd=new Map,vI=new Map;class Bde{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,r){be(this,"id",void 0),be(this,"track",void 0),be(this,"score",0),be(this,"active",!0),be(this,"muted",!1),be(this,"timer",0),be(this,"actives",0),be(this,"inactives",0),this.id=t,this.track=r,this.setActive(xd.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:r,inactives:a}=function(){const c=[],d=[];return Array.from(Oa(xd).call(xd)).forEach(h=>{h.active?c.push(h):d.push(h)}),{actives:c,inactives:d}}();if(r.length>3){let c;r.forEach(d=>{(!c||c.score>d.score)&&(c=d)}),c&&c.setActive(!1)}if(r.length<3&&a.length>0){let c;a.forEach(d=>{(!c||c.score<d.score)&&d.id!==this.id&&(c=d)}),c&&t&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=function(r){let a;return Array.from(Oa(xd).call(xd)).forEach(c=>{!c.active||c.id===r||c.samples<40||(!a||c.score<a.score)&&(a=c)}),a}(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=function(r){let a;return Array.from(Oa(xd).call(xd)).forEach(c=>{c.active||c.id===r||c.samples<40||(!a||c.score>a.score)&&(a=c)}),a}(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let EI;function bH(e){const t=xd.get(e);t&&(xd.delete(e),t.clearTimer())}const yI=new Map,zde=new Map,fM="video/h264",mM="video/h265";function xH(e,t,r){let a=new Uint8Array(e,t,r),c=[],d=0;for(;c.length<r;)d+3<r&&a[d]===0&&a[d+1]===0&&a[d+2]===3&&(a[d+3]===0||a[d+3]===1||a[d+3]===2||a[d+3]===3)?(c.push(a[d],a[d+1],a[d+3]),d+=4):(c.push(a[d]),d++);return new Uint8Array(c)}function wH(e){const t=e.length;let r=[],a=0;for(;a<t;)a+2<t&&e[a]===0&&e[a+1]===0&&(e[a+2]===0||e[a+2]===1||e[a+2]===2||e[a+2]===3)?(r.push(e[a],e[a+1],3,e[a+2]),a+=3):(r.push(e[a]),a++);return new Uint8Array(r)}function SH(e){if(e.length<5)return"";let t=-1;for(let c=0;c<e.length-3;c++){if(e[c]===0&&e[c+1]===0&&e[c+2]===1){t=c;break}if(c<e.length-4&&e[c]===0&&e[c+1]===0&&e[c+2]===0&&e[c+3]===1){t=c;break}}if(t===-1)return"";const r=t+(e[t+2]===0?4:3);if(r>=e.length)return"";const a=e[r];return 128&a?"":(a>>1&63)>=32||r+1<e.length&&!(248&e[r+1])?mM:(31&a)<=31?fM:""}const bI=new Map,Xx=new Map;(function(){const e=yn();Ps.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Ps.getStreamFromExtension=e.name===Tn.CHROME&&Number(e.version)>34,Ps.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let r=!1;try{t.addTransceiver("audio"),r=!0}catch{}return t.close(),r}(),Ps.supportMinBitrate=e.name===Tn.CHROME||e.name===Tn.EDGE,Ps.supportSetRtpSenderParameters=function(){const t=yn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!yu()||!(!Hs()&&!YN())||t.name===Tn.FIREFOX&&Number(t.version)>=64)}(),e.name===Tn.SAFARI&&(Number(e.version)>=14?Ps.supportDualStream=!0:Ps.supportDualStream=!1),Ps.webAudioMediaStreamDest=function(){const t=yn();return!(t.name===Tn.SAFARI&&Number(t.version)<12)}(),Ps.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Ps.supportWebGL=typeof WebGLRenderingContext<"u",Ps.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,yu()||(Ps.webAudioWithAEC=!0),Ps.supportShareAudio=function(){const t=yn();return(t.os===Os.WIN_10||t.os===Os.WIN_81||t.os===Os.WIN_7||t.os===Os.LINUX||t.os===Os.MAC_OS||t.os===Os.CHROMIUM_OS)&&t.name===Tn.CHROME&&Number(t.version)>=74}(),Ps.supportDataChannel=!!(Ed(76)||Ej(68)||mG(14)),Ps.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!dr()&&!!t&&t.prototype.setConfiguration instanceof Function}(),Ps.supportWebRTCEncodedTransform=Ed(87)||hG()||Ej(117),Ps.supportWebRTCInsertableStream=function(){const t=yn();return(t.name===Tn.CHROME||t.name===Tn.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Ps.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Ps.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,Ps.supportSuppressLocalAudioPlayback=cW(),Ps.supportRestrictOwnAudio=lW(),$N(()=>{Ps.supportDualStreamEncoding=function(){const t=yn();return!!z("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&z("CHROME_DUAL_STREAM_USE_ENCODING"))}(),I.debug("browser ua: ",navigator.userAgent),I.info("browser info: ",e),I.info("browser compatibility: ",Ps)})})();const Gde=["CHINA","GLOBAL"],TH=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Mg=[],Yv=[];function Ug(e,t){return!!t&&Mg.some(r=>r.uid===e&&r.channelName===t)}function gM(){return Yv.length>0}var Wde=O8.forEach,RH=vh("forEach")?[].forEach:function(e){return Wde(this,e,arguments.length>1?arguments[1]:void 0)};vn({target:"Array",proto:!0,forced:[].forEach!==RH},{forEach:RH});var Hde=So("Array","forEach"),Kde=tu,qde=Ns,Yde=M,Xde=Hde,_M=Array.prototype,$de={DOMTokenList:!0,NodeList:!0},Jde=function(e){var t=e.forEach;return e===_M||Yde(_M,e)&&t===_M.forEach||qde($de,Kde(e))?Xde:t},Qde=u(Jde),Zde=Wo,CH=_0;vn({target:"Object",stat:!0,forced:p(function(){CH(1)})},{keys:function(e){return CH(Zde(e))}});var eue=u(qt.Object.keys),tue=u(DT),nue=u(Xy),rue=vn,NH=nu,sue=G0,iue=Gr,IH=Oe,aue=Vn,oue=Oi,cue=X2,lue=Nr,due=hu,uue=x8("slice"),hue=lue("species"),vM=Array,pue=Math.max;rue({target:"Array",proto:!0,forced:!uue},{slice:function(e,t){var r,a,c,d=oue(this),h=aue(d),f=IH(e,h),m=IH(t===void 0?h:t,h);if(NH(d)&&(r=d.constructor,(sue(r)&&(r===vM||NH(r.prototype))||iue(r)&&(r=r[hue])===null)&&(r=void 0),r===vM||r===void 0))return due(d,f,m);for(a=new(r===void 0?vM:r)(pue(m-f,0)),c=0;f<m;f++,c++)f in d&&cue(a,c,d[f]);return a.length=c,a}});var fue=So("Array","slice"),mue=M,gue=fue,EM=Array.prototype,_ue=function(e){var t=e.slice;return e===EM||mue(EM,e)&&t===EM.slice?gue:t},vue=u(_ue);function Fe(e,t,r,a,c){var d,h,f,m={};return Qde(d=eue(a)).call(d,function(v){m[v]=a[v]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=tue(h=nue(f=vue(r).call(r)).call(f)).call(h,function(v,E){return E(e,t,v)||v},m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0?(v8(e,t,m),null):m}let xI=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),yM=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),Lc=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e[e.REQ_DOWNGRADE_FALLBACK=27]="REQ_DOWNGRADE_FALLBACK",e}({}),_a=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),pt=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.K_VOS_FALLBACK=30]="K_VOS_FALLBACK",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),rn=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),rt=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e.VOS_FALLBACK="vos_fallback",e.VOS_FALLBACK_PROMISE="vos_fallback_promise",e}({}),lt=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SET_DUAL_STREAM_MODE="set_dual_stream_mode",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.CONFIGURE="configure",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e}({}),Vg=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),Rt=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e.ENABLE_MULTI_STREAM="enable_multi_stream",e}({}),va=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),Lt=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e.ON_FALLBACK="websocket:on_fallback",e}({});function wI(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw I.error("Invalid Channel Name ".concat(e)),new Ee(K.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function SI(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||SG(e,1,255)))throw new Ee(K.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&I.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Oh=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const Eue={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},bM={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function xM(e,t){ri(e.url,"".concat(t,".url"),1,1e3,!1),Lr(e.x)||Xn(e.x,"".concat(t,".x"),0,1e4),Lr(e.y)||Xn(e.y,"".concat(t,".y"),0,1e4),Lr(e.width)||Xn(e.width,"".concat(t,".width"),0,1e4),Lr(e.height)||Xn(e.height,"".concat(t,".height"),0,1e4),Lr(e.zOrder)||Xn(e.zOrder,"".concat(t,".zOrder"),0,255),Lr(e.alpha)||Xn(e.alpha,"".concat(t,".alpha"),0,1,!1)}const yue={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let hf=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),wM=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),xs=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function AH(e){if(!e.channelName)throw new Ee(K.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new Ee(K.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&ri(e.token,"info.token",1,2047),SI(e.uid),wI(e.channelName),!0}let Ma=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Dh=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),oo=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),Xv=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),Un=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),rs=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e.VOS_FALLBACK="vos-fallback",e.VOS_FALLBACK_PROMISE="vos-fallback-promise",e.RESET_SIGNAL="reset-signal",e.DATACHANNEL_FAILBACK="datachannel-failback",e}({}),TI=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Ls=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),Nn=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const kH=[Nn.AFRICA,Nn.ASIA,Nn.CHINA,Nn.EUROPE,Nn.GLOBAL,Nn.INDIA,Nn.JAPAN,Nn.NORTH_AMERICA,Nn.OCEANIA,Nn.OVERSEA,Nn.SOUTH_AMERICA];let Ni=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const RI={CHINA:{},ASIA:{CODE:Ni.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Ni.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Ni.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Ni.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Ni.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Ni.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Ni.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Ni.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Ni.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Ni.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Ni.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Ni.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Ni.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};Vj&&(RI.CHINA={CODE:Ni.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let wd=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e.UPDATE_REMOTE_VIDEO_STREAM_TYPE="update_remote_video_stream_type",e.FALLBACK_TO_HLS="fallback_to_hls",e.UPDATE_VOS_CONFIGURE="update_vos_configure",e}({});function OH(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class DH extends br{constructor(t,r){super(),L(this,"onICEConnectionStateChange",void 0),L(this,"onConnectionStateChange",void 0),L(this,"onDTLSTransportStateChange",void 0),L(this,"onDTLSTransportError",void 0),L(this,"onICETransportStateChange",void 0),L(this,"onFirstAudioReceived",void 0),L(this,"onFirstVideoReceived",void 0),L(this,"onFirstAudioDecoded",void 0),L(this,"onFirstVideoDecoded",void 0),L(this,"onFirstVideoRender",void 0),L(this,"onFirstVideoBufferReady",void 0),L(this,"onFirstVideoDecodedTimeout",void 0),L(this,"onSelectedLocalCandidateChanged",void 0),L(this,"onSelectedRemoteCandidateChanged",void 0),L(this,"onICECandidateError",void 0),L(this,"getLocalVideoStats",void 0)}}class CI extends DH{constructor(t,r){super(t,r),L(this,"establishPromise",void 0)}}let Je=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),qs=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),Ph=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const PH=["disconnected","failed"];let De=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),An=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),dt=function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e.FirstVideoPreRender="FirstVideoPreRender",e.FirstVideoBufferReady="FirstVideoBufferReady",e}({}),Al=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),kl=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Ys=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),pf=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),ws=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),Su=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),jc=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Sd=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),$v=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),ss=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),Jv=function(e){return e.ABORT="abort",e}({}),ff=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),bue=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const xue={[xI.ACCESS_POINT]:{[_a.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[_a.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[_a.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[_a.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[_a.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[_a.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[_a.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[_a.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[_a.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[_a.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[_a.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[_a.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[_a.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[_a.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[_a.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[_a.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[_a.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[_a.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[xI.UNILBS]:{[Lc.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Lc.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Lc.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Lc.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Lc.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Lc.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Lc.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Lc.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Lc.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Lc.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Lc.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Lc.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1},[Lc.REQ_DOWNGRADE_FALLBACK]:{desc:"request downgrade fallback",retry:!1}},[xI.STRING_UID_ALLOCATOR]:{[yM.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[yM.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[yM.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Qv(e){const t=xue[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const r=t[e%1e4];if(!r){if(Math.floor(e/1e4)===xI.ACCESS_POINT){const a=e%1e4;if(a.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(a.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return r}const wue={[pt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[pt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[pt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[pt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[pt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[pt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[pt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[pt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[pt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[pt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[pt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[pt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[pt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[pt.K_VOS_FALLBACK]:{desc:"K_VOS_FALLBACK",action:"tryNext"},[pt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[pt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[pt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[pt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[pt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[pt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[pt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[pt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[pt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[pt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[pt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[pt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[pt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[pt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[pt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[pt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[pt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[pt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[pt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[pt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[pt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[pt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[pt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[pt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[pt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[pt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[pt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[pt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[pt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[pt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[pt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[pt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[pt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[pt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[pt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[pt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[pt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[pt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[pt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[pt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[pt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[pt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[pt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[pt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[pt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[pt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[pt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[pt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[pt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[pt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[pt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Fg(e){return wue[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function LH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function SM(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?LH(Object(r),!0).forEach(function(a){L(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):LH(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}function TM(e,t){if(typeof e=="string")return e;const{proxy:r,host:a,port:c}=e;if(t){const d=z("JOIN_GATEWAY_FALLBACK_PORT")||443;return d===443?"wss://".concat(a,"/ws/?p=").concat(Number(c)+150):"wss://".concat(a,":").concat(d,"/ws/?p=").concat(Number(c)+150)}return r?"wss://".concat(r,"/ws/?h=").concat(a,"&p=").concat(c):"wss://".concat(a,":").concat(c)}const Sue=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Tue=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Rue=/wss:\/\/(.+):([0-9]+)\/?/,Cue=/wss:\/\/(.[^\/]+)\/?/;let Nue=0;class Iue{constructor(t,r){L(this,"id",0),L(this,"store",void 0),L(this,"recordIndex",void 0),L(this,"websockets",[]),L(this,"try443PortDuration",2e3),L(this,"forceCloseWSDuration",5e3),L(this,"try443PortTimeout",null),L(this,"forceCloseTimeout",null),L(this,"isTry443PortFailed",!1),L(this,"isNormalPortFailed",!1),L(this,"useDoubleDomain",!1),L(this,"useProxy",!1),L(this,"startTime",Date.now()),this.id=++Nue,this.try443PortDuration=z("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=r}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const r=Date.now()-this.startTime;for(var a=arguments.length,c=new Array(a),d=0;d<a;d++)c[d]=arguments[d];I.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(r,"ms:"),...c)}createWebSocket(t,r,a){this.logger("createWebSocket:",t,{isTry443Port:r,hasTimeoutDetection:a});const c=z("GATEWAY_DOMAINS"),d=Date.now(),h=[],f=c.find(S=>{var R;return ke(R=t.host).call(R,S)});f||(this.useDoubleDomain=!1);const m=[];if(this.useDoubleDomain)c.forEach(S=>{m.push(TM(SM(SM({},t),{},{host:t.host.replace(f,S)}),r))});else{const S=SM({},t);if(r&&f){const R=c.find(j=>j!==f);R&&(S.host=S.host.replace(f,R))}m.push(TM(S,r))}try{m.forEach(S=>{const R=new WebSocket(S);R.binaryType="arraybuffer",h.push(R),this.logger("ws is connecting:",R.url)})}catch(S){if(this.logger("ws create failed"),h.forEach(R=>R.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,r,a);if(!r&&Number(t.port)!==443)return this.createWebSocket(t,!0,a);throw new Ee(K.WS_ERR,"init websocket failed! Error: ".concat(S.toString()))}const v=Mx();this.store&&this.store.recordJoinChannelService({urls:h.map(S=>S.url),service:"gateway"},this.recordIndex),h.forEach(S=>{S.onopen=()=>{this.logger("onopen: ws ".concat(S.url," open cost ").concat(Date.now()-d,"ms")),this.websockets.forEach(R=>{R!==S&&(R.onopen=null,R.onclose=null,R.onmessage=null,R.close(),this.logger("close backup websocket: ".concat(R.url)))}),this.websockets.length=0,v.resolve(S)},S.onclose=R=>{this.logger("onclose: ws ".concat(S.url," closed cost ").concat(Date.now()-d,"ms state: ").concat(S.readyState));const j=h.every(D=>D.readyState===WebSocket.CLOSED||D.readyState===WebSocket.CLOSING);this.logger("".concat(r?"443":"47xx"," websocket closed, all failed: ").concat(j)),j&&(r||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(R.reason)),v.reject({code:R.code,reason:TI.A_ROUND_WS_FAILED})):!r&&j&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),w()),r?this.isTry443PortFailed=j:this.isNormalPortFailed=j},S.onmessage=R=>this.logger("".concat(S.url," onmessage: ").concat(R.data))}),this.websockets.push(...h);const E=()=>{this.websockets.forEach(S=>S.readyState!==WebSocket.OPEN&&S.close())},w=()=>{if(v.isResolved)return E();yn().os===Os.MAC_OS&&dr()&&E(),this.createWebSocket(t,!0,!0).then(S=>{v.resolve(S)}).catch(S=>{this.isNormalPortFailed&&v.reject(S),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",v.isResolved),this.forceCloseTimeout=null,E()},this.forceCloseWSDuration)};return a||(()=>{if(r||this.useProxy)return this.logger("add 5s timeout at ".concat(r?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,E()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",v.isResolved),this.try443PortTimeout=null,w()},this.try443PortDuration)})(),v.promise}chooseBestWebsocket(t,r,a,c){return this.useDoubleDomain=!!r,typeof t=="string"&&(t=function(d){let h,f,m;return[,h,f,m]=d.match(Sue)||[],h||([,f,m]=d.match(Tue)||[]),f&&m||([,f,m]=d.match(Rue)||[]),f&&m||([,f]=d.match(Cue)||[]),f||I.warning("un-destructible url: ",d),{proxy:h,host:f,port:m||"443"}}(t)),this.recordIndex=c,this.useProxy=!!t.proxy,a&&this.useProxy&&(I.warn("cannot use 443 only when use proxy"),a=!1),this.createWebSocket(t,!!a,!1).finally(()=>this.clearTimeout())}}function jH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}class MH extends br{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var r;ke(r=["tryNext","recover"]).call(r,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Lt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Lt.CONNECTED):this._state==="closed"?this.emit(Lt.CLOSED):this._state==="failed"&&this.emit(Lt.FAILED))}resetReconnectCount(t){I.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,r){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],d=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),L(this,"_websocketUrl",null),L(this,"connectionID",0),L(this,"currentURLIndex",0),L(this,"urls",[]),L(this,"_reconnectMode","tryNext"),L(this,"reconnectReason",void 0),L(this,"_initMutex",void 0),L(this,"name",void 0),L(this,"_state","closed"),L(this,"reconnectInterrupter",void 0),L(this,"websocket",void 0),L(this,"retryConfig",void 0),L(this,"reconnectCount",0),L(this,"forceCloseTimeout",5e3),L(this,"onlineReconnectListener",void 0),L(this,"useCompress",void 0),L(this,"tryDoubleDomain",!1),L(this,"use443PortOnly",!1),L(this,"wsInflateLength",0),L(this,"wsDeflateLength",0),L(this,"closeEstablishingWs",()=>{}),L(this,"store",void 0),L(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=t,this.retryConfig=function(w){for(var S=1;S<arguments.length;S++){var R=arguments[S]!=null?arguments[S]:{};S%2?jH(Object(R),!0).forEach(function(j){L(w,j,R[j])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(R)):jH(Object(R)).forEach(function(j){Object.defineProperty(w,j,Object.getOwnPropertyDescriptor(R,j))})}return w}({},r),this.useCompress=a,this.tryDoubleDomain=c,this.use443PortOnly=d,this._initMutex=new Ks("websocket",h?h.clientId:void 0);const{timeout:f,timeoutFactor:m}=r,v=Math.max(300,Math.floor(3*f/5)),E=Math.max(1.2,Math.floor(8*m)/10);fa.ONLINE&&(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=E),jr.on(Sg.NETWORK_STATE_CHANGE,(w,S)=>{w!==S&&(this.resetReconnectCount("network state change: ".concat(S," -> ").concat(w)),w===fa.ONLINE?(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=E):(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=m))})}getConnection(){return this.websocket||void 0}async init(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const a=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=r,this.urls=t,this.state="connecting";try{var c;const d=Mx(),h=this.urls[this.currentURLIndex];(c=this.store)===null||c===void 0||c.beforeConnect(),function(f){return!(iI()||z("USE_NEW_TOKEN")||!z("ENABLE_PREALLOC_PC")&&(f==null||!f.autoSubscribe||z("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(ws.PRE_CONNECT_PC),this.createWebSocketConnection(h).then(d.resolve).catch(d.reject),this.once(Lt.CLOSED,()=>{d.reject(new we(K.WS_DISCONNECT))}),this.once(Lt.CONNECTED,d.resolve),await d.promise}catch{}finally{a()}}close(t,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const a=this.websocket;r?setTimeout(()=>a.close(),500):a.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,r){if(!this.websocket)return void I.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),I.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(r)]},this.joinGatewayRecordIndex);const a=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),a&&a.bind(this.websocket)({code:9999,reason:r})}sendMessage(t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new we(K.WS_ABORT,"websocket is not ready");try{r||(t=JSON.stringify(t)),this.websocket.send(t)}catch(a){throw new we(K.WS_ERR,"send websocket message error"+a.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,r=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:r}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var r;const a=Mx();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=E=>{var w;(w=this.store)===null||w===void 0||w.signalChannelOpen(),I.debug("[".concat(this.name,"] websocket opened:"),E),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),a.resolve()},d=async E=>{var w;if(I.debug("[".concat(this.name,"] websocket close ").concat((w=this.websocket)===null||w===void 0?void 0:w.url,", code: ").concat(E.code,", reason: ").concat(E.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)a.reject(new we(K.WS_DISCONNECT,"websocket close: ".concat(E.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=E.reason,this.state="reconnecting");const S=Oo(this,Lt.WILL_RECONNECT,this.reconnectMode,E.reason)||this.reconnectMode,R=await this.reconnectWithAction(S);if(this.state==="closed")return void I.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!R)return a.reject(new we(K.WS_DISCONNECT,"websocket reconnect failed: ".concat(E.code))),this.close(!0);a.resolve()}},h=E=>{this.emit(Lt.ON_MESSAGE,E)},f=E=>{I.warn("[".concat(this.connectionID,"] ws open error ").concat(E))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),z("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=z("GATEWAY_WSS_ADDRESS")),I.debug("[".concat(this.name,"] start connect, url:"),t);const m=(r=this.store)===null||r===void 0?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var v;this._websocketUrl=TM(t);const E=await this.chooseBestWebsocketConnection(t);this.websocket=E,c&&c(this.websocket.url),this.websocket.onclose=d,this.websocket.onmessage=h,this.websocket.onerror=f,(v=this.store)===null||v===void 0||v.recordJoinChannelService({endTs:Date.now(),status:"success"},m),this.joinGatewayRecordIndex=m}catch(E){const w=this.state==="closed",S=E instanceof we,R=S&&E.code===K.WS_ABORT,j=S&&E.code===K.WS_ERR,D=S?E.message:E&&(E.reason||E.toString());I.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(D)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:R?"aborted":"error",errors:[E]},m),w||j?(a.reject(w?new we(K.WS_DISCONNECT,"websocket is closed: ".concat(D)):new we(K.WS_ERR,"init websocket failed: ".concat(D))),j&&I.error("[".concat(this.name,"] init websocket failed: ").concat(D))):d&&d(E)}return a.promise}async reconnectWithAction(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;I.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||jr.isOnline||!jr.onlineWaiter||(this.onlineReconnectListener=jr.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let a=!0;if(this.reconnectInterrupter=()=>a=!1,r){const h=JN(this.reconnectCount,this.retryConfig);I.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(t)),await Ue.race([Ds(h),this.onlineReconnectListener||new Ue(()=>{})])}if(this._state==="closed"||!a)return!1;this.reconnectCount+=1;const c=async(h,f)=>{this.emit(Lt.RECONNECT_CREATE_CONNECTION,f),await this.createWebSocketConnection(h)};try{if(t==="retry")await c(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);I.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],t)}else t==="recover"&&(I.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await _s(this,Lt.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],t))}catch(h){var d;I.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const f=h==null||(d=h.data)===null||d===void 0?void 0:d.desc;if(Array.isArray(f)){if(ke(f).call(f,"dynamic key expired"))return this.emit(Lt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1;if(ke(f).call(f,"request downgrade fallback"))return this.emit(Lt.ON_FALLBACK),!1}return this.reconnectWithAction(t,r)}return!0}}class RM extends MH{constructor(t,r){super(t,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,r){const a=Mx(),c=function(h,f){return new Iue(h,f)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{I.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),a.reject(new we(K.WS_ABORT,"choose best websocket aborted"))};const d=z("GATEWAY_DOMAINS");return I.debug("[choose-best-ws] currentDomain: ",t,", domains: ",d,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,r).then(a.resolve).catch(a.reject),a.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class $x extends MH{constructor(t,r){super(t,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,r){return new Ue((a,c)=>{let d=!1;const h=[];this.closeEstablishingWs=()=>{I.debug("[choose-best-ws] close establishing websockets"),h.forEach(j=>{j.onclose=null,j.onopen=null,j.onmessage=null,j.close()}),c(new we(K.WS_ABORT,"choose best websocket aborted"))};const f=z("GATEWAY_DOMAINS");let m;const v=t.indexOf("?h="),E=f.find(j=>v!==-1?ke(t).call(t,j,v):ke(t).call(t,j));I.debug("[choose-best-ws] currentDomain: ",E,", domains: ",f);let w=!this.tryDoubleDomain||!E;if(!w&&E){var S;const j=Date.now();try{f.forEach(D=>{const P=v===-1?t.replace(E,D):t.substr(0,v)+t.substr(v).replace(E,D),W=new WebSocket(P);W.binaryType="arraybuffer",h.push(W),I.debug("[choose-best-ws] ws is connecting:",W.url)})}catch{for(I.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(P=>P.close());h.length;)h.pop();w=!0}(S=this.store)===null||S===void 0||S.recordJoinChannelService({urls:h.map(D=>D.url),service:"gateway"},r),h.forEach(D=>{D.onopen=()=>{if(d)return;const P=Date.now()-j;I.debug("[choose-best-ws] ws open cost ".concat(P,"ms")),h.filter(W=>W!==D).forEach(W=>{I.debug("[choose-best-ws]close backup websocket: ".concat(W.url)),W.close()}),d=!0,a(D)},D.onclose=P=>{m=P,!d&&(h.find(W=>!(W.readyState===WebSocket.CLOSED||W.readyState===WebSocket.CLOSING))||(I.debug("[choose-best-ws] all websocket is closed"),d=!0,c(m)))},D.onmessage=P=>{I.debug("[choose-best-ws]".concat(D.url," onmessage: ").concat(P.data))}}),Ds(this.forceCloseTimeout).then(()=>{h.forEach(D=>{D.readyState!==WebSocket.OPEN&&D.close()})})}if(w){var R;let j;I.debug("[choose-best-ws] use single url: ",t),(R=this.store)===null||R===void 0||R.recordJoinChannelService({urls:[t],service:"gateway"},r);try{j=new WebSocket(t),h.push(j),j.binaryType="arraybuffer"}catch(D){const P=new we(K.WS_ERR,"init websocket failed! Error: ".concat(D.toString()));return I.error("[".concat(this.name,"]").concat(P)),void c(P)}j.onopen=()=>{a(j)},j.onclose=D=>{c(D)},j.onmessage=D=>{I.debug("[choose-best-ws]".concat(j.url," onmessage: ").concat(D.data))},Ds(this.forceCloseTimeout).then(()=>{j&&j.readyState!==WebSocket.OPEN&&j.close()})}}).then(a=>(this.closeEstablishingWs=void 0,a)).catch(a=>{throw this.closeEstablishingWs=void 0,a})}}class UH extends br{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===rn.CONNECTED?this.emit(rt.WS_CONNECTED):t===rn.RECONNECTING?this.emit(rt.WS_RECONNECTING,this._websocketReconnectReason):t===rn.CLOSED&&this.emit(rt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,r){super(),L(this,"__name__","AgoraRTCSignal"),L(this,"_disconnectedReason",void 0),L(this,"_websocketReconnectReason",void 0),L(this,"_connectionState",rn.CLOSED),L(this,"reconnectToken",void 0),L(this,"websocket",void 0),L(this,"openConnectionTime",void 0),L(this,"clientId",void 0),L(this,"lastMsgTime",Date.now()),L(this,"uploadCache",[]),L(this,"uploadCacheInterval",void 0),L(this,"rttRolling",new Oj(5)),L(this,"pingpongTimer",void 0),L(this,"wsInflateDataTimer",void 0),L(this,"pingpongTimeoutCount",0),L(this,"ortc",void 0),L(this,"joinResponse",void 0),L(this,"multiIpOption",void 0),L(this,"initError",void 0),L(this,"spec",void 0),L(this,"store",void 0),L(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(rt.ON_BINARY_DATA,a.data);const c=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===Rt.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===Rt.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(nn.UID_BANNED);break;case 15:this.close(nn.IP_BANNED);break;case 16:this.close(nn.CHANNEL_BANNED)}if(c._type===Rt.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case pt.ERR_LICENSE_MISSING:this.close(nn.LICENSE_MISSING);break;case pt.ERR_LICENSE_EXPIRED:this.close(nn.LICENSE_EXPIRED);break;case pt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(nn.LICENSE_MINUTES_EXCEEDED);break;case pt.ERR_LICENSE_PERIOD_INVALID:this.close(nn.LICENSE_PERIOD_INVALID);break;case pt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(nn.LICENSE_MULTIPLE_SDK_SERVICE);break;case pt.ERR_LICENSE_ILLEGAL:this.close(nn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=r,this.websocket=new RM("gateway-".concat(this.clientId),this.spec.retryConfig,!0,z("JOIN_GATEWAY_USE_DUAL_DOMAIN"),z("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===rn.CONNECTED&&this.reconnect("retry",fi.OFFLINE)})}async request(t,r,a,c){const d=jn(6,""),h={_id:d,_type:t,_message:r},f=this.websocket.connectionID,m=()=>new Ue((j,D)=>{if(this.connectionState===rn.CONNECTED)return j();const P=()=>{this.off(rt.WS_CLOSED,W),j()},W=()=>{this.off(rt.WS_CONNECTED,P),D(new Ee(K.WS_ABORT))};this.once(rt.WS_CONNECTED,P),this.once(rt.WS_CLOSED,W),t!==lt.PUBLISH&&t!==lt.PUBLISH_DATASTREAM&&t!==lt.SUBSCRIBE&&t!==lt.SUBSCRIBE_DATASTREAM&&t!==lt.UNSUBSCRIBE&&t!==lt.UNSUBSCRIBE_DATASTREAM&&t!==lt.UNPUBLISH&&t!==lt.UNPUBLISH_DATASTREAM&&t!==lt.CONTROL&&t!==lt.RESTART_ICE||this.once(rt.DISCONNECT_P2P,()=>{D(new Ee(K.DISCONNECT_P2P))}),t!==lt.PUBLISH&&t!==lt.RESTART_ICE||this.once(rt.ABORT_P2P_EXECUTION,()=>{D(new Ee(K.DISCONNECT_P2P))})});if(this.connectionState!==rn.CONNECTING&&this.connectionState!==rn.RECONNECTING||t===lt.JOIN||t===lt.REJOIN||await m(),this.websocket.sendMessage(h,!0),c)return;const v=new Ue((j,D)=>{let P=!1;const W=(ne,le)=>{P=!0,j({isSuccess:ne==="success",message:le||{}}),this.off(rt.WS_CLOSED,Y),this.off(rt.WS_RECONNECTING,Y),this.emit(rt.REQUEST_SUCCESS,t,r)};this.once("res-@".concat(d),W);const Y=()=>{D(new Ee(K.WS_ABORT,"type: ".concat(t))),this.off(rt.WS_CLOSED,Y),this.off(rt.WS_RECONNECTING,Y),this.off("res-@".concat(d),W)};this.once(rt.WS_CLOSED,Y),this.once(rt.WS_RECONNECTING,Y),Ds(z("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==f||P||(I.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(rt.REQUEST_TIMEOUT,t,r))})});let E=null;try{E=await v}catch(j){if(this.connectionState===rn.CLOSED||t===lt.LEAVE)throw new Ee(K.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?j.throw():t===lt.JOIN||t===lt.REJOIN?null:(await m(),await this.request(t,r))}if(E.isSuccess)return E.message;const w=Number(E.message.error_code||E.message.code),S=Fg(w),R=new Ee(K.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(E.message.error_str),{code:w,data:E.message,desc:S.desc});return S.action==="success"?E.message:(I.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(w,", message: ").concat(S.desc,", action: ").concat(S.action)),w===pt.ERR_TOO_MANY_BROADCASTERS?((t===lt.JOIN||t===lt.REJOIN)&&(this.initError=R,this.close()),R.throw()):S.action==="failed"?R.throw():S.action==="quit"?(this.initError=R,this.close(),R.throw()):(w===pt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=E.message.option,I.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",fi.MULTI_IP)):this.reconnect(S.action,fi.SERVER_ERROR),t===lt.JOIN||t===lt.REJOIN?null:await this.request(t,r)))}waitMessage(t,r){return new Ue(a=>{const c=d=>{(!r||r(d))&&(this.off(t,c),a(d))};this.on(t,c)})}uploadWRTCStats(t){if(!this.store.sessionId)return void I.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Vg.WRTC_STATS,r)}upload(t,r){const a={_type:t,_message:r};try{this.websocket.sendMessage(a)}catch{const d=z("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==rn.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},z("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,r){const a={_type:t,_message:r};this.websocket.sendMessage(a)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Ue((r,a)=>{this.once(rt.WS_CONNECTED,()=>r(this.joinResponse)),this.once(rt.WS_CLOSED,c=>a(this.initError||new Ee(K.WS_ABORT,c))),this.connectionState=rn.CONNECTING,this.websocket.init(t).catch(a),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||nn.LEAVE,this.connectionState=rn.CLOSED,I.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(rt.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await _s(this,rt.REQUEST_JOIN_INFO);this.store.joinReq();const r=await this.request(lt.JOIN,t);if(this.ortc=t==null?void 0:t.ortc,this.store.joinRep(),!r)return this.emit(rt.REPORT_JOIN_GATEWAY,TI.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(rt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=rn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Ee(K.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=Tg(this,rt.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const r=await this.request(lt.REJOIN,t);return!!r&&(this.connectionState=rn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),r.peers&&r.peers.forEach(a=>{this.emit(Rt.ON_USER_ONLINE,{uid:a.uid}),a.audio&&this.emit(Rt.ON_ADD_AUDIO_STREAM,{uid:a.uid,uint_id:a.uint_id,audio:!0,ssrcId:a.audio_ssrc}),a.video&&this.emit(Rt.ON_ADD_VIDEO_STREAM,{uid:a.uid,uint_id:a.uint_id,video:!0,ssrcId:a.video_ssrc}),a.audio_mute?this.emit(Rt.MUTE_AUDIO,{uid:a.uid}):this.emit(Rt.UNMUTE_AUDIO,{uid:a.uid}),a.video_mute?this.emit(Rt.MUTE_VIDEO,{uid:a.uid}):this.emit(Rt.UNMUTE_VIDEO,{uid:a.uid}),a.audio_enable_local?this.emit(Rt.ENABLE_LOCAL_AUDIO,{uid:a.uid}):this.emit(Rt.DISABLE_LOCAL_AUDIO,{uid:a.uid}),a.video_enable_local?this.emit(Rt.ENABLE_LOCAL_VIDEO,{uid:a.uid}):this.emit(Rt.DISABLE_LOCAL_VIDEO,{uid:a.uid}),a.audio||a.video||this.emit(Rt.ON_REMOVE_STREAM,{uid:a.uid,uint_id:a.uint_id})}),!0)}reconnect(t,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,r)}async downgradeCodec(t){if(!this.ortc)return!1;const r={downgrade_codec:t,ortc:this.ortc};return!!await this.request(lt.DOWNGRADE_CODEC,r)}handleNotification(t){I.debug("[".concat(this.clientId,"] receive notification: "),t);const r=Fg(t.code);if(t.code===28&&"detail"in t&&(I.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(rt.RECOVER_NOTIFICATION,t.detail)),r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?t.code===pt.ERR_REPEAT_JOIN_CHANNEL&&z("IGNORE_UID_CHECK")?void this.close(nn.UID_CONFLICT):(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(nn.UID_BANNED),void this.close()):t.code===pt.K_VOS_FALLBACK&&"detail"in t?(I.info("[".concat(this.clientId,"] receive vos fallback notification: "),t.detail),t.detail==="FALLBACKCN"&&z("ENABLE_QUALITY_FALLBACK")?void _s(this,rt.VOS_FALLBACK_PROMISE,t.detail).then(()=>{this.reconnect("recover",r.desc)}).catch(a=>{I.debug("[".concat(this.clientId,"] cancel vos fallback cn, error: "),a)}):t.detail==="fallback_hls"&&z("ENABLE_FALLBACK_TO_HLS")?(this.emit(rt.VOS_FALLBACK,t.detail),void this.close(nn.FALLBACK_TO_HLS)):this.reconnect(r.action,r.desc)):void this.reconnect(r.action,fi.SERVER_ERROR);I.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=z("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=t&&(I.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>z("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",fi.TIMEOUT):this.request(lt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-r;this.rttRolling.add(a),z("REPORT_STATS")&&this.send(lt.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:r}=this.websocket.getWsInflateData();t!==0&&r!==0&&this.upload(Vg.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Lt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(rt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Lt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Lt.CLOSED,()=>{this.connectionState=rn.CLOSED}),this.websocket.on(Lt.FAILED,()=>{this._disconnectedReason=nn.NETWORK_ERROR,this.connectionState=rn.CLOSED}),this.websocket.on(Lt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===rn.CONNECTED?this.connectionState=rn.RECONNECTING:this.connectionState=rn.CONNECTING}),this.websocket.on(Lt.WILL_RECONNECT,(t,r,a)=>{const c=Tg(this,rt.IS_P2P_DISCONNECTED),d=c||t!=="retry";c&&t==="retry"&&(I.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",r=TI.P2P_DISCONNECTED),d&&(I.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(rt.REPORT_JOIN_GATEWAY,r||TI.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(rt.DISCONNECT_P2P)),a(t)}),this.websocket.on(Lt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{I.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",fi.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(rt.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof Ee){if(t.code===K.UNEXPECTED_RESPONSE&&t.data.code===pt.ERR_NO_AUTHORIZED)return this.initError=new Ee(K.TOKEN_EXPIRE,"dynamic key expired"),void this.close(nn.TOKEN_EXPIRE);I.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",fi.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(Lt.REQUEST_NEW_URLS,(t,r)=>{_s(this,rt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(r)}),this.websocket.on(Lt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Rt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(ws.PRE_CONNECT_PC,()=>{this.emit(rt.PRE_CONNECT_PC)}),this.websocket.on(Lt.ON_FALLBACK,()=>{z("ENABLE_FALLBACK_TO_HLS")&&this.emit(rt.VOS_FALLBACK,"fallback_hls")})}}let Aue=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),ds=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function VH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function NI(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?VH(Object(r),!0).forEach(function(a){L(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):VH(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}let CM=0;function Ol(e){const t=z("TURN_DOMAINS");CM=(CM+1)%t.length;const r=t[CM]||"edge.agora.io";return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(r):(I.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function II(e){try{const t=z("TURN_DOMAINS"),r=z("GATEWAY_DOMAINS").concat(t).find(a=>ke(e).call(e,a));return r?e.split(".".concat(r))[0].replace(/-/g,"."):e}catch{return I.debug("serverUrlToIp error, fallback to url",e),e}}function NM(e,t){e.addresses||(e.addresses=[]);const r=function(f,m){if(z("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return f.map(w=>{let{ip:S,port:R}=w;return{address:"".concat(S,":").concat(R)}});const v=z("GATEWAY_DOMAINS");let E=v[1]&&ke(m).call(m,v[1])?1:0;return f.map(w=>{let{domain_prefix:S,port:R,ip:j}=w;if(S)return{address:"".concat(S,".").concat(v[E++%v.length],":").concat(R)};const D=/^[\.\:\d]+$/.test(j),P=D?"".concat(j.replace(/[^\d]/g,"-"),".").concat(v[E++%v.length],":").concat(R):"".concat(j,":").concat(R);return D||I.debug("Cannot recognized as ip address: ".concat(j,", use as host3")),{ip:j,port:R,address:P}})}(e.addresses,t),a=Array.isArray(e.detail)&&e.detail[18];if(a&&typeof a=="string"){const f=a.split(";");for(let m=0;m<f.length;m++){var c;const v=ha(c=f[m]).call(c);r[m]&&v&&(r[m].ip6=v)}}const d=e.detail&&e.detail.candidate;let h;if(d){const[f,m]=d.split(":");f&&m&&(h={port:Number(m),ip:f,address:"".concat(f,":").concat(m)})}return{gatewayAddrs:r,apGatewayAddress:h,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Ua(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function FH(e){const t=e._encoderConfig;if(!t)return{};const r={resolution:t.width&&t.height?"".concat(Ua(t.width),"x").concat(Ua(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(r.maxFrameRate=t.frameRate,r.minFrameRate=t.frameRate):t.frameRate&&(r.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,r.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),r}function AI(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Jx(e,t){let r,a,c;switch(t){case ds.CHOOSE_SERVER:a=4096,c="choose server";break;case ds.CLOUD_PROXY:a=1048576,c="proxy";break;case ds.CLOUD_PROXY_5:a=4194304,c="proxy5";break;case ds.CLOUD_PROXY_FALLBACK:a=4194310,c="proxy fallback";break;default:throw new Ee(K.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(d=>{d.buffer&&d.buffer.flag===a&&(r={code:d.buffer.code,addresses:(d.buffer.edges_services||[]).map(h=>NI(NI({},h),{},{ticket:d.buffer.cert})),server_ts:e.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:NI(NI({},d.buffer.detail),e.detail),flag:d.buffer.flag,opid:e.opid,cert:d.buffer.cert})}),!r)throw new Ee(K.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return r}async function BH(e,t){return await Ue.all(e.addresses.map(async r=>({address:Ol(r.ip),tcpport:r.port,udpport:r.port,username:t&&z("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():mi.username,password:t&&z("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await Tj(t.toString()):mi.password})))}function IM(e,t){const r=t.getMediaStreamTrack(!0).getSettings(),a=t.videoHeight||r.height,c=t.videoWidth||r.width;return a&&c?Math.max(Math.min(a,c)/Math.min(Ua(e.height),Ua(e.width)),1):(I.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function mf(e){let{candidateType:t,relayProtocol:r,type:a,address:c,port:d,protocol:h}=e;const f={candidateType:t,relayProtocol:r,protocol:h};if(a!=="local-candidate"){const m=c.split(".");m.length>=4&&(m[1]="*",m[2]="*"),f.address=m.join("."),f.port=d}return f}function Tu(e){const t=e.split(":"),r=e.split(/[-.]/),a=ke(e).call(e,"-")?"-":".";let c=e;return t.length>1?r.length>1?(r[1]="**",c=r[0]+a+"**:"+t[t.length-1]):c=t.length>2?t[0]+a+"**:"+t[t.length-1]:"**:"+t[t.length-1]:r.length>1&&(c=r[0]+a+"**"),c}function zH(e,t){return e.getTransceivers().find(r=>r.sender.track===t||r.receiver.track===t)}function Qx(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:z("SVC_MODE");if(z("ENABLE_SVC"))return function(t){return t in eI}(e)?e:eI.L1T3}const GH={[Je.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Je.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function WH(e){e.send&&(Zv(Je.VIDEO,e.send.videoExtensions),Zv(Je.AUDIO,e.send.audioExtensions)),e.recv&&(Zv(Je.VIDEO,e.recv.videoExtensions),Zv(Je.AUDIO,e.recv.audioExtensions)),e.sendrecv&&(Zv(Je.VIDEO,e.sendrecv.videoExtensions),Zv(Je.AUDIO,e.sendrecv.audioExtensions))}function HH(e,t){e.send&&(kI(Je.VIDEO,e.send.videoExtensions,t.send.videoExtensions),kI(Je.AUDIO,e.send.audioExtensions,t.send.audioExtensions)),e.recv&&(kI(Je.VIDEO,e.recv.videoExtensions,t.recv.videoExtensions),kI(Je.AUDIO,e.recv.audioExtensions,t.recv.audioExtensions))}function kI(e,t,r){t.forEach(a=>{var c;const d=GH[e].find(f=>{var m;let{key:v}=f;return ke(m=a.extensionName).call(m,v)});if(!d)return;const h=r.find(f=>{let{extensionName:m}=f;return ke(m).call(m,d.key)});h&&ke(c=h.extensionName).call(c,"gdpr_forbidden")&&(a.extensionName=h.extensionName)})}function Zv(e,t){t.forEach(r=>{var a;const c=GH[e].find(d=>{var h;let{key:f}=d;return ke(h=r.extensionName).call(h,f)});ke(a=r.extensionName).call(a,"gdpr_forbidden")&&c&&(r.extensionName=c.extensionName)})}function KH(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||ke(e).call(e,"abs-send-time")}function OI(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||ke(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function qH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function YH(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?qH(Object(r),!0).forEach(function(a){L(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qH(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}function Zx(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:d,filterAudioFec:h,filterAudioCodec:f,filterVideoCodec:m,unsupportedVideoUplinkCodec:v,unsupportedVideoDownlinkCodec:E}=t,{useXR:w}=r;let S=[],R=[],j=[],D=[],P=!1,W=!1;if(ma(e).mediaDescriptions.forEach(ne=>{a&&a!==ne.attributes.direction||(ne.media.mediaType!=="video"||P||(R=ne.attributes.payloads,D=ne.attributes.extmaps,P=!0),ne.media.mediaType!=="audio"||W||(S=ne.attributes.payloads,j=ne.attributes.extmaps,W=!0))}),!D||R.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!j||S.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(R.forEach(ne=>{var le;(le=ne.rtpMap)!==null&&le!==void 0&&le.clockRate&&(ne.rtpMap.clockRate=parseInt(ne.rtpMap.clockRate)),w&&ne.rtcpFeedbacks.push({type:"rrtr"})}),S.forEach(ne=>{var le;(le=ne.rtpMap)!==null&&le!==void 0&&le.clockRate&&(ne.rtpMap.clockRate=parseInt(ne.rtpMap.clockRate)),w&&ne.rtcpFeedbacks.push({type:"rrtr"})}),c&&(S=S.filter(ne=>{var le;return((le=ne.rtpMap)===null||le===void 0?void 0:le.encodingName.toLowerCase())!=="rtx"}),R=R.filter(ne=>{var le;return((le=ne.rtpMap)===null||le===void 0?void 0:le.encodingName.toLowerCase())!=="rtx"})),d){const ne=R.filter(ie=>{var _e;return/(red)|(ulpfec)|(flexfec)/i.test(((_e=ie.rtpMap)===null||_e===void 0?void 0:_e.encodingName)||"")}),le=gf(ne,R).map(ie=>ie.payloadType),fe=[...ne.map(ie=>ie.payloadType),...le];R=R.filter(ie=>!ke(fe).call(fe,ie.payloadType))}if(h&&(S=S.filter(ne=>{var le;return!/(red)|(ulpfec)|(flexfec)/i.test(((le=ne.rtpMap)===null||le===void 0?void 0:le.encodingName)||"")})),f&&(f==null?void 0:f.length)>0&&(S=S.filter(ne=>{var le;return ke(f).call(f,((le=ne.rtpMap)===null||le===void 0?void 0:le.encodingName.toLowerCase())||"")})),m&&(m==null?void 0:m.length)>0){const ne=R.filter(le=>{var fe;return ke(m).call(m,((fe=le.rtpMap)===null||fe===void 0?void 0:fe.encodingName.toLowerCase())||"")});R=ne.concat(c?[]:gf(ne,R))}const Y=z("UNSUPPORTED_VIDEO_CODEC");if(Y&&Y.length>0){const ne=R.filter(ie=>ie.rtpMap&&ke(Y).call(Y,ie.rtpMap.encodingName.toLowerCase())),le=gf(ne,R),fe=ne.concat(le).map(ie=>ie.payloadType);R=R.filter(ie=>!ke(fe).call(fe,ie.payloadType)),I.debug("unsupportedVideoCodec: ".concat(Y,", toBeRemoved: ").concat(fe))}if(v&&v.length>0&&a==="sendonly"){const ne=R.filter(ie=>ie.rtpMap&&ke(v).call(v,ie.rtpMap.encodingName.toLowerCase())),le=gf(ne,R),fe=ne.concat(le).map(ie=>ie.payloadType);R=R.filter(ie=>!ke(fe).call(fe,ie.payloadType)),I.debug("unsupportedVideoUplinkCodec: ".concat(v,", toBeRemoved: ").concat(fe))}if(E&&E.length>0&&a==="recvonly"){const ne=R.filter(ie=>ie.rtpMap&&ke(E).call(E,ie.rtpMap.encodingName.toLowerCase())),le=gf(ne,R),fe=ne.concat(le).map(ie=>ie.payloadType);R=R.filter(ie=>!ke(fe).call(fe,ie.payloadType)),I.debug("unsupportedVideoDownlinkCodec: ".concat(E,", toBeRemoved: ").concat(fe))}return{audioCodecs:S,videoCodecs:R,audioExtensions:j,videoExtensions:D}}function Ru(e){const t=ma(e);let r,a;for(const c of t.mediaDescriptions){if(!r){const d=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!d||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");r={iceUfrag:d,icePwd:h}}if(!a){const d=c.attributes.fingerprints;d.length>0&&(a={fingerprints:d})}}if(!a&&t.attributes.fingerprints.length>0&&(a={fingerprints:t.attributes.fingerprints}),!a||!r)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:r,dtlsParameters:a}}function AM(e,t){const r=[],a=e.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=e.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),d=e.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var f;const m=(f=a.find(v=>v.ssrcIds[0]===h))===null||f===void 0?void 0:f.ssrcIds[1];r.push({ssrcId:h,rtx:t?m:void 0})});else if(a.length>0){const h=a[0].ssrcIds[0],f=a[0].ssrcIds[1];r.push({ssrcId:h,rtx:t?f:void 0})}else{if(d.length===0)throw new Error("No ssrcs found on local media description.");r.push({ssrcId:d[0].ssrcId})}return r}function XH(e,t,r){const{cname:a}=e;let c=[];t&&(c=$H(t)),c.length===0&&(c=e.iceParameters.candidates.map(E=>({foundation:E.foundation,componentId:"1",transport:E.protocol,priority:E.priority.toString(),connectionAddress:E.ip,port:E.port.toString(),type:E.type,extension:{}})),I.debug("Using candidates from gateway."));const d={fingerprints:e.dtlsParameters.fingerprints.map(E=>({hashFunction:E.algorithm,fingerprint:E.fingerprint}))},h={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let f;switch(e.dtlsParameters.role){case"server":f="passive";break;case"client":f="active";break;case"auto":f="actpass"}const m=tw(e.rtpCapabilities),v=[];return Array.isArray(r)&&r.length>0&&r.forEach(E=>{v.push({kind:Je.VIDEO,ssrcMsg:[{ssrcId:E.v,rtx:E.v_rtx}],mslabel:"".concat(E.v,"_").concat(E.a)},{kind:Je.AUDIO,ssrcMsg:[{ssrcId:E.a}],mslabel:"".concat(E.v,"_").concat(E.a)})}),{dtlsParameters:d,iceParameters:h,candidates:c,rtpCapabilities:m,setup:f,cname:a,preSSRCs:v}}function $H(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],I.debug("Using remote candidate from AP ".concat(Tu(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),I.debug("Using IPV6 remote candidate from AP ".concat(Tu(e.ip6),":").concat(e.port)))),t}function ew(e,t,r){const a=[],c=[];return e.forEach(d=>{let{ssrcId:h,rtx:f}=d;const m=jn(8,"track-"),v={ssrcId:h,attributes:YH({label:m,mslabel:r=r||jn(10,""),msid:"".concat(r," ").concat(m)},t&&{cname:t})};if(a.push(v),f!==void 0){const E={ssrcId:f,attributes:YH({label:m,mslabel:r,msid:"".concat(r," ").concat(m)},t&&{cname:t})};a.push(E),c.push({semantic:"FID",ssrcIds:[h,f]})}}),e.length>1&&c.push({semantic:"SIM",ssrcIds:e.map(d=>{let{ssrcId:h}=d;return h})}),{ssrcs:a,ssrcGroups:c}}function Bg(e,t){t instanceof Xr&&e.attributes.payloads.forEach(r=>{var a;const c=(a=r.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;r.fmtp||(r.fmtp={parameters:{}}),c==="opus"&&typeof z("OPUS_PTIME")=="number"?r.fmtp.parameters.ptime=z("OPUS_PTIME"):r.fmtp.parameters.minptime="10",r.fmtp.parameters.useinbandfec="1";const d=t._encoderConfig;d&&(c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(d.bitrate&&!dr()&&(r.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*d.bitrate))),d.sampleRate&&(r.fmtp.parameters.maxplaybackrate="".concat(d.sampleRate),r.fmtp.parameters["sprop-maxcapturerate"]="".concat(d.sampleRate)),d.stereo&&(r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1")),t instanceof Yx&&c==="opus"&&t._config.DTX&&(r.fmtp.parameters.usedtx="1"))})}function kM(e){const t=e.attributes.unrecognized.findIndex(r=>r.attField==="x-google-flag"&&r.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function OM(e,t){var r;if(e.attributes.payloads.forEach(c=>{var d;((d=c.rtpMap)===null||d===void 0?void 0:d.encodingName.toLowerCase())==="h264"&&c.fmtp&&c.fmtp.parameters&&z("ENABLE_UP_SPS_PPS")&&(c.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),!(t instanceof Jn&&t._encoderConfig&&t._hints.indexOf(Pn.SCREEN_TRACK)===-1))return;const a=t._encoderConfig;Zt().supportMinBitrate&&a.bitrateMin&&e.attributes.payloads.forEach(c=>{var d,h;ke(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(a.bitrateMin))}),Zt().supportMinBitrate&&!ke(r=t._hints).call(r,Pn.LOW_STREAM)&&a.bitrateMax&&e.attributes.payloads.forEach(c=>{var d,h;ke(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(z("X_GOOGLE_START_BITRATE")||Math.floor(a.bitrateMax)))})}function JH(e){if(e.media.mediaType!=="video")return;const t=yn();if(t.name!==Tn.SAFARI&&t.os!==Os.IOS)return;const r=e.attributes.extmaps.findIndex(a=>/video-orientation/g.test(a.extensionName));r!==-1&&e.attributes.extmaps.splice(r,1)}function DI(e,t,r){if(!t)return;let a,c;if(e.media.mediaType==="video"?(a=r.videoExtensions,c=r.videoCodecs):(a=r.audioExtensions,c=r.audioCodecs),t.twcc===!0){const d=a.find(h=>OI(h.extensionName));if(d){const h=d.extensionName;e.attributes.extmaps.find(m=>OI(m.extensionName))||e.attributes.extmaps.push({entry:d.entry,extensionName:h}),function(m,v){return v.filter(E=>!!m.find(w=>w.payloadType===E.payloadType&&!!w.rtcpFeedbacks.find(S=>S.type==="transport-cc")))}(c,e.attributes.payloads).forEach(m=>{m.rtcpFeedbacks.find(v=>v.type==="transport-cc")||m.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){const d=e.attributes.extmaps.findIndex(h=>OI(h.extensionName));d!==-1&&e.attributes.extmaps.splice(d,1),e.attributes.payloads.forEach(h=>{const f=h.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");f!==-1&&h.rtcpFeedbacks.splice(f,1)})}if(t.remb===!0){const d=a.find(h=>KH(h.extensionName));if(d){const h=d.extensionName;e.attributes.extmaps.find(m=>m.extensionName===h)||e.attributes.extmaps.push({entry:d.entry,extensionName:h}),function(m,v){return v.filter(E=>!!m.find(w=>w.payloadType===E.payloadType&&!!w.rtcpFeedbacks.find(S=>S.type==="goog-remb")))}(c,e.attributes.payloads).forEach(m=>{m.rtcpFeedbacks.find(v=>v.type==="goog-remb")||m.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){const d=e.attributes.extmaps.findIndex(h=>KH(h.extensionName));d!==-1&&e.attributes.extmaps.splice(d,1),e.attributes.payloads.forEach(h=>{const f=h.rtcpFeedbacks.findIndex(m=>m.type==="goog-remb");f!==-1&&h.rtcpFeedbacks.splice(f,1)})}}function DM(e,t,r){if(dr()||e.media.mediaType!=="video"||!(t instanceof Jn)||r!=="vp9"&&r!=="vp8"||r==="vp8"&&!z("SIMULCAST")||r==="vp9"&&z("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const a=r==="vp8"?2:t._scalabilityMode.numSpatialLayers,c=e.attributes.ssrcs[0],d=e.attributes.ssrcGroups.find(f=>f.semantic==="FID"&&f.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let f=1;f<a;f++)e.attributes.ssrcs.push({ssrcId:c.ssrcId+f,attributes:ur(c.attributes)}),h.ssrcIds.push(c.ssrcId+f),d&&(e.attributes.ssrcs.push({ssrcId:d.ssrcIds[1]+f,attributes:ur(c.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+f,d.ssrcIds[1]+f]}));e.attributes.ssrcGroups.unshift(h)}async function QH(){try{const e=new RTCPeerConnection;e.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:eI.L1T3}]});const t=await e.createOffer();if(!t.sdp)return void e.close();const r=ma(t.sdp).mediaDescriptions[0];if(!r)return;const a=r.attributes.extmaps.find(c=>c.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return e.close(),a}catch{return}}async function PM(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new RTCPeerConnection;r.addTransceiver("video",{direction:"sendonly"}),r.addTransceiver("audio",{direction:"sendonly"}),r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"});const a=(await r.createOffer()).sdp,{send:c,recv:d,sendrecv:h}=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;const E=Zx(v,f,m,"sendonly"),w=Zx(v,f,m,"recvonly"),S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},R={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},j={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Dl(E,w,"videoExtensions",S,R,j),Dl(E,w,"videoCodecs",S,R,j),Dl(E,w,"audioExtensions",S,R,j),Dl(E,w,"audioCodecs",S,R,j),z("RAISE_H264_BASELINE_PRIORITY")){const D=[],P=[];if(j.videoCodecs.forEach((W,Y)=>{var ne;if(((ne=W.rtpMap)===null||ne===void 0?void 0:ne.encodingName.toLocaleLowerCase())==="h264"){var le,fe;const ie=j.videoCodecs[Y+1],_e=ie&&n7(W,ie),Te=(le=W.fmtp)===null||le===void 0?void 0:le.parameters["profile-level-id"],Ne=(fe=W.fmtp)===null||fe===void 0?void 0:fe.parameters["packetization-mode"];!Te||Te!==z("FIRST_H264_PROFILE_LEVEL_ID")||z("FIRST_PACKETIZATION_MODE")&&Ne!==z("FIRST_PACKETIZATION_MODE")?_e?P.push([W,ie]):P.push([W]):_e?D.push([W,ie]):D.push([W])}}),D.length>0&&P.length>0){I.debug("raising H264 baseline profile priority"),j.videoCodecs.forEach((Y,ne)=>{var le;if(((le=Y.rtpMap)===null||le===void 0?void 0:le.encodingName.toLocaleLowerCase())==="h264"){const fe=n7(Y,j.videoCodecs[ne+1]),ie=D.shift()||P.shift()||[];ie.length>0&&(fe?j.videoCodecs.splice(ne,2,...ie):j.videoCodecs.splice(ne,1,...ie))}});const W=R.videoCodecs.filter(Y=>{var ne,le;return((ne=Y.rtpMap)===null||ne===void 0?void 0:ne.encodingName.toLocaleLowerCase())==="h264"&&((le=Y.fmtp)===null||le===void 0?void 0:le.parameters["profile-level-id"])!==z("FIRST_H264_PROFILE_LEVEL_ID")});if(W.length>0){const Y=gf(W,R.videoCodecs).map(le=>le.payloadType),ne=[...W.map(le=>le.payloadType),...Y];R.videoCodecs=R.videoCodecs.filter(le=>!ke(ne).call(ne,le.payloadType))}z("FILTER_SEND_H264_BASELINE")&&(S.videoCodecs=S.videoCodecs.filter(Y=>{var ne,le;return!(((ne=Y.rtpMap)===null||ne===void 0?void 0:ne.encodingName.toLocaleLowerCase())==="h264"&&((le=Y.fmtp)===null||le===void 0?void 0:le.parameters["profile-level-id"])!==z("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:S,recv:R,sendrecv:j}}return{send:S,recv:R,sendrecv:j}}(e,t,a);try{r.close()}catch{}return{send:c,recv:d,sendrecv:h}}function ZH(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=Zx(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Dl(e,t,"videoExtensions",r,a,c),Dl(e,t,"videoCodecs",r,a,c),Dl(e,t,"audioExtensions",r,a,c),Dl(e,t,"audioCodecs",r,a,c),z("RAISE_H264_BASELINE_PRIORITY")){const d=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(d!==-1){const h=c.videoCodecs.findIndex(f=>f.rtpMap&&f.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<d){I.debug("raising H264 baseline profile priority");const f=c.videoCodecs[d];c.videoCodecs.splice(d,1),c.videoCodecs.splice(h,0,f)}h!==-1&&(a.videoCodecs=a.videoCodecs.filter(f=>!(f.rtpMap&&f.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&f.fmtp&&f.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:r,recv:a,sendrecv:c}}function Dl(e,t,r,a,c,d){if(r==="videoExtensions"||r==="audioExtensions"){const h=[];return e[r].forEach(f=>{t[r].some((m,v)=>{if(f.entry===m.entry&&f.extensionName===m.extensionName)return h.push(v),!0})?d[r].push(f):a[r].push(f)}),void t[r].forEach((f,m)=>{h.indexOf(m)===-1&&c[r].push(f)})}if(r==="videoCodecs"||r==="audioCodecs"){const h=[];return e[r].forEach(f=>{t[r].some((m,v)=>{if(f.payloadType===m.payloadType&&JSON.stringify(f)===JSON.stringify(m))return h.push(v),!0})?d[r].push(f):a[r].push(f)}),void t[r].forEach((f,m)=>{h.indexOf(m)===-1&&c[r].push(f)})}}function tw(e){const{send:t,recv:r,sendrecv:a}=e;if(!a){if(!t||!r)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:r}}let c,d;return t?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...t.audioCodecs,...a.audioCodecs],c.videoCodecs=[...t.videoCodecs,...a.videoCodecs],c.audioExtensions=[...t.audioExtensions,...a.audioExtensions],c.videoExtensions=[...t.videoExtensions,...a.videoExtensions]):c=ur(a),r?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...r.audioCodecs,...a.audioCodecs],d.videoCodecs=[...r.videoCodecs,...a.videoCodecs],d.audioExtensions=[...r.audioExtensions,...a.audioExtensions],d.videoExtensions=[...r.videoExtensions,...a.videoExtensions]):d=ur(a),{send:c,recv:d}}function eE(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var r;return((r=t.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function nw(e,t,r,a){let c=[];if(e===Je.VIDEO){if(z("H264_PROFILE_LEVEL_ID")&&a==="h264"&&(c=t.videoCodecs.filter(d=>{var h;return ke(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,a)&&d&&d.fmtp&&d.fmtp.parameters["profile-level-id"]===z("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let d=[];const h=[],f=[],m=[];if(r.videoCodecs.forEach(v=>{const E=v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||"";ke(E).call(E,a)?d.push(v):ke(E).call(E,"vp9")?h.push(v):ke(E).call(E,"vp8")?f.push(v):ke(E).call(E,"h264")&&m.push(v)}),d.length===0){let v="";h.length!==0?(d=h,v="vp9"):f.length!==0?(d=f,v="vp8"):m.length!==0&&(d=m,v="h264"),I.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(v))}d.length!==0&&(c=t.videoCodecs.filter(v=>d.some(E=>E.payloadType===v.payloadType)))}if(c.length===0&&(I.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),c=t.videoCodecs),z("USE_PUB_RTX")||z("USE_SUB_RTX")){const d=gf(c,t.videoCodecs);c=[...c,...d]}}else{c=t.audioCodecs.filter(h=>{var f;return ke(f=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(f,a)});const d=t.audioCodecs.filter(h=>{var f;return ke(f=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(f,"red")});c.length===0&&(I.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),c=t.audioCodecs.filter(h=>{var f;return ke(f=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(f,"opus")})),z("ENABLE_AUDIO_RED")&&d.length!==0&&(c=[...d,...c])}return c}function gf(e,t){const r=e.map(a=>a.payloadType.toString());return t.filter(a=>a.rtpMap&&a.rtpMap.encodingName==="rtx"&&a.fmtp&&a.fmtp.parameters.apt&&ke(r).call(r,a.fmtp&&a.fmtp.parameters.apt))}async function co(e,t,r){const a=t.toString(),c=e7(a,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:a});const d=await e.createAnswer();if(!d.sdp)throw new Error("cannot get answer sdp");let h=d.sdp;h=LM(h,r||{}),c==null||c(h||""),await e.setLocalDescription({type:"answer",sdp:h})}function LM(e,t,r){if(z("FORBID_MODIFY_LOCAL_OFFER_SDP"))return e;const a=ma(e),{useXR:c}=t;return a.mediaDescriptions.forEach(d=>{var h;d.attributes.mid&&(Array.isArray(r)&&!ke(r).call(r,d.attributes.mid)||(d.media.mediaType==="audio"&&eE(d),d.media.mediaType==="video"&&function(f){f.media.mediaType==="video"&&z("ENABLE_DOWN_SPS_PPS")&&f.attributes.payloads.filter(m=>{var v;return((v=m.rtpMap)===null||v===void 0?void 0:v.encodingName.toLowerCase())==="h264"}).forEach(m=>{m.fmtp||(m.fmtp={parameters:{}}),m.fmtp.parameters["sps-pps-idr-in-keyframe"]="1"})}(d),c&&ke(h=["audio","video"]).call(h,d.media.mediaType)&&d.attributes.payloads.forEach(f=>{f.rtcpFeedbacks.findIndex(m=>m.type==="rrtr")===-1&&f.rtcpFeedbacks.push({type:"rrtr"})})))}),kh(a)}function e7(e,t,r,a){if(z("SDP_LOGGING"))return I.upload("exchanging ".concat(r," ").concat(t," SDP during P2PConnection.").concat(a,`
`),e),t==="offer"?c=>{e7(c,"answer",r==="local"?"remote":"local",a)}:void 0}async function t7(e,t,r){try{var a;if(!Zt().supportSetRtpSenderParameters||!function(m){return m==="vp9"||m==="av1"}(e)||!z("ENABLE_SVC"))return;const c={},d={},h=t.getParameters(),f=(a=h.encodings)===null||a===void 0?void 0:a[0];d.scalabilityMode=Qx(r),f&&Object.assign(f,d),Object.assign(h,c),await t.setParameters(h),I.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(h.encodings)))}catch(c){I.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",c)}}function PI(e){const t=z("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(r=>ke(e).call(e,r))}function n7(e,t){try{var r;return((r=e.fmtp)===null||r===void 0?void 0:r.parameters.apt)===t.payloadType.toString()}catch{return!1}}function r7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function Po(e,t){return typeof z(e)===t?z(e):void 0}function kue(){try{const e=z("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?r7(Object(a),!0).forEach(function(c){L(t,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):r7(Object(a)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(a,c))})}return t}({},e)}catch(e){return I.debug("handle gateway attributes failed: ",e),{}}}const s7={};function Cu(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&I.debug("install service ".concat(e.name)),s7[e.name]=e}function Td(e){const t=s7[e];if(!t)throw new we(K.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function i7(e,t){return Td("DataStream").create(e,t)}function LI(){return Td("InterceptFrame").create()}function a7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function Xs(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?a7(Object(r),!0).forEach(function(a){L(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a7(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}const jM=new Map;class Oue extends br{get state(){return this._state}set state(t){if(t===this._state)return;const r=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(rs.CONNECTION_STATE_CHANGE,t,r,this._disconnectedReason):this.emit(rs.CONNECTION_STATE_CHANGE,t,r)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){I.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,r){var a,c,d;super(),L(this,"store",void 0),L(this,"joinInfo",void 0),L(this,"key",void 0),L(this,"ntpOffset",0),L(this,"usingProxy",!1),L(this,"signal",void 0),L(this,"role",void 0),L(this,"isPreallocation",void 0),L(this,"isPreSub",void 0),L(this,"inChannelInfo",{joinAt:null,duration:0}),L(this,"spec",void 0),L(this,"_state","DISCONNECTED"),L(this,"_statsCollector",void 0),L(this,"_disconnectedReason",void 0),L(this,"isSignalRecover",!1),L(this,"hasChangeBGPAddress",!1),L(this,"trafficStatsInterval",void 0),L(this,"networkQualityInterval",void 0),L(this,"_joinGatewayStartTime",0),L(this,"_signalTimeout",!1),L(this,"_clientRoleOptions",void 0),L(this,"_isProactiveJoin",!1),this.store=t,this.spec=r,this.signal=this.store.useP2P?(a={spec:Xs(Xs({},r),{},{retryConfig:r.websocketRetryConfig}),store:t},(c=(d=Td("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(d,a)):this.store.useDcSignal?function(h){return Td("DataChannelSignal").create(h)}({spec:Xs(Xs({},r),{},{retryConfig:r.websocketRetryConfig}),store:t}):new UH(Xs(Xs({},r),{},{retryConfig:r.websocketRetryConfig}),t),this._statsCollector=r.statsCollector,this.role=r.role||"audience",this._clientRoleOptions=r.clientRoleOptions,this.handleSignalEvents()}setUsingProxy(t){this.usingProxy=t}async join(t,r,a){if(this.store.useDcSignal){let E=!1;t.cloudProxyServer!=="disabled"?(I.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(t.cloudProxyServer,")")),E=!0):"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length>255||"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length<22?(I.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),E=!0):t.apResponse.addresses.some(w=>w.fingerprint)||z("FINGERPRINT")||(I.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),E=!0),E&&this.resetSignal()}this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let d=jM.get(t.cname);if(d||(d=new Map,jM.set(t.cname,d)),this._isProactiveJoin=!0,d.has(t.uid)){const E=new Ee(K.UID_CONFLICT);throw tt.joinGateway(t.sid,{lts:c,succ:!1,ec:E.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer||this.usingProxy,signalChannel:this.store.useDcSignal?"1":"0",preload:t.preload}),E}d.set(t.uid,!0),this.joinInfo=t,this.key=r;let h=0;this.joinGatewayStartTime=c;const f=t.proxyServer,m=this.store.useDcSignal?"datachannel":"websocket";try{I.debug("[".concat(this.store.clientId,"] use ").concat(m," join uid ").concat(h));const E=t.gatewayAddrs.map(S=>{let{address:R}=S;const[j,D]=R.split(":"),P={host:j,port:D};return t.proxyServer&&(P.proxy=t.proxyServer),P});let w;w=this.store.useDcSignal?await this.signal.init(t.apResponse.addresses):await this.signal.init(E),h=w.uid,I.debug("[".concat(this.store.clientId,"] ").concat(m," join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(E){var v;throw E.code===K.INIT_DATACHANNEL_TIMEOUT&&this.signal.__name__==="AgoraRTCSignal"||tt.joinGateway(t.sid,{lts:c,succ:!1,ec:((v=E.data)===null||v===void 0?void 0:v.desc)||E.code,errorMsg:E.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!f||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:t.preload}),E&&E.code===K.INIT_DATACHANNEL_TIMEOUT?(I.warning("[".concat(this.store.clientId,"] User join datachannel failed"),E.toString()),this.resetSignal(),E):(I.error("[".concat(this.store.clientId,"] User join failed"),E.toString()),d.delete(t.uid),this.signal.close(),E)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),I.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(E=>{I.warning("[".concat(this.store.clientId,"] get traffic stats error"),E.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(rs.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(rs.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(rs.NETWORK_QUALITY,{uplinkNetworkQuality:AI(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:AI(this._statsCollector.trafficStats.B_dnq)}):this.emit(rs.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],r=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){r!==nn.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==rn.CONNECTED||await function(a,c){return c===1/0?a:Ue.race([a,ide(c)])}(this.signal.request(lt.LEAVE,void 0,!0),3e3)}catch(a){I.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),a)}this.signal.close(r),r!==nn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,r,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ee(K.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:r,mode:this.spec.mode,extend:z("PUB_EXTEND"),twcc:!!z("PUBLISH_TWCC"),rtx:!!z("USE_PUB_RTX")};try{return(await this.signal.request(lt.PUBLISH,c,!0))._message}catch(d){if(a&&d.data&&d.data.code===pt.ERR_PUBLISH_REQUEST_INVALID)return I.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),d.toString()),await this.tryUnpubBeforeRepub(t,r),this.publish(t,r,!1);throw d}}async publishDataChannel(t,r,a){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ee(K.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const d={stream_id:r.streamId,ordered:r.ordered?1:0,max_retrans_times:(c=r.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:r.channelId,metadata:r.metadata};try{await this.signal.request(lt.PUBLISH_DATASTREAM,d,!0)}catch(h){if(a&&h.data&&h.data.code===pt.ERR_PUBLISH_REQUEST_INVALID)return I.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(t,r),this.publishDataChannel(t,r,!1);throw h}}async unpublish(t,r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ee(K.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(lt.UNPUBLISH,{stream_id:r,ortc:t},!0)}catch(a){I.warning("[".concat(this.store.clientId,"] unpublish warning: "),a)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ee(K.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Ue.all(t.map(r=>this.signal.request(lt.UNPUBLISH_DATASTREAM,{channel_id:r},!0)))}catch(r){I.warning("unpublish datachannels warning: ",r)}}async presubscribe(t,r,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ee(K.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:t,stream_type:r,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!z("SUBSCRIBE_TWCC"),rtx:!!z("USE_SUB_RTX")||void 0,extend:z("SUB_EXTEND"),svc:Array.isArray(z("SVC"))&&z("SVC").length!==0?z("SVC"):void 0};try{return await this.signal.request(lt.PRE_SUBSCRIBE,c,!0)}catch(d){if(a&&d.data&&d.data.code===pt.ERR_SUBSCRIBE_REQUEST_INVALID)return I.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),d.toString()),this.presubscribe(t,r,!1);throw d}}async subscribe(t,r,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ee(K.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:t,stream_type:r.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!z("SUBSCRIBE_TWCC"),rtx:!!z("USE_SUB_RTX"),extend:z("SUB_EXTEND"),ssrcId:r.ssrcId,svc:Array.isArray(z("SVC"))&&z("SVC").length!==0?z("SVC"):void 0};try{return(await this.signal.request(lt.SUBSCRIBE,c,!0))._message}catch(d){if(a&&d.data&&d.data.code===pt.ERR_SUBSCRIBE_REQUEST_INVALID)return I.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),d.toString()),await this.tryUnsubBeforeResub(t,r),await this.subscribe(t,r,!1);throw d}}async subscribeDataChannel(t,r,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ee(K.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:t,stream_id:r.id,channel_id:r.datachannelId};try{return void await this.signal.request(lt.SUBSCRIBE_DATASTREAM,c,!0)}catch(d){if(a&&d.data&&d.data.code===pt.ERR_SUBSCRIBE_REQUEST_INVALID)return I.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),d.toString()),await this.tryUnsubDataChannelBeforeResub(t,r),await this.subscribeDataChannel(t,r,!1);throw d}}async subscribeAll(t,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ee(K.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const a={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!z("USE_SUB_RTX"),twcc:!!z("SUBSCRIBE_TWCC"),svc:Array.isArray(z("SVC"))&&z("SVC").length!==0?z("SVC"):void 0};try{return await this.signal.request(lt.SUBSCRIBE_STREAMS,a,!0)}catch(c){if(r&&c.data&&c.data.code===pt.ERR_SUBSCRIBE_REQUEST_INVALID)return I.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw c}}async setVideoProfile(t){const r=function(a){if(!(a.bitrateMax&&a.bitrateMin&&a.frameRate&&a.height&&a.width))return;let c=a.frameRate,d=a.width,h=a.height,f=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(f=!1)),typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,d||(f=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(f=!1)),f?{stream_type:0,width:d,height:h,fps:c,start_bps:1e3*a.bitrateMax,min_bps:1e3*a.bitrateMin,target_bps:1e3*a.bitrateMax}:void 0}(t);if(r)return this.signal.request(lt.SET_VIDEO_PROFILE,r);I.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,r){try{await this.signal.request(lt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:r},!0)}catch(a){I.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),a)}}async unsubscribeDataChannel(t,r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ee(K.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Ue.all(t.map(a=>this.signal.request(lt.UNSUBSCRIBE_DATASTREAM,{stream_id:a,uid:r},!0)))}catch(a){I.warning("unsubscribeDataChannel warning: ",a)}}async massUnsubscribe(t){try{await this.signal.request(lt.UNSUBSCRIBE_STREAMS,t,!0)}catch(r){I.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),r)}}async reconnectPC(t){const{iceParameters:r,dtlsParameters:a,rtpCapabilities:c}=t;return{gatewayEstablishParams:await this.signal.request(lt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:r,dtlsParameters:a,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(lt.GATEWAY_INFO)}async renewToken(t){await this.signal.request(lt.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,r){r&&(this._clientRoleOptions=Object.assign({},r)),z("CLIENT_ROLE_OPTIONS")&&(I.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(z("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},z("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,r){if(r&&(this._clientRoleOptions=Object.assign({},r)),z("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},z("CLIENT_ROLE_OPTIONS")),I.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(z("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let a,c=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(a=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0;const d=Object.assign({},r);delete d.delay,delete d.level,await this.signal.request(lt.SET_CLIENT_ROLE,Xs(Xs({role:t,level:c,delay:a},d),{},{client_ts:Date.now()})),this.role=t}async setDualStreamMode(t,r,a){await this.signal.request(lt.SET_DUAL_STREAM_MODE,{mode:t},a,r)}async setRemoteVideoStreamType(t,r){await this.signal.request(lt.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:r})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(lt.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,r){await this.signal.request(lt.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:r})}async pickSVCLayer(t,r){await this.signal.request(lt.PICK_SVC_LAYER,{stream_id:t,spatial_layer:r.spatialLayer,temporal_layer:r.temporalLayer})}async setRTM2Flag(t){await this.signal.request(lt.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,r,a){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,r,a)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Xs({},this.inChannelInfo)}async setConfigure(t){if(t&&Array.isArray(t)&&t.length!==0)return this.signal.request(lt.CONFIGURE,t)}async getGatewayVersion(){return(await this.signal.request(lt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=jM.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0),this.usingProxy=!1}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(r){let a;return a=r.startsWith("dc")?r.match(/(dc\:\/\/)?([^:]+):(\d+)/):r.match(/(wss\:\/\/)?([^:]+):(\d+)/),a?{username:mi.username,password:mi.password,turnServerURL:a[2],tcpport:parseInt(a[3])+30,udpport:parseInt(a[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Xs(Xs({},mi),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(lt.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(r=>{const a=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===r.peer_uid);a&&a.B_st!==r.B_st&&$N(()=>{this.emit(rs.STREAM_TYPE_CHANGE,r.peer_uid,r.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var r,a,c,d;if(!this.joinInfo||!this.key)throw new Ee(K.UNEXPECTED_ERROR,"can not generate join message, no join info");const h=Object.assign({},this.joinInfo.apResponse);let f=z("REPORT_APP_SCENARIO");if(typeof f!="string")try{f=JSON.stringify(f)}catch{f=void 0}var m;f&&f.length>128&&(f=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(rs.UPDATE_GATEWAY_CONFIG),m=this.store.clientId,ke(Yv).call(Yv,m)||Yv.push(m);const v=Kx(this.store),E=!((r=this.isPreallocation)===null||r===void 0||!r.call(this)),w=aW(this.store),S=kue(),R=Ed(87)||hG()||Ej(117),j=(function(){const Y=yn();if(Y.name!==Tn.SAFARI||!Y.browserVersion)return!1;const ne=Y.browserVersion.split(".");return Number(ne[0])>18||Number(ne[0])===18&&Number(ne[1])>=4}()||gG(18,4,!1))&&yj(18,6,!0)&&this.spec.codec==="h264"&&z("ENABLE_ABSSENDTIME_AS_SENTTS"),D=!(((a=h.detail)===null||a===void 0?void 0:a[3])!=="CN"||!z("ENABLE_QUALITY_FALLBACK"))&&z("ENABLE_QUALITY_FALLBACK"),P=!!z("ENABLE_AP_MULTI_IP")&&((c=h.detail)===null||c===void 0?void 0:c[5])==="multi-ip",W=Xs({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:kc,browser:navigator.userAgent,process_id:z("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:P||this.hasChangeBGPAddress,ap_response:h,extend:z("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:f,attributes:{userAttributes:Xs(Xs({enableEncodedTransform:(!!z("ENABLE_AUDIO_METADATA")||!!z("ENABLE_AUDIO_PTS"))&&R||!!z("ENABLE_AUDIO_TOPN")&&vj(Tn.CHROME,87,116)||void 0,enableAudioMetadata:!!z("ENABLE_AUDIO_METADATA")&&R,enableAudioPts:!!z("ENABLE_AUDIO_PTS")&&R,topnSmoothLevel:z("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:z("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:z("TOPN_SWITCH_HOLD_MS"),topnAudioGain:z("TOPN_AUDIO_GAIN"),enableNetworkQualityProbe:this.store.networkQualityProbe,enablePublishedUserList:z("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:z("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Po("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Po("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Po("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:z("USE_PUB_RTX")===!0||z("USE_SUB_RTX")===!0||void 0,disableFEC:z("DISABLE_FEC"),enableNTPReport:!!z("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:w,enableFulllinkAvSync:!!z("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Po("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!z("FORCE_ENABLE_AUT_CC")||!iI()&&(!!z("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!z("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Po("USE_XR","boolean"),enableLossbasedBwe:Po("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!z("FORCE_ENABLE_AUT_CC")||!iI()&&(!!z("ENABLE_AUT_CC")||void 0),enableCCFallback:Po("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:E,preSubNum:v?Po("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Po("PUBLISH_TWCC","boolean"),enableSubTWCC:Po("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Po("USE_PUB_RTX","boolean"),enableSubRTX:Po("USE_SUB_RTX","boolean"),enableSubSVC:z("ENABLE_SVC")?z("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(z("SVC"))&&z("SVC").length!==0?z("SVC"):void 0,enableSvcExtended:z("ENABLE_SVC")&&Array.isArray(z("SVC_EXTENDED"))&&z("SVC_EXTENDED").length!==0?z("SVC_EXTENDED"):void 0,enableVosFallback:z("ENABLE_VOS_FALLBACK"),enableQualityFallback:D},S),{},{audioDuplicate:Po("ENABLE_AUDIO_RED","boolean")?(d=Po("AUDIO_DUPLICATE_NUM","number"))!==null&&d!==void 0?d:2:void 0,senttsUsesAbsSendTime:!!j||void 0,enableDualStreamFlag:Po("ENABLE_DUAL_STREAM_FLAG","boolean")})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(W.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(W.aes_mode=this.joinInfo.aesmode,z("ENCRYPT_AES")?(W.aes_secret=this.joinInfo.aespassword,W.aes_encrypt=!0):W.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(W.aes_salt=this.joinInfo.aessalt)),h.addresses[this.signal.websocket.currentURLIndex]&&(W.ap_response.ticket=h.addresses[this.signal.websocket.currentURLIndex].ticket,delete h.addresses),this.joinInfo.defaultVideoStream!==void 0&&(W.default_video_stream=this.joinInfo.defaultVideoStream),W}getRejoinMessage(){if(!this.joinInfo)throw new Ee(K.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(rt.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(rt.WS_RECONNECTING,t=>{this.joinInfo&&tt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||fi.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",tt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(rt.WS_CLOSED,t=>{let r;switch(t){case nn.LEAVE:r=fi.LEAVE;break;case nn.UID_BANNED:case nn.IP_BANNED:case nn.CHANNEL_BANNED:case nn.SERVER_ERROR:r=fi.SERVER_ERROR;break;case nn.FALLBACK:r=fi.FALLBACK;break;case nn.LICENSE_MISSING:case nn.LICENSE_EXPIRED:case nn.LICENSE_MINUTES_EXCEEDED:case nn.LICENSE_PERIOD_INVALID:case nn.LICENSE_MULTIPLE_SDK_SERVICE:case nn.LICENSE_ILLEGAL:case nn.TOKEN_EXPIRE:r=t;break;default:r=fi.NETWORK_ERROR}I.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(r||"undefined -> "+fi.NETWORK_ERROR)),this.joinInfo&&tt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===nn.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r}),this._disconnectedReason=t,t!==nn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(rt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=z("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(I.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(tt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void I.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));Wn("EVENT_REPORT_DOMAIN",t[1]),Wn("EVENT_REPORT_BACKUP_DOMAIN",t[1]),Wn("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(Rt.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(rt.REQUEST_RECOVER,(t,r,a)=>{if(!this.joinInfo)return a(new Ee(K.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,_s(this,rs.REQUEST_NEW_GATEWAY_LIST).then(r).catch(a)}),this.signal.on(rt.REQUEST_JOIN_INFO,async(t,r,a)=>{var c,d,h;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const f=ur((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(z("NEW_TURN_MODE")&&f&&((d=this.joinInfo)===null||d===void 0?void 0:d.cloudProxyServer)==="disabled"){var m;let S=f.servers.map(D=>"turnServerURL"in D&&z("USE_TURN_IP")?Xs(Xs({},D),{},{turnServerURL:II(D.turnServerURL)}):D),R=(m=f.serversFromGateway)===null||m===void 0?void 0:m.map(D=>z("USE_TURN_IP")?Xs(Xs({},D),{},{turnServerURL:II(D.turnServerURL)}):D);const j=this.signal.currentURLIndex;S.length>0&&(S=[S[j%S.length]],f.servers=S),Array.isArray(R)&&R.length>0&&(R=[R[0]],f.serversFromGateway=R),I.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(j))}const{iceParameters:v,dtlsParameters:E,rtpCapabilities:w}=await _s(this,rs.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:f,cloudProxyServer:(h=this.joinInfo)===null||h===void 0?void 0:h.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:v,dtlsParameters:E,rtpCapabilities:w,version:"2"}}))}catch(S){r(S)}}),this.signal.on(rt.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(rt.REPORT_JOIN_GATEWAY,(t,r)=>{if(!this.joinInfo)return;let a,c="";var d;t instanceof Ee?(a=((d=t.data)===null||d===void 0?void 0:d.desc)||t.code,c=t.message):a=t,tt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:a,errorMsg:c,addr:r,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload})}),this.signal.on(rt.IS_P2P_DISCONNECTED,t=>{t(Tg(this,rs.IS_P2P_DISCONNECTED))}),this.signal.on(rt.DISCONNECT_P2P,()=>{this.emit(rs.DISCONNECT_P2P)}),this.signal.on(rt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(rt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(rt.JOIN_RESPONSE,t=>{const r=this.getCurrentGatewayAddress();this.emit(rs.JOIN_RESPONSE,t,r)}),this.signal.on(rt.PRE_CONNECT_PC,async(t,r)=>{if(this.joinInfo){var a,c;this.updateTurnConfigFromSignal();const h=this.getCurrentGatewayAddress(),f=ur((a=this.joinInfo)===null||a===void 0?void 0:a.turnServer);if(z("NEW_TURN_MODE")&&f&&((c=this.joinInfo)===null||c===void 0?void 0:c.cloudProxyServer)==="disabled"){var d;let v=f.servers.map(S=>"turnServerURL"in S&&z("USE_TURN_IP")?Xs(Xs({},S),{},{turnServerURL:II(S.turnServerURL)}):S),E=(d=f.serversFromGateway)===null||d===void 0?void 0:d.map(S=>z("USE_TURN_IP")?Xs(Xs({},S),{},{turnServerURL:II(S.turnServerURL)}):S);const w=this.signal.currentURLIndex;v.length>0&&(v=[v[w%v.length]],f.servers=v),Array.isArray(E)&&E.length>0&&(E=[E[0]],f.serversFromGateway=E),I.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(w,",in pre pc"))}const m=z("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(h&&m){const v=$H(h);_s(this,rs.PRE_CONNECT_PC,{candidates:v,fingerprint:m,turnServer:f}).then(E=>{t==null||t(E)}).catch(r||(()=>{}))}}}),this.signal.on(rt.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof z("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(z("AP_REQUEST_DETAIL"),";").concat(t))}),this.signal.on(rt.VOS_FALLBACK,t=>{this.emit(rs.VOS_FALLBACK,t)}),this.signal.on(rt.DATACHANNEL_FAILBACK,t=>{I.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(rs.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(t,r){try{await this.signal.request(lt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[r]},!0)}catch(a){throw I.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),a),a}}async tryUnsubDataChannelBeforeResub(t,r){try{await this.signal.request(lt.UNSUBSCRIBE,{stream_id:r.id},!0)}catch(a){throw I.warning("unsubscribe datachannel warning",a),a}}async tryUnpubBeforeRepub(t,r){try{await this.signal.request(lt.UNPUBLISH,{stream_id:t,ortc:r},!0)}catch(a){throw I.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),a),a}}async tryUnpubDataChannelBeforeRepub(t,r){try{await this.signal.request(lt.UNPUBLISH_DATASTREAM,{channnel_id:r.channelId},!0)}catch(a){throw I.warning("unpublish datastream warning: ",a),a}}async tryMassUnsubBeforeResub(t){const r={users:t.map(a=>({stream_id:a.stream_id,stream_type:a.stream_type}))};try{await this.signal.request(lt.UNSUBSCRIBE_STREAMS,r,!0)}catch(a){throw I.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),a),a}}async muteLocal(t,r){const a={action:t.find(c=>c.stream_type===Un.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:r};try{await this.signal.request(lt.CONTROL,a,!0,!0)}catch(c){throw I.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(t,r){const a={action:t.find(c=>c.stream_type===Un.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:r};try{await this.signal.request(lt.CONTROL,a,!0,!0)}catch(c){throw I.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(t,r){const a={action:t===Je.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:r};try{await this.signal.request(lt.CONTROL,a,!0,!0)}catch(c){throw I.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(t,r){const a={action:t===Je.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:r};try{await this.signal.request(lt.CONTROL,a,!0,!0)}catch(c){throw I.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,r){this.signal.upload(t,r)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const r={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(lt.RESTART_ICE,r,!0)}catch(a){throw I.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),a),a}}reconnect(t,r){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,r||fi.P2P_FAILED)}getCurrentGatewayAddress(){var t,r;if(!z("GATEWAY_WSS_ADDRESS"))return z("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(I.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(r=this.joinInfo)!==null&&r!==void 0&&r.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(lt.SET_PARAMETER,{enablePublishAudioFilter:t})}downgradeCodec(t){this.signal.downgradeCodec(t)}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(nn.FALLBACK)),this.store.useDcSignal=!1,this.signal=new UH(Xs(Xs({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(rs.RESET_SIGNAL)}}let jI=0,MM=0;function Rd(e,t,r,a){return new Ue((c,d)=>{t.timeout=t.timeout||z("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),jI+=bu(t.data)):r&&(t.data.size?jI+=t.data.size:t.data instanceof FormData?jI+=jG(t.data):jI+=bu(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Pa.request(t).then(h=>{typeof h.data=="string"?MM+=bu(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?MM+=h.data.byteLength:MM+=bu(JSON.stringify(h.data)),a&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{Pa.isCancel(h)?d(new Ee(K.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new Ee(K.NETWORK_TIMEOUT,h.message)):h.response?d(new Ee(K.NETWORK_RESPONSE_ERROR,h.response.status)):d(new Ee(K.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(Re){var je=0;return function(){return je<Re.length?{done:!1,value:Re[je++]}:{done:!0}}}var r=typeof Object.defineProperties=="function"?Object.defineProperty:function(Re,je,Ze){return Re==Array.prototype||Re==Object.prototype||(Re[je]=Ze.value),Re},a,c=function(Re){Re=[typeof globalThis=="object"&&globalThis,Re,typeof window=="object"&&window,typeof self=="object"&&self,typeof l=="object"&&l];for(var je=0;je<Re.length;++je){var Ze=Re[je];if(Ze&&Ze.Math==Math)return Ze}throw Error("Cannot find global object")}(this);function d(Re,je){if(je)e:{var Ze=c;Re=Re.split(".");for(var Ce=0;Ce<Re.length-1;Ce++){var O=Re[Ce];if(!(O in Ze))break e;Ze=Ze[O]}(je=je(Ce=Ze[Re=Re[Re.length-1]]))!=Ce&&je!=null&&r(Ze,Re,{configurable:!0,writable:!0,value:je})}}function h(Re){return(Re={next:Re})[Symbol.iterator]=function(){return this},Re}function f(Re){var je=typeof Symbol<"u"&&Symbol.iterator&&Re[Symbol.iterator];return je?je.call(Re):{next:t(Re)}}if(d("Symbol",function(Re){function je(O,te){this.A=O,r(this,"description",{configurable:!0,writable:!0,value:te})}if(Re)return Re;je.prototype.toString=function(){return this.A};var Ze="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Ce=0;return function O(te){if(this instanceof O)throw new TypeError("Symbol is not a constructor");return new je(Ze+(te||"")+"_"+Ce++,te)}}),d("Symbol.iterator",function(Re){if(Re)return Re;Re=Symbol("Symbol.iterator");for(var je="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Ze=0;Ze<je.length;Ze++){var Ce=c[je[Ze]];typeof Ce=="function"&&typeof Ce.prototype[Re]!="function"&&r(Ce.prototype,Re,{configurable:!0,writable:!0,value:function(){return h(t(this))}})}return Re}),typeof Object.setPrototypeOf=="function")a=Object.setPrototypeOf;else{var m;e:{var v={};try{v.__proto__={a:!0},m=v.a;break e}catch{}m=!1}a=m?function(Re,je){if(Re.__proto__=je,Re.__proto__!==je)throw new TypeError(Re+" is not extensible");return Re}:null}var E=a;function w(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function S(Re){if(Re.m)throw new TypeError("Generator is already running");Re.m=!0}function R(Re,je){return Re.h=3,{value:je}}function j(Re){this.g=new w,this.G=Re}function D(Re,je,Ze,Ce){try{var O=je.call(Re.g.j,Ze);if(!(O instanceof Object))throw new TypeError("Iterator result "+O+" is not an object");if(!O.done)return Re.g.m=!1,O;var te=O.value}catch(oe){return Re.g.j=null,Re.g.s(oe),P(Re)}return Re.g.j=null,Ce.call(Re.g,te),P(Re)}function P(Re){for(;Re.g.h;)try{var je=Re.G(Re.g);if(je)return Re.g.m=!1,{value:je.value,done:!1}}catch(Ze){Re.g.v=void 0,Re.g.s(Ze)}if(Re.g.m=!1,Re.g.l){if(je=Re.g.l,Re.g.l=null,je.F)throw je.D;return{value:je.return,done:!0}}return{value:void 0,done:!0}}function W(Re){this.next=function(je){return Re.o(je)},this.throw=function(je){return Re.s(je)},this.return=function(je){return function(Ze,Ce){S(Ze.g);var O=Ze.g.j;return O?D(Ze,"return"in O?O.return:function(te){return{value:te,done:!0}},Ce,Ze.g.return):(Ze.g.return(Ce),P(Ze))}(Re,je)},this[Symbol.iterator]=function(){return this}}function Y(Re,je){return je=new W(new j(je)),E&&Re.prototype&&E(je,Re.prototype),je}if(w.prototype.o=function(Re){this.v=Re},w.prototype.s=function(Re){this.l={D:Re,F:!0},this.h=this.C||this.u},w.prototype.return=function(Re){this.l={return:Re},this.h=this.u},j.prototype.o=function(Re){return S(this.g),this.g.j?D(this,this.g.j.next,Re,this.g.o):(this.g.o(Re),P(this))},j.prototype.s=function(Re){return S(this.g),this.g.j?D(this,this.g.j.throw,Re,this.g.o):(this.g.s(Re),P(this))},d("Array.prototype.entries",function(Re){return Re||function(){return function(je,Ze){je instanceof String&&(je+="");var Ce=0,O=!1,te={next:function(){if(!O&&Ce<je.length){var oe=Ce++;return{value:Ze(oe,je[oe]),done:!1}}return O=!0,{done:!0,value:void 0}}};return te[Symbol.iterator]=function(){return te},te}(this,function(je,Ze){return[je,Ze]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var ne=function(Re,je){for(var Ze=0;Ze<Re.length;Ze++)je(Re[Ze])},le=function(Re){return Re.replace(/\r?\n|\r/g,`\r
`)},fe=function(Re,je,Ze){return je instanceof Blob?(Ze=Ze!==void 0?Ze+"":typeof je.name=="string"?je.name:"blob",je.name===Ze&&Object.prototype.toString.call(je)!=="[object Blob]"||(je=new File([je],Ze)),[String(Re),je]):[String(Re),String(je)]},ie=function(Re,je){if(Re.length<je)throw new TypeError(je+" argument required, but only "+Re.length+" present.")},_e=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Te=_e.FormData,Ne=_e.XMLHttpRequest&&_e.XMLHttpRequest.prototype.send,Ke=_e.Request&&_e.fetch,St=_e.navigator&&_e.navigator.sendBeacon,Et=_e.Element&&_e.Element.prototype,Vt=_e.Symbol&&Symbol.toStringTag;Vt&&(Blob.prototype[Vt]||(Blob.prototype[Vt]="Blob"),"File"in _e&&!File.prototype[Vt]&&(File.prototype[Vt]="File"));try{new File([],"")}catch{_e.File=function(je,Ze,Ce){return je=new Blob(je,Ce||{}),Object.defineProperties(je,{name:{value:Ze},lastModified:{value:+(Ce&&Ce.lastModified!==void 0?new Date(Ce.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Vt&&Object.defineProperty(je,Vt,{value:"File"}),je}}var Ot=function(Re){return Re.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Cn=function(Re){this.i=[];var je=this;Re&&ne(Re.elements,function(Ze){if(Ze.name&&!Ze.disabled&&Ze.type!=="submit"&&Ze.type!=="button"&&!Ze.matches("form fieldset[disabled] *"))if(Ze.type==="file"){var Ce=Ze.files&&Ze.files.length?Ze.files:[new File([],"",{type:"application/octet-stream"})];ne(Ce,function(O){je.append(Ze.name,O)})}else Ze.type==="select-multiple"||Ze.type==="select-one"?ne(Ze.options,function(O){!O.disabled&&O.selected&&je.append(Ze.name,O.value)}):Ze.type==="checkbox"||Ze.type==="radio"?Ze.checked&&je.append(Ze.name,Ze.value):(Ce=Ze.type==="textarea"?le(Ze.value):Ze.value,je.append(Ze.name,Ce))})};if((e=Cn.prototype).append=function(Re,je,Ze){ie(arguments,2),this.i.push(fe(Re,je,Ze))},e.delete=function(Re){ie(arguments,1);var je=[];Re=String(Re),ne(this.i,function(Ze){Ze[0]!==Re&&je.push(Ze)}),this.i=je},e.entries=function Re(){var je,Ze=this;return Y(Re,function(Ce){if(Ce.h==1&&(je=0),Ce.h!=3)return je<Ze.i.length?Ce=R(Ce,Ze.i[je]):(Ce.h=0,Ce=void 0),Ce;je++,Ce.h=2})},e.forEach=function(Re,je){ie(arguments,1);for(var Ze=f(this),Ce=Ze.next();!Ce.done;Ce=Ze.next()){var O=f(Ce.value);Ce=O.next().value,O=O.next().value,Re.call(je,O,Ce,this)}},e.get=function(Re){ie(arguments,1);var je=this.i;Re=String(Re);for(var Ze=0;Ze<je.length;Ze++)if(je[Ze][0]===Re)return je[Ze][1];return null},e.getAll=function(Re){ie(arguments,1);var je=[];return Re=String(Re),ne(this.i,function(Ze){Ze[0]===Re&&je.push(Ze[1])}),je},e.has=function(Re){ie(arguments,1),Re=String(Re);for(var je=0;je<this.i.length;je++)if(this.i[je][0]===Re)return!0;return!1},e.keys=function Re(){var je,Ze,Ce,O,te=this;return Y(Re,function(oe){if(oe.h==1&&(je=f(te),Ze=je.next()),oe.h!=3)return Ze.done?void(oe.h=0):(Ce=Ze.value,O=f(Ce),R(oe,O.next().value));Ze=je.next(),oe.h=2})},e.set=function(Re,je,Ze){ie(arguments,2),Re=String(Re);var Ce=[],O=fe(Re,je,Ze),te=!0;ne(this.i,function(oe){oe[0]===Re?te&&(te=!Ce.push(O)):Ce.push(oe)}),te&&Ce.push(O),this.i=Ce},e.values=function Re(){var je,Ze,Ce,O,te=this;return Y(Re,function(oe){if(oe.h==1&&(je=f(te),Ze=je.next()),oe.h!=3)return Ze.done?void(oe.h=0):(Ce=Ze.value,(O=f(Ce)).next(),R(oe,O.next().value));Ze=je.next(),oe.h=2})},Cn.prototype._asNative=function(){for(var Re=new Te,je=f(this),Ze=je.next();!Ze.done;Ze=je.next()){var Ce=f(Ze.value);Ze=Ce.next().value,Ce=Ce.next().value,Re.append(Ze,Ce)}return Re},Cn.prototype._blob=function(){var Re="----formdata-polyfill-"+Math.random(),je=[],Ze="--"+Re+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Ce,O){return typeof Ce=="string"?je.push(Ze+Ot(le(O))+`"\r
\r
`+le(Ce)+`\r
`):je.push(Ze+Ot(le(O))+'"; filename="'+Ot(Ce.name)+`"\r
Content-Type: `+(Ce.type||"application/octet-stream")+`\r
\r
`,Ce,`\r
`)}),je.push("--"+Re+"--"),new Blob(je,{type:"multipart/form-data; boundary="+Re})},Cn.prototype[Symbol.iterator]=function(){return this.entries()},Cn.prototype.toString=function(){return"[object FormData]"},Et&&!Et.matches&&(Et.matches=Et.matchesSelector||Et.mozMatchesSelector||Et.msMatchesSelector||Et.oMatchesSelector||Et.webkitMatchesSelector||function(Re){for(var je=(Re=(this.document||this.ownerDocument).querySelectorAll(Re)).length;0<=--je&&Re.item(je)!==this;);return-1<je}),Vt&&(Cn.prototype[Vt]="FormData"),Ne){var Er=_e.XMLHttpRequest.prototype.setRequestHeader;_e.XMLHttpRequest.prototype.setRequestHeader=function(Re,je){Er.call(this,Re,je),Re.toLowerCase()==="content-type"&&(this.B=!0)},_e.XMLHttpRequest.prototype.send=function(Re){Re instanceof Cn?(Re=Re._blob(),this.B||this.setRequestHeader("Content-Type",Re.type),Ne.call(this,Re)):Ne.call(this,Re)}}Ke&&(_e.fetch=function(Re,je){return je&&je.body&&je.body instanceof Cn&&(je.body=je.body._blob()),Ke.call(this,Re,je)}),St&&(_e.navigator.sendBeacon=function(Re,je){return je instanceof Cn&&(je=je._asNative()),St.call(this,Re,je)}),_e.FormData=Cn}})();const rw=()=>{const e=z("AREAS");return e.length===0&&e.push(Nn.GLOBAL),To(e).call(e,(t,r,a)=>{const c=o7(r);return c?a===0?c:"".concat(t,",").concat(c):t},"")},o7=e=>e===Nn.OVERSEA?"".concat(Ni.ASIA,",").concat(Ni.EUROPE,",").concat(Ni.AFRICA,",").concat(Ni.NORTH_AMERICA,",").concat(Ni.SOUTH_AMERICA,",").concat(Ni.OCEANIA):Ni[e],Due=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(r=>{const a=RI[r],c=Object.keys(a);c&&c.map(d=>{d!=="CODE"&&(t[d]=t[d].concat(a[d]))})}),t},MI={GLOBAL:{ASIA:[Nn.CHINA,Nn.JAPAN,Nn.INDIA,Nn.KOREA,Nn.HKMC],EUROPE:[],NORTH_AMERICA:[Nn.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},UI=Object.keys(MI[Nn.GLOBAL]),UM=[Nn.CHINA,Nn.NORTH_AMERICA,Nn.EUROPE,Nn.ASIA,Nn.JAPAN,Nn.INDIA,Nn.OCEANIA,Nn.SOUTH_AMERICA,Nn.AFRICA,Nn.KOREA,Nn.HKMC,Nn.US],Pue=function(e,t){let r=[];if(ke(e).call(e,Nn.GLOBAL)){const d=[Nn.GLOBAL,Nn.OVERSEA],h=Object.keys(RI);if(t===Nn.GLOBAL)throw new Ee(K.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===Nn.CHINA)r=[Nn.OVERSEA];else if(c=t,ke(UI).call(UI,c)){const f=(a=t,MI[Nn.GLOBAL][a]||[]),m=[...d,t,...f];r=h.filter(v=>!ke(m).call(m,v))}else if(function(f){let m=!1;return UI.forEach(v=>{var E;ke(E=MI[Nn.GLOBAL][v]).call(E,f)&&(m=!0)}),m}(t)){const f=function(v){let E;return UI.forEach(w=>{var S;ke(S=MI[Nn.GLOBAL][w]).call(S,v)&&(E=w)}),E}(t),m=[...d,f,t];r=h.filter(v=>!ke(m).call(m,v))}else r=e;r=function(f){const m=[];return UM.forEach(v=>{ke(f).call(f,v)&&m.push(v)}),m.concat(f.filter(v=>!ke(UM).call(UM,v)))}(r)}else r=e;var a,c;return r};function c7(e){var t,r;if(!e&&ke(t=z("AREAS")).call(t,Nn.EXTENSIONS))return I.debug("update area from ap : reset"),void VM(Gde,!0);if(!ke(r=z("AREAS")).call(r,Nn.GLOBAL)||!e)return;let a=RI.EXTENSIONS;a&&(a={CODE:o7(Nn.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},I.debug("update area from ap success: ".concat(e,",config is "),a),Wn("AREAS",[Nn.EXTENSIONS],!0),Object.keys(a).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?Wn(c,a[c][0]):Wn(c,a[c])}))}function VM(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=tt.reportApiInvoke(null,{name:_r.SET_AREA,options:e,tag:$n.TRACER});try{let a=[];if(typeof e=="string"&&(a=[e]),Array.isArray(e)&&(e.forEach(d=>{if(!ke(kH).call(kH,d))throw new Ee(K.INVALID_PARAMS,"invalid area code")}),a=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:d,excludedArea:h}=e;if(!d)throw new Ee(K.INVALID_PARAMS,"area code is needed");let f=d;typeof d=="string"&&(f=[d]),a=h?Pue(f,h):f}if(!t){if(tc.AREAS){const d=new Ee(K.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return r.onError(d),void I.warning("setArea is prohibited because of config-distribute")}if(ke(a).call(a,Nn.GLOBAL)&&z("AREAS")===Nn.EXTENSIONS){const d=new Ee(K.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return r.onError(d),void I.warning("setArea is prohibited because of ap extensions")}}Wn("AREAS",a,t);const c=Due(a);Object.keys(c).map(d=>{d==="LOG_UPLOAD_SERVER"||d==="EVENT_REPORT_DOMAIN"||d==="EVENT_REPORT_BACKUP_DOMAIN"||d==="PROXY_SERVER_TYPE3"?Wn(d,c[d][0]):Wn(d,c[d])}),I.debug("set area success:",a.join(","))}catch(a){throw r.onError(a),a}r.onSuccess()}function l7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function Nu(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?l7(Object(r),!0).forEach(function(a){L(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l7(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}let FM=1;function Lue(e,t,r,a,c){FM+=1;const d={sid:r.sid,command:"convergeAllocateEdge",uid:"666",appId:r.appId,ts:Math.floor(Date.now()/1e3),seq:FM,requestId:FM,version:kc,cname:r.cname},h={service_name:t,json_body:JSON.stringify(d)};let f,m,v=e[0];return yd(async()=>{f=Date.now();const E=await Rd(v,{data:h,cancelToken:a,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(m=Date.now()-f,E.code!==0){const R=new Ee(K.UNEXPECTED_RESPONSE,"live streaming ap error, code"+E.code,{retry:!0,responseTime:m});throw I.error(R.toString()),R}const w=JSON.parse(E.json_body);if(w.code!==200){const R=new Ee(K.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(w.code,", reason: ").concat(w.reason),{code:w.code,responseTime:m});throw I.error(R.toString()),R}if(!w.servers||w.servers.length===0){const R=new Ee(K.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:w.code,responseTime:m});throw I.error(R.toString()),R}const S=function(R,j){return{addressList:R.servers.map(D=>"wss://".concat(D.address.replace(/\./g,"-"),".").concat(z("WORKER_DOMAIN"),":").concat(D.wss,"?serviceName=").concat(encodeURIComponent(j))),workerToken:R.workerToken,vid:R.vid}}(w,t);return z("LIVE_STREAMING_ADDRESS")&&(S.addressList=z("LIVE_STREAMING_ADDRESS")instanceof Array?z("LIVE_STREAMING_ADDRESS"):[z("LIVE_STREAMING_ADDRESS")]),Nu(Nu({},S),{},{responseTime:m})},(E,w)=>(tt.apworkerEvent(r.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(E.addressList),firstSuccess:w===0,responseTime:m,serverIp:e[w%e.length]}),!1),(E,w)=>(tt.apworkerEvent(r.sid,{success:!1,sc:E.data&&E.data.code||200,serviceName:t,responseTime:m,serverIp:e[w%e.length]}),!!(E.code!==K.OPERATION_ABORTED&&E.code!==K.UNEXPECTED_RESPONSE||E.data&&E.data.retry)&&(v=e[(w+1)%e.length],!0)),c)}let BM=1;function d7(e,t,r,a){let{url:c,areaCode:d}=e;const{clientId:h,sid:f}=t,m=Date.now();let v;const E=t.role,[w,S]=GM(t,d,[ds.CHOOSE_SERVER]);let R=jr.networkState;return yd(async()=>{R&&jr.networkState===fa.OFFLINE&&jr.onlineWaiter&&await Ue.race([jr.onlineWaiter,Ds(a&&a.maxRetryTimeout||ls.maxRetryTimeout)]),R=jr.networkState;const{data:j,headers:D}=await Rd(c,{data:w,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);v=D.http3==="1"?1:-1,tt.reportResourceTiming(c,f),h7(j,c,t,m,[ds.CHOOSE_SERVER],v);const P=Jx(j,ds.CHOOSE_SERVER);return zM(P),NM(P,c)},j=>(j&&tt.joinChooseServer(f,{role:E,lts:m,succ:!0,csAddr:c,opid:S,serverList:j.gatewayAddrs.map(D=>D.address),ec:null,cid:j.cid.toString(),uid:j.uid.toString(),csIp:j.csIp,unilbsServerIds:[ds.CHOOSE_SERVER].toString(),isHttp3:v,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:j.res.detail&&j.res.detail[38],vid:j.vid}),!1),j=>j.code!==K.OPERATION_ABORTED&&(j.code===K.CAN_NOT_GET_GATEWAY_SERVER?j.data.retry:(tt.joinChooseServer(f,{role:E,lts:m,succ:!1,csAddr:c,serverList:null,opid:S,ec:j.code,csIp:j.data&&j.data.csIp,unilbsServerIds:[ds.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:R}),isHttp3:v,corssRegionTagReq:t.apRequestDetail}),I.warning("[".concat(h||"sid-".concat(f.slice(0,6)),"] Choose server network error, retry"),j),!0)),a)}function u7(e,t,r,a){let c,{url:d,areaCode:h,serviceIds:f}=e;const m=Date.now(),v=t.role,[E,w]=GM(t,h,f);let S;return yd(async()=>{S&&jr.networkState===fa.OFFLINE&&jr.onlineWaiter&&await Ue.race([jr.onlineWaiter,Ds(a&&a.maxRetryTimeout||ls.maxRetryTimeout)]),S=jr.networkState;const{data:R,headers:j}=await Rd(d,{data:E,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=j.http3==="1"?1:-1,tt.reportResourceTiming(d,t.sid),h7(R,d,t,m,f,c);const D=Jx(R,ds.CHOOSE_SERVER),P=Jx(R,t.cloudProxyServer==="proxy5"?ds.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?ds.CLOUD_PROXY:ds.CLOUD_PROXY_FALLBACK),W=performance.getEntriesByName(d),Y=W[W.length-1];let ne;return Y&&(ne={name:Y.name,protocol:"nextHopProtocol"in Y?Y.nextHopProtocol:"",dnscost:"domainLookupEnd"in Y&&"domainLookupStart"in Y&&typeof Y.domainLookupEnd=="number"&&typeof Y.domainLookupStart=="number"?Y.domainLookupEnd-Y.domainLookupStart:-1,tcpTlsCost:"connectEnd"in Y&&"connectStart"in Y&&typeof Y.connectEnd=="number"&&typeof Y.connectStart=="number"?Y.connectEnd-Y.connectStart:-1,reqCost:"requestStart"in Y&&typeof Y.requestStart=="number"&&"responseEnd"in Y&&typeof Y.responseEnd=="number"?Y.responseEnd-Y.requestStart:-1,handleCost:"leave_ts"in R&&"enter_ts"in R&&typeof R.leave_ts=="number"&&typeof R.enter_ts=="number"?R.leave_ts-R.enter_ts:-1}),zM(D),{gatewayInfo:NM(D,d),proxyInfo:P,url:d,resourceTimingInfo:ne}},R=>{var j;return R.gatewayInfo&&tt.joinChooseServer(t.sid,{role:v,lts:m,succ:!0,csAddr:d,serverList:R.gatewayInfo.gatewayAddrs.map(D=>D.address),ec:null,opid:w,cid:R.gatewayInfo.cid.toString(),uid:R.gatewayInfo.uid.toString(),csIp:R.gatewayInfo.csIp,unilbsServerIds:f.toString(),isHttp3:c,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:R.gatewayInfo.res.detail&&R.gatewayInfo.res.detail[38],vid:(j=R.gatewayInfo)===null||j===void 0?void 0:j.vid,resourceTimingInfo:R.resourceTimingInfo?JSON.stringify(R.resourceTimingInfo):void 0}),R.proxyInfo&&tt.joinWebProxyAP(t.sid,{lts:m,sucess:1,apServerAddr:d,turnServerAddrList:R.proxyInfo.addresses.map(D=>D.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:f.toString()}),!1},R=>R.code!==K.OPERATION_ABORTED&&(R.code===K.CAN_NOT_GET_GATEWAY_SERVER?R.data.retry:(tt.joinWebProxyAP(t.sid,{lts:m,sucess:0,apServerAddr:d,turnServerAddrList:null,errorCode:R.code,eventType:t.cloudProxyServer,unilbsServerIds:f.toString(),extend:JSON.stringify({networkState:S})}),I.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),R),!0)),a)}const h7=(e,t,r,a,c,d)=>{const{sid:h,clientId:f,cloudProxyServer:m}=r,v=[],E=w=>{w.flag===4096?tt.joinChooseServer(h,{role:r.role,lts:a,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:w.error.message,csIp:w.error.data&&w.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:d,corssRegionTagReq:r.apRequestDetail}):w.flag!==1048576&&w.flag!==4194304&&w.flag!==4194310||tt.joinWebProxyAP(h,{lts:a,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:w.error.code,eventType:m,unilbsServerIds:c.toString()})};if(e.response_body.forEach(w=>{const S=w.buffer.code;if(w.uri===23&&S===0&&!w.buffer.edges_services)if(w.buffer.flag===4194310)I.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),w.buffer.edges_services=[];else{const R={error:new Ee(K.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:z("NO_EDGES_RETRY"),csIp:e.detail[502]}),flag:w.buffer.flag};v.push(R),E(R)}if(S!==0){const R=Qv(S),j={error:new Ee(K.CAN_NOT_GET_GATEWAY_SERVER,R.desc,{desc:R.desc,retry:R.retry,csIp:e.detail[502]}),flag:w.buffer.flag};w.buffer.flag===4194310?I.warning(j.error.toString()):v.push(j),E(j)}}),v.length)throw I.warning("[".concat(f||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(v.map(w=>"flag: ".concat(w.flag,", message: ").concat(w.error.message,", retry: ").concat(w.error.data.retry)).join(" | "))),new Ee(K.CAN_NOT_GET_GATEWAY_SERVER,v.map(w=>"flag: ".concat(w.flag,", message: ").concat(w.error.message)).join(" | "),{retry:!!v.find(w=>w.error.data.retry),csIp:e.detail[502],desc:[...new Set(v.map(w=>{var S;return w==null||(S=w.error)===null||S===void 0||(S=S.data)===null||S===void 0?void 0:S.desc}).filter(w=>!!w))]})},zM=e=>{var t,r,a,c;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new Ee(K.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(z("AP_AREA")&&((a=e.detail)!==null&&a!==void 0&&a[23]&&typeof((c=e.detail)===null||c===void 0?void 0:c[23])=="string"?c7(e.detail[23].toLowerCase()):c7()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((r=e.detail)===null||r===void 0?void 0:r[19])=="string"){const h=e.detail[19],f=h==null?void 0:h.split(";");for(let m=0;m<f.length;m++){var d;const v=ha(d=f[m]).call(d);e.addresses[m]&&f&&(e.addresses[m].fingerprint=v)}}if(z("GATEWAY_ADDRESS")&&z("GATEWAY_ADDRESS").length>0){I.debug("assign gateway address to",z("GATEWAY_ADDRESS"));const h=z("GATEWAY_ADDRESS").map(f=>{var m,v;const E=(m=(v=e.addresses.find(w=>w.ip===f.ip&&w.port===f.port))===null||v===void 0?void 0:v.fingerprint)!==null&&m!==void 0?m:"";return{ip:f.ip,port:f.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:f.fingerprint||E}});e.addresses=h}},jue=(e,t)=>{if(e.response_body&&e.response_body.length){const r=e.response_body[0];if(r.buffer.code!==0){const a=Qv(r.buffer.code);throw new Ee(K.UPDATE_TICKET_FAILED,"[".concat(r.buffer.code,"]: ").concat(a.desc),{retry:a.retry})}return r.buffer.ticket}throw I.debug("update ticket request received ap response without response body:",t),new Ee(K.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},GM=(e,t,r)=>{const a=Math.floor(Math.random()*1e12),c=e.role==="host"?"1":e.role==="audience"?"2":void 0,d={appid:e.appId,client_ts:Date.now(),opid:a,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Nu(Nu(Nu({6:e.stringUid,11:t,12:z("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:r,uid:e.uid||0}}]};d.request_bodies.forEach(f=>{e.multiIP&&e.multiIP.gateway_ip&&(f.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(d)),[h,a]},Mue=(e,t)=>{const r=Math.floor(Math.random()*1e12),a={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(d=>({ip:d.ip,port:d.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(a)),[c,r]};let tE=0;function nE(e){return Ue.all(e.map(t=>t.then(r=>{throw r},r=>r))).then(t=>{throw t},t=>t)}const sw=async e=>{let{fragementLength:t,referenceList:r,asyncMapHandler:a,allFailedhandler:c,promisesCollector:d}=e,h=0;const f=t;let m,v=0;const E=async()=>{const w=(()=>{const S=h*f,R=S+f;return r.slice(S,R).map(a)})();d&&d.push(...w);try{m=await nE(w)}catch(S){if(v+=f,h++,!(v>=r.length))return void await E();c(S)}w.forEach(S=>S.cancel())};return await E(),m},p7=async e=>{let{referenceList:t,asyncMapHandler:r,closeFn:a}=e;const c=t.length;let d=0;const h=async()=>{const f=r(t.shift());try{return await f}catch(m){if(d++,d>=c||a!=null&&a(m))throw m;return h()}};return h()};async function Uue(){if(typeof VideoDecoder>"u")return!0;let e;const t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],a=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],c=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],d=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],h=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new Ue((m,v)=>{let E;(async function(){e&&e.state!=="closed"||await async function(){e=new VideoDecoder({output:S=>{S.close(),clearTimeout(E),m(!0)},error:S=>{clearTimeout(E),m(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})}();const w=[t,r,a,c,d,h];for(let S=0;S<w.length;S++){const R=new EncodedVideoChunk({type:S==0?"key":"delta",timestamp:33333*S,duration:33333,data:new Uint8Array(w[S])});try{await e.decode(R)}catch{return void m(!1)}}})(),E=setTimeout(()=>{m(!1)},5e3)})}async function VI(e,t,r,a){return{gatewayInfo:await async function(d,h,f,m){let v=null;const E=[],w=async()=>{const R=z("WEBCS_DOMAIN").slice(0,z("AJAX_REQUEST_CONCURRENT")).map(P=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(P+"/api/v2/transpond/webrtc?v=2"):"https://".concat(P,"/api/v2/transpond/webrtc?v=2"),areaCode:rw()})),j=m.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map(P=>P.url)}),D=await sw({fragementLength:z("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:P=>(I.debug("[".concat(d.clientId,"] Connect to choose_server:"),P.url),d7(P,d,h,f)),allFailedhandler:P=>{throw m.recordJoinChannelService({endTs:Date.now(),status:"error",errors:P},j),P[0]},promisesCollector:E});return m.recordJoinChannelService({endTs:Date.now(),status:"success"},j),D},S=async()=>{if(await Ds(1e3),v!==null)return v;const R=z("WEBCS_DOMAIN_BACKUP_LIST").map(P=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(P+"/api/v2/transpond/webrtc?v=2"):"https://".concat(P,"/api/v2/transpond/webrtc?v=2"),areaCode:rw()})),j=m.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map(P=>P.url)}),D=await sw({fragementLength:z("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:P=>(I.debug("[".concat(d.clientId,"] Connect to backup choose_server:"),P.url),d7(P,d,h,f)),allFailedhandler:P=>{throw m.recordJoinChannelService({endTs:Date.now(),status:"error",errors:P},j),P[0]},promisesCollector:E});return m.recordJoinChannelService({endTs:Date.now(),status:"success"},j),D};try{return v=await nE([w(),S()]),E.length&&E.forEach(R=>R.cancel&&typeof R.cancel=="function"&&R.cancel()),v}catch(R){throw R[0]}}(e,t,r,a)}}async function f7(e,t,r,a,c){const d=e.cloudProxyServer;if(d==="disabled"){if(e.useLocalAccessPoint)return await VI(e,t,r,c);if(z("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:S,proxyInfo:R}=await _7(e,t,r,c);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:S};const j=R.map(D=>({turnServerURL:D.address,tcpport:D.tcpport||mi.tcpport,udpport:D.udpport||mi.udpport,username:D.username||mi.username,password:D.password||mi.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const D=(h=e.uid)!==null&&h!==void 0?h:S.uid,P="glb:".concat(D.toString()),W=await Tj(P),Y=R.map(ne=>({turnServerURL:ne.address,tcpport:ne.tcpport||mi.tcpport,udpport:ne.udpport||mi.udpport,username:P,password:W,forceturn:!1,security:!0}));j.push(...Y)}return e.turnServer={mode:"manual",servers:j},{gatewayInfo:S}}return await VI(e,t,r,c)}const{proxyInfo:f,gatewayInfo:m}=await _7(e,t,r,c),v={gatewayInfo:m},E=f.map(S=>({turnServerURL:S.address,tcpport:d==="proxy3"?void 0:S.tcpport?S.tcpport:mi.tcpport,udpport:d==="proxy4"?void 0:S.udpport?S.udpport:mi.udpport,username:S.username||mi.username,password:S.password||mi.password,forceturn:d!=="proxy4",security:d==="proxy5"}));if(c.useP2P){var w;const S=(w=e.uid)!==null&&w!==void 0?w:m.uid,R="glb:".concat(S.toString()),j=await Tj(R),D=f.map(P=>({turnServerURL:P.address,tcpport:d==="proxy3"?void 0:P.tcpport||mi.tcpport,udpport:d==="proxy4"?void 0:P.udpport||mi.udpport,username:R,password:j,forceturn:d!=="proxy4",security:d==="proxy5"}));E.push(...D)}return e.turnServer={mode:"manual",servers:E},I.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(d)),v}async function m7(e,t,r,a,c){const d=z("ACCOUNT_REGISTER").slice(0,z("AJAX_REQUEST_CONCURRENT"));let h=[];h=t.proxyServer?d.map(m=>"https://".concat(t.proxyServer,"/ap/?url=").concat(m+"/api/v1")):d.map(m=>"https://".concat(m,"/api/v1"));const f=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const m=await async function(v,E,w,S,R){const j=Date.now(),D={sid:w.sid,opid:10,appid:w.appId,string_uid:E};let P=v[0];const W=await yd(()=>Rd(P+"".concat(P.indexOf("?")===-1?"?":"&","action=stringuid"),{data:D,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(Y,ne)=>{if(Y.code===0){if(Y.uid<=0||Y.uid>=Math.pow(2,32))throw I.error("Invalid Uint Uid ".concat(E," => ").concat(Y.uid),Y),tt.reqUserAccount(D.sid,{lts:j,success:!1,serverAddr:P,stringUid:D.string_uid,uid:Y.uid,errorCode:K.INVALID_UINT_UID_FROM_STRING_UID,extend:D}),new Ee(K.INVALID_UINT_UID_FROM_STRING_UID);return tt.reqUserAccount(D.sid,{lts:j,success:!0,serverAddr:P,stringUid:D.string_uid,uid:Y.uid,errorCode:null,extend:D}),!1}const le=Qv(Y.code);return le.retry&&(P=v[(ne+1)%v.length]),tt.reqUserAccount(D.sid,{lts:j,success:!1,serverAddr:P,stringUid:D.string_uid,uid:Y.uid,errorCode:le.desc,extend:D}),le.retry},(Y,ne)=>Y.code!==K.OPERATION_ABORTED&&(tt.reqUserAccount(D.sid,{lts:j,success:!1,serverAddr:P,stringUid:D.string_uid,uid:null,errorCode:Y.code,extend:D}),P=v[(ne+1)%v.length],!0),R);if(W.code!==0){const Y=Qv(W.code);throw new Ee(K.UNEXPECTED_RESPONSE,Y.desc)}return W}(h,e,t,r,a);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},f),m.uid}catch(m){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[m]},f),m}}async function Vue(e,t,r){const a=z("ACCOUNT_REGISTER");let c=[];c=t.proxyServer?a.map(d=>"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1")):a.map(d=>"https://".concat(d,"/api/v1"));try{return await p7({referenceList:c,asyncMapHandler:h=>async function(f,m,v,E){const w=Date.now(),S={sid:v.sid,opid:10,appid:v.appId,string_uid:m};try{const R=await Rd(f+"".concat(f.indexOf("?")===-1?"?":"&","action=stringuid"),{data:S,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(R.code!==0){const j=Qv(R.code);throw new Ee(K.UNEXPECTED_RESPONSE,"preload sua error:".concat(j.desc),j)}if(R.uid<=0||R.uid>=Math.pow(2,32))throw new Ee(K.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:w,url:f,req:S,uid:R.uid,elapse:Date.now()-w}}catch(R){throw R}}(h,e,t,r),closeFn:h=>h.code===K.OPERATION_ABORTED||h.code===K.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(d){throw d}}async function Fue(e,t,r){const a=z("CDS_AP").slice(0,z("AJAX_REQUEST_CONCURRENT")).map(m=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(m+"/api/v1"):"https://".concat(m,"/api/v1?action=config")),c=a.map(m=>function(v,E,w,S){const R=yn(),j={flag:64,cipher_method:0,features:Nu(Nu(Nu(Nu(Nu({install_id:Uj(),device:R.name,system:R.os,system_general:navigator.userAgent,vendor:E.appId,version:kc,cname:E.cname,session_id:E.sid,proxyServer:E.proxyServer,sdk_type:Aue.WEB_RTC,browser_name:R.name,browser_version:R.version,user_agent:navigator.userAgent,channel_name:E.cname},E.stringUid&&{string_uid:E.stringUid}),E.uid&&{uid:E.uid+""}),R.os&&{os_name:R.os}),R.osVersion&&{os_version:R.osVersion}),{},{detail:""})};return yd(()=>Rd(v,{data:j,timeout:1e3,cancelToken:w,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,D=>D.code!==K.OPERATION_ABORTED,S)}(m,e,t,r));let d=null,h=null,f={};try{d=await nE(c)}catch(m){if(m.code===K.OPERATION_ABORTED)throw m;h=m}if(c.forEach(m=>m.cancel()),tt.reportApiInvoke(e.sid,{name:_r.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:d}}).onSuccess(),d&&d.test_tags)try{f=function(m){if(!m.test_tags)return{};const v=m.test_tags,E=Object.keys(v),w={};return E.forEach(S=>{var R;const j=ha(R=S.slice(4)).call(R),D=JSON.parse(v[S]),P=D[1];w[j]={tag:D[0]||"",value:P}}),w}(d)}catch{}return f}async function g7(e,t){const r=z("WEBCS_DOMAIN").concat(z("WEBCS_DOMAIN_BACKUP_LIST")).map(a=>({url:"https://".concat(a,"/api/v2/transpond/webrtc?v=2"),areaCode:rw(),serviceIds:[ds.CHOOSE_SERVER,ds.CLOUD_PROXY_FALLBACK]}));try{return await p7({referenceList:r,asyncMapHandler:c=>async function(d,h,f){let m,{url:v,areaCode:E,serviceIds:w}=d;const S=Date.now(),[R,j]=GM(h,E,w);let D=jr.networkState;try{D&&jr.networkState===fa.OFFLINE&&jr.onlineWaiter&&await Ue.race([jr.onlineWaiter,Ds(ls.maxRetryTimeout)]),D=jr.networkState;const{data:P,headers:W}=await Rd(v,{data:R,cancelToken:f,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);m=W.http3==="1"?1:-1,(fe=>{const ie=[];if(fe.response_body.forEach(_e=>{const Te=_e.buffer.code;if(_e.uri===23&&Te===0&&!_e.buffer.edges_services)if(_e.buffer.flag===4194310)_e.buffer.edges_services=[];else{const Ne={error:new Ee(K.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:z("NO_EDGES_RETRY"),csIp:fe.detail[502]}),flag:_e.buffer.flag};ie.push(Ne)}if(Te!==0){const Ne=Qv(Te),Ke={error:new Ee(K.CAN_NOT_GET_GATEWAY_SERVER,Ne.desc,{desc:Ne.desc,retry:Ne.retry,csIp:fe.detail[502]}),flag:_e.buffer.flag};_e.buffer.flag===4194310?I.warning(Ke.error.toString()):ie.push(Ke)}}),ie.length)throw new Ee(K.CAN_NOT_GET_GATEWAY_SERVER,ie.map(_e=>"flag: ".concat(_e.flag,", message: ").concat(_e.error.message)).join(" | "),{retry:!!ie.find(_e=>_e.error.data.retry),csIp:fe.detail[502],desc:[...new Set(ie.map(_e=>{var Te;return _e==null||(Te=_e.error)===null||Te===void 0||(Te=Te.data)===null||Te===void 0?void 0:Te.desc}).filter(_e=>!!_e))]})})(P);const ne=Jx(P,ds.CHOOSE_SERVER),le=Jx(P,ds.CLOUD_PROXY_FALLBACK);return zM(ne),{gatewayInfo:NM(ne,v),proxyInfo:le,opid:j,requestTime:S,url:v,isHttp3:m,elapse:Date.now()-S}}catch(P){throw P}}(c,e,t),closeFn:c=>c.code===K.OPERATION_ABORTED||c.code===K.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(a){throw a}}async function _7(e,t,r,a){const c=z("PROXY_SERVER_TYPE3"),d=(R,j,D)=>{let P=D||c;return Array.isArray(P)&&(P=j%2==0&&c[1]||c[0]),"https://".concat(P,"/ap/?url=").concat(R)};let h=null;const f=[],m=async()=>{const R=z("WEBCS_DOMAIN").slice(0,z("AJAX_REQUEST_CONCURRENT")).map((P,W)=>{let Y;return Y=e.cloudProxyServer==="disabled"&&e.proxyServer?d("".concat(P,"/api/v2/transpond/webrtc?v=2"),W,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(P,"/api/v2/transpond/webrtc?v=2"):d("".concat(P,"/api/v2/transpond/webrtc?v=2"),W),{url:Y,areaCode:rw(),serviceIds:[ds.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?ds.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?ds.CLOUD_PROXY:ds.CLOUD_PROXY_FALLBACK]}}),j=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map(P=>P.url)}),D=await sw({fragementLength:z("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:P=>(I.debug("[".concat(e.clientId,"] Connect to choose_server:"),P.url),u7(P,e,t,r)),allFailedhandler:P=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:P},j),P[0]},promisesCollector:f});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},j),D},v=async()=>{if(await Ds(1e3),h!==null)return h;const R=z("WEBCS_DOMAIN_BACKUP_LIST").map((P,W)=>{let Y;return Y=e.cloudProxyServer==="disabled"&&e.proxyServer?d("".concat(P,"/api/v2/transpond/webrtc?v=2"),W,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(P,"/api/v2/transpond/webrtc?v=2"):d("".concat(P,"/api/v2/transpond/webrtc?v=2"),W),{url:Y,areaCode:rw(),serviceIds:[ds.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?ds.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?ds.CLOUD_PROXY:ds.CLOUD_PROXY_FALLBACK]}}),j=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map(P=>P.url)}),D=await sw({fragementLength:z("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:P=>(I.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),P.url),u7(P,e,t,r)),allFailedhandler:P=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:P},j),P[0]},promisesCollector:f});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},j),D};let E,w,S;try{({gatewayInfo:E,proxyInfo:w,url:S}=await nE([m(),v()]))}catch(R){throw R[0]}if(f.length&&f.forEach(R=>R.cancel&&typeof R.cancel=="function"&&R.cancel()),!E||!w)throw new Ee(K.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=S,e.cloudProxyServer!=="disabled"&&Array.isArray(c)&&S){const R=/^https?:\/\/(.+?)(\/.*)?$/.exec(S)[1];ke(c).call(c,R)&&(e.proxyServer=R,I.setProxyServer(R),tt.setProxyServer(R))}return h={gatewayInfo:E,proxyInfo:await BH(w,E.uid)},h}async function Bue(e,t,r){const a=z("UAP_AP").slice(0,z("AJAX_REQUEST_CONCURRENT")).map(d=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap")),c=a.map(d=>function(h,f,m,v){const E={command:"convergeAllocateEdge",sid:f.sid,appId:f.appId,token:f.token,ts:Date.now(),version:kc,cname:f.cname,uid:f.uid.toString(),requestId:BM,seq:BM};BM+=1;const w={service_name:"tele_channel",json_body:JSON.stringify(E)};return yd(async()=>{const S=await Rd(h,{data:w,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(S.code!==0){const j=new Ee(K.UNEXPECTED_RESPONSE,"cross channel ap error, code"+S.code,{retry:!0});throw I.error(j.toString()),j}const R=JSON.parse(S.json_body);if(R.code!==200){const j=new Ee(K.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(R.code,", reason: ").concat(R.reason));throw I.error(j.toString()),j}if(!R.servers||R.servers.length===0){const j=new Ee(K.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw I.error(j.toString()),j}return{vid:R.vid,workerToken:R.workerToken,addressList:(z("CHANNEL_MEDIA_RELAY_SERVERS")||R.servers).map(j=>"wss://".concat(j.address.replace(/\./g,"-"),".").concat(z("WORKER_DOMAIN"),":").concat(j.wss))}},void 0,S=>!!(S.code!==K.OPERATION_ABORTED&&S.code!==K.UNEXPECTED_RESPONSE||S.data&&S.data.retry),v)}(d,e,t,r));try{const d=await nE(c);return c.forEach(h=>h.cancel()),d}catch(d){throw d[0]}}async function zue(e,t,r){let a=null;const c=[],d=async h=>{const f=z(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(m=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(m+"/api/v2/transpond/webrtc?v=2"):"https://".concat(m,"/api/v2/transpond/webrtc?v=2"));return h&&(await Ds(1e3),a!==null)?a:await sw({fragementLength:z("FRAGEMENT_LENGTH"),referenceList:f,asyncMapHandler:m=>(I.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),m),function(v,E,w,S){const[R]=Mue(E,[ds.CHOOSE_SERVER]);let j=jr.networkState;return yd(async()=>{j&&jr.networkState===fa.OFFLINE&&jr.onlineWaiter&&await Ue.race([jr.onlineWaiter,Ds(S&&S.maxRetryTimeout||ls.maxRetryTimeout)]),j=jr.networkState;const D=await Rd(v,{data:R,cancelToken:w,headers:{"Content-Type":"multipart/form-data;"}},!0);return jue(D,v)},()=>!1,D=>D.code!==K.OPERATION_ABORTED&&(D.code===K.UPDATE_TICKET_FAILED?D.data.retry:(I.warning("[".concat(E.clientId,"] update ticket network error, retry"),D),!0)),S)}(m,e,t,r)),allFailedhandler:m=>{throw m[0]},promisesCollector:c})};try{return a=await nE([d(!1),d(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),a}catch(h){throw h[0]}}function v7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function WM(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?v7(Object(r),!0).forEach(function(a){L(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v7(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}class Gue extends br{get isSuccess(){return!!this.configs}constructor(t,r){super(),L(this,"configs",void 0),L(this,"store",void 0),L(this,"joinInfo",void 0),L(this,"cancelToken",void 0),L(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),L(this,"interval",void 0),L(this,"mutex",void 0),L(this,"mutableParamsRead",!1),L(this,"configCache",{}),L(this,"limit_bitrate",void 0),this.mutex=new Ks("config-distribute",t),this.store=r}startGetConfigDistribute(t,r){this.joinInfo=t,this.cancelToken=r,this.interval&&this.stopGetConfigDistribute(),z("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},z("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,tt.reportApiInvoke(null,{options:void 0,name:_r.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:$n.TRACER}).onSuccess(JSON.stringify(tc))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void I.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const r=await this.mutex.lock();try{t=await Fue(this.joinInfo,this.cancelToken,this.retryConfig),I.debug("[config-distribute] get config distribute",JSON.stringify(t));const a=function(c){var d;const h=Th(d=Object.keys(c).filter(v=>/^webrtc_ng_global_parameter/.test(v))).call(d);for(let v=0;v<h.length;v++)for(let E=h.length-1;E>v;E--){const w=h[E],S=c[w].value;if(typeof S.__priority=="number"){const R=S.__priority,j=h[E-1],D=c[j].value;if(typeof D.__priority=="number"){if(!(R>D.__priority))continue;{const P=w;h[E]=h[E-1],h[E-1]=P}}else{const P=w;h[E]=h[E-1],h[E-1]=P}}}const f=Date.now(),m={};return h.forEach(v=>{const E=c[v].value.__expires;E&&E<=f||(m[v]=c[v])}),m}(t);this.cacheGlobalParameterConfig(a),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=a}catch(a){const c=new Ee(K.NETWORK_RESPONSE_ERROR,a);I.warning("[config-distribute] ".concat(c.toString()))}finally{r()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){OH(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(wd.UPDATE_BITRATE_LIMIT,t):this.emit(wd.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&WM({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const r={},a=Object.keys(t),c=[];a.forEach(d=>{const h=t[d].value;r[d]=h;const f=h.__id;if(f&&this.configCache[d]&&this.configCache[d].__id===f)return;const m=h.__type,v=t[d].value,E=t[d].tag;let w=0;m?m===JG.REALTIME&&(w=1):Object.keys(v).some(S=>Object.prototype.hasOwnProperty.call(zj,S)||!gM()&&Object.prototype.hasOwnProperty.call(nI,S)?(w=1,!0):void 0),c.push({tag:E,isApplied:w,feature:d,params:JSON.stringify(h)})}),c.forEach(d=>{let{tag:h,feature:f,params:m,isApplied:v}=d;this.store.sessionId&&tt.abTest(this.store.sessionId,{intSucc:1,isApplied:v,tag:h,feature:f,params:m,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=r}catch(r){I.debug("handleABTestConfigDistribute error",r)}}cacheGlobalParameterConfig(t){const r=function(c){const d={};return Object.keys(c).forEach(h=>{const f=c[h].value,m=f.__expires,v=f.__type;Object.keys(f).forEach(E=>{E==="__id"||E==="__type"||E==="__priority"||E==="__expires"||Object.prototype.hasOwnProperty.call(d,E)||(d[E]=WM(WM({value:f[E]},m&&{expires:m}),v&&{type:v}))})}),d}(t);try{var a;const c=(a=r.LIMIT_BITRATE)===null||a===void 0?void 0:a.value;delete r.LIMIT_BITRATE,c&&OH(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(r),this.handleABTestConfigDistribute(t),function(f){try{const m=Date.now();Object.keys(f).forEach(v=>{const{value:E,type:w,expires:S}=f[v];S&&S<=m||((w===JG.REALTIME||Object.prototype.hasOwnProperty.call(zj,v))&&(tc[v]=E,Mn[v]=E,I.debug("Update realtime parameters from config distribute",v,E)),w||gM()||!Object.prototype.hasOwnProperty.call(nI,v)||(tc[v]=E,Mn[v]=E,I.debug("Update gateway parameters from config distribute",v,E)))})}catch(m){I.error("Error update config immediately: ".concat(f),m.message)}}(r);const d=JSON.stringify(r),h=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",h),I.debug("Caching global parameters ".concat(d))}catch(c){I.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(t){try{const r=Date.now();Object.keys(t).forEach(a=>{switch(a){case"CLIENT_ROLE_OPTIONS":if(Object.prototype.hasOwnProperty.call(Mn,a)){const{value:d,expires:h}=t[a];if(h&&h<=r)return;Aj(Mn[a],d)||(tc[a]=d,Mn[a]=d,this.emit(wd.UPDATE_CLIENT_ROLE_OPTIONS,d),I.debug("Updating client role options: ".concat(JSON.stringify(d))))}break;case"REMOTE_VIDEO_STREAM_TYPE":if(Object.prototype.hasOwnProperty.call(Mn,a)){var c;const{value:d,expires:h}=t[a];if(h&&h<=r)return;typeof d=="number"&&ke(c=[0,1,4,5,6,7,8,9]).call(c,d)&&(tc[a]={value:d},Mn[a]=d,this.emit(wd.UPDATE_REMOTE_VIDEO_STREAM_TYPE,d),I.debug("Updating client remote stream type: ".concat(JSON.stringify(d))))}break;case"ENABLE_FORCE_HLS":if(Object.prototype.hasOwnProperty.call(Mn,a)){const{value:d,expires:h}=t[a];if(h&&h<=r)return;Aj(Mn[a],d)||(tc[a]=d,Mn[a]=d,this.emit(wd.FALLBACK_TO_HLS,d),I.debug("Updating enable force hls: ".concat(JSON.stringify(d))))}break;case"VOS_CONFIGURE":if(Object.prototype.hasOwnProperty.call(Mn,a)){const{value:d,expires:h}=t[a];if(h&&h<=r)return;Aj(Mn[a],d)||(tc[a]=d,Mn[a]=d,this.emit(wd.UPDATE_VOS_CONFIGURE,d),I.debug("Updating vos configure: ".concat(JSON.stringify(d))))}}})}catch(r){I.error("Error handling global parameter config:",r.message)}}}class Wue extends br{constructor(){super(...arguments),L(this,"resultStorage",new Map)}setLocalAudioStats(t,r,a){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(a,r)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(a,r))}setLocalVideoStats(t,r,a){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(a,r)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(a,r)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(a)),!r.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(a))}setRemoteAudioStats(t,r){const a=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",a,this.checkAudioOutputLevel(r))}setRemoteVideoStats(t,r){const a=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",a,this.checkVideoDecode(r))}record(t,r,a){if(z("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(t);if(!c)return;c.result.push(a);const d=t==="VIDEO_ENCODE_FAILED"?z("ENCODE_EXCEPTION_TIMES"):5;if(c.result.length>=d){var h;const f=ke(h=c.result).call(h,!0);c.isPrevNormal&&!f&&this.emit("exception",HM[t],t,r),!c.isPrevNormal&&f&&this.emit("exception",HM[t]+2e3,t+"_RECOVER",r),c.isPrevNormal=f,c.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,r){return r instanceof bs&&!r.isActive||!!r.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,r){let a=null;r._encoderConfig&&r._encoderConfig.frameRate&&(a=Ua(r._encoderConfig.frameRate));const c=t.captureFrameRate;return!a||!c||!(a>10&&c<5||a<10&&a>=5&&c<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var r;return!(!t.codecType||ke(r=z("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(r,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,r){return!!r.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,r){return r instanceof bs&&!r.isActive||!!r.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const HM={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},Ii=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(r.length>0){const a=r[r.length-1];return Math.round(performance.now()-a.startTime)}return 0}measureFromPublishStart(e,t){const r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(r.length>0){const a=r[r.length-1];return Math.round(performance.now()-a.startTime)}return 0}};function E7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function zg(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?E7(Object(r),!0).forEach(function(a){L(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E7(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}class iw{constructor(t){L(this,"store",void 0),L(this,"onStatsException",void 0),L(this,"onUploadPublishDuration",void 0),L(this,"onStatsChanged",void 0),L(this,"onVideoCodecChanged",void 0),L(this,"localStats",new Map),L(this,"remoteStats",new Map),L(this,"updateStatsInterval",void 0),L(this,"trafficStats",void 0),L(this,"trafficStatsPeerList",[]),L(this,"uplinkStats",void 0),L(this,"exceptionMonitor",void 0),L(this,"p2pChannel",void 0),L(this,"scalabilityMode",eI.L1T1),L(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new Wue,this.exceptionMonitor.on("exception",(r,a,c)=>{this.onStatsException&&this.onStatsException(r,a,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(De.LocalAudioTrack)||zg({},Yj)}getLocalVideoTrackStats(){return this.localStats.get(De.LocalVideoTrack)||zg({},Xj)}getRemoteAudioTrackStats(t){const r=(d,h)=>{if(!this.trafficStats)return h;const f=this.trafficStats.peer_delay.find(m=>m.peer_uid===d);return f&&(h.publishDuration=f.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},a={};if(t){var c;const d=(c=this.remoteStats.get(t))===null||c===void 0?void 0:c.audioStats;d&&(a[t]=r(t,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{audioStats:f}]=d;f&&(a[h]=r(h,f))});return a}getRemoteNetworkQualityStats(t){const r={};if(t){var a;const c=(a=this.remoteStats.get(t))===null||a===void 0?void 0:a.networkStats;c&&(r[t]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[d,{networkStats:h}]=c;h&&(r[d]=h)});return r}getNetworkQuality(){let t=0,r=0;return this.trafficStats&&(t=AI(this.trafficStats.B_unq),r=AI(this.trafficStats.B_dnq)),{uplinkNetworkQuality:t,downlinkNetworkQuality:r}}getRemoteVideoTrackStats(t){const r=(d,h)=>{if(!this.trafficStats)return h;const f=this.trafficStats.peer_delay.find(m=>m.peer_uid===d);return f&&(h.publishDuration=f.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},a={};if(t){var c;const d=(c=this.remoteStats.get(t))===null||c===void 0?void 0:c.videoStats;d&&(a[t]=r(t,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{videoStats:f}]=d;f&&(a[h]=r(h,f))});return a}getRTCStats(){let t=0,r=0,a=0,c=0;const d=this.localStats.get(De.LocalAudioTrack);d&&(t+=d.sendBytes,r+=d.sendBitrate);const h=this.localStats.get(De.LocalVideoTrack);h&&(t+=h.sendBytes,r+=h.sendBitrate);const f=this.localStats.get(De.LocalVideoLowTrack);f&&(t+=f.sendBytes,r+=f.sendBitrate),this.remoteStats.forEach(v=>{let{audioStats:E,videoStats:w}=v;E&&(a+=E.receiveBytes,c+=E.receiveBitrate),w&&(a+=w.receiveBytes,c+=w.receiveBitrate)});let m=1;return this.trafficStats&&(m+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:m,SendBitrate:r,SendBytes:t,RecvBytes:a,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(r=>r.B_ppad!==void 0||r.B_ppvd!==void 0),t.peer_delay.filter(r=>this.trafficStatsPeerList.indexOf(r.peer_uid)===-1).forEach(r=>{var a;const c=(a=this.p2pChannel)===null||a===void 0?void 0:a.getRemoteMedia(r.peer_uid),d=c!=null&&c.videoSSRC?Ii.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?Ii.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;r.B_ppad!==void 0&&r.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(r.peer_uid,r.B_ppad,r.B_ppvd,d>h?d:h),this.trafficStatsPeerList.push(r.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&I.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,r,a){if(!t)return!1;const c=!!a&&r.framesDecodeFreezeTime>a.framesDecodeFreezeTime,d=!a||r.framesDecodeCount>a.framesDecodeCount;return c||!d}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(r=>{let[a,c]=r;switch(a){case De.LocalVideoTrack:case De.LocalVideoLowTrack:{const f=c,m=zg({},Xj),v=t.getStats(),E=t.getLocalMedia(a);if(v){const w=v.videoSend.find(S=>S.ssrc===(E==null?void 0:E.ssrcs[0].ssrcId));if(w){const S=t.getLocalVideoSize(),R=t.getEncoderConfig(De.LocalVideoTrack);var d;(w.codec==="H264"||w.codec==="H265"||w.codec==="VP8"||w.codec==="VP9"||w.codec==="AV1X"||w.codec==="AV1")&&(m.codecType=w.codec,(f==null?void 0:f.codecType)!==w.codec&&((d=this.onVideoCodecChanged)===null||d===void 0||d.call(this,w.codec.toLocaleLowerCase()))),m.sendBytes=w.bytes,m.sendBitrate=f?8*Math.max(0,m.sendBytes-f.sendBytes):0,w.inputFrame?(m.captureFrameRate=w.inputFrame.frameRate,m.captureResolutionHeight=w.inputFrame.height,m.captureResolutionWidth=w.inputFrame.width):S&&(m.captureResolutionWidth=S.width,m.captureResolutionHeight=S.height),w.sentFrame?(m.sendFrameRate=w.sentFrame.frameRate,m.sendResolutionHeight=w.sentFrame.height,m.sendResolutionWidth=w.sentFrame.width):S&&(m.sendResolutionWidth=S.width,m.sendResolutionHeight=S.height),w.avgEncodeMs&&(m.encodeDelay=w.avgEncodeMs),R&&R.bitrateMax?m.targetSendBitrate=1e3*R.bitrateMax:w.targetBitrate&&(m.targetSendBitrate=w.targetBitrate),m.sendPackets=w.packets,m.sendPacketsLost=w.packetsLost,m.sendJitterMs=w.jitterMs,m.sendRttMs=w.rttMs,m.totalDuration=f?f.totalDuration+1:1,m.totalFreezeTime=f?f.totalFreezeTime:0,this.isLocalVideoFreeze(w)&&(m.totalFreezeTime+=1),w.scalabilityMode&&this.scalabilityMode!==w.scalabilityMode&&(I.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(w.scalabilityMode)),this.scalabilityMode=w.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var h;this.localStats.set(a,m),((f==null?void 0:f.sendResolutionWidth)!==m.sendResolutionWidth||(f==null?void 0:f.sendResolutionHeight)!==m.sendResolutionHeight)&&((h=this.onStatsChanged)===null||h===void 0||h.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&E&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,E.track,m);break}case De.LocalAudioTrack:{const f=c,m=zg({},Yj),v=t.getStats(),E=t.getLocalMedia(a);if(v){const w=v.audioSend.find(S=>S.ssrc===(E==null?void 0:E.ssrcs[0].ssrcId));if(w){if(w.codec!=="opus"&&w.codec!=="aac"&&w.codec!=="PCMU"&&w.codec!=="PCMA"&&w.codec!=="G722"||(m.codecType=w.codec),w.inputLevel)m.sendVolumeLevel=Math.round(32767*w.inputLevel);else{const S=t.getLocalAudioVolume();S&&(m.sendVolumeLevel=Math.round(32767*S))}m.sendBytes=w.bytes,m.sendPackets=w.packets,m.sendPacketsLost=w.packetsLost,m.sendJitterMs=w.jitterMs,m.sendRttMs=w.rttMs,m.sendBitrate=f?8*Math.max(0,m.sendBytes-f.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(De.LocalAudioTrack,m),m&&E&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,E.track,m);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(r=>{var a,c;let[d,{videoStats:h,audioStats:f,videoPcStats:m}]=r;const v=f,E=h,w=m,S=zg({},uW),R=zg({},hW),j=zg({},Ide),{audioTrack:D,videoTrack:P,audioSSRC:W,videoSSRC:Y}=t.getRemoteMedia(d);let ne;ne=this.store.useP2P?t.getStats(!0):t.getStats();const le=(a=ne)===null||a===void 0?void 0:a.audioRecv.find(Te=>Te.ssrc===W),fe=(c=ne)===null||c===void 0?void 0:c.videoRecv.find(Te=>Te.ssrc===Y),ie=this.trafficStats&&this.trafficStats.peer_delay.find(Te=>Te.peer_uid===d);if(le&&(le.codec!=="opus"&&le.codec!=="aac"&&le.codec!=="PCMU"&&le.codec!=="PCMA"&&le.codec!=="G722"||(S.codecType=le.codec),le.outputLevel?S.receiveLevel=Math.round(32767*le.outputLevel):D&&(S.receiveLevel=Math.round(32767*D.getVolumeLevel())),S.receiveBytes=le.bytes,S.receivePackets=le.packets,S.receivePacketsLost=le.packetsLost,S.receivePacketsDiscarded=le.packetsDiscarded,S.packetLossRate=S.receivePacketsLost/(S.receivePackets+S.receivePacketsLost),S.receiveBitrate=v?8*Math.max(0,S.receiveBytes-v.receiveBytes):0,S.totalDuration=v?v.totalDuration+1:1,S.totalFreezeTime=v?v.totalFreezeTime:0,S.freezeRate=S.totalFreezeTime/S.totalDuration,S.receiveDelay=le.jitterBufferMs,S.totalDuration>10&&iw.isRemoteAudioFreeze(D)&&(S.totalFreezeTime+=1)),fe){var _e;fe.codec!=="H264"&&fe.codec!=="H265"&&fe.codec!=="VP8"&&fe.codec!=="VP9"&&fe.codec!=="AV1X"&&fe.codec!=="AV1"||(R.codecType=fe.codec),R.receiveBytes=fe.bytes,R.receiveBitrate=E?8*Math.max(0,R.receiveBytes-E.receiveBytes):0,R.decodeFrameRate=fe.decodeFrameRate<0?0:fe.decodeFrameRate,R.renderFrameRate=fe.decodeFrameRate<0?0:fe.decodeFrameRate,fe.outputFrame&&(R.renderFrameRate=fe.outputFrame.frameRate),fe.receivedFrame?(R.receiveFrameRate=fe.receivedFrame.frameRate,R.receiveResolutionHeight=fe.receivedFrame.height,R.receiveResolutionWidth=fe.receivedFrame.width):P&&(R.receiveResolutionHeight=P._videoHeight||0,R.receiveResolutionWidth=P._videoWidth||0),fe.framesRateFirefox!==void 0&&(R.receiveFrameRate=Math.round(fe.framesRateFirefox)),R.receivePackets=fe.packets,R.receivePacketsLost=fe.packetsLost,R.packetLossRate=R.receivePacketsLost/(R.receivePackets+R.receivePacketsLost);const Te=E?E.totalFreezeTime:0,Ne=E?E.totalDuration:0;R.totalDuration=E?E.totalDuration+1:1,R.totalFreezeTime=(_e=fe.totalFreezesDuration)!==null&&_e!==void 0?_e:Te||0,R.receiveDelay=fe.jitterBufferMs||0;const Ke=!!Y&&t.getRemoteVideoIsReady(Y);fe.totalFreezesDuration===void 0&&P&&Ke&&iw.isRemoteVideoFreeze(P,fe,w)&&(R.totalFreezeTime+=1),R.freezeRate=Math.max(0,Math.min((R.totalFreezeTime-Te)/(R.totalDuration-Ne),1))}ie&&(S.end2EndDelay=ie.B_ad,R.end2EndDelay=ie.B_vd,S.transportDelay=ie.B_ed,R.transportDelay=ie.B_ed,S.currentPacketLossRate=ie.B_ealr4/100,R.currentPacketLossRate=ie.B_evlr4/100,j.uplinkNetworkQuality=ie.B_punq?ie.B_punq:0,j.downlinkNetworkQuality=ie.B_pdnq?ie.B_pdnq:0),this.remoteStats.set(d,{audioStats:S,videoStats:R,videoPcStats:fe,networkStats:j}),D&&this.exceptionMonitor.setRemoteAudioStats(D,S),P&&this.exceptionMonitor.setRemoteVideoStats(P,R)})}}class y7{constructor(){L(this,"destChannelMediaInfos",new Map),L(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){AH(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){AH(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){wI(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function b7(e){if(!(e instanceof y7))return new Ee(K.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),r=e.getDestChannelMediaInfo();if(!t)return new Ee(K.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(r.size===0)return new Ee(K.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class _f{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,r){L(this,"uid",void 0),L(this,"_uintid",void 0),L(this,"_trust_in_room_",!0),L(this,"_trust_audio_enabled_state_",!0),L(this,"_trust_video_enabled_state_",!0),L(this,"_trust_audio_mute_state_",!0),L(this,"_trust_video_mute_state_",!0),L(this,"_audio_muted_",!1),L(this,"_video_muted_",!1),L(this,"_audio_enabled_",!0),L(this,"_video_enabled_",!0),L(this,"_audio_added_",!1),L(this,"_video_added_",!1),L(this,"_is_pre_created",!1),L(this,"_video_pre_subscribed",!1),L(this,"_audio_pre_subscribed",!1),L(this,"_trust_video_stream_added_state_",!0),L(this,"_trust_audio_stream_added_state_",!0),L(this,"_audioTrack",void 0),L(this,"_videoTrack",void 0),L(this,"_dataChannels",[]),L(this,"_audioSSRC",void 0),L(this,"_videoSSRC",void 0),L(this,"_audioOrtc",void 0),L(this,"_videoOrtc",void 0),L(this,"_cname",void 0),L(this,"_rtxSsrcId",void 0),L(this,"_videoMid",void 0),L(this,"_audioMid",void 0),this.uid=t,this._uintid=r}}function x7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function KM(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?x7(Object(r),!0).forEach(function(a){L(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x7(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}const Hue=e=>`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1 2
a=msid-semantic: WMS
a=ice-lite`.concat(e?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:2
`),FI="9",qM=2e4,BI=4e4;let w7=class{get localCapabilities(){return ur(this._localCapabilities)}get rtpCapabilities(){return ur(this._rtpCapabilities)}get candidates(){return ur(this._candidates)}get iceParameters(){return ur(this._iceParameters)}get dtlsParameters(){return ur(this._dtlsParameters)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],a=arguments.length>3&&arguments[3]!==void 0&&arguments[3];L(this,"sessionDesc",void 0),L(this,"_localCapabilities",void 0),L(this,"_rtpCapabilities",void 0),L(this,"_candidates",void 0),L(this,"_originCandidates",void 0),L(this,"_iceParameters",void 0),L(this,"_isUseExtmapAllowMixed",void 0),L(this,"_isUseLocalCodecs",void 0),L(this,"_isUseDataChannel",void 0),L(this,"_dtlsParameters",void 0),L(this,"setup",void 0),L(this,"currentMidIndex",void 0),L(this,"cname",void 0),L(this,"useLocalCodecsMids",[]),L(this,"preloadSsrcs",[]),L(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=t,this._isUseLocalCodecs=r,this._isUseDataChannel=a,e=ur(e);const{iceParameters:c,dtlsParameters:d,candidates:h,rtpCapabilities:f,setup:m,localCapabilities:v,cname:E}=e;this._rtpCapabilities=f,this._candidates=h,this._originCandidates=ur(h),this._iceParameters=c,this._dtlsParameters=d,this._localCapabilities=v,this.setup=m,this.cname=E,[this.sessionDesc]=this.updateRemoteRTPCapabilities(f),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(e){return e.length===this.preloadSsrcs.length&&e.every(t=>{var r;return ke(r=this.preloadSsrcs).call(r,t)})}preloadRemoteMedia(e){let t=0;const r=[],a=[];for(;e>0;){const c=[KM({ssrcId:BI+t},z("USE_SUB_RTX")?{rtx:BI+t+1}:{})],d="".concat(BI+t,"_").concat(qM+t),{ssrcs:h,ssrcGroups:f}=ew(c,this.cname,z("SYNC_GROUP")?d:void 0),m=this.preCreateOrRecycleSendMedia("video",h,f,void 0),v=[{ssrcId:qM+t}],E="".concat(BI+t,"_").concat(qM+t),{ssrcs:w,ssrcGroups:S}=ew(v,this.cname,z("SYNC_GROUP")?E:void 0),R=this.preCreateOrRecycleSendMedia("audio",w,S,void 0);e--,t+=2,r.push(m,R),a.push(h[0].ssrcId,w[0].ssrcId)}return this.useLocalCodecsMids.push(...r),this.preloadSsrcs=a,{mids:r,preSSRCs:a,isAvailable:!0}}preCreateOrRecycleSendMedia(e,t,r,a){const c=this.rtpCapabilities.send.videoCodecs,d=this._isUseLocalCodecs||c.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;I.debug("create or recycle send media without remote rtp capabilities, ssrcs ",t[0].ssrcId);const h=e===Je.VIDEO?d.videoCodecs:d.audioCodecs,f=e===Je.VIDEO?d.videoExtensions:d.audioExtensions;this.currentMidIndex+=1;const m="".concat(this.currentMidIndex);let v={media:{mediaType:e,port:FI,protos:["UDP","TLS","RTP","SAVPF"],fmts:h.map(E=>E.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:f,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(m)}};return v=this.mungSendMediaDesc(v,a),this.sessionDesc.mediaDescriptions.push(v),this.updateBundleMids(),m}toString(){return kh(this.sessionDesc)}send(e,t,r,a){const{ssrcs:c,ssrcGroups:d}=ew(t,this.cname,z("SYNC_GROUP")?r:void 0),h=this.findPreloadMediaDesc(c);if(h){if(dr()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,h.attributes.mid),a&&(a.twcc||a.remb)){const f=this.sessionDesc.mediaDescriptions.indexOf(h);return this.sessionDesc.mediaDescriptions[f]=this.mungSendMediaDesc(h,a),{mid:h.attributes.mid,needExchangeSDP:!0}}return{mid:h.attributes.mid,needExchangeSDP:!1}}{const f=this.findAvailableMediaIndex(e,c);let m;return f===-1||f===1&&(Hs()||function(){const v=yn();return!(v.name!==Tn.CHROME||!v.osVersion)&&Number(v.version)<=90}()||Ed(143)||cf(143)||z("RESERVE_MID_1_MLINE")||z("ENABLE_ENCODED_TRANSFORM")&&Ih())||f===0&&!function(v){const E=yn();return!(E.name!==Tn.FIREFOX||!E.osVersion)&&Number(E.version)===v}(138)&&z("USE_SUB_RTX")||vG()?(m=this.createOrRecycleSendMedia(e,c,d,"sendonly",a),this.updateBundleMids()):(m=ur(this.sessionDesc.mediaDescriptions[f]),m.attributes.direction="sendonly",m.attributes.ssrcs=c,m.attributes.ssrcGroups=d,this.sessionDesc.mediaDescriptions[f]=this.mungSendMediaDesc(m,a)),dr()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,m.attributes.mid),{mid:m.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){const t=e.map(c=>{let{kind:d,ssrcMsg:h,mslabel:f}=c;return this.send(d,h,f)}),r=[];let a=!1;return t.forEach(c=>{let{mid:d,needExchangeSDP:h}=c;h&&(a=!0),r.push(d)}),{mids:r,needExchangeSDP:a}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(r=>{r.attributes.mid==="0"||dr()||vG()?r.attributes.ssrcs=[]:(r.attributes.ssrcs=[],r.attributes.direction="inactive",r.media.port="0")}),this.updateBundleMids()}mute(e){const t=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(r=>ke(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(r=>ke(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="recvonly"})}receive(e,t,r,a){e.forEach((c,d)=>{this.createOrRecycleRecvMedia(c,[],"recvonly",t,r,a[d])}),this.updateBundleMids()}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(r=>e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e){const t=this.sessionDesc||ma((r=this._isUseExtmapAllowMixed,this._isUseDataChannel?Hue(r):`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(r?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var r;this._rtpCapabilities=e;let a=!1;const c=this.rtpCapabilities.send,d=this.localCapabilities.send,h=this.localCapabilities.recv,f=h.videoCodecs,m=h.audioCodecs,v=h.videoExtensions,E=h.audioExtensions;for(const j of t.mediaDescriptions){var w;if(j.attributes.direction!=="sendonly"||typeof j.attributes.mid!="string"||!ke(w=this.useLocalCodecsMids).call(w,j.attributes.mid)){if(a=!0,j.attributes.iceUfrag=this._iceParameters.iceUfrag,j.attributes.icePwd=this._iceParameters.icePwd,j.attributes.fingerprints=this._dtlsParameters.fingerprints,j.attributes.candidates=this._candidates,j.attributes.setup=this.setup,j.media.mediaType==="application"&&(j.attributes.sctpPort="5000"),j.media.mediaType==="video")if(this._isUseLocalCodecs&&j.attributes.direction==="sendonly"){var S;j.media.fmts=f.map(P=>P.payloadType.toString(10)),j.attributes.payloads=f,j.attributes.extmaps=v;const D=j.attributes.mid;typeof D!="string"||ke(S=this.useLocalCodecsMids).call(S,D)||this.useLocalCodecsMids.push(D)}else if(c.videoCodecs.length===0){const D=d.videoCodecs.filter(P=>{var W,Y;return(W=P.rtpMap)===null||W===void 0?void 0:ke(Y=W.encodingName.toLowerCase()).call(Y,"vp8")});D.length===0&&D.push(d.videoCodecs[0]),j.media.fmts=D.map(P=>P.payloadType.toString(10)),j.attributes.payloads=D,j.attributes.extmaps=[]}else j.media.fmts=c.videoCodecs.map(D=>D.payloadType.toString(10)),j.attributes.payloads=c.videoCodecs,j.attributes.extmaps=c.videoExtensions;if(j.media.mediaType==="audio")if(this._isUseLocalCodecs&&j.attributes.direction==="sendonly"){var R;j.media.fmts=m.map(P=>P.payloadType.toString(10)),j.attributes.payloads=m,j.attributes.extmaps=E;const D=j.attributes.mid;typeof D!="string"||ke(R=this.useLocalCodecsMids).call(R,D)||this.useLocalCodecsMids.push(D)}else if(c.audioCodecs.length===0){const D=d.audioCodecs.filter(P=>{var W,Y;return(W=P.rtpMap)===null||W===void 0?void 0:ke(Y=W.encodingName.toLowerCase()).call(Y,"opus")})||[d.audioCodecs[0]];j.media.fmts=D.map(P=>P.payloadType.toString(10)),j.attributes.payloads=D,j.attributes.extmaps=[]}else j.media.fmts=c.audioCodecs.map(D=>D.payloadType.toString(10)),j.attributes.payloads=c.audioCodecs,j.attributes.extmaps=c.audioExtensions,eE(j)}}return this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1,[this.sessionDesc,a]}updateCandidates(e){const t=this._originCandidates.filter(a=>a.transport==="udp"),r=[];if(t.forEach(a=>{r.push(KM(KM({},a),{},{foundation:"tcpcandidate",priority:Number(a.priority)-1+"",transport:"tcp",port:Number(a.port)+90+""}))}),t.length!==0){switch(e){case qs.TCP_RELAY:this._candidates=r;break;case qs.UDP_TCP_RELAY:case qs.RELAY:this._candidates=[...t,...r];break;default:this._candidates=t}for(const a of this.sessionDesc.mediaDescriptions)a.attributes.candidates=this.candidates}}restartICE(e){e=ur(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const t=[];for(let r=0;r<e;r++)t.push((this.currentMidIndex+r+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const a=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(dr()){if(a){const c=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(c||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!c||c!==r.attributes.mid)}return!1}return a})}createOrRecycleDataChannel(){for(const r of this.sessionDesc.mediaDescriptions)if(r.media.mediaType==="application")return{mediaDesc:r,needExchangeSDP:!1};this.currentMidIndex+=1;const e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:FI,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,r,a,c,d){const h=e._mediaStreamTrack.kind,f=this.rtpCapabilities.recv,m=nw(h,f,this.localCapabilities.send,h===Je.VIDEO?a:c),v=h===Je.VIDEO?f.videoExtensions:f.audioExtensions;this.currentMidIndex+=1;const E="".concat(this.currentMidIndex);let w={media:{mediaType:h,port:FI,protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:v,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(E)}};w=this.mungRecvMediaDsec(w,e,d);const S=this.findFirstClosedMedia(h);if(S){const R=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[R]=w}else this.sessionDesc.mediaDescriptions.push(w);return w}updateRemoteDtlsParameters(e){const t=new Set(this._dtlsParameters.fingerprints.map(c=>c.fingerprint)),r=new Set(e.map(c=>c.fingerprint));let a=!1;t.size!==r.size&&(a=!0);for(const c of t)r.has(c)||(a=!0);return a}updateRemoteCodec(e,t,r){const a=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(w=>w.rtpMap&&w.rtpMap.encodingName.toLowerCase()||"").filter(w=>{var S;return ke(S=Object.keys(Ag)).call(S,w)}))],c=new Set(t);if(a.every(w=>c.has(w)))return I.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;const d=this._rtpCapabilities.recv.videoCodecs.filter(w=>t.some(S=>{var R;return ke(R=w.rtpMap&&w.rtpMap.encodingName.toLowerCase()||"").call(R,S)}));if(d.length===0)return I.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(a," codecs: ").concat(t)),!1;const h=[...new Set(d.map(w=>w.rtpMap&&w.rtpMap.encodingName.toLowerCase()||""))];let f;if(I.debug("updateRemoteCodec, from ".concat(a," to ").concat(h)),e.length===0)f=this.sessionDesc.mediaDescriptions.filter(w=>w.media.mediaType==="video"&&w.attributes.direction==="recvonly");else if(f=this.sessionDesc.mediaDescriptions.filter(w=>w.attributes.mid&&w.media.mediaType==="video"&&ke(e).call(e,w.attributes.mid)&&w.attributes.direction==="recvonly"),f.length!==e.length)return I.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(z("USE_PUB_RTX")||z("USE_SUB_RTX")){const w=gf(d,this.rtpCapabilities.recv.videoCodecs);d.push(...w)}this._rtpCapabilities.recv.videoCodecs=d;const m=this.localCapabilities.send,v=this.rtpCapabilities.recv,E=nw(Je.VIDEO,v,m,r);return f.forEach(w=>{const S=E.map(R=>R.payloadType.toString(10));I.debug("updateRemoteCodec mid: ".concat(w.attributes.mid,", from"),w.attributes.payloads,"to",E),w.attributes.payloads=E,w.media.fmts=S}),I.debug("updateRemoteCodec success, mids: ".concat(e,", codecs: ").concat(t,", remote recv: ").concat(this._rtpCapabilities.recv.videoCodecs.length,", remote send: ").concat(this._rtpCapabilities.send.videoCodecs.length)),!0}createOrRecycleSendMedia(e,t,r,a,c){const d=this.rtpCapabilities.send.videoCodecs,h=this._isUseLocalCodecs||d.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,f=e===Je.VIDEO?h.videoCodecs:h.audioCodecs,m=e===Je.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const v="".concat(this.currentMidIndex);let E={media:{mediaType:e,port:FI,protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(v)}};E=this.mungSendMediaDesc(E,c);const w=this.findFirstClosedMedia(e);if(w){const S=this.sessionDesc.mediaDescriptions.indexOf(w);this.sessionDesc.mediaDescriptions[S]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}mungRecvMediaDsec(e,t,r){const a=ur(e);return kM(a),Bg(a,t),OM(a,t),JH(a),DI(a,r,this.localCapabilities.send),a}mungSendMediaDesc(e,t){const r=ur(e);return r.attributes&&r.attributes.payloads&&Array.isArray(r.attributes.payloads)&&r.attributes.payloads.length>0&&r.attributes.payloads.forEach(a=>{a.rtpMap&&a.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&z("ENABLE_DOWN_SPS_PPS")&&(a.fmtp&&a.fmtp.parameters||(a.fmtp={parameters:{}}),a.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),DI(r,t,this.localCapabilities.recv),eE(r),r}updateRecvMedia(e,t){const r=this.sessionDesc.mediaDescriptions.findIndex(a=>a.attributes.mid===e);if(r!==-1){const a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],t);this.sessionDesc.mediaDescriptions[r]=a}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>dr()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var r;return((r=t.attributes)===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId)===e[0].ssrcId})}getSSRC(e){var t;return(t=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===e))===null||t===void 0?void 0:t.attributes.ssrcs}};function S7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function Lh(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?S7(Object(r),!0).forEach(function(a){L(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S7(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}var rE=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(rE||{});const zI=new Map;function T7(e,t,r,a){let{scale:c}=e;if(c===0&&a===rE.UP||c>=t.length-1&&a===rE.DOWN)return e;let d=Lh(Lh({},e),{},{scale:a===rE.DOWN?++c:--c});switch(r){case"maintain-framerate":d=Lh(Lh({},d),t[c].motion);break;case"maintain-resolution":d=Lh(Lh({},d),t[c].detail);break;case"balanced":d=Lh(Lh({},d),t[c].balanced)}return d}function R7(e,t){if(t){const r={overUse:0,underUse:0,adaptationList:C7(t)};zI.set(e,r)}else zI.delete(e)}function C7(e){const t=Lh({},e),{bitrateMax:r,frameRate:a,scaleResolutionDownBy:c,bitrateMin:d}=t,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:f,MAX_SCALE:m,BITRATE_MIN_THRESHOLD:v,BITRATE_MAX_THRESHOLD:E,BWE_SCALE_UP_THRESHOLD:w,BWE_SCALE_DOWN_THRESHOLD:S,PERF_SCALE_DOWN_THRESHOLD:R,PERF_SCALE_UP_THRESHOLD:j,BALANCE_BITRATE_FACTOR:D,BALANCE_FRAMERATE_FACTOR:P,BALANCE_RESOLUTION_FACTOR:W,MOTION_RESOLUTION_FACTOR:Y,MOTION_BITRATE_FACTOR:ne,DETAIL_FRAMERATE_FACTOR:le,DETAIL_BITRATE_FACTOR:fe}=Fj,ie=Math.min(t.frameRate,f),_e=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(S,1)*r),bwe_up:r,fps_down:Math.round(Math.pow(R,1)*ie),fps_up:a},balanced:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:r,bitrateMin:d},motion:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:r,bitrateMin:d},detail:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:r,bitrateMin:d}}];for(let Te=1;Te<=m;Te++){const Ne={bwe_up:Math.round(Math.pow(w,Te)*r),bwe_down:Math.round(Math.pow(S,Te+1)*r),fps_up:Math.round(Math.pow(j,Te)*ie),fps_down:Math.round(Math.pow(R,Te+1)*ie)},Ke={scaleResolutionDownBy:c/Math.pow(W,Te),frameRate:Math.max(Math.round(Math.pow(P,Te)*a),h),bitrateMax:Math.max(Math.round(Math.pow(D,Te)*r),E),bitrateMin:Math.max(Math.round(Math.pow(D,Te)*d),v)},St={scaleResolutionDownBy:c/Math.pow(Y,Te),frameRate:a,bitrateMax:Math.max(Math.round(Math.pow(ne,Te)*r),E),bitrateMin:Math.max(Math.round(Math.pow(ne,Te)*d),v)},Et={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(le,Te)*a),h),bitrateMax:Math.max(Math.round(Math.pow(fe,Te)*r),E),bitrateMin:Math.max(Math.round(Math.pow(fe,Te)*d),v)};_e.push({scale:Te,threshold:Ne,balanced:Ke,motion:St,detail:Et})}return _e}function Kue(e,t,r,a,c,d){const h=zI.get(e)||{overUse:0,underUse:0,adaptationList:C7(c)},{adaptationList:f}=h;zI.set(e,h);const{OVERUSE_TIMES_THRESHOLD:m,UNDERUSE_TIMES_THRESHOLD:v}=Fj,{scale:E}=a;let w,S;return typeof t=="number"&&t>0&&function(R,j,D,P){if(j>=D.length)return!1;let{threshold:{fps_down:W}}=D[j];return z("FORCE_AG_HIGH_FRAMERATE")&&P==="maintain-framerate"&&(W=D[0].threshold.fps_down),R<W}(t,E,f,d)&&(h.overUse++,S=Lv.CPU,h.overUse>m)||typeof r=="number"&&r>0&&function(R,j,D){if(j>=D.length)return!1;const{threshold:{bwe_down:P}}=D[j];return R<P}(r,E,f)&&(h.overUse++,S=Lv.BANDWIDTH,h.overUse>m)?(h.overUse=0,h.underUse=0,w=T7(a,f,d,rE.DOWN),[w,S]):(typeof t=="number"&&t>0&&typeof r=="number"&&r>0&&function(R,j,D,P){if(j===0)return;let{threshold:{fps_up:W}}=D[j];return z("FORCE_AG_HIGH_FRAMERATE")&&P==="maintain-framerate"&&(W=D[1].threshold.fps_up),R>W}(t,E,f,d)&&function(R,j,D){if(j===0)return;const{threshold:{bwe_up:P}}=D[j];return R>P}(r,E,f)&&(h.underUse++,h.underUse>v&&(h.overUse=0,h.underUse=0,w=T7(a,f,d,rE.UP),w.scale===0&&(S=Lv.NONE))),[w,S])}function N7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function YM(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?N7(Object(r),!0).forEach(function(a){L(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N7(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}function I7(e){var t;return!!z("ENABLE_AG_ADAPTATION")&&!!(e instanceof hI||ke(t=e._hints).call(t,Pn.CUSTOM_TRACK))&&(!!z("FORCE_SUPPORT_AG_ADAPTATION")||!!(gG(14,0,!1)&&_G(17,4,!0)||mG(14)&&yj(17,4,!0)))}const GI=new Map;function A7(e,t,r,a,c,d){if(sE(e,r),c(t),a!=="balanced"&&a!=="maintain-framerate"&&a!=="maintain-resolution")return;let h=-1;R7(e,t);const f=window.setInterval(()=>{const v=GI.get(e);if(!z("ENABLE_AG_ADAPTATION")||!v)return sE(e,r),void c(t);const E=d();if(E.sendPackets>0&&E.OutgoingAvailableBandwidth>0){if(h===-1)return void(h=Date.now());if(Date.now()-h<1e3)return;const w=E.sendFrameRate,S=E.OutgoingAvailableBandwidth,[R,j]=Kue(e,w,S,v.adaptationConfig,t,a);j&&(r.qualityLimitationReason=j),R&&v.adaptationConfig.scale!==R.scale&&(I.debug("[".concat(e,"] applyAdaptation: ").concat(r.qualityLimitationReason,`
           sendFps `).concat(w,", bwe ").concat(S,", switch from ").concat(v.adaptationConfig.scale," to ").concat(R.scale," ")),v.adaptationConfig=YM(YM({},v.adaptationConfig),R),c(R))}},z("CHECK_LOCAL_STATS_INTERVAL")),m=YM({},t);GI.set(e,{timer:f,adaptationConfig:m,originConfig:t,adaptationFunc:c}),I.debug("[".concat(e,"] start adaptation, originConfig: ").concat(JSON.stringify(t),", degradationPreference: ").concat(a))}function sE(e,t){const r=GI.get(e);if(r){const{timer:a}=r;window.clearTimeout(a),GI.delete(e)}t.qualityLimitationReason=Lv.NONE,R7(e)}function que(e,t){var r;let a;switch(t){case De.LocalAudioTrack:a=Un.Audio;break;case De.LocalVideoTrack:a=ke(r=e._hints).call(r,Pn.SCREEN_TRACK)?Un.Screen:Un.High;break;case De.LocalVideoLowTrack:a=Un.Low}return a}function XM(e){const t=Zt();if(e.some(r=>r._bypassWebAudio))throw new we(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new we(K.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function $M(e,t){XM(e);const r=new bs;return e.forEach(a=>r.addAudioTrack(a)),r}const Yue=!Zt().supportUnifiedPlan||z("CHROME_FORCE_PLAN_B")&&yu();function aw(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.useDcSignal)return r={spec:t,store:e},Td("DataChannelConnection").create(r);var r;return Yue?function(c){return Td("PlanBConnection").create(c)}({spec:t,store:e}):new cc(t,e)}function JM(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function QM(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(wg(e.turnServer.servers))return!1;if(z("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var hn;function k7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function Cd(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?k7(Object(r),!0).forEach(function(a){L(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k7(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}let cc=(hn=class l_ extends CI{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var r;return ke(r=Object.keys(Ag)).call(r,t)}))]}constructor(t,r){super(t,r),L(this,"id",jn(5,"connection-")),L(this,"store",void 0),L(this,"peerConnection",void 0),L(this,"forceTurn",!1),L(this,"remoteSDP",void 0),L(this,"initialOffer",void 0),L(this,"transportEventReceiver",void 0),L(this,"statsFilter",void 0),L(this,"extension",{useXR:z("USE_XR")}),L(this,"localCapabilities",void 0),L(this,"remoteCodecs",void 0),L(this,"localCandidateCount",0),L(this,"allCandidatesReceived",!1),L(this,"isPreallocation",!1),L(this,"isPreRender",!1),L(this,"preMediaMap",new Map),L(this,"dataStreamChannelMap",new Map),L(this,"establishPromise",void 0),L(this,"recoveredDataChannelIds",[]),L(this,"currentDataChannelId",1),L(this,"supportAV1RtpSpec",!1),L(this,"mutex",void 0),L(this,"qualityLimitationReason",Lv.NONE),L(this,"isFirstConnected",!1),this.store=r,this.forceTurn=QM(t),this.mutex=new Ks("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(l_.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=tI(this.peerConnection,z("STATS_UPDATE_INTERVAL"),void 0,dr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,r){if(this.remoteCodecs=r,!this.remoteSDP)return void I.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(r));if(this.remoteSDP.updateRemoteCodec(t,r,this.store.codec)){const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}else I.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const a=Ru(r.sdp),c=await PM({filterRTX:!z("USE_PUB_RTX")&&!z("USE_SUB_RTX"),filterVideoFec:z("FILTER_VIDEO_FEC"),filterAudioFec:z("FILTER_AUDIO_FEC"),filterVideoCodec:z("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:z("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:z("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=tw(c),this.initialOffer=r,z("ENABLE_SVC")&&this.store.codec=="av1"){const h=await QH();var t;h&&(this.supportAV1RtpSpec=!0,(t=c.send)===null||t===void 0||t.videoExtensions.push(h))}let d;return r.sdp&&PI(r.sdp)&&(d=ur(c),WH(d)),Cd(Cd({},a),{},{rtpCapabilities:d||c,offerSDP:r.sdp})}catch(r){throw new we(K.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&PI(this.initialOffer.sdp)&&HH(t.rtpCapabilities,this.localCapabilities),this.remoteSDP=new w7(Cd(Cd({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!z("ENABLE_PRE_SUB_WITH_PRE_PC")||!z("PRE_USE_LOCAL_CODECS"))&&Kx(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const r=this.remoteSDP.toString(),a=LM(this.initialOffer.sdp,this.extension),c=this.logSDPExchange(a||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),c==null||c(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r});const d=this.peerConnection.getTransceivers()[0];if(d!=null&&d.receiver&&this.tryBindTransportEvents(d.receiver),Kx(this.store))if(t.preallocation&&z("ENABLE_PRE_SUB_WITH_PRE_PC")){const h=z("PRE_SUB_NUM"),{mids:f,preSSRCs:m}=this.remoteSDP.preloadRemoteMedia(h);await co(this.peerConnection,this.remoteSDP,this.extension),I.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(m)),this.presetMedia(f,m)}else{const{preSSRCs:h=[]}=t,f=h.map(v=>v.ssrcMsg[0].ssrcId);if(h.length===0)return;const{mids:m}=this.remoteSDP.batchSend(h.map(v=>Object.assign({},v)));await co(this.peerConnection,this.remoteSDP,this.extension),I.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(f)),this.presetMedia(m,f)}}catch(r){throw new we(K.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}presetMedia(t,r){t.forEach((a,c)=>{this.peerConnection.getTransceivers().forEach(d=>{if(d.mid!=null&&a===d.mid&&d.receiver.track){const h=d.receiver.track;let f;h.kind==="video"&&z("ENABLE_PRE_RENDER")&&(f=new uI({trackId:"track-".concat(h.kind,"-unknown-").concat(this.store.clientId,"_").concat(jn(5,""))},!0),f.updateVideoTrack(h),f.onFirstVideoFrameRender=()=>{var m;const v=this.preMediaMap.get(r[c]);v&&(v.firstVideoRender=Date.now()),(m=this.onFirstVideoRender)===null||m===void 0||m.call(this,r[c])},f.onVideoBufferReady=()=>{var m;(m=this.onFirstVideoBufferReady)===null||m===void 0||m.call(this,r[c])},f.play(this.store.sessionId||void 0),this.isPreRender=!0),this.preMediaMap.set(r[c],{mid:a,track:h,player:f,transceiver:d})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let r=!1;const{rtpCapabilities:a}=t;if([,r]=this.remoteSDP.updateRemoteRTPCapabilities(a),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const h=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);r=r||h}const{preSSRCs:c=[]}=t,d=c.map(h=>h.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(d)){const h=[],f=[];if(Array.from(this.preMediaMap.entries()).every(m=>{let[v,{mid:E,player:w,track:S}]=m;return h.push(E),f.push(v),this.preMediaMap.delete(v),w&&w.destroy(),!0}),h.length>0&&(this.remoteSDP.stopSending(h),await co(this.peerConnection,this.remoteSDP,this.extension),I.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(f)),tt.reportApiInvoke(this.store.sessionId,{name:_r.PRELOAD_MEDIA_FAILED,options:[c,f],tag:$n.TRACER}).onSuccess()),c.length>0){const{mids:m}=this.remoteSDP.batchSend(c.map(v=>Object.assign({},v)));await co(this.peerConnection,this.remoteSDP,this.extension),I.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(d)),this.presetMedia(m,d)}}r?(await co(this.peerConnection,this.remoteSDP,this.extension),I.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):I.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(r){throw new we(K.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(r.toString()))}}send(t,r,a){var c=this;return Da(function*(){const d=yield Ft(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],f=Qx();t.forEach(P=>{const W=c.peerConnection.addTransceiver(P._mediaStreamTrack,Cd({direction:"sendonly"},P.trackMediaType==="video"&&c.supportAV1RtpSpec&&f?{sendEncodings:[{scalabilityMode:f}]}:{}));h.push(W),P._updateRtpTransceiver(W)}),dr()&&z("SIMULCAST")===!0&&(yield Ft(c.applySimulcastForFirefox(h,t)));const m=yield Ft(c.peerConnection.createOffer()),v=c.remoteSDP.predictReceivingMids(t.length),E=c.mungSendOfferSDP(m.sdp,t,v),w=ma(E),S=v.map(P=>{const W=w.mediaDescriptions.find(Y=>Y.attributes.mid===P);if(!W)throw new Error("Cannot extract ssrc from mediaDescription.");return AM(W,z("USE_PUB_RTX"))});let R;try{R=yield S}catch(P){R=[],c.remoteSDP.receive(t,r,a,R);const W=c.remoteSDP.toString();throw yield Ft(c.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield Ft(c.peerConnection.setRemoteDescription({type:"answer",sdp:W})),yield Ft(c.stopSending(v,!0)),P}c.remoteSDP.receive(t,r,a,R);const j=c.remoteSDP.toString(),D=c.logSDPExchange(E,"offer","local","send");return yield Ft(c.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield Ft(c.applySimulcastEncodings(h,t)),yield Ft(c.applySendEncodings(h,t)),D==null||D(j),yield Ft(c.peerConnection.setRemoteDescription({type:"answer",sdp:j})),h.map((P,W)=>{const Y=v[W];return{localSSRC:S[W],id:Y,transceiver:P}})}catch(h){throw h instanceof we?h:new we(K.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}async createDataChannels(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let a=this.dataStreamChannelMap.get(t);if(a&&a.readyState==="open")I.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const d=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof d!="number")throw new Error("create DataChannel error, because cannot get dc id");a=this.peerConnection.createDataChannel("datastream-channel",{id:d,negotiated:!0,ordered:!1,maxRetransmits:z("DATASTREAM_MAX_RETRANSMITS")}),a.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,a)}r.forEach(d=>{d._updateOriginDataChannel(a)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),I.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else I.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(a){throw a instanceof we?a:new we(K.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(a.toString()))}}async stopDataChannels(t){try{const r=this.dataStreamChannelMap.get(t);return r&&(r.id&&this.recoveredDataChannelIds.push(r.id),r.close()),void this.dataStreamChannelMap.delete(t)}catch(r){throw r instanceof we?r:new we(K.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(r.toString()))}}async stopSending(t,r){const a=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(m=>t.indexOf(m.mid)!==-1);if(c.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(m=>{var v;sE(this.id+m.mid,this),m.direction="inactive",(v=m.stop)===null||v===void 0||v.call(m)});const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(t);const f=this.remoteSDP.toString();h==null||h(f),await this.peerConnection.setRemoteDescription({type:"answer",sdp:f})}catch(c){throw new we(K.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{a&&a()}}async receive(t,r,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(t,r,a,c);h&&(await co(this.peerConnection,this.remoteSDP,this.extension),I.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const f=this.peerConnection.getTransceivers().find(m=>m.mid===d);if(!f)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:f.receiver.track,id:d,transceiver:f}}catch(d){throw new we(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:r,needExchangeSDP:a}=this.remoteSDP.batchSend(t);return a&&(await co(this.peerConnection,this.remoteSDP,this.extension),I.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),r.map(c=>{const d=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:c,transceiver:d}})}catch(r){throw new we(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(d=>{Array.from(this.preMediaMap.entries()).some(h=>{let[f,{mid:m,player:v}]=h;if(m===d)return this.preMediaMap.delete(f),v&&v.destroy(),!0})}),this.remoteSDP.stopSending(t);const r=this.remoteSDP.toString(),a=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new we(K.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const r=this.remoteSDP.toString(),a=this.logSDPExchange(r,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new we(K.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(r.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const r=this.remoteSDP.toString(),a=this.logSDPExchange(r,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new we(K.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(r.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(h=>{h.direction="inactive"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(t);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(r){throw new we(K.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(async(h,f)=>{h.direction="sendonly"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(r){throw new we(K.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return Da(function*(){const a=yield Ft(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Zt().supportPCSetConfiguration,d=z("FORCE_TURN_TCP")||r.forceTurn;if(t===qs.RELAY&&!c)return;if(c&&!d){const w=t===qs.RELAY?"relay":"all",S=r.peerConnection.getConfiguration();S.iceTransportPolicy!==w&&(I.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(S.iceTransportPolicy,"] to [").concat(w,"]")),S.iceTransportPolicy=w,r.peerConnection.setConfiguration(S))}r.remoteSDP.updateCandidates(t);const h=yield Ft(r.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const f=Ru(h.sdp),{remoteIceParameters:m}=yield f.iceParameters;r.remoteSDP.restartICE(m);const v=r.remoteSDP.toString(),E=r.logSDPExchange(h.sdp||"","offer","local","restartICE");r.store.descriptionStart(),yield Ft(r.peerConnection.setLocalDescription(h)),E==null||E(v),yield Ft(r.peerConnection.setRemoteDescription({type:"answer",sdp:v}))}catch(c){I.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),c)}finally{a()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(qs.TCP_RELAY),await co(this.peerConnection,this.remoteSDP,this.extension)}catch(r){I.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),r)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(r=>{sE(this.id+r.mid,this)}),this.preMediaMap.forEach(r=>{let{player:a}=r;a&&a.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Cd(Cd({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);const d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new we(K.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(t,r){const a=this.peerConnection.getTransceivers().filter(c=>c.mid===t);a.length===1&&(this.isVP8Simulcast(r)?dr()||await this.applySimulcastEncodings(a,[r]):await this.applySendEncodings(a,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){const a=this.peerConnection.getTransceivers().find(c=>c.mid===r);a&&await a.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const r=t[0].transport.iceTransport,{local:a,remote:c}=r.getSelectedCandidatePair();return{local:Cd(Cd({},Cl),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:Cd(Cd({},Cl),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var r;const a="code: ".concat(t.errorCode,", message: ").concat(t.errorText),c=t.port?"local: ".concat(t.port):"",d=Tu(t.url||"");I.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(a,"), url: ").concat(d||"",", host_candidate:").concat(c)),(r=this.onICECandidateError)===null||r===void 0||r.call(this,a)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},z("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const r={iceServers:[]},a=t.cloudProxyServer||"disabled";return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&(wg(t.turnServer.servers)?r.iceServers=t.turnServer.servers:z("NEW_TURN_MODE")&&r.iceServers&&a==="disabled"?(z("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&r.iceServers.push(...l_.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):r.iceServers.push(...l_.newTurnServerConfigToIceServers(t.turnServer.servers)),z("NEW_FORCE_TURN")&&(r.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(r.iceServers&&r.iceServers.push(...l_.turnServerConfigToIceServers(t.turnServer.servers)),z("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...l_.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),z("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(r.iceTransportPolicy="relay")}))),z("ENABLE_ENCODED_TRANSFORM")&&Zt().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(t){const r=[];return t.forEach(a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Ol(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!z("FORCE_TURN_TCP")&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),r}static newTurnServerConfigToIceServers(t){const r=[];return t.forEach(a=>{const c=z("NEW_TURN_MODE");c===1?r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}):c===2?r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}):c===3?r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Ol(a.turnServerURL),":443?transport=tcp")}):c===4&&(r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}),r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}),r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Ol(a.turnServerURL),":443?transport=tcp")}))}),r}tryBindTransportEvents(t){const r=t.transport;if(r){this.transportEventReceiver=t,r.onstatechange=()=>{var c;r!=null&&r.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,r.state))},r.onerror=c=>{var d;(d=this.onDTLSTransportError)===null||d===void 0||d.call(this,"error"in c?c.error:c)};const a=r.iceTransport;a&&(a.onstatechange=()=>{const c=r==null?void 0:r.iceTransport.state;var d;c&&((d=this.onICETransportStateChange)===null||d===void 0||d.call(this,c))},a.getSelectedCandidatePair&&(a.onselectedcandidatepairchange=()=>{if(a.getSelectedCandidatePair()){const{local:c,remote:d}=a.getSelectedCandidatePair()||{};if(c&&d){const h=c.address+":"+c.port,f=d.address+":"+d.port;I.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Tu(h)),", remote ").concat(JSON.stringify(Tu(f))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var a,c;if(r||(r=this.peerConnection.getSenders().find(P=>P.track===t._mediaStreamTrack)),!r)return I.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return I.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Zt().supportSetRtpSenderParameters)return I.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},h={};switch(t._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;case"balanced":d.degradationPreference="balanced"}const f=zH(this.peerConnection,t._mediaStreamTrack),m=kW(t);if(I7(t)&&f&&r&&m&&this.getLocalVideoStats&&ke(a=["vp8","vp9"]).call(a,this.store.codec)){var v;const D=d.degradationPreference||(ke(v=t._hints).call(v,Pn.CUSTOM_TRACK)?z("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");A7(this.id+f.mid,m,this,D,P=>{r&&this.updateAdaptation(r,P)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var E;const{bitrateMax:D,frameRate:P,scaleResolutionDownBy:W}=t._encoderConfig;D&&(h.maxBitrate=1e3*D),(ke(E=t._hints).call(E,Pn.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(P&&(h.maxFramerate=Ua(P)),W&&W>=1&&(h.scaleResolutionDownBy=W))}const{maxFramerate:w}=z("ENCODER_CONFIG_LIMIT");if(w&&typeof w=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,w):w),z("DSCP_TYPE")&&yu()){var S;const D=z("DSCP_TYPE");ke(S=["very-low","low","medium","high"]).call(S,D)&&(h.networkPriority=D)}const R=r.getParameters(),j=(c=R.encodings)===null||c===void 0?void 0:c[0];dr()&&!j&&(d.encodings=[h]),j&&Object.assign(j,h),Object.assign(R,d),I.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(R.encodings))),await r.setParameters(R),await t7(this.store.codec,r,z("SVC_MODE"))}async updateAdaptation(t,r){var a,c;if(!t)return I.debug("[updateAdaptation] no rtpSender found");if(!Zt().supportSetRtpSenderParameters)return I.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const d={},{bitrateMax:h,frameRate:f,scaleResolutionDownBy:m}=r;h&&(d.maxBitrate=1e3*h),f&&(d.maxFramerate=Ua(f)),m&&m>=1&&ke(a=["vp8","vp9"]).call(a,this.store.codec)&&(d.scaleResolutionDownBy=m);const v=t.getParameters(),E=(c=v.encodings)===null||c===void 0?void 0:c[0];E&&Object.assign(E,d),Object.assign(v,{});try{await t.setParameters(v),I.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(v.encodings)))}catch(w){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?I.debug("[updateAdaptation] peerConnection not connected}"):I.debug("[updateAdaptation] updateRtpSenderEncodings failed",w):I.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,r){try{if(!Zt().supportSetRtpSenderParameters||t.length!==r.length)return;for(let a=0;a<t.length;a++){const c=t[a],d=r[a];d instanceof Jn&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{I.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,a){if(z("FORBID_MODIFY_LOCAL_OFFER_SDP"))return t;const c=ma(t);return r.forEach((d,h)=>{const f=a[h],m=c.mediaDescriptions.find(v=>v.attributes.mid===f);m&&(Bg(m,d),DM(m,d,this.store.codec))}),kh(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let m=0;m<t.length;m++){var a,c,d,h,f;const v=t[m],E=r[m];if(E instanceof Jn&&!ke(a=E._hints).call(a,Pn.LOW_STREAM)&&(c=E._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=E._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=E._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((f=E._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1&&this.store.codec==="vp8"){const w={},S={high:1e3*(E._encoderConfig.bitrateMax-50),medium:5e4};w.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];const R=v.sender.getParameters();await v.sender.setParameters(Object.assign(R,w))}}}async applySimulcastEncodings(t,r){if(!dr()&&t.length===r.length)for(let a=0;a<t.length;a++){const c=r[a];if(c instanceof Jn&&this.isVP8Simulcast(c)){const d=t[a],h={},f={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:f.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:f.medium,scaleResolutionDownBy:4}];const m=d.sender.getParameters();await d.sender.setParameters(Object.assign(m,h))}}}isVP8Simulcast(t){var r,a,c,d,h;return!!(t instanceof Jn&&z("SIMULCAST")&&this.store.codec==="vp8"&&!ke(r=t._hints).call(r,Pn.LOW_STREAM)&&(a=t._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=t._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=t._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=t._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(t,r,a,c){if(z("SDP_LOGGING"))return I.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(r," SDP during P2PConnection.").concat(c,`
`),t),r==="offer"?d=>{this.logSDPExchange(d,"answer",a==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const r=this.remoteSDP.getSSRC(t);return r&&r.length!==0?r[0].ssrcId:void 0}setConfiguration(t){if(Zt().supportPCSetConfiguration){const r=l_.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}t.isPreallocation&&(this.isPreallocation=!0)}},Fe(hn.prototype,"updateRemoteRTPCapabilities",[Va],Object.getOwnPropertyDescriptor(hn.prototype,"updateRemoteRTPCapabilities"),hn.prototype),Fe(hn.prototype,"connect",[Va],Object.getOwnPropertyDescriptor(hn.prototype,"connect"),hn.prototype),Fe(hn.prototype,"updateRemoteConnect",[Va],Object.getOwnPropertyDescriptor(hn.prototype,"updateRemoteConnect"),hn.prototype),Fe(hn.prototype,"createDataChannels",[Va],Object.getOwnPropertyDescriptor(hn.prototype,"createDataChannels"),hn.prototype),Fe(hn.prototype,"receive",[Va],Object.getOwnPropertyDescriptor(hn.prototype,"receive"),hn.prototype),Fe(hn.prototype,"batchReceive",[Va],Object.getOwnPropertyDescriptor(hn.prototype,"batchReceive"),hn.prototype),Fe(hn.prototype,"stopReceiving",[Va],Object.getOwnPropertyDescriptor(hn.prototype,"stopReceiving"),hn.prototype),Fe(hn.prototype,"muteRemote",[Va],Object.getOwnPropertyDescriptor(hn.prototype,"muteRemote"),hn.prototype),Fe(hn.prototype,"unmuteRemote",[Va],Object.getOwnPropertyDescriptor(hn.prototype,"unmuteRemote"),hn.prototype),Fe(hn.prototype,"muteLocal",[Va],Object.getOwnPropertyDescriptor(hn.prototype,"muteLocal"),hn.prototype),Fe(hn.prototype,"unmuteLocal",[Va],Object.getOwnPropertyDescriptor(hn.prototype,"unmuteLocal"),hn.prototype),Fe(hn.prototype,"close",[Va],Object.getOwnPropertyDescriptor(hn.prototype,"close"),hn.prototype),Fe(hn.prototype,"updateEncoderConfig",[Va],Object.getOwnPropertyDescriptor(hn.prototype,"updateEncoderConfig"),hn.prototype),Fe(hn.prototype,"updateSendParameters",[Va],Object.getOwnPropertyDescriptor(hn.prototype,"updateSendParameters"),hn.prototype),Fe(hn.prototype,"replaceTrack",[Va],Object.getOwnPropertyDescriptor(hn.prototype,"replaceTrack"),hn.prototype),Fe(hn.prototype,"updateAdaptation",[Va],Object.getOwnPropertyDescriptor(hn.prototype,"updateAdaptation"),hn.prototype),Fe(hn.prototype,"getRemoteSSRC",[Va],Object.getOwnPropertyDescriptor(hn.prototype,"getRemoteSSRC"),hn.prototype),hn);function Va(e,t,r){const a=e[t];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this.mutex,d=await c.lock("From P2PConnection.".concat(t));try{for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];return await a.apply(this,f)}finally{d()}},r}function ZM(e,t){let r=document.createElement("video"),a=document.createElement("canvas");r.setAttribute("style","display:none"),a.setAttribute("style","display:none"),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("autoplay",""),r.autoplay=!0,r.setAttribute("playsinline",""),a.width=Ua(t.width),a.height=Ua(t.height);const c=Ua(t.framerate||15);document.body.append(r),document.body.append(a);let d=e._mediaStreamTrack;r.srcObject=new MediaStream([d]),r.play().catch(zx);const h=a.getContext("2d");if(!h)throw new Ee(K.UNEXPECTED_ERROR,"can not get canvas context");const f=Zt(),m=a.captureStream(f.supportRequestFrame?0:c).getVideoTracks()[0];m.canvas||(m.canvas=a),a.startCapture=()=>{if(!r)return a.stopCapture&&a.stopCapture();if(r.paused&&r.play(),r.videoHeight>2&&r.videoWidth>2){const E=r.videoWidth,w=r.videoHeight/E,S=a.width*w;Math.abs(S-a.height)>=2&&(I.debug("adjust low stream resolution","".concat(a.width,"x").concat(a.height," -> ").concat(a.width,"x").concat(S)),a.height=S)}h.drawImage(r,0,0,a.width,a.height),m.requestFrame&&m.requestFrame(),d!==e._mediaStreamTrack&&(d=e._mediaStreamTrack,r.srcObject=new MediaStream([d]))},a.stopCapture=Zj(()=>a.startCapture&&a.startCapture(),c);const v=m.stop;return m.stop=()=>{v.call(m),r&&(r.remove(),r.srcObject=null,r=null),a&&(a.width=0,a.remove(),a.stopCapture&&a.stopCapture(),a.startCapture=void 0,a.stopCapture=void 0,a=null),I.debug("clean low stream renderer")},m}var O7=function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e}(O7||{}),Nd=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e}(Nd||{}),At=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(At||{}),js=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e[e.Audio_Recv_AV_Sync_TIME=2237]="Audio_Recv_AV_Sync_TIME",e}(js||{}),ii=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(ii||{}),iE=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e[e.PAGE_VISIBILITY=2233]="PAGE_VISIBILITY",e}(iE||{}),eU=function(e){return e[e.Transport_Send_Bitrate=2234]="Transport_Send_Bitrate",e[e.Transport_Recv_Bitrate=2235]="Transport_Recv_Bitrate",e}(eU||{});const Gg=1e3,WI=6,ow=3,Xue=Math.max(WI,ow,60);function _t(e,t,r){r!=null&&Number.isFinite(r)&&(e[t]=Math.round(Math.max(0,r)))}function D7(e){const t={[ii.CONN_TYPE]:0,[ii.RTT]:e.rtt,[ii.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const r=e.selectedCandidatePair.localCandidate.relayProtocol;r==="udp"&&(t[ii.CONN_TYPE]=1),r==="tcp"&&(t[ii.CONN_TYPE]=3),r==="tls"&&(t[ii.CONN_TYPE]=4);break}case"srflx":t[ii.CONN_TYPE]=2;break;case"unknown":t[ii.CONN_TYPE]=5;break;default:t[ii.CONN_TYPE]=0}return t}function P7(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class L7 extends br{constructor(t){super(),L(this,"store",void 0),L(this,"uploadWRTCStatsTimer",void 0),L(this,"uploadOutboundDenoiserStatsTimer",void 0),L(this,"uploadExtStatsTimer",void 0),L(this,"uploadExtUsageStatsTimer",void 0),L(this,"uploadInboundExtStatsTimer",void 0),L(this,"requestStats",void 0),L(this,"requestTransportStats",void 0),L(this,"requestLocalMedia",void 0),L(this,"requestRemoteMedia",void 0),L(this,"requestAllTracks",void 0),L(this,"requestVideoIsReady",void 0),L(this,"requestUploadStats",void 0),L(this,"requestUpload",void 0),L(this,"uploadOutboundStarted",!1),L(this,"uploadInboundStarted",!1),L(this,"uploadTransportStarted",!1),L(this,"uploadBaseStatsStarted",!1),L(this,"uploadExtensionUsageStarted",!1),L(this,"lastRecvStats",void 0),L(this,"lastSendStats",void 0),L(this,"lastRefRecvStats",void 0),L(this,"lastRefSendStats",void 0),L(this,"lastNormalRecvStats",void 0),L(this,"lastNormalSendStats",void 0),L(this,"lastExtendStats",{}),L(this,"needUploadStats",{}),L(this,"needUploadRenderFreezeTime",!0),L(this,"lastUploadCompensateTime",-1),L(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const r=t%ow==0,a=t%WI==0,c=t%60==0;let d,h;if(this.uploadTransportStarted&&(d=this.requestStats(),this.store.useP2P&&(h=this.requestStats(!0))),!d&&this.uploadOutboundStarted&&(d=this.requestStats()),!h&&this.uploadInboundStarted&&(h=this.requestStats(!0)),d||h){var f;const m={};if(this.uploadTransportStarted&&d){const E=this.getTransportStats(d,r?this.lastRefSendStats:void 0,h,r);E&&(m.misc=[E])}if(this.uploadOutboundStarted&&d){const E=this.getOutboundStats(d,a?this.lastNormalSendStats:void 0,r?this.lastRefSendStats:void 0,this.lastSendStats,c);E&&(m.outbound=[E])}if(this.uploadInboundStarted&&h){this.uploadCompensateStats(t);const E=this.getInboundStats(h,a?this.lastNormalRecvStats:void 0,r?this.lastRefRecvStats:void 0,this.lastRecvStats);E&&(m.inbound=E)}const v=(f=this.requestTransportStats)===null||f===void 0?void 0:f.call(this).connectState;if(v&&(Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[iE.RTC_PEER_CONNECTION_STATE]=Mj[v]):m.misc=[{addition:{[iE.RTC_PEER_CONNECTION_STATE]:Mj[v]}}]),Do.needUploadStats.length>0||a){const E=Do.needUploadStats.shift()||(Do.visibility==="visible"?1:0);Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[iE.PAGE_VISIBILITY]=E):m.misc=[{addition:{[iE.PAGE_VISIBILITY]:E}}]}this.needUploadStats.sendType&&(Array.isArray(m.outbound)&&m.outbound[0]&&m.outbound[0].high&&(m.outbound[0].high[O7.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(m)}this.lastRecvStats=h,this.lastSendStats=d,a&&(this.lastNormalRecvStats=h,this.lastNormalSendStats=d),r&&(this.lastRefRecvStats=h,this.lastRefSendStats=d)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0,Do.startCollectStats();let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var r,a;const c=(r=this.requestTransportStats)===null||r===void 0?void 0:r.call(this);return void(c&&((a=this.requestUploadStats)===null||a===void 0||a.call(this,{misc:[{addition:{[iE.RTC_PEER_CONNECTION_STATE]:Mj[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===Xue+1&&(t=1)},Gg)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const r=t%ow==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!r)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const a=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=a,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const c=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*c;const d=this.requestStats(!0);new Array(c).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const h={};if(this.uploadInboundStarted&&d){const f=this.requestRemoteMedia()||[],m=[];f.forEach(v=>{let[E,w]=v;const S={peer:E.uid};if(E._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(E._videoSSRC)&&w.has(Je.VIDEO)&&E.videoTrack){const R=function(j,D,P){if(!D.videoRecv.find(Y=>Y.ssrc===j))return;const W={};if(P&&P._player){const Y=P._player,{renderFreezeAccTime2:ne,videoElementStatus:le}=Y;if(Do.visibility==="visible"&&le===Ci.PLAYING&&Zt().supportRequestVideoFrameCallback){const fe=Math.min(6e3,ne);Y.renderFreezeAccTime2=Math.max(0,ne-fe),_t(W,Nd.Video_Render_Freeze_Time_Render2,fe),z("USE_NEW_RENDER_FREEZE_TIME")&&_t(W,Nd.Video_Render_Freeze_Time_Render,fe)}}return W}(E._videoSSRC,d,E.videoTrack);R&&(S.video=R)}S.video&&m.push(S)}),m.length>0&&(h.inbound=m,this.requestUploadStats(h))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,r,a,c){if(!this.requestStats)return;if(!c)return t.rtt==null?void 0:{addition:{[ii.RTT]:t.rtt,[ii.CONN_TYPE]:void 0,[ii.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const d=D7(t);if(this.store.useP2P){if(a){const h=D7(a);d[ii.CONN_TYPE]&&h[ii.CONN_TYPE]&&(d[ii.CONN_TYPE]+=h[ii.CONN_TYPE]<<3)}d[ii.CONN_TYPE]?d[ii.CONN_TYPE]+=110:d[ii.CONN_TYPE]=110}else{d[ii.CONN_TYPE]?d[ii.CONN_TYPE]+=100:d[ii.CONN_TYPE]=100;const h=function(f,m){return m?[Math.ceil(8*(f.transport.bytesSent-m.transport.bytesSent)/(f.timestamp-m.timestamp)),Math.ceil(8*(f.transport.bytesReceived-m.transport.bytesReceived)/(f.timestamp-m.timestamp))]:[0,0]}(t,r);d[eU.Transport_Send_Bitrate]=h[0],d[eU.Transport_Recv_Bitrate]=h[1]}return{addition:d}}getOutboundStats(t,r,a,c,d){if(!this.requestUploadStats||!this.requestLocalMedia)return;const h=this.requestLocalMedia();if(!h||h.length===0)return;let f,m,v;return h.forEach(E=>{let[w,{track:S,ssrcs:R}]=E;switch(w){case De.LocalVideoLowTrack:case De.LocalVideoTrack:if(w===De.LocalVideoTrack){var j;const D=function(ne,le,fe,ie,_e,Te){const Ne=le.videoSend.find(Vt=>Vt.ssrc===ne);if(!Ne)return;const Ke={},{sentFrame:St,inputFrame:Et}=Ne;if(ie&&(_t(Ke,Nd.Video_Send_Qp_Sum,Ne.qpSumPerFrame),Et&&St)){const Vt=Et.frameRate,Ot=St.frameRate;Ke[Nd.Video_Send_Freeze]=function(Cn,Er){let Re=!0;return Re=!(Cn<=5)&&(Cn<=10?Er<3:Cn<=20?Er<4:Er<5),Re}(Vt,Ot)?1:0}if(_e){switch(St&&(_t(Ke,At.Video_Send_Height,St.height),_t(Ke,At.Video_Send_Width,St.width),_t(Ke,At.Video_Send_Frame_Rate,St.frameRate)),Ke[At.Video_Send_Disabled]=fe._originMediaStreamTrack&&!fe._originMediaStreamTrack.enabled||fe._mediaStreamTrack&&!fe._mediaStreamTrack.enabled?1:0,Ne.adaptionChangeReason){case"none":Ke[At.Video_Send_Adaptation]=0;break;case"cpu":Ke[At.Video_Send_Adaptation]=1;break;case"bandwidth":Ke[At.Video_Send_Adaptation]=2;break;case"other":Ke[At.Video_Send_Adaptation]=3}let Vt=0;Ne.adaptionChangeReason&&(Vt+=P7(Ne.adaptionChangeReason)),le.qualityLimitationReason&&(Vt+=P7(le.qualityLimitationReason)<<3),Ke[At.Video_Send_Adaptation]=Vt,Ke[At.Video_Send_Player_Status]=$j[fe._player?fe._player.videoElementStatus:"uninit"],_t(Ke,At.Video_Send_Nacks,Ne.nacksCount),_t(Ke,At.Video_Send_Plis,Ne.plisCount),_t(Ke,At.Video_Send_Firs,Ne.firsCount),_t(Ke,At.Video_Send_Avg_Encode,Ne.avgEncodeMs),_t(Ke,At.Video_Send_Huge_Frame_Sent,Ne.hugeFramesSent),_t(Ke,At.Video_Send_Bytes_Retransmit,Ne.retransmittedBytesSent),_t(Ke,At.Video_Send_Packages_Retransmit,Ne.retransmittedPacketsSent),_t(Ke,At.Video_Send_Key_Frames_Encoded,Ne.keyFramesEncoded);const Ot=_e.videoSend.find(Cn=>Cn.ssrc===ne);if(Ot){let Cn=Gg*ow;Ot.timestamp&&Ne.timestamp&&(Cn=Ne.timestamp-Ot.timestamp),Ot.packets!=null&&Ne.packets!=null&&_t(Ke,At.Video_Send_Package_Rate,1e3*(Ne.packets-Ot.packets)/Cn),Ne.packetsLost!=null&&Ot.packetsLost!=null&&_t(Ke,At.Video_Send_Package_Lost,Ne.packetsLost-Ot.packetsLost),Ot.bytes!=null&&Ne.bytes!=null&&_t(Ke,At.Video_Send_Bitrate,8*(Ne.bytes-Ot.bytes)/Cn)}}return Ke}(R[0].ssrcId,t,S,r,a),P=S.__className__==="CameraVideoTrack"?3:ke(j=S._hints).call(j,Pn.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==P||d)&&(this.needUploadStats={sendType:P},this.lastExtendStats.sendType=P);const W=S&&function(ne,le,fe,ie){const _e=le.videoSend.find(Ne=>Ne.ssrc===ne);if(!_e)return null;const Te={};if(ie){const Ne=_e.inputFrame,Ke=Ne&&Ne.height||fe.videoHeight||0,St=Ne&&Ne.width||fe.videoWidth||0,Et=Ne&&Ne.frameRate||0;_t(Te,At.Video_Capture_Height,Ke),_t(Te,At.Video_Capture_Width,St),_t(Te,At.Video_Capture_Frame_Rate,Et)}return Te}(R[0].ssrcId,t,S,!!a),Y=function(ne,le){const fe={};return le&&(_t(fe,At.Video_Send_Retransmit,ne.bitrate.retransmit),_t(fe,At.Video_Send_Target_Encoded,ne.bitrate.targetEncoded),_t(fe,At.Video_Send_Actual_Encoded,ne.bitrate.actualEncoded),_t(fe,At.Video_Send_Transmit,ne.bitrate.transmit),_t(fe,At.Video_Send_Bandwidth,ne.sendBandwidth)),fe}(t,!!a);m=Object.assign({},D,W,Y)}else v=function(D,P,W,Y,ne){const le=P.videoSend.find(ie=>ie.ssrc===D);if(!le)return;const fe={};if(Y){const ie=le.sentFrame;ie&&(_t(fe,At.Video_Send_Low_Height,ie.height),_t(fe,At.Video_Send_Low_Width,ie.width),_t(fe,At.Video_Send_Low_Frame_Rate,ie.frameRate));const _e=Y.videoSend.find(Te=>Te.ssrc===D);if(_e){let Te=Gg*WI;_e.timestamp&&le.timestamp&&(Te=le.timestamp-_e.timestamp),_e.packets!=null&&le.packets!=null&&_t(fe,At.Video_Send_Low_Package_Rate,1e3*(le.packets-_e.packets)/Te),le.packetsLost!=null&&_e.packetsLost!=null&&_t(fe,At.Video_Send_Low_Package_Lost,le.packetsLost-_e.packetsLost),_e.bytes!=null&&le.bytes!=null&&_t(fe,At.Video_Send_Low_Bitrate,8*(le.bytes-_e.bytes)/Te)}}return fe}(R[0].ssrcId,t,0,a);break;case De.LocalAudioTrack:f=S&&function(D,P,W,Y,ne,le){const fe=P.audioSend.find(_e=>_e.ssrc===D);if(!fe)return;const ie={};if(ne){ie[At.Audio_Send_Disabled]=W._originMediaStreamTrack&&!W._originMediaStreamTrack.enabled||W._mediaStreamTrack&&!W._mediaStreamTrack.enabled?1:0;const _e=100*W._source.getAccurateVolumeLevel(),Te=fe.inputLevel;if(Te!=null){const Ke=Math.ceil(50*Math.log10(100*Te+1));_t(ie,At.Audio_Send_Level,Ke)}_t(ie,At.Audio_Capture_PCM_Level,_e),_t(ie,At.Audio_Send_AEC_Return_Loss,fe.aecReturnLoss),_t(ie,At.Audio_Send_AEC_Return_Loss_Enhancement,fe.aecReturnLossEnhancement),_t(ie,At.Audio_Send_Bytes_Retransmit,fe.retransmittedBytesSent),_t(ie,At.Audio_Send_Packages_Retransmit,fe.retransmittedPacketsSent),ie[At.Audio_Send_Freeze]=0;const Ne=ne.audioSend.find(Ke=>Ke.ssrc===D);if(Ne){let Ke=Gg*WI;Ne.timestamp&&fe.timestamp&&(Ke=fe.timestamp-Ne.timestamp),Ne.bytes!=null&&fe.bytes!=null&&_t(ie,At.Audio_Send_Bitrate,8*(fe.bytes-Ne.bytes)/Ke),Ne.packets!=null&&fe.packets!=null&&_t(ie,At.Audio_Send_Package_Rate,1e3*(fe.packets-Ne.packets)/Ke)}}return ie}(R[0].ssrcId,t,S,0,a)}}),{high:m,low:v,audio:f}}getInboundStats(t,r,a,c){if(!this.requestRemoteMedia)return;const d=this.requestRemoteMedia()||[],h=[];return d.forEach(f=>{let[m,v]=f;const E={peer:m.uid};let w;if(v.has(Je.VIDEO)&&m.videoTrack){const S=m._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(m._videoSSRC)||!1,R=m.videoTrack?function(j,D,P,W,Y,ne,le,fe){const ie=D.videoRecv.find(Ot=>Ot.ssrc===j);if(!ie)return;const _e={},{receivedFrame:Te,outputFrame:Ne,decodeFrameRate:Ke}=ie;_t(_e,js.Video_Render_Frame_Rate_Decode,Ke),ie.framesRateFirefox&&_t(_e,js.Video_Recv_Frame_Rate,ie.framesRateFirefox),Te&&_t(_e,js.Video_Recv_Frame_Rate,Te.frameRate),_t(_e,js.Video_Recv_Frame_Dropped,ie.framesDroppedCount),_t(_e,js.Video_Recv_Bytes_Retransmit,ie.retransmittedBytesReceived),_t(_e,js.Video_Recv_Packages_Retransmit,ie.retransmittedPacketsReceived),_t(_e,js.Video_Recv_Packages_Discarded,ie.packetsDiscarded),_t(_e,js.Video_Recv_Avg_Decode,ie.avgDecodeMs),_t(_e,js.Video_Recv_Avg_Processing_Delay,ie.avgProcessingDelayMs),_t(_e,js.Video_Recv_Avg_Assembly_Time,ie.avgFramesAssembledFromMultiplePacketsMs),_t(_e,js.Video_Recv_Avg_Inter_Frame_Delay,ie.avgInterFrameDelayMs),_t(_e,js.Video_Recv_Key_Frames_Decoded,ie.keyFramesDecoded);const St=fe&&fe.videoRecv.find(Ot=>Ot.ssrc===j);if(St){const Ot=D.timestamp-fe.timestamp||Gg;ie.packetsLost!=null&&St.packetsLost!=null&&_t(_e,js.Video_Recv_Package_Lost,ie.packetsLost-St.packetsLost),St.bytes!=null&&ie.bytes!=null&&_t(_e,js.Video_Recv_Bitrate,8*(ie.bytes-St.bytes)/Ot),St.packets!=null&&ie.packets!=null&&_t(_e,js.Video_Recv_Package_Rate,1e3*(ie.packets-St.packets)/Ot)}const Et=ne&&ne.videoRecv.find(Ot=>Ot.ssrc===j);if(Et&&(_t(_e,Nd.Video_Recv_Qp_Sum,ie.qpSumPerFrame),_e[Nd.Video_Recv_Freeze]=W&&iw.isRemoteVideoFreeze(P,ie,Et)?1:0),le){var Vt;const Ot=le.videoRecv.find(Er=>Er.ssrc===j);Te?(_t(_e,At.Video_Recv_Height,Te.height),_t(_e,At.Video_Recv_Width,Te.width)):P&&(_t(_e,At.Video_Recv_Height,P._videoHeight||0),_t(_e,At.Video_Recv_Width,P._videoWidth||0)),Ne&&_t(_e,At.Video_Recv_Frame_Rate_Output,Ne.frameRate);const Cn=(Vt=P._player)===null||Vt===void 0?void 0:Vt.rendFrameRate.toFixed(0);if(Cn&&_t(_e,At.Video_Render_Frame_Rate_Render,+Cn),_t(_e,At.Video_Recv_Jitter_Buffer,ie.jitterBufferMs),_t(_e,At.Video_Recv_Current_Delay,ie.currentDelayMs),_t(_e,At.Video_Recv_Firs,ie.firsCount),_t(_e,At.Video_Recv_Nacks,ie.nacksCount),_t(_e,At.Video_Recv_Plis,ie.plisCount),P){_e[At.Video_Recv_Disabled]=P._originMediaStreamTrack.enabled&&P._mediaStreamTrack.enabled?0:1;const Er=P._player;if(Er){const{freezeTimeCounterList:Re,renderFreezeAccTime:je,renderFreezeAccTime2:Ze,videoElementStatus:Ce}=Er;if(Re&&Re.length>0&&_t(_e,Nd.Video_Render_Freeze_Time,Re.splice(0,1)[0]),Y&&Do.visibility==="visible"&&Ce===Ci.PLAYING&&Zt().supportRequestVideoFrameCallback){const O=Math.min(6e3,Ze);Er.renderFreezeAccTime2=Math.max(0,Ze-O),_t(_e,Nd.Video_Render_Freeze_Time_Render2,O);const te=Math.min(6e3,je);Er.renderFreezeAccTime=Math.max(0,je-te),_t(_e,Nd.Video_Render_Freeze_Time_Render,z("USE_NEW_RENDER_FREEZE_TIME")?O:te)}if(typeof ie.totalFreezesDuration=="number"){const O=Ot&&Ot.totalFreezesDuration?ie.totalFreezesDuration-Ot.totalFreezesDuration:ie.totalFreezesDuration;_t(_e,At.Video_Render_Freeze_Duration,1e3*O)}}}if(_e[At.Video_Recv_Player_Status]=$j[P._player?P._player.videoElementStatus:"uninit"],Ot&&ie.totalInterFrameDelay!==void 0&&ie.totalSquaredInterFrameDelay!==void 0&&Ot.totalInterFrameDelay!==void 0&&Ot.totalSquaredInterFrameDelay!==void 0){const Er=ie.totalInterFrameDelay-Ot.totalInterFrameDelay,Re=ie.totalSquaredInterFrameDelay-Ot.totalSquaredInterFrameDelay,je=ie.framesDecodeCount-Ot.framesDecodeCount,Ze=Er/je*1e3,Ce=Math.round(1e3*Math.sqrt((Re-Math.pow(Er,2)/je)/je));!isNaN(Ce)&&Ze+Ce>Math.max(3*Ze,Ze+150)&&(_e[At.Video_Recv_I_Frame_Delay]=Ce)}}return _e}(m._videoSSRC,t,m.videoTrack,S===!0,this.needUploadRenderFreezeTime,r,a,c):void 0;if(R&&(E.video=R),m.videoTrack){const j=t.videoRecv.find(D=>D.ssrc===m._videoSSRC);j&&j.estimatedPlayoutTimestamp&&(w=j.estimatedPlayoutTimestamp)}}if(v.has(Je.AUDIO)&&m.audioTrack){const S=m.audioTrack?function(R,j,D,P,W,Y){const ne=j.audioRecv.find(_e=>_e.ssrc===R);if(!ne)return;const le={};_t(le,js.Audio_Recv_Jitter,ne.jitterMs),_t(le,js.Audio_Recv_Bytes_Retransmit,ne.retransmittedBytesReceived),_t(le,js.Audio_Recv_Packages_Retransmit,ne.retransmittedPacketsReceived),_t(le,js.Audio_Recv_Packages_Discarded,ne.packetsDiscarded),_t(le,js.Audio_Recv_Avg_Processing_Delay,ne.avgProcessingDelayMs);const fe=Y&&Y.audioRecv.find(_e=>_e.ssrc===R);if(fe){const _e=Gg;ne.packets!=null&&fe.packets!=null&&_t(le,js.Audio_Recv_Package_Rate,1e3*(ne.packets-fe.packets)/_e),ne.packetsLost!=null&&fe.packetsLost!=null&&_t(le,js.Audio_Recv_Package_Lost,ne.packetsLost-fe.packetsLost)}if(P){const{receivedFrames:_e,droppedFrames:Te}=ne;_e!=null&&Te!=null&&(le[Nd.Audio_Recv_Freeze]=(ie=_e)===0||100*Te/ie>20?1:0)}var ie;if(W){const _e=100*D._source.getAccurateVolumeLevel(),Te=ne.outputLevel;if(Te!=null){const Ke=Math.ceil(50*Math.log10(100*Te+1));_t(le,At.Audio_Render_Level,Ke)}_t(le,At.Audio_Recv_PCM_Level,_e),D&&(le[At.Audio_Recv_Disabled]=D._originMediaStreamTrack.enabled&&D._mediaStreamTrack.enabled?0:1),_t(le,At.Audio_Recv_Jitter_Buffer,ne.jitterBufferMs),_t(le,At.Audio_Recv_Current_Delay,ne.jitterBufferMs),le[At.Audio_Recv_Player_Status]=$j[Ji.getPlayerState(D.getTrackId())];const Ne=W.audioRecv.find(Ke=>Ke.ssrc===R);if(Ne){Ne.bytes!=null&&ne.bytes!=null&&_t(le,At.Audio_Recv_Bitrate,8*(ne.bytes-Ne.bytes)/(Gg*ow));const Ke=ne.concealedSamples-Ne.concealedSamples;Ke>0&&_t(le,At.Audio_Recv_Concealed_Samples,Ke);const St=ne.totalSamplesReceived-Ne.totalSamplesReceived;St>0&&_t(le,At.Audio_Recv_Total_Samples_Received,St);const Et=ne.freezeSamples80-Ne.freezeSamples80;Et>0&&_t(le,At.Audio_Render_Freeze_Samples_80ms,Et);const Vt=ne.freezeSamples200-Ne.freezeSamples200;Vt>0&&_t(le,At.Audio_Render_Freeze_Samples_200ms,Vt);const Ot=ne.freezeMs80-Ne.freezeMs80;_t(le,At.Audio_Render_Freeze_Time_80ms,Ot<0?0:Ot);const Cn=ne.freezeMs200-Ne.freezeMs200;_t(le,At.Audio_Render_Freeze_Time_200ms,Cn<0?0:Cn)}}return le}(m._audioSSRC,t,m.audioTrack,r,a,c):void 0;if(S&&(E.audio=S),m.audioTrack&&w){const R=t.audioRecv.find(j=>j.ssrc===m._audioSSRC);if(R&&R.estimatedPlayoutTimestamp){const j=R.estimatedPlayoutTimestamp-w;E.audio?E.audio[js.Audio_Recv_AV_Sync_TIME]=j:E.audio={[js.Audio_Recv_AV_Sync_TIME]:j}}}}(E.video||E.audio)&&h.push(E)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find(r=>r instanceof Yx);if(t&&t._external.getDenoiserStats){const r=t._external.getDenoiserStats();r&&this.requestUpload(Vg.DENOISER_STATS,r)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[r,a]=t;a.has(Je.VIDEO)&&r.videoTrack&&r.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),a.has(Je.AUDIO)&&r.audioTrack&&r.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const r=Date.now(),a={connectionInterval:z("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:r};let c=[];const d=this.requestAllTracks&&this.requestAllTracks()||[];for(const v of d)!v.muted&&v.enabled&&(c=c.concat(await v.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[v,E]of h)E.has(Je.VIDEO)&&v.videoTrack&&(c=c.concat(await v.videoTrack.getProcessorUsage())),E.has(Je.AUDIO)&&v.audioTrack&&(c=c.concat(await v.audioTrack.getProcessorUsage()));if(c.length===0)return;a.details=function(v,E){const w={};for(const{id:D,value:P,level:W,direction:Y}of v){var S;const ne=(S=E.get(D))!==null&&S!==void 0?S:0,le=P===2?ne+z("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:ne;var R,j;E.set(D,le),w[D]?(P===2&&(w[D].value=P),W>w[D].level&&(w[D].level=W),Y==="remote"&&(w[D].remoteUidCount+=1),w[D].totalTs=(R=E.get(D))!==null&&R!==void 0?R:0):w[D]={value:P,level:W,remoteUidCount:Y==="local"?0:1,totalTs:(j=E.get(D))!==null&&j!==void 0?j:0}}return Object.keys(w).map(D=>{const{level:P,value:W,totalTs:Y}=w[D];return{id:D,level:P,value:W,totalTs:Y}})}(c,t);const f=Date.now(),m=f>r?f:r+1;this.requestUpload&&this.requestUpload(Vg.EXTENSION_USAGE_STATS,{usageStats:a,sendTs:m})},z("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1,Do.stopCollectStats()}}const $ue=z("ICE_RESTART_INTERVAL");let HI=new Map,aE=new Map,vf=[qs.UDP_TCP_RELAY,qs.TCP_RELAY,qs.RELAY],tU=z("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Zt().supportPCSetConfiguration;function j7(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=HI.get(e.id);r&&(window.clearTimeout(r),HI.delete(e.id));const a=aE.get(e.id);t&&a&&a.index===vf.length-1&&(I.debug("[".concat(e.id,"] reset ICE restart policy")),aE.delete(e.id))}function M7(e,t,r){if(HI.size===0&&aE.size===0&&(Array.isArray(z("RESTART_SEQUENCE"))&&z("RESTART_SEQUENCE").length>0&&!function(f,m){if(f.length!==m.length)return!1;for(let v=0;v<f.length;v+=1){const E=f[v];if(f.filter(w=>w===E).length!==m.filter(w=>w===E).length)return!1}return!0}(vf,z("RESTART_SEQUENCE"))&&(vf=z("RESTART_SEQUENCE").filter(f=>{var m;if(ke(m=Object.values(qs)).call(m,f))return!0}),I.debug("use reconnection policy from config distribution, queues: ".concat(vf.join(" => ")))),tU=z("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Zt().supportPCSetConfiguration),vf.length===0)return void r();let a,{index:c=0,type:d}=aE.get(e.id)||{};if(tU&&d===qs.RELAY)return void r();let h=d&&c>=vf.length-1;if(tU)d=qs.RELAY;else{if(h)return void r();d?(c++,d=vf[c]):(d=vf[0],c=0)}I.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(d,", index: ").concat(c)),t(d),aE.set(e.id,{index:c,type:d}),a=window.setTimeout(()=>M7(e,t,r),$ue),HI.set(e.id,a)}var tn;function U7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function Iu(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?U7(Object(r),!0).forEach(function(a){L(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U7(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}function V7(e){var t,r,a,c=2;for(typeof Symbol<"u"&&(r=UN,a=Symbol.iterator);c--;){if(r&&(t=e[r])!=null)return t.call(e);if(a&&(t=e[a])!=null)return new KI(t.call(e));r="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function KI(e){function t(r){if(Object(r)!==r)return Ue.reject(new TypeError(r+" is not an object."));var a=r.done;return Ue.resolve(r.value).then(function(c){return{value:c,done:a}})}return KI=function(r){this.s=r,this.n=r.next},KI.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var a=this.s.return;return a===void 0?Ue.resolve({value:r,done:!0}):t(a.apply(this.s,arguments))},throw:function(r){var a=this.s.return;return a===void 0?Ue.reject(r):t(a.apply(this.s,arguments))}},new KI(e)}let Wg=(tn=class extends br{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(dt.StateChange,t,this._state)}constructor(e,t){super(),L(this,"isPlanB",void 0),L(this,"store",void 0),L(this,"statsUploader",void 0),L(this,"connection",void 0),L(this,"localTrackMap",new Map),L(this,"remoteUserMap",new Map),L(this,"localDataChannels",[]),L(this,"remoteDataChannelMap",new Map),L(this,"pendingLocalTracks",[]),L(this,"pendingRemoteTracks",[]),L(this,"pendingLocalDataChannels",[]),L(this,"pendingRemoteDataChannels",[]),L(this,"statsCollector",void 0),L(this,"shouldForwardP2PCreation",void 0),L(this,"iceFailedCount",0),L(this,"dtlsFailedCount",0),L(this,"mutex",void 0),L(this,"_state",An.Disconnected),L(this,"_pcStatsUploadType",z("NEW_ICE_RESTART")?Ph.FIRST_CONNECTION:Ph.OLD_FIRST_CONNECTION),L(this,"_isStartRestartIce",!1),L(this,"_restartTimer",void 0),L(this,"_isTryConnecting",!1),L(this,"_iceError",null),L(this,"_forceTurn",!1),L(this,"_isWaitPcToRePub",!1),L(this,"handleMuteLocalTrack",async(r,a,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==An.Connected)return void c(new we(K.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(r);if(h.length===0)return void a();const f=h.find(v=>v[0]==="videoLowTrack");if(f){const v=f[1];this.store.enableInstantMuteRestore?(v.track._originMediaStreamTrack.enabled=!1,I.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):v.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?I.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(h.map(v=>{let[,{id:E}]=v;return E}));const m=this.createMuteMessage(h);await er(this,dt.RequestMuteLocal,m),a()}catch(h){c(h)}finally{d()}}),L(this,"handleUnmuteLocalTrack",async(r,a,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==An.Connected)return void c(new we(K.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(r);if(h.length===0)return void a();const f=h.find(v=>v[0]==="videoLowTrack");if(f){const v=f[1];if(this.store.enableInstantMuteRestore)v.track._originMediaStreamTrack.enabled=!0,I.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(v.track._originMediaStreamTrack.stop(),!z("DISABLE_DUAL_STREAM_USE_ENCODING")&&Zt().supportDualStreamEncoding){const E=r._mediaStreamTrack.clone();v.track._mediaStreamTrack=E,v.track._originMediaStreamTrack=E}else{const E=ZM(r,Tg(this,dt.RequestLowStreamParameter));v.track._mediaStreamTrack=E,v.track._originMediaStreamTrack=E}await new Ue((E,w)=>{this.handleReplaceTrack(v.track,E,w,!0)})}}this.store.enableInstantMuteRestore?I.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(h.map(v=>{let[,{id:E}]=v;return E}));const m=this.createUnmuteMessage(h);await er(this,dt.RequestUnmuteLocal,m),a()}catch(h){c(h)}finally{d()}}),L(this,"handleUpdateVideoEncoder",async(r,a,c,d)=>{let h;d||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const m=this.localTrackMap.get(De.LocalVideoTrack);if(!this.connection||!m||m.track!==r||this.state!==An.Connected)return void a();const{id:v,track:E}=m;await this.connection.updateSendParameters(v,E),await this.connection.updateEncoderConfig(v,E),this.emit(dt.UpdateVideoEncoder,E),a()}catch(m){c(m)}finally{var f;(f=h)===null||f===void 0||f()}}),L(this,"handleUpdateVideoSendParameters",async(r,a,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(De.LocalVideoTrack);if(!this.connection||!h||h.track!==r||this.state!==An.Connected)return void a();const{id:f,track:m}=h;await this.connection.updateSendParameters(f,m),a()}catch(h){c(h)}finally{d()}}),L(this,"handleReplaceMixingTrack",async(r,a,c,d)=>{if(!this.connection||this.state!==An.Connected)return void a();const h=$M([r]);let f;I.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof d=="boolean"&&d||(f=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(r,h),a()}catch(v){c(v)}finally{var m;(m=f)===null||m===void 0||m()}}),L(this,"handleReplaceTrack",async(r,a,c,d)=>{let h;I.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var f;const v=Array.from(this.localTrackMap.entries()).find(E=>{let[,{track:w}]=E;return r===w});if(!this.connection||!v||this.state!==An.Connected)return void a();if(await((f=this.connection)===null||f===void 0?void 0:f.replaceTrack(r,v[1].id)),this.isPlanB){const E=v[1];E.id=r._mediaStreamTrack.id,this.localTrackMap.set(v[0],E)}if(v[0]===De.LocalVideoTrack&&!z("DISABLE_DUAL_STREAM_USE_ENCODING")&&Zt().supportDualStreamEncoding){const E=this.localTrackMap.get(De.LocalVideoLowTrack);if(E){const w=r._mediaStreamTrack.clone();E.track._originMediaStreamTrack.stop(),E.track._mediaStreamTrack=w,E.track._originMediaStreamTrack=w,await new Ue((S,R)=>{this.handleReplaceTrack(E.track,S,R,!0)})}}a()}catch(v){c(v)}finally{var m;(m=h)===null||m===void 0||m()}}),L(this,"handleGetRTCStats",r=>{r(this.statsCollector.getRTCStats())}),L(this,"handleGetLocalVideoStats",r=>{r(this.statsCollector.getLocalVideoTrackStats())}),L(this,"handleGetLocalAudioStats",r=>{r(this.statsCollector.getLocalAudioTrackStats())}),L(this,"handleGetRemoteVideoStats",r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid]),L(this,"handleGetRemoteAudioStats",r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new L7(this.store),this.bindStatsUploaderEvents(),this.mutex=new Ks("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Zt().supportUnifiedPlan||z("CHROME_FORCE_PLAN_B")&&yu(),this.shouldForwardP2PCreation=z("FORWARD_P2P_CREATION")&&Zt().supportPCSetConfiguration&&xG(),this.shouldForwardP2PCreation&&(this.connection=aw(this.store),this.emit(dt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var r;this.state=An.New,this._forceTurn=QM(e),I.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const a=this.shouldForwardP2PCreation&&((r=this.connection)===null||r===void 0?void 0:r.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||a||t)&&((a||t)&&this.connection&&(I.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=aw(this.store,e),this.emit(dt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new we(K.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=z("NEW_ICE_RESTART")?Ph.FIRST_CONNECTION:Ph.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new we(K.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(!this.isPreallocation()||this.state!==An.Connected){this.store.peerConnectionStart();const t=await this.connection.connect(e);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=An.Connected,t}if(this.connection instanceof cc&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return I.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),tt.reportApiInvoke(this.store.sessionId,{name:_r.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:$n.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(dt.RequestReconnect)});await this.connection.updateRemoteConnect(e)}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(c=>{var d;let[h]=c;return ke(d=[De.LocalVideoLowTrack,De.LocalVideoTrack]).call(d,h)}),r=t.map(c=>{let[,{id:d}]=c;return d}),a=t.map(c=>{let[d]=c;return d});if(this.connection instanceof cc||this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"){if(tt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(a),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!ke(e).call(e,this.store.codec)){const c=["vp9","vp8","h264"].find(d=>ke(e).call(e,d));c&&(this.store.codec=c,I.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(r,e)}}async getEstablishParams(){var e;return this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof cc&&this.connection.peerConnectionState!=="closed"&&ke(e=[An.New,An.Connected]).call(e,this.state)?this.connection.establishPromise:void 0}async publishDataChannel(e){if(!this.connection||this.state!==An.Connected){if(this.state===An.Disconnected)throw new we(K.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(r=>{var a;ke(a=this.pendingLocalDataChannels).call(a,r)||this.pendingLocalDataChannels.push(r)}),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(r=>{const a=Date.now();this.store.publish(r.id.toString(),"datachannel",a)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(r=>{this.localDataChannels.push(r);const a=Date.now();this.store.publish(r.id+"","datachannel",void 0,a)}),e.map(r=>({streamId:r.id,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:r.metadata,channelId:r._originDataChannelId})))}publish(e,t,r){var a=this;return Da(function*(){const c=yield Ft(a.mutex.lock("From P2PChannel.publish"));try{var d;const h=a.connection&&ke(d=["disconnected","failed"]).call(d,a.connection.peerConnectionState);if(!a.connection||a.state!==An.Connected||h){if(a.state===An.Disconnected)throw new we(K.UNEXPECTED_ERROR,"PeerConnection already disconnected.");a.throwIfTrackTypeNotMatch(e);const m=e.filter(v=>a.pendingLocalTracks.indexOf(v)===-1);return a.pendingLocalTracks=a.pendingLocalTracks.concat(m),void(h&&(a._isWaitPcToRePub=!0))}a.store.pubId=a.store.pubId+1,Ii.markPublishStart(a.store.clientId,a.store.pubId);const f=a.filterTobePublishedTracks(e,t,r);if(f.length===0)return void(yield Ft(a.tryToUnmuteAudio(e)));yield*Iv(V7(a.doPublish(a.connection,f)))}finally{c()}})()}doPublish(e,t){var r=this;return Da(function*(){t.forEach(S=>{let{track:R,type:j}=S;const D=Date.now();r.store.publish(R.getTrackId(),j===De.LocalAudioTrack?"audio":"video",D)}),r.bindLocalTrackEvents(t);const a=t.map(S=>{let{track:R}=S;return R}),c=yield Ft(e.send(a,r.store.codec,r.store.audioCodec)),d=(yield Ft(c.next())).value,h=r.createGatewayPublishMessage(t,d);let f;try{f=yield h}catch(S){throw c.throw(S),(S==null?void 0:S.code)===K.WS_ABORT&&t.forEach(R=>{let{track:j}=R;r.pendingLocalTracks.indexOf(j)===-1&&r.pendingLocalTracks.push(j)}),r.unbindLocalTrackEvents(t),S}const m=r.mapPubResToRemoteConfig(h,f,a),v=(yield Ft(c.next(m))).value;if(r.state===An.Disconnected)throw new we(K.UNEXPECTED_ERROR,"PeerConnection already disconnected.");z("ENABLE_VIDEO_SEI");const E=z("ENABLE_ENCODED_TRANSFORM"),w=z("ENABLE_AUDIO_METADATA");a.forEach(async S=>{const R=S.getRTCRtpTransceiver();if(!R||!E)return;const{interceptLocalVideoFrame:j,interceptLocalAudioFrame:D}=LI();S.trackMediaType===Je.VIDEO?await j(R.sender,S):S.trackMediaType===Je.AUDIO&&await D(R.sender,{metadata:w?()=>{const P=S.metadata.shift();return P&&P.value}:void 0})}),t.forEach(S=>{let{type:R}=S;r.statsCollector.addLocalStats(R)}),r.assignLocalTracks(t,v),r.statsUploader.startUploadOutboundStats(),t.forEach(S=>{let{track:R,type:j}=S;const D=Date.now();r.store.publish(R.getTrackId(),j===De.LocalAudioTrack?"audio":"video",void 0,D)})})()}async updateVideoStreamParameter(e,t){const r=this.localTrackMap.get(t);if(!r||!this.connection)return;if(!(r.track instanceof Jn))return I.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:a}=r,c=function(d,h){const f={};return d.height&&d.width&&(f.scaleResolutionDownBy=IM(d,h)),f.maxFramerate=d.framerate?Ua(d.framerate):void 0,f.maxBitrate=d.bitrate?1e3*d.bitrate:void 0,f}(e,a);if(a._encoderConfig||(a._encoderConfig={}),t!==De.LocalVideoLowTrack||!z("DISABLE_DUAL_STREAM_USE_ENCODING")&&Zt().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(a._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const d=a._originMediaStreamTrack;if(!d.canvas)return I.warn("[".concat(a.getTrackId(),"] no canvas on track"));(function(h,f){const m=h.canvas;f.width&&(m.width=Ua(f.width)),f.height&&(m.height=Ua(f.height)),f.framerate&&(m.stopCapture&&m.stopCapture(),m.stopCapture=Zj(()=>{!m.startCapture&&m.stopCapture&&m.stopCapture(),m.startCapture&&m.startCapture()},Ua(f.framerate)))})(d,e)}c.maxBitrate!=null&&(a._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(a._encoderConfig.frameRate&&typeof a._encoderConfig.frameRate=="object"?a._encoderConfig.frameRate.max=c.maxFramerate:a._encoderConfig.frameRate={max:c.maxFramerate}),I.debug("[".concat(a.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(a._encoderConfig))),await this.connection.updateRtpSenderEncodings(a)}publishLowStream(e){var t=this;return Da(function*(){if(!t.connection||t.state!==An.Connected)return;const r=yield Ft(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=t.localTrackMap.get(De.LocalVideoTrack);if(!c)throw new we(K.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(De.LocalVideoLowTrack))throw new we(K.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const d=[{track:t.getLowVideoTrack(c.track,e),type:De.LocalVideoLowTrack}];if(yield*Iv(V7(t.doPublish(t.connection,d))),c.track.muted||!c.track.enabled){var a;const h=(a=t.localTrackMap.get(De.LocalVideoLowTrack))===null||a===void 0?void 0:a.id;h!==void 0&&(yield Ft(t.connection.muteLocal([h])))}}finally{r()}})()}async republish(){this.pendingLocalTracks.length>0&&(I.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await _s(this,dt.RequestRePublish,this.pendingLocalTracks),this.emit(dt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(I.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await _s(this,dt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:r,kind:a}=this.pendingRemoteTracks[t];(a!==Je.AUDIO||r._audio_added_&&r._audioSSRC)&&(a!==Je.VIDEO||r._video_added_&&r._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await _s(this,dt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:r}of this.pendingRemoteTracks)await this.subscribe(t,r,r===Je.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:r}=t;this.emit(dt.MediaReconnectEnd,r.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==An.Connected)return void e.forEach(a=>{const c=this.pendingLocalTracks.indexOf(a);c!==-1&&this.pendingLocalTracks.splice(c,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const r=t.find(a=>a[0]==="videoLowTrack");return r&&r[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==An.Connected)return void e.forEach(r=>{const a=this.pendingLocalDataChannels.indexOf(r);a!==-1&&this.pendingLocalDataChannels.splice(a,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(r=>{const a=this.localDataChannels.indexOf(r);a!==-1&&this.localDataChannels.splice(a,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(r=>r.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==An.Connected)return;const e=this.localTrackMap.get(De.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[De.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const r=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(a=>{let[,{id:c}]=a;return c})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(a=>{let[c,{track:d}]=a;return{type:c,track:d}})),t.forEach(a=>{let[c]=a;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),r}async subscribeDataChannel(e,t){if(!this.connection||this.state!==An.Connected)throw new we(K.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const r=t.filter(a=>{var c;return!((c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.get(a.id))});if(r.length!==0)return await this.connection.createDataChannels(e.uid,r),r.forEach(a=>{var c;this.remoteDataChannelMap.has(e)?(c=this.remoteDataChannelMap.get(e))===null||c===void 0||c.set(a.id,a):this.remoteDataChannelMap.set(e,new Map([[a.id,a]]));const d=this.pendingRemoteDataChannels.findIndex(h=>{let{user:f,id:m}=h;return f.uid===e.uid&&m===a.id});d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),r.map(a=>a.id)}async subscribe(e,t,r,a,c){var d;if(!this.connection||this.state!==An.Connected)throw new we(K.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((d=this.remoteUserMap.get(e))!==null&&d!==void 0&&d.has(t))return;let h,f,m,v;const E=this.connection.getPreMedia(r);if(E)I.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(r,", no need to send sub to gateway.")),m=E.transceiver,h=E.track,f=E.mid,v=E.player,E.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:E.firstVideoRender});else if(c){const R=c.find(D=>{let{stream_type:P}=D;return P===t});if(!R)throw new we(K.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const j=await this.connection.receive(t,R.ssrcs,String(e._uintid),R.attributes);(this.connection instanceof cc||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(m=j.transceiver),h=j.track,f=j.id}else{const R=await this.connection.receive(t,[{ssrcId:r,rtx:a}],String(e._uintid),void 0);(this.connection instanceof cc||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(m=R.transceiver),h=R.track,f=R.id}if(t===Je.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(h):(e._audioTrack=new Kv(h,e.uid,e._uintid,this.store),I.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),m&&e._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(h):(e._videoTrack=new Hv(h,e.uid,e._uintid,this.store,v),I.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(Dc.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once(Dc.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),v?e._videoTrack.once(Dc.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once(Dc.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),m&&e._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._videoTrack)),m&&z("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:R,interceptRemoteAudioFrame:j}=LI();t==Je.VIDEO?await R(m.receiver,{onSei:z("ENABLE_VIDEO_SEI")&&(D=>{var P;return(P=e._videoTrack)===null||P===void 0?void 0:P._onSei(D)}),onFirstFrame:D=>{var P;const W=Array.from(Ui(P=this.remoteUserMap).call(P)).find(Y=>Y._videoSSRC===D.ssrc);W&&this.store.firstVideoFrameDecoded(W.uid,{firstReceivedEncodedFrame:Date.now(),frameType:D.type,rtpTimestamp:D.rtpTimestamp,framePayloadType:D.payloadType,frameDataLength:D.length,mimeType:D.mimeType})}}):t==Je.AUDIO&&await j(m.receiver,{enableTopn:!!z("ENABLE_AUDIO_TOPN"),enableMetadata:!!z("ENABLE_AUDIO_METADATA"),enablePts:!!z("ENABLE_AUDIO_PTS"),onMetadata:D=>{this.safeEmit(dt.AudioMetadata,D)},onPts:D=>{this.safeEmit(dt.AudioPts,D)}})}const w=this.remoteUserMap.get(e);w?w.set(t,f):this.remoteUserMap.set(e,new Map([[t,f]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const S=this.pendingRemoteTracks.findIndex(R=>{let{user:j,kind:D}=R;return j.uid===e.uid&&t===D});S!==-1&&(this.pendingRemoteTracks.splice(S,1),this.emit(dt.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==An.Connected)throw new we(K.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(c=>{var d;let{user:h,mediaType:f}=c;return!((d=this.remoteUserMap.get(h))!==null&&d!==void 0&&d.has(f))});const t=[],r=new Map;e.forEach(c=>{if(!this.connection)return;const d=this.connection.getPreMedia(c.ssrcId);if(d){const{track:h,mid:f,transceiver:m,player:v}=d;r.set(c.ssrcId,{track:h,id:f,transceiver:m,player:v})}else t.push(c)});const a=await this.connection.batchReceive(t.map(c=>{let{user:d,mediaType:h,ssrcId:f,rtxSsrcId:m}=c;return{kind:h,ssrcMsg:[{ssrcId:f,rtx:m}],mslabel:String(d._uintid)}}));t.forEach((c,d)=>{r.set(c.ssrcId,a[d])});for(const{user:c,mediaType:d,ssrcId:h}of e){const f=r.get(h);if(!f)return void I.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(d,", ").concat(h));const{track:m,id:v,transceiver:E,player:w}=f;if(E&&z("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:j,interceptRemoteAudioFrame:D}=LI();d==Je.VIDEO?await j(E.receiver,{onSei:z("ENABLE_VIDEO_SEI")&&(P=>{var W;return(W=c._videoTrack)===null||W===void 0?void 0:W._onSei(P)}),onFirstFrame:P=>{var W;const Y=Array.from(Ui(W=this.remoteUserMap).call(W)).find(ne=>ne._videoSSRC===P.ssrc);Y&&this.store.firstVideoFrameDecoded(Y.uid,{firstReceivedEncodedFrame:Date.now(),frameType:P.type,rtpTimestamp:P.rtpTimestamp,framePayloadType:P.payloadType,frameDataLength:P.length,mimeType:P.mimeType})}}):d==Je.AUDIO&&await D(E.receiver,{enableTopn:!!z("ENABLE_AUDIO_TOPN"),enableMetadata:!!z("ENABLE_AUDIO_METADATA"),enablePts:!!z("ENABLE_AUDIO_PTS"),onMetadata:P=>{this.safeEmit(dt.AudioMetadata,P)},onPts:P=>{this.safeEmit(dt.AudioPts,P)}})}if(d===Je.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(m):(c._audioTrack=new Kv(m,c.uid,c._uintid,this.store),I.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),E&&c._audioTrack._updateRtpTransceiver(E),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(m):(c._videoTrack=new Hv(m,c.uid,c._uintid,this.store,w),I.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),E&&c._videoTrack._updateRtpTransceiver(E),this.bindRemoteTrackEvents(c,c._videoTrack)),z("ENABLE_VIDEO_SEI")&&E){const{interceptRemoteVideoFrame:j,interceptRemoteAudioFrame:D}=LI();d==Je.VIDEO?await j(E.receiver,{onSei:P=>{var W;(W=c._videoTrack)===null||W===void 0||W._onSei(P)},onFirstFrame:P=>{var W;const Y=Array.from(Ui(W=this.remoteUserMap).call(W)).find(ne=>ne._videoSSRC===P.ssrc);Y&&this.store.firstVideoFrameDecoded(Y.uid,{firstReceivedEncodedFrame:Date.now(),frameType:P.type,rtpTimestamp:P.rtpTimestamp,framePayloadType:P.payloadType,frameDataLength:P.length,mimeType:P.mimeType})}}):d==Je.AUDIO&&await D(E.receiver)}const S=this.remoteUserMap.get(c);S?S.set(d,v):this.remoteUserMap.set(c,new Map([[d,v]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const R=this.pendingRemoteTracks.findIndex(j=>{let{user:D,kind:P}=j;return D.uid===c.uid&&d===P});R!==-1&&(this.pendingRemoteTracks.splice(R,1),this.emit(dt.MediaReconnectEnd,c.uid))}}async unsubscribe(e,t,r){const a=this.pendingRemoteTracks.filter(h=>{let{user:f,kind:m}=h;return t!==void 0?f.uid===e.uid&&t===m:f.uid===e.uid});if(a.forEach(h=>{const f=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(f,1)}),this.connection&&this.state===An.Connected||r||a.forEach(h=>{let{kind:f}=h;var m;if(f===Je.AUDIO)(m=e._audioTrack)===null||m===void 0||m._destroy(),e._audioTrack=void 0;else if(f===Je.VIDEO){var v;(v=e._videoTrack)===null||v===void 0||v._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==An.Connected)return;const c=this.filterTobeUnSubscribedTracks(e,t);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:f}]=h;return f}));const d=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[f,{kind:m}]=h;var v,E;if(m===Je.VIDEO&&f._videoSSRC&&((v=this.connection)===null||v===void 0||v.setStatsRemoteVideoIsReady(f._videoSSRC,!1)),m===Je.VIDEO)this.unbindRemoteTrackEvents(f._videoTrack),r||((E=f._videoTrack)===null||E===void 0||E._destroy(),f._videoTrack=void 0);else if(m===Je.AUDIO){var w;this.unbindRemoteTrackEvents(f._audioTrack),!r&&((w=f._audioTrack)===null||w===void 0||w._destroy(),f._audioTrack=void 0)}}),d}async unsubscribeDataChannel(e,t){if(t.forEach(c=>{const d=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),!this.connection)return;const r=this.filterTobeUnSubscribedDataChannels(e,t);if(r.length===0)return;t.forEach(c=>{c._close()});const a=this.remoteDataChannelMap.get(e);return r.forEach(c=>{a&&a.delete(c.id)}),a&&a.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),r.map(c=>c.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:c,mediaType:d}of e){const h=this.pendingRemoteTracks.filter(f=>{let{user:m,kind:v}=f;return d!==void 0?m.uid===c.uid&&d===v:m.uid===c.uid});h.forEach(f=>{const m=this.pendingRemoteTracks.indexOf(f);this.pendingRemoteTracks.splice(m,1)}),t=t.concat(h)}if(!this.connection||this.state!==An.Connected)return void t.forEach(c=>{let{user:d,kind:h}=c;var f;if(h===Je.AUDIO)(f=d._audioTrack)===null||f===void 0||f._destroy(),d._audioTrack=void 0;else if(h===Je.VIDEO){var m;(m=d._videoTrack)===null||m===void 0||m._destroy(),d._videoTrack=void 0}});const r=To(e).call(e,(c,d)=>{let{user:h,mediaType:f}=d;const m=this.filterTobeUnSubscribedTracks(h,f);return c.concat(m)},[]);if(r.length===0)return;await this.connection.stopReceiving(r.map(c=>{let[,{id:d}]=c;return d}));const a=this.createUnsubscribeAllMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r.forEach(c=>{let[d,{kind:h}]=c;var f,m;if(h===Je.VIDEO&&d._videoSSRC&&((f=this.connection)===null||f===void 0||f.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),h===Je.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),(m=d._videoTrack)===null||m===void 0||m._destroy(),d._videoTrack=void 0;else if(h===Je.AUDIO){var v;this.unbindRemoteTrackEvents(d._audioTrack),(v=d._audioTrack)===null||v===void 0||v._destroy(),d._audioTrack=void 0}}),a}isPreSubScribe(e){return!this.connection||this.state!==An.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const r=this.remoteUserMap.get(e);if(!r)return void I.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void I.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const a=t===Je.VIDEO?e._videoSSRC:e._audioSSRC;a!==void 0&&this.connection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const r=this.remoteUserMap.get(e);if(!r)return void I.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||I.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(De.LocalAudioTrack),r=t&&t.track;r&&r.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(De.LocalAudioTrack);if((t==null?void 0:t.track)instanceof bs){const r=t.track;return Array.from(this.localTrackMap.entries()).filter(a=>{let[c]=a;return c!==De.LocalAudioTrack}).filter(a=>{let[c]=a;return!(e&&c===De.LocalVideoLowTrack)}).map(a=>{let[,{track:c}]=a;return c}).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter(r=>{let[a]=r;return!(e&&a===De.LocalVideoLowTrack)}).map(r=>{let[,{track:a}]=r;return a})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,r,a,c){if(e){const h=this.localTrackMap.get(De.LocalAudioTrack),f=a?this.localTrackMap.get(De.LocalVideoLowTrack):this.localTrackMap.get(De.LocalVideoTrack);tt.publish(this.store.sessionId,{eventElapse:Ii.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:f==null?void 0:f.track.getTrackLabel(),screenshare:(f==null?void 0:f.track._hints.indexOf(Pn.SCREEN_TRACK))!==-1,audio:!!h,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;r||(r=[]);const h=r.find(m=>m instanceof Xr),f=a?(d=this.localTrackMap.get(De.LocalVideoTrack))===null||d===void 0?void 0:d.track:r.find(m=>m instanceof Jn);tt.publish(this.store.sessionId,{eventElapse:Ii.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h==null?void 0:h.getTrackLabel(),videoName:f==null?void 0:f.getTrackLabel(),screenshare:(f==null?void 0:f._hints.indexOf(Pn.SCREEN_TRACK))!==-1,audio:!!h,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,t,r,a){const c=a===Je.VIDEO?r._videoSSRC:r._audioSSRC;c&&tt.subscribe(this.store.sessionId,{succ:e,ec:t,video:a===Je.VIDEO,audio:a===Je.AUDIO,peerid:r.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:Ii.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){I.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Ks("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=aw(this.store),this.emit(dt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(De.LocalAudioTrack);if((e==null?void 0:e.track)instanceof bs){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(r=>{t.removeAudioTrack(r)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=An.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(De.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(De.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Jn||t&&t.track instanceof Xr?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;const r=Array.from(Ui(t=this.remoteUserMap).call(t)).find(a=>a.uid===e);return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(r=>{let[a]=r;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(De.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Th(e).call(e,(r,a)=>r.level-a.level),e}async disconnectForReconnect(){this.connection&&(I.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=An.Reconnecting,z("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var r;t._videoTrack&&t._videoTrack._player&&((r=t._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=aw(this.store),this.emit(dt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[r,{track:a}]=e;switch(r){case De.LocalVideoTrack:ke(t=a._hints).call(t,Pn.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case De.LocalAudioTrack:a instanceof bs?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case De.LocalVideoLowTrack:}}),this.emit(dt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;Array.from(Ui(r).call(r)).forEach(a=>{this.setPendingRemoteMedia(t,a)}),this.emit(dt.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,r]=e;Array.from(Ui(r).call(r)).forEach(a=>{this.setPendingRemoteDataChannel(t,a)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),I.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const r of this.pendingRemoteDataChannels){const{user:a,id:c}=r;if((e instanceof _f?e.uid:e)===a.uid&&c===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const r of this.pendingRemoteTracks){const{user:a,kind:c}=r;if((e instanceof _f?e.uid:e)===a.uid&&t===c)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return Da(function*(){if(!t.connection||t.state!==An.Connected)return;const r=yield Ft(t.mutex.lock("From P2PChannel.restartICE"));let a;try{a=yield Ft(t.connection.restartICE(e));const d=yield Ft(a.next());if(d.done)return;const h=d.value,f=yield h;switch(JM(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case qs.UDP_TCP_RELAY:t._pcStatsUploadType=Ph.UDP_TCP_RESTART;break;case qs.TCP_RELAY:t._pcStatsUploadType=Ph.TCP_RESTART;break;case qs.RELAY:t._pcStatsUploadType=Ph.RELAY_RESTART;break;default:t._pcStatsUploadType=Ph.OLD_RESTART}t._isTryConnecting=!0,a.next(f)}catch(d){var c;(c=a)===null||c===void 0||c.throw(d)}finally{r()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(De.LocalVideoTrack),r=this.localTrackMap.get(De.LocalAudioTrack),a=e.videoSend.find(R=>R.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),c=e.audioSend.find(R=>R.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId));if(!a||!c)return 1;const d=Oo(this,dt.NeedSignalRTT),h=a?a.rttMs:void 0,f=c?c.rttMs:void 0,m=h&&f?(h+f)/2:h||f,v=(m&&d?(m+d)/2:m||d)||0,E=100*e.sendPacketLossRate*.7/50+.3*v/1500,w=E<.17?1:E<.36?2:E<.59?3:E<.1?4:5,S=t==null?void 0:t.track;if(S&&S._encoderConfig&&S._hints.indexOf(Pn.SCREEN_TRACK)===-1){const R=S._encoderConfig.bitrateMax,j=e.bitrate.actualEncoded;if(R&&j){const D=(1e3*R-j)/(1e3*R);return TH[D<.15?0:D<.3?1:D<.45?2:D<.6?3:4][w]}}return w}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(r=>{let[a]=r;const c=a._audioSSRC,d=a._videoSSRC,h=e.audioRecv.find(j=>j.ssrc===c),f=e.videoRecv.find(j=>j.ssrc===d);if(!h&&!f)return void(t+=1);const m=Oo(this,dt.NeedSignalRTT),v=e.rtt,E=(v&&m?(v+m)/2:v||m)||0,w=h?h.jitterMs:void 0,S=e.recvPacketLossRate;let R=.7*S*100/50+.3*E/1500;w&&(R=.6*S*100/50+.2*E/1500+.2*w/400),t+=R<.1?1:R<.17?2:R<.36?3:R<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Ue((t,r)=>{this.handleMuteLocalTrack(e,t,r)})}async replaceTrack(e,t){var r;if(I.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==An.Connected)return;const a=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return e===h});if(!a)return;const c=a[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:c}]),this.bindLocalTrackEvents([{track:t,type:c}]),a[1].track=t),await((r=this.connection)===null||r===void 0?void 0:r.replaceTrack(t,a[1].id)),this.isPlanB){const d=a[1];d.id=t._mediaStreamTrack.id,this.localTrackMap.set(c,d)}if(c===De.LocalVideoTrack&&!z("DISABLE_DUAL_STREAM_USE_ENCODING")&&Zt().supportDualStreamEncoding){const d=this.localTrackMap.get(De.LocalVideoLowTrack);if(d){const h=e._mediaStreamTrack.clone();d.track._originMediaStreamTrack.stop(),d.track._mediaStreamTrack=h,d.track._originMediaStreamTrack=h,await new Ue((f,m)=>{this.handleReplaceTrack(d.track,f,m,!0)})}}}filterTobePublishedTracks(e,t,r){const a=[],c=this.getAllTracks();e=Ov(e=e.filter(m=>c.indexOf(m)===-1));let d,h=!1;const f=this.localTrackMap.get(De.LocalAudioTrack);for(const m of e){if(m instanceof Jn&&(this.localTrackMap.has(De.LocalVideoTrack)||h?new we(K.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:m,type:De.LocalVideoTrack}),h=!0),t)){const v=this.getLowVideoTrack(m,r);a.push({track:v,type:De.LocalVideoLowTrack})}if(m instanceof Xr)if(f){const v=f.track;if(v instanceof bs)XM([m]),v.addAudioTrack(m),this.bindLocalAudioTrackEvents(m,!0);else{const E=$M([v,m]);I.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(E.getTrackId(),"]")),this.replaceTrack(v,E)}}else d instanceof bs?(XM([m]),d.addAudioTrack(m)):d||!m._useAudioElement&&Zt().webAudioMediaStreamDest&&!m._bypassWebAudio?d=$M(d?[m,d]:[m]):d=m}return d&&(I.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(d.getTrackId(),"]")),a.push({track:d,type:De.LocalAudioTrack})),a}filterTobeUnpublishedTracks(e){const t=[],r=this.getAllTracks();e=Ov(e=e.filter(a=>r.indexOf(a)!==-1));for(const a of e){if(a instanceof Xr){const c=this.localTrackMap.get(De.LocalAudioTrack);if(!c)continue;c.track instanceof bs?(c.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),c.track.trackList.length===0&&(t.push([De.LocalAudioTrack,c]),c.track.close())):t.push([De.LocalAudioTrack,c])}if(a instanceof Jn){const c=this.localTrackMap.get(De.LocalVideoTrack);if(!c)continue;t.push([De.LocalVideoTrack,c]);const d=this.localTrackMap.get(De.LocalVideoLowTrack);d&&t.push([De.LocalVideoLowTrack,d])}}return t}filterTobePublishedDataChannels(e){return e=(e=Ov(e)).filter(t=>this.localDataChannels.findIndex(r=>r.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Ov(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:r,type:a}=t;switch(a){case De.LocalVideoTrack:r.addListener(nt.GET_STATS,this.handleGetLocalVideoStats),r.addListener(nt.GET_RTC_STATS,this.handleGetRTCStats),r.addListener(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(nt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener(nt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener(nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case De.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case De.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof bs?e.trackList.forEach(r=>{r.addListener(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(nt.GET_STATS,this.handleGetLocalAudioStats),r.addListener(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(nt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(nt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[r,{track:a}]=t;return{track:a,type:r}})),e.forEach(t=>{let{track:r,type:a}=t;switch(a){case De.LocalVideoTrack:r.off(nt.GET_STATS,this.handleGetLocalVideoStats),r.off(nt.GET_RTC_STATS,this.handleGetRTCStats),r.off(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(nt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off(nt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off(nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case De.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case De.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof bs?e.trackList.forEach(t=>{t.off(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(nt.GET_STATS,this.handleGetLocalAudioStats),t.off(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(nt.GET_STATS,this.handleGetLocalAudioStats),e.off(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(nt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Hv&&t.addListener(nt.GET_STATS,r=>{r(this.handleGetRemoteVideoStats(e))}),t instanceof Kv&&t.addListener(nt.GET_STATS,r=>{r(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(nt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;r.has(Je.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has(Je.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((r,a)=>{var c;let d,h,{track:f,type:m}=r;switch(m){case De.LocalAudioTrack:d=Un.Audio,h={dtx:f instanceof Yx&&f._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case De.LocalVideoTrack:d=ke(c=f._hints).call(c,Pn.SCREEN_TRACK)?Un.Screen:Un.High,h=Iu(Iu({},FH(f)),{},{codec:this.store.codec,svc_mode:Qx()});break;case De.LocalVideoLowTrack:d=Un.Low,h=Iu(Iu({},FH(f)),{},{codec:this.store.codec,svc_mode:Qx()})}return{stream_type:d,attributes:h,ssrcs:t[a]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var r;let a,[c,{track:d,ssrcs:h,id:f}]=t;switch(c){case De.LocalVideoTrack:a=ke(r=d._hints).call(r,Pn.SCREEN_TRACK)?Un.Screen:Un.High;break;case De.LocalAudioTrack:a=Un.Audio;break;case De.LocalVideoLowTrack:a=Un.Low}return{stream_type:a,ssrcs:h,mid:f}})}assignLocalTracks(e,t){e.forEach((r,a)=>{let{track:c,type:d}=r;this.localTrackMap.set(d,{track:c,id:t[a].id,ssrcs:t[a].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[r]=t;this.localTrackMap.delete(r)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(dt.PeerConnectionStateChange,t),t==="connecting"&&e instanceof cc&&!dr()&&z("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},z("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof cc&&j7(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=Ph.DISCONNECTED_OR_FAILED,Oo(this,dt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const r=this.pendingLocalTracks.map(c=>c.getTrackId()),a=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));tt.reportApiInvoke(this.store.sessionId,{name:_r.REPUB_AFTER_PC_CONNECTED,options:r.concat(a),tag:$n.TRACER}).onSuccess(),this.republish()}if(z("NEW_ICE_RESTART")&&e instanceof cc&&!dr()&&!this._forceTurn&&!this.store.useDcSignal){if(ke(PH).call(PH,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const r=c=>{JM(e)&&(I.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),Oo(this,dt.QueryClientConnectionState)==="CONNECTED"&&this.emit(dt.RequestRestartICE,c))},a=()=>{JM(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),I.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(dt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{M7(e,r,a)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&z("ICE_RESTART")&&Oo(this,dt.QueryClientConnectionState)==="CONNECTED"&&this.emit(dt.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(I.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(dt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(I.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(dt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),tt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:$n.TRACER}).onSuccess(),this.emit(dt.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var r;const a=Array.from(Ui(r=this.remoteUserMap).call(r)).find(d=>d._audioSSRC===t);var c;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(c=a.audioTrack)===null||c===void 0||c.emit(Dc.FIRST_FRAME_DECODED),tt.firstRemoteFrame(this.store.sessionId,ys.FIRST_AUDIO_DECODE,vr.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:Ii.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var r;const a=Array.from(Ui(r=this.remoteUserMap).call(r)).find(c=>c._audioSSRC===t);a&&tt.firstRemoteFrame(this.store.sessionId,ys.FIRST_AUDIO_RECEIVED,vr.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:Ii.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,r,a)=>{var c;const d=Array.from(Ui(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);d&&this.store.firstVideoFrameDecoded(d.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,r,a)},e.onFirstVideoRender=t=>{var r;const a=Array.from(Ui(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);a&&(this.store.firstVideoFrameDecoded(a.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(a),this.emit(dt.FirstVideoPreRender,a.uid,t))},e.onFirstVideoReceived=t=>{var r;const a=Array.from(Ui(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);a&&(this.store.firstVideoFrameDecoded(a.uid,{firstReceived:Date.now()}),tt.firstRemoteFrame(this.store.sessionId,ys.FIRST_VIDEO_RECEIVED,vr.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:Ii.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstVideoBufferReady=t=>{var r;const a=Array.from(Ui(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);a&&this.emit(dt.FirstVideoBufferReady,a.uid,t)},e.onSelectedLocalCandidateChanged=(t,r)=>{const a=t.candidateType==="relay",c=r.candidateType==="relay";r.candidateType!=="unknown"&&a===c||this.emit(dt.ConnectionTypeChange,a),I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(mf(r))," -> ").concat(JSON.stringify(mf(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,r)=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(mf(r))," -> ").concat(JSON.stringify(mf(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),r=this.statsCollector.getRTCStats();return Iu(Iu({},t),r)},e.onICECandidateError=t=>{this._iceError=t}}fallbackConnection(){I.debug("[".concat(this.store.clientId,"] [P2PChannel] try to fallback connection")),this.state===An.Connected?(I.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&this.resetConnection(this.connection),this.shouldForwardP2PCreation&&(this.connection=aw(this.store),this.emit(dt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)))}resetConnection(e){e instanceof cc&&function(t){aE.delete(t.id),j7(t)}(e),e.close(),this.emit(dt.PeerConnectionStateChange,"closed"),function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const r=this.localTrackMap.get(De.LocalAudioTrack);if(e instanceof Xr&&(r==null?void 0:r.track)instanceof bs)return r.track.isActive||t.push([De.LocalAudioTrack,r]),t;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return e===d});if(a&&(t.push(a),a[0]===De.LocalVideoTrack)){const c=this.localTrackMap.get(De.LocalVideoLowTrack);c&&t.push([De.LocalVideoLowTrack,c])}return t}filterTobeUnmutedTracks(e){const t=[],r=this.localTrackMap.get(De.LocalAudioTrack);if(e instanceof Xr&&(r==null?void 0:r.track)instanceof bs)return r.track.isActive&&t.push([De.LocalAudioTrack,r]),t;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return e===d});if(a)if(a[0]===De.LocalVideoTrack){t.push(a);const c=this.localTrackMap.get(De.LocalVideoLowTrack);c&&t.push([De.LocalVideoLowTrack,c])}else t.push(a);return t}createMuteMessage(e){return e.map(t=>{var r;let a,[c,{track:d,ssrcs:h,id:f}]=t;switch(c){case De.LocalAudioTrack:a=Un.Audio;break;case De.LocalVideoTrack:a=ke(r=d._hints).call(r,Pn.SCREEN_TRACK)?Un.Screen:Un.High;break;case De.LocalVideoLowTrack:a=Un.Low}return{stream_type:a,ssrcs:h,mid:f}})}createUnmuteMessage(e){return e.map(t=>{var r;let a,[c,{track:d,ssrcs:h,id:f}]=t;switch(c){case De.LocalAudioTrack:a=Un.Audio;break;case De.LocalVideoTrack:a=ke(r=d._hints).call(r,Pn.SCREEN_TRACK)?Un.Screen:Un.High;break;case De.LocalVideoLowTrack:a=Un.Low}return{stream_type:a,ssrcs:h,mid:f}})}filterTobeUnSubscribedTracks(e,t){const r=[],a=this.remoteUserMap.get(e);if(!a)return r;if(t){const c=a.get(t);if(!c)return r;r.push([e,{kind:t,id:c}])}else Array.from(a.entries()).forEach(c=>{let[d,h]=c;r.push([e,{kind:d,id:h}])});return r}filterTobeUnSubscribedDataChannels(e,t){const r=[];return t.forEach(a=>{var c;(c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.has(a.id)&&r.push(a)}),r}createUnsubscribeMessage(e){const t=[];return e.forEach(r=>{let[a,{kind:c,id:d}]=r;switch(c){case Je.VIDEO:return void(a._videoSSRC&&t.push({stream_type:Je.VIDEO,ssrcId:a._videoSSRC}));case Je.AUDIO:return void(a._audioSSRC&&t.push({stream_type:Je.AUDIO,ssrcId:a._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(r=>{let[a,{kind:c}]=r;if(t.has(a)){let d=t.get(a);c===Je.VIDEO?d|=Ls.Video:d|=Ls.Audio,t.set(a,d)}else c===Je.VIDEO?t.set(a,Ls.Video):t.set(a,Ls.Audio)}),{users:Array.from(t.entries()).map(r=>{let[a,c]=r;return{stream_id:a.uid,stream_type:c}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[r,{kind:a}]=t;const c=this.remoteUserMap.get(r);c&&(c.delete(a),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(r))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(De.LocalVideoTrack),r=this.localTrackMap.get(De.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new Ue((a,c)=>{this.handleUpdateVideoEncoder(t.track,a,c,!0)})),r&&e.low_stream_uplink&&(await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Ue((a,c)=>{this.handleUpdateVideoEncoder(r.track,a,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return!(!this.connection||!("name"in this.connection)||this.connection.name!=="DataChannelConnection"||this.connection.peerConnectionState==="closed")||this.connection instanceof cc&&this.connection.isPreallocation}isPreSub(){return(this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof cc)&&this.connection.isPreSub()}isPreRender(){return this.connection instanceof cc&&this.connection.isPreRender}mapPubResToRemoteConfig(e,t,r){return e.map((a,c)=>{var d;let{stream_type:h}=a;const f=(d=t.find(m=>{let{stream_type:v}=m;return h===v}))===null||d===void 0?void 0:d.attributes;if(f&&z("DISABLE_SCREEN_SHARE_REMB")){const m=r[c]._hints;(ke(m).call(m,Pn.SCREEN_TRACK)||ke(m).call(m,Pn.SCREEN_LOW_TRACK))&&(f.remb=!1,I.debug("disable remb for screen share, hints:",m))}return f})}async tryToUnmuteAudio(e){for(let r=0;r<e.length;r++)if(e[r]instanceof Xr){var t;const a=this.filterTobeUnmutedTracks(e[r]);if(a.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(a.map(d=>{let[,{id:h}]=d;return h})));const c=this.createUnmuteMessage(a);return void await er(this,dt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(dt.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(dt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Ds(JN(this.dtlsFailedCount,ls)),this.emit(dt.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await _s(this,dt.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(dt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(De.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Jn)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Jn).length>1)throw new we(K.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Xr).length>1&&(e.some(t=>t instanceof Xr&&t._bypassWebAudio)||!Zt().webAudioMediaStreamDest))throw new we(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Jn&&this.pendingLocalTracks.some(r=>r instanceof Jn))throw new we(K.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Xr&&this.pendingLocalTracks.some(r=>r instanceof Xr)&&(!Zt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(r=>r instanceof Xr&&r._bypassWebAudio)))throw new we(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var r;const a=!z("DISABLE_DUAL_STREAM_USE_ENCODING")&&Zt().supportDualStreamEncoding,c=Iu(Iu({},{width:160,height:120,framerate:15,bitrate:50}),t);let d;d=a?e._mediaStreamTrack.clone():ZM(e,c);const h=jn(8,"track-low-"),f=new Jn(d,Iu(Iu({},a&&{scaleResolutionDownBy:IM(c,e)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return f.on(Og.TRANSCEIVER_UPDATED,m=>{e._updateRtpTransceiver(m,Vv.LOW_STREAM)}),f._hints.push(Pn.LOW_STREAM),ke(r=e._hints).call(r,Pn.SCREEN_TRACK)&&f._hints.push(Pn.SCREEN_LOW_TRACK),e.on("sei-to-send",m=>{f.emit("sei-to-send",m)}),e.addListener(nt.NEED_CLOSE,()=>{f.close()}),f}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,r){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof cc){var c,d,h,f;const m=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:v,dtlsTransportState:E,peerConnectionState:w}=this.connection,{local:S,remote:R}=await this.connection.getSelectedCandidatePair();tt.pcStats(this.store.sessionId,{startTime:m,eventElapse:e-m||0,iceconnectionsate:v,dtlsstate:E,connectionstate:w,intSucc:t?1:2,error:this._iceError||a||"",selectedLocalCandidateProtocol:(c=S==null?void 0:S.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(d=S.candidateType)!==null&&d!==void 0?d:"",selectedLocalCandidateAddress:"".concat(S.address,":").concat(S.port),selectedRemoteCandidateProtocol:(h=R.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(f=R.candidateType)!==null&&f!==void 0?f:"",selectedRemoteCandidateAddress:"".concat(R.address,":").concat(R.port),restartCnt:r,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){const t=this.store.keyMetrics,r=t.firstVideoFrameDecoded.find(E=>E.userId===e.uid);if(!r)return;const{isInternalUpload:a,isExternalUpload:c}=r;if(a&&c)return;const{subscribeEnd:d,firstPreRender:h,peerPublishDuration:f,peerPubStatusMs:m}=r;let{firstRender:v=0}=r;if(d&&(v||h)&&f&&m){r.isInternalUpload=!0;const{playEnd:E}=r;E&&(r.isExternalUpload=!0);const{firstPreRender:w=0}=r;v=w||v;const S=e.videoTrack,R={peer:e._uintid,width:(S==null?void 0:S._videoWidth)||0,height:(S==null?void 0:S._videoHeight)||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:f,peerPubStatusMs:m,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:r.userJoinNotify||0,videoAddNotify:r.videoAddNotify||0,subscribeStart:r.subscribeStart||0,subscribeEnd:r.subscribeEnd||0,firstReceived:r.firstReceived||0,firstDecoded:r.firstDecoded||0,firstPreRender:w||0,firstRender:E?Math.max(v,E):Math.max(v,d),playStart:r.playStart||0,playEnd:r.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:aW(this.store),firstReceivedEncodedFrame:r.firstReceivedEncodedFrame||0,frameType:r.frameType||"",rtpTimestamp:r.rtpTimestamp||0,framePayloadType:r.framePayloadType||0,frameDataLength:r.frameDataLength||0,mimeType:r.mimeType||""};tt.firstXLAPeerFirstVideoFrame(this.store.sessionId,R)}}reportVideoFirstFrameDecoded(e,t,r,a){var c;const d=Array.from(Ui(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(d){a||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,f=h.subscribe.find(m=>m.userId===d.uid&&m.type==="video");tt.firstRemoteVideoDecode(this.store.sessionId,ys.FIRST_VIDEO_DECODE,vr.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:t,videoheight:r,subscribeElapse:Ii.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(f==null?void 0:f.subscribeEnd)||0,subscriberStart:(f==null?void 0:f.subscribeStart)||0,videoAddNotify:(f==null?void 0:f.streamAdded)||0,state:a?1:0,firstFrame:(f==null?void 0:f.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.connection)return!1;const a=this.remoteUserMap.get(e);if(!a)return!1;const c=a.get(t);if(!c)return!1;const d=await this.connection.getRemoteSSRC(c);return d!==void 0&&d!==r}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:r}]=e;t===De.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,Vv.LOW_STREAM):r._updateRtpTransceiver(void 0)})}},Fe(tn.prototype,"startP2PConnection",[Qi],Object.getOwnPropertyDescriptor(tn.prototype,"startP2PConnection"),tn.prototype),Fe(tn.prototype,"connect",[Qi],Object.getOwnPropertyDescriptor(tn.prototype,"connect"),tn.prototype),Fe(tn.prototype,"updateRemoteRTPCapabilities",[Qi],Object.getOwnPropertyDescriptor(tn.prototype,"updateRemoteRTPCapabilities"),tn.prototype),Fe(tn.prototype,"publishDataChannel",[Qi],Object.getOwnPropertyDescriptor(tn.prototype,"publishDataChannel"),tn.prototype),Fe(tn.prototype,"unpublish",[Qi],Object.getOwnPropertyDescriptor(tn.prototype,"unpublish"),tn.prototype),Fe(tn.prototype,"unpublishDataChannel",[Qi],Object.getOwnPropertyDescriptor(tn.prototype,"unpublishDataChannel"),tn.prototype),Fe(tn.prototype,"unpublishLowStream",[Qi],Object.getOwnPropertyDescriptor(tn.prototype,"unpublishLowStream"),tn.prototype),Fe(tn.prototype,"subscribeDataChannel",[Qi],Object.getOwnPropertyDescriptor(tn.prototype,"subscribeDataChannel"),tn.prototype),Fe(tn.prototype,"subscribe",[Qi],Object.getOwnPropertyDescriptor(tn.prototype,"subscribe"),tn.prototype),Fe(tn.prototype,"massSubscribe",[Qi],Object.getOwnPropertyDescriptor(tn.prototype,"massSubscribe"),tn.prototype),Fe(tn.prototype,"unsubscribe",[Qi],Object.getOwnPropertyDescriptor(tn.prototype,"unsubscribe"),tn.prototype),Fe(tn.prototype,"unsubscribeDataChannel",[Qi],Object.getOwnPropertyDescriptor(tn.prototype,"unsubscribeDataChannel"),tn.prototype),Fe(tn.prototype,"massUnsubscribe",[Qi],Object.getOwnPropertyDescriptor(tn.prototype,"massUnsubscribe"),tn.prototype),Fe(tn.prototype,"muteRemote",[Qi],Object.getOwnPropertyDescriptor(tn.prototype,"muteRemote"),tn.prototype),Fe(tn.prototype,"unmuteRemote",[Qi],Object.getOwnPropertyDescriptor(tn.prototype,"unmuteRemote"),tn.prototype),Fe(tn.prototype,"hasRemoteMediaWithLock",[Qi],Object.getOwnPropertyDescriptor(tn.prototype,"hasRemoteMediaWithLock"),tn.prototype),Fe(tn.prototype,"disconnectForReconnect",[Qi],Object.getOwnPropertyDescriptor(tn.prototype,"disconnectForReconnect"),tn.prototype),Fe(tn.prototype,"updateBitrateLimit",[Qi],Object.getOwnPropertyDescriptor(tn.prototype,"updateBitrateLimit"),tn.prototype),Fe(tn.prototype,"remoteMediaSsrcChanged",[Qi],Object.getOwnPropertyDescriptor(tn.prototype,"remoteMediaSsrcChanged"),tn.prototype),tn);function Qi(e,t,r){const a=e[t];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this.mutex,d=await c.lock("From P2PChannel.".concat(t));try{for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];return await a.apply(this,f)}finally{d()}},r}function F7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function B7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?F7(Object(r),!0).forEach(function(a){L(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F7(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}const Jue=Date.now(),Que=20,nU=new Map,qI=new Map;async function z7(e){const t=nU.get(e),r=Array.isArray(t)&&t[t.length-1],a=qI.get(e);if(!r)return void(a.isSyncing=!1);const c={uid:r.uid,payload:r.payload};a.firstRecvTs===0&&(a.firstRecvTs=r.recvTs,a.firstSendTs=r.sendTs);const d=r.sendTs-a.firstSendTs,h=d-(Date.now()-a.firstRecvTs);h>0&&(a.firstRecvTs=Date.now()-d);let f=r.mediaDelay+h;f<=0?(t.pop(),G7(r.context,c),f=0):f=Math.min(f,Que),setTimeout(()=>t.length&&z7(e),f)}function G7(e,t){e.safeEmit(Kt.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function Zue(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return G7(r,{uid:e.uid,payload:e.payload});const a="".concat(r.id,"-").concat(e.uid),c=nU.get(a)||[],d=c.findIndex(v=>e.sendTs>=v.sendTs),h=B7(B7({},e),{},{context:r,mediaDelay:t,recvTs:Date.now()});d===-1?c.push(h):c.splice(d,0,h),nU.set(a,c);let f=!1;var m;qI.has(a)?f=!((m=qI.get(a))===null||m===void 0||!m.isSyncing):qI.set(a,{isSyncing:f,firstRecvTs:0,firstSendTs:0}),f||z7(a)}const ehe=yn().name;function W7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function H7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?W7(Object(r),!0).forEach(function(a){L(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W7(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}const oE="websdk_ng_cache_parameter",the=z("MAX_PRELOAD_ASYNC_LENGTH"),nhe=1e4,Hg=new Map,Kg=[];let rU=null,sU=0,iU=0;const YI=new Map,K7=new Uint8Array([241,141,127,212,103,139,200,225,251,157,127,139,143,2,22,163]),rhe=function(e,t){const r=[];let a=0;const c=async()=>{const d=r.shift();d&&await d(),r.length>0&&a<t?c():a--};return async function(){for(var d=arguments.length,h=new Array(d),f=0;f<d;f++)h[f]=arguments[f];return new Ue(async(m,v)=>{r.push(async()=>{try{const E=await e(...h);m(E)}catch(E){v(E)}}),a<t&&(a++,c())})}}(oU,the),aU=Pa.CancelToken.source();class she{constructor(){L(this,"_audioContext",null)}createMuteAudioTrack(){this._audioContext=new AudioContext;const t=this._audioContext.sampleRate,r=10*t,a=this._audioContext.createBuffer(2,r,t),c=this._audioContext.createBufferSource();c.buffer=a;const d=this._audioContext.createMediaStreamDestination();return c.connect(d),c.start(),d.stream.getAudioTracks()[0]}close(){this._audioContext&&(this._audioContext.close(),this._audioContext=null)}}async function oU(e,t,r,a,c,d,h){try{if(!z("ENABLE_PRELOAD"))return;if(!Zt().supportWebCrypto)return void lf(()=>{I.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!r&&r!==null)throw new we(K.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));r&&ri(r,"token",1,2047),ri(e,"appid",1,2047),wI(t),a&&SI(a);const f=Ng();I.debug("preload channel ".concat(t,", uid is ").concat(a));const m={appId:e,cname:t,token:r||e,uid:typeof a!="string"?a:null,sid:f,proxyServer:c,role:h};let v,E;typeof a=="string"?(m.stringUid=a,[E,v]=await Ue.all([Vue(a,{sid:f,appId:e},aU.token),g7(H7(H7({},m),{},{token:r||e,uid:0}),aU.token)]),m.uid=E.uid,v.gatewayInfo.uid=m.uid,v.gatewayInfo.res.uid=m.uid):(d&&(m.stringUid=d),v=await g7(m,aU.token));const w={sid:f,appId:e,cname:t,token:r||e,uid:m.stringUid||a,intUid:m.uid||v.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:E,ap:v};await lU(w),sU++}catch(f){throw iU++,function(m){rU||(rU=window.setTimeout(()=>{let E="";YI.forEach((w,S)=>{E+="".concat(S,": ").concat(w," ;")}),tt.reportApiInvoke(null,{name:_r.PRELOAD,options:{success:sU,failed:iU,err:E}}).onError(m),sU=0,iU=0,YI.clear(),rU=null},nhe));const v=YI.get(m.code)||0;YI.set(m.code,v+1)}(f),f}}async function cU(e){try{if(z("AP_REQUEST_DETAIL")||z("ENABLE_ROLE_SELECT_EDGE"))return;const t=q7(e);if(!t||e.cloudProxyServer!=="disabled")return;const r=await async function(a,c){try{const d=await window.crypto.subtle.importKey("raw",PG(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:K7},d,Cg(a));return JSON.parse(window.atob(df(new Uint8Array(h))))}catch{return}}(t,e.token||e.appId);if(!r||!function(a,c){return a.cname===c.cname&&a.appId===c.appId&&a.token===c.token?c.stringUid?a.stringUid===c.stringUid:typeof c.uid=="number"?a.uid===c.uid:a.uid==c.uid:!1}(r,e))return;if(r&&Date.now()-r.ts<z("AP_CACHE_LIFETIME"))return r}catch(t){I.warn("Error get preloadInfo",t.message)}}function q7(e){let t;try{if(t=$7(oE),!t)return;const r=JSON.parse(t),a=J7(e),c=function(h,f){for(let m=h.length-1;m>=0;m--)if(f(h[m]))return m;return-1}(r,h=>a in h);if(c===-1)return;const d=r.splice(c,1)[0];return XI(oE,JSON.stringify(r)),d[a]}catch(r){I.warn("Error delete preload info: ".concat(t),r.message),XI(oE,"")}}async function lU(e){let t;try{e.uid&&q7({appId:e.appId,cname:e.cname,token:e.token,uid:e.uid,stringUid:e.stringUid});const r=J7(e),a=await async function(d,h){try{const f=await window.crypto.subtle.importKey("raw",PG(h),"AES-GCM",!1,["encrypt"]),m=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:K7},f,Cg(window.btoa(JSON.stringify(d))));return df(new Uint8Array(m))}catch{return}}(e,e.token||e.appId);if(!a)return;t=$7(oE);const c=t?JSON.parse(t):[];c.push({[r]:a}),c.length>z("AP_CACHE_NUM")&&c.shift(),XI(oE,JSON.stringify(c))}catch(r){I.warn("Error caching server parameters:",r.message),XI(oE,"")}}function dU(e){if(e){let t=Hg.get(e);t&&(window.clearTimeout(t),t=null,Hg.delete(e)),ke(Kg).call(Kg,e)||e.cloudProxyServer!=="disabled"||Kg.push(e)}if(Hg.size<z("AP_CACHE_NUM")&&Kg.length>0){const t=Kg.shift();Hg.set(t,window.setTimeout(async()=>{const{appId:r,cname:a,token:c,stringUid:d,uid:h,proxyServer:f,role:m}=t;try{await rhe(r,a,c,h,f,d,m),Hg.has(t)&&dU(t)}catch(v){I.warn("update preload failed",v.message),Y7(t)}},z("AP_UPDATE_INTERVAL")))}}function Y7(e){const t=Kg.indexOf(e);t!==-1&&Kg.splice(t,1);let r=Hg.get(e);r&&(window.clearTimeout(r),r=null,Hg.delete(e),dU())}function X7(e,t){const r=e.sua,a=e.ap;t&&r&&tt.reqUserAccount(e.sid,{lts:r.requestTime,elapse:r.elapse,success:!0,serverAddr:r.url,stringUid:t,uid:e.intUid,errorCode:null,extend:r.req}),tt.reportResourceTiming(e.ap.url,e.sid),tt.joinWebProxyAP(e.sid,{lts:a.requestTime,elapse:a.elapse,sucess:1,apServerAddr:a.url,turnServerAddrList:a.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[ds.CHOOSE_SERVER,ds.CLOUD_PROXY_FALLBACK].toString()}),tt.joinChooseServer(e.sid,{lts:a.requestTime,elapse:a.elapse,succ:!0,csAddr:a.url,opid:a.opid,serverList:a.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:a.gatewayInfo.cid.toString(),uid:a.gatewayInfo.uid.toString(),csIp:a.gatewayInfo.csIp,unilbsServerIds:[ds.CHOOSE_SERVER].toString(),isHttp3:a.isHttp3})}function $7(e){return window.atob(window.localStorage.getItem(e)||"")}function XI(e,t){window.localStorage.setItem(e,window.btoa(t))}function J7(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),BG(t)}function ihe(e){let t=function(){const r=che.pop();return r?(r.offset=r.limit=0,r):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(r,a){let c=r.appId;c!==void 0&&(us(a,10),Ef(a,c));let d=r.cid;d!==void 0&&(us(a,16),us(a,d));let h=r.cname;h!==void 0&&(us(a,26),Ef(a,h));let f=r.deviceId;f!==void 0&&(us(a,34),Ef(a,f));let m=r.elapse;m!==void 0&&(us(a,40),yf(a,m));let v=r.fileSize;v!==void 0&&(us(a,48),yf(a,cE(v)));let E=r.height;E!==void 0&&(us(a,56),yf(a,cE(E)));let w=r.jpg;w!==void 0&&(us(a,66),us(a,w.length),Z7(a,w));let S=r.networkType;S!==void 0&&(us(a,72),yf(a,cE(S)));let R=r.osType;R!==void 0&&(us(a,80),yf(a,cE(R)));let j=r.requestId;j!==void 0&&(us(a,90),Ef(a,j));let D=r.sdkVersion;D!==void 0&&(us(a,98),Ef(a,D));let P=r.sequence;P!==void 0&&(us(a,104),yf(a,cE(P)));let W=r.sid;W!==void 0&&(us(a,114),Ef(a,W));let Y=r.timestamp;Y!==void 0&&(us(a,120),yf(a,Y));let ne=r.uid;ne!==void 0&&(us(a,128),us(a,ne));let le=r.vid;le!==void 0&&(us(a,136),us(a,le));let fe=r.width;fe!==void 0&&(us(a,144),yf(a,cE(fe)));let ie=r.service;ie!==void 0&&(us(a,152),us(a,ie));let _e=r.callbackData;_e!==void 0&&(us(a,162),us(a,_e.length),Z7(a,_e));let Te=r.ticket;Te!==void 0&&(us(a,170),Ef(a,Te));let Ne=r.vendorConfigs;Ne!==void 0&&(us(a,178),Ef(a,Ne))}(e,t),function(r){let a=r.bytes,c=r.limit;return a.length===c?a:a.subarray(0,c)}(t)}function ahe(e){return function(r){let a={};e:for(;!lhe(r);){let c=cw(r);switch(c>>>3){case 0:break e;case 1:a.code=cw(r);break;case 2:a.msg=eK(r,cw(r));break;case 3:a.requestId=eK(r,cw(r));break;case 4:a.timestamp=dhe(r,!1);break;default:ohe(r,7&c)}}return a}({bytes:t=e,offset:0,limit:t.length});var t}function ohe(e,t){switch(t){case 0:for(;128&Pl(e););break;case 2:uU(e,cw(e));break;case 5:uU(e,4);break;case 1:uU(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function cE(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let che=[];function uU(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function lhe(e){return e.offset>=e.limit}function $I(e,t){let r=e.bytes,a=e.offset,c=e.limit,d=a+t;if(d>r.length){let h=new Uint8Array(2*d);h.set(r),e.bytes=h}return e.offset=d,d>c&&(e.limit=d),a}function Q7(e,t){let r=e.offset;if(r+t>e.limit)throw new Error("Read past limit");return e.offset+=t,r}function Z7(e,t){let r=$I(e,t.length);e.bytes.set(t,r)}function eK(e,t){let r=Q7(e,t),a=String.fromCharCode,c=e.bytes,d="",h="";for(let f=0;f<t;f++){let m,v,E,w,S=c[f+r];128&S?(224&S)==192?f+1>=t?h+=d:(m=c[f+r+1],(192&m)!=128?h+=d:(w=(31&S)<<6|63&m,w<128?h+=d:(h+=a(w),f++))):(240&S)==224?f+2>=t?h+=d:(m=c[f+r+1],v=c[f+r+2],(49344&(m|v<<8))!=32896?h+=d:(w=(15&S)<<12|(63&m)<<6|63&v,w<2048||w>=55296&&w<=57343?h+=d:(h+=a(w),f+=2))):(248&S)==240?f+3>=t?h+=d:(m=c[f+r+1],v=c[f+r+2],E=c[f+r+3],(12632256&(m|v<<8|E<<16))!=8421504?h+=d:(w=(7&S)<<18|(63&m)<<12|(63&v)<<6|63&E,w<65536||w>1114111?h+=d:(w-=65536,h+=a(55296+(w>>10),56320+(1023&w)),f+=3))):h+=d:h+=a(S)}return h}function Ef(e,t){let r=t.length,a=0;for(let h=0;h<r;h++){let f=t.charCodeAt(h);f>=55296&&f<=56319&&h+1<r&&(f=(f<<10)+t.charCodeAt(++h)-56613888),a+=f<128?1:f<2048?2:f<65536?3:4}us(e,a);let c=$I(e,a),d=e.bytes;for(let h=0;h<r;h++){let f=t.charCodeAt(h);f>=55296&&f<=56319&&h+1<r&&(f=(f<<10)+t.charCodeAt(++h)-56613888),f<128?d[c++]=f:(f<2048?d[c++]=f>>6&31|192:(f<65536?d[c++]=f>>12&15|224:(d[c++]=f>>18&7|240,d[c++]=f>>12&63|128),d[c++]=f>>6&63|128),d[c++]=63&f|128)}}function Pl(e){return e.bytes[Q7(e,1)]}function tK(e,t){let r=$I(e,1);e.bytes[r]=t}function cw(e){let t,r=0,a=0;do t=Pl(e),r<32&&(a|=(127&t)<<r),r+=7;while(128&t);return a}function us(e,t){for(t>>>=0;t>=128;)tK(e,127&t|128),t>>>=7;tK(e,t)}function dhe(e,t){let r,a=0,c=0,d=0;return r=Pl(e),a=127&r,128&r&&(r=Pl(e),a|=(127&r)<<7,128&r&&(r=Pl(e),a|=(127&r)<<14,128&r&&(r=Pl(e),a|=(127&r)<<21,128&r&&(r=Pl(e),c=127&r,128&r&&(r=Pl(e),c|=(127&r)<<7,128&r&&(r=Pl(e),c|=(127&r)<<14,128&r&&(r=Pl(e),c|=(127&r)<<21,128&r&&(r=Pl(e),d=127&r,128&r&&(r=Pl(e),d|=(127&r)<<7))))))))),{low:a|c<<28,high:c>>>4|d<<24,unsigned:t}}function yf(e,t){let r=t.low>>>0,a=(t.low>>>28|t.high<<4)>>>0,c=t.high>>>24,d=c===0?a===0?r<16384?r<128?1:2:r<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:c<128?9:10,h=$I(e,d),f=e.bytes;switch(d){case 10:f[h+9]=c>>>7&1;case 9:f[h+8]=d!==9?128|c:127&c;case 8:f[h+7]=d!==8?a>>>21|128:a>>>21&127;case 7:f[h+6]=d!==7?a>>>14|128:a>>>14&127;case 6:f[h+5]=d!==6?a>>>7|128:a>>>7&127;case 5:f[h+4]=d!==5?128|a:127&a;case 4:f[h+3]=d!==4?r>>>21|128:r>>>21&127;case 3:f[h+2]=d!==3?r>>>14|128:r>>>14&127;case 2:f[h+1]=d!==2?r>>>7|128:r>>>7&127;case 1:f[h]=d!==1?128|r:127&r}}const nK={},rK={},JI=4294967296,uhe=JI*JI,sK=uhe/2;aK(0,!0);const iK=aK(0),hhe=lw(0,-2147483648,!1),phe=lw(-1,2147483647,!1);function aK(e,t){let r,a,c;return t?(c=0<=(e>>>=0)&&e<256)&&(a=rK[e],a)?a:(r=lw(e,0,!0),c&&(rK[e]=r),r):(c=-128<=(e|=0)&&e<128)&&(a=nK[e],a)?a:(r=lw(e,e<0?-1:0,!1),c&&(nK[e]=r),r)}function lw(e,t,r){return{low:0|e,high:0|t,unsigned:!!r}}function oK(e,t){if(isNaN(e))return iK;{if(e<=-sK)return hhe;if(e+1>=sK)return phe}return e<0?iK:lw(e%JI|0,e/JI|0,t)}function cK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}class hU extends br{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const r=this._connectionState;this._connectionState=t,this.emit(Sd.CONNECTION_STATE_CHANGE,t,r)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var r;super(),L(this,"name","AgoraRTCImageModeration"),L(this,"_connectionState",jc.CONNECTING),L(this,"_sequence",0),L(this,"_moderationStartTime",void 0),L(this,"_workerConnection",void 0),L(this,"_workerMessageLengthLimit",void 0),L(this,"_qualityRatio",void 0),L(this,"_connectInfo",void 0),L(this,"_cancelTokenSource",Pa.CancelToken.source()),L(this,"_retryConfig",void 0),L(this,"_moderationInterval",void 0),L(this,"_moderationTimer",null),L(this,"_moderationMode",1),L(this,"_quality",1),L(this,"_qualityTimer",null),L(this,"_ticket",void 0),L(this,"_moderationIntervalMinimum",void 0),L(this,"_uploadFailedNum",0),L(this,"_uploadNum",0),L(this,"_uploadTimer",null),L(this,"_extraInfo",void 0),L(this,"_vendor",""),L(this,"_encoder",new TextEncoder),L(this,"_moderationId",void 0),L(this,"inspectImage",()=>{if(this.connectionState!==jc.CONNECTED)throw new Ee(K.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===jc.CONNECTED?this.requestToInspectImage():I.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=jn(5,"image-moderation-"),this._workerMessageLengthLimit=z("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=z("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(r=t.interval)!==null&&r!==void 0?r:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=z("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new $x("worker-"+this._moderationId,ls),this.on(Sd.STATE_CHANGE,(a,c)=>{I.debug("[".concat(this._moderationId,"] Moderation operation :").concat($v[a]," ").concat(c||""))}),this.handleWorkerEvents()}async init(t,r){this.emit(Sd.STATE_CHANGE,$v.CONNECT_AP),this._connectInfo=t;const a=this._cancelTokenSource.token;return this._retryConfig=r,new Ue((c,d)=>{this.on(Sd.CONNECTION_STATE_CHANGE,(h,f)=>{h===jc.CONNECTED&&c()}),this.requestAP(t,a,r).then(h=>{this.connectWorker(h)}).catch(h=>{d(h)})})}updateConfig(t){var r;this._moderationInterval=(r=t.interval)!==null&&r!==void 0?r:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),I.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===jc.CONNECTED&&this.inspectImage()}async requestAP(t,r,a){const c=z("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),d=await function(m,v,E,w){let{appId:S,areaCode:R,cname:j,sid:D,token:P,uid:W}=v;tE++;const Y="moderation_plugin",ne={service_name:Y,json_body:JSON.stringify({appId:S,areaCode:R,cname:j,command:"allocateEdge",requestId:tE,seq:tE,sid:D,appToken:P,ts:Date.now(),uid:W+""})};let le,fe,ie=m[0];return yd(async()=>{le=Date.now();const _e=await Rd(ie,{data:ne,cancelToken:E,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(fe=Date.now()-le,_e.code!==0){const Et=new Ee(K.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+_e.code,{retry:!0,responseTime:fe});throw I.error(Et.toString()),Et}const Te=JSON.parse(_e.json_body);if(Te.code!==200){const Et=new Ee(K.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Te.code,", reason: ").concat(Te.reason),{code:Te.code,responseTime:fe});throw I.error(Et.toString()),Et}if(!Te.servers||!Array.isArray(Te.servers)||Te.servers.length===0){const Et=new Ee(K.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Te.code,responseTime:fe});throw I.error(Et.toString()),Et}if(!Te.servers.some(Et=>!!Et.wss)){const Et=new Ee(K.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Te.code,responseTime:fe});throw I.error(Et.toString()),Et}const Ne=z("IMAGE_MODERATION_WORKER_WSS");if(Ne)return{addressList:[Ne],workerToken:Te.workerToken,vid:Te.vid,responseTime:fe};const Ke=z("IMAGE_MODERATION_WORKER_HOST");return{addressList:Te.servers.map(Et=>{let{address:Vt,wss:Ot}=Et;if(Vt&&Ot)return"wss://".concat(Vt.replace(/\./g,"-"),".").concat(Ke,":").concat(Ot,"/moderation")}).filter(Et=>!!Et),workerToken:Te.workerToken,vid:Te.vid,ticket:Te.appTicket,responseTime:fe}},(_e,Te)=>(tt.apworkerEvent(D,{success:!0,sc:200,serviceName:Y,responseDetail:JSON.stringify(_e.addressList),firstSuccess:Te===0,responseTime:fe,serverIp:m[Te%m.length]}),!1),(_e,Te)=>(tt.apworkerEvent(D,{success:!1,sc:_e.data&&_e.data.code||200,serviceName:Y,responseTime:fe,serverIp:m[Te%m.length]}),!!(_e.code!==K.OPERATION_ABORTED&&_e.code!==K.UNEXPECTED_RESPONSE||_e.data&&_e.data.retry)&&(ie=m[(Te+1)%m.length],!0)),w)}(c,t,r,a);this.emit(Sd.STATE_CHANGE,$v.AP_CONNECTED);const{addressList:h,ticket:f}=d;return this._ticket=f,h}async connectWorker(t){this.emit(Sd.STATE_CHANGE,$v.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(Lt.CONNECTED,async()=>{this.emit(Sd.STATE_CHANGE,$v.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=jc.CONNECTED}),this._workerConnection.on(Lt.CLOSED,()=>{this.connectionState=jc.CLOSED}),this._workerConnection.on(Lt.FAILED,()=>{this.connectionState=jc.CLOSED}),this._workerConnection.on(Lt.RECONNECTING,()=>{this.connectionState=this.connectionState===jc.CONNECTED?jc.RECONNECTING:jc.CONNECTING}),this._workerConnection.on(Lt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const r=ahe(new Uint8Array(t.data));z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&I.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(r)),this._uploadNum++,r.code===void 0||r.code===0||(this._uploadFailedNum++,I.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(r.code,", msg is ").concat(r.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{tt.reportApiInvoke(this._connectInfo.sid||null,{name:_r.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,r.code],tag:$n.TRACER}).onError(new Ee(K.IMAGE_MODERATION_UPLOAD_FAILED,r.msg)),this._uploadTimer=null},z("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else I.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Lt.WILL_RECONNECT,(t,r,a)=>{t==="recover"&&a(t),a("tryNext")}),this._workerConnection.on(Lt.REQUEST_NEW_URLS,(t,r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(r)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=Oo(this,Sd.CLIENT_LOCAL_VIDEO_TRACK),r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&I.debug("Only the track being played can be inspected"));this._sequence++;const a=await this.generateRequestData(t,r);this._workerConnection.sendMessage(a,!0,!0)}else z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&I.debug("Only the track being published can be inspected")}async generateRequestData(t,r){let{appId:a,cname:c,cid:d,vid:h,sid:f,uid:m}=r;const v=Date.now(),E=await t.getCurrentFrameImage("image/jpeg",this.quality),w=await OW(E,a,c),S=this._sequence+"-"+d+"-"+m+"-"+v+"-"+jn(12,""),R={appId:a,cid:d,cname:c,deviceId:"",elapse:hU.intToLong(Number(v-this._moderationStartTime)),fileSize:E.buffer.byteLength,height:E.height,width:E.width,jpg:w,networkType:6,osType:7,requestId:S,sdkVersion:"4.24.2",sequence:this._sequence,sid:f,timestamp:oK(v),uid:m,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete R.callbackData;const j=ihe(R);if(j.byteLength<this._workerMessageLengthLimit){if(z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const D=function(P){for(var W=1;W<arguments.length;W++){var Y=arguments[W]!=null?arguments[W]:{};W%2?cK(Object(Y),!0).forEach(function(ne){L(P,ne,Y[ne])}):Object.getOwnPropertyDescriptors?Object.defineProperties(P,Object.getOwnPropertyDescriptors(Y)):cK(Object(Y)).forEach(function(ne){Object.defineProperty(P,ne,Object.getOwnPropertyDescriptor(Y,ne))})}return P}({},R);delete D.jpg,I.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(D))}return j}{const D=this.quality*this._qualityRatio;return this.quality=D,await this.generateRequestData(t,{appId:a,cname:c,cid:d,vid:h,sid:f,uid:m})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Pa.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=jc.CLOSED,this.emit(Sd.STATE_CHANGE,$v.CLOSED)}}function lK(e){if(Xn(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new Ee(K.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new Ee(K.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const fhe={name:"ImageModeration",create:function(e){let{config:t}=e;return lK(t),new hU(t)}};var dK,uK,hK,pK,fK,mK,gK,_K,vK,EK,yK,bK,xK,wK,SK,TK,RK,CK,NK,IK,AK,kK,OK,DK,PK,LK,jK,MK,UK,VK,FK,BK,zK,GK,WK,HK,KK,qK,YK,XK,$K,JK,Xe;function QK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function Ll(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?QK(Object(r),!0).forEach(function(a){L(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):QK(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}Ks.setLogger(I);let mhe=(dK=mt(),uK=mt({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof zv))return[t];t=[t]}return t.map(r=>r?Object(r).toString():"null")}}),hK=mt({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==Bv.DATA?(Array.isArray(t)||(t=[t]),t.map(r=>r.getTrackId())):[t.getChannelId()])}),pK=mt({argsMap:(e,t,r,a)=>[typeof t=="object"?t.uid:t,r,a]}),fK=mt({argsMap:(e,t,r)=>[t,r]}),mK=mt({argsMap:(e,t)=>t.map(r=>{let{user:a,mediaType:c}=r;return[a==null?void 0:a.uid,c]})}),gK=mt({argsMap:(e,t,r,a)=>[typeof t=="object"?t.uid:t,r,a]}),_K=mt({argsMap:(e,t)=>t.map(r=>{let{user:a,mediaType:c}=r;return{uid:a==null?void 0:a.uid,mediaType:c}})}),vK=mt(),EK=mt(),yK=mt(),bK=mt(),xK=mt(),wK=mt(),SK=mt(),TK=mt(),RK=mt(),CK=mt(),NK=mt(),IK=mt(),AK=mt(),kK=mt(),OK=mt(),DK=mt(),PK=mt({argsMap:(e,t)=>[t]}),LK=mt(),jK=mt(),MK=mt(),UK=mt(),VK=mt(),FK=mt(),BK=mt(),zK=mt(),GK=mt({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),WK=mt(),HK=mt(),KK=mt(),qK=mt(),YK=mt(),XK=mt(),$K=mt({reportResult:!0}),JK=mt(),Xe=class extends br{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let r;if(super(),L(this,"store",void 0),L(this,"_uid",void 0),L(this,"_channelName",void 0),L(this,"_uintUid",void 0),L(this,"_users",[]),L(this,"_config",void 0),L(this,"_clientId",void 0),L(this,"_appId",void 0),L(this,"_sessionId",null),L(this,"_key",void 0),L(this,"_rtmConfig",{}),L(this,"_joinInfo",void 0),L(this,"_gateway",void 0),L(this,"_statsCollector",void 0),L(this,"_configDistribute",void 0),L(this,"_leaveMutex",void 0),L(this,"_publishMutex",void 0),L(this,"_renewTokenMutex",void 0),L(this,"_subscribeMutex",void 0),L(this,"_encryptionMode","none"),L(this,"_encryptionSecret",null),L(this,"_encryptionSalt",null),L(this,"_encryptDataStream",!1),L(this,"_encryptDataStreamKey",null),L(this,"_encryptDataStreamIv",null),L(this,"_proxyServer",void 0),L(this,"_turnServer",{servers:[],mode:"auto"}),L(this,"_cloudProxyServerMode","disabled"),L(this,"_isDualStreamEnabled",!1),L(this,"_defaultStreamFallbackType",void 0),L(this,"_lowStreamParameter",void 0),L(this,"_streamFallbackTypeCacheMap",new Map),L(this,"_remoteStreamTypeCacheMap",new Map),L(this,"_axiosCancelSource",Pa.CancelToken.source()),L(this,"_audioVolumeIndicationInterval",void 0),L(this,"_networkQualityInterval",void 0),L(this,"_userOfflineTimeout",void 0),L(this,"_streamRemovedTimeout",void 0),L(this,"_rteDetailInterval",void 0),L(this,"_liveTranscodeStreamingClient",void 0),L(this,"_liveRawStreamingClient",void 0),L(this,"_channelMediaRelayClient",void 0),L(this,"_networkQualitySensitivity","normal"),L(this,"_p2pChannel",void 0),L(this,"_useLocalAccessPoint",!1),L(this,"_setLocalAPVersion",void 0),L(this,"_joinAndNotLeaveYet",!1),L(this,"_numberOfJoinCount",0),L(this,"_joinResponse",null),L(this,"_remoteDefaultVideoStreamType",void 0),L(this,"_inspect",void 0),L(this,"_moderation",void 0),L(this,"_license",void 0),L(this,"_pendingPublishedUsers",[]),L(this,"ntpAlignErrorCount",0),L(this,"remoteInboundOffset",0),L(this,"_peerConnectionState",void 0),L(this,"_pendingRtpCapabilityChange",void 0),L(this,"_fallbackServerInfo",void 0),L(this,"_dualStreamMode",void 0),L(this,"_handleLocalTrackEnable",(c,d,h)=>{this.publish(c,!1).then(d).catch(h)}),L(this,"_handleLocalTrackDisable",(c,d,h)=>{this.unpublish(c).then(d).catch(h)}),L(this,"_handleUserOnline",c=>{if(z("BLOCK_LOCAL_CLIENT")&&Ug(c.uid,this.channelName))return void I.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&I.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const d=this._users.find(h=>h.uid===c.uid);if(d)d._trust_in_room_=!0,d._is_pre_created&&(d._is_pre_created=!1,this.safeEmit(Kt.USER_JOINED,d));else{const h=new _f(c.uid,c.uint_id||c.uid);this._users.push(h),I.debug("[".concat(this._clientId,"] user online"),c.uid),this.store.firstVideoFrameDecoded(h.uid,{userJoinNotify:Date.now()}),this.safeEmit(Kt.USER_JOINED,h)}}),L(this,"_handleUserOffline",c=>{if(z("BLOCK_LOCAL_CLIENT")&&Ug(c.uid,this.channelName))return;const d=this._users.find(h=>h.uid===c.uid);d&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),d._audio_pre_subscribed||d._video_pre_subscribed?d._is_pre_created=!0:XN(this._users,d),this._remoteStreamTypeCacheMap.delete(d.uid),this._streamFallbackTypeCacheMap.delete(d.uid),I.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(Kt.USER_LEAVED,d,c.reason))}),L(this,"_handleAddAudioOrVideoStream",(c,d,h,f,m,v,E,w)=>{if(z("BLOCK_LOCAL_CLIENT")&&Ug(d,this.channelName))return;const S=this._users.find(D=>D.uid===d);if(!S)return void I.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));I.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(S.uid,c,void 0,void 0,void 0,Date.now()),c==="video"&&this.store.firstVideoFrameDecoded(S.uid,{videoAddNotify:Date.now()});const R=c==="audio"?S.hasAudio:S.hasVideo;S._uintid||(S._uintid=v||d),c==="audio"?S._trust_audio_stream_added_state_=!0:S._trust_video_stream_added_state_=!0,c==="audio"?(S._audio_added_=!0,h!==void 0&&(S._audioSSRC=h),f!==void 0&&(S._cname=f),E&&(S._audioOrtc=E)):(S._video_added_=!0,h!==void 0&&(S._videoSSRC=h),f!==void 0&&(S._cname=f),w!==void 0&&(S._rtxSsrcId=w),E&&(S._videoOrtc=E)),(c==="audio"?S.hasAudio:S.hasVideo)&&!R&&(I.info("[".concat(this._clientId,"] remote user ").concat(S.uid," published ").concat(c)),this.safeEmit(Kt.USER_PUBLISHED,S,c)),c==="video"?tt.onGatewayStream(this._sessionId,ys.ON_ADD_VIDEO_STREAM,vr.ON_ADD_VIDEO_STREAM,{peer:v||d,ssrc:S._videoSSRC}):tt.onGatewayStream(this._sessionId,ys.ON_ADD_AUDIO_STREAM,vr.ON_ADD_AUDIO_STREAM,{peer:v||d,ssrc:S._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(S,c,h).then(D=>{if(D&&(I.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(S.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Wg))return this._p2pChannel.unsubscribe(S,c,!0).then(()=>this._subscribe(S,c,!0).catch(P=>{I.error("[".concat(this._clientId,"] resubscribe error"),P.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(S,c)&&(I.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(S.uid," after reconnect.")),this._subscribe(S,c,!0).catch(D=>{I.error("[".concat(this._clientId,"] resubscribe error"),D.toString())}));const j=this._getEncodingName(m);c==="video"&&(j==="unknown"?this.safeEmit(Kt.AV1_DECODABLE_RESULT,!1):Hs()||Mi()||(j==null?void 0:j.toLocaleLowerCase())!==Ag.av1||Uue().then(D=>{z("FLS_ENABLE_AV1_DECODE_DETECT")&&this.safeEmit(Kt.AV1_DECODABLE_RESULT,D),D||this._gateway.downgradeCodec(j)}))}),L(this,"_handleRemoveStream",c=>{if(z("BLOCK_LOCAL_CLIENT")&&Ug(c.uid,this.channelName))return;const d=this._users.find(f=>f.uid===c.uid);if(!d)return void I.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));I.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};d.hasAudio&&d.hasVideo?h=()=>{I.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(Kt.USER_UNPUBLISHED,d,"audio"),I.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(Kt.USER_UNPUBLISHED,d,"video")}:d.hasVideo?h=()=>{I.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(Kt.USER_UNPUBLISHED,d,"video")}:d.hasAudio&&(h=()=>{I.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(Kt.USER_UNPUBLISHED,d,"audio")}),d._video_pre_subscribed||d._audio_pre_subscribed||(d._trust_audio_stream_added_state_=!0,d._trust_video_stream_added_state_=!0,d._audio_added_=!1,d._video_added_=!1,this._p2pChannel instanceof Wg&&this._p2pChannel.unsubscribe(d).then(f=>{if(f)return this._gateway.unsubscribe(f,d.uid)}),d._audioSSRC=void 0,d._videoSSRC=void 0,d._audioOrtc=void 0,d._videoOrtc=void 0,d._rtxSsrcId=void 0),tt.onGatewayStream(this._sessionId,ys.ON_REMOVE_STREAM,vr.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),L(this,"_handleSetStreamLocalEnable",(c,d,h)=>{if(z("BLOCK_LOCAL_CLIENT")&&Ug(d,this.channelName))return;const f=this._users.find(E=>E.uid===d);if(!f)return void I.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));I.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(d));const m=c==="audio"?f.hasAudio:f.hasVideo;if(c==="audio"){f._trust_audio_enabled_state_=!0;const E=f._audio_enabled_;if(f._audio_enabled_=h,f._audio_enabled_===E)return;{const w=f._audio_enabled_?"enable-local-audio":"disable-local-audio";I.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(d,", msg: ").concat(w)),this.safeEmit(Kt.USER_INFO_UPDATED,d,w)}}else{f._trust_video_enabled_state_=!0;const E=f._video_enabled_;if(f._video_enabled_=h,f._video_enabled_===E)return;{const w=f._video_enabled_?"enable-local-video":"disable-local-video";I.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(w)),this.safeEmit(Kt.USER_INFO_UPDATED,d,w)}}const v=c==="audio"?f.hasAudio:f.hasVideo;return m!==v?!m&&v?(I.info("[".concat(this._clientId,"] remote user ").concat(d," published ").concat(c)),void this.safeEmit(Kt.USER_PUBLISHED,f,c)):(c==="video"&&f._videoTrack&&f._videoTrack._destroy(),c==="audio"&&f._audioTrack,this._p2pChannel.muteRemote(f,c),I.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished ").concat(c)),void this.safeEmit(Kt.USER_UNPUBLISHED,f,c)):void 0}),L(this,"_handleMuteStream",(c,d,h)=>{if(z("BLOCK_LOCAL_CLIENT")&&Ug(c,this.channelName))return;I.debug("[".concat(this._clientId,"] receive mute message"),c,d,h);const f=this._users.find(E=>E.uid===c);if(!f)return void I.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const m=d==="audio"?f.hasAudio:f.hasVideo;if(d==="audio"){f._trust_audio_mute_state_=!0;const E=f._audio_muted_;if(f._audio_muted_=h,f._audio_muted_===E)return;{const w=f._audio_muted_?"mute-audio":"unmute-audio";I.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(w)),this.safeEmit(Kt.USER_INFO_UPDATED,c,w)}}else{f._trust_video_mute_state_=!0;const E=f._video_muted_;if(f._video_muted_=h,f._video_muted_===E)return;{const w=f._video_muted_?"mute-video":"unmute-video";I.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(w)),this.safeEmit(Kt.USER_INFO_UPDATED,c,w)}}const v=d==="audio"?f.hasAudio:f.hasVideo;if(m!==v){if(!m&&v)return(d==="audio"?f._audioSSRC:f._videoSSRC)?(I.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(d)),void this.safeEmit(Kt.USER_PUBLISHED,f,d)):void I.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(d," unmute message  before add stream message, ").concat(d," SSRC doesn't exist yet."));d==="video"&&f._videoTrack&&!f._video_pre_subscribed&&f._videoTrack._destroy(),d==="audio"&&f._audioTrack,this._p2pChannel.muteRemote(f,d),I.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(d)),this.safeEmit(Kt.USER_UNPUBLISHED,f,d)}}),L(this,"_handleP2PLost",async c=>{I.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():I.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),L(this,"_handleTokenWillExpire",()=>{I.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Kt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),L(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),I.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),L(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Kt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Kt.NETWORK_QUALITY,c)}),L(this,"_handleP2PAddAudioOrVideoStream",(c,d,h,f)=>{const m=this._users.find(E=>E.uid===d);if(!m)return void I.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));I.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(m.uid,c,void 0,void 0,void 0,Date.now());const v=c==="audio"?m.hasAudio:m.hasVideo;c==="audio"?m._trust_audio_stream_added_state_=!0:m._trust_video_stream_added_state_=!0,c==="audio"?(m._audio_added_=!0,h!==void 0&&(m._audioSSRC=h),f!==void 0&&(m._audioMid=f)):(m._video_added_=!0,h!==void 0&&(m._videoSSRC=h),f!==void 0&&(m._videoMid=f)),(c==="audio"?m.hasAudio:m.hasVideo)&&!v&&(I.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published ").concat(c)),this.safeEmit(Kt.USER_PUBLISHED,m,c)),this._p2pChannel.hasPendingRemoteMedia(m,c)&&(I.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(m.uid," after reconnect.")),this._subscribe(m,c,!0).catch(E=>{I.error("[".concat(this._clientId,"] resubscribe error"),E.toString())}))}),this._config=e,this._clientId=t||jn(5,"client-"),this.store=new class{constructor(c,d,h,f,m){It(this,"state",void 0),this.state={codec:c,audioCodec:d,mode:h,clientId:f,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Ig.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,rteUrl:void 0,rteSid:void 0,autoSubscribe:!1,enableInstantMuteRestore:!1,networkQualityProbe:!1,useDcSignal:!!m}}dispatch(c){this.state=function(d,h){switch(h.type){case Tt.SET_SESSION_ID:return Le(Le({},d),{},{sessionId:h.sessionId});case Tt.SET_P2P_ID:return Le(Le({},d),{},{p2pId:h.p2pId});case Tt.SET_UID:return Le(Le({},d),{},{uid:h.uid});case Tt.SET_INT_UID:return Le(Le({},d),{},{intUid:h.intUid});case Tt.SET_PUB_ID:return Le(Le({},d),{},{pubId:h.pubId});case Tt.KEY_METRIC_CLIENT_CREATED:return Le(Le({},d),{},{keyMetrics:Le(Le({},d.keyMetrics),{},{clientCreated:h.metric})});case Tt.KEY_METRIC_JOIN_START:return Le(Le({},d),{},{keyMetrics:Le(Le({},d.keyMetrics),{},{joinStart:h.metric})});case Tt.KEY_METRIC_PRELOAD_START:return Le(Le({},d),{},{keyMetrics:Le(Le({},d.keyMetrics),{},{preloadStart:h.metric})});case Tt.KEY_METRIC_PRELOAD_END:return Le(Le({},d),{},{keyMetrics:Le(Le({},d.keyMetrics),{},{preloadEnd:h.metric})});case Tt.KEY_METRIC_JOIN_END:return Le(Le({},d),{},{keyMetrics:Le(Le({},d.keyMetrics),{},{joinEnd:h.metric})});case Tt.KEY_METRIC_REQUEST_AP_START:return Le(Le({},d),{},{keyMetrics:Le(Le({},d.keyMetrics),{},{requestAPStart:h.metric})});case Tt.KEY_METRIC_REQUEST_AP_END:return Le(Le({},d),{},{keyMetrics:Le(Le({},d.keyMetrics),{},{requestAPEnd:h.metric})});case Tt.KEY_METRIC_REQUEST_SUA_END:return Le(Le({},d),{},{keyMetrics:Le(Le({},d.keyMetrics),{},{requestSUAEnd:h.metric})});case Tt.KEY_METRIC_BEFORE_CONNECT:return Le(Le({},d),{},{keyMetrics:Le(Le({},d.keyMetrics),{},{beforeConnect:h.metric})});case Tt.KEY_METRIC_PEER_RECEIVER:return Le(Le({},d),{},{keyMetrics:Le(Le({},d.keyMetrics),{},{peerReceiver:h.metric})});case Tt.KEY_METRIC_SIGNAL_CONNECTED:return Le(Le({},d),{},{keyMetrics:Le(Le({},d.keyMetrics),{},{signalConnected:h.metric})});case Tt.KEY_METRIC_JOIN_REQ:return Le(Le({},d),{},{keyMetrics:Le(Le({},d.keyMetrics),{},{joinReq:h.metric})});case Tt.KEY_METRIC_JOIN_REP:return Le(Le({},d),{},{keyMetrics:Le(Le({},d.keyMetrics),{},{joinRep:h.metric})});case Tt.KEY_METRIC_JOIN_GATEWAY_START:return Le(Le({},d),{},{keyMetrics:Le(Le({},d.keyMetrics),{},{joinGatewayStart:h.metric})});case Tt.KEY_METRIC_JOIN_GATEWAY_END:return Le(Le({},d),{},{keyMetrics:Le(Le({},d.keyMetrics),{},{joinGatewayEnd:h.metric})});case Tt.KEY_METRIC_PEER_CONNECTION_START:return Le(Le({},d),{},{keyMetrics:Le(Le({},d.keyMetrics),{},{peerConnectionStart:h.metric})});case Tt.KEY_METRIC_PEER_CONNECTION_END:return Le(Le({},d),{},{keyMetrics:Le(Le({},d.keyMetrics),{},{peerConnectionEnd:h.metric})});case Tt.KEY_METRIC_DESCRIPTION_START:return Le(Le({},d),{},{keyMetrics:Le(Le({},d.keyMetrics),{},{descriptionStart:h.metric})});case Tt.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Le(Le({},d),{},{keyMetrics:Le(Le({},d.keyMetrics),{},{signalChannelOpen:h.metric})});case Tt.KEY_METRIC_ICE_CONNECTION_END:return Le(Le({},d),{},{keyMetrics:Le(Le({},d.keyMetrics),{},{iceConnectionEnd:h.metric})});case Tt.KEY_METRIC_PUBLISH:{const f=d.keyMetrics.publish,m=f.findIndex(v=>v.trackId===h.metric.trackId);return m!==-1?(f[m]=Le(Le({},f[m]),h.metric),Le(Le({},d),{},{keyMetrics:Le(Le({},d.keyMetrics),{},{publish:[...f]})})):Le(Le({},d),{},{keyMetrics:Le(Le({},d.keyMetrics),{},{publish:[...d.keyMetrics.publish,h.metric]})})}case Tt.KEY_METRIC_SUBSCRIBE:{const f=d.keyMetrics.subscribe,m=f.findIndex(v=>v.userId===h.metric.userId&&v.type===h.metric.type);return m!==-1?(f[m]=Le(Le({},f[m]),h.metric),Le(Le({},d),{},{keyMetrics:Le(Le({},d.keyMetrics),{},{subscribe:[...f]})})):Le(Le({},d),{},{keyMetrics:Le(Le({},d.keyMetrics),{},{subscribe:[...d.keyMetrics.subscribe,h.metric]})})}case Tt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const f=d.keyMetrics.firstVideoFrameDecoded,m=f.findIndex(v=>v.userId===h.metric.userId);return m!==-1?(f[m]=Le(Le({},f[m]),h.metric),Le(Le({},d),{},{keyMetrics:Le(Le({},d.keyMetrics),{},{firstVideoFrameDecoded:[...f]})})):Le(Le({},d),{},{keyMetrics:Le(Le({},d.keyMetrics),{},{firstVideoFrameDecoded:[...d.keyMetrics.firstVideoFrameDecoded,h.metric]})})}case Tt.RESET_FIRST_VIDEO_FRAME_DECODED:return d.keyMetrics.firstVideoFrameDecoded=[],d;case Tt.SET_CLOUD_PROXY_SERVER_MODE:return d.cloudProxyServerMode=h.mode,d;case Tt.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?d.joinChannelServiceRecords=[...d.joinChannelServiceRecords,h.record]:(d.joinChannelServiceRecords[h.index]=Le(Le({},d.joinChannelServiceRecords[h.index]),h.record),d.joinChannelServiceRecords=[...d.joinChannelServiceRecords]),d;case Tt.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return d.joinChannelServiceRecords=[],d;case Tt.RESET_KEY_METRICS:return d.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},d;case Tt.SET_USE_P2P:return Le(Le({},d),{},{useP2P:h.val});case Tt.SET_TRANSPORT_TYPE:return Le(Le({},d),{},{p2pTransport:h.val});case Tt.SET_RTE_URL:return Le(Le({},d),{},{rteUrl:h.rteUrl});case Tt.SET_RTE_SID:return Le(Le({},d),{},{rteSid:h.rteSid});default:return d}}(this.state,c)}get useDcSignal(){return this.state.useDcSignal}set useDcSignal(c){this.state.useDcSignal=c}set autoSubscribe(c){this.state.autoSubscribe=c}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(c){this.state.enableInstantMuteRestore=c}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set networkQualityProbe(c){this.state.networkQualityProbe=c}get networkQualityProbe(){return this.state.networkQualityProbe}set sessionId(c){this.dispatch({type:Tt.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set rteUrl(c){this.dispatch({type:Tt.SET_RTE_URL,rteUrl:c})}get rteUrl(){return this.state.rteUrl}set rteSid(c){this.dispatch({type:Tt.SET_RTE_SID,rteSid:c})}get rteSid(){return this.state.rteSid}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:Tt.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:Tt.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:Tt.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:Tt.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:Tt.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:Tt.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:Tt.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:Tt.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:Tt.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Tt.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:Tt.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:Tt.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:Tt.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Tt.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Tt.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:Tt.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:Tt.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:Tt.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:Tt.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:Tt.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:Tt.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Tt.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Tt.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Tt.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Tt.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(c,d){this.dispatch({type:Tt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:Le({userId:c},d)})}descriptionStart(){this.dispatch({type:Tt.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Tt.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Tt.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,d,h,f){this.dispatch({type:Tt.KEY_METRIC_PUBLISH,metric:Le(Le({trackId:c,type:d},h&&{publishStart:h}),f&&{publishEnd:f})})}subscribe(c,d,h,f,m,v,E){this.dispatch({type:Tt.KEY_METRIC_SUBSCRIBE,metric:Le(Le(Le(Le(Le({userId:c,type:d},h&&{subscribeStart:h}),f&&{subscribeEnd:f}),m&&{firstFrame:m}),v&&{streamAdded:v}),E&&{firstDecoded:E})})}massSubscribe(c,d,h,f){c.forEach(m=>{this.dispatch({type:Tt.KEY_METRIC_SUBSCRIBE,metric:Le(Le(Le({userId:m.userId,type:m.type},d&&{subscribeStart:d}),h&&{subscribeEnd:h}),f&&{firstFrame:f})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,d){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof d!="number"?(this.dispatch({type:Tt.RECORD_JOIN_CHANNEL_SERVICE,record:Le(Le({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(d<0||d>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Tt.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:d}),d)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Tt.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Tt.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:Tt.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId,z("SIGNAL_CHANNEL")===1),this._leaveMutex=new Ks("client-leave",this._clientId),this._publishMutex=new Ks("client-publish",this._clientId),this._renewTokenMutex=new Ks("client-renewtoken",this._clientId),this._subscribeMutex=new Ks("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),I.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(kc," build: ").concat(Bj,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{Rj(e.clientRoleOptions),r=Object.assign({},e.clientRoleOptions)}catch(c){I.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var a;this._statsCollector=new iw(this.store),this._statsCollector.onStatsException=(c,d,h)=>{I.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(d,", uid: ").concat(h)),c===HM.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(f=>{f instanceof hI&&z("ENABLE_ENCODE_EXCEPTION")&&f.findClosestProfile()}),this.safeEmit(Kt.EXCEPTION,{code:c,msg:d,uid:h})},this._statsCollector.onUploadPublishDuration=(c,d,h,f)=>{const m=this._users.find(v=>v.uid===c);m&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(m.uid,{peerPublishDuration:h,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(m)),tt.peerPublishStatus(this._sessionId,{subscribeElapse:f,audioPublishDuration:d,videoPublishDuration:h,peer:m._uintid}))},this._statsCollector.onVideoCodecChanged=c=>{if(z("VIDEO_STANDARD_BITRATE_VERSION")&&(c==="av1"||c==="h265"||c==="h264")){const d=this.localTracks.find(h=>h instanceof Jn);d&&d._saveEncodeBitrateRatio!==1&&d.setSaveEncodeBitrateRatio(c==="h264"?z("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new Oue(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||ls,httpRetryConfig:e.httpRetryConfig||ls,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:r}),this._configDistribute=new Gue(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(a={store:this.store,statsCollector:this._statsCollector},Td("P2PChannel").create(a)),this._handleP2PEvents()):this._p2pChannel=new Wg(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,r,a,c){let d=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Wn("JOIN_GATEWAY_USE_443PORT_ONLY",d),Wn("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const f=this._gateway.signal.websocket;return f instanceof RM&&(f.use443PortOnly=d,f.tryDoubleDomain=h),async function(m,v,E){HN.get(m)||HN.set(m,[]),KN.get(m)||KN.set(m,v),Eu.get(m)||Eu.set(m,0);const w=HN.get(m),S=KN.get(m);if(!w||!S)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Eu.get(m)===S){const W=Mx();w.push(W),await W.promise}Eu.set(m,Eu.get(m)+1);for(var R=arguments.length,j=new Array(R>3?R-3:0),D=3;D<R;D++)j[D-3]=arguments[D];const P=await E(...j);return Eu.set(m,Eu.get(m)-1),Eu.get(m)===S-1&&w.length>0&&(w[0].resolve(),w.shift()),Eu.get(m)===0&&(HN.set(m,[]),KN.set(m,0),Eu.set(m,0)),P}("client.join",z("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,r,a,c)}async join(e,t,r,a,c){const d=++this._numberOfJoinCount;this.store.joinStart(),a&&(this.store.uid=a);const h=(QN||QN||(QN=(window.location.protocol.split(":")[0]||"").toUpperCase(),QN))==="HTTPS",f=GG()?window.isSecureContext:"Browser Not Support";(!GG()&&!h||!window.isSecureContext)&&I.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let m;tt.setAppId(e);try{if(!r&&r!==null)throw new Ee(K.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));if(r&&ri(r,"token",1,2047),ri(e,"appid",1,2047),wI(t),a&&SI(a),c)if(typeof c=="string")ri(c,"optionalInfo",1,256),m=c;else{if(typeof c!="object")throw new Ee(K.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:P,enableInstantMuteRestore:W,networkQualityProbe:Y}=c;P&&(Tl(P,"autoSubscribe"),I.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(P)),this.store.autoSubscribe=P),W&&(Tl(W,"enableInstantMuteRestore"),I.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(W)),this.store.enableInstantMuteRestore=W),Y&&(Tl(Y,"networkQualityProbe"),I.info("[".concat(this._clientId,"] join: networkQualityProbe: ").concat(Y)),this.store.networkQualityProbe=Y)}}}catch(P){throw tt.reportApiInvoke(Ng(),{name:_r.JOIN,options:[e,t,r,a],states:{isHttps:h,isSecureContext:f},tag:$n.TRACER}).onError(P),P}if(this._leaveMutex.isLocked&&(I.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),I.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const P=new Ee(K.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw tt.reportApiInvoke(Ng(),{name:_r.JOIN,options:[e,t,r,a],states:{isHttps:h,isSecureContext:f},tag:$n.TRACER}).onError(P),P}this._gateway.state="CONNECTING",this.store.preloadStart();const v=await cU({appId:e,cname:t,uid:a,stringUid:typeof a=="string"?a:void 0,token:r||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new Ee(K.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const E=(v==null?void 0:v.sid)||Ng();I.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(d)),this._sessionId||(this._sessionId=E,this.store.sessionId=this._sessionId);const w=tt.reportApiInvoke(this._sessionId,{id:this._clientId,name:_r.JOIN,options:[e,t,r,a],states:{isHttps:h,isSecureContext:f},tag:$n.TRACER}),S=Ll(Ll(Ll({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof a!="string"?a:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:r||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:m,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!v},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:z("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(S.setLocalAPVersion=this._setLocalAPVersion),typeof a=="string"&&(S.stringUid=a,this._uintUid?(S.uid=this._uintUid,this._uintUid=void 0):S.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(S.aesmode=this._encryptionMode,S.aespassword=await(async P=>{const W=function(fe){const ie=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),_e=new Uint8Array(new ArrayBuffer(ie.length));for(let Te=0;Te<ie.length;Te+=1)_e[Te]=ie.charCodeAt(Te);return _e}(),Y=await window.crypto.subtle.importKey("spki",W,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),ne=Sj(P),le=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},Y,ne);return function(fe){let ie="";for(let _e=0;_e<fe.length;_e+=1)ie+=String.fromCharCode(fe[_e]);return window.btoa(ie)}(new Uint8Array(le))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Ee(K.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(S.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const P=new TextEncoder,W=z("USE_PURE_ENCRYPTION_MASTER_KEY")?P.encode(S.appId+this._encryptionSecret+this._encryptionSecret):P.encode(S.appId+S.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(Y,ne,le){const fe=await window.crypto.subtle.importKey("raw",ne,"PBKDF2",!1,["deriveBits","deriveKey"]),ie=Y==="aes-128-gcm2"?128:256,_e=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:ZG,hash:"SHA-256",salt:le},fe,ie+dde);return new Uint8Array(_e).subarray(ie/8)}(this._encryptionMode,W,Cg(this._encryptionSalt)),this._encryptDataStreamKey=await async function(Y,ne,le){const fe=await window.crypto.subtle.importKey("raw",ne,"PBKDF2",!1,["deriveBits","deriveKey"]),ie=Y==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:ZG,hash:"SHA-256",salt:le},fe,{name:"AES-GCM",length:ie},!0,["encrypt","decrypt"])}(this._encryptionMode,W,Cg(this._encryptionSalt))}else f?I.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):I.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,I.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:S.stringUid});const R=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&R===this._sessionId&&tt.joinChannelTimeout(this._sessionId,5)},5e3);try{var j;let P;const W=S.cloudProxyServer;if(ke(j=["proxy3","proxy4","proxy5"]).call(j,W)){const ie=z("PROXY_SERVER_TYPE3");Array.isArray(ie)?S.proxyServer=ie[0]:S.proxyServer=ie}if(tt.setProxyServer(S.proxyServer),I.setProxyServer(S.proxyServer),this.store.requestAPStart(),v){if(I.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(S.stringUid?", ".concat(S.stringUid," => ").concat(v.intUid):""," ")),S.stringUid&&!S.uid&&(S.uid=v.intUid),P={gatewayInfo:v.ap.gatewayInfo},z("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&S.turnServer.mode==="auto")if(v.ap.proxyInfo.addresses.length===0)I.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const ie=(await BH(v.ap.proxyInfo,v.ap.gatewayInfo.uid)).map(_e=>({turnServerURL:_e.address,tcpport:_e.tcpport||mi.tcpport,udpport:_e.udpport||mi.udpport,username:_e.username||mi.username,password:_e.password||mi.password,forceturn:!1,security:!0}));S.turnServer={mode:"manual",servers:ie}}X7(v,S.stringUid)}else{if(S.stringUid&&!S.uid){let ie;[ie,P]=await Ue.all([m7(S.stringUid,S,this._axiosCancelSource.token,this._config.httpRetryConfig||ls,this.store).finally(()=>{this.store.requestSUAEnd()}),f7(S,this._axiosCancelSource.token,this._config.httpRetryConfig||ls,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),I.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(S.stringUid," => ").concat(ie)),S.uid=ie,P.gatewayInfo.uid=ie,P.gatewayInfo.res.uid=ie}else P=await f7(S,this._axiosCancelSource.token,this._config.httpRetryConfig||ls,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Ee(K.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(S,this._axiosCancelSource.token),this._configDistribute.on(wd.UPDATE_BITRATE_LIMIT,ie=>{this._p2pChannel.updateBitrateLimit(ie)}),this._configDistribute.on(wd.UPDATE_CLIENT_ROLE_OPTIONS,ie=>{this._setClientRoleOptions(ie)}),this._configDistribute.on(wd.UPDATE_REMOTE_VIDEO_STREAM_TYPE,ie=>{var _e;ke(_e=[0,1,4,5,6,7,8,9]).call(_e,ie)&&(this.remoteUsers.forEach(Te=>{this._remoteStreamTypeCacheMap.get(Te.uid)!==ie&&this.setRemoteVideoStreamType(Te.uid,ie)}),this.setRemoteDefaultVideoStreamType(ie))}),this._configDistribute.on(wd.FALLBACK_TO_HLS,ie=>{ie&&this.safeEmit(Kt.FALLBACK_TO_HLS,Cj.CONFIG)}),this._configDistribute.on(wd.UPDATE_VOS_CONFIGURE,ie=>{this._gateway.setConfigure(ie).catch(_e=>{I.debug("[".concat(this._clientId,"] auto set vos config failed"),_e)})})},0),this._key=r||e;const Y=P.gatewayInfo,ne=S.uid?S.uid:Y.uid;this._joinInfo=Ll(Ll({},S),{},{cid:Y.cid,uid:ne,vid:Y.vid,apResponse:Y.res,apGatewayAddress:Y.apGatewayAddress,uni_lbs_ip:Y.uni_lbs_ip,gatewayAddrs:Y.gatewayAddrs}),this.store.intUid=ne,this.store.cid=Y.cid;const le=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Ee(K.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));w.onSuccess(le),this._appId=e,this._channelName=S.cname,this._uid=le,this.store.uid=le,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),!Hs()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(Hs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const fe=S.stringUid?"string uid: ".concat(S.stringUid,",uid: ").concat(S.uid):"uid: ".concat(this._uid);return I.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(fe)),setTimeout(()=>{I.startUpload()},5e3),this.store.joinEnd(),D=this,ke(Mg).call(Mg,D)||Mg.push(D),this._cloudProxyServerMode==="disabled"&&Zt().supportWebCrypto&&z("ENABLE_PRELOAD")&&dU(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0),this._sessionId&&tt.reportRteDetail(this._sessionId),this._rteDetailInterval=window.setInterval(()=>{this._sessionId&&tt.reportRteDetail(this._sessionId)},z("RTE_DETAIL_REPORT_INTERVAL")||6e4),le}catch(P){const W=Array.isArray(P)?P[0]:P;throw W&&W.code===K.OPERATION_ABORTED?I.warning("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),W):I.error("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),W),W.code!==K.OPERATION_ABORTED&&this._numberOfJoinCount===d&&(this._gateway.state="DISCONNECTED",this._reset()),w.onError(W),W}var D}async _joinGateway(){if(!this._joinInfo||!this._key)throw new Ee(K.INVALID_OPERATION);try{return await this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!z("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}catch(e){if(e.code===K.INIT_DATACHANNEL_TIMEOUT){if(this._gateway.leave(!0,nn.FALLBACK),I.debug("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new Ee(K.INVALID_OPERATION);return tt.reportApiInvoke(this._sessionId,{name:_r.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:$n.TRACER}).onSuccess(),await this._joinGateway()}throw e}}async leave(){I.info("[".concat(this._clientId,"] Leaving channel"));const e=()=>{!Hs()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(Hs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(r){const a=Mg.indexOf(r);a!==-1&&Mg.splice(a,1)}(this),this._statsCollector.stopUpdateStats()};this.store.useDcSignal||e();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return I.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",nn.LEAVE),I.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t(),this.store.useDcSignal&&e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof zv))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new Ee(K.INVALID_PARAMS,"param list is empty");const r=e;if(this._gateway.role==="audience")throw new Ee(K.INVALID_OPERATION,"audience can not publish stream");for(const c of r){if(!(c instanceof zv))throw new Ee(K.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&t)throw new Ee(K.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}I.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(r.map(c=>"".concat(c.getTrackId()," "))));const a=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&r.forEach(c=>{const d=this._configDistribute.getBitrateLimit();c instanceof Jn&&d&&c.setBitrateLimit(d.uplink)});try{await this._publishHighStream(r),I.info("[".concat(this._clientId,"] Publish success, id ").concat(r.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw I.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{a()}}async _publishDataChannel(e){if(e==null)throw new Ee(K.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));Xn(e.id,"id",0,65535,!0),Tl(e.ordered,"ordered"),ri(e.metadata,"metadata",0,512),I.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===e.id)!==-1)throw new Ee(K.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Ee(K.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ee(K.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&z("FORCE_TURN")&&!z("TURN_ENABLE_TCP")&&!z("TURN_ENABLE_UDP"))throw new Ee(K.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const r=function(c){return i7(c,!1)}(e),a=await this._p2pChannel.publishDataChannel([r]);if(a.length>0){if(typeof r._originDataChannelId!="number")throw I.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Ee(K.CREATE_DATACHANNEL_ERROR);try{await Ue.all(a.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await r._waitTillOpen()}catch(c){if(c.code!==K.DISCONNECT_P2P)throw c}}return I.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(r.id)),r}catch(r){throw I.error("[".concat(this._clientId,"] publish datachannels error"),r.toString()),r}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new Ee(K.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof zv))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);I.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(a=>"".concat(a.getTrackId()," "))," "));const r=await this._publishMutex.lock();try{if(this.store.useP2P){const a=await this._p2pChannel.unpublish(t);a&&await this._gateway.sendExtensionMessage(ss.UNPUBLISH,{unpubMsg:a},!0)}else{const a=await this._p2pChannel.unpublish(t);a&&await this._gateway.unpublish(a,this._uid),I.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(c=>"".concat(c.getTrackId()))))}}catch(a){throw I.error("[".concat(this._clientId,"] unpublish error"),a.toString()),a}finally{r&&r()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),I.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(r=>"".concat(r.id," "))," "));const t=await this._publishMutex.lock();try{const r=await this._p2pChannel.unpublishDataChannel(e);r&&await this._gateway.unpublishDataChannel(r),I.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(a=>"".concat(a.id))))}catch(r){throw I.error("[".concat(this._clientId,"] unpublish dataChannel error"),r.toString()),r}finally{t&&t()}}async subscribe(e,t,r){if(!(e instanceof _f)){const a=this.remoteUsers.find(c=>c.uid===e);if(!a)throw new Ee(K.INVALID_REMOTE_USER,"user is not in the channel");e=a}return t==="datachannel"?this._subscribeDataChannel(e,r):this._subscribe(e,t)}async presubscribe(e,t){if(cs(t,"mediaType",["audio","video"]),this.store.useP2P)throw new Ee(K.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Ee(K.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ee(K.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const r=t===Je.AUDIO,a=t===Je.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:d,ortc:h,rtxSsrcId:f,cname:m,uint_id:v}=await this._gateway.presubscribe(e,t,!0);if(d==null)throw new Ee(K.UNEXPECTED_RESPONSE,"no ssrc id");let E=this._users.find(S=>S.uid===e);E||(E=new _f(e,v||e),E._is_pre_created=!0,this._users.push(E)),m&&(E._cname=m),E._uintid||(E._uintid=v||e),r&&(E._audioSSRC=d,E._audio_pre_subscribed=!0,h&&(E._audioOrtc=h)),a&&(E._videoSSRC=d,E._video_pre_subscribed=!0,h&&(E._videoOrtc=h),f!=null&&(E._rtxSsrcId=f)),I.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(d)),await this._p2pChannel.subscribe(E,t,d,f,h);const w=r?E._audioTrack:E._videoTrack;if(!w)throw new Ee(K.UNEXPECTED_ERROR,"can not find remote track in user");return r&&(E._trust_audio_stream_added_state_=!0,E._audio_added_=!0),a&&(E._trust_video_stream_added_state_=!0,E._video_added_=!0),w}catch(d){throw I.error("[".concat(this._clientId,"] presub user ").concat(e," error"),d),d}finally{c()}}async _subscribeDataChannel(e,t){var r;if(Xn(t,"channelId",0,65535,!0),!this._joinInfo)throw new Ee(K.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ee(K.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(f=>f===e))throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new Ee(K.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new Ee(K.INVALID_REMOTE_USER,"user is not published");const c=(r=e._dataChannels)===null||r===void 0?void 0:r.find(f=>f.id===t);if(!c)throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new Ee(K.REMOTE_USER_IS_NOT_PUBLISHED);const d=await this._subscribeMutex.lock();I.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const f=await this._p2pChannel.subscribeDataChannel(e,[c]);if(f&&ke(f).call(f,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Ee(K.CREATE_DATACHANNEL_ERROR);const m={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(e.uid,m,!0),await c._waitTillOpen()}catch(m){if((m==null?void 0:m.code)!==K.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[c]),m;await this._p2pChannel.unsubscribeDataChannel(e,[c]),this._p2pChannel.setPendingRemoteDataChannel(e,c.id)}return I.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),c}finally{d()}}async _p2pSubscribe(e,t,r){if(cs(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Ee(K.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ee(K.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(d=>d===e)){const d=new Ee(K.INVALID_REMOTE_USER,"user is not in the channel");throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),d}if(!e.hasAudio&&!e.hasVideo){const d=new Ee(K.INVALID_REMOTE_USER,"user is not published");throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),d}if(!r&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const d=new Ee(K.REMOTE_USER_IS_NOT_PUBLISHED);throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),d}const c=await this._subscribeMutex.lock();I.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const h=t==="audio"?e._audioSSRC:e._videoSSRC,f=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,h,f)}catch(h){throw h}I.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(h=>{I.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const d=t==="audio"?e._audioTrack:e._videoTrack;if(!d)throw new Ee(K.UNEXPECTED_ERROR,"can not find remote track in user object");return d}catch(d){throw I.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),d),d}finally{c()}}async _subscribe(e,t,r){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(cs(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Ee(K.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ee(K.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(v=>v===e)){const v=new Ee(K.INVALID_REMOTE_USER,"user is not in the channel");throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),v}if(!e.hasAudio&&!e.hasVideo){const v=new Ee(K.INVALID_REMOTE_USER,"user is not published");throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),v}if(!(r||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const v=new Ee(K.REMOTE_USER_IS_NOT_PUBLISHED);throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),v}let c=t==="audio"?e._audioSSRC:e._videoSSRC,d=t==="audio"?e._audioOrtc:e._videoOrtc,h=t==="video"?e._rtxSsrcId:void 0,f={stream_type:t==="audio"?Je.AUDIO:Je.VIDEO,ssrcId:c};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});const m=await this._subscribeMutex.lock();I.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const E=t==="audio"?e._audioSSRC:e._videoSSRC;E!==void 0&&E!==c&&(c=E,d=t==="audio"?e._audioOrtc:e._videoOrtc,h=t==="video"?e._rtxSsrcId:void 0,f={stream_type:t==="audio"?Je.AUDIO:Je.VIDEO,ssrcId:c}),Ii.markSubscribeStart(this.store.clientId,c),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,c,h,d);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(e.uid,f,!0)}catch(w){if((w==null?void 0:w.code)!==K.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),w;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(E){throw this._p2pChannel.reportSubscribeEvent(!1,E==null?void 0:E.code,e,t),E}I.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(E=>{I.warning("[".concat(this._clientId,"] auto set fallback failed"),E)});const v=t==="audio"?e._audioTrack:e._videoTrack;if(!v)throw new Ee(K.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),v}catch(v){throw I.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),v),v}finally{m()}}async massSubscribe(e){if(Ah(e,"subscribeList"),!this._joinInfo)throw new Ee(K.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ee(K.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),r=new Map,a=await this._subscribeMutex.lock();I.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(f=>{let{user:m,mediaType:v}=f;return"user: ".concat(m==null?void 0:m.uid,", mediaType: ").concat(v)}).join("; ")));const c=(e=[...e]).map(f=>{let{user:m,mediaType:v}=f;return{user:m,mediaType:v}}),d=await this._p2pChannel.globalLock();try{var h;for(let m=e.length-1;m>=0;m--){const v=e[m],{user:E,mediaType:w}=v;if(cs(w,"mediaType",["audio","video"]),!E){const D=new Ee(K.INVALID_PARAMS,"user property does not exist in subscribeList item");throw I.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),D}if(!this._users.find(D=>D===E)){const D=new Ee(K.INVALID_REMOTE_USER,"user is not in the channel");I.error("[".concat(this._clientId,"] can not massSubscribe ").concat(E.uid,", this user is not in the channel")),c[m].error=D,e.splice(m,1);continue}if(w==="audio"&&(!E.hasAudio||E._audioSSRC===void 0)||w==="video"&&(!E.hasVideo||E._videoSSRC===void 0)){const D=new Ee(K.REMOTE_USER_IS_NOT_PUBLISHED);I.error("[".concat(this._clientId,"] can not subscribe ").concat(E.uid," with mediaType ").concat(w,", remote user is not published")),c[m].error=D,e.splice(m,1);continue}const R=Ls.Video|Ls.LwoVideo,j=r.get(E);if(j){if(w==="video"?j&R:j&Ls.Audio){e.splice(m,1),I.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(E.uid,", mediaType:").concat(w," twice"));continue}r.set(E,j|(w==="video"?R:Ls.Audio))}else r.set(E,w==="video"?R:Ls.Audio)}for(let m=e.length-1;m>=0;m--){const v=e[m],{user:E,mediaType:w}=v,S=Ls.Video|Ls.LwoVideo;if(this._p2pChannel.hasRemoteMedia(E,w)){await this._p2pChannel.unmuteRemoteNoLock(E,w);const R=r.get(E);r.set(E,w==="video"?R^S:R^Ls.Audio),e.splice(m,1)}}this.store.massSubscribe(e.map(m=>({userId:m.user.uid,type:m.mediaType})),t);let f=To(h=Array.from(r.entries())).call(h,(m,v)=>{let[E,w]=v;if(w===0)return m;const S={stream_id:E.uid,stream_type:w};return w&Ls.Audio&&(S.audio_ssrc=E._audioSSRC),w&Ls.Video&&(S.video_ssrc=E._videoSSRC),m.push(S),m},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(v=>{let{user:E,mediaType:w}=v;return{user:E,mediaType:w,ssrcId:w===Je.VIDEO?E._videoSSRC:E._audioSSRC,rtxSsrcId:w===Je.VIDEO?E._rtxSsrcId:void 0}}));const m=new Map;if(f=f.filter(v=>v.video_ssrc&&!this._p2pChannel.isPreSubScribe(v.video_ssrc)||v.audio_ssrc&&!this._p2pChannel.isPreSubScribe(v.audio_ssrc)||!v.video_ssrc&&!v.audio_ssrc),f.length>0){const v=await this._gateway.subscribeAll(f,!0);((v==null?void 0:v.users)||[]).forEach(E=>{let{stream_id:w,video_error_code:S,audio_error_code:R,error_code:j}=E;(S||R||j)&&m.set(w,{video_error_code:S,audio_error_code:R,error_code:j})})}if(Array.from(m.entries()).length>0){const v=[];Array.from(m.entries()).forEach(E=>{let[w,S]=E;const R=this.remoteUsers.find(j=>j.uid===w);if(R){let j;S.error_code||S.video_error_code&&S.audio_error_code?j=void 0:S.video_error_code?j=Je.VIDEO:S.audio_error_code&&(j=Je.AUDIO),v.push({user:R,mediaType:j})}}),v.length>0&&await this._p2pChannel.massUnsubscribeNoLock(v)}for(const v of c){const E=m.get(v.user.uid);if(E){const w=E.error_code||v.mediaType==="audio"&&E.audio_error_code||v.mediaType==="video"&&E.video_error_code;if(w){const S=Fg(w);I.error("user:".concat(v.user.uid," mediaType:").concat(v.mediaType," has massSubscribe error ").concat(S.desc)),v.error=new Ee(K.SUBSCRIBE_FAILED,"code ".concat(w,": ").concat(S.desc))}}v.error||(v.mediaType==="video"?v.track=v.user.videoTrack:v.track=v.user.audioTrack)}return this.store.massSubscribe(c.filter(v=>!v.error).map(v=>({userId:v.user.uid,type:v.mediaType})),void 0,Date.now()),c.forEach(v=>{var E;tt.subscribe(this.store.sessionId,{succ:!!v.error,ec:((E=v.error)===null||E===void 0?void 0:E.code)||null,video:v.mediaType===Je.VIDEO,audio:v.mediaType===Je.AUDIO,peerid:v.user.uid,subscribeRequestid:v.mediaType===Je.VIDEO?v.user._videoSSRC:v.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(v.user._videoSSRC)},!0)}),I.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(v=>{let{user:E,mediaType:w}=v;return"user: ".concat(E==null?void 0:E.uid,", mediaType: ").concat(w)}).join("; "))),c}catch(m){throw await this._p2pChannel.massUnsubscribeNoLock(e),m}}finally{d(),a()}}async unsubscribe(e,t,r){if(!(e instanceof _f)){const d=this.remoteUsers.find(h=>h.uid===e);if(!d)throw new Ee(K.INVALID_REMOTE_USER,"user is not in the channel");e=d}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,r)}else await this._unsubscribeDataChannel(e,r);if(t&&cs(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Ee(K.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(d=>d===e)){const d=new Ee(K.INVALID_REMOTE_USER,"user is not in the channel");throw I.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),d}I.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const d=await this._p2pChannel.unsubscribe(e,t);d&&await this._gateway.unsubscribe(d,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&XN(this._users,e),I.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(d){if(d.code===K.DISCONNECT_P2P)return void I.warning("disconnecting p2p, abort unsubscribe request.");throw I.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),d.toString()),d}finally{c()}}async _unsubscribeDataChannel(e,t){if(t&&Xn(t,"id",0,65535,!0),!this._joinInfo)throw new Ee(K.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===e)){const c=new Ee(K.INVALID_REMOTE_USER,"user is not in the channel");throw I.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}let a;if(typeof t=="number"){const c=e._dataChannels.find(d=>d.id===t);c&&(a=[c])}else a=e._dataChannels;if(a===void 0){const c=new Ee(K.REMOTE_USER_IS_NOT_PUBLISHED);throw I.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),c}I.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(a.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(e,a);c&&await this._gateway.unsubscribeDataChannel(c,e.uid),I.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===K.DISCONNECT_P2P)return void I.warning("disconnecting p2p, abort unsubscribe request.");throw I.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}}async massUnsubscribe(e){if(Ah(e,"unsubscribeList"),!this._joinInfo)throw new Ee(K.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");I.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(r=>{let{user:a,mediaType:c}=r;return"user: ".concat(a==null?void 0:a.uid,", mediaType: ").concat(c,";")}).join())),e=[...e];const t=new Map;for(let r=e.length-1;r>=0;r--){const{user:a,mediaType:c}=e[r];if(!a){const f=new Ee(K.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw I.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),f}if(cs(c,"mediaType",["video","audio",void 0]),!this._users.find(f=>f===a)){I.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(a.uid,", user is not in the channel")),e.splice(r,1);continue}const h=Ls.Video|Ls.LwoVideo;if(t.has(a)){const f=t.get(a);let m;switch(c){case"video":m=f&h;break;case"audio":m=f&Ls.Audio;break;default:m=f&(Ls.Audio|h)}if(m){I.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(a.uid,",mediaType:").concat(c," twice.")),e.splice(r,1);continue}c?c==="audio"?t.set(a,f|Ls.Audio):c==="video"&&t.set(a,f|h):t.set(a,f|Ls.Audio|h)}else c?c==="audio"?t.set(a,Ls.Audio):c==="video"&&t.set(a,h):t.set(a,Ls.Audio|h)}try{const r=await this._p2pChannel.massUnsubscribe(e);r&&await this._gateway.massUnsubscribe(r),I.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(a=>{let{user:c,mediaType:d}=a;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(d,";")}).join()))}catch(r){if(r.code===K.DISCONNECT_P2P)return void I.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw I.error("[".concat(this._clientId,"] massUnsubscribe error"),r.toString()),r}}async setLowStreamParameter(e){(function(r){if(!r)throw new we(K.INVALID_PARAMS);Lr(r.width)||xj(r.width,"streamParameter.width"),Lr(r.height)||xj(r.height,"streamParameter.height"),Lr(r.framerate)||xj(r.framerate,"streamParameter.framerate"),Lr(r.bitrate)||Xn(r.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&I.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),I.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,De.LocalVideoLowTrack)}async setDualStreamMode(e,t){cs(e,"mode",[0,1,-1]);try{switch(t&&await this.setLowStreamParameter(t),this._dualStreamMode=e,this._joinInfo?this._gateway.setDualStreamMode(e).catch(r=>{I.warning("[".concat(this._clientId,"] set dual stream mode failed"),r.toString())}):I.debug("[".concat(this._clientId,"] haven't joined yet, cache dual stream mode ").concat(e)),e){case kv.AUTO_SIMULCAST_STREAM:I.info("[".concat(this._clientId,"] set dual stream mode to ").concat(e));break;case kv.DISABLE_SIMULCAST_STREM:return this.disableDualStream();case kv.ENABLE_SIMULCAST_STREAM:return this.enableDualStream()}}catch(r){throw I.error("[".concat(this._clientId,"] set dual stream mode error"),r.toString()),r}}async enableDualStream(){if(!Zt().supportDualStream)throw tt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Ee(K.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Ee(K.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw tt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,this._dualStreamMode=kv.ENABLE_SIMULCAST_STREAM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(e=>{I.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),e.toString())}),tt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),I.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)return this._isDualStreamEnabled=!1,void I.info("[".concat(this._clientId,"] disable dual stream before join"));if(this._p2pChannel.getLocalMedia(De.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw tt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,this._dualStreamMode=kv.DISABLE_SIMULCAST_STREM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(e=>{I.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),e.toString())}),tt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),I.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(a){cs(a,"role",["audience","host"])}(e),t&&Rj(t),this.mode==="rtc"||this.mode==="p2p")throw I.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Ee(K.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new Ee(K.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new Ee(K.INVALID_OPERATION,"can not set client role to audience when publishing stream");const r=this._config.role;if(this._joinInfo&&(this._joinInfo.role=e),e!==r&&z("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",fi.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),I.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level)),r==="audience"&&e!=="audience"&&this._pendingRtpCapabilityChange&&this._p2pChannel instanceof Wg){const{video_codec:a}=this._pendingRtpCapabilityChange;this._p2pChannel.updateRemoteRTPCapabilities(a.map(c=>c.toLowerCase()).filter(c=>{var d;return ke(d=Object.keys(Ag)).call(d,c)}))}}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&Rj(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{I.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const r=t.timestamp-Date.now();return Math.abs(r)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?r:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(ri(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new Ee(K.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Ee(K.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,tt.setProxyServer(this._proxyServer),I.setProxyServer(this._proxyServer),I.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new Ee(K.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Ee(K.INVALID_OPERATION,"You have already set the proxy")}if(wg(e))return this._turnServer={servers:e,mode:"original-manual"},void I.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(r=>r.urls).join(","),"."));e.forEach(r=>kG(r)),this._turnServer={servers:e,mode:"manual"},I.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new Ee(K.INVALID_OPERATION,"you should set license before join channel");if(ri(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new Ee(K.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,I.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new Ee(K.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Ee(K.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let r;switch(e===void 0&&(e=3),e){case 1:case 2:throw new Ee(K.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:r="proxy3";break;case 4:r="proxy4";break;case 5:r="proxy5";break;default:throw new Ee(K.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=r,this.store.cloudProxyServerMode=r,I.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Ee(K.INVALID_OPERATION,"Stop proxy server after leave channel");tt.setProxyServer(),I.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",I.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new Ee(K.INVALID_PARAMS,"accessPoints is required.");Ah(e.accessPoints.serverList,"accessPoints.serverList"),ri(e.accessPoints.domain,"accessPoints.domain");const t=(S,R)=>{Xn(S,R,0,65535,!0)};let r=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),r=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Ee(K.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");z("CLOSE_AFB_FOR_LOCAL_AP")&&(Wn("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Wn("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const a=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=e.accessPoints.domain,d=e.accessPoints.serverList.map(S=>a.test(S)?"".concat(S.replace(/\./g,"-"),".").concat(c):S),h=d.map(S=>"".concat(S,":").concat(r));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Wn("WEBCS_DOMAIN",h),Wn("WEBCS_DOMAIN_BACKUP_LIST",h),Wn("GATEWAY_DOMAINS",[c]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Ah(e.report.hostname,"report.hostname"),Wn("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Wn("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Wn("EVENT_REPORT_DOMAIN",d[0]),Wn("EVENT_REPORT_BACKUP_DOMAIN",d[1]||d[0]));let f=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),f=e.report.port),Wn("STATS_COLLECTOR_PORT",f),e.report?Wn("ENABLE_EVENT_REPORT",!0):Wn("ENABLE_EVENT_REPORT",!1);let m="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Ah(e.log.hostname,"log.hostname"),m=e.log.hostname[0]):m=d[0];let v=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),v=e.log.port),Wn("LOG_UPLOAD_SERVER","".concat(m,":").concat(v));let E=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Ah(e.cds.hostname,"cds.hostname"),E=e.cds.hostname):E=d;let w=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),w=e.cds.port),Wn("CDS_AP",E.map(S=>"".concat(S,":").concat(w))),e.cds?Wn("ENABLE_CONFIG_DISTRIBUTE",!0):Wn("ENABLE_CONFIG_DISTRIBUTE",!1),I.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(Ah(e,"serverList"),ri(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Ee(K.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const r=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(a=>r.test(a)?"".concat(a.replace(/\./g,"-"),".").concat(t):a),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Wn("WEBCS_DOMAIN",e),Wn("WEBCS_DOMAIN_BACKUP_LIST",e),Wn("GATEWAY_DOMAINS",[t]),Wn("EVENT_REPORT_DOMAIN",e[0]),Wn("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Wn("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),I.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(cs(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw I.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else I.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){cs(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const r=this._users.find(a=>a.uid===e);r&&r.videoTrack&&r.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(r){throw I.error("[".concat(this._clientId,"] set remote video stream type error"),r.toString()),r}I.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){cs(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(r){throw I.error("[".concat(this._clientId,"] set stream fallback option"),r.toString()),r}I.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,r,a){(function(d){cs(d,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),ri(t,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(ke(c).call(c,e)){if(!r||!(r instanceof Uint8Array&&r.length===32))throw new Ee(K.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(r)throw new Ee(K.INVALID_PARAMS,"current encrypt mode does not need salt");if(a){if(Tl(a,"encryptDataStream"),!ke(c).call(c,e))throw new Ee(K.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||I.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,r&&(this._encryptionSalt=df(r))}async renewToken(e){if(ri(e,"token",1,2047),!this._key||!this._joinInfo)throw new Ee(K.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const r=await this._renewTokenMutex.lock();try{if(z("USE_NEW_TOKEN")){I.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const a=await zue(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||ls);I.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:a})}else I.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});I.debug("[".concat(this._clientId,"] renewToken success"))}catch(a){throw this._key=t,this._joinInfo.token=t,I.error("[".concat(this._clientId,"] renewToken failed"),a.toString()),a}finally{r()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?I.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(Kt.VOLUME_INDICATOR,e)},z("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new Ee(K.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Ee(K.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new Ee(K.LIVE_STREAMING_TASK_CONFLICT);const r=t?Oh.TRANSCODE:Oh.RAW;return this._createLiveStreamingClient(r).startLiveStreamingTask(e,r)}setLiveTranscoding(e){return this._createLiveStreamingClient(Oh.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(r=>r&&r.hasUrl(e));if(!t.length)throw new Ee(K.INVALID_PARAMS,"can not find live streaming url to stop");await Ue.all(t.map(r=>r&&r.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){b7(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){b7(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof Wg&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Ee(K.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const c=new TextEncoder;e.payload=c.encode(e.payload)}let a=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ke(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(a=!0,e.payload=await async function(c,d,h){var f;const m=To(f=Array.from(h)).call(f,(D,P)=>D+P,0),v={serverTs:0,seq:ude++,length:h.length,checkSum:m},E=new Uint8Array(FG(m,2)),w=new ArrayBuffer(Mv),S=new DataView(w);S.setUint32(0,v.serverTs),S.setUint16(4,v.seq),S.setUint16(6,v.length),S.setUint16(8,v.checkSum);const R=16-h.length%16;h=LG(h,new Uint8Array(R));const j=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:QG,additionalData:E},d,h);return LG(new Uint8Array(w),new Uint8Array(j))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new Ee(K.INVALID_PARAMS,a?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(lt.DATA_STREAM,{payload:df(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-Jue},!r)}sendMetadata(e){if(!this._joinInfo)throw new Ee(K.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new Ee(K.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(lt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:df(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(yde),!this._joinInfo)throw new Ee(K.INVALID_OPERATION,"can not send custom report, not joined");await tt.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const e=this._statsCollector.getRemoteNetworkQualityStats();if(z("DELETE_NEQ_AFTER_USER_LEAVE")){const t=this._users.map(r=>r.uid+"");Object.keys(e).forEach(r=>{ke(t).call(t,r)||delete e[r]})}return e}getNetworkQuality(){return this._statsCollector.getNetworkQuality()}async pickSVCLayer(e,t){cs(t.spatialLayer,"spatialLayer",[0,1,2,3]),cs(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(r){throw I.error("[".concat(this._clientId,"] pick SVC layer failed"),r.toString()),r}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:r}=e;if(Tl(t,"apRTM"),Xn(r,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=r,I.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=r,this._gateway.setRTM2Flag(r)}_reset(){if(I.debug("[".concat(this._clientId,"] reset client")),function(e){const t=Yv.indexOf(e);t!==-1&&Yv.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._pendingRtpCapabilityChange=void 0,this._axiosCancelSource.cancel(),this._axiosCancelSource=Pa.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&Y7(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0,this._sessionId&&tt.reportRteDetail(this._sessionId)),this._fallbackServerInfo=void 0,this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&tt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Ks("client-publish",this._clientId),this._subscribeMutex=new Ks("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var r;const a=e||Ng();e?I.debug("[".concat(this._clientId,"] new Session ").concat(a)):I.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(a));const c=e?"":this._sessionId||"";this._sessionId=a,this.store.sessionId=a,tt.addSid(a);const d={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((r=this._joinInfo)===null||r===void 0?void 0:r.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1,rteUrl:this.store.rteUrl,rteSid:this.store.rteSid};tt.sessionInit(this._sessionId,Ll({cname:t.channel,appid:t.appId},d)),this._joinInfo&&(this._joinInfo.sid=a),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=a)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new Ee(K.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ee(K.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&z("FORCE_TURN")&&!z("TURN_ENABLE_TCP")&&!z("TURN_ENABLE_UDP"))throw new Ee(K.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");I.debug("[".concat(this._clientId,"] publish high stream"));try{const r=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const a=(await r.next()).value;if(a){try{await this._gateway.sendExtensionMessage(ss.PUBLISH,a,!0)}catch(c){throw r.throw(c),c}await r.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const a=(await r.next()).value;if(a){var t;let c;try{c=await this._gateway.publish(this._uid,a,!0)}catch(d){if(d.code!==K.DISCONNECT_P2P)throw r.throw(d),d}await r.next(((t=c)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of e)c instanceof Jn&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(d=>{I.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r==null?void 0:r.code,e),(r==null?void 0:r.code)===K.WS_ABORT)return;throw r}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Ee(K.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ee(K.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));I.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const r=await this._p2pChannel.publishLowStream(this._lowStreamParameter),a=(await r.next()).value;if(a){var t;let c;try{c=await this._gateway.publish(this._uid,a,!0)}catch(d){if(d.code!==K.DISCONNECT_P2P)throw r.throw(d),d}r.next(((t=c)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r==null?void 0:r.code,void 0,!0),(r==null?void 0:r.code)===K.WS_ABORT)return;throw r}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new Ee(K.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const r=(a={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Td("LiveStreaming").create(a));var a;return r.onLiveStreamError=(c,d)=>{tt.reportApiInvoke(this._sessionId,{name:_r.ON_LIVE_STREAM_ERROR,options:[c,d],tag:$n.TRACER}).onSuccess(),this.safeEmit(Kt.LIVE_STREAMING_ERROR,c,d)},r.onLiveStreamWarning=(c,d)=>{tt.reportApiInvoke(this._sessionId,{name:_r.ON_LIVE_STREAM_WARNING,options:[c,d],tag:$n.TRACER}).onSuccess(),this.safeEmit(Kt.LIVE_STREAMING_WARNING,c,d)},r.on(wM.REQUEST_WORKER_MANAGER_LIST,(c,d,h)=>{if(!this._joinInfo)return h(new Ee(K.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(f,m,v,E){const w=z("UAP_AP").slice(0,z("AJAX_REQUEST_CONCURRENT")).map(S=>m.proxyServer?"https://".concat(m.proxyServer,"/ap/?url=").concat(S+"/api/v1?action=uap"):"https://".concat(S,"/api/v1?action=uap"));return await Lue(w,f,m,v,E)})(c,this._joinInfo,this._axiosCancelSource.token,ls).then(d).catch(h)}),r};return e===Oh.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Ee(K.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:r}=this.getLocalVideoStats(),a=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:r}},Td("ChannelMediaRelay").create(e));a.on("state",c=>{c===oo.RELAY_STATE_FAILURE&&a&&a.dispose(),this.safeEmit(Kt.CHANNEL_MEDIA_RELAY_STATE,c)}),a.on("event",c=>{this.safeEmit(Kt.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=a,this._statsCollector.onStatsChanged=(c,d)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(d))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:r,deleted:a}=e,c=[];if(t){const d=[];this._users.forEach(h=>{h._dataChannels.forEach(f=>{r.every(m=>m.uid!==h._uintid||m.stream_id!==f.id)&&d.push({uid:h._uintid,stream_id:f.id,ordered:f.ordered,max_retrans_times:f.maxRetransmits,metadata:f.metadata})})}),d.length>0&&this._handleUpdateDataChannel({added:[],deleted:d})}Array.isArray(r)&&r.length>0&&r.forEach(d=>{const{uid:h,stream_id:f,ordered:m,max_retrans_times:v,metadata:E}=d,w=this._users.find(S=>S._uintid===h);if(!w)return void I.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(I.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),ke(c).call(c,w)||c.push(w),w._uintid||(w._uintid=h),w._dataChannels.findIndex(S=>S.id===d.stream_id)===-1){const S={id:f,ordered:!!m,maxRetransmits:v,metadata:E},R=function(j){return i7(j,!0)}(S);w._dataChannels.push(R),I.info("[".concat(this._clientId,"] remote user ").concat(w.uid," published datachannel")),t||this.safeEmit(Kt.USER_PUBLISHED,w,"datachannel",S)}this._p2pChannel.hasPendingRemoteDataChannel(w,d.stream_id)&&(I.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(w.uid," after reconnect.")),this._subscribeDataChannel(w,d.stream_id).catch(S=>{I.error("[".concat(this._clientId,"] resubscribe datachannel error"),S.toString())}))}),t&&(this.safeEmit(Kt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(a)&&a.length>0&&a.forEach(d=>{const{uid:h,stream_id:f}=d,m=this._users.find(E=>E._uintid===h);if(!m)return void I.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const v=m._dataChannels.find(E=>E.id===d.stream_id);v&&(I.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(m,[v]).then(E=>{if(m._dataChannels=m._dataChannels.filter(w=>w!==v),E)return this._gateway.unsubscribeDataChannel(E,m.uid)}),I.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(v.id)),this.safeEmit(Kt.USER_UNPUBLISHED,m,"datachannel",v._config))})}_getEncodingName(e){var t,r;if(!this._joinResponse)return;const a=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(!a)return;for(const f of a){var c;if(f.payloadType===e)return f==null||(c=f.rtpMap)===null||c===void 0?void 0:c.encodingName}const d=(r=this._joinResponse.ortc.rtpCapabilities.recv)===null||r===void 0?void 0:r.videoCodecs;if(d)for(const f of d){var h;if(f.payloadType===e)return f==null||(h=f.rtpMap)===null||h===void 0?void 0:h.encodingName}return e===0?"unknown":void 0}_handleRemoveDataChannels(e){const t=this._users.find(r=>r.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){I.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const r=()=>{I.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(a=>{this.safeEmit(Kt.USER_UNPUBLISHED,t,"datachannel",a._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(a=>{if(a)return this._gateway.unsubscribeDataChannel(a,t.uid)}),r()}}else I.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(rs.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void I.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),r=Date.now();Object.keys(t).forEach(a=>{const{value:c,type:d,expires:h}=t[a];h&&h<=r||d||gM()||!Object.prototype.hasOwnProperty.call(nI,a)||(tc[a]=c,Mn[a]=c,I.debug("Update gateway parameters from config distribute",a,c))})}catch(t){I.error("Error update config from local cache",t.message)}})()}),this._gateway.on(rs.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(rs.CONNECTION_STATE_CHANGE,(e,t,r)=>{var a;if(r===nn.FALLBACK)return;const c=()=>{this.safeEmit(Kt.CONNECTION_STATE_CHANGE,e,t,r)};if(tt.reportApiInvoke(this._sessionId||((a=this._gateway.joinInfo)===null||a===void 0?void 0:a.sid)||null,{name:_r.CONNECTION_STATE_CHANGE,options:[e,t,r],tag:$n.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:r})),I.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void c();if(e==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var d;this._streamFallbackTypeCacheMap.forEach((h,f)=>{this._gateway.setStreamFallbackOption(f,h).catch(m=>{I.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),m)})}),this._remoteStreamTypeCacheMap.forEach((h,f)=>{this._gateway.setRemoteVideoStreamType(f,h).catch(m=>{I.warning("[".concat(this._clientId,"] auto set remote stream type failed"),m)})}),z("VOS_CONFIGURE")&&Array.isArray(z("VOS_CONFIGURE"))&&z("VOS_CONFIGURE").length>0&&(this._gateway.setConfigure(z("VOS_CONFIGURE")).catch(h=>{I.debug("[".concat(this._clientId,"] auto set vos config failed"),h)}),I.debug("[".concat(this._clientId,"] ws connected auto set vos config"))),this._remoteDefaultVideoStreamType!==void 0&&((d=this._joinInfo)===null||d===void 0?void 0:d.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{I.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{I.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this._dualStreamMode&&this._gateway.setDualStreamMode(this._dualStreamMode).catch(h=>{I.warning("[".concat(this._clientId,"] auto set dual stream mode failed"),h)}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{I.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(I.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,Je.AUDIO,!1)),h._trust_video_mute_state_||(I.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,Je.VIDEO,!1)),h._trust_audio_enabled_state_||(I.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(I.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(I.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(I.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(I.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(rs.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new Ee(K.UNEXPECTED_ERROR,"can not recover, no join info"));try{let r;if(this._fallbackServerInfo)r=this._fallbackServerInfo,this._fallbackServerInfo=void 0,this._joinInfo.preload=!1,tt.reportApiInvoke(this._sessionId,{name:_r.VOS_FALLBACK_CN,options:{cur:r.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!0},tag:$n.TRACER}).onSuccess(),I.info("[".concat(this._clientId,"] use fallback cn server info"));else{const c=await cU(Ll(Ll({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));c?(r=c.ap,X7(c),this._joinInfo.preload=!0):(r=await VI(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||ls,this.store),this._joinInfo.preload=!1)}this._joinInfo&&(this._joinInfo.apResponse=r.gatewayInfo.res,this._joinInfo.gatewayAddrs=r.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=r.gatewayInfo.uni_lbs_ip);const a=[];r.gatewayInfo.gatewayAddrs.forEach(c=>{let{address:d}=c;const[h,f]=d.split(":");this._joinInfo&&this._joinInfo.proxyServer?a.push({proxy:this._joinInfo.proxyServer,host:h,port:f}):a.push({host:h,port:f})}),e(a)}catch(r){t(r)}}),this._gateway.on(rs.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Kt.NETWORK_QUALITY,e)}),this._gateway.on(rs.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(Kt.STREAM_TYPE_CHANGED,e,t),tt.reportApiInvoke(this._sessionId,{name:_r.STREAM_TYPE_CHANGE,options:[e,t],tag:$n.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(rs.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(rs.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,r)=>{try{let a=await this._p2pChannel.getEstablishParams();a&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(a=await this._p2pChannel.startP2PConnection(e)),t(a)}catch(a){r(a)}}),this._gateway.on(rs.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let r;this._joinResponse=e,e.attributes?r=e.attributes.userAttributes.preSubSsrcs:I.debug("no attributes in joinResponse");const a=XH(e.ortc,t,r);this._p2pChannel.connect(a)}),this._gateway.on(rs.PRE_CONNECT_PC,async(e,t,r)=>{const{candidates:a,fingerprint:c,turnServer:d}=e;if(this._joinInfo&&a.length>0&&!this._p2pChannel.isPlanB){const{cert:f,cid:m}=this._joinInfo.apResponse,v="".concat(m,"_").concat(f);if(v.length<4||v.length>256)return void I.debug("[".concat(this._clientId,"] ufrag length is not valid, length: ").concat(v.length));await this._p2pChannel.startP2PConnection({turnServer:d,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var h;t(await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(m,"_").concat(f),icePwd:"".concat(m,"_").concat(f)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(h=z("FINGERPRINT"))!==null&&h!==void 0?h:c}]},candidates:a,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0}))}catch(E){E.code&&E.code===K.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:d,cloudProxyServer:this._joinInfo.cloudProxyServer},!0),r(E)}}}),this._gateway.on(rs.VOS_FALLBACK,e=>{e==="fallback_hls"&&this.safeEmit(Kt.FALLBACK_TO_HLS,Cj.VOSERROR)}),this._gateway.on(rs.RESET_SIGNAL,()=>{this._p2pChannel instanceof Wg&&this._p2pChannel.fallbackConnection(),this._handleGatewaySignalEvents()}),this._gateway.on(rs.DATACHANNEL_FAILBACK,()=>{tt.reportApiInvoke(this._sessionId,{name:_r.DATACHANNEL_FAILBACK,options:{},tag:$n.TRACER}).onSuccess(),this._joinGateway()})}_handleGatewaySignalEvents(){this._gateway.signal.on(Rt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Rt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Rt.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(Rt.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(Rt.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(Rt.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Rt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Rt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Rt.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,Je.AUDIO,!0)),this._gateway.signal.on(Rt.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,Je.AUDIO,!1)),this._gateway.signal.on(Rt.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,Je.VIDEO,!0)),this._gateway.signal.on(Rt.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,Je.VIDEO,!1)),this._gateway.signal.on(Rt.RECEIVE_METADATA,e=>{const t=Cg(e.metadata);this.safeEmit(Kt.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(Rt.ON_DATA_STREAM,async e=>{var t;if(!e)return;let r=Cg(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ke(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<Mv)throw new Ee(K.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(Mv));r=await async function(d,h,f){const m=f.subarray(0,Mv),v=m.slice(8,Mv),E=(v[0]<<8)+v[1],w=(m[6]<<8)+m[7],S=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:d,tagLength:QG,additionalData:new Uint8Array(FG(E,2))},h,f.subarray(Mv));return new Uint8Array(S).subarray(0,w)}(this._encryptDataStreamIv,this._encryptDataStreamKey,r)}let a=0;if(e.ordered||e.syncWithAudio){const c=this._p2pChannel.getStats(),d=this.remoteUsers.find(f=>f.uid===e.uid),h=c==null?void 0:c.audioRecv.find(f=>f.ssrc===(d==null?void 0:d._audioSSRC));a=h==null?void 0:h.jitterBufferMs}(a==null||Number.isNaN(a))&&(a=0),Zue(Ll(Ll({},e),{},{payload:r}),a,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Rt.ON_CRYPT_ERROR,()=>{lf(()=>{I.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Kt.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Rt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Rt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{I.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,nn.TOKEN_EXPIRE),this.safeEmit(Kt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Rt.ON_STREAM_FALLBACK_UPDATE,e=>{I.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Kt.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Rt.ENABLE_MULTI_STREAM,e=>{this._dualStreamMode===kv.AUTO_SIMULCAST_STREAM&&this.enableDualStream().catch(t=>{I.debug("[".concat(this._clientId,"] set dual stream mode error"),t.toString())})}),this._gateway.signal.on(Rt.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),I.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(Rt.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(Rt.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(rt.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case lt.PUBLISH:{if(!t)return;const c=t.ortc;if(c){var r,a;const d=c.some(m=>{let{stream_type:v}=m;return v===Un.Audio}),h=c.some(m=>{let{stream_type:v}=m;return v!==Un.Audio}),f=c.some(m=>{let{stream_type:v}=m;return v===Un.Screen||v===Un.ScreenLow});t.state==="offer"&&tt.publish(this._joinInfo.sid,{eventElapse:Ii.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:K.TIMEOUT,audio:d,video:h,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:f,audioName:d?(r=c.find(m=>{let{stream_type:v}=m;return v===Un.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0,videoName:h?(a=c.find(m=>{let{stream_type:v}=m;return v!==Un.Audio}))===null||a===void 0||(a=a.ssrcs[0])===null||a===void 0?void 0:a.ssrcId.toString():void 0})}break}case lt.SUBSCRIBE:t&&tt.subscribe(this._joinInfo.sid,{succ:!1,ec:K.TIMEOUT,audio:t.stream_type===Je.AUDIO,video:t.stream_type===Je.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Ii.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(Rt.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(Rt.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;z("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(a=>!Ug(a.string_id||a.stream_id,this.channelName)));const t=[],r=[];for(const a of e.users){let c=this._users.find(E=>E._uintid===a.stream_id);c?c._trust_in_room_=!0:(c=new _f(a.string_id||a.stream_id,a.stream_id),this._users.push(c),this.store.firstVideoFrameDecoded(c.uid,{userJoinNotify:Date.now()}),this.getListeners(Kt.PUBLISHED_USER_LIST).length===0&&(I.debug("[".concat(this._clientId,"] user online"),a.stream_id),this.safeEmit(Kt.USER_JOINED,c)));const d=Ls.Audio&a.stream_type,h=(Ls.Video|Ls.LwoVideo)&a.stream_type,f=(65280&a.stream_type)!=0,m=d&&c.hasAudio,v=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=a.video_ssrc,c._rtxSsrcId=a.video_rtx),d&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=a.audio_ssrc),d&&!m&&this.getListeners(Kt.PUBLISHED_USER_LIST).length===0&&(I.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(Kt.USER_PUBLISHED,c,"audio")),h&&!v&&this.getListeners(Kt.PUBLISHED_USER_LIST).length===0&&(I.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(Kt.USER_PUBLISHED,c,"video")),(d&&!m||h&&!v||f)&&t.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&r.push({user:c,mediaType:"video"}),d&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&r.push({user:c,mediaType:"audio"})}r.length>0&&(I.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(r.map(a=>"user: ".concat(a.user.uid,", mediaType: ").concat(a.mediaType)).join("; ")," ")),this.massSubscribe(r).catch(a=>{I.error("[".concat(this._clientId,"] mass resubscribe error"),a.toString())})),this.getListeners(Kt.PUBLISHED_USER_LIST).length>0?z("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(I.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(a=>a.uid).join(", "))),this.safeEmit(Kt.PUBLISHED_USER_LIST,t)):I.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(a=>a.uid).join(", ")))}),this._gateway.signal.on(Rt.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;if(this._p2pChannel instanceof Wg){if(this.role==="audience"&&z("UPDATE_RTP_CAP_IN_HOST"))return this._pendingRtpCapabilityChange=e,void I.debug("[".concat(this._clientId,"] no need to change rtp capability because of audience, params: ").concat(JSON.stringify(e)));this._p2pChannel.updateRemoteRTPCapabilities(t.map(r=>r.toLowerCase()).filter(r=>{var a;return ke(a=Object.keys(Ag)).call(a,r)}))}}),this._gateway.signal.on(rt.VOS_FALLBACK_PROMISE,async(e,t,r)=>{if(e==="FALLBACKCN"&&z("ENABLE_QUALITY_FALLBACK")){if(!this._joinInfo)return r(new Ee(K.UNEXPECTED_ERROR,"can not recover, no join info"));I.info("[".concat(this._clientId,"] try fallback to cn, start request new server info"));const c=this._joinInfo.apRequestDetail;try{this._joinInfo.apRequestDetail=e;const d=await VI(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||ls,this.store);if(z("QUALITY_FALLBACK_REHEARSAL"))return tt.reportApiInvoke(this._sessionId,{name:_r.VOS_FALLBACK_CN,options:{cur:d.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:$n.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=c,void r();this._fallbackServerInfo=d,t()}catch(d){var a;const h=d==null||(a=d.data)===null||a===void 0?void 0:a.desc;z("QUALITY_FALLBACK_REHEARSAL")?(tt.reportApiInvoke(this._sessionId,{name:_r.VOS_FALLBACK_CN,options:{cur:"failed, errorReason: "+h||"unknown",prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:$n.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=c):Array.isArray(h)&&ke(h).call(h,"request downgrade fallback")&&this.safeEmit(Kt.FALLBACK_TO_HLS,Cj.AP_ERROR),r(d)}}else r()})}_handleP2PEvents(){this._gateway.signal.on(Rt.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(ss.PUBLISH,(e,t,r)=>{const{uid:a}=e;e.forEach(c=>{const{kind:d,ssrcs:h,mid:f,isMuted:m}=c;this._handleP2PAddAudioOrVideoStream(d,a,h[0].ssrcId,f);const v=this._users.find(E=>E.uid===a);return v&&this.store.useP2P?this._p2pChannel.mockSubscribe(v,d,h[0].ssrcId,f).then(()=>{t()}).catch(r):t(),this._handleMuteStream(a,d,!!m)})}),this._gateway.signal.on(ss.CALL,async(e,t,r)=>{if(this.store.useP2P)try{var a;t(await this._p2pChannel.startP2P({turnServer:(a=this._joinInfo)===null||a===void 0?void 0:a.turnServer},e))}catch(c){r(c)}}),this._gateway.signal.on(rt.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(ss.UNPUBLISH,async(e,t,r)=>{if(this.store.useP2P){const{unpubMsg:a,uid:c}=e,d=this._users.find(h=>h.uid===c);if(!d)return I.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void t();try{a.forEach(async h=>{let{stream_type:f}=h;const m=f===Un.Audio?Je.AUDIO:Je.VIDEO;await this._p2pChannel.unsubscribe(d,m),this._handleMuteStream(c,m,!0)}),t()}catch(h){r(h)}}}),this._gateway.signal.on(ss.CONTROL,async(e,t)=>{const{action:r}=e;switch(r){case ff.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,Je.VIDEO,!0);break;case ff.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,Je.AUDIO,!0);break;case ff.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,Je.VIDEO,!1);break;case ff.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,Je.AUDIO,!1)}}),this._gateway.signal.on(ss.RESTART_ICE,async(e,t,r)=>{if(this.store.useP2P)try{const{direction:a,iceParameter:c}=e;a!==va.SEND_ONLY||c?t(await this._p2pChannel.restartICE(a,c)):(this._p2pChannel.handleDisconnect(a),t())}catch(a){r(a)}}),this._gateway.signal.on(ss.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:t,direction:r}=e;this._p2pChannel.addRemoteCandidate(t,r)}}),this._p2pChannel.on(dt.RequestP2PRestartICE,async(e,t,r)=>{try{const{direction:a}=e;t(await this._gateway.sendExtensionMessage(ss.RESTART_ICE,e,a===va.SEND_ONLY))}catch(a){r(a)}}),this._p2pChannel.on(dt.LocalCandidate,e=>{this._gateway.sendExtensionMessage(ss.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(dt.RequestP2PMuteLocal,async(e,t,r)=>{try{await this._gateway.sendExtensionMessage(ss.CONTROL,e,!0),t()}catch(a){r(a)}}),this._p2pChannel.on(dt.RequestP2PUnmuteRemote,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(a){a.code===K.DISCONNECT_P2P?t():r(a)}else t()}),this._p2pChannel.on(dt.RequestP2PMuteRemote,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(a){a.code===K.DISCONNECT_P2P?t():r(a)}else t()}),this._p2pChannel.on(dt.StateChange,(e,t)=>{t===An.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(dt.PeerConnectionStateChange,e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(Kt.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(dt.RequestMuteLocal,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(a){a.code===K.DISCONNECT_P2P?t():r(a)}else t()}),this._p2pChannel.on(dt.RequestUnmuteLocal,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(a){a.code===K.DISCONNECT_P2P?t():r(a)}else t()}),this._p2pChannel.on(dt.RequestRePublish,(e,t,r)=>{this.publish(e,!1).then(t).catch(r)}),this._p2pChannel.on(dt.RequestRePublishDataChannel,(e,t,r)=>{Ue.all(e.map(async a=>{const c=await this._p2pChannel.publishDataChannel([a]);try{c.forEach(d=>{this._uid&&this._gateway.publishDataChannel(this._uid,d,!0)})}catch(d){if(d.code!==K.DISCONNECT_P2P)throw d}})).then(t).catch(r)}),this._p2pChannel.on(dt.RequestReSubscribe,async(e,t,r)=>{try{for(const{user:a,kind:c}of e)c===Je.VIDEO?await this.subscribe(a,"video"):await this.subscribe(a,"audio");t()}catch(a){r(a)}}),this._p2pChannel.on(dt.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(dt.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(dt.MediaReconnectStart,e=>{this.safeEmit(Kt.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(dt.MediaReconnectEnd,e=>{this.safeEmit(Kt.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(dt.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(dt.RequestRestartICE,async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),r=await t.next();if(r.done)return;const a=r.value;let c;try{c=await this._gateway.restartICE({iceParameters:a})}catch(h){return void t.throw(h)}const{iceParameters:d}=function(h){const f=h.iceParameters;return{iceParameters:{iceUfrag:f.iceUfrag,icePwd:f.icePwd}}}(c);await t.next({remoteIceParameters:d})}),this._p2pChannel.on(dt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(dt.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:r,rtpCapabilities:a}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:c,gatewayAddress:d}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:r,rtpCapabilities:a}),h=XH(c,d);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(dt.RequestUnpublishForReconnectPC,async(e,t,r)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):r()}),this._p2pChannel.on(dt.P2PLost,()=>{this.safeEmit(Kt.P2P_LOST,this.store.uid)}),this._p2pChannel.on(dt.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(dt.ConnectionTypeChange,e=>{this.safeEmit(Kt.IS_USING_CLOUD_PROXY,e),this._gateway.setUsingProxy(e)}),this._p2pChannel.on(dt.FirstVideoBufferReady,(e,t)=>{this.safeEmit(Kt.FIRST_VIDEO_BUFFER_READY,e,t)}),this._p2pChannel.on(dt.FirstVideoPreRender,(e,t)=>{this.safeEmit(Kt.FIRST_VIDEO_PRE_RENDER,e,t)}),this._p2pChannel.on(dt.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(dt.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(dt.AudioMetadata,e=>{this.safeEmit(Kt.AUDIO_METADATA,e)}),this._p2pChannel.on(dt.AudioPts,e=>{this.safeEmit(Kt.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Ee(K.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Ee(K.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const r=(t={config:e},Td("ContentInspect").create(t));this._inspect=r,this.handleVideoInspectEvents(r);const{appId:a,cname:c,sid:d,token:h,uid:f,cid:m,vid:v}=this._joinInfo;await r.init({appId:a,areaCode:"",cname:c,sid:d,token:h,uid:f,cid:m,vid:v?Number(v):0},ls)}catch(r){throw Array.isArray(r)?r[0]:r}var t}handleVideoInspectEvents(e){e.on(Ys.CONNECTION_STATE_CHANGE,(t,r)=>{if(this.safeEmit(Kt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,r),r===Al.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Kt.CONTENT_INSPECT_ERROR,new Ee(K.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Ys.INSPECT_RESULT,(t,r)=>{var a;if((r==null?void 0:r.code)===K.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return I.debug("Stop inspect content because that has left channel"),this==null||(a=this._inspect)===null||a===void 0||a.close(),void(this._inspect=void 0);this.safeEmit(Kt.CONTENT_INSPECT_RESULT,t,r)}),e.on(Ys.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(r=>r.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Ee(K.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Tl(e,"enabled"),e){if(!t)throw new Ee(K.INVALID_PARAMS,"config is required");if(lK(t),!this._joinInfo)throw new Ee(K.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const a=(r={config:t},Td("ImageModeration").create(r));this._moderation=a,this.handleImageModerationEvents(a);const{appId:c,cname:d,sid:h,token:f,uid:m,cid:v,vid:E}=this._joinInfo;await a.init({appId:c,areaCode:"",cname:d,sid:h,token:f,uid:m,cid:v,vid:E?Number(E):0},ls)}}catch(a){throw Array.isArray(a)?a[0]:a}}else{var r;if(!this._moderation)throw new Ee(K.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(a){throw Array.isArray(a)?a[0]:a}}}handleImageModerationEvents(e){e.on(Sd.CONNECTION_STATE_CHANGE,(t,r)=>{if(this.safeEmit(Kt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,r),t===jc.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Ee(K.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Sd.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(r=>r.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){cs(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new Ee(K.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,I.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return I.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Tl(e,"enabled"),Wn("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_setRteInfo(e,t){this.store.rteUrl=e,this.store.rteSid=t}_isPreRender(){return"isPreRender"in this._p2pChannel&&this._p2pChannel.isPreRender()}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Fe(Xe.prototype,"leave",[dK],Object.getOwnPropertyDescriptor(Xe.prototype,"leave"),Xe.prototype),Fe(Xe.prototype,"publish",[uK],Object.getOwnPropertyDescriptor(Xe.prototype,"publish"),Xe.prototype),Fe(Xe.prototype,"unpublish",[hK],Object.getOwnPropertyDescriptor(Xe.prototype,"unpublish"),Xe.prototype),Fe(Xe.prototype,"subscribe",[pK],Object.getOwnPropertyDescriptor(Xe.prototype,"subscribe"),Xe.prototype),Fe(Xe.prototype,"presubscribe",[fK],Object.getOwnPropertyDescriptor(Xe.prototype,"presubscribe"),Xe.prototype),Fe(Xe.prototype,"massSubscribe",[mK],Object.getOwnPropertyDescriptor(Xe.prototype,"massSubscribe"),Xe.prototype),Fe(Xe.prototype,"unsubscribe",[gK],Object.getOwnPropertyDescriptor(Xe.prototype,"unsubscribe"),Xe.prototype),Fe(Xe.prototype,"massUnsubscribe",[_K],Object.getOwnPropertyDescriptor(Xe.prototype,"massUnsubscribe"),Xe.prototype),Fe(Xe.prototype,"setLowStreamParameter",[vK],Object.getOwnPropertyDescriptor(Xe.prototype,"setLowStreamParameter"),Xe.prototype),Fe(Xe.prototype,"setDualStreamMode",[EK],Object.getOwnPropertyDescriptor(Xe.prototype,"setDualStreamMode"),Xe.prototype),Fe(Xe.prototype,"enableDualStream",[yK],Object.getOwnPropertyDescriptor(Xe.prototype,"enableDualStream"),Xe.prototype),Fe(Xe.prototype,"disableDualStream",[bK],Object.getOwnPropertyDescriptor(Xe.prototype,"disableDualStream"),Xe.prototype),Fe(Xe.prototype,"setClientRole",[xK],Object.getOwnPropertyDescriptor(Xe.prototype,"setClientRole"),Xe.prototype),Fe(Xe.prototype,"_setClientRoleOptions",[wK],Object.getOwnPropertyDescriptor(Xe.prototype,"_setClientRoleOptions"),Xe.prototype),Fe(Xe.prototype,"setProxyServer",[SK],Object.getOwnPropertyDescriptor(Xe.prototype,"setProxyServer"),Xe.prototype),Fe(Xe.prototype,"setTurnServer",[TK],Object.getOwnPropertyDescriptor(Xe.prototype,"setTurnServer"),Xe.prototype),Fe(Xe.prototype,"setLicense",[RK],Object.getOwnPropertyDescriptor(Xe.prototype,"setLicense"),Xe.prototype),Fe(Xe.prototype,"startProxyServer",[CK],Object.getOwnPropertyDescriptor(Xe.prototype,"startProxyServer"),Xe.prototype),Fe(Xe.prototype,"stopProxyServer",[NK],Object.getOwnPropertyDescriptor(Xe.prototype,"stopProxyServer"),Xe.prototype),Fe(Xe.prototype,"setLocalAccessPointsV2",[IK],Object.getOwnPropertyDescriptor(Xe.prototype,"setLocalAccessPointsV2"),Xe.prototype),Fe(Xe.prototype,"setLocalAccessPoints",[AK],Object.getOwnPropertyDescriptor(Xe.prototype,"setLocalAccessPoints"),Xe.prototype),Fe(Xe.prototype,"setRemoteDefaultVideoStreamType",[kK],Object.getOwnPropertyDescriptor(Xe.prototype,"setRemoteDefaultVideoStreamType"),Xe.prototype),Fe(Xe.prototype,"setRemoteVideoStreamType",[OK],Object.getOwnPropertyDescriptor(Xe.prototype,"setRemoteVideoStreamType"),Xe.prototype),Fe(Xe.prototype,"setStreamFallbackOption",[DK],Object.getOwnPropertyDescriptor(Xe.prototype,"setStreamFallbackOption"),Xe.prototype),Fe(Xe.prototype,"setEncryptionConfig",[PK],Object.getOwnPropertyDescriptor(Xe.prototype,"setEncryptionConfig"),Xe.prototype),Fe(Xe.prototype,"renewToken",[LK],Object.getOwnPropertyDescriptor(Xe.prototype,"renewToken"),Xe.prototype),Fe(Xe.prototype,"enableAudioVolumeIndicator",[jK],Object.getOwnPropertyDescriptor(Xe.prototype,"enableAudioVolumeIndicator"),Xe.prototype),Fe(Xe.prototype,"startLiveStreaming",[MK],Object.getOwnPropertyDescriptor(Xe.prototype,"startLiveStreaming"),Xe.prototype),Fe(Xe.prototype,"setLiveTranscoding",[UK],Object.getOwnPropertyDescriptor(Xe.prototype,"setLiveTranscoding"),Xe.prototype),Fe(Xe.prototype,"stopLiveStreaming",[VK],Object.getOwnPropertyDescriptor(Xe.prototype,"stopLiveStreaming"),Xe.prototype),Fe(Xe.prototype,"startChannelMediaRelay",[FK],Object.getOwnPropertyDescriptor(Xe.prototype,"startChannelMediaRelay"),Xe.prototype),Fe(Xe.prototype,"updateChannelMediaRelay",[BK],Object.getOwnPropertyDescriptor(Xe.prototype,"updateChannelMediaRelay"),Xe.prototype),Fe(Xe.prototype,"stopChannelMediaRelay",[zK],Object.getOwnPropertyDescriptor(Xe.prototype,"stopChannelMediaRelay"),Xe.prototype),Fe(Xe.prototype,"sendCustomReportMessage",[GK],Object.getOwnPropertyDescriptor(Xe.prototype,"sendCustomReportMessage"),Xe.prototype),Fe(Xe.prototype,"pickSVCLayer",[WK],Object.getOwnPropertyDescriptor(Xe.prototype,"pickSVCLayer"),Xe.prototype),Fe(Xe.prototype,"setRTMConfig",[HK],Object.getOwnPropertyDescriptor(Xe.prototype,"setRTMConfig"),Xe.prototype),Fe(Xe.prototype,"enableContentInspect",[KK],Object.getOwnPropertyDescriptor(Xe.prototype,"enableContentInspect"),Xe.prototype),Fe(Xe.prototype,"disableContentInspect",[qK],Object.getOwnPropertyDescriptor(Xe.prototype,"disableContentInspect"),Xe.prototype),Fe(Xe.prototype,"setImageModeration",[YK],Object.getOwnPropertyDescriptor(Xe.prototype,"setImageModeration"),Xe.prototype),Fe(Xe.prototype,"setP2PTransport",[XK],Object.getOwnPropertyDescriptor(Xe.prototype,"setP2PTransport"),Xe.prototype),Fe(Xe.prototype,"getJoinChannelServiceRecords",[$K],Object.getOwnPropertyDescriptor(Xe.prototype,"getJoinChannelServiceRecords"),Xe.prototype),Fe(Xe.prototype,"setPublishAudioFilterEnabled",[JK],Object.getOwnPropertyDescriptor(Xe.prototype,"setPublishAudioFilterEnabled"),Xe.prototype),Xe);function ZK(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const r=jn(5,"client-"),a=tt.reportApiInvoke(null,{id:r,name:_r.CREATE_CLIENT,options:[t],tag:$n.TRACER});try{(function(c){cs(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),cs(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&cs(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&ri(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&kG(c.turnServer),c.httpRetryConfig!==void 0&&AG(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&AG(c.websocketRetryConfig)})(t)}catch(c){throw a.onError(c),c}return(_G(16,0,!0)||yj(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",I.debug("browser not support vp9, force use vp8")),Wn("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),a.onSuccess(),new mhe(Ll(Ll({forceWaitGatewayResponse:!0},t),{},{role:ke(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),r)}function ghe(){let e=!1;const t=yn();return(t.name===Tn.CHROME&&Number(t.version)>=58&&(vd.engine.name!=="WebKit"||function(){const r=yn();if(YN()){if(r.os===Os.MAC_OS)return!0;if(r.os===Os.IOS){const a=vd.os.version&&vd.os.version.split(".");if(a&&Number(a[0])===14&&a[1]&&Number(a[1])>=3||a&&Number(a[0])>14)return!0}}return!1}())||t.name===Tn.FIREFOX&&Number(t.version)>=56||t.name===Tn.OPERA&&Number(t.version)>=45||t.name===Tn.SAFARI&&Number(t.version)>=11||t.name==="WebKit"&&(Mi()||Sl())&&t.osVersion&&Number(t.osVersion.split(".")[0])>=11||yG()||yn().name===Tn.QQ)&&(e=!0),e}class dw{constructor(t,r){L(this,"id",0),L(this,"element",void 0),L(this,"peerPair",void 0),L(this,"context",void 0),L(this,"audioPlayerElement",void 0),L(this,"audioTrack",void 0),dw.count+=1,this.id=dw.count,this.element=t,this.context=r}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const r=document.createElement("audio");r.srcObject=new MediaStream([t.track]),r.play(),this.audioPlayerElement=r}}async switchSdp(){if(!this.peerPair)return;const t=async(a,c)=>{const d=c==="offer"?await a.createOffer():await a.createAnswer();return await a.setLocalDescription(d),a.iceGatheringState==="complete"?a.localDescription:new Ue(h=>{a.onicegatheringstatechange=()=>{a.iceGatheringState==="complete"&&h(a.localDescription)}})},r=async(a,c)=>await a.setRemoteDescription(c);try{const a=await t(this.peerPair[0],"offer");await r(this.peerPair[1],a);const c=await t(this.peerPair[1],"answer");await r(this.peerPair[0],c)}catch(a){throw new Ee(K.LOCAL_AEC_ERROR,a.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let r;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),r=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(r)}catch(c){throw new Ee(K.LOCAL_AEC_ERROR,c.toString()).print()}if(!r)throw new Ee(K.LOCAL_AEC_ERROR,"no dest node when local aec").print();const a=r.stream.getAudioTracks()[0];return this.audioTrack=a,a}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,r=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(r),await this.switchSdp()}close(){I.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var eq,QI;L(dw,"count",0);const _he=window.AudioContext||window.webkitAudioContext,vhe=new(eq=mt({report:tt}),Fe((QI=class{constructor(){L(this,"units",[]),L(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return I.debug("the system does not need to process local aec"),-1;this.context||(this.context=new _he);let t=this.units.find(r=>r&&r.getElement()===e);return t||(t=new dw(e,this.context),this.units.push(t)),t.startEchoCancellation(),I.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return yn().name!==Tn.SAFARI}}).prototype,"processExternalMediaAEC",[eq],Object.getOwnPropertyDescriptor(QI.prototype,"processExternalMediaAEC"),QI.prototype),QI);function tq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function nq(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?tq(Object(r),!0).forEach(function(a){L(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tq(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}const pU=window||document;function rq(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!pU)return;const r=vs._cspEventHandlerPointer;if(r&&t)return void console.error(r,t);const a=c=>{if(!(c&&c.blockedURI&&(vs.onSecurityPolicyViolation||vs.getListeners(Su.SECURITY_POLICY_VIOLATION).length>0)))return;const d=c.blockedURI;z("CSP_DETECTED_HOSTNAME_LIST").some(h=>ke(d).call(d,h))&&(vs.onSecurityPolicyViolation&&typeof vs.onSecurityPolicyViolation=="function"&&vs.onSecurityPolicyViolation(c),vs.getListeners(Su.SECURITY_POLICY_VIOLATION).length>0&&vs.safeEmit(Su.SECURITY_POLICY_VIOLATION,c))};r&&pU.removeEventListener("securitypolicyviolation",r),(t||e&&typeof e=="function"||vs.getListeners(Su.SECURITY_POLICY_VIOLATION).length>0)&&pU.addEventListener("securitypolicyviolation",a),vs._cspEventHandlerPointer=a}var Ehe=M,yhe=RL,sq=RegExp.prototype,bhe=function(e){return e===sq||Ehe(sq,e)?yhe(e):e.flags},Zi=u(bhe);function lE(e){let t=e.length;for(;--t>=0;)e[t]=0}const fU=256,iq=286,uw=30,hw=15,mU=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),ZI=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),xhe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),aq=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),jh=new Array(576);lE(jh);const pw=new Array(60);lE(pw);const fw=new Array(512);lE(fw);const mw=new Array(256);lE(mw);const gU=new Array(29);lE(gU);const eA=new Array(uw);function _U(e,t,r,a,c){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=a,this.max_length=c,this.has_stree=e&&e.length}let oq,cq,lq;function vU(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}lE(eA);const dq=e=>e<256?fw[e]:fw[256+(e>>>7)],gw=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},lc=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,gw(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},Au=(e,t,r)=>{lc(e,r[2*t],r[2*t+1])},uq=(e,t)=>{let r=0;do r|=1&e,e>>>=1,r<<=1;while(--t>0);return r>>>1},hq=(e,t,r)=>{const a=new Array(16);let c,d,h=0;for(c=1;c<=hw;c++)h=h+r[c-1]<<1,a[c]=h;for(d=0;d<=t;d++){let f=e[2*d+1];f!==0&&(e[2*d]=uq(a[f]++,f))}},pq=e=>{let t;for(t=0;t<iq;t++)e.dyn_ltree[2*t]=0;for(t=0;t<uw;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},fq=e=>{e.bi_valid>8?gw(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},mq=(e,t,r,a)=>{const c=2*t,d=2*r;return e[c]<e[d]||e[c]===e[d]&&a[t]<=a[r]},EU=(e,t,r)=>{const a=e.heap[r];let c=r<<1;for(;c<=e.heap_len&&(c<e.heap_len&&mq(t,e.heap[c+1],e.heap[c],e.depth)&&c++,!mq(t,a,e.heap[c],e.depth));)e.heap[r]=e.heap[c],r=c,c<<=1;e.heap[r]=a},gq=(e,t,r)=>{let a,c,d,h,f=0;if(e.sym_next!==0)do a=255&e.pending_buf[e.sym_buf+f++],a+=(255&e.pending_buf[e.sym_buf+f++])<<8,c=e.pending_buf[e.sym_buf+f++],a===0?Au(e,c,t):(d=mw[c],Au(e,d+fU+1,t),h=mU[d],h!==0&&(c-=gU[d],lc(e,c,h)),a--,d=dq(a),Au(e,d,r),h=ZI[d],h!==0&&(a-=eA[d],lc(e,a,h)));while(f<e.sym_next);Au(e,256,t)},yU=(e,t)=>{const r=t.dyn_tree,a=t.stat_desc.static_tree,c=t.stat_desc.has_stree,d=t.stat_desc.elems;let h,f,m,v=-1;for(e.heap_len=0,e.heap_max=573,h=0;h<d;h++)r[2*h]!==0?(e.heap[++e.heap_len]=v=h,e.depth[h]=0):r[2*h+1]=0;for(;e.heap_len<2;)m=e.heap[++e.heap_len]=v<2?++v:0,r[2*m]=1,e.depth[m]=0,e.opt_len--,c&&(e.static_len-=a[2*m+1]);for(t.max_code=v,h=e.heap_len>>1;h>=1;h--)EU(e,r,h);m=d;do h=e.heap[1],e.heap[1]=e.heap[e.heap_len--],EU(e,r,1),f=e.heap[1],e.heap[--e.heap_max]=h,e.heap[--e.heap_max]=f,r[2*m]=r[2*h]+r[2*f],e.depth[m]=(e.depth[h]>=e.depth[f]?e.depth[h]:e.depth[f])+1,r[2*h+1]=r[2*f+1]=m,e.heap[1]=m++,EU(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((E,w)=>{const S=w.dyn_tree,R=w.max_code,j=w.stat_desc.static_tree,D=w.stat_desc.has_stree,P=w.stat_desc.extra_bits,W=w.stat_desc.extra_base,Y=w.stat_desc.max_length;let ne,le,fe,ie,_e,Te,Ne=0;for(ie=0;ie<=hw;ie++)E.bl_count[ie]=0;for(S[2*E.heap[E.heap_max]+1]=0,ne=E.heap_max+1;ne<573;ne++)le=E.heap[ne],ie=S[2*S[2*le+1]+1]+1,ie>Y&&(ie=Y,Ne++),S[2*le+1]=ie,le>R||(E.bl_count[ie]++,_e=0,le>=W&&(_e=P[le-W]),Te=S[2*le],E.opt_len+=Te*(ie+_e),D&&(E.static_len+=Te*(j[2*le+1]+_e)));if(Ne!==0){do{for(ie=Y-1;E.bl_count[ie]===0;)ie--;E.bl_count[ie]--,E.bl_count[ie+1]+=2,E.bl_count[Y]--,Ne-=2}while(Ne>0);for(ie=Y;ie!==0;ie--)for(le=E.bl_count[ie];le!==0;)fe=E.heap[--ne],fe>R||(S[2*fe+1]!==ie&&(E.opt_len+=(ie-S[2*fe+1])*S[2*fe],S[2*fe+1]=ie),le--)}})(e,t),hq(r,v,e.bl_count)},_q=(e,t,r)=>{let a,c,d=-1,h=t[1],f=0,m=7,v=4;for(h===0&&(m=138,v=3),t[2*(r+1)+1]=65535,a=0;a<=r;a++)c=h,h=t[2*(a+1)+1],++f<m&&c===h||(f<v?e.bl_tree[2*c]+=f:c!==0?(c!==d&&e.bl_tree[2*c]++,e.bl_tree[32]++):f<=10?e.bl_tree[34]++:e.bl_tree[36]++,f=0,d=c,h===0?(m=138,v=3):c===h?(m=6,v=3):(m=7,v=4))},vq=(e,t,r)=>{let a,c,d=-1,h=t[1],f=0,m=7,v=4;for(h===0&&(m=138,v=3),a=0;a<=r;a++)if(c=h,h=t[2*(a+1)+1],!(++f<m&&c===h)){if(f<v)do Au(e,c,e.bl_tree);while(--f!=0);else c!==0?(c!==d&&(Au(e,c,e.bl_tree),f--),Au(e,16,e.bl_tree),lc(e,f-3,2)):f<=10?(Au(e,17,e.bl_tree),lc(e,f-3,3)):(Au(e,18,e.bl_tree),lc(e,f-11,7));f=0,d=c,h===0?(m=138,v=3):c===h?(m=6,v=3):(m=7,v=4)}};let Eq=!1;const yq=(e,t,r,a)=>{lc(e,0+(a?1:0),3),fq(e),gw(e,r),gw(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r};var whe=e=>{Eq||((()=>{let t,r,a,c,d;const h=new Array(16);for(a=0,c=0;c<28;c++)for(gU[c]=a,t=0;t<1<<mU[c];t++)mw[a++]=c;for(mw[a-1]=c,d=0,c=0;c<16;c++)for(eA[c]=d,t=0;t<1<<ZI[c];t++)fw[d++]=c;for(d>>=7;c<uw;c++)for(eA[c]=d<<7,t=0;t<1<<ZI[c]-7;t++)fw[256+d++]=c;for(r=0;r<=hw;r++)h[r]=0;for(t=0;t<=143;)jh[2*t+1]=8,t++,h[8]++;for(;t<=255;)jh[2*t+1]=9,t++,h[9]++;for(;t<=279;)jh[2*t+1]=7,t++,h[7]++;for(;t<=287;)jh[2*t+1]=8,t++,h[8]++;for(hq(jh,287,h),t=0;t<uw;t++)pw[2*t+1]=5,pw[2*t]=uq(t,5);oq=new _U(jh,mU,257,iq,hw),cq=new _U(pw,ZI,0,uw,hw),lq=new _U(new Array(0),xhe,0,19,7)})(),Eq=!0),e.l_desc=new vU(e.dyn_ltree,oq),e.d_desc=new vU(e.dyn_dtree,cq),e.bl_desc=new vU(e.bl_tree,lq),e.bi_buf=0,e.bi_valid=0,pq(e)},She=(e,t,r,a)=>{let c,d,h=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(f=>{let m,v=4093624447;for(m=0;m<=31;m++,v>>>=1)if(1&v&&f.dyn_ltree[2*m]!==0)return 0;if(f.dyn_ltree[18]!==0||f.dyn_ltree[20]!==0||f.dyn_ltree[26]!==0)return 1;for(m=32;m<fU;m++)if(f.dyn_ltree[2*m]!==0)return 1;return 0})(e)),yU(e,e.l_desc),yU(e,e.d_desc),h=(f=>{let m;for(_q(f,f.dyn_ltree,f.l_desc.max_code),_q(f,f.dyn_dtree,f.d_desc.max_code),yU(f,f.bl_desc),m=18;m>=3&&f.bl_tree[2*aq[m]+1]===0;m--);return f.opt_len+=3*(m+1)+5+5+4,m})(e),c=e.opt_len+3+7>>>3,d=e.static_len+3+7>>>3,d<=c&&(c=d)):c=d=r+5,r+4<=c&&t!==-1?yq(e,t,r,a):e.strategy===4||d===c?(lc(e,2+(a?1:0),3),gq(e,jh,pw)):(lc(e,4+(a?1:0),3),((f,m,v,E)=>{let w;for(lc(f,m-257,5),lc(f,v-1,5),lc(f,E-4,4),w=0;w<E;w++)lc(f,f.bl_tree[2*aq[w]+1],3);vq(f,f.dyn_ltree,m-1),vq(f,f.dyn_dtree,v-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,h+1),gq(e,e.dyn_ltree,e.dyn_dtree)),pq(e),a&&fq(e)},The=(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,t===0?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(mw[r]+fU+1)]++,e.dyn_dtree[2*dq(t)]++),e.sym_next===e.sym_end),Rhe=e=>{lc(e,2,3),Au(e,256,jh),(t=>{t.bi_valid===16?(gw(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},Che={_tr_init:whe,_tr_stored_block:yq,_tr_flush_block:She,_tr_tally:The,_tr_align:Rhe},_w=(e,t,r,a)=>{let c=65535&e|0,d=e>>>16&65535|0,h=0;for(;r!==0;){h=r>2e3?2e3:r,r-=h;do c=c+t[a++]|0,d=d+c|0;while(--h);c%=65521,d%=65521}return c|d<<16|0};const Nhe=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var a=0;a<8;a++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})());var Ea=(e,t,r,a)=>{const c=Nhe,d=a+r;e^=-1;for(let h=a;h<d;h++)e=e>>>8^c[255&(e^t[h])];return-1^e},qg={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},tA={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Ihe,_tr_stored_block:bU,_tr_flush_block:Ahe,_tr_tally:bf,_tr_align:khe}=Che,{Z_NO_FLUSH:xf,Z_PARTIAL_FLUSH:Ohe,Z_FULL_FLUSH:Dhe,Z_FINISH:jl,Z_BLOCK:bq,Z_OK:Fa,Z_STREAM_END:xq,Z_STREAM_ERROR:ku,Z_DATA_ERROR:Phe,Z_BUF_ERROR:xU,Z_DEFAULT_COMPRESSION:Lhe,Z_FILTERED:jhe,Z_HUFFMAN_ONLY:nA,Z_RLE:Mhe,Z_FIXED:Uhe,Z_DEFAULT_STRATEGY:Vhe,Z_UNKNOWN:Fhe,Z_DEFLATED:rA}=tA,wU=286,Bhe=30,zhe=19,Ghe=2*wU+1,Whe=15,Yg=258,Ou=262,dE=42,Xg=113,vw=666,$g=(e,t)=>(e.msg=qg[t],t),wq=e=>2*e-(e>4?9:0),wf=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Hhe=e=>{let t,r,a,c=e.w_size;t=e.hash_size,a=t;do r=e.head[--a],e.head[a]=r>=c?r-c:0;while(--t);t=c,a=t;do r=e.prev[--a],e.prev[a]=r>=c?r-c:0;while(--t)};let Sf=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask;const Mc=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),r!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,t.pending===0&&(t.pending_out=0))},Uc=(e,t)=>{Ahe(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Mc(e.strm)},Qr=(e,t)=>{e.pending_buf[e.pending++]=t},Ew=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},SU=(e,t,r,a)=>{let c=e.avail_in;return c>a&&(c=a),c===0?0:(e.avail_in-=c,t.set(e.input.subarray(e.next_in,e.next_in+c),r),e.state.wrap===1?e.adler=_w(e.adler,t,c,r):e.state.wrap===2&&(e.adler=Ea(e.adler,t,c,r)),e.next_in+=c,e.total_in+=c,c)},Sq=(e,t)=>{let r,a,c=e.max_chain_length,d=e.strstart,h=e.prev_length,f=e.nice_match;const m=e.strstart>e.w_size-Ou?e.strstart-(e.w_size-Ou):0,v=e.window,E=e.w_mask,w=e.prev,S=e.strstart+Yg;let R=v[d+h-1],j=v[d+h];e.prev_length>=e.good_match&&(c>>=2),f>e.lookahead&&(f=e.lookahead);do if(r=t,v[r+h]===j&&v[r+h-1]===R&&v[r]===v[d]&&v[++r]===v[d+1]){d+=2,r++;do;while(v[++d]===v[++r]&&v[++d]===v[++r]&&v[++d]===v[++r]&&v[++d]===v[++r]&&v[++d]===v[++r]&&v[++d]===v[++r]&&v[++d]===v[++r]&&v[++d]===v[++r]&&d<S);if(a=Yg-(S-d),d=S-Yg,a>h){if(e.match_start=t,h=a,a>=f)break;R=v[d+h-1],j=v[d+h]}}while((t=w[t&E])>m&&--c!=0);return h<=e.lookahead?h:e.lookahead},uE=e=>{const t=e.w_size;let r,a,c;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Ou)&&(e.window.set(e.window.subarray(t,t+t-a),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Hhe(e),a+=t),e.strm.avail_in===0)break;if(r=SU(e.strm,e.window,e.strstart+e.lookahead,a),e.lookahead+=r,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=Sf(e,e.ins_h,e.window[c+1]);e.insert&&(e.ins_h=Sf(e,e.ins_h,e.window[c+3-1]),e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Ou&&e.strm.avail_in!==0)},Tq=(e,t)=>{let r,a,c,d=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,h=0,f=e.strm.avail_in;do{if(r=65535,c=e.bi_valid+42>>3,e.strm.avail_out<c||(c=e.strm.avail_out-c,a=e.strstart-e.block_start,r>a+e.strm.avail_in&&(r=a+e.strm.avail_in),r>c&&(r=c),r<d&&(r===0&&t!==jl||t===xf||r!==a+e.strm.avail_in)))break;h=t===jl&&r===a+e.strm.avail_in?1:0,bU(e,0,0,h),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,Mc(e.strm),a&&(a>r&&(a=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+a),e.strm.next_out),e.strm.next_out+=a,e.strm.avail_out-=a,e.strm.total_out+=a,e.block_start+=a,r-=a),r&&(SU(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(h===0);return f-=e.strm.avail_in,f&&(f>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=f&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-f,e.strm.next_in),e.strstart),e.strstart+=f,e.insert+=f>e.w_size-e.insert?e.w_size-e.insert:f),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),h?4:t!==xf&&t!==jl&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(c=e.window_size-e.strstart,e.strm.avail_in>c&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,c+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),c>e.strm.avail_in&&(c=e.strm.avail_in),c&&(SU(e.strm,e.window,e.strstart,c),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.high_water<e.strstart&&(e.high_water=e.strstart),c=e.bi_valid+42>>3,c=e.pending_buf_size-c>65535?65535:e.pending_buf_size-c,d=c>e.w_size?e.w_size:c,a=e.strstart-e.block_start,(a>=d||(a||t===jl)&&t!==xf&&e.strm.avail_in===0&&a<=c)&&(r=a>c?c:a,h=t===jl&&e.strm.avail_in===0&&r===a?1:0,bU(e,e.block_start,r,h),e.block_start+=r,Mc(e.strm)),h?3:1)},TU=(e,t)=>{let r,a;for(;;){if(e.lookahead<Ou){if(uE(e),e.lookahead<Ou&&t===xf)return 1;if(e.lookahead===0)break}if(r=0,e.lookahead>=3&&(e.ins_h=Sf(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-Ou&&(e.match_length=Sq(e,r)),e.match_length>=3)if(a=bf(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Sf(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Sf(e,e.ins_h,e.window[e.strstart+1]);else a=bf(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(a&&(Uc(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===jl?(Uc(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Uc(e,!1),e.strm.avail_out===0)?1:2},hE=(e,t)=>{let r,a,c;for(;;){if(e.lookahead<Ou){if(uE(e),e.lookahead<Ou&&t===xf)return 1;if(e.lookahead===0)break}if(r=0,e.lookahead>=3&&(e.ins_h=Sf(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-Ou&&(e.match_length=Sq(e,r),e.match_length<=5&&(e.strategy===jhe||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){c=e.strstart+e.lookahead-3,a=bf(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=c&&(e.ins_h=Sf(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,a&&(Uc(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(a=bf(e,0,e.window[e.strstart-1]),a&&Uc(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(a=bf(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===jl?(Uc(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Uc(e,!1),e.strm.avail_out===0)?1:2};function Du(e,t,r,a,c){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=a,this.func=c}const yw=[new Du(0,0,0,0,Tq),new Du(4,4,8,4,TU),new Du(4,5,16,8,TU),new Du(4,6,32,32,TU),new Du(4,4,16,16,hE),new Du(8,16,32,32,hE),new Du(8,16,128,128,hE),new Du(8,32,128,256,hE),new Du(32,128,258,1024,hE),new Du(32,258,258,4096,hE)];function Khe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=rA,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Ghe),this.dyn_dtree=new Uint16Array(2*(2*Bhe+1)),this.bl_tree=new Uint16Array(2*(2*zhe+1)),wf(this.dyn_ltree),wf(this.dyn_dtree),wf(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Whe+1),this.heap=new Uint16Array(2*wU+1),wf(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*wU+1),wf(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const bw=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==dE&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Xg&&t.status!==vw?1:0},Rq=e=>{if(bw(e))return $g(e,ku);e.total_in=e.total_out=0,e.data_type=Fhe;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?dE:Xg,e.adler=t.wrap===2?0:1,t.last_flush=-2,Ihe(t),Fa},Cq=e=>{const t=Rq(e);return t===Fa&&(r=>{r.window_size=2*r.w_size,wf(r.head),r.max_lazy_match=yw[r.level].max_lazy,r.good_match=yw[r.level].good_length,r.nice_match=yw[r.level].nice_length,r.max_chain_length=yw[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0})(e.state),t},Nq=(e,t,r,a,c,d)=>{if(!e)return ku;let h=1;if(t===Lhe&&(t=6),a<0?(h=0,a=-a):a>15&&(h=2,a-=16),c<1||c>9||r!==rA||a<8||a>15||t<0||t>9||d<0||d>Uhe||a===8&&h!==1)return $g(e,ku);a===8&&(a=9);const f=new Khe;return e.state=f,f.strm=e,f.status=dE,f.wrap=h,f.gzhead=null,f.w_bits=a,f.w_size=1<<f.w_bits,f.w_mask=f.w_size-1,f.hash_bits=c+7,f.hash_size=1<<f.hash_bits,f.hash_mask=f.hash_size-1,f.hash_shift=~~((f.hash_bits+3-1)/3),f.window=new Uint8Array(2*f.w_size),f.head=new Uint16Array(f.hash_size),f.prev=new Uint16Array(f.w_size),f.lit_bufsize=1<<c+6,f.pending_buf_size=4*f.lit_bufsize,f.pending_buf=new Uint8Array(f.pending_buf_size),f.sym_buf=f.lit_bufsize,f.sym_end=3*(f.lit_bufsize-1),f.level=t,f.strategy=d,f.method=r,Cq(e)};var qhe=(e,t)=>{if(bw(e)||t>bq||t<0)return e?$g(e,ku):ku;const r=e.state;if(!e.output||e.avail_in!==0&&!e.input||r.status===vw&&t!==jl)return $g(e,e.avail_out===0?xU:ku);const a=r.last_flush;if(r.last_flush=t,r.pending!==0){if(Mc(e),e.avail_out===0)return r.last_flush=-1,Fa}else if(e.avail_in===0&&wq(t)<=wq(a)&&t!==jl)return $g(e,xU);if(r.status===vw&&e.avail_in!==0)return $g(e,xU);if(r.status===dE&&r.wrap===0&&(r.status=Xg),r.status===dE){let c=rA+(r.w_bits-8<<4)<<8,d=-1;if(d=r.strategy>=nA||r.level<2?0:r.level<6?1:r.level===6?2:3,c|=d<<6,r.strstart!==0&&(c|=32),c+=31-c%31,Ew(r,c),r.strstart!==0&&(Ew(r,e.adler>>>16),Ew(r,65535&e.adler)),e.adler=1,r.status=Xg,Mc(e),r.pending!==0)return r.last_flush=-1,Fa}if(r.status===57){if(e.adler=0,Qr(r,31),Qr(r,139),Qr(r,8),r.gzhead)Qr(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),Qr(r,255&r.gzhead.time),Qr(r,r.gzhead.time>>8&255),Qr(r,r.gzhead.time>>16&255),Qr(r,r.gzhead.time>>24&255),Qr(r,r.level===9?2:r.strategy>=nA||r.level<2?4:0),Qr(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(Qr(r,255&r.gzhead.extra.length),Qr(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=Ea(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(Qr(r,0),Qr(r,0),Qr(r,0),Qr(r,0),Qr(r,0),Qr(r,r.level===9?2:r.strategy>=nA||r.level<2?4:0),Qr(r,3),r.status=Xg,Mc(e),r.pending!==0)return r.last_flush=-1,Fa}if(r.status===69){if(r.gzhead.extra){let c=r.pending,d=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+d>r.pending_buf_size;){let f=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+f),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>c&&(e.adler=Ea(e.adler,r.pending_buf,r.pending-c,c)),r.gzindex+=f,Mc(e),r.pending!==0)return r.last_flush=-1,Fa;c=0,d-=f}let h=new Uint8Array(r.gzhead.extra);r.pending_buf.set(h.subarray(r.gzindex,r.gzindex+d),r.pending),r.pending+=d,r.gzhead.hcrc&&r.pending>c&&(e.adler=Ea(e.adler,r.pending_buf,r.pending-c,c)),r.gzindex=0}r.status=73}if(r.status===73){if(r.gzhead.name){let c,d=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>d&&(e.adler=Ea(e.adler,r.pending_buf,r.pending-d,d)),Mc(e),r.pending!==0)return r.last_flush=-1,Fa;d=0}c=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,Qr(r,c)}while(c!==0);r.gzhead.hcrc&&r.pending>d&&(e.adler=Ea(e.adler,r.pending_buf,r.pending-d,d)),r.gzindex=0}r.status=91}if(r.status===91){if(r.gzhead.comment){let c,d=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>d&&(e.adler=Ea(e.adler,r.pending_buf,r.pending-d,d)),Mc(e),r.pending!==0)return r.last_flush=-1,Fa;d=0}c=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,Qr(r,c)}while(c!==0);r.gzhead.hcrc&&r.pending>d&&(e.adler=Ea(e.adler,r.pending_buf,r.pending-d,d))}r.status=103}if(r.status===103){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(Mc(e),r.pending!==0))return r.last_flush=-1,Fa;Qr(r,255&e.adler),Qr(r,e.adler>>8&255),e.adler=0}if(r.status=Xg,Mc(e),r.pending!==0)return r.last_flush=-1,Fa}if(e.avail_in!==0||r.lookahead!==0||t!==xf&&r.status!==vw){let c=r.level===0?Tq(r,t):r.strategy===nA?((d,h)=>{let f;for(;;){if(d.lookahead===0&&(uE(d),d.lookahead===0)){if(h===xf)return 1;break}if(d.match_length=0,f=bf(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++,f&&(Uc(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===jl?(Uc(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(Uc(d,!1),d.strm.avail_out===0)?1:2})(r,t):r.strategy===Mhe?((d,h)=>{let f,m,v,E;const w=d.window;for(;;){if(d.lookahead<=Yg){if(uE(d),d.lookahead<=Yg&&h===xf)return 1;if(d.lookahead===0)break}if(d.match_length=0,d.lookahead>=3&&d.strstart>0&&(v=d.strstart-1,m=w[v],m===w[++v]&&m===w[++v]&&m===w[++v])){E=d.strstart+Yg;do;while(m===w[++v]&&m===w[++v]&&m===w[++v]&&m===w[++v]&&m===w[++v]&&m===w[++v]&&m===w[++v]&&m===w[++v]&&v<E);d.match_length=Yg-(E-v),d.match_length>d.lookahead&&(d.match_length=d.lookahead)}if(d.match_length>=3?(f=bf(d,1,d.match_length-3),d.lookahead-=d.match_length,d.strstart+=d.match_length,d.match_length=0):(f=bf(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++),f&&(Uc(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===jl?(Uc(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(Uc(d,!1),d.strm.avail_out===0)?1:2})(r,t):yw[r.level].func(r,t);if(c!==3&&c!==4||(r.status=vw),c===1||c===3)return e.avail_out===0&&(r.last_flush=-1),Fa;if(c===2&&(t===Ohe?khe(r):t!==bq&&(bU(r,0,0,!1),t===Dhe&&(wf(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),Mc(e),e.avail_out===0))return r.last_flush=-1,Fa}return t!==jl?Fa:r.wrap<=0?xq:(r.wrap===2?(Qr(r,255&e.adler),Qr(r,e.adler>>8&255),Qr(r,e.adler>>16&255),Qr(r,e.adler>>24&255),Qr(r,255&e.total_in),Qr(r,e.total_in>>8&255),Qr(r,e.total_in>>16&255),Qr(r,e.total_in>>24&255)):(Ew(r,e.adler>>>16),Ew(r,65535&e.adler)),Mc(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?Fa:xq)},Yhe=(e,t)=>{let r=t.length;if(bw(e))return ku;const a=e.state,c=a.wrap;if(c===2||c===1&&a.status!==dE||a.lookahead)return ku;if(c===1&&(e.adler=_w(e.adler,t,r,0)),a.wrap=0,r>=a.w_size){c===0&&(wf(a.head),a.strstart=0,a.block_start=0,a.insert=0);let m=new Uint8Array(a.w_size);m.set(t.subarray(r-a.w_size,r),0),t=m,r=a.w_size}const d=e.avail_in,h=e.next_in,f=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,uE(a);a.lookahead>=3;){let m=a.strstart,v=a.lookahead-2;do a.ins_h=Sf(a,a.ins_h,a.window[m+3-1]),a.prev[m&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=m,m++;while(--v);a.strstart=m,a.lookahead=2,uE(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,e.next_in=h,e.input=f,e.avail_in=d,a.wrap=c,Fa},xw={deflateInit:(e,t)=>Nq(e,t,rA,15,8,Vhe),deflateInit2:Nq,deflateReset:Cq,deflateResetKeep:Rq,deflateSetHeader:(e,t)=>bw(e)||e.state.wrap!==2?ku:(e.state.gzhead=t,Fa),deflate:qhe,deflateEnd:e=>{if(bw(e))return ku;const t=e.state.status;return e.state=null,t===Xg?$g(e,Phe):Fa},deflateSetDictionary:Yhe,deflateInfo:"pako deflate (from Nodeca project)"};const Xhe=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var sA={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(const a in r)Xhe(r,a)&&(e[a]=r[a])}}return e},flattenChunks:e=>{let t=0;for(let a=0,c=e.length;a<c;a++)t+=e[a].length;const r=new Uint8Array(t);for(let a=0,c=0,d=e.length;a<d;a++){let h=e[a];r.set(h,c),c+=h.length}return r}};let Iq=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Iq=!1}const ww=new Uint8Array(256);for(let e=0;e<256;e++)ww[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;ww[254]=ww[254]=1;var Sw={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,r,a,c,d,h=e.length,f=0;for(c=0;c<h;c++)r=e.charCodeAt(c),(64512&r)==55296&&c+1<h&&(a=e.charCodeAt(c+1),(64512&a)==56320&&(r=65536+(r-55296<<10)+(a-56320),c++)),f+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(f),d=0,c=0;d<f;c++)r=e.charCodeAt(c),(64512&r)==55296&&c+1<h&&(a=e.charCodeAt(c+1),(64512&a)==56320&&(r=65536+(r-55296<<10)+(a-56320),c++)),r<128?t[d++]=r:r<2048?(t[d++]=192|r>>>6,t[d++]=128|63&r):r<65536?(t[d++]=224|r>>>12,t[d++]=128|r>>>6&63,t[d++]=128|63&r):(t[d++]=240|r>>>18,t[d++]=128|r>>>12&63,t[d++]=128|r>>>6&63,t[d++]=128|63&r);return t},buf2string:(e,t)=>{const r=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let a,c;const d=new Array(2*r);for(c=0,a=0;a<r;){let h=e[a++];if(h<128){d[c++]=h;continue}let f=ww[h];if(f>4)d[c++]=65533,a+=f-1;else{for(h&=f===2?31:f===3?15:7;f>1&&a<r;)h=h<<6|63&e[a++],f--;f>1?d[c++]=65533:h<65536?d[c++]=h:(h-=65536,d[c++]=55296|h>>10&1023,d[c++]=56320|1023&h)}}return((h,f)=>{if(f<65534&&h.subarray&&Iq)return String.fromCharCode.apply(null,h.length===f?h:h.subarray(0,f));let m="";for(let v=0;v<f;v++)m+=String.fromCharCode(h[v]);return m})(d,c)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&(192&e[r])==128;)r--;return r<0||r===0?t:r+ww[e[r]]>t?r:t}},Aq=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const kq=Object.prototype.toString,{Z_NO_FLUSH:$he,Z_SYNC_FLUSH:Jhe,Z_FULL_FLUSH:Qhe,Z_FINISH:Zhe,Z_OK:iA,Z_STREAM_END:epe,Z_DEFAULT_COMPRESSION:tpe,Z_DEFAULT_STRATEGY:npe,Z_DEFLATED:rpe}=tA;function aA(e){this.options=sA.assign({level:tpe,method:rpe,chunkSize:16384,windowBits:15,memLevel:8,strategy:npe},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Aq,this.strm.avail_out=0;let r=xw.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==iA)throw new Error(qg[r]);if(t.header&&xw.deflateSetHeader(this.strm,t.header),t.dictionary){let a;if(a=typeof t.dictionary=="string"?Sw.string2buf(t.dictionary):kq.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,r=xw.deflateSetDictionary(this.strm,a),r!==iA)throw new Error(qg[r]);this._dict_set=!0}}function Oq(e,t){const r=new aA(t);if(r.push(e,!0),r.err)throw r.msg||qg[r.err];return r.result}aA.prototype.push=function(e,t){const r=this.strm,a=this.options.chunkSize;let c,d;if(this.ended)return!1;for(d=t===~~t?t:t===!0?Zhe:$he,typeof e=="string"?r.input=Sw.string2buf(e):kq.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(r.avail_out===0&&(r.output=new Uint8Array(a),r.next_out=0,r.avail_out=a),(d===Jhe||d===Qhe)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(c=xw.deflate(r,d),c===epe)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),c=xw.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===iA;if(r.avail_out!==0){if(d>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(r.avail_in===0)break}else this.onData(r.output)}return!0},aA.prototype.onData=function(e){this.chunks.push(e)},aA.prototype.onEnd=function(e){e===iA&&(this.result=sA.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var spe={deflate:Oq,deflateRaw:function(e,t){return(t=t||{}).raw=!0,Oq(e,t)}};const oA=16209;var ipe=function(e,t){let r,a,c,d,h,f,m,v,E,w,S,R,j,D,P,W,Y,ne,le,fe,ie,_e,Te,Ne;const Ke=e.state;r=e.next_in,Te=e.input,a=r+(e.avail_in-5),c=e.next_out,Ne=e.output,d=c-(t-e.avail_out),h=c+(e.avail_out-257),f=Ke.dmax,m=Ke.wsize,v=Ke.whave,E=Ke.wnext,w=Ke.window,S=Ke.hold,R=Ke.bits,j=Ke.lencode,D=Ke.distcode,P=(1<<Ke.lenbits)-1,W=(1<<Ke.distbits)-1;e:do{R<15&&(S+=Te[r++]<<R,R+=8,S+=Te[r++]<<R,R+=8),Y=j[S&P];t:for(;;){if(ne=Y>>>24,S>>>=ne,R-=ne,ne=Y>>>16&255,ne===0)Ne[c++]=65535&Y;else{if(!(16&ne)){if(!(64&ne)){Y=j[(65535&Y)+(S&(1<<ne)-1)];continue t}if(32&ne){Ke.mode=16191;break e}e.msg="invalid literal/length code",Ke.mode=oA;break e}le=65535&Y,ne&=15,ne&&(R<ne&&(S+=Te[r++]<<R,R+=8),le+=S&(1<<ne)-1,S>>>=ne,R-=ne),R<15&&(S+=Te[r++]<<R,R+=8,S+=Te[r++]<<R,R+=8),Y=D[S&W];n:for(;;){if(ne=Y>>>24,S>>>=ne,R-=ne,ne=Y>>>16&255,!(16&ne)){if(!(64&ne)){Y=D[(65535&Y)+(S&(1<<ne)-1)];continue n}e.msg="invalid distance code",Ke.mode=oA;break e}if(fe=65535&Y,ne&=15,R<ne&&(S+=Te[r++]<<R,R+=8,R<ne&&(S+=Te[r++]<<R,R+=8)),fe+=S&(1<<ne)-1,fe>f){e.msg="invalid distance too far back",Ke.mode=oA;break e}if(S>>>=ne,R-=ne,ne=c-d,fe>ne){if(ne=fe-ne,ne>v&&Ke.sane){e.msg="invalid distance too far back",Ke.mode=oA;break e}if(ie=0,_e=w,E===0){if(ie+=m-ne,ne<le){le-=ne;do Ne[c++]=w[ie++];while(--ne);ie=c-fe,_e=Ne}}else if(E<ne){if(ie+=m+E-ne,ne-=E,ne<le){le-=ne;do Ne[c++]=w[ie++];while(--ne);if(ie=0,E<le){ne=E,le-=ne;do Ne[c++]=w[ie++];while(--ne);ie=c-fe,_e=Ne}}}else if(ie+=E-ne,ne<le){le-=ne;do Ne[c++]=w[ie++];while(--ne);ie=c-fe,_e=Ne}for(;le>2;)Ne[c++]=_e[ie++],Ne[c++]=_e[ie++],Ne[c++]=_e[ie++],le-=3;le&&(Ne[c++]=_e[ie++],le>1&&(Ne[c++]=_e[ie++]))}else{ie=c-fe;do Ne[c++]=Ne[ie++],Ne[c++]=Ne[ie++],Ne[c++]=Ne[ie++],le-=3;while(le>2);le&&(Ne[c++]=Ne[ie++],le>1&&(Ne[c++]=Ne[ie++]))}break}}break}}while(r<a&&c<h);le=R>>3,r-=le,R-=le<<3,S&=(1<<R)-1,e.next_in=r,e.next_out=c,e.avail_in=r<a?a-r+5:5-(r-a),e.avail_out=c<h?h-c+257:257-(c-h),Ke.hold=S,Ke.bits=R};const cA=15,ape=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ope=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),cpe=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),lpe=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Tw=(e,t,r,a,c,d,h,f)=>{const m=f.bits;let v,E,w,S,R,j,D=0,P=0,W=0,Y=0,ne=0,le=0,fe=0,ie=0,_e=0,Te=0,Ne=null;const Ke=new Uint16Array(16),St=new Uint16Array(16);let Et,Vt,Ot,Cn=null;for(D=0;D<=cA;D++)Ke[D]=0;for(P=0;P<a;P++)Ke[t[r+P]]++;for(ne=m,Y=cA;Y>=1&&Ke[Y]===0;Y--);if(ne>Y&&(ne=Y),Y===0)return c[d++]=20971520,c[d++]=20971520,f.bits=1,0;for(W=1;W<Y&&Ke[W]===0;W++);for(ne<W&&(ne=W),ie=1,D=1;D<=cA;D++)if(ie<<=1,ie-=Ke[D],ie<0)return-1;if(ie>0&&(e===0||Y!==1))return-1;for(St[1]=0,D=1;D<cA;D++)St[D+1]=St[D]+Ke[D];for(P=0;P<a;P++)t[r+P]!==0&&(h[St[t[r+P]]++]=P);if(e===0?(Ne=Cn=h,j=20):e===1?(Ne=ape,Cn=ope,j=257):(Ne=cpe,Cn=lpe,j=0),Te=0,P=0,D=W,R=d,le=ne,fe=0,w=-1,_e=1<<ne,S=_e-1,e===1&&_e>852||e===2&&_e>592)return 1;for(;;){Et=D-fe,h[P]+1<j?(Vt=0,Ot=h[P]):h[P]>=j?(Vt=Cn[h[P]-j],Ot=Ne[h[P]-j]):(Vt=96,Ot=0),v=1<<D-fe,E=1<<le,W=E;do E-=v,c[R+(Te>>fe)+E]=Et<<24|Vt<<16|Ot|0;while(E!==0);for(v=1<<D-1;Te&v;)v>>=1;if(v!==0?(Te&=v-1,Te+=v):Te=0,P++,--Ke[D]==0){if(D===Y)break;D=t[r+h[P]]}if(D>ne&&(Te&S)!==w){for(fe===0&&(fe=ne),R+=W,le=D-fe,ie=1<<le;le+fe<Y&&(ie-=Ke[le+fe],!(ie<=0));)le++,ie<<=1;if(_e+=1<<le,e===1&&_e>852||e===2&&_e>592)return 1;w=Te&S,c[w]=ne<<24|le<<16|R-d|0}}return Te!==0&&(c[R+Te]=D-fe<<24|64<<16|0),f.bits=ne,0};const{Z_FINISH:Dq,Z_BLOCK:dpe,Z_TREES:lA,Z_OK:Jg,Z_STREAM_END:upe,Z_NEED_DICT:hpe,Z_STREAM_ERROR:Ml,Z_DATA_ERROR:Pq,Z_MEM_ERROR:Lq,Z_BUF_ERROR:ppe,Z_DEFLATED:jq}=tA,dA=16180,uA=16190,Mh=16191,RU=16192,CU=16194,hA=16199,pA=16200,NU=16206,$s=16209,Mq=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function fpe(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Qg=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<dA||t.mode>16211?1:0},Uq=e=>{if(Qg(e))return Ml;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=dA,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Jg},Vq=e=>{if(Qg(e))return Ml;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Uq(e)},Fq=(e,t)=>{let r;if(Qg(e))return Ml;const a=e.state;return t<0?(r=0,t=-t):(r=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Ml:(a.window!==null&&a.wbits!==t&&(a.window=null),a.wrap=r,a.wbits=t,Vq(e))},Bq=(e,t)=>{if(!e)return Ml;const r=new fpe;e.state=r,r.strm=e,r.window=null,r.mode=dA;const a=Fq(e,t);return a!==Jg&&(e.state=null),a};let IU,AU,zq=!0;const mpe=e=>{if(zq){IU=new Int32Array(512),AU=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Tw(1,e.lens,0,288,IU,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Tw(2,e.lens,0,32,AU,0,e.work,{bits:5}),zq=!1}e.lencode=IU,e.lenbits=9,e.distcode=AU,e.distbits=5},Gq=(e,t,r,a)=>{let c;const d=e.state;return d.window===null&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),a>=d.wsize?(d.window.set(t.subarray(r-d.wsize,r),0),d.wnext=0,d.whave=d.wsize):(c=d.wsize-d.wnext,c>a&&(c=a),d.window.set(t.subarray(r-a,r-a+c),d.wnext),(a-=c)?(d.window.set(t.subarray(r-a,r),0),d.wnext=a,d.whave=d.wsize):(d.wnext+=c,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=c))),0};var gpe=(e,t)=>{let r,a,c,d,h,f,m,v,E,w,S,R,j,D,P,W,Y,ne,le,fe,ie,_e,Te=0;const Ne=new Uint8Array(4);let Ke,St;const Et=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Qg(e)||!e.output||!e.input&&e.avail_in!==0)return Ml;r=e.state,r.mode===Mh&&(r.mode=RU),h=e.next_out,c=e.output,m=e.avail_out,d=e.next_in,a=e.input,f=e.avail_in,v=r.hold,E=r.bits,w=f,S=m,_e=Jg;e:for(;;)switch(r.mode){case dA:if(r.wrap===0){r.mode=RU;break}for(;E<16;){if(f===0)break e;f--,v+=a[d++]<<E,E+=8}if(2&r.wrap&&v===35615){r.wbits===0&&(r.wbits=15),r.check=0,Ne[0]=255&v,Ne[1]=v>>>8&255,r.check=Ea(r.check,Ne,2,0),v=0,E=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&v)<<8)+(v>>8))%31){e.msg="incorrect header check",r.mode=$s;break}if((15&v)!==jq){e.msg="unknown compression method",r.mode=$s;break}if(v>>>=4,E-=4,ie=8+(15&v),r.wbits===0&&(r.wbits=ie),ie>15||ie>r.wbits){e.msg="invalid window size",r.mode=$s;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=512&v?16189:Mh,v=0,E=0;break;case 16181:for(;E<16;){if(f===0)break e;f--,v+=a[d++]<<E,E+=8}if(r.flags=v,(255&Zi(r))!==jq){e.msg="unknown compression method",r.mode=$s;break}if(57344&Zi(r)){e.msg="unknown header flags set",r.mode=$s;break}r.head&&(r.head.text=v>>8&1),512&Zi(r)&&4&r.wrap&&(Ne[0]=255&v,Ne[1]=v>>>8&255,r.check=Ea(r.check,Ne,2,0)),v=0,E=0,r.mode=16182;case 16182:for(;E<32;){if(f===0)break e;f--,v+=a[d++]<<E,E+=8}r.head&&(r.head.time=v),512&Zi(r)&&4&r.wrap&&(Ne[0]=255&v,Ne[1]=v>>>8&255,Ne[2]=v>>>16&255,Ne[3]=v>>>24&255,r.check=Ea(r.check,Ne,4,0)),v=0,E=0,r.mode=16183;case 16183:for(;E<16;){if(f===0)break e;f--,v+=a[d++]<<E,E+=8}r.head&&(r.head.xflags=255&v,r.head.os=v>>8),512&Zi(r)&&4&r.wrap&&(Ne[0]=255&v,Ne[1]=v>>>8&255,r.check=Ea(r.check,Ne,2,0)),v=0,E=0,r.mode=16184;case 16184:if(1024&Zi(r)){for(;E<16;){if(f===0)break e;f--,v+=a[d++]<<E,E+=8}r.length=v,r.head&&(r.head.extra_len=v),512&Zi(r)&&4&r.wrap&&(Ne[0]=255&v,Ne[1]=v>>>8&255,r.check=Ea(r.check,Ne,2,0)),v=0,E=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&Zi(r)&&(R=r.length,R>f&&(R=f),R&&(r.head&&(ie=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(a.subarray(d,d+R),ie)),512&Zi(r)&&4&r.wrap&&(r.check=Ea(r.check,a,R,d)),f-=R,d+=R,r.length-=R),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&Zi(r)){if(f===0)break e;R=0;do ie=a[d+R++],r.head&&ie&&r.length<65536&&(r.head.name+=String.fromCharCode(ie));while(ie&&R<f);if(512&Zi(r)&&4&r.wrap&&(r.check=Ea(r.check,a,R,d)),f-=R,d+=R,ie)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&Zi(r)){if(f===0)break e;R=0;do ie=a[d+R++],r.head&&ie&&r.length<65536&&(r.head.comment+=String.fromCharCode(ie));while(ie&&R<f);if(512&Zi(r)&&4&r.wrap&&(r.check=Ea(r.check,a,R,d)),f-=R,d+=R,ie)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&Zi(r)){for(;E<16;){if(f===0)break e;f--,v+=a[d++]<<E,E+=8}if(4&r.wrap&&v!==(65535&r.check)){e.msg="header crc mismatch",r.mode=$s;break}v=0,E=0}r.head&&(r.head.hcrc=Zi(r)>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=Mh;break;case 16189:for(;E<32;){if(f===0)break e;f--,v+=a[d++]<<E,E+=8}e.adler=r.check=Mq(v),v=0,E=0,r.mode=uA;case uA:if(r.havedict===0)return e.next_out=h,e.avail_out=m,e.next_in=d,e.avail_in=f,r.hold=v,r.bits=E,hpe;e.adler=r.check=1,r.mode=Mh;case Mh:if(t===dpe||t===lA)break e;case RU:if(r.last){v>>>=7&E,E-=7&E,r.mode=NU;break}for(;E<3;){if(f===0)break e;f--,v+=a[d++]<<E,E+=8}switch(r.last=1&v,v>>>=1,E-=1,3&v){case 0:r.mode=16193;break;case 1:if(mpe(r),r.mode=hA,t===lA){v>>>=2,E-=2;break e}break;case 2:r.mode=16196;break;case 3:e.msg="invalid block type",r.mode=$s}v>>>=2,E-=2;break;case 16193:for(v>>>=7&E,E-=7&E;E<32;){if(f===0)break e;f--,v+=a[d++]<<E,E+=8}if((65535&v)!=(v>>>16^65535)){e.msg="invalid stored block lengths",r.mode=$s;break}if(r.length=65535&v,v=0,E=0,r.mode=CU,t===lA)break e;case CU:r.mode=16195;case 16195:if(R=r.length,R){if(R>f&&(R=f),R>m&&(R=m),R===0)break e;c.set(a.subarray(d,d+R),h),f-=R,d+=R,m-=R,h+=R,r.length-=R;break}r.mode=Mh;break;case 16196:for(;E<14;){if(f===0)break e;f--,v+=a[d++]<<E,E+=8}if(r.nlen=257+(31&v),v>>>=5,E-=5,r.ndist=1+(31&v),v>>>=5,E-=5,r.ncode=4+(15&v),v>>>=4,E-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=$s;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;E<3;){if(f===0)break e;f--,v+=a[d++]<<E,E+=8}r.lens[Et[r.have++]]=7&v,v>>>=3,E-=3}for(;r.have<19;)r.lens[Et[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,Ke={bits:r.lenbits},_e=Tw(0,r.lens,0,19,r.lencode,0,r.work,Ke),r.lenbits=Ke.bits,_e){e.msg="invalid code lengths set",r.mode=$s;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;Te=r.lencode[v&(1<<r.lenbits)-1],P=Te>>>24,W=Te>>>16&255,Y=65535&Te,!(P<=E);){if(f===0)break e;f--,v+=a[d++]<<E,E+=8}if(Y<16)v>>>=P,E-=P,r.lens[r.have++]=Y;else{if(Y===16){for(St=P+2;E<St;){if(f===0)break e;f--,v+=a[d++]<<E,E+=8}if(v>>>=P,E-=P,r.have===0){e.msg="invalid bit length repeat",r.mode=$s;break}ie=r.lens[r.have-1],R=3+(3&v),v>>>=2,E-=2}else if(Y===17){for(St=P+3;E<St;){if(f===0)break e;f--,v+=a[d++]<<E,E+=8}v>>>=P,E-=P,ie=0,R=3+(7&v),v>>>=3,E-=3}else{for(St=P+7;E<St;){if(f===0)break e;f--,v+=a[d++]<<E,E+=8}v>>>=P,E-=P,ie=0,R=11+(127&v),v>>>=7,E-=7}if(r.have+R>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=$s;break}for(;R--;)r.lens[r.have++]=ie}}if(r.mode===$s)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=$s;break}if(r.lenbits=9,Ke={bits:r.lenbits},_e=Tw(1,r.lens,0,r.nlen,r.lencode,0,r.work,Ke),r.lenbits=Ke.bits,_e){e.msg="invalid literal/lengths set",r.mode=$s;break}if(r.distbits=6,r.distcode=r.distdyn,Ke={bits:r.distbits},_e=Tw(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,Ke),r.distbits=Ke.bits,_e){e.msg="invalid distances set",r.mode=$s;break}if(r.mode=hA,t===lA)break e;case hA:r.mode=pA;case pA:if(f>=6&&m>=258){e.next_out=h,e.avail_out=m,e.next_in=d,e.avail_in=f,r.hold=v,r.bits=E,ipe(e,S),h=e.next_out,c=e.output,m=e.avail_out,d=e.next_in,a=e.input,f=e.avail_in,v=r.hold,E=r.bits,r.mode===Mh&&(r.back=-1);break}for(r.back=0;Te=r.lencode[v&(1<<r.lenbits)-1],P=Te>>>24,W=Te>>>16&255,Y=65535&Te,!(P<=E);){if(f===0)break e;f--,v+=a[d++]<<E,E+=8}if(W&&!(240&W)){for(ne=P,le=W,fe=Y;Te=r.lencode[fe+((v&(1<<ne+le)-1)>>ne)],P=Te>>>24,W=Te>>>16&255,Y=65535&Te,!(ne+P<=E);){if(f===0)break e;f--,v+=a[d++]<<E,E+=8}v>>>=ne,E-=ne,r.back+=ne}if(v>>>=P,E-=P,r.back+=P,r.length=Y,W===0){r.mode=16205;break}if(32&W){r.back=-1,r.mode=Mh;break}if(64&W){e.msg="invalid literal/length code",r.mode=$s;break}r.extra=15&W,r.mode=16201;case 16201:if(r.extra){for(St=r.extra;E<St;){if(f===0)break e;f--,v+=a[d++]<<E,E+=8}r.length+=v&(1<<r.extra)-1,v>>>=r.extra,E-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;Te=r.distcode[v&(1<<r.distbits)-1],P=Te>>>24,W=Te>>>16&255,Y=65535&Te,!(P<=E);){if(f===0)break e;f--,v+=a[d++]<<E,E+=8}if(!(240&W)){for(ne=P,le=W,fe=Y;Te=r.distcode[fe+((v&(1<<ne+le)-1)>>ne)],P=Te>>>24,W=Te>>>16&255,Y=65535&Te,!(ne+P<=E);){if(f===0)break e;f--,v+=a[d++]<<E,E+=8}v>>>=ne,E-=ne,r.back+=ne}if(v>>>=P,E-=P,r.back+=P,64&W){e.msg="invalid distance code",r.mode=$s;break}r.offset=Y,r.extra=15&W,r.mode=16203;case 16203:if(r.extra){for(St=r.extra;E<St;){if(f===0)break e;f--,v+=a[d++]<<E,E+=8}r.offset+=v&(1<<r.extra)-1,v>>>=r.extra,E-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=$s;break}r.mode=16204;case 16204:if(m===0)break e;if(R=S-m,r.offset>R){if(R=r.offset-R,R>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=$s;break}R>r.wnext?(R-=r.wnext,j=r.wsize-R):j=r.wnext-R,R>r.length&&(R=r.length),D=r.window}else D=c,j=h-r.offset,R=r.length;R>m&&(R=m),m-=R,r.length-=R;do c[h++]=D[j++];while(--R);r.length===0&&(r.mode=pA);break;case 16205:if(m===0)break e;c[h++]=r.length,m--,r.mode=pA;break;case NU:if(r.wrap){for(;E<32;){if(f===0)break e;f--,v|=a[d++]<<E,E+=8}if(S-=m,e.total_out+=S,r.total+=S,4&r.wrap&&S&&(e.adler=r.check=Zi(r)?Ea(r.check,c,S,h-S):_w(r.check,c,S,h-S)),S=m,4&r.wrap&&(Zi(r)?v:Mq(v))!==r.check){e.msg="incorrect data check",r.mode=$s;break}v=0,E=0}r.mode=16207;case 16207:if(r.wrap&&Zi(r)){for(;E<32;){if(f===0)break e;f--,v+=a[d++]<<E,E+=8}if(4&r.wrap&&v!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=$s;break}v=0,E=0}r.mode=16208;case 16208:_e=upe;break e;case $s:_e=Pq;break e;case 16210:return Lq;default:return Ml}return e.next_out=h,e.avail_out=m,e.next_in=d,e.avail_in=f,r.hold=v,r.bits=E,(r.wsize||S!==e.avail_out&&r.mode<$s&&(r.mode<NU||t!==Dq))&&Gq(e,e.output,e.next_out,S-e.avail_out),w-=e.avail_in,S-=e.avail_out,e.total_in+=w,e.total_out+=S,r.total+=S,4&r.wrap&&S&&(e.adler=r.check=Zi(r)?Ea(r.check,c,S,e.next_out-S):_w(r.check,c,S,e.next_out-S)),e.data_type=r.bits+(r.last?64:0)+(r.mode===Mh?128:0)+(r.mode===hA||r.mode===CU?256:0),(w===0&&S===0||t===Dq)&&_e===Jg&&(_e=ppe),_e},Uh={inflateReset:Vq,inflateReset2:Fq,inflateResetKeep:Uq,inflateInit:e=>Bq(e,15),inflateInit2:Bq,inflate:gpe,inflateEnd:e=>{if(Qg(e))return Ml;let t=e.state;return t.window&&(t.window=null),e.state=null,Jg},inflateGetHeader:(e,t)=>{if(Qg(e))return Ml;const r=e.state;return 2&r.wrap?(r.head=t,t.done=!1,Jg):Ml},inflateSetDictionary:(e,t)=>{const r=t.length;let a,c,d;return Qg(e)?Ml:(a=e.state,a.wrap!==0&&a.mode!==uA?Ml:a.mode===uA&&(c=1,c=_w(c,t,r,0),c!==a.check)?Pq:(d=Gq(e,t,r,r),d?(a.mode=16210,Lq):(a.havedict=1,Jg)))},inflateInfo:"pako inflate (from Nodeca project)"},_pe=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Wq=Object.prototype.toString,{Z_NO_FLUSH:vpe,Z_FINISH:Epe,Z_OK:Rw,Z_STREAM_END:kU,Z_NEED_DICT:OU,Z_STREAM_ERROR:ype,Z_DATA_ERROR:Hq,Z_MEM_ERROR:bpe}=tA;function fA(e){this.options=sA.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Aq,this.strm.avail_out=0;let r=Uh.inflateInit2(this.strm,t.windowBits);if(r!==Rw)throw new Error(qg[r]);if(this.header=new _pe,Uh.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=Sw.string2buf(t.dictionary):Wq.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=Uh.inflateSetDictionary(this.strm,t.dictionary),r!==Rw)))throw new Error(qg[r])}function Kq(e,t){const r=new fA(t);if(r.push(e),r.err)throw r.msg||qg[r.err];return r.result}fA.prototype.push=function(e,t){const r=this.strm,a=this.options.chunkSize,c=this.options.dictionary;let d,h,f;if(this.ended)return!1;for(h=t===~~t?t:t===!0?Epe:vpe,Wq.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(a),r.next_out=0,r.avail_out=a),d=Uh.inflate(r,h),d===OU&&c&&(d=Uh.inflateSetDictionary(r,c),d===Rw?d=Uh.inflate(r,h):d===Hq&&(d=OU));r.avail_in>0&&d===kU&&r.state.wrap>0&&e[r.next_in]!==0;)Uh.inflateReset(r),d=Uh.inflate(r,h);switch(d){case ype:case Hq:case OU:case bpe:return this.onEnd(d),this.ended=!0,!1}if(f=r.avail_out,r.next_out&&(r.avail_out===0||d===kU))if(this.options.to==="string"){let m=Sw.utf8border(r.output,r.next_out),v=r.next_out-m,E=Sw.buf2string(r.output,m);r.next_out=v,r.avail_out=a-v,v&&r.output.set(r.output.subarray(m,m+v),0),this.onData(E)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(d!==Rw||f!==0){if(d===kU)return d=Uh.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,!0;if(r.avail_in===0)break}}return!0},fA.prototype.onData=function(e){this.chunks.push(e)},fA.prototype.onEnd=function(e){e===Rw&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=sA.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var xpe={inflate:Kq,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Kq(e,t)}};const{deflate:wpe,deflateRaw:Spe}=spe,{inflate:Tpe,inflateRaw:Rpe}=xpe;var Cpe=wpe,Npe=Spe,Ipe=Tpe,Ape=Rpe,qq=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(qq||{});class kpe{constructor(){L(this,"_sequence",0),L(this,"_startTime",Date.now()),L(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const r={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const f=new Uint8Array(4);f.set([1,0,0,0]);const m={id:0,length:4,data:f.buffer},v={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[m]};r.commonPacketHeader.extension=1,r.extension=v,r.payload=this.compress(t),r.commonPacketHeader.length=8+(r.extension.length+2)+r.payload.byteLength}else r.commonPacketHeader.length=8+r.payload.byteLength;z("SHOW_DATASTREAM2_LOG")&&I.debug("send data header: ".concat(JSON.stringify(r.commonPacketHeader)));const a=new ArrayBuffer(r.commonPacketHeader.length),c=new Uint8Array(a),d=new DataView(a);let h=0;if(d.setUint16(h,r.commonPacketHeader.extension<<15|r.commonPacketHeader.reserved<<14|r.commonPacketHeader.length,!0),h+=2,d.setUint32(h,r.commonPacketHeader.sequence,!0),h+=4,d.setUint16(h,r.commonStreamHeader,!0),h+=2,r.extension){const f=this.serializeExtension(r.extension);c.set(new Uint8Array(f),h),h+=f.byteLength}if(c.set(new Uint8Array(r.payload),h),h+=r.payload.byteLength,h!==r.commonPacketHeader.length)throw Error("serialize error!");return a}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const r=new DataView(t);let a=0;const c=r.getUint16(a,!0);a+=2;const d={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:r.getUint16(a+2,!0)<<16|r.getUint16(a,!0)};let h,f;if(a+=4,z("SHOW_DATASTREAM2_LOG")&&I.debug("receive data header: ".concat(JSON.stringify(d))),r.getUint16(a,!0),a+=2,d.extension){f=this.deserializeExtension(t.slice(a)),a+=2+f.length,h=t.slice(a);let m=!1;if(f.datas.length>0){const v=f.datas.find(E=>E.id===0);v&&(m=(1&new DataView(v.data).getUint32(0,!0))==1)}h=m?this.decompress(h):h}else h=t.slice(8);return h}serializeExtension(t){const{profile:r,length:a,datas:c}=t,d=new ArrayBuffer(a+2),h=new Uint8Array(d),f=new DataView(d);let m=0;if(f.setUint8(m++,r),f.setUint8(m++,a),c.forEach(v=>{r?(f.setUint8(m++,v.id),f.setUint8(m++,v.length),h.set(new Uint8Array(v.data),m),m+=v.data.byteLength):(f.setUint8(m++,v.id|v.length<<4),h.set(new Uint8Array(v.data),m),m+=v.data.byteLength)}),m!==a+2)throw Error("serialize extension error, is ".concat(m,"!==").concat(a+2));return d}deserializeExtension(t){const r=new DataView(t);let a=0;const c=r.getUint8(a);a++;const d=r.getUint8(a);a++;const h=c===qq.TWO_BYTE,f=[],m=new DataView(t,2);let v=0;for(;v<d;){let E=0,w=0,S=new ArrayBuffer(0);h?(E=m.getUint8(v),v++,w=m.getUint8(v),v++):(E=15&m.getUint8(v),w=m.getUint8(v)>>4,v++),w>0&&(S=m.buffer.slice(v+2,v+2+w),v+=S.byteLength),f.push({id:E,length:w,data:S})}if(v!==d)throw Error("parse error");return{profile:c,length:d,datas:f}}decompress(t){return Ipe(new Uint8Array(t))}compress(t){return Cpe(new Uint8Array(t))}}const Ope={name:"DataStream",create:(e,t)=>{const r=t?new jde(e):new Mde(e);return r.useDataStream(new kpe),r}};class Dpe extends br{constructor(t,r,a){super(),L(this,"ws",void 0),L(this,"requestId",1),L(this,"heartBeatTimer",void 0),L(this,"joinInfo",void 0),L(this,"clientId",void 0),L(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),L(this,"onClose",c=>{this.emit("close"),this.dispose()}),L(this,"onMessage",c=>{const d=JSON.parse(c.data);if(!d||d.command!=="serverResponse"||!d.requestId)return d&&d.command==="serverStatus"&&d.serverStatus&&d.serverStatus.command?(this.emit("status",d.serverStatus),void this.emit(d.serverStatus.command,d.serverStatus)):void 0;this.emit("req_".concat(d.requestId),d)}),this.joinInfo=t,this.clientId=r,this.ws=new $x("cross-channel-".concat(this.clientId),a),this.ws.on(Lt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Lt.CONNECTED,this.onOpen),this.ws.on(Lt.ON_MESSAGE,this.onMessage),this.ws.on(Lt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const r=this.requestId++;return t.requestId=r,t.seq=r,this.ws.sendMessage(t),r}waitStatus(t){return new Ue((r,a)=>{const c=window.setTimeout(()=>{a(new Ee(K.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,d=>{window.clearTimeout(c),d.state&&d.state!==0?a(new Ee(K.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):r(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),a(new Ee(K.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new Ee(K.WS_DISCONNECT);const r=()=>new Ue((h,f)=>{this.ws.once(Lt.CLOSED,()=>f(new Ee(K.WS_ABORT))),this.ws.once(Lt.CONNECTED,h)});this.ws.state!=="connected"&&await r();const a=this.sendMessage(t),c=new Ue((h,f)=>{const m=()=>{f(new Ee(K.WS_ABORT))};this.ws.once(Lt.RECONNECTING,m),this.ws.once(Lt.CLOSED,m),this.once("req_".concat(a),h),Ds(3e3).then(()=>{this.removeAllListeners("req_".concat(a)),this.ws.off(Lt.RECONNECTING,m),this.ws.off(Lt.CLOSED,m),f(new Ee(K.TIMEOUT,"cross channel ws request timeout"))})}),d=await c;if(!d||d.code!==200)throw new Ee(K.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(d)));return d}async connect(t){this.ws.removeAllListeners(Lt.REQUEST_NEW_URLS),this.ws.on(Lt.REQUEST_NEW_URLS,r=>{r(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const r=this.requestId++;return t.requestId=r,this.ws.sendMessage(t),r}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Ppe extends br{set state(t){t!==this._state&&(t!==oo.RELAY_STATE_FAILURE&&(this.errorCode=Xv.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,r,a,c,d){super(),L(this,"joinInfo",void 0),L(this,"sid",void 0),L(this,"clientId",void 0),L(this,"cancelToken",Pa.CancelToken.source()),L(this,"workerToken",void 0),L(this,"requestId",0),L(this,"signal",void 0),L(this,"prevChannelMediaConfig",void 0),L(this,"httpRetryConfig",void 0),L(this,"_resolution",void 0),L(this,"_state",oo.RELAY_STATE_IDLE),L(this,"errorCode",Xv.RELAY_OK),L(this,"onStatus",h=>{I.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",Dh.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",Dh.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Xv.SRC_TOKEN_EXPIRED,this.state=oo.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Xv.DEST_TOKEN_EXPIRED,this.state=oo.RELAY_STATE_FAILURE))}),L(this,"onReconnect",async()=>{I.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Dh.NETWORK_DISCONNECTED),this.state=oo.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==oo.RELAY_STATE_IDLE&&(I.error("auto restart channel media relay failed",h.toString()),this.errorCode=Xv.SERVER_CONNECTION_LOST,this.state=oo.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=r,this.sid=Ng(),this.signal=new Dpe(this.joinInfo,this.clientId,a),this.httpRetryConfig=c,this._resolution=d}async startChannelMediaRelay(t){if(this.state!==oo.RELAY_STATE_IDLE)throw new Ee(K.INVALID_OPERATION);this.state=oo.RELAY_STATE_CONNECTING,await this.connect(),I.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(r){throw r.data&&r.data.serverResponse&&r.data.serverResponse.command==="SetSourceChannel"?new Ee(K.CROSS_CHANNEL_FAILED_JOIN_SRC):r.data&&r.data.serverResponse&&r.serverResponse.command==="SetDestChannelStatus"?new Ee(K.CROSS_CHANNEL_FAILED_JOIN_DEST):r.data&&r.data.serverResponse&&r.serverResponse.command==="StartPacketTransfer"?new Ee(K.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):r}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==oo.RELAY_STATE_RUNNING)throw new Ee(K.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==oo.RELAY_STATE_RUNNING)throw new Ee(K.INVALID_OPERATION);const r=this.genMessage(Ma.SetVideoProfile);await this.signal.request(r),I.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),I.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=oo.RELAY_STATE_IDLE,this.dispose()}dispose(){I.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Pa.CancelToken.source(),this.state=oo.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await Bue(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",Dh.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const r=this.genMessage(Ma.SetSdkProfile,t);await this.signal.request(r),I.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const a=this.genMessage(Ma.SetSourceChannel,t);await this.signal.request(a),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Dh.PACKET_JOINED_SRC_CHANNEL),I.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const c=this.genMessage(Ma.SetSourceUserId,t);await this.signal.request(c),I.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const d=this.genMessage(Ma.SetDestChannel,t);await this.signal.request(d),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Dh.PACKET_JOINED_DEST_CHANNEL),I.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const h=this.genMessage(Ma.StartPacketTransfer,t);await this.signal.request(h),this.emit("event",Dh.PACKET_SENT_TO_DEST_CHANNEL),this.state=oo.RELAY_STATE_RUNNING,I.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const r=this.genMessage(Ma.UpdateDestChannel,t);await this.signal.request(r),this.emit("event",Dh.PACKET_UPDATE_DEST_CHANNEL),I.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(Ma.StopPacketTransfer);await this.signal.request(t),I.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,r){const a=[],c=[],d=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:kc,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.24.2"&&(h.sdkVersion="0.0.1");let f=null,m=null;switch(t){case Ma.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case Ma.SetSourceChannel:if(m=r&&r.getSrcChannelMediaInfo(),!m)throw new Ee(K.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:m.channelName,token:m.token||this.joinInfo.appId},h;case Ma.SetSourceUserId:if(m=r&&r.getSrcChannelMediaInfo(),!m)throw new Ee(K.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:m.uid+""},h;case Ma.SetDestChannel:if(f=r&&r.getDestChannelMediaInfo(),!f)throw new Ee(K.UNEXPECTED_ERROR,"can not find dest config");return f.forEach(v=>{a.push(v.channelName),c.push(v.uid+""),d.push(v.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:a,uid:c,token:d},h;case Ma.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case Ma.Reconnect:return h.clientRequest={command:"Reconnect"},h;case Ma.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case Ma.UpdateDestChannel:if(f=r&&r.getDestChannelMediaInfo(),!f)throw new Ee(K.UNEXPECTED_ERROR,"can not find dest config");return f.forEach(v=>{a.push(v.channelName),c.push(v.uid+""),d.push(v.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:a,uid:c,token:d},h;case Ma.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const Lpe={name:"ChannelMediaRelay",create:function(e){return new Ppe(e.joinInfo,e.clientId,e.websocketRetryConfig||ls,e.httpRetryConfig||ls,e.resolution)}};function Yq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function Cw(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Yq(Object(r),!0).forEach(function(a){L(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Yq(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}class jpe extends br{constructor(t,r,a,c){super(),L(this,"spec",void 0),L(this,"token",void 0),L(this,"websocket",void 0),L(this,"pingpongTimer",void 0),L(this,"reconnectMode","retry"),L(this,"serviceMode",void 0),L(this,"reqId",0),L(this,"commandReqId",0),L(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),L(this,"handleWebSocketMessage",d=>{if(!d.data)return;const h=JSON.parse(d.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(tt.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===Oh.TRANSCODE?1:2}),this.emit(hf.PUBLISH_STREAM_STATUS,h))}),this.spec=r,this.token=t,this.serviceMode=c,this.websocket=new $x("live-streaming",a),this.websocket.on(Lt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Lt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Lt.REQUEST_NEW_URLS,(d,h)=>{_s(this,hf.REQUEST_NEW_ADDRESS).then(d).catch(h)}),this.websocket.on(Lt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,r,a,c){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const d=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new Ee(K.UNEXPECTED_ERROR);const f=Cw({command:t,sdkVersion:kc==="4.24.2"?"0.0.1":kc,seq:h,requestId:h,allocate:a,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},r);if(this.websocket.state==="closed")throw new Ee(K.WS_DISCONNECT);const m=()=>new Ue((S,R)=>{this.websocket.once(Lt.CLOSED,()=>R(new Ee(K.WS_ABORT))),this.websocket.once(Lt.CONNECTED,S)});this.websocket.state!=="connected"&&await m(),f.clientRequest&&(f.clientRequest.workerToken=this.token);const v=new Ue((S,R)=>{const j=()=>{R(new Ee(K.WS_ABORT))};this.websocket.once(Lt.RECONNECTING,j),this.websocket.once(Lt.CLOSED,j),this.once("@".concat(h,"-").concat(this.spec.sid),D=>{S(D)})});c&&tt.workerEvent(this.spec.sid,Cw(Cw({},c),{},{requestId:d,actionType:"request",payload:JSON.stringify(r.clientRequest),serverCode:0,code:0}));const E=Date.now();this.websocket.sendMessage(f);let w=null;try{w=await v}catch(S){if(this.websocket.state==="closed")throw S;return await m(),await this.request(t,r,a)}return c&&tt.workerEvent(this.spec.sid,Cw(Cw({},c),{},{requestId:d,actionType:"response",payload:JSON.stringify(w.serverResponse),serverCode:w.code,success:w.code===200,responseTime:Date.now()-E})),w.code!==200&&this.handleResponseError(w),w}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=kc==="4.24.2"?"0.0.1":kc;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case xs.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void I.warning("live stream response already exists stream");case xs.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case xs.LIVE_STREAM_RESPONSE_BAD_STREAM:case xs.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Ee(K.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case xs.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new Ee(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case xs.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Ee(K.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case xs.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const r=new Ee(K.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(hf.WARNING,r,t.serverResponse.url)}case xs.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const r=new Ee(K.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(hf.WARNING,r,t.serverResponse.url)}case xs.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Ee(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case xs.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Ee(K.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case xs.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const r=new Ee(K.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(hf.WARNING,r,t.serverResponse.url)}case xs.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Ee(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case xs.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Ee(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case xs.LIVE_STREAM_RESPONSE_WORKER_LOST:case xs.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new Ee(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case xs.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new Ee(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new Ee(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case xs.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case xs.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case xs.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case xs.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Ee(K.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(zx)},6e3)}}function Xq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function lo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Xq(Object(r),!0).forEach(function(a){L(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xq(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}class Mpe extends br{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ls,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ls;super(),L(this,"onLiveStreamWarning",void 0),L(this,"onLiveStreamError",void 0),L(this,"spec",void 0),L(this,"retryTimeout",1e4),L(this,"connection",void 0),L(this,"httpRetryConfig",void 0),L(this,"wsRetryConfig",void 0),L(this,"streamingTasks",new Map),L(this,"isStartingStreamingTask",!1),L(this,"taskMutex",new Ks("live-streaming")),L(this,"cancelToken",Pa.CancelToken.source()),L(this,"transcodingConfig",void 0),L(this,"uapResponse",void 0),L(this,"lastTaskId",1),L(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=a,this.wsRetryConfig=r}async setTranscodingConfig(t){const r=lo(lo({},yue),t);r.videoCodecProfile!==66&&r.videoCodecProfile!==77&&r.videoCodecProfile!==100&&(I.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(r.videoCodecProfile," -> 100")),r.videoCodecProfile=100),r.transcodingUsers||(r.transcodingUsers=r.userConfigs),r.transcodingUsers&&(r.transcodingUsers=r.transcodingUsers.map(h=>lo(lo(lo({},Eue),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){Lr(h.width)||Xn(h.width,"config.width",0,1e4),Lr(h.height)||Xn(h.height,"config.height",0,1e4),Lr(h.videoBitrate)||Xn(h.videoBitrate,"config.videoBitrate",1,1e6),Lr(h.videoFrameRate)||Xn(h.videoFrameRate,"config.videoFrameRate"),Lr(h.lowLatency)||Tl(h.lowLatency,"config.lowLatency"),Lr(h.audioSampleRate)||cs(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Lr(h.audioBitrate)||Xn(h.audioBitrate,"config.audioBitrate",1,128),Lr(h.audioChannels)||cs(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),Lr(h.videoGop)||Xn(h.videoGop,"config.videoGop"),Lr(h.videoCodecProfile)||cs(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Lr(h.userCount)||Xn(h.userCount,"config.userCount",0,17),Lr(h.backgroundColor)||Xn(h.backgroundColor,"config.backgroundColor",0,16777215),Lr(h.userConfigExtraInfo)||ri(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!Lr(h.transcodingUsers)&&(Ah(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((f,m)=>{SI(f.uid),Lr(f.x)||Xn(f.x,"transcodingUser[".concat(m,"].x"),0,1e4),Lr(f.y)||Xn(f.y,"transcodingUser[".concat(m,"].y"),0,1e4),Lr(f.width)||Xn(f.width,"transcodingUser[".concat(m,"].width"),0,1e4),Lr(f.height)||Xn(f.height,"transcodingUser[".concat(m,"].height"),0,1e4),Lr(f.zOrder)||Xn(f.zOrder-1,"transcodingUser[".concat(m,"].zOrder"),0,100),Lr(f.alpha)||Xn(f.alpha,"transcodingUser[".concat(m,"].alpha"),0,1,!1)})),Lr(h.watermark)||xM(h.watermark,"watermark"),Lr(h.backgroundImage)||xM(h.backgroundImage,"backgroundImage"),h.images&&!Lr(h.images)&&(Ah(h.images,"config.images"),h.images.forEach((f,m)=>{xM(f,"images[".concat(m,"]"))}))}(r);const a=[];r.images&&a.push(...r.images.map(h=>lo(lo(lo({},bM),h),{},{zOrder:255}))),r.backgroundImage&&(a.push(lo(lo(lo({},bM),r.backgroundImage),{},{zOrder:0})),delete r.backgroundImage),r.watermark&&(a.push(lo(lo(lo({},bM),r.watermark),{},{zOrder:255})),delete r.watermark),r.images=a,r.transcodingUsers&&(r.userConfigs=r.transcodingUsers.map(h=>lo({},h)),r.userCount=r.transcodingUsers.length,delete r.transcodingUsers);const c=(r.userConfigs||[]).map(h=>typeof h.uid=="number"?Ue.resolve(h.uid):m7(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await Ue.all(c)).forEach((h,f)=>{r.userConfigs&&r.userConfigs[f]&&(r.userConfigs[f].uid=h)}),this.transcodingConfig=r,this.connection)try{var d;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Oa(d=this.streamingTasks).call(d)).map(f=>f.taskId).join("#")});I.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(f=>{I.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",f.url),this.startLiveStreamingTask(f.url,f.mode,h).then(()=>{I.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(f.url," success"))}).catch(m=>{I.error("[".concat(this.spec.clientId,"] live streaming republish failed"),f.url,m.toString()),this.onLiveStreamError&&this.onLiveStreamError(f.url,m)})})}}async startLiveStreamingTask(t,r,a){if(!this.transcodingConfig&&r===Oh.TRANSCODE)throw new Ee(K.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};I.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(r));const d=await this.taskMutex.lock();if(!this.connection&&a)return void d();if(this.streamingTasks.get(t)&&!a)return d(),new Ee(K.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(r))}catch(f){throw d(),f}switch(r){case Oh.TRANSCODE:c.transcodingConfig=lo({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const f=new Ue((v,E)=>{Ds(this.retryTimeout).then(()=>{if(a)return E(a);const w=this.statusError.get(t);return w?(this.statusError.delete(t),E(w)):void 0})}),m=await Ue.race([this.connection.request("request",{clientRequest:c},!0,{url:t,command:"PublishStream",workerType:r===Oh.TRANSCODE?1:2,requestByUser:!a,tid:h.toString()}),f]);this.isStartingStreamingTask=!1,I.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(m.code)),this.streamingTasks.set(t,{clientRequest:c,mode:r,url:t,taskId:h}),d()}catch(f){if(d(),this.isStartingStreamingTask=!1,!f.data||!f.data.retry||a)throw f;return f.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,r,f)):await this.startLiveStreamingTask(t,r,f)}}stopLiveStreamingTask(t){return new Ue((r,a)=>{const c=this.streamingTasks.get(t);if(!c||!this.connection)return new Ee(K.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const d=c.mode;c.abortTask=()=>{I.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),r()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:t,command:"UnPublishStream",workerType:d===Oh.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{I.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),r()}).catch(a)})}resetAllTask(){var t;const r=Array.from(Oa(t=this.streamingTasks).call(t));this.terminate();for(const a of r)this.startLiveStreamingTask(a.url,a.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(a.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Pa.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new Ee(K.UNEXPECTED_ERROR,"live streaming connection has already connected");const r=await _s(this,wM.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=r,this.connection=new jpe(r.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(hf.WARNING,(a,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,a)),this.connection.on(hf.PUBLISH_STREAM_STATUS,a=>this.handlePublishStreamServer(a)),this.connection.on(hf.REQUEST_NEW_ADDRESS,(a,c)=>{if(!this.connection)return c(new Ee(K.UNEXPECTED_ERROR,"can not get new live streaming address list"));_s(this,wM.REQUEST_WORKER_MANAGER_LIST,t).then(d=>{this.uapResponse=d,a(d.addressList)}).catch(c)}),await this.connection.init(r.addressList),this.connection}handlePublishStreamServer(t){const r=t.serverStatus&&t.serverStatus.url||"empty_url",a=this.streamingTasks.get(r),c=t.reason;switch(t.code){case xs.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case xs.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case xs.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case xs.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new Ee(K.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(a)return I.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(r,h);if(!this.isStartingStreamingTask)return;this.statusError.set(r,h)}case xs.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new Ee(K.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(r,h)}case xs.LIVE_STREAM_RESPONSE_WORKER_LOST:case xs.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var d;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(Oa(d=this.streamingTasks).call(d));for(const f of h)f.abortTask?f.abortTask():(I.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",f.url),this.startLiveStreamingTask(f.url,f.mode,new Ee(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{I.debug("[".concat(this.spec.clientId,"] republish live stream success"),f.url)}).catch(m=>{I.error(m.toString()),this.onLiveStreamError&&this.onLiveStreamError(f.url,m)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const Upe={name:"LiveStreaming",create:function(e){return new Mpe(e.joinInfo,e.websocketRetryConfig||ls,e.httpRetryConfig||ls)}};function Vpe(e){let t=Qq();return function(r,a){let c=r.appId;c!==void 0&&(Fn(a,10),Pu(a,c));let d=r.cid;d!==void 0&&(Fn(a,16),Fn(a,d));let h=r.cname;h!==void 0&&(Fn(a,26),Pu(a,h));let f=r.deviceId;f!==void 0&&(Fn(a,34),Pu(a,f));let m=r.elapse;m!==void 0&&(Fn(a,40),Tf(a,m));let v=r.fileSize;v!==void 0&&(Fn(a,48),Tf(a,pE(v)));let E=r.height;E!==void 0&&(Fn(a,56),Tf(a,pE(E)));let w=r.jpg;w!==void 0&&(Fn(a,66),Fn(a,w.length),function(Er,Re){let je=fE(Er,Re.length);Er.bytes.set(Re,je)}(a,w));let S=r.networkType;S!==void 0&&(Fn(a,72),Tf(a,pE(S)));let R=r.osType;R!==void 0&&(Fn(a,80),Tf(a,pE(R)));let j=r.requestId;j!==void 0&&(Fn(a,90),Pu(a,j));let D=r.sdkVersion;D!==void 0&&(Fn(a,98),Pu(a,D));let P=r.sequence;P!==void 0&&(Fn(a,104),Tf(a,pE(P)));let W=r.sid;W!==void 0&&(Fn(a,114),Pu(a,W));let Y=r.timestamp;Y!==void 0&&(Fn(a,120),Tf(a,Y));let ne=r.uid;ne!==void 0&&(Fn(a,128),Fn(a,ne));let le=r.vid;le!==void 0&&(Fn(a,136),Fn(a,le));let fe=r.width;fe!==void 0&&(Fn(a,144),Tf(a,pE(fe)));let ie=r.service;ie!==void 0&&(Fn(a,152),Fn(a,ie));let _e=r.callbackData;_e!==void 0&&(Fn(a,162),Pu(a,_e));let Te=r.jpgEncryption;Te!==void 0&&(Fn(a,168),Fn(a,Te));let Ne=r.requestType;Ne!==void 0&&(Fn(a,176),Fn(a,Ne));let Ke=r.scorePorn;Ke!==void 0&&(Fn(a,185),MU(a,Ke));let St=r.scoreSexy;St!==void 0&&(Fn(a,193),MU(a,St));let Et=r.scoreNeutral;Et!==void 0&&(Fn(a,201),MU(a,Et));let Vt=r.scene;Vt!==void 0&&(Fn(a,208),Fn(a,Vt));let Ot=r.ossFilePrefix;Ot!==void 0&&(Fn(a,218),Pu(a,Ot));let Cn=r.serviceVendor;if(Cn!==void 0)for(let Er of Cn){Fn(a,226);let Re=Qq();zpe(Er,Re),Fn(a,Re.limit),Kpe(a,Re),Hpe(Re)}}(e,t),function(r){let a=r.bytes,c=r.limit;return a.length===c?a:a.subarray(0,c)}(t)}function Fpe(e){return function(r){let a={};e:for(;!Zq(r);){let c=Lu(r);switch(c>>>3){case 0:break e;case 1:a.code=Lu(r);break;case 2:a.msg=eY(r,Lu(r));break;case 3:{let d=Gpe(r);a.data=Bpe(r),r.limit=d;break}default:$q(r,7&c)}}return a}({bytes:t=e,offset:0,limit:t.length});var t}function Bpe(e){let t={};e:for(;!Zq(e);){let r=Lu(e);switch(r>>>3){case 0:break e;case 1:t.requestId=eY(e,Lu(e));break;case 2:t.requestType=Lu(e)>>>0;break;case 3:t.scorePorn=jU(e);break;case 4:t.scoreSexy=jU(e);break;case 5:t.scoreNeutral=jU(e);break;case 6:t.requestScene=Lu(e)>>>0;break;case 7:t.scene=Lu(e)>>>0;break;default:$q(e,7&r)}}return t}function zpe(e,t){let r=e.service;r!==void 0&&(Fn(t,8),Fn(t,r));let a=e.vendor;a!==void 0&&(Fn(t,16),Fn(t,a));let c=e.token;c!==void 0&&(Fn(t,26),Pu(t,c));let d=e.callbackUrl;d!==void 0&&(Fn(t,34),Pu(t,d))}function Gpe(e){let t=Lu(e),r=e.limit;return e.limit=e.offset+t,r}function $q(e,t){switch(t){case 0:for(;128&tY(e););break;case 2:PU(e,Lu(e));break;case 5:PU(e,4);break;case 1:PU(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let Wpe=new Float32Array(1);new Uint8Array(Wpe.buffer);let DU=new Float64Array(1),uo=new Uint8Array(DU.buffer);function pE(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let Jq=[];function Qq(){const e=Jq.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function Hpe(e){Jq.push(e)}function PU(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function Zq(e){return e.offset>=e.limit}function fE(e,t){let r=e.bytes,a=e.offset,c=e.limit,d=a+t;if(d>r.length){let h=new Uint8Array(2*d);h.set(r),e.bytes=h}return e.offset=d,d>c&&(e.limit=d),a}function LU(e,t){let r=e.offset;if(r+t>e.limit)throw new Error("Read past limit");return e.offset+=t,r}function eY(e,t){let r=LU(e,t),a=String.fromCharCode,c=e.bytes,d="",h="";for(let f=0;f<t;f++){let m,v,E,w,S=c[f+r];128&S?(224&S)==192?f+1>=t?h+=d:(m=c[f+r+1],(192&m)!=128?h+=d:(w=(31&S)<<6|63&m,w<128?h+=d:(h+=a(w),f++))):(240&S)==224?f+2>=t?h+=d:(m=c[f+r+1],v=c[f+r+2],(49344&(m|v<<8))!=32896?h+=d:(w=(15&S)<<12|(63&m)<<6|63&v,w<2048||w>=55296&&w<=57343?h+=d:(h+=a(w),f+=2))):(248&S)==240?f+3>=t?h+=d:(m=c[f+r+1],v=c[f+r+2],E=c[f+r+3],(12632256&(m|v<<8|E<<16))!=8421504?h+=d:(w=(7&S)<<18|(63&m)<<12|(63&v)<<6|63&E,w<65536||w>1114111?h+=d:(w-=65536,h+=a(55296+(w>>10),56320+(1023&w)),f+=3))):h+=d:h+=a(S)}return h}function Pu(e,t){let r=t.length,a=0;for(let h=0;h<r;h++){let f=t.charCodeAt(h);f>=55296&&f<=56319&&h+1<r&&(f=(f<<10)+t.charCodeAt(++h)-56613888),a+=f<128?1:f<2048?2:f<65536?3:4}Fn(e,a);let c=fE(e,a),d=e.bytes;for(let h=0;h<r;h++){let f=t.charCodeAt(h);f>=55296&&f<=56319&&h+1<r&&(f=(f<<10)+t.charCodeAt(++h)-56613888),f<128?d[c++]=f:(f<2048?d[c++]=f>>6&31|192:(f<65536?d[c++]=f>>12&15|224:(d[c++]=f>>18&7|240,d[c++]=f>>12&63|128),d[c++]=f>>6&63|128),d[c++]=63&f|128)}}function Kpe(e,t){let r=fE(e,t.limit),a=e.bytes,c=t.bytes;for(let d=0,h=t.limit;d<h;d++)a[d+r]=c[d]}function tY(e){return e.bytes[LU(e,1)]}function nY(e,t){let r=fE(e,1);e.bytes[r]=t}function jU(e){let t=LU(e,8),r=e.bytes;return uo[0]=r[t++],uo[1]=r[t++],uo[2]=r[t++],uo[3]=r[t++],uo[4]=r[t++],uo[5]=r[t++],uo[6]=r[t++],uo[7]=r[t++],DU[0]}function MU(e,t){let r=fE(e,8),a=e.bytes;DU[0]=t,a[r++]=uo[0],a[r++]=uo[1],a[r++]=uo[2],a[r++]=uo[3],a[r++]=uo[4],a[r++]=uo[5],a[r++]=uo[6],a[r++]=uo[7]}function Lu(e){let t,r=0,a=0;do t=tY(e),r<32&&(a|=(127&t)<<r),r+=7;while(128&t);return a}function Fn(e,t){for(t>>>=0;t>=128;)nY(e,127&t|128),t>>>=7;nY(e,t)}function Tf(e,t){let r=t.low>>>0,a=(t.low>>>28|t.high<<4)>>>0,c=t.high>>>24,d=c===0?a===0?r<16384?r<128?1:2:r<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:c<128?9:10,h=fE(e,d),f=e.bytes;switch(d){case 10:f[h+9]=c>>>7&1;case 9:f[h+8]=d!==9?128|c:127&c;case 8:f[h+7]=d!==8?a>>>21|128:a>>>21&127;case 7:f[h+6]=d!==7?a>>>14|128:a>>>14&127;case 6:f[h+5]=d!==6?a>>>7|128:a>>>7&127;case 5:f[h+4]=d!==5?128|a:127&a;case 4:f[h+3]=d!==4?r>>>21|128:r>>>21&127;case 3:f[h+2]=d!==3?r>>>14|128:r>>>14&127;case 2:f[h+1]=d!==2?r>>>7|128:r>>>7&127;case 1:f[h]=d!==1?128|r:127&r}}function rY(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}const qpe=new Map([["moderation",1],["supervise",2]]);class Ype extends br{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const r=this._connectionState;this._connectionState=t,this.emit(Ys.CONNECTION_STATE_CHANGE,r,t)}get inspectType(){return this._inspectType}set inspectType(t){var r;this._inspectMode=To(r=t.map(a=>qpe.get(a)||0)).call(r,(a,c)=>a+c),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),L(this,"name","AgoraRTCVideoContentInspect"),L(this,"_connectionState",Al.CONNECTING),L(this,"_innerConnectionState",void 0),L(this,"sequence",0),L(this,"inspectStartTime",void 0),L(this,"workerManagerConnection",void 0),L(this,"workerConnection",void 0),L(this,"workerMessageLengthLimit",void 0),L(this,"inspectIntervalMinimum",void 0),L(this,"qualityRatio",void 0),L(this,"_connectInfo",void 0),L(this,"_cancelTokenSource",Pa.CancelToken.source()),L(this,"_retryConfig",void 0),L(this,"wmSequence",0),L(this,"inspectInterval",void 0),L(this,"inspectTimer",null),L(this,"ossFilePrefix",void 0),L(this,"extraInfo",void 0),L(this,"_inspectType",void 0),L(this,"_inspectMode",void 0),L(this,"_quality",1),L(this,"qualityTimer",null),L(this,"_inspectId",void 0),L(this,"_needWorkUrlOnly",!1),L(this,"inspectImage",()=>{if(this.connectionState!==Al.CONNECTED)throw new Ee(K.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Al.CONNECTED?this.requestToInspectImage():I.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=jn(5,"inspect-"),this.workerMessageLengthLimit=z("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=z("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=z("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new $x("worker-manager-"+this._inspectId,ls),this.on(Ys.STATE_CHANGE,(r,a)=>{this._innerConnectionState=r,I.debug("[".concat(this._inspectId,"] Inspect operation :").concat(kl[r]," ").concat(a||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new $x("worker-"+this._inspectId,ls),this.handleWorkerEvents()}async init(t,r){this.emit(Ys.STATE_CHANGE,kl.CONNECT_AP),this._connectInfo=t;const a=this._cancelTokenSource.token;return this._retryConfig=r,new Ue((c,d)=>{this.on(Ys.CONNECTION_STATE_CHANGE,(h,f)=>{f===Al.CONNECTED&&c()}),this.requestAP(t,a,r).then(h=>{this.connectWorkerManager(h)}).catch(h=>{d(h)})})}async requestAP(t,r,a){const c=z("WEBCS_DOMAIN").map(f=>"https://".concat(f,"/api/v1")),d=await function(f,m,v,E){let{appId:w,areaCode:S,cname:R,sid:j,token:D,uid:P}=m;tE++;const W="image_moderation_api",Y={service_name:W,json_body:JSON.stringify({appId:w,areaCode:S,cname:R,command:"allocateEdge",requestId:tE,seq:tE,sid:j,token:D,ts:Date.now(),uid:P+""})};let ne,le,fe=f[0];return yd(async()=>{ne=Date.now();const ie=await Rd(fe,{data:Y,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(le=Date.now()-ne,ie.code!==0){const Et=new Ee(K.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ie.code,{retry:!0,responseTime:le});throw I.error(Et.toString()),Et}const _e=JSON.parse(ie.json_body);if(_e.code!==200){const Et=new Ee(K.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(_e.code,", reason: ").concat(_e.reason),{code:_e.code,responseTime:le});throw I.error(Et.toString()),Et}if(!_e.servers||!Array.isArray(_e.servers)||_e.servers.length===0){const Et=new Ee(K.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:_e.code,responseTime:le});throw I.error(Et.toString()),Et}const Te=z("VIDEO_INSPECT_WORKER_MANAGER_WSS");if(Te)return{addressList:[Te],workerToken:_e.workerToken,vid:_e.vid,responseTime:le};const Ne=z("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Ke=z("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:_e.servers.map(Et=>{let{address:Vt,wss:Ot}=Et;if(Vt&&Ot)return"wss://".concat(Vt.replace(/\./g,"-"),".").concat(Ne,":").concat(Ke||Ot)}).filter(Et=>!!Et),workerToken:_e.workerToken,vid:_e.vid,responseTime:le}},(ie,_e)=>(tt.apworkerEvent(j,{success:!0,sc:200,serviceName:W,responseDetail:JSON.stringify(ie.addressList),firstSuccess:_e===0,responseTime:le,serverIp:f[_e%f.length]}),!1),(ie,_e)=>(tt.apworkerEvent(j,{success:!1,sc:ie.data&&ie.data.code||200,serviceName:W,responseTime:le,serverIp:f[_e%f.length]}),!!(ie.code!==K.OPERATION_ABORTED&&ie.code!==K.UNEXPECTED_RESPONSE||ie.data&&ie.data.retry)&&(fe=f[(_e+1)%f.length],!0)),E)}(c,t,r,a);this.emit(Ys.STATE_CHANGE,kl.AP_CONNECTED);const{addressList:h}=d;return this.wmSequence++,h}async connectWorkerManager(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=r,this.emit(Ys.STATE_CHANGE,kl.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Lt.CONNECTED,async()=>{this.emit(Ys.STATE_CHANGE,kl.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Lt.CLOSED,()=>{this._innerConnectionState<kl.GET_WORKER_MANAGER_RESPONSE&&I.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Lt.FAILED,()=>{this._innerConnectionState<kl.GET_WORKER_MANAGER_RESPONSE&&I.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Lt.RECONNECTING,()=>{this._innerConnectionState<kl.GET_WORKER_MANAGER_RESPONSE&&I.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Lt.ON_MESSAGE,async t=>{this.emit(Ys.STATE_CHANGE,kl.GET_WORKER_MANAGER_RESPONSE);const r=this.workerManagerConnection.url;this.workerManagerConnection.close();const a=JSON.parse(t.data);if(a.code!==200)throw I.error("[".concat(this._inspectId,"] Unexpected code ").concat(a.code," from worker manager")),new Ee(K.UNEXPECTED_RESPONSE,"response code of worker is unexpected",a);if(!(a.serverResponse&&a.serverResponse.portWss&&r))throw I.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(a))),new Ee(K.UNEXPECTED_RESPONSE,"response content of worker is unexpected",a);{const c=z("VIDEO_INSPECT_WORKER_PORT")||a.serverResponse.portWss,d=r.replace(/:\d+\/?$/,":".concat(c));this.emit(Ys.STATE_CHANGE,kl.CONNECT_WORKER,d),this._needWorkUrlOnly?this.emit(Ys.REQUEST_NEW_WORKER_URL,d):await this.connectWorker(d)}}),this.workerManagerConnection.on(Lt.WILL_RECONNECT,(t,r,a)=>{a(t)}),this.workerManagerConnection.on(Lt.REQUEST_NEW_URLS,(t,r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(r)})}handleWorkerEvents(){this.workerConnection.on(Lt.CONNECTED,async()=>{this.emit(Ys.STATE_CHANGE,kl.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Al.CONNECTED}),this.workerConnection.on(Lt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const a=Fpe(new Uint8Array(t.data));if(z("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&I.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(a)),a.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Ys.INSPECT_RESULT,void 0,void 0);if(a.data&&a.data.scorePorn&&a.data.scoreSexy&&a.data.scoreNeutral){var r;const c={porn:a.data.scorePorn,sexy:a.data.scoreSexy,neutral:a.data.scoreNeutral},d=To(r=Object.keys(c)).call(r,(f,m)=>c[f]>c[m]?f:m,"porn"),h=Object.keys(c).find(f=>f===d);this.emit(Ys.INSPECT_RESULT,h)}else this.emit(Ys.INSPECT_RESULT,void 0,new Ee(K.UNEXPECTED_RESPONSE,a.code+"","There is an unexpected data on message"))}else this.emit(Ys.INSPECT_RESULT,void 0,new Ee(K.UNEXPECTED_RESPONSE,a.code+"",a.msg))}else I.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Ys.INSPECT_RESULT,void 0,new Ee(K.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Lt.CLOSED,()=>{this.connectionState=Al.CLOSED}),this.workerConnection.on(Lt.FAILED,()=>{this.connectionState=Al.CLOSED}),this.workerConnection.on(Lt.RECONNECTING,()=>{this.connectionState=this.connectionState===Al.CONNECTED?Al.RECONNECTING:Al.CONNECTING}),this.workerConnection.on(Lt.WILL_RECONNECT,(t,r,a)=>{t==="recover"&&a(t),a("tryNext")}),this.workerConnection.on(Lt.REQUEST_NEW_URLS,(t,r)=>{this.workerManagerConnection.close(),this.once(Ys.REQUEST_NEW_WORKER_URL,a=>{t([a])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(a=>{this.connectWorkerManager(a,!0)}).catch(a=>{r(a)})})}async requestToInspectImage(){this.sequence++;const t=Oo(this,Ys.CLIENT_LOCAL_VIDEO_TRACK),r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(Ys.INSPECT_RESULT,void 0,new Ee(K.INVALID_OPERATION,"Only the track being played can be inspected"));const a=await this.generateRequestData(t,r);this.workerConnection.sendMessage(a,!0,!0)}else this.emit(Ys.INSPECT_RESULT,void 0,new Ee(K.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,r){let{appId:a,cname:c,cid:d,vid:h,sid:f,uid:m}=r;const v=Date.now(),E=await t.getCurrentFrameImage("image/jpeg",this.quality),w=await OW(E,a,c),S=this.sequence+"-"+d+"-"+m+"-"+v+"-"+jn(12,""),R={appId:a,cid:d,cname:c,deviceId:"",elapse:(j=Number(v-this.inspectStartTime),{low:j|=0,high:j>>31,unsigned:j>=0}),fileSize:w.byteLength,jpgEncryption:2,height:E.height,width:E.width,jpg:w,networkType:6,osType:7,requestId:S,sdkVersion:"4.24.2",sequence:this.sequence,sid:f,timestamp:oK(v),uid:m,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var j;this.extraInfo===void 0&&delete R.callbackData,this.ossFilePrefix===void 0&&delete R.ossFilePrefix;const D=Vpe(R);if(D.byteLength<this.workerMessageLengthLimit){if(z("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const P=function(W){for(var Y=1;Y<arguments.length;Y++){var ne=arguments[Y]!=null?arguments[Y]:{};Y%2?rY(Object(ne),!0).forEach(function(le){L(W,le,ne[le])}):Object.getOwnPropertyDescriptors?Object.defineProperties(W,Object.getOwnPropertyDescriptors(ne)):rY(Object(ne)).forEach(function(le){Object.defineProperty(W,le,Object.getOwnPropertyDescriptor(ne,le))})}return W}({},R);delete P.jpg,I.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(P))}return D}{const P=this.quality*this.qualityRatio;return this.quality=P,await this.generateRequestData(t,{appId:a,cname:c,cid:d,vid:h,sid:f,uid:m})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Pa.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Al.CLOSED,this.emit(Ys.STATE_CHANGE,kl.CLOSED)}}const Xpe={name:"ContentInspect",create:function(e){let{config:t}=e;return function(r){if(!r)throw new Ee(K.INVALID_PARAMS,"inspectConfig is necessary.");if(!r.inspectType||!Array.isArray(r.inspectType))throw new Ee(K.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const a=[...new Set(r.inspectType)];a.forEach(c=>{var d;if(!ke(d=["supervise","moderation"]).call(d,c))throw new Ee(K.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),r.inspectType=a}if(r&&r.extraInfo&&r.extraInfo.length>1024)throw new Ee(K.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new Ype(t)}};var sY=u(qt.Object.getOwnPropertySymbols),$pe=vn,Jpe=td.indexOf,Qpe=vh,UU=ce([].indexOf),iY=!!UU&&1/UU([1],1,-0)<0;$pe({target:"Array",proto:!0,forced:iY||!Qpe("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return iY?UU(this,e,t)||0:Jpe(this,e,t)}});var Zpe=So("Array","indexOf"),efe=M,tfe=Zpe,VU=Array.prototype,nfe=function(e){var t=e.indexOf;return e===VU||efe(VU,e)&&t===VU.indexOf?tfe:t},aY=u(nfe);function rfe(e,t){if(e==null)return{};var r,a,c=function(h,f){if(h==null)return{};var m={};for(var v in h)if({}.hasOwnProperty.call(h,v)){if(aY(f).call(f,v)!==-1)continue;m[v]=h[v]}return m}(e,t);if(sY){var d=sY(e);for(a=0;a<d.length;a++)r=d[a],aY(t).call(t,r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(c[r]=e[r])}return c}let oY=class{get localCapabilities(){return ur(this._localCapabilities)}get rtpCapabilities(){return ur(this._rtpCapabilities)}get candidates(){return ur(this._candidates)}get iceParameters(){return ur(this._iceParameters)}get dtlsParameters(){return ur(this._dtlsParameters)}constructor(e){L(this,"sessionDesc",void 0),L(this,"_localCapabilities",void 0),L(this,"_rtpCapabilities",void 0),L(this,"_candidates",void 0),L(this,"_iceParameters",void 0),L(this,"_dtlsParameters",void 0),L(this,"setup",void 0),L(this,"currentMidIndex",void 0),L(this,"cname","o/i14u9pJrxRKAsu"),L(this,"firefoxSsrcMidMap",new Map),e=ur(e);const{remoteIceParameters:t,remoteDtlsParameters:r,candidates:a,remoteRTPCapabilities:c,localCapabilities:d,direction:h,setup:f,videoCodec:m,audioCodec:v}=e;let E;this.setup=f,E=h===va.RECEIVE_ONLY?ma(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):ma(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=a,this._iceParameters=t,this._dtlsParameters=r,this._localCapabilities=d;const w=h===va.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,S=h===va.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,R=h===va.RECEIVE_ONLY?c.send.videoCodecs:nw(Je.VIDEO,w,S,m),j=h===va.RECEIVE_ONLY?c.send.audioCodecs:nw(Je.AUDIO,w,S,v);for(const D of E.mediaDescriptions)D.attributes.iceUfrag=t.iceUfrag,D.attributes.icePwd=t.icePwd,D.attributes.fingerprints=r.fingerprints,D.attributes.candidates=a,D.attributes.setup=this.setup,D.media.mediaType==="application"&&(D.attributes.sctpPort="5000"),D.media.mediaType==="video"&&(D.media.fmts=R.map(P=>P.payloadType.toString(10)),D.attributes.payloads=R,D.attributes.extmaps=w.videoExtensions),D.media.mediaType==="audio"&&(D.media.fmts=j.map(P=>P.payloadType.toString(10)),D.attributes.payloads=j,D.attributes.extmaps=w.audioExtensions,eE(D));this.sessionDesc=E,this.currentMidIndex=E.mediaDescriptions.length-1}toString(){return kh(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,r,a,c){r=r.replace(/ /g,"-");const{ssrcs:d,ssrcGroups:h}=ew(t,this.cname,z("SYNC_GROUP")?r:void 0),f=this.findPreloadMediaDesc(d);if(f){if(dr()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,f.attributes.mid),c&&(c.twcc||c.remb)){const m=this.sessionDesc.mediaDescriptions.indexOf(f);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(f,c),{mid:f.attributes.mid,needExchangeSDP:!0}}return{mid:f.attributes.mid,needExchangeSDP:!1}}{const m=this.findAvailableMediaIndex(e,d,a);let v;return m===-1?(v=this.createOrRecycleSendMedia(e,d,h,"sendonly",a,c),this.updateBundleMids()):(v=ur(this.sessionDesc.mediaDescriptions[m]),v.attributes.direction="sendonly",v.attributes.ssrcs=d,v.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(v,c)),dr()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,v.attributes.mid),{needExchangeSDP:!0,mid:v.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(r=>{r.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,r){const a=[];return e.forEach(c=>{const d=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(d);let f,m=!1;h===-1?(m=!0,f=this.createOrRecycleRecvMedia(c,[],"recvonly",t,r),this.updateBundleMids()):(f=ur(this.sessionDesc.mediaDescriptions[h]),f.attributes.direction="recvonly"),a.push({mid:f.attributes.mid,needCreateTransceiver:m})}),a}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(r=>e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:r,address:a,port:c,type:d,relatedAddress:h,relatedPort:f,priority:m}=new RTCIceCandidate(e),v={foundation:t??"",componentId:"1",transport:r??"",priority:m?m+"":"",connectionAddress:a??"",port:c?c+"":"",type:d?d+"":"",relAddr:h??"",relPort:f?f+"":"",extension:{}};this.candidates.some(E=>E.priority===v.priority&&E.connectionAddress===v.connectionAddress&&E.port===v.port)||(this._candidates.push(v),this.sessionDesc.mediaDescriptions.forEach(E=>{E.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,r,a,c){const d=e._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,f=nw(d,h,this.localCapabilities.send,d===Je.AUDIO?c:a),m=d===Je.VIDEO?h.videoExtensions:h.audioExtensions,v="".concat(++this.currentMidIndex);let E={media:{mediaType:d,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(v)}};E=this.mungRecvMediaDsec(E,e);const w=this.findFirstClosedMedia(d);if(w){const S=this.sessionDesc.mediaDescriptions.indexOf(w);this.sessionDesc.mediaDescriptions[S]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(r=>ke(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(r=>ke(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,r){return this.sessionDesc.mediaDescriptions.findIndex(a=>{const c=a.media.mediaType===e&&a.media.port!=="0"&&(a.attributes.direction==="sendonly"||a.attributes.direction==="sendrecv")&&a.attributes.ssrcs.length===0;if(dr()){if(c){const d=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(d||a.attributes.mid!=="0"&&a.attributes.mid!=="1")||!(!d||d!==a.attributes.mid)}return!1}return c&&a.attributes.mid===r})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const r=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&r})}predictReceivingMids(e){const t=[];for(let r=0;r<e;r++)t.push((this.currentMidIndex+r+1).toString(10));return t}restartICE(e){e=ur(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,r,a,c,d){const h=this.rtpCapabilities.send,f=e===Je.VIDEO?h.videoCodecs:h.audioCodecs,m=e===Je.VIDEO?h.videoExtensions:h.audioExtensions;dr()&&(c="".concat(++this.currentMidIndex));let v={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(w=>w.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:c}};v=this.mungSendMediaDesc(v,d);const E=this.findFirstClosedMedia(e);if(E){const w=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[w]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}mungRecvMediaDsec(e,t,r){const a=ur(e);return kM(a),Bg(a,t),OM(a,t),JH(a),DI(a,r,this.localCapabilities.send),a}mungSendMediaDesc(e,t){const r=ur(e);return DI(r,t,this.localCapabilities.recv),eE(r),r}updateRecvMedia(e,t){const r=this.sessionDesc.mediaDescriptions.findIndex(a=>a.attributes.mid===e);if(r!==-1){const a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],t);this.sessionDesc.mediaDescriptions[r]=a}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var r;return((r=t.attributes)===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>dr()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}};const sfe=["sdp"];var hr;function cY(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function Rf(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?cY(Object(r),!0).forEach(function(a){L(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cY(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}let lY=(hr=class TE extends DH{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,r,a){super(t,r),L(this,"direction",void 0),L(this,"name",void 0),L(this,"store",void 0),L(this,"spec",void 0),L(this,"peerConnection",void 0),L(this,"initialOffer",void 0),L(this,"transport",void 0),L(this,"statsFilter",void 0),L(this,"localCandidateCount",0),L(this,"_isInRestartIce",!1),L(this,"mutex",void 0),L(this,"onLocalCandidate",void 0),L(this,"remoteSDP",void 0),L(this,"pendingCandidates",[]),L(this,"localCapabilities",void 0),L(this,"isReady",!1),L(this,"restartCnt",0),L(this,"curTurnServerIndex",0),this.store=r,this.spec=t,this.mutex=new Ks("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(TE.resolvePCConfiguration(t,r.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=a??va.SEND_ONLY,this.name=this.direction===va.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=tI(this.peerConnection,z("STATS_UPDATE_INTERVAL"),void 0,dr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const r=await PM();if(this.localCapabilities=tw(r),t){const{sdp:a}=t,c=rfe(t,sfe),d=function(){const E={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},w=Zx(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},R={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},j={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Dl(w,E,"videoExtensions",S,R,j),Dl(w,E,"videoCodecs",S,R,j),Dl(w,E,"audioExtensions",S,R,j),Dl(w,E,"audioCodecs",S,R,j),z("RAISE_H264_BASELINE_PRIORITY")){const D=j.videoCodecs.findIndex(P=>P.rtpMap&&P.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&P.fmtp&&P.fmtp.parameters["profile-level-id"]==="42001f");if(D!==-1){const P=j.videoCodecs.findIndex(W=>W.rtpMap&&W.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(P<D){I.debug("raising H264 baseline profile priority");const W=j.videoCodecs[D];j.videoCodecs.splice(D,1),j.videoCodecs.splice(P,0,W)}P!==-1&&z("FILTER_SEND_H264_BASELINE")&&(S.videoCodecs=S.videoCodecs.filter(W=>!(W.rtpMap&&W.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&W.fmtp&&W.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:S,recv:R,sendrecv:j}}({},{},a);this.remoteSDP=new oY({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const f=Ru(h.sdp);await this.peerConnection.setLocalDescription(h);const m=await ZH({},{},h.sdp);this.localCapabilities=tw(m);const v=this.peerConnection.getTransceivers()[0];return v!=null&&v.receiver&&v.receiver.transport&&this.tryBindTransportEvents(v.receiver.transport),Rf(Rf({},f),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Ru(a.sdp);return this.initialOffer=a,Rf(Rf({},c),{},{sdp:a.sdp})}}catch(r){throw new we(K.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:r,iceParameters:a,dtlsParameters:c}=t,d=await ZH({},{},r);this.remoteSDP=new oY({remoteIceParameters:a,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(r){throw new we(K.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(r=>{this.peerConnection.addIceCandidate(r)}),this.pendingCandidates=[])}catch(r){throw new we(K.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(r.toString()))}}send(t,r,a){var c=this;return Da(function*(){const d=yield Ft(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],f=c.remoteSDP.receive(t,r,a);t.forEach((P,W)=>{if(f[W].needCreateTransceiver){const Y=c.peerConnection.addTransceiver(P._mediaStreamTrack,{direction:"sendonly"});h.push(Y),P._updateRtpTransceiver(Y)}else{const Y=c.peerConnection.getTransceivers().find(ne=>ne.mid===f[W].mid);if(!Y)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(f[W].mid));h.push(Y),P._updateRtpTransceiver(Y)}}),dr()&&z("SIMULCAST")===!0&&(yield Ft(c.applySimulcastForFirefox(h,t)));const m=f.map(P=>P.mid),v=yield Ft(c.peerConnection.createOffer()),E=c.mungSendOfferSDP(v.sdp,t,m),w=ma(E),S=m.map(P=>{const W=w.mediaDescriptions.find(Y=>Y.attributes.mid===P);if(!W)throw new Error("Cannot extract ssrc from mediaDescription.");return AM(W,z("USE_PUB_RTX"))}),R=h.map((P,W)=>{const Y=m[W];return{localSSRC:S[W],id:Y}});yield Ft(c.peerConnection.setLocalDescription({type:"offer",sdp:E}));try{yield R}catch(P){const W=c.remoteSDP.toString();throw yield Ft(c.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield Ft(c.peerConnection.setRemoteDescription({type:"answer",sdp:W})),yield Ft(c.stopSending(m,!0)),P}yield Ft(c.applySimulcastEncodings(h,t)),yield Ft(c.applySendEncodings(h,t));const j=c.remoteSDP.toString(),D=c.logSDPExchange(E,"offer","local","send");return D==null||D(j),yield Ft(c.setRemoteDescription({type:"answer",sdp:j})),h.map((P,W)=>{const Y=m[W];return{localSSRC:S[W],id:Y}})}catch(h){throw h instanceof we?h:new we(K.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}async stopSending(t,r){const a=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(m=>t.indexOf(m.mid)!==-1);if(c.length!==t.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));c.map(m=>{var v;m.direction="inactive",(v=m.stop)===null||v===void 0||v.call(m)});const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(t);const f=this.remoteSDP.toString();h==null||h(f),await this.setRemoteDescription({type:"answer",sdp:f})}catch(c){throw new we(K.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{a&&a()}}async receive(t,r,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(t,r,a,c);if(h){const m=this.remoteSDP.toString(),v=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const E=await this.peerConnection.createAnswer(),w=this.mungReceiveAnswerSDP(E.sdp,d,t);v==null||v(w||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:w}),I.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else I.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const f=this.peerConnection.getTransceivers().find(m=>m.mid===d);if(!f||f.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:f.receiver.track,mid:f.mid,transceiver:f}}catch(d){throw new we(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async mockReceive(t,r,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(t,r,a,c);if(h){const f=this.remoteSDP.toString(),m=this.logSDPExchange(f,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:f});const v=await this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(v.sdp,d,t);m==null||m(E||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:E}),I.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else I.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(d){throw new we(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const r=this.remoteSDP.toString(),a=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:r});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new we(K.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===Ig.Auto&&(this.store.p2pTransport=Ig.SdRtn,Zt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(TE.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Zt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(TE.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const r=await this.peerConnection.createOffer({iceRestart:!0});if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:a}=Ru(r.sdp);return this.store.descriptionStart(),this.direction===va.SEND_ONLY&&await this.peerConnection.setLocalDescription(r),a}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===va.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const r=await this.peerConnection.createAnswer();if(!r.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:a}=Ru(r.sdp);return await this.peerConnection.setLocalDescription(r),a}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(r){throw new we(K.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);const d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new we(K.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(t,r){const a=this.peerConnection.getTransceivers().filter(c=>c.mid===t);a.length===1&&(this.isVP8Simulcast(r)?dr()||await this.applySimulcastEncodings(a,[r]):await this.applySendEncodings(a,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){const a=this.peerConnection.getTransceivers().find(c=>c.mid===r);a&&await a.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const r=t[0].transport.iceTransport,{local:a,remote:c}=r.getSelectedCandidatePair();return{local:Rf(Rf({},Cl),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:Rf(Rf({},Cl),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,r;ke(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var r;t.candidate.candidate&&((r=this.onLocalCandidate)===null||r===void 0||r.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,r){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var d;return t.iceServers?c.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(wg(t.turnServer.servers)?c.iceServers=t.turnServer.servers:(c.iceServers&&c.iceServers.push(...TE.turnServerConfigToIceServers(t.turnServer.servers,r,a)),z("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&t.turnServer.serversFromGateway&&c.iceServers.push(...TE.turnServerConfigToIceServers(t.turnServer.serversFromGateway,r,a)),ke(d=[Ig.Relay,Ig.SdRtn]).call(d,r)&&(c.iceTransportPolicy="relay"),z("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),z("ENABLE_ENCODED_TRANSFORM")&&Zt().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),I.debug("P2PConnection p2pTransport is ".concat(r)),c}static turnServerConfigToIceServers(t,r){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],d=t.filter(f=>f.tcpport);I.debug("P2PConnection turnServers is ".concat(d,", current index is ").concat(a));const h=d.length>a?d[a]:d[0];switch(r){case Ig.SdRtn:const f=t.filter(v=>{var E;return ke(E=v.username).call(E,"glb:")&&v.turnServerURL==v.turnServerURL}),m=f.length>a?f[a]:f[0];m&&(c.push({username:m.username,credential:m.password,credentialType:"password",urls:"turn:".concat(Ol(m.turnServerURL),":").concat(m.tcpport,"?transport=udp")}),c.push({username:m.username,credential:m.password,credentialType:"password",urls:"turns:".concat(Ol(m.turnServerURL),":").concat(m.tcpport,"?transport=tcp")}));break;case Ig.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Ol(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Ol(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var a;t!=null&&t.state&&((a=this.onDTLSTransportStateChange)===null||a===void 0||a.call(this,t.state))},t.onerror=a=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in a?a.error:a)};const r=t.iceTransport;r&&(r.onstatechange=()=>{const a=t==null?void 0:t.iceTransport.state;var c;a&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,a))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:a,remote:c}=r.getSelectedCandidatePair()||{};if(a&&c){const d=a.address+":"+a.port,h=c.address+":"+c.port;I.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Tu(d)),", remote ").concat(JSON.stringify(Tu(h))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var a;if(r||(r=this.peerConnection.getSenders().find(E=>E.track===t._mediaStreamTrack)),!r)return I.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return I.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Zt().supportSetRtpSenderParameters)return I.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},d={};switch(t._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(t._encoderConfig){var h;const{bitrateMax:E,frameRate:w,scaleResolutionDownBy:S}=t._encoderConfig;E&&(d.maxBitrate=1e3*E),ke(h=t._hints).call(h,Pn.LOW_STREAM)&&(w&&(d.maxFramerate=Ua(w)),S&&S>=1&&(d.scaleResolutionDownBy=S))}if(z("DSCP_TYPE")&&yu()){var f;const E=z("DSCP_TYPE");ke(f=["very-low","low","medium","high"]).call(f,E)&&(d.networkPriority=E)}const m=r.getParameters(),v=(a=m.encodings)===null||a===void 0?void 0:a[0];dr()&&!v&&(c.encodings=[d]),v&&Object.assign(v,d),Object.assign(m,c),I.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await r.setParameters(m)}async applySendEncodings(t,r){try{if(!Zt().supportSetRtpSenderParameters||t.length!==r.length)return;for(let a=0;a<t.length;a++){const c=t[a],d=r[a];d instanceof Jn&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{I.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,a){const c=ma(t);return r.forEach((d,h)=>{const f=a[h],m=c.mediaDescriptions.find(v=>v.attributes.mid===f);m&&(Bg(m,d),DM(m,d,this.store.codec))}),kh(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let m=0;m<t.length;m++){var a,c,d,h,f;const v=t[m],E=r[m];if(E instanceof Jn&&!ke(a=E._hints).call(a,Pn.LOW_STREAM)&&(c=E._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=E._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=E._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((f=E._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1&&this.store.codec==="vp8"){const w={},S={high:1e3*(E._encoderConfig.bitrateMax-50),medium:5e4};w.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];const R=v.sender.getParameters();await v.sender.setParameters(Object.assign(R,w))}}}async applySimulcastEncodings(t,r){if(!dr()&&t.length===r.length)for(let a=0;a<t.length;a++){const c=r[a];if(c instanceof Jn&&this.isVP8Simulcast(c)){const d=t[a],h={},f={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:f.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:f.medium,scaleResolutionDownBy:4}];const m=d.sender.getParameters();await d.sender.setParameters(Object.assign(m,h))}}}isVP8Simulcast(t){var r,a,c,d,h;return!!(t instanceof Jn&&z("SIMULCAST")&&this.store.codec==="vp8"&&!ke(r=t._hints).call(r,Pn.LOW_STREAM)&&(a=t._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=t._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=t._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=t._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(t,r,a,c){if(z("SDP_LOGGING"))return I.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(r," SDP during P2PConnection.").concat(c,`
`),t),r==="offer"?d=>{this.logSDPExchange(d,"answer",a==="local"?"remote":"local",c)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(h=>{h.direction="inactive"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(t);const d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(r){throw new we(K.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(async h=>{h.direction="sendonly"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(t);const d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(r){throw new we(K.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}async getRemoteSSRC(t,r){var a;if(r=r??((a=this.currentRemoteDescription)===null||a===void 0?void 0:a.sdp)){var c;const d=(c=ma(r).mediaDescriptions.find(h=>h.attributes.mid===t))===null||c===void 0?void 0:c.attributes.ssrcs;return d==null?void 0:d[0].ssrcId}}async setRemoteDescription(t){var r;await this.peerConnection.setRemoteDescription(t),ke(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,r,a){const c=ma(t),d=c.mediaDescriptions.find(h=>h.attributes.mid===r);return d&&a===Je.AUDIO&&d.media.mediaType==="audio"&&eE(d),kh(c)}},Fe(hr.prototype,"establish",[Ul],Object.getOwnPropertyDescriptor(hr.prototype,"establish"),hr.prototype),Fe(hr.prototype,"connect",[Ul],Object.getOwnPropertyDescriptor(hr.prototype,"connect"),hr.prototype),Fe(hr.prototype,"receive",[Ul],Object.getOwnPropertyDescriptor(hr.prototype,"receive"),hr.prototype),Fe(hr.prototype,"mockReceive",[Ul],Object.getOwnPropertyDescriptor(hr.prototype,"mockReceive"),hr.prototype),Fe(hr.prototype,"stopReceiving",[Ul],Object.getOwnPropertyDescriptor(hr.prototype,"stopReceiving"),hr.prototype),Fe(hr.prototype,"restartICE",[Ul],Object.getOwnPropertyDescriptor(hr.prototype,"restartICE"),hr.prototype),Fe(hr.prototype,"close",[Ul],Object.getOwnPropertyDescriptor(hr.prototype,"close"),hr.prototype),Fe(hr.prototype,"updateEncoderConfig",[Ul],Object.getOwnPropertyDescriptor(hr.prototype,"updateEncoderConfig"),hr.prototype),Fe(hr.prototype,"updateSendParameters",[Ul],Object.getOwnPropertyDescriptor(hr.prototype,"updateSendParameters"),hr.prototype),Fe(hr.prototype,"replaceTrack",[Ul],Object.getOwnPropertyDescriptor(hr.prototype,"replaceTrack"),hr.prototype),Fe(hr.prototype,"muteLocal",[Ul],Object.getOwnPropertyDescriptor(hr.prototype,"muteLocal"),hr.prototype),Fe(hr.prototype,"unmuteLocal",[Ul],Object.getOwnPropertyDescriptor(hr.prototype,"unmuteLocal"),hr.prototype),hr);function Ul(e,t,r){const a=e[t];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this.mutex,d=await c.lock("From P2PConnection.".concat(t));try{for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];return await a.apply(this,f)}finally{d()}},r}let Id=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var dY,uY,hY,pY,fY,mY,gY,_Y,vY,EY,yY,Rr;function bY(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function mA(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?bY(Object(r),!0).forEach(function(a){L(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bY(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}let ife=(dY=Ad(Id.SEND_ONLY),uY=Ad(Id.SEND_ONLY),hY=Ad(),pY=Ad(Id.RECEIVE_ONLY),fY=Ad(Id.RECEIVE_ONLY),mY=Ad(Id.RECEIVE_ONLY),gY=Ad(Id.RECEIVE_ONLY),_Y=Ad(Id.RECEIVE_ONLY),vY=Ad(Id.RECEIVE_ONLY),EY=Ad(),yY=Ad(Id.RECEIVE_ONLY),Rr=class extends br{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(dt.StateChange,t,this._state)}constructor(e,t){super(),L(this,"isPlanB",!1),L(this,"store",void 0),L(this,"statsUploader",void 0),L(this,"sendConnection",void 0),L(this,"recvConnection",void 0),L(this,"localTrackMap",new Map),L(this,"remoteUserMap",new Map),L(this,"localDataChannels",[]),L(this,"pendingLocalTracks",[]),L(this,"pendingRemoteTracks",[]),L(this,"statsCollector",void 0),L(this,"dtlsFailedCount",0),L(this,"sendMutex",void 0),L(this,"recvMutex",void 0),L(this,"_state",An.Disconnected),L(this,"_restartStates",["disconnected","failed"]),L(this,"reconnectInterval",void 0),L(this,"uploadUnplinkStarted",!1),L(this,"uploadDownlinkStarted",!1),L(this,"uplinkStateUploadInterval",void 0),L(this,"downlinkStatsUploadInterval",void 0),L(this,"handleMuteLocalTrack",async(r,a,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==An.Connected)return void c(new we(K.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const m=this.filterTobeMutedTracks(r);if(m.length===0)return void a();const v=m.find(R=>R[0]==="videoLowTrack");v&&v[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(m.map(R=>{let[,{id:j}]=R;return j}));let E=!1;var h,f;r.trackMediaType==="video"?E=!((h=this.localTrackMap.get(De.LocalAudioTrack))===null||h===void 0||!h.track._muted):E=((f=this.localTrackMap.get(De.LocalVideoTrack))===null||f===void 0?void 0:f.id)===void 0;const w=this.createMuteMessage(m);await er(this,dt.RequestMuteLocal,w);const S=r.trackMediaType==="video"?ff.MUTE_LOCAL_VIDEO:ff.MUTE_LOCAL_AUDIO;await er(this,dt.RequestP2PMuteLocal,{action:S,message:w,isMuteAll:E}),a()}catch(m){c(m)}finally{d()}}),L(this,"handleUnmuteLocalTrack",async(r,a,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==An.Connected)return void c(new we(K.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(r);if(h.length===0)return void a();await this.sendConnection.unmuteLocal(h.map(v=>{let[,{id:E}]=v;return E}));const f=this.createUnmuteMessage(h),m=r.trackMediaType==="video"?ff.UNMUTE_LOCAL_VIDEO:ff.UNMUTE_LOCAL_AUDIO;await er(this,dt.RequestP2PMuteLocal,{action:m,message:f}),a()}catch(h){c(h)}finally{d()}}),L(this,"handleUpdateVideoEncoder",async(r,a,c,d)=>{let h;typeof d=="boolean"&&d||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const m=this.localTrackMap.get(De.LocalVideoTrack);if(!this.sendConnection||!m||m.track!==r||this.state!==An.Connected)return void a();const{id:v,track:E}=m;v&&(await this.sendConnection.updateSendParameters(v,E),await this.sendConnection.updateEncoderConfig(v,E),this.emit(dt.UpdateVideoEncoder,E)),a()}catch(m){c(m)}finally{var f;(f=h)===null||f===void 0||f()}}),L(this,"handleUpdateVideoSendParameters",async(r,a,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(De.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==r||this.state!==An.Connected)return void a();const{id:f,track:m}=h;f&&await this.sendConnection.updateSendParameters(f,m),a()}catch(h){c(h)}finally{d()}}),L(this,"handleReplaceTrack",async(r,a,c,d)=>{let h;I.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var f;const v=Array.from(this.localTrackMap.entries()).find(E=>{let[,{track:w}]=E;return r===w});if(!this.sendConnection||!v||v[1].id===void 0||this.state!==An.Connected)return void a();if(await((f=this.sendConnection)===null||f===void 0?void 0:f.replaceTrack(r,v[1].id)),v[0]===De.LocalVideoTrack&&Zt().supportDualStreamEncoding){const E=this.localTrackMap.get(De.LocalVideoLowTrack);if(E){const w=r._mediaStreamTrack.clone();E.track._originMediaStreamTrack.stop(),E.track._mediaStreamTrack=w,E.track._originMediaStreamTrack=w,await new Ue((S,R)=>{this.handleReplaceTrack(E.track,S,R,!0)})}}a()}catch(v){c(v)}finally{var m;(m=h)===null||m===void 0||m()}}),L(this,"handleGetLocalVideoStats",r=>{r(this.statsCollector.getLocalVideoTrackStats())}),L(this,"handleGetLocalAudioStats",r=>{r(this.statsCollector.getLocalAudioTrackStats())}),L(this,"handleGetRemoteVideoStats",r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid]),L(this,"handleGetRemoteAudioStats",r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new L7(e),this.bindStatsUploaderEvents(),this.sendMutex=new Ks("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Ks("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(r=>{r&&(r.iceConnectionState!=="disconnected"&&r.iceConnectionState!=="failed"||this.handleDisconnect(r.direction))})},z("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new we(K.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new we(K.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let r;try{if(t){this.recvConnection&&(I.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),r=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new lY(e,this.store,va.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const a=await this.recvConnection.establish(t);return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}{this.state=An.New,this.sendConnection&&(I.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),r=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new lY(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const a=await this.sendConnection.establish();return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}}finally{r&&r()}}async p2pConnect(e){if(!this.sendConnection)throw new we(K.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=An.Connected}async addRemoteCandidate(e,t){if(t===va.RECEIVE_ONLY){if(!this.sendConnection)throw new we(K.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new we(K.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,r){var a=this;return Da(function*(){const c=yield Ft(a.sendMutex.lock("From P2PChannel.publish"));try{if(!a.sendConnection||a.state!==An.Connected){a.throwIfTrackTypeNotMatch(e);const v=e.filter(E=>a.pendingLocalTracks.indexOf(E)===-1);return void(a.pendingLocalTracks=a.pendingLocalTracks.concat(v))}a.store.pubId=a.store.pubId+1,Ii.markPublishStart(a.store.clientId,a.store.pubId);const d=a.filterTobePublishedTracks(e,t,r);if(d.length===0)return void(yield Ft(a.tryToUnmuteAudio(e)));d.forEach(v=>{let{track:E,type:w}=v;const S=Date.now();a.store.publish(E.getTrackId(),w===De.LocalAudioTrack?"audio":"video",S)}),a.bindLocalTrackEvents(d);const h=yield Ft(a.sendConnection.send(d.map(v=>{let{track:E}=v;return E}),a.store.codec,a.store.audioCodec)),f=(yield Ft(h.next())).value,m=a.createGatewayPublishMessage(d,f);try{yield m}catch(v){throw h.throw(v),(v==null?void 0:v.code)===K.WS_ABORT&&d.forEach(E=>{let{track:w}=E;a.pendingLocalTracks.indexOf(w)===-1&&a.pendingLocalTracks.push(w)}),a.unbindLocalTrackEvents(d),v}yield Ft(h.next()),d.forEach(v=>{let{type:E}=v;a.statsCollector.addLocalStats(E)}),a.statsUploader.startUploadOutboundStats(),a.assignLocalTracks(d,f),d.forEach(v=>{let{track:E,type:w}=v;const S=Date.now();a.store.publish(E.getTrackId(),w===De.LocalAudioTrack?"audio":"video",void 0,S)}),a.startUploadUplinkState()}finally{c()}})()}async unpublish(e){if(!this.sendConnection||this.state!==An.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!ke(e).call(e,c)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const r=t.find(c=>c[0]==="videoLowTrack");r&&r[1].track.close();const a=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(c=>{let[,{id:d}]=c;return d})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(c=>{let[d,{track:h}]=c;return{type:d,track:h}})),t.forEach(c=>{let[d]=c;this.statsCollector.removeLocalStats(d)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===An.Connected)return r&&r[1].track.close(),a;e.forEach(c=>{const d=this.pendingLocalTracks.indexOf(c);d!==-1&&this.pendingLocalTracks.splice(d,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],r=[];Array.from(this.localTrackMap.entries()).forEach(a=>{let[c,{track:d,ssrcs:h}]=a;const f={stream_type:que(d,c),ssrcs:h};d._muted||!d._enabled?t.push(f):r.push(f)}),t.length>0&&t.forEach(a=>{er(this,dt.RequestMuteLocal,[a])}),r.length>0&&r.forEach(a=>{er(this,dt.RequestUnmuteLocal,[a])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Da(function*(){throw new we(K.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(I.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await _s(this,dt.RequestRePublish,this.pendingLocalTracks),this.emit(dt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new we(K.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,r,a){var c;if(!this.recvConnection)throw new we(K.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(t))return;const{track:d,mid:h,transceiver:f}=await this.recvConnection.receive(t,[{ssrcId:r}],String(e.uid),a);t===Je.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(d):(e._audioTrack=new Kv(d,e.uid,e._uintid,this.store),I.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),f&&e._audioTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=r,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(d):(e._videoTrack=new Hv(d,e.uid,e._uintid,this.store),I.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),f&&e._videoTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(e,e._videoTrack));const m=this.remoteUserMap.get(e);m?m.set(t,h):this.remoteUserMap.set(e,new Map([[t,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const v=this.pendingRemoteTracks.findIndex(E=>{let{user:w,kind:S}=E;return w.uid===e.uid&&t===S});v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit(dt.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,r,a){if(!this.recvConnection)throw new we(K.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:r}],String(e.uid),a)}async unsubscribe(e,t,r){const a=this.pendingRemoteTracks.filter(d=>{let{user:h,kind:f}=d;return t!==void 0?h.uid===e.uid&&t===f:h.uid===e.uid});if(a.forEach(d=>{const h=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||r||a.forEach(d=>{let{kind:h}=d;var f;if(h===Je.AUDIO)(f=e._audioTrack)===null||f===void 0||f._destroy(),e._audioTrack=void 0;else if(h===Je.VIDEO){var m;(m=e._videoTrack)===null||m===void 0||m._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(e,t);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(d=>{let[,{id:h}]=d;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(d=>{let[h,{kind:f}]=d;var m,v;if(f===Je.VIDEO&&h._videoSSRC&&((m=this.recvConnection)===null||m===void 0||m.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),f===Je.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),r||((v=h._videoTrack)===null||v===void 0||v._destroy(),h._videoTrack=void 0);else if(f===Je.AUDIO){var E;this.unbindRemoteTrackEvents(h._audioTrack),!r&&((E=h._audioTrack)===null||E===void 0||E._destroy(),h._audioTrack=void 0)}}),c.forEach(d=>{let[,{kind:h}]=d;er(this,dt.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,r]=t;[Je.VIDEO,Je.AUDIO].forEach(a=>{r.has(a)?er(this,dt.RequestP2PUnmuteRemote,a):er(this,dt.RequestP2PMuteRemote,a)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new we(K.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new we(K.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new we(K.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new we(K.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const r=this.remoteUserMap.get(e);if(!r)return void I.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void I.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const a=t===Je.VIDEO?e._videoSSRC:e._audioSSRC;a!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const r=this.remoteUserMap.get(e);if(!r)return void I.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||I.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(De.LocalAudioTrack);if((t==null?void 0:t.track)instanceof bs){const r=t.track;return Array.from(this.localTrackMap.entries()).filter(a=>{let[c]=a;return c!==De.LocalAudioTrack}).filter(a=>{let[c]=a;return!(e&&c===De.LocalVideoLowTrack)}).map(a=>{let[,{track:c}]=a;return c}).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter(r=>{let[a]=r;return!(e&&a===De.LocalVideoLowTrack)}).map(r=>{let[,{track:a}]=r;return a})}reportPublishEvent(e,t,r,a,c){if(e){const h=this.localTrackMap.get(De.LocalAudioTrack),f=a?this.localTrackMap.get(De.LocalVideoLowTrack):this.localTrackMap.get(De.LocalVideoTrack);tt.publish(this.store.sessionId,{eventElapse:Ii.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:f==null?void 0:f.track.getTrackLabel(),screenshare:(f==null?void 0:f.track._hints.indexOf(Pn.SCREEN_TRACK))!==-1,audio:!!h,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;r||(r=[]);const h=r.find(m=>m instanceof Xr),f=a?(d=this.localTrackMap.get(De.LocalVideoTrack))===null||d===void 0?void 0:d.track:r.find(m=>m instanceof Jn);tt.publish(this.store.sessionId,{eventElapse:Ii.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h==null?void 0:h.getTrackLabel(),videoName:f==null?void 0:f.getTrackLabel(),screenshare:(f==null?void 0:f._hints.indexOf(Pn.SCREEN_TRACK))!==-1,audio:!!h,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,t,r,a){const c=a===Je.VIDEO?r._videoSSRC:r._audioSSRC;c&&tt.subscribe(this.store.sessionId,{succ:e,ec:t,video:a===Je.VIDEO,audio:a===Je.AUDIO,peerid:r.uid,subscribeRequestid:a===Je.VIDEO?r._videoSSRC:r._audioSSRC,p2pid:this.store.p2pId,eventElapse:Ii.measureFromSubscribeStart(this.store.clientId,c)})}reset(){I.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Ks("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Ks("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(De.LocalAudioTrack);if((e==null?void 0:e.track)instanceof bs){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(r=>{t.removeAudioTrack(r)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=An.Disconnected}getStats(e){var t,r;return e?(r=this.recvConnection)===null||r===void 0?void 0:r.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(De.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(De.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Jn||t&&t.track instanceof Xr?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;const r=Array.from(Ui(t=this.remoteUserMap).call(t)).find(a=>a.uid===e);return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(r=>{let[a]=r;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(De.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Th(e).call(e,(r,a)=>r.level-a.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(I.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=An.Reconnecting,z("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var r;t._videoTrack&&t._videoTrack._player&&((r=t._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[r,{track:a}]=e;switch(r){case De.LocalVideoTrack:ke(t=a._hints).call(t,Pn.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case De.LocalAudioTrack:a instanceof bs?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case De.LocalVideoLowTrack:}}),this.emit(dt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;Array.from(Ui(r).call(r)).forEach(a=>{this.setPendingRemoteMedia(t,a)}),this.emit(dt.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),I.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const r of this.pendingRemoteTracks){const{user:a,kind:c}=r;if((e instanceof _f?e.uid:e)===a.uid&&t===c)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let r,a;if(e===va.SEND_ONLY){if(!this.sendConnection)throw new we(K.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");r=await this.sendMutex.lock("From P2PChannel.restartICE"),a=this.sendConnection}else{if(!this.recvConnection)throw new we(K.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");r=await this.recvMutex.lock("From P2PChannel.restartICE"),a=this.recvConnection}try{if(t){const c=await a.restartICE(t);return a.isInRestartIce=!1,c}{const c=await a.restartICE();if(c){const d=await _s(this,dt.RequestP2PRestartICE,{direction:va.RECEIVE_ONLY,iceParameter:c});await a.restartICE(d),a.isInRestartIce=!1}}}finally{r()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(De.LocalVideoTrack),r=this.localTrackMap.get(De.LocalAudioTrack),a=e.videoSend.find(R=>{var j;return R.ssrc===(t==null||(j=t.ssrcs)===null||j===void 0?void 0:j[0].ssrcId)}),c=e.audioSend.find(R=>{var j;return R.ssrc===(r==null||(j=r.ssrcs)===null||j===void 0?void 0:j[0].ssrcId)});if(!a||!c)return 1;const d=Oo(this,dt.NeedSignalRTT),h=a?a.rttMs:void 0,f=c?c.rttMs:void 0,m=h&&f?(h+f)/2:h||f,v=(m&&d?(m+d)/2:m||d)||0,E=100*e.sendPacketLossRate*.7/50+.3*v/1500,w=E<.17?1:E<.36?2:E<.59?3:E<.1?4:5,S=t==null?void 0:t.track;if(S&&S._encoderConfig&&S._hints.indexOf(Pn.SCREEN_TRACK)===-1){const R=S._encoderConfig.bitrateMax,j=e.bitrate.actualEncoded;if(R&&j){const D=(1e3*R-j)/(1e3*R);return TH[D<.15?0:D<.3?1:D<.45?2:D<.6?3:4][w]}}return w}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(r=>{let[a]=r;const c=a._audioSSRC,d=a._videoSSRC,h=e.audioRecv.find(j=>j.ssrc===c),f=e.videoRecv.find(j=>j.ssrc===d);if(!h&&!f)return void(t+=1);const m=Oo(this,dt.NeedSignalRTT),v=e.rtt,E=(v&&m?(v+m)/2:v||m)||0,w=h?h.jitterMs:void 0,S=e.recvPacketLossRate;let R=.7*S*100/50+.3*E/1500;w&&(R=.6*S*100/50+.2*E/1500+.2*w/400),t+=R<.1?1:R<.17?2:R<.36?3:R<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Ue((t,r)=>{this.handleMuteLocalTrack(e,t,r)})}filterTobePublishedTracks(e,t,r){const a=[],c=Zt(),d=this.getAllTracks();e=Ov(e=e.filter(m=>d.indexOf(m)===-1));let h=!1,f=!1;for(const m of e){if(m instanceof Jn&&(this.localTrackMap.has(De.LocalVideoTrack)||h?new we(K.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:m,type:De.LocalVideoTrack}),h=!0),t)){const v=this.getLowVideoTrack(m,r);a.push({track:v,type:De.LocalVideoLowTrack})}if(m instanceof Xr){const v=this.localTrackMap.get(De.LocalAudioTrack);if(v){if(!(v.track instanceof bs))throw new we(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new we(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(m),this.bindLocalAudioTrackEvents(m,!0)}else if(f){const E=a.find(w=>{let{type:S}=w;return S===De.LocalAudioTrack});if(!(E.track instanceof bs))throw new we(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new we(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(m)}else{if(!c.webAudioMediaStreamDest||m instanceof bs||m._bypassWebAudio)a.push({track:m,type:De.LocalAudioTrack});else{const E=new bs;E.addAudioTrack(m),a.push({track:E,type:De.LocalAudioTrack})}f=!0}}}return a}filterTobeUnpublishedTracks(e){const t=[],r=this.getAllTracks();e=Ov(e=e.filter(a=>r.indexOf(a)!==-1));for(const a of e){if(a instanceof Xr){const c=this.localTrackMap.get(De.LocalAudioTrack);if(!c)continue;c.track instanceof bs?(c.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),c.track.trackList.length===0&&(t.push([De.LocalAudioTrack,c]),c.track.close())):t.push([De.LocalAudioTrack,c])}if(a instanceof Jn){const c=this.localTrackMap.get(De.LocalVideoTrack);if(!c)continue;t.push([De.LocalVideoTrack,c]);const d=this.localTrackMap.get(De.LocalVideoLowTrack);d&&t.push([De.LocalVideoLowTrack,d])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:r,type:a}=t;switch(a){case De.LocalVideoTrack:r.addListener(nt.GET_STATS,this.handleGetLocalVideoStats),r.addListener(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(nt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener(nt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener(nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case De.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case De.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof bs?e.trackList.forEach(r=>{r.addListener(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(nt.GET_STATS,this.handleGetLocalAudioStats),r.addListener(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(nt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(nt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[r,{track:a}]=t;return{track:a,type:r}})),e.forEach(t=>{let{track:r,type:a}=t;switch(a){case De.LocalVideoTrack:r.off(nt.GET_STATS,this.handleGetLocalVideoStats),r.off(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(nt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off(nt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off(nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case De.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case De.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof bs?e.trackList.forEach(t=>{t.off(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(nt.GET_STATS,this.handleGetLocalAudioStats),t.off(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(nt.GET_STATS,this.handleGetLocalAudioStats),e.off(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Hv&&t.addListener(nt.GET_STATS,r=>{r(this.handleGetRemoteVideoStats(e))}),t instanceof Kv&&t.addListener(nt.GET_STATS,r=>{r(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(nt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;r.has(Je.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has(Je.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((r,a)=>{var c;let d,{track:h,type:f}=r;switch(f){case De.LocalAudioTrack:d=Un.Audio;break;case De.LocalVideoTrack:d=ke(c=h._hints).call(c,Pn.SCREEN_TRACK)?Un.Screen:Un.High;break;case De.LocalVideoLowTrack:d=Un.Low}return{kind:f===De.LocalAudioTrack?Je.AUDIO:Je.VIDEO,stream_type:d,mid:t[a].id,ssrcs:t[a].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var r;let a,[c,{track:d,ssrcs:h,id:f}]=t;switch(c){case De.LocalVideoTrack:a=ke(r=d._hints).call(r,Pn.SCREEN_TRACK)?Un.Screen:Un.High;break;case De.LocalAudioTrack:a=Un.Audio;break;case De.LocalVideoLowTrack:a=Un.Low}return{stream_type:a,ssrcs:h,mid:f}})}assignLocalTracks(e,t){e.forEach((r,a)=>{let{track:c,type:d}=r;this.localTrackMap.set(d,{track:c,id:t[a].id,ssrcs:t[a].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[r]=t;this.localTrackMap.delete(r)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var r;I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(dt.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),ke(r=this._restartStates).call(r,t)&&!e.isInRestartIce&&(t==="disconnected"&&await Ds(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),tt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:$n.TRACER}).onSuccess(),this.emit(dt.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var r;const a=Array.from(Ui(r=this.remoteUserMap).call(r)).find(d=>d._audioSSRC===t);var c;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(c=a.audioTrack)===null||c===void 0||c.emit(Dc.FIRST_FRAME_DECODED),tt.firstRemoteFrame(this.store.sessionId,ys.FIRST_AUDIO_DECODE,vr.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:Ii.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var r;const a=Array.from(Ui(r=this.remoteUserMap).call(r)).find(c=>c._audioSSRC===t);a&&tt.firstRemoteFrame(this.store.sessionId,ys.FIRST_AUDIO_RECEIVED,vr.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:Ii.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,r,a)=>{this.reportVideoFirstFrameDecoded(t,r,a)},e.onFirstVideoReceived=t=>{var r;const a=Array.from(Ui(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);a&&tt.firstRemoteFrame(this.store.sessionId,ys.FIRST_VIDEO_RECEIVED,vr.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:Ii.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,r)=>{const a=t.candidateType==="relay",c=r.candidateType==="relay";r.candidateType!=="unknown"&&a===c||this.emit(dt.ConnectionTypeChange,a),I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(mf(r))," -> ").concat(JSON.stringify(mf(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,r)=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(mf(r))," -> ").concat(JSON.stringify(mf(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(dt.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===va.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,I.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===va.SEND_ONLY?this.restartICE(e):_s(this,dt.RequestP2PRestartICE,{direction:va.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const r=this.localTrackMap.get(De.LocalAudioTrack);if(e instanceof Xr&&(r==null?void 0:r.track)instanceof bs)return r.track.isActive||t.push([De.LocalAudioTrack,r]),t;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return e===d});if(a&&(t.push(a),a[0]===De.LocalVideoTrack)){const c=this.localTrackMap.get(De.LocalVideoLowTrack);c&&t.push([De.LocalVideoLowTrack,c])}return t}filterTobeUnmutedTracks(e){const t=[],r=this.localTrackMap.get(De.LocalAudioTrack);if(e instanceof Xr&&(r==null?void 0:r.track)instanceof bs)return r.track.isActive&&t.push([De.LocalAudioTrack,r]),t;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return e===d});if(a)if(a[0]===De.LocalVideoTrack){t.push(a);const c=this.localTrackMap.get(De.LocalVideoLowTrack);c&&t.push([De.LocalVideoLowTrack,c])}else t.push(a);return t}createMuteMessage(e){return e.map(t=>{var r;let a,[c,{track:d,ssrcs:h,id:f}]=t;switch(c){case De.LocalAudioTrack:a=Un.Audio;break;case De.LocalVideoTrack:a=ke(r=d._hints).call(r,Pn.SCREEN_TRACK)?Un.Screen:Un.High;break;case De.LocalVideoLowTrack:a=Un.Low}return{stream_type:a,ssrcs:h,mid:f}})}createUnmuteMessage(e){return e.map(t=>{var r;let a,[c,{track:d,ssrcs:h,id:f}]=t;switch(c){case De.LocalAudioTrack:a=Un.Audio;break;case De.LocalVideoTrack:a=ke(r=d._hints).call(r,Pn.SCREEN_TRACK)?Un.Screen:Un.High;break;case De.LocalVideoLowTrack:a=Un.Low}return{stream_type:a,ssrcs:h,mid:f}})}filterTobeUnSubscribedTracks(e,t){const r=[],a=this.remoteUserMap.get(e);if(!a)return r;if(t){const c=a.get(t);if(!c)return r;r.push([e,{kind:t,id:c}])}else Array.from(a.entries()).forEach(c=>{let[d,h]=c;r.push([e,{kind:d,id:h}])});return r}createUnsubscribeMessage(e){const t=[];return e.forEach(r=>{let[a,{kind:c,id:d}]=r;switch(c){case Je.VIDEO:return void(a._videoSSRC&&t.push({stream_type:Je.VIDEO,ssrcId:a._videoSSRC}));case Je.AUDIO:return void(a._audioSSRC&&t.push({stream_type:Je.AUDIO,ssrcId:a._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[r,{kind:a}]=t;const c=this.remoteUserMap.get(r);c&&(c.delete(a),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(r))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(De.LocalVideoTrack),r=this.localTrackMap.get(De.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new Ue((a,c)=>{this.handleUpdateVideoEncoder(t.track,a,c,!0)})),r&&e.low_stream_uplink&&(await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Ue((a,c)=>{this.handleUpdateVideoEncoder(r.track,a,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Xr){const r=this.filterTobeUnmutedTracks(e[t]);if(r.length===0)continue;const a=this.createUnmuteMessage(r);return void await er(this,dt.RequestUnmuteLocal,a)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(dt.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(dt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Ds(JN(this.dtlsFailedCount,ls)),this.emit(dt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(De.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Jn)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Jn).length>1)throw new we(K.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Xr).length>1&&(e.some(t=>t instanceof Xr&&t._bypassWebAudio)||!Zt().webAudioMediaStreamDest))throw new we(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Jn&&this.pendingLocalTracks.some(r=>r instanceof Jn))throw new we(K.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Xr&&this.pendingLocalTracks.some(r=>r instanceof Xr)&&(!Zt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(r=>r instanceof Xr&&r._bypassWebAudio)))throw new we(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const r=!z("DISABLE_DUAL_STREAM_USE_ENCODING")&&Zt().supportDualStreamEncoding,a=mA(mA({},{width:160,height:120,framerate:15,bitrate:50}),t);let c;c=r?e._mediaStreamTrack.clone():ZM(e,a);const d=jn(8,"track-low-"),h=new Jn(c,mA(mA({},r&&{scaleResolutionDownBy:IM(a,e)}),{},{frameRate:a.framerate,bitrateMax:a.bitrate,bitrateMin:a.bitrate}),void 0,void 0,d);return h.on(Og.TRANSCEIVER_UPDATED,f=>{e._updateRtpTransceiver(f,Vv.LOW_STREAM)}),h._hints.push(Pn.LOW_STREAM),e.addListener(nt.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,r,a){var c;const d=Array.from(Ui(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(d){a||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,f=h.subscribe.find(m=>m.userId===d.uid&&m.type==="video");tt.firstRemoteVideoDecode(this.store.sessionId,ys.FIRST_VIDEO_DECODE,vr.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:t,videoheight:r,subscribeElapse:Ii.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(f==null?void 0:f.subscribeEnd)||0,subscriberStart:(f==null?void 0:f.subscribeStart)||0,videoAddNotify:(f==null?void 0:f.streamAdded)||0,state:a?1:0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.recvConnection)return!1;const a=this.remoteUserMap.get(e);if(!a)return!1;const c=a.get(t);if(!c)return!1;const d=await this.recvConnection.getRemoteSSRC(c);return d!==void 0&&d!==r}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new we(K.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new we(K.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new we(K.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new we(K.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new we(K.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new we(K.NOT_SUPPORTED)}async preConnect(e){throw new we(K.NOT_SUPPORTED)}getEstablishParams(){throw new we(K.NOT_SUPPORTED)}async reSubscribe(e){throw new we(K.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new we(K.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:r}]=e;t===De.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,Vv.LOW_STREAM):r._updateRtpTransceiver(void 0)})}},Fe(Rr.prototype,"p2pConnect",[dY],Object.getOwnPropertyDescriptor(Rr.prototype,"p2pConnect"),Rr.prototype),Fe(Rr.prototype,"unpublish",[uY],Object.getOwnPropertyDescriptor(Rr.prototype,"unpublish"),Rr.prototype),Fe(Rr.prototype,"unpublishLowStream",[hY],Object.getOwnPropertyDescriptor(Rr.prototype,"unpublishLowStream"),Rr.prototype),Fe(Rr.prototype,"subscribe",[pY],Object.getOwnPropertyDescriptor(Rr.prototype,"subscribe"),Rr.prototype),Fe(Rr.prototype,"mockSubscribe",[fY],Object.getOwnPropertyDescriptor(Rr.prototype,"mockSubscribe"),Rr.prototype),Fe(Rr.prototype,"unsubscribe",[mY],Object.getOwnPropertyDescriptor(Rr.prototype,"unsubscribe"),Rr.prototype),Fe(Rr.prototype,"muteRemote",[gY],Object.getOwnPropertyDescriptor(Rr.prototype,"muteRemote"),Rr.prototype),Fe(Rr.prototype,"unmuteRemote",[_Y],Object.getOwnPropertyDescriptor(Rr.prototype,"unmuteRemote"),Rr.prototype),Fe(Rr.prototype,"hasRemoteMediaWithLock",[vY],Object.getOwnPropertyDescriptor(Rr.prototype,"hasRemoteMediaWithLock"),Rr.prototype),Fe(Rr.prototype,"disconnectForReconnect",[EY],Object.getOwnPropertyDescriptor(Rr.prototype,"disconnectForReconnect"),Rr.prototype),Fe(Rr.prototype,"remoteMediaSsrcChanged",[yY],Object.getOwnPropertyDescriptor(Rr.prototype,"remoteMediaSsrcChanged"),Rr.prototype),Rr);function Ad(e){return function(t,r,a){const c=t[r];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return a.value=async function(){for(var d=arguments.length,h=new Array(d),f=0;f<d;f++)h[f]=arguments[f];switch(e){case Id.SEND_ONLY:{const m=await this.sendMutex.lock("From P2PChannel2.".concat(r));try{return await c.apply(this,h)}finally{m()}}case Id.RECEIVE_ONLY:{const m=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await c.apply(this,h)}finally{m()}}default:{const m=await this.sendMutex.lock("From P2PChannel2.".concat(r)),v=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await c.apply(this,h)}finally{m(),v()}}}},a}}class Zg extends br{constructor(t,r){super(),L(this,"signal",void 0),L(this,"token",void 0),L(this,"tokenTimeout",void 0),L(this,"tokenInterval",void 0),L(this,"_sequence",0),L(this,"userMap",new Map),L(this,"encoder",new TextEncoder),this.signal=t,this.token=r;const a=()=>{this.signal.connectionState===rn.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(a,1e3):this.tokenInterval=window.setTimeout(a,3*z("P2P_TOKEN_INTERVAL"))};a()}async send(t,r,a,c,d){var h;if(this.userMap.size===0)return;const f=Array.from(Oa(h=this.userMap).call(h))[0].token;typeof r!="string"&&(r=JSON.stringify(r)),c=c??jn(6,""),d=d??this._sequence++;const m={_id:c,_type:t,_seq:d,_message:r,token:"".concat(this.token,"_").concat(f)};z("SHOW_P2P_LOG")&&I.debug("send message",m,"noNeedResponse : ".concat(a)),this.splitMessage(JSON.stringify(m)).forEach(E=>{this.signal.request(lt.DATA_STREAM,{payload:df(this.encoder.encode(E))})});const v=new Ue((E,w)=>{const S=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),R),this.off("res-@".concat(c),D),this.off(Jv.ABORT,j),I.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(c)),this.userMap.size===0?w(new we(K.INVALID_REMOTE_USER)):w(new we(K.TIMEOUT))},z("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),R=()=>{S&&window.clearTimeout(S),this.off(Jv.ABORT,j),a&&E()},j=()=>{S&&window.clearTimeout(S),this.off("res-@".concat(c,"_ack"),R),this.off("res-@".concat(c),D),w(new we(K.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(c)))};this.once(Jv.ABORT,j),this.once("res-@".concat(c,"_ack"),R);const D=(W,Y)=>{P=!0,S&&window.clearTimeout(S),this.off("res-@".concat(c,"_ack"),R),this.off(Jv.ABORT,j),W==="success"?E(Y):w(new we(K.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(c)))};let P=!1;a||(this.once("res-@".concat(c),D),Ds(z("SIGNAL_REQUEST_TIMEOUT")).then(()=>{P||I.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(c,", ").concat(m))}))});try{return await v}catch(E){if(E.code===K.TIMEOUT)return await this.send(t,r,a,c,d);throw E}}onMessage(t){var r;const{_uid:a}=t;let c,d=this.userMap.get(a);if(d)c=d.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==ss.CHECK)return;const{token:v}=t;c=new Map,d={uid:a,isStart:!0,token:v,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(a,d),this.signal.emit(Rt.ON_USER_ONLINE,{uid:a}),this.handleUserOnline()}if("id"in t&&"total"in t){var h;const{id:v,total:E}=t,w=(h=c.get(v))!==null&&h!==void 0?h:[];if(w.push(t),c.has(v)||c.set(v,w),w.length!==E)return;{const S=Th(w).call(w,(R,j)=>R.index-j.index).map(R=>R.payload).join("");c.delete(v),(t=JSON.parse(S))._uid=a}}const{_type:f,token:m}=t;if(ke(r=[ss.ACK,ss.CHECK]).call(r,f))return f===ss.CHECK&&this.handleCheckToken(d,m),void this.receiveMessage(t);m==="".concat(d.token,"_").concat(this.token)?this.handleReceivedMessage(t):I.debug('Receive unexpected message", '.concat(m,", cur_token: ").concat(d.token,"_").concat(this.token),t)}check(){const t={_id:jn(6,""),token:this.token,_type:ss.CHECK};z("SHOW_P2P_LOG")&&I.debug("send message",t),this.signal.request(lt.DATA_STREAM,{payload:df(this.encoder.encode(JSON.stringify(t)))})}ack(t){const r={_id:t,_type:ss.ACK,token:this.token};z("SHOW_P2P_LOG")&&I.debug("send message",r),this.signal.request(lt.DATA_STREAM,{payload:df(this.encoder.encode(JSON.stringify(r)))})}response(t,r,a){this.send(ss.RESPONSE,JSON.stringify({success:!a,message:r}),!0,t)}handleReceivedMessage(t){const r=()=>{this.userMap.forEach(v=>{const{receivedMessagesMap:E,nextExpectedSequenceNumber:w}=v;for(;E.has(w);){const S=E.get(w);E.delete(w),this.receiveMessage(S),v.nextExpectedSequenceNumber++}})};if(!t)return void r();const{_uid:a,_seq:c}=t,d=this.userMap.get(a),{receivedMessagesMap:h,isStart:f,nextExpectedSequenceNumber:m}=d;if(c<m)return this.ack(t._id),void I.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(t._message));h.set(c,t),f&&c===m&&(this.receiveMessage(t),h.delete(m),d.nextExpectedSequenceNumber++,r())}receiveMessage(t){const{_id:r,_type:a,_message:c,_uid:d}=t;if(z("SHOW_P2P_LOG")&&I.debug("receive message",t),r){let h;switch(t._type!==ss.ACK&&(c&&(h=JSON.parse(c)),this.ack(t._id)),t._type){case ss.CANDIDATE:case ss.CONTROL:this.signal.emit(a,h,d);break;case ss.PUBLISH:case ss.UNPUBLISH:case ss.RESTART_ICE:case ss.CALL:h.uid=d,_s(this.signal,a,h).then(f=>{this.response(t._id,f)}).catch(()=>{this.response(t._id,void 0,!0)});break;case ss.ACK:this.getListeners("res-@".concat(r,"_ack")).length>0&&this.emit("res-@".concat(r,"_ack"));break;case ss.RESPONSE:{const{success:f,message:m}=h;this.emit("res-@".concat(r),f?"success":"failed",m);break}}}}splitMessage(t){if(t.length<Zg.MAX_MESSAGE_SIZE)return[t];const r=[],{remoteToken:a}=JSON.parse(t),c=jn(6,"");let d=0,h=800;const f=Math.ceil(t.length/h);for(;t.length>0;){d++;const m={id:c,index:d,total:f,payload:t.slice(0,h),token:"".concat(this.token,"_").concat(a)};JSON.stringify(m).length>Zg.MAX_MESSAGE_SIZE?h-=50:(r.push(m),t=t.slice(h))}return r.map(m=>JSON.stringify(m))}handleCheckToken(t,r){return t.token!==r?(I.debug("token changed, from ".concat(t.token," to ").concat(r)),this.reset(t.uid,r),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{I.debug("token timeout, ".concat(r)),this.reset(t.uid)},z("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await _s(this.signal,ss.CALL,void 0),r=await this.send(ss.CALL,t);this.signal.emit(rt.P2P_CONNECTION,r,!0)}async reset(t,r){const a=this.userMap.get(t);a&&(this.emit(Jv.ABORT),this.signal.emit(Rt.ON_USER_OFFLINE,{uid:a.uid,reason:bue.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),r||(I.debug("change local token from ".concat(r," to ").concat(r)),this.token=jn(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Jv.ABORT)}}L(Zg,"MAX_SIZE",1),L(Zg,"MAX_MESSAGE_SIZE",1024);class afe extends br{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===rn.CONNECTED?this.emit(rt.WS_CONNECTED):t===rn.RECONNECTING?this.emit(rt.WS_RECONNECTING,this._websocketReconnectReason):t===rn.CLOSED&&this.emit(rt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,r){super(),L(this,"__name__","P2PSignal"),L(this,"_disconnectedReason",void 0),L(this,"_websocketReconnectReason",void 0),L(this,"_connectionState",rn.CLOSED),L(this,"reconnectToken",void 0),L(this,"p2pToken",void 0),L(this,"websocket",void 0),L(this,"openConnectionTime",void 0),L(this,"clientId",void 0),L(this,"lastMsgTime",Date.now()),L(this,"uploadCache",[]),L(this,"uploadCacheInterval",void 0),L(this,"rttRolling",new Oj(5)),L(this,"pingpongTimer",void 0),L(this,"pingpongTimeoutCount",0),L(this,"joinResponse",void 0),L(this,"multiIpOption",void 0),L(this,"initError",void 0),L(this,"spec",void 0),L(this,"store",void 0),L(this,"_external_signal",void 0),L(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(rt.ON_BINARY_DATA,a.data);const c=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case Rt.ON_DATA_STREAM:return void this.handleDataStream(c._message);case Rt.MUTE_AUDIO:case Rt.MUTE_VIDEO:case Rt.ON_P2P_LOST:case Rt.ON_USER_ONLINE:return;case Rt.ON_USER_OFFLINE:const{uid:d}=c._message;return I.debug("[".concat(this.clientId,"] user-offline uid: ").concat(d)),void this._external_signal.reset(d)}if(this.emit(c._type,c._message),c._type===Rt.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===Rt.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(nn.UID_BANNED);break;case 15:this.close(nn.IP_BANNED);break;case 16:this.close(nn.CHANNEL_BANNED)}if(c._type===Rt.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case pt.ERR_LICENSE_MISSING:this.close(nn.LICENSE_MISSING);break;case pt.ERR_LICENSE_EXPIRED:this.close(nn.LICENSE_EXPIRED);break;case pt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(nn.LICENSE_MINUTES_EXCEEDED);break;case pt.ERR_LICENSE_PERIOD_INVALID:this.close(nn.LICENSE_PERIOD_INVALID);break;case pt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(nn.LICENSE_MULTIPLE_SDK_SERVICE);break;case pt.ERR_LICENSE_ILLEGAL:this.close(nn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=r,this.websocket=new RM("gateway-".concat(this.clientId),this.spec.retryConfig,!0,z("JOIN_GATEWAY_USE_DUAL_DOMAIN"),z("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===rn.CONNECTED&&this.reconnect("retry",fi.OFFLINE)}),this.p2pToken=jn(6,""),this._external_signal=new Zg(this,this.p2pToken)}async request(t,r,a,c){const d=jn(6,""),h={_id:d,_type:t,_message:r},f=this.websocket.connectionID,m=()=>new Ue((j,D)=>{if(this.connectionState===rn.CONNECTED)return j();const P=()=>{this.off(rt.WS_CLOSED,W),j()},W=()=>{this.off(rt.WS_CONNECTED,P),D(new we(K.WS_ABORT))};this.once(rt.WS_CONNECTED,P),this.once(rt.WS_CLOSED,W)});if(this.connectionState!==rn.CONNECTING&&this.connectionState!==rn.RECONNECTING||t===lt.JOIN||t===lt.REJOIN||await m(),this.websocket.sendMessage(h,!0),c)return;const v=new Ue((j,D)=>{let P=!1;const W=(ne,le)=>{P=!0,j({isSuccess:ne==="success",message:le||{}}),this.off(rt.WS_CLOSED,Y),this.off(rt.WS_RECONNECTING,Y),this.emit(rt.REQUEST_SUCCESS,t,r)};this.once("res-@".concat(d),W);const Y=()=>{D(new we(K.WS_ABORT,"type: ".concat(t))),this.off(rt.WS_CLOSED,Y),this.off(rt.WS_RECONNECTING,Y),this.off("res-@".concat(d),W)};this.once(rt.WS_CLOSED,Y),this.once(rt.WS_RECONNECTING,Y),Ds(z("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==f||P||(I.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(rt.REQUEST_TIMEOUT,t,r))})});let E=null;try{E=await v}catch(j){if(this.connectionState===rn.CLOSED||t===lt.LEAVE)throw new we(K.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?j.throw():t===lt.JOIN||t===lt.REJOIN?null:(await m(),await this.request(t,r))}if(E.isSuccess)return E.message;const w=Number(E.message.error_code||E.message.code),S=Fg(w),R=new we(K.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(E.message.error_str),{code:w,data:E.message,desc:S.desc});return S.action==="success"?E.message:(I.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(w,", message: ").concat(S.desc,", action: ").concat(S.action)),w===pt.ERR_TOO_MANY_BROADCASTERS?((t===lt.JOIN||t===lt.REJOIN)&&(this.initError=R,this.close()),R.throw()):S.action==="failed"?R.throw():S.action==="quit"?(this.initError=R,this.close(),R.throw()):(w===pt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=E.message.option,I.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",fi.MULTI_IP)):this.reconnect(S.action,fi.SERVER_ERROR),t===lt.JOIN||t===lt.REJOIN?null:await this.request(t,r)))}waitMessage(t,r){return new Ue(a=>{const c=d=>{(!r||r(d))&&(this.off(t,c),a(d))};this.on(t,c)})}uploadWRTCStats(t){if(!this.store.sessionId)return void I.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Vg.WRTC_STATS,r)}upload(t,r){const a={_type:t,_message:r};try{this.websocket.sendMessage(a)}catch{const d=z("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==rn.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},z("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,r){const a={_type:t,_message:r};this.websocket.sendMessage(a)}async sendExtensionMessage(t,r,a){return await this._external_signal.send(t,r,a)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Ue((r,a)=>{this.once(rt.WS_CONNECTED,()=>r(this.joinResponse)),this.once(rt.WS_CLOSED,()=>a(this.initError||new we(K.WS_ABORT))),this.connectionState=rn.CONNECTING,this.websocket.init(t).catch(a)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||nn.LEAVE,this.connectionState=rn.CLOSED,I.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=jn(6,""),this._external_signal.clear(),this._external_signal=new Zg(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(rt.ABORT_P2P_EXECUTION);const t=await _s(this,rt.REQUEST_JOIN_INFO),r=await this.request(lt.JOIN,t);if(!r)return this.emit(rt.REPORT_JOIN_GATEWAY,K.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(rt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=rn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,r)}async downgradeCodec(t){return!1}handleDataStream(t){try{var r;const a=Cg(t.payload),c=new TextDecoder().decode(a),d=JSON.parse(c);"total"in d&&"id"in d||ke(r=Object.values(ss)).call(r,d._type)?(d._uid=t.uid,this._external_signal.onMessage(d)):this.emit(Rt.ON_DATA_STREAM,t)}catch{this.emit(Rt.ON_DATA_STREAM,t)}}handleNotification(t){I.debug("[".concat(this.clientId,"] receive notification: "),t);const r=Fg(t.code);if(r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?t.code===pt.ERR_REPEAT_JOIN_CHANNEL&&z("IGNORE_UID_CHECK")?void this.close(nn.UID_CONFLICT):(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(nn.UID_BANNED),void this.close()):void this.reconnect(r.action,fi.SERVER_ERROR);I.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=z("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=t&&(I.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>z("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",fi.TIMEOUT):this.request(lt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-r;this.rttRolling.add(a),z("REPORT_STATS")&&this.send(lt.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWebsocketEvents(){this.websocket.on(Lt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(rt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Lt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Lt.CLOSED,()=>{this.connectionState=rn.CLOSED}),this.websocket.on(Lt.FAILED,()=>{this._disconnectedReason=nn.NETWORK_ERROR,this.connectionState=rn.CLOSED}),this.websocket.on(Lt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===rn.CONNECTED?this.connectionState=rn.RECONNECTING:this.connectionState=rn.CONNECTING}),this.websocket.on(Lt.WILL_RECONNECT,(t,r,a)=>{t!=="retry"?(I.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):I.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),a(t)}),this.websocket.on(Lt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(rt.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof we&&t.code===K.UNEXPECTED_RESPONSE&&t.data.code===pt.ERR_NO_AUTHORIZED)return I.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",fi.SERVER_ERROR);I.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",fi.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Lt.REQUEST_NEW_URLS,(t,r)=>{_s(this,rt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(r)}),this.websocket.on(Lt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Rt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const ofe={name:"P2PChannel",create:function(e){let{store:t,statsCollector:r}=e;return new ife(t,r)},createSubmodule:function(e){let{store:t,spec:r}=e;return new afe(r,t)}};function xY(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function wY(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?xY(Object(r),!0).forEach(function(a){L(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xY(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}class cfe{constructor(t){L(this,"sessionDesc",void 0),L(this,"localCapabilities",void 0),L(this,"rtpCapabilities",void 0),L(this,"candidates",void 0),L(this,"_originCandidates",void 0),L(this,"iceParameters",void 0),L(this,"dtlsParameters",void 0),L(this,"setup",void 0),L(this,"currentMidIndex",void 0),L(this,"cname",void 0),t=ur(t);const{iceParameters:r,dtlsParameters:a,candidates:c,rtpCapabilities:d,setup:h,localCapabilities:f,sdkCodec:m,cname:v}=t,E=ma(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=d,this.candidates=c,this._originCandidates=ur(c),this.iceParameters=r,this.dtlsParameters=a,this.setup=h,this.localCapabilities=f,this.cname=v;for(let w=0;w<E.mediaDescriptions.length;w++){const S=E.mediaDescriptions[w];if(S.attributes.iceUfrag=r.iceUfrag,S.attributes.icePwd=r.icePwd,S.attributes.fingerprints=a.fingerprints,S.attributes.candidates=c,S.attributes.setup=h,S.media.mediaType==="video"){S.media.fmts=d.videoCodecs.map(D=>D.payloadType.toString(10));const R=d.videoCodecs.filter(D=>{var P,W;return(P=D.rtpMap)===null||P===void 0?void 0:ke(W=P.encodingName.toLowerCase()).call(W,m)}),j=d.videoCodecs.filter(D=>!ke(R).call(R,D));S.attributes.payloads=[...R,...j],S.attributes.extmaps=d.videoExtensions}S.media.mediaType==="audio"&&(S.media.fmts=d.audioCodecs.map(R=>R.payloadType.toString(10)),S.attributes.payloads=d.audioCodecs,S.attributes.extmaps=d.audioExtensions),E.mediaDescriptions[w]=this.mungMediaDesc(S)}this.sessionDesc=E,this.currentMidIndex=E.mediaDescriptions.length-1}toString(){return kh(this.sessionDesc)}send(t,r,a){const{ssrcs:c,ssrcGroups:d}=ew(r,this.cname),h=this.sessionDesc.mediaDescriptions.find(v=>t===Je.VIDEO?v.media.mediaType==="video":v.media.mediaType==="audio"),f=c[0].attributes.label,m=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(d),{id:f,mslabel:m}}batchSend(t){return t.map(r=>{let{kind:a,ssrcMsg:c}=r;return this.send(a,c,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(r=>{const a=[],c=[],d=[];r.attributes.ssrcs.forEach(h=>{ke(t).call(t,h.attributes.label||"")?d.push(h):a.push(h)}),r.attributes.ssrcGroups.forEach(h=>{var f;ke(f=d.map(m=>m.ssrcId)).call(f,h.ssrcIds[0])||c.push(h)}),r.attributes.ssrcs=a,r.attributes.ssrcGroups=c})}mute(t){const r=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===t);if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));r.attributes.direction="inactive"}unmute(t){const r=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===t);if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));r.attributes.direction="sendonly"}receive(t,r,a){t.forEach((c,d)=>{const h=c._mediaStreamTrack,f=this.sessionDesc.mediaDescriptions.findIndex(v=>v.attributes.mid===h.kind),m=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[f],c);this.sessionDesc.mediaDescriptions[f]=m})}stopReceiving(t){}updateCandidates(t){const r=this._originCandidates.filter(c=>c.transport==="udp"),a=[];if(r.forEach(c=>{a.push(wY(wY({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),r.length!==0){switch(t){case qs.TCP_RELAY:this.candidates=a;break;case qs.UDP_TCP_RELAY:case qs.RELAY:this.candidates=[...r,...a];break;default:this.candidates=r}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(t){t=ur(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const r=[];for(let a=0;a<t;a++)r.push((this.currentMidIndex+a+1).toString(10));return r}mungRecvMediaDsec(t,r){const a=ur(t);return Bg(a,r),OM(a,r),a}updateRecvMedia(t,r){const a=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===t);if(a!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[a],r);this.sessionDesc.mediaDescriptions[a]=c}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,r,a){const c=this.sessionDesc.mediaDescriptions.find(h=>t===Je.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(f=>f.attributes.label===r);var d;h&&(h.attributes.label=a,(d=h.attributes.msid)===null||d===void 0||d.replace(r,a))}}mungMediaDesc(t){const r=ur(t);return kM(r),function(a){const c=a.attributes.extmaps.find(d=>OI(d.extensionName));c&&a.attributes.extmaps.splice(a.attributes.extmaps.indexOf(c),1),a.attributes.payloads.forEach(d=>{const h=d.rtcpFeedbacks.findIndex(f=>f.type==="transport-cc");h!==-1&&d.rtcpFeedbacks.splice(h,1)})}(r),r}getSSRC(t){for(const r of this.sessionDesc.mediaDescriptions)for(const a of r.attributes.ssrcs)if(a.attributes.label===t)return[a]}}var tr;function SY(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function gA(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?SY(Object(r),!0).forEach(function(a){L(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):SY(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}let lfe=(tr=class $w extends CI{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var r;return ke(r=Object.keys(Ag)).call(r,t)}))]}constructor(t,r){super(t,r),L(this,"store",void 0),L(this,"peerConnection",void 0),L(this,"remoteSDP",void 0),L(this,"initialOffer",void 0),L(this,"statsFilter",void 0),L(this,"useRTX",!1),L(this,"localCapabilities",void 0),L(this,"localCandidateCount",0),L(this,"allCandidatesReceived",!1),L(this,"establishPromise",void 0),L(this,"mutex",void 0),this.store=r,this.mutex=new Ks("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection($w.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=tI(this.peerConnection,z("STATS_UPDATE_INTERVAL"),void 0,dr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=Ru(t.sdp),a=Zx(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:z("FILTER_VIDEO_FEC"),filterAudioFec:z("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=a,this.initialOffer=t,gA(gA({},r),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:a},offerSDP:t.sdp})}catch(t){throw new we(K.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new cfe(gA(gA({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const r=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(r){throw new we(K.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async updateRemoteRTPCapabilities(t,r){throw new we(K.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,r){var a=this;return Da(function*(){const c=yield Ft(a.mutex.lock());try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=t.map(S=>a.peerConnection.addTrack(S._mediaStreamTrack)),h=yield Ft(a.peerConnection.createOffer()),f=ma(h.sdp),m=t.map(S=>{const R=S._mediaStreamTrack,j=f.mediaDescriptions.find(D=>D.attributes.mid===R.kind);if(!j)throw new Error("Cannot extract ssrc from mediaDescription.");return function(D,P,W){const Y=D.attributes.ssrcs.filter(le=>le.attributes.label===P),ne=D.attributes.ssrcGroups;if(Y.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(ne&&Y.length>1){const le=ne.find(fe=>fe.ssrcIds.indexOf(Y[0].ssrcId)!==-1);return le?[{ssrcId:le.ssrcIds[0],rtx:W?le.ssrcIds[1]:void 0}]:[{ssrcId:Y[0].ssrcId}]}return[{ssrcId:Y[0].ssrcId}]}(j,R.id,a.useRTX)});let v;try{v=yield m}catch(S){throw d.forEach(R=>{Hs()&&R.replaceTrack(null),a.peerConnection.removeTrack(R)}),S}const E=a.mungSendOfferSDP(h.sdp,t);a.remoteSDP.receive(t,r,v);const w=a.remoteSDP.toString();return yield Ft(a.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield Ft(a.applySendEncodings(d,t)),yield Ft(a.peerConnection.setRemoteDescription({type:"answer",sdp:w})),t.map((S,R)=>{const j=S._mediaStreamTrack.id;return{localSSRC:m[R],id:j}})}catch(d){throw new we(K.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{c()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getSenders().filter(d=>{var h;return t.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r.map(d=>{Hs()&&d.replaceTrack(null),this.peerConnection.removeTrack(d)});const a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(t);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new we(K.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}}async receive(t,r,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:d,mslabel:h}=this.remoteSDP.send(t,r,c),f=new Ue((E,w)=>{const S=setTimeout(()=>{w(new Error("Cannot receive track, id: ".concat(d)))},1e4),R=j=>{const D=yn();if((D.name==="Safari"&&Number(D.version)===11||Mi())&&j.track.id!==d&&j.streams[0].id===h){var P;const W=j.streams[0].getTracks()[0];return(P=this.remoteSDP)===null||P===void 0||P.updateTrackLabel(t,d,j.track.id),this.peerConnection.removeEventListener("track",R),clearTimeout(S),void E(W)}if(j.track.id===d)return this.peerConnection.removeEventListener("track",R),clearTimeout(S),void E(j.track)};this.peerConnection.addEventListener("track",R)}),m=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:m});const v=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(v),{track:await f,id:d}}catch(d){throw new we(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const a=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(a)}catch(r){throw new we(K.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const r=this.peerConnection.getSenders().filter(a=>{var c;return t.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(r.length!==t.length)throw new Error("sender' length doesn't match mids' length.");r.map(a=>{if(Hs()&&a.track)a.track.enabled=!1;else{const c=a.getParameters();c.encodings.forEach(d=>d.active=!1),a.setParameters(c)}})}catch(r){throw new we(K.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const r=this.peerConnection.getSenders().filter(d=>{var h;return t.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(r.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");r.map(async d=>{if(Hs()&&d.track)d.track.enabled=!0;else{const h=d.getParameters();h.encodings.forEach(f=>f.active=!0),await d.setParameters(h)}});const a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new we(K.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return Da(function*(){const a=yield Ft(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Zt().supportPCSetConfiguration;if(t===qs.RELAY&&!c)return;if(c){const v=r.peerConnection.getConfiguration(),E=t===qs.RELAY?"relay":"all";v.iceTransportPolicy!==E&&(I.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(v.iceTransportPolicy,"] to [").concat(E,"]")),v.iceTransportPolicy=E,r.peerConnection.setConfiguration(v))}t!==qs.RELAY&&r.remoteSDP.updateCandidates(t);const d=yield Ft(r.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=Ru(d.sdp),{remoteIceParameters:f}=yield h.iceParameters;r.remoteSDP.restartICE(f);const m=r.remoteSDP.toString();yield Ft(r.peerConnection.setLocalDescription(d)),yield Ft(r.peerConnection.setRemoteDescription({type:"answer",sdp:m}))}catch(c){I.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),c)}finally{a()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[r]);this.remoteSDP.updateRecvMedia(r._mediaStreamTrack.kind,r);const d=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new we(K.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(t,r){const a=this.peerConnection.getSenders().filter(c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===t});a.length===1&&await this.applySendEncodings(a,[r])}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){const a=this.peerConnection.getSenders().find(c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===r});a&&await a.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,r){throw new we(K.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new we(K.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},z("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const r={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(wg(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...$w.turnServerConfigToIceServers(t.turnServer.servers)),z("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...$w.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(t){const r=[];return t.forEach(a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),r}async updateRtpSenderEncodings(t,r){var a;if(r||(r=this.peerConnection.getSenders().find(v=>{var E;return((E=v.track)===null||E===void 0?void 0:E.id)===t._mediaStreamTrack.id})),!r)return I.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Zt().supportSetRtpSenderParameters)return I.warn("Browser not support set rtp-sender parameters");const c={},d={};if(t instanceof Jn)switch(t._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(z("DSCP_TYPE")&&yu()){var h;const v=z("DSCP_TYPE");ke(h=["very-low","low","medium","high"]).call(h,v)&&(d.networkPriority=v)}const f=r.getParameters(),m=(a=f.encodings)===null||a===void 0?void 0:a[0];m&&Object.assign(m,d),Object.assign(f,c),I.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(f.encodings))),await r.setParameters(f)}async applySendEncodings(t,r){try{if(!Zt().supportSetRtpSenderParameters||t.length!==r.length)return;for(let a=0;a<t.length;a++){const c=t[a],d=r[a];c&&d&&await this.updateRtpSenderEncodings(d,c)}}catch{I.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r){const a=ma(t);return r.forEach((c,d)=>{const h=c._mediaStreamTrack,f=a.mediaDescriptions.find(m=>m.attributes.mid===h.kind);f&&Bg(f,c)}),kh(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,t,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const r=this.remoteSDP.batchSend(t).map((d,h)=>{let{id:f,mslabel:m}=d;const{kind:v}=t[h];return new Ue((E,w)=>{const S=setTimeout(()=>{w(new Error("Cannot receive track, id: ".concat(f)))},1e4),R=j=>{const D=yn();if(D.name==="Safari"&&Number(D.version)===11&&j.track.id!==f&&j.streams[0].id===m){var P;const W=j.streams[0].getTracks()[0];return(P=this.remoteSDP)===null||P===void 0||P.updateTrackLabel(v,f,j.track.id),this.peerConnection.removeEventListener("track",R),clearTimeout(S),void E({track:W,id:f})}if(j.track.id===f)return this.peerConnection.removeEventListener("track",R),clearTimeout(S),void E({track:j.track,id:f})};this.peerConnection.addEventListener("track",R)})}),a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await Ue.all(r)}catch(r){throw new we(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const r=this.remoteSDP.getSSRC(t);return r==null?void 0:r[0].ssrcId}setConfiguration(t){if(Zt().supportPCSetConfiguration){const r=$w.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}}},Fe(tr.prototype,"connect",[Vc],Object.getOwnPropertyDescriptor(tr.prototype,"connect"),tr.prototype),Fe(tr.prototype,"stopSending",[Vc],Object.getOwnPropertyDescriptor(tr.prototype,"stopSending"),tr.prototype),Fe(tr.prototype,"receive",[Vc],Object.getOwnPropertyDescriptor(tr.prototype,"receive"),tr.prototype),Fe(tr.prototype,"stopReceiving",[Vc],Object.getOwnPropertyDescriptor(tr.prototype,"stopReceiving"),tr.prototype),Fe(tr.prototype,"muteRemote",[Vc],Object.getOwnPropertyDescriptor(tr.prototype,"muteRemote"),tr.prototype),Fe(tr.prototype,"unmuteRemote",[Vc],Object.getOwnPropertyDescriptor(tr.prototype,"unmuteRemote"),tr.prototype),Fe(tr.prototype,"muteLocal",[Vc],Object.getOwnPropertyDescriptor(tr.prototype,"muteLocal"),tr.prototype),Fe(tr.prototype,"unmuteLocal",[Vc],Object.getOwnPropertyDescriptor(tr.prototype,"unmuteLocal"),tr.prototype),Fe(tr.prototype,"close",[Vc],Object.getOwnPropertyDescriptor(tr.prototype,"close"),tr.prototype),Fe(tr.prototype,"updateEncoderConfig",[Vc],Object.getOwnPropertyDescriptor(tr.prototype,"updateEncoderConfig"),tr.prototype),Fe(tr.prototype,"updateSendParameters",[Vc],Object.getOwnPropertyDescriptor(tr.prototype,"updateSendParameters"),tr.prototype),Fe(tr.prototype,"replaceTrack",[Vc],Object.getOwnPropertyDescriptor(tr.prototype,"replaceTrack"),tr.prototype),Fe(tr.prototype,"getRemoteSSRC",[Vc],Object.getOwnPropertyDescriptor(tr.prototype,"getRemoteSSRC"),tr.prototype),tr);function Vc(e,t,r){const a=e[t];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this.mutex,d=await c.lock("Locking from P2PConnection.".concat(t));try{for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];return await a.apply(this,f)}finally{d()}},r}const dfe={name:"PlanBConnection",create:function(e){let{store:t,spec:r}=e;return new lfe(r,t)}},ufe={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Zt().supportWebRTCEncodedTransform)return void I.warning("browser not support audio encoded transform");if(fI.has(e)||!e.track)return;const r={track:e.track};if(Ih()){if(!e.createEncodedStreams)return void I.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void I.error("create audio-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,f){r.controller||(r.controller=f),e.track&&e.track.id!==r.track.id&&(I.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",a),r.track=e.track,r.track.addEventListener("ended",a));const m=t.metadata&&t.metadata();m?function(v,E){const{chunk:w,controller:S}=E,R=uf.METADATA;w.data=function(j,D,P){const W=P.byteLength,Y=W+lM+_H,ne=oM+cM+Y,le=new ArrayBuffer(j.byteLength+ne),fe=new DataView(le);fe.setUint8(0,gH),fe.setUint16(1,Y),fe.setUint8(3,D),fe.setUint16(4,W);for(let _e=0;_e<W;_e++)fe.setUint8(6+_e,P[_e]);const ie=new Uint8Array(fe.buffer);return ie.set(new Uint8Array(j),ne),ie.buffer}(w.data,R,v),S.enqueue(w)}(m,{chunk:h,controller:f}):f.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(Hs()){if(typeof RTCRtpScriptTransform>"u")return void I.warning("browser not support RTCRtpScriptTransform");const c=pI(),d=new MessageChannel;await new Ue(f=>c.onmessage=m=>{m.data==="registered"&&f(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:d.port2},[d.port2]);e.transform=h,await new Ue(f=>c.onmessage=m=>{m.data==="started"&&f(void 0)}),d.port1.onmessage=f=>{var m;if(f.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==r.track.id)I.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",a),r.track=e.track,r.track.addEventListener("ended",a);else if(f.data.getMetadata){const v=t.metadata&&t.metadata();v&&d.port1.postMessage({metadata:v})}},r.worker=c}function a(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",a)}const c=fI.get(e);if(c){fI.delete(e);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(f){I.warning(f&&f.message)}}}fI.set(e,r),e.track.addEventListener("ended",a)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Zt().supportWebRTCEncodedTransform)return void I.warning("browser not support audio encoded transform");if(yI.has(e))return;const r={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(Ih()&&!Mi()){if(!e.createEncodedStreams)return void I.warning("browser not support createEncodedStreams() API");vj(Tn.CHROME,87,116)||(t.enableTopn=!1);let c=null;try{c=e.createEncodedStreams()}catch(h){return void I.error("create audio-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,f){r.controller||(r.controller=f),e.track&&e.track.id!==r.track.id&&(I.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",a),r.track=e.track,r.track.addEventListener("ended",a)),t.enableTopn?function(m,v,E){var w;const S=dM(new DataView(v.data));if(!S)return E.enqueue(v);const R=m.track.id;zde.set(R,m.track);const j=(w=S.tlv.find(le=>le.tag===uf.AUDIO_LEVEL))===null||w===void 0?void 0:w.value;let D=0;typeof j=="number"&&(D=127-j);const P=Math.round(Math.pow(10,D/60)-1),{selected:W,speaker:Y}=function(le,fe){let ie=qv.get(le);if(ie||(ie=function(_e){const Te=new EH;return qv.set(_e,Te),bd||(bd=new Fde(z("TOPN_SILENCE_THRESHOLD")||500),bd.on("ActiveSpeakerChanged",Ne=>{Ne!=null&&(_I=Ne)})),bd.addSpeakers([Te]),Te}(le)),qv.size<=yH)return{selected:!0,speaker:ie};if(!bd)throw new Error("no active speaker detector");return bd.levelChanged(ie.id,fe),jg=bd.loudest.map(_e=>_e.id),_I&&!ke(jg).call(jg,_I)&&jg.length>=yH&&jg.pop(),{selected:ke(jg).call(jg,ie.id)||ie.id===_I,speaker:ie}}(m,P),ne=function(le,fe,ie){const _e=xd.get(le)||new Bde(le,fe);return _e.score=ie,xd.set(le,_e),function(Te){if(vI.set(Te,!0),!EI)return void(EI=Date.now());const Ne=Date.now();Ne-EI>1e3&&(vI.get(Te)?vI.set(Te,!1):(bH(Te),vI.delete(Te)),EI=Ne)}(le),_e}(R,m.track,Y.energyScore);ne.addSample(W),ne.active&&(v.data=S.frame.buffer,E.enqueue(v))}(e,h,f):t.enableMetadata||t.enablePts?function(m,v,E,w){const S=new DataView(m.data),R=S.getUint8(0);let j;if(128&R&&R!==71){const W=function(Y){if(Y.byteLength<=0)return[];const ne=[];let le=0;for(;le<Y.byteLength;){const ie=(128&Y.getUint8(le))>>7,_e=127&Y.getUint8(le);if(!(ie&&le+4<=Y.byteLength)){le++;break}{const Te=Y.getUint32(le,!1),Ne=(16776192&Te)>>10,Ke=1023&Te;ne.push({pt:_e,ts_offset:Ne,length:Ke,data:new Uint8Array}),le+=4}}let fe=Y.byteLength-le;for(const ie of ne){if(ie.length>fe)return console.warn("Broken red payload"),[];ie.length>0&&(ie.data=new Uint8Array(Y.buffer,Y.byteOffset+le,ie.length),le+=ie.length,fe-=ie.length)}if(fe>0){const ie={pt:ne.length>0?ne[ne.length-1].pt:0,ts_offset:0,length:fe,data:new Uint8Array(Y.buffer,Y.byteOffset+le,fe)};ne.push(ie)}return ne}(S);if(W.length>0){const Y=function(ne){let le=0;for(let _e=0;_e<ne.length;_e++)le+=_e<ne.length-1?4:1,le+=ne[_e].length;const fe=new Uint8Array(le);let ie=0;for(let _e=0;_e<ne.length;_e++)if(_e<ne.length-1){const Te=(2147483648|(127&ne[_e].pt)<<24|(262143&ne[_e].ts_offset)<<10|1023&ne[_e].length)>>>0;fe[ie++]=Te>>24&255,fe[ie++]=Te>>16&255,fe[ie++]=Te>>8&255,fe[ie++]=255&Te}else fe[ie++]=127&ne[_e].pt;for(const _e of ne)fe.set(_e.data,ie),ie+=_e.length;return fe}(W.map(ne=>{const le=new Uint8Array(ne.length);le.set(ne.data);const fe=dM(new DataView(le.buffer));return fe!=null&&fe.frame&&(ne.data=fe==null?void 0:fe.frame),j=fe,ne}));m.data=Y.buffer}}else j=dM(S),j&&(m.data=j.frame.buffer);if(v.enqueue(m),!j)return;const D=j.tlv.find(W=>W.tag===uf.METADATA);D&&E&&D.value instanceof Uint8Array&&E(D.value);const P=j.tlv.find(W=>W.tag===uf.AUDIO_64_BIT_PTS);P&&w&&P.value instanceof Uint8Array&&P.value.length==8&&w(new DataView(P.value.buffer).getBigUint64(0,!0))}(h,f,t.onMetadata,t.onPts):f.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void I.warning("browser not support RTCRtpScriptTransform");const c=pI(),d=new MessageChannel;await new Ue(f=>c.onmessage=m=>{m.data==="registered"&&f(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:d.port2},[d.port2]);e.transform=h,await new Ue(f=>c.onmessage=m=>{m.data==="started"&&f(void 0)}),d.port1.onmessage=f=>{var m;f.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==r.track.id?(I.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",a),r.track=e.track,r.track.addEventListener("ended",a)):f.data.metadata&&r.onMetadata?r.onMetadata(f.data.metadata):f.data.pts&&r.onPts&&r.onPts(f.data.pts)},r.worker=c}function a(){e.track.removeEventListener("ended",a),function(c){const d=yI.get(c);if(d){(function(m){const v=qv.get(m);v&&(qv.delete(m),bd&&(bd.removeSpeakers([v]),qv.size===0&&(bd.destroy(),bd=null)))})(c),bH(c.track.id),yI.delete(c);try{var h,f;(h=d.controller)===null||h===void 0||h.terminate(),(f=d.worker)===null||f===void 0||f.terminate()}catch(m){I.warning(m&&m.message)}}}(e)}yI.set(e,r),e.track.addEventListener("ended",a)},interceptLocalVideoFrame:async function(e,t){if(!Zt().supportWebRTCEncodedTransform)return void I.warning("browser not support video encoded transform");if(bI.has(e)||!e.track)return;const r={track:e.track};if(Ih()){if(!e.createEncodedStreams)return void I.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(f){return void I.error("create video-encoded-streams error",f&&f.message)}const d=[];t.on("sei-to-send",f=>{d.push(f)});const h=new TransformStream({transform(f,m){r.controller||(r.controller=m),e.track&&e.track.id!==r.track.id&&(I.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",a),r.track=e.track,r.track.addEventListener("ended",a));const v=SH(new Uint8Array(f.data)),E=d.shift();if(E){const w=function(S,R,j){switch(j){case fM:return function(D,P){const W=wH(P),Y=W.length,ne=Math.floor(Y/255),le=Y%255,fe=new Uint8Array(6+ne+1+Y+D.byteLength);fe[0]=0,fe[1]=0,fe[2]=0,fe[3]=1,fe[4]=6,fe[5]=101;let ie=0;for(;ie<ne;)fe[6+ie]=255,ie++;return fe[6+ie]=le,ie++,fe.set(W,6+ie),fe.set(new Uint8Array(D),6+ie+Y),fe.buffer}(S,R);case mM:return function(D,P){const W=wH(P),Y=W.length,ne=Math.floor(Y/255),le=Y%255,fe=new Uint8Array(7+ne+1+Y+1+D.byteLength);fe[0]=0,fe[1]=0,fe[2]=0,fe[3]=1,fe[4]=78,fe[5]=1,fe[6]=101;let ie=0;for(;ie<ne;)fe[7+ie]=255,ie++;return fe[7+ie]=le,ie++,fe.set(W,7+ie),ie+=Y,fe[7+ie]=128,ie++,fe.set(new Uint8Array(D),7+ie),fe.buffer}(S,R);default:return null}}(f.data,E,v);w&&(f.data=w)}m.enqueue(f)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!Hs())return;{if(typeof RTCRtpScriptTransform>"u")return void I.warning("browser not support RTCRtpScriptTransform");const c=pI(),d=new MessageChannel;await new Ue(f=>c.onmessage=m=>{m.data==="registered"&&f(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:d.port2},[d.port2]);e.transform=h,await new Ue(f=>c.onmessage=m=>{m.data==="started"&&f(void 0)}),t.on("sei-to-send",f=>{d.port1.postMessage({sei:f})}),d.port1.onmessage=f=>{var m;f.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==r.track.id&&(I.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",a),r.track=e.track,r.track.addEventListener("ended",a))},r.worker=c}}function a(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",a)}const c=bI.get(e);if(c){bI.delete(e);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(f){I.warning(f&&f.message)}}}bI.set(e,r),e.track.addEventListener("ended",a)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Zt().supportWebRTCEncodedTransform)return void I.warning("browser not support video encoded transform");if(!e.track)return;if(Xx.has(e)){const c=Xx.get(e);return void(c&&(c.onSei=t.onSei))}const r={track:e.track,onSei:t.onSei};if(Ih()){if(!e.createEncodedStreams)return void I.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void I.error("create video-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,f){if(r.controller||(r.controller=f),!r.firstFrameInfo){var m;const E=h.getMetadata()||{};r.firstFrameInfo=ar({type:h.type,rtpTimestamp:h.timestamp,payloadType:E.payloadType||0,ssrc:E.synchronizationSource||0,length:h.data.byteLength},"mimeType"in E?{mimeType:E.mimeType}:{}),(m=t.onFirstFrame)===null||m===void 0||m.call(t,r.firstFrameInfo)}e.track&&e.track.id!==r.track.id&&(I.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",a),r.track=e.track,r.track.addEventListener("ended",a));const v=function(E,w){switch(w){case fM:return function(S){const R=new DataView(S.data);let j=0;for(;j+4<S.data.byteLength;){if(R.getUint8(j+0)===0&&R.getUint8(j+1)===0&&R.getUint8(j+2)===0&&R.getUint8(j+3)===1&&R.getUint8(j+4)===6){let D=j+6,P=0,W=0;for(;(W=R.getUint8(D++))===255;)P+=255;P+=W;const Y=xH(S.data,D,P);return new Uint8Array(Y)}j++}return null}(E);case mM:return function(S){const R=new DataView(S.data);let j=0;for(;j+5<S.data.byteLength;){if(R.getUint8(j+0)===0&&R.getUint8(j+1)===0&&R.getUint8(j+2)===0&&R.getUint8(j+3)===1&&R.getUint8(j+4)===78&&R.getUint8(j+5)===1&&R.getUint8(j+6)===101){let D=j+7,P=0,W=0;for(;(W=R.getUint8(D++))===255;)P+=255;P+=W;const Y=xH(S.data,D,P);return new Uint8Array(Y)}j++}return null}(E);default:return null}}(h,SH(new Uint8Array(h.data)));v&&r.onSei&&r.onSei(v),f.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(Hs()){if(typeof RTCRtpScriptTransform>"u")return void I.warning("browser not support RTCRtpScriptTransform");const c=pI(),d=new MessageChannel;await new Ue(f=>c.onmessage=m=>{m.data==="registered"&&f(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:d.port2},[d.port2]);e.transform=h,await new Ue(f=>c.onmessage=m=>{m.data==="started"&&f(void 0)}),d.port1.onmessage=f=>{var m;if(f.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==r.track.id)I.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",a),r.track=e.track,r.track.addEventListener("ended",a);else if(f.data.sei&&r.onSei)r.onSei(f.data.sei);else if(f.data.firstFrameInfo&&t.onFirstFrame){var v;(v=t.onFirstFrame)===null||v===void 0||v.call(t,f.data.firstFrameInfo)}},r.worker=c}function a(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",a)}(function(c){const d=Xx.get(c);if(d){Xx.delete(c);try{var h,f;(h=d.controller)===null||h===void 0||h.terminate(),(f=d.worker)===null||f===void 0||f.terminate()}catch(m){I.warning(m&&m.message)}}})(e)}Xx.set(e,r),e.track.addEventListener("ended",a)}},hfe={name:"InterceptFrame",create:()=>ufe};var pn;function TY(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function kd(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?TY(Object(r),!0).forEach(function(a){L(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):TY(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}let pfe=(pn=class RE extends CI{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var r;return ke(r=Object.keys(Ag)).call(r,t)}))]}constructor(t,r,a){super(t,r),L(this,"id",jn(5,"connection-")),L(this,"store",void 0),L(this,"peerConnection",void 0),L(this,"forceTurn",!1),L(this,"remoteSDP",void 0),L(this,"initialOffer",void 0),L(this,"transportEventReceiver",void 0),L(this,"statsFilter",void 0),L(this,"extension",{useXR:z("USE_XR")}),L(this,"localCapabilities",void 0),L(this,"remoteCodecs",void 0),L(this,"localCandidateCount",0),L(this,"allCandidatesReceived",!1),L(this,"isPreallocation",!1),L(this,"preMediaMap",new Map),L(this,"dataStreamChannelMap",new Map),L(this,"establishPromise",void 0),L(this,"recoveredDataChannelIds",[]),L(this,"currentDataChannelId",1),L(this,"supportAV1RtpSpec",!1),L(this,"mutex",void 0),L(this,"qualityLimitationReason",Lv.NONE),L(this,"isFirstConnected",!1),this.store=r,this.forceTurn=QM(t),this.mutex=new Ks("NVConnectionExtension-mutex",r.clientId),this.peerConnection=a,this.isFirstConnected=!1,this.statsFilter=tI(this.peerConnection,z("STATS_UPDATE_INTERVAL"),void 0,dr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,r){if(this.remoteCodecs=r,!this.remoteSDP)return void I.debug("[NVConnectionExtension] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(r));if(this.remoteSDP.updateRemoteCodec(t,r,this.store.codec)){const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}else I.debug("[NVConnectionExtension] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const a=Ru(r.sdp),c=await PM({filterRTX:!z("USE_PUB_RTX")&&!z("USE_SUB_RTX"),filterVideoFec:z("FILTER_VIDEO_FEC"),filterAudioFec:z("FILTER_AUDIO_FEC"),filterVideoCodec:z("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:z("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:z("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=tw(c),this.initialOffer=r,z("ENABLE_SVC")&&this.store.codec=="av1"){const h=await QH();var t;h&&(this.supportAV1RtpSpec=!0,(t=c.send)===null||t===void 0||t.videoExtensions.push(h))}let d;return r.sdp&&PI(r.sdp)&&(d=ur(c),WH(d)),kd(kd({},a),{},{rtpCapabilities:d||c,offerSDP:r.sdp})}catch(r){throw new we(K.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnectionExtension without initial offer.");this.initialOffer.sdp&&PI(this.initialOffer.sdp)&&HH(t.rtpCapabilities,this.localCapabilities),this.remoteSDP=new w7(kd(kd({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!z("ENABLE_PRE_SUB_WITH_PRE_PC")||!z("PRE_USE_LOCAL_CODECS"))&&Kx(this.store),!0),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const r=this.remoteSDP.toString(),a=LM(this.initialOffer.sdp,this.extension),c=this.logSDPExchange(a||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),c==null||c(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r});const d=this.peerConnection.getTransceivers()[0];if(d!=null&&d.receiver&&this.tryBindTransportEvents(d.receiver),Kx(this.store))if(t.preallocation&&z("ENABLE_PRE_SUB_WITH_PRE_PC")){const h=z("PRE_SUB_NUM"),{mids:f,preSSRCs:m}=this.remoteSDP.preloadRemoteMedia(h);await co(this.peerConnection,this.remoteSDP,this.extension),I.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] preload media, in pre pc,add preload ssrcs ").concat(m)),this.presetMedia(f,m)}else{const{preSSRCs:h=[]}=t,f=h.map(v=>v.ssrcMsg[0].ssrcId);if(h.length===0)return;const{mids:m}=this.remoteSDP.batchSend(h.map(v=>Object.assign({},v)));await co(this.peerConnection,this.remoteSDP,this.extension),I.debug("[NVConnectionExtension.connect] preload media, after join, add preload ssrcs ".concat(f)),this.presetMedia(m,f)}}catch(r){throw new we(K.EXCHANGE_SDP_FAILED,"NVConnectionExtension.connect failed; ".concat(r.toString()))}}presetMedia(t,r){t.forEach((a,c)=>{this.peerConnection.getTransceivers().forEach(d=>{if(d.mid!=null&&a===d.mid&&d.receiver.track){const h=d.receiver.track;let f;h.kind==="video"&&z("ENABLE_PRE_RENDER")&&(f=new uI({trackId:"track-".concat(h.kind,"-unknown-").concat(this.store.clientId,"_").concat(jn(5,""))},!0),f.updateVideoTrack(h),f.onFirstVideoFrameRender=()=>{var m;const v=this.preMediaMap.get(r[c]);v&&(v.firstVideoRender=Date.now()),(m=this.onFirstVideoRender)===null||m===void 0||m.call(this,r[c])},f.onVideoBufferReady=()=>{var m;(m=this.onFirstVideoBufferReady)===null||m===void 0||m.call(this,r[c])},f.play(this.store.sessionId||void 0)),this.preMediaMap.set(r[c],{mid:a,track:h,player:f,transceiver:d})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateRemoteConnect before remote SDP created");let r=!1;const{rtpCapabilities:a}=t;if([,r]=this.remoteSDP.updateRemoteRTPCapabilities(a),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const h=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);r=r||h}const{preSSRCs:c=[]}=t,d=c.map(h=>h.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(d)){const h=[],f=[];if(Array.from(this.preMediaMap.entries()).every(m=>{let[v,{mid:E,player:w,track:S}]=m;return h.push(E),f.push(v),this.preMediaMap.delete(v),w&&w.destroy(),!0}),h.length>0&&(this.remoteSDP.stopSending(h),await co(this.peerConnection,this.remoteSDP,this.extension),I.warn("[NVConnectionExtension.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(f)),tt.reportApiInvoke(this.store.sessionId,{name:_r.PRELOAD_MEDIA_FAILED,options:[c,f],tag:$n.TRACER}).onSuccess()),c.length>0){const{mids:m}=this.remoteSDP.batchSend(c.map(v=>Object.assign({},v)));await co(this.peerConnection,this.remoteSDP,this.extension),I.debug("[NVConnectionExtension.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(d)),this.presetMedia(m,d)}}r?(await co(this.peerConnection,this.remoteSDP,this.extension),I.debug("[NVConnectionExtension] updateRemoteConnect by exchanging SDP.")):I.debug("[NVConnectionExtension] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(r){throw new we(K.EXCHANGE_SDP_FAILED,"NVConnectionExtension.updateRemoteConnect failed; ".concat(r.toString()))}}send(t,r,a){var c=this;return Da(function*(){const d=yield Ft(c.mutex.lock("From NVConnectionExtension.send"));try{if(!c.remoteSDP)throw new Error("Cannot call NVConnectionExtension.send before remote SDP created");const h=[],f=Qx();t.forEach(P=>{const W=c.peerConnection.addTransceiver(P._mediaStreamTrack,kd({direction:"sendonly"},P.trackMediaType==="video"&&c.supportAV1RtpSpec&&f?{sendEncodings:[{scalabilityMode:f}]}:{}));h.push(W),P._updateRtpTransceiver(W)}),dr()&&z("SIMULCAST")===!0&&(yield Ft(c.applySimulcastForFirefox(h,t)));const m=yield Ft(c.peerConnection.createOffer()),v=c.remoteSDP.predictReceivingMids(t.length),E=c.mungSendOfferSDP(m.sdp,t,v),w=ma(E),S=v.map(P=>{const W=w.mediaDescriptions.find(Y=>Y.attributes.mid===P);if(!W)throw new Error("Cannot extract ssrc from mediaDescription.");return AM(W,z("USE_PUB_RTX"))});let R;try{R=yield S}catch(P){R=[],c.remoteSDP.receive(t,r,a,R);const W=c.remoteSDP.toString();throw yield Ft(c.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield Ft(c.peerConnection.setRemoteDescription({type:"answer",sdp:W})),yield Ft(c.stopSending(v,!0)),P}c.remoteSDP.receive(t,r,a,R);const j=c.remoteSDP.toString(),D=c.logSDPExchange(E,"offer","local","send");return yield Ft(c.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield Ft(c.applySimulcastEncodings(h,t)),yield Ft(c.applySendEncodings(h,t)),D==null||D(j),yield Ft(c.peerConnection.setRemoteDescription({type:"answer",sdp:j})),h.map((P,W)=>{const Y=v[W];return{localSSRC:S[W],id:Y,transceiver:P}})}catch(h){throw h instanceof we?h:new we(K.EXCHANGE_SDP_FAILED,"NVConnectionExtension.send failed; ".concat(h.toString()))}finally{d()}})()}async createDataChannels(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.createDataChannels before remote SDP created");let a=this.dataStreamChannelMap.get(t);if(a&&a.readyState==="open")I.debug("[NVConnectionExtension] Channels are already available and can be reused directly.");else{const d=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof d!="number")throw new Error("create DataChannel error, because cannot get dc id");a=this.peerConnection.createDataChannel("datastream-channel",{id:d,negotiated:!0,ordered:!1,maxRetransmits:z("DATASTREAM_MAX_RETRANSMITS")}),a.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,a)}r.forEach(d=>{d._updateOriginDataChannel(a)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),I.debug("[NVConnectionExtension] createDataChannels by exchanging SDP.")}else I.debug("[NVConnectionExtension] createDataChannels no need to exchange SDP.");return}catch(a){throw a instanceof we?a:new we(K.EXCHANGE_SDP_FAILED,"NVConnectionExtension.createDataChannels failed; ".concat(a.toString()))}}async stopDataChannels(t){try{const r=this.dataStreamChannelMap.get(t);return r&&(r.id&&this.recoveredDataChannelIds.push(r.id),r.close()),void this.dataStreamChannelMap.delete(t)}catch(r){throw r instanceof we?r:new we(K.DATACHANNEL_FAILED,"NVConnectionExtension.stopDataChannels failed; ".concat(r.toString()))}}async stopSending(t,r){const a=r?void 0:await this.mutex.lock("From NVConnectionExtension.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(m=>t.indexOf(m.mid)!==-1);if(c.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVConnectionExtension.stopSending.");c.map(m=>{var v;sE(this.id+m.mid,this),m.direction="inactive",(v=m.stop)===null||v===void 0||v.call(m)});const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(t);const f=this.remoteSDP.toString();h==null||h(f),await this.peerConnection.setRemoteDescription({type:"answer",sdp:f})}catch(c){throw new we(K.EXCHANGE_SDP_FAILED,"NVConnectionExtension.stopSending failed; ".concat(c.toString()))}finally{a&&a()}}async receive(t,r,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.receive ".concat(t," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(t,r,a,c);h&&(await co(this.peerConnection,this.remoteSDP,this.extension),I.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] receive ").concat(t," by exchanging SDP.")));const f=this.peerConnection.getTransceivers().find(m=>m.mid===d);if(!f)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:f.receiver.track,id:d,transceiver:f}}catch(d){throw new we(K.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(d.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.batchReceive before remoteSDP created.");const{mids:r,needExchangeSDP:a}=this.remoteSDP.batchSend(t);return a&&(await co(this.peerConnection,this.remoteSDP,this.extension),I.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] batchReceive by exchanging SDP."))),r.map(c=>{const d=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:c,transceiver:d}})}catch(r){throw new we(K.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(r.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopReceiving before remote SDP created.");t.forEach(d=>{Array.from(this.preMediaMap.entries()).some(h=>{let[f,{mid:m,player:v}]=h;if(m===d)return this.preMediaMap.delete(f),v&&v.destroy(),!0})}),this.remoteSDP.stopSending(t);const r=this.remoteSDP.toString(),a=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new we(K.EXCHANGE_SDP_FAILED,"NVConnectionExtension stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const r=this.remoteSDP.toString(),a=this.logSDPExchange(r,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new we(K.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteRemote failed; ".concat(r.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const r=this.remoteSDP.toString(),a=this.logSDPExchange(r,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new we(K.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteRemote failed; ".concat(r.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(h=>{h.direction="inactive"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(t);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(r){throw new we(K.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(async(h,f)=>{h.direction="sendonly"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(r){throw new we(K.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return Da(function*(){const a=yield Ft(r.mutex.lock("From NVConnectionExtension.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Zt().supportPCSetConfiguration,d=z("FORCE_TURN_TCP")||r.forceTurn;if(t===qs.RELAY&&!c)return;if(c&&!d){const w=t===qs.RELAY?"relay":"all",S=r.peerConnection.getConfiguration();S.iceTransportPolicy!==w&&(I.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(S.iceTransportPolicy,"] to [").concat(w,"]")),S.iceTransportPolicy=w,r.peerConnection.setConfiguration(S))}r.remoteSDP.updateCandidates(t);const h=yield Ft(r.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const f=Ru(h.sdp),{remoteIceParameters:m}=yield f.iceParameters;r.remoteSDP.restartICE(m);const v=r.remoteSDP.toString(),E=r.logSDPExchange(h.sdp||"","offer","local","restartICE");r.store.descriptionStart(),yield Ft(r.peerConnection.setLocalDescription(h)),E==null||E(v),yield Ft(r.peerConnection.setRemoteDescription({type:"answer",sdp:v}))}catch(c){I.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),c)}finally{a()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From NVConnectionExtension.extendCandidate");try{this.remoteSDP.updateCandidates(qs.TCP_RELAY),await co(this.peerConnection,this.remoteSDP,this.extension)}catch(r){I.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),r)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(r=>{sE(this.id+r.mid,this)}),this.preMediaMap.forEach(r=>{let{player:a}=r;a&&a.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return kd(kd({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);const d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new we(K.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(t,r){const a=this.peerConnection.getTransceivers().filter(c=>c.mid===t);a.length===1&&(this.isVP8Simulcast(r)?dr()||await this.applySimulcastEncodings(a,[r]):await this.applySendEncodings(a,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){const a=this.peerConnection.getTransceivers().find(c=>c.mid===r);a&&await a.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const r=t[0].transport.iceTransport,{local:a,remote:c}=r.getSelectedCandidatePair();return{local:kd(kd({},Cl),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:kd(kd({},Cl),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var r;const a="code: ".concat(t.errorCode,", message: ").concat(t.errorText),c=t.port?"local: ".concat(t.port):"",d=Tu(t.url||"");I.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: NVConnectionExtension.onICECandidateError(").concat(a,"), url: ").concat(d||"",", host_candidate:").concat(c)),(r=this.onICECandidateError)===null||r===void 0||r.call(this,a)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},z("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const r={iceServers:[]},a=t.cloudProxyServer||"disabled";return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&(wg(t.turnServer.servers)?r.iceServers=t.turnServer.servers:z("NEW_TURN_MODE")&&r.iceServers&&a==="disabled"?(z("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&r.iceServers.push(...RE.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):r.iceServers.push(...RE.newTurnServerConfigToIceServers(t.turnServer.servers)),z("NEW_FORCE_TURN")&&(r.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(r.iceServers&&r.iceServers.push(...RE.turnServerConfigToIceServers(t.turnServer.servers)),z("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...RE.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),z("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(r.iceTransportPolicy="relay")}))),z("ENABLE_ENCODED_TRANSFORM")&&Zt().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(t){const r=[];return t.forEach(a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Ol(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!z("FORCE_TURN_TCP")&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),r}static newTurnServerConfigToIceServers(t){const r=[];return t.forEach(a=>{const c=z("NEW_TURN_MODE");c===1?r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}):c===2?r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}):c===3?r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Ol(a.turnServerURL),":443?transport=tcp")}):c===4&&(r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}),r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}),r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Ol(a.turnServerURL),":443?transport=tcp")}))}),r}tryBindTransportEvents(t){const r=t.transport;if(r){this.transportEventReceiver=t,r.onstatechange=()=>{var c;r!=null&&r.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,r.state))},r.onerror=c=>{var d;(d=this.onDTLSTransportError)===null||d===void 0||d.call(this,"error"in c?c.error:c)};const a=r.iceTransport;a&&(a.onstatechange=()=>{const c=r==null?void 0:r.iceTransport.state;var d;c&&((d=this.onICETransportStateChange)===null||d===void 0||d.call(this,c))},a.getSelectedCandidatePair&&(a.onselectedcandidatepairchange=()=>{if(a.getSelectedCandidatePair()){const{local:c,remote:d}=a.getSelectedCandidatePair()||{};if(c&&d){const h=c.address+":"+c.port,f=d.address+":"+d.port;I.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Tu(h)),", remote ").concat(JSON.stringify(Tu(f))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var a,c;if(r||(r=this.peerConnection.getSenders().find(P=>P.track===t._mediaStreamTrack)),!r)return I.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return I.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Zt().supportSetRtpSenderParameters)return I.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},h={};switch(t._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;case"balanced":d.degradationPreference="balanced"}const f=zH(this.peerConnection,t._mediaStreamTrack),m=kW(t);if(I7(t)&&f&&r&&m&&this.getLocalVideoStats&&ke(a=["vp8","vp9"]).call(a,this.store.codec)){var v;const D=d.degradationPreference||(ke(v=t._hints).call(v,Pn.CUSTOM_TRACK)?z("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");A7(this.id+f.mid,m,this,D,P=>{r&&this.updateAdaptation(r,P)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var E;const{bitrateMax:D,frameRate:P,scaleResolutionDownBy:W}=t._encoderConfig;D&&(h.maxBitrate=1e3*D),(ke(E=t._hints).call(E,Pn.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(P&&(h.maxFramerate=Ua(P)),W&&W>=1&&(h.scaleResolutionDownBy=W))}const{maxFramerate:w}=z("ENCODER_CONFIG_LIMIT");if(w&&typeof w=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,w):w),z("DSCP_TYPE")&&yu()){var S;const D=z("DSCP_TYPE");ke(S=["very-low","low","medium","high"]).call(S,D)&&(h.networkPriority=D)}const R=r.getParameters(),j=(c=R.encodings)===null||c===void 0?void 0:c[0];dr()&&!j&&(d.encodings=[h]),j&&Object.assign(j,h),Object.assign(R,d),I.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(R.encodings))),await r.setParameters(R),await t7(this.store.codec,r,z("SVC_MODE"))}async updateAdaptation(t,r){var a,c;if(!t)return I.debug("[updateAdaptation] no rtpSender found");if(!Zt().supportSetRtpSenderParameters)return I.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const d={},{bitrateMax:h,frameRate:f,scaleResolutionDownBy:m}=r;h&&(d.maxBitrate=1e3*h),f&&(d.maxFramerate=Ua(f)),m&&m>=1&&ke(a=["vp8","vp9"]).call(a,this.store.codec)&&(d.scaleResolutionDownBy=m);const v=t.getParameters(),E=(c=v.encodings)===null||c===void 0?void 0:c[0];E&&Object.assign(E,d),Object.assign(v,{});try{await t.setParameters(v),I.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(v.encodings)))}catch(w){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?I.debug("[updateAdaptation] peerConnection not connected}"):I.debug("[updateAdaptation] updateRtpSenderEncodings failed",w):I.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,r){try{if(!Zt().supportSetRtpSenderParameters||t.length!==r.length)return;for(let a=0;a<t.length;a++){const c=t[a],d=r[a];d instanceof Jn&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{I.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,a){const c=ma(t);return r.forEach((d,h)=>{const f=a[h],m=c.mediaDescriptions.find(v=>v.attributes.mid===f);m&&(Bg(m,d),DM(m,d,this.store.codec))}),kh(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let m=0;m<t.length;m++){var a,c,d,h,f;const v=t[m],E=r[m];if(E instanceof Jn&&!ke(a=E._hints).call(a,Pn.LOW_STREAM)&&(c=E._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=E._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=E._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((f=E._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1&&this.store.codec==="vp8"){const w={},S={high:1e3*(E._encoderConfig.bitrateMax-50),medium:5e4};w.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];const R=v.sender.getParameters();await v.sender.setParameters(Object.assign(R,w))}}}async applySimulcastEncodings(t,r){if(!dr()&&t.length===r.length)for(let a=0;a<t.length;a++){const c=r[a];if(c instanceof Jn&&this.isVP8Simulcast(c)){const d=t[a],h={},f={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:f.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:f.medium,scaleResolutionDownBy:4}];const m=d.sender.getParameters();await d.sender.setParameters(Object.assign(m,h))}}}isVP8Simulcast(t){var r,a,c,d,h;return!!(t instanceof Jn&&z("SIMULCAST")&&this.store.codec==="vp8"&&!ke(r=t._hints).call(r,Pn.LOW_STREAM)&&(a=t._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=t._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=t._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=t._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(t,r,a,c){if(z("SDP_LOGGING"))return I.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(r," SDP during NVConnectionExtension.").concat(c,`
`),t),r==="offer"?d=>{this.logSDPExchange(d,"answer",a==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const r=this.remoteSDP.getSSRC(t);return r&&r.length!==0?r[0].ssrcId:void 0}setConfiguration(t){if(Zt().supportPCSetConfiguration){const r=RE.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}t.isPreallocation&&(this.isPreallocation=!0)}},Fe(pn.prototype,"updateRemoteRTPCapabilities",[Ba],Object.getOwnPropertyDescriptor(pn.prototype,"updateRemoteRTPCapabilities"),pn.prototype),Fe(pn.prototype,"connect",[Ba],Object.getOwnPropertyDescriptor(pn.prototype,"connect"),pn.prototype),Fe(pn.prototype,"updateRemoteConnect",[Ba],Object.getOwnPropertyDescriptor(pn.prototype,"updateRemoteConnect"),pn.prototype),Fe(pn.prototype,"createDataChannels",[Ba],Object.getOwnPropertyDescriptor(pn.prototype,"createDataChannels"),pn.prototype),Fe(pn.prototype,"receive",[Ba],Object.getOwnPropertyDescriptor(pn.prototype,"receive"),pn.prototype),Fe(pn.prototype,"batchReceive",[Ba],Object.getOwnPropertyDescriptor(pn.prototype,"batchReceive"),pn.prototype),Fe(pn.prototype,"stopReceiving",[Ba],Object.getOwnPropertyDescriptor(pn.prototype,"stopReceiving"),pn.prototype),Fe(pn.prototype,"muteRemote",[Ba],Object.getOwnPropertyDescriptor(pn.prototype,"muteRemote"),pn.prototype),Fe(pn.prototype,"unmuteRemote",[Ba],Object.getOwnPropertyDescriptor(pn.prototype,"unmuteRemote"),pn.prototype),Fe(pn.prototype,"muteLocal",[Ba],Object.getOwnPropertyDescriptor(pn.prototype,"muteLocal"),pn.prototype),Fe(pn.prototype,"unmuteLocal",[Ba],Object.getOwnPropertyDescriptor(pn.prototype,"unmuteLocal"),pn.prototype),Fe(pn.prototype,"close",[Ba],Object.getOwnPropertyDescriptor(pn.prototype,"close"),pn.prototype),Fe(pn.prototype,"updateEncoderConfig",[Ba],Object.getOwnPropertyDescriptor(pn.prototype,"updateEncoderConfig"),pn.prototype),Fe(pn.prototype,"updateSendParameters",[Ba],Object.getOwnPropertyDescriptor(pn.prototype,"updateSendParameters"),pn.prototype),Fe(pn.prototype,"replaceTrack",[Ba],Object.getOwnPropertyDescriptor(pn.prototype,"replaceTrack"),pn.prototype),Fe(pn.prototype,"updateAdaptation",[Ba],Object.getOwnPropertyDescriptor(pn.prototype,"updateAdaptation"),pn.prototype),Fe(pn.prototype,"getRemoteSSRC",[Ba],Object.getOwnPropertyDescriptor(pn.prototype,"getRemoteSSRC"),pn.prototype),pn);function Ba(e,t,r){const a=e[t];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this.mutex,d=await c.lock("From NVConnectionExtension.".concat(t));try{for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];return await a.apply(this,f)}finally{d()}},r}var Bn;function RY(e){var t,r,a,c=2;for(typeof Symbol<"u"&&(r=UN,a=Symbol.iterator);c--;){if(r&&(t=e[r])!=null)return t.call(e);if(a&&(t=e[a])!=null)return new _A(t.call(e));r="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function _A(e){function t(r){if(Object(r)!==r)return Ue.reject(new TypeError(r+" is not an object."));var a=r.done;return Ue.resolve(r.value).then(function(c){return{value:c,done:a}})}return _A=function(r){this.s=r,this.n=r.next},_A.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var a=this.s.return;return a===void 0?Ue.resolve({value:r,done:!0}):t(a.apply(this.s,arguments))},throw:function(r){var a=this.s.return;return a===void 0?Ue.reject(r):t(a.apply(this.s,arguments))}},new _A(e)}let ffe=(Bn=class _1 extends CI{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(t,r){super(t,r),L(this,"name","DataChannelConnection"),L(this,"store",void 0),L(this,"peerConnection",void 0),L(this,"cname",void 0),L(this,"mutex",new Ks("DataChannelConnection-mutex")),L(this,"dataChannel",void 0),L(this,"_p2pConnection",void 0),L(this,"establishPromise",void 0),L(this,"_nvMedia",void 0),this.store=r,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(_1.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new pfe(t,r,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}getPreMedia(t){var r;return(r=this._p2pConnection)===null||r===void 0?void 0:r.getPreMedia(t)}isPreSub(){var t,r;return(t=(r=this._p2pConnection)===null||r===void 0?void 0:r.isPreSub())!==null&&t!==void 0&&t}async establish(){return await this._p2pConnection.establish()}getP2PConnectionParams(){return this._p2pConnection.establishPromise}updateRtpSenderEncodings(t){return this._p2pConnection.updateRtpSenderEncodings(t)}async connect(t){return this.cname=t.cname,await this._p2pConnection.connect(t),await new Ue((r,a)=>{const c=setTimeout(()=>{this.closeSignal(),a(new Ee(K.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(t.candidates))))},z("DC_CONNECTION_TIMEOUT"));this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(c),void r()},this.dataChannel.onerror=d=>{this.closeSignal(),a(d)},this.dataChannel.addEventListener("close",()=>{a(new Ee(K.DATACHANNEL_CONNECTION_TIMEOUT))})}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(t,r){return this._p2pConnection.updateRemoteRTPCapabilities(t,r)}send(t,r,a){var c=this;return Da(function*(){const d=yield Ft(c.mutex.lock("From DataChannelConnection.send"));try{return yield*Iv(RY(c._p2pConnection.send(t,r,a)))}finally{d()}})()}async stopSending(t,r){return this._p2pConnection.stopSending(t,r)}async createDataChannels(t,r){return this._p2pConnection.createDataChannels(t,r)}async stopDataChannels(t){return this._p2pConnection.stopDataChannels(t)}async receive(t,r,a,c){return this._nvMedia?(I.debug("[DataChannelConnection] receive ".concat(t," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(t,r,this.cname)):(I.debug("[DataChannelConnection] receive ".concat(t," by WebRTC.")),await this._p2pConnection.receive(t,r,a,c))}async batchReceive(t){return[...await this._p2pConnection.batchReceive(t)]}async stopReceiving(t){return await this._p2pConnection.stopReceiving(t)}async muteRemote(t){return await this._p2pConnection.muteRemote(t)}async unmuteRemote(t){return await this._p2pConnection.unmuteRemote(t)}async muteLocal(t){return await this._p2pConnection.muteLocal(t)}async unmuteLocal(t){return await this._p2pConnection.unmuteLocal(t)}restartICE(t){var r=this;return Da(function*(){return yield*Iv(RY(r._p2pConnection.restartICE(t)))})()}close(){var t;(t=this._nvMedia)===null||t===void 0||t.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(t){return this._p2pConnection.getRemoteVideoIsReady(t)}updateRemoteConnect(t){var r;return(r=this._nvMedia)===null||r===void 0||r.setRemoteRtpCapabilities(t),this._p2pConnection.updateRemoteConnect(t)}async updateEncoderConfig(t,r){return await this._p2pConnection.updateEncoderConfig(t,r)}async updateSendParameters(t,r){return await this._p2pConnection.updateSendParameters(t,r)}setStatsRemoteVideoIsReady(t,r){this._p2pConnection.setStatsRemoteVideoIsReady(t,r)}async replaceTrack(t,r){return await this._p2pConnection.replaceTrack(t,r)}async getRemoteSSRC(t){return this._p2pConnection.getRemoteSSRC(t)}logSDPExchange(t,r,a,c){if(z("SDP_LOGGING"))return I.upload("exchanging ".concat(a," ").concat(r," SDP during DataChannelConnection.").concat(c,`
`),t),r==="offer"?d=>{this.logSDPExchange(d,"answer",a==="local"?"remote":"local",c)}:void 0}static resolvePCConfiguration(t){const r={iceServers:[]};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(wg(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(..._1.turnServerConfigToIceServers(t.turnServer.servers)),z("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(..._1.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),z("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(r.iceTransportPolicy="relay")}))),z("ENABLE_ENCODED_TRANSFORM")&&Zt().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(t){const r=[];return t.forEach(a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Ol(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!z("FORCE_TURN_TCP")&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),r}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=t=>{var r;return(r=this.onICEConnectionStateChange)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onConnectionStateChange=t=>{var r;return(r=this.onConnectionStateChange)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onDTLSTransportStateChange=t=>{var r;return(r=this.onDTLSTransportStateChange)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onDTLSTransportError=t=>{var r;return(r=this.onDTLSTransportError)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onICETransportStateChange=t=>{var r;return(r=this.onICETransportStateChange)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onFirstAudioReceived=t=>{var r;return(r=this.onFirstAudioReceived)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onFirstVideoReceived=t=>{var r;return(r=this.onFirstVideoReceived)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onFirstAudioDecoded=t=>{var r;return(r=this.onFirstAudioDecoded)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onFirstVideoRender=t=>{var r;return(r=this.onFirstVideoRender)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onFirstVideoBufferReady=t=>{var r;return(r=this.onFirstVideoBufferReady)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onFirstVideoDecoded=(t,r,a)=>{var c;return(c=this.onFirstVideoDecoded)===null||c===void 0?void 0:c.call(this,t,r,a)},this._p2pConnection.onFirstVideoDecodedTimeout=t=>{var r;return(r=this.onFirstVideoDecodedTimeout)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onSelectedLocalCandidateChanged=(t,r)=>{var a;return(a=this.onSelectedLocalCandidateChanged)===null||a===void 0?void 0:a.call(this,t,r)},this._p2pConnection.onSelectedRemoteCandidateChanged=(t,r)=>{var a;return(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0?void 0:a.call(this,t,r)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}setConfiguration(t){this._p2pConnection.setConfiguration(t)}},Fe(Bn.prototype,"connect",[dc],Object.getOwnPropertyDescriptor(Bn.prototype,"connect"),Bn.prototype),Fe(Bn.prototype,"updateRemoteRTPCapabilities",[dc],Object.getOwnPropertyDescriptor(Bn.prototype,"updateRemoteRTPCapabilities"),Bn.prototype),Fe(Bn.prototype,"createDataChannels",[dc],Object.getOwnPropertyDescriptor(Bn.prototype,"createDataChannels"),Bn.prototype),Fe(Bn.prototype,"receive",[dc],Object.getOwnPropertyDescriptor(Bn.prototype,"receive"),Bn.prototype),Fe(Bn.prototype,"stopReceiving",[dc],Object.getOwnPropertyDescriptor(Bn.prototype,"stopReceiving"),Bn.prototype),Fe(Bn.prototype,"muteRemote",[dc],Object.getOwnPropertyDescriptor(Bn.prototype,"muteRemote"),Bn.prototype),Fe(Bn.prototype,"unmuteRemote",[dc],Object.getOwnPropertyDescriptor(Bn.prototype,"unmuteRemote"),Bn.prototype),Fe(Bn.prototype,"muteLocal",[dc],Object.getOwnPropertyDescriptor(Bn.prototype,"muteLocal"),Bn.prototype),Fe(Bn.prototype,"unmuteLocal",[dc],Object.getOwnPropertyDescriptor(Bn.prototype,"unmuteLocal"),Bn.prototype),Fe(Bn.prototype,"close",[dc],Object.getOwnPropertyDescriptor(Bn.prototype,"close"),Bn.prototype),Fe(Bn.prototype,"updateEncoderConfig",[dc],Object.getOwnPropertyDescriptor(Bn.prototype,"updateEncoderConfig"),Bn.prototype),Fe(Bn.prototype,"updateSendParameters",[dc],Object.getOwnPropertyDescriptor(Bn.prototype,"updateSendParameters"),Bn.prototype),Fe(Bn.prototype,"replaceTrack",[dc],Object.getOwnPropertyDescriptor(Bn.prototype,"replaceTrack"),Bn.prototype),Fe(Bn.prototype,"getRemoteSSRC",[dc],Object.getOwnPropertyDescriptor(Bn.prototype,"getRemoteSSRC"),Bn.prototype),Bn);function dc(e,t,r){const a=e[t];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this.mutex,d=await c.lock("From DataChannelConnection.".concat(t));try{for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];return await a.apply(this,f)}finally{d()}},r}function CY(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}class mfe extends br{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var r;ke(r=["tryNext","recover"]).call(r,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(ws.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(ws.CONNECTED):this._state==="closed"?this.emit(ws.CLOSED):this._state==="failed"&&this.emit(ws.FAILED))}constructor(t,r,a,c){super(),L(this,"connectionID",0),L(this,"currentURLIndex",0),L(this,"reconnectReason",void 0),L(this,"_reconnectMode","tryNext"),L(this,"_initMutex",void 0),L(this,"_name",void 0),L(this,"_state","closed"),L(this,"_reconnectInterrupter",void 0),L(this,"_url",void 0),L(this,"_retryConfig",void 0),L(this,"_reconnectCount",0),L(this,"_forceCloseTimeout",5e3),L(this,"_onlineReconnectListener",void 0),L(this,"_closeEstablishingTransmitter",()=>{}),L(this,"_store",void 0),L(this,"_joinChannelServiceRecordIndex",void 0),L(this,"_transmitter",void 0),L(this,"_useCompress",void 0),L(this,"_inflateLength",0),L(this,"_deflateLength",0),this._store=c,this._name=t,this._retryConfig=function(d){for(var h=1;h<arguments.length;h++){var f=arguments[h]!=null?arguments[h]:{};h%2?CY(Object(f),!0).forEach(function(m){L(d,m,f[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(f)):CY(Object(f)).forEach(function(m){Object.defineProperty(d,m,Object.getOwnPropertyDescriptor(f,m))})}return d}({},r),this._useCompress=a}resetReconnectCount(t){I.debug("".concat(this._name," reset reconnect count, reason: ").concat(t)),this._reconnectCount=0}close(t,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const a=this._transmitter;r?setTimeout(()=>a.close(),500):a.close(),this._transmitter=void 0}this.state=t?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(t,r){if(!this._transmitter)return void I.warning("[".concat(this._name,"] can not reconnect, no websocket"));var a;t!==void 0&&(this.reconnectMode=t),I.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((a=this._store)===null||a===void 0||a.recordJoinChannelService({status:"error",errors:[new Error(r)]},this._joinChannelServiceRecordIndex));const c=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),c&&c.bind(this._transmitter)({code:9999,reason:r})}getInflateData(){const t=this._inflateLength,r=this._deflateLength;return this.clearInflateData(),{inflateLength:t,deflateLength:r}}setInflateData(t){this._deflateLength=this._deflateLength+t.originLength,this._inflateLength=this._inflateLength+t.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}let Od=function(e){return e[e.Default=0]="Default",e[e.Ack=1]="Ack",e}({});class gfe{constructor(t,r,a){L(this,"version",1),L(this,"initialRTO",void 0),L(this,"maxBatchAckCount",void 0),L(this,"maxRTO",void 0),L(this,"initialRTT",void 0),L(this,"ID",void 0),L(this,"rtt",void 0),L(this,"packetNumber",1),L(this,"rtoRatioMap",new Map),L(this,"timeoutMap",new Map),L(this,"unorderedPacketQueue",[]),L(this,"batchAckPacketQueue",[]),L(this,"lastOrderedPacketNumber",0),L(this,"batchAckTimer",void 0),L(this,"sendImpl",void 0),L(this,"receiveImpl",void 0),this.sendImpl=t,this.receiveImpl=r,this.ID=jn(7,"transmitter-"),this.initialRTO=(a==null?void 0:a.initialRTO)!==void 0?a.initialRTO:z("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(a==null?void 0:a.initialRTT)!==void 0?a.initialRTT:z("TRANSMITTER_INITIAL_RTT"),this.rtt=(a==null?void 0:a.initialRTT)!==void 0?a.initialRTT:z("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(a==null?void 0:a.maxBatchAckCount)!==void 0?a.maxBatchAckCount:z("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(a==null?void 0:a.maxRTO)!==void 0?a.maxRTO:z("TRANSMITTER_MAX_RTO")}packetize(t,r){return{type:Od.Default,version:this.version,packetNumber:r,payload:t}}serialize(t){switch(t.type){case Od.Default:{let r;typeof t.payload=="string"?r=new TextEncoder().encode(t.payload):r=t.payload;const a=new ArrayBuffer(r.length+15),c=new DataView(a);return c.setUint16(0,t.version),c.setUint8(2,t.type),c.setUint32(3,t.packetNumber),RG(c,7,BigInt(t.sendTs)),new Uint8Array(c.buffer).set(r,15),a}case Od.Ack:{const r=new ArrayBuffer(16),a=new DataView(r);return a.setUint16(0,t.version),a.setUint8(2,t.type),a.setUint32(3,t.maxAckPacketNumber),a.setUint8(7,t.shift),RG(a,8,BigInt(t.ackSendTs)),r}}}deserialize(t){const r=new DataView(t),a=r.getUint16(0),c=r.getUint8(2);switch(c){case Od.Default:{const d=r.getUint32(3),h=TG(r,7),f=t.slice(15),m=new Uint8Array(f);return{version:a,type:c,packetNumber:d,sendTs:Number(h),payload:m}}case Od.Ack:{const d=r.getUint32(3),h=r.getUint8(7),f=TG(r,8);return{version:a,type:c,maxAckPacketNumber:d,shift:h,ackSendTs:Number(f)}}default:throw I.error("[".concat(this.ID,"] Unrecognized packet type ").concat(c)),new Error("Unrecognized packet type ".concat(c))}}sendMessage(t){z("DC_DEBUG_LOG")&&typeof t=="string"&&I.debug("[".concat(this.ID,"] sending message packet"),JSON.parse(t));const r=this.packetize(t,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const a=this.calculateRTO(r),c=window.setTimeout(()=>{this.resendMessage(r)},a);this.timeoutMap.set(r.packetNumber,c),this.sendPacket(r)}onData(t){const r=this.deserialize(t);r.type===Od.Default?this.ack(r):r.type===Od.Ack&&(this.updateRTT(r,Math.round(performance.now())),this.clearRTO(r))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(t=>{let[r,a]=t;window.clearTimeout(a)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(t){const r=this.calculateRTO(t),a=window.setTimeout(()=>{z("DC_DEBUG_LOG")&&typeof t.payload=="string"&&I.debug("[".concat(this.ID,"] resending message packet"),JSON.parse(t.payload),"timeout: ".concat(r)),this.resendMessage(t)},r);this.timeoutMap.set(t.packetNumber,a),this.sendPacket(t)}calculateRTO(t){const r=this.rtoRatioMap.get(t.packetNumber);if(r===void 0)return this.rtoRatioMap.set(t.packetNumber,1),this.initialRTO;{const a=9*this.rtt/8*r;return this.rtoRatioMap.set(t.packetNumber,r+1),a>this.maxRTO?this.maxRTO:a}}updateRTT(t,r){const a=t.ackSendTs;this.rtt=this.rtt*(7/8)+(r-a-this.rtt)/8}ack(t){if(t.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(t):(this.batchAckPacketQueue.push(t),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(t.payload);;){const r=this.unorderedPacketQueue[0];if(!r){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(r.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(t.packetNumber<=this.lastOrderedPacketNumber){const r={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Od.Ack,version:this.version};z("DC_DEBUG_LOG")&&I.debug("[".concat(this.ID,"] sending ack packet"),r,"packetNumber: ".concat(t.packetNumber)),this.sendPacket(r)}else if(t.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[t.packetNumber-this.lastOrderedPacketNumber-2]=t;const r={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Od.Ack,version:this.version};z("DC_DEBUG_LOG")&&I.debug("[".concat(this.ID,"] sending ack packet"),r,"packetNumber: ".concat(t.packetNumber)),this.sendPacket(r)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const t={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:Od.Ack,version:this.version};z("DC_DEBUG_LOG")&&I.debug("[".concat(this.ID,"] sending batch ack packet"),t,"shift: ".concat(this.batchAckPacketQueue.length-1)),this.sendPacket(t),this.batchAckPacketQueue=[]}sendPacket(t){t.type===Od.Default&&(t.sendTs=Math.round(performance.now()));const r=this.serialize(t);this.sendImpl(r)}clearRTO(t){for(let r=t.maxAckPacketNumber-t.shift;r<=t.maxAckPacketNumber;r++){const a=this.timeoutMap.get(r);a!==void 0&&window.clearTimeout(a),this.timeoutMap.delete(r),this.rtoRatioMap.delete(r)}}}class NY extends mfe{constructor(t,r){super(t,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),L(this,"_initMutex",void 0),L(this,"_reconnectInterrupter",void 0),L(this,"_url",void 0),L(this,"_transmitter",void 0),L(this,"_addresses",void 0),L(this,"_reliableTransmission",void 0),L(this,"_textEncoder",void 0),L(this,"_textDecoder",void 0),this._textEncoder=new TextEncoder,this._textDecoder=new TextDecoder,this._initMutex=new Ks("datachannel");const{timeout:a,timeoutFactor:c}=r,d=Math.max(300,Math.floor(3*a/5)),h=Math.max(1.2,Math.floor(8*c)/10);fa.ONLINE&&(this._retryConfig.timeout=d,this._retryConfig.timeoutFactor=h),jr.on(Sg.NETWORK_STATE_CHANGE,(f,m)=>{f!==m&&(this.resetReconnectCount("network state change: ".concat(m," -> ").concat(f)),f===fa.ONLINE?(this._retryConfig.timeout=d,this._retryConfig.timeoutFactor=h):(this._retryConfig.timeout=a,this._retryConfig.timeoutFactor=c))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=r;const a=(c,d)=>{this._addresses=t,this.currentURLIndex=this._addresses.findIndex(f=>f.fingerprint||z("FINGERPRINT"));const h=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(h).then(c).catch(d),this.once(ws.CLOSED,()=>d(new Ee(K.WS_DISCONNECT))),this.once(ws.CONNECTED,()=>c())};return this._initMutex.lock().then(c=>new Ue((d,h)=>{a(d,h)}).then(()=>{c()}).catch(()=>{c()}))}async sendMessage(t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new Ee(K.WS_ABORT,"datachannel is not ready");try{r||(t=JSON.stringify(t));const a=this._textEncoder.encode(t),c=Npe(a,{raw:!0});this._reliableTransmission.sendMessage(c)}catch(a){throw new Ee(K.WS_ERR,"send datachannel signal message error"+a.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(t){const r=JSON.stringify(t);return{compressed:r,compressedLength:r.length,origin:t}}sendMessageWithUint8Array(t){return{compressed:t,compressedLength:t.byteLength,origin:t}}createTransmitterConnection(t){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(t.ip,":").concat(t.port),new Ue((r,a)=>{var c;const d=()=>{I.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="recover",this.state="connected",this.resetReconnectCount("opened"),r()},h=async E=>{var w;if((w=this._closeEstablishingTransmitter)===null||w===void 0||w.call(this),I.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(E.code,", reason: ").concat(E.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=E.reason,this.state="reconnecting");const S=Oo(this,ws.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,R=await this.reconnectWithAction(S);if(this.state==="closed")return void I.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!R)return a(new Ee(K.WS_DISCONNECT,"datachannel reconnect failed: ".concat(E.code))),void this.close(!0);r()}else a(new Ee(K.WS_DISCONNECT,"datachannel close: ".concat(E.code))),this.close()},f=async E=>{try{var w;(w=this._reliableTransmission)===null||w===void 0||w.onData(E.data)}catch(S){console.log(S)}};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),I.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(t)));const m=(c=this._store)===null||c===void 0?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),v=Date.now();_s(this,ws.TO_CONNECT_DATACHANNEL).then(E=>{var w,S;if(!E)throw new Error("transmissonInfo not exist yet");const{transmitter:R,close:j}=E;this._transmitter=R,(w=this._store)===null||w===void 0||w.signalChannelOpen();const D=Date.now()-v;I.debug("[choose dc] dc open cost ".concat(D,"ms")),this._reliableTransmission=new gfe(P=>{var W;this._transmitter&&this._transmitter.readyState==="open"&&((W=this._transmitter)===null||W===void 0||W.send(P))},P=>{if(typeof P=="string")this.emit(ws.ON_MESSAGE,P);else{const W=Ape(P,{raw:!0}).buffer,Y=this._textDecoder.decode(W);this.emit(ws.ON_MESSAGE,Y)}}),this._closeEstablishingTransmitter=()=>{var P;(P=this._reliableTransmission)===null||P===void 0||P.close(),this._reliableTransmission=void 0,j()},d&&d(),R.onclose=h,R.onmessage=f,(S=this._store)===null||S===void 0||S.recordJoinChannelService({endTs:Date.now(),status:"success"},m),this._joinChannelServiceRecordIndex=m}).catch(E=>{var w;if((w=this._store)===null||w===void 0||w.recordJoinChannelService({endTs:Date.now(),status:E instanceof Ee&&E.code===K.WS_ABORT?"aborted":"error",errors:[E]},m),this.state!=="closed"){if(E instanceof Ee&&E.code===K.WS_ERR){const S=new Ee(K.WS_ERR,"init datachannel failed! Error: ".concat(E.toString()));return I.error("[".concat(this._name,"]").concat(S)),void a(S)}h&&h(E)}else a(new Ee(K.WS_DISCONNECT,"datachannel is closed: ".concat(E.toString())))})})}async reconnectWithAction(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||jr.networkState!==fa.OFFLINE||(this._onlineReconnectListener=jr.onlineWaiter&&jr.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let a=!0;if(this._reconnectInterrupter=()=>{a=!1},r){const f=JN(this._reconnectCount,this._retryConfig);I.debug("[".concat(this._name,"] wait ").concat(f,"ms to reconnect datachannel, mode: ").concat(t)),await Ue.race([Ds(f),this._onlineReconnectListener||new Ue(()=>{})])}if(this.state==="closed"||!a)return!1;this._reconnectCount+=1;const c=async(f,m)=>{this.emit(ws.RECONNECT_CREATE_CONNECTION,m),await this.createTransmitterConnection(f)};try{if(t==="retry"){const f=this._addresses[this.currentURLIndex];await c(f,t)}else if(t==="tryNext"){this.currentURLIndex+=1;for(let m=this.currentURLIndex;m<this._addresses.length;m++){if(this._addresses[m].fingerprint||z("FINGERPRINT")){this.currentURLIndex=m;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return I.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);I.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const f=this._addresses[this.currentURLIndex];await c(f,t)}else t==="recover"&&(I.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(ws.FAILBACK));return!0}catch(f){var d,h;return I.error("[".concat(this._name,"] reconnect failed"),f.toString()),f!=null&&(d=f.data)!==null&&d!==void 0&&d.desc&&Array.isArray(f.data.desc)&&f.data.desc.length&&ke(h=f.data.desc).call(h,"dynamic key expired")?(this.emit(ws.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,r)}}}class _fe extends br{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===rn.CONNECTED?this.emit(rt.WS_CONNECTED):t===rn.RECONNECTING?this.emit(rt.WS_RECONNECTING,this._websocketReconnectReason):t===rn.CLOSED&&this.emit(rt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}processPendingNotifications(){this.pendingNotifications.length!==0&&(I.debug("[".concat(this.clientId,"] processing ").concat(this.pendingNotifications.length," pending notifications")),this.pendingNotifications.forEach(t=>{let{type:r,message:a}=t;this.emit(r,a),r===Rt.ON_NOTIFICATION&&this.handleNotification(a),r===Rt.ON_USER_BANNED&&this.handleUserBanned(a)}),this.pendingNotifications=[])}handleUserBanned(t){switch(t.error_code){case 14:this.close(nn.UID_BANNED);break;case 15:this.close(nn.IP_BANNED);break;case 16:this.close(nn.CHANNEL_BANNED)}}constructor(t,r){super(),L(this,"__name__","DataChannelSignal"),L(this,"_disconnectedReason",void 0),L(this,"_websocketReconnectReason",void 0),L(this,"_connectionState",rn.CLOSED),L(this,"reconnectToken",void 0),L(this,"websocket",void 0),L(this,"openConnectionTime",void 0),L(this,"clientId",void 0),L(this,"lastMsgTime",Date.now()),L(this,"uploadCache",[]),L(this,"uploadCacheInterval",void 0),L(this,"rttRolling",new Oj(5)),L(this,"pingpongTimer",void 0),L(this,"inflateDataTimer",void 0),L(this,"pingpongTimeoutCount",0),L(this,"ortc",void 0),L(this,"joinResponse",void 0),L(this,"multiIpOption",void 0),L(this,"initError",void 0),L(this,"spec",void 0),L(this,"store",void 0),L(this,"isJoining",!1),L(this,"pendingNotifications",[]),L(this,"onWebsocketMessage",a=>{if(a instanceof ArrayBuffer)return void this.emit(rt.ON_BINARY_DATA,a);const c=JSON.parse(a);if(z("DC_DEBUG_LOG")&&I.debug("[datachannel-signal] received packet",c),this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else Object.prototype.hasOwnProperty.call(c,"_type")&&(this.isJoining?c._type===Rt.ON_NOTIFICATION||c._type===Rt.ON_USER_BANNED?(this.emit(c._type,c._message),c._type===Rt.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===Rt.ON_USER_BANNED&&this.handleUserBanned(c._message)):(this.pendingNotifications.push({type:c._type,message:c._message}),I.debug("[".concat(this.clientId,"] cached notification during join: ").concat(c._type))):(this.emit(c._type,c._message),c._type===Rt.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===Rt.ON_USER_BANNED&&this.handleUserBanned(c._message)))}),this.clientId=t.clientId,this.spec=t,this.store=r,this.websocket=new NY("gateway-".concat(this.clientId),this.spec.retryConfig,!0,r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===rn.CONNECTED&&this.reconnect("retry",pf.OFFLINE)})}async request(t,r,a,c){const d=jn(6,""),h={_id:d,_type:t,_message:r},f=this.websocket.connectionID,m=()=>new Ue((j,D)=>{if(this.connectionState===rn.CONNECTED)return j();const P=()=>{this.off(rt.WS_CLOSED,W),j()},W=()=>{this.off(rt.WS_CONNECTED,P),D(new Ee(K.WS_ABORT))};this.once(rt.WS_CONNECTED,P),this.once(rt.WS_CLOSED,W),t!==lt.PUBLISH&&t!==lt.SUBSCRIBE&&t!==lt.UNSUBSCRIBE&&t!==lt.UNPUBLISH&&t!==lt.CONTROL&&t!==lt.RESTART_ICE||this.once(rt.DISCONNECT_P2P,()=>{D(new Ee(K.DISCONNECT_P2P))}),t!==lt.PUBLISH&&t!==lt.RESTART_ICE||this.once(rt.ABORT_P2P_EXECUTION,()=>{D(new Ee(K.DISCONNECT_P2P))})});if(this.connectionState!==rn.CONNECTING&&this.connectionState!==rn.RECONNECTING||t===lt.JOIN||t===lt.REJOIN||await m(),t===lt.LEAVE&&(this.websocket.unbindDcCloseEventListener(),c=!0),z("DC_DEBUG_LOG")&&I.debug("[datachannel-signal] sendMessage",h),await this.websocket.sendMessage(h,!0,!1),c)return;const v=new Ue((j,D)=>{let P=!1;const W=(ne,le)=>{P=!0,j({isSuccess:ne==="success",message:le||{}}),this.off(rt.WS_CLOSED,Y),this.off(rt.WS_RECONNECTING,Y),this.emit(rt.REQUEST_SUCCESS,t,r)};this.once("res-@".concat(d),W);const Y=()=>{D(new Ee(K.WS_ABORT,"type: ".concat(t))),this.off(rt.WS_CLOSED,Y),this.off(rt.WS_RECONNECTING,Y),this.off("res-@".concat(d),W)};this.once(rt.WS_CLOSED,Y),this.once(rt.WS_RECONNECTING,Y),Ds(z("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==f||P||(I.warning("dc request timeout, type: ".concat(t)),this.emit(rt.REQUEST_TIMEOUT,t,r))})});let E=null;try{E=await v}catch(j){if(this.connectionState===rn.CLOSED||t===lt.LEAVE)throw new Ee(K.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?j.throw():t===lt.JOIN||t===lt.REJOIN?null:(await m(),await this.request(t,r))}if(E.isSuccess)return E.message;const w=Number(E.message.error_code||E.message.code),S=Fg(w),R=new Ee(K.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(E.message.error_str),{code:w,data:E.message});return S.action==="success"?E.message:(I.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(w,", message: ").concat(S.desc,", action: ").concat(S.action)),w===pt.ERR_TOO_MANY_BROADCASTERS?((t===lt.JOIN||t===lt.REJOIN)&&(this.initError=R,this.close()),R.throw()):S.action==="failed"?R.throw():S.action==="quit"?(this.initError=R,this.close(),R.throw()):(w===pt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=E.message.option,I.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",pf.MULTI_IP)):this.reconnect(S.action,pf.SERVER_ERROR),t===lt.JOIN||t===lt.REJOIN?null:await this.request(t,r)))}waitMessage(t,r){return new Ue(a=>{const c=d=>{(!r||r(d))&&(this.off(t,c),a(d))};this.on(t,c)})}uploadWRTCStats(t){if(!this.store.sessionId)return void I.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Vg.WRTC_STATS,r)}upload(t,r){const a={_type:t,_message:r};try{this.websocket.sendMessage(a)}catch{const d=z("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==rn.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},z("UPLOAD_CACHE_INTERVAL")||2e3))}}async send(t,r){const a={_type:t,_message:r};await this.websocket.sendMessage(a)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Ue((r,a)=>{this.once(rt.WS_CONNECTED,()=>r(this.joinResponse)),this.once(rt.WS_CLOSED,()=>a(this.initError||new Ee(K.WS_ABORT))),this.connectionState=rn.CONNECTING,this.websocket.init(t).catch(a),this.websocket.once(ws.FAILBACK,()=>{a(new Ee(K.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{this.openConnectionTime===void 0&&(I.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),a(new Ee(K.INIT_DATACHANNEL_TIMEOUT)))},z("DC_JOIN_WITH_FAILBACK"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this.isJoining=!1,this.pendingNotifications=[],this._disconnectedReason=t||nn.LEAVE,this.connectionState=rn.CLOSED,I.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),t===nn.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new NY("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),z("DC_PINGPONG_INTERVAL")),!this.joinResponse){this.emit(rt.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await _s(this,rt.REQUEST_JOIN_INFO);this.store.joinReq(),this.isJoining=!0,this.pendingNotifications=[];const r=await this.request(lt.JOIN,t);if(this.store.joinRep(),this.ortc=t==null?void 0:t.ortc,!r)return this.emit(rt.REPORT_JOIN_GATEWAY,K.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(rt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=rn.CONNECTED,this.isJoining=!1,this.processPendingNotifications(),!0}async rejoin(){if(!this.reconnectToken)throw new Ee(K.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=Tg(this,rt.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const r=await this.request(lt.REJOIN,t);return!!r&&(this.connectionState=rn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),z("DC_PINGPONG_INTERVAL")),r.peers&&r.peers.forEach(a=>{this.emit(Rt.ON_USER_ONLINE,{uid:a.uid}),a.audio&&this.emit(Rt.ON_ADD_AUDIO_STREAM,{uid:a.uid,uint_id:a.uint_id,audio:!0,ssrcId:a.audio_ssrc}),a.video&&this.emit(Rt.ON_ADD_VIDEO_STREAM,{uid:a.uid,uint_id:a.uint_id,video:!0,ssrcId:a.video_ssrc}),a.audio_mute?this.emit(Rt.MUTE_AUDIO,{uid:a.uid}):this.emit(Rt.UNMUTE_AUDIO,{uid:a.uid}),a.video_mute?this.emit(Rt.MUTE_VIDEO,{uid:a.uid}):this.emit(Rt.UNMUTE_VIDEO,{uid:a.uid}),a.audio_enable_local?this.emit(Rt.ENABLE_LOCAL_AUDIO,{uid:a.uid}):this.emit(Rt.DISABLE_LOCAL_AUDIO,{uid:a.uid}),a.video_enable_local?this.emit(Rt.ENABLE_LOCAL_VIDEO,{uid:a.uid}):this.emit(Rt.DISABLE_LOCAL_VIDEO,{uid:a.uid}),a.audio||a.video||this.emit(Rt.ON_REMOVE_STREAM,{uid:a.uid,uint_id:a.uint_id})}),!0)}reconnect(t,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,r)}async downgradeCodec(t){if(!this.ortc)return!1;const r={downgrade_codec:t,ortc:this.ortc};return!!await this.request(lt.DOWNGRADE_CODEC,r)}handleNotification(t){I.debug("[".concat(this.clientId,"] receive notification: "),t);const r=Fg(t.code);if(r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(nn.UID_BANNED),void this.close()):void this.reconnect(r.action,pf.SERVER_ERROR);I.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1,z("DC_DEBUG_LOG")&&console.debug("[datachannel-signal] pingpongTimeoutCount: ".concat(this.pingpongTimeoutCount));const t=z("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=t&&(I.warning("[datachannel-signal] PINGPONG Timeout. Last Socket Message: ".concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>z("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("recover",pf.FALLBACK):this.request(lt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-r;this.rttRolling.add(a),z("REPORT_STATS")&&this.send(lt.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleInflateData(){const{inflateLength:t,deflateLength:r}=this.websocket.getInflateData();t!==0&&r!==0&&this.upload(Vg.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(ws.RECONNECT_CREATE_CONNECTION,t=>{this.emit(rt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(ws.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(ws.CLOSED,()=>{this.connectionState=rn.CLOSED}),this.websocket.on(ws.FAILED,()=>{this._disconnectedReason=nn.NETWORK_ERROR,this.connectionState=rn.CLOSED}),this.websocket.on(ws.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===rn.CONNECTED?this.connectionState=rn.RECONNECTING:this.connectionState=rn.CONNECTING}),this.websocket.on(ws.WILL_RECONNECT,(t,r)=>{if(Tg(this,rt.IS_P2P_DISCONNECTED)&&t==="retry")return I.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(rt.NEED_RENEW_SESSION),this.emit(rt.DISCONNECT_P2P),r("tryNext");t!=="retry"&&(I.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(rt.NEED_RENEW_SESSION),this.emit(rt.DISCONNECT_P2P)),r(t)}),this.websocket.on(ws.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{I.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",pf.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(rt.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof Ee&&t.code===K.UNEXPECTED_RESPONSE&&t.data.code===pt.ERR_NO_AUTHORIZED)return I.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",pf.SERVER_ERROR);I.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",pf.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(ws.REQUEST_NEW_URLS,(t,r)=>{_s(this,rt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(r)}),this.websocket.on(ws.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Rt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(ws.TO_CONNECT_DATACHANNEL,(t,r)=>{_s(this,rt.PRE_CONNECT_PC).then(t).catch(r)}),this.websocket.on(ws.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(rt.DATACHANNEL_FAILBACK)})}}const vfe={name:"DataChannelConnection",create:function(e){let{store:t,spec:r}=e;return new ffe(r,t)}},Efe={name:"DataChannelSignal",create:function(e){let{store:t,spec:r}=e;return new _fe(r,t)}};Uj(),Wn("PROCESS_ID","process-".concat(jn(8,""),"-").concat(jn(4,""),"-").concat(jn(4,""),"-").concat(jn(4,""),"-").concat(jn(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void I.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),r=Date.now();I.debug("Loading global parameters from cache",t),Object.keys(t).forEach(a=>{if(Object.prototype.hasOwnProperty.call(Mn,a)){const{value:c,expires:d}=t[a];if(d&&d<=r)return;tc[a]=c,Mn[a]=c}})}catch(t){I.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(tc.AREAS)&&tc.AREAS.length>0&&VM(tc.AREAS,!0);const IY=(e,t,r)=>{I.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),Wn(e,t,r)};Cu(Lpe,!1),Cu(Upe,!1),Cu(fhe,!1),Cu(Xpe,!1),Cu(Ope,!1),Cu(ofe,!1),Cu(dfe,!1),Cu(hfe,!1),Cu(vfe,!1),Cu(Efe,!1);const vs=function(e){const t=new br,r=e,a={getListeners:t.getListeners.bind(t),on:(c,d)=>(function(h,f){h===Su.SECURITY_POLICY_VIOLATION&&rq(f,!0)}(c,d),t.on.bind(t)(c,d)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return nq(nq({},r),a)}({__TRACK_LIST__:kg,VERSION:kc,BUILD:Bj,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:IY,getParameter:z,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const r=await async function(a){let c;return Zt().supportUnifiedPlan?(a.addTransceiver("video",{direction:"recvonly"}),a.addTransceiver("audio",{direction:"recvonly"}),c=(await a.createOffer()).sdp):c=(await a.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(t);if(!r)return e;t.close(),t=null,e=function(a){const c={video:[],audio:[]};return a.match(/ VP8/i)&&c.video.push("VP8"),a.match(/ VP9/i)&&c.video.push("VP9"),a.match(/ AV1/i)&&c.video.push("AV1"),a.match(/ H264/i)&&c.video.push("H264"),a.match(/ H265/i)&&c.video.push("H265"),a.match(/ opus/i)&&c.audio.push("OPUS"),a.match(/ PCMU/i)&&c.audio.push("PCMU"),a.match(/ PCMA/i)&&c.audio.push("PCMA"),a.match(/ G722/i)&&c.audio.push("G722"),c}(r)}catch(t){throw new Ee(K.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];const t=tt.reportApiInvoke(null,{name:_r.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:$n.TRACER}),r=function(){let d=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],h=!1;try{const f=window.RTCPeerConnection,m=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,v=window.WebSocket;h=!(!f||!v),d&&!m&&(h=!1),h&&Ux()&&fG(75)&&new f().close()}catch(f){I.error("check system requirement failed: ",f),h=!1}return h}(e),a=ghe();I.debug("checkSystemRequirements, api:",r,"browser",a);const c=r&&a;return t.onSuccess(c),z("IGNORE_RTC_DEVICE_CHECK")?r:c},getDevices:function(e){return ac.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return ac.getRecordingDevices(e)},getCameras:function(e){return ac.getCamerasDevices(e)},getElectronScreenSources:EW,getPlaybackDevices:function(e){return ac.getSpeakers(e)},createClient:ZK,createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=z("CAMERA_CAPTURE_CONFIG"),r=jn(8,"track-cam-"),a=tt.reportApiInvoke(null,{id:r,tag:$n.TRACER,name:_r.CREATE_CAM_VIDEO_TRACK,options:[ar({},e),t]});t&&(e.encoderConfig=t);const c=dI(e);let d=null;I.info("start create camera video track with config",JSON.stringify(e),"trackId",r);try{d=(await ic({video:c},r)).getVideoTracks()[0]||null}catch(f){throw a.onError(f),f}if(!d){const f=new we(K.UNEXPECTED_ERROR,"can not find track in media stream");return a.onError(f),f.throw(I)}if(e.optimizationMode&&aM(r,d,e,Il(e.encoderConfig)),z("USE_STANDARD_BITRATE_DEFAULT")){const f=Il(e.encoderConfig);e.encoderConfig=f,delete f.bitrateMax,delete f.bitrateMin}const h=new hI(d,e,c,e.scalabiltyMode?aI(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r);return a.onSuccess(h.getTrackId()),I.info("create camera video success, trackId:",r),h},createCustomVideoTrack:function(e){const t=jn(8,"track-cus-"),r=tt.reportApiInvoke(null,{id:t,tag:$n.TRACER,name:_r.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});z("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const a=new Jn(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?aI(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[Pn.CUSTOM_TRACK]);return r.onSuccess(a.getTrackId()),I.info("create custom video track success with config",e,"trackId",a.getTrackId()),a},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const r=typeof t=="object"?function(S){const R=IW(S);return cW()&&S.suppressLocalAudioPlayback&&(R.suppressLocalAudioPlayback=S.suppressLocalAudioPlayback),lW()&&S.restrictOwnAudio&&(R.restrictOwnAudio=!0),R}(t):void 0;r&&(t="auto");const a=jn(8,"track-scr-v-"),c=tt.reportApiInvoke(null,{id:a,tag:$n.TRACER,name:_r.CREATE_SCREEN_VIDEO_TRACK,options:[ar({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const d=function(S){const R={};S.screenSourceType&&(R.mediaSource=S.screenSourceType),S.extensionId&&Ih()&&(R.extensionId=S.extensionId);const{displaySurface:j,selfBrowserSurface:D,surfaceSwitching:P,systemAudio:W,preferCurrentTab:Y,windowAudio:ne,monitorTypeSurfaces:le}=S;(Ed(107)||cf(107)||xg(93))&&(j&&(cs(j,"displaySurface",["browser","window","monitor"]),R.displaySurface=j),D?(cs(D,"selfBrowserSurface",["exclude","include"]),R.selfBrowserSurface=D):R.selfBrowserSurface="include",P&&(cs(P,"surfaceSwitching",["exclude","include"]),R.surfaceSwitching=P)),(Ed(105)||cf(105)||xg(91))&&W&&(cs(W,"systemAudio",["exclude","include"]),R.systemAudio=W),(Ed(94)||cf(94)||xg(80))&&Y&&(R.preferCurrentTab=!0),(Ed(141)||cf(141)||xg(125))&&ne&&(cs(ne,"windowAudio",["exclude","system"]),R.windowAudio=ne),(Ed(119)||cf(119)||xg(105))&&le&&(cs(le,"monitorTypeSurfaces",["exclude","include"]),R.monitorTypeSurfaces=le),S.electronScreenSourceId&&(R.sourceId=S.electronScreenSourceId);const fe=S.encoderConfig?qj(S.encoderConfig):null;return R.mandatory={chromeMediaSource:"desktop",maxWidth:fe?fe.width:void 0,maxHeight:fe?fe.height:void 0},fe&&(fe.frameRate&&(typeof fe.frameRate=="number"?(R.mandatory.maxFrameRate=fe.frameRate,R.mandatory.minFrameRate=fe.frameRate):(R.mandatory.maxFrameRate=fe.frameRate.max||fe.frameRate.ideal||fe.frameRate.exact||void 0,R.mandatory.minFrameRate=fe.frameRate.min||fe.frameRate.ideal||fe.frameRate.exact||void 0),R.frameRate=fe.frameRate),fe.width&&(R.width=fe.width),fe.height&&(R.height=fe.height)),R}(e);let h=null,f=null;const m=Zt();if(!m.supportShareAudio&&t==="enable"){const S=new we(K.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(S),S.throw(I)}I.info("start create screen video track with config",e,"withAudio",t,"trackId",a);const v=m.supportShareAudio&&t!=="disable";try{const S=await ic({screen:d,screenAudio:v?r||!0:void 0},a);h=S.getVideoTracks()[0]||null,f=S.getAudioTracks()[0]||null}catch(S){throw c.onError(S),S}if(!h){const S=new we(K.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(S),S.throw(I)}if(!f&&t==="enable"){h&&h.stop();const S=new we(K.SHARE_AUDIO_NOT_ALLOWED);return c.onError(S),S.throw(I)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(aM(a,h,e,e.encoderConfig&&qj(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const E=new Jn(h,e.encoderConfig?qj(e.encoderConfig):{},e.scalabiltyMode?aI(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,a,[Pn.SCREEN_TRACK]);if(!f)return c.onSuccess(E.getTrackId()),I.info("create screen video track success","video:",E.getTrackId()),E;const w=new Xr(f,void 0,jn(8,"track-scr-a-"),!1);return c.onSuccess([E.getTrackId(),w.getTrackId()]),I.info("create screen video track success","video:",E.getTrackId(),"audio:",w.getTrackId()),[E,w]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=z("CAMERA_CAPTURE_CONFIG"),a=jn(8,"track-mic-"),c=jn(8,"track-cam-"),d=tt.reportApiInvoke(null,{id:"".concat(a,"-").concat(c),tag:$n.TRACER,name:_r.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,r]});r&&(t.encoderConfig=r);const h=dI(t),f=AW(e);let m=null,v=null;I.info("start create camera video track(".concat(c,") and microphone audio track(").concat(a,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const S=await ic({audio:f,video:h},"".concat(a,"-").concat(c));m=S.getAudioTracks()[0],v=S.getVideoTracks()[0]}catch(S){throw d.onError(S),S}if(!m||!v){const S=new we(K.UNEXPECTED_ERROR,"can not find tracks in media stream");return d.onError(S),S.throw(I)}if(t.optimizationMode&&aM(c,v,t,Il(t.encoderConfig)),z("USE_STANDARD_BITRATE_DEFAULT")){const S=Il(t.encoderConfig);t.encoderConfig=S,delete S.bitrateMax,delete S.bitrateMin}const E=new Yx(m,e,f,a),w=new hI(v,t,h,t.scalabiltyMode?aI(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,c);return d.onSuccess([E.getTrackId(),w.getTrackId()]),I.info("create camera video track(".concat(c,") and microphone audio track(").concat(a,") success")),[E,w]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=jn(8,"track-mic-"),r=tt.reportApiInvoke(null,{id:t,tag:$n.TRACER,name:_r.CREATE_MIC_AUDIO_TRACK,options:[e]}),a=AW(e);let c=null;I.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{c=(await ic({audio:a},t)).getAudioTracks()[0]||null}catch(h){throw r.onError(h),h}if(!c){const h=new we(K.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(h),h.throw(I)}const d=new Yx(c,e,a,t);return r.onSuccess(d.getTrackId()),I.info("create microphone audio track success, trackId:",t),d},createCustomAudioTrack:nH,createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:r,encoderConfig:a}=e;let{source:c}=e;const d={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":c,cacheOnlineFile:r,encoderConfig:a},h=jn(8,"track-buf-"),f=tt.reportApiInvoke(null,{id:h,tag:$n.TRACER,name:_r.CREATE_BUFFER_AUDIO_TRACK,options:[d]});if(z("DISABLE_WEBAUDIO"))throw new we(K.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");I.info("start create buffer source audio track with config",JSON.stringify(d),"trackId",h);const m=c;if(!(c instanceof AudioBuffer))try{c=await async function(w,S){let R=null;if(typeof w=="string"){const D=_9.get(w);if(D)return I.debug("use cached audio resource: ",w),D;try{R=(await yd(()=>Pa.get(w,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(P){throw new we(K.FETCH_AUDIO_FILE_FAILED,P.toString())}}else R=await new Ue((P,W)=>{const Y=new FileReader;Y.onload=ne=>{ne.target?P(ne.target.result):W(new we(K.READ_LOCAL_AUDIO_FILE_ERROR))},Y.onerror=()=>{W(new we(K.READ_LOCAL_AUDIO_FILE_ERROR))},Y.readAsArrayBuffer(w)});const j=await function(D){const P=Gv();return new Ue((W,Y)=>{P.decodeAudioData(D,ne=>{W(ne)},ne=>{Y(new we(K.DECODE_AUDIO_FILE_FAILED,ne.toString()))})})}(R);return typeof w=="string"&&S&&_9.set(w,j),j}(c,r)}catch(w){return f.onError(w),w.throw(I)}const v=new Lde(c),E=new Pde(m,v,a?oI(a):{},h);return I.info("create buffer source audio track success, trackId:",h),f.onSuccess(E.getTrackId()),E},setAppType:function(e){if(I.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw I.debug("Invalid appType"),new Ee(K.INVALID_PARAMS,"invalid app type",e);Wn("APP_TYPE",Math.floor(e))},setLogLevel:function(e){I.setLogLevel(e)},enableLogUpload:function(){z("USE_NEW_LOG")?Wn("UPLOAD_LOG",!0):I.enableLogUpload()},disableLogUpload:function(){z("USE_NEW_LOG")?Wn("UPLOAD_LOG",!1):I.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new y7},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=tt.reportApiInvoke(null,{tag:$n.TRACER,name:_r.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Xr||e instanceof Kv)){const m=new Ee(K.INVALID_TRACK,"the parameter is not a audio track");return r.onError(m),m.throw()}t&&t<1e3&&(t=1e3);const a=e instanceof Xr?e.getTrackLabel():"remote_track",c=e.getVolumeLevel();let d=c,h=c;const f=Date.now();return new Ue(m=>{const v=setInterval(()=>{const E=e.getVolumeLevel();d=E>d?E:d,h=E<h?E:h;const w=d-h>1e-4,S=Date.now()-f;if(w||S>t){clearInterval(v);const R=w,j={duration:S,deviceLabel:a,maxVolumeLevel:d,result:R};I.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(j))),r.onSuccess(j),m(R)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=tt.reportApiInvoke(null,{tag:$n.TRACER,name:_r.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Jn||e instanceof Hv)){const w=new Ee(K.INVALID_TRACK,"the parameter is not a video track");return r.onError(w),w.throw()}t&&t<1e3&&(t=1e3);const a=e instanceof Jn?e.getTrackLabel():"remote_track",c=e.getMediaStreamTrack(!0),d=document.createElement("video");d.style.width="1px",d.style.height="1px",d.setAttribute("muted",""),d.muted=!0,d.setAttribute("playsinline",""),d.controls=!1,(Hs()||YN())&&(d.style.opacity="0.01",d.style.position="fixed",d.style.left="0",d.style.top="0",document.body.appendChild(d)),d.srcObject=new MediaStream([c]),d.play();const h=document.createElement("canvas");h.width=160,h.height=120;let f=0,m=0;try{const w=Date.now();f=await function(S,R,j,D){let P,W=0,Y=null;return new Ue((ne,le)=>{function fe(){W>D&&P&&(P(),ne(W));const ie=j.getContext("2d");if(!ie){const Ne=new Ee(K.UNEXPECTED_ERROR,"can not get canvas 2d context.");return I.error(Ne.toString()),void le(Ne)}ie.drawImage(S,0,0,160,120);const _e=ie.getImageData(0,0,j.width,j.height),Te=Math.floor(_e.data.length/3);if(Y){for(let Ne=0;Ne<Te;Ne+=3)if(_e.data[Ne]!==Y[Ne])return W+=1,void(Y=_e.data);Y=_e.data}else Y=_e.data}setTimeout(()=>{P&&(P(),ne(W))},R),P=Zj(()=>{fe()},30)})}(d,t,h,4),m=Date.now()-w}catch(w){throw r.onError(w),w}ehe===Tn.SAFARI&&(d.pause(),d.remove()),d.srcObject=null;const v=f>4,E={duration:m,changedPicNum:f,deviceLabel:a,result:v};return I.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(E))),r.onSuccess(E),v},setArea:VM,audioElementPlayCenter:Ji,resumeAudioContext:function(){return Ji.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){vhe.processExternalMediaAEC(e)},registerExtensions:function(e){const t=z("PLUGIN_INFO")||[];e.forEach(r=>{"name"in r&&!ke(t).call(t,r.name)&&t.push(r.name);const a=r;a.__registered__=!0,a.logger.hookLog=I.extLog,a.reporter.hookApiInvoke=tt.extApiInvoke,a.parameters&&Object.keys(a.parameters).forEach(c=>{a.parameters[c]=z(c)})}),IY("PLUGIN_INFO",t)},ChannelMediaRelayError:Xv,ChannelMediaRelayEvent:Dh,ChannelMediaRelayState:oo,RemoteStreamFallbackType:Nde,RemoteStreamType:Cde,ConnectionDisconnectedReason:nn,AudienceLatencyLevelType:nde,AREAS:Nn,preload:async function(e,t,r,a){return oU(e,t,r,a)},startLastmileProbeTest:async function(e,t,r,a){let c={state:"unavailable"};await oU(e,t,r,a);const d=await cU({appId:e,cname:t,token:r||e,uid:a,cloudProxyServer:"disabled"});if(!d)return c;await lU(d);let h,f=ZK({mode:"rtc",codec:"vp8"});try{h=await f.join(e,t,r,a,{networkQualityProbe:!0})}catch{return c}const m=new she,v=m.createMuteAudioTrack();let E=await nH({mediaStreamTrack:v});await f.publish([E]);let[w,S,R]=await new Ue((ne,le)=>{const fe=setTimeout(()=>{clearTimeout(fe),ne([!0,null,"audio"])},5e3);f.on("user-published",async(ie,_e)=>{ie.uid===h&&(clearTimeout(fe),ne([!1,ie,_e]))})});if(w||!S)return await f.unpublish([E]),await f.leave(),E.close(),m.close(),c;await f.subscribe(S,R),await new Ue((ne,le)=>{const fe=setTimeout(()=>{clearTimeout(fe),ne(null)},5e3)});let j=f.getRTCStats(),D=f.getLocalAudioStats();const P=j.RTT,W=D.sendJitterMs,Y=D.currentPacketLossRate;return c={state:"complete",rtt:P,packetLossRate:Y,jitter:W,networkQuality:((ne,le,fe)=>{let ie=1;if(fe>0){let St=Math.log(100*fe)/Math.log(2)+1;St=Math.min(5,Math.max(0,St)),ie=1-St/5}let _e=1;if(ne>0){let St=Math.log(ne/40)/Math.log(2)+1;St=Math.min(5,Math.max(0,St)),_e=1-St/5}let Te=1;if(le>0){let St=Math.log(le/10)/Math.log(2.5)+1;St=Math.min(5,Math.max(0,St)),Te=1-St/5}const Ne=.5*ie+.3*_e+.2*Te;let Ke=0;return Ke=Ne>=.8?1:Ne>=.6?2:Ne>=.4?3:Ne>=.2?4:5,Ke})(P,W,Y)},await f.unsubscribe(S),await f.unpublish([E]),await f.leave(),E.close(),m.close(),await lU(d),c}});return Object.defineProperties(vs,{onAudioAutoplayFailed:{get:()=>ja.onAudioAutoplayFailed,set:e=>{ja.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>ja.onAutoplayFailed,set:e=>{ja.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>vs._onSecurityPolicyViolation,set(e){vs._onSecurityPolicyViolation=e,rq(e)}},__CLIENT_LIST__:{get:()=>z("SHOW_GLOBAL_CLIENT_LIST")?Mg:[]}}),ac.on(Dg.CAMERA_DEVICE_CHANGED,e=>{I.info("camera device changed",JSON.stringify(e)),vs.onCameraChanged&&vs.onCameraChanged(e),vs.safeEmit(Su.CAMERA_CHANGED,e)}),ac.on(Dg.RECORDING_DEVICE_CHANGED,e=>{I.info("microphone device changed",JSON.stringify(e)),vs.onMicrophoneChanged&&vs.onMicrophoneChanged(e),vs.safeEmit(Su.MICROPHONE_CHANGED,e)}),ac.on(Dg.PLAYOUT_DEVICE_CHANGED,e=>{I.debug("playout device changed",JSON.stringify(e)),vs.onPlaybackDeviceChanged&&vs.onPlaybackDeviceChanged(e),vs.safeEmit(Su.PLAYBACK_DEVICE_CHANGED,e)}),Ji.onAutoplayFailed=()=>{I.info("detect audio element autoplay failed"),ja.onAudioAutoplayFailed&&ja.onAudioAutoplayFailed()},Hn.on("autoplay-failed",()=>{I.info("detect webaudio autoplay failed"),ja.onAudioAutoplayFailed&&ja.onAudioAutoplayFailed(),vs.safeEmit(Su.AUTOPLAY_FAILED)}),Hn.on(si.STATE_CHANGE,(e,t)=>{I.info("audio context state changed: ".concat(t," => ").concat(e)),vs.onAudioContextStateChanged&&vs.onAudioContextStateChanged(e,t),vs.safeEmit(Su.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),jr.on(Sg.NETWORK_STATE_CHANGE,(e,t)=>{I.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=vs),vs})})(zre);var $Re=zre.exports;const IJ=xV($Re),JRe="ee6b812204e647358c5e9345deabc13d",r_={warningTimeMs:12e4,kickTimeMs:18e4,speakingThreshold:.15,checkIntervalMs:5e3},QRe=s=>{let n=0;for(let i=0;i<s.length;i++){const l=s.charCodeAt(i);n=(n<<5)-n+l,n=n&n}return Math.abs(n)%1e9},ZRe=({roomId:s,oderId:n,username:i,onUserJoined:l,onUserLeft:u,onError:p,onAFKWarning:g,onAFKKick:y,onSpeakingChange:x})=>{const[C,k]=H.useState(!1),[A,M]=H.useState(!1),[G,B]=H.useState(!0),[X,Z]=H.useState(0),[q,V]=H.useState(new Map),[ee,de]=H.useState(null),[ae,ye]=H.useState("prompt"),[Q,$]=H.useState(!1),[se,ce]=H.useState(0),he=H.useRef(null),ve=H.useRef(null),ge=H.useRef(null),qe=H.useRef(Date.now()),Dt=H.useRef(null),gt=H.useRef(!1);H.useEffect(()=>{const Pt=IJ.createClient({mode:"rtc",codec:"vp8"});return he.current=Pt,Pt.on("user-published",async(Jt,He)=>{var bt;He==="audio"&&(await Pt.subscribe(Jt,He),(bt=Jt.audioTrack)==null||bt.play(),V(Wt=>{const gn=new Map(Wt);return gn.set(Jt.uid.toString(),{oderId:Jt.uid.toString(),isSpeaking:!1,isMuted:!1,audioLevel:0}),gn}),l==null||l(Jt))}),Pt.on("user-unpublished",(Jt,He)=>{He==="audio"&&V(bt=>{const Wt=new Map(bt),gn=Wt.get(Jt.uid.toString());return gn&&Wt.set(Jt.uid.toString(),{...gn,isMuted:!0,isSpeaking:!1}),Wt})}),Pt.on("user-left",Jt=>{V(He=>{const bt=new Map(He);return bt.delete(Jt.uid.toString()),bt}),u==null||u(Jt)}),Pt.on("exception",Jt=>{}),()=>{he.current&&(he.current.removeAllListeners(),he.current.leave()),ve.current&&ve.current.close(),ge.current&&clearInterval(ge.current),Dt.current&&clearInterval(Dt.current)}},[l,u]);const Ye=H.useCallback(()=>{ge.current&&clearInterval(ge.current),ge.current=setInterval(()=>{if(ve.current&&!G){const Pt=ve.current.getVolumeLevel();Z(Pt);const Jt=gt.current,He=Pt>r_.speakingThreshold;He&&(qe.current=Date.now(),$(!1),ce(0)),He!==Jt&&(gt.current=He,x==null||x(He))}else Z(0);if(he.current){const Pt=he.current.remoteUsers;V(Jt=>{const He=new Map(Jt);return Pt.forEach(bt=>{var xt;const Wt=((xt=bt.audioTrack)==null?void 0:xt.getVolumeLevel())||0,gn=He.get(bt.uid.toString());gn&&He.set(bt.uid.toString(),{...gn,audioLevel:Wt,isSpeaking:Wt>r_.speakingThreshold})}),He})}},100)},[G,x]),ze=H.useCallback(()=>{Dt.current&&clearInterval(Dt.current),qe.current=Date.now(),Dt.current=setInterval(()=>{if(G){$(!1),ce(0);return}const Pt=Date.now()-qe.current,Jt=Math.max(0,r_.kickTimeMs-Pt);ce(Math.ceil(Jt/1e3)),Pt>=r_.warningTimeMs&&Pt<r_.kickTimeMs&&(Q||($(!0),g==null||g(),"vibrate"in navigator&&navigator.vibrate([200,100,200,100,200]))),Pt>=r_.kickTimeMs&&(y==null||y(),$(!1))},r_.checkIntervalMs)},[G,Q,g,y]),ut=H.useCallback(()=>{qe.current=Date.now(),$(!1),ce(0)},[]),yt=H.useCallback(()=>{ut()},[ut]),Xt=H.useCallback(async()=>{var Pt,Jt,He;if(!(!he.current||C||A)){M(!0),de(null);try{const bt=QRe(n);await he.current.join(JRe,s,null,bt);try{const Wt=await IJ.createMicrophoneAudioTrack();ve.current=Wt,ye("granted"),Wt.setEnabled(!1),await he.current.publish([Wt]),k(!0),B(!0),Ye(),ze()}catch(Wt){Wt.code==="PERMISSION_DENIED"||(Pt=Wt.message)!=null&&Pt.includes("Permission denied")||(Jt=Wt.message)!=null&&Jt.includes("NotAllowedError")||Wt.name==="NotAllowedError"?(ye("denied"),de("Mikrofon deaktiviert - Bitte erlaube den Zugriff in deinen Browser-Einstellungen, um sprechen zu knnen.")):Wt.code==="DEVICE_NOT_FOUND"||(He=Wt.message)!=null&&He.includes("NotFoundError")||Wt.name==="NotFoundError"?(ye("error"),de("Kein Mikrofon gefunden. Bitte schliee ein Mikrofon an.")):(ye("error"),de("Fehler beim Aktivieren des Mikrofons. Du kannst zuhren, aber nicht sprechen.")),k(!0),B(!0),Ye()}}catch(bt){de(bt.message||"Fehler beim Beitreten zum Voice Chat")}finally{M(!1)}}},[s,n,C,A,Ye,ze,p]),jt=H.useCallback(async()=>{if(he.current)try{ge.current&&(clearInterval(ge.current),ge.current=null),Dt.current&&(clearInterval(Dt.current),Dt.current=null),ve.current&&(ve.current.close(),ve.current=null),await he.current.leave(),k(!1),B(!0),Z(0),V(new Map),$(!1),ce(0),de(null)}catch{}},[]),Gt=H.useCallback(async()=>{if(!ve.current){ae==="denied"&&de("Mikrofon ist deaktiviert. Bitte erlaube den Zugriff in deinen Browser-Einstellungen.");return}const Pt=!G;ve.current.setEnabled(!Pt),B(Pt),Pt||ut()},[G,ae,ut]),mn=H.useCallback(async Pt=>{ve.current&&(ve.current.setEnabled(!Pt),B(Pt),Pt||ut())},[ut]);return H.useEffect(()=>{C&&ze()},[G,C,ze]),{isConnected:C,isConnecting:A,isMuted:G,localAudioLevel:X,remoteUsers:q,error:ee,microphonePermission:ae,afkWarning:Q,afkTimeRemaining:se,joinChannel:Xt,leaveChannel:jt,toggleMute:Gt,setMuted:mn,resetAFKTimer:ut,dismissAFKWarning:yt}},vE={voiceMinuteXP:10,speakingBonusXP:5,premiumMultiplier:1.5,maxXPPerSession:500,xpTickIntervalMs:6e4},gV=s=>Math.floor(Math.sqrt(s/100))+1,AJ=s=>Math.pow(s-1,2)*100,eCe=s=>{const n=gV(s),i=AJ(n),l=AJ(n+1),u=s-i,p=l-i;return{current:u,required:p,progress:Math.min(100,u/p*100)}},tCe=({userId:s,isPremium:n=!1,onXPGain:i,onLevelUp:l})=>{const{showXPGain:u}=mr(),p=H.useRef(null),g=H.useRef(0),y=H.useRef(!1),x=H.useRef(!1),C=H.useRef(1),k=H.useCallback(async(V,ee)=>{if(!s||V<=0||g.current>=vE.maxXPPerSession)return;const de=n?Math.round(V*vE.premiumMultiplier):V,ae=Math.min(de,vE.maxXPPerSession-g.current);if(!(ae<=0)){g.current+=ae;try{const ye=at(Me,"users",s),Q=await fr(ye);if(Q.exists()){const $=Q.data().xp||0,se=Q.data().level||1;C.current=se;const ce=$+ae,he=gV(ce);await Kn(ye,{xp:ta(ae),level:he,totalVoiceMinutes:ta(1),lastXPGain:Uo()}),u(ae,ee),i==null||i(ae,ee),he>se&&(l==null||l(he))}}catch{}}},[s,n,u,i,l]),A=H.useCallback(()=>{p.current||!s||(y.current=!0,g.current=0,p.current=setInterval(()=>{if(!y.current)return;let V=vE.voiceMinuteXP,ee="Sprachchat Minute";x.current&&(V+=vE.speakingBonusXP,ee="Aktiv gesprochen"),k(V,ee)},vE.xpTickIntervalMs))},[s,k]),M=H.useCallback(()=>{y.current=!1,p.current&&(clearInterval(p.current),p.current=null)},[]),G=H.useCallback(V=>{x.current=V},[]);H.useEffect(()=>()=>{M()},[M]);const B=H.useCallback(async()=>{await k(50,"Tglicher Login")},[k]),X=H.useCallback(async()=>{await k(25,"Positive Bewertung erhalten")},[k]),Z=H.useCallback(async V=>{await k(V*15,`${V} Stern(e) erhalten`)},[k]),q=H.useCallback(async()=>{await k(100,"Erste Verbindung heute")},[k]);return{startVoiceXPTick:A,stopVoiceXPTick:M,updateSpeakingStatus:G,awardXP:k,awardDailyLoginXP:B,awardPositiveRatingXP:X,awardStarReceivedXP:Z,awardFirstConnectionXP:q,sessionXP:g.current,calculateLevel:gV,calculateXPProgress:eCe}},nCe=()=>{const s=fp(),n=zr(),{user:i}=mr(),[l,u]=H.useState([]),[p,g]=H.useState([]),[y,x]=H.useState(null),[C,k]=H.useState(!0),[A,M]=H.useState(0),[G,B]=H.useState(null),[X,Z]=H.useState(!1),[q,V]=H.useState(!0),[ee,de]=H.useState(!1),[ae,ye]=H.useState("all"),[Q,$]=H.useState(""),[se,ce]=H.useState("public"),[he,ve]=H.useState(!1),[ge,qe]=H.useState(!1),[Dt,gt]=H.useState(!1),[Ye,ze]=H.useState(0),{playJoinSound:ut,playLeaveSound:yt,playWarningSound:Xt,playMuteSound:jt}=Sre(),Gt=(i==null?void 0:i.isPremium)||!1,{startVoiceXPTick:mn,stopVoiceXPTick:Pt,updateSpeakingStatus:Jt}=tCe({userId:i==null?void 0:i.id,isPremium:Gt,onLevelUp:Ve=>{}}),{isConnected:He,isConnecting:bt,localAudioLevel:Wt,error:gn,microphonePermission:xt,afkWarning:Sn,afkTimeRemaining:cr,joinChannel:Or,leaveChannel:ms,toggleMute:Oi,dismissAFKWarning:xi}=ZRe({roomId:(y==null?void 0:y.id)||"",oderId:(i==null?void 0:i.id)||"",username:(i==null?void 0:i.username)||"",onError:Ve=>{},onAFKWarning:()=>{qe(!0),Xt()},onAFKKick:()=>{gt(!0)},onSpeakingChange:Ve=>{Jt(Ve)}});H.useEffect(()=>{He&&y?mn():Pt()},[He,y,mn,Pt]),H.useEffect(()=>{const Ve=xn(Me,"rooms"),Qt=qa(Ve,_n=>{const Qe=[];_n.docs.forEach(Bt=>{var sn;const Ct=Bt.data();Ct.isActive!==!1&&Qe.push({id:Bt.id,name:Ct.name,type:Ct.type||"public",isAnonymous:Ct.isAnonymous||!1,participants:(Ct.participants||[]).map(Qn=>{var qn;return{id:Qn.oderId||Qn.id,oderId:Qn.oderId||Qn.id,username:Qn.username||"unknown",displayName:Qn.displayName||"Unbekannt",isSpeaking:Qn.isSpeaking||!1,isMuted:Qn.isMuted||!1,isAnonymous:Qn.isAnonymous||!1,level:Qn.level||1,joinedAt:((qn=Qn.joinedAt)==null?void 0:qn.toDate())||new Date}}),maxParticipants:Ct.maxParticipants||8,xpMultiplier:Ct.xpMultiplier||1,regionName:Ct.regionName,createdAt:((sn=Ct.createdAt)==null?void 0:sn.toDate())||new Date,createdBy:Ct.createdBy})}),Qe.sort((Bt,Ct)=>Ct.createdAt.getTime()-Bt.createdAt.getTime()),u(Qe),V(!1)},_n=>{console.error("Error fetching rooms:",_n),V(!1)});return()=>Qt()},[]),H.useEffect(()=>{const Ve=xn(Me,"starEvents"),Qt=qa(Ve,_n=>{const Qe=[];_n.docs.forEach(Bt=>{var sn,Qn,qn;const Ct=Bt.data();Ct.isActive!==!1&&Qe.push({id:Bt.id,hostId:Ct.hostId,hostUsername:Ct.hostUsername,hostDisplayName:Ct.hostDisplayName,hostTier:Ct.hostTier||"nova",title:Ct.title,description:Ct.description,category:Ct.category||"general",startedAt:(sn=Ct.startedAt)==null?void 0:sn.toDate(),scheduledAt:(Qn=Ct.scheduledAt)==null?void 0:Qn.toDate(),endedAt:(qn=Ct.endedAt)==null?void 0:qn.toDate(),maxCapacity:Ct.maxCapacity||100,currentListeners:Ct.currentListeners||0,peakListeners:Ct.peakListeners||0,stageParticipants:Ct.stageParticipants||[],handRaiseQueue:Ct.handRaiseQueue||[],starsReceived:Ct.starsReceived||0,chatMessages:Ct.chatMessages||0,isPublic:Ct.isPublic!==!1,isRecording:Ct.isRecording||!1,isPinned:Ct.isPinned||!1,xpMultiplier:Ct.xpMultiplier||2})}),Qe.sort((Bt,Ct)=>{var qn,Bs;const sn=((qn=Bt.startedAt)==null?void 0:qn.getTime())||0;return(((Bs=Ct.startedAt)==null?void 0:Bs.getTime())||0)-sn}),g(Qe)},_n=>{console.error("Error fetching star events:",_n)});return()=>Qt()},[]),H.useEffect(()=>{if(!y)return;const Ve=at(Me,"rooms",y.id),Qt=qa(Ve,async _n=>{var Qe;if(_n.exists()){const Bt=_n.data();if(!Bt.isActive){x(null),k(!0),M(0);return}const Ct=(Bt.participants||[]).map(qn=>{var Bs;return{id:qn.oderId||qn.id,oderId:qn.oderId||qn.id,username:qn.username||"unknown",displayName:qn.displayName||"Unbekannt",isSpeaking:qn.isSpeaking||!1,isMuted:qn.isMuted||!1,isAnonymous:qn.isAnonymous||!1,level:qn.level||1,joinedAt:((Bs=qn.joinedAt)==null?void 0:Bs.toDate())||new Date}});if(i!=null&&i.id&&Ct.filter(Bs=>Bs.oderId===i.id).length>1){gt(!0);return}const sn=Ct.length,Qn=Ye;if(Qn>0&&sn!==Qn){const qn=i==null?void 0:i.id,Bs=y.participants.some(Xl=>Xl.oderId===qn),qd=Ct.some(Xl=>Xl.oderId===qn);Bs&&qd&&(sn>Qn?ut():sn<Qn&&yt())}ze(sn),x({id:_n.id,name:Bt.name,type:Bt.type||"public",isAnonymous:Bt.isAnonymous||!1,participants:Ct,maxParticipants:Bt.maxParticipants||8,xpMultiplier:Bt.xpMultiplier||1,regionName:Bt.regionName,createdAt:((Qe=Bt.createdAt)==null?void 0:Qe.toDate())||new Date,createdBy:Bt.createdBy})}else x(null),k(!0),M(0)});return()=>Qt()},[y==null?void 0:y.id]),H.useEffect(()=>{const Ve=s.state;(Ve==null?void 0:Ve.filter)==="stars"&&(ye("stars"),window.history.replaceState({},document.title))},[s.state]),H.useEffect(()=>{const Ve=s.state;if(Ve!=null&&Ve.joinRoom){const Qt=l.filter(_n=>_n.participants.length<_n.maxParticipants);if(Qt.length>0){const _n=Qt[Math.floor(Math.random()*Qt.length)];Gr(_n,Ve.mode==="anonymous")}window.history.replaceState({},document.title)}},[s.state,l]),H.useEffect(()=>{if(A>0){const Ve=setTimeout(()=>{M(A-1),A===1&&(k(!1),"vibrate"in navigator&&navigator.vibrate([50,30,50]))},1e3);return()=>clearTimeout(Ve)}},[A]);const Gr=async(Ve,Qt=!1)=>{if(i!=null&&i.id){y&&await qt();try{const _n=at(Me,"rooms",Ve.id),Qe=await fr(_n);if(!Qe.exists())return;const Ct=Qe.data().participants||[];if(Ct.some(qn=>qn.oderId===i.id)){const qn=Ct.filter(Bs=>Bs.oderId!==i.id);await Kn(_n,{participants:qn})}const Qn={oderId:i.id,username:i.username||"unknown",displayName:Qt?"Wanderer":i.displayName||"Unbekannt",isSpeaking:!1,isMuted:!0,isAnonymous:Qt||Ve.isAnonymous,level:i.level||1,joinedAt:cn.now()};await Kn(_n,{participants:Ywe(Qn)}),ze(Ct.length+1),x(Ve),k(!0),M(4),"vibrate"in navigator&&navigator.vibrate([20,10,20])}catch{}}};H.useEffect(()=>{y&&(i!=null&&i.id)&&!He&&!bt&&Or()},[y==null?void 0:y.id,i==null?void 0:i.id]),H.useEffect(()=>{if(!y||!(i!=null&&i.id))return;const Ve=async()=>{try{const Bt=at(Me,"rooms",y.id),Ct=y.participants.filter(sn=>sn.oderId!==i.id);Ct.length===0?(await Ga(Bt),console.log("Empty room deleted:",y.id)):await Kn(Bt,{participants:Ct.map(sn=>({oderId:sn.oderId,username:sn.username,displayName:sn.displayName,isSpeaking:sn.isSpeaking,isMuted:sn.isMuted,isAnonymous:sn.isAnonymous,level:sn.level,joinedAt:cn.fromDate(sn.joinedAt)}))})}catch(Bt){console.error("Error auto-leaving room:",Bt)}},Qt=()=>{Ve()},_n=()=>{if(document.visibilityState==="hidden"){const Bt=setTimeout(()=>{document.visibilityState==="hidden"&&(Ve(),x(null))},3e4);return()=>clearTimeout(Bt)}},Qe=()=>{Ve(),x(null),k(!0)};return window.addEventListener("beforeunload",Qt),window.addEventListener("visibilitychange",_n),window.addEventListener("offline",Qe),()=>{window.removeEventListener("beforeunload",Qt),window.removeEventListener("visibilitychange",_n),window.removeEventListener("offline",Qe)}},[y,i==null?void 0:i.id]);const qt=async()=>{if(await ms(),!y||!(i!=null&&i.id)){x(null),k(!0),M(0);return}try{const Ve=at(Me,"rooms",y.id);if(y.participants.find(_n=>_n.oderId===i.id)){const _n=y.participants.filter(Qe=>Qe.oderId!==i.id);_n.length===0?(await Ga(Ve),console.log("Empty room deleted:",y.id)):await Kn(Ve,{participants:_n.map(Qe=>({oderId:Qe.oderId,username:Qe.username,displayName:Qe.displayName,isSpeaking:Qe.isSpeaking,isMuted:Qe.isMuted,isAnonymous:Qe.isAnonymous,level:Qe.level,joinedAt:cn.fromDate(Qe.joinedAt)}))})}}catch(Ve){console.error("Error leaving room:",Ve)}x(null),k(!0),M(0),gt(!1)};H.useEffect(()=>{Dt&&qt()},[Dt]);const[Jr,Ht]=H.useState(!1),[wi,Cs]=H.useState(null),gr=async()=>{if(!Q.trim()||!(i!=null&&i.id)){Cs("Bitte gib einen Namen ein");return}Ht(!0),Cs(null);try{const Ve={name:Q.trim(),type:se,isAnonymous:he,participants:[],maxParticipants:8,xpMultiplier:1,isActive:!0,createdAt:cn.now(),createdBy:i.id};console.log("Creating room with data:",Ve);const Qt=await my(xn(Me,"rooms"),Ve);console.log("Room created with ID:",Qt.id),Z(!1),$(""),ce("public"),ve(!1)}catch(Ve){console.error("Error creating room:",Ve),Cs(Ve.message||"Fehler beim Erstellen des Wlkchens")}finally{Ht(!1)}},Za=async()=>{if(A>0||!y||!(i!=null&&i.id))return;await Oi();const Ve=!C;k(Ve),jt(Ve);try{const Qt=at(Me,"rooms",y.id),_n=y.participants.map(Qe=>Qe.oderId===i.id?{...Qe,isMuted:Ve,isSpeaking:!Ve,joinedAt:cn.fromDate(Qe.joinedAt)}:{...Qe,joinedAt:cn.fromDate(Qe.joinedAt)});await Kn(Qt,{participants:_n})}catch(Qt){console.error("Error updating mute status:",Qt)}},es=Ve=>{console.log("Vote to remove:",Ve),B(null)},Sr=async()=>{de(!0),await new Promise(Ve=>setTimeout(Ve,1e3)),de(!1)},Ki=l.filter(Ve=>ae==="all"||ae==="stars"?!0:ae==="public"?Ve.type==="public"&&!Ve.isAnonymous:ae==="anonymous"?Ve.isAnonymous:ae==="regional"?Ve.type==="regional":!0),Go=Ve=>{const Qt=Math.floor((Date.now()-Ve.getTime())/6e4);return Qt<60?`${Qt}m`:`${Math.floor(Qt/60)}h ${Qt%60}m`},vc=p.filter(Ve=>Ve.startedAt&&!Ve.endedAt),Ec=l.reduce((Ve,Qt)=>Ve+Qt.participants.length,0);return q?o.jsx("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx(Br,{size:32,className:"animate-spin text-delulu-violet mx-auto mb-4"}),o.jsx("p",{className:"text-delulu-muted text-sm",children:"Lade Wlkchen..."})]})}):o.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white safe-top pb-24",children:[y?o.jsxs("div",{className:"px-6 pt-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("h1",{className:"font-display text-xl font-bold text-delulu-text",children:y.name}),y.isAnonymous&&o.jsx("span",{className:"px-2 py-0.5 bg-purple-100 text-purple-600 text-[10px] font-bold rounded-full",children:"ANONYM"}),y.xpMultiplier>1&&o.jsxs("span",{className:"px-2 py-0.5 bg-amber-100 text-amber-600 text-[10px] font-bold rounded-full flex items-center gap-1",children:[o.jsx(Ei,{size:10})," ",y.xpMultiplier,"x XP"]})]}),o.jsxs("p",{className:"text-sm text-delulu-muted",children:[y.participants.length," / ",y.maxParticipants," Teilnehmer"]})]}),o.jsx("button",{onClick:qt,className:"px-4 py-2 bg-red-100 text-red-600 rounded-xl font-semibold text-sm hover:bg-red-200 transition-colors",children:"Verlassen"})]}),A>0&&o.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-2xl p-4 mb-6 flex items-center gap-4",children:[o.jsx("div",{className:"w-12 h-12 rounded-xl bg-amber-100 flex items-center justify-center",children:o.jsx(Gi,{size:24,className:"text-amber-600"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("p",{className:"font-semibold text-amber-800",children:"Bitte erst zuhren"}),o.jsxs("p",{className:"text-sm text-amber-600",children:["Du kannst in ",A," Sekunden sprechen"]})]}),o.jsx("div",{className:"w-12 h-12 rounded-full bg-amber-500 flex items-center justify-center text-white font-bold text-xl",children:A})]}),y.participants.length===0?o.jsxs("div",{className:"text-center py-12",children:[o.jsx("div",{className:"w-20 h-20 mx-auto rounded-2xl bg-gray-100 flex items-center justify-center mb-4",children:o.jsx(rr,{size:32,className:"text-gray-400"})}),o.jsx("h3",{className:"font-semibold text-delulu-text mb-2",children:"Wlkchen ist leer"}),o.jsx("p",{className:"text-sm text-delulu-muted",children:"Du bist der Erste! Warte auf andere oder teile das Wlkchen."})]}):o.jsx("div",{className:"grid grid-cols-2 gap-4 mb-6",children:y.participants.map(Ve=>{const Qt=!Ve.isAnonymous&&!y.isAnonymous&&Ve.oderId!==(i==null?void 0:i.id);return o.jsxs("div",{onClick:()=>{Qt&&n(`/user/${Ve.oderId}`)},className:`bg-white rounded-2xl p-4 shadow-sm relative ${Ve.isSpeaking?"ring-2 ring-green-400 ring-offset-2":""} ${Qt?"cursor-pointer hover:shadow-md active:scale-[0.98] transition-all":""}`,children:[Ve.isSpeaking&&o.jsx("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center",children:o.jsx(pO,{size:12,className:"text-white"})}),Qt&&o.jsx("div",{className:"absolute top-2 right-2",children:o.jsx(ep,{size:12,className:"text-delulu-violet"})}),o.jsx("div",{className:`w-16 h-16 mx-auto rounded-full flex items-center justify-center mb-3 ${Ve.isAnonymous?"bg-purple-100":"bg-delulu-violet/10"} ${Ve.isSpeaking?"animate-pulse":""}`,children:Ve.isAnonymous?o.jsx($c,{size:24,className:"text-purple-500"}):o.jsx("span",{className:"text-2xl",children:""})}),o.jsx("p",{className:"font-semibold text-sm text-center text-delulu-text truncate",children:Ve.isAnonymous?"Wanderer":Ve.displayName}),o.jsxs("p",{className:"text-[10px] text-center text-delulu-muted",children:["Level ",Ve.level]}),Qt&&o.jsx("p",{className:"text-[10px] text-center text-delulu-violet mt-1 font-medium",children:"Profil ansehen "}),Ve.isMuted&&o.jsx("div",{className:"absolute bottom-2 right-2",children:o.jsx(TRe,{size:14,className:"text-red-400"})}),Ve.oderId!==(i==null?void 0:i.id)&&o.jsx("button",{onClick:_n=>{_n.stopPropagation(),B(Ve.id)},className:"absolute top-2 left-2 w-6 h-6 rounded-full bg-gray-100 flex items-center justify-center text-gray-400 hover:bg-red-100 hover:text-red-500 transition-colors",children:o.jsx(RJ,{size:12})})]},Ve.id)})}),o.jsxs("div",{className:"fixed bottom-24 left-0 right-0 px-6",children:[gn&&o.jsx("div",{className:"mb-2 p-2 bg-red-50 border border-red-200 rounded-xl text-center",children:o.jsx("p",{className:"text-xs text-red-600",children:gn})}),o.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-lg",children:[o.jsx("div",{className:"flex items-center justify-center gap-2 mb-3",children:bt?o.jsxs(o.Fragment,{children:[o.jsx(Br,{size:14,className:"animate-spin text-amber-500"}),o.jsx("span",{className:"text-xs text-amber-600",children:"Verbinde..."})]}):He?o.jsxs(o.Fragment,{children:[o.jsx(RRe,{size:14,className:"text-green-500"}),o.jsx("span",{className:"text-xs text-green-600",children:"Voice verbunden"})]}):o.jsxs(o.Fragment,{children:[o.jsx(Lre,{size:14,className:"text-gray-400"}),o.jsx("span",{className:"text-xs text-gray-500",children:"Voice nicht verbunden"})]})}),He&&!C&&o.jsx("div",{className:"h-1 bg-gray-200 rounded-full mb-3 overflow-hidden",children:o.jsx("div",{className:"h-full bg-green-500 rounded-full transition-all duration-100",style:{width:`${Math.min(100,Wt*200)}%`}})}),o.jsxs("div",{className:"flex items-center justify-center gap-4",children:[o.jsx("button",{onClick:Za,disabled:A>0||!He,className:`w-16 h-16 rounded-full flex items-center justify-center transition-all ${C||A>0?"bg-red-500 text-white":"bg-green-500 text-white scale-110"} disabled:opacity-50`,children:C||A>0?o.jsx(TJ,{size:28}):o.jsx(eh,{size:28})}),o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"font-semibold text-delulu-text",children:A>0?"Warte...":C?"Stumm":"Sprechen"}),o.jsx("p",{className:"text-xs text-delulu-muted",children:A>0?`${A}s`:He?"Tippe zum Umschalten":"Warte auf Verbindung..."})]})]})]})]})]}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"px-6 pt-6 pb-4",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"font-display text-2xl font-bold text-delulu-text",children:"Entdecken"}),o.jsx("p",{className:"text-sm text-delulu-muted",children:Ec>0?`${Ec} User in ${l.length} Wlkchen`:"Noch keine aktiven Wlkchen"})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:()=>Z(!0),className:"w-10 h-10 rounded-xl bg-delulu-violet text-white shadow-sm flex items-center justify-center hover:bg-delulu-violet/90 transition-colors",children:o.jsx($S,{size:20})}),o.jsx("button",{onClick:Sr,disabled:ee,className:"w-10 h-10 rounded-xl bg-white shadow-sm flex items-center justify-center text-delulu-muted hover:text-delulu-violet transition-colors",children:o.jsx(gS,{size:20,className:ee?"animate-spin":""})})]})]})}),o.jsx("div",{className:"px-6 mb-4",children:o.jsx("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide pb-2",children:[{id:"all",label:"Alle",icon:rr},{id:"stars",label:"Stars",icon:wr,special:!0},{id:"public",label:"ffentlich",icon:D_},{id:"anonymous",label:"Anonym",icon:$c},{id:"regional",label:"Regional",icon:_c}].map(Ve=>o.jsxs("button",{onClick:()=>ye(Ve.id),className:`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-semibold whitespace-nowrap transition-all ${ae===Ve.id?Ve.special?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-delulu-violet text-white shadow-lg":Ve.special?"bg-purple-50 text-purple-600 hover:bg-purple-100":"bg-white text-delulu-muted hover:bg-gray-50"}`,children:[o.jsx(Ve.icon,{size:16}),Ve.label,Ve.special&&vc.length>0&&o.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse"})]},Ve.id))})}),(ae==="all"||ae==="stars")&&p.length>0&&o.jsxs("div",{className:"px-6 mb-6",children:[ae==="all"&&o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsxs("h2",{className:"font-semibold text-delulu-text flex items-center gap-2",children:[o.jsx(wr,{size:18,className:"text-purple-500"}),"Star Events"]}),o.jsx("button",{onClick:()=>ye("stars"),className:"text-sm text-purple-500 font-medium",children:"Alle anzeigen"})]}),o.jsx("div",{className:"space-y-4",children:p.map(Ve=>{const Qt=!!Ve.startedAt&&!Ve.endedAt,_n=!!Ve.scheduledAt&&!Ve.startedAt;return o.jsx("div",{className:"relative",children:o.jsx(KRe,{tier:Ve.hostTier,intensity:"normal",children:o.jsxs("div",{className:"bg-gradient-to-br from-gray-900/95 to-gray-800/95 rounded-2xl p-4 border border-purple-500/30",children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[Qt?o.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-red-500/20 rounded-full",children:[o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-ping absolute"}),o.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full relative"})]}),o.jsx("span",{className:"text-[10px] font-bold text-red-400",children:"LIVE"})]}):_n?o.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-blue-500/20 rounded-full",children:[o.jsx(Gi,{size:12,className:"text-blue-400"}),o.jsx("span",{className:"text-[10px] font-bold text-blue-400",children:new Date(Ve.scheduledAt).toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})})]}):null,Ve.xpMultiplier>1&&o.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-amber-500/20 rounded-full",children:[o.jsx(Ei,{size:12,className:"text-amber-400"}),o.jsxs("span",{className:"text-[10px] font-bold text-amber-400",children:[Ve.xpMultiplier,"x XP"]})]})]}),o.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"w-14 h-14 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 border-2",style:{borderColor:Ve.hostTier==="galaxy"?"#EC4899":"#F59E0B",boxShadow:`0 0 20px ${Ve.hostTier==="galaxy"?"rgba(236, 72, 153, 0.5)":"rgba(245, 158, 11, 0.5)"}`}}),o.jsx("div",{className:"absolute -bottom-1 -right-1",children:o.jsx(vy,{tier:Ve.hostTier,size:"md"})})]}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("div",{className:"flex items-center gap-2",children:o.jsxs("h3",{className:"font-bold text-white",children:["@",Ve.hostUsername]})}),o.jsx("p",{className:"text-sm text-gray-400",children:Ve.hostDisplayName})]})]}),o.jsx("h4",{className:"font-semibold text-white mb-2",children:Ve.title}),o.jsx("p",{className:"text-sm text-gray-400 mb-3",children:Ve.description}),Qt&&o.jsxs("div",{className:"flex items-center gap-4 mb-4 text-xs text-gray-500",children:[o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx(rr,{size:14}),Ve.currentListeners.toLocaleString()," zuhren"]}),o.jsxs("span",{className:"flex items-center gap-1 text-amber-400",children:[o.jsx(hs,{size:14}),Ve.starsReceived," Sterne"]}),Ve.handRaiseQueue.length>0&&o.jsxs("span",{className:"flex items-center gap-1 text-purple-400",children:[o.jsx(pV,{size:14}),Ve.handRaiseQueue.length," warten"]})]}),o.jsx("button",{onClick:()=>console.log("Join star event:",Ve.id),className:`w-full py-3 rounded-xl font-semibold flex items-center justify-center gap-2 transition-all ${Qt?"bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:opacity-90":"bg-gray-700 text-gray-300"}`,children:Qt?o.jsxs(o.Fragment,{children:[o.jsx(eh,{size:18}),"Jetzt reinhren"]}):o.jsxs(o.Fragment,{children:[o.jsx(Gi,{size:18}),"Erinnerung setzen"]})})]})})},Ve.id)})})]}),ae==="stars"&&p.length===0&&o.jsx("div",{className:"px-6 py-12",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"w-20 h-20 mx-auto rounded-2xl bg-purple-50 flex items-center justify-center mb-4",children:o.jsx(wr,{size:32,className:"text-purple-400"})}),o.jsx("h3",{className:"font-semibold text-delulu-text mb-2",children:"Keine Star Events"}),o.jsx("p",{className:"text-sm text-delulu-muted max-w-xs mx-auto",children:"Aktuell sind keine Star Events live oder geplant. Schau spter nochmal vorbei!"})]})}),ae!=="stars"&&l.length>0&&o.jsx("div",{className:"px-6 mb-4",children:o.jsx("div",{className:"bg-gradient-to-r from-amber-400 to-orange-500 rounded-2xl p-4 text-white",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center",children:o.jsx(Ei,{size:24})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("p",{className:"font-semibold",children:"Regional-Bonus aktiv!"}),o.jsx("p",{className:"text-sm text-white/80",children:"Bis zu 3x XP in bestimmten Zonen - geh raus und entdecke!"})]})]})})}),ae!=="stars"&&o.jsx("div",{className:"px-6 space-y-4",children:l.length===0?o.jsxs("div",{className:"text-center py-12",children:[o.jsx(Ju,{delay:0,children:o.jsx(zF,{size:140,className:"mx-auto mb-4"})}),o.jsx("h3",{className:"font-display font-bold text-xl text-delulu-text mb-3",children:GF.empty.lounges}),o.jsx("p",{className:"text-sm text-delulu-muted mb-8 max-w-xs mx-auto leading-relaxed",children:"Sei der Erste und erstelle ein Wlkchen, in dem sich deine Nachbarschaft treffen kann!"}),o.jsxs("button",{onClick:()=>Z(!0),className:"inline-flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-delulu-violet to-purple-600 text-white rounded-2xl font-display font-bold shadow-lg hover:shadow-xl transition-all",children:[o.jsx($S,{size:20}),"Wlkchen erstellen"]})]}):Ki.length===0?o.jsxs("div",{className:"text-center py-12",children:[o.jsx(Ju,{delay:.2,children:o.jsx(ZS,{size:120,className:"mx-auto mb-2"})}),o.jsx("p",{className:"font-semibold text-delulu-text mb-2",children:"Keine Wlkchen gefunden"}),o.jsx("p",{className:"text-sm text-delulu-muted mb-4",children:"ndere den Filter oder erstelle ein neues Wlkchen"}),o.jsx("button",{onClick:()=>ye("all"),className:"px-6 py-3 bg-delulu-violet text-white rounded-xl font-semibold",children:"Alle Wlkchen anzeigen"})]}):Ki.map(Ve=>o.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm hover:shadow-md transition-shadow",children:[o.jsxs("div",{className:"flex items-start justify-between mb-3",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.jsx("h3",{className:"font-semibold text-delulu-text",children:Ve.name}),Ve.isAnonymous&&o.jsx(Hi,{size:14,className:"text-purple-500"})]}),o.jsxs("div",{className:"flex items-center gap-3 text-xs text-delulu-muted",children:[o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx(rr,{size:12}),Ve.participants.length,"/",Ve.maxParticipants]}),o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx(Gi,{size:12}),Go(Ve.createdAt)]})]})]}),Ve.xpMultiplier>1&&o.jsxs("div",{className:"px-2 py-1 bg-amber-100 text-amber-600 rounded-lg text-xs font-bold flex items-center gap-1",children:[o.jsx(Ei,{size:12}),Ve.xpMultiplier,"x XP"]})]}),o.jsx("div",{className:"flex items-center gap-2 mb-4",children:Ve.participants.length>0?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex -space-x-2",children:[Ve.participants.slice(0,4).map(Qt=>o.jsx("div",{className:`w-8 h-8 rounded-full border-2 border-white flex items-center justify-center text-xs ${Qt.isAnonymous?"bg-purple-100 text-purple-600":"bg-delulu-violet/10 text-delulu-violet"} ${Qt.isSpeaking?"ring-2 ring-green-400":""}`,children:Qt.isAnonymous?"?":Qt.displayName[0]},Qt.id)),Ve.participants.length>4&&o.jsxs("div",{className:"w-8 h-8 rounded-full border-2 border-white bg-gray-100 flex items-center justify-center text-xs text-gray-500",children:["+",Ve.participants.length-4]})]}),Ve.participants.some(Qt=>Qt.isSpeaking)&&o.jsxs("div",{className:"flex items-center gap-1 text-green-600 text-xs",children:[o.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),o.jsx("span",{children:"Aktiv"})]})]}):o.jsx("p",{className:"text-xs text-delulu-muted italic",children:"Noch keine Teilnehmer"})}),o.jsxs("button",{onClick:()=>Gr(Ve,Ve.isAnonymous),disabled:Ve.participants.length>=Ve.maxParticipants,className:"w-full py-3 rounded-xl bg-delulu-violet text-white font-semibold hover:bg-delulu-violet/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[o.jsx(ep,{size:18}),Ve.isAnonymous?"Anonym beitreten":"Beitreten"]})]},Ve.id))})]}),X&&o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-6 bg-black/60 backdrop-blur-sm",children:o.jsxs("div",{className:"w-full max-w-sm bg-white rounded-3xl p-6 shadow-2xl",children:[o.jsx("h2",{className:"font-display text-xl font-bold text-delulu-text mb-6 text-center",children:"Wlkchen erstellen"}),o.jsxs("div",{className:"space-y-4 mb-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-delulu-text mb-2",children:"Name"}),o.jsx("input",{type:"text",value:Q,onChange:Ve=>$(Ve.target.value),placeholder:"z.B. Chill Wlkchen",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-delulu-violet/30",maxLength:30})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-delulu-text mb-2",children:"Typ"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs("button",{onClick:()=>ce("public"),className:`flex-1 py-3 rounded-xl font-semibold flex items-center justify-center gap-2 ${se==="public"?"bg-delulu-violet text-white":"bg-gray-100 text-gray-600"}`,children:[o.jsx(D_,{size:18}),"ffentlich"]}),o.jsxs("button",{onClick:()=>ce("private"),className:`flex-1 py-3 rounded-xl font-semibold flex items-center justify-center gap-2 ${se==="private"?"bg-delulu-violet text-white":"bg-gray-100 text-gray-600"}`,children:[o.jsx(Hi,{size:18}),"Privat"]})]})]}),o.jsxs("label",{className:"flex items-center gap-3 p-4 bg-purple-50 rounded-xl cursor-pointer",children:[o.jsx("input",{type:"checkbox",checked:he,onChange:Ve=>ve(Ve.target.checked),className:"w-5 h-5 rounded text-purple-500"}),o.jsxs("div",{children:[o.jsxs("p",{className:"font-medium text-delulu-text flex items-center gap-2",children:[o.jsx($c,{size:16,className:"text-purple-500"}),"Anonymes Wlkchen"]}),o.jsx("p",{className:"text-xs text-delulu-muted",children:'Alle Teilnehmer werden als "Wanderer" angezeigt'})]})]})]}),wi&&o.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-xl",children:o.jsx("p",{className:"text-sm text-red-600",children:wi})}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:()=>{Z(!1),Cs(null)},disabled:Jr,className:"flex-1 py-3 px-4 bg-gray-100 text-gray-600 rounded-xl font-semibold disabled:opacity-50",children:"Abbrechen"}),o.jsx("button",{onClick:gr,disabled:!Q.trim()||Jr,className:"flex-1 py-3 px-4 bg-delulu-violet text-white rounded-xl font-semibold disabled:opacity-50 flex items-center justify-center gap-2",children:Jr?o.jsxs(o.Fragment,{children:[o.jsx(Br,{size:18,className:"animate-spin"}),"Erstelle..."]}):"Erstellen"})]})]})}),G&&o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-6 bg-black/60 backdrop-blur-sm",children:o.jsxs("div",{className:"w-full max-w-sm bg-white rounded-3xl p-6 shadow-2xl",children:[o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:o.jsx(ql,{size:32,className:"text-red-600"})}),o.jsx("h2",{className:"font-display text-xl font-bold text-delulu-text mb-2",children:"User melden?"}),o.jsx("p",{className:"text-sm text-delulu-muted",children:"Bei mehreren Meldungen wird der User aus dem Wlkchen entfernt. Missbrauch dieser Funktion wird geahndet."})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:()=>B(null),className:"flex-1 py-3 px-4 bg-gray-100 text-gray-600 rounded-xl font-semibold",children:"Abbrechen"}),o.jsxs("button",{onClick:()=>es(G),className:"flex-1 py-3 px-4 bg-red-500 text-white rounded-xl font-semibold flex items-center justify-center gap-2",children:[o.jsx(RJ,{size:18}),"Melden"]})]})]})}),(ge||Sn)&&y&&o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-6 bg-black/60 backdrop-blur-sm",children:o.jsxs("div",{className:"w-full max-w-sm bg-white rounded-3xl p-6 shadow-2xl animate-pulse",children:[o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("div",{className:"w-20 h-20 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce",children:o.jsx(ql,{size:40,className:"text-amber-600"})}),o.jsx("h2",{className:"font-display text-xl font-bold text-delulu-text mb-2",children:"Bist du noch da? "}),o.jsx("p",{className:"text-sm text-delulu-muted mb-4",children:"Du hast schon lnger nicht mehr gesprochen. Bitte besttige, dass du noch teilnimmst."}),cr>0&&o.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-red-100 text-red-600 rounded-full font-semibold",children:[o.jsx(Gi,{size:16}),"Auto-Kick in ",cr,"s"]})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:()=>{qt(),qe(!1)},className:"flex-1 py-3 px-4 bg-gray-100 text-gray-600 rounded-xl font-semibold",children:"Verlassen"}),o.jsxs("button",{onClick:()=>{xi(),qe(!1)},className:"flex-1 py-3 px-4 bg-green-500 text-white rounded-xl font-semibold flex items-center justify-center gap-2",children:[o.jsx(pV,{size:18}),"Ich bin da!"]})]})]})}),y&&xt==="denied"&&o.jsx("div",{className:"fixed top-0 left-0 right-0 z-40 bg-amber-500 text-white px-4 py-3 safe-top",children:o.jsxs("div",{className:"flex items-center gap-3 max-w-md mx-auto",children:[o.jsx(TJ,{size:20,className:"flex-shrink-0"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("p",{className:"font-semibold text-sm",children:"Mikrofon deaktiviert"}),o.jsx("p",{className:"text-xs opacity-90",children:"Du kannst zuhren, aber nicht sprechen. Aktiviere das Mikrofon in deinen Browser-Einstellungen."})]})]})})]})},rCe=()=>{const s=zr(),{user:n}=mr(),[i,l]=H.useState("all"),[u,p]=H.useState(""),[g,y]=H.useState(!0),[x,C]=H.useState([]),[k,A]=H.useState(!0);H.useEffect(()=>{if(!(n!=null&&n.id)){A(!1);return}const V=xn(Me,"conversations"),ee=Zr(V,or("participants","array-contains",n.id),fy("lastMessageAt","desc")),de=qa(ee,async ae=>{var Q,$,se,ce;const ye=[];for(const he of ae.docs){const ve=he.data(),ge=ve.participants.find(qe=>qe!==n.id);if(ge)try{const qe=await fr(at(Me,"users",ge));if(!qe.exists())continue;const Dt=qe.data(),gt=await fr(at(Me,"friendships",`${n.id}_${ge}`)),Ye=await fr(at(Me,"friendships",`${ge}_${n.id}`)),ze=gt.exists()||Ye.exists(),ut=((Q=ve.unreadBy)==null?void 0:Q[n.id])||0;ye.push({id:he.id,oderId:ge,username:Dt.username||"unknown",displayName:Dt.displayName||Dt.username||"Unbekannt",avatarUrl:Dt.avatarUrl,isFriend:ze,metAt:($=ve.metAt)==null?void 0:$.toDate(),lastMessage:ve.lastMessage?{content:ve.lastMessage.content,createdAt:((se=ve.lastMessage.createdAt)==null?void 0:se.toDate())||new Date,isFromMe:ve.lastMessage.senderId===n.id}:void 0,unreadCount:ut,isOnline:Dt.isActive&&((ce=Dt.lastSeen)==null?void 0:ce.toDate())>new Date(Date.now()-5*60*1e3),level:Dt.level||1})}catch(qe){console.error("Error fetching user data:",qe)}}C(ye),A(!1)},ae=>{console.error("Error fetching conversations:",ae),A(!1)});return()=>de()},[n==null?void 0:n.id]);const G=[...x.filter(V=>{if(u){const ee=u.toLowerCase();if(!V.username.toLowerCase().includes(ee)&&!V.displayName.toLowerCase().includes(ee))return!1}return i==="friends"?V.isFriend:i==="met"?!V.isFriend&&V.metAt:!0})].sort((V,ee)=>{var ye,Q;if(V.unreadCount!==ee.unreadCount)return ee.unreadCount-V.unreadCount;const de=((ye=V.lastMessage)==null?void 0:ye.createdAt.getTime())||0;return(((Q=ee.lastMessage)==null?void 0:Q.createdAt.getTime())||0)-de}),B=x.filter(V=>V.isFriend).length,X=x.filter(V=>!V.isFriend&&V.metAt).length,Z=x.reduce((V,ee)=>V+ee.unreadCount,0),q=V=>{const de=new Date().getTime()-V.getTime(),ae=Math.floor(de/(1e3*60*60*24));return ae===0?V.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"}):ae===1?"Gestern":ae<7?V.toLocaleDateString("de-DE",{weekday:"short"}):V.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit"})};return k?o.jsx("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx(Br,{size:32,className:"animate-spin text-delulu-violet mx-auto mb-4"}),o.jsx("p",{className:"text-delulu-muted text-sm",children:"Lade Nachrichten..."})]})}):o.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white safe-top pb-24",children:[o.jsxs("div",{className:"px-6 pt-6 pb-4",children:[o.jsx("div",{className:"flex items-center justify-between mb-4",children:o.jsxs("div",{children:[o.jsx("h1",{className:"font-display text-2xl font-bold text-delulu-text",children:"Nachrichten"}),o.jsx("p",{className:"text-sm text-delulu-muted",children:Z>0?`${Z} ungelesen`:"Keine neuen Nachrichten"})]})}),x.length>0&&o.jsxs("div",{className:"relative mb-4",children:[o.jsx(JS,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-delulu-muted"}),o.jsx("input",{type:"text",value:u,onChange:V=>p(V.target.value),placeholder:"Suche nach Kontakten...",className:"w-full pl-11 pr-4 py-3 bg-white rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-delulu-violet/30 shadow-sm"})]}),x.length>0&&o.jsx("div",{className:"flex gap-2",children:[{id:"all",label:"Alle",count:x.length},{id:"friends",label:"Freunde",count:B,icon:CJ},{id:"met",label:"Getroffen",count:X,icon:rr}].map(V=>o.jsxs("button",{onClick:()=>l(V.id),className:`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-semibold transition-all ${i===V.id?"bg-delulu-violet text-white shadow-lg":"bg-white text-delulu-muted hover:bg-gray-50"}`,children:[V.icon&&o.jsx(V.icon,{size:16}),V.label,o.jsx("span",{className:`px-1.5 py-0.5 rounded-full text-[10px] ${i===V.id?"bg-white/20":"bg-gray-100"}`,children:V.count})]},V.id))})]}),g&&x.length>0&&o.jsx("div",{className:"px-6 mb-4",children:o.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-2xl p-4 flex items-start gap-3",children:[o.jsx(li,{size:20,className:"text-blue-500 flex-shrink-0 mt-0.5"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("p",{className:"text-sm text-blue-800 font-medium",children:"Privatsphre geschtzt"}),o.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Du kannst nur mit Freunden oder Usern chatten, die du bereits in der App getroffen hast."})]}),o.jsx("button",{onClick:()=>y(!1),className:"text-blue-400 hover:text-blue-600",children:""})]})}),o.jsx("div",{className:"px-6",children:x.length===0?o.jsxs("div",{className:"text-center py-16",children:[o.jsx("div",{className:"w-24 h-24 mx-auto rounded-3xl bg-gradient-to-br from-delulu-soft to-white flex items-center justify-center mb-6 shadow-inner",children:o.jsx(V_,{size:40,className:"text-delulu-muted"})}),o.jsx("h3",{className:"font-display font-bold text-xl text-delulu-text mb-3",children:GF.empty.messages}),o.jsx("p",{className:"text-sm text-delulu-muted mb-8 max-w-xs mx-auto leading-relaxed",children:"Triff Leute in Voice-Rumen oder fge Freunde hinzu, um Gesprche zu starten. Jede Begegnung kann der Anfang von etwas Groem sein."}),o.jsxs("button",{onClick:()=>s("/discover"),className:"inline-flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-delulu-violet to-purple-600 text-white rounded-2xl font-display font-bold shadow-lg hover:shadow-xl transition-all",children:[o.jsx(Cre,{size:20}),"Rume entdecken"]})]}):G.length===0?o.jsxs("div",{className:"text-center py-12",children:[o.jsx("div",{className:"w-20 h-20 mx-auto rounded-2xl bg-gray-100 flex items-center justify-center mb-4",children:o.jsx(JS,{size:32,className:"text-gray-400"})}),o.jsx("h3",{className:"font-semibold text-delulu-text mb-2",children:"Keine Ergebnisse"}),o.jsx("p",{className:"text-sm text-delulu-muted mb-6 max-w-xs mx-auto",children:"Versuche einen anderen Suchbegriff oder wechsle den Filter."}),o.jsx("button",{onClick:()=>{p(""),l("all")},className:"px-6 py-3 bg-delulu-violet text-white rounded-xl font-semibold",children:"Filter zurcksetzen"})]}):o.jsx("div",{className:"space-y-2",children:G.map(V=>o.jsxs("button",{className:"w-full bg-white rounded-2xl p-4 flex items-center gap-4 text-left hover:shadow-md transition-shadow",children:[o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-delulu-violet to-purple-600 flex items-center justify-center font-display font-bold text-white text-lg",children:V.displayName.slice(0,2).toUpperCase()}),V.isOnline&&o.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-white"}),V.unreadCount>0&&o.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-[10px] font-bold text-white",children:V.unreadCount>9?"9+":V.unreadCount})})]}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.jsx("p",{className:"font-semibold text-delulu-text truncate",children:V.displayName}),V.isFriend&&o.jsx(CJ,{size:14,className:"text-green-500 flex-shrink-0"}),o.jsxs("span",{className:"text-[10px] text-delulu-muted",children:["Lv.",V.level]})]}),V.lastMessage?o.jsxs("p",{className:`text-sm truncate ${V.unreadCount>0?"text-delulu-text font-medium":"text-delulu-muted"}`,children:[V.lastMessage.isFromMe&&o.jsx("span",{className:"text-delulu-muted",children:"Du: "}),V.lastMessage.content]}):o.jsx("p",{className:"text-sm text-delulu-muted italic",children:V.isFriend?"Noch keine Nachrichten":`Getroffen ${sCe(V.metAt)}`})]}),o.jsxs("div",{className:"flex flex-col items-end gap-1",children:[V.lastMessage&&o.jsx("span",{className:"text-[10px] text-delulu-muted",children:q(V.lastMessage.createdAt)}),o.jsx(As,{size:18,className:"text-delulu-muted"})]})]},V.id))})})]})};function sCe(s){const i=new Date().getTime()-s.getTime(),l=Math.floor(i/(1e3*60*60*24));return l===0?"heute":l===1?"gestern":l<7?`vor ${l} Tagen`:`vor ${Math.floor(l/7)} Woche${l>=14?"n":""}`}function gO(){const{user:s}=mr(),[n,i]=H.useState([]),[l,u]=H.useState([]),[p,g]=H.useState(!0),y=H.useCallback(async()=>{var G;if(!(s!=null&&s.id)){i([]),g(!1);return}try{const B=xn(Me,"blocks"),X=Zr(B,or("blockerId","==",s.id)),Z=await Ur(X),q=[],V=[];for(const ee of Z.docs){const de=ee.data();try{const ae=await fr(at(Me,"users",de.blockedUserId));if(!ae.exists()){V.push(ee.id);continue}const ye=ae.data();q.push({id:ee.id,blockerId:de.blockerId,blockedUserId:de.blockedUserId,username:(ye==null?void 0:ye.username)||"Gelschter Nutzer",displayName:ye==null?void 0:ye.displayName,avatar:ye==null?void 0:ye.avatar,avatarUrl:(ye==null?void 0:ye.avatarUrl)||(ye==null?void 0:ye.photoURL),blockedAt:((G=de.blockedAt)==null?void 0:G.toDate())||new Date,reason:de.reason,customReason:de.customReason})}catch{V.push(ee.id)}}for(const ee of V)try{await Ga(at(Me,"blocks",ee)),console.log("Cleaned up orphaned block entry:",ee)}catch(de){console.error("Failed to clean up block entry:",de)}i(q)}catch(B){console.error("Error fetching blocked users:",B),i([])}finally{g(!1)}},[s==null?void 0:s.id]),x=H.useCallback(async()=>{if(s!=null&&s.id)try{const G=xn(Me,"blocks"),B=Zr(G,or("blockedUserId","==",s.id)),Z=(await Ur(B)).docs.map(q=>q.data().blockerId);u(Z)}catch(G){console.error("Error fetching blocked by users:",G)}},[s==null?void 0:s.id]);H.useEffect(()=>{if(!(s!=null&&s.id)){i([]),u([]),g(!1);return}g(!0);const G=xn(Me,"blocks"),B=Zr(G,or("blockerId","==",s.id)),X=qa(B,async Z=>{var ee;const q=[],V=[];for(const de of Z.docs){const ae=de.data();try{const ye=await fr(at(Me,"users",ae.blockedUserId));if(!ye.exists()){V.push(de.id);continue}const Q=ye.data();q.push({id:de.id,blockerId:ae.blockerId,blockedUserId:ae.blockedUserId,username:(Q==null?void 0:Q.username)||"Gelschter Nutzer",displayName:Q==null?void 0:Q.displayName,avatar:Q==null?void 0:Q.avatar,avatarUrl:(Q==null?void 0:Q.avatarUrl)||(Q==null?void 0:Q.photoURL),blockedAt:((ee=ae.blockedAt)==null?void 0:ee.toDate())||new Date,reason:ae.reason,customReason:ae.customReason})}catch{V.push(de.id)}}for(const de of V)try{await Ga(at(Me,"blocks",de))}catch{}i(q),g(!1)},Z=>{console.error("Error in blocked users listener:",Z),i([]),g(!1)});return x(),()=>X()},[s==null?void 0:s.id,x]);const C=H.useCallback(async(G,B,X)=>{if(!(s!=null&&s.id)||G===s.id)return!1;try{return(await fr(at(Me,"users",G))).exists()?(n.find(V=>V.blockedUserId===G)||(await my(xn(Me,"blocks"),{blockerId:s.id,blockedUserId:G,blockedAt:Uo(),reason:B||"personal",customReason:X||null}),"vibrate"in navigator&&navigator.vibrate([30,20,30])),!0):(console.error("Cannot block non-existent user"),!1)}catch(Z){return console.error("Error blocking user:",Z),!1}},[s==null?void 0:s.id,n]),k=H.useCallback(async G=>{if(!(s!=null&&s.id))return!1;try{const B=n.find(X=>X.blockedUserId===G);return B?(await Ga(at(Me,"blocks",B.id)),"vibrate"in navigator&&navigator.vibrate(10),!0):!1}catch(B){return console.error("Error unblocking user:",B),!1}},[s==null?void 0:s.id,n]),A=H.useCallback(G=>n.some(B=>B.blockedUserId===G),[n]),M=H.useCallback(G=>l.includes(G),[l]);return{blockedUsers:n,isLoading:p,blockUser:C,unblockUser:k,isBlocked:A,isBlockedBy:M,refreshBlockedUsers:y}}const pk=[{id:"pegasus",image:"/avatars/pegasus.png",name:"Pegasus"},{id:"sailor-boy",image:"/avatars/sailor-boy.png",name:"Sailor Boy"},{id:"sailor-girl",image:"/avatars/sailor-girl.png",name:"Sailor Girl"},{id:"sailor-boy-2",image:"/avatars/sailor-boy-2.png",name:"Sailor Shy"}],Hre=({selectedAvatar:s,onSelect:n,onClose:i})=>{var y;const{t:l}=tl(),[u,p]=H.useState(s),g=()=>{n(u),i()};return o.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-end justify-center z-50 p-4",children:o.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-md p-6 animate-slide-up",children:[o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("h2",{className:"font-display text-xl font-bold text-delulu-text",children:l("avatar.title")}),o.jsx("p",{className:"text-sm text-delulu-muted",children:l("avatar.subtitle")})]}),o.jsx("div",{className:"grid grid-cols-2 gap-4 mb-6",children:pk.map(x=>o.jsxs("button",{onClick:()=>p(x.id),className:`relative aspect-square rounded-2xl bg-gradient-to-br from-delulu-soft to-white p-2 transition-all ${u===x.id?"scale-105 ring-4 ring-delulu-violet ring-offset-2 shadow-lg":"hover:scale-102 hover:shadow-md"}`,children:[o.jsx("img",{src:x.image,alt:x.name,className:"w-full h-full object-contain"}),u===x.id&&o.jsx("div",{className:"absolute -top-2 -right-2 w-7 h-7 bg-delulu-violet rounded-full flex items-center justify-center shadow-lg",children:o.jsx(zn,{size:16,className:"text-white"})})]},x.id))}),o.jsx("div",{className:"text-center mb-6",children:o.jsxs("p",{className:"text-sm text-delulu-muted",children:[l("avatar.selected"),": ",o.jsx("span",{className:"font-semibold text-delulu-text",children:(y=pk.find(x=>x.id===u))==null?void 0:y.name})]})}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:i,className:"flex-1 py-3 rounded-xl border-2 border-delulu-soft font-semibold text-delulu-muted",children:l("common.cancel")}),o.jsx("button",{onClick:g,className:"flex-1 py-3 rounded-xl btn-primary text-white font-semibold",children:l("common.save")})]})]})})},Kre=({avatarId:s,size:n="md",className:i=""})=>{const l=pk.find(p=>p.id===s)||pk[0],u={sm:"w-10 h-10",md:"w-14 h-14",lg:"w-20 h-20",xl:"w-24 h-24"};return o.jsx("div",{className:`rounded-2xl bg-gradient-to-br from-delulu-soft to-white flex items-center justify-center p-1 ${u[n]} ${i}`,children:o.jsx("img",{src:l.image,alt:l.name,className:"w-full h-full object-contain"})})},kJ=({compact:s=!1})=>{const{language:n,setLanguage:i,currentLanguage:l}=tl(),[u,p]=H.useState(!1),g=y=>{i(y),p(!1)};return s?o.jsxs("div",{className:"relative",children:[o.jsxs("button",{onClick:()=>p(!u),className:"flex items-center gap-2 px-3 py-2 rounded-xl bg-delulu-soft hover:bg-delulu-soft/80 transition-colors",children:[o.jsx("span",{className:"text-lg",children:l.flag}),o.jsx(uO,{size:16,className:`text-delulu-muted transition-transform ${u?"rotate-180":""}`})]}),u&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>p(!1)}),o.jsx("div",{className:"absolute right-0 top-full mt-2 bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden z-50 min-w-[160px]",children:Object.entries(zc).map(([y,x])=>o.jsxs("button",{onClick:()=>g(y),className:`w-full flex items-center gap-3 px-4 py-3 hover:bg-delulu-soft transition-colors ${n===y?"bg-delulu-soft":""}`,children:[o.jsx("span",{className:"text-lg",children:x.flag}),o.jsx("span",{className:"font-medium text-delulu-text flex-1 text-left",children:x.native}),n===y&&o.jsx(zn,{size:16,className:"text-delulu-violet"})]},y))})]})]}):o.jsx("div",{className:"space-y-2",children:Object.entries(zc).map(([y,x])=>o.jsxs("button",{onClick:()=>g(y),className:`w-full flex items-center gap-4 p-4 rounded-2xl transition-all ${n===y?"bg-delulu-violet/10 border-2 border-delulu-violet":"bg-delulu-soft border-2 border-transparent hover:border-delulu-violet/20"}`,children:[o.jsx("span",{className:"text-2xl",children:x.flag}),o.jsxs("div",{className:"flex-1 text-left",children:[o.jsx("p",{className:"font-semibold text-delulu-text",children:x.native}),o.jsx("p",{className:"text-xs text-delulu-muted",children:x.name})]}),n===y&&o.jsx("div",{className:"w-6 h-6 rounded-full bg-delulu-violet flex items-center justify-center",children:o.jsx(zn,{size:14,className:"text-white"})})]},y))})},EE={minLength:3,maxLength:20,pattern:/^[a-z0-9_]+$/,reserved:["admin","delulu","support","help","system","mod","moderator"]},iCe=[{id:"harassment",label:"Belstigung",icon:""},{id:"spam",label:"Spam / Werbung",icon:""},{id:"inappropriate",label:"Unangemessenes Verhalten",icon:""},{id:"personal",label:"Persnliche Grnde",icon:""},{id:"other",label:"Sonstiges",icon:""}],OJ={freeStarsPerDay:3,premiumStarsPerDay:15},Js={starsRequired:500,levelRequired:25,voiceMinutesRequired:120,minPositiveRatings:80},Jw=30,qre=s=>{const n=s.toLowerCase().trim();return n.length<EE.minLength?{isValid:!1,error:`Mindestens ${EE.minLength} Zeichen erforderlich`}:n.length>EE.maxLength?{isValid:!1,error:`Maximal ${EE.maxLength} Zeichen erlaubt`}:EE.pattern.test(n)?EE.reserved.includes(n)?{isValid:!1,error:"Dieser Username ist reserviert"}:{isValid:!0}:{isValid:!1,error:"Nur Kleinbuchstaben, Zahlen und Unterstriche erlaubt"}},Yre=async(s,n)=>{const i=s.toLowerCase().trim();try{const l=xn(Me,"users"),u=Zr(l,or("username","==",i)),p=await Ur(u);return p.empty?{isAvailable:!0}:n&&p.docs[0].id===n?{isAvailable:!0}:{isAvailable:!1,error:"Dieser Username ist bereits vergeben"}}catch(l){return console.error("Error checking username:",l),{isAvailable:!1,error:"Fehler bei der Prfung"}}},Ey=async s=>{var n;try{const i=at(Me,"users",s),l=await fr(i);if(!l.exists())return{canChange:!0,daysRemaining:0,lastChanged:null,nextChangeDate:null,progressPercent:100};const p=((n=l.data().usernameLastChanged)==null?void 0:n.toDate())||null;if(!p)return{canChange:!0,daysRemaining:0,lastChanged:null,nextChangeDate:null,progressPercent:100};const y=Math.floor((new Date().getTime()-p.getTime())/(1e3*60*60*24)),x=Math.max(0,Jw-y),C=Math.min(100,y/Jw*100),k=new Date(p);return k.setDate(k.getDate()+Jw),{canChange:x===0,daysRemaining:x,lastChanged:p,nextChangeDate:k,progressPercent:C}}catch(i){return console.error("Error getting username change status:",i),{canChange:!1,daysRemaining:Jw,lastChanged:null,nextChangeDate:null,progressPercent:0}}},aCe=async(s,n)=>{var i;try{const l=qre(n);if(!l.isValid)return{success:!1,error:l.error};const u=await Ey(s);if(!u.canChange)return{success:!1,error:`Du kannst deinen Username erst in ${u.daysRemaining} Tagen ndern`};const p=n.toLowerCase().trim(),g=await Yre(p,s);if(!g.isAvailable)return{success:!1,error:g.error};const y=at(Me,"users",s),C=((i=(await fr(y)).data())==null?void 0:i.usernameChangeCount)||0;return await Kn(y,{username:p,usernameLastChanged:Uo(),usernameChangeCount:C+1}),{success:!0}}catch(l){return console.error("Error changing username:",l),{success:!1,error:"Fehler beim ndern des Usernamens"}}},oCe=s=>s===0?"Jetzt nderbar":s===1?"Noch 1 Tag":`Noch ${s} Tage`,DJ=s=>s?s.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}):"Nie gendert",cCe=({progress:s,size:n,strokeWidth:i,daysRemaining:l})=>{const u=(n-i)/2,p=u*2*Math.PI,g=p-s/100*p;return o.jsxs("div",{className:"relative",style:{width:n,height:n},children:[o.jsxs("svg",{width:n,height:n,className:"transform -rotate-90",children:[o.jsx("circle",{cx:n/2,cy:n/2,r:u,fill:"none",stroke:"#E5E7EB",strokeWidth:i}),o.jsx("circle",{cx:n/2,cy:n/2,r:u,fill:"none",stroke:s>=100?"#10B981":"#8B5CF6",strokeWidth:i,strokeDasharray:p,strokeDashoffset:g,strokeLinecap:"round",className:"transition-all duration-1000 ease-out"})]}),o.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s>=100?o.jsx(am,{size:24,className:"text-green-500"}):o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-xl font-bold text-gray-900",children:l}),o.jsx("p",{className:"text-[10px] text-gray-500",children:"Tage"})]})})]})},Xre=({isOpen:s,onClose:n,onSuccess:i})=>{const{user:l,setUser:u}=mr(),[p,g]=H.useState((l==null?void 0:l.username)||""),[y,x]=H.useState(null),[C,k]=H.useState(!0),[A,M]=H.useState(!1),[G,B]=H.useState(null),[X,Z]=H.useState(null),[q,V]=H.useState(!1);H.useEffect(()=>{l!=null&&l.id&&s&&ee()},[l==null?void 0:l.id,s]);const ee=async()=>{if(l!=null&&l.id){k(!0);try{const $=await Ey(l.id);x($)}catch($){console.error("Failed to load username status:",$)}finally{k(!1)}}},de=H.useCallback(Vre.debounce(async $=>{if(!$||$===(l==null?void 0:l.username)){Z(null);return}const se=qre($);if(!se.isValid){B(se.error||null),Z(!1),V(!1);return}V(!0),B(null);try{const ce=await Yre($,l==null?void 0:l.id);Z(ce.isAvailable),ce.isAvailable||B(ce.error||"Username nicht verfgbar")}catch{Z(!1),B("Prfung fehlgeschlagen")}finally{V(!1)}},500),[l==null?void 0:l.id,l==null?void 0:l.username]),ae=$=>{const se=$.toLowerCase().replace(/[^a-z0-9_]/g,"");g(se),Z(null),B(null),se&&se!==(l==null?void 0:l.username)&&de(se)},ye=async()=>{if(!(!(l!=null&&l.id)||!p||p===(l==null?void 0:l.username))){M(!0),B(null);try{const $=await aCe(l.id,p);$.success?(u({...l,username:p}),"vibrate"in navigator&&navigator.vibrate([20,10,30]),i==null||i(p),n()):B($.error||"nderung fehlgeschlagen")}catch{B("Ein Fehler ist aufgetreten")}finally{M(!1)}}};if(!s)return null;const Q=p!==(l==null?void 0:l.username)&&X&&!q&&(y==null?void 0:y.canChange);return o.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 animate-in fade-in",onClick:n,children:o.jsxs("div",{className:"w-full max-w-md bg-white rounded-3xl overflow-hidden shadow-2xl animate-in zoom-in-95",onClick:$=>$.stopPropagation(),children:[o.jsxs("div",{className:"bg-gradient-to-br from-violet-500 to-purple-600 px-6 py-6 text-white",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("h2",{className:"font-display text-xl font-bold",children:"Username ndern"}),o.jsx("button",{onClick:n,className:"w-8 h-8 rounded-full bg-white/20 flex items-center justify-center",children:o.jsx(Rs,{size:18})})]}),o.jsx("p",{className:"text-white/80 text-sm mt-1",children:"Dein @handle ist deine Identitt"})]}),o.jsx("div",{className:"p-6",children:C?o.jsx("div",{className:"flex items-center justify-center py-12",children:o.jsx(Br,{size:32,className:"text-purple-500 animate-spin"})}):o.jsxs(o.Fragment,{children:[y&&o.jsxs("div",{className:"flex items-center gap-4 mb-6 p-4 bg-gray-50 rounded-2xl",children:[o.jsx(cCe,{progress:y.progressPercent,size:80,strokeWidth:8,daysRemaining:y.daysRemaining}),o.jsxs("div",{children:[o.jsx("p",{className:"font-semibold text-gray-900",children:y.canChange?o.jsxs("span",{className:"text-green-600 flex items-center gap-2",children:[o.jsx(zn,{size:18}),"nderung mglich"]}):o.jsxs("span",{className:"text-amber-600 flex items-center gap-2",children:[o.jsx(Gi,{size:18}),oCe(y.daysRemaining)]})}),y.lastChanged&&o.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Letzte nderung: ",DJ(y.lastChanged)]}),y.nextChangeDate&&!y.canChange&&o.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Verfgbar ab: ",DJ(y.nextChangeDate)]})]})]}),o.jsxs("div",{className:"mb-6",children:[o.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Neuer Username"}),o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400",children:o.jsx(UF,{size:20})}),o.jsx("input",{type:"text",value:p,onChange:$=>ae($.target.value),disabled:!(y!=null&&y.canChange),className:`w-full pl-12 pr-12 py-3 rounded-xl border-2 transition-all ${y!=null&&y.canChange?G?"border-red-300 focus:border-red-500":X?"border-green-300 focus:border-green-500":"border-gray-200 focus:border-purple-500":"bg-gray-100 border-gray-200 text-gray-400"} outline-none`,placeholder:"dein_username",maxLength:20}),o.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2",children:q?o.jsx(Br,{size:20,className:"text-gray-400 animate-spin"}):X===!0?o.jsx(zn,{size:20,className:"text-green-500"}):X===!1?o.jsx(Rs,{size:20,className:"text-red-500"}):null})]}),G&&o.jsxs("p",{className:"text-red-500 text-sm mt-2 flex items-center gap-1 animate-in fade-in slide-in-from-top-2",children:[o.jsx(ql,{size:14}),G]}),X&&p!==(l==null?void 0:l.username)&&o.jsxs("p",{className:"text-green-600 text-sm mt-2 flex items-center gap-1 animate-in fade-in slide-in-from-top-2",children:[o.jsx(zn,{size:14}),"@",p," ist verfgbar"]})]}),o.jsx("div",{className:"p-4 bg-purple-50 rounded-xl mb-6",children:o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx(aRe,{size:18,className:"text-purple-600 flex-shrink-0 mt-0.5"}),o.jsxs("div",{className:"text-sm text-purple-800",children:[o.jsx("p",{className:"font-medium mb-1",children:"Regeln fr Usernames:"}),o.jsxs("ul",{className:"text-xs space-y-1 text-purple-700",children:[o.jsx("li",{children:" 3-20 Zeichen"}),o.jsx("li",{children:" Nur Kleinbuchstaben, Zahlen & Unterstriche"}),o.jsxs("li",{children:[" nderung nur alle ",Jw," Tage mglich"]})]})]})]})}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:n,className:"flex-1 py-3 px-4 bg-gray-100 text-gray-600 rounded-xl font-semibold hover:bg-gray-200 transition-colors",children:"Abbrechen"}),o.jsx("button",{onClick:ye,disabled:!Q||A,className:"flex-1 py-3 px-4 bg-gradient-to-r from-violet-500 to-purple-600 text-white rounded-xl font-semibold disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 transition-all hover:shadow-lg hover:shadow-purple-500/30",children:A?o.jsx(Br,{size:18,className:"animate-spin"}):o.jsxs(o.Fragment,{children:[o.jsx(zn,{size:18}),"Speichern"]})})]})]})})]})})},lCe=()=>{const{user:s}=mr(),[n,i]=H.useState(null),[l,u]=H.useState({totalLinks:5,usedLinks:0,availableLinks:5,totalReferrals:0,xpEarned:0,premiumDaysEarned:0}),[p,g]=H.useState(null),[y,x]=H.useState(!0),[C,k]=H.useState(!1);H.useEffect(()=>{A()},[s==null?void 0:s.id]);const A=async()=>{if(s!=null&&s.id){x(!0);try{let q=await gre(s.id);q||(q=await lO(s.id)),i(q);const V=await ST(s.id);u(V)}catch(q){console.error("Error loading referral data:",q)}finally{x(!1)}}},M=async q=>{await Ere(q)&&(g(q),setTimeout(()=>g(null),2e3))},G=async q=>{await WTe(q,(s==null?void 0:s.username)||"Ein Freund")};if(y)return o.jsxs("div",{className:"bg-gradient-to-br from-purple-500/10 to-pink-500/10 rounded-2xl p-6 animate-pulse",children:[o.jsx("div",{className:"h-6 bg-white/10 rounded w-1/3 mb-4"}),o.jsx("div",{className:"h-20 bg-white/10 rounded"})]});const B=(n==null?void 0:n.links.filter(q=>q.isActive&&!q.usedBy))||[],X=(n==null?void 0:n.links.filter(q=>q.usedBy!==null))||[],Z=C?B:B.slice(0,2);return o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"bg-gradient-to-br from-purple-600 via-violet-600 to-pink-600 rounded-2xl p-6 text-white relative overflow-hidden",children:[o.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full blur-3xl"}),o.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-pink-500/20 rounded-full blur-2xl"}),o.jsxs("div",{className:"relative z-10",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[o.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:o.jsx(ra,{size:24})}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-xl font-bold",children:"Referral System"}),o.jsx("p",{className:"text-white/80 text-sm",children:"Lade Freunde ein & erhalte Belohnungen"})]})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-4",children:[o.jsxs("div",{className:"bg-white/10 backdrop-blur-xl rounded-xl p-3 text-center",children:[o.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[o.jsx(rr,{size:16}),o.jsx("span",{className:"text-2xl font-bold",children:l.totalReferrals})]}),o.jsx("p",{className:"text-xs text-white/70",children:"Eingeladen"})]}),o.jsxs("div",{className:"bg-white/10 backdrop-blur-xl rounded-xl p-3 text-center",children:[o.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[o.jsx(Ei,{size:16,className:"text-yellow-300"}),o.jsx("span",{className:"text-2xl font-bold",children:l.xpEarned})]}),o.jsx("p",{className:"text-xs text-white/70",children:"XP verdient"})]}),o.jsxs("div",{className:"bg-white/10 backdrop-blur-xl rounded-xl p-3 text-center",children:[o.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[o.jsx(SJ,{size:16}),o.jsx("span",{className:"text-2xl font-bold",children:l.availableLinks})]}),o.jsx("p",{className:"text-xs text-white/70",children:"Verfgbar"})]})]})]})]}),o.jsx("div",{className:"bg-gradient-to-r from-amber-500/10 to-orange-500/10 border border-amber-500/20 rounded-xl p-4",children:o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("div",{className:"w-10 h-10 bg-amber-500/20 rounded-full flex items-center justify-center flex-shrink-0",children:o.jsx(wr,{size:20,className:"text-amber-500"})}),o.jsxs("div",{children:[o.jsx("h3",{className:"font-semibold text-amber-200 mb-1",children:"Belohnungen pro Einladung"}),o.jsxs("div",{className:"space-y-1 text-sm text-amber-100/80",children:[o.jsxs("p",{className:"flex items-center gap-2",children:[o.jsx(Ei,{size:14,className:"text-amber-400"}),o.jsx("span",{children:"+500 XP fr dich"})]}),o.jsxs("p",{className:"flex items-center gap-2",children:[o.jsx(hs,{size:14,className:"text-amber-400"}),o.jsx("span",{children:"+7 Tage Premium"})]}),o.jsxs("p",{className:"flex items-center gap-2",children:[o.jsx(ra,{size:14,className:"text-amber-400"}),o.jsx("span",{children:"+250 XP fr deinen Freund"})]})]})]})]})}),o.jsxs("div",{className:"bg-white/5 rounded-2xl p-4",children:[o.jsxs("h3",{className:"font-semibold text-white mb-3 flex items-center gap-2",children:[o.jsx(SJ,{size:18,className:"text-purple-400"}),"Deine exklusiven Links (",l.availableLinks,"/",l.totalLinks,")"]}),o.jsxs("div",{className:"space-y-2",children:[Z.length===0?o.jsxs("div",{className:"text-center py-6 text-white/50",children:[o.jsx(ra,{size:32,className:"mx-auto mb-2 opacity-50"}),o.jsx("p",{children:"Alle Links wurden verwendet!"}),o.jsx("p",{className:"text-sm",children:"Danke frs Teilen "})]}):Z.map((q,V)=>o.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-3 flex items-center justify-between gap-3",children:[o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("p",{className:"text-sm text-white/60 mb-0.5",children:["Link #",V+1]}),o.jsx("p",{className:"font-mono text-white font-medium truncate",children:q.code})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("button",{onClick:()=>M(q.code),className:`p-2.5 rounded-xl transition-all ${p===q.code?"bg-green-500 text-white":"bg-white/10 text-white/70 hover:bg-white/20 hover:text-white"}`,children:p===q.code?o.jsx(zn,{size:18}):o.jsx(FF,{size:18})}),o.jsx("button",{onClick:()=>G(q.code),className:"p-2.5 bg-purple-500 text-white rounded-xl hover:bg-purple-600 transition-colors",children:o.jsx(BF,{size:18})})]})]},q.id)),B.length>2&&!C&&o.jsxs("button",{onClick:()=>k(!0),className:"w-full py-3 text-center text-purple-400 hover:text-purple-300 text-sm flex items-center justify-center gap-1",children:["Alle ",B.length," Links anzeigen",o.jsx(As,{size:16})]})]})]}),X.length>0&&o.jsxs("div",{className:"bg-white/5 rounded-2xl p-4",children:[o.jsxs("h3",{className:"font-semibold text-white/60 mb-3 flex items-center gap-2",children:[o.jsx(zn,{size:18,className:"text-green-400"}),"Verwendete Links (",X.length,")"]}),o.jsx("div",{className:"space-y-2",children:X.map((q,V)=>o.jsxs("div",{className:"bg-green-500/10 border border-green-500/20 rounded-xl p-3 flex items-center gap-3",children:[o.jsx("div",{className:"w-8 h-8 bg-green-500/20 rounded-full flex items-center justify-center",children:o.jsx(zn,{size:16,className:"text-green-400"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("p",{className:"font-mono text-white/60 text-sm line-through",children:q.code}),o.jsxs("p",{className:"text-xs text-green-400",children:["Verwendet ",q.usedAt?new Date(q.usedAt).toLocaleDateString("de-DE"):""]})]})]},q.id))})]}),(n==null?void 0:n.referredBy)&&o.jsx("div",{className:"bg-gradient-to-r from-green-500/10 to-emerald-500/10 border border-green-500/20 rounded-xl p-4",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 bg-green-500/20 rounded-full flex items-center justify-center",children:o.jsx(rr,{size:20,className:"text-green-400"})}),o.jsxs("div",{children:[o.jsx("p",{className:"text-sm text-green-400",children:"Du wurdest eingeladen mit:"}),o.jsx("p",{className:"font-mono text-white font-medium",children:n.referredByCode})]})]})})]})},wa={seasonId:"beta_s1",seasonName:"Beta Season 1",seasonNameDE:"Beta Staffel 1",maxLevel:100,xpPerLevel:1e3,seasonStart:new Date("2026-03-01T00:00:00Z"),seasonEnd:new Date("2026-05-31T23:59:59Z"),premiumUnlockInvites:5,colors:{free:{primary:"#A78BFA",secondary:"#818CF8"},premium:{primary:"#F472B6",secondary:"#FB923C",gradient:"linear-gradient(135deg, #A78BFA 0%, #818CF8 50%, #F472B6 100%)"}}},zh=[{id:"bs1_r01",level:1,type:"coins",name:"Starter Coins",nameDE:"Starter Coins",description:"50 Delulu Coins to start your journey",descriptionDE:"50 Delulu Coins fr deinen Start",rarity:"common",isPremium:!1,value:50},{id:"bs1_r02",level:1,type:"avatar_frame",name:"Beta Dreamer Frame",nameDE:"Beta Trumer Rahmen",description:"Exclusive frame for Beta participants",descriptionDE:"Exklusiver Rahmen fr Beta-Teilnehmer",rarity:"rare",isPremium:!0,previewUrl:"/assets/frames/beta-dreamer.png"},{id:"bs1_r03",level:5,type:"xp_boost",name:"XP Boost x1.5",nameDE:"XP Boost x1.5",description:"24h of 1.5x XP",descriptionDE:"24h lang 1.5x XP",rarity:"common",isPremium:!1,value:1.5},{id:"bs1_r04",level:5,type:"chat_bubble",name:"Cloud Bubble",nameDE:"Wolken-Bubble",description:"Dreamy cloud-shaped chat bubbles",descriptionDE:"Vertrumte Wolken-Chat-Bubbles",rarity:"rare",isPremium:!0,previewUrl:"/assets/bubbles/cloud.png"},{id:"bs1_r05",level:10,type:"coins",name:"Coin Bundle",nameDE:"Coin Bundle",description:"100 Delulu Coins",descriptionDE:"100 Delulu Coins",rarity:"common",isPremium:!1,value:100},{id:"bs1_r06",level:10,type:"glow_effect",name:"Soft Lavender Glow",nameDE:"Sanftes Lavendel-Leuchten",description:"Gentle purple aura around your avatar",descriptionDE:"Sanfte lila Aura um deinen Avatar",rarity:"epic",isPremium:!0,previewUrl:"/assets/effects/lavender-glow.png"},{id:"bs1_r07",level:15,type:"emoji_pack",name:"Dreamy Emojis",nameDE:"Vertrumte Emojis",description:"12 exclusive dreamy emojis",descriptionDE:"12 exklusive vertrumte Emojis",rarity:"rare",isPremium:!1},{id:"bs1_r08",level:15,type:"profile_banner",name:"Aurora Banner",nameDE:"Aurora Banner",description:"Beautiful aurora borealis header",descriptionDE:"Wunderschner Nordlicht-Header",rarity:"epic",isPremium:!0,previewUrl:"/assets/banners/aurora.png"},{id:"bs1_r09",level:20,type:"title",name:"Cloud Walker",nameDE:"Wolkenwanderer",description:"Display title below your name",descriptionDE:"Titel unter deinem Namen",rarity:"rare",isPremium:!1},{id:"bs1_r10",level:20,type:"name_effect",name:"Shimmer Name",nameDE:"Schimmer-Name",description:"Your name sparkles with light",descriptionDE:"Dein Name funkelt im Licht",rarity:"epic",isPremium:!0},{id:"bs1_r11",level:25,type:"coins",name:"Big Coin Bag",nameDE:"Groer Coin-Beutel",description:"250 Delulu Coins",descriptionDE:"250 Delulu Coins",rarity:"rare",isPremium:!1,value:250},{id:"bs1_r12",level:25,type:"cloud_theme",name:"Sunset Dreams",nameDE:"Sonnenuntergang-Trume",description:"Golden hour cloud theme",descriptionDE:"Goldene Stunde Cloud-Theme",rarity:"epic",isPremium:!0,previewUrl:"/assets/themes/sunset-dreams.png"},{id:"bs1_r13",level:30,type:"sound_pack",name:"Chill Vibes",nameDE:"Chill Vibes",description:"Relaxing notification sounds",descriptionDE:"Entspannende Benachrichtigungstne",rarity:"rare",isPremium:!1},{id:"bs1_r14",level:30,type:"avatar_frame",name:"Holographic Frame",nameDE:"Holografischer Rahmen",description:"Color-shifting holographic border",descriptionDE:"Farbwechselnder holografischer Rahmen",rarity:"legendary",isPremium:!0,previewUrl:"/assets/frames/holographic.png"},{id:"bs1_r15",level:40,type:"exclusive_badge",name:"Early Dreamer",nameDE:"Frher Trumer",description:"Badge for Beta Season participants",descriptionDE:"Abzeichen fr Beta-Staffel-Teilnehmer",rarity:"epic",isPremium:!1},{id:"bs1_r16",level:40,type:"glow_effect",name:"Rainbow Aura",nameDE:"Regenbogen-Aura",description:"Multicolor shifting aura",descriptionDE:"Mehrfarbig wechselnde Aura",rarity:"legendary",isPremium:!0,previewUrl:"/assets/effects/rainbow-aura.png"},{id:"bs1_r17",level:50,type:"coins",name:"Treasure Chest",nameDE:"Schatzkiste",description:"500 Delulu Coins",descriptionDE:"500 Delulu Coins",rarity:"epic",isPremium:!1,value:500},{id:"bs1_r18",level:50,type:"profile_banner",name:"Galaxy Dreams",nameDE:"Galaxie-Trume",description:"Animated galaxy header",descriptionDE:"Animierter Galaxie-Header",rarity:"legendary",isPremium:!0,previewUrl:"/assets/banners/galaxy.png"},{id:"bs1_r19",level:60,type:"title",name:"Dream Master",nameDE:"Traum-Meister",description:"Prestigious title",descriptionDE:"Prestigetrchtiger Titel",rarity:"epic",isPremium:!1},{id:"bs1_r20",level:60,type:"chat_bubble",name:"Neon Bubble",nameDE:"Neon-Bubble",description:"Glowing neon chat bubbles",descriptionDE:"Leuchtende Neon-Chat-Bubbles",rarity:"legendary",isPremium:!0,previewUrl:"/assets/bubbles/neon.png"},{id:"bs1_r21",level:75,type:"xp_boost",name:"XP Boost x2",nameDE:"XP Boost x2",description:"48h of 2x XP",descriptionDE:"48h lang 2x XP",rarity:"epic",isPremium:!1,value:2},{id:"bs1_r22",level:75,type:"name_effect",name:"Holographic Name",nameDE:"Holografischer Name",description:"Your name shimmers in holographic colors",descriptionDE:"Dein Name schimmert holografisch",rarity:"legendary",isPremium:!0},{id:"bs1_r23",level:85,type:"coins",name:"Elite Vault",nameDE:"Elite-Tresor",description:"1000 Delulu Coins",descriptionDE:"1000 Delulu Coins",rarity:"legendary",isPremium:!1,value:1e3},{id:"bs1_r24",level:85,type:"cloud_theme",name:"Cosmic Dreams",nameDE:"Kosmische Trume",description:"Animated cosmic cloud theme",descriptionDE:"Animiertes kosmisches Cloud-Theme",rarity:"legendary",isPremium:!0,previewUrl:"/assets/themes/cosmic.png"},{id:"bs1_r25",level:100,type:"exclusive_badge",name:"Beta Legend",nameDE:"Beta-Legende",description:"Ultimate badge for completing Beta Season",descriptionDE:"Ultimatives Abzeichen fr Beta-Staffel-Abschluss",rarity:"mythic",isPremium:!1},{id:"bs1_r26",level:100,type:"avatar_frame",name:"Mythic Dreamer Frame",nameDE:"Mythischer Trumer-Rahmen",description:"Animated legendary frame with particles",descriptionDE:"Animierter legendrer Rahmen mit Partikeln",rarity:"mythic",isPremium:!0,previewUrl:"/assets/frames/mythic-dreamer.png"}],s_={dailyQuest:{easy:50,medium:100,hard:200,bonus:300},cloudStreak:{base:25,milestone7:100,milestone14:250,milestone30:500,milestone100:2e3},social:{invite:150,inviteActive:300,cloudInteraction:10,friendMade:50}},np=async s=>{var n,i,l;try{const u=at(Me,"dreamPassProgress",`${s}_${wa.seasonId}`),p=await fr(u);if(!p.exists())return null;const g=p.data();return{id:p.id,oderId:g.userId,...g,lastXPGain:((n=g.lastXPGain)==null?void 0:n.toDate())||new Date,createdAt:((i=g.createdAt)==null?void 0:i.toDate())||new Date,updatedAt:((l=g.updatedAt)==null?void 0:l.toDate())||new Date}}catch(u){return console.error("Error getting Dream Pass progress:",u),null}},WF=async s=>{const n={id:`${s}_${wa.seasonId}`,oderId:s,seasonId:wa.seasonId,currentLevel:1,currentXP:0,totalXPEarned:0,isPremium:!1,premiumUnlockedVia:null,unlockedRewards:[],claimedRewards:[],lastXPGain:new Date,streakBonus:0,createdAt:new Date,updatedAt:new Date},i=at(Me,"dreamPassProgress",n.id);return await yo(i,{...n,lastXPGain:cn.fromDate(n.lastXPGain),createdAt:cn.fromDate(n.createdAt),updatedAt:cn.fromDate(n.updatedAt)}),n},dCe=async(s,n)=>{try{let i=await np(s);i||(i=await WF(s)),new Date<wa.seasonStart&&console.log("Pre-season XP accumulation");const u=Math.floor(n.amount*(n.multiplier||1)),p=i.totalXPEarned+u;let g=i.currentXP+u,y=i.currentLevel;const x=[];for(;g>=wa.xpPerLevel&&y<wa.maxLevel;){g-=wa.xpPerLevel,y++;const A=zh.filter(M=>M.level===y&&(!M.isPremium||i.isPremium));x.push(...A)}y>=wa.maxLevel&&(g=Math.min(g,wa.xpPerLevel));const C=at(Me,"dreamPassProgress",i.id),k=x.map(A=>A.id);return await Kn(C,{currentLevel:y,currentXP:g,totalXPEarned:p,unlockedRewards:[...i.unlockedRewards,...k],lastXPGain:cn.fromDate(new Date),updatedAt:cn.fromDate(new Date)}),{success:!0,leveledUp:y>i.currentLevel,newLevel:y>i.currentLevel?y:void 0,newRewards:x.length>0?x:void 0,totalXP:p}}catch(i){return console.error("Error adding Dream Pass XP:",i),{success:!1,leveledUp:!1}}},$re=async s=>{try{const n=await np(s);if(!n||n.isPremium)return(n==null?void 0:n.isPremium)||!1;if((await ST(s)).totalReferrals>=wa.premiumUnlockInvites){const l=at(Me,"dreamPassProgress",n.id);await Kn(l,{isPremium:!0,premiumUnlockedVia:"referral",updatedAt:cn.fromDate(new Date)});const u=zh.filter(p=>p.isPremium&&p.level<=n.currentLevel);return u.length>0&&await Kn(l,{unlockedRewards:[...n.unlockedRewards,...u.map(p=>p.id)]}),!0}return!1}catch(n){return console.error("Error checking premium unlock:",n),!1}},uCe=async(s,n)=>{try{const i=await np(s);if(!i)return{success:!1,error:"Pass nicht gefunden"};if(!i.unlockedRewards.includes(n))return{success:!1,error:"Belohnung nicht freigeschaltet"};if(i.claimedRewards.includes(n))return{success:!1,error:"Belohnung bereits abgeholt"};const l=zh.find(p=>p.id===n);if(!l)return{success:!1,error:"Belohnung nicht gefunden"};if(l.type==="coins"&&l.value){const{addCoins:p}=await eQ(async()=>{const{addCoins:g}=await Promise.resolve().then(()=>eNe);return{addCoins:g}},void 0);await p(s,l.value,`Dream Pass Belohnung: ${l.nameDE}`,"earn")}const u=at(Me,"dreamPassProgress",i.id);return await Kn(u,{claimedRewards:[...i.claimedRewards,n],updatedAt:cn.fromDate(new Date)}),{success:!0}}catch(i){return console.error("Error claiming reward:",i),{success:!1,error:"Fehler beim Abholen"}}},hCe=(s,n)=>{const i=at(Me,"dreamPassProgress",`${s}_${wa.seasonId}`);return qa(i,l=>{var p,g,y;if(!l.exists()){n(null);return}const u=l.data();n({id:l.id,oderId:u.userId,...u,lastXPGain:((p=u.lastXPGain)==null?void 0:p.toDate())||new Date,createdAt:((g=u.createdAt)==null?void 0:g.toDate())||new Date,updatedAt:((y=u.updatedAt)==null?void 0:y.toDate())||new Date})})},fk=()=>{const s=new Date,n=wa.seasonStart;if(s>=n)return{days:0,hours:0,minutes:0,seconds:0,hasStarted:!0};const i=n.getTime()-s.getTime();return{days:Math.floor(i/(1e3*60*60*24)),hours:Math.floor(i%(1e3*60*60*24)/(1e3*60*60)),minutes:Math.floor(i%(1e3*60*60)/(1e3*60)),seconds:Math.floor(i%(1e3*60)/1e3),hasStarted:!1}},uc=s=>({common:"#9CA3AF",rare:"#60A5FA",epic:"#A78BFA",legendary:"#FBBF24",mythic:"#F472B6"})[s],_V=s=>({common:"none",rare:"0 0 10px #60A5FA50",epic:"0 0 15px #A78BFA60",legendary:"0 0 20px #FBBF2470",mythic:"0 0 25px #F472B680, 0 0 50px #F472B640"})[s],pCe=({isOpen:s,onClose:n})=>{const{user:i}=mr(),l=H.useRef(null),[u,p]=H.useState(null),[g,y]=H.useState(!0),[x,C]=H.useState("rewards"),[k,A]=H.useState(fk()),[M,G]=H.useState(0),[B,X]=H.useState(null),[Z,q]=H.useState(null);H.useEffect(()=>{if(!s||!(i!=null&&i.id))return;(async()=>{y(!0);let $=await np(i.id);$||($=await WF(i.id)),await $re(i.id),$=await np(i.id),p($);const se=await ST(i.id);G(se.totalReferrals),y(!1)})()},[s,i==null?void 0:i.id]),H.useEffect(()=>{if(!s)return;const Q=setInterval(()=>{A(fk())},1e3);return()=>clearInterval(Q)},[s]);const V=async Q=>{if(!(i!=null&&i.id)||B)return;if(X(Q),(await uCe(i.id,Q)).success){const se=await np(i.id);p(se)}X(null)},ee=()=>{if(!l.current||!u)return;const Q=u.currentLevel-1;l.current.scrollTo({left:Math.max(0,Q*280-100),behavior:"smooth"})};if(H.useEffect(()=>{u&&l.current&&setTimeout(ee,100)},[u]),!s)return null;const de=[...new Set(zh.map(Q=>Q.level))].sort((Q,$)=>Q-$),ae=u?u.currentXP/wa.xpPerLevel*100:0,ye=wa.premiumUnlockInvites-M;return o.jsxs("div",{className:"fixed inset-0 z-50 bg-black",children:[o.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[o.jsx("div",{className:"absolute inset-0 opacity-30",style:{background:"radial-gradient(ellipse at 50% 0%, #A78BFA40 0%, transparent 50%), radial-gradient(ellipse at 80% 80%, #818CF840 0%, transparent 40%)"}}),[...Array(20)].map((Q,$)=>o.jsx("div",{className:"absolute w-1 h-1 bg-purple-400/30 rounded-full",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`,animation:`float ${3+Math.random()*4}s ease-in-out infinite`,animationDelay:`${Math.random()*2}s`}},$))]}),o.jsxs("div",{className:"relative z-10 safe-top",children:[o.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[o.jsx("button",{onClick:n,className:"w-10 h-10 bg-white/10 rounded-xl flex items-center justify-center",children:o.jsx(Rs,{size:20,className:"text-white"})}),o.jsxs("div",{className:"text-center",children:[o.jsxs("h1",{className:"text-xl font-bold text-white flex items-center gap-2",children:[o.jsx(hs,{size:20,className:"text-purple-400"}),"Dream Pass"]}),o.jsx("p",{className:"text-xs text-white/60",children:"Beta Season 1"})]}),o.jsx("div",{className:"w-10"})," "]}),!k.hasStarted&&o.jsx("div",{className:"mx-4 mb-4 p-4 bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-2xl border border-purple-500/30",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(Gi,{size:20,className:"text-purple-400"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("p",{className:"text-sm text-white/80",children:"Season startet in"}),o.jsx("div",{className:"flex gap-3 mt-1",children:[{value:k.days,label:"Tage"},{value:k.hours,label:"Std"},{value:k.minutes,label:"Min"},{value:k.seconds,label:"Sek"}].map(({value:Q,label:$})=>o.jsxs("div",{className:"text-center",children:[o.jsx("span",{className:"text-lg font-bold text-white",children:Q}),o.jsx("span",{className:"text-xs text-white/60 ml-1",children:$})]},$))})]})]})}),!g&&u&&o.jsxs("div",{className:"mx-4 mb-4 p-4 bg-white/5 rounded-2xl",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center",children:o.jsx("span",{className:"text-lg font-bold text-white",children:u.currentLevel})}),o.jsxs("div",{children:[o.jsxs("p",{className:"text-white font-semibold",children:["Level ",u.currentLevel]}),o.jsxs("p",{className:"text-xs text-white/60",children:[u.currentXP.toLocaleString()," / ",wa.xpPerLevel.toLocaleString()," XP"]})]})]}),u.isPremium?o.jsxs("div",{className:"px-3 py-1.5 bg-gradient-to-r from-amber-500 to-orange-500 rounded-full flex items-center gap-2",children:[o.jsx(hs,{size:14,className:"text-white"}),o.jsx("span",{className:"text-sm font-bold text-white",children:"PREMIUM"})]}):o.jsxs("button",{onClick:()=>C("rewards"),className:"px-3 py-1.5 bg-white/10 rounded-full flex items-center gap-2 hover:bg-white/20 transition-colors",children:[o.jsx(Hi,{size:14,className:"text-white/60"}),o.jsx("span",{className:"text-sm text-white/80",children:"Premium"})]})]}),o.jsx("div",{className:"h-3 bg-white/10 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full transition-all duration-500",style:{width:`${ae}%`}})})]}),!g&&u&&!u.isPremium&&o.jsx("div",{className:"mx-4 mb-4 p-4 bg-gradient-to-r from-amber-500/20 to-orange-500/20 rounded-2xl border border-amber-500/30",children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-amber-500 to-orange-500 rounded-xl flex items-center justify-center",children:o.jsx(rr,{size:24,className:"text-white"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("p",{className:"text-white font-semibold",children:"Premium freischalten"}),o.jsx("p",{className:"text-sm text-white/70",children:ye>0?`Lade ${ye} Freund${ye>1?"e":""} ein!`:"Du hast es geschafft!"}),o.jsx("div",{className:"flex gap-1 mt-2",children:[...Array(wa.premiumUnlockInvites)].map((Q,$)=>o.jsx("div",{className:`w-8 h-2 rounded-full ${$<M?"bg-gradient-to-r from-amber-500 to-orange-500":"bg-white/20"}`},$))})]})]})}),o.jsxs("div",{className:"flex mx-4 mb-4 bg-white/5 rounded-xl p-1",children:[o.jsxs("button",{onClick:()=>C("rewards"),className:`flex-1 py-2 rounded-lg text-sm font-medium transition-all ${x==="rewards"?"bg-purple-500 text-white":"text-white/60"}`,children:[o.jsx(ra,{size:16,className:"inline mr-2"}),"Belohnungen"]}),o.jsxs("button",{onClick:()=>C("sneak-peek"),className:`flex-1 py-2 rounded-lg text-sm font-medium transition-all ${x==="sneak-peek"?"bg-purple-500 text-white":"text-white/60"}`,children:[o.jsx(Ta,{size:16,className:"inline mr-2"}),"Sneak Peek"]})]})]}),o.jsx("div",{className:"flex-1 overflow-hidden",children:g?o.jsx("div",{className:"flex items-center justify-center h-64",children:o.jsx("div",{className:"w-10 h-10 border-3 border-purple-500/30 border-t-purple-500 rounded-full animate-spin"})}):x==="rewards"?o.jsx("div",{ref:l,className:"overflow-x-auto overflow-y-hidden pb-32 hide-scrollbar",style:{scrollSnapType:"x mandatory"},children:o.jsx("div",{className:"flex gap-4 px-4 min-w-max",children:de.map(Q=>{const $=zh.filter(ge=>ge.level===Q),se=$.find(ge=>!ge.isPremium),ce=$.find(ge=>ge.isPremium),he=u&&u.currentLevel>=Q,ve=u&&u.currentLevel===Q;return o.jsxs("div",{className:"flex flex-col items-center gap-4",style:{scrollSnapAlign:"center"},children:[o.jsx(PJ,{reward:ce,isUnlocked:he&&(u==null?void 0:u.isPremium),isClaimed:u==null?void 0:u.claimedRewards.includes((ce==null?void 0:ce.id)||""),isPremiumLocked:!(u!=null&&u.isPremium),onClaim:()=>ce&&V(ce.id),onPreview:()=>ce&&q(ce),isClaiming:B===(ce==null?void 0:ce.id)}),o.jsxs("div",{className:`relative w-16 h-16 rounded-full flex items-center justify-center ${ve?"bg-gradient-to-br from-purple-500 to-pink-500 ring-4 ring-purple-500/50":he?"bg-gradient-to-br from-green-500 to-emerald-500":"bg-white/10"}`,children:[he&&!ve?o.jsx(zn,{size:24,className:"text-white"}):o.jsx("span",{className:`text-xl font-bold ${he?"text-white":"text-white/50"}`,children:Q}),Q<wa.maxLevel&&o.jsx("div",{className:`absolute left-full top-1/2 w-4 h-1 ${he?"bg-green-500":"bg-white/20"}`,style:{transform:"translateY(-50%)"}})]}),o.jsx(PJ,{reward:se,isUnlocked:he,isClaimed:u==null?void 0:u.claimedRewards.includes((se==null?void 0:se.id)||""),isPremiumLocked:!1,onClaim:()=>se&&V(se.id),onPreview:()=>se&&q(se),isClaiming:B===(se==null?void 0:se.id)})]},Q)})})}):o.jsxs("div",{className:"px-4 pb-32 overflow-y-auto",children:[o.jsxs("div",{className:"bg-white/5 rounded-2xl p-6 mb-4",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[o.jsx(wr,{size:24,className:"text-purple-400"}),o.jsx("h2",{className:"text-xl font-bold text-white",children:"Coming Soon"})]}),o.jsx("p",{className:"text-white/70 mb-6",children:"Diese exklusiven Belohnungen warten auf dich in der Beta Season 1!"}),o.jsx("div",{className:"grid grid-cols-2 gap-4",children:zh.filter(Q=>Q.rarity==="legendary"||Q.rarity==="mythic").slice(0,6).map(Q=>o.jsxs("div",{className:"relative bg-white/5 rounded-xl p-4 border border-white/10 overflow-hidden",onClick:()=>q(Q),children:[o.jsx("div",{className:"absolute inset-0 opacity-20",style:{background:`radial-gradient(circle at 50% 50%, ${uc(Q.rarity)} 0%, transparent 70%)`}}),o.jsxs("div",{className:"relative",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("span",{className:"text-xs font-bold uppercase px-2 py-0.5 rounded-full",style:{backgroundColor:`${uc(Q.rarity)}30`,color:uc(Q.rarity)},children:Q.rarity}),o.jsxs("span",{className:"text-xs text-white/50",children:["Lv.",Q.level]})]}),o.jsx("div",{className:"w-12 h-12 rounded-xl mb-3 flex items-center justify-center",style:{background:`linear-gradient(135deg, ${uc(Q.rarity)}40 0%, ${uc(Q.rarity)}20 100%)`},children:Q.isPremium?o.jsx(hs,{size:24,style:{color:uc(Q.rarity)}}):o.jsx(ra,{size:24,style:{color:uc(Q.rarity)}})}),o.jsx("h3",{className:"text-sm font-semibold text-white truncate",children:Q.nameDE}),o.jsx("p",{className:"text-xs text-white/50 truncate",children:Q.descriptionDE}),Q.isPremium&&o.jsxs("div",{className:"mt-2 flex items-center gap-1 text-xs text-amber-400",children:[o.jsx(hs,{size:12}),o.jsx("span",{children:"Premium"})]})]})]},Q.id))})]}),o.jsxs("div",{className:"bg-white/5 rounded-2xl p-6",children:[o.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[o.jsx(mV,{size:20,className:"text-amber-400"}),"Season Statistik"]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"bg-white/5 rounded-xl p-4 text-center",children:[o.jsx("p",{className:"text-3xl font-bold text-white",children:zh.length}),o.jsx("p",{className:"text-sm text-white/60",children:"Belohnungen"})]}),o.jsxs("div",{className:"bg-white/5 rounded-xl p-4 text-center",children:[o.jsx("p",{className:"text-3xl font-bold text-white",children:wa.maxLevel}),o.jsx("p",{className:"text-sm text-white/60",children:"Level"})]}),o.jsxs("div",{className:"bg-white/5 rounded-xl p-4 text-center",children:[o.jsx("p",{className:"text-3xl font-bold text-white",children:zh.filter(Q=>Q.isPremium).length}),o.jsx("p",{className:"text-sm text-white/60",children:"Premium Items"})]}),o.jsxs("div",{className:"bg-white/5 rounded-xl p-4 text-center",children:[o.jsx("p",{className:"text-3xl font-bold text-white",children:zh.filter(Q=>Q.rarity==="mythic").length}),o.jsx("p",{className:"text-sm text-white/60",children:"Mythisch"})]})]})]})]})}),Z&&o.jsx("div",{className:"fixed inset-0 z-60 bg-black/80 flex items-center justify-center p-6",onClick:()=>q(null),children:o.jsx("div",{className:"bg-gray-900 rounded-3xl p-6 w-full max-w-sm",onClick:Q=>Q.stopPropagation(),style:{boxShadow:_V(Z.rarity)},children:o.jsxs("div",{className:"text-center",children:[o.jsx("span",{className:"text-sm font-bold uppercase px-3 py-1 rounded-full",style:{backgroundColor:`${uc(Z.rarity)}30`,color:uc(Z.rarity)},children:Z.rarity}),o.jsx("div",{className:"w-24 h-24 rounded-2xl mx-auto mt-4 mb-4 flex items-center justify-center",style:{background:`linear-gradient(135deg, ${uc(Z.rarity)}40 0%, ${uc(Z.rarity)}20 100%)`,boxShadow:_V(Z.rarity)},children:Z.isPremium?o.jsx(hs,{size:48,style:{color:uc(Z.rarity)}}):o.jsx(ra,{size:48,style:{color:uc(Z.rarity)}})}),o.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:Z.nameDE}),o.jsx("p",{className:"text-white/70 mb-4",children:Z.descriptionDE}),o.jsxs("div",{className:"flex items-center justify-center gap-4 mb-6",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-2xl font-bold text-purple-400",children:Z.level}),o.jsx("p",{className:"text-xs text-white/50",children:"Level"})]}),o.jsx("div",{className:"w-px h-8 bg-white/20"}),o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-sm font-medium text-white/80 capitalize",children:Z.type.replace("_"," ")}),o.jsx("p",{className:"text-xs text-white/50",children:"Typ"})]}),Z.isPremium&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-px h-8 bg-white/20"}),o.jsxs("div",{className:"text-center",children:[o.jsx(hs,{size:20,className:"text-amber-400 mx-auto"}),o.jsx("p",{className:"text-xs text-white/50",children:"Premium"})]})]})]}),o.jsx("button",{onClick:()=>q(null),className:"w-full py-3 bg-white/10 rounded-xl text-white font-medium hover:bg-white/20 transition-colors",children:"Schlieen"})]})})}),o.jsx("style",{children:`
        @keyframes float {
          0%, 100% { transform: translateY(0) rotate(0deg); }
          50% { transform: translateY(-20px) rotate(180deg); }
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      `})]})},PJ=({reward:s,isUnlocked:n=!1,isClaimed:i=!1,isPremiumLocked:l=!1,onClaim:u,onPreview:p,isClaiming:g=!1})=>{if(!s)return o.jsx("div",{className:"w-32 h-40 bg-white/5 rounded-2xl flex items-center justify-center",children:o.jsx("span",{className:"text-white/20 text-sm",children:""})});const y=uc(s.rarity),x=n&&!i&&!l;return o.jsxs("div",{className:`relative w-32 rounded-2xl overflow-hidden transition-all duration-300 ${x?"ring-2 ring-green-500 ring-offset-2 ring-offset-black":""}`,style:{background:n?`linear-gradient(180deg, ${y}20 0%, transparent 100%)`:"rgba(255,255,255,0.05)",boxShadow:n?_V(s.rarity):"none"},onClick:p,children:[l&&o.jsx("div",{className:"absolute inset-0 bg-black/60 z-10 flex items-center justify-center",children:o.jsx(Hi,{size:24,className:"text-amber-400"})}),o.jsxs("div",{className:"p-3",children:[s.isPremium&&o.jsx("div",{className:"absolute top-2 right-2 z-20",children:o.jsx(hs,{size:14,className:"text-amber-400"})}),o.jsx("div",{className:"w-12 h-12 rounded-xl mx-auto mb-2 flex items-center justify-center",style:{background:`linear-gradient(135deg, ${y}40 0%, ${y}20 100%)`},children:s.type==="coins"?o.jsx("span",{className:"text-xl",children:""}):s.type==="xp_boost"?o.jsx(Ei,{size:24,style:{color:y}}):o.jsx(ra,{size:24,style:{color:y}})}),o.jsx("p",{className:"text-xs font-medium text-white text-center truncate mb-1",children:s.nameDE}),s.value&&o.jsx("p",{className:"text-xs text-center",style:{color:y},children:s.type==="coins"?`${s.value} `:`x${s.value}`}),o.jsx("p",{className:"text-[10px] text-center uppercase font-bold mt-1",style:{color:y},children:s.rarity})]}),x&&o.jsx("button",{onClick:C=>{C.stopPropagation(),u()},disabled:g,className:"w-full py-2 bg-green-500 text-white text-xs font-bold flex items-center justify-center gap-1",children:g?o.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):o.jsxs(o.Fragment,{children:[o.jsx(ra,{size:14}),"Abholen"]})}),i&&o.jsxs("div",{className:"w-full py-2 bg-white/10 text-white/50 text-xs text-center",children:[o.jsx(zn,{size:14,className:"inline mr-1"}),"Abgeholt"]})]})},Jre=({currentLevel:s=1,hasUnclaimedRewards:n=!1})=>{const[i,l]=H.useState(!1);return o.jsxs(o.Fragment,{children:[o.jsxs("button",{id:"dream-pass-btn",onClick:()=>l(!0),className:"relative group w-full overflow-hidden rounded-2xl p-[2px] transition-all duration-300 hover:scale-[1.02] active:scale-[0.98]",style:{background:"linear-gradient(135deg, #C4B5FD 0%, #A78BFA 25%, #818CF8 50%, #6366F1 75%, #A78BFA 100%)",backgroundSize:"200% 200%",animation:"gradient-shift 3s ease infinite, pulse-glow 2s ease-in-out infinite"},children:[o.jsxs("div",{className:"relative flex items-center justify-between gap-4 bg-gray-900/95 rounded-[14px] px-4 py-4 backdrop-blur-sm",children:[o.jsxs("div",{className:"relative",children:[o.jsxs("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center relative overflow-hidden",style:{background:"linear-gradient(135deg, #C4B5FD 0%, #818CF8 100%)"},children:[o.jsx(sm,{size:40,className:"absolute text-white/30",style:{transform:"translateY(5px)"}}),o.jsx(hs,{size:24,className:"text-white relative z-10"}),o.jsx(wr,{size:12,className:"absolute top-1 right-1 text-yellow-300 animate-pulse"})]}),o.jsxs("div",{className:"absolute -bottom-1 -right-1 bg-gradient-to-r from-amber-400 to-orange-500 text-white text-xs font-bold px-2 py-0.5 rounded-full shadow-lg",children:["Lv.",s]})]}),o.jsxs("div",{className:"flex-1 text-left",children:[o.jsxs("h3",{className:"font-bold text-white text-lg flex items-center gap-2",children:["Dream Pass",n&&o.jsxs("span",{className:"flex h-2.5 w-2.5",children:[o.jsx("span",{className:"animate-ping absolute inline-flex h-2.5 w-2.5 rounded-full bg-pink-400 opacity-75"}),o.jsx("span",{className:"relative inline-flex rounded-full h-2.5 w-2.5 bg-pink-500"})]})]}),o.jsx("p",{className:"text-sm text-white/60",children:"Beta Season 1  Exklusive Belohnungen"})]}),o.jsx("div",{className:"flex items-center gap-2",children:o.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center",style:{background:"linear-gradient(135deg, rgba(167, 139, 250, 0.2) 0%, rgba(129, 140, 248, 0.2) 100%)"},children:o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",className:"text-purple-300",children:o.jsx("path",{d:"M9 18l6-6-6-6"})})})})]}),o.jsx("div",{className:"absolute inset-0 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none",style:{boxShadow:"0 0 30px rgba(167, 139, 250, 0.4), 0 0 60px rgba(129, 140, 248, 0.2)"}})]}),o.jsx(pCe,{isOpen:i,onClose:()=>l(!1)}),o.jsx("style",{children:`
        @keyframes gradient-shift {
          0% { background-position: 0% 50%; }
          50% { background-position: 100% 50%; }
          100% { background-position: 0% 50%; }
        }

        @keyframes pulse-glow {
          0%, 100% { box-shadow: 0 0 20px rgba(167, 139, 250, 0.3); }
          50% { box-shadow: 0 0 35px rgba(167, 139, 250, 0.5), 0 0 50px rgba(129, 140, 248, 0.3); }
        }
      `})]})},Qre=()=>{const{user:s,showXPGain:n}=mr(),[i,l]=H.useState(null),[u,p]=H.useState(!0),[g,y]=H.useState(fk());H.useEffect(()=>{if(!(s!=null&&s.id)){p(!1);return}(async()=>{p(!0);let X=await np(s.id);X||(X=await WF(s.id)),await $re(s.id),X=await np(s.id),l(X),p(!1)})()},[s==null?void 0:s.id]),H.useEffect(()=>{if(!(s!=null&&s.id))return;const B=hCe(s.id,X=>{l(X)});return()=>B()},[s==null?void 0:s.id]),H.useEffect(()=>{const B=setInterval(()=>{y(fk())},1e3);return()=>clearInterval(B)},[]);const x=i?i.unlockedRewards.filter(B=>!i.claimedRewards.includes(B)).length:0,C=H.useCallback(async B=>{if(!(s!=null&&s.id))return{success:!1,leveledUp:!1};const X=await dCe(s.id,B);return X.success&&X.leveledUp&&X.newLevel&&n(B.amount,`Dream Pass Level ${X.newLevel}! `),X},[s==null?void 0:s.id,n]),k=H.useCallback(async()=>{if(!(s!=null&&s.id))return;const B=await np(s.id);l(B)},[s==null?void 0:s.id]),A=H.useCallback(async B=>{const X=s_.dailyQuest[B];await C({type:"daily_quest",amount:X,description:`Daily Quest (${B})`})},[C]),M=H.useCallback(async B=>{let X=s_.cloudStreak.base*B;B>=100?X+=s_.cloudStreak.milestone100:B>=30?X+=s_.cloudStreak.milestone30:B>=14?X+=s_.cloudStreak.milestone14:B>=7&&(X+=s_.cloudStreak.milestone7),await C({type:"cloud_streak",amount:X,description:`${B} Tage Streak`})},[C]),G=H.useCallback(async B=>{const X=s_.social[B];await C({type:"social",amount:X,description:B==="invite"?"Freund eingeladen":B==="inviteActive"?"Eingeladener Freund aktiv":B==="friendMade"?"Neue Freundschaft":"Cloud Interaktion"})},[C]);return{progress:i,isLoading:u,countdown:g,unclaimedRewards:x,addXP:C,refreshProgress:k,awardDailyQuestXP:A,awardStreakXP:M,awardSocialXP:G}},fCe=()=>{const{t:s}=tl(),n=zr(),{user:i,setUser:l,searchRadius:u,setSearchRadius:p,isVerifiedStar:g,starProfile:y}=mr(),{logout:x}=TT(),{blockedUsers:C}=gO(),{progress:k,unclaimedRewards:A}=Qre(),[M,G]=H.useState(!1),[B,X]=H.useState(!1),[Z,q]=H.useState(!1),[V,ee]=H.useState(!1),[de,ae]=H.useState((i==null?void 0:i.displayName)||""),[ye,Q]=H.useState((i==null?void 0:i.bio)||""),[$,se]=H.useState(!1),[ce,he]=H.useState(null);H.useEffect(()=>{i!=null&&i.id&&Ey(i.id).then(he)},[i==null?void 0:i.id]);const ve=(i==null?void 0:i.avatar)||"pegasus",ge=(i==null?void 0:i.xp)||0,qe=(i==null?void 0:i.level)||1,Dt=(i==null?void 0:i.currentStreak)||0,gt=(i==null?void 0:i.trustScore)||3,Ye=(i==null?void 0:i.totalVoiceMinutes)||0,ze=(i==null?void 0:i.friendCount)||0,ut=(i==null?void 0:i.friendRadarEnabled)??!0,yt=(i==null?void 0:i.isPremium)||!1,Xt=(i==null?void 0:i.visibilityMode)||"public",jt=(i==null?void 0:i.starsGivenToday)||0,Gt=yt?OJ.premiumStarsPerDay:OJ.freeStarsPerDay,mn=Math.max(0,Gt-jt),Pt=fO(qe),Jt=mO(Dt),He=hk(qe),bt=hk(qe+1),Wt=(ge-He)/(bt-He)*100,gn=async qt=>{if(i)try{await Kn(at(Me,"users",i.id),{visibilityMode:qt}),l({...i,visibilityMode:qt})}catch(Jr){console.error("Failed to update visibility:",Jr)}},xt=async()=>{if(i)try{await Kn(at(Me,"users",i.id),{friendRadarEnabled:!ut}),l({...i,friendRadarEnabled:!ut})}catch(qt){console.error("Failed to update friend radar:",qt)}},Sn=async qt=>{if(p(qt),!!i)try{await Kn(at(Me,"users",i.id),{searchRadius:qt})}catch(Jr){console.error("Failed to update radius:",Jr)}},cr=async qt=>{if(i)try{await Kn(at(Me,"users",i.id),{avatar:qt}),l({...i,avatar:qt})}catch(Jr){console.error("Failed to update avatar:",Jr)}},Or=async()=>{if(i)try{await Kn(at(Me,"users",i.id),{displayName:de,bio:ye}),l({...i,displayName:de,bio:ye}),ee(!1)}catch(qt){console.error("Failed to update profile:",qt)}},ms=async()=>{se(!0),await x()},xi=[100,200,300,500,750,1e3,2e3,3e3,5e3].reduce((qt,Jr)=>Math.abs(Jr-u)<Math.abs(qt-u)?Jr:qt),Gr=qt=>qt>=1e3?`${qt/1e3}km`:`${qt}m`;return o.jsxs("div",{className:"px-4 py-6 pb-24 safe-top min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsx("h1",{className:"font-display text-2xl font-bold text-delulu-text",children:s("profile.title")}),o.jsx(kJ,{compact:!0})]}),o.jsx("div",{className:"glass-card rounded-3xl p-6 mb-4",children:o.jsxs("div",{className:"flex flex-col items-center mb-4",children:[o.jsxs("button",{onClick:()=>G(!0),className:"relative mb-4",children:[o.jsx(Kre,{avatarId:ve,size:"xl",className:"shadow-lg"}),o.jsx("div",{className:"absolute -bottom-1 -right-1 w-8 h-8 bg-white rounded-full shadow-md flex items-center justify-center",children:o.jsx(QE,{size:14,className:"text-delulu-violet"})})]}),o.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-violet-500 to-purple-600 rounded-full text-white text-sm font-semibold mb-3 shadow-lg",children:[o.jsx("span",{children:Pt.emoji}),o.jsxs("span",{children:[s("level.level")," ",qe]}),o.jsx("span",{className:"opacity-60",children:""}),o.jsx("span",{children:Pt.name})]}),o.jsxs("div",{className:"w-full max-w-[200px] mb-4",children:[o.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full bg-gradient-to-r from-violet-500 to-purple-500 rounded-full transition-all duration-500",style:{width:`${Math.min(100,Math.max(0,Wt))}%`}})}),o.jsxs("p",{className:"text-xs text-delulu-muted mt-1 text-center",children:[ge," / ",bt," XP"]})]}),V?o.jsxs("div",{className:"w-full space-y-3",children:[o.jsx("input",{type:"text",value:de,onChange:qt=>ae(qt.target.value),className:"w-full text-center font-display text-xl font-bold bg-delulu-soft rounded-xl px-4 py-2",placeholder:s("profile.editProfile")}),o.jsx("textarea",{value:ye,onChange:qt=>Q(qt.target.value),placeholder:s("profile.bioPlaceholder"),maxLength:150,rows:2,className:"w-full bg-delulu-soft rounded-xl px-4 py-3 text-sm resize-none text-center"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:()=>ee(!1),className:"flex-1 py-2 rounded-xl border-2 border-delulu-soft font-semibold text-delulu-muted text-sm",children:s("common.cancel")}),o.jsx("button",{onClick:Or,className:"flex-1 py-2 rounded-xl btn-primary text-white font-semibold text-sm",children:s("common.save")})]})]}):o.jsxs(o.Fragment,{children:[o.jsx("h2",{className:"font-display text-xl font-bold text-delulu-text",children:(i==null?void 0:i.displayName)||"Anonymous"}),o.jsxs("button",{onClick:()=>q(!0),className:"flex items-center gap-2 text-sm text-delulu-muted mb-2 hover:text-delulu-violet transition-colors",children:[o.jsx(UF,{size:14}),o.jsx("span",{children:i==null?void 0:i.username}),ce!=null&&ce.canChange?o.jsx(QE,{size:12,className:"text-delulu-violet"}):o.jsxs("span",{className:"text-[10px] text-amber-500 flex items-center gap-1",children:[o.jsx(Gi,{size:10}),(ce==null?void 0:ce.daysRemaining)||0,"d"]})]}),(i==null?void 0:i.birthDay)&&(i==null?void 0:i.birthMonth)&&o.jsxs("div",{className:"flex items-center gap-2 text-sm text-delulu-muted mb-2",children:[o.jsx(VF,{size:14}),o.jsxs("span",{children:[i.birthDay,". ",mCe(i.birthMonth)]}),(i==null?void 0:i.city)&&o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"text-gray-300",children:""}),o.jsx(_c,{size:12}),o.jsx("span",{children:i.city})]})]}),o.jsx("p",{className:"text-sm text-delulu-text/70 italic text-center px-4",children:(i==null?void 0:i.bio)||s("profile.noBio")}),o.jsxs("button",{onClick:()=>ee(!0),className:"mt-3 flex items-center gap-2 text-sm text-delulu-violet font-medium",children:[o.jsx(QE,{size:14}),s("profile.editProfile")]})]})]})}),o.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[o.jsxs("div",{className:"glass-card rounded-2xl p-3 text-center",children:[o.jsx("p",{className:"text-xl font-bold gradient-text",children:ze}),o.jsx("p",{className:"text-[10px] text-delulu-muted uppercase tracking-wide",children:s("profile.stats.friends")})]}),o.jsxs("div",{className:"glass-card rounded-2xl p-3 text-center",children:[o.jsxs("div",{className:"flex items-center justify-center gap-1",children:[o.jsx("span",{className:"text-yellow-500 text-sm",children:""}),o.jsx("p",{className:"text-xl font-bold gradient-text",children:gt.toFixed(1)})]}),o.jsx("p",{className:"text-[10px] text-delulu-muted uppercase tracking-wide",children:s("profile.stats.trust")})]}),o.jsxs("div",{className:"glass-card rounded-2xl p-3 text-center",children:[o.jsx("p",{className:"text-xl font-bold gradient-text",children:Ye}),o.jsx("p",{className:"text-[10px] text-delulu-muted uppercase tracking-wide",children:s("profile.stats.voiceMin")})]})]}),o.jsx("div",{className:"mb-4",children:o.jsx(Jre,{currentLevel:(k==null?void 0:k.currentLevel)||1,hasUnclaimedRewards:A>0})}),g&&y&&o.jsxs("div",{className:"glass-card rounded-2xl p-4 mb-4 bg-gradient-to-br from-purple-50 to-pink-50 border border-purple-200",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(vy,{tier:y.nebulaTier,size:"lg",animated:!0}),o.jsxs("div",{children:[o.jsx("h3",{className:"font-bold text-delulu-text",children:"Creator Hub"}),o.jsx(Bre,{category:y.category,size:"sm"})]})]}),o.jsx("button",{onClick:()=>n("/stars/dashboard"),className:"px-3 py-1.5 bg-purple-100 text-purple-600 rounded-lg text-xs font-semibold",children:"Dashboard "})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[o.jsxs("div",{className:"bg-white/60 rounded-xl p-2 text-center",children:[o.jsx("p",{className:"text-lg font-bold text-purple-600",children:y.totalListeners.toLocaleString()}),o.jsx("p",{className:"text-[9px] text-gray-500",children:"Zuhrer"})]}),o.jsxs("div",{className:"bg-white/60 rounded-xl p-2 text-center",children:[o.jsx("p",{className:"text-lg font-bold text-amber-500",children:y.totalStarsReceived.toLocaleString()}),o.jsx("p",{className:"text-[9px] text-gray-500",children:"Sterne"})]}),o.jsxs("div",{className:"bg-white/60 rounded-xl p-2 text-center",children:[o.jsx("p",{className:"text-lg font-bold text-green-600",children:y.totalEventsHosted}),o.jsx("p",{className:"text-[9px] text-gray-500",children:"Events"})]})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs("button",{onClick:()=>n("/stars/event/new"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl text-sm font-semibold",children:[o.jsx(kre,{size:16}),"Live gehen"]}),o.jsxs("button",{onClick:()=>n("/stars/schedule"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 bg-white border border-purple-200 text-purple-600 rounded-xl text-sm font-semibold",children:[o.jsx(rm,{size:16}),"Event planen"]})]})]}),o.jsxs("div",{className:"glass-card rounded-2xl p-4 mb-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Fs,{size:18,className:"text-amber-500"}),o.jsx("span",{className:"font-semibold text-delulu-text text-sm",children:"Deine Sterne heute"})]}),o.jsxs("span",{className:"text-xs text-delulu-muted",children:[mn," / ",Gt," brig"]})]}),o.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden mb-2",children:o.jsx("div",{className:"h-full bg-gradient-to-r from-amber-400 to-orange-500 rounded-full transition-all",style:{width:`${mn/Gt*100}%`}})}),o.jsxs("div",{className:"flex items-center justify-between text-xs",children:[o.jsxs("span",{className:"text-delulu-muted",children:[jt," Sterne heute vergeben"]}),!yt&&o.jsxs("button",{onClick:()=>n("/premium"),className:"text-purple-500 font-medium flex items-center gap-1",children:[o.jsx(wr,{size:12}),"Mehr mit Premium"]})]})]}),Dt>=2&&o.jsx("div",{className:"glass-card rounded-2xl p-4 mb-4 bg-gradient-to-r from-orange-400/10 to-red-400/10 border border-orange-200",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-2xl animate-pulse",children:""}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("p",{className:"font-semibold text-delulu-text",children:[Dt," ",s("streak.days")," ",s("streak.title"),"!"]}),o.jsxs("p",{className:"text-xs text-delulu-muted",children:[Jt,"x ",s("streak.xpBoost")]})]})]})}),o.jsxs("div",{className:"glass-card rounded-2xl p-4 mb-4",children:[o.jsx("p",{className:"text-xs font-semibold text-delulu-muted uppercase tracking-wide mb-3",children:s("visibility.title")}),o.jsx("div",{className:"space-y-2",children:["public","friends","ghost"].map(qt=>o.jsxs("button",{onClick:()=>gn(qt),className:`w-full flex items-center gap-3 p-3 rounded-xl transition-all ${Xt===qt?"bg-delulu-violet/10 border-2 border-delulu-violet":"bg-delulu-soft/50 border-2 border-transparent"}`,children:[o.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center ${Xt===qt?"bg-delulu-violet":"border-2 border-gray-300"}`,children:Xt===qt&&o.jsx("span",{className:"text-white text-xs",children:""})}),o.jsxs("div",{className:"flex-1 text-left",children:[o.jsx("p",{className:"font-medium text-delulu-text text-sm",children:s(`visibility.${qt}.title`)}),o.jsx("p",{className:"text-xs text-delulu-muted",children:s(`visibility.${qt}.description`)})]})]},qt))})]}),o.jsx("div",{className:"glass-card rounded-2xl p-4 mb-4",children:o.jsxs("button",{onClick:xt,className:"w-full flex items-center gap-4",children:[o.jsx("div",{className:"w-12 h-12 rounded-xl bg-delulu-violet/10 flex items-center justify-center",children:o.jsx(_c,{size:20,className:"text-delulu-violet"})}),o.jsxs("div",{className:"flex-1 text-left",children:[o.jsx("p",{className:"font-semibold text-delulu-text",children:s("friendRadar.title")}),o.jsx("p",{className:"text-xs text-delulu-muted",children:s("friendRadar.description")})]}),o.jsx("div",{className:`w-14 h-8 rounded-full p-1 transition-colors ${ut?"bg-delulu-violet":"bg-gray-300"}`,children:o.jsx("div",{className:`w-6 h-6 bg-white rounded-full shadow transition-transform ${ut?"translate-x-6":""}`})})]})}),o.jsxs("div",{className:"glass-card rounded-2xl p-4 mb-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-xl bg-delulu-violet/10 flex items-center justify-center",children:o.jsx("span",{className:"text-xl",children:""})}),o.jsxs("div",{children:[o.jsx("p",{className:"font-semibold text-delulu-text",children:s("radius.title")}),o.jsx("p",{className:"text-xs text-delulu-muted",children:s("radius.description")})]})]}),o.jsx("span",{className:"text-xl font-bold gradient-text",children:Gr(xi)})]}),o.jsxs("div",{className:"px-2",children:[o.jsx("input",{type:"range",min:"100",max:"5000",step:"100",value:u,onChange:qt=>Sn(Number(qt.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-delulu-violet"}),o.jsxs("div",{className:"flex justify-between text-xs text-delulu-muted mt-1",children:[o.jsx("span",{children:"100m"}),o.jsx("span",{children:"5km"})]})]})]}),!g&&o.jsxs("div",{className:"glass-card rounded-2xl p-5 mb-4 bg-gradient-to-br from-pink-50 to-purple-50 border border-pink-200",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-pink-500 to-purple-500 flex items-center justify-center",children:o.jsx(Fs,{size:24,className:"text-white"})}),o.jsxs("div",{children:[o.jsx("h3",{className:"font-bold text-lg text-delulu-text",children:"Creator werden"}),o.jsx("p",{className:"text-xs text-delulu-muted",children:"Teile deine Stimme mit der Community"})]})]}),o.jsx("p",{className:"text-sm text-delulu-text/80 mb-4",children:"Werde ein verifizierter Star und hoste eigene Live-Events, verdiene Sterne und baue deine Community auf."}),o.jsxs("button",{onClick:()=>n("/stars/apply"),className:"w-full py-3 rounded-xl bg-gradient-to-r from-pink-500 to-purple-500 text-white font-semibold shadow-lg hover:shadow-xl transition-shadow flex items-center justify-center gap-2",children:[o.jsx(wr,{size:18}),"Jetzt bewerben"]})]}),!yt&&o.jsxs("div",{className:"glass-card rounded-2xl p-5 mb-4 bg-gradient-to-br from-violet-50 to-purple-50 border border-violet-200 relative overflow-hidden",children:[o.jsx("div",{className:"absolute top-3 right-3 px-3 py-1 bg-amber-100 text-amber-700 text-xs font-bold rounded-full",children:"Bald verfgbar"}),o.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[o.jsx(wr,{size:20,className:"text-violet-500"}),o.jsx("h3",{className:"font-bold text-lg gradient-text",children:s("premium.title")})]}),o.jsx("p",{className:"text-sm text-delulu-text/80 mb-4",children:s("premium.upsell")}),o.jsx("button",{disabled:!0,className:"w-full py-3 rounded-xl bg-gray-300 text-gray-500 font-semibold cursor-not-allowed",children:"Demnchst verfgbar"})]}),o.jsx("div",{className:"mb-4",children:o.jsx(lCe,{})}),o.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden mb-4",children:[o.jsxs("button",{onClick:()=>X(!0),className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 transition-colors border-b border-gray-100",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(D_,{size:18,className:"text-delulu-muted"}),o.jsx("span",{className:"font-medium text-delulu-text",children:s("settings.language")})]}),o.jsx(As,{size:18,className:"text-delulu-muted"})]}),o.jsxs("button",{onClick:()=>n("/blocked-users"),className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 transition-colors border-b border-gray-100",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(li,{size:18,className:"text-delulu-muted"}),o.jsx("span",{className:"font-medium text-delulu-text",children:s("settings.blockedUsers")})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-sm text-delulu-muted",children:C.length}),o.jsx(As,{size:18,className:"text-delulu-muted"})]})]}),o.jsxs("button",{onClick:()=>n("/statistics"),className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 transition-colors border-b border-gray-100",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(mS,{size:18,className:"text-delulu-muted"}),o.jsx("span",{className:"font-medium text-delulu-text",children:s("settings.myStats")})]}),o.jsx(As,{size:18,className:"text-delulu-muted"})]}),o.jsxs("button",{onClick:()=>n("/notifications"),className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 transition-colors border-b border-gray-100",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(Xc,{size:18,className:"text-delulu-muted"}),o.jsx("span",{className:"font-medium text-delulu-text",children:s("settings.notifications")})]}),o.jsx(As,{size:18,className:"text-delulu-muted"})]}),o.jsxs("button",{onClick:()=>n("/help"),className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(RT,{size:18,className:"text-delulu-muted"}),o.jsx("span",{className:"font-medium text-delulu-text",children:s("settings.help")})]}),o.jsx(As,{size:18,className:"text-delulu-muted"})]})]}),o.jsxs("button",{onClick:ms,disabled:$,className:"w-full p-4 flex items-center justify-center gap-3 text-red-500 font-medium rounded-2xl border-2 border-red-100 hover:bg-red-50 transition-colors disabled:opacity-50",children:[o.jsx(hO,{size:18}),s($?"profile.loggingOut":"profile.logout")]}),o.jsx("p",{className:"text-center text-xs text-delulu-muted mt-6",children:"delulu v2.0  butterbread "}),M&&o.jsx(Hre,{selectedAvatar:ve,onSelect:cr,onClose:()=>G(!1)}),B&&o.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-end justify-center z-50 p-4",children:o.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-md p-6 animate-slide-up",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("h2",{className:"font-display text-xl font-bold text-delulu-text",children:s("settings.language")}),o.jsx("button",{onClick:()=>X(!1),className:"w-10 h-10 rounded-xl bg-delulu-soft flex items-center justify-center",children:o.jsx(Rs,{size:20,className:"text-delulu-muted"})})]}),o.jsx(kJ,{})]})}),o.jsx(Xre,{isOpen:Z,onClose:()=>q(!1),onSuccess:qt=>{Ey((i==null?void 0:i.id)||"").then(he)}})]})},mCe=s=>["Januar","Februar","Mrz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"][s-1]||"",LJ="/avatars/pegasus.png",HF=(s={})=>{const{user:n,setUser:i}=mr(),l=H.useMemo(()=>{if(!(n!=null&&n.id))return LJ;const g=xre();if(g)return g;const y=wre(n.id);return y!=null&&y.url?y.url:n.avatarUrl?(Wd(n.id,n.avatarUrl),Zh(n.id,{url:n.avatarUrl,type:"custom"}),n.avatarUrl):n.avatar?`/avatars/${n.avatar}.png`:LJ},[n==null?void 0:n.id,n==null?void 0:n.avatarUrl,n==null?void 0:n.avatar,s.forceRefresh]),u=H.useMemo(()=>n!=null&&n.id?n.avatarUrl?"custom":n.avatar?"preset":"default":"default",[n==null?void 0:n.id,n==null?void 0:n.avatarUrl,n==null?void 0:n.avatar]),p=H.useCallback(g=>{n!=null&&n.id&&(E_(g),Zh(n.id,{url:g,type:"custom"}),Wd(n.id,g),i({...n,avatarUrl:g}))},[n,i]);return H.useEffect(()=>{n!=null&&n.avatarUrl&&(n!=null&&n.id)&&(E_(n.avatarUrl),Wd(n.id,n.avatarUrl))},[n==null?void 0:n.avatarUrl,n==null?void 0:n.id]),{avatarUrl:l,avatarType:u,setAvatarUrl:p,userId:n==null?void 0:n.id,isCustom:u==="custom",isPreset:u==="preset",isDefault:u==="default"}},gCe=s=>["Januar","Februar","Mrz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"][s-1]||"",_Ce=()=>{tl();const s=zr(),{user:n,setUser:i}=mr(),{progress:l,unclaimedRewards:u}=Qre(),{avatarUrl:p}=HF(),[g,y]=H.useState(!1),[x,C]=H.useState(!1),[k,A]=H.useState(!1),[M,G]=H.useState((n==null?void 0:n.displayName)||""),[B,X]=H.useState((n==null?void 0:n.bio)||""),[Z,q]=H.useState(null),V=(n==null?void 0:n.xp)||0,ee=(n==null?void 0:n.level)||1,de=(n==null?void 0:n.friendCount)||0,ae=(n==null?void 0:n.trustScore)||3,ye=(n==null?void 0:n.totalVoiceMinutes)||0,Q=fO(ee),$=hk(ee),se=hk(ee+1),ce=(V-$)/(se-$)*100;H.useEffect(()=>{n!=null&&n.id&&Ey(n.id).then(q)},[n==null?void 0:n.id]);const he=async ge=>{if(n)try{await Kn(at(Me,"users",n.id),{avatar:ge}),i({...n,avatar:ge})}catch(qe){console.error("Failed to update avatar:",qe)}},ve=async()=>{if(n)try{await Kn(at(Me,"users",n.id),{displayName:M,bio:B}),i({...n,displayName:M,bio:B}),A(!1)}catch(ge){console.error("Failed to update profile:",ge)}};return o.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-purple-50/80 via-white to-white",children:[o.jsxs("div",{className:"px-4 pt-6 pb-2 flex items-center justify-between",children:[o.jsx("h1",{className:"font-display text-2xl font-bold text-gray-900",children:"Profil"}),o.jsx("button",{onClick:()=>s("/settings"),className:"w-10 h-10 rounded-xl bg-white shadow-sm border border-gray-100 flex items-center justify-center hover:bg-gray-50 transition-colors",children:o.jsx(QS,{size:20,className:"text-gray-600"})})]}),o.jsx("div",{className:"px-4 py-8",children:o.jsxs("div",{className:"flex flex-col items-center",children:[o.jsxs("button",{onClick:()=>y(!0),className:"relative mb-6 group",children:[o.jsx("div",{className:"w-28 h-28 rounded-full overflow-hidden ring-4 ring-white shadow-2xl shadow-purple-500/20",children:o.jsx("img",{src:p,alt:"Avatar",className:"w-full h-full object-cover"})}),o.jsx("div",{className:"absolute inset-0 rounded-full bg-black/0 group-hover:bg-black/20 transition-colors flex items-center justify-center",children:o.jsx("div",{className:"absolute bottom-0 right-0 w-9 h-9 bg-white rounded-full shadow-lg flex items-center justify-center border-2 border-purple-100",children:o.jsx(QE,{size:16,className:"text-purple-600"})})})]}),o.jsxs("div",{className:"inline-flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-violet-500 to-purple-600 rounded-full text-white text-sm font-semibold shadow-lg shadow-purple-500/30 mb-4",children:[o.jsx("span",{className:"text-base",children:Q.emoji}),o.jsxs("span",{children:["Level ",ee]}),o.jsx("span",{className:"opacity-50",children:""}),o.jsx("span",{children:Q.name})]}),o.jsxs("div",{className:"w-full max-w-[220px] mb-5",children:[o.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full bg-gradient-to-r from-violet-500 to-purple-500 rounded-full transition-all duration-700",style:{width:`${Math.min(100,Math.max(0,ce))}%`}})}),o.jsxs("div",{className:"flex justify-between items-center mt-1.5",children:[o.jsxs("span",{className:"text-xs text-gray-400",children:[V," XP"]}),o.jsxs("span",{className:"text-xs text-gray-400",children:[se," XP"]})]})]}),k?o.jsxs("div",{className:"w-full max-w-sm space-y-3",children:[o.jsx("input",{type:"text",value:M,onChange:ge=>G(ge.target.value),className:"w-full text-center font-display text-xl font-bold bg-gray-50 rounded-xl px-4 py-3 border border-gray-200 focus:border-purple-400 focus:ring-2 focus:ring-purple-100 outline-none transition-all",placeholder:"Dein Name"}),o.jsx("textarea",{value:B,onChange:ge=>X(ge.target.value),placeholder:"ber dich...",maxLength:150,rows:2,className:"w-full bg-gray-50 rounded-xl px-4 py-3 text-sm resize-none text-center border border-gray-200 focus:border-purple-400 focus:ring-2 focus:ring-purple-100 outline-none transition-all"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:()=>A(!1),className:"flex-1 py-2.5 rounded-xl border-2 border-gray-200 font-semibold text-gray-500 text-sm hover:bg-gray-50 transition-colors",children:"Abbrechen"}),o.jsx("button",{onClick:ve,className:"flex-1 py-2.5 rounded-xl bg-gradient-to-r from-violet-500 to-purple-600 text-white font-semibold text-sm shadow-lg shadow-purple-500/30 hover:shadow-purple-500/50 transition-shadow",children:"Speichern"})]})]}):o.jsxs(o.Fragment,{children:[o.jsx("h2",{className:"font-display text-2xl font-bold text-gray-900 mb-1",children:(n==null?void 0:n.displayName)||"Anonymous"}),o.jsxs("button",{onClick:()=>C(!0),className:"flex items-center gap-2 text-sm text-gray-500 mb-3 hover:text-purple-600 transition-colors group",children:[o.jsx(UF,{size:14}),o.jsx("span",{children:n==null?void 0:n.username}),Z!=null&&Z.canChange?o.jsx(QE,{size:12,className:"text-purple-500 opacity-0 group-hover:opacity-100 transition-opacity"}):o.jsxs("span",{className:"text-[10px] text-amber-500 flex items-center gap-1 bg-amber-50 px-1.5 py-0.5 rounded-full",children:[o.jsx(Gi,{size:10}),(Z==null?void 0:Z.daysRemaining)||0,"d"]})]}),((n==null?void 0:n.birthDay)||(n==null?void 0:n.city))&&o.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-400 mb-4",children:[(n==null?void 0:n.birthDay)&&(n==null?void 0:n.birthMonth)&&o.jsxs("span",{className:"flex items-center gap-1.5",children:[o.jsx(VF,{size:14}),n.birthDay,". ",gCe(n.birthMonth)]}),(n==null?void 0:n.city)&&o.jsxs("span",{className:"flex items-center gap-1.5",children:[o.jsx(_c,{size:14}),n.city]})]}),o.jsx("p",{className:"text-sm text-gray-600 text-center max-w-xs mb-4",children:(n==null?void 0:n.bio)||"Noch keine Bio hinzugefgt"}),o.jsxs("button",{onClick:()=>A(!0),className:"flex items-center gap-2 text-sm text-purple-600 font-medium hover:text-purple-700 transition-colors",children:[o.jsx(QE,{size:14}),"Profil bearbeiten"]})]})]})}),o.jsx("div",{className:"px-4 mb-6",children:o.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[o.jsxs("div",{className:"bg-white rounded-2xl p-4 text-center shadow-sm border border-gray-100",children:[o.jsx("div",{className:"w-10 h-10 mx-auto mb-2 rounded-xl bg-purple-50 flex items-center justify-center",children:o.jsx(rr,{size:20,className:"text-purple-500"})}),o.jsx("p",{className:"text-xl font-bold text-gray-900",children:de}),o.jsx("p",{className:"text-[10px] text-gray-400 uppercase tracking-wider",children:"Freunde"})]}),o.jsxs("div",{className:"bg-white rounded-2xl p-4 text-center shadow-sm border border-gray-100",children:[o.jsx("div",{className:"w-10 h-10 mx-auto mb-2 rounded-xl bg-amber-50 flex items-center justify-center",children:o.jsx(Fs,{size:20,className:"text-amber-500"})}),o.jsx("p",{className:"text-xl font-bold text-gray-900",children:ae.toFixed(1)}),o.jsx("p",{className:"text-[10px] text-gray-400 uppercase tracking-wider",children:"Trust"})]}),o.jsxs("div",{className:"bg-white rounded-2xl p-4 text-center shadow-sm border border-gray-100",children:[o.jsx("div",{className:"w-10 h-10 mx-auto mb-2 rounded-xl bg-pink-50 flex items-center justify-center",children:o.jsx(lRe,{size:20,className:"text-pink-500"})}),o.jsx("p",{className:"text-xl font-bold text-gray-900",children:ye}),o.jsx("p",{className:"text-[10px] text-gray-400 uppercase tracking-wider",children:"Minuten"})]})]})}),o.jsx("div",{className:"px-4 mb-6",children:o.jsx(Jre,{currentLevel:(l==null?void 0:l.currentLevel)||1,hasUnclaimedRewards:u>0})}),o.jsx("div",{className:"px-4 pb-32",children:o.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[o.jsxs("button",{onClick:()=>s("/statistics"),className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-violet-50 flex items-center justify-center",children:o.jsx(Ei,{size:20,className:"text-violet-500"})}),o.jsx("span",{className:"font-medium text-gray-900",children:"Meine Statistiken"})]}),o.jsx(As,{size:20,className:"text-gray-400"})]}),o.jsx("div",{className:"h-px bg-gray-100"}),o.jsxs("button",{onClick:()=>s("/settings"),className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center",children:o.jsx(QS,{size:20,className:"text-gray-600"})}),o.jsx("span",{className:"font-medium text-gray-900",children:"Alle Einstellungen"})]}),o.jsx(As,{size:20,className:"text-gray-400"})]})]})}),g&&o.jsx(Hre,{selectedAvatar:(n==null?void 0:n.avatar)||"pegasus",onSelect:he,onClose:()=>y(!1)}),o.jsx(Xre,{isOpen:x,onClose:()=>C(!1),onSuccess:()=>{Ey((n==null?void 0:n.id)||"").then(q)}})]})},vCe=()=>{const s=zr(),{user:n}=mr(),[i,l]=H.useState("overview"),[u,p]=H.useState(!0),[g,y]=H.useState({totalTalkTime:0,starsReceived:0,starsGiven:0,loungesVisited:0,friendsMade:0,voiceChatsJoined:0,weeklyActivity:[0,0,0,0,0,0,0],xpCurrent:0,xpRequired:1e3,trustScore:5,followers:0,following:0});H.useEffect(()=>{(async()=>{if(!(n!=null&&n.id)){p(!1);return}try{const X=await fr(at(Me,"users",n.id)),Z=X.exists()?X.data():{},q=Zr(xn(Me,"stars"),or("toUserId","==",n.id)),V=await Ur(q),ee=Zr(xn(Me,"stars"),or("fromUserId","==",n.id)),de=await Ur(ee),ae=Zr(xn(Me,"friendships"),or("userId","==",n.id)),ye=await Ur(ae),Q=Zr(xn(Me,"voiceChatHistory"),or("userId","==",n.id)),$=await Ur(Q),se=Zr(xn(Me,"follows"),or("followingId","==",n.id)),ce=await Ur(se),he=Zr(xn(Me,"follows"),or("followerId","==",n.id)),ve=await Ur(he);let ge=0;$.docs.forEach(gt=>{const Ye=gt.data();Ye.duration&&(ge+=Math.floor(Ye.duration/60))});const Dt=(Z.level||1)*500+500;y({totalTalkTime:ge,starsReceived:V.size,starsGiven:de.size,loungesVisited:Z.loungesVisited||0,friendsMade:ye.size,voiceChatsJoined:$.size,weeklyActivity:Z.weeklyActivity||[0,0,0,0,0,0,0],xpCurrent:Z.xp||0,xpRequired:Dt,trustScore:Z.trustScore||5,followers:ce.size,following:ve.size})}catch(X){console.error("Error fetching stats:",X)}finally{p(!1)}})()},[n==null?void 0:n.id]);const x=(n==null?void 0:n.level)||1,C=fO(x),k=mO((n==null?void 0:n.currentStreak)||0),A=g.xpRequired>0?g.xpCurrent/g.xpRequired*100:0,G=[{label:"Gesprochene Zeit",value:(B=>{const X=Math.floor(B/60),Z=B%60;return X>0?`${X}h ${Z}m`:Z>0?`${Z}m`:"0m"})(g.totalTalkTime),subtext:g.totalTalkTime===0?"Noch keine Gesprche":void 0,icon:o.jsx(eh,{size:20}),color:"from-violet-500 to-purple-600"},{label:"Sterne erhalten",value:g.starsReceived,subtext:`${g.starsGiven} verschenkt`,icon:o.jsx(Fs,{size:20}),color:"from-amber-400 to-orange-500"},{label:"Voice Chats",value:g.voiceChatsJoined,subtext:g.voiceChatsJoined===0?"Noch keinem beigetreten":void 0,icon:o.jsx(sm,{size:20}),color:"from-blue-400 to-cyan-500"},{label:"Freundschaften",value:g.friendsMade,subtext:g.friendsMade===0?"Finde neue Freunde!":void 0,icon:o.jsx(rr,{size:20}),color:"from-green-400 to-emerald-500"}];return u?o.jsx("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx(Br,{size:32,className:"animate-spin text-delulu-violet mx-auto mb-4"}),o.jsx("p",{className:"text-delulu-muted text-sm",children:"Lade Statistiken..."})]})}):o.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white safe-top safe-bottom pb-24",children:[o.jsxs("div",{className:"sticky top-0 z-20 bg-white/90 backdrop-blur-lg border-b border-gray-100",children:[o.jsxs("div",{className:"px-6 py-4 flex items-center gap-4",children:[o.jsx("button",{onClick:()=>s(-1),className:"w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-delulu-muted hover:bg-gray-200 transition-colors",children:o.jsx(sa,{size:20})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h1",{className:"font-display text-xl font-bold text-delulu-text",children:"Meine Statistiken"}),o.jsx("p",{className:"text-xs text-delulu-muted",children:"Deine Aktivitt im berblick"})]})]}),o.jsx("div",{className:"px-6 pb-3 flex gap-2",children:[{id:"overview",label:"bersicht",icon:mS},{id:"activity",label:"Aktivitt",icon:rm},{id:"social",label:"Sozial",icon:rr}].map(B=>o.jsxs("button",{onClick:()=>l(B.id),className:`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-semibold transition-all ${i===B.id?"bg-delulu-violet text-white shadow-lg":"bg-gray-100 text-delulu-muted hover:bg-gray-200"}`,children:[o.jsx(B.icon,{size:16}),B.label]},B.id))})]}),o.jsx("div",{className:"px-6 py-4",children:o.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-br from-delulu-violet to-purple-600 rounded-3xl p-6 text-white shadow-xl",children:[o.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2"}),o.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/5 rounded-full translate-y-1/2 -translate-x-1/2"}),o.jsxs("div",{className:"relative",children:[o.jsxs("div",{className:"flex items-start justify-between mb-4",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-16 h-16 rounded-2xl bg-white/20 flex items-center justify-center text-3xl",children:C.emoji}),o.jsxs("div",{children:[o.jsx("p",{className:"text-white/70 text-sm",children:"Dein Level"}),o.jsxs("h2",{className:"font-display text-3xl font-bold",children:["Level ",x]}),o.jsx("p",{className:"text-white/80 text-sm",children:C.name})]})]}),k>1&&o.jsxs("div",{className:"flex items-center gap-1 px-3 py-1.5 bg-amber-400 text-amber-900 rounded-full",children:[o.jsx(Ire,{size:14}),o.jsxs("span",{className:"text-sm font-bold",children:[k,"x XP"]})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex items-center justify-between text-sm",children:[o.jsxs("span",{className:"text-white/70",children:["Fortschritt zu Level ",x+1]}),o.jsxs("span",{className:"font-semibold",children:[g.xpCurrent," / ",g.xpRequired," XP"]})]}),o.jsx("div",{className:"h-3 bg-white/20 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full bg-gradient-to-r from-amber-400 to-yellow-300 rounded-full transition-all duration-500",style:{width:`${Math.min(A,100)}%`}})}),o.jsx("p",{className:"text-xs text-white/60",children:g.xpRequired-g.xpCurrent>0?`Noch ${g.xpRequired-g.xpCurrent} XP bis zum nchsten Level`:"Level Up bereit!"})]})]})]})}),i==="overview"&&o.jsx("div",{className:"px-6 space-y-4",children:g.totalTalkTime===0&&g.starsReceived===0&&g.voiceChatsJoined===0&&g.friendsMade===0?o.jsxs("div",{className:"text-center py-12",children:[o.jsx("div",{className:"w-24 h-24 mx-auto rounded-3xl bg-gradient-to-br from-delulu-soft to-white flex items-center justify-center mb-6 shadow-inner",children:o.jsx(mS,{size:40,className:"text-delulu-muted"})}),o.jsx("h3",{className:"font-display font-bold text-xl text-delulu-text mb-3",children:GF.empty.stats}),o.jsx("p",{className:"text-sm text-delulu-muted mb-8 max-w-xs mx-auto leading-relaxed",children:"Hier werden deine Statistiken angezeigt, sobald du anfngst die App zu nutzen. Tritt einem Voice Chat bei oder finde neue Freunde!"}),o.jsxs("button",{onClick:()=>s("/discover"),className:"inline-flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-delulu-violet to-purple-600 text-white rounded-2xl font-display font-bold shadow-lg",children:[o.jsx(sm,{size:20}),"Wlkchen entdecken"]})]}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"grid grid-cols-2 gap-3",children:G.map((B,X)=>o.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm hover:shadow-md transition-shadow",children:[o.jsx("div",{className:`w-10 h-10 rounded-xl bg-gradient-to-br ${B.color} flex items-center justify-center text-white mb-3`,children:B.icon}),o.jsx("p",{className:"text-2xl font-display font-bold text-delulu-text",children:B.value}),o.jsx("p",{className:"text-xs text-delulu-muted mt-1",children:B.label}),B.subtext&&o.jsx("p",{className:"text-[10px] text-delulu-muted mt-1",children:B.subtext})]},X))}),o.jsx("div",{className:"bg-gradient-to-r from-delulu-violet/10 to-purple-100 rounded-2xl p-4",children:o.jsxs("p",{className:"text-sm text-delulu-text",children:[o.jsx("span",{className:"font-semibold",children:"Tipp:"})," Je mehr du mit anderen interagierst, desto mehr XP und Sterne verdienst du!"]})})]})}),i==="activity"&&o.jsxs("div",{className:"px-6 space-y-4",children:[o.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-sm",children:[o.jsxs("h3",{className:"font-display font-bold text-delulu-text mb-4 flex items-center gap-2",children:[o.jsx(mS,{size:18,className:"text-delulu-violet"}),"Wochenbersicht"]}),g.weeklyActivity.every(B=>B===0)?o.jsxs("div",{className:"text-center py-8",children:[o.jsx(rm,{size:32,className:"mx-auto text-gray-300 mb-3"}),o.jsx("p",{className:"text-sm text-delulu-muted",children:"Noch keine Aktivittsdaten vorhanden."}),o.jsx("p",{className:"text-xs text-delulu-muted mt-1",children:"Nutze die App regelmig, um deine Aktivitt zu tracken."})]}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"flex items-end justify-between h-32 gap-2",children:["Mo","Di","Mi","Do","Fr","Sa","So"].map((B,X)=>{const Z=Math.max(...g.weeklyActivity,1),q=g.weeklyActivity[X]/Z*100,V=X===(new Date().getDay()+6)%7;return o.jsxs("div",{className:"flex-1 flex flex-col items-center gap-2",children:[o.jsx("div",{className:"w-full bg-gray-100 rounded-lg overflow-hidden h-full flex flex-col justify-end",children:o.jsx("div",{className:`w-full rounded-t-lg transition-all duration-500 ${V?"bg-delulu-violet":"bg-delulu-violet/40"}`,style:{height:`${q}%`}})}),o.jsx("span",{className:`text-xs ${V?"font-bold text-delulu-violet":"text-delulu-muted"}`,children:B})]},B)})}),o.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-gray-100",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-xs text-delulu-muted",children:"Gesamt diese Woche"}),o.jsxs("p",{className:"font-bold text-delulu-text",children:[g.weeklyActivity.reduce((B,X)=>B+X,0)," Minuten"]})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("p",{className:"text-xs text-delulu-muted",children:"Durchschnitt"}),o.jsxs("p",{className:"font-bold text-delulu-violet",children:[(g.weeklyActivity.reduce((B,X)=>B+X,0)/7).toFixed(0),"min/Tag"]})]})]})]})]}),o.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-sm",children:[o.jsxs("h3",{className:"font-display font-bold text-delulu-text mb-4 flex items-center gap-2",children:[o.jsx(yRe,{size:18,className:"text-green-500"}),"Wochenziele"]}),o.jsx("div",{className:"space-y-4",children:[{label:"5 Voice Chats",current:Math.min(g.voiceChatsJoined,5),target:5,color:"bg-violet-500"},{label:"10 Sterne verschenken",current:Math.min(g.starsGiven,10),target:10,color:"bg-amber-500"},{label:"3 neue Freunde",current:Math.min(g.friendsMade,3),target:3,color:"bg-green-500"}].map((B,X)=>o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("span",{className:"text-sm text-delulu-text",children:B.label}),o.jsxs("span",{className:`text-sm font-bold ${B.current>=B.target?"text-green-600":"text-delulu-muted"}`,children:[B.current,"/",B.target,B.current>=B.target&&" "]})]}),o.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:o.jsx("div",{className:`h-full ${B.color} rounded-full transition-all`,style:{width:`${Math.min(B.current/B.target*100,100)}%`}})})]},X))})]})]}),i==="social"&&o.jsxs("div",{className:"px-6 space-y-4",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-4",children:[o.jsx(Fs,{size:24,className:"text-amber-500 mb-2"}),o.jsx("p",{className:"text-2xl font-display font-bold text-amber-600",children:g.starsReceived}),o.jsx("p",{className:"text-xs text-amber-700/70",children:"Sterne erhalten"}),o.jsxs("p",{className:"text-[10px] text-amber-600 mt-1",children:["= ",g.starsReceived*15," XP verdient"]})]}),o.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-violet-50 rounded-2xl p-4",children:[o.jsx(fS,{size:24,className:"text-violet-500 mb-2"}),o.jsx("p",{className:"text-2xl font-display font-bold text-violet-600",children:g.starsGiven}),o.jsx("p",{className:"text-xs text-violet-700/70",children:"Sterne verschenkt"}),o.jsxs("p",{className:"text-[10px] text-violet-600 mt-1",children:["= ",g.starsGiven*5," XP ausgegeben"]})]})]}),o.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-sm",children:[o.jsxs("h3",{className:"font-display font-bold text-delulu-text mb-4 flex items-center gap-2",children:[o.jsx(Ei,{size:18,className:"text-green-500"}),"Trust Score"]}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("div",{className:"relative w-24 h-24",children:[o.jsxs("svg",{className:"w-full h-full -rotate-90",viewBox:"0 0 100 100",children:[o.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"#E5E7EB",strokeWidth:"12"}),o.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"#10B981",strokeWidth:"12",strokeLinecap:"round",strokeDasharray:`${g.trustScore/5*251.2} 251.2`})]}),o.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:o.jsx("span",{className:"text-2xl font-bold text-green-600",children:g.trustScore.toFixed(1)})})]}),o.jsxs("div",{className:"flex-1",children:[o.jsx("p",{className:"text-sm text-delulu-muted mb-2",children:"Dein Trust Score basiert auf:"}),o.jsxs("ul",{className:"space-y-1 text-xs text-delulu-text",children:[o.jsxs("li",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),"Positive Bewertungen"]}),o.jsxs("li",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),"Regelmige Aktivitt"]}),o.jsxs("li",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),"Keine Verste"]})]})]})]})]}),o.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-sm",children:[o.jsx("div",{className:"flex items-center justify-between mb-4",children:o.jsxs("h3",{className:"font-display font-bold text-delulu-text flex items-center gap-2",children:[o.jsx(rr,{size:18,className:"text-blue-500"}),"Freundesnetzwerk"]})}),o.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-2xl font-bold text-delulu-text",children:g.friendsMade}),o.jsx("p",{className:"text-[10px] text-delulu-muted",children:"Freunde"})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-2xl font-bold text-blue-500",children:g.followers}),o.jsx("p",{className:"text-[10px] text-delulu-muted",children:"Follower"})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-2xl font-bold text-purple-500",children:g.following}),o.jsx("p",{className:"text-[10px] text-delulu-muted",children:"Folgst du"})]})]}),g.friendsMade===0&&g.followers===0&&g.following===0&&o.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100 text-center",children:o.jsx("p",{className:"text-xs text-delulu-muted",children:"Noch keine Verbindungen. Tritt Voice Chats bei, um Leute kennenzulernen!"})})]})]})]})},ECe=()=>{const s=zr(),{user:n}=mr(),[i,l]=H.useState("all"),[u,p]=H.useState([]),[g,y]=H.useState([]),[x,C]=H.useState(!0),[k,A]=H.useState(null);H.useEffect(()=>{if(!(n!=null&&n.id))return;const ae=xn(Me,"notifications"),ye=qa(ae,Q=>{const $=[];Q.docs.forEach(se=>{var he;const ce=se.data();ce.toUserId===n.id&&$.push({id:se.id,type:ce.type||"system",title:ce.title||"",message:ce.message||"",timestamp:((he=ce.timestamp)==null?void 0:he.toDate())||new Date,isRead:ce.isRead||!1,fromUserId:ce.fromUserId,fromUsername:ce.fromUsername,fromDisplayName:ce.fromDisplayName})}),$.sort((se,ce)=>ce.timestamp.getTime()-se.timestamp.getTime()),y($),C(!1)},Q=>{console.error("Error fetching notifications:",Q),C(!1)});return()=>ye()},[n==null?void 0:n.id]),H.useEffect(()=>{if(!(n!=null&&n.id))return;const ae=xn(Me,"friendRequests"),ye=qa(ae,Q=>{const $=[];Q.docs.forEach(se=>{var he;const ce=se.data();ce.toUserId===n.id&&ce.status==="pending"&&$.push({id:se.id,fromUserId:ce.fromUserId,fromUsername:ce.fromUsername||"unknown",fromDisplayName:ce.fromDisplayName||"Unbekannt",fromLevel:ce.fromLevel||1,message:ce.message,createdAt:((he=ce.createdAt)==null?void 0:he.toDate())||new Date})}),$.sort((se,ce)=>ce.createdAt.getTime()-se.createdAt.getTime()),p($)},Q=>{console.error("Error fetching friend requests:",Q)});return()=>ye()},[n==null?void 0:n.id]);const M=g.filter(ae=>!ae.isRead).length,G=u.length,B=async ae=>{if(n!=null&&n.id){A(ae.id);try{await Kn(at(Me,"friendRequests",ae.id),{status:"accepted",acceptedAt:cn.now()}),await my(xn(Me,"friendships"),{users:[n.id,ae.fromUserId],createdAt:cn.now()}),await my(xn(Me,"notifications"),{toUserId:ae.fromUserId,type:"follow",title:"Freundschaft akzeptiert!",message:`${n.displayName||n.username} hat deine Anfrage angenommen`,timestamp:cn.now(),isRead:!1,fromUserId:n.id,fromUsername:n.username,fromDisplayName:n.displayName})}catch(ye){console.error("Error accepting request:",ye)}finally{A(null)}}},X=async ae=>{A(ae);try{await Kn(at(Me,"friendRequests",ae),{status:"declined",declinedAt:cn.now()})}catch(ye){console.error("Error declining request:",ye)}finally{A(null)}},Z=async ae=>{try{await Kn(at(Me,"notifications",ae),{isRead:!0})}catch(ye){console.error("Error marking as read:",ye)}},q=async()=>{const ae=g.filter(ye=>!ye.isRead);try{await Promise.all(ae.map(ye=>Kn(at(Me,"notifications",ye.id),{isRead:!0})))}catch(ye){console.error("Error marking all as read:",ye)}},V=ae=>{switch(ae){case"star":return o.jsx(Fs,{size:16,className:"text-amber-500"});case"follow":return o.jsx(ep,{size:16,className:"text-blue-500"});case"mention":return o.jsx(V_,{size:16,className:"text-green-500"});case"lounge":return o.jsx(rr,{size:16,className:"text-purple-500"});case"system":return o.jsx(Xc,{size:16,className:"text-gray-500"})}},ee=ae=>{const ye=Date.now()-ae.getTime(),Q=Math.floor(ye/6e4),$=Math.floor(ye/36e5),se=Math.floor(ye/864e5);return Q<60?`${Q}m`:$<24?`${$}h`:`${se}d`},de=g.filter(ae=>i==="all"?!0:i==="stars"?ae.type==="star":i==="social"?["follow","lounge","mention"].includes(ae.type):!1);return x?o.jsx("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx(Br,{size:32,className:"animate-spin text-delulu-violet mx-auto mb-4"}),o.jsx("p",{className:"text-delulu-muted text-sm",children:"Lade Benachrichtigungen..."})]})}):o.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white safe-top safe-bottom pb-24",children:[o.jsxs("div",{className:"sticky top-0 z-20 bg-white/90 backdrop-blur-lg border-b border-gray-100",children:[o.jsxs("div",{className:"px-6 py-4 flex items-center gap-4",children:[o.jsx("button",{onClick:()=>s(-1),className:"w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-delulu-muted hover:bg-gray-200 transition-colors",children:o.jsx(sa,{size:20})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h1",{className:"font-display text-xl font-bold text-delulu-text",children:"Benachrichtigungen"}),o.jsx("p",{className:"text-xs text-delulu-muted",children:M>0?`${M} ungelesen`:"Alles gelesen"})]}),M>0&&o.jsx("button",{onClick:q,className:"text-xs text-delulu-violet font-semibold",children:"Alle lesen"})]}),o.jsx("div",{className:"px-6 pb-3 flex gap-2 overflow-x-auto scrollbar-hide",children:[{id:"all",label:"Alle",count:g.length},{id:"requests",label:"Anfragen",count:G},{id:"stars",label:"Sterne",count:g.filter(ae=>ae.type==="star").length},{id:"social",label:"Sozial",count:g.filter(ae=>["follow","lounge"].includes(ae.type)).length}].map(ae=>o.jsxs("button",{onClick:()=>l(ae.id),className:`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-semibold whitespace-nowrap transition-all ${i===ae.id?"bg-delulu-violet text-white shadow-lg":"bg-gray-100 text-delulu-muted hover:bg-gray-200"}`,children:[ae.label,ae.count>0&&o.jsx("span",{className:`px-1.5 py-0.5 rounded-full text-[10px] ${i===ae.id?"bg-white/20":"bg-delulu-violet/10 text-delulu-violet"}`,children:ae.count})]},ae.id))})]}),(i==="all"||i==="requests")&&u.length>0&&o.jsxs("div",{className:"px-6 py-4",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[o.jsx(ep,{size:18,className:"text-delulu-violet"}),o.jsx("h2",{className:"font-display font-bold text-delulu-text",children:"Freundschaftsanfragen"}),o.jsx("span",{className:"px-2 py-0.5 bg-red-100 text-red-600 text-xs font-bold rounded-full",children:G})]}),o.jsx("div",{className:"space-y-3",children:u.map(ae=>{var ye;return o.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:[o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-full bg-delulu-violet/10 flex items-center justify-center text-lg",children:((ye=ae.fromDisplayName[0])==null?void 0:ye.toUpperCase())||"?"}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("p",{className:"font-semibold text-delulu-text truncate",children:ae.fromDisplayName}),o.jsxs("p",{className:"text-xs text-delulu-muted",children:["@",ae.fromUsername,"  Level ",ae.fromLevel]}),ae.message&&o.jsxs("p",{className:"text-sm text-delulu-text/70 mt-1 italic",children:['"',ae.message,'"']})]}),o.jsx("span",{className:"text-[10px] text-delulu-muted",children:ee(ae.createdAt)})]}),o.jsxs("div",{className:"flex gap-2 mt-3",children:[o.jsxs("button",{onClick:()=>X(ae.id),disabled:k===ae.id,className:"flex-1 py-2 rounded-xl bg-gray-100 text-gray-600 font-semibold text-sm flex items-center justify-center gap-2 disabled:opacity-50",children:[o.jsx(Rs,{size:16}),"Ablehnen"]}),o.jsxs("button",{onClick:()=>B(ae),disabled:k===ae.id,className:"flex-1 py-2 rounded-xl bg-delulu-violet text-white font-semibold text-sm flex items-center justify-center gap-2 disabled:opacity-50",children:[k===ae.id?o.jsx(Br,{size:16,className:"animate-spin"}):o.jsx(zn,{size:16}),"Annehmen"]})]})]},ae.id)})})]}),i!=="requests"&&o.jsxs("div",{className:"px-6 py-4",children:[i==="all"&&u.length>0&&o.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[o.jsx(Xc,{size:18,className:"text-delulu-violet"}),o.jsx("h2",{className:"font-display font-bold text-delulu-text",children:"Aktivitten"})]}),de.length===0?o.jsxs("div",{className:"text-center py-12",children:[o.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:o.jsx(Xc,{size:24,className:"text-gray-400"})}),o.jsx("p",{className:"font-semibold text-delulu-text mb-2",children:"Keine Benachrichtigungen"}),o.jsx("p",{className:"text-sm text-delulu-muted",children:"Neue Aktivitten erscheinen hier"})]}):o.jsx("div",{className:"space-y-2",children:de.map(ae=>o.jsxs("div",{onClick:()=>!ae.isRead&&Z(ae.id),className:`flex items-start gap-3 p-4 rounded-2xl transition-colors cursor-pointer ${ae.isRead?"bg-white hover:bg-gray-50":"bg-delulu-violet/5 hover:bg-delulu-violet/10"}`,children:[o.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${ae.isRead?"bg-gray-100":"bg-white shadow-sm"}`,children:V(ae.type)}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex items-start justify-between gap-2",children:[o.jsx("h3",{className:`text-sm ${ae.isRead?"text-delulu-text":"font-semibold text-delulu-text"}`,children:ae.title}),o.jsx("span",{className:"text-[10px] text-delulu-muted whitespace-nowrap",children:ee(ae.timestamp)})]}),o.jsx("p",{className:"text-xs text-delulu-muted mt-0.5 truncate",children:ae.message})]}),!ae.isRead&&o.jsx("div",{className:"w-2 h-2 rounded-full bg-delulu-violet mt-2"})]},ae.id))})]}),i==="requests"&&u.length===0&&o.jsxs("div",{className:"text-center py-12 px-6",children:[o.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:o.jsx(ep,{size:24,className:"text-gray-400"})}),o.jsx("h3",{className:"font-semibold text-delulu-text mb-2",children:"Keine Anfragen"}),o.jsx("p",{className:"text-sm text-delulu-muted",children:"Neue Freundschaftsanfragen erscheinen hier"})]})]})},yCe=()=>{const s=zr(),{language:n}=tl(),[i,l]=H.useState(!1),u=n==="de",p=[{icon:o.jsx(Ei,{size:20}),title:"1.5x XP Boost",titleEn:"1.5x XP Boost",description:"Verdiene 50% mehr XP bei jeder Aktivitt",descriptionEn:"Earn 50% more XP with every activity",isPremium:!0},{icon:o.jsx(Fs,{size:20}),title:"Unbegrenzte Sterne",titleEn:"Unlimited Stars",description:"Verschenke so viele Sterne wie du mchtest",descriptionEn:"Gift as many stars as you want",isPremium:!0},{icon:o.jsx(Ta,{size:20}),title:"Profilbesucher",titleEn:"Profile Visitors",description:"Sieh wer dein Profil besucht hat",descriptionEn:"See who visited your profile",isPremium:!0},{icon:o.jsx(li,{size:20}),title:"Erweiterte Privatsphre",titleEn:"Extended Privacy",description:"Unsichtbarer Modus & Lesebesttigungen kontrollieren",descriptionEn:"Invisible mode & control read receipts",isPremium:!0},{icon:o.jsx(rr,{size:20}),title:"Exklusive Lounges",titleEn:"Exclusive Lounges",description:"Zugang zu Premium-Only Voice Lounges",descriptionEn:"Access to Premium-Only Voice Lounges",isPremium:!0},{icon:o.jsx(hs,{size:20}),title:"Premium Badge",titleEn:"Premium Badge",description:"Zeige deinen Status mit einem goldenen Badge",descriptionEn:"Show your status with a golden badge",isPremium:!0},{icon:o.jsx(_c,{size:20}),title:"Erweiterter Suchradius",titleEn:"Extended Search Radius",description:"Finde Nutzer in bis zu 2km Entfernung",descriptionEn:"Find users up to 2km away",isPremium:!0},{icon:o.jsx(eh,{size:20}),title:"HD Sprachqualitt",titleEn:"HD Voice Quality",description:"Kristallklare Audioqualitt in Voice Chats",descriptionEn:"Crystal clear audio quality in voice chats",isPremium:!0}],g=()=>{l(!0),"vibrate"in navigator&&navigator.vibrate([30,20,50]),setTimeout(()=>{l(!1)},3e3)};return o.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-amber-50 via-orange-50 to-white safe-top safe-bottom pb-24",children:[o.jsxs("div",{className:"relative overflow-hidden",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-amber-400 via-orange-500 to-amber-500"}),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent"}),o.jsx("div",{className:"relative px-6 pt-4 pb-2 flex items-center justify-between",children:o.jsx("button",{onClick:()=>s(-1),className:"w-10 h-10 rounded-xl bg-white/20 flex items-center justify-center text-white hover:bg-white/30 transition-colors",children:o.jsx(sa,{size:20})})}),o.jsxs("div",{className:"relative px-6 pt-4 pb-12 text-white text-center",children:[o.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-3xl bg-white/20 backdrop-blur flex items-center justify-center",children:o.jsx(hs,{size:40,className:"text-white"})}),o.jsx("h1",{className:"font-display text-3xl font-bold mb-2",children:"Catalyst Premium"}),o.jsx("p",{className:"text-white/80 text-sm max-w-xs mx-auto",children:u?"Entfessle dein volles Potenzial mit exklusiven Features":"Unleash your full potential with exclusive features"}),o.jsx("div",{className:"absolute top-8 left-8 w-3 h-3 bg-white/30 rounded-full animate-ping"}),o.jsx("div",{className:"absolute top-16 right-12 w-2 h-2 bg-white/20 rounded-full animate-bounce"})]})]}),o.jsx("div",{className:"px-6 -mt-6 mb-6",children:o.jsxs("div",{className:"bg-white rounded-3xl shadow-xl p-6 text-center",children:[o.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-orange-100 to-amber-100 flex items-center justify-center",children:o.jsx(CRe,{size:36,className:"text-amber-600"})}),o.jsx("h2",{className:"font-display font-bold text-xl text-gray-900 mb-2",children:u?"Wartungsarbeiten":"Under Maintenance"}),o.jsx("p",{className:"text-gray-500 text-sm mb-6 max-w-xs mx-auto",children:u?"Wir arbeiten an etwas Groartigem! Premium kommt bald zurck mit noch besseren Features.":"We're working on something great! Premium is coming back soon with even better features."}),o.jsx("div",{className:"mb-6",children:o.jsx(Ju,{delay:0,children:o.jsx(zF,{size:120,className:"mx-auto"})})}),i?o.jsxs("div",{className:"py-4 bg-green-100 text-green-700 font-semibold rounded-2xl flex items-center justify-center gap-2",children:[o.jsx(zn,{size:20}),u?"Du wirst benachrichtigt!":"You'll be notified!"]}):o.jsxs("button",{onClick:g,className:"w-full py-4 bg-gradient-to-r from-amber-400 to-orange-500 text-white font-bold rounded-2xl shadow-lg flex items-center justify-center gap-2 hover:shadow-xl transition-all",children:[o.jsx(Xc,{size:20}),u?"Benachrichtigen wenn verfgbar":"Notify me when available"]}),o.jsx("p",{className:"text-xs text-gray-400 mt-4",children:u?"Vielen Dank fr deine Geduld ":"Thank you for your patience "})]})}),o.jsxs("div",{className:"px-6 mb-6",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[o.jsx(wr,{size:20,className:"text-amber-500"}),o.jsx("h2",{className:"font-display font-bold text-lg text-gray-900",children:u?"Geplante Features":"Upcoming Features"})]}),o.jsx("div",{className:"space-y-3",children:p.map((y,x)=>o.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm flex items-center gap-4",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-amber-100 to-orange-100 flex items-center justify-center text-amber-600 flex-shrink-0",children:y.icon}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"font-semibold text-gray-900 text-sm",children:u?y.title:y.titleEn}),o.jsx("p",{className:"text-xs text-gray-500",children:u?y.description:y.descriptionEn})]}),o.jsx("div",{className:"w-6 h-6 rounded-full bg-amber-100 flex items-center justify-center flex-shrink-0",children:o.jsx(hs,{size:12,className:"text-amber-600"})})]},x))})]}),o.jsx("div",{className:"px-6 pb-8",children:o.jsxs("div",{className:"bg-gradient-to-br from-violet-100 to-purple-100 rounded-2xl p-5 text-center",children:[o.jsx("p",{className:"font-semibold text-violet-700 mb-1",children:u?" Bald verfgbar":" Coming Soon"}),o.jsx("p",{className:"text-sm text-violet-600/80",children:u?"Apple Pay  Google Pay  Kreditkarte":"Apple Pay  Google Pay  Credit Card"})]})})]})},bCe=async(s,n)=>{try{const i=at(Me,"presence",s);await Kn(i,{isIncognito:n});const l=at(Me,"users",s);await Kn(l,{isIncognito:n})}catch(i){console.error("Error setting incognito mode:",i)}},xCe=()=>{const{user:s}=mr(),[n,i]=H.useState({isIncognito:!1,showOnlineStatus:!0,showProfileVisitors:!0,allowProfileVisits:!0,showLastSeen:!0,notifyOnVisit:!0}),[l,u]=H.useState(!0),[p,g]=H.useState(null);H.useEffect(()=>{if(!(s!=null&&s.id))return;(async()=>{try{const k=await fr(at(Me,"users",s.id));if(k.exists()){const A=k.data();i({isIncognito:A.isIncognito||!1,showOnlineStatus:A.showOnlineStatus!==!1,showProfileVisitors:A.showProfileVisitors!==!1,allowProfileVisits:A.allowProfileVisits!==!1,showLastSeen:A.showLastSeen!==!1,notifyOnVisit:A.notifyOnVisit!==!1})}}catch(k){console.error("Error loading privacy settings:",k)}finally{u(!1)}})()},[s==null?void 0:s.id]);const y=async C=>{if(!(s!=null&&s.id))return;const k=!n[C];g(C);try{C==="isIncognito"&&await bCe(s.id,k),await Kn(at(Me,"users",s.id),{[C]:k}),i(A=>({...A,[C]:k}))}catch(A){console.error("Error updating setting:",A)}finally{g(null)}},x=[{id:"isIncognito",title:"Inkognito-Modus",description:"Besuche Profile unsichtbar. Andere sehen dich nicht.",icon:o.jsx(xJ,{size:20,className:"text-purple-500"})},{id:"showOnlineStatus",title:"Online-Status anzeigen",description:"Andere knnen sehen, wenn du online bist.",icon:o.jsx(Ta,{size:20,className:"text-green-500"})},{id:"showProfileVisitors",title:"Profilbesucher anzeigen",description:"Sieh, wer dein Profil besucht hat.",icon:o.jsx(rr,{size:20,className:"text-blue-500"})},{id:"allowProfileVisits",title:"Besuche erlauben",description:"Erlaube anderen, dass sie in deinen Besuchern erscheinen.",icon:o.jsx(li,{size:20,className:"text-violet-500"})},{id:"showLastSeen",title:'"Zuletzt gesehen" anzeigen',description:"Zeige an, wann du zuletzt aktiv warst.",icon:o.jsx($c,{size:20,className:"text-gray-500"})},{id:"notifyOnVisit",title:"Bei Besuch benachrichtigen",description:"Erhalte eine Benachrichtigung bei Profilbesuchern.",icon:o.jsx(Xc,{size:20,className:"text-amber-500"})}];return l?o.jsx("div",{className:"p-6 flex items-center justify-center",children:o.jsx("div",{className:"w-8 h-8 border-2 border-purple-200 border-t-purple-500 rounded-full animate-spin"})}):o.jsxs("div",{className:"space-y-4",children:[n.isIncognito&&o.jsxs("div",{className:"bg-gradient-to-r from-purple-500/10 to-violet-500/10 rounded-2xl p-4 flex items-center gap-3 border border-purple-200",children:[o.jsx("div",{className:"w-10 h-10 bg-purple-500 rounded-xl flex items-center justify-center",children:o.jsx(xJ,{size:20,className:"text-white"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h4",{className:"font-semibold text-purple-900",children:"Inkognito aktiv"}),o.jsx("p",{className:"text-sm text-purple-600",children:"Du bist unsichtbar unterwegs"})]}),o.jsx(wr,{size:20,className:"text-purple-400"})]}),o.jsx("div",{className:"bg-white rounded-2xl overflow-hidden divide-y divide-gray-100",children:x.map(C=>o.jsxs("div",{className:"p-4 flex items-center gap-4",children:[o.jsx("div",{className:"w-10 h-10 bg-gray-50 rounded-xl flex items-center justify-center",children:C.icon}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("h4",{className:"font-medium text-gray-900",children:C.title}),C.isPremium&&o.jsx("span",{className:"px-2 py-0.5 bg-amber-100 text-amber-600 text-xs font-medium rounded-full",children:"Premium"})]}),o.jsx("p",{className:"text-sm text-gray-500",children:C.description})]}),o.jsx("button",{onClick:()=>y(C.id),disabled:p===C.id,className:`relative w-14 h-8 rounded-full transition-all duration-300 ${n[C.id]?"bg-purple-500":"bg-gray-200"}`,children:o.jsx("div",{className:`absolute top-1 w-6 h-6 bg-white rounded-full shadow-sm transition-all duration-300 flex items-center justify-center ${n[C.id]?"left-7":"left-1"}`,children:p===C.id?o.jsx("div",{className:"w-3 h-3 border-2 border-purple-300 border-t-purple-600 rounded-full animate-spin"}):n[C.id]?o.jsx(zn,{size:12,className:"text-purple-500"}):null})})]},C.id))}),o.jsx("p",{className:"text-xs text-gray-400 text-center px-4",children:"Deine Privatsphre ist uns wichtig. Diese Einstellungen gelten sofort."})]})},I4=[{version:"v1.4",date:"31. Januar 2026",title:"The Awakening Update",titleDE:"Das Erwachen",emoji:"",color:"#A78BFA",features:[{icon:Ta,title:"Besucher-Tracking",description:"Sieh, wer einen Blick in deine Wolke geworfen hat",isNew:!0},{icon:Fs,title:"Sterne-Rating",description:"Bewerte andere nach Voice-Chats mit 1-5 Sternen",isNew:!0},{icon:rr,title:"200 Beta-Pltze",description:"Exklusiver Zugang  der Countdown luft!",isNew:!0},{icon:li,title:"Inkognito-Modus",description:"Besuche Profile unsichtbar",isPremium:!0},{icon:Ei,title:"Online-Status",description:"Sanft leuchtender Indikator am Profilbild",isNew:!0}]},{version:"v1.3",date:"20. Januar 2026",title:"Dream Pass Beta",titleDE:"Traum-Pass Beta",emoji:"",color:"#F472B6",features:[{icon:hs,title:"Dream Pass System",description:"100 Level mit exklusiven Belohnungen"},{icon:ra,title:"Creator Dashboard",description:"Verwalte deine Secret Bubbles"},{icon:rr,title:"5-Freunde-System",description:"Premium gratis durch Einladungen"}]},{version:"v1.2",date:"10. Januar 2026",title:"Social Vibes",titleDE:"Soziale Vibes",emoji:"",color:"#60A5FA",features:[{icon:Xc,title:"Benachrichtigungen",description:"Push-Notifications fr wichtige Events"},{icon:Gi,title:"Streak-System",description:"Tgliche Aktivitt wird belohnt"}]}],wCe=({isOpen:s,onClose:n})=>{const[i,l]=H.useState(0),[u,p]=H.useState(!1);if(H.useEffect(()=>{if(s){const y=localStorage.getItem("delulu_seen_updates")||"",x=I4[0].version;y.includes(x)||localStorage.setItem("delulu_seen_updates",y+x),p(!0)}},[s]),!s)return null;const g=I4[i];return o.jsxs("div",{className:"fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4",children:[o.jsxs("div",{className:"bg-gray-900 rounded-3xl w-full max-w-md max-h-[85vh] overflow-hidden flex flex-col animate-scale-in",style:{boxShadow:`0 0 60px ${g.color}30`},children:[o.jsxs("div",{className:"relative p-6 pb-8",style:{background:`linear-gradient(135deg, ${g.color}20 0%, transparent 100%)`},children:[o.jsx("button",{onClick:n,className:"absolute top-4 right-4 w-10 h-10 bg-white/10 rounded-full flex items-center justify-center",children:o.jsx(Rs,{size:20,className:"text-white"})}),o.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[o.jsx("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center text-2xl",style:{background:`${g.color}30`},children:g.emoji}),o.jsxs("div",{children:[o.jsx("p",{className:"text-sm text-white/60",children:"Was gibt's Neues?"}),o.jsx("h2",{className:"text-2xl font-bold text-white",children:g.titleDE})]})]}),o.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 hide-scrollbar",children:I4.map((y,x)=>o.jsxs("button",{onClick:()=>l(x),className:`px-4 py-2 rounded-full text-sm font-semibold whitespace-nowrap transition-all ${i===x?"text-white":"bg-white/10 text-white/60"}`,style:{background:i===x?y.color:void 0},children:[y.version,x===0&&o.jsx("span",{className:"ml-2 text-xs",children:"NEU"})]},y.version))})]}),o.jsxs("div",{className:"flex-1 overflow-y-auto p-6 pt-0",children:[o.jsx("p",{className:"text-sm text-white/50 mb-4",children:g.date}),o.jsx("div",{className:"space-y-4",children:g.features.map((y,x)=>o.jsxs("div",{className:"flex items-start gap-4 p-4 bg-white/5 rounded-2xl hover:bg-white/10 transition-colors",children:[o.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0",style:{background:`${g.color}20`},children:o.jsx(y.icon,{size:24,style:{color:g.color}})}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.jsx("h3",{className:"font-semibold text-white",children:y.title}),y.isNew&&o.jsx("span",{className:"px-2 py-0.5 bg-green-500/20 text-green-400 text-xs font-bold rounded-full",children:"NEU"}),y.isPremium&&o.jsxs("span",{className:"px-2 py-0.5 bg-amber-500/20 text-amber-400 text-xs font-bold rounded-full flex items-center gap-1",children:[o.jsx(hs,{size:10}),"PREMIUM"]})]}),o.jsx("p",{className:"text-sm text-white/60",children:y.description})]})]},x))})]}),o.jsxs("div",{className:"p-6 pt-0",children:[o.jsx("div",{className:"p-4 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-2xl border border-purple-500/20 mb-4",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(gRe,{size:24,className:"text-purple-400"}),o.jsxs("div",{children:[o.jsx("p",{className:"text-sm font-semibold text-white",children:"Dream Pass Beta"}),o.jsx("p",{className:"text-xs text-white/60",children:"Startet im Mrz 2026  Sammle jetzt schon XP!"})]})]})}),o.jsxs("button",{onClick:n,className:"w-full py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold rounded-xl flex items-center justify-center gap-2",children:[o.jsx(wr,{size:20}),"Los geht's!"]})]})]}),o.jsx("style",{children:`
        @keyframes scale-in {
          from { transform: scale(0.9); opacity: 0; }
          to { transform: scale(1); opacity: 1; }
        }
        .animate-scale-in { animation: scale-in 0.3s ease-out; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      `})]})},A4=[{id:"harassment",label:"Belstigung",icon:o.jsx(ql,{size:16})},{id:"spam",label:"Spam / Werbung",icon:o.jsx(V_,{size:16})},{id:"inappropriate",label:"Unangemessenes Verhalten",icon:o.jsx(Nre,{size:16})},{id:"personal",label:"Persnliche Grnde",icon:o.jsx(tp,{size:16})},{id:"other",label:"Sonstiges",icon:o.jsx(Rre,{size:16})}],SCe=[{id:"b1",username:"toxic_user",displayName:"Toxic Person",blockedAt:new Date(Date.now()-7*24*60*60*1e3),reason:"harassment"},{id:"b2",username:"spammer99",displayName:"Spam Bot",blockedAt:new Date(Date.now()-30*24*60*60*1e3),reason:"spam"}],jJ=()=>{const s=zr(),{user:n,isVerifiedStar:i}=mr(),{language:l,setLanguage:u}=tl(),{logout:p}=TT(),[g,y]=H.useState(null),[x,C]=H.useState((n==null?void 0:n.isGlobalAnonymous)||!1),[k,A]=H.useState(!0),[M,G]=H.useState(!0),[B,X]=H.useState(!0),[Z,q]=H.useState(!0),[V,ee]=H.useState(!0),[de,ae]=H.useState(!0),[ye,Q]=H.useState(!0),[$,se]=H.useState(SCe),[ce,he]=H.useState(null),[ve,ge]=H.useState(!1),[qe,Dt]=H.useState(!1),[gt,Ye]=H.useState(""),[ze,ut]=H.useState(!1),[yt,Xt]=H.useState(!1),[jt,Gt]=H.useState(""),[mn,Pt]=H.useState(""),[Jt,He]=H.useState(!1),bt=(n==null?void 0:n.totalStarsReceived)||0,Wt=(n==null?void 0:n.level)||1,gn=(n==null?void 0:n.totalVoiceMinutes)||0,xt=(n==null?void 0:n.positiveRatings)||0,Sn=(n==null?void 0:n.totalRatings)||1,cr=Math.round(xt/Sn*100),Or={stars:Math.min(100,bt/Js.starsRequired*100),level:Math.min(100,Wt/Js.levelRequired*100),voice:Math.min(100,gn/Js.voiceMinutesRequired*100),ratings:Math.min(100,cr/Js.minPositiveRatings*100)},ms=bt>=Js.starsRequired&&Wt>=Js.levelRequired&&gn>=Js.voiceMinutesRequired&&cr>=Js.minPositiveRatings,Oi=Ht=>zc[Ht].native,xi=Ht=>{se(wi=>wi.filter(Cs=>Cs.id!==Ht)),he(null),"vibrate"in navigator&&navigator.vibrate(10)},Gr=async()=>{if(n!=null&&n.id){Xt(!0),Gt("");try{const Ht=at(Me,"users",n.id);await Kn(Ht,{isPaused:!0,pausedAt:Uo(),isActive:!1}),await p(),ge(!1),s("/welcome")}catch(Ht){console.error("Error pausing account:",Ht),Gt("Fehler beim Pausieren. Bitte versuche es erneut.")}finally{Xt(!1)}}},qt=async()=>{if(gt.toLowerCase()==="lschen"&&!(!(n!=null&&n.id)||!Fi.currentUser)){ut(!0),Pt("");try{const Ht=Fi.currentUser,wi=at(Me,"users",n.id);await Ga(wi);try{await g$(Ht)}catch(Cs){if(Cs.code==="auth/requires-recent-login")if(Ht.providerData.some(es=>es.providerId==="google.com"))try{const es=new Bd;await tye(Ht,es),await g$(Ht)}catch{throw new Error("Bitte melde dich erneut an und versuche es dann nochmal.")}else throw new Error("Bitte melde dich erneut an und versuche es dann nochmal.");else throw Cs}await p(),Dt(!1),s("/welcome")}catch(Ht){console.error("Error deleting account:",Ht),Pt(Ht.message||"Fehler beim Lschen. Bitte versuche es erneut.")}finally{ut(!1)}}},Jr=Ht=>Ht.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"});return o.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white safe-top safe-bottom pb-24",children:[o.jsx("div",{className:"sticky top-0 z-20 bg-white/90 backdrop-blur-lg border-b border-gray-100",children:o.jsxs("div",{className:"px-6 py-4 flex items-center gap-4",children:[o.jsx("button",{onClick:()=>g?y(null):s(-1),className:"w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-delulu-muted hover:bg-gray-200 transition-colors",children:o.jsx(sa,{size:20})}),o.jsx("div",{className:"flex-1",children:o.jsxs("h1",{className:"font-display text-xl font-bold text-delulu-text",children:[g==="account"&&"Account",g==="privacy"&&"Privatsphre",g==="notifications"&&"Benachrichtigungen",g==="blocked"&&"Blockierte User",g==="danger"&&"Account-Einstellungen",g==="language"&&"Sprache",g==="creator"&&"Creator werden",g==="legal"&&"Rechtliches",!g&&"Einstellungen"]})})]})}),!g&&o.jsxs("div",{className:"px-6 py-4 space-y-4",children:[o.jsx("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:o.jsxs("button",{onClick:()=>s("/profile"),className:"w-full flex items-center gap-4 p-4 hover:bg-gray-50 transition-colors",children:[o.jsx("div",{className:"w-14 h-14 rounded-2xl bg-delulu-violet/10 flex items-center justify-center",children:n!=null&&n.avatarUrl?o.jsx("img",{src:n.avatarUrl,alt:"",className:"w-full h-full rounded-2xl object-cover"}):o.jsx(tp,{size:24,className:"text-delulu-violet"})}),o.jsxs("div",{className:"flex-1 text-left",children:[o.jsx("h3",{className:"font-semibold text-delulu-text",children:(n==null?void 0:n.displayName)||"Dein Profil"}),o.jsxs("p",{className:"text-sm text-delulu-muted",children:["@",(n==null?void 0:n.username)||"username"]})]}),o.jsx(As,{size:20,className:"text-delulu-muted"})]})}),o.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden divide-y divide-gray-100",children:[o.jsx(Md,{icon:o.jsx(Hi,{size:20}),label:"Account & Sicherheit",sublabel:"Passwort, E-Mail",onClick:()=>y("account")}),o.jsx(Md,{icon:o.jsx(li,{size:20}),label:"Privatsphre",sublabel:"Anonymitt, Sichtbarkeit",onClick:()=>y("privacy")}),o.jsx(Md,{icon:o.jsx(Xc,{size:20}),label:"Benachrichtigungen",sublabel:"Push, Sound, Filter",onClick:()=>y("notifications")}),o.jsx(Md,{icon:o.jsx(dk,{size:20}),label:"Blockierte User",sublabel:`${$.length} blockiert`,onClick:()=>y("blocked")})]}),!(n!=null&&n.isPremium)&&o.jsx("button",{onClick:()=>s("/premium"),className:"w-full bg-gradient-to-r from-amber-400 to-orange-500 rounded-2xl p-4 text-white text-left",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(hs,{size:24}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"font-semibold",children:"Catalyst Premium"}),o.jsx("p",{className:"text-sm text-white/80",children:"1.5x XP,  Sterne & mehr"})]}),o.jsx(As,{size:20})]})}),!i&&o.jsx("button",{onClick:()=>y("creator"),className:"w-full bg-gradient-to-r from-purple-500/10 to-pink-500/10 border border-purple-500/30 rounded-2xl p-4 text-left",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center",children:o.jsx(wr,{size:24,className:"text-white"})}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("h3",{className:"font-semibold text-delulu-text",children:"Creator werden"}),ms&&o.jsx("span",{className:"px-1.5 py-0.5 bg-green-100 rounded text-[10px] font-bold text-green-600",children:" Berechtigt"})]}),o.jsx("p",{className:"text-xs text-delulu-muted",children:ms?"Jetzt bewerben!":"Dein Fortschritt zum Stars Programm"})]}),o.jsx(As,{size:20,className:"text-delulu-muted"})]})}),i&&o.jsx("button",{onClick:()=>s("/stars/dashboard"),className:"w-full bg-gradient-to-r from-amber-500/20 to-orange-500/20 border border-amber-500/30 rounded-2xl p-4 text-left",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center",children:o.jsx(lk,{size:24,className:"text-white"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"font-semibold text-delulu-text",children:"Star Dashboard"}),o.jsx("p",{className:"text-xs text-delulu-muted",children:"Analytics, Events & mehr"})]}),o.jsx(As,{size:20,className:"text-delulu-muted"})]})}),o.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden divide-y divide-gray-100",children:[o.jsx(Md,{icon:o.jsx(RT,{size:20}),label:"Hilfe & FAQ",onClick:()=>s("/help")}),o.jsx(Md,{icon:o.jsx(wr,{size:20}),label:"Was gibt's Neues?",sublabel:"v1.4 - Delulu OS Update",onClick:()=>He(!0)}),o.jsx(Md,{icon:o.jsx(D_,{size:20}),label:"Sprache",sublabel:Oi(l),onClick:()=>y("language")}),o.jsx(Md,{icon:o.jsx(ck,{size:20}),label:"Rechtliches",sublabel:"Impressum & Datenschutz",onClick:()=>y("legal")})]}),o.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden divide-y divide-gray-100",children:[o.jsx(Md,{icon:o.jsx(N4,{size:20,className:"text-amber-500"}),label:"Account pausieren",sublabel:"Temporr deaktivieren",onClick:()=>ge(!0),dangerous:!0}),o.jsx(Md,{icon:o.jsx(Jh,{size:20,className:"text-red-500"}),label:"Account lschen",sublabel:"Unwiderruflich",onClick:()=>Dt(!0),dangerous:!0})]}),o.jsxs("button",{onClick:async()=>{await p(),s("/welcome")},className:"w-full flex items-center justify-center gap-2 py-4 text-red-500 font-semibold",children:[o.jsx(hO,{size:20}),"Abmelden"]})]}),g==="account"&&o.jsxs("div",{className:"px-6 py-4 space-y-4",children:[o.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden divide-y divide-gray-100",children:[o.jsx(Md,{icon:o.jsx(Hi,{size:20}),label:"Passwort ndern",onClick:()=>s("/login",{state:{showForgotPassword:!0}})}),o.jsxs("div",{className:"p-4",children:[o.jsx("label",{className:"text-sm text-delulu-muted",children:"E-Mail Adresse"}),o.jsx("p",{className:"font-medium text-delulu-text mt-1",children:(n==null?void 0:n.email)||"user@example.com"})]})]}),o.jsx("div",{className:"p-4 bg-blue-50 rounded-2xl",children:o.jsxs("p",{className:"text-sm text-blue-700",children:[o.jsx("strong",{children:"Tipp:"})," Verwende ein starkes Passwort mit mindestens 12 Zeichen, Gro- und Kleinbuchstaben, Zahlen und Sonderzeichen."]})})]}),g==="privacy"&&o.jsx("div",{className:"px-6 py-4",children:o.jsx(xCe,{})}),g==="notifications"&&o.jsxs("div",{className:"px-6 py-4 space-y-4",children:[o.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden divide-y divide-gray-100",children:[o.jsx(Fw,{icon:o.jsx(Xc,{size:20}),label:"Push-Benachrichtigungen",sublabel:"Erhalte Benachrichtigungen auf dein Gert",value:B,onChange:X}),o.jsx(Fw,{icon:o.jsx(pO,{size:20}),label:"Sounds",sublabel:"Tne bei Benachrichtigungen",value:Z,onChange:q})]}),o.jsx("h3",{className:"font-semibold text-delulu-text px-1",children:"Benachrichtige mich bei:"}),o.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden divide-y divide-gray-100",children:[o.jsx(Fw,{icon:o.jsx(Fs,{size:20,className:"text-amber-500"}),label:"Sterne erhalten",value:V,onChange:ee}),o.jsx(Fw,{icon:o.jsx(tp,{size:20,className:"text-blue-500"}),label:"Neue Follower & Anfragen",value:de,onChange:ae}),o.jsx(Fw,{icon:o.jsx(lk,{size:20,className:"text-purple-500"}),label:"Star geht live",sublabel:"Benachrichtigung wenn Stars Events starten",value:ye,onChange:Q})]})]}),g==="blocked"&&o.jsxs("div",{className:"px-6 py-4",children:[$.length===0?o.jsxs("div",{className:"text-center py-12",children:[o.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:o.jsx(dk,{size:24,className:"text-gray-400"})}),o.jsx("h3",{className:"font-semibold text-delulu-text mb-2",children:"Keine blockierten User"}),o.jsx("p",{className:"text-sm text-delulu-muted",children:"User, die du blockierst, erscheinen hier"})]}):o.jsx("div",{className:"space-y-3",children:$.map(Ht=>{var wi,Cs;return o.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:[o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-xl bg-gray-200 flex items-center justify-center",children:o.jsx(tp,{size:20,className:"text-gray-500"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"font-semibold text-delulu-text",children:Ht.displayName}),o.jsxs("p",{className:"text-sm text-delulu-muted",children:["@",Ht.username]}),o.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[o.jsxs("span",{className:"text-xs px-2 py-0.5 bg-red-100 text-red-600 rounded-full flex items-center gap-1",children:[(wi=A4.find(gr=>gr.id===Ht.reason))==null?void 0:wi.icon,(Cs=A4.find(gr=>gr.id===Ht.reason))==null?void 0:Cs.label]}),o.jsx("span",{className:"text-xs text-delulu-muted",children:Jr(Ht.blockedAt)})]})]})]}),ce===Ht.id?o.jsxs("div",{className:"mt-4 flex gap-2",children:[o.jsx("button",{onClick:()=>xi(Ht.id),className:"flex-1 py-2 px-4 bg-green-500 text-white rounded-xl font-semibold text-sm",children:"Ja, entblocken"}),o.jsx("button",{onClick:()=>he(null),className:"flex-1 py-2 px-4 bg-gray-100 text-gray-600 rounded-xl font-semibold text-sm",children:"Abbrechen"})]}):o.jsx("button",{onClick:()=>he(Ht.id),className:"mt-4 w-full py-2 px-4 bg-gray-100 text-gray-600 rounded-xl font-semibold text-sm hover:bg-gray-200 transition-colors",children:"Entblocken"})]},Ht.id)})}),o.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-2xl",children:[o.jsxs("h4",{className:"font-semibold text-delulu-text mb-3 flex items-center gap-2",children:[o.jsx(Rre,{size:16}),"Block-Grnde"]}),o.jsx("div",{className:"space-y-2",children:A4.map(Ht=>o.jsxs("div",{className:"flex items-center gap-2 text-sm text-delulu-muted",children:[Ht.icon,o.jsx("span",{children:Ht.label})]},Ht.id))})]})]}),g==="language"&&o.jsxs("div",{className:"px-6 py-4 space-y-4",children:[o.jsx("p",{className:"text-sm text-delulu-muted",children:"Whle deine bevorzugte Sprache. Die App wird sofort in der gewhlten Sprache angezeigt."}),o.jsx("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden divide-y divide-gray-100",children:Object.keys(zc).map(Ht=>o.jsxs("button",{onClick:()=>u(Ht),className:"w-full flex items-center gap-4 p-4 hover:bg-gray-50 transition-colors text-left",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-delulu-violet/10 flex items-center justify-center text-lg",children:zc[Ht].flag}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"font-semibold text-delulu-text",children:zc[Ht].native}),o.jsx("p",{className:"text-xs text-delulu-muted",children:zc[Ht].name})]}),l===Ht&&o.jsx(zn,{size:20,className:"text-green-500"})]},Ht))})]}),g==="creator"&&o.jsxs("div",{className:"px-6 py-4 space-y-4",children:[ms?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"p-4 bg-green-50 rounded-2xl flex items-start gap-3",children:[o.jsx(Vu,{size:24,className:"text-green-600 flex-shrink-0"}),o.jsxs("div",{children:[o.jsx("p",{className:"font-semibold text-green-800",children:"Du bist berechtigt!"}),o.jsx("p",{className:"text-sm text-green-700 mt-1",children:"Du erfllst alle Anforderungen und kannst dich jetzt als Creator bewerben."})]})]}),o.jsxs("button",{onClick:()=>s("/stars/apply"),className:"w-full py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl font-semibold flex items-center justify-center gap-2",children:[o.jsx(wr,{size:20}),"Jetzt als Creator bewerben"]})]}):o.jsxs(o.Fragment,{children:[o.jsx("p",{className:"text-sm text-delulu-muted",children:"Erflle die folgenden Anforderungen, um dich als Creator zu bewerben:"}),o.jsxs("div",{className:"bg-white rounded-2xl shadow-sm p-4 space-y-4",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[o.jsxs("span",{className:"flex items-center gap-2 text-delulu-muted",children:[o.jsx(Fs,{size:16,className:"text-amber-500"}),"Sterne erhalten"]}),o.jsxs("span",{className:bt>=Js.starsRequired?"text-green-500 font-medium":"text-delulu-muted",children:[bt," / ",Js.starsRequired]})]}),o.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:o.jsx("div",{className:`h-full rounded-full transition-all ${bt>=Js.starsRequired?"bg-green-500":"bg-amber-400"}`,style:{width:`${Or.stars}%`}})})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[o.jsxs("span",{className:"flex items-center gap-2 text-delulu-muted",children:[o.jsx(im,{size:16,className:"text-purple-500"}),"Level"]}),o.jsxs("span",{className:Wt>=Js.levelRequired?"text-green-500 font-medium":"text-delulu-muted",children:[Wt," / ",Js.levelRequired]})]}),o.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:o.jsx("div",{className:`h-full rounded-full transition-all ${Wt>=Js.levelRequired?"bg-green-500":"bg-purple-400"}`,style:{width:`${Or.level}%`}})})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[o.jsxs("span",{className:"flex items-center gap-2 text-delulu-muted",children:[o.jsx(Gi,{size:16,className:"text-blue-500"}),"Voice-Minuten"]}),o.jsxs("span",{className:gn>=Js.voiceMinutesRequired?"text-green-500 font-medium":"text-delulu-muted",children:[gn," / ",Js.voiceMinutesRequired]})]}),o.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:o.jsx("div",{className:`h-full rounded-full transition-all ${gn>=Js.voiceMinutesRequired?"bg-green-500":"bg-blue-400"}`,style:{width:`${Or.voice}%`}})})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[o.jsxs("span",{className:"flex items-center gap-2 text-delulu-muted",children:[o.jsx(rr,{size:16,className:"text-green-500"}),"Positive Bewertungen"]}),o.jsxs("span",{className:cr>=Js.minPositiveRatings?"text-green-500 font-medium":"text-delulu-muted",children:[cr,"% / ",Js.minPositiveRatings,"%"]})]}),o.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:o.jsx("div",{className:`h-full rounded-full transition-all ${cr>=Js.minPositiveRatings?"bg-green-500":"bg-green-400"}`,style:{width:`${Or.ratings}%`}})})]})]}),o.jsx("div",{className:"p-4 bg-purple-50 rounded-2xl",children:o.jsxs("p",{className:"text-sm text-purple-800",children:[o.jsx("strong",{children:"Tipp:"})," Sei aktiv in Voice-Rumen, sammle Sterne von anderen Nutzern und erreiche ein hohes Level durch regelmige Nutzung!"]})})]}),o.jsxs("div",{className:"pt-4 border-t border-gray-200",children:[o.jsx("p",{className:"text-sm text-delulu-muted mb-3",children:"Oder bewerbe dich als Influencer/VIP, wenn du bereits eine Fangemeinde hast:"}),o.jsx("button",{onClick:()=>s("/stars/apply"),className:"w-full py-3 border-2 border-purple-300 text-purple-600 rounded-xl font-semibold",children:"Als Influencer bewerben "})]})]}),g==="legal"&&o.jsxs("div",{className:"px-6 py-4 space-y-4",children:[o.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden divide-y divide-gray-100",children:[o.jsxs("button",{onClick:()=>s("/impressum"),className:"w-full flex items-center gap-4 p-4 hover:bg-gray-50 transition-colors text-left",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-delulu-violet/10 flex items-center justify-center",children:o.jsx(ck,{size:20,className:"text-delulu-violet"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"font-semibold text-delulu-text",children:"Impressum"}),o.jsx("p",{className:"text-sm text-delulu-muted",children:"Anbieterinformationen"})]}),o.jsx(As,{size:20,className:"text-delulu-muted"})]}),o.jsxs("button",{onClick:()=>s("/datenschutz"),className:"w-full flex items-center gap-4 p-4 hover:bg-gray-50 transition-colors text-left",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-delulu-violet/10 flex items-center justify-center",children:o.jsx(li,{size:20,className:"text-delulu-violet"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"font-semibold text-delulu-text",children:"Datenschutz"}),o.jsx("p",{className:"text-sm text-delulu-muted",children:"Datenschutzerklrung"})]}),o.jsx(As,{size:20,className:"text-delulu-muted"})]})]}),o.jsx("div",{className:"p-4 bg-gray-50 rounded-2xl text-center",children:o.jsxs("p",{className:"text-sm text-delulu-muted",children:["delulu App v1.0.0",o.jsx("br",{})," 2025 Butterbread UG"]})})]}),ve&&o.jsx(MJ,{onClose:()=>!yt&&ge(!1),children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"w-16 h-16 bg-amber-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:o.jsx(N4,{size:32,className:"text-amber-600"})}),o.jsx("h2",{className:"font-display text-xl font-bold text-delulu-text mb-2",children:"Account pausieren?"}),o.jsx("p",{className:"text-sm text-delulu-muted mb-6",children:"Dein Profil wird fr andere unsichtbar. Du kannst jederzeit zurckkehren und all deine Daten bleiben erhalten."}),jt&&o.jsx("p",{className:"text-red-500 text-sm mb-4",children:jt}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:()=>ge(!1),disabled:yt,className:"flex-1 py-3 px-4 bg-gray-100 text-gray-600 rounded-xl font-semibold disabled:opacity-50",children:"Abbrechen"}),o.jsx("button",{onClick:Gr,disabled:yt,className:"flex-1 py-3 px-4 bg-amber-500 text-white rounded-xl font-semibold disabled:opacity-50 flex items-center justify-center gap-2",children:yt?o.jsx(Br,{size:18,className:"animate-spin"}):o.jsxs(o.Fragment,{children:[o.jsx(N4,{size:18}),"Pausieren"]})})]})]})}),qe&&o.jsx(MJ,{onClose:()=>Dt(!1),children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:o.jsx(Jh,{size:32,className:"text-red-600"})}),o.jsx("h2",{className:"font-display text-xl font-bold text-delulu-text mb-2",children:"Account unwiderruflich lschen?"}),o.jsx("p",{className:"text-sm text-delulu-muted mb-6",children:"Alle deine Daten, Freundschaften, Sterne und XP werden permanent gelscht. Diese Aktion kann nicht rckgngig gemacht werden."}),o.jsxs("div",{className:"mb-6",children:[o.jsx("label",{className:"text-sm text-delulu-muted block mb-2",children:'Tippe "LSCHEN" zur Besttigung:'}),o.jsx("input",{type:"text",value:gt,onChange:Ht=>Ye(Ht.target.value),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-red-500 focus:outline-none text-center font-mono",placeholder:"LSCHEN"})]}),mn&&o.jsx("p",{className:"text-red-500 text-sm mb-4",children:mn}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:()=>Dt(!1),className:"flex-1 py-3 px-4 bg-gray-100 text-gray-600 rounded-xl font-semibold",children:"Abbrechen"}),o.jsx("button",{onClick:qt,disabled:gt.toLowerCase()!=="lschen"||ze,className:"flex-1 py-3 px-4 bg-red-500 text-white rounded-xl font-semibold disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:ze?o.jsx(Br,{size:18,className:"animate-spin"}):o.jsxs(o.Fragment,{children:[o.jsx(Jh,{size:18}),"Lschen"]})})]})]})}),o.jsx(wCe,{isOpen:Jt,onClose:()=>He(!1)})]})},Md=({icon:s,label:n,sublabel:i,onClick:l,dangerous:u})=>o.jsxs("button",{onClick:l,className:"w-full flex items-center gap-4 p-4 hover:bg-gray-50 transition-colors text-left",children:[o.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${u?"bg-red-50 text-red-500":"bg-delulu-violet/10 text-delulu-violet"}`,children:s}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:`font-semibold ${u?"text-red-600":"text-delulu-text"}`,children:n}),i&&o.jsx("p",{className:"text-sm text-delulu-muted",children:i})]}),o.jsx(As,{size:20,className:"text-delulu-muted"})]}),Fw=({icon:s,label:n,sublabel:i,value:l,onChange:u})=>o.jsxs("div",{className:"flex items-center gap-4 p-4",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-delulu-violet/10 flex items-center justify-center text-delulu-violet",children:s}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"font-semibold text-delulu-text",children:n}),i&&o.jsx("p",{className:"text-sm text-delulu-muted",children:i})]}),o.jsx("button",{onClick:()=>u(!l),className:`relative w-12 h-7 rounded-full transition-colors ${l?"bg-delulu-violet":"bg-gray-200"}`,children:o.jsx("div",{className:`absolute top-1 w-5 h-5 rounded-full bg-white shadow-sm transition-transform ${l?"left-6":"left-1"}`})})]}),MJ=({children:s,onClose:n})=>o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-6 bg-black/60 backdrop-blur-sm",children:o.jsxs("div",{className:"relative w-full max-w-sm bg-white rounded-3xl p-6 shadow-2xl animate-in zoom-in-95",children:[o.jsx("button",{onClick:n,className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center",children:o.jsx(Rs,{size:18})}),s]})}),ps={MAX_RADIUS:5e3,MIN_RADIUS:100,DEFAULT_RADIUS:1e3,STEP_SIZE:50,HIGH_ACCURACY_THRESHOLD:500,UPDATE_INTERVAL_ACTIVE:3e4,UPDATE_INTERVAL_BACKGROUND:3e5,LOCATION_MAX_AGE:6e4,LOCATION_TIMEOUT:15e3,NEARBY_CACHE_TTL:3e4,LOCATION_EXPIRY:9e5,EARTH_RADIUS_METERS:6371e3},TCe=(s,n,i,l)=>{const u=ps.EARTH_RADIUS_METERS,p=s*Math.PI/180,g=i*Math.PI/180,y=(i-s)*Math.PI/180,x=(l-n)*Math.PI/180,C=Math.sin(y/2)*Math.sin(y/2)+Math.cos(p)*Math.cos(g)*Math.sin(x/2)*Math.sin(x/2),k=2*Math.atan2(Math.sqrt(C),Math.sqrt(1-C));return u*k},RCe=(s,n,i,l)=>{const u=s*Math.PI/180,p=i*Math.PI/180,g=(l-n)*Math.PI/180,y=Math.sin(g)*Math.cos(p),x=Math.cos(u)*Math.sin(p)-Math.sin(u)*Math.cos(p)*Math.cos(g);return(Math.atan2(y,x)*180/Math.PI+360)%360},CCe=(s,n=!1)=>{const i=s<=ps.HIGH_ACCURACY_THRESHOLD;return n?{enableHighAccuracy:!1,maximumAge:ps.LOCATION_MAX_AGE*5,timeout:ps.LOCATION_TIMEOUT*2}:i?{enableHighAccuracy:!0,maximumAge:1e4,timeout:ps.LOCATION_TIMEOUT}:{enableHighAccuracy:!1,maximumAge:ps.LOCATION_MAX_AGE,timeout:ps.LOCATION_TIMEOUT}},NCe=async s=>{const n=Fi.currentUser;if(!n)return!1;try{return await yo(at(Me,"user_locations",n.uid),{userId:n.uid,geopoint:new tO(s.latitude,s.longitude),latitude:s.latitude,longitude:s.longitude,accuracy:s.accuracy,updatedAt:Uo(),expiresAt:new Date(Date.now()+ps.LOCATION_EXPIRY),isActive:!0},{merge:!0}),!0}catch(i){return console.error("[PrecisionRadar] Failed to update location:",i),!1}},ICe=async(s,n=ps.DEFAULT_RADIUS)=>{var u,p;const i=Fi.currentUser;if(!i)return[];const l=Math.min(n,ps.MAX_RADIUS);try{const g=l/ps.EARTH_RADIUS_METERS*(180/Math.PI),y=g/Math.cos(s.latitude*Math.PI/180),x=s.latitude-g,C=s.latitude+g,k=s.longitude-y,A=s.longitude+y,M=xn(Me,"user_locations"),G=Zr(M,or("latitude",">=",x),or("latitude","<=",C),or("expiresAt",">",new Date)),B=await Ur(G),X=[];for(const Z of B.docs){const q=Z.data();if(q.userId===i.uid||q.longitude<k||q.longitude>A)continue;const V=TCe(s.latitude,s.longitude,q.latitude,q.longitude);if(!(V<=l))continue;const de=await fr(at(Me,"users",q.userId));if(!de.exists())continue;const ae=de.data(),ye=RCe(s.latitude,s.longitude,q.latitude,q.longitude),Q=((p=(u=q.updatedAt)==null?void 0:u.toDate)==null?void 0:p.call(u))||new Date(0),$=Date.now()-Q.getTime()<3e5;X.push({id:q.userId,username:ae.username||"",displayName:ae.displayName||ae.username||"Anonym",avatarUrl:ae.avatarUrl,avatar:ae.avatar,distance:Math.round(V),bearing:Math.round(ye),level:ae.level||1,trustScore:ae.trustScore||50,isPremium:ae.isPremium||!1,isActive:$,lastSeen:Q,isWithinRadius:!0})}return X.sort((Z,q)=>Z.distance-q.distance)}catch(g){return console.error("[PrecisionRadar] Failed to fetch nearby users:",g),[]}},ACe=async()=>{const s=Fi.currentUser;if(!s)return{radius:ps.DEFAULT_RADIUS,isEnabled:!0};try{const n=await fr(at(Me,"users",s.uid));if(!n.exists())return{radius:ps.DEFAULT_RADIUS,isEnabled:!0};const i=n.data();return{radius:Math.min(i.searchRadius||ps.DEFAULT_RADIUS,ps.MAX_RADIUS),isEnabled:i.friendRadarEnabled!==!1}}catch{return{radius:ps.DEFAULT_RADIUS,isEnabled:!0}}},UJ=async(s,n)=>{const i=Fi.currentUser;if(!i)return!1;const l=Math.min(Math.max(s,ps.MIN_RADIUS),ps.MAX_RADIUS);try{return await yo(at(Me,"users",i.uid),{searchRadius:l,friendRadarEnabled:n},{merge:!0}),!0}catch{return!1}},KF=s=>s<50?"Sehr nah":s<100?`${Math.round(s)}m`:s<1e3?`${Math.round(s/10)*10}m`:s<5e3?`${(s/1e3).toFixed(1)}km`:"5km+",kCe=s=>s<100?"immediate":s<500?"near":s<1e3?"mid":s<3e3?"far":"edge",qF=()=>{const{user:s}=mr(),[n,i]=H.useState(!0),[l,u]=H.useState(!0),[p,g]=H.useState(null),[y,x]=H.useState(null),[C,k]=H.useState(null),[A,M]=H.useState(ps.DEFAULT_RADIUS),[G,B]=H.useState([]),X=H.useRef(null),Z=H.useRef(null),q=H.useRef(!1);H.useEffect(()=>{(async()=>{if(s!=null&&s.id){u(!0);try{const $=await ACe();if(M($.radius),i($.isEnabled),navigator.permissions){const se=await navigator.permissions.query({name:"geolocation"});x(se.state),se.addEventListener("change",()=>{x(se.state)})}}catch($){console.error("[PrecisionRadar] Init failed:",$)}finally{u(!1)}}})()},[s==null?void 0:s.id]);const V=H.useCallback(()=>{if(!navigator.geolocation||!n)return;X.current!==null&&navigator.geolocation.clearWatch(X.current);const Q=CCe(A,q.current);X.current=navigator.geolocation.watchPosition(async $=>{const se={latitude:$.coords.latitude,longitude:$.coords.longitude,accuracy:$.coords.accuracy,timestamp:new Date($.timestamp)};k(se),g(null),x("granted"),await NCe(se)},$=>{switch($.code){case $.PERMISSION_DENIED:g("Standortzugriff verweigert"),x("denied");break;case $.POSITION_UNAVAILABLE:g("Standort nicht verfgbar");break;case $.TIMEOUT:g("Standortanfrage Timeout");break;default:g("Standortfehler")}},Q)},[n,A]);H.useEffect(()=>(n&&y!=="denied"&&V(),()=>{X.current!==null&&(navigator.geolocation.clearWatch(X.current),X.current=null)}),[n,y,V]);const ee=H.useCallback(async()=>{if(!C||!n){B([]);return}try{const Q=await ICe(C,A);B(Q)}catch(Q){console.error("[PrecisionRadar] Failed to fetch nearby:",Q)}},[C,A,n]);H.useEffect(()=>{if(!C||!n)return;ee();const Q=q.current?ps.UPDATE_INTERVAL_BACKGROUND:ps.UPDATE_INTERVAL_ACTIVE;return Z.current=setInterval(ee,Q),()=>{Z.current&&(clearInterval(Z.current),Z.current=null)}},[C,n,ee]),H.useEffect(()=>{const Q=()=>{q.current=document.hidden,!document.hidden&&n&&V()};return document.addEventListener("visibilitychange",Q),()=>{document.removeEventListener("visibilitychange",Q)}},[n,V]);const de=H.useCallback(async Q=>{const $=Math.min(Math.max(Q,ps.MIN_RADIUS),ps.MAX_RADIUS);M($),await UJ($,n),"vibrate"in navigator&&navigator.vibrate(10)},[n]),ae=H.useCallback(async()=>{const Q=!n;i(Q),await UJ(A,Q),Q||B([]),"vibrate"in navigator&&navigator.vibrate([10,50,20])},[n,A]),ye=H.useCallback(async()=>navigator.geolocation?new Promise(Q=>{navigator.geolocation.getCurrentPosition(()=>{x("granted"),g(null),Q(!0)},$=>{$.code===$.PERMISSION_DENIED&&(x("denied"),g("Standortzugriff verweigert")),Q(!1)},{enableHighAccuracy:!1,timeout:1e4})}):(g("Geolocation wird nicht untersttzt"),!1),[]);return{isEnabled:n,isLoading:l,error:p,permission:y,location:C,radius:A,nearbyUsers:G,nearbyCount:G.length,setRadius:de,toggleRadar:ae,refreshNearby:ee,requestPermission:ye}},i_=({children:s,className:n="",onClick:i,gradient:l})=>o.jsxs("div",{onClick:i,className:`
      relative overflow-hidden rounded-3xl
      bg-white/70 dark:bg-gray-900/70
      backdrop-blur-xl backdrop-saturate-150
      border border-white/20 dark:border-gray-700/30
      shadow-xl shadow-purple-500/5
      transition-all duration-300
      ${i?"cursor-pointer hover:scale-[1.01] hover:shadow-2xl hover:shadow-purple-500/10 active:scale-[0.99]":""}
      ${n}
    `,children:[l&&o.jsx("div",{className:`absolute inset-0 opacity-10 bg-gradient-to-br ${l}`}),o.jsx("div",{className:"relative",children:s})]}),Vl=({icon:s,iconBg:n,label:i,description:l,value:u,onClick:p,toggle:g,isOn:y,onToggle:x,danger:C,badge:k})=>o.jsxs("button",{onClick:()=>{g&&x?x(!y):p&&p(),"vibrate"in navigator&&navigator.vibrate(10)},className:`w-full p-4 flex items-center gap-4 transition-colors ${C?"hover:bg-red-50 dark:hover:bg-red-900/20":"hover:bg-gray-50/50 dark:hover:bg-gray-800/50"}`,children:[o.jsx("div",{className:`w-11 h-11 rounded-2xl flex items-center justify-center ${n}`,children:s}),o.jsxs("div",{className:"flex-1 text-left",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:`font-medium ${C?"text-red-600":"text-gray-900 dark:text-white"}`,children:i}),k&&o.jsx("span",{className:"px-2 py-0.5 text-[10px] font-bold uppercase bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-full",children:k})]}),l&&o.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:l})]}),g?o.jsx("div",{className:`w-14 h-8 rounded-full p-1 transition-colors ${y?"bg-gradient-to-r from-purple-500 to-pink-500":"bg-gray-200 dark:bg-gray-700"}`,children:o.jsx("div",{className:`w-6 h-6 rounded-full bg-white shadow-md transition-transform ${y?"translate-x-6":"translate-x-0"}`})}):u?o.jsx("span",{className:"text-sm text-gray-500",children:u}):o.jsx(As,{size:20,className:"text-gray-400"})]}),OCe=({value:s,onChange:n,disabled:i})=>{const l=(s-ps.MIN_RADIUS)/(ps.MAX_RADIUS-ps.MIN_RADIUS)*100;return o.jsxs("div",{className:`px-4 py-3 ${i?"opacity-50":""}`,children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Suchradius"}),o.jsx("span",{className:"text-sm font-semibold text-purple-600",children:s>=1e3?`${(s/1e3).toFixed(1)}km`:`${s}m`})]}),o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full transition-all",style:{width:`${l}%`}})}),o.jsx("input",{type:"range",min:ps.MIN_RADIUS,max:ps.MAX_RADIUS,step:ps.STEP_SIZE,value:s,onChange:u=>n(Number(u.target.value)),disabled:i,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"})]}),o.jsxs("div",{className:"flex justify-between mt-1",children:[o.jsx("span",{className:"text-[10px] text-gray-400",children:"100m"}),o.jsx("span",{className:"text-[10px] text-gray-400",children:"5km MAX"})]})]})},DCe=()=>{tl();const s=zr(),{user:n,setUser:i}=mr(),{avatarUrl:l}=HF(),{isEnabled:u,radius:p,setRadius:g,toggleRadar:y}=qF(),[x,C]=H.useState("everyone"),[k,A]=H.useState(!0),[M,G]=H.useState(!0),[B,X]=H.useState(!1),[Z,q]=H.useState(""),[V,ee]=H.useState(!1),[de,ae]=H.useState(!1);H.useEffect(()=>{(async()=>{if(n!=null&&n.id)try{const ce=await fr(at(Me,"users",n.id));if(ce.exists()){const he=ce.data();C(he.visibility||"everyone"),A(he.notifications!==!1),G(he.soundEnabled!==!1),X(he.darkMode===!0),q(he.referralCode||`DELULU-${n.id.slice(0,6).toUpperCase()}`),ae(he.isCreator===!0)}}catch(ce){console.error("[SettingsHub] Load failed:",ce)}})()},[n==null?void 0:n.id]);const ye=async(se,ce)=>{if(n!=null&&n.id)try{await Kn(at(Me,"users",n.id),{[se]:ce})}catch(he){console.error("[SettingsHub] Save failed:",he)}},Q=async()=>{try{await navigator.clipboard.writeText(`Hey! Komm zu Delulu  Nutze meinen Code: ${Z}
https://delulu.app/join/${Z}`),ee(!0),"vibrate"in navigator&&navigator.vibrate([10,50,10]),setTimeout(()=>ee(!1),2e3)}catch(se){console.error("Copy failed:",se)}},$=async()=>{"vibrate"in navigator&&navigator.vibrate([50,30,50]);try{await ate(Fi),s("/login")}catch(se){console.error("Logout failed:",se)}};return o.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-purple-50/80 via-white to-gray-50 dark:from-gray-900 dark:via-gray-900 dark:to-black",children:[o.jsx("div",{className:"sticky top-0 z-50 px-4 pt-6 pb-4 bg-gradient-to-b from-purple-50/95 via-white/95 to-transparent dark:from-gray-900/95 dark:via-gray-900/95 backdrop-blur-lg",children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("button",{onClick:()=>s(-1),className:"w-10 h-10 rounded-xl bg-white/80 dark:bg-gray-800/80 shadow-sm border border-gray-100 dark:border-gray-700 flex items-center justify-center hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:o.jsx(Gu,{size:20,className:"text-gray-600 dark:text-gray-300"})}),o.jsx("h1",{className:"font-display text-2xl font-bold text-gray-900 dark:text-white",children:"Einstellungen"})]})}),o.jsxs("div",{className:"px-4 pb-32 space-y-6",children:[o.jsx(i_,{onClick:()=>s("/profile"),gradient:"from-purple-500 to-pink-500",children:o.jsxs("div",{className:"p-5 flex items-center gap-4",children:[o.jsx("div",{className:"w-16 h-16 rounded-2xl overflow-hidden ring-2 ring-purple-500/30 shadow-lg",children:o.jsx("img",{src:l,alt:"Avatar",className:"w-full h-full object-cover"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h2",{className:"font-display text-lg font-bold text-gray-900 dark:text-white",children:(n==null?void 0:n.displayName)||"Anonym"}),o.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["@",(n==null?void 0:n.username)||"username"]})]}),o.jsx(As,{size:20,className:"text-gray-400"})]})}),o.jsx(i_,{gradient:"from-amber-400 to-orange-500",children:o.jsxs("div",{className:"divide-y divide-gray-100/50 dark:divide-gray-800/50",children:[o.jsx(Vl,{icon:o.jsx(hs,{size:20,className:"text-amber-500"}),iconBg:"bg-gradient-to-br from-amber-100 to-orange-100 dark:from-amber-900/30 dark:to-orange-900/30",label:"Creator werden",description:de?"Du bist bereits Creator ":"Verdiene Geld mit deinem Content",badge:de?"AKTIV":"NEU",onClick:()=>s("/creator-application")}),o.jsxs("div",{className:"p-4",children:[o.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[o.jsx("div",{className:"w-11 h-11 rounded-2xl bg-gradient-to-br from-pink-100 to-purple-100 dark:from-pink-900/30 dark:to-purple-900/30 flex items-center justify-center",children:o.jsx(ra,{size:20,className:"text-pink-500"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:"Einladungssystem"}),o.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Lade Freunde ein & erhalte Rewards"})]})]}),o.jsxs("div",{className:"bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-2xl p-4 border border-purple-200/50 dark:border-purple-700/30",children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"Dein Code"}),o.jsx("span",{className:"text-[10px] px-2 py-0.5 bg-purple-500/20 text-purple-600 rounded-full font-semibold",children:" 7 Tage Premium pro Einladung"})]}),o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"flex-1 bg-white dark:bg-gray-800 rounded-xl px-4 py-3 font-mono text-lg font-bold text-purple-600 dark:text-purple-400 tracking-wider",children:Z}),o.jsx("button",{onClick:Q,className:`w-12 h-12 rounded-xl flex items-center justify-center transition-all ${V?"bg-green-500 text-white":"bg-purple-500 text-white hover:bg-purple-600"}`,children:V?o.jsx(zn,{size:20}):o.jsx(FF,{size:20})})]})]}),o.jsxs("div",{className:"flex gap-2 mt-3",children:[o.jsxs("button",{onClick:()=>s("/invites"),className:"flex-1 py-2.5 px-4 rounded-xl bg-purple-500 text-white text-sm font-semibold flex items-center justify-center gap-2 hover:bg-purple-600 transition-colors",children:[o.jsx(ep,{size:16}),"Einladen"]}),o.jsxs("button",{onClick:()=>s("/referral-status"),className:"flex-1 py-2.5 px-4 rounded-xl bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 text-sm font-semibold flex items-center justify-center gap-2 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",children:[o.jsx(rr,{size:16}),"Status"]})]})]})]})}),o.jsx(i_,{children:o.jsxs("div",{className:"divide-y divide-gray-100/50 dark:divide-gray-800/50",children:[o.jsxs("div",{className:"p-4",children:[o.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[o.jsx("div",{className:"w-11 h-11 rounded-2xl bg-gradient-to-br from-violet-100 to-purple-100 dark:from-violet-900/30 dark:to-purple-900/30 flex items-center justify-center",children:x==="nobody"?o.jsx($c,{size:20,className:"text-violet-500"}):o.jsx(Ta,{size:20,className:"text-violet-500"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:"Sichtbarkeit"}),o.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Wer kann dich im Radar sehen?"})]})]}),o.jsx("div",{className:"flex gap-2",children:[{key:"everyone",label:"Alle",icon:D_},{key:"friends",label:"Freunde",icon:rr},{key:"nobody",label:"Niemand",icon:$c}].map(se=>{const ce=se.icon,he=x===se.key;return o.jsxs("button",{onClick:()=>{C(se.key),ye("visibility",se.key),"vibrate"in navigator&&navigator.vibrate(10)},className:`flex-1 py-2.5 px-3 rounded-xl text-sm font-medium flex items-center justify-center gap-2 transition-all ${he?"bg-purple-500 text-white shadow-lg shadow-purple-500/30":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:[o.jsx(ce,{size:16}),se.label]},se.key)})})]}),o.jsxs("div",{children:[o.jsx(Vl,{icon:o.jsx(fV,{size:20,className:"text-cyan-500"}),iconBg:"bg-gradient-to-br from-cyan-100 to-blue-100 dark:from-cyan-900/30 dark:to-blue-900/30",label:"Friend Radar",description:"Entdecke Delulu-User in deiner Nhe",toggle:!0,isOn:u,onToggle:y}),o.jsx(OCe,{value:p,onChange:g,disabled:!u})]})]})}),o.jsx(i_,{children:o.jsxs("div",{className:"divide-y divide-gray-100/50 dark:divide-gray-800/50",children:[o.jsx(Vl,{icon:o.jsx(Xc,{size:20,className:"text-rose-500"}),iconBg:"bg-gradient-to-br from-rose-100 to-pink-100 dark:from-rose-900/30 dark:to-pink-900/30",label:"Push-Benachrichtigungen",description:"Erhalte Updates zu Matches & Messages",toggle:!0,isOn:k,onToggle:se=>{A(se),ye("notifications",se)}}),o.jsx(Vl,{icon:o.jsx(pO,{size:20,className:"text-emerald-500"}),iconBg:"bg-gradient-to-br from-emerald-100 to-green-100 dark:from-emerald-900/30 dark:to-green-900/30",label:"Sound-Effekte",description:"Tne bei Aktionen & Benachrichtigungen",toggle:!0,isOn:M,onToggle:se=>{G(se),ye("soundEnabled",se)}}),o.jsx(Vl,{icon:B?o.jsx(uRe,{size:20,className:"text-indigo-500"}):o.jsx(vRe,{size:20,className:"text-amber-500"}),iconBg:B?"bg-gradient-to-br from-indigo-100 to-violet-100 dark:from-indigo-900/30 dark:to-violet-900/30":"bg-gradient-to-br from-amber-100 to-yellow-100 dark:from-amber-900/30 dark:to-yellow-900/30",label:"Dark Mode",description:"Dunkles Erscheinungsbild aktivieren",toggle:!0,isOn:B,onToggle:se=>{X(se),ye("darkMode",se),document.documentElement.classList.toggle("dark",se)}})]})}),o.jsx(i_,{children:o.jsxs("div",{className:"divide-y divide-gray-100/50 dark:divide-gray-800/50",children:[o.jsx(Vl,{icon:o.jsx(li,{size:20,className:"text-blue-500"}),iconBg:"bg-gradient-to-br from-blue-100 to-cyan-100 dark:from-blue-900/30 dark:to-cyan-900/30",label:"Account & Sicherheit",description:"Passwort, Email, Zwei-Faktor",onClick:()=>s("/settings/security")}),o.jsx(Vl,{icon:o.jsx(Hi,{size:20,className:"text-gray-500"}),iconBg:"bg-gradient-to-br from-gray-100 to-slate-100 dark:from-gray-800/50 dark:to-slate-800/50",label:"Blockierte Nutzer",description:"Verwalte blockierte Profile",onClick:()=>s("/settings/blocked")}),o.jsx(Vl,{icon:o.jsx(Ore,{size:20,className:"text-purple-500"}),iconBg:"bg-gradient-to-br from-purple-100 to-fuchsia-100 dark:from-purple-900/30 dark:to-fuchsia-900/30",label:"Verknpfte Gerte",description:"Aktive Sessions verwalten",onClick:()=>s("/settings/devices")})]})}),o.jsx(i_,{children:o.jsxs("div",{className:"divide-y divide-gray-100/50 dark:divide-gray-800/50",children:[o.jsx(Vl,{icon:o.jsx(RT,{size:20,className:"text-teal-500"}),iconBg:"bg-gradient-to-br from-teal-100 to-cyan-100 dark:from-teal-900/30 dark:to-cyan-900/30",label:"Hilfe & Support",description:"FAQ, Kontakt, Bug melden",onClick:()=>s("/help")}),o.jsx(Vl,{icon:o.jsx(Fs,{size:20,className:"text-yellow-500"}),iconBg:"bg-gradient-to-br from-yellow-100 to-amber-100 dark:from-yellow-900/30 dark:to-amber-900/30",label:"App bewerten",description:"Hilf uns mit einer Bewertung",onClick:()=>window.open("https://apps.apple.com/app/delulu","_blank")}),o.jsx(Vl,{icon:o.jsx(ck,{size:20,className:"text-gray-500"}),iconBg:"bg-gradient-to-br from-gray-100 to-slate-100 dark:from-gray-800/50 dark:to-slate-800/50",label:"Rechtliches",description:"Impressum, Datenschutz, AGB",onClick:()=>s("/legal")})]})}),o.jsx(i_,{children:o.jsx(Vl,{icon:o.jsx(hO,{size:20,className:"text-red-500"}),iconBg:"bg-red-100 dark:bg-red-900/30",label:"Abmelden",description:"Von diesem Gert abmelden",onClick:$,danger:!0})}),o.jsxs("div",{className:"text-center py-6",children:[o.jsx("p",{className:"text-xs text-gray-400",children:"Delulu v1.5.0  Made with  in Germany"}),o.jsx("p",{className:"text-[10px] text-gray-300 mt-1",children:"Build 2024.01.15"})]})]})]})},k4=[{category:"allgemein",question:"Was ist delulu?",answer:'delulu ist eine hyperlocal Community-App, die Menschen in deiner Nhe per Voice-Chat verbindet. Tauche in die "Wolke" ein und triff neue Leute spontan und unkompliziert.'},{category:"allgemein",question:"Wie funktioniert die Wolke?",answer:"Die Wolke zeigt dir Rume mit aktiven Usern in deiner Umgebung. Tippe einfach auf die groe Wolke auf der Home-Seite, und du wirst automatisch mit jemandem verbunden, der gerade online ist."},{category:"allgemein",question:"Ist delulu kostenlos?",answer:"Ja! Die Grundfunktionen sind komplett kostenlos. Mit Catalyst Premium bekommst du zustzliche Features wie 1.5x XP, unbegrenzte Sterne und die Mglichkeit zu sehen, wer dein Profil besucht hat."},{category:"voice",question:"Wie starte ich einen Voice-Chat?",answer:"Gehe auf die Home-Seite und tippe auf die Wolke. Du wirst gefragt, ob du anonym oder ffentlich beitreten mchtest. Danach wirst du mit einem aktiven Raum verbunden."},{category:"voice",question:"Warum bin ich am Anfang stumm geschaltet?",answer:"Neue Teilnehmer haben eine kurze Redepause von 4 Sekunden. Das gibt dir Zeit, erst mal zuzuhren und den Kontext des Gesprchs zu verstehen, bevor du dich einbringst."},{category:"voice",question:"Kann ich aus einem Raum rausgeworfen werden?",answer:"Einzelne Personen knnen dich nicht kicken. Bei schlechtem Verhalten knnen andere User jedoch eine Abstimmung starten, um dich aus dem Raum zu entfernen."},{category:"sicherheit",question:"Was ist der Anonym-Modus?",answer:'Im Anonym-Modus wird dein Profilbild verschwommen angezeigt und du erscheinst unter einem zuflligen Alias wie "Wanderer_4821". Dein echter Username bleibt verborgen.'},{category:"sicherheit",question:"Wie blockiere ich jemanden?",answer:"Gehe zu Einstellungen  Blockierte User. Dort kannst du User blockieren und auch den Grund angeben (Belstigung, Spam, etc.). Blockierte User knnen dich nicht mehr sehen oder kontaktieren."},{category:"sicherheit",question:"Werden meine Gesprche aufgezeichnet?",answer:"Nein. Voice-Chats werden nicht aufgezeichnet oder gespeichert. Alle Gesprche sind live und ephemer - sobald du den Raum verlsst, sind sie weg."},{category:"xp",question:"Wie verdiene ich XP?",answer:"Du verdienst XP durch: Voice-Chats (pro Minute), Sterne erhalten (15 XP pro Stern), tgliche Logins (Streak-Bonus), und regionale Events (bis zu 3x XP in bestimmten Zonen)."},{category:"xp",question:"Was bringt mir ein hheres Level?",answer:'Mit jedem Level steigt dein Ansehen in der Community. Hhere Level bekommen spezielle Titel (z.B. "Socialite" ab Level 31), vergrerte Trust-Badges und Zugang zu exklusiven Features.'},{category:"xp",question:"Was sind Sterne und wie funktionieren sie?",answer:"Sterne sind virtuelle Geschenke, die du anderen Usern geben kannst. Jeder Stern ist 15 XP wert. Free User knnen 3 Sterne pro Tag verschenken, Premium User unbegrenzt viele."},{category:"freunde",question:"Wie fge ich Freunde hinzu?",answer:'Sende eine Freundschaftsanfrage ber das Profil eines Users. Freundschaft in delulu funktioniert nach dem "Handshake"-Prinzip - beide mssen besttigen.'},{category:"freunde",question:"Was ist der Unterschied zwischen Folgen und Freundschaft?",answer:"Folgen ist einseitig (wie auf Twitter) - du siehst Updates von jemandem. Freundschaft ist gegenseitig und schaltet zustzliche Features wie Direktnachrichten frei."},{category:"freunde",question:"Mit wem kann ich chatten?",answer:"Du kannst nur mit Freunden oder Usern chatten, die du bereits in der App getroffen hast. Das schtzt vor unerwnschten Nachrichten von Fremden."}],PCe=[{id:"allgemein",label:"Allgemein",icon:RT},{id:"voice",label:"Voice Chat",icon:eh},{id:"sicherheit",label:"Sicherheit",icon:li},{id:"xp",label:"XP & Level",icon:Fs},{id:"freunde",label:"Freundschaften",icon:rr}],LCe=()=>{const s=zr(),[n,i]=H.useState(null),[l,u]=H.useState(null),[p,g]=H.useState(""),y=p?k4.filter(C=>C.question.toLowerCase().includes(p.toLowerCase())||C.answer.toLowerCase().includes(p.toLowerCase())):n?k4.filter(C=>C.category===n):k4,x=C=>{u(l===C?null:C)};return o.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white safe-top safe-bottom pb-24",children:[o.jsxs("div",{className:"sticky top-0 z-20 bg-white/90 backdrop-blur-lg border-b border-gray-100",children:[o.jsxs("div",{className:"px-6 py-4 flex items-center gap-4",children:[o.jsx("button",{onClick:()=>s(-1),className:"w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-delulu-muted hover:bg-gray-200 transition-colors",children:o.jsx(sa,{size:20})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h1",{className:"font-display text-xl font-bold text-delulu-text",children:"Hilfe & FAQ"}),o.jsx("p",{className:"text-xs text-delulu-muted",children:"Finde Antworten auf deine Fragen"})]})]}),o.jsx("div",{className:"px-6 pb-4",children:o.jsxs("div",{className:"relative",children:[o.jsx(JS,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-delulu-muted"}),o.jsx("input",{type:"text",value:p,onChange:C=>g(C.target.value),placeholder:"Suche in den FAQ...",className:"w-full pl-11 pr-4 py-3 bg-gray-100 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-delulu-violet/30"})]})})]}),!p&&o.jsx("div",{className:"px-6 py-4",children:o.jsxs("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide pb-2",children:[o.jsx("button",{onClick:()=>i(null),className:`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-semibold whitespace-nowrap transition-all ${n?"bg-gray-100 text-delulu-muted hover:bg-gray-200":"bg-delulu-violet text-white shadow-lg"}`,children:"Alle"}),PCe.map(C=>o.jsxs("button",{onClick:()=>i(C.id),className:`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-semibold whitespace-nowrap transition-all ${n===C.id?"bg-delulu-violet text-white shadow-lg":"bg-gray-100 text-delulu-muted hover:bg-gray-200"}`,children:[o.jsx(C.icon,{size:16}),C.label]},C.id))]})}),o.jsx("div",{className:"px-6 space-y-3",children:y.length===0?o.jsxs("div",{className:"text-center py-12",children:[o.jsx(RT,{size:48,className:"mx-auto text-gray-300 mb-4"}),o.jsx("p",{className:"text-delulu-muted",children:"Keine Ergebnisse gefunden"})]}):y.map((C,k)=>o.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:[o.jsxs("button",{onClick:()=>x(C.question),className:"w-full flex items-center justify-between p-4 text-left",children:[o.jsx("span",{className:"font-semibold text-delulu-text pr-4",children:C.question}),l===C.question?o.jsx(uO,{size:20,className:"text-delulu-violet flex-shrink-0"}):o.jsx(As,{size:20,className:"text-delulu-muted flex-shrink-0"})]}),l===C.question&&o.jsx("div",{className:"px-4 pb-4 pt-0",children:o.jsx("div",{className:"bg-gray-50 rounded-xl p-4",children:o.jsx("p",{className:"text-sm text-delulu-text leading-relaxed",children:C.answer})})})]},k))}),o.jsx("div",{className:"px-6 py-8",children:o.jsxs("div",{className:"bg-gradient-to-br from-delulu-violet/10 to-purple-100 rounded-2xl p-6 text-center",children:[o.jsx(V_,{size:32,className:"mx-auto text-delulu-violet mb-3"}),o.jsx("h3",{className:"font-display font-bold text-delulu-text mb-2",children:"Noch Fragen?"}),o.jsx("p",{className:"text-sm text-delulu-muted mb-4",children:"Unser Support-Team hilft dir gerne weiter"}),o.jsxs("div",{className:"flex flex-col gap-3",children:[o.jsxs("a",{href:"mailto:support@delulu.app",className:"flex items-center justify-center gap-2 py-3 px-4 bg-delulu-violet text-white rounded-xl font-semibold hover:bg-delulu-violet/90 transition-colors",children:[o.jsx(_y,{size:18}),"E-Mail schreiben"]}),o.jsxs("a",{href:"https://delulu.app/help",target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 py-3 px-4 bg-white text-delulu-text rounded-xl font-semibold hover:bg-gray-50 transition-colors border border-gray-200",children:[o.jsx(tRe,{size:18}),"Hilfe-Center besuchen"]})]})]})}),o.jsx("div",{className:"px-6 pb-8",children:o.jsxs("div",{className:"flex justify-center gap-6 text-xs text-delulu-muted",children:[o.jsx("a",{href:"/privacy",className:"hover:text-delulu-violet",children:"Datenschutz"}),o.jsx("a",{href:"/terms",className:"hover:text-delulu-violet",children:"AGB"}),o.jsx("a",{href:"/imprint",className:"hover:text-delulu-violet",children:"Impressum"})]})})]})},VJ=()=>{const s=zr(),[n]=aT(),{user:i}=mr(),l=(i==null?void 0:i.totalStarsReceived)||0,u=(i==null?void 0:i.level)||1,p=(i==null?void 0:i.totalVoiceMinutes)||0,g=(i==null?void 0:i.positiveRatings)||0,y=(i==null?void 0:i.totalRatings)||1,x=Math.round(g/y*100),C=H.useMemo(()=>l>=Js.starsRequired&&u>=Js.levelRequired&&p>=Js.voiceMinutesRequired&&x>=Js.minPositiveRatings,[l,u,p,x]),k=n.get("path"),[A,M]=H.useState(k==="community"&&C?"community":"vip"),[G,B]=H.useState("intro"),[X,Z]=H.useState(!1),[q,V]=H.useState(A==="community"?"creator":null),[ee,de]=H.useState(""),[ae,ye]=H.useState(""),[Q,$]=H.useState([]),[se,ce]=H.useState([]),he=()=>o.jsxs("div",{className:"text-center px-4",children:[C&&o.jsxs("div",{className:"mb-6 p-1 bg-gray-800/50 rounded-xl flex",children:[o.jsx("button",{onClick:()=>M("vip"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${A==="vip"?"bg-purple-500 text-white":"text-gray-400 hover:text-white"}`,children:"VIP / Influencer"}),o.jsx("button",{onClick:()=>{M("community"),V("creator")},className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${A==="community"?"bg-green-500 text-white":"text-gray-400 hover:text-white"}`,children:"Community Creator"})]}),o.jsxs("div",{className:"relative w-32 h-32 mx-auto mb-8",children:[o.jsx("div",{className:`absolute inset-0 rounded-full animate-pulse ${A==="community"?"bg-gradient-to-br from-green-500/30 to-emerald-500/30":"bg-gradient-to-br from-purple-500/30 to-pink-500/30"}`}),o.jsx("div",{className:`absolute inset-2 rounded-full flex items-center justify-center ${A==="community"?"bg-gradient-to-br from-green-600 to-emerald-600":"bg-gradient-to-br from-purple-600 to-pink-600"}`,children:A==="community"?o.jsx(fS,{size:48,className:"text-white"}):o.jsx(wr,{size:48,className:"text-white"})}),[...Array(4)].map((He,bt)=>o.jsx("div",{className:`absolute w-3 h-3 rounded-full ${A==="community"?"bg-green-400":"bg-yellow-400"}`,style:{top:"50%",left:"50%",transform:`rotate(${bt*90}deg) translateX(60px) translateY(-50%)`,animation:`orbit 4s linear infinite ${bt*.25}s`}},bt))]}),o.jsx("h1",{className:"text-3xl font-bold text-white mb-3",children:A==="community"?"Community Creator":"Stars Programm"}),o.jsx("p",{className:"text-gray-400 mb-8 max-w-sm mx-auto",children:A==="community"?o.jsx(o.Fragment,{children:"Du hast dich durch dein Engagement qualifiziert! Werde jetzt offizieller Community Creator."}):o.jsx(o.Fragment,{children:"Exklusiv fr Persnlichkeiten des ffentlichen Lebens. Erhalte das Nebula Badge und erweiterte Features."})}),A==="community"&&o.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-6 max-w-sm mx-auto",children:[o.jsxs("div",{className:"bg-green-500/10 border border-green-500/30 rounded-xl p-3",children:[o.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[o.jsx(Fs,{size:14,className:"text-amber-400"}),o.jsx("span",{className:"text-lg font-bold text-white",children:l})]}),o.jsx("p",{className:"text-[10px] text-gray-400",children:"Sterne erhalten"})]}),o.jsxs("div",{className:"bg-green-500/10 border border-green-500/30 rounded-xl p-3",children:[o.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[o.jsx(eh,{size:14,className:"text-blue-400"}),o.jsx("span",{className:"text-lg font-bold text-white",children:p})]}),o.jsx("p",{className:"text-[10px] text-gray-400",children:"Voice-Minuten"})]}),o.jsxs("div",{className:"bg-green-500/10 border border-green-500/30 rounded-xl p-3",children:[o.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[o.jsx(rr,{size:14,className:"text-purple-400"}),o.jsxs("span",{className:"text-lg font-bold text-white",children:["Lvl ",u]})]}),o.jsx("p",{className:"text-[10px] text-gray-400",children:"Dein Level"})]}),o.jsxs("div",{className:"bg-green-500/10 border border-green-500/30 rounded-xl p-3",children:[o.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[o.jsx(Vu,{size:14,className:"text-green-400"}),o.jsxs("span",{className:"text-lg font-bold text-white",children:[x,"%"]})]}),o.jsx("p",{className:"text-[10px] text-gray-400",children:"Positive Ratings"})]})]}),o.jsx("div",{className:"space-y-3 mb-8 text-left max-w-sm mx-auto",children:(A==="community"?[{icon:"",text:"Community Creator Badge"},{icon:"",text:"Voice-Rume hosten"},{icon:"",text:"Events planen & ankndigen"},{icon:"",text:"Analytics Dashboard"},{icon:"",text:"Schnelle Verifizierung"}]:[{icon:"",text:"Verifiziertes Nebula Badge"},{icon:"",text:"Erweiterte Moderationsrechte"},{icon:"",text:"Detaillierte Analytics"},{icon:"",text:"Priorisierte Sichtbarkeit"},{icon:"",text:"Voice Lift Feature"}]).map((He,bt)=>o.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-xl ${A==="community"?"bg-green-900/30 border border-green-500/20":"bg-gray-800/50"}`,children:[o.jsx("span",{className:"text-xl",children:He.icon}),o.jsx("span",{className:"text-gray-300",children:He.text})]},bt))}),o.jsx("button",{onClick:()=>B(A==="community"?"social":"category"),className:`w-full py-4 rounded-xl text-white font-semibold text-lg hover:opacity-90 transition-opacity ${A==="community"?"bg-gradient-to-r from-green-500 to-emerald-500":"bg-gradient-to-r from-purple-500 to-pink-500"}`,children:A==="community"?"Weiter zur Bewerbung":"Jetzt bewerben"}),A==="community"&&o.jsxs("p",{className:"text-xs text-green-400 mt-4 flex items-center justify-center gap-1",children:[o.jsx(Vu,{size:12}),"Du erfllst alle Voraussetzungen!"]}),o.jsx("p",{className:"text-xs text-gray-500 mt-4",children:"Deine Daten werden vertraulich behandelt und nur zur Verifizierung verwendet."}),o.jsx("style",{children:`
        @keyframes orbit {
          from { transform: rotate(0deg) translateX(60px) rotate(0deg); }
          to { transform: rotate(360deg) translateX(60px) rotate(-360deg); }
        }
      `})]}),ve=[{value:"influencer",label:"Influencer",emoji:"",desc:"Social Media Creator"},{value:"entrepreneur",label:"Unternehmer",emoji:"",desc:"Grnder & Business"},{value:"artist",label:"Knstler",emoji:"",desc:"Bildende Kunst"},{value:"musician",label:"Musiker",emoji:"",desc:"Musik & Audio"},{value:"athlete",label:"Sportler",emoji:"",desc:"Profisport"},{value:"actor",label:"Schauspieler",emoji:"",desc:"Film & Theater"},{value:"creator",label:"Creator",emoji:"",desc:"Content Creator"},{value:"journalist",label:"Journalist",emoji:"",desc:"Medien & Presse"},{value:"scientist",label:"Wissenschaftler",emoji:"",desc:"Forschung & Bildung"},{value:"other",label:"Andere",emoji:"",desc:"Persnlichkeit"}],ge=()=>o.jsxs("div",{className:"px-4",children:[o.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Whle deine Kategorie"}),o.jsx("p",{className:"text-gray-400 mb-6",children:"In welchem Bereich bist du aktiv?"}),o.jsx("div",{className:"grid grid-cols-2 gap-3 mb-6",children:ve.map(He=>o.jsxs("button",{onClick:()=>V(He.value),className:`p-4 rounded-xl text-left transition-all ${q===He.value?"bg-purple-500/20 border-2 border-purple-500":"bg-gray-800/50 border-2 border-transparent hover:border-gray-700"}`,children:[o.jsx("span",{className:"text-2xl mb-2 block",children:He.emoji}),o.jsx("p",{className:"font-semibold text-white",children:He.label}),o.jsx("p",{className:"text-xs text-gray-400",children:He.desc})]},He.value))}),o.jsxs("div",{className:"mb-6",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Erzhl uns mehr ber dich"}),o.jsx("textarea",{value:ee,onChange:He=>de(He.target.value),placeholder:"Warum solltest du verifiziert werden? Was machst du?",className:"w-full p-4 bg-gray-800/50 rounded-xl text-white placeholder-gray-500 resize-none h-32 focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),o.jsxs("div",{className:"mb-6",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Geschtzte Follower-Anzahl (alle Plattformen)"}),o.jsx("input",{type:"number",value:ae,onChange:He=>ye(He.target.value),placeholder:"z.B. 50000",className:"w-full p-4 bg-gray-800/50 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),o.jsx("button",{onClick:()=>B("social"),disabled:!q||!ee||!ae,className:"w-full py-4 rounded-xl bg-gradient-to-r from-purple-500 to-pink-500 text-white font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:"Weiter"})]}),qe=[{value:"instagram",label:"Instagram",icon:oRe,color:"#E4405F"},{value:"tiktok",label:"TikTok",icon:hRe,color:"#000000"},{value:"youtube",label:"YouTube",icon:NRe,color:"#FF0000"},{value:"twitter",label:"X / Twitter",icon:xRe,color:"#1DA1F2"},{value:"linkedin",label:"LinkedIn",icon:cRe,color:"#0A66C2"},{value:"other",label:"Andere",icon:D_,color:"#6B7280"}],Dt=He=>{Q.find(bt=>bt.platform===He)||$([...Q,{platform:He,url:"",username:""}])},gt=(He,bt,Wt)=>{$(Q.map(gn=>gn.platform===He?{...gn,[bt]:Wt}:gn))},Ye=He=>{$(Q.filter(bt=>bt.platform!==He))},ze=()=>o.jsxs("div",{className:"px-4",children:[o.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Social Media Profile"}),o.jsx("p",{className:"text-gray-400 mb-6",children:"Verlinke deine verifizierten Profile"}),o.jsx("div",{className:"space-y-3 mb-6",children:Q.map(He=>{const bt=qe.find(gn=>gn.value===He.platform),Wt=bt.icon;return o.jsxs("div",{className:"p-4 bg-gray-800/50 rounded-xl",children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Wt,{size:20,style:{color:bt.color}}),o.jsx("span",{className:"font-medium text-white",children:bt.label})]}),o.jsx("button",{onClick:()=>Ye(He.platform),className:"p-1 text-gray-500 hover:text-red-400",children:o.jsx(Rs,{size:18})})]}),o.jsx("input",{type:"text",value:He.username,onChange:gn=>gt(He.platform,"username",gn.target.value),placeholder:"@username",className:"w-full p-3 bg-gray-900/50 rounded-lg text-white placeholder-gray-500 text-sm mb-2 focus:outline-none focus:ring-1 focus:ring-purple-500"}),o.jsx("input",{type:"url",value:He.url,onChange:gn=>gt(He.platform,"url",gn.target.value),placeholder:"https://...",className:"w-full p-3 bg-gray-900/50 rounded-lg text-white placeholder-gray-500 text-sm focus:outline-none focus:ring-1 focus:ring-purple-500"})]},He.platform)})}),o.jsx("p",{className:"text-sm text-gray-400 mb-3",children:"Plattform hinzufgen:"}),o.jsx("div",{className:"flex flex-wrap gap-2 mb-8",children:qe.filter(He=>!Q.find(bt=>bt.platform===He.value)).map(He=>{const bt=He.icon;return o.jsxs("button",{onClick:()=>Dt(He.value),className:"flex items-center gap-2 px-3 py-2 bg-gray-800/50 rounded-lg text-gray-400 hover:text-white hover:bg-gray-700/50 transition-colors",children:[o.jsx(bt,{size:16}),o.jsx("span",{className:"text-sm",children:He.label}),o.jsx($S,{size:14})]},He.value)})}),o.jsx("button",{onClick:()=>B(A==="community"?"review":"documents"),disabled:Q.length===0||Q.some(He=>!He.url||!He.username),className:`w-full py-4 rounded-xl text-white font-semibold disabled:opacity-50 disabled:cursor-not-allowed ${A==="community"?"bg-gradient-to-r from-green-500 to-emerald-500":"bg-gradient-to-r from-purple-500 to-pink-500"}`,children:A==="community"?"Zur berprfung":"Weiter"}),A==="community"&&o.jsxs("p",{className:"text-xs text-green-400 text-center mt-3 flex items-center justify-center gap-1",children:[o.jsx(Vu,{size:12}),"Keine Dokumente erforderlich - du bist bereits verifiziert durch dein Engagement!"]})]}),ut=He=>{const bt=He.target.files;bt&&ce([...se,...Array.from(bt)])},yt=He=>{ce(se.filter((bt,Wt)=>Wt!==He))},Xt=()=>o.jsxs("div",{className:"px-4",children:[o.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Verifikations-Dokumente"}),o.jsx("p",{className:"text-gray-400 mb-6",children:"Hilf uns, deine Identitt zu besttigen. Alle Daten werden vertraulich behandelt."}),o.jsxs("div",{className:"p-4 bg-purple-500/10 border border-purple-500/30 rounded-xl mb-6",children:[o.jsx("p",{className:"text-sm text-purple-300 font-medium mb-2",children:"Akzeptierte Dokumente:"}),o.jsxs("ul",{className:"text-sm text-gray-400 space-y-1",children:[o.jsx("li",{children:" Screenshot deiner verifizierten Social Media Profile"}),o.jsx("li",{children:" Presseartikel oder Interviews ber dich"}),o.jsx("li",{children:" Visitenkarte oder Firmennachweis"}),o.jsx("li",{children:" Ausweisdokument (wird nach Prfung gelscht)"})]})]}),o.jsxs("label",{className:"block mb-4",children:[o.jsxs("div",{className:"border-2 border-dashed border-gray-700 rounded-xl p-8 text-center cursor-pointer hover:border-purple-500 transition-colors",children:[o.jsx(Dre,{size:32,className:"mx-auto mb-3 text-gray-500"}),o.jsx("p",{className:"text-gray-400 mb-1",children:"Dokumente hochladen"}),o.jsx("p",{className:"text-xs text-gray-500",children:"PDF, JPG, PNG (max. 10MB)"})]}),o.jsx("input",{type:"file",accept:".pdf,.jpg,.jpeg,.png",multiple:!0,onChange:ut,className:"hidden"})]}),se.length>0&&o.jsx("div",{className:"space-y-2 mb-6",children:se.map((He,bt)=>o.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-800/50 rounded-lg",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[He.type.includes("pdf")?o.jsx(ck,{size:20,className:"text-red-400"}):o.jsx(QTe,{size:20,className:"text-blue-400"}),o.jsx("span",{className:"text-sm text-gray-300 truncate max-w-[200px]",children:He.name})]}),o.jsx("button",{onClick:()=>yt(bt),className:"p-1 text-gray-500 hover:text-red-400",children:o.jsx(Rs,{size:18})})]},bt))}),o.jsx("button",{onClick:()=>B("review"),disabled:se.length===0,className:"w-full py-4 rounded-xl bg-gradient-to-r from-purple-500 to-pink-500 text-white font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:"Weiter zur berprfung"})]}),jt=async()=>{Z(!0),await new Promise(He=>setTimeout(He,2e3)),Z(!1),B("submitted")},Gt=()=>{var He,bt;return o.jsxs("div",{className:"px-4",children:[A==="community"&&o.jsxs("div",{className:"mb-4 p-3 bg-green-500/10 border border-green-500/30 rounded-xl flex items-center gap-3",children:[o.jsx(fS,{className:"text-green-400",size:24}),o.jsxs("div",{children:[o.jsx("p",{className:"text-green-400 font-medium text-sm",children:"Community Creator Bewerbung"}),o.jsx("p",{className:"text-gray-400 text-xs",children:"Schnelle Verifizierung durch Engagement"})]})]}),o.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"berprfe deine Angaben"}),o.jsx("p",{className:"text-gray-400 mb-6",children:"Stelle sicher, dass alles korrekt ist."}),o.jsxs("div",{className:"space-y-4 mb-8",children:[o.jsxs("div",{className:`p-4 rounded-xl ${A==="community"?"bg-green-900/30 border border-green-500/20":"bg-gray-800/50"}`,children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Kategorie"}),o.jsxs("p",{className:"text-white font-medium",children:[(He=ve.find(Wt=>Wt.value===q))==null?void 0:He.emoji," ",(bt=ve.find(Wt=>Wt.value===q))==null?void 0:bt.label]})]}),ee&&o.jsxs("div",{className:`p-4 rounded-xl ${A==="community"?"bg-green-900/30 border border-green-500/20":"bg-gray-800/50"}`,children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Beschreibung"}),o.jsx("p",{className:"text-gray-300 text-sm",children:ee})]}),A!=="community"&&ae&&o.jsxs("div",{className:"p-4 bg-gray-800/50 rounded-xl",children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Follower"}),o.jsx("p",{className:"text-white font-medium",children:parseInt(ae).toLocaleString()})]}),A==="community"&&o.jsxs("div",{className:"p-4 bg-green-900/30 border border-green-500/20 rounded-xl",children:[o.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Deine Community-Statistiken"}),o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Fs,{size:14,className:"text-amber-400"}),o.jsxs("span",{className:"text-sm text-gray-300",children:[l," Sterne"]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(eh,{size:14,className:"text-blue-400"}),o.jsxs("span",{className:"text-sm text-gray-300",children:[p," Min"]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(rr,{size:14,className:"text-purple-400"}),o.jsxs("span",{className:"text-sm text-gray-300",children:["Level ",u]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Vu,{size:14,className:"text-green-400"}),o.jsxs("span",{className:"text-sm text-gray-300",children:[x,"% Positiv"]})]})]})]}),o.jsxs("div",{className:`p-4 rounded-xl ${A==="community"?"bg-green-900/30 border border-green-500/20":"bg-gray-800/50"}`,children:[o.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Social Media"}),o.jsx("div",{className:"space-y-2",children:Q.map(Wt=>{const gn=qe.find(Sn=>Sn.value===Wt.platform),xt=gn.icon;return o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(xt,{size:16,style:{color:gn.color}}),o.jsxs("span",{className:"text-sm text-gray-300",children:["@",Wt.username]})]},Wt.platform)})})]}),A!=="community"&&o.jsxs("div",{className:"p-4 bg-gray-800/50 rounded-xl",children:[o.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Dokumente"}),o.jsxs("p",{className:"text-gray-300 text-sm",children:[se.length," Datei(en) hochgeladen"]})]})]}),o.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"Mit dem Absenden besttigst du, dass alle Angaben wahrheitsgem sind und du unseren Nutzungsbedingungen zustimmst."}),o.jsx("button",{onClick:jt,disabled:X,className:`w-full py-4 rounded-xl text-white font-semibold disabled:opacity-50 flex items-center justify-center gap-2 ${A==="community"?"bg-gradient-to-r from-green-500 to-emerald-500":"bg-gradient-to-r from-purple-500 to-pink-500"}`,children:X?o.jsxs(o.Fragment,{children:[o.jsx(Br,{size:20,className:"animate-spin"}),"Wird eingereicht..."]}):"Bewerbung einreichen"})]})},mn=()=>o.jsxs("div",{className:"px-4 text-center",children:[o.jsx("div",{className:"w-24 h-24 mx-auto mb-6 rounded-full flex items-center justify-center bg-green-500/20",children:A==="community"?o.jsx(fS,{size:48,className:"text-green-400"}):o.jsx(Vu,{size:48,className:"text-green-400"})}),o.jsx("h2",{className:"text-2xl font-bold text-white mb-3",children:A==="community"?"Community Creator Bewerbung eingereicht!":"Bewerbung eingereicht!"}),o.jsx("p",{className:"text-gray-400 mb-8",children:A==="community"?o.jsx(o.Fragment,{children:"Deine Bewerbung wird bevorzugt behandelt! Du erhltst innerhalb von 24 Stunden eine Antwort."}):o.jsx(o.Fragment,{children:"Unser Team wird deine Bewerbung innerhalb von 2-5 Werktagen prfen. Du erhltst eine Benachrichtigung, sobald eine Entscheidung getroffen wurde."})}),o.jsx("div",{className:`p-4 rounded-xl mb-8 ${A==="community"?"bg-green-500/10 border border-green-500/30":"bg-amber-500/10 border border-amber-500/30"}`,children:o.jsxs("div",{className:"flex items-center gap-3",children:[A==="community"?o.jsx(Vu,{size:20,className:"text-green-400"}):o.jsx(MF,{size:20,className:"text-amber-400"}),o.jsxs("div",{className:"text-left",children:[o.jsx("p",{className:`text-sm font-medium ${A==="community"?"text-green-300":"text-amber-300"}`,children:A==="community"?"Status: Bevorzugte Prfung":"Status: In Prfung"}),o.jsxs("p",{className:"text-xs text-gray-400",children:["Eingereicht am ",new Date().toLocaleDateString("de-DE")]})]})]})}),o.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"So wird dein Badge aussehen:"}),o.jsx("div",{className:"flex justify-center mb-8",children:o.jsx("div",{className:`flex items-center gap-3 px-4 py-3 rounded-xl ${A==="community"?"bg-green-900/30 border border-green-500/20":"bg-gray-800/50"}`,children:o.jsx(vy,{tier:"nebula",size:"lg",showLabel:!0})})}),o.jsx("button",{onClick:()=>s("/"),className:`w-full py-4 rounded-xl text-white font-semibold transition-colors ${A==="community"?"bg-gradient-to-r from-green-500 to-emerald-500 hover:opacity-90":"bg-gray-800 hover:bg-gray-700"}`,children:"Zurck zur App"})]}),Pt=()=>{switch(G){case"intro":return he();case"category":return ge();case"social":return ze();case"documents":return Xt();case"review":return Gt();case"submitted":return mn()}},Jt=()=>{const He=["intro","category","social","documents","review","submitted"];return(He.indexOf(G)+1)/He.length*100};return o.jsxs("div",{className:"min-h-screen bg-gray-950 pb-8",children:[o.jsxs("div",{className:"sticky top-0 z-10 bg-gray-950/95 backdrop-blur-sm border-b border-gray-800",children:[o.jsxs("div",{className:"flex items-center justify-between p-4",children:[o.jsx("button",{onClick:()=>{if(G==="intro"||G==="submitted")s(-1);else{const He=["intro","category","social","documents","review"],bt=He.indexOf(G);bt>0&&B(He[bt-1])}},className:"p-2 -m-2 text-gray-400 hover:text-white",children:o.jsx(sa,{size:24})}),o.jsx("span",{className:"text-sm text-gray-500",children:G!=="intro"&&G!=="submitted"&&`Schritt ${["category","social","documents","review"].indexOf(G)+1}/4`}),o.jsx("div",{className:"w-8"})]}),G!=="intro"&&G!=="submitted"&&o.jsx("div",{className:"h-1 bg-gray-800",children:o.jsx("div",{className:"h-full bg-gradient-to-r from-purple-500 to-pink-500 transition-all duration-300",style:{width:`${Jt()}%`}})})]}),o.jsx("div",{className:"pt-6",children:Pt()})]})},jCe=()=>{const s=zr(),{starProfile:n,user:i,isVerifiedStar:l}=mr(),[u,p]=H.useState("week");if(!(l&&n&&n.verifiedAt))return o.jsxs("div",{className:"min-h-screen bg-gray-950 pb-24",children:[o.jsx("div",{className:"sticky top-0 z-10 bg-gray-950/95 backdrop-blur-sm border-b border-gray-800",children:o.jsxs("div",{className:"flex items-center justify-between p-4",children:[o.jsx("button",{onClick:()=>s(-1),className:"p-2 -m-2 text-gray-400 hover:text-white",children:o.jsx(sa,{size:24})}),o.jsx("h1",{className:"text-lg font-bold text-white",children:"Stars Dashboard"}),o.jsx("div",{className:"w-10"})]})}),o.jsxs("div",{className:"p-6 flex flex-col items-center justify-center min-h-[60vh]",children:[o.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-purple-500/20 to-pink-500/20 rounded-full flex items-center justify-center mb-6 border border-purple-500/30",children:o.jsx(hs,{size:48,className:"text-purple-400"})}),o.jsx("h2",{className:"text-2xl font-bold text-white mb-3 text-center",children:"Verifizierung erforderlich"}),o.jsx("p",{className:"text-gray-400 text-center mb-8 max-w-sm",children:"Um das Stars Dashboard nutzen zu knnen, musst du dich erst als Creator verifizieren lassen. Nach erfolgreicher Prfung erhltst du Zugang zu allen Star-Features."}),o.jsxs("div",{className:"w-full max-w-sm space-y-4",children:[o.jsxs("button",{onClick:()=>s("/stars/apply"),className:"w-full py-4 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl text-white font-semibold flex items-center justify-center gap-2",children:[o.jsx(wr,{size:20}),"Als Creator bewerben"]}),o.jsx("button",{onClick:()=>s("/settings"),className:"w-full py-3 bg-gray-800/50 rounded-xl text-gray-400 font-medium border border-gray-700",children:"Zurck zu Einstellungen"})]}),o.jsxs("div",{className:"mt-8 p-4 bg-purple-500/10 rounded-xl border border-purple-500/30 max-w-sm",children:[o.jsxs("h3",{className:"font-semibold text-purple-300 mb-2 flex items-center gap-2",children:[o.jsx(im,{size:16}),"Wie werde ich Creator?"]}),o.jsxs("ul",{className:"text-sm text-gray-400 space-y-1",children:[o.jsx("li",{children:" Erflle die Mindestanforderungen"}),o.jsx("li",{children:" Reiche deine Bewerbung ein"}),o.jsx("li",{children:" Warte auf die Prfung durch unser Team"}),o.jsx("li",{children:" Nach Freischaltung: Voller Zugang!"})]})]})]})]});const y={userId:(i==null?void 0:i.id)||"",totalListeners:(n==null?void 0:n.totalListeners)||0,uniqueListeners:(n==null?void 0:n.uniqueListeners)||0,averageListenDuration:(n==null?void 0:n.averageListenDuration)||0,peakConcurrentListeners:(n==null?void 0:n.peakConcurrentListeners)||0,totalStarsReceived:(n==null?void 0:n.totalStarsReceived)||0,starsValue:((n==null?void 0:n.totalStarsReceived)||0)*.1,totalChatMessages:(n==null?void 0:n.totalChatMessages)||0,averageEngagementRate:(n==null?void 0:n.averageEngagementRate)||0,eventsHosted:(n==null?void 0:n.totalEventsHosted)||0,totalEventDuration:(n==null?void 0:n.totalEventDuration)||0,averageEventDuration:(n==null?void 0:n.averageEventDuration)||0,newFollowers:(n==null?void 0:n.newFollowers)||0,followerGrowthRate:(n==null?void 0:n.followerGrowthRate)||0,topSupporters:(n==null?void 0:n.topSupporters)||[],listenerLocations:(n==null?void 0:n.listenerLocations)||[],listenerAgeGroups:(n==null?void 0:n.listenerAgeGroups)||[]},x={userId:(n==null?void 0:n.userId)||(i==null?void 0:i.id)||"",username:(n==null?void 0:n.username)||(i==null?void 0:i.username)||"",displayName:(n==null?void 0:n.displayName)||(i==null?void 0:i.displayName)||"",avatar:(n==null?void 0:n.avatar)||(i==null?void 0:i.avatarUrl),verifiedAt:(n==null?void 0:n.verifiedAt)||null,category:(n==null?void 0:n.category)||"creator",nebulaTier:(n==null?void 0:n.nebulaTier)||"nebula",totalListeners:(n==null?void 0:n.totalListeners)||0,totalStarsReceived:(n==null?void 0:n.totalStarsReceived)||0,totalEventsHosted:(n==null?void 0:n.totalEventsHosted)||0,averageEventRating:(n==null?void 0:n.averageEventRating)||0,isLive:(n==null?void 0:n.isLive)||!1,permissions:(n==null?void 0:n.permissions)||{canMuteParticipants:!1,canManageHandRaise:!1,canStartRecording:!1,canVoiceLiftUsers:!1,maxVoiceLiftSlots:0,maxEventCapacity:0,hasAdvancedAnalytics:!1,canExportData:!1}},C={day:"Heute",week:"Diese Woche",month:"Diesen Monat",all_time:"Gesamt"};return o.jsxs("div",{className:"min-h-screen bg-gray-950 pb-24",children:[o.jsx("div",{className:"sticky top-0 z-10 bg-gray-950/95 backdrop-blur-sm border-b border-gray-800",children:o.jsxs("div",{className:"flex items-center justify-between p-4",children:[o.jsx("button",{onClick:()=>s(-1),className:"p-2 -m-2 text-gray-400 hover:text-white",children:o.jsx(sa,{size:24})}),o.jsx("h1",{className:"text-lg font-bold text-white",children:"Stars Dashboard"}),o.jsx("button",{className:"p-2 -m-2 text-gray-400 hover:text-white",children:o.jsx(BF,{size:20})})]})}),o.jsxs("div",{className:"p-4 space-y-6",children:[o.jsxs("div",{className:"relative bg-gradient-to-br from-purple-900/30 to-pink-900/30 rounded-2xl p-6 border border-purple-500/30",children:[o.jsx("div",{className:"absolute inset-0 rounded-2xl overflow-hidden",children:o.jsx("div",{className:"absolute inset-0 opacity-30",style:{background:"radial-gradient(circle at 30% 30%, rgba(139, 92, 246, 0.4), transparent 50%)"}})}),o.jsxs("div",{className:"relative flex items-start gap-4",children:[o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"w-20 h-20 rounded-full bg-cover bg-center border-3",style:{backgroundImage:x.avatar?`url(${x.avatar})`:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderColor:"#F59E0B",boxShadow:"0 0 30px rgba(245, 158, 11, 0.5)"}}),o.jsx("div",{className:"absolute -bottom-1 -right-1",children:o.jsx(vy,{tier:x.nebulaTier,size:"lg"})})]}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"flex items-center gap-2 mb-1",children:o.jsxs("h2",{className:"text-xl font-bold text-white",children:["@",x.username]})}),o.jsx("p",{className:"text-gray-400 mb-2",children:x.displayName}),o.jsx(Bre,{category:x.category})]})]}),o.jsxs("div",{className:"relative grid grid-cols-3 gap-4 mt-6 pt-6 border-t border-gray-700/50",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-2xl font-bold text-white",children:x.totalListeners.toLocaleString()}),o.jsx("p",{className:"text-xs text-gray-400",children:"Zuhrer"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-2xl font-bold text-amber-400",children:x.totalStarsReceived.toLocaleString()}),o.jsx("p",{className:"text-xs text-gray-400",children:"Sterne"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-2xl font-bold text-white",children:x.totalEventsHosted}),o.jsx("p",{className:"text-xs text-gray-400",children:"Events"})]})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs("button",{onClick:()=>s("/stars/event/new"),className:"flex items-center justify-center gap-2 p-4 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl text-white font-semibold",children:[o.jsx(kre,{size:20}),"Event starten"]}),o.jsxs("button",{onClick:()=>s("/stars/schedule"),className:"flex items-center justify-center gap-2 p-4 bg-gray-800/50 rounded-xl text-gray-300 font-medium border border-gray-700",children:[o.jsx(rm,{size:20}),"Planen"]})]}),o.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 -mx-4 px-4",children:["day","week","month","all_time"].map(k=>o.jsx("button",{onClick:()=>p(k),className:`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all ${u===k?"bg-purple-500 text-white":"bg-gray-800/50 text-gray-400 hover:bg-gray-700/50"}`,children:C[k]},k))}),o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsx(yE,{icon:o.jsx(rr,{className:"text-blue-400"}),label:"Zuhrer",value:y.totalListeners.toLocaleString(),subvalue:`${y.uniqueListeners.toLocaleString()} unique`,trend:12.5}),o.jsx(yE,{icon:o.jsx(Fs,{className:"text-amber-400"}),label:"Sterne",value:y.totalStarsReceived.toLocaleString(),subvalue:`${y.starsValue.toFixed(2)}`,trend:8.3}),o.jsx(yE,{icon:o.jsx(Gi,{className:"text-green-400"}),label:" Hrdauer",value:`${y.averageListenDuration}m`,subvalue:"pro Session",trend:3.2}),o.jsx(yE,{icon:o.jsx(im,{className:"text-purple-400"}),label:"Engagement",value:`${y.averageEngagementRate}%`,subvalue:"Interaktionsrate",trend:5.1}),o.jsx(yE,{icon:o.jsx(Ta,{className:"text-pink-400"}),label:"Peak",value:y.peakConcurrentListeners.toLocaleString(),subvalue:"gleichzeitig"}),o.jsx(yE,{icon:o.jsx(im,{className:"text-cyan-400"}),label:"Wachstum",value:`+${y.newFollowers.toLocaleString()}`,subvalue:`${y.followerGrowthRate}% `,trend:y.followerGrowthRate})]}),o.jsxs("div",{className:"bg-gray-800/30 rounded-2xl p-4 border border-gray-700/50",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("h3",{className:"font-semibold text-white flex items-center gap-2",children:[o.jsx(hs,{size:18,className:"text-amber-400"}),"Top Supporter"]}),o.jsx("button",{className:"text-sm text-purple-400",children:"Alle anzeigen"})]}),o.jsx("div",{className:"space-y-3",children:y.topSupporters.slice(0,5).map((k,A)=>o.jsx(MCe,{supporter:k,rank:A+1},k.userId))})]}),o.jsxs("div",{className:"bg-gray-800/30 rounded-2xl p-4 border border-gray-700/50",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("h3",{className:"font-semibold text-white flex items-center gap-2",children:[o.jsx(wr,{size:18,className:"text-purple-400"}),"Deine Star-Features"]}),o.jsx(vy,{tier:x.nebulaTier,size:"sm",showLabel:!0})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsx(bE,{icon:o.jsx(pO,{size:16}),label:"Stummschalten",enabled:x.permissions.canMuteParticipants}),o.jsx(bE,{icon:o.jsx(pV,{size:16}),label:"Hand-Management",enabled:x.permissions.canManageHandRaise}),o.jsx(bE,{icon:o.jsx(wr,{size:16}),label:"Voice Lift",enabled:x.permissions.canVoiceLiftUsers,extra:`${x.permissions.maxVoiceLiftSlots} Slots`}),o.jsx(bE,{icon:o.jsx(eh,{size:16}),label:"Aufnahme",enabled:x.permissions.canStartRecording}),o.jsx(bE,{icon:o.jsx(rr,{size:16}),label:"Kapazitt",enabled:!0,extra:`${x.permissions.maxEventCapacity}`}),o.jsx(bE,{icon:o.jsx(mS,{size:16}),label:"Analytics",enabled:x.permissions.hasAdvancedAnalytics})]})]}),x.permissions.canExportData&&o.jsxs("button",{className:"w-full flex items-center justify-center gap-2 p-4 bg-gray-800/50 rounded-xl text-gray-300 border border-gray-700 hover:bg-gray-700/50 transition-colors",children:[o.jsx(eRe,{size:20}),"Analytics exportieren (CSV)"]})]})]})},yE=({icon:s,label:n,value:i,subvalue:l,trend:u})=>o.jsxs("div",{className:"bg-gray-800/30 rounded-xl p-4 border border-gray-700/50",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s,o.jsx("span",{className:"text-sm text-gray-400",children:n})]}),o.jsx("p",{className:"text-2xl font-bold text-white",children:i}),o.jsxs("div",{className:"flex items-center justify-between mt-1",children:[l&&o.jsx("span",{className:"text-xs text-gray-500",children:l}),u!==void 0&&o.jsxs("span",{className:`text-xs font-medium ${u>=0?"text-green-400":"text-red-400"}`,children:[u>=0?"+":"",u.toFixed(1),"%"]})]})]}),MCe=({supporter:s,rank:n})=>{const i=["text-amber-400","text-gray-400","text-orange-400"];return o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:`w-6 text-center font-bold ${i[n-1]||"text-gray-500"}`,children:n}),o.jsx("div",{className:"w-10 h-10 rounded-full bg-cover bg-center",style:{backgroundImage:s.avatar?`url(${s.avatar})`:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("p",{className:"font-medium text-white truncate",children:["@",s.username]}),o.jsxs("p",{className:"text-xs text-gray-500",children:[s.eventsAttended," Events besucht"]})]}),o.jsx("div",{className:"text-right",children:o.jsxs("p",{className:"font-semibold text-amber-400 flex items-center gap-1",children:[o.jsx(Fs,{size:14}),s.starsGiven]})})]})},bE=({icon:s,label:n,enabled:i,extra:l})=>o.jsxs("div",{className:`flex items-center gap-2 p-2 rounded-lg ${i?"bg-purple-500/10 text-purple-300":"bg-gray-800/30 text-gray-500"}`,children:[s,o.jsx("span",{className:"text-xs",children:n}),l&&o.jsx("span",{className:"text-[10px] ml-auto opacity-70",children:l})]}),UCe=[{id:"1",hostId:"user1",hostUsername:"max_official",hostDisplayName:"Max Mustermann",hostTier:"supernova",title:"Abend Q&A mit der Community",description:"Ich beantworte eure Fragen zu meinem neuen Projekt und mehr!",category:"qa",scheduledAt:new Date(Date.now()+2*60*60*1e3),estimatedDuration:60,interestedCount:234,status:"scheduled"},{id:"2",hostId:"user1",hostUsername:"max_official",hostDisplayName:"Max Mustermann",hostTier:"supernova",title:"Wochenend-Chill & Music",description:"Entspannter Samstag mit guter Musik und netten Gesprchen",category:"music",scheduledAt:new Date(Date.now()+48*60*60*1e3),estimatedDuration:120,interestedCount:89,status:"scheduled"}],f_={qa:{icon:eh,label:"Q&A",color:"text-purple-400"},talk:{icon:V_,label:"Talk",color:"text-blue-400"},interview:{icon:Pre,label:"Interview",color:"text-orange-400"},music:{icon:pRe,label:"Musik",color:"text-pink-400"},gaming:{icon:nRe,label:"Gaming",color:"text-green-400"},education:{icon:rRe,label:"Bildung",color:"text-indigo-400"},business:{icon:JTe,label:"Business",color:"text-yellow-400"},casual:{icon:ZTe,label:"Casual",color:"text-cyan-400"},other:{icon:wr,label:"Sonstiges",color:"text-gray-400"}};function VCe(){const s=zr(),{isVerifiedStar:n}=mr(),[i,l]=H.useState(UCe),[u,p]=H.useState(!1),[g,y]=H.useState(null);if(!n)return o.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center p-4",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"w-16 h-16 bg-purple-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:o.jsx(rm,{className:"w-8 h-8 text-purple-400"})}),o.jsx("h2",{className:"text-xl font-bold mb-2",children:"Nur fr verifizierte Stars"}),o.jsx("p",{className:"text-gray-400 mb-6",children:"Event-Planung ist nur fr verifizierte Creator verfgbar."}),o.jsx("button",{onClick:()=>s("/stars/apply"),className:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl font-medium",children:"Star werden"})]})});const x=A=>{const M=new Date,G=A.getTime()-M.getTime(),B=Math.floor(G/(1e3*60*60)),X=Math.floor(B/24);if(X>0)return`In ${X} Tag${X>1?"en":""}`;if(B>0)return`In ${B} Stunde${B>1?"n":""}`;{const Z=Math.floor(G/6e4);return`In ${Z} Minute${Z>1?"n":""}`}},C=A=>{l(i.filter(M=>M.id!==A))},k=A=>{s("/discover")};return o.jsxs("div",{className:"min-h-screen bg-black text-white pb-24",children:[o.jsx("div",{className:"sticky top-0 z-50 bg-black/90 backdrop-blur-lg border-b border-white/10",children:o.jsxs("div",{className:"flex items-center justify-between p-4",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("button",{onClick:()=>s(-1),className:"p-2 hover:bg-white/10 rounded-xl transition-colors",children:o.jsx(sa,{className:"w-5 h-5"})}),o.jsxs("div",{children:[o.jsx("h1",{className:"text-lg font-bold",children:"Event-Planung"}),o.jsx("p",{className:"text-xs text-gray-400",children:"Plane deine nchsten Sessions"})]})]}),o.jsx("button",{onClick:()=>p(!0),className:"p-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl",children:o.jsx($S,{className:"w-5 h-5"})})]})}),o.jsxs("div",{className:"p-4 grid grid-cols-3 gap-3",children:[o.jsxs("div",{className:"bg-white/5 rounded-xl p-3 text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-purple-400",children:i.length}),o.jsx("div",{className:"text-xs text-gray-400",children:"Geplant"})]}),o.jsxs("div",{className:"bg-white/5 rounded-xl p-3 text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-pink-400",children:i.reduce((A,M)=>A+M.interestedCount,0)}),o.jsx("div",{className:"text-xs text-gray-400",children:"Interessiert"})]}),o.jsxs("div",{className:"bg-white/5 rounded-xl p-3 text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-cyan-400",children:i.filter(A=>{const M=new Date(A.scheduledAt).getTime()-Date.now();return M<24*60*60*1e3&&M>0}).length}),o.jsx("div",{className:"text-xs text-gray-400",children:"Heute"})]})]}),o.jsxs("div",{className:"p-4 space-y-4",children:[o.jsxs("h2",{className:"text-lg font-bold flex items-center gap-2",children:[o.jsx(rm,{className:"w-5 h-5 text-purple-400"}),"Geplante Events"]}),i.length===0?o.jsxs("div",{className:"bg-white/5 rounded-2xl p-8 text-center",children:[o.jsx("div",{className:"w-16 h-16 bg-purple-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:o.jsx(rm,{className:"w-8 h-8 text-purple-400"})}),o.jsx("h3",{className:"font-bold mb-2",children:"Keine Events geplant"}),o.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Plane dein erstes Event, damit deine Follower wissen, wann du live gehst!"}),o.jsx("button",{onClick:()=>p(!0),className:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl font-medium",children:"Event erstellen"})]}):o.jsx("div",{className:"space-y-3",children:i.map(A=>{const M=f_[A.category].icon,G=new Date(A.scheduledAt).getTime()-Date.now()<30*60*1e3;return o.jsxs("div",{className:`bg-white/5 rounded-2xl p-4 border ${G?"border-purple-500/50":"border-transparent"}`,children:[o.jsxs("div",{className:"flex items-start justify-between mb-3",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:`w-10 h-10 rounded-xl bg-white/10 flex items-center justify-center ${f_[A.category].color}`,children:o.jsx(M,{className:"w-5 h-5"})}),o.jsxs("div",{children:[o.jsx("h3",{className:"font-bold",children:A.title}),o.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[o.jsx("span",{className:f_[A.category].color,children:f_[A.category].label}),o.jsx("span",{children:""}),o.jsxs("span",{children:[A.estimatedDuration," Min"]})]})]})]}),o.jsxs("div",{className:"flex gap-1",children:[o.jsx("button",{onClick:()=>y(A),className:"p-2 hover:bg-white/10 rounded-lg transition-colors",children:o.jsx(fRe,{className:"w-4 h-4 text-gray-400"})}),o.jsx("button",{onClick:()=>C(A.id),className:"p-2 hover:bg-red-500/20 rounded-lg transition-colors",children:o.jsx(Jh,{className:"w-4 h-4 text-red-400"})})]})]}),A.description&&o.jsx("p",{className:"text-sm text-gray-400 mb-3",children:A.description}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[o.jsx(Gi,{className:"w-4 h-4 text-purple-400"}),o.jsx("span",{className:G?"text-purple-400 font-medium":"text-gray-400",children:x(new Date(A.scheduledAt))})]}),o.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[o.jsx(Xc,{className:"w-4 h-4 text-pink-400"}),o.jsxs("span",{className:"text-gray-400",children:[A.interestedCount," interessiert"]})]})]}),G&&o.jsxs("button",{onClick:()=>k(),className:"px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl text-sm font-medium flex items-center gap-2",children:[o.jsx(lk,{className:"w-4 h-4"}),"Jetzt starten"]})]}),G&&o.jsxs("div",{className:"mt-3 px-3 py-2 bg-purple-500/20 rounded-xl flex items-center gap-2",children:[o.jsx("div",{className:"w-2 h-2 bg-purple-400 rounded-full animate-pulse"}),o.jsx("span",{className:"text-sm text-purple-300",children:"Event startet bald!"})]})]},A.id)})})]}),o.jsx("div",{className:"p-4",children:o.jsxs("div",{className:"bg-gradient-to-br from-purple-500/10 to-pink-500/10 rounded-2xl p-4 border border-purple-500/20",children:[o.jsxs("h3",{className:"font-bold mb-2 flex items-center gap-2",children:[o.jsx(wr,{className:"w-5 h-5 text-purple-400"}),"Tipps fr bessere Events"]}),o.jsxs("ul",{className:"space-y-2 text-sm text-gray-400",children:[o.jsxs("li",{className:"flex items-start gap-2",children:[o.jsx(zn,{className:"w-4 h-4 text-green-400 mt-0.5 shrink-0"}),"Plane Events mindestens 24h im Voraus"]}),o.jsxs("li",{className:"flex items-start gap-2",children:[o.jsx(zn,{className:"w-4 h-4 text-green-400 mt-0.5 shrink-0"}),"Fge eine aussagekrftige Beschreibung hinzu"]}),o.jsxs("li",{className:"flex items-start gap-2",children:[o.jsx(zn,{className:"w-4 h-4 text-green-400 mt-0.5 shrink-0"}),"Whle Zeiten, wenn deine Follower aktiv sind"]})]})]})}),u&&o.jsx(FJ,{onClose:()=>p(!1),onSave:A=>{l([...i,A]),p(!1)}}),g&&o.jsx(FJ,{event:g,onClose:()=>y(null),onSave:A=>{l(i.map(M=>M.id===A.id?A:M)),y(null)}})]})}function FJ({event:s,onClose:n,onSave:i}){const{user:l,starProfile:u}=mr(),[p,g]=H.useState((s==null?void 0:s.title)||""),[y,x]=H.useState((s==null?void 0:s.description)||""),[C,k]=H.useState((s==null?void 0:s.category)||"talk"),[A,M]=H.useState(s!=null&&s.scheduledAt?new Date(s.scheduledAt).toISOString().split("T")[0]:new Date(Date.now()+24*60*60*1e3).toISOString().split("T")[0]),[G,B]=H.useState(s!=null&&s.scheduledAt?new Date(s.scheduledAt).toTimeString().slice(0,5):"19:00"),[X,Z]=H.useState((s==null?void 0:s.estimatedDuration)||60),q=()=>{if(!p.trim())return;const V=new Date(`${A}T${G}:00`),ee={id:(s==null?void 0:s.id)||`event-${Date.now()}`,hostId:(l==null?void 0:l.id)||"",hostUsername:(l==null?void 0:l.username)||"",hostDisplayName:(l==null?void 0:l.displayName)||(l==null?void 0:l.username)||"",hostAvatar:l==null?void 0:l.avatar,hostTier:(u==null?void 0:u.nebulaTier)||"nebula",title:p,description:y,category:C,scheduledAt:V,estimatedDuration:X,interestedCount:(s==null?void 0:s.interestedCount)||0,status:"scheduled"};i(ee)};return o.jsxs("div",{className:"fixed inset-0 z-50 flex items-end justify-center",children:[o.jsx("div",{className:"absolute inset-0 bg-black/80",onClick:n}),o.jsxs("div",{className:"relative w-full max-w-lg bg-gray-900 rounded-t-3xl max-h-[90vh] overflow-y-auto",children:[o.jsxs("div",{className:"sticky top-0 bg-gray-900 p-4 border-b border-white/10 flex items-center justify-between",children:[o.jsx("h2",{className:"text-lg font-bold",children:s?"Event bearbeiten":"Neues Event"}),o.jsx("button",{onClick:n,className:"p-2 hover:bg-white/10 rounded-xl",children:o.jsx(Rs,{className:"w-5 h-5"})})]}),o.jsxs("div",{className:"p-4 space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",children:"Titel *"}),o.jsx("input",{type:"text",value:p,onChange:V=>g(V.target.value),placeholder:"z.B. Abend Q&A mit der Community",className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl focus:outline-none focus:border-purple-500",maxLength:50}),o.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[p.length,"/50"]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",children:"Beschreibung"}),o.jsx("textarea",{value:y,onChange:V=>x(V.target.value),placeholder:"Worum geht es in deinem Event?",className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl focus:outline-none focus:border-purple-500 resize-none h-24",maxLength:200}),o.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[y.length,"/200"]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",children:"Kategorie"}),o.jsx("div",{className:"grid grid-cols-3 gap-2",children:Object.entries(f_).map(([V,ee])=>{const de=ee.icon;return o.jsxs("button",{onClick:()=>k(V),className:`p-3 rounded-xl border text-sm flex flex-col items-center gap-1 transition-all ${C===V?"border-purple-500 bg-purple-500/20":"border-white/10 bg-white/5 hover:bg-white/10"}`,children:[o.jsx(de,{className:`w-5 h-5 ${ee.color}`}),o.jsx("span",{children:ee.label})]},V)})})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",children:"Datum"}),o.jsx("input",{type:"date",value:A,onChange:V=>M(V.target.value),min:new Date().toISOString().split("T")[0],className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl focus:outline-none focus:border-purple-500"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",children:"Uhrzeit"}),o.jsx("input",{type:"time",value:G,onChange:V=>B(V.target.value),className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl focus:outline-none focus:border-purple-500"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",children:"Geplante Dauer"}),o.jsx("div",{className:"flex gap-2",children:[30,60,90,120].map(V=>o.jsxs("button",{onClick:()=>Z(V),className:`flex-1 py-3 rounded-xl border text-sm transition-all ${X===V?"border-purple-500 bg-purple-500/20":"border-white/10 bg-white/5 hover:bg-white/10"}`,children:[V," Min"]},V))})]}),o.jsxs("div",{className:"bg-white/5 rounded-xl p-4 border border-white/10",children:[o.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"Vorschau fr Follower"}),o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:`w-10 h-10 rounded-xl bg-white/10 flex items-center justify-center ${f_[C].color}`,children:(()=>{const V=f_[C].icon;return o.jsx(V,{className:"w-5 h-5"})})()}),o.jsxs("div",{children:[o.jsx("div",{className:"font-medium",children:p||"Event Titel"}),o.jsxs("div",{className:"text-xs text-gray-400",children:[new Date(`${A}T${G}`).toLocaleDateString("de-DE",{weekday:"short",day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}),"  ",X," Min"]})]})]})]}),o.jsx("button",{onClick:q,disabled:!p.trim(),className:"w-full py-4 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl font-bold disabled:opacity-50 disabled:cursor-not-allowed",children:s?"nderungen speichern":"Event erstellen"})]})]})]})}const FCe=({isOpen:s,onClose:n,userId:i,username:l,displayName:u,isCurrentlyBlocked:p})=>{const{blockUser:g,unblockUser:y}=gO(),[x,C]=H.useState("personal"),[k,A]=H.useState(""),[M,G]=H.useState(!1),[B,X]=H.useState(!1),Z=async()=>{G(!0);const ee=await g(i,x,x==="other"?k:void 0);G(!1),ee&&(X(!0),setTimeout(()=>{n(),X(!1)},1500))},q=async()=>{G(!0);const ee=await y(i);G(!1),ee&&(X(!0),setTimeout(()=>{n(),X(!1)},1500))};if(!s)return null;const V=u||`@${l}`;return B?o.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:o.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-sm p-6 text-center animate-in zoom-in-95",children:[o.jsx("div",{className:`w-16 h-16 mx-auto rounded-full ${p?"bg-green-100":"bg-red-100"} flex items-center justify-center mb-4`,children:p?o.jsx(am,{size:28,className:"text-green-500"}):o.jsx(zn,{size:28,className:"text-red-500"})}),o.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:p?"Entblockt!":"Blockiert!"}),o.jsx("p",{className:"text-gray-500 text-sm",children:p?`${V} kann dich jetzt wieder kontaktieren.`:`${V} kann dich nicht mehr kontaktieren.`})]})}):p?o.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:o.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-sm p-6 animate-in zoom-in-95",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Nutzer entblocken"}),o.jsx("button",{onClick:n,className:"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center",children:o.jsx(Rs,{size:18,className:"text-gray-500"})})]}),o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("div",{className:"w-16 h-16 mx-auto rounded-full bg-green-100 flex items-center justify-center mb-4",children:o.jsx(am,{size:28,className:"text-green-500"})}),o.jsx("p",{className:"font-semibold text-gray-900 mb-2",children:V}),o.jsx("p",{className:"text-sm text-gray-500",children:"Nach dem Entblocken kann diese Person dich wieder kontaktieren und in Voice-Chats sehen."})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:n,className:"flex-1 py-3 bg-gray-100 text-gray-600 rounded-xl font-semibold",children:"Abbrechen"}),o.jsx("button",{onClick:q,disabled:M,className:"flex-1 py-3 bg-green-500 text-white rounded-xl font-semibold flex items-center justify-center gap-2",children:M?o.jsx(Br,{size:18,className:"animate-spin"}):o.jsxs(o.Fragment,{children:[o.jsx(am,{size:18}),"Entblocken"]})})]})]})}):o.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:o.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-sm p-6 animate-in zoom-in-95 max-h-[90vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Nutzer blockieren"}),o.jsx("button",{onClick:n,className:"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center",children:o.jsx(Rs,{size:18,className:"text-gray-500"})})]}),o.jsxs("p",{className:"text-gray-500 text-sm mb-4",children:[o.jsx("span",{className:"font-semibold text-gray-900",children:V})," wird dich nicht mehr kontaktieren knnen."]}),o.jsxs("div",{className:"mb-4",children:[o.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Grund (optional)"}),o.jsx("div",{className:"space-y-2",children:iCe.map(ee=>o.jsxs("button",{onClick:()=>C(ee.id),className:`w-full flex items-center gap-3 p-3 rounded-xl border-2 transition-all ${x===ee.id?"border-violet-500 bg-violet-50":"border-gray-200 hover:border-gray-300"}`,children:[o.jsx("span",{className:"text-lg",children:ee.icon}),o.jsx("span",{className:"text-sm font-medium text-gray-700",children:ee.label}),x===ee.id&&o.jsx(zn,{size:16,className:"text-violet-500 ml-auto"})]},ee.id))})]}),x==="other"&&o.jsx("div",{className:"mb-4",children:o.jsx("input",{type:"text",value:k,onChange:ee=>A(ee.target.value),placeholder:"Grund eingeben (optional)",maxLength:100,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-violet-500 focus:outline-none"})}),o.jsx("div",{className:"p-3 bg-amber-50 rounded-xl border border-amber-200 mb-4",children:o.jsxs("div",{className:"flex gap-2",children:[o.jsx(ql,{size:16,className:"text-amber-500 flex-shrink-0 mt-0.5"}),o.jsx("p",{className:"text-xs text-amber-700",children:"Blockierte Personen erfahren nicht, dass sie blockiert wurden. Du kannst sie jederzeit wieder entblocken."})]})}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:n,className:"flex-1 py-3 bg-gray-100 text-gray-600 rounded-xl font-semibold",children:"Abbrechen"}),o.jsx("button",{onClick:Z,disabled:M,className:"flex-1 py-3 bg-red-500 text-white rounded-xl font-semibold flex items-center justify-center gap-2",children:M?o.jsx(Br,{size:18,className:"animate-spin"}):o.jsxs(o.Fragment,{children:[o.jsx(li,{size:18}),"Blockieren"]})})]})]})})},BCe=()=>{const{userId:s}=Eee(),n=zr(),{user:i}=mr(),{isBlocked:l,isBlockedBy:u}=gO(),[p,g]=H.useState(null),[y,x]=H.useState(!0),[C,k]=H.useState(!1),[A,M]=H.useState(!1),[G,B]=H.useState(!1),[X,Z]=H.useState(!1),q=s?l(s):!1;s&&u(s),H.useEffect(()=>{(async()=>{var ye;if(s)try{const Q=await fr(at(Me,"users",s));if(Q.exists()){const $=Q.data();g({id:Q.id,username:$.username||"unknown",displayName:$.displayName||"Unbekannt",bio:$.bio||"",avatar:$.avatar,avatarUrl:$.avatarUrl||$.photoURL,level:$.level||1,xp:$.xp||0,joinedAt:((ye=$.createdAt)==null?void 0:ye.toDate())||new Date,isVerified:$.isVerified||!1,isCreator:$.isCreator||!1,friendsCount:$.friendsCount||0,roomsJoined:$.roomsJoined||0,minutesTalked:$.minutesTalked||0,birthDay:$.birthDay,birthMonth:$.birthMonth,showBirthdateOnProfile:$.showBirthdateOnProfile!==!1,city:$.city})}}catch(Q){console.error("Error fetching user:",Q)}finally{x(!1)}})()},[s]),H.useEffect(()=>{(async()=>{if(!(!s||!(i!=null&&i.id)))try{const ye=Zr(xn(Me,"friends"),or("users","array-contains",i.id)),$=(await Ur(ye)).docs.some(he=>he.data().users.includes(s));k($);const se=Zr(xn(Me,"friendRequests"),or("fromId","==",i.id),or("toId","==",s),or("status","==","pending")),ce=await Ur(se);M(!ce.empty)}catch(ye){console.error("Error checking friendship:",ye)}})()},[s,i==null?void 0:i.id]);const V=async()=>{if(!(!s||!(i!=null&&i.id)||G)){B(!0);try{await my(xn(Me,"friendRequests"),{fromId:i.id,fromUsername:i.username,fromDisplayName:i.displayName,toId:s,toUsername:p==null?void 0:p.username,status:"pending",createdAt:cn.now()}),M(!0)}catch(ae){console.error("Error sending friend request:",ae)}finally{B(!1)}}},ee=()=>{n("/messages",{state:{openChat:s}})},de=ae=>ae.toLocaleDateString("de-DE",{month:"long",year:"numeric"});return y?o.jsx("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white flex items-center justify-center",children:o.jsx(Br,{size:32,className:"animate-spin text-delulu-violet"})}):p?s===(i==null?void 0:i.id)?(n("/profile"),null):o.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white safe-top pb-24",children:[o.jsx("div",{className:"px-6 pt-6",children:o.jsx("button",{onClick:()=>n(-1),className:"w-10 h-10 rounded-xl bg-white shadow-sm flex items-center justify-center mb-6",children:o.jsx(sa,{size:20,className:"text-delulu-text"})})}),o.jsxs("div",{className:"px-6 text-center mb-6",children:[o.jsxs("div",{className:"relative inline-block mb-4",children:[o.jsx("div",{className:`w-28 h-28 rounded-full flex items-center justify-center text-4xl ${p.isCreator?"bg-gradient-to-br from-purple-500 to-pink-500 text-white":"bg-delulu-violet/10"}`,children:p.avatar||""}),p.isVerified&&o.jsx("div",{className:"absolute -bottom-1 -right-1 w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center border-4 border-white",children:o.jsx(C4,{size:16,className:"text-white"})}),p.isCreator&&o.jsx("div",{className:"absolute -top-1 -right-1 w-8 h-8 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center border-4 border-white",children:o.jsx(Fs,{size:14,className:"text-white"})})]}),o.jsx("h1",{className:"font-display text-2xl font-bold text-delulu-text mb-1",children:p.displayName}),o.jsxs("p",{className:"text-delulu-muted mb-2",children:["@",p.username]}),o.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-delulu-violet/10 rounded-full mb-4",children:[o.jsx(fS,{size:16,className:"text-delulu-violet"}),o.jsxs("span",{className:"font-semibold text-delulu-violet",children:["Level ",p.level]})]}),p.bio&&o.jsx("p",{className:"text-sm text-delulu-text max-w-xs mx-auto mb-4",children:p.bio}),p.showBirthdateOnProfile&&p.birthDay&&p.birthMonth&&o.jsxs("p",{className:"text-xs text-delulu-muted flex items-center justify-center gap-2 mb-1",children:[o.jsx(VF,{size:12}),o.jsxs("span",{children:[p.birthDay,". ",zCe(p.birthMonth)]}),p.city&&o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"text-gray-300",children:""}),o.jsx(_c,{size:12}),o.jsx("span",{children:p.city})]})]}),o.jsxs("p",{className:"text-xs text-delulu-muted flex items-center justify-center gap-1",children:[o.jsx(rm,{size:12}),"Dabei seit ",de(p.joinedAt)]})]}),o.jsx("div",{className:"px-6 mb-6",children:o.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[o.jsxs("div",{className:"bg-white rounded-2xl p-4 text-center shadow-sm",children:[o.jsx(rr,{size:20,className:"mx-auto text-delulu-violet mb-2"}),o.jsx("p",{className:"font-bold text-delulu-text",children:p.friendsCount}),o.jsx("p",{className:"text-xs text-delulu-muted",children:"Freunde"})]}),o.jsxs("div",{className:"bg-white rounded-2xl p-4 text-center shadow-sm",children:[o.jsx(eh,{size:20,className:"mx-auto text-green-500 mb-2"}),o.jsx("p",{className:"font-bold text-delulu-text",children:p.roomsJoined}),o.jsx("p",{className:"text-xs text-delulu-muted",children:"Rume"})]}),o.jsxs("div",{className:"bg-white rounded-2xl p-4 text-center shadow-sm",children:[o.jsx(Fs,{size:20,className:"mx-auto text-amber-500 mb-2"}),o.jsxs("p",{className:"font-bold text-delulu-text",children:[Math.floor(p.minutesTalked/60),"h"]}),o.jsx("p",{className:"text-xs text-delulu-muted",children:"Gesprochen"})]})]})}),o.jsxs("div",{className:"px-6 space-y-3",children:[C?o.jsxs("div",{className:"flex gap-3",children:[o.jsxs("button",{onClick:ee,className:"flex-1 py-4 bg-delulu-violet text-white rounded-2xl font-semibold flex items-center justify-center gap-2",children:[o.jsx(V_,{size:20}),"Nachricht"]}),o.jsx("button",{className:"w-14 h-14 bg-gray-100 text-gray-500 rounded-2xl flex items-center justify-center",children:o.jsx(SRe,{size:20})})]}):A?o.jsxs("button",{disabled:!0,className:"w-full py-4 bg-gray-100 text-gray-500 rounded-2xl font-semibold flex items-center justify-center gap-2",children:[o.jsx(C4,{size:20}),"Anfrage gesendet"]}):o.jsxs("button",{onClick:V,disabled:G,className:"w-full py-4 bg-delulu-violet text-white rounded-2xl font-semibold flex items-center justify-center gap-2 disabled:opacity-50",children:[G?o.jsx(Br,{size:20,className:"animate-spin"}):o.jsx(ep,{size:20}),"Freund hinzufgen"]}),o.jsx("button",{onClick:()=>Z(!0),className:`w-full py-3 rounded-xl font-medium flex items-center justify-center gap-2 text-sm ${q?"bg-green-100 text-green-600":"bg-red-50 text-red-500"}`,children:q?o.jsxs(o.Fragment,{children:[o.jsx(_Re,{size:16}),"Entblocken"]}):o.jsxs(o.Fragment,{children:[o.jsx(li,{size:16}),"Blockieren"]})}),o.jsxs("button",{className:"w-full py-3 bg-gray-100 text-gray-500 rounded-xl font-medium flex items-center justify-center gap-2 text-sm",children:[o.jsx(Nre,{size:16}),"Nutzer melden"]})]}),o.jsx(FCe,{isOpen:X,onClose:()=>Z(!1),userId:s||"",username:(p==null?void 0:p.username)||"",displayName:p==null?void 0:p.displayName,isCurrentlyBlocked:q})]}):o.jsx("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white safe-top pb-24",children:o.jsxs("div",{className:"px-6 pt-6",children:[o.jsx("button",{onClick:()=>n(-1),className:"w-10 h-10 rounded-xl bg-white shadow-sm flex items-center justify-center mb-6",children:o.jsx(sa,{size:20,className:"text-delulu-text"})}),o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"w-28 h-28 mx-auto rounded-full bg-delulu-violet/10 flex items-center justify-center mb-4",children:o.jsx("span",{className:"text-4xl",children:""})}),o.jsx("h1",{className:"font-display text-xl font-bold text-delulu-text mb-2",children:"Delulu Nutzer"}),o.jsx("p",{className:"text-sm text-delulu-muted mb-6",children:"Profil wird geladen..."}),o.jsx("button",{onClick:V,disabled:G||A,className:"w-full max-w-xs mx-auto py-4 bg-delulu-violet text-white rounded-2xl font-semibold flex items-center justify-center gap-2 disabled:opacity-50",children:G?o.jsx(Br,{size:20,className:"animate-spin"}):A?o.jsxs(o.Fragment,{children:[o.jsx(C4,{size:20}),"Anfrage gesendet"]}):o.jsxs(o.Fragment,{children:[o.jsx(ep,{size:20}),"Freund hinzufgen"]})})]})]})})},zCe=s=>["Januar","Februar","Mrz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"][s-1]||"",GCe=({user:s,addLog:n})=>{const{config:i}=Tre(),[l,u]=H.useState(!1),[p,g]=H.useState(""),[y,x]=H.useState(30),C=async()=>{u(!0);try{const A=!i.maintenanceMode;await BTe(A,s.id,p||void 0,A?y:void 0),n(A?" Wartungsmodus AKTIVIERT":" Wartungsmodus DEAKTIVIERT")}catch{n(" Fehler beim Umschalten des Wartungsmodus")}u(!1)},k=async(A,M)=>{try{await mre({features:{...i.features,[A]:M}},s.id),n(`Feature "${A}" ${M?"aktiviert":"deaktiviert"}`)}catch{n(` Fehler beim Aktualisieren von "${A}"`)}};return o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:`rounded-2xl p-6 border-2 relative overflow-hidden ${i.maintenanceMode?"bg-gradient-to-br from-purple-900/50 via-fuchsia-900/30 to-purple-900/50 border-fuchsia-500/50":"bg-gray-800 border-gray-700"}`,style:i.maintenanceMode?{boxShadow:"0 0 30px rgba(192, 38, 211, 0.3), inset 0 0 30px rgba(192, 38, 211, 0.1)"}:{},children:[i.maintenanceMode&&o.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:o.jsx("div",{className:"absolute inset-0 opacity-30",style:{background:"linear-gradient(45deg, transparent 30%, rgba(192, 38, 211, 0.2) 50%, transparent 70%)",animation:"shimmer 3s ease-in-out infinite"}})}),o.jsxs("div",{className:"relative flex items-start gap-4 mb-6",children:[o.jsx("div",{className:`w-16 h-16 rounded-2xl flex items-center justify-center transition-all ${i.maintenanceMode?"bg-gradient-to-br from-fuchsia-500 to-purple-600":"bg-gray-700"}`,style:i.maintenanceMode?{boxShadow:"0 0 25px rgba(192, 38, 211, 0.5)",animation:"pulse 2s ease-in-out infinite"}:{},children:o.jsx(Ei,{size:32,className:i.maintenanceMode?"text-white animate-pulse":"text-gray-400"})}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("h2",{className:"font-bold text-2xl mb-1 flex items-center gap-3",children:[o.jsx("span",{className:i.maintenanceMode?"text-transparent bg-clip-text bg-gradient-to-r from-fuchsia-400 to-purple-400":"text-white",children:"REALITY BENDING MODE"}),i.maintenanceMode&&o.jsx("span",{className:"px-3 py-1 bg-gradient-to-r from-fuchsia-500 to-purple-500 text-white text-xs font-bold rounded-full",style:{animation:"pulse 1.5s ease-in-out infinite",boxShadow:"0 0 15px rgba(192, 38, 211, 0.5)"},children:" GODMODE AKTIV "})]}),o.jsx("p",{className:"text-gray-400 text-sm",children:"Blockiert den Zugriff fr alle Sterblichen whrend die Gtter das Universum neu konfigurieren."})]})]}),!i.maintenanceMode&&o.jsxs("div",{className:"space-y-4 mb-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"text-sm text-gray-400 mb-2 block",children:"Nachricht fr Benutzer"}),o.jsx("input",{type:"text",value:p,onChange:A=>g(A.target.value),placeholder:"Wir machen eine kurze Pause...",className:"w-full px-4 py-3 bg-gray-900 border border-gray-700 rounded-xl text-white placeholder:text-gray-500 focus:border-purple-500 focus:outline-none"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-sm text-gray-400 mb-2 block",children:"Geschtzte Dauer (Minuten)"}),o.jsx("div",{className:"flex gap-2",children:[15,30,60,120].map(A=>o.jsxs("button",{onClick:()=>x(A),className:`px-4 py-2 rounded-xl text-sm font-medium transition-colors ${y===A?"bg-purple-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:[A," Min"]},A))})]})]}),i.maintenanceMode&&i.maintenanceEstimatedEnd&&o.jsxs("div",{className:"flex items-center gap-3 p-4 bg-amber-600/20 rounded-xl mb-6",children:[o.jsx(Gi,{size:20,className:"text-amber-400"}),o.jsxs("div",{children:[o.jsx("p",{className:"text-amber-200 font-medium",children:"Geschtztes Ende"}),o.jsx("p",{className:"text-amber-100/70 text-sm",children:new Date(i.maintenanceEstimatedEnd).toLocaleString("de-DE")})]})]}),o.jsxs("button",{onClick:C,disabled:l,className:`relative w-full py-5 rounded-2xl font-bold text-lg flex items-center justify-center gap-3 transition-all overflow-hidden ${i.maintenanceMode?"bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white":"bg-gradient-to-r from-fuchsia-500 via-purple-500 to-violet-600 hover:from-fuchsia-600 hover:via-purple-600 hover:to-violet-700 text-white"} disabled:opacity-50`,style:i.maintenanceMode?{boxShadow:"0 0 30px rgba(34, 197, 94, 0.4)"}:{boxShadow:"0 0 30px rgba(192, 38, 211, 0.4)"},children:[o.jsx("div",{className:"absolute inset-0 opacity-30",style:{background:"linear-gradient(90deg, transparent 30%, rgba(255,255,255,0.3) 50%, transparent 70%)",animation:"shimmer-button 2s ease-in-out infinite"}}),l?o.jsx(Br,{size:28,className:"animate-spin"}):o.jsxs(o.Fragment,{children:[o.jsx(Ei,{size:28,className:i.maintenanceMode?"":"animate-pulse"}),i.maintenanceMode?" REALITT WIEDERHERSTELLEN":" ACTIVATE GODMODE "]})]}),o.jsx("style",{children:`
          @keyframes shimmer-button {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
          }
        `})]}),o.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[o.jsxs("h2",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[o.jsx(Ei,{size:20,className:"text-purple-400"}),"Feature Flags"]}),o.jsx("div",{className:"space-y-3",children:Object.entries(i.features).map(([A,M])=>o.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-900 rounded-xl",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[A==="referralSystem"&&o.jsx(ra,{size:20,className:"text-pink-400"}),A==="premiumPurchases"&&o.jsx(im,{size:20,className:"text-amber-400"}),A==="voiceChat"&&o.jsx(dV,{size:20,className:"text-blue-400"}),A==="anonymousMode"&&o.jsx(li,{size:20,className:"text-green-400"}),A==="starEvents"&&o.jsx(Ei,{size:20,className:"text-purple-400"}),o.jsxs("div",{children:[o.jsx("p",{className:"font-medium capitalize",children:A.replace(/([A-Z])/g," $1").trim()}),o.jsxs("p",{className:"text-xs text-gray-400",children:[A==="referralSystem"&&"Einladungs-System mit 5 Links",A==="premiumPurchases"&&"Premium-Kufe aktivieren",A==="voiceChat"&&"Voice Chat in Wlkchen",A==="anonymousMode"&&"Anonymer Modus verfgbar",A==="starEvents"&&"Star Events & Zeitplne"]})]})]}),o.jsx("button",{onClick:()=>k(A,!M),className:`w-14 h-8 rounded-full transition-colors relative ${M?"bg-purple-600":"bg-gray-600"}`,children:o.jsx("div",{className:`w-6 h-6 bg-white rounded-full absolute top-1 transition-transform ${M?"translate-x-7":"translate-x-1"}`})})]},A))})]}),o.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[o.jsxs("h2",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[o.jsx(hV,{size:20,className:"text-blue-400"}),"System Limits"]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"p-4 bg-gray-900 rounded-xl",children:[o.jsx("p",{className:"text-2xl font-bold text-white",children:i.limits.maxUsersPerRoom}),o.jsx("p",{className:"text-xs text-gray-400",children:"Max. User pro Wlkchen"})]}),o.jsxs("div",{className:"p-4 bg-gray-900 rounded-xl",children:[o.jsx("p",{className:"text-2xl font-bold text-white",children:i.limits.maxRoomsPerUser}),o.jsx("p",{className:"text-xs text-gray-400",children:"Max. Wlkchen pro User"})]}),o.jsxs("div",{className:"p-4 bg-gray-900 rounded-xl",children:[o.jsx("p",{className:"text-2xl font-bold text-white",children:i.limits.maxDailyXP}),o.jsx("p",{className:"text-xs text-gray-400",children:"Max. XP pro Tag"})]}),o.jsxs("div",{className:"p-4 bg-gray-900 rounded-xl",children:[o.jsx("p",{className:"text-2xl font-bold text-white",children:i.limits.maxLevel}),o.jsx("p",{className:"text-xs text-gray-400",children:"Max. Level"})]})]})]}),o.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[o.jsxs("h2",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[o.jsx(im,{size:20,className:"text-green-400"}),"Level System 2.0"]}),o.jsxs("div",{className:"space-y-3 text-sm",children:[o.jsxs("div",{className:"p-4 bg-gray-900 rounded-xl font-mono",children:[o.jsx("p",{className:"text-gray-400 mb-2",children:"XP Formula:"}),o.jsxs("p",{className:"text-green-400",children:["XP_n = ",i.levelConfig.baseXP,"  n^",i.levelConfig.exponent]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"p-4 bg-gray-900 rounded-xl",children:[o.jsx("p",{className:"text-xl font-bold text-white",children:i.levelConfig.prestigeUnlockLevel}),o.jsx("p",{className:"text-xs text-gray-400",children:"Prestige Unlock Level"})]}),o.jsxs("div",{className:"p-4 bg-gray-900 rounded-xl",children:[o.jsx("p",{className:"text-xl font-bold text-white",children:i.levelConfig.communityPrestigeThreshold}),o.jsx("p",{className:"text-xs text-gray-400",children:"Community Prestige"})]})]})]})]}),o.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[o.jsx("h2",{className:"font-bold text-lg mb-4",children:"Admin-Infos"}),o.jsxs("div",{className:"space-y-3 text-sm",children:[o.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-600/10 border border-green-600/30 rounded-xl",children:[o.jsx(li,{size:20,className:"text-green-400"}),o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-green-400",children:"Sicher authentifiziert"}),o.jsx("p",{className:"text-xs text-gray-400",children:"Via Firebase Firestore isAdmin Flag"})]})]}),o.jsxs("p",{children:[o.jsx("span",{className:"text-gray-400",children:"Deine User-ID:"})," ",o.jsx("code",{className:"bg-gray-700 px-2 py-1 rounded",children:s.id})]}),o.jsxs("p",{children:[o.jsx("span",{className:"text-gray-400",children:"Username:"})," ",o.jsx("code",{className:"bg-gray-700 px-2 py-1 rounded",children:s.username})]})]})]}),o.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[o.jsx("h2",{className:"font-bold text-lg mb-4",children:"Neuen Admin hinzufgen"}),o.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Um einen neuen Admin hinzuzufgen, setze in der Firebase Console:"}),o.jsxs("div",{className:"p-4 bg-gray-900 rounded-xl font-mono text-sm",children:[o.jsx("p",{className:"text-gray-400",children:"Firestore  users  [user-id]"}),o.jsx("p",{className:"text-green-400 mt-2",children:"isAdmin: true"})]})]})]})},BJ=()=>{const s=zr(),{user:n}=mr(),[i,l]=H.useState(!1),[u,p]=H.useState(!0),[g,y]=H.useState("overview"),[x,C]=H.useState([]),[k,A]=H.useState([]),[M,G]=H.useState({totalUsers:0,totalRooms:0,activeRooms:0,totalFriendRequests:0}),[B,X]=H.useState(!1),[Z,q]=H.useState(null),[V,ee]=H.useState([]);H.useEffect(()=>{(async()=>{if(!(n!=null&&n.id)){p(!1);return}try{const ge=(await fr(at(Me,"users",n.id))).data();(ge==null?void 0:ge.isAdmin)===!0&&(l(!0),await de())}catch{}p(!1)})()},[n]);const de=async()=>{try{const ve=(await Ur(xn(Me,"users"))).docs.map(gt=>{var Ye;return{id:gt.id,username:gt.data().username||"unknown",displayName:gt.data().displayName||"Unbekannt",email:gt.data().email,createdAt:((Ye=gt.data().createdAt)==null?void 0:Ye.toDate())||new Date,level:gt.data().level||1,isAdmin:gt.data().isAdmin||!1}});C(ve);const qe=(await Ur(xn(Me,"rooms"))).docs.map(gt=>{var Ye;return{id:gt.id,name:gt.data().name||"Unnamed",type:gt.data().type||"public",participantCount:(gt.data().participants||[]).length,createdAt:((Ye=gt.data().createdAt)==null?void 0:Ye.toDate())||new Date,createdBy:gt.data().createdBy||"unknown"}});A(qe);const Dt=await Ur(xn(Me,"friendRequests"));G({totalUsers:ve.length,totalRooms:qe.length,activeRooms:qe.filter(gt=>gt.participantCount>0).length,totalFriendRequests:Dt.size}),ae("Daten erfolgreich geladen")}catch{ae("Fehler beim Laden der Daten")}},ae=he=>{const ve=new Date().toLocaleTimeString("de-DE");ee(ge=>[`[${ve}] ${he}`,...ge.slice(0,49)])},ye=async()=>{X(!0),ae("Starte Lschung aller Benutzer...");try{const he=await Ur(xn(Me,"users"));let ve=0;for(const ze of he.docs)ze.data().isAdmin||(await Ga(at(Me,"users",ze.id)),ve++,ae(`Benutzer gelscht: ${ze.id}`));const ge=await Ur(xn(Me,"blocks"));for(const ze of ge.docs)await Ga(at(Me,"blocks",ze.id));ae(`${ge.size} Block-Eintrge gelscht`);const qe=await Ur(xn(Me,"referrals"));let Dt=0;for(const ze of qe.docs)he.docs.find(yt=>yt.data().isAdmin&&yt.id===ze.id)||(await Ga(at(Me,"referrals",ze.id)),Dt++);ae(`${Dt} Referral-Eintrge gelscht`);const gt=await Ur(xn(Me,"friendRequests"));for(const ze of gt.docs)await Ga(at(Me,"friendRequests",ze.id));ae(`${gt.size} Freundschaftsanfragen gelscht`);const Ye=await Ur(xn(Me,"notifications"));for(const ze of Ye.docs)await Ga(at(Me,"notifications",ze.id));ae(`${Ye.size} Benachrichtigungen gelscht`),ae(` ${ve} Benutzer erfolgreich gelscht`),await de()}catch{ae(" Fehler beim Lschen der Benutzer")}X(!1),q(null)},Q=async()=>{X(!0),ae("Starte Lschung aller Wlkchen...");try{const he=await Ur(xn(Me,"rooms"));let ve=0;for(const qe of he.docs)await Ga(at(Me,"rooms",qe.id)),ve++,ae(`Wlkchen gelscht: ${qe.data().name}`);const ge=await Ur(xn(Me,"starEvents"));for(const qe of ge.docs)await Ga(at(Me,"starEvents",qe.id));ae(`${ge.size} Star Events gelscht`),ae(` ${ve} Wlkchen erfolgreich gelscht`),await de()}catch{ae(" Fehler beim Lschen der Wlkchen")}X(!1),q(null)},$=async()=>{X(!0),ae(" KOMPLETTER RESET GESTARTET..."),await Q(),await ye(),ae(" KOMPLETTER RESET ABGESCHLOSSEN"),X(!1)},se=async he=>{var ve;try{if((ve=(await fr(at(Me,"users",he))).data())!=null&&ve.isAdmin){ae(" Admin-Benutzer knnen nicht gelscht werden");return}await Ga(at(Me,"users",he)),C(qe=>qe.filter(Dt=>Dt.id!==he)),G(qe=>({...qe,totalUsers:qe.totalUsers-1})),ae(`Benutzer ${he} gelscht`)}catch{ae(`Fehler beim Lschen von ${he}`)}},ce=async(he,ve)=>{try{await Ga(at(Me,"rooms",he)),A(ge=>ge.filter(qe=>qe.id!==he)),G(ge=>({...ge,totalRooms:ge.totalRooms-1})),ae(`Wlkchen "${ve}" gelscht`)}catch{ae(`Fehler beim Lschen von "${ve}"`)}};return u?o.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:o.jsx(Br,{size:32,className:"animate-spin text-purple-500"})}):n?i?o.jsxs("div",{className:"min-h-screen bg-gray-900 text-white",children:[o.jsx("div",{className:"bg-gray-800 border-b border-gray-700 px-6 py-4",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 bg-purple-600 rounded-xl flex items-center justify-center",children:o.jsx(li,{size:20})}),o.jsxs("div",{children:[o.jsx("h1",{className:"font-bold text-lg",children:"Delulu Admin Panel"}),o.jsxs("p",{className:"text-xs text-gray-400",children:["Eingeloggt als ",n.username]})]})]}),o.jsx("button",{onClick:()=>s("/"),className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",children:o.jsx(Are,{size:20})})]})}),o.jsx("div",{className:"bg-gray-800 border-b border-gray-700 px-6",children:o.jsx("div",{className:"flex gap-1",children:[{id:"overview",label:"bersicht",icon:dV},{id:"users",label:"Benutzer",icon:rr},{id:"rooms",label:"Wlkchen",icon:sm},{id:"settings",label:"Einstellungen",icon:QS}].map(he=>o.jsxs("button",{onClick:()=>y(he.id),className:`flex items-center gap-2 px-4 py-3 font-medium text-sm transition-colors border-b-2 ${g===he.id?"text-purple-400 border-purple-500":"text-gray-400 border-transparent hover:text-white"}`,children:[o.jsx(he.icon,{size:16}),he.label]},he.id))})}),o.jsxs("div",{className:"p-6",children:[g==="overview"&&o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[o.jsxs("div",{className:"bg-gray-800 rounded-xl p-4",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[o.jsx(rr,{size:20,className:"text-blue-400"}),o.jsx("span",{className:"text-gray-400 text-sm",children:"Benutzer"})]}),o.jsx("p",{className:"text-2xl font-bold",children:M.totalUsers})]}),o.jsxs("div",{className:"bg-gray-800 rounded-xl p-4",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[o.jsx(sm,{size:20,className:"text-purple-400"}),o.jsx("span",{className:"text-gray-400 text-sm",children:"Wlkchen"})]}),o.jsx("p",{className:"text-2xl font-bold",children:M.totalRooms})]}),o.jsxs("div",{className:"bg-gray-800 rounded-xl p-4",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[o.jsx(dV,{size:20,className:"text-green-400"}),o.jsx("span",{className:"text-gray-400 text-sm",children:"Aktiv"})]}),o.jsx("p",{className:"text-2xl font-bold",children:M.activeRooms})]}),o.jsxs("div",{className:"bg-gray-800 rounded-xl p-4",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[o.jsx(hV,{size:20,className:"text-amber-400"}),o.jsx("span",{className:"text-gray-400 text-sm",children:"Anfragen"})]}),o.jsx("p",{className:"text-2xl font-bold",children:M.totalFriendRequests})]})]}),o.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[o.jsxs("h2",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[o.jsx(ql,{size:20,className:"text-red-400"}),"Gefhrliche Aktionen"]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[o.jsxs("button",{onClick:()=>q("users"),disabled:B,className:"p-4 bg-red-600/20 border border-red-600/50 rounded-xl text-left hover:bg-red-600/30 transition-colors disabled:opacity-50",children:[o.jsx(dk,{size:24,className:"text-red-400 mb-2"}),o.jsx("p",{className:"font-semibold text-red-400",children:"Alle Benutzer lschen"}),o.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Lscht ",M.totalUsers," Benutzer (auer Admins)"]})]}),o.jsxs("button",{onClick:()=>q("rooms"),disabled:B,className:"p-4 bg-orange-600/20 border border-orange-600/50 rounded-xl text-left hover:bg-orange-600/30 transition-colors disabled:opacity-50",children:[o.jsx(Jh,{size:24,className:"text-orange-400 mb-2"}),o.jsx("p",{className:"font-semibold text-orange-400",children:"Alle Wlkchen lschen"}),o.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Lscht ",M.totalRooms," Wlkchen"]})]}),o.jsxs("button",{onClick:$,disabled:B,className:"p-4 bg-purple-600/20 border border-purple-600/50 rounded-xl text-left hover:bg-purple-600/30 transition-colors disabled:opacity-50",children:[o.jsx(hV,{size:24,className:"text-purple-400 mb-2"}),o.jsx("p",{className:"font-semibold text-purple-400",children:"KOMPLETTER RESET"}),o.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Alles lschen & neu starten"})]})]})]}),o.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("h2",{className:"font-bold text-lg",children:"Aktivittslog"}),o.jsx("button",{onClick:de,className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",children:o.jsx(gS,{size:16})})]}),o.jsx("div",{className:"bg-gray-900 rounded-lg p-4 h-64 overflow-y-auto font-mono text-xs",children:V.length===0?o.jsx("p",{className:"text-gray-500",children:"Noch keine Aktivitten"}):V.map((he,ve)=>o.jsx("div",{className:"py-1 text-gray-300",children:he},ve))})]})]}),g==="users"&&o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("h2",{className:"font-bold text-lg",children:["Benutzer (",x.length,")"]}),o.jsx("button",{onClick:de,className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",children:o.jsx(gS,{size:16})})]}),o.jsx("div",{className:"bg-gray-800 rounded-xl overflow-hidden",children:x.length===0?o.jsx("div",{className:"p-8 text-center text-gray-400",children:"Keine Benutzer vorhanden"}):o.jsx("div",{className:"divide-y divide-gray-700",children:x.map(he=>{var ve;return o.jsxs("div",{className:"p-4 flex items-center justify-between hover:bg-gray-700/50",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${he.isAdmin?"bg-amber-600/20":"bg-purple-600/20"}`,children:o.jsx("span",{className:`text-sm font-bold ${he.isAdmin?"text-amber-400":"text-purple-400"}`,children:(ve=he.displayName[0])==null?void 0:ve.toUpperCase()})}),o.jsxs("div",{children:[o.jsxs("p",{className:"font-medium flex items-center gap-2",children:[he.displayName,he.isAdmin&&o.jsx("span",{className:"px-1.5 py-0.5 bg-amber-600/20 text-amber-400 text-[10px] font-bold rounded",children:"ADMIN"})]}),o.jsxs("p",{className:"text-xs text-gray-400",children:["@",he.username,"  Level ",he.level]})]})]}),!he.isAdmin&&o.jsx("button",{onClick:()=>se(he.id),className:"p-2 text-red-400 hover:bg-red-600/20 rounded-lg transition-colors",children:o.jsx(Jh,{size:16})})]},he.id)})})})]}),g==="rooms"&&o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("h2",{className:"font-bold text-lg",children:["Wlkchen (",k.length,")"]}),o.jsx("button",{onClick:de,className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",children:o.jsx(gS,{size:16})})]}),o.jsx("div",{className:"bg-gray-800 rounded-xl overflow-hidden",children:k.length===0?o.jsx("div",{className:"p-8 text-center text-gray-400",children:"Keine Wlkchen vorhanden"}):o.jsx("div",{className:"divide-y divide-gray-700",children:k.map(he=>o.jsxs("div",{className:"p-4 flex items-center justify-between hover:bg-gray-700/50",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-600/20 flex items-center justify-center",children:o.jsx(sm,{size:20,className:"text-blue-400"})}),o.jsxs("div",{children:[o.jsx("p",{className:"font-medium",children:he.name}),o.jsxs("p",{className:"text-xs text-gray-400",children:[he.type,"  ",he.participantCount," Teilnehmer"]})]})]}),o.jsx("button",{onClick:()=>ce(he.id,he.name),className:"p-2 text-red-400 hover:bg-red-600/20 rounded-lg transition-colors",children:o.jsx(Jh,{size:16})})]},he.id))})})]}),g==="settings"&&o.jsx(GCe,{user:n,addLog:ae})]}),Z&&o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-6 bg-black/80",children:o.jsxs("div",{className:"w-full max-w-md bg-gray-800 rounded-2xl p-6",children:[o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("div",{className:"w-16 h-16 bg-red-600/20 rounded-2xl flex items-center justify-center mx-auto mb-4",children:o.jsx(ql,{size:32,className:"text-red-500"})}),o.jsx("h2",{className:"text-xl font-bold mb-2",children:"Bist du sicher?"}),o.jsx("p",{className:"text-gray-400",children:Z==="users"?`${M.totalUsers} Benutzer werden unwiderruflich gelscht (auer Admins).`:`${M.totalRooms} Wlkchen werden unwiderruflich gelscht.`})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:()=>q(null),disabled:B,className:"flex-1 py-3 bg-gray-700 text-white rounded-xl font-semibold",children:"Abbrechen"}),o.jsx("button",{onClick:Z==="users"?ye:Q,disabled:B,className:"flex-1 py-3 bg-red-600 text-white rounded-xl font-semibold flex items-center justify-center gap-2",children:B?o.jsxs(o.Fragment,{children:[o.jsx(Br,{size:18,className:"animate-spin"}),"Lsche..."]}):o.jsxs(o.Fragment,{children:[o.jsx(Jh,{size:18}),"Lschen"]})})]})]})})]}):o.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-6",children:o.jsxs("div",{className:"text-center max-w-md",children:[o.jsx("div",{className:"w-20 h-20 mx-auto bg-red-600/20 rounded-2xl flex items-center justify-center mb-6",children:o.jsx(li,{size:40,className:"text-red-500"})}),o.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Zugriff verweigert"}),o.jsx("p",{className:"text-gray-400 mb-6",children:"Du hast keine Admin-Berechtigung. Admin-Rechte werden ber die Firestore-Datenbank vergeben."}),o.jsxs("div",{className:"p-4 bg-gray-800 rounded-xl text-left mb-6",children:[o.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"So wirst du Admin:"}),o.jsx("code",{className:"text-xs text-green-400 block",children:"Firestore  users  [deine-id]  isAdmin: true"})]}),o.jsx("button",{onClick:()=>s("/"),className:"px-6 py-3 bg-purple-600 text-white rounded-xl font-semibold",children:"Zur Startseite"})]})}):o.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-6",children:o.jsxs("div",{className:"text-center",children:[o.jsx(li,{size:64,className:"mx-auto text-red-500 mb-4"}),o.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Zugriff verweigert"}),o.jsx("p",{className:"text-gray-400 mb-6",children:"Du musst eingeloggt sein."}),o.jsx("button",{onClick:()=>s("/"),className:"px-6 py-3 bg-purple-600 text-white rounded-xl font-semibold",children:"Zur Startseite"})]})})},zJ=[{minLevel:1,maxLevel:9,name:"Newcomer",nameDE:"Neuling",emoji:"",frameStyle:"border-2 border-gray-300",glowColor:"transparent",glowIntensity:0,nameEffect:"none",backgroundEffect:"none",badgeStyle:"bg-gray-200 text-gray-600",particles:null},{minLevel:10,maxLevel:24,name:"Beginner",nameDE:"Anfnger",emoji:"",frameStyle:"border-2 border-blue-400",glowColor:"#60A5FA",glowIntensity:5,nameEffect:"none",backgroundEffect:"none",badgeStyle:"bg-blue-100 text-blue-600",particles:null},{minLevel:25,maxLevel:49,name:"Explorer",nameDE:"Entdecker",emoji:"",frameStyle:"border-3 border-green-500",glowColor:"#22C55E",glowIntensity:8,nameEffect:"gradient",backgroundEffect:"none",badgeStyle:"bg-green-100 text-green-600",particles:{type:"sparkles",count:5,speed:1,size:4,colors:["#22C55E","#4ADE80"]}},{minLevel:50,maxLevel:99,name:"Adventurer",nameDE:"Abenteurer",emoji:"",frameStyle:"border-3 border-purple-500 ring-2 ring-purple-300",glowColor:"#A855F7",glowIntensity:12,nameEffect:"gradient",backgroundEffect:"particles",badgeStyle:"bg-purple-100 text-purple-600",particles:{type:"sparkles",count:10,speed:1.5,size:5,colors:["#A855F7","#C084FC","#E879F9"]}},{minLevel:100,maxLevel:149,name:"Champion",nameDE:"Champion",emoji:"",frameStyle:"border-4 border-amber-500 ring-4 ring-amber-300",glowColor:"#F59E0B",glowIntensity:18,nameEffect:"shimmer",backgroundEffect:"stars",badgeStyle:"bg-gradient-to-r from-amber-400 to-yellow-500 text-white",particles:{type:"stars",count:15,speed:2,size:6,colors:["#F59E0B","#FBBF24","#FCD34D"]}},{minLevel:150,maxLevel:199,name:"Master",nameDE:"Meister",emoji:"",frameStyle:"border-4 border-orange-500 ring-4 ring-orange-400 ring-offset-2",glowColor:"#F97316",glowIntensity:22,nameEffect:"shimmer",backgroundEffect:"aurora",badgeStyle:"bg-gradient-to-r from-orange-500 to-red-500 text-white",particles:{type:"fire",count:20,speed:2.5,size:7,colors:["#F97316","#EF4444","#FCD34D"]}},{minLevel:200,maxLevel:299,name:"Grandmaster",nameDE:"Gromeister",emoji:"",frameStyle:"border-4 border-pink-500 ring-4 ring-pink-400 ring-offset-4 ring-offset-pink-100",glowColor:"#EC4899",glowIntensity:28,nameEffect:"rainbow",backgroundEffect:"aurora",badgeStyle:"bg-gradient-to-r from-pink-500 via-purple-500 to-indigo-500 text-white",particles:{type:"hearts",count:25,speed:3,size:8,colors:["#EC4899","#F472B6","#F9A8D4"]}},{minLevel:300,maxLevel:399,name:"Legend",nameDE:"Legende",emoji:"",frameStyle:"border-[6px] border-transparent bg-gradient-to-r from-violet-500 via-purple-500 to-pink-500 p-[3px]",glowColor:"#8B5CF6",glowIntensity:35,nameEffect:"rainbow",backgroundEffect:"nebula",badgeStyle:"bg-gradient-to-r from-violet-600 via-purple-600 to-pink-600 text-white animate-pulse",particles:{type:"cosmic",count:30,speed:3.5,size:10,colors:["#8B5CF6","#A855F7","#D946EF","#EC4899"]}},{minLevel:400,maxLevel:499,name:"Mythic",nameDE:"Mythisch",emoji:"",frameStyle:"border-[8px] border-transparent bg-gradient-to-r from-red-500 via-yellow-500 via-green-500 via-blue-500 to-purple-500 p-[4px] animate-gradient",glowColor:"#FFD700",glowIntensity:45,nameEffect:"holographic",backgroundEffect:"cosmic",badgeStyle:"bg-gradient-to-r from-red-500 via-yellow-500 to-green-500 text-white animate-gradient",particles:{type:"cosmic",count:40,speed:4,size:12,colors:["#EF4444","#F59E0B","#22C55E","#3B82F6","#8B5CF6"]}},{minLevel:500,maxLevel:500,name:"Delulu God",nameDE:"Delulu Gott",emoji:"",frameStyle:"border-[10px] border-transparent bg-gradient-conic from-red-500 via-yellow-500 via-green-500 via-blue-500 via-purple-500 to-red-500 p-[5px] animate-spin-slow",glowColor:"#FFFFFF",glowIntensity:60,nameEffect:"holographic",backgroundEffect:"cosmic",badgeStyle:"bg-gradient-conic from-red-500 via-yellow-500 via-green-500 via-blue-500 to-purple-500 text-white animate-gradient shadow-2xl",particles:{type:"cosmic",count:60,speed:5,size:15,colors:["#FFFFFF","#FFD700","#FF69B4","#00CED1","#9400D3"]}}],My=s=>zJ.find(i=>s>=i.minLevel&&s<=i.maxLevel)||zJ[0],WCe=s=>{const n=My(s);return{boxShadow:n.glowIntensity>0?`0 0 ${n.glowIntensity}px ${n.glowIntensity/2}px ${n.glowColor}`:"none"}},HCe=s=>My(s).frameStyle,KCe=s=>{switch(My(s).nameEffect){case"gradient":return"bg-gradient-to-r from-violet-600 to-pink-600 bg-clip-text text-transparent";case"shimmer":return"bg-gradient-to-r from-amber-200 via-yellow-300 to-amber-200 bg-clip-text text-transparent animate-shimmer bg-[length:200%_100%]";case"rainbow":return"bg-gradient-to-r from-red-500 via-yellow-500 via-green-500 via-blue-500 to-purple-500 bg-clip-text text-transparent animate-gradient bg-[length:200%_100%]";case"fire":return"bg-gradient-to-r from-red-500 via-orange-500 to-yellow-500 bg-clip-text text-transparent animate-fire";case"holographic":return"bg-gradient-conic from-red-500 via-yellow-500 via-green-500 via-blue-500 via-purple-500 to-red-500 bg-clip-text text-transparent animate-holographic bg-[length:100%_100%]";default:return""}},qCe=s=>My(s).badgeStyle,YCe=s=>My(s).particles,Bu={user:{tier:"user",name:"User",nameDE:"Nutzer",emoji:"",minFollowers:0,minInvites:0,minLevel:1,color:"#9CA3AF",glowColor:"transparent",features:["basic_profile","private_clouds"],revenueShare:0},rising:{tier:"rising",name:"Rising",nameDE:"Aufsteiger",emoji:"",minFollowers:25,minInvites:3,minLevel:10,color:"#60A5FA",glowColor:"#60A5FA40",features:["animated_avatar","custom_status","locked_content"],revenueShare:10},creator:{tier:"creator",name:"Creator",nameDE:"Creator",emoji:"",minFollowers:100,minInvites:10,minLevel:25,color:"#A78BFA",glowColor:"#A78BFA50",features:["public_cloud","analytics_basic","custom_header","priority_support"],revenueShare:20},star:{tier:"star",name:"Delulu Star",nameDE:"Delulu Star",emoji:"",minFollowers:500,minInvites:25,minLevel:50,color:"#FBBF24",glowColor:"#FBBF2460",features:["verified_badge","creator_quests","monetization","analytics_advanced"],revenueShare:40},legend:{tier:"legend",name:"Legend",nameDE:"Legende",emoji:"",minFollowers:2e3,minInvites:100,minLevel:100,color:"#F472B6",glowColor:"#F472B670",features:["custom_effects","exclusive_events","direct_monetization"],revenueShare:60},icon:{tier:"icon",name:"Delulu Icon",nameDE:"Delulu Icon",emoji:"",minFollowers:1e4,minInvites:500,minLevel:200,color:"#DC2626",glowColor:"#DC262680",features:["legendary_effects","partnership","revenue_priority"],revenueShare:80}},YF={name:"Delulu Coins",symbol:"",exchangeRate:100,unlockCost:50,packages:[{coins:100,priceEUR:.99,bonus:0},{coins:500,priceEUR:4.49,bonus:50},{coins:1200,priceEUR:9.99,bonus:200},{coins:3e3,priceEUR:19.99,bonus:750},{coins:8e3,priceEUR:49.99,bonus:2500}]},XCe=(s,n,i,l)=>{const u=["user","rising","creator","star","legend","icon"],p=u.indexOf(s);if(p===u.length-1)return{nextTier:null,followersProgress:100,invitesProgress:100,levelProgress:100,overallProgress:100};const g=u[p+1],y=Bu[g],x=Bu[s],C=y.minFollowers-x.minFollowers,k=y.minInvites-x.minInvites,A=y.minLevel-x.minLevel,M=Math.min(100,(n-x.minFollowers)/C*100),G=Math.min(100,(i-x.minInvites)/k*100),B=Math.min(100,(l-x.minLevel)/A*100);return{nextTier:g,followersProgress:M,invitesProgress:G,levelProgress:B,overallProgress:(M+G+B)/3}},$Ce=async s=>{var n,i;try{const l=at(Me,"creatorProfiles",s),u=await fr(l);if(!u.exists())return null;const p=u.data();return{...p,createdAt:((n=p.createdAt)==null?void 0:n.toDate())||new Date,updatedAt:((i=p.updatedAt)==null?void 0:i.toDate())||new Date}}catch(l){return console.error("Error getting creator profile:",l),null}},JCe=({config:s,size:n})=>{const i=H.useRef(null);return H.useEffect(()=>{const l=i.current;if(!l)return;const u=l.getContext("2d");if(!u)return;const p=[];for(let x=0;x<s.count;x++)p.push({x:Math.random()*n,y:Math.random()*n,size:Math.random()*s.size+2,speedX:(Math.random()-.5)*s.speed,speedY:(Math.random()-.5)*s.speed-.5,color:s.colors[Math.floor(Math.random()*s.colors.length)],opacity:Math.random()*.8+.2});const g=()=>{u.clearRect(0,0,n,n),p.forEach(x=>{if(u.beginPath(),s.type==="sparkles"||s.type==="stars"){const C=s.type==="stars"?5:4,k=x.size,A=x.size/2;for(let M=0;M<C*2;M++){const G=M%2===0?k:A,B=M*Math.PI/C,X=x.x+Math.cos(B)*G,Z=x.y+Math.sin(B)*G;M===0?u.moveTo(X,Z):u.lineTo(X,Z)}u.closePath()}else s.type,u.arc(x.x,x.y,x.size/2,0,Math.PI*2);u.fillStyle=x.color+Math.floor(x.opacity*255).toString(16).padStart(2,"0"),u.fill(),x.x+=x.speedX,x.y+=x.speedY,x.opacity-=.005,(x.x<0||x.x>n||x.y<0||x.y>n||x.opacity<=0)&&(x.x=n/2+(Math.random()-.5)*n/2,x.y=n/2+(Math.random()-.5)*n/2,x.opacity=Math.random()*.8+.2)}),requestAnimationFrame(g)},y=requestAnimationFrame(g);return()=>cancelAnimationFrame(y)},[s,n]),o.jsx("canvas",{ref:i,width:n,height:n,className:"absolute inset-0 pointer-events-none z-10"})},QCe=({avatarUrl:s,avatarId:n="pegasus",level:i,creatorTier:l,isVerified:u=!1,size:p="md",showName:g=!1,name:y,showLevel:x=!1,showParticles:C=!0,className:k="",onClick:A})=>{const M=My(i),G=YCe(i),B={sm:"w-10 h-10",md:"w-14 h-14",lg:"w-20 h-20",xl:"w-28 h-28","2xl":"w-36 h-36"},X={sm:40,md:56,lg:80,xl:112,"2xl":144},q=s||null;return o.jsxs("div",{className:`relative inline-flex flex-col items-center ${k}`,onClick:A,children:[M.glowIntensity>0&&o.jsx("div",{className:`absolute rounded-full ${B[p]}`,style:{background:M.glowColor,filter:`blur(${M.glowIntensity}px)`,opacity:.5,animation:"pulse 2s ease-in-out infinite"}}),C&&G&&p!=="sm"&&o.jsx(JCe,{config:G,size:X[p]*1.5}),o.jsxs("div",{className:`relative ${B[p]} rounded-full overflow-visible cursor-pointer transition-transform hover:scale-105`,style:WCe(i),children:[o.jsx("div",{className:`absolute inset-0 rounded-full ${HCe(i)}`}),o.jsx("div",{className:"absolute inset-[4px] rounded-full overflow-hidden bg-gradient-to-br from-gray-700 to-gray-900",children:q?o.jsx("img",{src:q,alt:"Avatar",className:"w-full h-full object-cover"}):o.jsx("div",{className:"w-full h-full flex items-center justify-center text-2xl",children:n==="pegasus"?"":n==="phoenix"?"":""})}),u&&o.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center border-2 border-gray-900 shadow-lg",children:o.jsx("span",{className:"text-xs",children:""})}),l&&l!=="user"&&o.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 rounded-full flex items-center justify-center border-2 border-gray-900 shadow-lg text-sm",style:{backgroundColor:Bu[l].color},children:Bu[l].emoji})]}),x&&o.jsxs("div",{className:`mt-1 px-2 py-0.5 rounded-full text-xs font-bold ${qCe(i)}`,children:[M.emoji," Lv. ",i]}),g&&y&&o.jsx("p",{className:`mt-2 font-bold text-center ${p==="sm"?"text-xs":p==="md"?"text-sm":"text-base"} ${KCe(i)}`,children:y})]})},yy={defaultUnlockCost:50,minUnlockCost:10,maxUnlockCost:500,invitesForFreeUnlock:1,platformFee:.2,blurIntensity:20,previewTextLength:50},Uy=async s=>{var n;try{const i=at(Me,"wallets",s),l=await fr(i);if(!l.exists())return null;const u=l.data();return{...u,lastUpdated:((n=u.lastUpdated)==null?void 0:n.toDate())||new Date,transactions:(u.transactions||[]).map(p=>{var g;return{...p,createdAt:((g=p.createdAt)==null?void 0:g.toDate())||new Date}})}}catch(i){return console.error("Error getting wallet:",i),null}},XF=async s=>{const n={userId:s,balance:0,totalEarned:0,totalSpent:0,transactions:[],lastUpdated:new Date},i=at(Me,"wallets",s);return await yo(i,{...n,lastUpdated:cn.fromDate(n.lastUpdated)}),n},$F=async(s,n,i,l="purchase")=>{try{let u=await Uy(s);u||(u=await XF(s));const p={id:`tx_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:l,amount:n,description:i,createdAt:new Date},g=at(Me,"wallets",s);return await Kn(g,{balance:ta(n),totalEarned:ta(l==="earn"?n:0),transactions:[...u.transactions.slice(-49),{...p,createdAt:cn.fromDate(p.createdAt)}],lastUpdated:cn.fromDate(new Date)}),!0}catch(u){return console.error("Error adding coins:",u),!1}},JF=async(s,n,i,l)=>{try{const u=await Uy(s);if(!u||u.balance<n)return!1;const p={id:`tx_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"spend",amount:-n,description:i,relatedContentId:l,createdAt:new Date},g=at(Me,"wallets",s);return await Kn(g,{balance:ta(-n),totalSpent:ta(n),transactions:[...u.transactions.slice(-49),{...p,createdAt:cn.fromDate(p.createdAt)}],lastUpdated:cn.fromDate(new Date)}),!0}catch(u){return console.error("Error spending coins:",u),!1}},QF=async(s,n,i)=>{try{const l=xn(Me,"lockedContent");return(await my(l,{...i,creatorId:s,creatorUsername:n,totalUnlocks:0,totalRevenue:0,createdAt:cn.fromDate(new Date)})).id}catch(l){return console.error("Error creating locked content:",l),null}},mk=async s=>{var n,i;try{const l=at(Me,"lockedContent",s),u=await fr(l);if(!u.exists())return null;const p=u.data();return{id:u.id,...p,createdAt:((n=p.createdAt)==null?void 0:n.toDate())||new Date,expiresAt:(i=p.expiresAt)==null?void 0:i.toDate()}}catch(l){return console.error("Error getting locked content:",l),null}},Zre=async(s,n=20)=>{try{const i=xn(Me,"lockedContent"),l=Zr(i,or("creatorId","==",s),or("isActive","==",!0),fy("createdAt","desc"),VE(n));return(await Ur(l)).docs.map(p=>{var g,y;return{id:p.id,...p.data(),createdAt:((g=p.data().createdAt)==null?void 0:g.toDate())||new Date,expiresAt:(y=p.data().expiresAt)==null?void 0:y.toDate()}})}catch(i){return console.error("Error getting creator content:",i),[]}},ZF=async(s,n)=>{try{const i=at(Me,"contentUnlocks",`${s}_${n}`);return(await fr(i)).exists()}catch{return!1}},eB=async s=>{try{const i=(await ST(s)).totalReferrals,l=xn(Me,"contentUnlocks"),u=Zr(l,or("userId","==",s),or("method","==","referral")),g=(await Ur(u)).docs.reduce((y,x)=>y+(x.data().invitesUsed||0),0);return Math.max(0,i-g)}catch(n){return console.error("Error calculating free unlocks:",n),0}},ese=async(s,n,i)=>{var l,u;try{if(await ZF(s,n)){const G=await mk(n);return{success:!0,content:G==null?void 0:G.content}}const g=await mk(n);if(!g)return{success:!1,error:"Inhalt nicht gefunden"};if(!g.unlockMethods.includes(i))return{success:!1,error:"Diese Unlock-Methode ist nicht verfgbar"};let y=0,x=0,C=0;if(i==="coins"){const G=await Uy(s);if(!G||G.balance<g.unlockCost)return{success:!1,error:"Nicht gengend Coins"};if(!await JF(s,g.unlockCost,`Unlock: ${g.title}`,n))return{success:!1,error:"Zahlung fehlgeschlagen"};y=g.unlockCost;const Z=((l=(await fr(at(Me,"creatorProfiles",g.creatorId))).data())==null?void 0:l.tier)||"user",q=Bu[Z].revenueShare/100;C=Math.floor(y*q),C>0&&await $F(g.creatorId,C,`Unlock-Einnahmen: ${g.title}`,"earn")}else if(i==="referral"){const G=await eB(s);if(G<g.requiresInvites)return{success:!1,error:`Du brauchst ${g.requiresInvites} erfolgreiche Einladung(en). Du hast ${G} verfgbar.`};x=g.requiresInvites}else if(i==="premium"&&!((u=(await fr(at(Me,"users",s))).data())!=null&&u.isPremium))return{success:!1,error:"Premium-Mitgliedschaft erforderlich"};const k=at(Me,"contentUnlocks",`${s}_${n}`);await yo(k,{contentId:n,userId:s,method:i,coinsPaid:y,invitesUsed:x,creatorRevenue:C,unlockedAt:cn.fromDate(new Date)});const A=at(Me,"lockedContent",n);await Kn(A,{totalUnlocks:ta(1),totalRevenue:ta(y)});const M=at(Me,"creatorProfiles",g.creatorId);return await Kn(M,{totalUnlocks:ta(1),totalRevenue:ta(C)}),{success:!0,content:g.content}}catch(p){return console.error("Error unlocking content:",p),{success:!1,error:"Fehler beim Entsperren"}}},tse=s=>s.length<=yy.previewTextLength?s:s.substring(0,yy.previewTextLength)+"...",nse=s=>s?{filter:`blur(${yy.blurIntensity}px)`,WebkitFilter:`blur(${yy.blurIntensity}px)`,userSelect:"none",pointerEvents:"none"}:{},ZCe={LOCK_CONFIG:yy,CURRENCY_CONFIG:YF,getUserWallet:Uy,initializeWallet:XF,addCoins:$F,spendCoins:JF,createLockedContent:QF,getLockedContent:mk,getCreatorLockedContent:Zre,hasUnlockedContent:ZF,getAvailableFreeUnlocks:eB,unlockContent:ese,generatePreviewText:tse,getBlurStyle:nse},eNe=Object.freeze(Object.defineProperty({__proto__:null,CURRENCY_CONFIG:YF,LOCK_CONFIG:yy,addCoins:$F,createLockedContent:QF,default:ZCe,generatePreviewText:tse,getAvailableFreeUnlocks:eB,getBlurStyle:nse,getCreatorLockedContent:Zre,getLockedContent:mk,getUserWallet:Uy,hasUnlockedContent:ZF,initializeWallet:XF,spendCoins:JF,unlockContent:ese},Symbol.toStringTag,{value:"Module"})),GJ=()=>{const s=zr(),{user:n}=mr(),[i,l]=H.useState(null),[u,p]=H.useState([]),[g,y]=H.useState(0),[x,C]=H.useState({totalReferrals:0,xpEarned:0}),[k,A]=H.useState(!0);H.useEffect(()=>{M()},[n==null?void 0:n.id]);const M=async()=>{if(n!=null&&n.id){A(!0);try{const q=await $Ce(n.id);l(q);const V=await Uy(n.id);y((V==null?void 0:V.balance)||0);const ee=await ST(n.id);C(ee);const de=xn(Me,"lockedContent"),ae=Zr(de,or("creatorId","==",n.id),fy("createdAt","desc"),VE(10)),ye=await Ur(ae);p(ye.docs.map(Q=>{var $;return{id:Q.id,...Q.data(),createdAt:(($=Q.data().createdAt)==null?void 0:$.toDate())||new Date}}))}catch(q){console.error("Error loading dashboard:",q)}A(!1)}},G=(i==null?void 0:i.tier)||"user",B=Bu[G],X=(n==null?void 0:n.level)||1,Z=XCe(G,(i==null?void 0:i.followerCount)||0,(i==null?void 0:i.successfulInvites)||0,X);return k?o.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500"})}):o.jsxs("div",{className:"min-h-screen bg-gray-900 text-white pb-24",children:[o.jsx("div",{className:"bg-gradient-to-b from-purple-900/50 to-transparent",children:o.jsxs("div",{className:"px-4 py-6 safe-top",children:[o.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[o.jsx("button",{onClick:()=>s(-1),className:"w-10 h-10 bg-white/10 rounded-xl flex items-center justify-center",children:o.jsx(sa,{size:20})}),o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-bold",children:"Creator Dashboard"}),o.jsx("p",{className:"text-sm text-white/60",children:"Deine Statistiken & Verdienste"})]})]}),o.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-2xl p-6 border border-white/10",children:[o.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[o.jsx(QCe,{avatarUrl:n==null?void 0:n.avatarUrl,level:X,creatorTier:G,isVerified:i==null?void 0:i.isVerified,size:"xl",showParticles:!0}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.jsx("h2",{className:"text-xl font-bold",children:n==null?void 0:n.displayName}),(i==null?void 0:i.isVerified)&&o.jsx("span",{className:"text-purple-400",children:""})]}),o.jsxs("p",{className:"text-white/60 mb-2",children:["@",n==null?void 0:n.username]}),o.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-semibold",style:{backgroundColor:`${B.color}20`,color:B.color},children:[o.jsx("span",{children:B.emoji}),o.jsx("span",{children:B.nameDE})]})]})]}),Z.nextTier&&o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"flex items-center justify-between text-sm",children:[o.jsx("span",{className:"text-white/60",children:"Nchstes Level"}),o.jsxs("span",{style:{color:Bu[Z.nextTier].color},children:[Bu[Z.nextTier].emoji," ",Bu[Z.nextTier].nameDE]})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between text-xs text-white/50 mb-1",children:[o.jsx("span",{children:"Follower"}),o.jsxs("span",{children:[Math.round(Z.followersProgress),"%"]})]}),o.jsx("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full bg-blue-500 transition-all",style:{width:`${Z.followersProgress}%`}})})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between text-xs text-white/50 mb-1",children:[o.jsx("span",{children:"Invites"}),o.jsxs("span",{children:[Math.round(Z.invitesProgress),"%"]})]}),o.jsx("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full bg-green-500 transition-all",style:{width:`${Z.invitesProgress}%`}})})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between text-xs text-white/50 mb-1",children:[o.jsx("span",{children:"Level"}),o.jsxs("span",{children:[Math.round(Z.levelProgress),"%"]})]}),o.jsx("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full bg-purple-500 transition-all",style:{width:`${Z.levelProgress}%`}})})]})]})]})]})]})}),o.jsxs("div",{className:"px-4 space-y-6",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"bg-gradient-to-br from-blue-500/20 to-cyan-500/20 rounded-2xl p-4 border border-blue-500/30",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.jsx(rr,{size:20,className:"text-blue-400"}),o.jsx("span",{className:"text-white/60 text-sm",children:"Follower"})]}),o.jsx("p",{className:"text-3xl font-bold",children:(i==null?void 0:i.followerCount)||0})]}),o.jsxs("div",{className:"bg-gradient-to-br from-purple-500/20 to-pink-500/20 rounded-2xl p-4 border border-purple-500/30",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.jsx(Ta,{size:20,className:"text-purple-400"}),o.jsx("span",{className:"text-white/60 text-sm",children:"Cloud Reach"})]}),o.jsx("p",{className:"text-3xl font-bold",children:(i==null?void 0:i.cloudReach)||0})]}),o.jsxs("div",{className:"bg-gradient-to-br from-green-500/20 to-emerald-500/20 rounded-2xl p-4 border border-green-500/30",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.jsx(ra,{size:20,className:"text-green-400"}),o.jsx("span",{className:"text-white/60 text-sm",children:"Referrals"})]}),o.jsx("p",{className:"text-3xl font-bold",children:x.totalReferrals})]}),o.jsxs("div",{className:"bg-gradient-to-br from-amber-500/20 to-orange-500/20 rounded-2xl p-4 border border-amber-500/30",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.jsx(Hi,{size:20,className:"text-amber-400"}),o.jsx("span",{className:"text-white/60 text-sm",children:"Unlocks"})]}),o.jsx("p",{className:"text-3xl font-bold",children:(i==null?void 0:i.totalUnlocks)||0})]})]}),o.jsxs("div",{className:"bg-gradient-to-r from-amber-600/20 to-yellow-600/20 rounded-2xl p-6 border border-amber-500/30",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-xl bg-amber-500/30 flex items-center justify-center",children:o.jsx(uV,{size:24,className:"text-amber-400"})}),o.jsxs("div",{children:[o.jsx("p",{className:"text-white/60 text-sm",children:"Dein Guthaben"}),o.jsxs("p",{className:"text-2xl font-bold text-amber-400",children:[" ",g]})]})]}),o.jsx("button",{className:"px-4 py-2 bg-amber-500 text-white font-semibold rounded-xl",children:"Auszahlen"})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"bg-white/5 rounded-xl p-3",children:[o.jsx("p",{className:"text-white/50 text-xs mb-1",children:"Gesamt verdient"}),o.jsxs("p",{className:"font-bold text-white",children:[" ",(i==null?void 0:i.totalRevenue)||0]})]}),o.jsxs("div",{className:"bg-white/5 rounded-xl p-3",children:[o.jsxs("p",{className:"text-white/50 text-xs mb-1",children:["Anteil (",B.revenueShare,"%)"]}),o.jsxs("p",{className:"font-bold text-green-400",children:["+",B.revenueShare,"%"]})]})]})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("h2",{className:"font-bold text-lg flex items-center gap-2",children:[o.jsx(Hi,{size:20,className:"text-purple-400"}),"Deine Secret Bubbles"]}),o.jsxs("button",{onClick:()=>s("/creator/new-content"),className:"flex items-center gap-1 text-purple-400 text-sm",children:[o.jsx($S,{size:16}),"Erstellen"]})]}),u.length===0?o.jsxs("div",{className:"bg-white/5 rounded-2xl p-8 text-center",children:[o.jsx(Hi,{size:48,className:"mx-auto text-white/20 mb-4"}),o.jsx("h3",{className:"font-semibold mb-2",children:"Noch keine Secret Bubbles"}),o.jsx("p",{className:"text-white/50 text-sm mb-4",children:"Erstelle exklusive Inhalte und verdiene an Unlocks!"}),o.jsx("button",{onClick:()=>s("/creator/new-content"),className:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl font-semibold",children:"Ersten Content erstellen"})]}):o.jsx("div",{className:"space-y-4",children:u.map(q=>o.jsxs("div",{className:"bg-white/5 rounded-2xl p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsx("h3",{className:"font-semibold",children:q.title}),o.jsxs("span",{className:"text-sm text-white/50",children:[q.totalUnlocks," Unlocks"]})]}),o.jsxs("div",{className:"flex items-center gap-4 text-sm text-white/60",children:[o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx(uV,{size:14})," ",q.unlockCost," Coins"]}),o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx(Ta,{size:14})," ",q.totalUnlocks," Views"]}),o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx(im,{size:14})," ",q.totalRevenue," verdient"]})]})]},q.id))})]}),o.jsxs("div",{className:"bg-white/5 rounded-2xl p-6",children:[o.jsxs("h2",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[o.jsx(wr,{size:20,className:"text-amber-400"}),"Deine Creator-Features"]}),o.jsx("div",{className:"space-y-3",children:B.features.map(q=>o.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/5 rounded-xl",children:[o.jsx("div",{className:"w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center",children:o.jsx(Ei,{size:16,className:"text-green-400"})}),o.jsx("span",{className:"capitalize",children:q.replace(/_/g," ")})]},q))}),Z.nextTier&&o.jsxs("div",{className:"mt-4 p-4 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-xl border border-purple-500/30",children:[o.jsx("p",{className:"text-sm text-purple-300 mb-2",children:"Nchste Stufe schaltet frei:"}),o.jsx("div",{className:"flex flex-wrap gap-2",children:Bu[Z.nextTier].features.filter(q=>!B.features.includes(q)).map(q=>o.jsx("span",{className:"px-2 py-1 bg-purple-500/20 text-purple-300 text-xs rounded-full capitalize",children:q.replace(/_/g," ")},q))})]})]})]})]})},Wh={maxFileSizeMB:5,maxFileSizeBytes:5*1024*1024,allowedTypes:["image/jpeg","image/png","image/gif","image/webp"],profilePicture:{maxWidth:500,maxHeight:500,quality:.85,folder:"profile-pictures"},headerImage:{maxWidth:1200,maxHeight:400,quality:.85,folder:"header-images"},lockedContent:{maxWidth:1920,maxHeight:1080,quality:.9,folder:"locked-content"},thumbnails:{width:200,height:200,quality:.6,blur:20,folder:"thumbnails"}},tNe=async(s,n,i,l)=>new Promise((u,p)=>{const g=new Image,y=document.createElement("canvas"),x=y.getContext("2d");g.onload=()=>{let C=g.width,k=g.height;C>n&&(k=k*n/C,C=n),k>i&&(C=C*i/k,k=i),y.width=C,y.height=k,x==null||x.drawImage(g,0,0,C,k),y.toBlob(A=>{A?u(A):p(new Error("Failed to process image"))},"image/jpeg",l)},g.onerror=()=>p(new Error("Failed to load image")),g.src=URL.createObjectURL(s)}),nNe=async(s,n=Wh.thumbnails.width,i=Wh.thumbnails.height,l=Wh.thumbnails.blur)=>new Promise((u,p)=>{const g=new Image,y=document.createElement("canvas"),x=y.getContext("2d");g.onload=()=>{const C=n/i;let k=0,A=0,M=g.width,G=g.height;g.width/g.height>C?(M=g.height*C,k=(g.width-M)/2):(G=g.width/C,A=(g.height-G)/2),y.width=n,y.height=i,x&&(x.filter=`blur(${l}px)`,x.drawImage(g,k,A,M,G,-l,-l,n+l*2,i+l*2)),y.toBlob(B=>{B?u(B):p(new Error("Failed to create thumbnail"))},"image/jpeg",Wh.thumbnails.quality)},g.onerror=()=>p(new Error("Failed to load image")),g.src=URL.createObjectURL(s)}),rNe=async(s,n,i)=>{try{if(!Wh.allowedTypes.includes(s.type))return{success:!1,error:"Ungltiger Dateityp. Erlaubt: JPG, PNG, GIF, WebP"};if(s.size>Wh.maxFileSizeBytes)return{success:!1,error:`Datei zu gro. Maximum: ${Wh.maxFileSizeMB}MB`};const l=Wh[i],u=ire(),p=await tNe(s,l.maxWidth,l.maxHeight,l.quality),g=Date.now(),x=`${n}_${g}.jpg`,C=`${l.folder}/${x}`,k=cV(u,C);await aV(k,p);const A=await oV(k);let M;if(i==="lockedContent"){const G=await nNe(s),B=`${Wh.thumbnails.folder}/${x}`,X=cV(u,B);await aV(X,G),M=await oV(X)}return{success:!0,url:A,thumbnailUrl:M}}catch(l){return console.error("Upload error:",l),{success:!1,error:"Upload fehlgeschlagen. Bitte versuche es erneut."}}},sNe=()=>{const s=zr(),{user:n}=mr(),i=H.useRef(null),[l,u]=H.useState("text"),[p,g]=H.useState(""),[y,x]=H.useState(""),[C,k]=H.useState(""),[A,M]=H.useState(YF.unlockCost),[G,B]=H.useState(1),[X,Z]=H.useState(["coins","referral"]),[q,V]=H.useState(null),[ee,de]=H.useState(null),[ae,ye]=H.useState(!1),[Q,$]=H.useState(null),[se,ce]=H.useState(!1),he=qe=>{var gt;const Dt=(gt=qe.target.files)==null?void 0:gt[0];if(Dt){V(Dt);const Ye=new FileReader;Ye.onloadend=()=>{de(Ye.result)},Ye.readAsDataURL(Dt)}},ve=qe=>{X.includes(qe)?X.length>1&&Z(X.filter(Dt=>Dt!==qe)):Z([...X,qe])},ge=async()=>{if(n!=null&&n.id){if(!p.trim()){$("Bitte gib einen Titel ein");return}if(l==="text"&&!y.trim()){$("Bitte gib den Content ein");return}if(l==="image"&&!q){$("Bitte whle ein Bild aus");return}ye(!0),$(null);try{let qe=y,Dt;if(l==="image"&&q){const Ye=await rNe(q,n.id,"lockedContent");if(Ye.success&&Ye.url)qe=Ye.url,Dt=Ye.thumbnailUrl;else throw new Error(Ye.error||"Bild-Upload fehlgeschlagen")}if(await QF(n.id,n.username||"Anonym",{title:p.trim(),content:qe,previewText:C.trim()||void 0,thumbnailUrl:Dt,type:l,unlockCost:A,unlockMethods:X,requiresInvites:G,isActive:!0}))ce(!0),setTimeout(()=>{s("/creator/dashboard")},2e3);else throw new Error("Fehler beim Erstellen")}catch(qe){$(qe.message||"Ein Fehler ist aufgetreten")}ye(!1)}};return se?o.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-4",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"w-20 h-20 mx-auto bg-green-500/20 rounded-full flex items-center justify-center mb-4",children:o.jsx(zn,{size:40,className:"text-green-400"})}),o.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Secret Bubble erstellt!"}),o.jsx("p",{className:"text-white/60",children:"Wird zum Dashboard weitergeleitet..."})]})}):o.jsxs("div",{className:"min-h-screen bg-gray-900 text-white pb-24",children:[o.jsx("div",{className:"bg-gradient-to-b from-purple-900/50 to-transparent",children:o.jsx("div",{className:"px-4 py-6 safe-top",children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("button",{onClick:()=>s(-1),className:"w-10 h-10 bg-white/10 rounded-xl flex items-center justify-center",children:o.jsx(sa,{size:20})}),o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-bold",children:"Secret Bubble erstellen"}),o.jsx("p",{className:"text-sm text-white/60",children:"Exklusiver Content fr deine Fans"})]})]})})}),o.jsxs("div",{className:"px-4 space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"text-sm text-white/60 mb-2 block",children:"Content-Typ"}),o.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{type:"text",icon:wRe,label:"Text"},{type:"image",icon:iRe,label:"Bild"},{type:"video",icon:Pre,label:"Video",disabled:!0}].map(({type:qe,icon:Dt,label:gt,disabled:Ye})=>o.jsxs("button",{onClick:()=>!Ye&&u(qe),disabled:Ye,className:`p-4 rounded-xl flex flex-col items-center gap-2 transition-all ${l===qe?"bg-purple-500 text-white":Ye?"bg-white/5 text-white/30 cursor-not-allowed":"bg-white/10 text-white/70 hover:bg-white/15"}`,children:[o.jsx(Dt,{size:24}),o.jsx("span",{className:"text-sm font-medium",children:gt}),Ye&&o.jsx("span",{className:"text-xs",children:"Bald"})]},qe))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-sm text-white/60 mb-2 block",children:"Titel"}),o.jsx("input",{type:"text",value:p,onChange:qe=>g(qe.target.value),placeholder:"z.B. Exklusives Behind-the-Scenes",className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/40 focus:outline-none focus:border-purple-500",maxLength:100})]}),l==="text"&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{children:[o.jsx("label",{className:"text-sm text-white/60 mb-2 block",children:"Geheimer Content"}),o.jsx("textarea",{value:y,onChange:qe=>x(qe.target.value),placeholder:"Der Content, der nach dem Entsperren sichtbar wird...",className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/40 focus:outline-none focus:border-purple-500 min-h-[150px] resize-none",maxLength:2e3}),o.jsxs("p",{className:"text-xs text-white/40 mt-1",children:[y.length,"/2000"]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-sm text-white/60 mb-2 block",children:"Preview-Text (optional)"}),o.jsx("input",{type:"text",value:C,onChange:qe=>k(qe.target.value),placeholder:"Kurzer Teaser, der verschwommen angezeigt wird",className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/40 focus:outline-none focus:border-purple-500",maxLength:200})]})]}),l==="image"&&o.jsxs("div",{children:[o.jsx("label",{className:"text-sm text-white/60 mb-2 block",children:"Bild auswhlen"}),o.jsx("input",{ref:i,type:"file",accept:"image/*",onChange:he,className:"hidden"}),ee?o.jsxs("div",{className:"relative",children:[o.jsx("img",{src:ee,alt:"Preview",className:"w-full aspect-video object-cover rounded-xl"}),o.jsx("button",{onClick:()=>{V(null),de(null)},className:"absolute top-2 right-2 w-8 h-8 bg-black/50 rounded-full flex items-center justify-center",children:o.jsx(Rs,{size:16})})]}):o.jsxs("button",{onClick:()=>{var qe;return(qe=i.current)==null?void 0:qe.click()},className:"w-full aspect-video bg-white/5 border-2 border-dashed border-white/20 rounded-xl flex flex-col items-center justify-center gap-3 hover:border-purple-500 transition-colors",children:[o.jsx(Dre,{size:40,className:"text-white/40"}),o.jsx("span",{className:"text-white/60",children:"Bild hochladen"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-sm text-white/60 mb-2 block",children:"Entsperr-Methoden"}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("button",{onClick:()=>ve("coins"),className:`w-full p-4 rounded-xl flex items-center gap-4 transition-all ${X.includes("coins")?"bg-amber-500/20 border-2 border-amber-500/50":"bg-white/5 border-2 border-transparent"}`,children:[o.jsx("div",{className:"w-10 h-10 rounded-full bg-amber-500/20 flex items-center justify-center",children:o.jsx(uV,{size:20,className:"text-amber-400"})}),o.jsxs("div",{className:"flex-1 text-left",children:[o.jsx("p",{className:"font-semibold",children:"Mit Coins"}),o.jsx("p",{className:"text-sm text-white/60",children:"User zahlen Delulu Coins"})]}),o.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${X.includes("coins")?"bg-amber-500":"bg-white/20"}`,children:X.includes("coins")&&o.jsx(zn,{size:14})})]}),o.jsxs("button",{onClick:()=>ve("referral"),className:`w-full p-4 rounded-xl flex items-center gap-4 transition-all ${X.includes("referral")?"bg-green-500/20 border-2 border-green-500/50":"bg-white/5 border-2 border-transparent"}`,children:[o.jsx("div",{className:"w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center",children:o.jsx(rr,{size:20,className:"text-green-400"})}),o.jsxs("div",{className:"flex-1 text-left",children:[o.jsx("p",{className:"font-semibold",children:"Mit Einladung"}),o.jsx("p",{className:"text-sm text-white/60",children:"Gratis durch Freunde einladen"})]}),o.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${X.includes("referral")?"bg-green-500":"bg-white/20"}`,children:X.includes("referral")&&o.jsx(zn,{size:14})})]}),o.jsxs("button",{onClick:()=>ve("premium"),className:`w-full p-4 rounded-xl flex items-center gap-4 transition-all ${X.includes("premium")?"bg-purple-500/20 border-2 border-purple-500/50":"bg-white/5 border-2 border-transparent"}`,children:[o.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-500/20 flex items-center justify-center",children:o.jsx(hs,{size:20,className:"text-purple-400"})}),o.jsxs("div",{className:"flex-1 text-left",children:[o.jsx("p",{className:"font-semibold",children:"Fr Premium"}),o.jsx("p",{className:"text-sm text-white/60",children:"Premium-User haben Zugang"})]}),o.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${X.includes("premium")?"bg-purple-500":"bg-white/20"}`,children:X.includes("premium")&&o.jsx(zn,{size:14})})]})]})]}),X.includes("coins")&&o.jsxs("div",{children:[o.jsx("label",{className:"text-sm text-white/60 mb-2 block",children:"Coin-Preis"}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("input",{type:"range",min:"10",max:"500",step:"10",value:A,onChange:qe=>M(Number(qe.target.value)),className:"flex-1 accent-amber-500"}),o.jsx("div",{className:"w-24 px-4 py-2 bg-amber-500/20 rounded-xl text-center",children:o.jsxs("span",{className:"font-bold text-amber-400",children:[" ",A]})})]})]}),X.includes("referral")&&o.jsxs("div",{children:[o.jsx("label",{className:"text-sm text-white/60 mb-2 block",children:"Bentigte Einladungen"}),o.jsx("div",{className:"flex items-center gap-4",children:[1,2,3,5].map(qe=>o.jsx("button",{onClick:()=>B(qe),className:`flex-1 py-3 rounded-xl font-semibold transition-all ${G===qe?"bg-green-500 text-white":"bg-white/10 text-white/70"}`,children:qe},qe))})]}),Q&&o.jsx("div",{className:"p-4 bg-red-500/20 border border-red-500/30 rounded-xl text-red-400",children:Q}),o.jsx("button",{onClick:ge,disabled:ae,className:"w-full py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold rounded-xl flex items-center justify-center gap-3 disabled:opacity-50",children:ae?o.jsxs(o.Fragment,{children:[o.jsx(Br,{size:20,className:"animate-spin"}),"Wird erstellt..."]}):o.jsxs(o.Fragment,{children:[o.jsx(wr,{size:20}),"Secret Bubble erstellen"]})}),o.jsxs("div",{className:"p-4 bg-white/5 rounded-xl",children:[o.jsxs("h3",{className:"font-semibold mb-2 flex items-center gap-2",children:[o.jsx(Hi,{size:16,className:"text-purple-400"}),"So funktioniert's"]}),o.jsxs("ul",{className:"text-sm text-white/60 space-y-2",children:[o.jsx("li",{children:" Dein Content wird mit Blur-Effekt angezeigt"}),o.jsx("li",{children:" User knnen mit Coins oder Einladungen entsperren"}),o.jsx("li",{children:" Du verdienst bei jedem Unlock basierend auf deinem Creator-Tier"}),o.jsx("li",{children:" Premium-User haben kostenlosen Zugang (wenn aktiviert)"})]})]})]})]})},WJ=()=>{const s=zr();tl();const{blockedUsers:n,isLoading:i,unblockUser:l}=gO(),[u,p]=H.useState(""),[g,y]=H.useState(null),[x,C]=H.useState(null),k=n.filter(B=>{var X;return B.username.toLowerCase().includes(u.toLowerCase())||((X=B.displayName)==null?void 0:X.toLowerCase().includes(u.toLowerCase()))}),A=async B=>{y(B);const X=await l(B);y(null),C(null),X&&"vibrate"in navigator&&navigator.vibrate(10)},M=B=>new Intl.DateTimeFormat("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}).format(B),G=B=>({harassment:"Belstigung",spam:"Spam / Werbung",inappropriate:"Unangemessen",personal:"Persnliche Grnde",other:"Sonstiges"})[B||""]||"Persnliche Grnde";return o.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-white safe-top",children:[o.jsx("div",{className:"sticky top-0 z-10 bg-white/80 backdrop-blur-lg border-b border-gray-100",children:o.jsxs("div",{className:"px-4 py-4 flex items-center gap-3",children:[o.jsx("button",{onClick:()=>s(-1),className:"w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center",children:o.jsx(Gu,{size:20,className:"text-gray-600"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h1",{className:"font-display text-xl font-bold text-gray-900",children:"Blockierte Nutzer"}),o.jsxs("p",{className:"text-xs text-gray-500",children:[n.length," ",n.length===1?"Person":"Personen"," blockiert"]})]}),o.jsx("div",{className:"w-10 h-10 rounded-xl bg-red-100 flex items-center justify-center",children:o.jsx(li,{size:20,className:"text-red-500"})})]})}),n.length>5&&o.jsx("div",{className:"px-4 py-3",children:o.jsxs("div",{className:"relative",children:[o.jsx(JS,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"}),o.jsx("input",{type:"text",value:u,onChange:B=>p(B.target.value),placeholder:"Suchen...",className:"w-full pl-11 pr-4 py-3 bg-gray-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-violet-500"})]})}),o.jsxs("div",{className:"px-4 py-4",children:[i?o.jsx("div",{className:"flex items-center justify-center py-20",children:o.jsx(Br,{size:32,className:"text-gray-300 animate-spin"})}):n.length===0?o.jsxs("div",{className:"text-center py-20",children:[o.jsx("div",{className:"w-20 h-20 mx-auto rounded-full bg-green-100 flex items-center justify-center mb-4",children:o.jsx(dk,{size:32,className:"text-green-500"})}),o.jsx("h2",{className:"font-semibold text-gray-900 mb-2",children:"Keine blockierten Nutzer"}),o.jsx("p",{className:"text-sm text-gray-500 max-w-xs mx-auto",children:"Du hast noch niemanden blockiert. Wenn dich jemand strt, kannst du ihn/sie auf dem Profil blockieren."})]}):k.length===0?o.jsxs("div",{className:"text-center py-20",children:[o.jsx(JS,{size:32,className:"text-gray-300 mx-auto mb-3"}),o.jsxs("p",{className:"text-gray-500",children:['Keine Ergebnisse fr "',u,'"']})]}):o.jsx("div",{className:"space-y-3",children:k.map(B=>o.jsx("div",{className:"bg-white rounded-2xl border border-gray-100 p-4 shadow-sm",children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("div",{className:"relative",children:[B.avatarUrl?o.jsx("img",{src:B.avatarUrl,alt:"",className:"w-14 h-14 rounded-xl object-cover grayscale"}):B.avatar?o.jsx(Kre,{avatarId:B.avatar,size:"lg",className:"grayscale"}):o.jsx("div",{className:"w-14 h-14 rounded-xl bg-gray-200 flex items-center justify-center text-gray-400",children:o.jsx(tp,{size:24})}),o.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 rounded-full bg-red-500 flex items-center justify-center",children:o.jsx(li,{size:12,className:"text-white"})})]}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("p",{className:"font-semibold text-gray-900 truncate",children:["@",B.username]}),B.displayName&&o.jsx("p",{className:"text-sm text-gray-500 truncate",children:B.displayName}),o.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Blockiert am ",M(B.blockedAt),"  ",G(B.reason)]})]}),o.jsxs("button",{onClick:()=>C(B.blockedUserId),disabled:g===B.blockedUserId,className:"px-4 py-2 bg-gray-100 text-gray-600 rounded-xl text-sm font-semibold hover:bg-gray-200 transition-colors disabled:opacity-50 flex items-center gap-2",children:[g===B.blockedUserId?o.jsx(Br,{size:16,className:"animate-spin"}):o.jsx(am,{size:16}),o.jsx("span",{className:"hidden sm:inline",children:"Entblocken"})]})]})},B.id))}),n.length>0&&o.jsx("div",{className:"mt-6 p-4 bg-amber-50 rounded-2xl border border-amber-200",children:o.jsxs("div",{className:"flex gap-3",children:[o.jsx(ql,{size:20,className:"text-amber-500 flex-shrink-0 mt-0.5"}),o.jsxs("div",{className:"text-sm text-amber-800",children:[o.jsx("p",{className:"font-medium mb-1",children:"Was passiert beim Blockieren?"}),o.jsxs("ul",{className:"text-xs space-y-1 text-amber-700",children:[o.jsx("li",{children:" Diese Person kann dir keine Nachrichten mehr senden"}),o.jsx("li",{children:' Ihr seht euch nicht mehr in der "In der Nhe"-Liste'}),o.jsx("li",{children:" Voice-Chats werden verhindert"}),o.jsx("li",{children:" Die Person erfhrt nicht, dass sie blockiert wurde"})]})]})]})})]}),x&&o.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:o.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-sm p-6 animate-in zoom-in-95",children:[o.jsx("div",{className:"w-16 h-16 mx-auto rounded-full bg-amber-100 flex items-center justify-center mb-4",children:o.jsx(am,{size:28,className:"text-amber-600"})}),o.jsx("h2",{className:"text-xl font-bold text-gray-900 text-center mb-2",children:"Nutzer entblocken?"}),o.jsx("p",{className:"text-gray-500 text-center text-sm mb-6",children:"Diese Person kann dich dann wieder kontaktieren und in Voice-Chats sehen."}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:()=>C(null),className:"flex-1 py-3 bg-gray-100 text-gray-600 rounded-xl font-semibold",children:"Abbrechen"}),o.jsx("button",{onClick:()=>A(x),className:"flex-1 py-3 bg-violet-500 text-white rounded-xl font-semibold flex items-center justify-center gap-2",children:g?o.jsx(Br,{size:18,className:"animate-spin"}):o.jsxs(o.Fragment,{children:[o.jsx(am,{size:18}),"Entblocken"]})})]})]})})]})},qA=()=>{const s=zr();return o.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white safe-top safe-bottom pb-24",children:[o.jsx("div",{className:"sticky top-0 z-20 bg-white/90 backdrop-blur-lg border-b border-gray-100",children:o.jsxs("div",{className:"px-6 py-4 flex items-center gap-4",children:[o.jsx("button",{onClick:()=>s(-1),className:"w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-delulu-muted hover:bg-gray-200 transition-colors",children:o.jsx(sa,{size:20})}),o.jsx("h1",{className:"font-display text-xl font-bold text-delulu-text",children:"Impressum"})]})}),o.jsxs("div",{className:"px-6 py-6 space-y-6",children:[o.jsxs("section",{children:[o.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"Angaben gem  5 TMG"}),o.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm space-y-2",children:[o.jsx("p",{className:"text-delulu-text font-medium",children:"Butterbread UG (haftungsbeschrnkt)"}),o.jsx("p",{className:"text-delulu-muted",children:"Musterstrae 123"}),o.jsx("p",{className:"text-delulu-muted",children:"12345 Musterstadt"}),o.jsx("p",{className:"text-delulu-muted",children:"Deutschland"})]})]}),o.jsxs("section",{children:[o.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"Kontakt"}),o.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm space-y-2",children:[o.jsxs("p",{className:"text-delulu-muted",children:[o.jsx("span",{className:"text-delulu-text",children:"E-Mail:"})," kontakt@delulu.app"]}),o.jsxs("p",{className:"text-delulu-muted",children:[o.jsx("span",{className:"text-delulu-text",children:"Telefon:"})," +49 (0) 123 456789"]})]})]}),o.jsxs("section",{children:[o.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"Vertreten durch"}),o.jsx("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:o.jsx("p",{className:"text-delulu-muted",children:"Geschftsfhrer: Jan Hundsdorff"})})]}),o.jsxs("section",{children:[o.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"Handelsregister"}),o.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm space-y-2",children:[o.jsxs("p",{className:"text-delulu-muted",children:[o.jsx("span",{className:"text-delulu-text",children:"Registergericht:"})," Amtsgericht Musterstadt"]}),o.jsxs("p",{className:"text-delulu-muted",children:[o.jsx("span",{className:"text-delulu-text",children:"Registernummer:"})," HRB 12345"]})]})]}),o.jsxs("section",{children:[o.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"Umsatzsteuer-ID"}),o.jsx("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:o.jsxs("p",{className:"text-delulu-muted",children:["Umsatzsteuer-Identifikationsnummer gem  27 a Umsatzsteuergesetz:",o.jsx("br",{}),"DE 123456789"]})})]}),o.jsxs("section",{children:[o.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"Verantwortlich fr den Inhalt nach  55 Abs. 2 RStV"}),o.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm space-y-2",children:[o.jsx("p",{className:"text-delulu-text font-medium",children:"Jan Hundsdorff"}),o.jsx("p",{className:"text-delulu-muted",children:"Musterstrae 123"}),o.jsx("p",{className:"text-delulu-muted",children:"12345 Musterstadt"})]})]}),o.jsxs("section",{children:[o.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"Streitschlichtung"}),o.jsx("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:o.jsxs("p",{className:"text-delulu-muted text-sm",children:["Die Europische Kommission stellt eine Plattform zur Online-Streitbeilegung (OS) bereit:",o.jsx("span",{className:"text-delulu-violet",children:" https://ec.europa.eu/consumers/odr"}),o.jsx("br",{}),o.jsx("br",{}),"Unsere E-Mail-Adresse finden Sie oben im Impressum.",o.jsx("br",{}),o.jsx("br",{}),"Wir sind nicht bereit oder verpflichtet, an Streitbeilegungsverfahren vor einer Verbraucherschlichtungsstelle teilzunehmen."]})})]}),o.jsx("div",{className:"text-center text-xs text-delulu-muted pt-4",children:"Stand: Januar 2025"})]})]})},O4=()=>{const s=zr();return o.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-delulu-soft/50 to-white safe-top safe-bottom pb-24",children:[o.jsx("div",{className:"sticky top-0 z-20 bg-white/90 backdrop-blur-lg border-b border-gray-100",children:o.jsxs("div",{className:"px-6 py-4 flex items-center gap-4",children:[o.jsx("button",{onClick:()=>s(-1),className:"w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-delulu-muted hover:bg-gray-200 transition-colors",children:o.jsx(sa,{size:20})}),o.jsx("h1",{className:"font-display text-xl font-bold text-delulu-text",children:"Datenschutzerklrung"})]})}),o.jsxs("div",{className:"px-6 py-6 space-y-6",children:[o.jsxs("section",{children:[o.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"1. Datenschutz auf einen Blick"}),o.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:[o.jsx("h3",{className:"font-medium text-delulu-text mb-2",children:"Allgemeine Hinweise"}),o.jsx("p",{className:"text-delulu-muted text-sm",children:"Die folgenden Hinweise geben einen einfachen berblick darber, was mit Ihren personenbezogenen Daten passiert, wenn Sie diese App nutzen. Personenbezogene Daten sind alle Daten, mit denen Sie persnlich identifiziert werden knnen."})]})]}),o.jsxs("section",{children:[o.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"2. Datenerfassung in der App"}),o.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm space-y-4",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"font-medium text-delulu-text mb-2",children:"Welche Daten erfassen wir?"}),o.jsxs("p",{className:"text-delulu-muted text-sm",children:[" Registrierungsdaten (E-Mail, Benutzername, Passwort)",o.jsx("br",{})," Profilinformationen (Avatar, Bio, Display-Name)",o.jsx("br",{})," Nutzungsdaten (Level, XP, Voice-Minuten, Sterne)",o.jsx("br",{})," Standortdaten (bei aktivierter Standortfreigabe)",o.jsx("br",{})," Gerte-Informationen"]})]}),o.jsxs("div",{children:[o.jsx("h3",{className:"font-medium text-delulu-text mb-2",children:"Wie erfassen wir Ihre Daten?"}),o.jsx("p",{className:"text-delulu-muted text-sm",children:"Ihre Daten werden zum einen dadurch erhoben, dass Sie uns diese mitteilen (z.B. bei der Registrierung). Andere Daten werden automatisch beim Nutzen der App durch unsere IT-Systeme erfasst."})]})]})]}),o.jsxs("section",{children:[o.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"3. Standortdaten"}),o.jsx("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:o.jsxs("p",{className:"text-delulu-muted text-sm",children:["delulu nutzt Standortdaten, um Nutzer in deiner Nhe zu finden und Voice-Rume basierend auf der Region anzuzeigen. Die Standortfreigabe ist optional und kann jederzeit in den Einstellungen deaktiviert werden.",o.jsx("br",{}),o.jsx("br",{}),o.jsx("strong",{children:"Wichtig:"})," Wir speichern keine genauen GPS-Koordinaten, sondern nur eine ungefhre Region (z.B. Stadt oder Stadtteil)."]})})]}),o.jsxs("section",{children:[o.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"4. Voice-Chat Daten"}),o.jsx("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:o.jsxs("p",{className:"text-delulu-muted text-sm",children:["Voice-Chats werden ",o.jsx("strong",{children:"nicht"})," aufgezeichnet oder gespeichert. Alle Gesprche sind live und werden nach Beendigung nicht archiviert.",o.jsx("br",{}),o.jsx("br",{}),"Wir erfassen lediglich Metadaten wie Dauer der Teilnahme (zur XP-Berechnung) und Bewertungen durch andere Nutzer."]})})]}),o.jsxs("section",{children:[o.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"5. Ihre Rechte"}),o.jsx("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:o.jsxs("p",{className:"text-delulu-muted text-sm",children:["Sie haben jederzeit das Recht:",o.jsx("br",{}),o.jsx("br",{})," Auskunft ber Ihre gespeicherten Daten zu erhalten",o.jsx("br",{})," Berichtigung unrichtiger Daten zu verlangen",o.jsx("br",{})," Lschung Ihrer Daten zu verlangen",o.jsx("br",{})," Die Verarbeitung einzuschrnken",o.jsx("br",{})," Datenbertragbarkeit zu verlangen",o.jsx("br",{})," Widerspruch gegen die Verarbeitung einzulegen"]})})]}),o.jsxs("section",{children:[o.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"6. Datenlschung"}),o.jsx("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:o.jsx("p",{className:"text-delulu-muted text-sm",children:'ber die Einstellungen  "Account lschen" knnen Sie Ihre gesamten Daten unwiderruflich lschen. Nach Besttigung werden alle personenbezogenen Daten innerhalb von 30 Tagen vollstndig entfernt.'})})]}),o.jsxs("section",{children:[o.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"7. Kontakt"}),o.jsx("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:o.jsxs("p",{className:"text-delulu-muted text-sm",children:["Bei Fragen zum Datenschutz erreichen Sie uns unter:",o.jsx("br",{}),o.jsx("br",{}),o.jsx("strong",{children:"Butterbread UG (haftungsbeschrnkt)"}),o.jsx("br",{}),"Musterstrae 123",o.jsx("br",{}),"12345 Musterstadt",o.jsx("br",{}),o.jsx("br",{}),"E-Mail: datenschutz@delulu.app"]})})]}),o.jsxs("section",{children:[o.jsx("h2",{className:"font-semibold text-delulu-text text-lg mb-3",children:"8. nderungen"}),o.jsx("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:o.jsx("p",{className:"text-delulu-muted text-sm",children:"Wir behalten uns vor, diese Datenschutzerklrung anzupassen, damit sie stets den aktuellen rechtlichen Anforderungen entspricht oder um nderungen unserer Leistungen umzusetzen. Fr Ihren erneuten Besuch gilt dann die neue Datenschutzerklrung."})})]}),o.jsx("div",{className:"text-center text-xs text-delulu-muted pt-4",children:"Stand: Januar 2025"})]})]})},iNe=()=>{const[s]=aT(),n=zr(),[i,l]=H.useState(""),[u,p]=H.useState(""),[g,y]=H.useState(!1),[x,C]=H.useState(!1),[k,A]=H.useState(!0),[M,G]=H.useState(""),[B,X]=H.useState(!1),[Z,q]=H.useState(""),V=s.get("oobCode");H.useEffect(()=>{(async()=>{if(!V){G("Ungltiger oder abgelaufener Link"),A(!1);return}try{const se=await kEe(Fi,V);q(se),A(!1)}catch{G("Dieser Link ist ungltig oder abgelaufen. Bitte fordere einen neuen an."),A(!1)}})()},[V]);const ee={length:i.length>=8,uppercase:/[A-Z]/.test(i),lowercase:/[a-z]/.test(i),number:/[0-9]/.test(i),special:/[!@#$%^&*(),.?":{}|<>]/.test(i)},de=Object.values(ee).filter(Boolean).length,ae=de>=4,ye=i===u&&u.length>0,Q=async $=>{if($.preventDefault(),G(""),!ae){G("Bitte whle ein strkeres Passwort");return}if(!ye){G("Die Passwrter stimmen nicht berein");return}if(!V){G("Ungltiger Reset-Link");return}C(!0);try{await IEe(Fi,V,i),X(!0)}catch(se){se.code==="auth/expired-action-code"?G("Dieser Link ist abgelaufen. Bitte fordere einen neuen an."):se.code==="auth/invalid-action-code"?G("Dieser Link ist ungltig. Bitte fordere einen neuen an."):se.code==="auth/weak-password"?G("Das Passwort ist zu schwach."):G("Ein Fehler ist aufgetreten. Bitte versuche es erneut.")}finally{C(!1)}};return k?o.jsx("div",{className:"min-h-screen min-h-[100dvh] bg-gradient-to-b from-violet-50 via-white to-purple-50 flex items-center justify-center px-6",children:o.jsxs("div",{className:"text-center",children:[o.jsx(Ju,{children:o.jsx(ZS,{size:120,className:"mx-auto mb-6"})}),o.jsx("div",{className:"animate-pulse",children:o.jsx("p",{className:"text-gray-600 font-medium",children:"Link wird berprft..."})})]})}):M&&!Z?o.jsx("div",{className:"min-h-screen min-h-[100dvh] bg-gradient-to-b from-violet-50 via-white to-purple-50 flex items-center justify-center px-6",children:o.jsxs("div",{className:"text-center max-w-sm",children:[o.jsx(Ju,{children:o.jsx(zF,{size:140,className:"mx-auto mb-4"})}),o.jsx("h1",{className:"font-display text-2xl font-bold text-gray-900 mb-3",children:"Link ungltig"}),o.jsx("p",{className:"text-gray-500 mb-8",children:M}),o.jsx("button",{onClick:()=>n("/login"),className:"w-full py-4 bg-gradient-to-r from-violet-600 to-purple-600 text-white font-display font-bold rounded-2xl shadow-lg",children:"Zurck zum Login"})]})}):B?o.jsx("div",{className:"min-h-screen min-h-[100dvh] bg-gradient-to-b from-violet-50 via-white to-purple-50 flex items-center justify-center px-6",children:o.jsxs("div",{className:"text-center max-w-sm",children:[o.jsx("div",{className:"w-20 h-20 mx-auto rounded-full bg-green-100 flex items-center justify-center mb-6",children:o.jsx(Vu,{size:40,className:"text-green-600"})}),o.jsx("h1",{className:"font-display text-2xl font-bold text-gray-900 mb-3",children:"Passwort gendert! "}),o.jsx("p",{className:"text-gray-500 mb-8",children:"Dein Passwort wurde erfolgreich zurckgesetzt. Du kannst dich jetzt mit deinem neuen Passwort anmelden."}),o.jsx("button",{onClick:()=>n("/login"),className:"w-full py-4 bg-gradient-to-r from-violet-600 to-purple-600 text-white font-display font-bold rounded-2xl shadow-lg hover:shadow-xl transition-all",children:"Zum Login"})]})}):o.jsxs("div",{className:"min-h-screen min-h-[100dvh] bg-gradient-to-b from-violet-50 via-white to-purple-50 relative overflow-hidden",children:[o.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[o.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-violet-200/40 to-purple-300/30 rounded-full blur-3xl"}),o.jsx("div",{className:"absolute bottom-20 left-0 w-56 h-56 bg-gradient-to-tr from-pink-200/30 to-violet-200/30 rounded-full blur-3xl"})]}),o.jsxs("div",{className:"relative z-10 px-6 py-8 safe-top max-w-md mx-auto",children:[o.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[o.jsx("button",{onClick:()=>n("/login"),className:"w-10 h-10 rounded-xl bg-white/80 backdrop-blur-sm flex items-center justify-center shadow-sm border border-gray-100",children:o.jsx(sa,{size:20,className:"text-gray-600"})}),o.jsx("h1",{className:"font-display text-2xl font-bold text-gray-900",children:"Neues Passwort"})]}),o.jsx("div",{className:"flex justify-center mb-6",children:o.jsx(Ju,{children:o.jsx(ZS,{size:100})})}),o.jsxs("div",{className:"bg-violet-50 rounded-2xl p-4 mb-6 text-center",children:[o.jsx("p",{className:"text-sm text-gray-600",children:"Neues Passwort fr"}),o.jsx("p",{className:"font-semibold text-violet-700",children:Z})]}),o.jsxs("form",{onSubmit:Q,className:"space-y-5",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Neues Passwort"}),o.jsxs("div",{className:"relative",children:[o.jsx(Hi,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"}),o.jsx("input",{type:g?"text":"password",value:i,onChange:$=>l($.target.value),className:"w-full pl-12 pr-12 py-4 bg-white border-2 border-gray-200 rounded-2xl focus:border-violet-500 focus:outline-none transition-colors",required:!0}),o.jsx("button",{type:"button",onClick:()=>y(!g),className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-400",children:g?o.jsx($c,{size:18}):o.jsx(Ta,{size:18})})]}),i&&o.jsxs("div",{className:"mt-3 space-y-2",children:[o.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map($=>o.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${$<=de?de<=2?"bg-red-500":de===3?"bg-yellow-500":"bg-green-500":"bg-gray-200"}`},$))}),o.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[o.jsxs("div",{className:`flex items-center gap-1 ${ee.length?"text-green-600":"text-gray-400"}`,children:[ee.length?o.jsx(zn,{size:12}):o.jsx(Rs,{size:12}),"Min. 8 Zeichen"]}),o.jsxs("div",{className:`flex items-center gap-1 ${ee.uppercase?"text-green-600":"text-gray-400"}`,children:[ee.uppercase?o.jsx(zn,{size:12}):o.jsx(Rs,{size:12}),"Grobuchstabe"]}),o.jsxs("div",{className:`flex items-center gap-1 ${ee.lowercase?"text-green-600":"text-gray-400"}`,children:[ee.lowercase?o.jsx(zn,{size:12}):o.jsx(Rs,{size:12}),"Kleinbuchstabe"]}),o.jsxs("div",{className:`flex items-center gap-1 ${ee.number?"text-green-600":"text-gray-400"}`,children:[ee.number?o.jsx(zn,{size:12}):o.jsx(Rs,{size:12}),"Zahl"]})]})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Passwort besttigen"}),o.jsxs("div",{className:"relative",children:[o.jsx(Hi,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"}),o.jsx("input",{type:g?"text":"password",value:u,onChange:$=>p($.target.value),className:`w-full pl-12 pr-12 py-4 bg-white border-2 rounded-2xl focus:outline-none transition-colors ${u?ye?"border-green-500 focus:border-green-500":"border-red-500 focus:border-red-500":"border-gray-200 focus:border-violet-500"}`,required:!0}),u&&o.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2",children:ye?o.jsx(zn,{size:18,className:"text-green-500"}):o.jsx(Rs,{size:18,className:"text-red-500"})})]})]}),M&&o.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm bg-red-50 px-4 py-3 rounded-xl",children:[o.jsx(MF,{size:16}),M]}),o.jsx("button",{type:"submit",disabled:x||!ae||!ye,className:"w-full py-4 bg-gradient-to-r from-violet-600 to-purple-600 text-white font-display font-bold rounded-2xl shadow-lg shadow-violet-500/30 hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Wird gespeichert...":"Passwort speichern"})]})]})]})},aNe={golden:{gradient:"from-amber-300 via-yellow-400 to-orange-400",shimmer:"from-transparent via-white/40 to-transparent",glow:"shadow-amber-500/50",accent:"text-amber-900",badge:" Golden Ticket",border:"border-amber-400/50"},platinum:{gradient:"from-slate-200 via-gray-100 to-slate-300",shimmer:"from-transparent via-white/60 to-transparent",glow:"shadow-slate-400/50",accent:"text-slate-700",badge:" Platinum Pass",border:"border-slate-300/50"},diamond:{gradient:"from-violet-400 via-purple-300 to-fuchsia-400",shimmer:"from-transparent via-white/50 to-transparent",glow:"shadow-purple-500/50",accent:"text-purple-900",badge:" Diamond Elite",border:"border-purple-400/50"}},oNe=({mousePosition:s,isHovered:n})=>o.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden rounded-3xl",style:{opacity:n?1:0,transition:"opacity 0.3s ease"},children:[o.jsx("div",{className:"absolute w-[200%] h-[200%] opacity-30",style:{background:`
          radial-gradient(
            circle at ${s.x}% ${s.y}%,
            rgba(255, 0, 128, 0.3) 0%,
            rgba(128, 0, 255, 0.2) 25%,
            rgba(0, 128, 255, 0.2) 50%,
            rgba(0, 255, 128, 0.1) 75%,
            transparent 100%
          )
        `,transform:"translate(-25%, -25%)",transition:"all 0.1s ease-out"}}),o.jsx("div",{className:"absolute inset-0",style:{background:"repeating-linear-gradient(0deg, transparent 0px, rgba(255,255,255,0.03) 1px, transparent 2px)"}})]}),cNe=({isActive:s})=>s?o.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-hidden rounded-3xl",children:[...Array(6)].map((n,i)=>o.jsx("div",{className:"absolute w-1 h-1 bg-white rounded-full animate-float",style:{left:`${15+i*15}%`,top:`${20+i%3*25}%`,animationDelay:`${i*.3}s`,animationDuration:`${2+i*.5}s`}},i))}):null,lNe=({code:s,remainingInvites:n,totalInvites:i,rewardDays:l,onShare:u,onCopy:p,onShowQR:g,variant:y="golden",isAnimated:x=!0})=>{const[C,k]=H.useState(!1),[A,M]=H.useState({x:50,y:50}),[G,B]=H.useState(!1),[X,Z]=H.useState(!1),q=H.useRef(null),V=aNe[y];H.useEffect(()=>{const Q=setTimeout(()=>Z(!0),100);return()=>clearTimeout(Q)},[]);const ee=H.useCallback(Q=>{if(!q.current)return;const $=q.current.getBoundingClientRect(),se=(Q.clientX-$.left)/$.width*100,ce=(Q.clientY-$.top)/$.height*100;M({x:se,y:ce})},[]),de=async()=>{try{const Q=` Du wurdest zu Delulu eingeladen!

 Dein VIP-Code: ${s}

 https://delulu.app/join/${s}`;await navigator.clipboard.writeText(Q),B(!0),"vibrate"in navigator&&navigator.vibrate([15,50,15]),p==null||p(),setTimeout(()=>B(!1),2e3)}catch(Q){console.error("Copy failed:",Q)}},ae=async()=>{if("vibrate"in navigator&&navigator.vibrate([10,30,10,30,10]),navigator.share)try{await navigator.share({title:"Delulu Einladung ",text:`Hey! Ich lade dich zu Delulu ein. Nutze meinen Code: ${s}`,url:`https://delulu.app/join/${s}`}),u==null||u()}catch{de()}else de()},ye=n/i*100;return o.jsxs("div",{ref:q,onMouseEnter:()=>k(!0),onMouseLeave:()=>k(!1),onMouseMove:ee,className:`
        relative overflow-hidden rounded-3xl
        transform transition-all duration-500 ease-out
        ${X?"scale-100 opacity-100":"scale-95 opacity-0"}
        ${C?"scale-[1.02]":"scale-100"}
      `,style:{transformStyle:"preserve-3d",perspective:"1000px"},children:[o.jsx("div",{className:`
          absolute inset-0 bg-gradient-to-br ${V.gradient}
          shadow-2xl ${V.glow}
        `}),o.jsx("div",{className:"absolute inset-0 opacity-20",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E")`}}),o.jsx(oNe,{mousePosition:A,isHovered:C}),o.jsx(cNe,{isActive:x&&C}),x&&o.jsx("div",{className:`absolute inset-0 bg-gradient-to-r ${V.shimmer} -translate-x-full animate-shimmer`}),o.jsxs("div",{className:"relative p-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(wr,{size:18,className:V.accent}),o.jsx("span",{className:`text-sm font-bold ${V.accent}`,children:V.badge})]}),o.jsxs("div",{className:`flex items-center gap-1 px-3 py-1 rounded-full bg-black/10 ${V.accent}`,children:[o.jsx(ra,{size:14}),o.jsxs("span",{className:"text-xs font-semibold",children:["+",l," Tage Premium"]})]})]}),o.jsxs("div",{className:"mb-6",children:[o.jsx("div",{className:"text-xs text-black/50 mb-2 uppercase tracking-wider",children:"Dein Einladungscode"}),o.jsxs("div",{className:`
              relative bg-white/30 backdrop-blur-sm rounded-2xl p-4
              border ${V.border}
            `,children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"font-mono text-2xl font-black tracking-widest text-black/80",children:s}),o.jsx("button",{onClick:de,className:`
                  w-10 h-10 rounded-xl flex items-center justify-center
                  transition-all duration-300
                  ${G?"bg-green-500 text-white scale-110":"bg-black/10 text-black/60 hover:bg-black/20 hover:scale-105"}
                `,children:G?o.jsx(zn,{size:18}):o.jsx(FF,{size:18})})]}),o.jsx("div",{className:"absolute top-2 right-2 opacity-20",children:o.jsx(Fs,{size:12})}),o.jsx("div",{className:"absolute bottom-2 left-2 opacity-20",children:o.jsx(Fs,{size:12})})]})]}),o.jsxs("div",{className:"mb-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("span",{className:`text-xs ${V.accent} opacity-70`,children:"Verbleibende Einladungen"}),o.jsxs("span",{className:`text-sm font-bold ${V.accent}`,children:[n," / ",i]})]}),o.jsx("div",{className:"h-2 bg-black/10 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full bg-black/30 rounded-full transition-all duration-500",style:{width:`${ye}%`}})})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsxs("button",{onClick:ae,className:`
              flex-1 py-3.5 px-4 rounded-2xl font-bold text-sm
              bg-black/80 text-white
              flex items-center justify-center gap-2
              hover:bg-black hover:scale-[1.02]
              active:scale-[0.98]
              transition-all duration-200
              shadow-lg shadow-black/20
            `,children:[o.jsx(BF,{size:18}),"Teilen"]}),o.jsx("button",{onClick:g,className:`
              w-14 h-14 rounded-2xl
              bg-white/30 backdrop-blur-sm border ${V.border}
              flex items-center justify-center
              hover:bg-white/50 hover:scale-[1.02]
              active:scale-[0.98]
              transition-all duration-200
            `,children:o.jsx(mRe,{size:22,className:V.accent})})]})]}),o.jsx("div",{className:"absolute top-0 left-0 w-12 h-12 flex items-center justify-center opacity-30",children:o.jsx(hs,{size:20,className:V.accent})}),o.jsx("div",{className:"absolute bottom-0 right-0 w-12 h-12 flex items-center justify-center opacity-30",children:o.jsx(sRe,{size:20,className:V.accent})}),o.jsx("style",{children:`
        @keyframes shimmer {
          0% { transform: translateX(-100%); }
          100% { transform: translateX(200%); }
        }
        .animate-shimmer {
          animation: shimmer 3s ease-in-out infinite;
        }
        @keyframes float {
          0%, 100% {
            transform: translateY(0) scale(1);
            opacity: 0.6;
          }
          50% {
            transform: translateY(-20px) scale(1.2);
            opacity: 1;
          }
        }
        .animate-float {
          animation: float 3s ease-in-out infinite;
        }
      `})]})};var CT={},dNe=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},rse={},nl={};let tB;const uNe=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];nl.getSymbolSize=function(n){if(!n)throw new Error('"version" cannot be null or undefined');if(n<1||n>40)throw new Error('"version" should be in range from 1 to 40');return n*4+17};nl.getSymbolTotalCodewords=function(n){return uNe[n]};nl.getBCHDigit=function(s){let n=0;for(;s!==0;)n++,s>>>=1;return n};nl.setToSJISFunction=function(n){if(typeof n!="function")throw new Error('"toSJISFunc" is not a valid function.');tB=n};nl.isKanjiModeEnabled=function(){return typeof tB<"u"};nl.toSJIS=function(n){return tB(n)};var _O={};(function(s){s.L={bit:1},s.M={bit:0},s.Q={bit:3},s.H={bit:2};function n(i){if(typeof i!="string")throw new Error("Param is not a string");switch(i.toLowerCase()){case"l":case"low":return s.L;case"m":case"medium":return s.M;case"q":case"quartile":return s.Q;case"h":case"high":return s.H;default:throw new Error("Unknown EC Level: "+i)}}s.isValid=function(l){return l&&typeof l.bit<"u"&&l.bit>=0&&l.bit<4},s.from=function(l,u){if(s.isValid(l))return l;try{return n(l)}catch{return u}}})(_O);function sse(){this.buffer=[],this.length=0}sse.prototype={get:function(s){const n=Math.floor(s/8);return(this.buffer[n]>>>7-s%8&1)===1},put:function(s,n){for(let i=0;i<n;i++)this.putBit((s>>>n-i-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(s){const n=Math.floor(this.length/8);this.buffer.length<=n&&this.buffer.push(0),s&&(this.buffer[n]|=128>>>this.length%8),this.length++}};var hNe=sse;function NT(s){if(!s||s<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=s,this.data=new Uint8Array(s*s),this.reservedBit=new Uint8Array(s*s)}NT.prototype.set=function(s,n,i,l){const u=s*this.size+n;this.data[u]=i,l&&(this.reservedBit[u]=!0)};NT.prototype.get=function(s,n){return this.data[s*this.size+n]};NT.prototype.xor=function(s,n,i){this.data[s*this.size+n]^=i};NT.prototype.isReserved=function(s,n){return this.reservedBit[s*this.size+n]};var pNe=NT,ise={};(function(s){const n=nl.getSymbolSize;s.getRowColCoords=function(l){if(l===1)return[];const u=Math.floor(l/7)+2,p=n(l),g=p===145?26:Math.ceil((p-13)/(2*u-2))*2,y=[p-7];for(let x=1;x<u-1;x++)y[x]=y[x-1]-g;return y.push(6),y.reverse()},s.getPositions=function(l){const u=[],p=s.getRowColCoords(l),g=p.length;for(let y=0;y<g;y++)for(let x=0;x<g;x++)y===0&&x===0||y===0&&x===g-1||y===g-1&&x===0||u.push([p[y],p[x]]);return u}})(ise);var ase={};const fNe=nl.getSymbolSize,HJ=7;ase.getPositions=function(n){const i=fNe(n);return[[0,0],[i-HJ,0],[0,i-HJ]]};var ose={};(function(s){s.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const n={N1:3,N2:3,N3:40,N4:10};s.isValid=function(u){return u!=null&&u!==""&&!isNaN(u)&&u>=0&&u<=7},s.from=function(u){return s.isValid(u)?parseInt(u,10):void 0},s.getPenaltyN1=function(u){const p=u.size;let g=0,y=0,x=0,C=null,k=null;for(let A=0;A<p;A++){y=x=0,C=k=null;for(let M=0;M<p;M++){let G=u.get(A,M);G===C?y++:(y>=5&&(g+=n.N1+(y-5)),C=G,y=1),G=u.get(M,A),G===k?x++:(x>=5&&(g+=n.N1+(x-5)),k=G,x=1)}y>=5&&(g+=n.N1+(y-5)),x>=5&&(g+=n.N1+(x-5))}return g},s.getPenaltyN2=function(u){const p=u.size;let g=0;for(let y=0;y<p-1;y++)for(let x=0;x<p-1;x++){const C=u.get(y,x)+u.get(y,x+1)+u.get(y+1,x)+u.get(y+1,x+1);(C===4||C===0)&&g++}return g*n.N2},s.getPenaltyN3=function(u){const p=u.size;let g=0,y=0,x=0;for(let C=0;C<p;C++){y=x=0;for(let k=0;k<p;k++)y=y<<1&2047|u.get(C,k),k>=10&&(y===1488||y===93)&&g++,x=x<<1&2047|u.get(k,C),k>=10&&(x===1488||x===93)&&g++}return g*n.N3},s.getPenaltyN4=function(u){let p=0;const g=u.data.length;for(let x=0;x<g;x++)p+=u.data[x];return Math.abs(Math.ceil(p*100/g/5)-10)*n.N4};function i(l,u,p){switch(l){case s.Patterns.PATTERN000:return(u+p)%2===0;case s.Patterns.PATTERN001:return u%2===0;case s.Patterns.PATTERN010:return p%3===0;case s.Patterns.PATTERN011:return(u+p)%3===0;case s.Patterns.PATTERN100:return(Math.floor(u/2)+Math.floor(p/3))%2===0;case s.Patterns.PATTERN101:return u*p%2+u*p%3===0;case s.Patterns.PATTERN110:return(u*p%2+u*p%3)%2===0;case s.Patterns.PATTERN111:return(u*p%3+(u+p)%2)%2===0;default:throw new Error("bad maskPattern:"+l)}}s.applyMask=function(u,p){const g=p.size;for(let y=0;y<g;y++)for(let x=0;x<g;x++)p.isReserved(x,y)||p.xor(x,y,i(u,x,y))},s.getBestMask=function(u,p){const g=Object.keys(s.Patterns).length;let y=0,x=1/0;for(let C=0;C<g;C++){p(C),s.applyMask(C,u);const k=s.getPenaltyN1(u)+s.getPenaltyN2(u)+s.getPenaltyN3(u)+s.getPenaltyN4(u);s.applyMask(C,u),k<x&&(x=k,y=C)}return y}})(ose);var vO={};const Wf=_O,YA=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],XA=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];vO.getBlocksCount=function(n,i){switch(i){case Wf.L:return YA[(n-1)*4+0];case Wf.M:return YA[(n-1)*4+1];case Wf.Q:return YA[(n-1)*4+2];case Wf.H:return YA[(n-1)*4+3];default:return}};vO.getTotalCodewordsCount=function(n,i){switch(i){case Wf.L:return XA[(n-1)*4+0];case Wf.M:return XA[(n-1)*4+1];case Wf.Q:return XA[(n-1)*4+2];case Wf.H:return XA[(n-1)*4+3];default:return}};var cse={},EO={};const _S=new Uint8Array(512),gk=new Uint8Array(256);(function(){let n=1;for(let i=0;i<255;i++)_S[i]=n,gk[n]=i,n<<=1,n&256&&(n^=285);for(let i=255;i<512;i++)_S[i]=_S[i-255]})();EO.log=function(n){if(n<1)throw new Error("log("+n+")");return gk[n]};EO.exp=function(n){return _S[n]};EO.mul=function(n,i){return n===0||i===0?0:_S[gk[n]+gk[i]]};(function(s){const n=EO;s.mul=function(l,u){const p=new Uint8Array(l.length+u.length-1);for(let g=0;g<l.length;g++)for(let y=0;y<u.length;y++)p[g+y]^=n.mul(l[g],u[y]);return p},s.mod=function(l,u){let p=new Uint8Array(l);for(;p.length-u.length>=0;){const g=p[0];for(let x=0;x<u.length;x++)p[x]^=n.mul(u[x],g);let y=0;for(;y<p.length&&p[y]===0;)y++;p=p.slice(y)}return p},s.generateECPolynomial=function(l){let u=new Uint8Array([1]);for(let p=0;p<l;p++)u=s.mul(u,new Uint8Array([1,n.exp(p)]));return u}})(cse);const lse=cse;function nB(s){this.genPoly=void 0,this.degree=s,this.degree&&this.initialize(this.degree)}nB.prototype.initialize=function(n){this.degree=n,this.genPoly=lse.generateECPolynomial(this.degree)};nB.prototype.encode=function(n){if(!this.genPoly)throw new Error("Encoder not initialized");const i=new Uint8Array(n.length+this.degree);i.set(n);const l=lse.mod(i,this.genPoly),u=this.degree-l.length;if(u>0){const p=new Uint8Array(this.degree);return p.set(l,u),p}return l};var mNe=nB,dse={},_m={},rB={};rB.isValid=function(n){return!isNaN(n)&&n>=1&&n<=40};var sh={};const use="[0-9]+",gNe="[A-Z $%*+\\-./:]+";let eT="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";eT=eT.replace(/u/g,"\\u");const _Ne="(?:(?![A-Z0-9 $%*+\\-./:]|"+eT+`)(?:.|[\r
]))+`;sh.KANJI=new RegExp(eT,"g");sh.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");sh.BYTE=new RegExp(_Ne,"g");sh.NUMERIC=new RegExp(use,"g");sh.ALPHANUMERIC=new RegExp(gNe,"g");const vNe=new RegExp("^"+eT+"$"),ENe=new RegExp("^"+use+"$"),yNe=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");sh.testKanji=function(n){return vNe.test(n)};sh.testNumeric=function(n){return ENe.test(n)};sh.testAlphanumeric=function(n){return yNe.test(n)};(function(s){const n=rB,i=sh;s.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},s.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},s.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},s.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},s.MIXED={bit:-1},s.getCharCountIndicator=function(p,g){if(!p.ccBits)throw new Error("Invalid mode: "+p);if(!n.isValid(g))throw new Error("Invalid version: "+g);return g>=1&&g<10?p.ccBits[0]:g<27?p.ccBits[1]:p.ccBits[2]},s.getBestModeForData=function(p){return i.testNumeric(p)?s.NUMERIC:i.testAlphanumeric(p)?s.ALPHANUMERIC:i.testKanji(p)?s.KANJI:s.BYTE},s.toString=function(p){if(p&&p.id)return p.id;throw new Error("Invalid mode")},s.isValid=function(p){return p&&p.bit&&p.ccBits};function l(u){if(typeof u!="string")throw new Error("Param is not a string");switch(u.toLowerCase()){case"numeric":return s.NUMERIC;case"alphanumeric":return s.ALPHANUMERIC;case"kanji":return s.KANJI;case"byte":return s.BYTE;default:throw new Error("Unknown mode: "+u)}}s.from=function(p,g){if(s.isValid(p))return p;try{return l(p)}catch{return g}}})(_m);(function(s){const n=nl,i=vO,l=_O,u=_m,p=rB,g=7973,y=n.getBCHDigit(g);function x(M,G,B){for(let X=1;X<=40;X++)if(G<=s.getCapacity(X,B,M))return X}function C(M,G){return u.getCharCountIndicator(M,G)+4}function k(M,G){let B=0;return M.forEach(function(X){const Z=C(X.mode,G);B+=Z+X.getBitsLength()}),B}function A(M,G){for(let B=1;B<=40;B++)if(k(M,B)<=s.getCapacity(B,G,u.MIXED))return B}s.from=function(G,B){return p.isValid(G)?parseInt(G,10):B},s.getCapacity=function(G,B,X){if(!p.isValid(G))throw new Error("Invalid QR Code version");typeof X>"u"&&(X=u.BYTE);const Z=n.getSymbolTotalCodewords(G),q=i.getTotalCodewordsCount(G,B),V=(Z-q)*8;if(X===u.MIXED)return V;const ee=V-C(X,G);switch(X){case u.NUMERIC:return Math.floor(ee/10*3);case u.ALPHANUMERIC:return Math.floor(ee/11*2);case u.KANJI:return Math.floor(ee/13);case u.BYTE:default:return Math.floor(ee/8)}},s.getBestVersionForData=function(G,B){let X;const Z=l.from(B,l.M);if(Array.isArray(G)){if(G.length>1)return A(G,Z);if(G.length===0)return 1;X=G[0]}else X=G;return x(X.mode,X.getLength(),Z)},s.getEncodedBits=function(G){if(!p.isValid(G)||G<7)throw new Error("Invalid QR Code version");let B=G<<12;for(;n.getBCHDigit(B)-y>=0;)B^=g<<n.getBCHDigit(B)-y;return G<<12|B}})(dse);var hse={};const vV=nl,pse=1335,bNe=21522,KJ=vV.getBCHDigit(pse);hse.getEncodedBits=function(n,i){const l=n.bit<<3|i;let u=l<<10;for(;vV.getBCHDigit(u)-KJ>=0;)u^=pse<<vV.getBCHDigit(u)-KJ;return(l<<10|u)^bNe};var fse={};const xNe=_m;function by(s){this.mode=xNe.NUMERIC,this.data=s.toString()}by.getBitsLength=function(n){return 10*Math.floor(n/3)+(n%3?n%3*3+1:0)};by.prototype.getLength=function(){return this.data.length};by.prototype.getBitsLength=function(){return by.getBitsLength(this.data.length)};by.prototype.write=function(n){let i,l,u;for(i=0;i+3<=this.data.length;i+=3)l=this.data.substr(i,3),u=parseInt(l,10),n.put(u,10);const p=this.data.length-i;p>0&&(l=this.data.substr(i),u=parseInt(l,10),n.put(u,p*3+1))};var wNe=by;const SNe=_m,D4=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function xy(s){this.mode=SNe.ALPHANUMERIC,this.data=s}xy.getBitsLength=function(n){return 11*Math.floor(n/2)+6*(n%2)};xy.prototype.getLength=function(){return this.data.length};xy.prototype.getBitsLength=function(){return xy.getBitsLength(this.data.length)};xy.prototype.write=function(n){let i;for(i=0;i+2<=this.data.length;i+=2){let l=D4.indexOf(this.data[i])*45;l+=D4.indexOf(this.data[i+1]),n.put(l,11)}this.data.length%2&&n.put(D4.indexOf(this.data[i]),6)};var TNe=xy;const RNe=_m;function wy(s){this.mode=RNe.BYTE,typeof s=="string"?this.data=new TextEncoder().encode(s):this.data=new Uint8Array(s)}wy.getBitsLength=function(n){return n*8};wy.prototype.getLength=function(){return this.data.length};wy.prototype.getBitsLength=function(){return wy.getBitsLength(this.data.length)};wy.prototype.write=function(s){for(let n=0,i=this.data.length;n<i;n++)s.put(this.data[n],8)};var CNe=wy;const NNe=_m,INe=nl;function Sy(s){this.mode=NNe.KANJI,this.data=s}Sy.getBitsLength=function(n){return n*13};Sy.prototype.getLength=function(){return this.data.length};Sy.prototype.getBitsLength=function(){return Sy.getBitsLength(this.data.length)};Sy.prototype.write=function(s){let n;for(n=0;n<this.data.length;n++){let i=INe.toSJIS(this.data[n]);if(i>=33088&&i<=40956)i-=33088;else if(i>=57408&&i<=60351)i-=49472;else throw new Error("Invalid SJIS character: "+this.data[n]+`
Make sure your charset is UTF-8`);i=(i>>>8&255)*192+(i&255),s.put(i,13)}};var ANe=Sy,mse={exports:{}};(function(s){var n={single_source_shortest_paths:function(i,l,u){var p={},g={};g[l]=0;var y=n.PriorityQueue.make();y.push(l,0);for(var x,C,k,A,M,G,B,X,Z;!y.empty();){x=y.pop(),C=x.value,A=x.cost,M=i[C]||{};for(k in M)M.hasOwnProperty(k)&&(G=M[k],B=A+G,X=g[k],Z=typeof g[k]>"u",(Z||X>B)&&(g[k]=B,y.push(k,B),p[k]=C))}if(typeof u<"u"&&typeof g[u]>"u"){var q=["Could not find a path from ",l," to ",u,"."].join("");throw new Error(q)}return p},extract_shortest_path_from_predecessor_list:function(i,l){for(var u=[],p=l;p;)u.push(p),i[p],p=i[p];return u.reverse(),u},find_path:function(i,l,u){var p=n.single_source_shortest_paths(i,l,u);return n.extract_shortest_path_from_predecessor_list(p,u)},PriorityQueue:{make:function(i){var l=n.PriorityQueue,u={},p;i=i||{};for(p in l)l.hasOwnProperty(p)&&(u[p]=l[p]);return u.queue=[],u.sorter=i.sorter||l.default_sorter,u},default_sorter:function(i,l){return i.cost-l.cost},push:function(i,l){var u={value:i,cost:l};this.queue.push(u),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};s.exports=n})(mse);var kNe=mse.exports;(function(s){const n=_m,i=wNe,l=TNe,u=CNe,p=ANe,g=sh,y=nl,x=kNe;function C(q){return unescape(encodeURIComponent(q)).length}function k(q,V,ee){const de=[];let ae;for(;(ae=q.exec(ee))!==null;)de.push({data:ae[0],index:ae.index,mode:V,length:ae[0].length});return de}function A(q){const V=k(g.NUMERIC,n.NUMERIC,q),ee=k(g.ALPHANUMERIC,n.ALPHANUMERIC,q);let de,ae;return y.isKanjiModeEnabled()?(de=k(g.BYTE,n.BYTE,q),ae=k(g.KANJI,n.KANJI,q)):(de=k(g.BYTE_KANJI,n.BYTE,q),ae=[]),V.concat(ee,de,ae).sort(function(Q,$){return Q.index-$.index}).map(function(Q){return{data:Q.data,mode:Q.mode,length:Q.length}})}function M(q,V){switch(V){case n.NUMERIC:return i.getBitsLength(q);case n.ALPHANUMERIC:return l.getBitsLength(q);case n.KANJI:return p.getBitsLength(q);case n.BYTE:return u.getBitsLength(q)}}function G(q){return q.reduce(function(V,ee){const de=V.length-1>=0?V[V.length-1]:null;return de&&de.mode===ee.mode?(V[V.length-1].data+=ee.data,V):(V.push(ee),V)},[])}function B(q){const V=[];for(let ee=0;ee<q.length;ee++){const de=q[ee];switch(de.mode){case n.NUMERIC:V.push([de,{data:de.data,mode:n.ALPHANUMERIC,length:de.length},{data:de.data,mode:n.BYTE,length:de.length}]);break;case n.ALPHANUMERIC:V.push([de,{data:de.data,mode:n.BYTE,length:de.length}]);break;case n.KANJI:V.push([de,{data:de.data,mode:n.BYTE,length:C(de.data)}]);break;case n.BYTE:V.push([{data:de.data,mode:n.BYTE,length:C(de.data)}])}}return V}function X(q,V){const ee={},de={start:{}};let ae=["start"];for(let ye=0;ye<q.length;ye++){const Q=q[ye],$=[];for(let se=0;se<Q.length;se++){const ce=Q[se],he=""+ye+se;$.push(he),ee[he]={node:ce,lastCount:0},de[he]={};for(let ve=0;ve<ae.length;ve++){const ge=ae[ve];ee[ge]&&ee[ge].node.mode===ce.mode?(de[ge][he]=M(ee[ge].lastCount+ce.length,ce.mode)-M(ee[ge].lastCount,ce.mode),ee[ge].lastCount+=ce.length):(ee[ge]&&(ee[ge].lastCount=ce.length),de[ge][he]=M(ce.length,ce.mode)+4+n.getCharCountIndicator(ce.mode,V))}}ae=$}for(let ye=0;ye<ae.length;ye++)de[ae[ye]].end=0;return{map:de,table:ee}}function Z(q,V){let ee;const de=n.getBestModeForData(q);if(ee=n.from(V,de),ee!==n.BYTE&&ee.bit<de.bit)throw new Error('"'+q+'" cannot be encoded with mode '+n.toString(ee)+`.
 Suggested mode is: `+n.toString(de));switch(ee===n.KANJI&&!y.isKanjiModeEnabled()&&(ee=n.BYTE),ee){case n.NUMERIC:return new i(q);case n.ALPHANUMERIC:return new l(q);case n.KANJI:return new p(q);case n.BYTE:return new u(q)}}s.fromArray=function(V){return V.reduce(function(ee,de){return typeof de=="string"?ee.push(Z(de,null)):de.data&&ee.push(Z(de.data,de.mode)),ee},[])},s.fromString=function(V,ee){const de=A(V,y.isKanjiModeEnabled()),ae=B(de),ye=X(ae,ee),Q=x.find_path(ye.map,"start","end"),$=[];for(let se=1;se<Q.length-1;se++)$.push(ye.table[Q[se]].node);return s.fromArray(G($))},s.rawSplit=function(V){return s.fromArray(A(V,y.isKanjiModeEnabled()))}})(fse);const yO=nl,P4=_O,ONe=hNe,DNe=pNe,PNe=ise,LNe=ase,EV=ose,yV=vO,jNe=mNe,_k=dse,MNe=hse,UNe=_m,L4=fse;function VNe(s,n){const i=s.size,l=LNe.getPositions(n);for(let u=0;u<l.length;u++){const p=l[u][0],g=l[u][1];for(let y=-1;y<=7;y++)if(!(p+y<=-1||i<=p+y))for(let x=-1;x<=7;x++)g+x<=-1||i<=g+x||(y>=0&&y<=6&&(x===0||x===6)||x>=0&&x<=6&&(y===0||y===6)||y>=2&&y<=4&&x>=2&&x<=4?s.set(p+y,g+x,!0,!0):s.set(p+y,g+x,!1,!0))}}function FNe(s){const n=s.size;for(let i=8;i<n-8;i++){const l=i%2===0;s.set(i,6,l,!0),s.set(6,i,l,!0)}}function BNe(s,n){const i=PNe.getPositions(n);for(let l=0;l<i.length;l++){const u=i[l][0],p=i[l][1];for(let g=-2;g<=2;g++)for(let y=-2;y<=2;y++)g===-2||g===2||y===-2||y===2||g===0&&y===0?s.set(u+g,p+y,!0,!0):s.set(u+g,p+y,!1,!0)}}function zNe(s,n){const i=s.size,l=_k.getEncodedBits(n);let u,p,g;for(let y=0;y<18;y++)u=Math.floor(y/3),p=y%3+i-8-3,g=(l>>y&1)===1,s.set(u,p,g,!0),s.set(p,u,g,!0)}function j4(s,n,i){const l=s.size,u=MNe.getEncodedBits(n,i);let p,g;for(p=0;p<15;p++)g=(u>>p&1)===1,p<6?s.set(p,8,g,!0):p<8?s.set(p+1,8,g,!0):s.set(l-15+p,8,g,!0),p<8?s.set(8,l-p-1,g,!0):p<9?s.set(8,15-p-1+1,g,!0):s.set(8,15-p-1,g,!0);s.set(l-8,8,1,!0)}function GNe(s,n){const i=s.size;let l=-1,u=i-1,p=7,g=0;for(let y=i-1;y>0;y-=2)for(y===6&&y--;;){for(let x=0;x<2;x++)if(!s.isReserved(u,y-x)){let C=!1;g<n.length&&(C=(n[g]>>>p&1)===1),s.set(u,y-x,C),p--,p===-1&&(g++,p=7)}if(u+=l,u<0||i<=u){u-=l,l=-l;break}}}function WNe(s,n,i){const l=new ONe;i.forEach(function(x){l.put(x.mode.bit,4),l.put(x.getLength(),UNe.getCharCountIndicator(x.mode,s)),x.write(l)});const u=yO.getSymbolTotalCodewords(s),p=yV.getTotalCodewordsCount(s,n),g=(u-p)*8;for(l.getLengthInBits()+4<=g&&l.put(0,4);l.getLengthInBits()%8!==0;)l.putBit(0);const y=(g-l.getLengthInBits())/8;for(let x=0;x<y;x++)l.put(x%2?17:236,8);return HNe(l,s,n)}function HNe(s,n,i){const l=yO.getSymbolTotalCodewords(n),u=yV.getTotalCodewordsCount(n,i),p=l-u,g=yV.getBlocksCount(n,i),y=l%g,x=g-y,C=Math.floor(l/g),k=Math.floor(p/g),A=k+1,M=C-k,G=new jNe(M);let B=0;const X=new Array(g),Z=new Array(g);let q=0;const V=new Uint8Array(s.buffer);for(let Q=0;Q<g;Q++){const $=Q<x?k:A;X[Q]=V.slice(B,B+$),Z[Q]=G.encode(X[Q]),B+=$,q=Math.max(q,$)}const ee=new Uint8Array(l);let de=0,ae,ye;for(ae=0;ae<q;ae++)for(ye=0;ye<g;ye++)ae<X[ye].length&&(ee[de++]=X[ye][ae]);for(ae=0;ae<M;ae++)for(ye=0;ye<g;ye++)ee[de++]=Z[ye][ae];return ee}function KNe(s,n,i,l){let u;if(Array.isArray(s))u=L4.fromArray(s);else if(typeof s=="string"){let C=n;if(!C){const k=L4.rawSplit(s);C=_k.getBestVersionForData(k,i)}u=L4.fromString(s,C||40)}else throw new Error("Invalid data");const p=_k.getBestVersionForData(u,i);if(!p)throw new Error("The amount of data is too big to be stored in a QR Code");if(!n)n=p;else if(n<p)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+p+`.
`);const g=WNe(n,i,u),y=yO.getSymbolSize(n),x=new DNe(y);return VNe(x,n),FNe(x),BNe(x,n),j4(x,i,0),n>=7&&zNe(x,n),GNe(x,g),isNaN(l)&&(l=EV.getBestMask(x,j4.bind(null,x,i))),EV.applyMask(l,x),j4(x,i,l),{modules:x,version:n,errorCorrectionLevel:i,maskPattern:l,segments:u}}rse.create=function(n,i){if(typeof n>"u"||n==="")throw new Error("No input text");let l=P4.M,u,p;return typeof i<"u"&&(l=P4.from(i.errorCorrectionLevel,P4.M),u=_k.from(i.version),p=EV.from(i.maskPattern),i.toSJISFunc&&yO.setToSJISFunction(i.toSJISFunc)),KNe(n,u,l,p)};var gse={},sB={};(function(s){function n(i){if(typeof i=="number"&&(i=i.toString()),typeof i!="string")throw new Error("Color should be defined as hex string");let l=i.slice().replace("#","").split("");if(l.length<3||l.length===5||l.length>8)throw new Error("Invalid hex color: "+i);(l.length===3||l.length===4)&&(l=Array.prototype.concat.apply([],l.map(function(p){return[p,p]}))),l.length===6&&l.push("F","F");const u=parseInt(l.join(""),16);return{r:u>>24&255,g:u>>16&255,b:u>>8&255,a:u&255,hex:"#"+l.slice(0,6).join("")}}s.getOptions=function(l){l||(l={}),l.color||(l.color={});const u=typeof l.margin>"u"||l.margin===null||l.margin<0?4:l.margin,p=l.width&&l.width>=21?l.width:void 0,g=l.scale||4;return{width:p,scale:p?4:g,margin:u,color:{dark:n(l.color.dark||"#000000ff"),light:n(l.color.light||"#ffffffff")},type:l.type,rendererOpts:l.rendererOpts||{}}},s.getScale=function(l,u){return u.width&&u.width>=l+u.margin*2?u.width/(l+u.margin*2):u.scale},s.getImageWidth=function(l,u){const p=s.getScale(l,u);return Math.floor((l+u.margin*2)*p)},s.qrToImageData=function(l,u,p){const g=u.modules.size,y=u.modules.data,x=s.getScale(g,p),C=Math.floor((g+p.margin*2)*x),k=p.margin*x,A=[p.color.light,p.color.dark];for(let M=0;M<C;M++)for(let G=0;G<C;G++){let B=(M*C+G)*4,X=p.color.light;if(M>=k&&G>=k&&M<C-k&&G<C-k){const Z=Math.floor((M-k)/x),q=Math.floor((G-k)/x);X=A[y[Z*g+q]?1:0]}l[B++]=X.r,l[B++]=X.g,l[B++]=X.b,l[B]=X.a}}})(sB);(function(s){const n=sB;function i(u,p,g){u.clearRect(0,0,p.width,p.height),p.style||(p.style={}),p.height=g,p.width=g,p.style.height=g+"px",p.style.width=g+"px"}function l(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}s.render=function(p,g,y){let x=y,C=g;typeof x>"u"&&(!g||!g.getContext)&&(x=g,g=void 0),g||(C=l()),x=n.getOptions(x);const k=n.getImageWidth(p.modules.size,x),A=C.getContext("2d"),M=A.createImageData(k,k);return n.qrToImageData(M.data,p,x),i(A,C,k),A.putImageData(M,0,0),C},s.renderToDataURL=function(p,g,y){let x=y;typeof x>"u"&&(!g||!g.getContext)&&(x=g,g=void 0),x||(x={});const C=s.render(p,g,x),k=x.type||"image/png",A=x.rendererOpts||{};return C.toDataURL(k,A.quality)}})(gse);var _se={};const qNe=sB;function qJ(s,n){const i=s.a/255,l=n+'="'+s.hex+'"';return i<1?l+" "+n+'-opacity="'+i.toFixed(2).slice(1)+'"':l}function M4(s,n,i){let l=s+n;return typeof i<"u"&&(l+=" "+i),l}function YNe(s,n,i){let l="",u=0,p=!1,g=0;for(let y=0;y<s.length;y++){const x=Math.floor(y%n),C=Math.floor(y/n);!x&&!p&&(p=!0),s[y]?(g++,y>0&&x>0&&s[y-1]||(l+=p?M4("M",x+i,.5+C+i):M4("m",u,0),u=0,p=!1),x+1<n&&s[y+1]||(l+=M4("h",g),g=0)):u++}return l}_se.render=function(n,i,l){const u=qNe.getOptions(i),p=n.modules.size,g=n.modules.data,y=p+u.margin*2,x=u.color.light.a?"<path "+qJ(u.color.light,"fill")+' d="M0 0h'+y+"v"+y+'H0z"/>':"",C="<path "+qJ(u.color.dark,"stroke")+' d="'+YNe(g,p,u.margin)+'"/>',k='viewBox="0 0 '+y+" "+y+'"',M='<svg xmlns="http://www.w3.org/2000/svg" '+(u.width?'width="'+u.width+'" height="'+u.width+'" ':"")+k+' shape-rendering="crispEdges">'+x+C+`</svg>
`;return typeof l=="function"&&l(null,M),M};const XNe=dNe,bV=rse,vse=gse,$Ne=_se;function iB(s,n,i,l,u){const p=[].slice.call(arguments,1),g=p.length,y=typeof p[g-1]=="function";if(!y&&!XNe())throw new Error("Callback required as last argument");if(y){if(g<2)throw new Error("Too few arguments provided");g===2?(u=i,i=n,n=l=void 0):g===3&&(n.getContext&&typeof u>"u"?(u=l,l=void 0):(u=l,l=i,i=n,n=void 0))}else{if(g<1)throw new Error("Too few arguments provided");return g===1?(i=n,n=l=void 0):g===2&&!n.getContext&&(l=i,i=n,n=void 0),new Promise(function(x,C){try{const k=bV.create(i,l);x(s(k,n,l))}catch(k){C(k)}})}try{const x=bV.create(i,l);u(null,s(x,n,l))}catch(x){u(x)}}CT.create=bV.create;CT.toCanvas=iB.bind(null,vse.render);CT.toDataURL=iB.bind(null,vse.renderToDataURL);CT.toString=iB.bind(null,function(s,n,i){return $Ne.render(s,i)});const JNe=({code:s,onClose:n})=>{const[i,l]=H.useState("");return H.useEffect(()=>{(async()=>{try{const p=await CT.toDataURL(`https://delulu.app/join/${s}`,{width:256,margin:2,color:{dark:"#1a1a1a",light:"#ffffff"}});l(p)}catch(p){console.error("QR generation failed:",p)}})()},[s]),o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",onClick:n,children:o.jsxs("div",{className:"bg-white rounded-3xl p-6 max-w-sm w-full shadow-2xl",onClick:u=>u.stopPropagation(),children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"QR-Code scannen"}),o.jsx("button",{onClick:n,className:"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition-colors",children:o.jsx(Rs,{size:16})})]}),o.jsx("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl p-6 flex items-center justify-center mb-4",children:i?o.jsx("img",{src:i,alt:"QR Code",className:"w-48 h-48"}):o.jsx("div",{className:"w-48 h-48 bg-gray-200 animate-pulse rounded-xl"})}),o.jsx("p",{className:"text-center text-gray-600 text-sm mb-2",children:"Lass deine Freunde diesen Code scannen"}),o.jsx("p",{className:"text-center font-mono text-lg font-bold text-purple-600",children:s})]})})},QNe=({friend:s})=>{const i={pending:{label:"Eingeladen",color:"bg-amber-100 text-amber-700",icon:o.jsx(Gi,{size:12})},registered:{label:"Registriert",color:"bg-blue-100 text-blue-700",icon:o.jsx(zn,{size:12})},active:{label:"Aktiv",color:"bg-green-100 text-green-700",icon:o.jsx(wr,{size:12})}}[s.status];return o.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white rounded-2xl shadow-sm border border-gray-100",children:[o.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-purple-100 to-pink-100 flex items-center justify-center overflow-hidden",children:s.avatar?o.jsx("img",{src:s.avatar,alt:"",className:"w-full h-full object-cover"}):o.jsx(rr,{size:20,className:"text-purple-400"})}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("p",{className:"font-semibold text-gray-900 truncate",children:s.displayName||s.username||"Anonym"}),o.jsx("p",{className:"text-xs text-gray-500",children:s.invitedAt.toLocaleDateString("de-DE")})]}),o.jsxs("div",{className:`flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-semibold ${i.color}`,children:[i.icon,i.label]})]})},ZNe=({milestone:s,currentCount:n})=>o.jsxs("div",{className:`relative p-4 rounded-2xl border transition-all ${s.unlocked?"bg-gradient-to-br from-purple-50 to-pink-50 border-purple-200 shadow-lg shadow-purple-500/10":"bg-gray-50 border-gray-100 opacity-60"}`,children:[s.unlocked&&o.jsx("div",{className:"absolute -top-2 -right-2 w-6 h-6 rounded-full bg-green-500 flex items-center justify-center shadow-lg",children:o.jsx(zn,{size:12,className:"text-white"})}),o.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[o.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${s.unlocked?"bg-purple-500 text-white":"bg-gray-200 text-gray-400"}`,children:s.icon}),o.jsxs("div",{children:[o.jsxs("p",{className:`font-bold ${s.unlocked?"text-purple-900":"text-gray-400"}`,children:[s.count," Freunde"]}),o.jsx("p",{className:`text-xs ${s.unlocked?"text-purple-600":"text-gray-400"}`,children:s.reward})]})]}),!s.unlocked&&o.jsxs("div",{className:"mt-2",children:[o.jsx("div",{className:"h-1.5 bg-gray-200 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full bg-purple-500 rounded-full transition-all",style:{width:`${Math.min(100,n/s.count*100)}%`}})}),o.jsxs("p",{className:"text-[10px] text-gray-400 mt-1 text-right",children:[n,"/",s.count]})]})]}),YJ=()=>{const s=zr(),{user:n}=mr(),[i,l]=H.useState(""),[u,p]=H.useState(5),[g,y]=H.useState(5),[x,C]=H.useState([]),[k,A]=H.useState(!0),[M,G]=H.useState(!1),[B,X]=H.useState("card"),Z=[{count:1,reward:"7 Tage Premium",rewardDays:7,icon:o.jsx(Fs,{size:18}),unlocked:x.filter(V=>V.status!=="pending").length>=1},{count:3,reward:"14 Tage Premium",rewardDays:14,icon:o.jsx(ra,{size:18}),unlocked:x.filter(V=>V.status!=="pending").length>=3},{count:5,reward:"30 Tage Premium",rewardDays:30,icon:o.jsx(hs,{size:18}),unlocked:x.filter(V=>V.status!=="pending").length>=5},{count:10,reward:"Lifetime Premium",rewardDays:999,icon:o.jsx(mV,{size:18}),unlocked:x.filter(V=>V.status!=="pending").length>=10}];H.useEffect(()=>{(async()=>{var ee,de;if(n!=null&&n.id){A(!0);try{const ae=await fr(at(Me,"users",n.id));if(ae.exists()){const se=ae.data();l(se.referralCode||`DELULU-${n.id.slice(0,6).toUpperCase()}`),p(se.remainingInvites??5),y(se.totalInvites??5)}const ye=Zr(xn(Me,"referrals"),or("referrerId","==",n.id),fy("createdAt","desc")),Q=await Ur(ye),$=[];for(const se of Q.docs){const ce=se.data();let he={};if(ce.referredId){const ve=await fr(at(Me,"users",ce.referredId));ve.exists()&&(he=ve.data())}$.push({id:ce.referredId||se.id,username:he.username||"",displayName:he.displayName||ce.invitedName||"",avatar:he.avatarUrl,status:ce.status||"pending",invitedAt:((ee=ce.createdAt)==null?void 0:ee.toDate())||new Date,registeredAt:(de=ce.registeredAt)==null?void 0:de.toDate()})}C($)}catch(ae){console.error("[InvitesPage] Load failed:",ae)}finally{A(!1)}}})()},[n==null?void 0:n.id]);const q=x.filter(V=>V.status!=="pending").length;return o.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-purple-50/80 via-white to-gray-50",children:[o.jsxs("div",{className:"px-4 pt-6 pb-4",children:[o.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[o.jsx("button",{onClick:()=>s(-1),className:"w-10 h-10 rounded-xl bg-white shadow-sm border border-gray-100 flex items-center justify-center hover:bg-gray-50 transition-colors",children:o.jsx(Gu,{size:20,className:"text-gray-600"})}),o.jsxs("div",{children:[o.jsx("h1",{className:"font-display text-2xl font-bold text-gray-900",children:"Einladungen"}),o.jsx("p",{className:"text-sm text-gray-500",children:"Lade Freunde ein & erhalte Rewards"})]})]}),o.jsx("div",{className:"flex gap-2 p-1 bg-gray-100 rounded-2xl",children:[{key:"card",label:"Ticket",icon:ra},{key:"friends",label:"Freunde",icon:rr},{key:"rewards",label:"Rewards",icon:mV}].map(V=>{const ee=V.icon,de=B===V.key;return o.jsxs("button",{onClick:()=>{X(V.key),"vibrate"in navigator&&navigator.vibrate(10)},className:`flex-1 py-2.5 px-3 rounded-xl text-sm font-semibold flex items-center justify-center gap-2 transition-all ${de?"bg-white shadow-md text-purple-600":"text-gray-500 hover:text-gray-700"}`,children:[o.jsx(ee,{size:16}),V.label]},V.key)})})]}),o.jsx("div",{className:"px-4 pb-32",children:k?o.jsx("div",{className:"flex items-center justify-center py-20",children:o.jsx("div",{className:"w-10 h-10 border-4 border-purple-500 border-t-transparent rounded-full animate-spin"})}):o.jsxs(o.Fragment,{children:[B==="card"&&o.jsxs("div",{className:"space-y-6",children:[o.jsx(lNe,{code:i,remainingInvites:u,totalInvites:g,rewardDays:7,onShowQR:()=>G(!0),variant:q>=10?"diamond":q>=5?"platinum":"golden"}),o.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[o.jsxs("div",{className:"bg-white rounded-2xl p-4 text-center shadow-sm border border-gray-100",children:[o.jsx("p",{className:"text-2xl font-bold text-purple-600",children:x.length}),o.jsx("p",{className:"text-[10px] text-gray-400 uppercase tracking-wider",children:"Eingeladen"})]}),o.jsxs("div",{className:"bg-white rounded-2xl p-4 text-center shadow-sm border border-gray-100",children:[o.jsx("p",{className:"text-2xl font-bold text-green-600",children:q}),o.jsx("p",{className:"text-[10px] text-gray-400 uppercase tracking-wider",children:"Aktiv"})]}),o.jsxs("div",{className:"bg-white rounded-2xl p-4 text-center shadow-sm border border-gray-100",children:[o.jsx("p",{className:"text-2xl font-bold text-amber-600",children:u}),o.jsx("p",{className:"text-[10px] text-gray-400 uppercase tracking-wider",children:"brig"})]})]})]}),B==="friends"&&o.jsx("div",{className:"space-y-3",children:x.length===0?o.jsxs("div",{className:"text-center py-16",children:[o.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full bg-gray-100 flex items-center justify-center",children:o.jsx(rr,{size:32,className:"text-gray-400"})}),o.jsx("p",{className:"text-gray-500 mb-2",children:"Noch keine Einladungen"}),o.jsx("p",{className:"text-sm text-gray-400",children:"Teile deinen Code und lade Freunde ein!"})]}):x.map(V=>o.jsx(QNe,{friend:V},V.id))}),B==="rewards"&&o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"bg-gradient-to-r from-purple-500 to-pink-500 rounded-2xl p-4 text-white",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[o.jsx(wr,{size:24}),o.jsxs("div",{children:[o.jsx("p",{className:"font-bold",children:"Aktive Freunde"}),o.jsx("p",{className:"text-2xl font-black",children:q})]})]}),o.jsx("p",{className:"text-sm text-white/80",children:"Je mehr Freunde sich registrieren, desto besser deine Rewards!"})]}),o.jsx("div",{className:"grid grid-cols-2 gap-3",children:Z.map((V,ee)=>o.jsx(ZNe,{milestone:V,currentCount:q},ee))})]})]})}),M&&o.jsx(JNe,{code:i,onClose:()=>G(!1)})]})},eIe=({user:s,containerSize:n,maxRadius:i,onClick:l,isSelected:u})=>{const p=Math.min(s.distance/i,1),g=n/2-30,y=p*g,x=(s.bearing-90)*Math.PI/180,C=Math.cos(x)*y,k=Math.sin(x)*y,A=kCe(s.distance),M={immediate:"ring-green-400 shadow-green-500/50",near:"ring-emerald-400 shadow-emerald-500/40",mid:"ring-purple-400 shadow-purple-500/30",far:"ring-blue-400 shadow-blue-500/20",edge:"ring-gray-400 shadow-gray-500/10"},G=s.avatarUrl||s.avatar?`https://storage.googleapis.com/delulu-avatars/${s.avatar||"default"}.png`:`https://api.dicebear.com/7.x/adventurer/svg?seed=${s.id}`;return o.jsx("button",{onClick:()=>{"vibrate"in navigator&&navigator.vibrate(15),l==null||l()},className:`
        absolute transform -translate-x-1/2 -translate-y-1/2
        transition-all duration-500 ease-out
        ${u?"scale-125 z-20":"hover:scale-110 z-10"}
      `,style:{left:`calc(50% + ${C}px)`,top:`calc(50% + ${k}px)`},children:o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:`
            w-12 h-12 rounded-full overflow-hidden
            ring-2 ${M[A]}
            shadow-lg ${M[A]}
            ${u?"ring-4 ring-purple-500":""}
            ${s.isActive?"animate-pulse":""}
          `,children:o.jsx("img",{src:G,alt:s.displayName,className:"w-full h-full object-cover",onError:B=>{B.target.src=`https://api.dicebear.com/7.x/adventurer/svg?seed=${s.id}`}})}),s.isActive&&o.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-4 h-4 bg-green-500 rounded-full border-2 border-white flex items-center justify-center",children:o.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-ping"})}),s.isPremium&&o.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-gradient-to-br from-amber-400 to-orange-500 rounded-full flex items-center justify-center shadow-lg",children:o.jsx(hs,{size:10,className:"text-white"})}),o.jsx("div",{className:"absolute -bottom-5 left-1/2 -translate-x-1/2 whitespace-nowrap",children:o.jsx("span",{className:"text-[10px] font-semibold text-gray-500 bg-white/80 px-1.5 py-0.5 rounded-full shadow-sm",children:KF(s.distance)})})]})})},tIe=({size:s,isScanning:n})=>{const i=[.25,.5,.75,1];return o.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[i.map((l,u)=>o.jsx("div",{className:`
            absolute rounded-full border
            ${u===i.length-1?"border-purple-300/50":"border-purple-200/30"}
          `,style:{width:s*l,height:s*l,left:"50%",top:"50%",transform:"translate(-50%, -50%)"}},u)),n&&o.jsx("div",{className:"absolute left-1/2 top-1/2 origin-bottom animate-radar-sweep",style:{width:2,height:s/2,background:"linear-gradient(to top, rgba(147, 51, 234, 0.8), transparent)",transform:"translateX(-50%)"}}),n&&o.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:o.jsx("div",{className:"w-4 h-4 bg-purple-500 rounded-full animate-ping"})})]})},nIe=({user:s,onClose:n,onViewProfile:i})=>{if(!s)return null;const l=s.avatarUrl||s.avatar?`https://storage.googleapis.com/delulu-avatars/${s.avatar||"default"}.png`:`https://api.dicebear.com/7.x/adventurer/svg?seed=${s.id}`;return o.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-white rounded-t-3xl shadow-2xl p-4 animate-slide-up",onClick:u=>u.stopPropagation(),children:[o.jsx("div",{className:"w-10 h-1 bg-gray-300 rounded-full mx-auto mb-4"}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"w-16 h-16 rounded-2xl overflow-hidden ring-2 ring-purple-200 shadow-lg",children:o.jsx("img",{src:l,alt:"",className:"w-full h-full object-cover"})}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("h3",{className:"font-bold text-lg text-gray-900 truncate",children:s.displayName}),s.isPremium&&o.jsx(hs,{size:16,className:"text-amber-500"})]}),o.jsxs("p",{className:"text-sm text-gray-500",children:["@",s.username]}),o.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[o.jsxs("span",{className:"text-xs text-purple-600 font-semibold",children:["Level ",s.level]}),o.jsxs("span",{className:"flex items-center gap-1 text-xs text-amber-600",children:[o.jsx(Fs,{size:12}),s.trustScore]}),o.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-400",children:[o.jsx(_c,{size:12}),KF(s.distance)]})]})]}),o.jsx("button",{onClick:i,className:"w-12 h-12 rounded-xl bg-purple-500 text-white flex items-center justify-center shadow-lg hover:bg-purple-600 transition-colors",children:o.jsx(As,{size:20})})]})]})},rIe=({onUserSelect:s,compact:n=!1})=>{const{isEnabled:i,isLoading:l,permission:u,nearbyUsers:p,nearbyCount:g,radius:y,refreshNearby:x}=qF(),{avatarUrl:C}=HF(),[k,A]=H.useState(null),[M,G]=H.useState(!1),B=n?200:320,X=H.useCallback(async()=>{G(!0),"vibrate"in navigator&&navigator.vibrate([20,50,20,50,20]),await x(),setTimeout(()=>{G(!1),p.length>0&&"vibrate"in navigator&&navigator.vibrate([10,30,10,30,50])},2e3)},[x,p.length]);return H.useEffect(()=>{i&&u==="granted"&&X()},[i,u]),u==="denied"?o.jsxs("div",{className:`flex flex-col items-center justify-center ${n?"p-4":"p-8"}`,children:[o.jsx("div",{className:"w-16 h-16 rounded-full bg-red-100 flex items-center justify-center mb-4",children:o.jsx(Lre,{size:28,className:"text-red-500"})}),o.jsx("p",{className:"text-gray-600 text-center mb-2",children:"Standort-Zugriff verweigert"}),o.jsx("p",{className:"text-sm text-gray-400 text-center",children:"Aktiviere den Standort in deinen Einstellungen"})]}):i?l?o.jsx("div",{className:"flex items-center justify-center p-8",children:o.jsx("div",{className:"w-10 h-10 border-4 border-purple-500 border-t-transparent rounded-full animate-spin"})}):o.jsxs("div",{className:"relative",children:[o.jsxs("div",{className:"relative mx-auto",style:{width:B,height:B},onClick:()=>k&&A(null),children:[o.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-purple-100/50 via-white to-pink-100/50",style:{boxShadow:"inset 0 0 40px rgba(147, 51, 234, 0.1)"}}),o.jsx(tIe,{size:B,isScanning:M}),o.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-30",children:o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"w-14 h-14 rounded-full overflow-hidden ring-4 ring-purple-500 shadow-xl shadow-purple-500/30",children:o.jsx("img",{src:C,alt:"Du",className:"w-full h-full object-cover"})}),o.jsx("div",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 bg-purple-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full",children:"DU"})]})}),p.map(Z=>o.jsx(eIe,{user:Z,containerSize:B,maxRadius:y,onClick:()=>{A(Z),s==null||s(Z)},isSelected:(k==null?void 0:k.id)===Z.id},Z.id)),!n&&o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"absolute top-2 left-1/2 -translate-x-1/2 text-[10px] text-gray-400 font-medium",children:"N"}),o.jsx("span",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 text-[10px] text-gray-400 font-medium",children:"S"}),o.jsx("span",{className:"absolute left-2 top-1/2 -translate-y-1/2 text-[10px] text-gray-400 font-medium",children:"W"}),o.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-[10px] text-gray-400 font-medium",children:"O"})]}),o.jsx(nIe,{user:k,onClose:()=>A(null),onViewProfile:()=>{k&&(window.location.href=`/profile/${k.id}`)}})]}),!n&&o.jsx("div",{className:"mt-6 flex items-center justify-center gap-4",children:o.jsx("button",{onClick:X,disabled:M,className:`
              px-6 py-3 rounded-2xl font-semibold
              flex items-center gap-2
              transition-all
              ${M?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg shadow-purple-500/30 hover:shadow-purple-500/50 active:scale-95"}
            `,children:M?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-5 h-5 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"}),"Scanne..."]}):o.jsxs(o.Fragment,{children:[o.jsx(fV,{size:20}),"Radar scannen"]})})}),o.jsxs("div",{className:"mt-4 flex items-center justify-center gap-4 text-sm",children:[o.jsxs("span",{className:"flex items-center gap-1.5 text-gray-500",children:[o.jsx(rr,{size:14}),o.jsx("span",{className:"font-semibold text-purple-600",children:g}),o.jsx("span",{children:"in der Nhe"})]}),o.jsx("span",{className:"text-gray-300",children:""}),o.jsxs("span",{className:"flex items-center gap-1.5 text-gray-500",children:[o.jsx(_c,{size:14}),o.jsx("span",{children:y>=1e3?`${(y/1e3).toFixed(1)}km`:`${y}m`})]})]}),o.jsx("style",{children:`
        @keyframes radar-sweep {
          0% { transform: translateX(-50%) rotate(0deg); }
          100% { transform: translateX(-50%) rotate(360deg); }
        }
        .animate-radar-sweep {
          animation: radar-sweep 2s linear infinite;
        }
        @keyframes slide-up {
          from {
            transform: translateY(100%);
            opacity: 0;
          }
          to {
            transform: translateY(0);
            opacity: 1;
          }
        }
        .animate-slide-up {
          animation: slide-up 0.3s ease-out;
        }
      `})]}):o.jsxs("div",{className:`flex flex-col items-center justify-center ${n?"p-4":"p-8"}`,children:[o.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:o.jsx(fV,{size:28,className:"text-gray-400"})}),o.jsx("p",{className:"text-gray-600 text-center mb-2",children:"Radar deaktiviert"}),o.jsx("p",{className:"text-sm text-gray-400 text-center",children:"Aktiviere den Friend Radar in den Einstellungen"})]})},sIe=({user:s,onClick:n})=>{const i=s.avatarUrl||s.avatar?`https://storage.googleapis.com/delulu-avatars/${s.avatar||"default"}.png`:`https://api.dicebear.com/7.x/adventurer/svg?seed=${s.id}`;return o.jsxs("button",{onClick:n,className:"w-full p-4 flex items-center gap-4 hover:bg-gray-50 transition-colors active:bg-gray-100",children:[o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"w-14 h-14 rounded-2xl overflow-hidden ring-2 ring-purple-100 shadow-md",children:o.jsx("img",{src:i,alt:"",className:"w-full h-full object-cover"})}),s.isActive&&o.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-4 h-4 bg-green-500 rounded-full border-2 border-white"}),s.isPremium&&o.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-gradient-to-br from-amber-400 to-orange-500 rounded-full flex items-center justify-center",children:o.jsx(hs,{size:10,className:"text-white"})})]}),o.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:s.displayName}),s.isActive&&o.jsx("span",{className:"text-[10px] font-semibold text-green-600 bg-green-100 px-1.5 py-0.5 rounded-full",children:"ONLINE"})]}),o.jsxs("p",{className:"text-sm text-gray-500 truncate",children:["@",s.username]}),o.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[o.jsxs("span",{className:"flex items-center gap-1 text-xs text-purple-600",children:[o.jsx(Ei,{size:10}),"Lv.",s.level]}),o.jsxs("span",{className:"flex items-center gap-1 text-xs text-amber-600",children:[o.jsx(Fs,{size:10}),s.trustScore]})]})]}),o.jsxs("div",{className:"text-right",children:[o.jsxs("div",{className:"flex items-center gap-1 text-sm font-semibold text-purple-600 mb-1",children:[o.jsx(_c,{size:12}),KF(s.distance)]}),o.jsx("div",{className:"text-[10px] text-gray-400 uppercase",children:s.bearing<45||s.bearing>=315?"Nord":s.bearing<135?"Ost":s.bearing<225?"Sd":"West"})]}),o.jsx(As,{size:20,className:"text-gray-400"})]})},iIe=()=>{const s=zr(),{nearbyUsers:n,nearbyCount:i,radius:l}=qF(),[u,p]=H.useState("radar"),[g,y]=H.useState("distance"),[x,C]=H.useState(!1),k=n.filter(M=>!x||M.isActive).sort((M,G)=>{switch(g){case"distance":return M.distance-G.distance;case"activity":return(G.isActive?1:0)-(M.isActive?1:0);case"level":return G.level-M.level;default:return 0}}),A=M=>{"vibrate"in navigator&&navigator.vibrate(15),s(`/profile/${M.id}`)};return o.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-purple-50/80 via-white to-gray-50",children:[o.jsxs("div",{className:"sticky top-0 z-50 px-4 pt-6 pb-4 bg-gradient-to-b from-purple-50/95 to-transparent backdrop-blur-lg",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("button",{onClick:()=>s(-1),className:"w-10 h-10 rounded-xl bg-white shadow-sm border border-gray-100 flex items-center justify-center hover:bg-gray-50 transition-colors",children:o.jsx(Gu,{size:20,className:"text-gray-600"})}),o.jsxs("div",{children:[o.jsx("h1",{className:"font-display text-2xl font-bold text-gray-900",children:"Friend Radar"}),o.jsxs("p",{className:"text-sm text-gray-500",children:[i," User in ",l>=1e3?`${(l/1e3).toFixed(1)}km`:`${l}m`]})]})]}),o.jsx("button",{onClick:()=>s("/settings"),className:"w-10 h-10 rounded-xl bg-white shadow-sm border border-gray-100 flex items-center justify-center hover:bg-gray-50 transition-colors",children:o.jsx(QS,{size:20,className:"text-gray-600"})})]}),o.jsxs("div",{className:"flex gap-2 p-1 bg-white/80 rounded-2xl shadow-sm border border-gray-100",children:[o.jsxs("button",{onClick:()=>p("radar"),className:`flex-1 py-2 px-4 rounded-xl text-sm font-semibold transition-all ${u==="radar"?"bg-purple-500 text-white shadow-md":"text-gray-500 hover:text-gray-700"}`,children:[o.jsx(_c,{size:16,className:"inline mr-1.5"}),"Radar"]}),o.jsxs("button",{onClick:()=>p("list"),className:`flex-1 py-2 px-4 rounded-xl text-sm font-semibold transition-all ${u==="list"?"bg-purple-500 text-white shadow-md":"text-gray-500 hover:text-gray-700"}`,children:[o.jsx(rr,{size:16,className:"inline mr-1.5"}),"Liste"]})]})]}),o.jsx("div",{className:"px-4 pb-32",children:u==="radar"?o.jsx("div",{className:"py-8",children:o.jsx(rIe,{onUserSelect:A})}):o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between mb-4 pt-4",children:[o.jsx("div",{className:"flex gap-2",children:o.jsx("button",{onClick:()=>C(!x),className:`px-3 py-1.5 rounded-full text-xs font-semibold transition-all ${x?"bg-green-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:" Online"})}),o.jsxs("select",{value:g,onChange:M=>y(M.target.value),className:"px-3 py-1.5 rounded-xl bg-white border border-gray-200 text-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-purple-500",children:[o.jsx("option",{value:"distance",children:"Entfernung"}),o.jsx("option",{value:"activity",children:"Aktivitt"}),o.jsx("option",{value:"level",children:"Level"})]})]}),k.length===0?o.jsxs("div",{className:"text-center py-16",children:[o.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full bg-gray-100 flex items-center justify-center",children:o.jsx(rr,{size:32,className:"text-gray-400"})}),o.jsx("p",{className:"text-gray-500 mb-2",children:x?"Keine Online-User in der Nhe":"Keine User in der Nhe"}),o.jsx("p",{className:"text-sm text-gray-400",children:"Versuche einen greren Radius in den Einstellungen"})]}):o.jsx("div",{className:"bg-white rounded-3xl shadow-sm border border-gray-100 overflow-hidden divide-y divide-gray-100",children:k.map(M=>o.jsx(sIe,{user:M,onClick:()=>A(M)},M.id))})]})}),o.jsx("div",{className:"fixed bottom-20 left-4 right-4",children:o.jsx("div",{className:"bg-white/90 backdrop-blur-xl rounded-2xl shadow-lg border border-gray-100 p-4",children:o.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-2xl font-bold text-purple-600",children:i}),o.jsx("p",{className:"text-[10px] text-gray-400 uppercase",children:"In der Nhe"})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-2xl font-bold text-green-600",children:n.filter(M=>M.isActive).length}),o.jsx("p",{className:"text-[10px] text-gray-400 uppercase",children:"Online"})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-2xl font-bold text-amber-600",children:n.filter(M=>M.isPremium).length}),o.jsx("p",{className:"text-[10px] text-gray-400 uppercase",children:"Premium"})]})]})})})]})},aIe=async s=>{if(!s||s.trim().length===0)return{isValid:!1,error:"INVALID",message:"Kein Einladungscode angegeben"};const n=s.trim().toUpperCase();try{const i=await fr(at(Me,"invite_codes",n));if(!i.exists()){const u=Zr(xn(Me,"invite_codes"),or("code","==",n)),p=await Ur(u);if(p.empty)return{isValid:!1,error:"INVALID",message:"Dieser Code existiert nicht"};const g=p.docs[0].data();return XJ(g)}const l=i.data();return XJ(l)}catch(i){return console.error("[InviteSystem] Validation error:",i),{isValid:!1,error:"INVALID",message:"Fehler bei der Validierung"}}},XJ=s=>s.isActive?s.expiresAt&&s.expiresAt.toDate()<new Date?{isValid:!1,code:s,error:"EXPIRED",message:"Dieser Code ist abgelaufen"}:s.type!=="unlimited"&&s.usedCount>=s.maxUses?{isValid:!1,code:s,error:"USED_UP",message:"Dieser Code wurde bereits vollstndig eingelst"}:{isValid:!0,code:s}:{isValid:!1,code:s,error:"DEACTIVATED",message:"Dieser Code wurde deaktiviert"},$J=async(s,n,i)=>{var u;const l=s.trim().toUpperCase();try{const p=await fr(at(Me,"invite_codes",l));if(!p.exists())return!1;const g=p.data();await Kn(at(Me,"invite_codes",l),{usedCount:ta(1)}),await yo(at(Me,"referrals",`${g.creatorId}_${n}`),{referrerId:g.creatorId,referrerName:g.creatorName,referredId:n,referredName:i,inviteCode:l,status:"registered",createdAt:Uo(),registeredAt:Uo()}),await Kn(at(Me,"users",g.creatorId),{referralCount:ta(1),"stats.totalReferrals":ta(1)});const y=await fr(at(Me,"users",g.creatorId));if(y.exists()){const x=((u=y.data().premiumEndsAt)==null?void 0:u.toDate())||new Date,C=new Date(Math.max(x.getTime(),Date.now()));C.setDate(C.getDate()+7),await Kn(at(Me,"users",g.creatorId),{isPremium:!0,premiumEndsAt:cn.fromDate(C)})}return console.log("[InviteSystem] Code used successfully:",{code:l,newUser:n,referrer:g.creatorId}),!0}catch(p){return console.error("[InviteSystem] Use code error:",p),!1}},oIe=async(s,n,i)=>{if(!s||!s.includes("@"))return{success:!1,error:"Ungltige E-Mail-Adresse"};const l=s.toLowerCase().trim();try{const u=Zr(xn(Me,"waitlist"),or("email","==",l)),p=await Ur(u);if(!p.empty)return{success:!0,position:p.docs[0].data().position};const g=Zr(xn(Me,"waitlist")),x=(await Ur(g)).size+1;return await yo(at(Me,"waitlist",l),{email:l,name:n||null,joinedAt:Uo(),status:"waiting",position:x,referralSource:i||null}),{success:!0,position:x}}catch(u){return console.error("[InviteSystem] Waitlist error:",u),{success:!1,error:"Fehler beim Beitreten zur Warteliste"}}},cIe=s=>{sessionStorage.setItem("delulu_invite_code",s.toUpperCase())},Qs={dark:{bg:{primary:"#0A0A0B",secondary:"#111113",tertiary:"#18181B",elevated:"#1F1F23"},border:{default:"rgba(255, 255, 255, 0.10)"},text:{primary:"#FAFAFA",secondary:"#A1A1AA"}},light:{bg:{primary:"#FFFFFF",secondary:"#FAFAFA",tertiary:"#F4F4F5",elevated:"#FFFFFF"},border:{default:"rgba(0, 0, 0, 0.08)"},text:{primary:"#09090B",secondary:"#52525B"}}};ure()(pre(s=>({isDark:!0,setDark:n=>{s({isDark:n}),JJ(n)},toggle:()=>s(n=>{const i=!n.isDark;return JJ(i),{isDark:i}})}),{name:"delulu-theme"}));const JJ=s=>{const n=document.documentElement;s?(n.classList.add("dark"),n.style.setProperty("--bg-primary",Qs.dark.bg.primary),n.style.setProperty("--bg-secondary",Qs.dark.bg.secondary),n.style.setProperty("--bg-tertiary",Qs.dark.bg.tertiary),n.style.setProperty("--bg-elevated",Qs.dark.bg.elevated),n.style.setProperty("--text-primary",Qs.dark.text.primary),n.style.setProperty("--text-secondary",Qs.dark.text.secondary),n.style.setProperty("--border-default",Qs.dark.border.default)):(n.classList.remove("dark"),n.style.setProperty("--bg-primary",Qs.light.bg.primary),n.style.setProperty("--bg-secondary",Qs.light.bg.secondary),n.style.setProperty("--bg-tertiary",Qs.light.bg.tertiary),n.style.setProperty("--bg-elevated",Qs.light.bg.elevated),n.style.setProperty("--text-primary",Qs.light.text.primary),n.style.setProperty("--text-secondary",Qs.light.text.secondary),n.style.setProperty("--border-default",Qs.light.border.default))},lIe=()=>o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:o.jsx("div",{className:"w-32 h-32 rounded-full border-2 border-purple-500/20 animate-ping"})}),o.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:o.jsx("div",{className:"w-24 h-24 rounded-full border-2 border-purple-500/30 animate-pulse"})}),o.jsx("div",{className:"relative w-20 h-20 mx-auto rounded-full bg-gradient-to-br from-purple-500/20 to-pink-500/20 flex items-center justify-center",children:o.jsx(Hi,{size:32,className:"text-purple-400"})})]}),dIe=()=>o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:[...Array(8)].map((s,n)=>o.jsx("div",{className:"absolute w-2 h-2 bg-green-400 rounded-full animate-burst",style:{transform:`rotate(${n*45}deg) translateY(-40px)`,animationDelay:`${n*.1}s`}},n))}),o.jsx("div",{className:"relative w-20 h-20 mx-auto rounded-full bg-gradient-to-br from-green-500/20 to-emerald-500/20 flex items-center justify-center animate-bounce-once",children:o.jsx(am,{size:32,className:"text-green-400"})})]}),uIe=({onJoin:s,isLoading:n,position:i})=>{const[l,u]=H.useState(""),[p,g]=H.useState(""),[y,x]=H.useState(!1),C=async k=>{k.preventDefault(),await s(l,p),x(!0)};return y&&i?o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-purple-500/20 flex items-center justify-center",children:o.jsx(zn,{size:28,className:"text-purple-400"})}),o.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Du bist auf der Liste!"}),o.jsxs("p",{className:"text-gray-400 mb-4",children:["Position ",o.jsxs("span",{className:"text-purple-400 font-bold",children:["#",i]})]}),o.jsx("p",{className:"text-sm text-gray-500",children:"Wir benachrichtigen dich, sobald ein Platz frei wird."})]}):o.jsxs("form",{onSubmit:C,className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Name"}),o.jsx("input",{type:"text",value:p,onChange:k=>g(k.target.value),placeholder:"Dein Name",className:"w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white placeholder-gray-500 focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"E-Mail *"}),o.jsx("input",{type:"email",value:l,onChange:k=>u(k.target.value),placeholder:"deine@email.de",required:!0,className:"w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white placeholder-gray-500 focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all"})]}),o.jsx("button",{type:"submit",disabled:n||!l,className:"w-full py-4 rounded-xl bg-gradient-to-r from-purple-600 to-pink-600 text-white font-semibold flex items-center justify-center gap-2 hover:opacity-90 disabled:opacity-50 transition-all",children:n?o.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):o.jsxs(o.Fragment,{children:[o.jsx(Gi,{size:18}),"Auf Warteliste setzen"]})})]})},QJ=()=>{var Dt;const s=zr(),{code:n}=Eee(),[i]=aT(),[l,u]=H.useState(""),[p,g]=H.useState(null),[y,x]=H.useState(!1),[C,k]=H.useState(!1),[A,M]=H.useState(""),[G,B]=H.useState(""),[X,Z]=H.useState(""),[q,V]=H.useState(!1),[ee,de]=H.useState(!1),[ae,ye]=H.useState(""),[Q,$]=H.useState(),[se,ce]=H.useState(!1);H.useEffect(()=>{const gt=n||i.get("code")||i.get("invite");gt&&(u(gt.toUpperCase()),he(gt))},[n,i]);const he=async gt=>{const Ye=gt||l;if(Ye.trim()){x(!0),ye("");try{const ze=await aIe(Ye);g(ze),ze.isValid?(cIe(Ye),setTimeout(()=>k(!0),500),"vibrate"in navigator&&navigator.vibrate([50,30,50,30,100])):"vibrate"in navigator&&navigator.vibrate([100,50,100])}catch{g({isValid:!1,error:"INVALID",message:"Validierung fehlgeschlagen"})}finally{x(!1)}}},ve=async gt=>{var Ye;if(gt.preventDefault(),!(!(p!=null&&p.isValid)||!A||!G||!X)){de(!0),ye("");try{const ut=(await ite(Fi,A,G)).user;await yo(at(Me,"users",ut.uid),{id:ut.uid,email:ut.email,displayName:X,username:X.toLowerCase().replace(/\s+/g,"_"),avatarUrl:null,createdAt:Uo(),onboardingCompleted:!1,level:1,xp:0,isPremium:!1,isCreator:!1,invitedBy:((Ye=p.code)==null?void 0:Ye.creatorId)||null,inviteCode:l}),await $J(l,ut.uid,X),s("/onboarding")}catch(ze){console.error("[Register] Error:",ze),ze.code==="auth/email-already-in-use"?ye("Diese E-Mail wird bereits verwendet"):ze.code==="auth/weak-password"?ye("Passwort muss mindestens 6 Zeichen haben"):ye("Registrierung fehlgeschlagen")}finally{de(!1)}}},ge=async()=>{var gt;if(p!=null&&p.isValid){de(!0),ye("");try{const Ye=new Bd,ut=(await gte(Fi,Ye)).user;await yo(at(Me,"users",ut.uid),{id:ut.uid,email:ut.email,displayName:ut.displayName||"Anonym",username:(ut.displayName||"user").toLowerCase().replace(/\s+/g,"_"),avatarUrl:ut.photoURL,createdAt:Uo(),onboardingCompleted:!1,level:1,xp:0,isPremium:!1,isCreator:!1,invitedBy:((gt=p.code)==null?void 0:gt.creatorId)||null,inviteCode:l},{merge:!0}),await $J(l,ut.uid,ut.displayName||"Anonym"),s("/onboarding")}catch(Ye){console.error("[Google Sign In] Error:",Ye),ye("Google Anmeldung fehlgeschlagen")}finally{de(!1)}}},qe=async(gt,Ye)=>{ce(!0);const ze=await oIe(gt,Ye,"registration_page");ze.success&&ze.position&&$(ze.position),ce(!1)};return o.jsxs("div",{className:"min-h-screen flex flex-col",style:{background:Qs.dark.bg.primary},children:[o.jsx("div",{className:"p-4",children:o.jsx("button",{onClick:()=>s("/"),className:"w-10 h-10 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center hover:bg-white/10 transition-colors",children:o.jsx(Gu,{size:20,className:"text-white"})})}),o.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center px-6 py-8",children:[o.jsxs("div",{className:"mb-8",children:[o.jsx("h1",{className:"font-display text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 via-pink-400 to-purple-400",children:"Delulu"}),o.jsx("p",{className:"text-center text-gray-500 text-sm mt-1",children:"Invite-Only Beta"})]}),!p&&o.jsxs("div",{className:"w-full max-w-sm",children:[o.jsxs("div",{className:"rounded-3xl p-6 border",style:{background:Qs.dark.bg.secondary,borderColor:Qs.dark.border.default},children:[o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-purple-500/10 flex items-center justify-center",children:o.jsx(ra,{size:28,className:"text-purple-400"})}),o.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Hast du einen Einladungscode?"}),o.jsx("p",{className:"text-gray-400 text-sm",children:"Delulu ist nur mit Einladung zugnglich"})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsx("div",{children:o.jsx("input",{type:"text",value:l,onChange:gt=>u(gt.target.value.toUpperCase()),placeholder:"DELULU-XXXXXX",className:"w-full px-4 py-4 rounded-xl bg-white/5 border border-white/10 text-white text-center font-mono text-lg tracking-widest placeholder-gray-500 focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all uppercase"})}),o.jsx("button",{onClick:()=>he(),disabled:y||!l.trim(),className:"w-full py-4 rounded-xl bg-gradient-to-r from-purple-600 to-pink-600 text-white font-semibold flex items-center justify-center gap-2 hover:opacity-90 disabled:opacity-50 transition-all",children:y?o.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):o.jsxs(o.Fragment,{children:[o.jsx(li,{size:18}),"Code prfen"]})})]})]}),o.jsx("button",{onClick:()=>g({isValid:!1,error:"INVALID",message:"Kein Code"}),className:"w-full mt-4 py-3 text-gray-400 text-sm hover:text-white transition-colors",children:"Ich habe keinen Code"})]}),p&&!p.isValid&&o.jsx("div",{className:"w-full max-w-sm",children:o.jsxs("div",{className:"rounded-3xl p-6 border",style:{background:Qs.dark.bg.secondary,borderColor:Qs.dark.border.default},children:[o.jsx(lIe,{}),o.jsxs("div",{className:"text-center mt-6 mb-6",children:[o.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:p.error==="USED_UP"?"Code vollstndig eingelst":p.error==="EXPIRED"?"Code abgelaufen":"Zugang limitiert"}),o.jsx("p",{className:"text-gray-400 text-sm",children:p.message||"Tritt der Warteliste bei, um benachrichtigt zu werden"})]}),o.jsx(uIe,{onJoin:qe,isLoading:se,position:Q}),o.jsx("button",{onClick:()=>{g(null),u("")},className:"w-full mt-4 py-3 text-gray-400 text-sm hover:text-white transition-colors",children:"Anderen Code eingeben"})]})}),(p==null?void 0:p.isValid)&&o.jsxs("div",{className:"w-full max-w-sm",children:[o.jsx("div",{className:"rounded-3xl p-6 border",style:{background:Qs.dark.bg.secondary,borderColor:Qs.dark.border.default},children:C?o.jsxs(o.Fragment,{children:[o.jsx(dIe,{}),o.jsxs("div",{className:"text-center mt-6 mb-6",children:[o.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Willkommen im Club! "}),o.jsxs("p",{className:"text-gray-400 text-sm",children:["Eingeladen von"," ",o.jsx("span",{className:"text-purple-400 font-semibold",children:((Dt=p.code)==null?void 0:Dt.creatorName)||"einem Freund"})]})]}),ae&&o.jsx("div",{className:"mb-4 p-3 rounded-xl bg-red-500/10 border border-red-500/20 text-red-400 text-sm text-center",children:ae}),o.jsxs("form",{onSubmit:ve,className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Name"}),o.jsxs("div",{className:"relative",children:[o.jsx(tp,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500"}),o.jsx("input",{type:"text",value:X,onChange:gt=>Z(gt.target.value),placeholder:"Dein Name",required:!0,className:"w-full pl-12 pr-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white placeholder-gray-500 focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"E-Mail"}),o.jsxs("div",{className:"relative",children:[o.jsx(_y,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500"}),o.jsx("input",{type:"email",value:A,onChange:gt=>M(gt.target.value),placeholder:"deine@email.de",required:!0,className:"w-full pl-12 pr-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white placeholder-gray-500 focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Passwort"}),o.jsxs("div",{className:"relative",children:[o.jsx(Hi,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500"}),o.jsx("input",{type:q?"text":"password",value:G,onChange:gt=>B(gt.target.value),placeholder:"",required:!0,minLength:6,className:"w-full pl-12 pr-12 py-3 rounded-xl bg-white/5 border border-white/10 text-white placeholder-gray-500 focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all"}),o.jsx("button",{type:"button",onClick:()=>V(!q),className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 hover:text-white transition-colors",children:q?o.jsx($c,{size:18}):o.jsx(Ta,{size:18})})]})]}),o.jsx("button",{type:"submit",disabled:ee,className:"w-full py-4 rounded-xl bg-gradient-to-r from-purple-600 to-pink-600 text-white font-semibold flex items-center justify-center gap-2 hover:opacity-90 disabled:opacity-50 transition-all",children:ee?o.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):o.jsxs(o.Fragment,{children:[o.jsx(wr,{size:18}),"Account erstellen"]})})]}),o.jsxs("div",{className:"flex items-center gap-4 my-6",children:[o.jsx("div",{className:"flex-1 h-px bg-white/10"}),o.jsx("span",{className:"text-gray-500 text-sm",children:"oder"}),o.jsx("div",{className:"flex-1 h-px bg-white/10"})]}),o.jsxs("button",{onClick:ge,disabled:ee,className:"w-full py-3 rounded-xl bg-white/5 border border-white/10 text-white font-medium flex items-center justify-center gap-3 hover:bg-white/10 disabled:opacity-50 transition-all",children:[o.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[o.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),o.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),o.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),o.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Mit Google fortfahren"]})]}):o.jsx("div",{className:"py-8",children:o.jsx("div",{className:"w-12 h-12 mx-auto border-4 border-purple-500 border-t-transparent rounded-full animate-spin"})})}),o.jsxs("p",{className:"text-center mt-6 text-gray-400 text-sm",children:["Bereits registriert?"," ",o.jsx("button",{onClick:()=>s("/login"),className:"text-purple-400 hover:text-purple-300 font-semibold",children:"Anmelden"})]})]})]}),o.jsx("style",{children:`
        @keyframes burst {
          0% {
            transform: rotate(var(--rotation)) translateY(0) scale(1);
            opacity: 1;
          }
          100% {
            transform: rotate(var(--rotation)) translateY(-60px) scale(0);
            opacity: 0;
          }
        }
        .animate-burst {
          animation: burst 0.6s ease-out forwards;
        }
        @keyframes bounce-once {
          0%, 100% { transform: scale(1); }
          50% { transform: scale(1.1); }
        }
        .animate-bounce-once {
          animation: bounce-once 0.5s ease-out;
        }
      `})]})},hIe=({type:s,size:n=24,className:i=""})=>{const u={mobile:Ore,tablet:ERe,desktop:dRe,unknown:wJ}[s]||wJ;return o.jsx(u,{size:n,className:i})},pIe=({device:s,onRevoke:n,isRevoking:i})=>{const[l,u]=H.useState(!1),p=g=>{const x=new Date().getTime()-g.getTime(),C=Math.floor(x/6e4),k=Math.floor(C/60),A=Math.floor(k/24);return C<1?"Gerade aktiv":C<60?`Vor ${C} Min`:k<24?`Vor ${k} Std`:A<7?`Vor ${A} Tagen`:g.toLocaleDateString("de-DE")};return o.jsxs("div",{className:`
        relative rounded-2xl p-4 transition-all
        ${s.isCurrent?"bg-purple-500/10 border-2 border-purple-500/30":"bg-white/5 border border-white/10 hover:border-white/20"}
      `,children:[s.isCurrent&&o.jsx("div",{className:"absolute -top-2 left-4 px-2 py-0.5 bg-purple-500 rounded-full",children:o.jsx("span",{className:"text-[10px] font-bold text-white uppercase tracking-wider",children:"Dieses Gert"})}),o.jsxs("div",{className:"flex items-start gap-4",children:[o.jsx("div",{className:`
          w-12 h-12 rounded-xl flex items-center justify-center
          ${s.isCurrent?"bg-purple-500/20 text-purple-400":"bg-white/10 text-gray-400"}
        `,children:o.jsx(hIe,{type:s.deviceType,size:24})}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("h3",{className:"font-semibold text-white truncate",children:s.deviceName}),s.isCurrent&&o.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"})]}),o.jsxs("p",{className:"text-sm text-gray-400 truncate",children:[s.browser,"  ",s.os]}),o.jsxs("div",{className:"flex items-center gap-3 mt-2 text-xs text-gray-500",children:[o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx(Gi,{size:12}),p(s.lastActive)]}),s.location&&o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx(_c,{size:12}),s.location]})]})]}),!s.isCurrent&&o.jsx("div",{children:l?o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("button",{onClick:()=>{n(),u(!1)},disabled:i,className:"w-8 h-8 rounded-lg bg-red-500/20 text-red-400 flex items-center justify-center hover:bg-red-500/30 transition-colors",children:i?o.jsx("div",{className:"w-4 h-4 border-2 border-red-400 border-t-transparent rounded-full animate-spin"}):o.jsx(zn,{size:16})}),o.jsx("button",{onClick:()=>u(!1),className:"w-8 h-8 rounded-lg bg-white/10 text-gray-400 flex items-center justify-center hover:bg-white/20 transition-colors",children:o.jsx(Rs,{size:16})})]}):o.jsx("button",{onClick:()=>u(!0),className:"w-8 h-8 rounded-lg bg-white/5 text-gray-400 flex items-center justify-center hover:bg-red-500/20 hover:text-red-400 transition-colors",children:o.jsx(hO,{size:16})})})]})]})},fIe=()=>{const s=zr(),{user:n}=mr(),[i,l]=H.useState([]),[u,p]=H.useState(!0),[g,y]=H.useState(null),[x,C]=H.useState(!1),k=()=>sessionStorage.getItem("delulu_session_id")||"unknown",A=()=>{const X=navigator.userAgent;let Z="desktop";/tablet|ipad/i.test(X)?Z="tablet":/mobile|android|iphone/i.test(X)&&(Z="mobile");let q="Unbekannt";X.includes("Chrome")?q="Chrome":X.includes("Safari")?q="Safari":X.includes("Firefox")?q="Firefox":X.includes("Edge")&&(q="Edge");let V="Unbekannt";X.includes("Mac")?V="macOS":X.includes("Windows")?V="Windows":X.includes("iPhone")||X.includes("iPad")?V="iOS":X.includes("Android")?V="Android":X.includes("Linux")&&(V="Linux");const ee=Z==="mobile"?`${V} Smartphone`:Z==="tablet"?`${V} Tablet`:`${q} auf ${V}`;return{deviceType:Z,deviceName:ee,browser:q,os:V}};H.useEffect(()=>{(async()=>{if(n!=null&&n.id){p(!0);try{const Z=Zr(xn(Me,"user_sessions"),or("userId","==",n.id)),q=await Ur(Z),V=k(),ee=q.docs.map(de=>{var ye,Q;const ae=de.data();return{id:de.id,deviceType:ae.deviceType||"unknown",deviceName:ae.deviceName||"Unbekanntes Gert",browser:ae.browser||"Unbekannt",os:ae.os||"Unbekannt",location:ae.location,ipAddress:ae.ipAddress,lastActive:((ye=ae.lastActive)==null?void 0:ye.toDate())||new Date,createdAt:((Q=ae.createdAt)==null?void 0:Q.toDate())||new Date,isCurrent:de.id===V}});if(ee.sort((de,ae)=>de.isCurrent?-1:ae.isCurrent?1:ae.lastActive.getTime()-de.lastActive.getTime()),ee.length===0){const de=A();ee.push({id:"current",...de,lastActive:new Date,createdAt:new Date,isCurrent:!0})}l(ee)}catch(Z){console.error("[DevicesSettings] Load error:",Z)}finally{p(!1)}}})()},[n==null?void 0:n.id]);const M=async X=>{y(X);try{await Ga(at(Me,"user_sessions",X)),l(Z=>Z.filter(q=>q.id!==X)),"vibrate"in navigator&&navigator.vibrate(20)}catch(Z){console.error("[DevicesSettings] Revoke error:",Z)}finally{y(null)}},G=async()=>{k();const X=i.filter(Z=>!Z.isCurrent);for(const Z of X)try{await Ga(at(Me,"user_sessions",Z.id))}catch(q){console.error("[DevicesSettings] Revoke error:",q)}l(Z=>Z.filter(q=>q.isCurrent)),C(!1),"vibrate"in navigator&&navigator.vibrate([20,50,20])},B=i.filter(X=>!X.isCurrent).length;return o.jsxs("div",{className:"min-h-screen",style:{background:Qs.dark.bg.primary},children:[o.jsx("div",{className:"sticky top-0 z-50 px-4 pt-6 pb-4 bg-gradient-to-b from-[#0A0A0B] to-transparent backdrop-blur-lg",children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("button",{onClick:()=>s(-1),className:"w-10 h-10 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center hover:bg-white/10 transition-colors",children:o.jsx(Gu,{size:20,className:"text-white"})}),o.jsxs("div",{children:[o.jsx("h1",{className:"text-xl font-bold text-white",children:"Verknpfte Gerte"}),o.jsxs("p",{className:"text-sm text-gray-500",children:[i.length," ",i.length===1?"Gert":"Gerte"," aktiv"]})]})]})}),o.jsxs("div",{className:"px-4 pb-32 space-y-6",children:[o.jsxs("div",{className:"rounded-2xl p-4 border flex items-start gap-4",style:{background:Qs.dark.bg.secondary,borderColor:Qs.dark.border.default},children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center flex-shrink-0",children:o.jsx(li,{size:20,className:"text-blue-400"})}),o.jsxs("div",{children:[o.jsx("h3",{className:"font-semibold text-white mb-1",children:"Sicherheitsbersicht"}),o.jsx("p",{className:"text-sm text-gray-400",children:"Hier siehst du alle Gerte, auf denen dein Delulu-Account aktiv ist. Entferne unbekannte Gerte sofort."})]})]}),u?o.jsx("div",{className:"flex items-center justify-center py-16",children:o.jsx("div",{className:"w-10 h-10 border-4 border-purple-500 border-t-transparent rounded-full animate-spin"})}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"space-y-3",children:i.map(X=>o.jsx(pIe,{device:X,onRevoke:()=>M(X.id),isRevoking:g===X.id},X.id))}),B>0&&o.jsx("div",{className:"pt-4",children:x?o.jsxs("div",{className:"rounded-2xl p-4 border",style:{background:"rgba(239, 68, 68, 0.1)",borderColor:"rgba(239, 68, 68, 0.2)"},children:[o.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[o.jsx(ql,{size:20,className:"text-red-400 flex-shrink-0 mt-0.5"}),o.jsxs("div",{children:[o.jsx("h3",{className:"font-semibold text-white mb-1",children:"Alle anderen Gerte abmelden?"}),o.jsxs("p",{className:"text-sm text-gray-400",children:["Du wirst auf ",B," anderen"," ",B===1?"Gert":"Gerten"," abgemeldet."]})]})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:G,className:"flex-1 py-3 rounded-xl bg-red-500 text-white font-semibold hover:bg-red-600 transition-colors",children:"Ja, alle abmelden"}),o.jsx("button",{onClick:()=>C(!1),className:"flex-1 py-3 rounded-xl bg-white/10 text-white font-semibold hover:bg-white/20 transition-colors",children:"Abbrechen"})]})]}):o.jsxs("button",{onClick:()=>C(!0),className:"w-full py-4 rounded-xl bg-red-500/10 border border-red-500/20 text-red-400 font-semibold flex items-center justify-center gap-2 hover:bg-red-500/20 transition-colors",children:[o.jsx(Jh,{size:18}),"Alle anderen Gerte abmelden"]})})]})]})]})},mIe=[{to:"/",icon:Are,label:"Home"},{to:"/discover",icon:Cre,label:"Entdecken"},{to:"/messages",icon:V_,label:"Nachrichten"},{to:"/profile",icon:tp,label:"Profil"}],gIe=()=>o.jsx("nav",{className:"fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-lg border-t border-delulu-soft safe-bottom z-50",children:o.jsx("div",{className:"flex items-center justify-around h-16 max-w-lg mx-auto px-4",children:mIe.map(({to:s,icon:n,label:i})=>o.jsx($_e,{to:s,className:({isActive:l})=>`flex flex-col items-center justify-center gap-1 px-4 py-2 rounded-xl transition-all ${l?"text-delulu-violet":"text-delulu-muted hover:text-delulu-text"}`,children:({isActive:l})=>o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:`relative ${l?"scale-110":""} transition-transform`,children:[o.jsx(n,{size:22,strokeWidth:l?2.5:2}),l&&o.jsx("div",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-1 h-1 bg-delulu-violet rounded-full"})]}),o.jsx("span",{className:"text-[10px] font-medium",children:i})]})},s))})}),_Ie=()=>o.jsxs("div",{className:"min-h-screen min-h-[100dvh] bg-delulu-bg flex flex-col items-center justify-center",children:[o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"w-24 h-24 rounded-3xl bg-gradient-to-br from-delulu-violet to-delulu-violet-dark flex items-center justify-center shadow-lg",children:o.jsx("span",{className:"text-4xl",children:""})}),o.jsx("div",{className:"absolute inset-0 rounded-3xl bg-delulu-violet/30 pulse-ring"})]}),o.jsx("h1",{className:"font-display text-3xl font-bold mt-6 gradient-text",children:"delulu"}),o.jsx("p",{className:"text-delulu-muted text-sm mt-2",children:"Wird geladen..."})]}),Ese=H.createContext(null),vIe=()=>{const s=H.useContext(Ese);if(!s)throw new Error("useNotifications must be used within NotificationProvider");return s},EIe=({children:s})=>{const{user:n}=mr(),[i,l]=H.useState([]),[u,p]=H.useState(null),[g,y]=H.useState([]);H.useEffect(()=>{if(!(n!=null&&n.id))return;const G=xn(Me,"friendRequests"),B=Zr(G,or("toId","==",n.id),or("status","==","pending")),X=qa(B,Z=>{Z.docChanges().forEach(q=>{var V;if(q.type==="added"){const ee=q.doc.data(),de=((V=ee.createdAt)==null?void 0:V.toDate())||new Date;if(Date.now()-de.getTime()<3e4){const ye={id:q.doc.id,type:"friend_request",title:"Neue Freundschaftsanfrage",message:`${ee.fromDisplayName||ee.fromUsername} mchte dein Freund sein!`,fromUserId:ee.fromId,fromUsername:ee.fromUsername,fromDisplayName:ee.fromDisplayName,createdAt:de,read:!1};l(Q=>[ye,...Q]),x(ye)}}})});return()=>X()},[n==null?void 0:n.id]),H.useEffect(()=>{if(!(n!=null&&n.id))return;const G=xn(Me,"friendRequests"),B=Zr(G,or("fromId","==",n.id),or("status","==","accepted")),X=qa(B,Z=>{Z.docChanges().forEach(q=>{if(q.type==="modified"){const V=q.doc.data(),ee={id:`accepted-${q.doc.id}`,type:"friend_accepted",title:"Freundschaft besttigt!",message:`${V.toUsername||"Jemand"} hat deine Anfrage angenommen!`,fromUserId:V.toId,fromUsername:V.toUsername,createdAt:new Date,read:!1};l(de=>[ee,...de]),x(ee)}})});return()=>X()},[n==null?void 0:n.id]),H.useEffect(()=>{if(!(n!=null&&n.id))return;const G=xn(Me,"stars"),B=Zr(G,or("toUserId","==",n.id)),X=qa(B,Z=>{Z.docChanges().forEach(q=>{var V;if(q.type==="added"){const ee=q.doc.data(),de=((V=ee.createdAt)==null?void 0:V.toDate())||new Date;if(Date.now()-de.getTime()<3e4){const ye={id:q.doc.id,type:"star_received",title:" Stern erhalten!",message:`${ee.fromDisplayName||"Jemand"} hat dir einen Stern geschenkt!`,fromUserId:ee.fromUserId,fromUsername:ee.fromUsername,fromDisplayName:ee.fromDisplayName,data:{amount:ee.amount},createdAt:de,read:!1};l(Q=>[ye,...Q]),x(ye)}}})});return()=>X()},[n==null?void 0:n.id]),H.useEffect(()=>{!u&&g.length>0&&(p(g[0]),y(G=>G.slice(1)))},[u,g]),H.useEffect(()=>{if(u){const G=setTimeout(()=>{p(null)},5e3);return()=>clearTimeout(G)}},[u]);const x=H.useCallback(G=>{const B={id:"id"in G?G.id:`toast-${Date.now()}`,createdAt:"createdAt"in G?G.createdAt:new Date,read:!1,...G};u?y(X=>[...X,B]):p(B),"vibrate"in navigator&&navigator.vibrate([50,30,50])},[u]),C=H.useCallback(()=>{p(null)},[]),k=H.useCallback(G=>{l(B=>B.map(X=>X.id===G?{...X,read:!0}:X))},[]),A=H.useCallback(()=>{l(G=>G.map(B=>({...B,read:!0})))},[]),M=i.filter(G=>!G.read).length;return o.jsx(Ese.Provider,{value:{notifications:i,unreadCount:M,showToast:x,markAsRead:k,markAllAsRead:A,clearToast:C,currentToast:u},children:s})},yIe=()=>{const s=zr(),{currentToast:n,clearToast:i,markAsRead:l}=vIe(),[u,p]=H.useState(!1),[g,y]=H.useState(!1);H.useEffect(()=>{n&&(p(!0),y(!1))},[n]);const x=()=>{y(!0),setTimeout(()=>{p(!1),i()},300)},C=()=>{if(n){switch(l(n.id),n.type){case"friend_request":s("/notifications");break;case"friend_accepted":n.fromUserId&&s(`/user/${n.fromUserId}`);break;case"star_received":s("/profile");break;case"room_invite":s("/discover");break;default:s("/notifications")}x()}},k=M=>{switch(M){case"friend_request":return o.jsx(ep,{size:24,className:"text-delulu-violet"});case"friend_accepted":return o.jsx(zn,{size:24,className:"text-green-500"});case"star_received":return o.jsx(Fs,{size:24,className:"text-amber-500"});case"room_invite":return o.jsx(rr,{size:24,className:"text-blue-500"});default:return o.jsx(Xc,{size:24,className:"text-delulu-violet"})}},A=M=>{switch(M){case"friend_request":return"from-purple-500/10 to-pink-500/10 border-purple-200";case"friend_accepted":return"from-green-500/10 to-emerald-500/10 border-green-200";case"star_received":return"from-amber-500/10 to-yellow-500/10 border-amber-200";case"room_invite":return"from-blue-500/10 to-cyan-500/10 border-blue-200";default:return"from-gray-500/10 to-gray-400/10 border-gray-200"}};return!n||!u?null:o.jsxs("div",{className:"fixed top-0 left-0 right-0 z-[100] px-4 pt-safe-top pointer-events-none",children:[o.jsx("div",{className:`mt-4 pointer-events-auto transform transition-all duration-300 ease-out ${g?"translate-y-[-100%] opacity-0":"translate-y-0 opacity-100"}`,children:o.jsxs("div",{onClick:C,className:`bg-gradient-to-r ${A(n.type)} backdrop-blur-lg rounded-2xl p-4 shadow-lg border cursor-pointer active:scale-[0.98] transition-transform`,children:[o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-xl bg-white shadow-sm flex items-center justify-center flex-shrink-0",children:k(n.type)}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("p",{className:"font-bold text-delulu-text text-sm",children:n.title}),o.jsx("p",{className:"text-sm text-delulu-muted mt-0.5 line-clamp-2",children:n.message}),o.jsx("p",{className:"text-xs text-delulu-violet mt-1 font-medium",children:"Tippe zum Ansehen "})]}),o.jsx("button",{onClick:M=>{M.stopPropagation(),x()},className:"w-8 h-8 rounded-full bg-white/50 flex items-center justify-center text-gray-400 hover:text-gray-600 transition-colors flex-shrink-0",children:o.jsx(Rs,{size:16})})]}),o.jsx("div",{className:"mt-3 h-1 bg-white/30 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full bg-delulu-violet rounded-full animate-shrink",style:{animationDuration:"5s"}})})]})}),o.jsx("style",{children:`
        @keyframes shrink {
          from { width: 100%; }
          to { width: 0%; }
        }
        .animate-shrink {
          animation: shrink linear forwards;
        }
      `})]})},ZJ=["Die Realitt wird gerade neu gerendert. Gedulde dich, Sterblicher. ","Wir polieren gerade die Sterne. Deine App ist gleich noch glanzvoller. ","Eure Gebete wurden erhrt, die Admins sind im Godmode-Update. ","Das Multiversum wird gerade rebalanced. Ein Moment Geduld. ","Die Matrix bekommt ein Upgrade. Neo wre neidisch. ","Wir fgen mehr Glitzer hinzu. Kann nicht schaden. ","Die Delulu-Energie wird aufgeladen. Stand by. ","Quantenverschrnkung in Progress. Nicht die Katze stren. ","Das Universum macht einen Powernap. Gleich geht's weiter. ","Wir bauen gerade eine Brcke zum Mond. Fast fertig. "],bIe=({message:s,estimatedEnd:n})=>{const[i,l]=H.useState(0),[u,p]=H.useState(!1),[g,y]=H.useState("");H.useEffect(()=>{const C=setInterval(()=>{p(!0),setTimeout(()=>{l(k=>(k+1)%ZJ.length),p(!1)},200)},8e3);return()=>clearInterval(C)},[]),H.useEffect(()=>{if(!n)return;const C=()=>{const A=new Date,M=n.getTime()-A.getTime();if(M<=0){y("Gleich fertig...");return}const G=Math.floor(M/6e4),B=Math.floor(M%6e4/1e3);G>0?y(`~${G} Min ${B}s`):y(`${B}s`)};C();const k=setInterval(C,1e3);return()=>clearInterval(k)},[n]);const x=s||ZJ[i];return o.jsxs("div",{className:"fixed inset-0 z-[9999] overflow-hidden",children:[o.jsxs("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-900 via-purple-900/90 to-gray-900",children:[o.jsx("div",{className:"absolute inset-0 opacity-50",style:{background:"linear-gradient(45deg, transparent 30%, rgba(139, 92, 246, 0.15) 50%, transparent 70%)",animation:"shimmer 3s ease-in-out infinite"}}),o.jsx("div",{className:"absolute inset-0 opacity-10",style:{backgroundImage:"linear-gradient(rgba(139, 92, 246, 0.3) 1px, transparent 1px), linear-gradient(90deg, rgba(139, 92, 246, 0.3) 1px, transparent 1px)",backgroundSize:"50px 50px"}})]}),o.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[...Array(30)].map((C,k)=>o.jsx("div",{className:"absolute rounded-full",style:{width:`${2+Math.random()*4}px`,height:`${2+Math.random()*4}px`,background:`rgba(${139+Math.random()*50}, ${92+Math.random()*50}, 246, ${.3+Math.random()*.4})`,left:`${Math.random()*100}%`,top:`${Math.random()*100}%`,animation:`float ${5+Math.random()*10}s ease-in-out infinite`,animationDelay:`${Math.random()*5}s`}},k))}),o.jsxs("div",{className:"relative z-10 min-h-screen flex flex-col items-center justify-center px-6 text-center",children:[o.jsxs("div",{className:"relative mb-8",children:[o.jsx("div",{className:"absolute inset-0 scale-150",children:o.jsx("div",{className:"w-32 h-32 mx-auto rounded-full bg-purple-500/20",style:{animation:"pulse-glow 2s ease-in-out infinite",filter:"blur(20px)"}})}),o.jsx("div",{className:"absolute inset-0 scale-125",children:o.jsx("div",{className:"w-32 h-32 mx-auto rounded-full bg-violet-500/30",style:{animation:"pulse-glow 2s ease-in-out infinite 0.5s",filter:"blur(15px)"}})}),o.jsxs("div",{className:"relative w-32 h-32 mx-auto rounded-full bg-gradient-to-br from-purple-500 via-violet-500 to-fuchsia-500 flex items-center justify-center shadow-2xl",style:{boxShadow:"0 0 60px rgba(139, 92, 246, 0.5), 0 0 100px rgba(139, 92, 246, 0.3)"},children:[o.jsx(sm,{size:56,className:"text-white",style:{filter:"drop-shadow(0 0 10px rgba(255,255,255,0.8))",animation:"breathe 3s ease-in-out infinite"}}),o.jsx("div",{className:"absolute inset-0",style:{animation:"spin 10s linear infinite"},children:o.jsx(wr,{size:16,className:"absolute -top-2 left-1/2 -translate-x-1/2 text-yellow-300"})}),o.jsx("div",{className:"absolute inset-0",style:{animation:"spin 15s linear infinite reverse"},children:o.jsx(wr,{size:14,className:"absolute -bottom-1 left-1/2 -translate-x-1/2 text-cyan-300"})}),o.jsx("div",{className:"absolute inset-0",style:{animation:"spin 8s linear infinite"},children:o.jsx(Ei,{size:12,className:"absolute top-1/2 -right-1 -translate-y-1/2 text-yellow-400"})})]})]}),o.jsx("h1",{className:"text-4xl md:text-5xl font-display font-bold mb-4",style:{background:"linear-gradient(135deg, #fff 0%, #a78bfa 50%, #f0abfc 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textShadow:"0 0 40px rgba(167, 139, 250, 0.5)"},children:"GODMODE AKTIV"}),o.jsx("p",{className:"text-purple-300/80 text-lg mb-8 font-medium tracking-wide",children:" Die Gtter arbeiten an etwas Groem "}),o.jsx("div",{className:`max-w-md mx-auto p-6 rounded-2xl bg-white/5 backdrop-blur-xl border border-purple-500/30 transition-all duration-200 ${u?"opacity-0 scale-95":"opacity-100 scale-100"}`,style:{boxShadow:"0 0 30px rgba(139, 92, 246, 0.2), inset 0 0 30px rgba(139, 92, 246, 0.05)"},children:o.jsx("p",{className:"text-white text-lg leading-relaxed",children:x})}),n&&g&&o.jsxs("div",{className:"mt-6 flex items-center gap-2 text-purple-300/60",children:[o.jsx(gS,{size:16,className:"animate-spin",style:{animationDuration:"3s"}}),o.jsxs("span",{className:"text-sm",children:["Geschtzte Wartezeit: ",g]})]}),o.jsxs("div",{className:"mt-10 flex items-center gap-3",children:[o.jsx("div",{className:"flex gap-1.5",children:[0,1,2].map(C=>o.jsx("div",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-purple-400 to-fuchsia-400",style:{animation:"bounce-loading 1.4s ease-in-out infinite",animationDelay:`${C*.2}s`}},C))}),o.jsx("span",{className:"text-purple-400/60 text-sm",children:"Realitt wird geladen..."})]}),o.jsx("div",{className:"absolute bottom-8 left-0 right-0 text-center",children:o.jsx("p",{className:"text-purple-500/40 text-xs tracking-widest uppercase",children:"Delulu Digital Operating System  v.0"})})]}),o.jsx("style",{children:`
        @keyframes shimmer {
          0%, 100% { transform: translateX(-100%) rotate(45deg); }
          50% { transform: translateX(100%) rotate(45deg); }
        }

        @keyframes float {
          0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.3; }
          50% { transform: translateY(-20px) rotate(180deg); opacity: 0.8; }
        }

        @keyframes pulse-glow {
          0%, 100% { transform: scale(1); opacity: 0.5; }
          50% { transform: scale(1.1); opacity: 0.8; }
        }

        @keyframes breathe {
          0%, 100% { transform: scale(1); }
          50% { transform: scale(1.05); }
        }

        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }

        @keyframes bounce-loading {
          0%, 80%, 100% { transform: scale(0.6); opacity: 0.5; }
          40% { transform: scale(1); opacity: 1; }
        }
      `})]})},xIe=H.createContext(null),U4="/avatars/pegasus.png",wIe=({children:s})=>{const{user:n,setUser:i}=mr(),[l,u]=H.useState(()=>n!=null&&n.id?KA(n.id,n.avatarUrl,n.avatar):{url:U4,type:"default"}),[p,g]=H.useState(!1),[y,x]=H.useState(0),[C,k]=H.useState(null);H.useEffect(()=>{if(!(n!=null&&n.id)){u({url:U4,type:"default"});return}const Z=KA(n.id,n.avatarUrl,n.avatar);u(Z),Z.url&&Z.type==="custom"&&(E_(Z.url),Wd(n.id,Z.url))},[n==null?void 0:n.id,n==null?void 0:n.avatarUrl,n==null?void 0:n.avatar]);const A=H.useCallback(async Z=>{if(!(n!=null&&n.id))return{success:!1,error:"Nicht eingeloggt"};if(!Z.type.startsWith("image/"))return{success:!1,error:"Nur Bilder erlaubt"};if(Z.size>5*1024*1024)return{success:!1,error:"Bild darf maximal 5MB gro sein"};g(!0),x(0),k(null);try{const q=URL.createObjectURL(Z);u({url:q,type:"custom"}),x(10);const V=`avatars/${n.id}/${Date.now()}_${Z.name.replace(/[^a-zA-Z0-9.]/g,"_")}`,ee=cV(cTe,V);x(30),await aV(ee,Z),x(60);const de=await oV(ee);x(80);const ae=at(Me,"users",n.id);return await Kn(ae,{avatarUrl:de}),x(90),Zh(n.id,{url:de,type:"custom"}),Wd(n.id,de),E_(de),u({url:de,type:"custom"}),i({...n,avatarUrl:de}),qTe(n.id,de).catch(()=>{}),URL.revokeObjectURL(q),x(100),"vibrate"in navigator&&navigator.vibrate([15,10,25]),{success:!0,url:de}}catch(q){console.error("Avatar upload failed:",q);const V=q.message||"Upload fehlgeschlagen";k(V);const ee=KA(n.id,n.avatarUrl,n.avatar);return u(ee),{success:!1,error:V}}finally{g(!1),x(0)}},[n,i]),M=H.useCallback(async Z=>{if(!(n!=null&&n.id))return;const q=`/avatars/${Z}.png`,V=at(Me,"users",n.id);await Kn(V,{avatar:Z,avatarUrl:null}),Zh(n.id,{type:"preset",presetId:Z,url:q}),Wd(n.id,q),E_(q),u({url:q,type:"preset"}),i({...n,avatar:Z,avatarUrl:void 0})},[n,i]),G=H.useCallback(()=>{n!=null&&n.id&&(YTe(),u({url:U4,type:"default"}))},[n==null?void 0:n.id]),B=H.useCallback((Z,q)=>KA(Z,q).url,[]),X={avatarUrl:l.url,avatarType:l.type,isUploading:p,uploadProgress:y,uploadError:C,uploadAvatar:A,setPresetAvatar:M,clearAvatar:G,getAvatarForUser:B};return o.jsx(xIe.Provider,{value:X,children:s})},SIe=()=>{const{showXPToast:s,xpToastAmount:n,xpToastReason:i,hideXPToast:l}=mr(),{playXPSound:u}=Sre();return H.useEffect(()=>{if(s){u();const p=setTimeout(()=>{l()},3e3);return()=>clearTimeout(p)}},[s,l,u]),s?o.jsx("div",{className:"fixed top-4 right-4 z-50 animate-bounce",children:o.jsxs("div",{className:"bg-gradient-to-r from-amber-500 to-orange-500 text-white px-4 py-3 rounded-xl shadow-lg flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-full flex items-center justify-center",children:o.jsx(Ei,{size:20,className:"text-white"})}),o.jsxs("div",{children:[o.jsxs("p",{className:"font-bold text-lg",children:["+",n," XP"]}),o.jsx("p",{className:"text-xs opacity-90",children:i})]})]})}):null};function TIe(){const{isAuthenticated:s,isLoading:n}=TT(),{user:i}=mr(),{isMaintenanceMode:l,maintenanceMessage:u,maintenanceEstimatedEnd:p,isLoading:g}=Tre(),[y,x]=H.useState(!1),[C,k]=H.useState(!1),A=fp();if(H.useEffect(()=>{(async()=>{var q;if(i!=null&&i.id)try{const V=await fr(at(Me,"users",i.id));x(((q=V.data())==null?void 0:q.isAdmin)===!0)}catch{x(!1)}k(!0)})()},[i==null?void 0:i.id]),n||g||!C)return o.jsx(_Ie,{});const M=A.pathname.startsWith("/admin"),G=A.pathname==="/login",B=["/impressum","/datenschutz"].includes(A.pathname);return l&&!y&&!M&&!G&&!B?o.jsx(bIe,{message:u,estimatedEnd:p}):s?(i==null?void 0:i.onboardingCompleted)===!0?o.jsx(wIe,{children:o.jsx(EIe,{children:o.jsxs("div",{className:"min-h-screen min-h-[100dvh] bg-delulu-bg pb-20",children:[o.jsx(yIe,{}),o.jsx(SIe,{}),o.jsxs(p4,{children:[o.jsx(kn,{path:"/",element:o.jsx(YRe,{})}),o.jsx(kn,{path:"/discover",element:o.jsx(nCe,{})}),o.jsx(kn,{path:"/messages",element:o.jsx(rCe,{})}),o.jsx(kn,{path:"/profile",element:o.jsx(_Ce,{})}),o.jsx(kn,{path:"/profile/full",element:o.jsx(fCe,{})}),o.jsx(kn,{path:"/statistics",element:o.jsx(vCe,{})}),o.jsx(kn,{path:"/notifications",element:o.jsx(ECe,{})}),o.jsx(kn,{path:"/premium",element:o.jsx(yCe,{})}),o.jsx(kn,{path:"/settings",element:o.jsx(DCe,{})}),o.jsx(kn,{path:"/settings/legacy",element:o.jsx(jJ,{})}),o.jsx(kn,{path:"/settings/security",element:o.jsx(jJ,{})}),o.jsx(kn,{path:"/settings/blocked",element:o.jsx(WJ,{})}),o.jsx(kn,{path:"/settings/devices",element:o.jsx(fIe,{})}),o.jsx(kn,{path:"/help",element:o.jsx(LCe,{})}),o.jsx(kn,{path:"/invites",element:o.jsx(YJ,{})}),o.jsx(kn,{path:"/referral-status",element:o.jsx(YJ,{})}),o.jsx(kn,{path:"/radar",element:o.jsx(iIe,{})}),o.jsx(kn,{path:"/stars/apply",element:o.jsx(VJ,{})}),o.jsx(kn,{path:"/stars/dashboard",element:o.jsx(jCe,{})}),o.jsx(kn,{path:"/stars/schedule",element:o.jsx(VCe,{})}),o.jsx(kn,{path:"/user/:userId",element:o.jsx(BCe,{})}),o.jsx(kn,{path:"/blocked-users",element:o.jsx(WJ,{})}),o.jsx(kn,{path:"/admin",element:o.jsx(BJ,{})}),o.jsx(kn,{path:"/creator",element:o.jsx(GJ,{})}),o.jsx(kn,{path:"/creator/dashboard",element:o.jsx(GJ,{})}),o.jsx(kn,{path:"/creator/new-content",element:o.jsx(sNe,{})}),o.jsx(kn,{path:"/creator-application",element:o.jsx(VJ,{})}),o.jsx(kn,{path:"/impressum",element:o.jsx(qA,{})}),o.jsx(kn,{path:"/datenschutz",element:o.jsx(O4,{})}),o.jsx(kn,{path:"/legal",element:o.jsx(qA,{})}),o.jsx(kn,{path:"/onboarding",element:o.jsx(UA,{to:"/",replace:!0})}),o.jsx(kn,{path:"*",element:o.jsx(UA,{to:"/",replace:!0})})]}),o.jsx(gIe,{})]})})}):o.jsxs(p4,{children:[o.jsx(kn,{path:"/onboarding",element:o.jsx(FRe,{})}),o.jsx(kn,{path:"/impressum",element:o.jsx(qA,{})}),o.jsx(kn,{path:"/datenschutz",element:o.jsx(O4,{})}),o.jsx(kn,{path:"*",element:o.jsx(UA,{to:"/onboarding",replace:!0})})]}):o.jsxs(p4,{children:[o.jsx(kn,{path:"/",element:o.jsx(ARe,{})}),o.jsx(kn,{path:"/login",element:o.jsx(kRe,{})}),o.jsx(kn,{path:"/register",element:o.jsx(VRe,{})}),o.jsx(kn,{path:"/join/:code",element:o.jsx(QJ,{})}),o.jsx(kn,{path:"/join",element:o.jsx(QJ,{})}),o.jsx(kn,{path:"/reset-password",element:o.jsx(iNe,{})}),o.jsx(kn,{path:"/impressum",element:o.jsx(qA,{})}),o.jsx(kn,{path:"/datenschutz",element:o.jsx(O4,{})}),o.jsx(kn,{path:"/admin",element:o.jsx(BJ,{})}),o.jsx(kn,{path:"*",element:o.jsx(UA,{to:"/",replace:!0})})]})}V4.createRoot(document.getElementById("root")).render(o.jsx(CV.StrictMode,{children:o.jsx(q_e,{children:o.jsx(TIe,{})})}));eQ(async()=>{const{initializeCopyProtection:s}=await import("./copyProtection-DMGEU1DQ.js");return{initializeCopyProtection:s}},[]).then(({initializeCopyProtection:s})=>{setTimeout(()=>{try{s()}catch(n){console.warn("Protection init failed:",n)}},1e3)}).catch(()=>{});
