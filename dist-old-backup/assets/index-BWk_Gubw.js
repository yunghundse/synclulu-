var DTe=Object.defineProperty;var OTe=(t,e,r)=>e in t?DTe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var Qc=(t,e,r)=>OTe(t,typeof e!="symbol"?e+"":e,r);function LTe(t,e){for(var r=0;r<e.length;r++){const a=e[r];if(typeof a!="string"&&!Array.isArray(a)){for(const l in a)if(l!=="default"&&!(l in t)){const u=Object.getOwnPropertyDescriptor(a,l);u&&Object.defineProperty(t,l,u.get?u:{enumerable:!0,get:()=>a[l]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))a(l);new MutationObserver(l=>{for(const u of l)if(u.type==="childList")for(const p of u.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&a(p)}).observe(document,{childList:!0,subtree:!0});function r(l){const u={};return l.integrity&&(u.integrity=l.integrity),l.referrerPolicy&&(u.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?u.credentials="include":l.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function a(l){if(l.ep)return;l.ep=!0;const u=r(l);fetch(l.href,u)}})();const jTe="modulepreload",MTe=function(t){return"/"+t},$ee={},VN=function(e,r,a){let l=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const p=document.querySelector("meta[property=csp-nonce]"),m=(p==null?void 0:p.nonce)||(p==null?void 0:p.getAttribute("nonce"));l=Promise.allSettled(r.map(v=>{if(v=MTe(v),v in $ee)return;$ee[v]=!0;const w=v.endsWith(".css"),R=w?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${v}"]${R}`))return;const C=document.createElement("link");if(C.rel=w?"stylesheet":jTe,w||(C.as="script"),C.crossOrigin="",C.href=v,m&&C.setAttribute("nonce",m),document.head.appendChild(C),w)return new Promise((A,O)=>{C.addEventListener("load",A),C.addEventListener("error",()=>O(new Error(`Unable to preload CSS for ${v}`)))})}))}function u(p){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=p,window.dispatchEvent(m),!m.defaultPrevented)throw p}return l.then(p=>{for(const m of p||[])m.status==="rejected"&&u(m.reason);return e().catch(u)})};var _f=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function VO(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Cae={exports:{}},FO={},Nae={exports:{}},ti={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var FN=Symbol.for("react.element"),UTe=Symbol.for("react.portal"),VTe=Symbol.for("react.fragment"),FTe=Symbol.for("react.strict_mode"),BTe=Symbol.for("react.profiler"),zTe=Symbol.for("react.provider"),GTe=Symbol.for("react.context"),WTe=Symbol.for("react.forward_ref"),HTe=Symbol.for("react.suspense"),KTe=Symbol.for("react.memo"),qTe=Symbol.for("react.lazy"),Xee=Symbol.iterator;function YTe(t){return t===null||typeof t!="object"?null:(t=Xee&&t[Xee]||t["@@iterator"],typeof t=="function"?t:null)}var Iae={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Aae=Object.assign,kae={};function Nw(t,e,r){this.props=t,this.context=e,this.refs=kae,this.updater=r||Iae}Nw.prototype.isReactComponent={};Nw.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Nw.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Pae(){}Pae.prototype=Nw.prototype;function Xz(t,e,r){this.props=t,this.context=e,this.refs=kae,this.updater=r||Iae}var Jz=Xz.prototype=new Pae;Jz.constructor=Xz;Aae(Jz,Nw.prototype);Jz.isPureReactComponent=!0;var Jee=Array.isArray,Dae=Object.prototype.hasOwnProperty,Qz={current:null},Oae={key:!0,ref:!0,__self:!0,__source:!0};function Lae(t,e,r){var a,l={},u=null,p=null;if(e!=null)for(a in e.ref!==void 0&&(p=e.ref),e.key!==void 0&&(u=""+e.key),e)Dae.call(e,a)&&!Oae.hasOwnProperty(a)&&(l[a]=e[a]);var m=arguments.length-2;if(m===1)l.children=r;else if(1<m){for(var v=Array(m),w=0;w<m;w++)v[w]=arguments[w+2];l.children=v}if(t&&t.defaultProps)for(a in m=t.defaultProps,m)l[a]===void 0&&(l[a]=m[a]);return{$$typeof:FN,type:t,key:u,ref:p,props:l,_owner:Qz.current}}function $Te(t,e){return{$$typeof:FN,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Zz(t){return typeof t=="object"&&t!==null&&t.$$typeof===FN}function XTe(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return e[r]})}var Qee=/\/+/g;function nF(t,e){return typeof t=="object"&&t!==null&&t.key!=null?XTe(""+t.key):e.toString(36)}function q2(t,e,r,a,l){var u=typeof t;(u==="undefined"||u==="boolean")&&(t=null);var p=!1;if(t===null)p=!0;else switch(u){case"string":case"number":p=!0;break;case"object":switch(t.$$typeof){case FN:case UTe:p=!0}}if(p)return p=t,l=l(p),t=a===""?"."+nF(p,0):a,Jee(l)?(r="",t!=null&&(r=t.replace(Qee,"$&/")+"/"),q2(l,e,r,"",function(w){return w})):l!=null&&(Zz(l)&&(l=$Te(l,r+(!l.key||p&&p.key===l.key?"":(""+l.key).replace(Qee,"$&/")+"/")+t)),e.push(l)),1;if(p=0,a=a===""?".":a+":",Jee(t))for(var m=0;m<t.length;m++){u=t[m];var v=a+nF(u,m);p+=q2(u,e,r,v,l)}else if(v=YTe(t),typeof v=="function")for(t=v.call(t),m=0;!(u=t.next()).done;)u=u.value,v=a+nF(u,m++),p+=q2(u,e,r,v,l);else if(u==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return p}function c2(t,e,r){if(t==null)return t;var a=[],l=0;return q2(t,a,"","",function(u){return e.call(r,u,l++)}),a}function JTe(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Dl={current:null},Y2={transition:null},QTe={ReactCurrentDispatcher:Dl,ReactCurrentBatchConfig:Y2,ReactCurrentOwner:Qz};function jae(){throw Error("act(...) is not supported in production builds of React.")}ti.Children={map:c2,forEach:function(t,e,r){c2(t,function(){e.apply(this,arguments)},r)},count:function(t){var e=0;return c2(t,function(){e++}),e},toArray:function(t){return c2(t,function(e){return e})||[]},only:function(t){if(!Zz(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};ti.Component=Nw;ti.Fragment=VTe;ti.Profiler=BTe;ti.PureComponent=Xz;ti.StrictMode=FTe;ti.Suspense=HTe;ti.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=QTe;ti.act=jae;ti.cloneElement=function(t,e,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var a=Aae({},t.props),l=t.key,u=t.ref,p=t._owner;if(e!=null){if(e.ref!==void 0&&(u=e.ref,p=Qz.current),e.key!==void 0&&(l=""+e.key),t.type&&t.type.defaultProps)var m=t.type.defaultProps;for(v in e)Dae.call(e,v)&&!Oae.hasOwnProperty(v)&&(a[v]=e[v]===void 0&&m!==void 0?m[v]:e[v])}var v=arguments.length-2;if(v===1)a.children=r;else if(1<v){m=Array(v);for(var w=0;w<v;w++)m[w]=arguments[w+2];a.children=m}return{$$typeof:FN,type:t.type,key:l,ref:u,props:a,_owner:p}};ti.createContext=function(t){return t={$$typeof:GTe,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:zTe,_context:t},t.Consumer=t};ti.createElement=Lae;ti.createFactory=function(t){var e=Lae.bind(null,t);return e.type=t,e};ti.createRef=function(){return{current:null}};ti.forwardRef=function(t){return{$$typeof:WTe,render:t}};ti.isValidElement=Zz;ti.lazy=function(t){return{$$typeof:qTe,_payload:{_status:-1,_result:t},_init:JTe}};ti.memo=function(t,e){return{$$typeof:KTe,type:t,compare:e===void 0?null:e}};ti.startTransition=function(t){var e=Y2.transition;Y2.transition={};try{t()}finally{Y2.transition=e}};ti.unstable_act=jae;ti.useCallback=function(t,e){return Dl.current.useCallback(t,e)};ti.useContext=function(t){return Dl.current.useContext(t)};ti.useDebugValue=function(){};ti.useDeferredValue=function(t){return Dl.current.useDeferredValue(t)};ti.useEffect=function(t,e){return Dl.current.useEffect(t,e)};ti.useId=function(){return Dl.current.useId()};ti.useImperativeHandle=function(t,e,r){return Dl.current.useImperativeHandle(t,e,r)};ti.useInsertionEffect=function(t,e){return Dl.current.useInsertionEffect(t,e)};ti.useLayoutEffect=function(t,e){return Dl.current.useLayoutEffect(t,e)};ti.useMemo=function(t,e){return Dl.current.useMemo(t,e)};ti.useReducer=function(t,e,r){return Dl.current.useReducer(t,e,r)};ti.useRef=function(t){return Dl.current.useRef(t)};ti.useState=function(t){return Dl.current.useState(t)};ti.useSyncExternalStore=function(t,e,r){return Dl.current.useSyncExternalStore(t,e,r)};ti.useTransition=function(){return Dl.current.useTransition()};ti.version="18.3.1";Nae.exports=ti;var V=Nae.exports;const Yb=VO(V),ZTe=LTe({__proto__:null,default:Yb},[V]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var eRe=V,tRe=Symbol.for("react.element"),nRe=Symbol.for("react.fragment"),rRe=Object.prototype.hasOwnProperty,iRe=eRe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,sRe={key:!0,ref:!0,__self:!0,__source:!0};function Mae(t,e,r){var a,l={},u=null,p=null;r!==void 0&&(u=""+r),e.key!==void 0&&(u=""+e.key),e.ref!==void 0&&(p=e.ref);for(a in e)rRe.call(e,a)&&!sRe.hasOwnProperty(a)&&(l[a]=e[a]);if(t&&t.defaultProps)for(a in e=t.defaultProps,e)l[a]===void 0&&(l[a]=e[a]);return{$$typeof:tRe,type:t,key:u,ref:p,props:l,_owner:iRe.current}}FO.Fragment=nRe;FO.jsx=Mae;FO.jsxs=Mae;Cae.exports=FO;var c=Cae.exports,MB={},Uae={exports:{}},Zd={},Vae={exports:{}},Fae={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(Le,Me){var Ke=Le.length;Le.push(Me);e:for(;0<Ke;){var Rt=Ke-1>>>1,rt=Le[Rt];if(0<l(rt,Me))Le[Rt]=Me,Le[Ke]=rt,Ke=Rt;else break e}}function r(Le){return Le.length===0?null:Le[0]}function a(Le){if(Le.length===0)return null;var Me=Le[0],Ke=Le.pop();if(Ke!==Me){Le[0]=Ke;e:for(var Rt=0,rt=Le.length,mt=rt>>>1;Rt<mt;){var yt=2*(Rt+1)-1,Ct=Le[yt],Ot=yt+1,vt=Le[Ot];if(0>l(Ct,Ke))Ot<rt&&0>l(vt,Ct)?(Le[Rt]=vt,Le[Ot]=Ke,Rt=Ot):(Le[Rt]=Ct,Le[yt]=Ke,Rt=yt);else if(Ot<rt&&0>l(vt,Ke))Le[Rt]=vt,Le[Ot]=Ke,Rt=Ot;else break e}}return Me}function l(Le,Me){var Ke=Le.sortIndex-Me.sortIndex;return Ke!==0?Ke:Le.id-Me.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;t.unstable_now=function(){return u.now()}}else{var p=Date,m=p.now();t.unstable_now=function(){return p.now()-m}}var v=[],w=[],R=1,C=null,A=3,O=!1,U=!1,F=!1,q=typeof setTimeout=="function"?setTimeout:null,W=typeof clearTimeout=="function"?clearTimeout:null,H=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function X(Le){for(var Me=r(w);Me!==null;){if(Me.callback===null)a(w);else if(Me.startTime<=Le)a(w),Me.sortIndex=Me.expirationTime,e(v,Me);else break;Me=r(w)}}function ne(Le){if(F=!1,X(Le),!U)if(r(v)!==null)U=!0,St(te);else{var Me=r(w);Me!==null&&lt(ne,Me.startTime-Le)}}function te(Le,Me){U=!1,F&&(F=!1,W(Q),Q=-1),O=!0;var Ke=A;try{for(X(Me),C=r(v);C!==null&&(!(C.expirationTime>Me)||Le&&!pe());){var Rt=C.callback;if(typeof Rt=="function"){C.callback=null,A=C.priorityLevel;var rt=Rt(C.expirationTime<=Me);Me=t.unstable_now(),typeof rt=="function"?C.callback=rt:C===r(v)&&a(v),X(Me)}else a(v);C=r(v)}if(C!==null)var mt=!0;else{var yt=r(w);yt!==null&&lt(ne,yt.startTime-Me),mt=!1}return mt}finally{C=null,A=Ke,O=!1}}var he=!1,J=null,Q=-1,ce=5,de=-1;function pe(){return!(t.unstable_now()-de<ce)}function be(){if(J!==null){var Le=t.unstable_now();de=Le;var Me=!0;try{Me=J(!0,Le)}finally{Me?ye():(he=!1,J=null)}}else he=!1}var ye;if(typeof H=="function")ye=function(){H(be)};else if(typeof MessageChannel<"u"){var Ze=new MessageChannel,It=Ze.port2;Ze.port1.onmessage=be,ye=function(){It.postMessage(null)}}else ye=function(){q(be,0)};function St(Le){J=Le,he||(he=!0,ye())}function lt(Le,Me){Q=q(function(){Le(t.unstable_now())},Me)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Le){Le.callback=null},t.unstable_continueExecution=function(){U||O||(U=!0,St(te))},t.unstable_forceFrameRate=function(Le){0>Le||125<Le?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ce=0<Le?Math.floor(1e3/Le):5},t.unstable_getCurrentPriorityLevel=function(){return A},t.unstable_getFirstCallbackNode=function(){return r(v)},t.unstable_next=function(Le){switch(A){case 1:case 2:case 3:var Me=3;break;default:Me=A}var Ke=A;A=Me;try{return Le()}finally{A=Ke}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Le,Me){switch(Le){case 1:case 2:case 3:case 4:case 5:break;default:Le=3}var Ke=A;A=Le;try{return Me()}finally{A=Ke}},t.unstable_scheduleCallback=function(Le,Me,Ke){var Rt=t.unstable_now();switch(typeof Ke=="object"&&Ke!==null?(Ke=Ke.delay,Ke=typeof Ke=="number"&&0<Ke?Rt+Ke:Rt):Ke=Rt,Le){case 1:var rt=-1;break;case 2:rt=250;break;case 5:rt=1073741823;break;case 4:rt=1e4;break;default:rt=5e3}return rt=Ke+rt,Le={id:R++,callback:Me,priorityLevel:Le,startTime:Ke,expirationTime:rt,sortIndex:-1},Ke>Rt?(Le.sortIndex=Ke,e(w,Le),r(v)===null&&Le===r(w)&&(F?(W(Q),Q=-1):F=!0,lt(ne,Ke-Rt))):(Le.sortIndex=rt,e(v,Le),U||O||(U=!0,St(te))),Le},t.unstable_shouldYield=pe,t.unstable_wrapCallback=function(Le){var Me=A;return function(){var Ke=A;A=Me;try{return Le.apply(this,arguments)}finally{A=Ke}}}})(Fae);Vae.exports=Fae;var aRe=Vae.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oRe=V,$d=aRe;function Mt(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Bae=new Set,$C={};function Vv(t,e){$b(t,e),$b(t+"Capture",e)}function $b(t,e){for($C[t]=e,t=0;t<e.length;t++)Bae.add(e[t])}var Fm=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),UB=Object.prototype.hasOwnProperty,cRe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Zee={},ete={};function lRe(t){return UB.call(ete,t)?!0:UB.call(Zee,t)?!1:cRe.test(t)?ete[t]=!0:(Zee[t]=!0,!1)}function dRe(t,e,r,a){if(r!==null&&r.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return a?!1:r!==null?!r.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function uRe(t,e,r,a){if(e===null||typeof e>"u"||dRe(t,e,r,a))return!0;if(a)return!1;if(r!==null)switch(r.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ol(t,e,r,a,l,u,p){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=a,this.attributeNamespace=l,this.mustUseProperty=r,this.propertyName=t,this.type=e,this.sanitizeURL=u,this.removeEmptyString=p}var Ic={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ic[t]=new Ol(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ic[e]=new Ol(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ic[t]=new Ol(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ic[t]=new Ol(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ic[t]=new Ol(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ic[t]=new Ol(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ic[t]=new Ol(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ic[t]=new Ol(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ic[t]=new Ol(t,5,!1,t.toLowerCase(),null,!1,!1)});var e8=/[\-:]([a-z])/g;function t8(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(e8,t8);Ic[e]=new Ol(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(e8,t8);Ic[e]=new Ol(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(e8,t8);Ic[e]=new Ol(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ic[t]=new Ol(t,1,!1,t.toLowerCase(),null,!1,!1)});Ic.xlinkHref=new Ol("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ic[t]=new Ol(t,1,!1,t.toLowerCase(),null,!0,!0)});function n8(t,e,r,a){var l=Ic.hasOwnProperty(e)?Ic[e]:null;(l!==null?l.type!==0:a||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(uRe(e,r,l,a)&&(r=null),a||l===null?lRe(e)&&(r===null?t.removeAttribute(e):t.setAttribute(e,""+r)):l.mustUseProperty?t[l.propertyName]=r===null?l.type===3?!1:"":r:(e=l.attributeName,a=l.attributeNamespace,r===null?t.removeAttribute(e):(l=l.type,r=l===3||l===4&&r===!0?"":""+r,a?t.setAttributeNS(a,e,r):t.setAttribute(e,r))))}var Qm=oRe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l2=Symbol.for("react.element"),_b=Symbol.for("react.portal"),yb=Symbol.for("react.fragment"),r8=Symbol.for("react.strict_mode"),VB=Symbol.for("react.profiler"),zae=Symbol.for("react.provider"),Gae=Symbol.for("react.context"),i8=Symbol.for("react.forward_ref"),FB=Symbol.for("react.suspense"),BB=Symbol.for("react.suspense_list"),s8=Symbol.for("react.memo"),g_=Symbol.for("react.lazy"),Wae=Symbol.for("react.offscreen"),tte=Symbol.iterator;function BR(t){return t===null||typeof t!="object"?null:(t=tte&&t[tte]||t["@@iterator"],typeof t=="function"?t:null)}var ga=Object.assign,rF;function aC(t){if(rF===void 0)try{throw Error()}catch(r){var e=r.stack.trim().match(/\n( *(at )?)/);rF=e&&e[1]||""}return`
`+rF+t}var iF=!1;function sF(t,e){if(!t||iF)return"";iF=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(w){var a=w}Reflect.construct(t,[],e)}else{try{e.call()}catch(w){a=w}t.call(e.prototype)}else{try{throw Error()}catch(w){a=w}t()}}catch(w){if(w&&a&&typeof w.stack=="string"){for(var l=w.stack.split(`
`),u=a.stack.split(`
`),p=l.length-1,m=u.length-1;1<=p&&0<=m&&l[p]!==u[m];)m--;for(;1<=p&&0<=m;p--,m--)if(l[p]!==u[m]){if(p!==1||m!==1)do if(p--,m--,0>m||l[p]!==u[m]){var v=`
`+l[p].replace(" at new "," at ");return t.displayName&&v.includes("<anonymous>")&&(v=v.replace("<anonymous>",t.displayName)),v}while(1<=p&&0<=m);break}}}finally{iF=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?aC(t):""}function hRe(t){switch(t.tag){case 5:return aC(t.type);case 16:return aC("Lazy");case 13:return aC("Suspense");case 19:return aC("SuspenseList");case 0:case 2:case 15:return t=sF(t.type,!1),t;case 11:return t=sF(t.type.render,!1),t;case 1:return t=sF(t.type,!0),t;default:return""}}function zB(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case yb:return"Fragment";case _b:return"Portal";case VB:return"Profiler";case r8:return"StrictMode";case FB:return"Suspense";case BB:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Gae:return(t.displayName||"Context")+".Consumer";case zae:return(t._context.displayName||"Context")+".Provider";case i8:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case s8:return e=t.displayName||null,e!==null?e:zB(t.type)||"Memo";case g_:e=t._payload,t=t._init;try{return zB(t(e))}catch{}}return null}function pRe(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return zB(e);case 8:return e===r8?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function $_(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Hae(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function fRe(t){var e=Hae(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),a=""+t[e];if(!t.hasOwnProperty(e)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var l=r.get,u=r.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return l.call(this)},set:function(p){a=""+p,u.call(this,p)}}),Object.defineProperty(t,e,{enumerable:r.enumerable}),{getValue:function(){return a},setValue:function(p){a=""+p},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function d2(t){t._valueTracker||(t._valueTracker=fRe(t))}function Kae(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var r=e.getValue(),a="";return t&&(a=Hae(t)?t.checked?"true":"false":t.value),t=a,t!==r?(e.setValue(t),!0):!1}function SD(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function GB(t,e){var r=e.checked;return ga({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??t._wrapperState.initialChecked})}function nte(t,e){var r=e.defaultValue==null?"":e.defaultValue,a=e.checked!=null?e.checked:e.defaultChecked;r=$_(e.value!=null?e.value:r),t._wrapperState={initialChecked:a,initialValue:r,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function qae(t,e){e=e.checked,e!=null&&n8(t,"checked",e,!1)}function WB(t,e){qae(t,e);var r=$_(e.value),a=e.type;if(r!=null)a==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if(a==="submit"||a==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?HB(t,e.type,r):e.hasOwnProperty("defaultValue")&&HB(t,e.type,$_(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function rte(t,e,r){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var a=e.type;if(!(a!=="submit"&&a!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,r||e===t.value||(t.value=e),t.defaultValue=e}r=t.name,r!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,r!==""&&(t.name=r)}function HB(t,e,r){(e!=="number"||SD(t.ownerDocument)!==t)&&(r==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var oC=Array.isArray;function Db(t,e,r,a){if(t=t.options,e){e={};for(var l=0;l<r.length;l++)e["$"+r[l]]=!0;for(r=0;r<t.length;r++)l=e.hasOwnProperty("$"+t[r].value),t[r].selected!==l&&(t[r].selected=l),l&&a&&(t[r].defaultSelected=!0)}else{for(r=""+$_(r),e=null,l=0;l<t.length;l++){if(t[l].value===r){t[l].selected=!0,a&&(t[l].defaultSelected=!0);return}e!==null||t[l].disabled||(e=t[l])}e!==null&&(e.selected=!0)}}function KB(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Mt(91));return ga({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function ite(t,e){var r=e.value;if(r==null){if(r=e.children,e=e.defaultValue,r!=null){if(e!=null)throw Error(Mt(92));if(oC(r)){if(1<r.length)throw Error(Mt(93));r=r[0]}e=r}e==null&&(e=""),r=e}t._wrapperState={initialValue:$_(r)}}function Yae(t,e){var r=$_(e.value),a=$_(e.defaultValue);r!=null&&(r=""+r,r!==t.value&&(t.value=r),e.defaultValue==null&&t.defaultValue!==r&&(t.defaultValue=r)),a!=null&&(t.defaultValue=""+a)}function ste(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function $ae(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function qB(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?$ae(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var u2,Xae=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,r,a,l){MSApp.execUnsafeLocalFunction(function(){return t(e,r,a,l)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(u2=u2||document.createElement("div"),u2.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=u2.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function XC(t,e){if(e){var r=t.firstChild;if(r&&r===t.lastChild&&r.nodeType===3){r.nodeValue=e;return}}t.textContent=e}var bC={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},mRe=["Webkit","ms","Moz","O"];Object.keys(bC).forEach(function(t){mRe.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),bC[e]=bC[t]})});function Jae(t,e,r){return e==null||typeof e=="boolean"||e===""?"":r||typeof e!="number"||e===0||bC.hasOwnProperty(t)&&bC[t]?(""+e).trim():e+"px"}function Qae(t,e){t=t.style;for(var r in e)if(e.hasOwnProperty(r)){var a=r.indexOf("--")===0,l=Jae(r,e[r],a);r==="float"&&(r="cssFloat"),a?t.setProperty(r,l):t[r]=l}}var gRe=ga({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function YB(t,e){if(e){if(gRe[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Mt(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Mt(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Mt(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Mt(62))}}function $B(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var XB=null;function a8(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var JB=null,Ob=null,Lb=null;function ate(t){if(t=GN(t)){if(typeof JB!="function")throw Error(Mt(280));var e=t.stateNode;e&&(e=HO(e),JB(t.stateNode,t.type,e))}}function Zae(t){Ob?Lb?Lb.push(t):Lb=[t]:Ob=t}function eoe(){if(Ob){var t=Ob,e=Lb;if(Lb=Ob=null,ate(t),e)for(t=0;t<e.length;t++)ate(e[t])}}function toe(t,e){return t(e)}function noe(){}var aF=!1;function roe(t,e,r){if(aF)return t(e,r);aF=!0;try{return toe(t,e,r)}finally{aF=!1,(Ob!==null||Lb!==null)&&(noe(),eoe())}}function JC(t,e){var r=t.stateNode;if(r===null)return null;var a=HO(r);if(a===null)return null;r=a[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(a=!a.disabled)||(t=t.type,a=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!a;break e;default:t=!1}if(t)return null;if(r&&typeof r!="function")throw Error(Mt(231,e,typeof r));return r}var QB=!1;if(Fm)try{var zR={};Object.defineProperty(zR,"passive",{get:function(){QB=!0}}),window.addEventListener("test",zR,zR),window.removeEventListener("test",zR,zR)}catch{QB=!1}function _Re(t,e,r,a,l,u,p,m,v){var w=Array.prototype.slice.call(arguments,3);try{e.apply(r,w)}catch(R){this.onError(R)}}var wC=!1,TD=null,RD=!1,ZB=null,yRe={onError:function(t){wC=!0,TD=t}};function vRe(t,e,r,a,l,u,p,m,v){wC=!1,TD=null,_Re.apply(yRe,arguments)}function ERe(t,e,r,a,l,u,p,m,v){if(vRe.apply(this,arguments),wC){if(wC){var w=TD;wC=!1,TD=null}else throw Error(Mt(198));RD||(RD=!0,ZB=w)}}function Fv(t){var e=t,r=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(r=e.return),t=e.return;while(t)}return e.tag===3?r:null}function ioe(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function ote(t){if(Fv(t)!==t)throw Error(Mt(188))}function xRe(t){var e=t.alternate;if(!e){if(e=Fv(t),e===null)throw Error(Mt(188));return e!==t?null:t}for(var r=t,a=e;;){var l=r.return;if(l===null)break;var u=l.alternate;if(u===null){if(a=l.return,a!==null){r=a;continue}break}if(l.child===u.child){for(u=l.child;u;){if(u===r)return ote(l),t;if(u===a)return ote(l),e;u=u.sibling}throw Error(Mt(188))}if(r.return!==a.return)r=l,a=u;else{for(var p=!1,m=l.child;m;){if(m===r){p=!0,r=l,a=u;break}if(m===a){p=!0,a=l,r=u;break}m=m.sibling}if(!p){for(m=u.child;m;){if(m===r){p=!0,r=u,a=l;break}if(m===a){p=!0,a=u,r=l;break}m=m.sibling}if(!p)throw Error(Mt(189))}}if(r.alternate!==a)throw Error(Mt(190))}if(r.tag!==3)throw Error(Mt(188));return r.stateNode.current===r?t:e}function soe(t){return t=xRe(t),t!==null?aoe(t):null}function aoe(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=aoe(t);if(e!==null)return e;t=t.sibling}return null}var ooe=$d.unstable_scheduleCallback,cte=$d.unstable_cancelCallback,bRe=$d.unstable_shouldYield,wRe=$d.unstable_requestPaint,ja=$d.unstable_now,SRe=$d.unstable_getCurrentPriorityLevel,o8=$d.unstable_ImmediatePriority,coe=$d.unstable_UserBlockingPriority,CD=$d.unstable_NormalPriority,TRe=$d.unstable_LowPriority,loe=$d.unstable_IdlePriority,BO=null,wf=null;function RRe(t){if(wf&&typeof wf.onCommitFiberRoot=="function")try{wf.onCommitFiberRoot(BO,t,void 0,(t.current.flags&128)===128)}catch{}}var rp=Math.clz32?Math.clz32:IRe,CRe=Math.log,NRe=Math.LN2;function IRe(t){return t>>>=0,t===0?32:31-(CRe(t)/NRe|0)|0}var h2=64,p2=4194304;function cC(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function ND(t,e){var r=t.pendingLanes;if(r===0)return 0;var a=0,l=t.suspendedLanes,u=t.pingedLanes,p=r&268435455;if(p!==0){var m=p&~l;m!==0?a=cC(m):(u&=p,u!==0&&(a=cC(u)))}else p=r&~l,p!==0?a=cC(p):u!==0&&(a=cC(u));if(a===0)return 0;if(e!==0&&e!==a&&!(e&l)&&(l=a&-a,u=e&-e,l>=u||l===16&&(u&4194240)!==0))return e;if(a&4&&(a|=r&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=a;0<e;)r=31-rp(e),l=1<<r,a|=t[r],e&=~l;return a}function ARe(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function kRe(t,e){for(var r=t.suspendedLanes,a=t.pingedLanes,l=t.expirationTimes,u=t.pendingLanes;0<u;){var p=31-rp(u),m=1<<p,v=l[p];v===-1?(!(m&r)||m&a)&&(l[p]=ARe(m,e)):v<=e&&(t.expiredLanes|=m),u&=~m}}function e6(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function doe(){var t=h2;return h2<<=1,!(h2&4194240)&&(h2=64),t}function oF(t){for(var e=[],r=0;31>r;r++)e.push(t);return e}function BN(t,e,r){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-rp(e),t[e]=r}function PRe(t,e){var r=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var a=t.eventTimes;for(t=t.expirationTimes;0<r;){var l=31-rp(r),u=1<<l;e[l]=0,a[l]=-1,t[l]=-1,r&=~u}}function c8(t,e){var r=t.entangledLanes|=e;for(t=t.entanglements;r;){var a=31-rp(r),l=1<<a;l&e|t[a]&e&&(t[a]|=e),r&=~l}}var Xi=0;function uoe(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var hoe,l8,poe,foe,moe,t6=!1,f2=[],L_=null,j_=null,M_=null,QC=new Map,ZC=new Map,v_=[],DRe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function lte(t,e){switch(t){case"focusin":case"focusout":L_=null;break;case"dragenter":case"dragleave":j_=null;break;case"mouseover":case"mouseout":M_=null;break;case"pointerover":case"pointerout":QC.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ZC.delete(e.pointerId)}}function GR(t,e,r,a,l,u){return t===null||t.nativeEvent!==u?(t={blockedOn:e,domEventName:r,eventSystemFlags:a,nativeEvent:u,targetContainers:[l]},e!==null&&(e=GN(e),e!==null&&l8(e)),t):(t.eventSystemFlags|=a,e=t.targetContainers,l!==null&&e.indexOf(l)===-1&&e.push(l),t)}function ORe(t,e,r,a,l){switch(e){case"focusin":return L_=GR(L_,t,e,r,a,l),!0;case"dragenter":return j_=GR(j_,t,e,r,a,l),!0;case"mouseover":return M_=GR(M_,t,e,r,a,l),!0;case"pointerover":var u=l.pointerId;return QC.set(u,GR(QC.get(u)||null,t,e,r,a,l)),!0;case"gotpointercapture":return u=l.pointerId,ZC.set(u,GR(ZC.get(u)||null,t,e,r,a,l)),!0}return!1}function goe(t){var e=sv(t.target);if(e!==null){var r=Fv(e);if(r!==null){if(e=r.tag,e===13){if(e=ioe(r),e!==null){t.blockedOn=e,moe(t.priority,function(){poe(r)});return}}else if(e===3&&r.stateNode.current.memoizedState.isDehydrated){t.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}t.blockedOn=null}function $2(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var r=n6(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(r===null){r=t.nativeEvent;var a=new r.constructor(r.type,r);XB=a,r.target.dispatchEvent(a),XB=null}else return e=GN(r),e!==null&&l8(e),t.blockedOn=r,!1;e.shift()}return!0}function dte(t,e,r){$2(t)&&r.delete(e)}function LRe(){t6=!1,L_!==null&&$2(L_)&&(L_=null),j_!==null&&$2(j_)&&(j_=null),M_!==null&&$2(M_)&&(M_=null),QC.forEach(dte),ZC.forEach(dte)}function WR(t,e){t.blockedOn===e&&(t.blockedOn=null,t6||(t6=!0,$d.unstable_scheduleCallback($d.unstable_NormalPriority,LRe)))}function eN(t){function e(l){return WR(l,t)}if(0<f2.length){WR(f2[0],t);for(var r=1;r<f2.length;r++){var a=f2[r];a.blockedOn===t&&(a.blockedOn=null)}}for(L_!==null&&WR(L_,t),j_!==null&&WR(j_,t),M_!==null&&WR(M_,t),QC.forEach(e),ZC.forEach(e),r=0;r<v_.length;r++)a=v_[r],a.blockedOn===t&&(a.blockedOn=null);for(;0<v_.length&&(r=v_[0],r.blockedOn===null);)goe(r),r.blockedOn===null&&v_.shift()}var jb=Qm.ReactCurrentBatchConfig,ID=!0;function jRe(t,e,r,a){var l=Xi,u=jb.transition;jb.transition=null;try{Xi=1,d8(t,e,r,a)}finally{Xi=l,jb.transition=u}}function MRe(t,e,r,a){var l=Xi,u=jb.transition;jb.transition=null;try{Xi=4,d8(t,e,r,a)}finally{Xi=l,jb.transition=u}}function d8(t,e,r,a){if(ID){var l=n6(t,e,r,a);if(l===null)_F(t,e,a,AD,r),lte(t,a);else if(ORe(l,t,e,r,a))a.stopPropagation();else if(lte(t,a),e&4&&-1<DRe.indexOf(t)){for(;l!==null;){var u=GN(l);if(u!==null&&hoe(u),u=n6(t,e,r,a),u===null&&_F(t,e,a,AD,r),u===l)break;l=u}l!==null&&a.stopPropagation()}else _F(t,e,a,null,r)}}var AD=null;function n6(t,e,r,a){if(AD=null,t=a8(a),t=sv(t),t!==null)if(e=Fv(t),e===null)t=null;else if(r=e.tag,r===13){if(t=ioe(e),t!==null)return t;t=null}else if(r===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return AD=t,null}function _oe(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(SRe()){case o8:return 1;case coe:return 4;case CD:case TRe:return 16;case loe:return 536870912;default:return 16}default:return 16}}var C_=null,u8=null,X2=null;function yoe(){if(X2)return X2;var t,e=u8,r=e.length,a,l="value"in C_?C_.value:C_.textContent,u=l.length;for(t=0;t<r&&e[t]===l[t];t++);var p=r-t;for(a=1;a<=p&&e[r-a]===l[u-a];a++);return X2=l.slice(t,1<a?1-a:void 0)}function J2(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function m2(){return!0}function ute(){return!1}function eu(t){function e(r,a,l,u,p){this._reactName=r,this._targetInst=l,this.type=a,this.nativeEvent=u,this.target=p,this.currentTarget=null;for(var m in t)t.hasOwnProperty(m)&&(r=t[m],this[m]=r?r(u):u[m]);return this.isDefaultPrevented=(u.defaultPrevented!=null?u.defaultPrevented:u.returnValue===!1)?m2:ute,this.isPropagationStopped=ute,this}return ga(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=m2)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=m2)},persist:function(){},isPersistent:m2}),e}var Iw={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},h8=eu(Iw),zN=ga({},Iw,{view:0,detail:0}),URe=eu(zN),cF,lF,HR,zO=ga({},zN,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:p8,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==HR&&(HR&&t.type==="mousemove"?(cF=t.screenX-HR.screenX,lF=t.screenY-HR.screenY):lF=cF=0,HR=t),cF)},movementY:function(t){return"movementY"in t?t.movementY:lF}}),hte=eu(zO),VRe=ga({},zO,{dataTransfer:0}),FRe=eu(VRe),BRe=ga({},zN,{relatedTarget:0}),dF=eu(BRe),zRe=ga({},Iw,{animationName:0,elapsedTime:0,pseudoElement:0}),GRe=eu(zRe),WRe=ga({},Iw,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),HRe=eu(WRe),KRe=ga({},Iw,{data:0}),pte=eu(KRe),qRe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},YRe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},$Re={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function XRe(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=$Re[t])?!!e[t]:!1}function p8(){return XRe}var JRe=ga({},zN,{key:function(t){if(t.key){var e=qRe[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=J2(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?YRe[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:p8,charCode:function(t){return t.type==="keypress"?J2(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?J2(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),QRe=eu(JRe),ZRe=ga({},zO,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),fte=eu(ZRe),eCe=ga({},zN,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:p8}),tCe=eu(eCe),nCe=ga({},Iw,{propertyName:0,elapsedTime:0,pseudoElement:0}),rCe=eu(nCe),iCe=ga({},zO,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),sCe=eu(iCe),aCe=[9,13,27,32],f8=Fm&&"CompositionEvent"in window,SC=null;Fm&&"documentMode"in document&&(SC=document.documentMode);var oCe=Fm&&"TextEvent"in window&&!SC,voe=Fm&&(!f8||SC&&8<SC&&11>=SC),mte=" ",gte=!1;function Eoe(t,e){switch(t){case"keyup":return aCe.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function xoe(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var vb=!1;function cCe(t,e){switch(t){case"compositionend":return xoe(e);case"keypress":return e.which!==32?null:(gte=!0,mte);case"textInput":return t=e.data,t===mte&&gte?null:t;default:return null}}function lCe(t,e){if(vb)return t==="compositionend"||!f8&&Eoe(t,e)?(t=yoe(),X2=u8=C_=null,vb=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return voe&&e.locale!=="ko"?null:e.data;default:return null}}var dCe={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function _te(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!dCe[t.type]:e==="textarea"}function boe(t,e,r,a){Zae(a),e=kD(e,"onChange"),0<e.length&&(r=new h8("onChange","change",null,r,a),t.push({event:r,listeners:e}))}var TC=null,tN=null;function uCe(t){Doe(t,0)}function GO(t){var e=bb(t);if(Kae(e))return t}function hCe(t,e){if(t==="change")return e}var woe=!1;if(Fm){var uF;if(Fm){var hF="oninput"in document;if(!hF){var yte=document.createElement("div");yte.setAttribute("oninput","return;"),hF=typeof yte.oninput=="function"}uF=hF}else uF=!1;woe=uF&&(!document.documentMode||9<document.documentMode)}function vte(){TC&&(TC.detachEvent("onpropertychange",Soe),tN=TC=null)}function Soe(t){if(t.propertyName==="value"&&GO(tN)){var e=[];boe(e,tN,t,a8(t)),roe(uCe,e)}}function pCe(t,e,r){t==="focusin"?(vte(),TC=e,tN=r,TC.attachEvent("onpropertychange",Soe)):t==="focusout"&&vte()}function fCe(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return GO(tN)}function mCe(t,e){if(t==="click")return GO(e)}function gCe(t,e){if(t==="input"||t==="change")return GO(e)}function _Ce(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var cp=typeof Object.is=="function"?Object.is:_Ce;function nN(t,e){if(cp(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var r=Object.keys(t),a=Object.keys(e);if(r.length!==a.length)return!1;for(a=0;a<r.length;a++){var l=r[a];if(!UB.call(e,l)||!cp(t[l],e[l]))return!1}return!0}function Ete(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function xte(t,e){var r=Ete(t);t=0;for(var a;r;){if(r.nodeType===3){if(a=t+r.textContent.length,t<=e&&a>=e)return{node:r,offset:e-t};t=a}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Ete(r)}}function Toe(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Toe(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Roe(){for(var t=window,e=SD();e instanceof t.HTMLIFrameElement;){try{var r=typeof e.contentWindow.location.href=="string"}catch{r=!1}if(r)t=e.contentWindow;else break;e=SD(t.document)}return e}function m8(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function yCe(t){var e=Roe(),r=t.focusedElem,a=t.selectionRange;if(e!==r&&r&&r.ownerDocument&&Toe(r.ownerDocument.documentElement,r)){if(a!==null&&m8(r)){if(e=a.start,t=a.end,t===void 0&&(t=e),"selectionStart"in r)r.selectionStart=e,r.selectionEnd=Math.min(t,r.value.length);else if(t=(e=r.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var l=r.textContent.length,u=Math.min(a.start,l);a=a.end===void 0?u:Math.min(a.end,l),!t.extend&&u>a&&(l=a,a=u,u=l),l=xte(r,u);var p=xte(r,a);l&&p&&(t.rangeCount!==1||t.anchorNode!==l.node||t.anchorOffset!==l.offset||t.focusNode!==p.node||t.focusOffset!==p.offset)&&(e=e.createRange(),e.setStart(l.node,l.offset),t.removeAllRanges(),u>a?(t.addRange(e),t.extend(p.node,p.offset)):(e.setEnd(p.node,p.offset),t.addRange(e)))}}for(e=[],t=r;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<e.length;r++)t=e[r],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var vCe=Fm&&"documentMode"in document&&11>=document.documentMode,Eb=null,r6=null,RC=null,i6=!1;function bte(t,e,r){var a=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;i6||Eb==null||Eb!==SD(a)||(a=Eb,"selectionStart"in a&&m8(a)?a={start:a.selectionStart,end:a.selectionEnd}:(a=(a.ownerDocument&&a.ownerDocument.defaultView||window).getSelection(),a={anchorNode:a.anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset}),RC&&nN(RC,a)||(RC=a,a=kD(r6,"onSelect"),0<a.length&&(e=new h8("onSelect","select",null,e,r),t.push({event:e,listeners:a}),e.target=Eb)))}function g2(t,e){var r={};return r[t.toLowerCase()]=e.toLowerCase(),r["Webkit"+t]="webkit"+e,r["Moz"+t]="moz"+e,r}var xb={animationend:g2("Animation","AnimationEnd"),animationiteration:g2("Animation","AnimationIteration"),animationstart:g2("Animation","AnimationStart"),transitionend:g2("Transition","TransitionEnd")},pF={},Coe={};Fm&&(Coe=document.createElement("div").style,"AnimationEvent"in window||(delete xb.animationend.animation,delete xb.animationiteration.animation,delete xb.animationstart.animation),"TransitionEvent"in window||delete xb.transitionend.transition);function WO(t){if(pF[t])return pF[t];if(!xb[t])return t;var e=xb[t],r;for(r in e)if(e.hasOwnProperty(r)&&r in Coe)return pF[t]=e[r];return t}var Noe=WO("animationend"),Ioe=WO("animationiteration"),Aoe=WO("animationstart"),koe=WO("transitionend"),Poe=new Map,wte="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function d0(t,e){Poe.set(t,e),Vv(e,[t])}for(var fF=0;fF<wte.length;fF++){var mF=wte[fF],ECe=mF.toLowerCase(),xCe=mF[0].toUpperCase()+mF.slice(1);d0(ECe,"on"+xCe)}d0(Noe,"onAnimationEnd");d0(Ioe,"onAnimationIteration");d0(Aoe,"onAnimationStart");d0("dblclick","onDoubleClick");d0("focusin","onFocus");d0("focusout","onBlur");d0(koe,"onTransitionEnd");$b("onMouseEnter",["mouseout","mouseover"]);$b("onMouseLeave",["mouseout","mouseover"]);$b("onPointerEnter",["pointerout","pointerover"]);$b("onPointerLeave",["pointerout","pointerover"]);Vv("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Vv("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Vv("onBeforeInput",["compositionend","keypress","textInput","paste"]);Vv("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Vv("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Vv("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lC="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),bCe=new Set("cancel close invalid load scroll toggle".split(" ").concat(lC));function Ste(t,e,r){var a=t.type||"unknown-event";t.currentTarget=r,ERe(a,e,void 0,t),t.currentTarget=null}function Doe(t,e){e=(e&4)!==0;for(var r=0;r<t.length;r++){var a=t[r],l=a.event;a=a.listeners;e:{var u=void 0;if(e)for(var p=a.length-1;0<=p;p--){var m=a[p],v=m.instance,w=m.currentTarget;if(m=m.listener,v!==u&&l.isPropagationStopped())break e;Ste(l,m,w),u=v}else for(p=0;p<a.length;p++){if(m=a[p],v=m.instance,w=m.currentTarget,m=m.listener,v!==u&&l.isPropagationStopped())break e;Ste(l,m,w),u=v}}}if(RD)throw t=ZB,RD=!1,ZB=null,t}function Ls(t,e){var r=e[l6];r===void 0&&(r=e[l6]=new Set);var a=t+"__bubble";r.has(a)||(Ooe(e,t,2,!1),r.add(a))}function gF(t,e,r){var a=0;e&&(a|=4),Ooe(r,t,a,e)}var _2="_reactListening"+Math.random().toString(36).slice(2);function rN(t){if(!t[_2]){t[_2]=!0,Bae.forEach(function(r){r!=="selectionchange"&&(bCe.has(r)||gF(r,!1,t),gF(r,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[_2]||(e[_2]=!0,gF("selectionchange",!1,e))}}function Ooe(t,e,r,a){switch(_oe(e)){case 1:var l=jRe;break;case 4:l=MRe;break;default:l=d8}r=l.bind(null,e,r,t),l=void 0,!QB||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(l=!0),a?l!==void 0?t.addEventListener(e,r,{capture:!0,passive:l}):t.addEventListener(e,r,!0):l!==void 0?t.addEventListener(e,r,{passive:l}):t.addEventListener(e,r,!1)}function _F(t,e,r,a,l){var u=a;if(!(e&1)&&!(e&2)&&a!==null)e:for(;;){if(a===null)return;var p=a.tag;if(p===3||p===4){var m=a.stateNode.containerInfo;if(m===l||m.nodeType===8&&m.parentNode===l)break;if(p===4)for(p=a.return;p!==null;){var v=p.tag;if((v===3||v===4)&&(v=p.stateNode.containerInfo,v===l||v.nodeType===8&&v.parentNode===l))return;p=p.return}for(;m!==null;){if(p=sv(m),p===null)return;if(v=p.tag,v===5||v===6){a=u=p;continue e}m=m.parentNode}}a=a.return}roe(function(){var w=u,R=a8(r),C=[];e:{var A=Poe.get(t);if(A!==void 0){var O=h8,U=t;switch(t){case"keypress":if(J2(r)===0)break e;case"keydown":case"keyup":O=QRe;break;case"focusin":U="focus",O=dF;break;case"focusout":U="blur",O=dF;break;case"beforeblur":case"afterblur":O=dF;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":O=hte;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":O=FRe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":O=tCe;break;case Noe:case Ioe:case Aoe:O=GRe;break;case koe:O=rCe;break;case"scroll":O=URe;break;case"wheel":O=sCe;break;case"copy":case"cut":case"paste":O=HRe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":O=fte}var F=(e&4)!==0,q=!F&&t==="scroll",W=F?A!==null?A+"Capture":null:A;F=[];for(var H=w,X;H!==null;){X=H;var ne=X.stateNode;if(X.tag===5&&ne!==null&&(X=ne,W!==null&&(ne=JC(H,W),ne!=null&&F.push(iN(H,ne,X)))),q)break;H=H.return}0<F.length&&(A=new O(A,U,null,r,R),C.push({event:A,listeners:F}))}}if(!(e&7)){e:{if(A=t==="mouseover"||t==="pointerover",O=t==="mouseout"||t==="pointerout",A&&r!==XB&&(U=r.relatedTarget||r.fromElement)&&(sv(U)||U[Bm]))break e;if((O||A)&&(A=R.window===R?R:(A=R.ownerDocument)?A.defaultView||A.parentWindow:window,O?(U=r.relatedTarget||r.toElement,O=w,U=U?sv(U):null,U!==null&&(q=Fv(U),U!==q||U.tag!==5&&U.tag!==6)&&(U=null)):(O=null,U=w),O!==U)){if(F=hte,ne="onMouseLeave",W="onMouseEnter",H="mouse",(t==="pointerout"||t==="pointerover")&&(F=fte,ne="onPointerLeave",W="onPointerEnter",H="pointer"),q=O==null?A:bb(O),X=U==null?A:bb(U),A=new F(ne,H+"leave",O,r,R),A.target=q,A.relatedTarget=X,ne=null,sv(R)===w&&(F=new F(W,H+"enter",U,r,R),F.target=X,F.relatedTarget=q,ne=F),q=ne,O&&U)t:{for(F=O,W=U,H=0,X=F;X;X=eb(X))H++;for(X=0,ne=W;ne;ne=eb(ne))X++;for(;0<H-X;)F=eb(F),H--;for(;0<X-H;)W=eb(W),X--;for(;H--;){if(F===W||W!==null&&F===W.alternate)break t;F=eb(F),W=eb(W)}F=null}else F=null;O!==null&&Tte(C,A,O,F,!1),U!==null&&q!==null&&Tte(C,q,U,F,!0)}}e:{if(A=w?bb(w):window,O=A.nodeName&&A.nodeName.toLowerCase(),O==="select"||O==="input"&&A.type==="file")var te=hCe;else if(_te(A))if(woe)te=gCe;else{te=fCe;var he=pCe}else(O=A.nodeName)&&O.toLowerCase()==="input"&&(A.type==="checkbox"||A.type==="radio")&&(te=mCe);if(te&&(te=te(t,w))){boe(C,te,r,R);break e}he&&he(t,A,w),t==="focusout"&&(he=A._wrapperState)&&he.controlled&&A.type==="number"&&HB(A,"number",A.value)}switch(he=w?bb(w):window,t){case"focusin":(_te(he)||he.contentEditable==="true")&&(Eb=he,r6=w,RC=null);break;case"focusout":RC=r6=Eb=null;break;case"mousedown":i6=!0;break;case"contextmenu":case"mouseup":case"dragend":i6=!1,bte(C,r,R);break;case"selectionchange":if(vCe)break;case"keydown":case"keyup":bte(C,r,R)}var J;if(f8)e:{switch(t){case"compositionstart":var Q="onCompositionStart";break e;case"compositionend":Q="onCompositionEnd";break e;case"compositionupdate":Q="onCompositionUpdate";break e}Q=void 0}else vb?Eoe(t,r)&&(Q="onCompositionEnd"):t==="keydown"&&r.keyCode===229&&(Q="onCompositionStart");Q&&(voe&&r.locale!=="ko"&&(vb||Q!=="onCompositionStart"?Q==="onCompositionEnd"&&vb&&(J=yoe()):(C_=R,u8="value"in C_?C_.value:C_.textContent,vb=!0)),he=kD(w,Q),0<he.length&&(Q=new pte(Q,t,null,r,R),C.push({event:Q,listeners:he}),J?Q.data=J:(J=xoe(r),J!==null&&(Q.data=J)))),(J=oCe?cCe(t,r):lCe(t,r))&&(w=kD(w,"onBeforeInput"),0<w.length&&(R=new pte("onBeforeInput","beforeinput",null,r,R),C.push({event:R,listeners:w}),R.data=J))}Doe(C,e)})}function iN(t,e,r){return{instance:t,listener:e,currentTarget:r}}function kD(t,e){for(var r=e+"Capture",a=[];t!==null;){var l=t,u=l.stateNode;l.tag===5&&u!==null&&(l=u,u=JC(t,r),u!=null&&a.unshift(iN(t,u,l)),u=JC(t,e),u!=null&&a.push(iN(t,u,l))),t=t.return}return a}function eb(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Tte(t,e,r,a,l){for(var u=e._reactName,p=[];r!==null&&r!==a;){var m=r,v=m.alternate,w=m.stateNode;if(v!==null&&v===a)break;m.tag===5&&w!==null&&(m=w,l?(v=JC(r,u),v!=null&&p.unshift(iN(r,v,m))):l||(v=JC(r,u),v!=null&&p.push(iN(r,v,m)))),r=r.return}p.length!==0&&t.push({event:e,listeners:p})}var wCe=/\r\n?/g,SCe=/\u0000|\uFFFD/g;function Rte(t){return(typeof t=="string"?t:""+t).replace(wCe,`
`).replace(SCe,"")}function y2(t,e,r){if(e=Rte(e),Rte(t)!==e&&r)throw Error(Mt(425))}function PD(){}var s6=null,a6=null;function o6(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var c6=typeof setTimeout=="function"?setTimeout:void 0,TCe=typeof clearTimeout=="function"?clearTimeout:void 0,Cte=typeof Promise=="function"?Promise:void 0,RCe=typeof queueMicrotask=="function"?queueMicrotask:typeof Cte<"u"?function(t){return Cte.resolve(null).then(t).catch(CCe)}:c6;function CCe(t){setTimeout(function(){throw t})}function yF(t,e){var r=e,a=0;do{var l=r.nextSibling;if(t.removeChild(r),l&&l.nodeType===8)if(r=l.data,r==="/$"){if(a===0){t.removeChild(l),eN(e);return}a--}else r!=="$"&&r!=="$?"&&r!=="$!"||a++;r=l}while(r);eN(e)}function U_(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Nte(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="$"||r==="$!"||r==="$?"){if(e===0)return t;e--}else r==="/$"&&e++}t=t.previousSibling}return null}var Aw=Math.random().toString(36).slice(2),yf="__reactFiber$"+Aw,sN="__reactProps$"+Aw,Bm="__reactContainer$"+Aw,l6="__reactEvents$"+Aw,NCe="__reactListeners$"+Aw,ICe="__reactHandles$"+Aw;function sv(t){var e=t[yf];if(e)return e;for(var r=t.parentNode;r;){if(e=r[Bm]||r[yf]){if(r=e.alternate,e.child!==null||r!==null&&r.child!==null)for(t=Nte(t);t!==null;){if(r=t[yf])return r;t=Nte(t)}return e}t=r,r=t.parentNode}return null}function GN(t){return t=t[yf]||t[Bm],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function bb(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Mt(33))}function HO(t){return t[sN]||null}var d6=[],wb=-1;function u0(t){return{current:t}}function Us(t){0>wb||(t.current=d6[wb],d6[wb]=null,wb--)}function Ts(t,e){wb++,d6[wb]=t.current,t.current=e}var X_={},al=u0(X_),ud=u0(!1),vv=X_;function Xb(t,e){var r=t.type.contextTypes;if(!r)return X_;var a=t.stateNode;if(a&&a.__reactInternalMemoizedUnmaskedChildContext===e)return a.__reactInternalMemoizedMaskedChildContext;var l={},u;for(u in r)l[u]=e[u];return a&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=l),l}function hd(t){return t=t.childContextTypes,t!=null}function DD(){Us(ud),Us(al)}function Ite(t,e,r){if(al.current!==X_)throw Error(Mt(168));Ts(al,e),Ts(ud,r)}function Loe(t,e,r){var a=t.stateNode;if(e=e.childContextTypes,typeof a.getChildContext!="function")return r;a=a.getChildContext();for(var l in a)if(!(l in e))throw Error(Mt(108,pRe(t)||"Unknown",l));return ga({},r,a)}function OD(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||X_,vv=al.current,Ts(al,t),Ts(ud,ud.current),!0}function Ate(t,e,r){var a=t.stateNode;if(!a)throw Error(Mt(169));r?(t=Loe(t,e,vv),a.__reactInternalMemoizedMergedChildContext=t,Us(ud),Us(al),Ts(al,t)):Us(ud),Ts(ud,r)}var wm=null,KO=!1,vF=!1;function joe(t){wm===null?wm=[t]:wm.push(t)}function ACe(t){KO=!0,joe(t)}function h0(){if(!vF&&wm!==null){vF=!0;var t=0,e=Xi;try{var r=wm;for(Xi=1;t<r.length;t++){var a=r[t];do a=a(!0);while(a!==null)}wm=null,KO=!1}catch(l){throw wm!==null&&(wm=wm.slice(t+1)),ooe(o8,h0),l}finally{Xi=e,vF=!1}}return null}var Sb=[],Tb=0,LD=null,jD=0,Yu=[],$u=0,Ev=null,Nm=1,Im="";function Yy(t,e){Sb[Tb++]=jD,Sb[Tb++]=LD,LD=t,jD=e}function Moe(t,e,r){Yu[$u++]=Nm,Yu[$u++]=Im,Yu[$u++]=Ev,Ev=t;var a=Nm;t=Im;var l=32-rp(a)-1;a&=~(1<<l),r+=1;var u=32-rp(e)+l;if(30<u){var p=l-l%5;u=(a&(1<<p)-1).toString(32),a>>=p,l-=p,Nm=1<<32-rp(e)+l|r<<l|a,Im=u+t}else Nm=1<<u|r<<l|a,Im=t}function g8(t){t.return!==null&&(Yy(t,1),Moe(t,1,0))}function _8(t){for(;t===LD;)LD=Sb[--Tb],Sb[Tb]=null,jD=Sb[--Tb],Sb[Tb]=null;for(;t===Ev;)Ev=Yu[--$u],Yu[$u]=null,Im=Yu[--$u],Yu[$u]=null,Nm=Yu[--$u],Yu[$u]=null}var qd=null,Hd=null,ea=!1,np=null;function Uoe(t,e){var r=Xu(5,null,null,0);r.elementType="DELETED",r.stateNode=e,r.return=t,e=t.deletions,e===null?(t.deletions=[r],t.flags|=16):e.push(r)}function kte(t,e){switch(t.tag){case 5:var r=t.type;return e=e.nodeType!==1||r.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,qd=t,Hd=U_(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,qd=t,Hd=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(r=Ev!==null?{id:Nm,overflow:Im}:null,t.memoizedState={dehydrated:e,treeContext:r,retryLane:1073741824},r=Xu(18,null,null,0),r.stateNode=e,r.return=t,t.child=r,qd=t,Hd=null,!0):!1;default:return!1}}function u6(t){return(t.mode&1)!==0&&(t.flags&128)===0}function h6(t){if(ea){var e=Hd;if(e){var r=e;if(!kte(t,e)){if(u6(t))throw Error(Mt(418));e=U_(r.nextSibling);var a=qd;e&&kte(t,e)?Uoe(a,r):(t.flags=t.flags&-4097|2,ea=!1,qd=t)}}else{if(u6(t))throw Error(Mt(418));t.flags=t.flags&-4097|2,ea=!1,qd=t}}}function Pte(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;qd=t}function v2(t){if(t!==qd)return!1;if(!ea)return Pte(t),ea=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!o6(t.type,t.memoizedProps)),e&&(e=Hd)){if(u6(t))throw Voe(),Error(Mt(418));for(;e;)Uoe(t,e),e=U_(e.nextSibling)}if(Pte(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Mt(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="/$"){if(e===0){Hd=U_(t.nextSibling);break e}e--}else r!=="$"&&r!=="$!"&&r!=="$?"||e++}t=t.nextSibling}Hd=null}}else Hd=qd?U_(t.stateNode.nextSibling):null;return!0}function Voe(){for(var t=Hd;t;)t=U_(t.nextSibling)}function Jb(){Hd=qd=null,ea=!1}function y8(t){np===null?np=[t]:np.push(t)}var kCe=Qm.ReactCurrentBatchConfig;function KR(t,e,r){if(t=r.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Mt(309));var a=r.stateNode}if(!a)throw Error(Mt(147,t));var l=a,u=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===u?e.ref:(e=function(p){var m=l.refs;p===null?delete m[u]:m[u]=p},e._stringRef=u,e)}if(typeof t!="string")throw Error(Mt(284));if(!r._owner)throw Error(Mt(290,t))}return t}function E2(t,e){throw t=Object.prototype.toString.call(e),Error(Mt(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Dte(t){var e=t._init;return e(t._payload)}function Foe(t){function e(W,H){if(t){var X=W.deletions;X===null?(W.deletions=[H],W.flags|=16):X.push(H)}}function r(W,H){if(!t)return null;for(;H!==null;)e(W,H),H=H.sibling;return null}function a(W,H){for(W=new Map;H!==null;)H.key!==null?W.set(H.key,H):W.set(H.index,H),H=H.sibling;return W}function l(W,H){return W=z_(W,H),W.index=0,W.sibling=null,W}function u(W,H,X){return W.index=X,t?(X=W.alternate,X!==null?(X=X.index,X<H?(W.flags|=2,H):X):(W.flags|=2,H)):(W.flags|=1048576,H)}function p(W){return t&&W.alternate===null&&(W.flags|=2),W}function m(W,H,X,ne){return H===null||H.tag!==6?(H=RF(X,W.mode,ne),H.return=W,H):(H=l(H,X),H.return=W,H)}function v(W,H,X,ne){var te=X.type;return te===yb?R(W,H,X.props.children,ne,X.key):H!==null&&(H.elementType===te||typeof te=="object"&&te!==null&&te.$$typeof===g_&&Dte(te)===H.type)?(ne=l(H,X.props),ne.ref=KR(W,H,X),ne.return=W,ne):(ne=iD(X.type,X.key,X.props,null,W.mode,ne),ne.ref=KR(W,H,X),ne.return=W,ne)}function w(W,H,X,ne){return H===null||H.tag!==4||H.stateNode.containerInfo!==X.containerInfo||H.stateNode.implementation!==X.implementation?(H=CF(X,W.mode,ne),H.return=W,H):(H=l(H,X.children||[]),H.return=W,H)}function R(W,H,X,ne,te){return H===null||H.tag!==7?(H=hv(X,W.mode,ne,te),H.return=W,H):(H=l(H,X),H.return=W,H)}function C(W,H,X){if(typeof H=="string"&&H!==""||typeof H=="number")return H=RF(""+H,W.mode,X),H.return=W,H;if(typeof H=="object"&&H!==null){switch(H.$$typeof){case l2:return X=iD(H.type,H.key,H.props,null,W.mode,X),X.ref=KR(W,null,H),X.return=W,X;case _b:return H=CF(H,W.mode,X),H.return=W,H;case g_:var ne=H._init;return C(W,ne(H._payload),X)}if(oC(H)||BR(H))return H=hv(H,W.mode,X,null),H.return=W,H;E2(W,H)}return null}function A(W,H,X,ne){var te=H!==null?H.key:null;if(typeof X=="string"&&X!==""||typeof X=="number")return te!==null?null:m(W,H,""+X,ne);if(typeof X=="object"&&X!==null){switch(X.$$typeof){case l2:return X.key===te?v(W,H,X,ne):null;case _b:return X.key===te?w(W,H,X,ne):null;case g_:return te=X._init,A(W,H,te(X._payload),ne)}if(oC(X)||BR(X))return te!==null?null:R(W,H,X,ne,null);E2(W,X)}return null}function O(W,H,X,ne,te){if(typeof ne=="string"&&ne!==""||typeof ne=="number")return W=W.get(X)||null,m(H,W,""+ne,te);if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case l2:return W=W.get(ne.key===null?X:ne.key)||null,v(H,W,ne,te);case _b:return W=W.get(ne.key===null?X:ne.key)||null,w(H,W,ne,te);case g_:var he=ne._init;return O(W,H,X,he(ne._payload),te)}if(oC(ne)||BR(ne))return W=W.get(X)||null,R(H,W,ne,te,null);E2(H,ne)}return null}function U(W,H,X,ne){for(var te=null,he=null,J=H,Q=H=0,ce=null;J!==null&&Q<X.length;Q++){J.index>Q?(ce=J,J=null):ce=J.sibling;var de=A(W,J,X[Q],ne);if(de===null){J===null&&(J=ce);break}t&&J&&de.alternate===null&&e(W,J),H=u(de,H,Q),he===null?te=de:he.sibling=de,he=de,J=ce}if(Q===X.length)return r(W,J),ea&&Yy(W,Q),te;if(J===null){for(;Q<X.length;Q++)J=C(W,X[Q],ne),J!==null&&(H=u(J,H,Q),he===null?te=J:he.sibling=J,he=J);return ea&&Yy(W,Q),te}for(J=a(W,J);Q<X.length;Q++)ce=O(J,W,Q,X[Q],ne),ce!==null&&(t&&ce.alternate!==null&&J.delete(ce.key===null?Q:ce.key),H=u(ce,H,Q),he===null?te=ce:he.sibling=ce,he=ce);return t&&J.forEach(function(pe){return e(W,pe)}),ea&&Yy(W,Q),te}function F(W,H,X,ne){var te=BR(X);if(typeof te!="function")throw Error(Mt(150));if(X=te.call(X),X==null)throw Error(Mt(151));for(var he=te=null,J=H,Q=H=0,ce=null,de=X.next();J!==null&&!de.done;Q++,de=X.next()){J.index>Q?(ce=J,J=null):ce=J.sibling;var pe=A(W,J,de.value,ne);if(pe===null){J===null&&(J=ce);break}t&&J&&pe.alternate===null&&e(W,J),H=u(pe,H,Q),he===null?te=pe:he.sibling=pe,he=pe,J=ce}if(de.done)return r(W,J),ea&&Yy(W,Q),te;if(J===null){for(;!de.done;Q++,de=X.next())de=C(W,de.value,ne),de!==null&&(H=u(de,H,Q),he===null?te=de:he.sibling=de,he=de);return ea&&Yy(W,Q),te}for(J=a(W,J);!de.done;Q++,de=X.next())de=O(J,W,Q,de.value,ne),de!==null&&(t&&de.alternate!==null&&J.delete(de.key===null?Q:de.key),H=u(de,H,Q),he===null?te=de:he.sibling=de,he=de);return t&&J.forEach(function(be){return e(W,be)}),ea&&Yy(W,Q),te}function q(W,H,X,ne){if(typeof X=="object"&&X!==null&&X.type===yb&&X.key===null&&(X=X.props.children),typeof X=="object"&&X!==null){switch(X.$$typeof){case l2:e:{for(var te=X.key,he=H;he!==null;){if(he.key===te){if(te=X.type,te===yb){if(he.tag===7){r(W,he.sibling),H=l(he,X.props.children),H.return=W,W=H;break e}}else if(he.elementType===te||typeof te=="object"&&te!==null&&te.$$typeof===g_&&Dte(te)===he.type){r(W,he.sibling),H=l(he,X.props),H.ref=KR(W,he,X),H.return=W,W=H;break e}r(W,he);break}else e(W,he);he=he.sibling}X.type===yb?(H=hv(X.props.children,W.mode,ne,X.key),H.return=W,W=H):(ne=iD(X.type,X.key,X.props,null,W.mode,ne),ne.ref=KR(W,H,X),ne.return=W,W=ne)}return p(W);case _b:e:{for(he=X.key;H!==null;){if(H.key===he)if(H.tag===4&&H.stateNode.containerInfo===X.containerInfo&&H.stateNode.implementation===X.implementation){r(W,H.sibling),H=l(H,X.children||[]),H.return=W,W=H;break e}else{r(W,H);break}else e(W,H);H=H.sibling}H=CF(X,W.mode,ne),H.return=W,W=H}return p(W);case g_:return he=X._init,q(W,H,he(X._payload),ne)}if(oC(X))return U(W,H,X,ne);if(BR(X))return F(W,H,X,ne);E2(W,X)}return typeof X=="string"&&X!==""||typeof X=="number"?(X=""+X,H!==null&&H.tag===6?(r(W,H.sibling),H=l(H,X),H.return=W,W=H):(r(W,H),H=RF(X,W.mode,ne),H.return=W,W=H),p(W)):r(W,H)}return q}var Qb=Foe(!0),Boe=Foe(!1),MD=u0(null),UD=null,Rb=null,v8=null;function E8(){v8=Rb=UD=null}function x8(t){var e=MD.current;Us(MD),t._currentValue=e}function p6(t,e,r){for(;t!==null;){var a=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,a!==null&&(a.childLanes|=e)):a!==null&&(a.childLanes&e)!==e&&(a.childLanes|=e),t===r)break;t=t.return}}function Mb(t,e){UD=t,v8=Rb=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(ad=!0),t.firstContext=null)}function th(t){var e=t._currentValue;if(v8!==t)if(t={context:t,memoizedValue:e,next:null},Rb===null){if(UD===null)throw Error(Mt(308));Rb=t,UD.dependencies={lanes:0,firstContext:t}}else Rb=Rb.next=t;return e}var av=null;function b8(t){av===null?av=[t]:av.push(t)}function zoe(t,e,r,a){var l=e.interleaved;return l===null?(r.next=r,b8(e)):(r.next=l.next,l.next=r),e.interleaved=r,zm(t,a)}function zm(t,e){t.lanes|=e;var r=t.alternate;for(r!==null&&(r.lanes|=e),r=t,t=t.return;t!==null;)t.childLanes|=e,r=t.alternate,r!==null&&(r.childLanes|=e),r=t,t=t.return;return r.tag===3?r.stateNode:null}var __=!1;function w8(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Goe(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function jm(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function V_(t,e,r){var a=t.updateQueue;if(a===null)return null;if(a=a.shared,Ti&2){var l=a.pending;return l===null?e.next=e:(e.next=l.next,l.next=e),a.pending=e,zm(t,r)}return l=a.interleaved,l===null?(e.next=e,b8(a)):(e.next=l.next,l.next=e),a.interleaved=e,zm(t,r)}function Q2(t,e,r){if(e=e.updateQueue,e!==null&&(e=e.shared,(r&4194240)!==0)){var a=e.lanes;a&=t.pendingLanes,r|=a,e.lanes=r,c8(t,r)}}function Ote(t,e){var r=t.updateQueue,a=t.alternate;if(a!==null&&(a=a.updateQueue,r===a)){var l=null,u=null;if(r=r.firstBaseUpdate,r!==null){do{var p={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};u===null?l=u=p:u=u.next=p,r=r.next}while(r!==null);u===null?l=u=e:u=u.next=e}else l=u=e;r={baseState:a.baseState,firstBaseUpdate:l,lastBaseUpdate:u,shared:a.shared,effects:a.effects},t.updateQueue=r;return}t=r.lastBaseUpdate,t===null?r.firstBaseUpdate=e:t.next=e,r.lastBaseUpdate=e}function VD(t,e,r,a){var l=t.updateQueue;__=!1;var u=l.firstBaseUpdate,p=l.lastBaseUpdate,m=l.shared.pending;if(m!==null){l.shared.pending=null;var v=m,w=v.next;v.next=null,p===null?u=w:p.next=w,p=v;var R=t.alternate;R!==null&&(R=R.updateQueue,m=R.lastBaseUpdate,m!==p&&(m===null?R.firstBaseUpdate=w:m.next=w,R.lastBaseUpdate=v))}if(u!==null){var C=l.baseState;p=0,R=w=v=null,m=u;do{var A=m.lane,O=m.eventTime;if((a&A)===A){R!==null&&(R=R.next={eventTime:O,lane:0,tag:m.tag,payload:m.payload,callback:m.callback,next:null});e:{var U=t,F=m;switch(A=e,O=r,F.tag){case 1:if(U=F.payload,typeof U=="function"){C=U.call(O,C,A);break e}C=U;break e;case 3:U.flags=U.flags&-65537|128;case 0:if(U=F.payload,A=typeof U=="function"?U.call(O,C,A):U,A==null)break e;C=ga({},C,A);break e;case 2:__=!0}}m.callback!==null&&m.lane!==0&&(t.flags|=64,A=l.effects,A===null?l.effects=[m]:A.push(m))}else O={eventTime:O,lane:A,tag:m.tag,payload:m.payload,callback:m.callback,next:null},R===null?(w=R=O,v=C):R=R.next=O,p|=A;if(m=m.next,m===null){if(m=l.shared.pending,m===null)break;A=m,m=A.next,A.next=null,l.lastBaseUpdate=A,l.shared.pending=null}}while(!0);if(R===null&&(v=C),l.baseState=v,l.firstBaseUpdate=w,l.lastBaseUpdate=R,e=l.shared.interleaved,e!==null){l=e;do p|=l.lane,l=l.next;while(l!==e)}else u===null&&(l.shared.lanes=0);bv|=p,t.lanes=p,t.memoizedState=C}}function Lte(t,e,r){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var a=t[e],l=a.callback;if(l!==null){if(a.callback=null,a=r,typeof l!="function")throw Error(Mt(191,l));l.call(a)}}}var WN={},Sf=u0(WN),aN=u0(WN),oN=u0(WN);function ov(t){if(t===WN)throw Error(Mt(174));return t}function S8(t,e){switch(Ts(oN,e),Ts(aN,t),Ts(Sf,WN),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:qB(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=qB(e,t)}Us(Sf),Ts(Sf,e)}function Zb(){Us(Sf),Us(aN),Us(oN)}function Woe(t){ov(oN.current);var e=ov(Sf.current),r=qB(e,t.type);e!==r&&(Ts(aN,t),Ts(Sf,r))}function T8(t){aN.current===t&&(Us(Sf),Us(aN))}var ha=u0(0);function FD(t){for(var e=t;e!==null;){if(e.tag===13){var r=e.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var EF=[];function R8(){for(var t=0;t<EF.length;t++)EF[t]._workInProgressVersionPrimary=null;EF.length=0}var Z2=Qm.ReactCurrentDispatcher,xF=Qm.ReactCurrentBatchConfig,xv=0,fa=null,mo=null,Go=null,BD=!1,CC=!1,cN=0,PCe=0;function Zc(){throw Error(Mt(321))}function C8(t,e){if(e===null)return!1;for(var r=0;r<e.length&&r<t.length;r++)if(!cp(t[r],e[r]))return!1;return!0}function N8(t,e,r,a,l,u){if(xv=u,fa=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Z2.current=t===null||t.memoizedState===null?jCe:MCe,t=r(a,l),CC){u=0;do{if(CC=!1,cN=0,25<=u)throw Error(Mt(301));u+=1,Go=mo=null,e.updateQueue=null,Z2.current=UCe,t=r(a,l)}while(CC)}if(Z2.current=zD,e=mo!==null&&mo.next!==null,xv=0,Go=mo=fa=null,BD=!1,e)throw Error(Mt(300));return t}function I8(){var t=cN!==0;return cN=0,t}function gf(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Go===null?fa.memoizedState=Go=t:Go=Go.next=t,Go}function nh(){if(mo===null){var t=fa.alternate;t=t!==null?t.memoizedState:null}else t=mo.next;var e=Go===null?fa.memoizedState:Go.next;if(e!==null)Go=e,mo=t;else{if(t===null)throw Error(Mt(310));mo=t,t={memoizedState:mo.memoizedState,baseState:mo.baseState,baseQueue:mo.baseQueue,queue:mo.queue,next:null},Go===null?fa.memoizedState=Go=t:Go=Go.next=t}return Go}function lN(t,e){return typeof e=="function"?e(t):e}function bF(t){var e=nh(),r=e.queue;if(r===null)throw Error(Mt(311));r.lastRenderedReducer=t;var a=mo,l=a.baseQueue,u=r.pending;if(u!==null){if(l!==null){var p=l.next;l.next=u.next,u.next=p}a.baseQueue=l=u,r.pending=null}if(l!==null){u=l.next,a=a.baseState;var m=p=null,v=null,w=u;do{var R=w.lane;if((xv&R)===R)v!==null&&(v=v.next={lane:0,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null}),a=w.hasEagerState?w.eagerState:t(a,w.action);else{var C={lane:R,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null};v===null?(m=v=C,p=a):v=v.next=C,fa.lanes|=R,bv|=R}w=w.next}while(w!==null&&w!==u);v===null?p=a:v.next=m,cp(a,e.memoizedState)||(ad=!0),e.memoizedState=a,e.baseState=p,e.baseQueue=v,r.lastRenderedState=a}if(t=r.interleaved,t!==null){l=t;do u=l.lane,fa.lanes|=u,bv|=u,l=l.next;while(l!==t)}else l===null&&(r.lanes=0);return[e.memoizedState,r.dispatch]}function wF(t){var e=nh(),r=e.queue;if(r===null)throw Error(Mt(311));r.lastRenderedReducer=t;var a=r.dispatch,l=r.pending,u=e.memoizedState;if(l!==null){r.pending=null;var p=l=l.next;do u=t(u,p.action),p=p.next;while(p!==l);cp(u,e.memoizedState)||(ad=!0),e.memoizedState=u,e.baseQueue===null&&(e.baseState=u),r.lastRenderedState=u}return[u,a]}function Hoe(){}function Koe(t,e){var r=fa,a=nh(),l=e(),u=!cp(a.memoizedState,l);if(u&&(a.memoizedState=l,ad=!0),a=a.queue,A8($oe.bind(null,r,a,t),[t]),a.getSnapshot!==e||u||Go!==null&&Go.memoizedState.tag&1){if(r.flags|=2048,dN(9,Yoe.bind(null,r,a,l,e),void 0,null),Yo===null)throw Error(Mt(349));xv&30||qoe(r,e,l)}return l}function qoe(t,e,r){t.flags|=16384,t={getSnapshot:e,value:r},e=fa.updateQueue,e===null?(e={lastEffect:null,stores:null},fa.updateQueue=e,e.stores=[t]):(r=e.stores,r===null?e.stores=[t]:r.push(t))}function Yoe(t,e,r,a){e.value=r,e.getSnapshot=a,Xoe(e)&&Joe(t)}function $oe(t,e,r){return r(function(){Xoe(e)&&Joe(t)})}function Xoe(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!cp(t,r)}catch{return!0}}function Joe(t){var e=zm(t,1);e!==null&&ip(e,t,1,-1)}function jte(t){var e=gf();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:lN,lastRenderedState:t},e.queue=t,t=t.dispatch=LCe.bind(null,fa,t),[e.memoizedState,t]}function dN(t,e,r,a){return t={tag:t,create:e,destroy:r,deps:a,next:null},e=fa.updateQueue,e===null?(e={lastEffect:null,stores:null},fa.updateQueue=e,e.lastEffect=t.next=t):(r=e.lastEffect,r===null?e.lastEffect=t.next=t:(a=r.next,r.next=t,t.next=a,e.lastEffect=t)),t}function Qoe(){return nh().memoizedState}function eD(t,e,r,a){var l=gf();fa.flags|=t,l.memoizedState=dN(1|e,r,void 0,a===void 0?null:a)}function qO(t,e,r,a){var l=nh();a=a===void 0?null:a;var u=void 0;if(mo!==null){var p=mo.memoizedState;if(u=p.destroy,a!==null&&C8(a,p.deps)){l.memoizedState=dN(e,r,u,a);return}}fa.flags|=t,l.memoizedState=dN(1|e,r,u,a)}function Mte(t,e){return eD(8390656,8,t,e)}function A8(t,e){return qO(2048,8,t,e)}function Zoe(t,e){return qO(4,2,t,e)}function ece(t,e){return qO(4,4,t,e)}function tce(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function nce(t,e,r){return r=r!=null?r.concat([t]):null,qO(4,4,tce.bind(null,e,t),r)}function k8(){}function rce(t,e){var r=nh();e=e===void 0?null:e;var a=r.memoizedState;return a!==null&&e!==null&&C8(e,a[1])?a[0]:(r.memoizedState=[t,e],t)}function ice(t,e){var r=nh();e=e===void 0?null:e;var a=r.memoizedState;return a!==null&&e!==null&&C8(e,a[1])?a[0]:(t=t(),r.memoizedState=[t,e],t)}function sce(t,e,r){return xv&21?(cp(r,e)||(r=doe(),fa.lanes|=r,bv|=r,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,ad=!0),t.memoizedState=r)}function DCe(t,e){var r=Xi;Xi=r!==0&&4>r?r:4,t(!0);var a=xF.transition;xF.transition={};try{t(!1),e()}finally{Xi=r,xF.transition=a}}function ace(){return nh().memoizedState}function OCe(t,e,r){var a=B_(t);if(r={lane:a,action:r,hasEagerState:!1,eagerState:null,next:null},oce(t))cce(e,r);else if(r=zoe(t,e,r,a),r!==null){var l=Nl();ip(r,t,a,l),lce(r,e,a)}}function LCe(t,e,r){var a=B_(t),l={lane:a,action:r,hasEagerState:!1,eagerState:null,next:null};if(oce(t))cce(e,l);else{var u=t.alternate;if(t.lanes===0&&(u===null||u.lanes===0)&&(u=e.lastRenderedReducer,u!==null))try{var p=e.lastRenderedState,m=u(p,r);if(l.hasEagerState=!0,l.eagerState=m,cp(m,p)){var v=e.interleaved;v===null?(l.next=l,b8(e)):(l.next=v.next,v.next=l),e.interleaved=l;return}}catch{}finally{}r=zoe(t,e,l,a),r!==null&&(l=Nl(),ip(r,t,a,l),lce(r,e,a))}}function oce(t){var e=t.alternate;return t===fa||e!==null&&e===fa}function cce(t,e){CC=BD=!0;var r=t.pending;r===null?e.next=e:(e.next=r.next,r.next=e),t.pending=e}function lce(t,e,r){if(r&4194240){var a=e.lanes;a&=t.pendingLanes,r|=a,e.lanes=r,c8(t,r)}}var zD={readContext:th,useCallback:Zc,useContext:Zc,useEffect:Zc,useImperativeHandle:Zc,useInsertionEffect:Zc,useLayoutEffect:Zc,useMemo:Zc,useReducer:Zc,useRef:Zc,useState:Zc,useDebugValue:Zc,useDeferredValue:Zc,useTransition:Zc,useMutableSource:Zc,useSyncExternalStore:Zc,useId:Zc,unstable_isNewReconciler:!1},jCe={readContext:th,useCallback:function(t,e){return gf().memoizedState=[t,e===void 0?null:e],t},useContext:th,useEffect:Mte,useImperativeHandle:function(t,e,r){return r=r!=null?r.concat([t]):null,eD(4194308,4,tce.bind(null,e,t),r)},useLayoutEffect:function(t,e){return eD(4194308,4,t,e)},useInsertionEffect:function(t,e){return eD(4,2,t,e)},useMemo:function(t,e){var r=gf();return e=e===void 0?null:e,t=t(),r.memoizedState=[t,e],t},useReducer:function(t,e,r){var a=gf();return e=r!==void 0?r(e):e,a.memoizedState=a.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},a.queue=t,t=t.dispatch=OCe.bind(null,fa,t),[a.memoizedState,t]},useRef:function(t){var e=gf();return t={current:t},e.memoizedState=t},useState:jte,useDebugValue:k8,useDeferredValue:function(t){return gf().memoizedState=t},useTransition:function(){var t=jte(!1),e=t[0];return t=DCe.bind(null,t[1]),gf().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,r){var a=fa,l=gf();if(ea){if(r===void 0)throw Error(Mt(407));r=r()}else{if(r=e(),Yo===null)throw Error(Mt(349));xv&30||qoe(a,e,r)}l.memoizedState=r;var u={value:r,getSnapshot:e};return l.queue=u,Mte($oe.bind(null,a,u,t),[t]),a.flags|=2048,dN(9,Yoe.bind(null,a,u,r,e),void 0,null),r},useId:function(){var t=gf(),e=Yo.identifierPrefix;if(ea){var r=Im,a=Nm;r=(a&~(1<<32-rp(a)-1)).toString(32)+r,e=":"+e+"R"+r,r=cN++,0<r&&(e+="H"+r.toString(32)),e+=":"}else r=PCe++,e=":"+e+"r"+r.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},MCe={readContext:th,useCallback:rce,useContext:th,useEffect:A8,useImperativeHandle:nce,useInsertionEffect:Zoe,useLayoutEffect:ece,useMemo:ice,useReducer:bF,useRef:Qoe,useState:function(){return bF(lN)},useDebugValue:k8,useDeferredValue:function(t){var e=nh();return sce(e,mo.memoizedState,t)},useTransition:function(){var t=bF(lN)[0],e=nh().memoizedState;return[t,e]},useMutableSource:Hoe,useSyncExternalStore:Koe,useId:ace,unstable_isNewReconciler:!1},UCe={readContext:th,useCallback:rce,useContext:th,useEffect:A8,useImperativeHandle:nce,useInsertionEffect:Zoe,useLayoutEffect:ece,useMemo:ice,useReducer:wF,useRef:Qoe,useState:function(){return wF(lN)},useDebugValue:k8,useDeferredValue:function(t){var e=nh();return mo===null?e.memoizedState=t:sce(e,mo.memoizedState,t)},useTransition:function(){var t=wF(lN)[0],e=nh().memoizedState;return[t,e]},useMutableSource:Hoe,useSyncExternalStore:Koe,useId:ace,unstable_isNewReconciler:!1};function ep(t,e){if(t&&t.defaultProps){e=ga({},e),t=t.defaultProps;for(var r in t)e[r]===void 0&&(e[r]=t[r]);return e}return e}function f6(t,e,r,a){e=t.memoizedState,r=r(a,e),r=r==null?e:ga({},e,r),t.memoizedState=r,t.lanes===0&&(t.updateQueue.baseState=r)}var YO={isMounted:function(t){return(t=t._reactInternals)?Fv(t)===t:!1},enqueueSetState:function(t,e,r){t=t._reactInternals;var a=Nl(),l=B_(t),u=jm(a,l);u.payload=e,r!=null&&(u.callback=r),e=V_(t,u,l),e!==null&&(ip(e,t,l,a),Q2(e,t,l))},enqueueReplaceState:function(t,e,r){t=t._reactInternals;var a=Nl(),l=B_(t),u=jm(a,l);u.tag=1,u.payload=e,r!=null&&(u.callback=r),e=V_(t,u,l),e!==null&&(ip(e,t,l,a),Q2(e,t,l))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var r=Nl(),a=B_(t),l=jm(r,a);l.tag=2,e!=null&&(l.callback=e),e=V_(t,l,a),e!==null&&(ip(e,t,a,r),Q2(e,t,a))}};function Ute(t,e,r,a,l,u,p){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(a,u,p):e.prototype&&e.prototype.isPureReactComponent?!nN(r,a)||!nN(l,u):!0}function dce(t,e,r){var a=!1,l=X_,u=e.contextType;return typeof u=="object"&&u!==null?u=th(u):(l=hd(e)?vv:al.current,a=e.contextTypes,u=(a=a!=null)?Xb(t,l):X_),e=new e(r,u),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=YO,t.stateNode=e,e._reactInternals=t,a&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=l,t.__reactInternalMemoizedMaskedChildContext=u),e}function Vte(t,e,r,a){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(r,a),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(r,a),e.state!==t&&YO.enqueueReplaceState(e,e.state,null)}function m6(t,e,r,a){var l=t.stateNode;l.props=r,l.state=t.memoizedState,l.refs={},w8(t);var u=e.contextType;typeof u=="object"&&u!==null?l.context=th(u):(u=hd(e)?vv:al.current,l.context=Xb(t,u)),l.state=t.memoizedState,u=e.getDerivedStateFromProps,typeof u=="function"&&(f6(t,e,u,r),l.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof l.getSnapshotBeforeUpdate=="function"||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(e=l.state,typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount(),e!==l.state&&YO.enqueueReplaceState(l,l.state,null),VD(t,r,l,a),l.state=t.memoizedState),typeof l.componentDidMount=="function"&&(t.flags|=4194308)}function ew(t,e){try{var r="",a=e;do r+=hRe(a),a=a.return;while(a);var l=r}catch(u){l=`
Error generating stack: `+u.message+`
`+u.stack}return{value:t,source:e,stack:l,digest:null}}function SF(t,e,r){return{value:t,source:null,stack:r??null,digest:e??null}}function g6(t,e){try{console.error(e.value)}catch(r){setTimeout(function(){throw r})}}var VCe=typeof WeakMap=="function"?WeakMap:Map;function uce(t,e,r){r=jm(-1,r),r.tag=3,r.payload={element:null};var a=e.value;return r.callback=function(){WD||(WD=!0,R6=a),g6(t,e)},r}function hce(t,e,r){r=jm(-1,r),r.tag=3;var a=t.type.getDerivedStateFromError;if(typeof a=="function"){var l=e.value;r.payload=function(){return a(l)},r.callback=function(){g6(t,e)}}var u=t.stateNode;return u!==null&&typeof u.componentDidCatch=="function"&&(r.callback=function(){g6(t,e),typeof a!="function"&&(F_===null?F_=new Set([this]):F_.add(this));var p=e.stack;this.componentDidCatch(e.value,{componentStack:p!==null?p:""})}),r}function Fte(t,e,r){var a=t.pingCache;if(a===null){a=t.pingCache=new VCe;var l=new Set;a.set(e,l)}else l=a.get(e),l===void 0&&(l=new Set,a.set(e,l));l.has(r)||(l.add(r),t=ZCe.bind(null,t,e,r),e.then(t,t))}function Bte(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function zte(t,e,r,a,l){return t.mode&1?(t.flags|=65536,t.lanes=l,t):(t===e?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(e=jm(-1,1),e.tag=2,V_(r,e,1))),r.lanes|=1),t)}var FCe=Qm.ReactCurrentOwner,ad=!1;function Sl(t,e,r,a){e.child=t===null?Boe(e,null,r,a):Qb(e,t.child,r,a)}function Gte(t,e,r,a,l){r=r.render;var u=e.ref;return Mb(e,l),a=N8(t,e,r,a,u,l),r=I8(),t!==null&&!ad?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~l,Gm(t,e,l)):(ea&&r&&g8(e),e.flags|=1,Sl(t,e,a,l),e.child)}function Wte(t,e,r,a,l){if(t===null){var u=r.type;return typeof u=="function"&&!V8(u)&&u.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(e.tag=15,e.type=u,pce(t,e,u,a,l)):(t=iD(r.type,null,a,e,e.mode,l),t.ref=e.ref,t.return=e,e.child=t)}if(u=t.child,!(t.lanes&l)){var p=u.memoizedProps;if(r=r.compare,r=r!==null?r:nN,r(p,a)&&t.ref===e.ref)return Gm(t,e,l)}return e.flags|=1,t=z_(u,a),t.ref=e.ref,t.return=e,e.child=t}function pce(t,e,r,a,l){if(t!==null){var u=t.memoizedProps;if(nN(u,a)&&t.ref===e.ref)if(ad=!1,e.pendingProps=a=u,(t.lanes&l)!==0)t.flags&131072&&(ad=!0);else return e.lanes=t.lanes,Gm(t,e,l)}return _6(t,e,r,a,l)}function fce(t,e,r){var a=e.pendingProps,l=a.children,u=t!==null?t.memoizedState:null;if(a.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ts(Nb,zd),zd|=r;else{if(!(r&1073741824))return t=u!==null?u.baseLanes|r:r,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Ts(Nb,zd),zd|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},a=u!==null?u.baseLanes:r,Ts(Nb,zd),zd|=a}else u!==null?(a=u.baseLanes|r,e.memoizedState=null):a=r,Ts(Nb,zd),zd|=a;return Sl(t,e,l,r),e.child}function mce(t,e){var r=e.ref;(t===null&&r!==null||t!==null&&t.ref!==r)&&(e.flags|=512,e.flags|=2097152)}function _6(t,e,r,a,l){var u=hd(r)?vv:al.current;return u=Xb(e,u),Mb(e,l),r=N8(t,e,r,a,u,l),a=I8(),t!==null&&!ad?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~l,Gm(t,e,l)):(ea&&a&&g8(e),e.flags|=1,Sl(t,e,r,l),e.child)}function Hte(t,e,r,a,l){if(hd(r)){var u=!0;OD(e)}else u=!1;if(Mb(e,l),e.stateNode===null)tD(t,e),dce(e,r,a),m6(e,r,a,l),a=!0;else if(t===null){var p=e.stateNode,m=e.memoizedProps;p.props=m;var v=p.context,w=r.contextType;typeof w=="object"&&w!==null?w=th(w):(w=hd(r)?vv:al.current,w=Xb(e,w));var R=r.getDerivedStateFromProps,C=typeof R=="function"||typeof p.getSnapshotBeforeUpdate=="function";C||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(m!==a||v!==w)&&Vte(e,p,a,w),__=!1;var A=e.memoizedState;p.state=A,VD(e,a,p,l),v=e.memoizedState,m!==a||A!==v||ud.current||__?(typeof R=="function"&&(f6(e,r,R,a),v=e.memoizedState),(m=__||Ute(e,r,m,a,A,v,w))?(C||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount()),typeof p.componentDidMount=="function"&&(e.flags|=4194308)):(typeof p.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=a,e.memoizedState=v),p.props=a,p.state=v,p.context=w,a=m):(typeof p.componentDidMount=="function"&&(e.flags|=4194308),a=!1)}else{p=e.stateNode,Goe(t,e),m=e.memoizedProps,w=e.type===e.elementType?m:ep(e.type,m),p.props=w,C=e.pendingProps,A=p.context,v=r.contextType,typeof v=="object"&&v!==null?v=th(v):(v=hd(r)?vv:al.current,v=Xb(e,v));var O=r.getDerivedStateFromProps;(R=typeof O=="function"||typeof p.getSnapshotBeforeUpdate=="function")||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(m!==C||A!==v)&&Vte(e,p,a,v),__=!1,A=e.memoizedState,p.state=A,VD(e,a,p,l);var U=e.memoizedState;m!==C||A!==U||ud.current||__?(typeof O=="function"&&(f6(e,r,O,a),U=e.memoizedState),(w=__||Ute(e,r,w,a,A,U,v)||!1)?(R||typeof p.UNSAFE_componentWillUpdate!="function"&&typeof p.componentWillUpdate!="function"||(typeof p.componentWillUpdate=="function"&&p.componentWillUpdate(a,U,v),typeof p.UNSAFE_componentWillUpdate=="function"&&p.UNSAFE_componentWillUpdate(a,U,v)),typeof p.componentDidUpdate=="function"&&(e.flags|=4),typeof p.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof p.componentDidUpdate!="function"||m===t.memoizedProps&&A===t.memoizedState||(e.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||m===t.memoizedProps&&A===t.memoizedState||(e.flags|=1024),e.memoizedProps=a,e.memoizedState=U),p.props=a,p.state=U,p.context=v,a=w):(typeof p.componentDidUpdate!="function"||m===t.memoizedProps&&A===t.memoizedState||(e.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||m===t.memoizedProps&&A===t.memoizedState||(e.flags|=1024),a=!1)}return y6(t,e,r,a,u,l)}function y6(t,e,r,a,l,u){mce(t,e);var p=(e.flags&128)!==0;if(!a&&!p)return l&&Ate(e,r,!1),Gm(t,e,u);a=e.stateNode,FCe.current=e;var m=p&&typeof r.getDerivedStateFromError!="function"?null:a.render();return e.flags|=1,t!==null&&p?(e.child=Qb(e,t.child,null,u),e.child=Qb(e,null,m,u)):Sl(t,e,m,u),e.memoizedState=a.state,l&&Ate(e,r,!0),e.child}function gce(t){var e=t.stateNode;e.pendingContext?Ite(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Ite(t,e.context,!1),S8(t,e.containerInfo)}function Kte(t,e,r,a,l){return Jb(),y8(l),e.flags|=256,Sl(t,e,r,a),e.child}var v6={dehydrated:null,treeContext:null,retryLane:0};function E6(t){return{baseLanes:t,cachePool:null,transitions:null}}function _ce(t,e,r){var a=e.pendingProps,l=ha.current,u=!1,p=(e.flags&128)!==0,m;if((m=p)||(m=t!==null&&t.memoizedState===null?!1:(l&2)!==0),m?(u=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(l|=1),Ts(ha,l&1),t===null)return h6(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(p=a.children,t=a.fallback,u?(a=e.mode,u=e.child,p={mode:"hidden",children:p},!(a&1)&&u!==null?(u.childLanes=0,u.pendingProps=p):u=JO(p,a,0,null),t=hv(t,a,r,null),u.return=e,t.return=e,u.sibling=t,e.child=u,e.child.memoizedState=E6(r),e.memoizedState=v6,t):P8(e,p));if(l=t.memoizedState,l!==null&&(m=l.dehydrated,m!==null))return BCe(t,e,p,a,m,l,r);if(u){u=a.fallback,p=e.mode,l=t.child,m=l.sibling;var v={mode:"hidden",children:a.children};return!(p&1)&&e.child!==l?(a=e.child,a.childLanes=0,a.pendingProps=v,e.deletions=null):(a=z_(l,v),a.subtreeFlags=l.subtreeFlags&14680064),m!==null?u=z_(m,u):(u=hv(u,p,r,null),u.flags|=2),u.return=e,a.return=e,a.sibling=u,e.child=a,a=u,u=e.child,p=t.child.memoizedState,p=p===null?E6(r):{baseLanes:p.baseLanes|r,cachePool:null,transitions:p.transitions},u.memoizedState=p,u.childLanes=t.childLanes&~r,e.memoizedState=v6,a}return u=t.child,t=u.sibling,a=z_(u,{mode:"visible",children:a.children}),!(e.mode&1)&&(a.lanes=r),a.return=e,a.sibling=null,t!==null&&(r=e.deletions,r===null?(e.deletions=[t],e.flags|=16):r.push(t)),e.child=a,e.memoizedState=null,a}function P8(t,e){return e=JO({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function x2(t,e,r,a){return a!==null&&y8(a),Qb(e,t.child,null,r),t=P8(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function BCe(t,e,r,a,l,u,p){if(r)return e.flags&256?(e.flags&=-257,a=SF(Error(Mt(422))),x2(t,e,p,a)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(u=a.fallback,l=e.mode,a=JO({mode:"visible",children:a.children},l,0,null),u=hv(u,l,p,null),u.flags|=2,a.return=e,u.return=e,a.sibling=u,e.child=a,e.mode&1&&Qb(e,t.child,null,p),e.child.memoizedState=E6(p),e.memoizedState=v6,u);if(!(e.mode&1))return x2(t,e,p,null);if(l.data==="$!"){if(a=l.nextSibling&&l.nextSibling.dataset,a)var m=a.dgst;return a=m,u=Error(Mt(419)),a=SF(u,a,void 0),x2(t,e,p,a)}if(m=(p&t.childLanes)!==0,ad||m){if(a=Yo,a!==null){switch(p&-p){case 4:l=2;break;case 16:l=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:l=32;break;case 536870912:l=268435456;break;default:l=0}l=l&(a.suspendedLanes|p)?0:l,l!==0&&l!==u.retryLane&&(u.retryLane=l,zm(t,l),ip(a,t,l,-1))}return U8(),a=SF(Error(Mt(421))),x2(t,e,p,a)}return l.data==="$?"?(e.flags|=128,e.child=t.child,e=eNe.bind(null,t),l._reactRetry=e,null):(t=u.treeContext,Hd=U_(l.nextSibling),qd=e,ea=!0,np=null,t!==null&&(Yu[$u++]=Nm,Yu[$u++]=Im,Yu[$u++]=Ev,Nm=t.id,Im=t.overflow,Ev=e),e=P8(e,a.children),e.flags|=4096,e)}function qte(t,e,r){t.lanes|=e;var a=t.alternate;a!==null&&(a.lanes|=e),p6(t.return,e,r)}function TF(t,e,r,a,l){var u=t.memoizedState;u===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:a,tail:r,tailMode:l}:(u.isBackwards=e,u.rendering=null,u.renderingStartTime=0,u.last=a,u.tail=r,u.tailMode=l)}function yce(t,e,r){var a=e.pendingProps,l=a.revealOrder,u=a.tail;if(Sl(t,e,a.children,r),a=ha.current,a&2)a=a&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&qte(t,r,e);else if(t.tag===19)qte(t,r,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}a&=1}if(Ts(ha,a),!(e.mode&1))e.memoizedState=null;else switch(l){case"forwards":for(r=e.child,l=null;r!==null;)t=r.alternate,t!==null&&FD(t)===null&&(l=r),r=r.sibling;r=l,r===null?(l=e.child,e.child=null):(l=r.sibling,r.sibling=null),TF(e,!1,l,r,u);break;case"backwards":for(r=null,l=e.child,e.child=null;l!==null;){if(t=l.alternate,t!==null&&FD(t)===null){e.child=l;break}t=l.sibling,l.sibling=r,r=l,l=t}TF(e,!0,r,null,u);break;case"together":TF(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function tD(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Gm(t,e,r){if(t!==null&&(e.dependencies=t.dependencies),bv|=e.lanes,!(r&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Mt(153));if(e.child!==null){for(t=e.child,r=z_(t,t.pendingProps),e.child=r,r.return=e;t.sibling!==null;)t=t.sibling,r=r.sibling=z_(t,t.pendingProps),r.return=e;r.sibling=null}return e.child}function zCe(t,e,r){switch(e.tag){case 3:gce(e),Jb();break;case 5:Woe(e);break;case 1:hd(e.type)&&OD(e);break;case 4:S8(e,e.stateNode.containerInfo);break;case 10:var a=e.type._context,l=e.memoizedProps.value;Ts(MD,a._currentValue),a._currentValue=l;break;case 13:if(a=e.memoizedState,a!==null)return a.dehydrated!==null?(Ts(ha,ha.current&1),e.flags|=128,null):r&e.child.childLanes?_ce(t,e,r):(Ts(ha,ha.current&1),t=Gm(t,e,r),t!==null?t.sibling:null);Ts(ha,ha.current&1);break;case 19:if(a=(r&e.childLanes)!==0,t.flags&128){if(a)return yce(t,e,r);e.flags|=128}if(l=e.memoizedState,l!==null&&(l.rendering=null,l.tail=null,l.lastEffect=null),Ts(ha,ha.current),a)break;return null;case 22:case 23:return e.lanes=0,fce(t,e,r)}return Gm(t,e,r)}var vce,x6,Ece,xce;vce=function(t,e){for(var r=e.child;r!==null;){if(r.tag===5||r.tag===6)t.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};x6=function(){};Ece=function(t,e,r,a){var l=t.memoizedProps;if(l!==a){t=e.stateNode,ov(Sf.current);var u=null;switch(r){case"input":l=GB(t,l),a=GB(t,a),u=[];break;case"select":l=ga({},l,{value:void 0}),a=ga({},a,{value:void 0}),u=[];break;case"textarea":l=KB(t,l),a=KB(t,a),u=[];break;default:typeof l.onClick!="function"&&typeof a.onClick=="function"&&(t.onclick=PD)}YB(r,a);var p;r=null;for(w in l)if(!a.hasOwnProperty(w)&&l.hasOwnProperty(w)&&l[w]!=null)if(w==="style"){var m=l[w];for(p in m)m.hasOwnProperty(p)&&(r||(r={}),r[p]="")}else w!=="dangerouslySetInnerHTML"&&w!=="children"&&w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&($C.hasOwnProperty(w)?u||(u=[]):(u=u||[]).push(w,null));for(w in a){var v=a[w];if(m=l!=null?l[w]:void 0,a.hasOwnProperty(w)&&v!==m&&(v!=null||m!=null))if(w==="style")if(m){for(p in m)!m.hasOwnProperty(p)||v&&v.hasOwnProperty(p)||(r||(r={}),r[p]="");for(p in v)v.hasOwnProperty(p)&&m[p]!==v[p]&&(r||(r={}),r[p]=v[p])}else r||(u||(u=[]),u.push(w,r)),r=v;else w==="dangerouslySetInnerHTML"?(v=v?v.__html:void 0,m=m?m.__html:void 0,v!=null&&m!==v&&(u=u||[]).push(w,v)):w==="children"?typeof v!="string"&&typeof v!="number"||(u=u||[]).push(w,""+v):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&($C.hasOwnProperty(w)?(v!=null&&w==="onScroll"&&Ls("scroll",t),u||m===v||(u=[])):(u=u||[]).push(w,v))}r&&(u=u||[]).push("style",r);var w=u;(e.updateQueue=w)&&(e.flags|=4)}};xce=function(t,e,r,a){r!==a&&(e.flags|=4)};function qR(t,e){if(!ea)switch(t.tailMode){case"hidden":e=t.tail;for(var r=null;e!==null;)e.alternate!==null&&(r=e),e=e.sibling;r===null?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var a=null;r!==null;)r.alternate!==null&&(a=r),r=r.sibling;a===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:a.sibling=null}}function el(t){var e=t.alternate!==null&&t.alternate.child===t.child,r=0,a=0;if(e)for(var l=t.child;l!==null;)r|=l.lanes|l.childLanes,a|=l.subtreeFlags&14680064,a|=l.flags&14680064,l.return=t,l=l.sibling;else for(l=t.child;l!==null;)r|=l.lanes|l.childLanes,a|=l.subtreeFlags,a|=l.flags,l.return=t,l=l.sibling;return t.subtreeFlags|=a,t.childLanes=r,e}function GCe(t,e,r){var a=e.pendingProps;switch(_8(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return el(e),null;case 1:return hd(e.type)&&DD(),el(e),null;case 3:return a=e.stateNode,Zb(),Us(ud),Us(al),R8(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(t===null||t.child===null)&&(v2(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,np!==null&&(I6(np),np=null))),x6(t,e),el(e),null;case 5:T8(e);var l=ov(oN.current);if(r=e.type,t!==null&&e.stateNode!=null)Ece(t,e,r,a,l),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!a){if(e.stateNode===null)throw Error(Mt(166));return el(e),null}if(t=ov(Sf.current),v2(e)){a=e.stateNode,r=e.type;var u=e.memoizedProps;switch(a[yf]=e,a[sN]=u,t=(e.mode&1)!==0,r){case"dialog":Ls("cancel",a),Ls("close",a);break;case"iframe":case"object":case"embed":Ls("load",a);break;case"video":case"audio":for(l=0;l<lC.length;l++)Ls(lC[l],a);break;case"source":Ls("error",a);break;case"img":case"image":case"link":Ls("error",a),Ls("load",a);break;case"details":Ls("toggle",a);break;case"input":nte(a,u),Ls("invalid",a);break;case"select":a._wrapperState={wasMultiple:!!u.multiple},Ls("invalid",a);break;case"textarea":ite(a,u),Ls("invalid",a)}YB(r,u),l=null;for(var p in u)if(u.hasOwnProperty(p)){var m=u[p];p==="children"?typeof m=="string"?a.textContent!==m&&(u.suppressHydrationWarning!==!0&&y2(a.textContent,m,t),l=["children",m]):typeof m=="number"&&a.textContent!==""+m&&(u.suppressHydrationWarning!==!0&&y2(a.textContent,m,t),l=["children",""+m]):$C.hasOwnProperty(p)&&m!=null&&p==="onScroll"&&Ls("scroll",a)}switch(r){case"input":d2(a),rte(a,u,!0);break;case"textarea":d2(a),ste(a);break;case"select":case"option":break;default:typeof u.onClick=="function"&&(a.onclick=PD)}a=l,e.updateQueue=a,a!==null&&(e.flags|=4)}else{p=l.nodeType===9?l:l.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=$ae(r)),t==="http://www.w3.org/1999/xhtml"?r==="script"?(t=p.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof a.is=="string"?t=p.createElement(r,{is:a.is}):(t=p.createElement(r),r==="select"&&(p=t,a.multiple?p.multiple=!0:a.size&&(p.size=a.size))):t=p.createElementNS(t,r),t[yf]=e,t[sN]=a,vce(t,e,!1,!1),e.stateNode=t;e:{switch(p=$B(r,a),r){case"dialog":Ls("cancel",t),Ls("close",t),l=a;break;case"iframe":case"object":case"embed":Ls("load",t),l=a;break;case"video":case"audio":for(l=0;l<lC.length;l++)Ls(lC[l],t);l=a;break;case"source":Ls("error",t),l=a;break;case"img":case"image":case"link":Ls("error",t),Ls("load",t),l=a;break;case"details":Ls("toggle",t),l=a;break;case"input":nte(t,a),l=GB(t,a),Ls("invalid",t);break;case"option":l=a;break;case"select":t._wrapperState={wasMultiple:!!a.multiple},l=ga({},a,{value:void 0}),Ls("invalid",t);break;case"textarea":ite(t,a),l=KB(t,a),Ls("invalid",t);break;default:l=a}YB(r,l),m=l;for(u in m)if(m.hasOwnProperty(u)){var v=m[u];u==="style"?Qae(t,v):u==="dangerouslySetInnerHTML"?(v=v?v.__html:void 0,v!=null&&Xae(t,v)):u==="children"?typeof v=="string"?(r!=="textarea"||v!=="")&&XC(t,v):typeof v=="number"&&XC(t,""+v):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&($C.hasOwnProperty(u)?v!=null&&u==="onScroll"&&Ls("scroll",t):v!=null&&n8(t,u,v,p))}switch(r){case"input":d2(t),rte(t,a,!1);break;case"textarea":d2(t),ste(t);break;case"option":a.value!=null&&t.setAttribute("value",""+$_(a.value));break;case"select":t.multiple=!!a.multiple,u=a.value,u!=null?Db(t,!!a.multiple,u,!1):a.defaultValue!=null&&Db(t,!!a.multiple,a.defaultValue,!0);break;default:typeof l.onClick=="function"&&(t.onclick=PD)}switch(r){case"button":case"input":case"select":case"textarea":a=!!a.autoFocus;break e;case"img":a=!0;break e;default:a=!1}}a&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return el(e),null;case 6:if(t&&e.stateNode!=null)xce(t,e,t.memoizedProps,a);else{if(typeof a!="string"&&e.stateNode===null)throw Error(Mt(166));if(r=ov(oN.current),ov(Sf.current),v2(e)){if(a=e.stateNode,r=e.memoizedProps,a[yf]=e,(u=a.nodeValue!==r)&&(t=qd,t!==null))switch(t.tag){case 3:y2(a.nodeValue,r,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&y2(a.nodeValue,r,(t.mode&1)!==0)}u&&(e.flags|=4)}else a=(r.nodeType===9?r:r.ownerDocument).createTextNode(a),a[yf]=e,e.stateNode=a}return el(e),null;case 13:if(Us(ha),a=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(ea&&Hd!==null&&e.mode&1&&!(e.flags&128))Voe(),Jb(),e.flags|=98560,u=!1;else if(u=v2(e),a!==null&&a.dehydrated!==null){if(t===null){if(!u)throw Error(Mt(318));if(u=e.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(Mt(317));u[yf]=e}else Jb(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;el(e),u=!1}else np!==null&&(I6(np),np=null),u=!0;if(!u)return e.flags&65536?e:null}return e.flags&128?(e.lanes=r,e):(a=a!==null,a!==(t!==null&&t.memoizedState!==null)&&a&&(e.child.flags|=8192,e.mode&1&&(t===null||ha.current&1?go===0&&(go=3):U8())),e.updateQueue!==null&&(e.flags|=4),el(e),null);case 4:return Zb(),x6(t,e),t===null&&rN(e.stateNode.containerInfo),el(e),null;case 10:return x8(e.type._context),el(e),null;case 17:return hd(e.type)&&DD(),el(e),null;case 19:if(Us(ha),u=e.memoizedState,u===null)return el(e),null;if(a=(e.flags&128)!==0,p=u.rendering,p===null)if(a)qR(u,!1);else{if(go!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(p=FD(t),p!==null){for(e.flags|=128,qR(u,!1),a=p.updateQueue,a!==null&&(e.updateQueue=a,e.flags|=4),e.subtreeFlags=0,a=r,r=e.child;r!==null;)u=r,t=a,u.flags&=14680066,p=u.alternate,p===null?(u.childLanes=0,u.lanes=t,u.child=null,u.subtreeFlags=0,u.memoizedProps=null,u.memoizedState=null,u.updateQueue=null,u.dependencies=null,u.stateNode=null):(u.childLanes=p.childLanes,u.lanes=p.lanes,u.child=p.child,u.subtreeFlags=0,u.deletions=null,u.memoizedProps=p.memoizedProps,u.memoizedState=p.memoizedState,u.updateQueue=p.updateQueue,u.type=p.type,t=p.dependencies,u.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return Ts(ha,ha.current&1|2),e.child}t=t.sibling}u.tail!==null&&ja()>tw&&(e.flags|=128,a=!0,qR(u,!1),e.lanes=4194304)}else{if(!a)if(t=FD(p),t!==null){if(e.flags|=128,a=!0,r=t.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),qR(u,!0),u.tail===null&&u.tailMode==="hidden"&&!p.alternate&&!ea)return el(e),null}else 2*ja()-u.renderingStartTime>tw&&r!==1073741824&&(e.flags|=128,a=!0,qR(u,!1),e.lanes=4194304);u.isBackwards?(p.sibling=e.child,e.child=p):(r=u.last,r!==null?r.sibling=p:e.child=p,u.last=p)}return u.tail!==null?(e=u.tail,u.rendering=e,u.tail=e.sibling,u.renderingStartTime=ja(),e.sibling=null,r=ha.current,Ts(ha,a?r&1|2:r&1),e):(el(e),null);case 22:case 23:return M8(),a=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==a&&(e.flags|=8192),a&&e.mode&1?zd&1073741824&&(el(e),e.subtreeFlags&6&&(e.flags|=8192)):el(e),null;case 24:return null;case 25:return null}throw Error(Mt(156,e.tag))}function WCe(t,e){switch(_8(e),e.tag){case 1:return hd(e.type)&&DD(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Zb(),Us(ud),Us(al),R8(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return T8(e),null;case 13:if(Us(ha),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Mt(340));Jb()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Us(ha),null;case 4:return Zb(),null;case 10:return x8(e.type._context),null;case 22:case 23:return M8(),null;case 24:return null;default:return null}}var b2=!1,rl=!1,HCe=typeof WeakSet=="function"?WeakSet:Set,pn=null;function Cb(t,e){var r=t.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(a){Sa(t,e,a)}else r.current=null}function b6(t,e,r){try{r()}catch(a){Sa(t,e,a)}}var Yte=!1;function KCe(t,e){if(s6=ID,t=Roe(),m8(t)){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else e:{r=(r=t.ownerDocument)&&r.defaultView||window;var a=r.getSelection&&r.getSelection();if(a&&a.rangeCount!==0){r=a.anchorNode;var l=a.anchorOffset,u=a.focusNode;a=a.focusOffset;try{r.nodeType,u.nodeType}catch{r=null;break e}var p=0,m=-1,v=-1,w=0,R=0,C=t,A=null;t:for(;;){for(var O;C!==r||l!==0&&C.nodeType!==3||(m=p+l),C!==u||a!==0&&C.nodeType!==3||(v=p+a),C.nodeType===3&&(p+=C.nodeValue.length),(O=C.firstChild)!==null;)A=C,C=O;for(;;){if(C===t)break t;if(A===r&&++w===l&&(m=p),A===u&&++R===a&&(v=p),(O=C.nextSibling)!==null)break;C=A,A=C.parentNode}C=O}r=m===-1||v===-1?null:{start:m,end:v}}else r=null}r=r||{start:0,end:0}}else r=null;for(a6={focusedElem:t,selectionRange:r},ID=!1,pn=e;pn!==null;)if(e=pn,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,pn=t;else for(;pn!==null;){e=pn;try{var U=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(U!==null){var F=U.memoizedProps,q=U.memoizedState,W=e.stateNode,H=W.getSnapshotBeforeUpdate(e.elementType===e.type?F:ep(e.type,F),q);W.__reactInternalSnapshotBeforeUpdate=H}break;case 3:var X=e.stateNode.containerInfo;X.nodeType===1?X.textContent="":X.nodeType===9&&X.documentElement&&X.removeChild(X.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Mt(163))}}catch(ne){Sa(e,e.return,ne)}if(t=e.sibling,t!==null){t.return=e.return,pn=t;break}pn=e.return}return U=Yte,Yte=!1,U}function NC(t,e,r){var a=e.updateQueue;if(a=a!==null?a.lastEffect:null,a!==null){var l=a=a.next;do{if((l.tag&t)===t){var u=l.destroy;l.destroy=void 0,u!==void 0&&b6(e,r,u)}l=l.next}while(l!==a)}}function $O(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var r=e=e.next;do{if((r.tag&t)===t){var a=r.create;r.destroy=a()}r=r.next}while(r!==e)}}function w6(t){var e=t.ref;if(e!==null){var r=t.stateNode;switch(t.tag){case 5:t=r;break;default:t=r}typeof e=="function"?e(t):e.current=t}}function bce(t){var e=t.alternate;e!==null&&(t.alternate=null,bce(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[yf],delete e[sN],delete e[l6],delete e[NCe],delete e[ICe])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function wce(t){return t.tag===5||t.tag===3||t.tag===4}function $te(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||wce(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function S6(t,e,r){var a=t.tag;if(a===5||a===6)t=t.stateNode,e?r.nodeType===8?r.parentNode.insertBefore(t,e):r.insertBefore(t,e):(r.nodeType===8?(e=r.parentNode,e.insertBefore(t,r)):(e=r,e.appendChild(t)),r=r._reactRootContainer,r!=null||e.onclick!==null||(e.onclick=PD));else if(a!==4&&(t=t.child,t!==null))for(S6(t,e,r),t=t.sibling;t!==null;)S6(t,e,r),t=t.sibling}function T6(t,e,r){var a=t.tag;if(a===5||a===6)t=t.stateNode,e?r.insertBefore(t,e):r.appendChild(t);else if(a!==4&&(t=t.child,t!==null))for(T6(t,e,r),t=t.sibling;t!==null;)T6(t,e,r),t=t.sibling}var wc=null,tp=!1;function d_(t,e,r){for(r=r.child;r!==null;)Sce(t,e,r),r=r.sibling}function Sce(t,e,r){if(wf&&typeof wf.onCommitFiberUnmount=="function")try{wf.onCommitFiberUnmount(BO,r)}catch{}switch(r.tag){case 5:rl||Cb(r,e);case 6:var a=wc,l=tp;wc=null,d_(t,e,r),wc=a,tp=l,wc!==null&&(tp?(t=wc,r=r.stateNode,t.nodeType===8?t.parentNode.removeChild(r):t.removeChild(r)):wc.removeChild(r.stateNode));break;case 18:wc!==null&&(tp?(t=wc,r=r.stateNode,t.nodeType===8?yF(t.parentNode,r):t.nodeType===1&&yF(t,r),eN(t)):yF(wc,r.stateNode));break;case 4:a=wc,l=tp,wc=r.stateNode.containerInfo,tp=!0,d_(t,e,r),wc=a,tp=l;break;case 0:case 11:case 14:case 15:if(!rl&&(a=r.updateQueue,a!==null&&(a=a.lastEffect,a!==null))){l=a=a.next;do{var u=l,p=u.destroy;u=u.tag,p!==void 0&&(u&2||u&4)&&b6(r,e,p),l=l.next}while(l!==a)}d_(t,e,r);break;case 1:if(!rl&&(Cb(r,e),a=r.stateNode,typeof a.componentWillUnmount=="function"))try{a.props=r.memoizedProps,a.state=r.memoizedState,a.componentWillUnmount()}catch(m){Sa(r,e,m)}d_(t,e,r);break;case 21:d_(t,e,r);break;case 22:r.mode&1?(rl=(a=rl)||r.memoizedState!==null,d_(t,e,r),rl=a):d_(t,e,r);break;default:d_(t,e,r)}}function Xte(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var r=t.stateNode;r===null&&(r=t.stateNode=new HCe),e.forEach(function(a){var l=tNe.bind(null,t,a);r.has(a)||(r.add(a),a.then(l,l))})}}function $h(t,e){var r=e.deletions;if(r!==null)for(var a=0;a<r.length;a++){var l=r[a];try{var u=t,p=e,m=p;e:for(;m!==null;){switch(m.tag){case 5:wc=m.stateNode,tp=!1;break e;case 3:wc=m.stateNode.containerInfo,tp=!0;break e;case 4:wc=m.stateNode.containerInfo,tp=!0;break e}m=m.return}if(wc===null)throw Error(Mt(160));Sce(u,p,l),wc=null,tp=!1;var v=l.alternate;v!==null&&(v.return=null),l.return=null}catch(w){Sa(l,e,w)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Tce(e,t),e=e.sibling}function Tce(t,e){var r=t.alternate,a=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if($h(e,t),mf(t),a&4){try{NC(3,t,t.return),$O(3,t)}catch(F){Sa(t,t.return,F)}try{NC(5,t,t.return)}catch(F){Sa(t,t.return,F)}}break;case 1:$h(e,t),mf(t),a&512&&r!==null&&Cb(r,r.return);break;case 5:if($h(e,t),mf(t),a&512&&r!==null&&Cb(r,r.return),t.flags&32){var l=t.stateNode;try{XC(l,"")}catch(F){Sa(t,t.return,F)}}if(a&4&&(l=t.stateNode,l!=null)){var u=t.memoizedProps,p=r!==null?r.memoizedProps:u,m=t.type,v=t.updateQueue;if(t.updateQueue=null,v!==null)try{m==="input"&&u.type==="radio"&&u.name!=null&&qae(l,u),$B(m,p);var w=$B(m,u);for(p=0;p<v.length;p+=2){var R=v[p],C=v[p+1];R==="style"?Qae(l,C):R==="dangerouslySetInnerHTML"?Xae(l,C):R==="children"?XC(l,C):n8(l,R,C,w)}switch(m){case"input":WB(l,u);break;case"textarea":Yae(l,u);break;case"select":var A=l._wrapperState.wasMultiple;l._wrapperState.wasMultiple=!!u.multiple;var O=u.value;O!=null?Db(l,!!u.multiple,O,!1):A!==!!u.multiple&&(u.defaultValue!=null?Db(l,!!u.multiple,u.defaultValue,!0):Db(l,!!u.multiple,u.multiple?[]:"",!1))}l[sN]=u}catch(F){Sa(t,t.return,F)}}break;case 6:if($h(e,t),mf(t),a&4){if(t.stateNode===null)throw Error(Mt(162));l=t.stateNode,u=t.memoizedProps;try{l.nodeValue=u}catch(F){Sa(t,t.return,F)}}break;case 3:if($h(e,t),mf(t),a&4&&r!==null&&r.memoizedState.isDehydrated)try{eN(e.containerInfo)}catch(F){Sa(t,t.return,F)}break;case 4:$h(e,t),mf(t);break;case 13:$h(e,t),mf(t),l=t.child,l.flags&8192&&(u=l.memoizedState!==null,l.stateNode.isHidden=u,!u||l.alternate!==null&&l.alternate.memoizedState!==null||(L8=ja())),a&4&&Xte(t);break;case 22:if(R=r!==null&&r.memoizedState!==null,t.mode&1?(rl=(w=rl)||R,$h(e,t),rl=w):$h(e,t),mf(t),a&8192){if(w=t.memoizedState!==null,(t.stateNode.isHidden=w)&&!R&&t.mode&1)for(pn=t,R=t.child;R!==null;){for(C=pn=R;pn!==null;){switch(A=pn,O=A.child,A.tag){case 0:case 11:case 14:case 15:NC(4,A,A.return);break;case 1:Cb(A,A.return);var U=A.stateNode;if(typeof U.componentWillUnmount=="function"){a=A,r=A.return;try{e=a,U.props=e.memoizedProps,U.state=e.memoizedState,U.componentWillUnmount()}catch(F){Sa(a,r,F)}}break;case 5:Cb(A,A.return);break;case 22:if(A.memoizedState!==null){Qte(C);continue}}O!==null?(O.return=A,pn=O):Qte(C)}R=R.sibling}e:for(R=null,C=t;;){if(C.tag===5){if(R===null){R=C;try{l=C.stateNode,w?(u=l.style,typeof u.setProperty=="function"?u.setProperty("display","none","important"):u.display="none"):(m=C.stateNode,v=C.memoizedProps.style,p=v!=null&&v.hasOwnProperty("display")?v.display:null,m.style.display=Jae("display",p))}catch(F){Sa(t,t.return,F)}}}else if(C.tag===6){if(R===null)try{C.stateNode.nodeValue=w?"":C.memoizedProps}catch(F){Sa(t,t.return,F)}}else if((C.tag!==22&&C.tag!==23||C.memoizedState===null||C===t)&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===t)break e;for(;C.sibling===null;){if(C.return===null||C.return===t)break e;R===C&&(R=null),C=C.return}R===C&&(R=null),C.sibling.return=C.return,C=C.sibling}}break;case 19:$h(e,t),mf(t),a&4&&Xte(t);break;case 21:break;default:$h(e,t),mf(t)}}function mf(t){var e=t.flags;if(e&2){try{e:{for(var r=t.return;r!==null;){if(wce(r)){var a=r;break e}r=r.return}throw Error(Mt(160))}switch(a.tag){case 5:var l=a.stateNode;a.flags&32&&(XC(l,""),a.flags&=-33);var u=$te(t);T6(t,u,l);break;case 3:case 4:var p=a.stateNode.containerInfo,m=$te(t);S6(t,m,p);break;default:throw Error(Mt(161))}}catch(v){Sa(t,t.return,v)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function qCe(t,e,r){pn=t,Rce(t)}function Rce(t,e,r){for(var a=(t.mode&1)!==0;pn!==null;){var l=pn,u=l.child;if(l.tag===22&&a){var p=l.memoizedState!==null||b2;if(!p){var m=l.alternate,v=m!==null&&m.memoizedState!==null||rl;m=b2;var w=rl;if(b2=p,(rl=v)&&!w)for(pn=l;pn!==null;)p=pn,v=p.child,p.tag===22&&p.memoizedState!==null?Zte(l):v!==null?(v.return=p,pn=v):Zte(l);for(;u!==null;)pn=u,Rce(u),u=u.sibling;pn=l,b2=m,rl=w}Jte(t)}else l.subtreeFlags&8772&&u!==null?(u.return=l,pn=u):Jte(t)}}function Jte(t){for(;pn!==null;){var e=pn;if(e.flags&8772){var r=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:rl||$O(5,e);break;case 1:var a=e.stateNode;if(e.flags&4&&!rl)if(r===null)a.componentDidMount();else{var l=e.elementType===e.type?r.memoizedProps:ep(e.type,r.memoizedProps);a.componentDidUpdate(l,r.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}var u=e.updateQueue;u!==null&&Lte(e,u,a);break;case 3:var p=e.updateQueue;if(p!==null){if(r=null,e.child!==null)switch(e.child.tag){case 5:r=e.child.stateNode;break;case 1:r=e.child.stateNode}Lte(e,p,r)}break;case 5:var m=e.stateNode;if(r===null&&e.flags&4){r=m;var v=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":v.autoFocus&&r.focus();break;case"img":v.src&&(r.src=v.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var w=e.alternate;if(w!==null){var R=w.memoizedState;if(R!==null){var C=R.dehydrated;C!==null&&eN(C)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Mt(163))}rl||e.flags&512&&w6(e)}catch(A){Sa(e,e.return,A)}}if(e===t){pn=null;break}if(r=e.sibling,r!==null){r.return=e.return,pn=r;break}pn=e.return}}function Qte(t){for(;pn!==null;){var e=pn;if(e===t){pn=null;break}var r=e.sibling;if(r!==null){r.return=e.return,pn=r;break}pn=e.return}}function Zte(t){for(;pn!==null;){var e=pn;try{switch(e.tag){case 0:case 11:case 15:var r=e.return;try{$O(4,e)}catch(v){Sa(e,r,v)}break;case 1:var a=e.stateNode;if(typeof a.componentDidMount=="function"){var l=e.return;try{a.componentDidMount()}catch(v){Sa(e,l,v)}}var u=e.return;try{w6(e)}catch(v){Sa(e,u,v)}break;case 5:var p=e.return;try{w6(e)}catch(v){Sa(e,p,v)}}}catch(v){Sa(e,e.return,v)}if(e===t){pn=null;break}var m=e.sibling;if(m!==null){m.return=e.return,pn=m;break}pn=e.return}}var YCe=Math.ceil,GD=Qm.ReactCurrentDispatcher,D8=Qm.ReactCurrentOwner,Zu=Qm.ReactCurrentBatchConfig,Ti=0,Yo=null,to=null,Nc=0,zd=0,Nb=u0(0),go=0,uN=null,bv=0,XO=0,O8=0,IC=null,sd=null,L8=0,tw=1/0,bm=null,WD=!1,R6=null,F_=null,w2=!1,N_=null,HD=0,AC=0,C6=null,nD=-1,rD=0;function Nl(){return Ti&6?ja():nD!==-1?nD:nD=ja()}function B_(t){return t.mode&1?Ti&2&&Nc!==0?Nc&-Nc:kCe.transition!==null?(rD===0&&(rD=doe()),rD):(t=Xi,t!==0||(t=window.event,t=t===void 0?16:_oe(t.type)),t):1}function ip(t,e,r,a){if(50<AC)throw AC=0,C6=null,Error(Mt(185));BN(t,r,a),(!(Ti&2)||t!==Yo)&&(t===Yo&&(!(Ti&2)&&(XO|=r),go===4&&E_(t,Nc)),pd(t,a),r===1&&Ti===0&&!(e.mode&1)&&(tw=ja()+500,KO&&h0()))}function pd(t,e){var r=t.callbackNode;kRe(t,e);var a=ND(t,t===Yo?Nc:0);if(a===0)r!==null&&cte(r),t.callbackNode=null,t.callbackPriority=0;else if(e=a&-a,t.callbackPriority!==e){if(r!=null&&cte(r),e===1)t.tag===0?ACe(ene.bind(null,t)):joe(ene.bind(null,t)),RCe(function(){!(Ti&6)&&h0()}),r=null;else{switch(uoe(a)){case 1:r=o8;break;case 4:r=coe;break;case 16:r=CD;break;case 536870912:r=loe;break;default:r=CD}r=Oce(r,Cce.bind(null,t))}t.callbackPriority=e,t.callbackNode=r}}function Cce(t,e){if(nD=-1,rD=0,Ti&6)throw Error(Mt(327));var r=t.callbackNode;if(Ub()&&t.callbackNode!==r)return null;var a=ND(t,t===Yo?Nc:0);if(a===0)return null;if(a&30||a&t.expiredLanes||e)e=KD(t,a);else{e=a;var l=Ti;Ti|=2;var u=Ice();(Yo!==t||Nc!==e)&&(bm=null,tw=ja()+500,uv(t,e));do try{JCe();break}catch(m){Nce(t,m)}while(!0);E8(),GD.current=u,Ti=l,to!==null?e=0:(Yo=null,Nc=0,e=go)}if(e!==0){if(e===2&&(l=e6(t),l!==0&&(a=l,e=N6(t,l))),e===1)throw r=uN,uv(t,0),E_(t,a),pd(t,ja()),r;if(e===6)E_(t,a);else{if(l=t.current.alternate,!(a&30)&&!$Ce(l)&&(e=KD(t,a),e===2&&(u=e6(t),u!==0&&(a=u,e=N6(t,u))),e===1))throw r=uN,uv(t,0),E_(t,a),pd(t,ja()),r;switch(t.finishedWork=l,t.finishedLanes=a,e){case 0:case 1:throw Error(Mt(345));case 2:$y(t,sd,bm);break;case 3:if(E_(t,a),(a&130023424)===a&&(e=L8+500-ja(),10<e)){if(ND(t,0)!==0)break;if(l=t.suspendedLanes,(l&a)!==a){Nl(),t.pingedLanes|=t.suspendedLanes&l;break}t.timeoutHandle=c6($y.bind(null,t,sd,bm),e);break}$y(t,sd,bm);break;case 4:if(E_(t,a),(a&4194240)===a)break;for(e=t.eventTimes,l=-1;0<a;){var p=31-rp(a);u=1<<p,p=e[p],p>l&&(l=p),a&=~u}if(a=l,a=ja()-a,a=(120>a?120:480>a?480:1080>a?1080:1920>a?1920:3e3>a?3e3:4320>a?4320:1960*YCe(a/1960))-a,10<a){t.timeoutHandle=c6($y.bind(null,t,sd,bm),a);break}$y(t,sd,bm);break;case 5:$y(t,sd,bm);break;default:throw Error(Mt(329))}}}return pd(t,ja()),t.callbackNode===r?Cce.bind(null,t):null}function N6(t,e){var r=IC;return t.current.memoizedState.isDehydrated&&(uv(t,e).flags|=256),t=KD(t,e),t!==2&&(e=sd,sd=r,e!==null&&I6(e)),t}function I6(t){sd===null?sd=t:sd.push.apply(sd,t)}function $Ce(t){for(var e=t;;){if(e.flags&16384){var r=e.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var a=0;a<r.length;a++){var l=r[a],u=l.getSnapshot;l=l.value;try{if(!cp(u(),l))return!1}catch{return!1}}}if(r=e.child,e.subtreeFlags&16384&&r!==null)r.return=e,e=r;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function E_(t,e){for(e&=~O8,e&=~XO,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var r=31-rp(e),a=1<<r;t[r]=-1,e&=~a}}function ene(t){if(Ti&6)throw Error(Mt(327));Ub();var e=ND(t,0);if(!(e&1))return pd(t,ja()),null;var r=KD(t,e);if(t.tag!==0&&r===2){var a=e6(t);a!==0&&(e=a,r=N6(t,a))}if(r===1)throw r=uN,uv(t,0),E_(t,e),pd(t,ja()),r;if(r===6)throw Error(Mt(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,$y(t,sd,bm),pd(t,ja()),null}function j8(t,e){var r=Ti;Ti|=1;try{return t(e)}finally{Ti=r,Ti===0&&(tw=ja()+500,KO&&h0())}}function wv(t){N_!==null&&N_.tag===0&&!(Ti&6)&&Ub();var e=Ti;Ti|=1;var r=Zu.transition,a=Xi;try{if(Zu.transition=null,Xi=1,t)return t()}finally{Xi=a,Zu.transition=r,Ti=e,!(Ti&6)&&h0()}}function M8(){zd=Nb.current,Us(Nb)}function uv(t,e){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(r!==-1&&(t.timeoutHandle=-1,TCe(r)),to!==null)for(r=to.return;r!==null;){var a=r;switch(_8(a),a.tag){case 1:a=a.type.childContextTypes,a!=null&&DD();break;case 3:Zb(),Us(ud),Us(al),R8();break;case 5:T8(a);break;case 4:Zb();break;case 13:Us(ha);break;case 19:Us(ha);break;case 10:x8(a.type._context);break;case 22:case 23:M8()}r=r.return}if(Yo=t,to=t=z_(t.current,null),Nc=zd=e,go=0,uN=null,O8=XO=bv=0,sd=IC=null,av!==null){for(e=0;e<av.length;e++)if(r=av[e],a=r.interleaved,a!==null){r.interleaved=null;var l=a.next,u=r.pending;if(u!==null){var p=u.next;u.next=l,a.next=p}r.pending=a}av=null}return t}function Nce(t,e){do{var r=to;try{if(E8(),Z2.current=zD,BD){for(var a=fa.memoizedState;a!==null;){var l=a.queue;l!==null&&(l.pending=null),a=a.next}BD=!1}if(xv=0,Go=mo=fa=null,CC=!1,cN=0,D8.current=null,r===null||r.return===null){go=1,uN=e,to=null;break}e:{var u=t,p=r.return,m=r,v=e;if(e=Nc,m.flags|=32768,v!==null&&typeof v=="object"&&typeof v.then=="function"){var w=v,R=m,C=R.tag;if(!(R.mode&1)&&(C===0||C===11||C===15)){var A=R.alternate;A?(R.updateQueue=A.updateQueue,R.memoizedState=A.memoizedState,R.lanes=A.lanes):(R.updateQueue=null,R.memoizedState=null)}var O=Bte(p);if(O!==null){O.flags&=-257,zte(O,p,m,u,e),O.mode&1&&Fte(u,w,e),e=O,v=w;var U=e.updateQueue;if(U===null){var F=new Set;F.add(v),e.updateQueue=F}else U.add(v);break e}else{if(!(e&1)){Fte(u,w,e),U8();break e}v=Error(Mt(426))}}else if(ea&&m.mode&1){var q=Bte(p);if(q!==null){!(q.flags&65536)&&(q.flags|=256),zte(q,p,m,u,e),y8(ew(v,m));break e}}u=v=ew(v,m),go!==4&&(go=2),IC===null?IC=[u]:IC.push(u),u=p;do{switch(u.tag){case 3:u.flags|=65536,e&=-e,u.lanes|=e;var W=uce(u,v,e);Ote(u,W);break e;case 1:m=v;var H=u.type,X=u.stateNode;if(!(u.flags&128)&&(typeof H.getDerivedStateFromError=="function"||X!==null&&typeof X.componentDidCatch=="function"&&(F_===null||!F_.has(X)))){u.flags|=65536,e&=-e,u.lanes|=e;var ne=hce(u,m,e);Ote(u,ne);break e}}u=u.return}while(u!==null)}kce(r)}catch(te){e=te,to===r&&r!==null&&(to=r=r.return);continue}break}while(!0)}function Ice(){var t=GD.current;return GD.current=zD,t===null?zD:t}function U8(){(go===0||go===3||go===2)&&(go=4),Yo===null||!(bv&268435455)&&!(XO&268435455)||E_(Yo,Nc)}function KD(t,e){var r=Ti;Ti|=2;var a=Ice();(Yo!==t||Nc!==e)&&(bm=null,uv(t,e));do try{XCe();break}catch(l){Nce(t,l)}while(!0);if(E8(),Ti=r,GD.current=a,to!==null)throw Error(Mt(261));return Yo=null,Nc=0,go}function XCe(){for(;to!==null;)Ace(to)}function JCe(){for(;to!==null&&!bRe();)Ace(to)}function Ace(t){var e=Dce(t.alternate,t,zd);t.memoizedProps=t.pendingProps,e===null?kce(t):to=e,D8.current=null}function kce(t){var e=t;do{var r=e.alternate;if(t=e.return,e.flags&32768){if(r=WCe(r,e),r!==null){r.flags&=32767,to=r;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{go=6,to=null;return}}else if(r=GCe(r,e,zd),r!==null){to=r;return}if(e=e.sibling,e!==null){to=e;return}to=e=t}while(e!==null);go===0&&(go=5)}function $y(t,e,r){var a=Xi,l=Zu.transition;try{Zu.transition=null,Xi=1,QCe(t,e,r,a)}finally{Zu.transition=l,Xi=a}return null}function QCe(t,e,r,a){do Ub();while(N_!==null);if(Ti&6)throw Error(Mt(327));r=t.finishedWork;var l=t.finishedLanes;if(r===null)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(Mt(177));t.callbackNode=null,t.callbackPriority=0;var u=r.lanes|r.childLanes;if(PRe(t,u),t===Yo&&(to=Yo=null,Nc=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||w2||(w2=!0,Oce(CD,function(){return Ub(),null})),u=(r.flags&15990)!==0,r.subtreeFlags&15990||u){u=Zu.transition,Zu.transition=null;var p=Xi;Xi=1;var m=Ti;Ti|=4,D8.current=null,KCe(t,r),Tce(r,t),yCe(a6),ID=!!s6,a6=s6=null,t.current=r,qCe(r),wRe(),Ti=m,Xi=p,Zu.transition=u}else t.current=r;if(w2&&(w2=!1,N_=t,HD=l),u=t.pendingLanes,u===0&&(F_=null),RRe(r.stateNode),pd(t,ja()),e!==null)for(a=t.onRecoverableError,r=0;r<e.length;r++)l=e[r],a(l.value,{componentStack:l.stack,digest:l.digest});if(WD)throw WD=!1,t=R6,R6=null,t;return HD&1&&t.tag!==0&&Ub(),u=t.pendingLanes,u&1?t===C6?AC++:(AC=0,C6=t):AC=0,h0(),null}function Ub(){if(N_!==null){var t=uoe(HD),e=Zu.transition,r=Xi;try{if(Zu.transition=null,Xi=16>t?16:t,N_===null)var a=!1;else{if(t=N_,N_=null,HD=0,Ti&6)throw Error(Mt(331));var l=Ti;for(Ti|=4,pn=t.current;pn!==null;){var u=pn,p=u.child;if(pn.flags&16){var m=u.deletions;if(m!==null){for(var v=0;v<m.length;v++){var w=m[v];for(pn=w;pn!==null;){var R=pn;switch(R.tag){case 0:case 11:case 15:NC(8,R,u)}var C=R.child;if(C!==null)C.return=R,pn=C;else for(;pn!==null;){R=pn;var A=R.sibling,O=R.return;if(bce(R),R===w){pn=null;break}if(A!==null){A.return=O,pn=A;break}pn=O}}}var U=u.alternate;if(U!==null){var F=U.child;if(F!==null){U.child=null;do{var q=F.sibling;F.sibling=null,F=q}while(F!==null)}}pn=u}}if(u.subtreeFlags&2064&&p!==null)p.return=u,pn=p;else e:for(;pn!==null;){if(u=pn,u.flags&2048)switch(u.tag){case 0:case 11:case 15:NC(9,u,u.return)}var W=u.sibling;if(W!==null){W.return=u.return,pn=W;break e}pn=u.return}}var H=t.current;for(pn=H;pn!==null;){p=pn;var X=p.child;if(p.subtreeFlags&2064&&X!==null)X.return=p,pn=X;else e:for(p=H;pn!==null;){if(m=pn,m.flags&2048)try{switch(m.tag){case 0:case 11:case 15:$O(9,m)}}catch(te){Sa(m,m.return,te)}if(m===p){pn=null;break e}var ne=m.sibling;if(ne!==null){ne.return=m.return,pn=ne;break e}pn=m.return}}if(Ti=l,h0(),wf&&typeof wf.onPostCommitFiberRoot=="function")try{wf.onPostCommitFiberRoot(BO,t)}catch{}a=!0}return a}finally{Xi=r,Zu.transition=e}}return!1}function tne(t,e,r){e=ew(r,e),e=uce(t,e,1),t=V_(t,e,1),e=Nl(),t!==null&&(BN(t,1,e),pd(t,e))}function Sa(t,e,r){if(t.tag===3)tne(t,t,r);else for(;e!==null;){if(e.tag===3){tne(e,t,r);break}else if(e.tag===1){var a=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof a.componentDidCatch=="function"&&(F_===null||!F_.has(a))){t=ew(r,t),t=hce(e,t,1),e=V_(e,t,1),t=Nl(),e!==null&&(BN(e,1,t),pd(e,t));break}}e=e.return}}function ZCe(t,e,r){var a=t.pingCache;a!==null&&a.delete(e),e=Nl(),t.pingedLanes|=t.suspendedLanes&r,Yo===t&&(Nc&r)===r&&(go===4||go===3&&(Nc&130023424)===Nc&&500>ja()-L8?uv(t,0):O8|=r),pd(t,e)}function Pce(t,e){e===0&&(t.mode&1?(e=p2,p2<<=1,!(p2&130023424)&&(p2=4194304)):e=1);var r=Nl();t=zm(t,e),t!==null&&(BN(t,e,r),pd(t,r))}function eNe(t){var e=t.memoizedState,r=0;e!==null&&(r=e.retryLane),Pce(t,r)}function tNe(t,e){var r=0;switch(t.tag){case 13:var a=t.stateNode,l=t.memoizedState;l!==null&&(r=l.retryLane);break;case 19:a=t.stateNode;break;default:throw Error(Mt(314))}a!==null&&a.delete(e),Pce(t,r)}var Dce;Dce=function(t,e,r){if(t!==null)if(t.memoizedProps!==e.pendingProps||ud.current)ad=!0;else{if(!(t.lanes&r)&&!(e.flags&128))return ad=!1,zCe(t,e,r);ad=!!(t.flags&131072)}else ad=!1,ea&&e.flags&1048576&&Moe(e,jD,e.index);switch(e.lanes=0,e.tag){case 2:var a=e.type;tD(t,e),t=e.pendingProps;var l=Xb(e,al.current);Mb(e,r),l=N8(null,e,a,t,l,r);var u=I8();return e.flags|=1,typeof l=="object"&&l!==null&&typeof l.render=="function"&&l.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,hd(a)?(u=!0,OD(e)):u=!1,e.memoizedState=l.state!==null&&l.state!==void 0?l.state:null,w8(e),l.updater=YO,e.stateNode=l,l._reactInternals=e,m6(e,a,t,r),e=y6(null,e,a,!0,u,r)):(e.tag=0,ea&&u&&g8(e),Sl(null,e,l,r),e=e.child),e;case 16:a=e.elementType;e:{switch(tD(t,e),t=e.pendingProps,l=a._init,a=l(a._payload),e.type=a,l=e.tag=rNe(a),t=ep(a,t),l){case 0:e=_6(null,e,a,t,r);break e;case 1:e=Hte(null,e,a,t,r);break e;case 11:e=Gte(null,e,a,t,r);break e;case 14:e=Wte(null,e,a,ep(a.type,t),r);break e}throw Error(Mt(306,a,""))}return e;case 0:return a=e.type,l=e.pendingProps,l=e.elementType===a?l:ep(a,l),_6(t,e,a,l,r);case 1:return a=e.type,l=e.pendingProps,l=e.elementType===a?l:ep(a,l),Hte(t,e,a,l,r);case 3:e:{if(gce(e),t===null)throw Error(Mt(387));a=e.pendingProps,u=e.memoizedState,l=u.element,Goe(t,e),VD(e,a,null,r);var p=e.memoizedState;if(a=p.element,u.isDehydrated)if(u={element:a,isDehydrated:!1,cache:p.cache,pendingSuspenseBoundaries:p.pendingSuspenseBoundaries,transitions:p.transitions},e.updateQueue.baseState=u,e.memoizedState=u,e.flags&256){l=ew(Error(Mt(423)),e),e=Kte(t,e,a,r,l);break e}else if(a!==l){l=ew(Error(Mt(424)),e),e=Kte(t,e,a,r,l);break e}else for(Hd=U_(e.stateNode.containerInfo.firstChild),qd=e,ea=!0,np=null,r=Boe(e,null,a,r),e.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(Jb(),a===l){e=Gm(t,e,r);break e}Sl(t,e,a,r)}e=e.child}return e;case 5:return Woe(e),t===null&&h6(e),a=e.type,l=e.pendingProps,u=t!==null?t.memoizedProps:null,p=l.children,o6(a,l)?p=null:u!==null&&o6(a,u)&&(e.flags|=32),mce(t,e),Sl(t,e,p,r),e.child;case 6:return t===null&&h6(e),null;case 13:return _ce(t,e,r);case 4:return S8(e,e.stateNode.containerInfo),a=e.pendingProps,t===null?e.child=Qb(e,null,a,r):Sl(t,e,a,r),e.child;case 11:return a=e.type,l=e.pendingProps,l=e.elementType===a?l:ep(a,l),Gte(t,e,a,l,r);case 7:return Sl(t,e,e.pendingProps,r),e.child;case 8:return Sl(t,e,e.pendingProps.children,r),e.child;case 12:return Sl(t,e,e.pendingProps.children,r),e.child;case 10:e:{if(a=e.type._context,l=e.pendingProps,u=e.memoizedProps,p=l.value,Ts(MD,a._currentValue),a._currentValue=p,u!==null)if(cp(u.value,p)){if(u.children===l.children&&!ud.current){e=Gm(t,e,r);break e}}else for(u=e.child,u!==null&&(u.return=e);u!==null;){var m=u.dependencies;if(m!==null){p=u.child;for(var v=m.firstContext;v!==null;){if(v.context===a){if(u.tag===1){v=jm(-1,r&-r),v.tag=2;var w=u.updateQueue;if(w!==null){w=w.shared;var R=w.pending;R===null?v.next=v:(v.next=R.next,R.next=v),w.pending=v}}u.lanes|=r,v=u.alternate,v!==null&&(v.lanes|=r),p6(u.return,r,e),m.lanes|=r;break}v=v.next}}else if(u.tag===10)p=u.type===e.type?null:u.child;else if(u.tag===18){if(p=u.return,p===null)throw Error(Mt(341));p.lanes|=r,m=p.alternate,m!==null&&(m.lanes|=r),p6(p,r,e),p=u.sibling}else p=u.child;if(p!==null)p.return=u;else for(p=u;p!==null;){if(p===e){p=null;break}if(u=p.sibling,u!==null){u.return=p.return,p=u;break}p=p.return}u=p}Sl(t,e,l.children,r),e=e.child}return e;case 9:return l=e.type,a=e.pendingProps.children,Mb(e,r),l=th(l),a=a(l),e.flags|=1,Sl(t,e,a,r),e.child;case 14:return a=e.type,l=ep(a,e.pendingProps),l=ep(a.type,l),Wte(t,e,a,l,r);case 15:return pce(t,e,e.type,e.pendingProps,r);case 17:return a=e.type,l=e.pendingProps,l=e.elementType===a?l:ep(a,l),tD(t,e),e.tag=1,hd(a)?(t=!0,OD(e)):t=!1,Mb(e,r),dce(e,a,l),m6(e,a,l,r),y6(null,e,a,!0,t,r);case 19:return yce(t,e,r);case 22:return fce(t,e,r)}throw Error(Mt(156,e.tag))};function Oce(t,e){return ooe(t,e)}function nNe(t,e,r,a){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=a,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Xu(t,e,r,a){return new nNe(t,e,r,a)}function V8(t){return t=t.prototype,!(!t||!t.isReactComponent)}function rNe(t){if(typeof t=="function")return V8(t)?1:0;if(t!=null){if(t=t.$$typeof,t===i8)return 11;if(t===s8)return 14}return 2}function z_(t,e){var r=t.alternate;return r===null?(r=Xu(t.tag,e,t.key,t.mode),r.elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=e,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=t.flags&14680064,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,e=t.dependencies,r.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function iD(t,e,r,a,l,u){var p=2;if(a=t,typeof t=="function")V8(t)&&(p=1);else if(typeof t=="string")p=5;else e:switch(t){case yb:return hv(r.children,l,u,e);case r8:p=8,l|=8;break;case VB:return t=Xu(12,r,e,l|2),t.elementType=VB,t.lanes=u,t;case FB:return t=Xu(13,r,e,l),t.elementType=FB,t.lanes=u,t;case BB:return t=Xu(19,r,e,l),t.elementType=BB,t.lanes=u,t;case Wae:return JO(r,l,u,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case zae:p=10;break e;case Gae:p=9;break e;case i8:p=11;break e;case s8:p=14;break e;case g_:p=16,a=null;break e}throw Error(Mt(130,t==null?t:typeof t,""))}return e=Xu(p,r,e,l),e.elementType=t,e.type=a,e.lanes=u,e}function hv(t,e,r,a){return t=Xu(7,t,a,e),t.lanes=r,t}function JO(t,e,r,a){return t=Xu(22,t,a,e),t.elementType=Wae,t.lanes=r,t.stateNode={isHidden:!1},t}function RF(t,e,r){return t=Xu(6,t,null,e),t.lanes=r,t}function CF(t,e,r){return e=Xu(4,t.children!==null?t.children:[],t.key,e),e.lanes=r,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function iNe(t,e,r,a,l){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=oF(0),this.expirationTimes=oF(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=oF(0),this.identifierPrefix=a,this.onRecoverableError=l,this.mutableSourceEagerHydrationData=null}function F8(t,e,r,a,l,u,p,m,v){return t=new iNe(t,e,r,m,v),e===1?(e=1,u===!0&&(e|=8)):e=0,u=Xu(3,null,null,e),t.current=u,u.stateNode=t,u.memoizedState={element:a,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},w8(u),t}function sNe(t,e,r){var a=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:_b,key:a==null?null:""+a,children:t,containerInfo:e,implementation:r}}function Lce(t){if(!t)return X_;t=t._reactInternals;e:{if(Fv(t)!==t||t.tag!==1)throw Error(Mt(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(hd(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Mt(171))}if(t.tag===1){var r=t.type;if(hd(r))return Loe(t,r,e)}return e}function jce(t,e,r,a,l,u,p,m,v){return t=F8(r,a,!0,t,l,u,p,m,v),t.context=Lce(null),r=t.current,a=Nl(),l=B_(r),u=jm(a,l),u.callback=e??null,V_(r,u,l),t.current.lanes=l,BN(t,l,a),pd(t,a),t}function QO(t,e,r,a){var l=e.current,u=Nl(),p=B_(l);return r=Lce(r),e.context===null?e.context=r:e.pendingContext=r,e=jm(u,p),e.payload={element:t},a=a===void 0?null:a,a!==null&&(e.callback=a),t=V_(l,e,p),t!==null&&(ip(t,l,p,u),Q2(t,l,p)),p}function qD(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function nne(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var r=t.retryLane;t.retryLane=r!==0&&r<e?r:e}}function B8(t,e){nne(t,e),(t=t.alternate)&&nne(t,e)}function aNe(){return null}var Mce=typeof reportError=="function"?reportError:function(t){console.error(t)};function z8(t){this._internalRoot=t}ZO.prototype.render=z8.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Mt(409));QO(t,e,null,null)};ZO.prototype.unmount=z8.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;wv(function(){QO(null,t,null,null)}),e[Bm]=null}};function ZO(t){this._internalRoot=t}ZO.prototype.unstable_scheduleHydration=function(t){if(t){var e=foe();t={blockedOn:null,target:t,priority:e};for(var r=0;r<v_.length&&e!==0&&e<v_[r].priority;r++);v_.splice(r,0,t),r===0&&goe(t)}};function G8(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function eL(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function rne(){}function oNe(t,e,r,a,l){if(l){if(typeof a=="function"){var u=a;a=function(){var w=qD(p);u.call(w)}}var p=jce(e,a,t,0,null,!1,!1,"",rne);return t._reactRootContainer=p,t[Bm]=p.current,rN(t.nodeType===8?t.parentNode:t),wv(),p}for(;l=t.lastChild;)t.removeChild(l);if(typeof a=="function"){var m=a;a=function(){var w=qD(v);m.call(w)}}var v=F8(t,0,!1,null,null,!1,!1,"",rne);return t._reactRootContainer=v,t[Bm]=v.current,rN(t.nodeType===8?t.parentNode:t),wv(function(){QO(e,v,r,a)}),v}function tL(t,e,r,a,l){var u=r._reactRootContainer;if(u){var p=u;if(typeof l=="function"){var m=l;l=function(){var v=qD(p);m.call(v)}}QO(e,p,t,l)}else p=oNe(r,e,t,l,a);return qD(p)}hoe=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var r=cC(e.pendingLanes);r!==0&&(c8(e,r|1),pd(e,ja()),!(Ti&6)&&(tw=ja()+500,h0()))}break;case 13:wv(function(){var a=zm(t,1);if(a!==null){var l=Nl();ip(a,t,1,l)}}),B8(t,1)}};l8=function(t){if(t.tag===13){var e=zm(t,134217728);if(e!==null){var r=Nl();ip(e,t,134217728,r)}B8(t,134217728)}};poe=function(t){if(t.tag===13){var e=B_(t),r=zm(t,e);if(r!==null){var a=Nl();ip(r,t,e,a)}B8(t,e)}};foe=function(){return Xi};moe=function(t,e){var r=Xi;try{return Xi=t,e()}finally{Xi=r}};JB=function(t,e,r){switch(e){case"input":if(WB(t,r),e=r.name,r.type==="radio"&&e!=null){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<r.length;e++){var a=r[e];if(a!==t&&a.form===t.form){var l=HO(a);if(!l)throw Error(Mt(90));Kae(a),WB(a,l)}}}break;case"textarea":Yae(t,r);break;case"select":e=r.value,e!=null&&Db(t,!!r.multiple,e,!1)}};toe=j8;noe=wv;var cNe={usingClientEntryPoint:!1,Events:[GN,bb,HO,Zae,eoe,j8]},YR={findFiberByHostInstance:sv,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},lNe={bundleType:YR.bundleType,version:YR.version,rendererPackageName:YR.rendererPackageName,rendererConfig:YR.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Qm.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=soe(t),t===null?null:t.stateNode},findFiberByHostInstance:YR.findFiberByHostInstance||aNe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var S2=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!S2.isDisabled&&S2.supportsFiber)try{BO=S2.inject(lNe),wf=S2}catch{}}Zd.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=cNe;Zd.createPortal=function(t,e){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!G8(e))throw Error(Mt(200));return sNe(t,e,null,r)};Zd.createRoot=function(t,e){if(!G8(t))throw Error(Mt(299));var r=!1,a="",l=Mce;return e!=null&&(e.unstable_strictMode===!0&&(r=!0),e.identifierPrefix!==void 0&&(a=e.identifierPrefix),e.onRecoverableError!==void 0&&(l=e.onRecoverableError)),e=F8(t,1,!1,null,null,r,!1,a,l),t[Bm]=e.current,rN(t.nodeType===8?t.parentNode:t),new z8(e)};Zd.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Mt(188)):(t=Object.keys(t).join(","),Error(Mt(268,t)));return t=soe(e),t=t===null?null:t.stateNode,t};Zd.flushSync=function(t){return wv(t)};Zd.hydrate=function(t,e,r){if(!eL(e))throw Error(Mt(200));return tL(null,t,e,!0,r)};Zd.hydrateRoot=function(t,e,r){if(!G8(t))throw Error(Mt(405));var a=r!=null&&r.hydratedSources||null,l=!1,u="",p=Mce;if(r!=null&&(r.unstable_strictMode===!0&&(l=!0),r.identifierPrefix!==void 0&&(u=r.identifierPrefix),r.onRecoverableError!==void 0&&(p=r.onRecoverableError)),e=jce(e,null,t,1,r??null,l,!1,u,p),t[Bm]=e.current,rN(t),a)for(t=0;t<a.length;t++)r=a[t],l=r._getVersion,l=l(r._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[r,l]:e.mutableSourceEagerHydrationData.push(r,l);return new ZO(e)};Zd.render=function(t,e,r){if(!eL(e))throw Error(Mt(200));return tL(null,t,e,!1,r)};Zd.unmountComponentAtNode=function(t){if(!eL(t))throw Error(Mt(40));return t._reactRootContainer?(wv(function(){tL(null,null,t,!1,function(){t._reactRootContainer=null,t[Bm]=null})}),!0):!1};Zd.unstable_batchedUpdates=j8;Zd.unstable_renderSubtreeIntoContainer=function(t,e,r,a){if(!eL(r))throw Error(Mt(200));if(t==null||t._reactInternals===void 0)throw Error(Mt(38));return tL(t,e,r,!1,a)};Zd.version="18.3.1-next-f1338f8080-20240426";function Uce(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Uce)}catch(t){console.error(t)}}Uce(),Uae.exports=Zd;var Vce=Uae.exports,ine=Vce;MB.createRoot=ine.createRoot,MB.hydrateRoot=ine.hydrateRoot;/**
 * @remix-run/router v1.23.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function hN(){return hN=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},hN.apply(this,arguments)}var I_;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(I_||(I_={}));const sne="popstate";function dNe(t){t===void 0&&(t={});function e(a,l){let{pathname:u,search:p,hash:m}=a.location;return A6("",{pathname:u,search:p,hash:m},l.state&&l.state.usr||null,l.state&&l.state.key||"default")}function r(a,l){return typeof l=="string"?l:YD(l)}return hNe(e,r,null,t)}function ma(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function W8(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function uNe(){return Math.random().toString(36).substr(2,8)}function ane(t,e){return{usr:t.state,key:t.key,idx:e}}function A6(t,e,r,a){return r===void 0&&(r=null),hN({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?kw(e):e,{state:r,key:e&&e.key||a||uNe()})}function YD(t){let{pathname:e="/",search:r="",hash:a=""}=t;return r&&r!=="?"&&(e+=r.charAt(0)==="?"?r:"?"+r),a&&a!=="#"&&(e+=a.charAt(0)==="#"?a:"#"+a),e}function kw(t){let e={};if(t){let r=t.indexOf("#");r>=0&&(e.hash=t.substr(r),t=t.substr(0,r));let a=t.indexOf("?");a>=0&&(e.search=t.substr(a),t=t.substr(0,a)),t&&(e.pathname=t)}return e}function hNe(t,e,r,a){a===void 0&&(a={});let{window:l=document.defaultView,v5Compat:u=!1}=a,p=l.history,m=I_.Pop,v=null,w=R();w==null&&(w=0,p.replaceState(hN({},p.state,{idx:w}),""));function R(){return(p.state||{idx:null}).idx}function C(){m=I_.Pop;let q=R(),W=q==null?null:q-w;w=q,v&&v({action:m,location:F.location,delta:W})}function A(q,W){m=I_.Push;let H=A6(F.location,q,W);w=R()+1;let X=ane(H,w),ne=F.createHref(H);try{p.pushState(X,"",ne)}catch(te){if(te instanceof DOMException&&te.name==="DataCloneError")throw te;l.location.assign(ne)}u&&v&&v({action:m,location:F.location,delta:1})}function O(q,W){m=I_.Replace;let H=A6(F.location,q,W);w=R();let X=ane(H,w),ne=F.createHref(H);p.replaceState(X,"",ne),u&&v&&v({action:m,location:F.location,delta:0})}function U(q){let W=l.location.origin!=="null"?l.location.origin:l.location.href,H=typeof q=="string"?q:YD(q);return H=H.replace(/ $/,"%20"),ma(W,"No window.location.(origin|href) available to create URL for href: "+H),new URL(H,W)}let F={get action(){return m},get location(){return t(l,p)},listen(q){if(v)throw new Error("A history only accepts one active listener");return l.addEventListener(sne,C),v=q,()=>{l.removeEventListener(sne,C),v=null}},createHref(q){return e(l,q)},createURL:U,encodeLocation(q){let W=U(q);return{pathname:W.pathname,search:W.search,hash:W.hash}},push:A,replace:O,go(q){return p.go(q)}};return F}var one;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(one||(one={}));function pNe(t,e,r){return r===void 0&&(r="/"),fNe(t,e,r)}function fNe(t,e,r,a){let l=typeof e=="string"?kw(e):e,u=nw(l.pathname||"/",r);if(u==null)return null;let p=Fce(t);mNe(p);let m=null;for(let v=0;m==null&&v<p.length;++v){let w=RNe(u);m=SNe(p[v],w)}return m}function Fce(t,e,r,a){e===void 0&&(e=[]),r===void 0&&(r=[]),a===void 0&&(a="");let l=(u,p,m)=>{let v={relativePath:m===void 0?u.path||"":m,caseSensitive:u.caseSensitive===!0,childrenIndex:p,route:u};v.relativePath.startsWith("/")&&(ma(v.relativePath.startsWith(a),'Absolute route path "'+v.relativePath+'" nested under path '+('"'+a+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),v.relativePath=v.relativePath.slice(a.length));let w=G_([a,v.relativePath]),R=r.concat(v);u.children&&u.children.length>0&&(ma(u.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+w+'".')),Fce(u.children,e,R,w)),!(u.path==null&&!u.index)&&e.push({path:w,score:bNe(w,u.index),routesMeta:R})};return t.forEach((u,p)=>{var m;if(u.path===""||!((m=u.path)!=null&&m.includes("?")))l(u,p);else for(let v of Bce(u.path))l(u,p,v)}),e}function Bce(t){let e=t.split("/");if(e.length===0)return[];let[r,...a]=e,l=r.endsWith("?"),u=r.replace(/\?$/,"");if(a.length===0)return l?[u,""]:[u];let p=Bce(a.join("/")),m=[];return m.push(...p.map(v=>v===""?u:[u,v].join("/"))),l&&m.push(...p),m.map(v=>t.startsWith("/")&&v===""?"/":v)}function mNe(t){t.sort((e,r)=>e.score!==r.score?r.score-e.score:wNe(e.routesMeta.map(a=>a.childrenIndex),r.routesMeta.map(a=>a.childrenIndex)))}const gNe=/^:[\w-]+$/,_Ne=3,yNe=2,vNe=1,ENe=10,xNe=-2,cne=t=>t==="*";function bNe(t,e){let r=t.split("/"),a=r.length;return r.some(cne)&&(a+=xNe),e&&(a+=yNe),r.filter(l=>!cne(l)).reduce((l,u)=>l+(gNe.test(u)?_Ne:u===""?vNe:ENe),a)}function wNe(t,e){return t.length===e.length&&t.slice(0,-1).every((a,l)=>a===e[l])?t[t.length-1]-e[e.length-1]:0}function SNe(t,e,r){let{routesMeta:a}=t,l={},u="/",p=[];for(let m=0;m<a.length;++m){let v=a[m],w=m===a.length-1,R=u==="/"?e:e.slice(u.length)||"/",C=k6({path:v.relativePath,caseSensitive:v.caseSensitive,end:w},R),A=v.route;if(!C)return null;Object.assign(l,C.params),p.push({params:l,pathname:G_([u,C.pathname]),pathnameBase:kNe(G_([u,C.pathnameBase])),route:A}),C.pathnameBase!=="/"&&(u=G_([u,C.pathnameBase]))}return p}function k6(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,a]=TNe(t.path,t.caseSensitive,t.end),l=e.match(r);if(!l)return null;let u=l[0],p=u.replace(/(.)\/+$/,"$1"),m=l.slice(1);return{params:a.reduce((w,R,C)=>{let{paramName:A,isOptional:O}=R;if(A==="*"){let F=m[C]||"";p=u.slice(0,u.length-F.length).replace(/(.)\/+$/,"$1")}const U=m[C];return O&&!U?w[A]=void 0:w[A]=(U||"").replace(/%2F/g,"/"),w},{}),pathname:u,pathnameBase:p,pattern:t}}function TNe(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!0),W8(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let a=[],l="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(p,m,v)=>(a.push({paramName:m,isOptional:v!=null}),v?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(a.push({paramName:"*"}),l+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?l+="\\/*$":t!==""&&t!=="/"&&(l+="(?:(?=\\/|$))"),[new RegExp(l,e?void 0:"i"),a]}function RNe(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return W8(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function nw(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let r=e.endsWith("/")?e.length-1:e.length,a=t.charAt(r);return a&&a!=="/"?null:t.slice(r)||"/"}const CNe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,NNe=t=>CNe.test(t);function INe(t,e){e===void 0&&(e="/");let{pathname:r,search:a="",hash:l=""}=typeof t=="string"?kw(t):t,u;if(r)if(NNe(r))u=r;else{if(r.includes("//")){let p=r;r=r.replace(/\/\/+/g,"/"),W8(!1,"Pathnames cannot have embedded double slashes - normalizing "+(p+" -> "+r))}r.startsWith("/")?u=lne(r.substring(1),"/"):u=lne(r,e)}else u=e;return{pathname:u,search:PNe(a),hash:DNe(l)}}function lne(t,e){let r=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(l=>{l===".."?r.length>1&&r.pop():l!=="."&&r.push(l)}),r.length>1?r.join("/"):"/"}function NF(t,e,r,a){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(a)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function ANe(t){return t.filter((e,r)=>r===0||e.route.path&&e.route.path.length>0)}function H8(t,e){let r=ANe(t);return e?r.map((a,l)=>l===r.length-1?a.pathname:a.pathnameBase):r.map(a=>a.pathnameBase)}function K8(t,e,r,a){a===void 0&&(a=!1);let l;typeof t=="string"?l=kw(t):(l=hN({},t),ma(!l.pathname||!l.pathname.includes("?"),NF("?","pathname","search",l)),ma(!l.pathname||!l.pathname.includes("#"),NF("#","pathname","hash",l)),ma(!l.search||!l.search.includes("#"),NF("#","search","hash",l)));let u=t===""||l.pathname==="",p=u?"/":l.pathname,m;if(p==null)m=r;else{let C=e.length-1;if(!a&&p.startsWith("..")){let A=p.split("/");for(;A[0]==="..";)A.shift(),C-=1;l.pathname=A.join("/")}m=C>=0?e[C]:"/"}let v=INe(l,m),w=p&&p!=="/"&&p.endsWith("/"),R=(u||p===".")&&r.endsWith("/");return!v.pathname.endsWith("/")&&(w||R)&&(v.pathname+="/"),v}const G_=t=>t.join("/").replace(/\/\/+/g,"/"),kNe=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),PNe=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,DNe=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function ONe(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const zce=["post","put","patch","delete"];new Set(zce);const LNe=["get",...zce];new Set(LNe);/**
 * React Router v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function pN(){return pN=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},pN.apply(this,arguments)}const nL=V.createContext(null),Gce=V.createContext(null),Zm=V.createContext(null),rL=V.createContext(null),eg=V.createContext({outlet:null,matches:[],isDataRoute:!1}),Wce=V.createContext(null);function jNe(t,e){let{relative:r}=e===void 0?{}:e;Pw()||ma(!1);let{basename:a,navigator:l}=V.useContext(Zm),{hash:u,pathname:p,search:m}=iL(t,{relative:r}),v=p;return a!=="/"&&(v=p==="/"?a:G_([a,p])),l.createHref({pathname:v,search:m,hash:u})}function Pw(){return V.useContext(rL)!=null}function dp(){return Pw()||ma(!1),V.useContext(rL).location}function Hce(t){V.useContext(Zm).static||V.useLayoutEffect(t)}function yr(){let{isDataRoute:t}=V.useContext(eg);return t?$Ne():MNe()}function MNe(){Pw()||ma(!1);let t=V.useContext(nL),{basename:e,future:r,navigator:a}=V.useContext(Zm),{matches:l}=V.useContext(eg),{pathname:u}=dp(),p=JSON.stringify(H8(l,r.v7_relativeSplatPath)),m=V.useRef(!1);return Hce(()=>{m.current=!0}),V.useCallback(function(w,R){if(R===void 0&&(R={}),!m.current)return;if(typeof w=="number"){a.go(w);return}let C=K8(w,JSON.parse(p),u,R.relative==="path");t==null&&e!=="/"&&(C.pathname=C.pathname==="/"?e:G_([e,C.pathname])),(R.replace?a.replace:a.push)(C,R.state,R)},[e,a,p,u,t])}function Kce(){let{matches:t}=V.useContext(eg),e=t[t.length-1];return e?e.params:{}}function iL(t,e){let{relative:r}=e===void 0?{}:e,{future:a}=V.useContext(Zm),{matches:l}=V.useContext(eg),{pathname:u}=dp(),p=JSON.stringify(H8(l,a.v7_relativeSplatPath));return V.useMemo(()=>K8(t,JSON.parse(p),u,r==="path"),[t,p,u,r])}function UNe(t,e){return VNe(t,e)}function VNe(t,e,r,a){Pw()||ma(!1);let{navigator:l}=V.useContext(Zm),{matches:u}=V.useContext(eg),p=u[u.length-1],m=p?p.params:{};p&&p.pathname;let v=p?p.pathnameBase:"/";p&&p.route;let w=dp(),R;if(e){var C;let q=typeof e=="string"?kw(e):e;v==="/"||(C=q.pathname)!=null&&C.startsWith(v)||ma(!1),R=q}else R=w;let A=R.pathname||"/",O=A;if(v!=="/"){let q=v.replace(/^\//,"").split("/");O="/"+A.replace(/^\//,"").split("/").slice(q.length).join("/")}let U=pNe(t,{pathname:O}),F=WNe(U&&U.map(q=>Object.assign({},q,{params:Object.assign({},m,q.params),pathname:G_([v,l.encodeLocation?l.encodeLocation(q.pathname).pathname:q.pathname]),pathnameBase:q.pathnameBase==="/"?v:G_([v,l.encodeLocation?l.encodeLocation(q.pathnameBase).pathname:q.pathnameBase])})),u,r,a);return e&&F?V.createElement(rL.Provider,{value:{location:pN({pathname:"/",search:"",hash:"",state:null,key:"default"},R),navigationType:I_.Pop}},F):F}function FNe(){let t=YNe(),e=ONe(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,l={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return V.createElement(V.Fragment,null,V.createElement("h2",null,"Unexpected Application Error!"),V.createElement("h3",{style:{fontStyle:"italic"}},e),r?V.createElement("pre",{style:l},r):null,null)}const BNe=V.createElement(FNe,null);class zNe extends V.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,r){return r.location!==e.location||r.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:r.error,location:r.location,revalidation:e.revalidation||r.revalidation}}componentDidCatch(e,r){console.error("React Router caught the following error during render",e,r)}render(){return this.state.error!==void 0?V.createElement(eg.Provider,{value:this.props.routeContext},V.createElement(Wce.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function GNe(t){let{routeContext:e,match:r,children:a}=t,l=V.useContext(nL);return l&&l.static&&l.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(l.staticContext._deepestRenderedBoundaryId=r.route.id),V.createElement(eg.Provider,{value:e},a)}function WNe(t,e,r,a){var l;if(e===void 0&&(e=[]),r===void 0&&(r=null),a===void 0&&(a=null),t==null){var u;if(!r)return null;if(r.errors)t=r.matches;else if((u=a)!=null&&u.v7_partialHydration&&e.length===0&&!r.initialized&&r.matches.length>0)t=r.matches;else return null}let p=t,m=(l=r)==null?void 0:l.errors;if(m!=null){let R=p.findIndex(C=>C.route.id&&(m==null?void 0:m[C.route.id])!==void 0);R>=0||ma(!1),p=p.slice(0,Math.min(p.length,R+1))}let v=!1,w=-1;if(r&&a&&a.v7_partialHydration)for(let R=0;R<p.length;R++){let C=p[R];if((C.route.HydrateFallback||C.route.hydrateFallbackElement)&&(w=R),C.route.id){let{loaderData:A,errors:O}=r,U=C.route.loader&&A[C.route.id]===void 0&&(!O||O[C.route.id]===void 0);if(C.route.lazy||U){v=!0,w>=0?p=p.slice(0,w+1):p=[p[0]];break}}}return p.reduceRight((R,C,A)=>{let O,U=!1,F=null,q=null;r&&(O=m&&C.route.id?m[C.route.id]:void 0,F=C.route.errorElement||BNe,v&&(w<0&&A===0?(XNe("route-fallback"),U=!0,q=null):w===A&&(U=!0,q=C.route.hydrateFallbackElement||null)));let W=e.concat(p.slice(0,A+1)),H=()=>{let X;return O?X=F:U?X=q:C.route.Component?X=V.createElement(C.route.Component,null):C.route.element?X=C.route.element:X=R,V.createElement(GNe,{match:C,routeContext:{outlet:R,matches:W,isDataRoute:r!=null},children:X})};return r&&(C.route.ErrorBoundary||C.route.errorElement||A===0)?V.createElement(zNe,{location:r.location,revalidation:r.revalidation,component:F,error:O,children:H(),routeContext:{outlet:null,matches:W,isDataRoute:!0}}):H()},null)}var qce=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(qce||{}),Yce=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(Yce||{});function HNe(t){let e=V.useContext(nL);return e||ma(!1),e}function KNe(t){let e=V.useContext(Gce);return e||ma(!1),e}function qNe(t){let e=V.useContext(eg);return e||ma(!1),e}function $ce(t){let e=qNe(),r=e.matches[e.matches.length-1];return r.route.id||ma(!1),r.route.id}function YNe(){var t;let e=V.useContext(Wce),r=KNe(),a=$ce();return e!==void 0?e:(t=r.errors)==null?void 0:t[a]}function $Ne(){let{router:t}=HNe(qce.UseNavigateStable),e=$ce(Yce.UseNavigateStable),r=V.useRef(!1);return Hce(()=>{r.current=!0}),V.useCallback(function(l,u){u===void 0&&(u={}),r.current&&(typeof l=="number"?t.navigate(l):t.navigate(l,pN({fromRouteId:e},u)))},[t,e])}const dne={};function XNe(t,e,r){dne[t]||(dne[t]=!0)}function JNe(t,e){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function T2(t){let{to:e,replace:r,state:a,relative:l}=t;Pw()||ma(!1);let{future:u,static:p}=V.useContext(Zm),{matches:m}=V.useContext(eg),{pathname:v}=dp(),w=yr(),R=K8(e,H8(m,u.v7_relativeSplatPath),v,l==="path"),C=JSON.stringify(R);return V.useEffect(()=>w(JSON.parse(C),{replace:r,state:a,relative:l}),[w,C,l,r,a]),null}function Fn(t){ma(!1)}function QNe(t){let{basename:e="/",children:r=null,location:a,navigationType:l=I_.Pop,navigator:u,static:p=!1,future:m}=t;Pw()&&ma(!1);let v=e.replace(/^\/*/,"/"),w=V.useMemo(()=>({basename:v,navigator:u,static:p,future:pN({v7_relativeSplatPath:!1},m)}),[v,m,u,p]);typeof a=="string"&&(a=kw(a));let{pathname:R="/",search:C="",hash:A="",state:O=null,key:U="default"}=a,F=V.useMemo(()=>{let q=nw(R,v);return q==null?null:{location:{pathname:q,search:C,hash:A,state:O,key:U},navigationType:l}},[v,R,C,A,O,U,l]);return F==null?null:V.createElement(Zm.Provider,{value:w},V.createElement(rL.Provider,{children:r,value:F}))}function IF(t){let{children:e,location:r}=t;return UNe(P6(e),r)}new Promise(()=>{});function P6(t,e){e===void 0&&(e=[]);let r=[];return V.Children.forEach(t,(a,l)=>{if(!V.isValidElement(a))return;let u=[...e,l];if(a.type===V.Fragment){r.push.apply(r,P6(a.props.children,u));return}a.type!==Fn&&ma(!1),!a.props.index||!a.props.children||ma(!1);let p={id:a.props.id||u.join("-"),caseSensitive:a.props.caseSensitive,element:a.props.element,Component:a.props.Component,index:a.props.index,path:a.props.path,loader:a.props.loader,action:a.props.action,errorElement:a.props.errorElement,ErrorBoundary:a.props.ErrorBoundary,hasErrorBoundary:a.props.ErrorBoundary!=null||a.props.errorElement!=null,shouldRevalidate:a.props.shouldRevalidate,handle:a.props.handle,lazy:a.props.lazy};a.props.children&&(p.children=P6(a.props.children,u)),r.push(p)}),r}/**
 * React Router DOM v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function $D(){return $D=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},$D.apply(this,arguments)}function Xce(t,e){if(t==null)return{};var r={},a=Object.keys(t),l,u;for(u=0;u<a.length;u++)l=a[u],!(e.indexOf(l)>=0)&&(r[l]=t[l]);return r}function ZNe(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function eIe(t,e){return t.button===0&&(!e||e==="_self")&&!ZNe(t)}function D6(t){return t===void 0&&(t=""),new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,r)=>{let a=t[r];return e.concat(Array.isArray(a)?a.map(l=>[r,l]):[[r,a]])},[]))}function tIe(t,e){let r=D6(t);return e&&e.forEach((a,l)=>{r.has(l)||e.getAll(l).forEach(u=>{r.append(l,u)})}),r}const nIe=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],rIe=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],iIe="6";try{window.__reactRouterVersion=iIe}catch{}const sIe=V.createContext({isTransitioning:!1}),aIe="startTransition",une=ZTe[aIe];function oIe(t){let{basename:e,children:r,future:a,window:l}=t,u=V.useRef();u.current==null&&(u.current=dNe({window:l,v5Compat:!0}));let p=u.current,[m,v]=V.useState({action:p.action,location:p.location}),{v7_startTransition:w}=a||{},R=V.useCallback(C=>{w&&une?une(()=>v(C)):v(C)},[v,w]);return V.useLayoutEffect(()=>p.listen(R),[p,R]),V.useEffect(()=>JNe(a),[a]),V.createElement(QNe,{basename:e,children:r,location:m.location,navigationType:m.action,navigator:p,future:a})}const cIe=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",lIe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ju=V.forwardRef(function(e,r){let{onClick:a,relative:l,reloadDocument:u,replace:p,state:m,target:v,to:w,preventScrollReset:R,viewTransition:C}=e,A=Xce(e,nIe),{basename:O}=V.useContext(Zm),U,F=!1;if(typeof w=="string"&&lIe.test(w)&&(U=w,cIe))try{let X=new URL(window.location.href),ne=w.startsWith("//")?new URL(X.protocol+w):new URL(w),te=nw(ne.pathname,O);ne.origin===X.origin&&te!=null?w=te+ne.search+ne.hash:F=!0}catch{}let q=jNe(w,{relative:l}),W=uIe(w,{replace:p,state:m,target:v,preventScrollReset:R,relative:l,viewTransition:C});function H(X){a&&a(X),X.defaultPrevented||W(X)}return V.createElement("a",$D({},A,{href:U||q,onClick:F||u?a:H,ref:r,target:v}))}),hne=V.forwardRef(function(e,r){let{"aria-current":a="page",caseSensitive:l=!1,className:u="",end:p=!1,style:m,to:v,viewTransition:w,children:R}=e,C=Xce(e,rIe),A=iL(v,{relative:C.relative}),O=dp(),U=V.useContext(Gce),{navigator:F,basename:q}=V.useContext(Zm),W=U!=null&&hIe(A)&&w===!0,H=F.encodeLocation?F.encodeLocation(A).pathname:A.pathname,X=O.pathname,ne=U&&U.navigation&&U.navigation.location?U.navigation.location.pathname:null;l||(X=X.toLowerCase(),ne=ne?ne.toLowerCase():null,H=H.toLowerCase()),ne&&q&&(ne=nw(ne,q)||ne);const te=H!=="/"&&H.endsWith("/")?H.length-1:H.length;let he=X===H||!p&&X.startsWith(H)&&X.charAt(te)==="/",J=ne!=null&&(ne===H||!p&&ne.startsWith(H)&&ne.charAt(H.length)==="/"),Q={isActive:he,isPending:J,isTransitioning:W},ce=he?a:void 0,de;typeof u=="function"?de=u(Q):de=[u,he?"active":null,J?"pending":null,W?"transitioning":null].filter(Boolean).join(" ");let pe=typeof m=="function"?m(Q):m;return V.createElement(Ju,$D({},C,{"aria-current":ce,className:de,ref:r,style:pe,to:v,viewTransition:w}),typeof R=="function"?R(Q):R)});var O6;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(O6||(O6={}));var pne;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(pne||(pne={}));function dIe(t){let e=V.useContext(nL);return e||ma(!1),e}function uIe(t,e){let{target:r,replace:a,state:l,preventScrollReset:u,relative:p,viewTransition:m}=e===void 0?{}:e,v=yr(),w=dp(),R=iL(t,{relative:p});return V.useCallback(C=>{if(eIe(C,r)){C.preventDefault();let A=a!==void 0?a:YD(w)===YD(R);v(t,{replace:A,state:l,preventScrollReset:u,relative:p,viewTransition:m})}},[w,v,R,a,l,r,t,u,p,m])}function Dw(t){let e=V.useRef(D6(t)),r=V.useRef(!1),a=dp(),l=V.useMemo(()=>tIe(a.search,r.current?null:e.current),[a.search]),u=yr(),p=V.useCallback((m,v)=>{const w=D6(typeof m=="function"?m(l):m);r.current=!0,u("?"+w,v)},[u,l]);return[l,p]}function hIe(t,e){e===void 0&&(e={});let r=V.useContext(sIe);r==null&&ma(!1);let{basename:a}=dIe(O6.useViewTransitionState),l=iL(t,{relative:e.relative});if(!r.isTransitioning)return!1;let u=nw(r.currentLocation.pathname,a)||r.currentLocation.pathname,p=nw(r.nextLocation.pathname,a)||r.nextLocation.pathname;return k6(l.pathname,p)!=null||k6(l.pathname,u)!=null}var fne={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jce=function(t){const e=[];let r=0;for(let a=0;a<t.length;a++){let l=t.charCodeAt(a);l<128?e[r++]=l:l<2048?(e[r++]=l>>6|192,e[r++]=l&63|128):(l&64512)===55296&&a+1<t.length&&(t.charCodeAt(a+1)&64512)===56320?(l=65536+((l&1023)<<10)+(t.charCodeAt(++a)&1023),e[r++]=l>>18|240,e[r++]=l>>12&63|128,e[r++]=l>>6&63|128,e[r++]=l&63|128):(e[r++]=l>>12|224,e[r++]=l>>6&63|128,e[r++]=l&63|128)}return e},pIe=function(t){const e=[];let r=0,a=0;for(;r<t.length;){const l=t[r++];if(l<128)e[a++]=String.fromCharCode(l);else if(l>191&&l<224){const u=t[r++];e[a++]=String.fromCharCode((l&31)<<6|u&63)}else if(l>239&&l<365){const u=t[r++],p=t[r++],m=t[r++],v=((l&7)<<18|(u&63)<<12|(p&63)<<6|m&63)-65536;e[a++]=String.fromCharCode(55296+(v>>10)),e[a++]=String.fromCharCode(56320+(v&1023))}else{const u=t[r++],p=t[r++];e[a++]=String.fromCharCode((l&15)<<12|(u&63)<<6|p&63)}}return e.join("")},Qce={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let l=0;l<t.length;l+=3){const u=t[l],p=l+1<t.length,m=p?t[l+1]:0,v=l+2<t.length,w=v?t[l+2]:0,R=u>>2,C=(u&3)<<4|m>>4;let A=(m&15)<<2|w>>6,O=w&63;v||(O=64,p||(A=64)),a.push(r[R],r[C],r[A],r[O])}return a.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Jce(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):pIe(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const r=e?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let l=0;l<t.length;){const u=r[t.charAt(l++)],m=l<t.length?r[t.charAt(l)]:0;++l;const w=l<t.length?r[t.charAt(l)]:64;++l;const C=l<t.length?r[t.charAt(l)]:64;if(++l,u==null||m==null||w==null||C==null)throw new fIe;const A=u<<2|m>>4;if(a.push(A),w!==64){const O=m<<4&240|w>>2;if(a.push(O),C!==64){const U=w<<6&192|C;a.push(U)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class fIe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const mIe=function(t){const e=Jce(t);return Qce.encodeByteArray(e,!0)},XD=function(t){return mIe(t).replace(/\./g,"")},Zce=function(t){try{return Qce.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gIe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _Ie=()=>gIe().__FIREBASE_DEFAULTS__,yIe=()=>{if(typeof process>"u"||typeof fne>"u")return;const t=fne.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},vIe=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Zce(t[1]);return e&&JSON.parse(e)},sL=()=>{try{return _Ie()||yIe()||vIe()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},ele=t=>{var e,r;return(r=(e=sL())===null||e===void 0?void 0:e.emulatorHosts)===null||r===void 0?void 0:r[t]},tle=t=>{const e=ele(t);if(!e)return;const r=e.lastIndexOf(":");if(r<=0||r+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const a=parseInt(e.substring(r+1),10);return e[0]==="["?[e.substring(1,r-1),a]:[e.substring(0,r),a]},nle=()=>{var t;return(t=sL())===null||t===void 0?void 0:t.config},rle=t=>{var e;return(e=sL())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EIe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}wrapCallback(e){return(r,a)=>{r?this.reject(r):this.resolve(a),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(r):e(r,a))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ile(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const r={alg:"none",type:"JWT"},a=e||"demo-project",l=t.iat||0,u=t.sub||t.user_id;if(!u)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const p=Object.assign({iss:`https://securetoken.google.com/${a}`,aud:a,iat:l,exp:l+3600,auth_time:l,sub:u,user_id:u,firebase:{sign_in_provider:"custom",identities:{}}},t);return[XD(JSON.stringify(r)),XD(JSON.stringify(p)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vo(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function xIe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(vo())}function bIe(){var t;const e=(t=sL())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function wIe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function SIe(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function TIe(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function RIe(){const t=vo();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function sle(){return!bIe()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ale(){try{return typeof indexedDB=="object"}catch{return!1}}function CIe(){return new Promise((t,e)=>{try{let r=!0;const a="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(a);l.onsuccess=()=>{l.result.close(),r||self.indexedDB.deleteDatabase(a),t(!0)},l.onupgradeneeded=()=>{r=!1},l.onerror=()=>{var u;e(((u=l.error)===null||u===void 0?void 0:u.message)||"")}}catch(r){e(r)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NIe="FirebaseError";class Pf extends Error{constructor(e,r,a){super(r),this.code=e,this.customData=a,this.name=NIe,Object.setPrototypeOf(this,Pf.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,HN.prototype.create)}}class HN{constructor(e,r,a){this.service=e,this.serviceName=r,this.errors=a}create(e,...r){const a=r[0]||{},l=`${this.service}/${e}`,u=this.errors[e],p=u?IIe(u,a):"Error",m=`${this.serviceName}: ${p} (${l}).`;return new Pf(l,m,a)}}function IIe(t,e){return t.replace(AIe,(r,a)=>{const l=e[a];return l!=null?String(l):`<${a}?>`})}const AIe=/\{\$([^}]+)}/g;function kIe(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function J_(t,e){if(t===e)return!0;const r=Object.keys(t),a=Object.keys(e);for(const l of r){if(!a.includes(l))return!1;const u=t[l],p=e[l];if(mne(u)&&mne(p)){if(!J_(u,p))return!1}else if(u!==p)return!1}for(const l of a)if(!r.includes(l))return!1;return!0}function mne(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ow(t){const e=[];for(const[r,a]of Object.entries(t))Array.isArray(a)?a.forEach(l=>{e.push(encodeURIComponent(r)+"="+encodeURIComponent(l))}):e.push(encodeURIComponent(r)+"="+encodeURIComponent(a));return e.length?"&"+e.join("&"):""}function dC(t){const e={};return t.replace(/^\?/,"").split("&").forEach(a=>{if(a){const[l,u]=a.split("=");e[decodeURIComponent(l)]=decodeURIComponent(u)}}),e}function uC(t){const e=t.indexOf("?");if(!e)return"";const r=t.indexOf("#",e);return t.substring(e,r>0?r:void 0)}function PIe(t,e){const r=new DIe(t,e);return r.subscribe.bind(r)}class DIe{constructor(e,r){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=r,this.task.then(()=>{e(this)}).catch(a=>{this.error(a)})}next(e){this.forEachObserver(r=>{r.next(e)})}error(e){this.forEachObserver(r=>{r.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,r,a){let l;if(e===void 0&&r===void 0&&a===void 0)throw new Error("Missing Observer.");OIe(e,["next","error","complete"])?l=e:l={next:e,error:r,complete:a},l.next===void 0&&(l.next=AF),l.error===void 0&&(l.error=AF),l.complete===void 0&&(l.complete=AF);const u=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),u}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let r=0;r<this.observers.length;r++)this.sendOne(r,e)}sendOne(e,r){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{r(this.observers[e])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function OIe(t,e){if(typeof t!="object"||t===null)return!1;for(const r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}function AF(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zn(t){return t&&t._delegate?t._delegate:t}class Q_{constructor(e,r,a){this.name=e,this.instanceFactory=r,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xy="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LIe{constructor(e,r){this.name=e,this.container=r,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const r=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(r)){const a=new EIe;if(this.instancesDeferred.set(r,a),this.isInitialized(r)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:r});l&&a.resolve(l)}catch{}}return this.instancesDeferred.get(r).promise}getImmediate(e){var r;const a=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),l=(r=e==null?void 0:e.optional)!==null&&r!==void 0?r:!1;if(this.isInitialized(a)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:a})}catch(u){if(l)return null;throw u}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(MIe(e))try{this.getOrInitializeService({instanceIdentifier:Xy})}catch{}for(const[r,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(r);try{const u=this.getOrInitializeService({instanceIdentifier:l});a.resolve(u)}catch{}}}}clearInstance(e=Xy){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(r=>"INTERNAL"in r).map(r=>r.INTERNAL.delete()),...e.filter(r=>"_delete"in r).map(r=>r._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Xy){return this.instances.has(e)}getOptions(e=Xy){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:r={}}=e,a=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:a,options:r});for(const[u,p]of this.instancesDeferred.entries()){const m=this.normalizeInstanceIdentifier(u);a===m&&p.resolve(l)}return l}onInit(e,r){var a;const l=this.normalizeInstanceIdentifier(r),u=(a=this.onInitCallbacks.get(l))!==null&&a!==void 0?a:new Set;u.add(e),this.onInitCallbacks.set(l,u);const p=this.instances.get(l);return p&&e(p,l),()=>{u.delete(e)}}invokeOnInitCallbacks(e,r){const a=this.onInitCallbacks.get(r);if(a)for(const l of a)try{l(e,r)}catch{}}getOrInitializeService({instanceIdentifier:e,options:r={}}){let a=this.instances.get(e);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:jIe(e),options:r}),this.instances.set(e,a),this.instancesOptions.set(e,r),this.invokeOnInitCallbacks(a,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,a)}catch{}return a||null}normalizeInstanceIdentifier(e=Xy){return this.component?this.component.multipleInstances?e:Xy:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function jIe(t){return t===Xy?void 0:t}function MIe(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UIe{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const r=this.getProvider(e.name);if(r.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);r.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const r=new LIe(e,this);return this.providers.set(e,r),r}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var oi;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(oi||(oi={}));const VIe={debug:oi.DEBUG,verbose:oi.VERBOSE,info:oi.INFO,warn:oi.WARN,error:oi.ERROR,silent:oi.SILENT},FIe=oi.INFO,BIe={[oi.DEBUG]:"log",[oi.VERBOSE]:"log",[oi.INFO]:"info",[oi.WARN]:"warn",[oi.ERROR]:"error"},zIe=(t,e,...r)=>{if(e<t.logLevel)return;const a=new Date().toISOString(),l=BIe[e];if(l)console[l](`[${a}]  ${t.name}:`,...r);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class q8{constructor(e){this.name=e,this._logLevel=FIe,this._logHandler=zIe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in oi))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?VIe[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,oi.DEBUG,...e),this._logHandler(this,oi.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,oi.VERBOSE,...e),this._logHandler(this,oi.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,oi.INFO,...e),this._logHandler(this,oi.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,oi.WARN,...e),this._logHandler(this,oi.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,oi.ERROR,...e),this._logHandler(this,oi.ERROR,...e)}}const GIe=(t,e)=>e.some(r=>t instanceof r);let gne,_ne;function WIe(){return gne||(gne=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function HIe(){return _ne||(_ne=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ole=new WeakMap,L6=new WeakMap,cle=new WeakMap,kF=new WeakMap,Y8=new WeakMap;function KIe(t){const e=new Promise((r,a)=>{const l=()=>{t.removeEventListener("success",u),t.removeEventListener("error",p)},u=()=>{r(W_(t.result)),l()},p=()=>{a(t.error),l()};t.addEventListener("success",u),t.addEventListener("error",p)});return e.then(r=>{r instanceof IDBCursor&&ole.set(r,t)}).catch(()=>{}),Y8.set(e,t),e}function qIe(t){if(L6.has(t))return;const e=new Promise((r,a)=>{const l=()=>{t.removeEventListener("complete",u),t.removeEventListener("error",p),t.removeEventListener("abort",p)},u=()=>{r(),l()},p=()=>{a(t.error||new DOMException("AbortError","AbortError")),l()};t.addEventListener("complete",u),t.addEventListener("error",p),t.addEventListener("abort",p)});L6.set(t,e)}let j6={get(t,e,r){if(t instanceof IDBTransaction){if(e==="done")return L6.get(t);if(e==="objectStoreNames")return t.objectStoreNames||cle.get(t);if(e==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return W_(t[e])},set(t,e,r){return t[e]=r,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function YIe(t){j6=t(j6)}function $Ie(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...r){const a=t.call(PF(this),e,...r);return cle.set(a,e.sort?e.sort():[e]),W_(a)}:HIe().includes(t)?function(...e){return t.apply(PF(this),e),W_(ole.get(this))}:function(...e){return W_(t.apply(PF(this),e))}}function XIe(t){return typeof t=="function"?$Ie(t):(t instanceof IDBTransaction&&qIe(t),GIe(t,WIe())?new Proxy(t,j6):t)}function W_(t){if(t instanceof IDBRequest)return KIe(t);if(kF.has(t))return kF.get(t);const e=XIe(t);return e!==t&&(kF.set(t,e),Y8.set(e,t)),e}const PF=t=>Y8.get(t);function JIe(t,e,{blocked:r,upgrade:a,blocking:l,terminated:u}={}){const p=indexedDB.open(t,e),m=W_(p);return a&&p.addEventListener("upgradeneeded",v=>{a(W_(p.result),v.oldVersion,v.newVersion,W_(p.transaction),v)}),r&&p.addEventListener("blocked",v=>r(v.oldVersion,v.newVersion,v)),m.then(v=>{u&&v.addEventListener("close",()=>u()),l&&v.addEventListener("versionchange",w=>l(w.oldVersion,w.newVersion,w))}).catch(()=>{}),m}const QIe=["get","getKey","getAll","getAllKeys","count"],ZIe=["put","add","delete","clear"],DF=new Map;function yne(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(DF.get(e))return DF.get(e);const r=e.replace(/FromIndex$/,""),a=e!==r,l=ZIe.includes(r);if(!(r in(a?IDBIndex:IDBObjectStore).prototype)||!(l||QIe.includes(r)))return;const u=async function(p,...m){const v=this.transaction(p,l?"readwrite":"readonly");let w=v.store;return a&&(w=w.index(m.shift())),(await Promise.all([w[r](...m),l&&v.done]))[0]};return DF.set(e,u),u}YIe(t=>({...t,get:(e,r,a)=>yne(e,r)||t.get(e,r,a),has:(e,r)=>!!yne(e,r)||t.has(e,r)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eAe{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(r=>{if(tAe(r)){const a=r.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(r=>r).join(" ")}}function tAe(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const M6="@firebase/app",vne="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wm=new q8("@firebase/app"),nAe="@firebase/app-compat",rAe="@firebase/analytics-compat",iAe="@firebase/analytics",sAe="@firebase/app-check-compat",aAe="@firebase/app-check",oAe="@firebase/auth",cAe="@firebase/auth-compat",lAe="@firebase/database",dAe="@firebase/data-connect",uAe="@firebase/database-compat",hAe="@firebase/functions",pAe="@firebase/functions-compat",fAe="@firebase/installations",mAe="@firebase/installations-compat",gAe="@firebase/messaging",_Ae="@firebase/messaging-compat",yAe="@firebase/performance",vAe="@firebase/performance-compat",EAe="@firebase/remote-config",xAe="@firebase/remote-config-compat",bAe="@firebase/storage",wAe="@firebase/storage-compat",SAe="@firebase/firestore",TAe="@firebase/vertexai-preview",RAe="@firebase/firestore-compat",CAe="firebase",NAe="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JD="[DEFAULT]",IAe={[M6]:"fire-core",[nAe]:"fire-core-compat",[iAe]:"fire-analytics",[rAe]:"fire-analytics-compat",[aAe]:"fire-app-check",[sAe]:"fire-app-check-compat",[oAe]:"fire-auth",[cAe]:"fire-auth-compat",[lAe]:"fire-rtdb",[dAe]:"fire-data-connect",[uAe]:"fire-rtdb-compat",[hAe]:"fire-fn",[pAe]:"fire-fn-compat",[fAe]:"fire-iid",[mAe]:"fire-iid-compat",[gAe]:"fire-fcm",[_Ae]:"fire-fcm-compat",[yAe]:"fire-perf",[vAe]:"fire-perf-compat",[EAe]:"fire-rc",[xAe]:"fire-rc-compat",[bAe]:"fire-gcs",[wAe]:"fire-gcs-compat",[SAe]:"fire-fst",[RAe]:"fire-fst-compat",[TAe]:"fire-vertex","fire-js":"fire-js",[CAe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QD=new Map,AAe=new Map,U6=new Map;function Ene(t,e){try{t.container.addComponent(e)}catch(r){Wm.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,r)}}function Sv(t){const e=t.name;if(U6.has(e))return Wm.debug(`There were multiple attempts to register component ${e}.`),!1;U6.set(e,t);for(const r of QD.values())Ene(r,t);for(const r of AAe.values())Ene(r,t);return!0}function Lw(t,e){const r=t.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),t.container.getProvider(e)}function kAe(t,e,r=JD){Lw(t,e).clearInstance(r)}function Ko(t){return t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PAe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},H_=new HN("app","Firebase",PAe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DAe{constructor(e,r,a){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},r),this._name=r.name,this._automaticDataCollectionEnabled=r.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new Q_("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw H_.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bv=NAe;function lle(t,e={}){let r=t;typeof e!="object"&&(e={name:e});const a=Object.assign({name:JD,automaticDataCollectionEnabled:!1},e),l=a.name;if(typeof l!="string"||!l)throw H_.create("bad-app-name",{appName:String(l)});if(r||(r=nle()),!r)throw H_.create("no-options");const u=QD.get(l);if(u){if(J_(r,u.options)&&J_(a,u.config))return u;throw H_.create("duplicate-app",{appName:l})}const p=new UIe(l);for(const v of U6.values())p.addComponent(v);const m=new DAe(r,a,p);return QD.set(l,m),m}function $8(t=JD){const e=QD.get(t);if(!e&&t===JD&&nle())return lle();if(!e)throw H_.create("no-app",{appName:t});return e}function Tf(t,e,r){var a;let l=(a=IAe[t])!==null&&a!==void 0?a:t;r&&(l+=`-${r}`);const u=l.match(/\s|\//),p=e.match(/\s|\//);if(u||p){const m=[`Unable to register library "${l}" with version "${e}":`];u&&m.push(`library name "${l}" contains illegal characters (whitespace or "/")`),u&&p&&m.push("and"),p&&m.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Wm.warn(m.join(" "));return}Sv(new Q_(`${l}-version`,()=>({library:l,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OAe="firebase-heartbeat-database",LAe=1,fN="firebase-heartbeat-store";let OF=null;function dle(){return OF||(OF=JIe(OAe,LAe,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(fN)}catch(r){console.warn(r)}}}}).catch(t=>{throw H_.create("idb-open",{originalErrorMessage:t.message})})),OF}async function jAe(t){try{const r=(await dle()).transaction(fN),a=await r.objectStore(fN).get(ule(t));return await r.done,a}catch(e){if(e instanceof Pf)Wm.warn(e.message);else{const r=H_.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Wm.warn(r.message)}}}async function xne(t,e){try{const a=(await dle()).transaction(fN,"readwrite");await a.objectStore(fN).put(e,ule(t)),await a.done}catch(r){if(r instanceof Pf)Wm.warn(r.message);else{const a=H_.create("idb-set",{originalErrorMessage:r==null?void 0:r.message});Wm.warn(a.message)}}}function ule(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MAe=1024,UAe=30*24*60*60*1e3;class VAe{constructor(e){this.container=e,this._heartbeatsCache=null;const r=this.container.getProvider("app").getImmediate();this._storage=new BAe(r),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var e,r;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),u=bne();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((r=this._heartbeatsCache)===null||r===void 0?void 0:r.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===u||this._heartbeatsCache.heartbeats.some(p=>p.date===u)?void 0:(this._heartbeatsCache.heartbeats.push({date:u,agent:l}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(p=>{const m=new Date(p.date).valueOf();return Date.now()-m<=UAe}),this._storage.overwrite(this._heartbeatsCache))}catch(a){Wm.warn(a)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const r=bne(),{heartbeatsToSend:a,unsentEntries:l}=FAe(this._heartbeatsCache.heartbeats),u=XD(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=r,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),u}catch(r){return Wm.warn(r),""}}}function bne(){return new Date().toISOString().substring(0,10)}function FAe(t,e=MAe){const r=[];let a=t.slice();for(const l of t){const u=r.find(p=>p.agent===l.agent);if(u){if(u.dates.push(l.date),wne(r)>e){u.dates.pop();break}}else if(r.push({agent:l.agent,dates:[l.date]}),wne(r)>e){r.pop();break}a=a.slice(1)}return{heartbeatsToSend:r,unsentEntries:a}}class BAe{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return ale()?CIe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const r=await jAe(this.app);return r!=null&&r.heartbeats?r:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var r;if(await this._canUseIndexedDBPromise){const l=await this.read();return xne(this.app,{lastSentHeartbeatDate:(r=e.lastSentHeartbeatDate)!==null&&r!==void 0?r:l.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var r;if(await this._canUseIndexedDBPromise){const l=await this.read();return xne(this.app,{lastSentHeartbeatDate:(r=e.lastSentHeartbeatDate)!==null&&r!==void 0?r:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...e.heartbeats]})}else return}}function wne(t){return XD(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zAe(t){Sv(new Q_("platform-logger",e=>new eAe(e),"PRIVATE")),Sv(new Q_("heartbeat",e=>new VAe(e),"PRIVATE")),Tf(M6,vne,t),Tf(M6,vne,"esm2017"),Tf("fire-js","")}zAe("");function X8(t,e){var r={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&e.indexOf(a)<0&&(r[a]=t[a]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(t);l<a.length;l++)e.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(t,a[l])&&(r[a[l]]=t[a[l]]);return r}function hle(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const GAe=hle,ple=new HN("auth","Firebase",hle());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZD=new q8("@firebase/auth");function WAe(t,...e){ZD.logLevel<=oi.WARN&&ZD.warn(`Auth (${Bv}): ${t}`,...e)}function sD(t,...e){ZD.logLevel<=oi.ERROR&&ZD.error(`Auth (${Bv}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xd(t,...e){throw Q8(t,...e)}function Il(t,...e){return Q8(t,...e)}function J8(t,e,r){const a=Object.assign(Object.assign({},GAe()),{[e]:r});return new HN("auth","Firebase",a).create(e,{appName:t.name})}function Al(t){return J8(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function KN(t,e,r){const a=r;if(!(e instanceof a))throw a.name!==e.constructor.name&&Xd(t,"argument-error"),J8(t,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Q8(t,...e){if(typeof t!="string"){const r=e[0],a=[...e.slice(1)];return a[0]&&(a[0].appName=t.name),t._errorFactory.create(r,...a)}return ple.create(t,...e)}function Xt(t,e,...r){if(!t)throw Q8(e,...r)}function Am(t){const e="INTERNAL ASSERTION FAILED: "+t;throw sD(e),new Error(e)}function Hm(t,e){t||Am(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mN(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function Z8(){return Sne()==="http:"||Sne()==="https:"}function Sne(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HAe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Z8()||SIe()||"connection"in navigator)?navigator.onLine:!0}function KAe(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qN{constructor(e,r){this.shortDelay=e,this.longDelay=r,Hm(r>e,"Short delay should be less than long delay!"),this.isMobile=xIe()||TIe()}get(){return HAe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eG(t,e){Hm(t.emulator,"Emulator should always be set here");const{url:r}=t.emulator;return e?`${r}${e.startsWith("/")?e.slice(1):e}`:r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fle{static initialize(e,r,a){this.fetchImpl=e,r&&(this.headersImpl=r),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Am("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Am("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Am("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qAe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YAe=new qN(3e4,6e4);function xo(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function bo(t,e,r,a,l={}){return mle(t,l,async()=>{let u={},p={};a&&(e==="GET"?p=a:u={body:JSON.stringify(a)});const m=Ow(Object.assign({key:t.config.apiKey},p)).slice(1),v=await t._getAdditionalHeaders();v["Content-Type"]="application/json",t.languageCode&&(v["X-Firebase-Locale"]=t.languageCode);const w=Object.assign({method:e,headers:v},u);return wIe()||(w.referrerPolicy="no-referrer"),fle.fetch()(gle(t,t.config.apiHost,r,m),w)})}async function mle(t,e,r){t._canInitEmulator=!1;const a=Object.assign(Object.assign({},qAe),e);try{const l=new XAe(t),u=await Promise.race([r(),l.promise]);l.clearNetworkTimeout();const p=await u.json();if("needConfirmation"in p)throw hC(t,"account-exists-with-different-credential",p);if(u.ok&&!("errorMessage"in p))return p;{const m=u.ok?p.errorMessage:p.error.message,[v,w]=m.split(" : ");if(v==="FEDERATED_USER_ID_ALREADY_LINKED")throw hC(t,"credential-already-in-use",p);if(v==="EMAIL_EXISTS")throw hC(t,"email-already-in-use",p);if(v==="USER_DISABLED")throw hC(t,"user-disabled",p);const R=a[v]||v.toLowerCase().replace(/[_\s]+/g,"-");if(w)throw J8(t,R,w);Xd(t,R)}}catch(l){if(l instanceof Pf)throw l;Xd(t,"network-request-failed",{message:String(l)})}}async function tg(t,e,r,a,l={}){const u=await bo(t,e,r,a,l);return"mfaPendingCredential"in u&&Xd(t,"multi-factor-auth-required",{_serverResponse:u}),u}function gle(t,e,r,a){const l=`${e}${r}?${a}`;return t.config.emulator?eG(t.config,l):`${t.config.apiScheme}://${l}`}function $Ae(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class XAe{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((r,a)=>{this.timer=setTimeout(()=>a(Il(this.auth,"network-request-failed")),YAe.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function hC(t,e,r){const a={appName:t.name};r.email&&(a.email=r.email),r.phoneNumber&&(a.phoneNumber=r.phoneNumber);const l=Il(t,e,a);return l.customData._tokenResponse=r,l}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tne(t){return t!==void 0&&t.getResponse!==void 0}function Rne(t){return t!==void 0&&t.enterprise!==void 0}class JAe{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const r of this.recaptchaEnforcementState)if(r.provider&&r.provider===e)return $Ae(r.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function QAe(t){return(await bo(t,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function ZAe(t,e){return bo(t,"GET","/v2/recaptchaConfig",xo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function e1e(t,e){return bo(t,"POST","/v1/accounts:delete",e)}async function t1e(t,e){return bo(t,"POST","/v1/accounts:update",e)}async function _le(t,e){return bo(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kC(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function n1e(t,e=!1){const r=zn(t),a=await r.getIdToken(e),l=aL(a);Xt(l&&l.exp&&l.auth_time&&l.iat,r.auth,"internal-error");const u=typeof l.firebase=="object"?l.firebase:void 0,p=u==null?void 0:u.sign_in_provider;return{claims:l,token:a,authTime:kC(LF(l.auth_time)),issuedAtTime:kC(LF(l.iat)),expirationTime:kC(LF(l.exp)),signInProvider:p||null,signInSecondFactor:(u==null?void 0:u.sign_in_second_factor)||null}}function LF(t){return Number(t)*1e3}function aL(t){const[e,r,a]=t.split(".");if(e===void 0||r===void 0||a===void 0)return sD("JWT malformed, contained fewer than 3 sections"),null;try{const l=Zce(r);return l?JSON.parse(l):(sD("Failed to decode base64 JWT payload"),null)}catch(l){return sD("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function Cne(t){const e=aL(t);return Xt(e,"internal-error"),Xt(typeof e.exp<"u","internal-error"),Xt(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tv(t,e,r=!1){if(r)return e;try{return await e}catch(a){throw a instanceof Pf&&r1e(a)&&t.auth.currentUser===t&&await t.auth.signOut(),a}}function r1e({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i1e{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var r;if(e){const a=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),a}else{this.errorBackoff=3e4;const l=((r=this.user.stsTokenManager.expirationTime)!==null&&r!==void 0?r:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(e=!1){if(!this.isRunning)return;const r=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},r)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V6{constructor(e,r){this.createdAt=e,this.lastLoginAt=r,this._initializeTime()}_initializeTime(){this.lastSignInTime=kC(this.lastLoginAt),this.creationTime=kC(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gN(t){var e;const r=t.auth,a=await t.getIdToken(),l=await Tv(t,_le(r,{idToken:a}));Xt(l==null?void 0:l.users.length,r,"internal-error");const u=l.users[0];t._notifyReloadListener(u);const p=!((e=u.providerUserInfo)===null||e===void 0)&&e.length?yle(u.providerUserInfo):[],m=a1e(t.providerData,p),v=t.isAnonymous,w=!(t.email&&u.passwordHash)&&!(m!=null&&m.length),R=v?w:!1,C={uid:u.localId,displayName:u.displayName||null,photoURL:u.photoUrl||null,email:u.email||null,emailVerified:u.emailVerified||!1,phoneNumber:u.phoneNumber||null,tenantId:u.tenantId||null,providerData:m,metadata:new V6(u.createdAt,u.lastLoginAt),isAnonymous:R};Object.assign(t,C)}async function s1e(t){const e=zn(t);await gN(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function a1e(t,e){return[...t.filter(a=>!e.some(l=>l.providerId===a.providerId)),...e]}function yle(t){return t.map(e=>{var{providerId:r}=e,a=X8(e,["providerId"]);return{providerId:r,uid:a.rawId||"",displayName:a.displayName||null,email:a.email||null,phoneNumber:a.phoneNumber||null,photoURL:a.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function o1e(t,e){const r=await mle(t,{},async()=>{const a=Ow({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:l,apiKey:u}=t.config,p=gle(t,l,"/v1/token",`key=${u}`),m=await t._getAdditionalHeaders();return m["Content-Type"]="application/x-www-form-urlencoded",fle.fetch()(p,{method:"POST",headers:m,body:a})});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function c1e(t,e){return bo(t,"POST","/v2/accounts:revokeToken",xo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vb{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Xt(e.idToken,"internal-error"),Xt(typeof e.idToken<"u","internal-error"),Xt(typeof e.refreshToken<"u","internal-error");const r="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Cne(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,r)}updateFromIdToken(e){Xt(e.length!==0,"internal-error");const r=Cne(e);this.updateTokensAndExpiration(e,null,r)}async getToken(e,r=!1){return!r&&this.accessToken&&!this.isExpired?this.accessToken:(Xt(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,r){const{accessToken:a,refreshToken:l,expiresIn:u}=await o1e(e,r);this.updateTokensAndExpiration(a,l,Number(u))}updateTokensAndExpiration(e,r,a){this.refreshToken=r||null,this.accessToken=e||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(e,r){const{refreshToken:a,accessToken:l,expirationTime:u}=r,p=new Vb;return a&&(Xt(typeof a=="string","internal-error",{appName:e}),p.refreshToken=a),l&&(Xt(typeof l=="string","internal-error",{appName:e}),p.accessToken=l),u&&(Xt(typeof u=="number","internal-error",{appName:e}),p.expirationTime=u),p}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Vb,this.toJSON())}_performRefresh(){return Am("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u_(t,e){Xt(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class km{constructor(e){var{uid:r,auth:a,stsTokenManager:l}=e,u=X8(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new i1e(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=r,this.auth=a,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=u.displayName||null,this.email=u.email||null,this.emailVerified=u.emailVerified||!1,this.phoneNumber=u.phoneNumber||null,this.photoURL=u.photoURL||null,this.isAnonymous=u.isAnonymous||!1,this.tenantId=u.tenantId||null,this.providerData=u.providerData?[...u.providerData]:[],this.metadata=new V6(u.createdAt||void 0,u.lastLoginAt||void 0)}async getIdToken(e){const r=await Tv(this,this.stsTokenManager.getToken(this.auth,e));return Xt(r,this.auth,"internal-error"),this.accessToken!==r&&(this.accessToken=r,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),r}getIdTokenResult(e){return n1e(this,e)}reload(){return s1e(this)}_assign(e){this!==e&&(Xt(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(r=>Object.assign({},r)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const r=new km(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return r.metadata._copy(this.metadata),r}_onReload(e){Xt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,r=!1){let a=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),a=!0),r&&await gN(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ko(this.auth.app))return Promise.reject(Al(this.auth));const e=await this.getIdToken();return await Tv(this,e1e(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,r){var a,l,u,p,m,v,w,R;const C=(a=r.displayName)!==null&&a!==void 0?a:void 0,A=(l=r.email)!==null&&l!==void 0?l:void 0,O=(u=r.phoneNumber)!==null&&u!==void 0?u:void 0,U=(p=r.photoURL)!==null&&p!==void 0?p:void 0,F=(m=r.tenantId)!==null&&m!==void 0?m:void 0,q=(v=r._redirectEventId)!==null&&v!==void 0?v:void 0,W=(w=r.createdAt)!==null&&w!==void 0?w:void 0,H=(R=r.lastLoginAt)!==null&&R!==void 0?R:void 0,{uid:X,emailVerified:ne,isAnonymous:te,providerData:he,stsTokenManager:J}=r;Xt(X&&J,e,"internal-error");const Q=Vb.fromJSON(this.name,J);Xt(typeof X=="string",e,"internal-error"),u_(C,e.name),u_(A,e.name),Xt(typeof ne=="boolean",e,"internal-error"),Xt(typeof te=="boolean",e,"internal-error"),u_(O,e.name),u_(U,e.name),u_(F,e.name),u_(q,e.name),u_(W,e.name),u_(H,e.name);const ce=new km({uid:X,auth:e,email:A,emailVerified:ne,displayName:C,isAnonymous:te,photoURL:U,phoneNumber:O,tenantId:F,stsTokenManager:Q,createdAt:W,lastLoginAt:H});return he&&Array.isArray(he)&&(ce.providerData=he.map(de=>Object.assign({},de))),q&&(ce._redirectEventId=q),ce}static async _fromIdTokenResponse(e,r,a=!1){const l=new Vb;l.updateFromServerResponse(r);const u=new km({uid:r.localId,auth:e,stsTokenManager:l,isAnonymous:a});return await gN(u),u}static async _fromGetAccountInfoResponse(e,r,a){const l=r.users[0];Xt(l.localId!==void 0,"internal-error");const u=l.providerUserInfo!==void 0?yle(l.providerUserInfo):[],p=!(l.email&&l.passwordHash)&&!(u!=null&&u.length),m=new Vb;m.updateFromIdToken(a);const v=new km({uid:l.localId,auth:e,stsTokenManager:m,isAnonymous:p}),w={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:u,metadata:new V6(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(u!=null&&u.length)};return Object.assign(v,w),v}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nne=new Map;function Pm(t){Hm(t instanceof Function,"Expected a class definition");let e=Nne.get(t);return e?(Hm(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Nne.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vle{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,r){this.storage[e]=r}async _get(e){const r=this.storage[e];return r===void 0?null:r}async _remove(e){delete this.storage[e]}_addListener(e,r){}_removeListener(e,r){}}vle.type="NONE";const Ine=vle;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aD(t,e,r){return`firebase:${t}:${e}:${r}`}class Fb{constructor(e,r,a){this.persistence=e,this.auth=r,this.userKey=a;const{config:l,name:u}=this.auth;this.fullUserKey=aD(this.userKey,l.apiKey,u),this.fullPersistenceKey=aD("persistence",l.apiKey,u),this.boundEventHandler=r._onStorageEvent.bind(r),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?km._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const r=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,r)return this.setCurrentUser(r)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,r,a="authUser"){if(!r.length)return new Fb(Pm(Ine),e,a);const l=(await Promise.all(r.map(async w=>{if(await w._isAvailable())return w}))).filter(w=>w);let u=l[0]||Pm(Ine);const p=aD(a,e.config.apiKey,e.name);let m=null;for(const w of r)try{const R=await w._get(p);if(R){const C=km._fromJSON(e,R);w!==u&&(m=C),u=w;break}}catch{}const v=l.filter(w=>w._shouldAllowMigration);return!u._shouldAllowMigration||!v.length?new Fb(u,e,a):(u=v[0],m&&await u._set(p,m.toJSON()),await Promise.all(r.map(async w=>{if(w!==u)try{await w._remove(p)}catch{}})),new Fb(u,e,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ane(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(wle(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Ele(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Tle(e))return"Blackberry";if(Rle(e))return"Webos";if(xle(e))return"Safari";if((e.includes("chrome/")||ble(e))&&!e.includes("edge/"))return"Chrome";if(Sle(e))return"Android";{const r=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=t.match(r);if((a==null?void 0:a.length)===2)return a[1]}return"Other"}function Ele(t=vo()){return/firefox\//i.test(t)}function xle(t=vo()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function ble(t=vo()){return/crios\//i.test(t)}function wle(t=vo()){return/iemobile/i.test(t)}function Sle(t=vo()){return/android/i.test(t)}function Tle(t=vo()){return/blackberry/i.test(t)}function Rle(t=vo()){return/webos/i.test(t)}function tG(t=vo()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function l1e(t=vo()){var e;return tG(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function d1e(){return RIe()&&document.documentMode===10}function Cle(t=vo()){return tG(t)||Sle(t)||Rle(t)||Tle(t)||/windows phone/i.test(t)||wle(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nle(t,e=[]){let r;switch(t){case"Browser":r=Ane(vo());break;case"Worker":r=`${Ane(vo())}-${t}`;break;default:r=t}const a=e.length?e.join(","):"FirebaseCore-web";return`${r}/JsCore/${Bv}/${a}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u1e{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,r){const a=u=>new Promise((p,m)=>{try{const v=e(u);p(v)}catch(v){m(v)}});a.onAbort=r,this.queue.push(a);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const r=[];try{for(const a of this.queue)await a(e),a.onAbort&&r.push(a.onAbort)}catch(a){r.reverse();for(const l of r)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a==null?void 0:a.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function h1e(t,e={}){return bo(t,"GET","/v2/passwordPolicy",xo(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p1e=6;class f1e{constructor(e){var r,a,l,u;const p=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(r=p.minPasswordLength)!==null&&r!==void 0?r:p1e,p.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=p.maxPasswordLength),p.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=p.containsLowercaseCharacter),p.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=p.containsUppercaseCharacter),p.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=p.containsNumericCharacter),p.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=p.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(a=e.allowedNonAlphanumericCharacters)===null||a===void 0?void 0:a.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(u=e.forceUpgradeOnSignin)!==null&&u!==void 0?u:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var r,a,l,u,p,m;const v={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,v),this.validatePasswordCharacterOptions(e,v),v.isValid&&(v.isValid=(r=v.meetsMinPasswordLength)!==null&&r!==void 0?r:!0),v.isValid&&(v.isValid=(a=v.meetsMaxPasswordLength)!==null&&a!==void 0?a:!0),v.isValid&&(v.isValid=(l=v.containsLowercaseLetter)!==null&&l!==void 0?l:!0),v.isValid&&(v.isValid=(u=v.containsUppercaseLetter)!==null&&u!==void 0?u:!0),v.isValid&&(v.isValid=(p=v.containsNumericCharacter)!==null&&p!==void 0?p:!0),v.isValid&&(v.isValid=(m=v.containsNonAlphanumericCharacter)!==null&&m!==void 0?m:!0),v}validatePasswordLengthOptions(e,r){const a=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;a&&(r.meetsMinPasswordLength=e.length>=a),l&&(r.meetsMaxPasswordLength=e.length<=l)}validatePasswordCharacterOptions(e,r){this.updatePasswordCharacterOptionsStatuses(r,!1,!1,!1,!1);let a;for(let l=0;l<e.length;l++)a=e.charAt(l),this.updatePasswordCharacterOptionsStatuses(r,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(e,r,a,l,u){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=r)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m1e{constructor(e,r,a,l){this.app=e,this.heartbeatServiceProvider=r,this.appCheckServiceProvider=a,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new kne(this),this.idTokenSubscription=new kne(this),this.beforeStateQueue=new u1e(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ple,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(e,r){return r&&(this._popupRedirectResolver=Pm(r)),this._initializationPromise=this.queue(async()=>{var a,l;if(!this._deleted&&(this.persistenceManager=await Fb.create(this,e),!this._deleted)){if(!((a=this._popupRedirectResolver)===null||a===void 0)&&a._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(r),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const r=await _le(this,{idToken:e}),a=await km._fromGetAccountInfoResponse(this,r,e);await this.directlySetCurrentUser(a)}catch(r){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",r),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var r;if(Ko(this.app)){const p=this.app.settings.authIdToken;return p?new Promise(m=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(p).then(m,m))}):this.directlySetCurrentUser(null)}const a=await this.assertedPersistence.getCurrentUser();let l=a,u=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const p=(r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId,m=l==null?void 0:l._redirectEventId,v=await this.tryRedirectSignIn(e);(!p||p===m)&&(v!=null&&v.user)&&(l=v.user,u=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(u)try{await this.beforeStateQueue.runMiddleware(l)}catch(p){l=a,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(p))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Xt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(e){let r=null;try{r=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return r}async reloadAndSetCurrentUserOrClear(e){try{await gN(e)}catch(r){if((r==null?void 0:r.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=KAe()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ko(this.app))return Promise.reject(Al(this));const r=e?zn(e):null;return r&&Xt(r.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(r&&r._clone(this))}async _updateCurrentUser(e,r=!1){if(!this._deleted)return e&&Xt(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),r||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ko(this.app)?Promise.reject(Al(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ko(this.app)?Promise.reject(Al(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Pm(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const r=this._getPasswordPolicyInternal();return r.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):r.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await h1e(this),r=new f1e(e);this.tenantId===null?this._projectPasswordPolicy=r:this._tenantPasswordPolicies[this.tenantId]=r}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new HN("auth","Firebase",e())}onAuthStateChanged(e,r,a){return this.registerStateListener(this.authStateSubscription,e,r,a)}beforeAuthStateChanged(e,r){return this.beforeStateQueue.pushCallback(e,r)}onIdTokenChanged(e,r,a){return this.registerStateListener(this.idTokenSubscription,e,r,a)}authStateReady(){return new Promise((e,r)=>{if(this.currentUser)e();else{const a=this.onAuthStateChanged(()=>{a(),e()},r)}})}async revokeAccessToken(e){if(this.currentUser){const r=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:r};this.tenantId!=null&&(a.tenantId=this.tenantId),await c1e(this,a)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,r){const a=await this.getOrInitRedirectPersistenceManager(r);return e===null?a.removeCurrentUser():a.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const r=e&&Pm(e)||this._popupRedirectResolver;Xt(r,this,"argument-error"),this.redirectPersistenceManager=await Fb.create(this,[Pm(r._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var r,a;return this._isInitialized&&await this.queue(async()=>{}),((r=this._currentUser)===null||r===void 0?void 0:r._redirectEventId)===e?this._currentUser:((a=this.redirectUser)===null||a===void 0?void 0:a._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,r;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const a=(r=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&r!==void 0?r:null;this.lastNotifiedUid!==a&&(this.lastNotifiedUid=a,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,r,a,l){if(this._deleted)return()=>{};const u=typeof r=="function"?r:r.next.bind(r);let p=!1;const m=this._isInitialized?Promise.resolve():this._initializationPromise;if(Xt(m,this,"internal-error"),m.then(()=>{p||u(this.currentUser)}),typeof r=="function"){const v=e.addObserver(r,a,l);return()=>{p=!0,v()}}else{const v=e.addObserver(r);return()=>{p=!0,v()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Xt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Nle(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const r={"X-Client-Version":this.clientVersion};this.app.options.appId&&(r["X-Firebase-gmpid"]=this.app.options.appId);const a=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());a&&(r["X-Firebase-Client"]=a);const l=await this._getAppCheckToken();return l&&(r["X-Firebase-AppCheck"]=l),r}async _getAppCheckToken(){var e;const r=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return r!=null&&r.error&&WAe(`Error while retrieving App Check token: ${r.error}`),r==null?void 0:r.token}}function Zo(t){return zn(t)}class kne{constructor(e){this.auth=e,this.observer=null,this.addObserver=PIe(r=>this.observer=r)}get next(){return Xt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let YN={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function g1e(t){YN=t}function nG(t){return YN.loadJS(t)}function _1e(){return YN.recaptchaV2Script}function y1e(){return YN.recaptchaEnterpriseScript}function v1e(){return YN.gapiScript}function Ile(t){return`__${t}${Math.floor(Math.random()*1e6)}`}const E1e="recaptcha-enterprise",x1e="NO_RECAPTCHA";class b1e{constructor(e){this.type=E1e,this.auth=Zo(e)}async verify(e="verify",r=!1){async function a(u){if(!r){if(u.tenantId==null&&u._agentRecaptchaConfig!=null)return u._agentRecaptchaConfig.siteKey;if(u.tenantId!=null&&u._tenantRecaptchaConfigs[u.tenantId]!==void 0)return u._tenantRecaptchaConfigs[u.tenantId].siteKey}return new Promise(async(p,m)=>{ZAe(u,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(v=>{if(v.recaptchaKey===void 0)m(new Error("recaptcha Enterprise site key undefined"));else{const w=new JAe(v);return u.tenantId==null?u._agentRecaptchaConfig=w:u._tenantRecaptchaConfigs[u.tenantId]=w,p(w.siteKey)}}).catch(v=>{m(v)})})}function l(u,p,m){const v=window.grecaptcha;Rne(v)?v.enterprise.ready(()=>{v.enterprise.execute(u,{action:e}).then(w=>{p(w)}).catch(()=>{p(x1e)})}):m(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((u,p)=>{a(this.auth).then(m=>{if(!r&&Rne(window.grecaptcha))l(m,u,p);else{if(typeof window>"u"){p(new Error("RecaptchaVerifier is only supported in browser"));return}let v=y1e();v.length!==0&&(v+=m),nG(v).then(()=>{l(m,u,p)}).catch(w=>{p(w)})}}).catch(m=>{p(m)})})}}async function Pne(t,e,r,a=!1){const l=new b1e(t);let u;try{u=await l.verify(r)}catch{u=await l.verify(r,!0)}const p=Object.assign({},e);return a?Object.assign(p,{captchaResp:u}):Object.assign(p,{captchaResponse:u}),Object.assign(p,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(p,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),p}async function _N(t,e,r,a){var l;if(!((l=t._getRecaptchaConfig())===null||l===void 0)&&l.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const u=await Pne(t,e,r,r==="getOobCode");return a(t,u)}else return a(t,e).catch(async u=>{if(u.code==="auth/missing-recaptcha-token"){console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const p=await Pne(t,e,r,r==="getOobCode");return a(t,p)}else return Promise.reject(u)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w1e(t,e){const r=Lw(t,"auth");if(r.isInitialized()){const l=r.getImmediate(),u=r.getOptions();if(J_(u,e??{}))return l;Xd(l,"already-initialized")}return r.initialize({options:e})}function S1e(t,e){const r=(e==null?void 0:e.persistence)||[],a=(Array.isArray(r)?r:[r]).map(Pm);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(a,e==null?void 0:e.popupRedirectResolver)}function T1e(t,e,r){const a=Zo(t);Xt(a._canInitEmulator,a,"emulator-config-failed"),Xt(/^https?:\/\//.test(e),a,"invalid-emulator-scheme");const l=!1,u=Ale(e),{host:p,port:m}=R1e(e),v=m===null?"":`:${m}`;a.config.emulator={url:`${u}//${p}${v}/`},a.settings.appVerificationDisabledForTesting=!0,a.emulatorConfig=Object.freeze({host:p,port:m,protocol:u.replace(":",""),options:Object.freeze({disableWarnings:l})}),C1e()}function Ale(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function R1e(t){const e=Ale(t),r=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!r)return{host:"",port:null};const a=r[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(a);if(l){const u=l[1];return{host:u,port:Dne(a.substr(u.length+1))}}else{const[u,p]=a.split(":");return{host:u,port:Dne(p)}}}function Dne(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function C1e(){function t(){const e=document.createElement("p"),r=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",r.position="fixed",r.width="100%",r.backgroundColor="#ffffff",r.border=".1em solid #000000",r.color="#b50000",r.bottom="0px",r.left="0px",r.margin="0px",r.zIndex="10000",r.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oL{constructor(e,r){this.providerId=e,this.signInMethod=r}toJSON(){return Am("not implemented")}_getIdTokenResponse(e){return Am("not implemented")}_linkToIdToken(e,r){return Am("not implemented")}_getReauthenticationResolver(e){return Am("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kle(t,e){return bo(t,"POST","/v1/accounts:resetPassword",xo(t,e))}async function N1e(t,e){return bo(t,"POST","/v1/accounts:update",e)}async function I1e(t,e){return bo(t,"POST","/v1/accounts:signUp",e)}async function A1e(t,e){return bo(t,"POST","/v1/accounts:update",xo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function k1e(t,e){return tg(t,"POST","/v1/accounts:signInWithPassword",xo(t,e))}async function cL(t,e){return bo(t,"POST","/v1/accounts:sendOobCode",xo(t,e))}async function P1e(t,e){return cL(t,e)}async function D1e(t,e){return cL(t,e)}async function O1e(t,e){return cL(t,e)}async function L1e(t,e){return cL(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function j1e(t,e){return tg(t,"POST","/v1/accounts:signInWithEmailLink",xo(t,e))}async function M1e(t,e){return tg(t,"POST","/v1/accounts:signInWithEmailLink",xo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yN extends oL{constructor(e,r,a,l=null){super("password",a),this._email=e,this._password=r,this._tenantId=l}static _fromEmailAndPassword(e,r){return new yN(e,r,"password")}static _fromEmailAndCode(e,r,a=null){return new yN(e,r,"emailLink",a)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const r=typeof e=="string"?JSON.parse(e):e;if(r!=null&&r.email&&(r!=null&&r.password)){if(r.signInMethod==="password")return this._fromEmailAndPassword(r.email,r.password);if(r.signInMethod==="emailLink")return this._fromEmailAndCode(r.email,r.password,r.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const r={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return _N(e,r,"signInWithPassword",k1e);case"emailLink":return j1e(e,{email:this._email,oobCode:this._password});default:Xd(e,"internal-error")}}async _linkToIdToken(e,r){switch(this.signInMethod){case"password":const a={idToken:r,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return _N(e,a,"signUpPassword",I1e);case"emailLink":return M1e(e,{idToken:r,email:this._email,oobCode:this._password});default:Xd(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bb(t,e){return tg(t,"POST","/v1/accounts:signInWithIdp",xo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U1e="http://localhost";class Km extends oL{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const r=new Km(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(r.idToken=e.idToken),e.accessToken&&(r.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(r.nonce=e.nonce),e.pendingToken&&(r.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(r.accessToken=e.oauthToken,r.secret=e.oauthTokenSecret):Xd("argument-error"),r}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const r=typeof e=="string"?JSON.parse(e):e,{providerId:a,signInMethod:l}=r,u=X8(r,["providerId","signInMethod"]);if(!a||!l)return null;const p=new Km(a,l);return p.idToken=u.idToken||void 0,p.accessToken=u.accessToken||void 0,p.secret=u.secret,p.nonce=u.nonce,p.pendingToken=u.pendingToken||null,p}_getIdTokenResponse(e){const r=this.buildRequest();return Bb(e,r)}_linkToIdToken(e,r){const a=this.buildRequest();return a.idToken=r,Bb(e,a)}_getReauthenticationResolver(e){const r=this.buildRequest();return r.autoCreate=!1,Bb(e,r)}buildRequest(){const e={requestUri:U1e,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const r={};this.idToken&&(r.id_token=this.idToken),this.accessToken&&(r.access_token=this.accessToken),this.secret&&(r.oauth_token_secret=this.secret),r.providerId=this.providerId,this.nonce&&!this.pendingToken&&(r.nonce=this.nonce),e.postBody=Ow(r)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function V1e(t,e){return bo(t,"POST","/v1/accounts:sendVerificationCode",xo(t,e))}async function F1e(t,e){return tg(t,"POST","/v1/accounts:signInWithPhoneNumber",xo(t,e))}async function B1e(t,e){const r=await tg(t,"POST","/v1/accounts:signInWithPhoneNumber",xo(t,e));if(r.temporaryProof)throw hC(t,"account-exists-with-different-credential",r);return r}const z1e={USER_NOT_FOUND:"user-not-found"};async function G1e(t,e){const r=Object.assign(Object.assign({},e),{operation:"REAUTH"});return tg(t,"POST","/v1/accounts:signInWithPhoneNumber",xo(t,r),z1e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PC extends oL{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,r){return new PC({verificationId:e,verificationCode:r})}static _fromTokenResponse(e,r){return new PC({phoneNumber:e,temporaryProof:r})}_getIdTokenResponse(e){return F1e(e,this._makeVerificationRequest())}_linkToIdToken(e,r){return B1e(e,Object.assign({idToken:r},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return G1e(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:r,verificationId:a,verificationCode:l}=this.params;return e&&r?{temporaryProof:e,phoneNumber:r}:{sessionInfo:a,code:l}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:r,verificationCode:a,phoneNumber:l,temporaryProof:u}=e;return!a&&!r&&!l&&!u?null:new PC({verificationId:r,verificationCode:a,phoneNumber:l,temporaryProof:u})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W1e(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function H1e(t){const e=dC(uC(t)).link,r=e?dC(uC(e)).deep_link_id:null,a=dC(uC(t)).deep_link_id;return(a?dC(uC(a)).link:null)||a||r||e||t}class lL{constructor(e){var r,a,l,u,p,m;const v=dC(uC(e)),w=(r=v.apiKey)!==null&&r!==void 0?r:null,R=(a=v.oobCode)!==null&&a!==void 0?a:null,C=W1e((l=v.mode)!==null&&l!==void 0?l:null);Xt(w&&R&&C,"argument-error"),this.apiKey=w,this.operation=C,this.code=R,this.continueUrl=(u=v.continueUrl)!==null&&u!==void 0?u:null,this.languageCode=(p=v.languageCode)!==null&&p!==void 0?p:null,this.tenantId=(m=v.tenantId)!==null&&m!==void 0?m:null}static parseLink(e){const r=H1e(e);try{return new lL(r)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zv{constructor(){this.providerId=zv.PROVIDER_ID}static credential(e,r){return yN._fromEmailAndPassword(e,r)}static credentialWithLink(e,r){const a=lL.parseLink(r);return Xt(a,"argument-error"),yN._fromEmailAndCode(e,a.code,a.tenantId)}}zv.PROVIDER_ID="password";zv.EMAIL_PASSWORD_SIGN_IN_METHOD="password";zv.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gv{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jw extends Gv{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class oD extends jw{static credentialFromJSON(e){const r=typeof e=="string"?JSON.parse(e):e;return Xt("providerId"in r&&"signInMethod"in r,"argument-error"),Km._fromParams(r)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return Xt(e.idToken||e.accessToken,"argument-error"),Km._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return oD.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return oD.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:r,oauthAccessToken:a,oauthTokenSecret:l,pendingToken:u,nonce:p,providerId:m}=e;if(!a&&!l&&!r&&!u||!m)return null;try{return new oD(m)._credential({idToken:r,accessToken:a,nonce:p,pendingToken:u})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x_ extends jw{constructor(){super("facebook.com")}static credential(e){return Km._fromParams({providerId:x_.PROVIDER_ID,signInMethod:x_.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return x_.credentialFromTaggedObject(e)}static credentialFromError(e){return x_.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return x_.credential(e.oauthAccessToken)}catch{return null}}}x_.FACEBOOK_SIGN_IN_METHOD="facebook.com";x_.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gd extends jw{constructor(){super("google.com"),this.addScope("profile")}static credential(e,r){return Km._fromParams({providerId:Gd.PROVIDER_ID,signInMethod:Gd.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:r})}static credentialFromResult(e){return Gd.credentialFromTaggedObject(e)}static credentialFromError(e){return Gd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:r,oauthAccessToken:a}=e;if(!r&&!a)return null;try{return Gd.credential(r,a)}catch{return null}}}Gd.GOOGLE_SIGN_IN_METHOD="google.com";Gd.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b_ extends jw{constructor(){super("github.com")}static credential(e){return Km._fromParams({providerId:b_.PROVIDER_ID,signInMethod:b_.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return b_.credentialFromTaggedObject(e)}static credentialFromError(e){return b_.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return b_.credential(e.oauthAccessToken)}catch{return null}}}b_.GITHUB_SIGN_IN_METHOD="github.com";b_.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w_ extends jw{constructor(){super("twitter.com")}static credential(e,r){return Km._fromParams({providerId:w_.PROVIDER_ID,signInMethod:w_.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:r})}static credentialFromResult(e){return w_.credentialFromTaggedObject(e)}static credentialFromError(e){return w_.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:r,oauthTokenSecret:a}=e;if(!r||!a)return null;try{return w_.credential(r,a)}catch{return null}}}w_.TWITTER_SIGN_IN_METHOD="twitter.com";w_.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ple(t,e){return tg(t,"POST","/v1/accounts:signUp",xo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class If{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,r,a,l=!1){const u=await km._fromIdTokenResponse(e,a,l),p=One(a);return new If({user:u,providerId:p,_tokenResponse:a,operationType:r})}static async _forOperation(e,r,a){await e._updateTokensIfNecessary(a,!0);const l=One(a);return new If({user:e,providerId:l,_tokenResponse:a,operationType:r})}}function One(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gWe(t){var e;if(Ko(t.app))return Promise.reject(Al(t));const r=Zo(t);if(await r._initializationPromise,!((e=r.currentUser)===null||e===void 0)&&e.isAnonymous)return new If({user:r.currentUser,providerId:null,operationType:"signIn"});const a=await Ple(r,{returnSecureToken:!0}),l=await If._fromIdTokenResponse(r,"signIn",a,!0);return await r._updateCurrentUser(l.user),l}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eO extends Pf{constructor(e,r,a,l){var u;super(r.code,r.message),this.operationType=a,this.user=l,Object.setPrototypeOf(this,eO.prototype),this.customData={appName:e.name,tenantId:(u=e.tenantId)!==null&&u!==void 0?u:void 0,_serverResponse:r.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(e,r,a,l){return new eO(e,r,a,l)}}function Dle(t,e,r,a){return(e==="reauthenticate"?r._getReauthenticationResolver(t):r._getIdTokenResponse(t)).catch(u=>{throw u.code==="auth/multi-factor-auth-required"?eO._fromErrorAndOperation(t,u,e,a):u})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ole(t){return new Set(t.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _We(t,e){const r=zn(t);await dL(!0,r,e);const{providerUserInfo:a}=await t1e(r.auth,{idToken:await r.getIdToken(),deleteProvider:[e]}),l=Ole(a||[]);return r.providerData=r.providerData.filter(u=>l.has(u.providerId)),l.has("phone")||(r.phoneNumber=null),await r.auth._persistUserIfCurrent(r),r}async function Lle(t,e,r=!1){const a=await Tv(t,e._linkToIdToken(t.auth,await t.getIdToken()),r);return If._forOperation(t,"link",a)}async function dL(t,e,r){await gN(e);const a=Ole(e.providerData),l=t===!1?"provider-already-linked":"no-such-provider";Xt(a.has(r)===t,e.auth,l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function K1e(t,e,r=!1){const{auth:a}=t;if(Ko(a.app))return Promise.reject(Al(a));const l="reauthenticate";try{const u=await Tv(t,Dle(a,l,e,t),r);Xt(u.idToken,a,"internal-error");const p=aL(u.idToken);Xt(p,a,"internal-error");const{sub:m}=p;return Xt(t.uid===m,a,"user-mismatch"),If._forOperation(t,l,u)}catch(u){throw(u==null?void 0:u.code)==="auth/user-not-found"&&Xd(a,"user-mismatch"),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jle(t,e,r=!1){if(Ko(t.app))return Promise.reject(Al(t));const a="signIn",l=await Dle(t,a,e),u=await If._fromIdTokenResponse(t,a,l);return r||await t._updateCurrentUser(u.user),u}async function uL(t,e){return jle(Zo(t),e)}async function q1e(t,e){const r=zn(t);return await dL(!1,r,e.providerId),Lle(r,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Y1e(t,e){return tg(t,"POST","/v1/accounts:signInWithCustomToken",xo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yWe(t,e){if(Ko(t.app))return Promise.reject(Al(t));const r=Zo(t),a=await Y1e(r,{token:e,returnSecureToken:!0}),l=await If._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(l.user),l}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rG{constructor(e,r){this.factorId=e,this.uid=r.mfaEnrollmentId,this.enrollmentTime=new Date(r.enrolledAt).toUTCString(),this.displayName=r.displayName}static _fromServerResponse(e,r){return"phoneInfo"in r?iG._fromServerResponse(e,r):"totpInfo"in r?sG._fromServerResponse(e,r):Xd(e,"internal-error")}}class iG extends rG{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,r){return new iG(r)}}class sG extends rG{constructor(e){super("totp",e)}static _fromServerResponse(e,r){return new sG(r)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hL(t,e,r){var a;Xt(((a=r.url)===null||a===void 0?void 0:a.length)>0,t,"invalid-continue-uri"),Xt(typeof r.dynamicLinkDomain>"u"||r.dynamicLinkDomain.length>0,t,"invalid-dynamic-link-domain"),e.continueUrl=r.url,e.dynamicLinkDomain=r.dynamicLinkDomain,e.canHandleCodeInApp=r.handleCodeInApp,r.iOS&&(Xt(r.iOS.bundleId.length>0,t,"missing-ios-bundle-id"),e.iOSBundleId=r.iOS.bundleId),r.android&&(Xt(r.android.packageName.length>0,t,"missing-android-pkg-name"),e.androidInstallApp=r.android.installApp,e.androidMinimumVersionCode=r.android.minimumVersion,e.androidPackageName=r.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aG(t){const e=Zo(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function $1e(t,e,r){const a=Zo(t),l={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};r&&hL(a,l,r),await _N(a,l,"getOobCode",D1e)}async function X1e(t,e,r){await kle(zn(t),{oobCode:e,newPassword:r}).catch(async a=>{throw a.code==="auth/password-does-not-meet-requirements"&&aG(t),a})}async function vWe(t,e){await A1e(zn(t),{oobCode:e})}async function J1e(t,e){const r=zn(t),a=await kle(r,{oobCode:e}),l=a.requestType;switch(Xt(l,r,"internal-error"),l){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":Xt(a.newEmail,r,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":Xt(a.mfaInfo,r,"internal-error");default:Xt(a.email,r,"internal-error")}let u=null;return a.mfaInfo&&(u=rG._fromServerResponse(Zo(r),a.mfaInfo)),{data:{email:(a.requestType==="VERIFY_AND_CHANGE_EMAIL"?a.newEmail:a.email)||null,previousEmail:(a.requestType==="VERIFY_AND_CHANGE_EMAIL"?a.email:a.newEmail)||null,multiFactorInfo:u},operation:l}}async function Q1e(t,e){const{data:r}=await J1e(zn(t),e);return r.email}async function $N(t,e,r){if(Ko(t.app))return Promise.reject(Al(t));const a=Zo(t),p=await _N(a,{returnSecureToken:!0,email:e,password:r,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Ple).catch(v=>{throw v.code==="auth/password-does-not-meet-requirements"&&aG(t),v}),m=await If._fromIdTokenResponse(a,"signIn",p);return await a._updateCurrentUser(m.user),m}function Mle(t,e,r){return Ko(t.app)?Promise.reject(Al(t)):uL(zn(t),zv.credential(e,r)).catch(async a=>{throw a.code==="auth/password-does-not-meet-requirements"&&aG(t),a})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EWe(t,e,r){const a=Zo(t),l={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function u(p,m){Xt(m.handleCodeInApp,a,"argument-error"),m&&hL(a,p,m)}u(l,r),await _N(a,l,"getOobCode",O1e)}function xWe(t,e){const r=lL.parseLink(e);return(r==null?void 0:r.operation)==="EMAIL_SIGNIN"}async function bWe(t,e,r){if(Ko(t.app))return Promise.reject(Al(t));const a=zn(t),l=zv.credentialWithLink(e,r||mN());return Xt(l._tenantId===(a.tenantId||null),a,"tenant-id-mismatch"),uL(a,l)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Z1e(t,e){return bo(t,"POST","/v1/accounts:createAuthUri",xo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wWe(t,e){const r=Z8()?mN():"http://localhost",a={identifier:e,continueUri:r},{signinMethods:l}=await Z1e(zn(t),a);return l||[]}async function SWe(t,e){const r=zn(t),l={requestType:"VERIFY_EMAIL",idToken:await t.getIdToken()};e&&hL(r.auth,l,e);const{email:u}=await P1e(r.auth,l);u!==t.email&&await t.reload()}async function TWe(t,e,r){const a=zn(t),u={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await t.getIdToken(),newEmail:e};r&&hL(a.auth,u,r);const{email:p}=await L1e(a.auth,u);p!==t.email&&await t.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eke(t,e){return bo(t,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function RWe(t,{displayName:e,photoURL:r}){if(e===void 0&&r===void 0)return;const a=zn(t),u={idToken:await a.getIdToken(),displayName:e,photoUrl:r,returnSecureToken:!0},p=await Tv(a,eke(a.auth,u));a.displayName=p.displayName||null,a.photoURL=p.photoUrl||null;const m=a.providerData.find(({providerId:v})=>v==="password");m&&(m.displayName=a.displayName,m.photoURL=a.photoURL),await a._updateTokensIfNecessary(p)}function CWe(t,e){const r=zn(t);return Ko(r.auth.app)?Promise.reject(Al(r.auth)):Ule(r,e,null)}function NWe(t,e){return Ule(zn(t),null,e)}async function Ule(t,e,r){const{auth:a}=t,u={idToken:await t.getIdToken(),returnSecureToken:!0};e&&(u.email=e),r&&(u.password=r);const p=await Tv(t,N1e(a,u));await t._updateTokensIfNecessary(p,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tke(t){var e,r;if(!t)return null;const{providerId:a}=t,l=t.rawUserInfo?JSON.parse(t.rawUserInfo):{},u=t.isNewUser||t.kind==="identitytoolkit#SignupNewUserResponse";if(!a&&(t!=null&&t.idToken)){const p=(r=(e=aL(t.idToken))===null||e===void 0?void 0:e.firebase)===null||r===void 0?void 0:r.sign_in_provider;if(p){const m=p!=="anonymous"&&p!=="custom"?p:null;return new zb(u,m)}}if(!a)return null;switch(a){case"facebook.com":return new nke(u,l);case"github.com":return new rke(u,l);case"google.com":return new ike(u,l);case"twitter.com":return new ske(u,l,t.screenName||null);case"custom":case"anonymous":return new zb(u,null);default:return new zb(u,a,l)}}class zb{constructor(e,r,a={}){this.isNewUser=e,this.providerId=r,this.profile=a}}class Vle extends zb{constructor(e,r,a,l){super(e,r,a),this.username=l}}class nke extends zb{constructor(e,r){super(e,"facebook.com",r)}}class rke extends Vle{constructor(e,r){super(e,"github.com",r,typeof(r==null?void 0:r.login)=="string"?r==null?void 0:r.login:null)}}class ike extends zb{constructor(e,r){super(e,"google.com",r)}}class ske extends Vle{constructor(e,r,a){super(e,"twitter.com",r,a)}}function IWe(t){const{user:e,_tokenResponse:r}=t;return e.isAnonymous&&!r?{providerId:null,isNewUser:!1,profile:null}:tke(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AWe(t,e){return zn(t).setPersistence(e)}function ake(t,e,r,a){return zn(t).onIdTokenChanged(e,r,a)}function oke(t,e,r){return zn(t).beforeAuthStateChanged(e,r)}function cke(t,e,r,a){return zn(t).onAuthStateChanged(e,r,a)}function Fle(t){return zn(t).signOut()}function kWe(t,e){return Zo(t).revokeAccessToken(e)}async function Lne(t){return zn(t).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lke(t,e){return bo(t,"POST","/v2/accounts/mfaEnrollment:start",xo(t,e))}const tO="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ble{constructor(e,r){this.storageRetriever=e,this.type=r}_isAvailable(){try{return this.storage?(this.storage.setItem(tO,"1"),this.storage.removeItem(tO),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,r){return this.storage.setItem(e,JSON.stringify(r)),Promise.resolve()}_get(e){const r=this.storage.getItem(e);return Promise.resolve(r?JSON.parse(r):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dke=1e3,uke=10;class zle extends Ble{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,r)=>this.onStorageEvent(e,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Cle(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const r of Object.keys(this.listeners)){const a=this.storage.getItem(r),l=this.localCache[r];a!==l&&e(r,l,a)}}onStorageEvent(e,r=!1){if(!e.key){this.forAllChangedKeys((p,m,v)=>{this.notifyListeners(p,v)});return}const a=e.key;r?this.detachListener():this.stopPolling();const l=()=>{const p=this.storage.getItem(a);!r&&this.localCache[a]===p||this.notifyListeners(a,p)},u=this.storage.getItem(a);d1e()&&u!==e.newValue&&e.newValue!==e.oldValue?setTimeout(l,uke):l()}notifyListeners(e,r){this.localCache[e]=r;const a=this.listeners[e];if(a)for(const l of Array.from(a))l(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,r,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:r,newValue:a}),!0)})},dke)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(r)}_removeListener(e,r){this.listeners[e]&&(this.listeners[e].delete(r),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,r){await super._set(e,r),this.localCache[e]=JSON.stringify(r)}async _get(e){const r=await super._get(e);return this.localCache[e]=JSON.stringify(r),r}async _remove(e){await super._remove(e),delete this.localCache[e]}}zle.type="LOCAL";const hke=zle;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gle extends Ble{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,r){}_removeListener(e,r){}}Gle.type="SESSION";const Wle=Gle;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pke(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(r){return{fulfilled:!1,reason:r}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pL{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const r=this.receivers.find(l=>l.isListeningto(e));if(r)return r;const a=new pL(e);return this.receivers.push(a),a}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const r=e,{eventId:a,eventType:l,data:u}=r.data,p=this.handlersMap[l];if(!(p!=null&&p.size))return;r.ports[0].postMessage({status:"ack",eventId:a,eventType:l});const m=Array.from(p).map(async w=>w(r.origin,u)),v=await pke(m);r.ports[0].postMessage({status:"done",eventId:a,eventType:l,response:v})}_subscribe(e,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(r)}_unsubscribe(e,r){this.handlersMap[e]&&r&&this.handlersMap[e].delete(r),(!r||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}pL.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fL(t="",e=10){let r="";for(let a=0;a<e;a++)r+=Math.floor(Math.random()*10);return t+r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fke{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,r,a=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let u,p;return new Promise((m,v)=>{const w=fL("",20);l.port1.start();const R=setTimeout(()=>{v(new Error("unsupported_event"))},a);p={messageChannel:l,onMessage(C){const A=C;if(A.data.eventId===w)switch(A.data.status){case"ack":clearTimeout(R),u=setTimeout(()=>{v(new Error("timeout"))},3e3);break;case"done":clearTimeout(u),m(A.data.response);break;default:clearTimeout(R),clearTimeout(u),v(new Error("invalid_response"));break}}},this.handlers.add(p),l.port1.addEventListener("message",p.onMessage),this.target.postMessage({eventType:e,eventId:w,data:r},[l.port2])}).finally(()=>{p&&this.removeMessageHandler(p)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eo(){return window}function mke(t){eo().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oG(){return typeof eo().WorkerGlobalScope<"u"&&typeof eo().importScripts=="function"}async function gke(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function _ke(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function yke(){return oG()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hle="firebaseLocalStorageDb",vke=1,nO="firebaseLocalStorage",Kle="fbase_key";class XN{constructor(e){this.request=e}toPromise(){return new Promise((e,r)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{r(this.request.error)})})}}function mL(t,e){return t.transaction([nO],e?"readwrite":"readonly").objectStore(nO)}function Eke(){const t=indexedDB.deleteDatabase(Hle);return new XN(t).toPromise()}function F6(){const t=indexedDB.open(Hle,vke);return new Promise((e,r)=>{t.addEventListener("error",()=>{r(t.error)}),t.addEventListener("upgradeneeded",()=>{const a=t.result;try{a.createObjectStore(nO,{keyPath:Kle})}catch(l){r(l)}}),t.addEventListener("success",async()=>{const a=t.result;a.objectStoreNames.contains(nO)?e(a):(a.close(),await Eke(),e(await F6()))})})}async function jne(t,e,r){const a=mL(t,!0).put({[Kle]:e,value:r});return new XN(a).toPromise()}async function xke(t,e){const r=mL(t,!1).get(e),a=await new XN(r).toPromise();return a===void 0?null:a.value}function Mne(t,e){const r=mL(t,!0).delete(e);return new XN(r).toPromise()}const bke=800,wke=3;class qle{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await F6(),this.db)}async _withRetries(e){let r=0;for(;;)try{const a=await this._openDb();return await e(a)}catch(a){if(r++>wke)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return oG()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=pL._getInstance(yke()),this.receiver._subscribe("keyChanged",async(e,r)=>({keyProcessed:(await this._poll()).includes(r.key)})),this.receiver._subscribe("ping",async(e,r)=>["keyChanged"])}async initializeSender(){var e,r;if(this.activeServiceWorker=await gke(),!this.activeServiceWorker)return;this.sender=new fke(this.activeServiceWorker);const a=await this.sender._send("ping",{},800);a&&!((e=a[0])===null||e===void 0)&&e.fulfilled&&!((r=a[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||_ke()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await F6();return await jne(e,tO,"1"),await Mne(e,tO),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,r){return this._withPendingWrite(async()=>(await this._withRetries(a=>jne(a,e,r)),this.localCache[e]=r,this.notifyServiceWorker(e)))}async _get(e){const r=await this._withRetries(a=>xke(a,e));return this.localCache[e]=r,r}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(r=>Mne(r,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(l=>{const u=mL(l,!1).getAll();return new XN(u).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const r=[],a=new Set;if(e.length!==0)for(const{fbase_key:l,value:u}of e)a.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(u)&&(this.notifyListeners(l,u),r.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!a.has(l)&&(this.notifyListeners(l,null),r.push(l));return r}notifyListeners(e,r){this.localCache[e]=r;const a=this.listeners[e];if(a)for(const l of Array.from(a))l(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),bke)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(r)}_removeListener(e,r){this.listeners[e]&&(this.listeners[e].delete(r),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}qle.type="LOCAL";const Ske=qle;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tke(t,e){return bo(t,"POST","/v2/accounts/mfaSignIn:start",xo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rke=500,Cke=6e4,R2=1e12;class Nke{constructor(e){this.auth=e,this.counter=R2,this._widgets=new Map}render(e,r){const a=this.counter;return this._widgets.set(a,new Ike(e,this.auth.name,r||{})),this.counter++,a}reset(e){var r;const a=e||R2;(r=this._widgets.get(a))===null||r===void 0||r.delete(),this._widgets.delete(a)}getResponse(e){var r;const a=e||R2;return((r=this._widgets.get(a))===null||r===void 0?void 0:r.getResponse())||""}async execute(e){var r;const a=e||R2;return(r=this._widgets.get(a))===null||r===void 0||r.execute(),""}}class Ike{constructor(e,r,a){this.params=a,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const l=typeof e=="string"?document.getElementById(e):e;Xt(l,"argument-error",{appName:r}),this.container=l,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=Ake(50);const{callback:e,"expired-callback":r}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,r)try{r()}catch{}this.isVisible&&this.execute()},Cke)},Rke))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function Ake(t){const e=[],r="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let a=0;a<t;a++)e.push(r.charAt(Math.floor(Math.random()*r.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jF=Ile("rcb"),kke=new qN(3e4,6e4);class Pke{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=eo().grecaptcha)===null||e===void 0)&&e.render)}load(e,r=""){return Xt(Dke(r),e,"argument-error"),this.shouldResolveImmediately(r)&&Tne(eo().grecaptcha)?Promise.resolve(eo().grecaptcha):new Promise((a,l)=>{const u=eo().setTimeout(()=>{l(Il(e,"network-request-failed"))},kke.get());eo()[jF]=()=>{eo().clearTimeout(u),delete eo()[jF];const m=eo().grecaptcha;if(!m||!Tne(m)){l(Il(e,"internal-error"));return}const v=m.render;m.render=(w,R)=>{const C=v(w,R);return this.counter++,C},this.hostLanguage=r,a(m)};const p=`${_1e()}?${Ow({onload:jF,render:"explicit",hl:r})}`;nG(p).catch(()=>{clearTimeout(u),l(Il(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var r;return!!(!((r=eo().grecaptcha)===null||r===void 0)&&r.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function Dke(t){return t.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(t)}class Oke{async load(e){return new Nke(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yle="recaptcha",Lke={theme:"light",type:"image"};class PWe{constructor(e,r,a=Object.assign({},Lke)){this.parameters=a,this.type=Yle,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Zo(e),this.isInvisible=this.parameters.size==="invisible",Xt(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const l=typeof r=="string"?document.getElementById(r):r;Xt(l,this.auth,"argument-error"),this.container=l,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Oke:new Pke,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),r=this.getAssertedRecaptcha(),a=r.getResponse(e);return a||new Promise(l=>{const u=p=>{p&&(this.tokenChangeListeners.delete(u),l(p))};this.tokenChangeListeners.add(u),this.isInvisible&&r.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){Xt(!this.parameters.sitekey,this.auth,"argument-error"),Xt(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),Xt(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return r=>{if(this.tokenChangeListeners.forEach(a=>a(r)),typeof e=="function")e(r);else if(typeof e=="string"){const a=eo()[e];typeof a=="function"&&a(r)}}}assertNotDestroyed(){Xt(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const r=document.createElement("div");e.appendChild(r),e=r}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){Xt(Z8()&&!oG(),this.auth,"internal-error"),await jke(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await QAe(this.auth);Xt(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return Xt(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function jke(){let t=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}t=()=>e(),window.addEventListener("load",t)}).catch(e=>{throw t&&window.removeEventListener("load",t),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $le{constructor(e,r){this.verificationId=e,this.onConfirmation=r}confirm(e){const r=PC._fromVerification(this.verificationId,e);return this.onConfirmation(r)}}async function DWe(t,e,r){if(Ko(t.app))return Promise.reject(Al(t));const a=Zo(t),l=await Xle(a,e,zn(r));return new $le(l,u=>uL(a,u))}async function OWe(t,e,r){const a=zn(t);await dL(!1,a,"phone");const l=await Xle(a.auth,e,zn(r));return new $le(l,u=>q1e(a,u))}async function Xle(t,e,r){var a;const l=await r.verify();try{Xt(typeof l=="string",t,"argument-error"),Xt(r.type===Yle,t,"argument-error");let u;if(typeof e=="string"?u={phoneNumber:e}:u=e,"session"in u){const p=u.session;if("phoneNumber"in u)return Xt(p.type==="enroll",t,"internal-error"),(await lke(t,{idToken:p.credential,phoneEnrollmentInfo:{phoneNumber:u.phoneNumber,recaptchaToken:l}})).phoneSessionInfo.sessionInfo;{Xt(p.type==="signin",t,"internal-error");const m=((a=u.multiFactorHint)===null||a===void 0?void 0:a.uid)||u.multiFactorUid;return Xt(m,t,"missing-multi-factor-info"),(await Tke(t,{mfaPendingCredential:p.credential,mfaEnrollmentId:m,phoneSignInInfo:{recaptchaToken:l}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:p}=await V1e(t,{phoneNumber:u.phoneNumber,recaptchaToken:l});return p}}finally{r._reset()}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mw(t,e){return e?Pm(e):(Xt(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cG extends oL{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Bb(e,this._buildIdpRequest())}_linkToIdToken(e,r){return Bb(e,this._buildIdpRequest(r))}_getReauthenticationResolver(e){return Bb(e,this._buildIdpRequest())}_buildIdpRequest(e){const r={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(r.idToken=e),r}}function Mke(t){return jle(t.auth,new cG(t),t.bypassAuthState)}function Uke(t){const{auth:e,user:r}=t;return Xt(r,e,"internal-error"),K1e(r,new cG(t),t.bypassAuthState)}async function Vke(t){const{auth:e,user:r}=t;return Xt(r,e,"internal-error"),Lle(r,new cG(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jle{constructor(e,r,a,l,u=!1){this.auth=e,this.resolver=a,this.user=l,this.bypassAuthState=u,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(r)?r:[r]}execute(){return new Promise(async(e,r)=>{this.pendingPromise={resolve:e,reject:r};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(e){const{urlResponse:r,sessionId:a,postBody:l,tenantId:u,error:p,type:m}=e;if(p){this.reject(p);return}const v={auth:this.auth,requestUri:r,sessionId:a,tenantId:u||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(m)(v))}catch(w){this.reject(w)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Mke;case"linkViaPopup":case"linkViaRedirect":return Vke;case"reauthViaPopup":case"reauthViaRedirect":return Uke;default:Xd(this.auth,"internal-error")}}resolve(e){Hm(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Hm(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fke=new qN(2e3,1e4);async function lG(t,e,r){if(Ko(t.app))return Promise.reject(Il(t,"operation-not-supported-in-this-environment"));const a=Zo(t);KN(t,e,Gv);const l=Mw(a,r);return new Dm(a,"signInViaPopup",e,l).executeNotNull()}async function Bke(t,e,r){const a=zn(t);if(Ko(a.auth.app))return Promise.reject(Il(a.auth,"operation-not-supported-in-this-environment"));KN(a.auth,e,Gv);const l=Mw(a.auth,r);return new Dm(a.auth,"reauthViaPopup",e,l,a).executeNotNull()}async function LWe(t,e,r){const a=zn(t);KN(a.auth,e,Gv);const l=Mw(a.auth,r);return new Dm(a.auth,"linkViaPopup",e,l,a).executeNotNull()}class Dm extends Jle{constructor(e,r,a,l,u){super(e,r,l,u),this.provider=a,this.authWindow=null,this.pollId=null,Dm.currentPopupAction&&Dm.currentPopupAction.cancel(),Dm.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Xt(e,this.auth,"internal-error"),e}async onExecution(){Hm(this.filter.length===1,"Popup operations only handle one event");const e=fL();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(r=>{this.reject(r)}),this.resolver._isIframeWebStorageSupported(this.auth,r=>{r||this.reject(Il(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Il(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Dm.currentPopupAction=null}pollUserCancellation(){const e=()=>{var r,a;if(!((a=(r=this.authWindow)===null||r===void 0?void 0:r.window)===null||a===void 0)&&a.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Il(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Fke.get())};e()}}Dm.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zke="pendingRedirect",cD=new Map;class Gke extends Jle{constructor(e,r,a=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],r,void 0,a),this.eventId=null}async execute(){let e=cD.get(this.auth._key());if(!e){try{const a=await Wke(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(a)}catch(r){e=()=>Promise.reject(r)}cD.set(this.auth._key(),e)}return this.bypassAuthState||cD.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const r=await this.auth._redirectUserForId(e.eventId);if(r)return this.user=r,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Wke(t,e){const r=ede(e),a=Zle(t);if(!await a._isAvailable())return!1;const l=await a._get(r)==="true";return await a._remove(r),l}async function Qle(t,e){return Zle(t)._set(ede(e),"true")}function Hke(t,e){cD.set(t._key(),e)}function Zle(t){return Pm(t._redirectPersistence)}function ede(t){return aD(zke,t.config.apiKey,t.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kke(t,e,r){return qke(t,e,r)}async function qke(t,e,r){if(Ko(t.app))return Promise.reject(Al(t));const a=Zo(t);KN(t,e,Gv),await a._initializationPromise;const l=Mw(a,r);return await Qle(l,a),l._openRedirect(a,e,"signInViaRedirect")}function jWe(t,e,r){return Yke(t,e,r)}async function Yke(t,e,r){const a=zn(t);KN(a.auth,e,Gv),await a.auth._initializationPromise;const l=Mw(a.auth,r);await dL(!1,a,e.providerId),await Qle(l,a.auth);const u=await Xke(a);return l._openRedirect(a.auth,e,"linkViaRedirect",u)}async function $ke(t,e){return await Zo(t)._initializationPromise,tde(t,e,!1)}async function tde(t,e,r=!1){if(Ko(t.app))return Promise.reject(Al(t));const a=Zo(t),l=Mw(a,e),p=await new Gke(a,l,r).execute();return p&&!r&&(delete p.user._redirectEventId,await a._persistUserIfCurrent(p.user),await a._setRedirectUser(null,e)),p}async function Xke(t){const e=fL(`${t.uid}:::`);return t._redirectEventId=e,await t.auth._setRedirectUser(t),await t.auth._persistUserIfCurrent(t),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jke=10*60*1e3;class Qke{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let r=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(e,a)&&(r=!0,this.sendToConsumer(e,a),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Zke(e)||(this.hasHandledPotentialRedirect=!0,r||(this.queuedRedirectEvent=e,r=!0)),r}sendToConsumer(e,r){var a;if(e.error&&!nde(e)){const l=((a=e.error.code)===null||a===void 0?void 0:a.split("auth/")[1])||"internal-error";r.onError(Il(this.auth,l))}else r.onAuthEvent(e)}isEventForConsumer(e,r){const a=r.eventId===null||!!e.eventId&&e.eventId===r.eventId;return r.filter.includes(e.type)&&a}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Jke&&this.cachedEventUids.clear(),this.cachedEventUids.has(Une(e))}saveEventToCache(e){this.cachedEventUids.add(Une(e)),this.lastProcessedEventTime=Date.now()}}function Une(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function nde({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function Zke(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return nde(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ePe(t,e={}){return bo(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tPe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,nPe=/^https?/;async function rPe(t){if(t.config.emulator)return;const{authorizedDomains:e}=await ePe(t);for(const r of e)try{if(iPe(r))return}catch{}Xd(t,"unauthorized-domain")}function iPe(t){const e=mN(),{protocol:r,hostname:a}=new URL(e);if(t.startsWith("chrome-extension://")){const p=new URL(t);return p.hostname===""&&a===""?r==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):r==="chrome-extension:"&&p.hostname===a}if(!nPe.test(r))return!1;if(tPe.test(t))return a===t;const l=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sPe=new qN(3e4,6e4);function Vne(){const t=eo().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let r=0;r<t.CP.length;r++)t.CP[r]=null}}function aPe(t){return new Promise((e,r)=>{var a,l,u;function p(){Vne(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Vne(),r(Il(t,"network-request-failed"))},timeout:sPe.get()})}if(!((l=(a=eo().gapi)===null||a===void 0?void 0:a.iframes)===null||l===void 0)&&l.Iframe)e(gapi.iframes.getContext());else if(!((u=eo().gapi)===null||u===void 0)&&u.load)p();else{const m=Ile("iframefcb");return eo()[m]=()=>{gapi.load?p():r(Il(t,"network-request-failed"))},nG(`${v1e()}?onload=${m}`).catch(v=>r(v))}}).catch(e=>{throw lD=null,e})}let lD=null;function oPe(t){return lD=lD||aPe(t),lD}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cPe=new qN(5e3,15e3),lPe="__/auth/iframe",dPe="emulator/auth/iframe",uPe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},hPe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function pPe(t){const e=t.config;Xt(e.authDomain,t,"auth-domain-config-required");const r=e.emulator?eG(e,dPe):`https://${t.config.authDomain}/${lPe}`,a={apiKey:e.apiKey,appName:t.name,v:Bv},l=hPe.get(t.config.apiHost);l&&(a.eid=l);const u=t._getFrameworks();return u.length&&(a.fw=u.join(",")),`${r}?${Ow(a).slice(1)}`}async function fPe(t){const e=await oPe(t),r=eo().gapi;return Xt(r,t,"internal-error"),e.open({where:document.body,url:pPe(t),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:uPe,dontclear:!0},a=>new Promise(async(l,u)=>{await a.restyle({setHideOnLeave:!1});const p=Il(t,"network-request-failed"),m=eo().setTimeout(()=>{u(p)},cPe.get());function v(){eo().clearTimeout(m),l(a)}a.ping(v).then(v,()=>{u(p)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mPe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},gPe=500,_Pe=600,yPe="_blank",vPe="http://localhost";class Fne{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function EPe(t,e,r,a=gPe,l=_Pe){const u=Math.max((window.screen.availHeight-l)/2,0).toString(),p=Math.max((window.screen.availWidth-a)/2,0).toString();let m="";const v=Object.assign(Object.assign({},mPe),{width:a.toString(),height:l.toString(),top:u,left:p}),w=vo().toLowerCase();r&&(m=ble(w)?yPe:r),Ele(w)&&(e=e||vPe,v.scrollbars="yes");const R=Object.entries(v).reduce((A,[O,U])=>`${A}${O}=${U},`,"");if(l1e(w)&&m!=="_self")return xPe(e||"",m),new Fne(null);const C=window.open(e||"",m,R);Xt(C,t,"popup-blocked");try{C.focus()}catch{}return new Fne(C)}function xPe(t,e){const r=document.createElement("a");r.href=t,r.target=e;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),r.dispatchEvent(a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bPe="__/auth/handler",wPe="emulator/auth/handler",SPe=encodeURIComponent("fac");async function Bne(t,e,r,a,l,u){Xt(t.config.authDomain,t,"auth-domain-config-required"),Xt(t.config.apiKey,t,"invalid-api-key");const p={apiKey:t.config.apiKey,appName:t.name,authType:r,redirectUrl:a,v:Bv,eventId:l};if(e instanceof Gv){e.setDefaultLanguage(t.languageCode),p.providerId=e.providerId||"",kIe(e.getCustomParameters())||(p.customParameters=JSON.stringify(e.getCustomParameters()));for(const[R,C]of Object.entries({}))p[R]=C}if(e instanceof jw){const R=e.getScopes().filter(C=>C!=="");R.length>0&&(p.scopes=R.join(","))}t.tenantId&&(p.tid=t.tenantId);const m=p;for(const R of Object.keys(m))m[R]===void 0&&delete m[R];const v=await t._getAppCheckToken(),w=v?`#${SPe}=${encodeURIComponent(v)}`:"";return`${TPe(t)}?${Ow(m).slice(1)}${w}`}function TPe({config:t}){return t.emulator?eG(t,wPe):`https://${t.authDomain}/${bPe}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MF="webStorageSupport";class RPe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Wle,this._completeRedirectFn=tde,this._overrideRedirectResult=Hke}async _openPopup(e,r,a,l){var u;Hm((u=this.eventManagers[e._key()])===null||u===void 0?void 0:u.manager,"_initialize() not called before _openPopup()");const p=await Bne(e,r,a,mN(),l);return EPe(e,p,fL())}async _openRedirect(e,r,a,l){await this._originValidation(e);const u=await Bne(e,r,a,mN(),l);return mke(u),new Promise(()=>{})}_initialize(e){const r=e._key();if(this.eventManagers[r]){const{manager:l,promise:u}=this.eventManagers[r];return l?Promise.resolve(l):(Hm(u,"If manager is not set, promise should be"),u)}const a=this.initAndGetManager(e);return this.eventManagers[r]={promise:a},a.catch(()=>{delete this.eventManagers[r]}),a}async initAndGetManager(e){const r=await fPe(e),a=new Qke(e);return r.register("authEvent",l=>(Xt(l==null?void 0:l.authEvent,e,"invalid-auth-event"),{status:a.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:a},this.iframes[e._key()]=r,a}_isIframeWebStorageSupported(e,r){this.iframes[e._key()].send(MF,{type:MF},l=>{var u;const p=(u=l==null?void 0:l[0])===null||u===void 0?void 0:u[MF];p!==void 0&&r(!!p),Xd(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const r=e._key();return this.originValidationPromises[r]||(this.originValidationPromises[r]=rPe(e)),this.originValidationPromises[r]}get _shouldInitProactively(){return Cle()||xle()||tG()}}const CPe=RPe;var zne="@firebase/auth",Gne="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NPe{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const r=this.auth.onIdTokenChanged(a=>{e((a==null?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,r),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const r=this.internalListeners.get(e);r&&(this.internalListeners.delete(e),r(),this.updateProactiveRefresh())}assertAuthConfigured(){Xt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IPe(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function APe(t){Sv(new Q_("auth",(e,{options:r})=>{const a=e.getProvider("app").getImmediate(),l=e.getProvider("heartbeat"),u=e.getProvider("app-check-internal"),{apiKey:p,authDomain:m}=a.options;Xt(p&&!p.includes(":"),"invalid-api-key",{appName:a.name});const v={apiKey:p,authDomain:m,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Nle(t)},w=new m1e(a,l,u,v);return S1e(w,r),w},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,r,a)=>{e.getProvider("auth-internal").initialize()})),Sv(new Q_("auth-internal",e=>{const r=Zo(e.getProvider("auth").getImmediate());return(a=>new NPe(a))(r)},"PRIVATE").setInstantiationMode("EXPLICIT")),Tf(zne,Gne,IPe(t)),Tf(zne,Gne,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kPe=5*60,PPe=rle("authIdTokenMaxAge")||kPe;let Wne=null;const DPe=t=>async e=>{const r=e&&await e.getIdTokenResult(),a=r&&(new Date().getTime()-Date.parse(r.issuedAtTime))/1e3;if(a&&a>PPe)return;const l=r==null?void 0:r.token;Wne!==l&&(Wne=l,await fetch(t,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function OPe(t=$8()){const e=Lw(t,"auth");if(e.isInitialized())return e.getImmediate();const r=w1e(t,{popupRedirectResolver:CPe,persistence:[Ske,hke,Wle]}),a=rle("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const u=new URL(a,location.origin);if(location.origin===u.origin){const p=DPe(u.toString());oke(r,p,()=>p(r.currentUser)),ake(r,m=>p(m))}}const l=ele("auth");return l&&T1e(r,`http://${l}`),r}function LPe(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}g1e({loadJS(t){return new Promise((e,r)=>{const a=document.createElement("script");a.setAttribute("src",t),a.onload=e,a.onerror=l=>{const u=Il("internal-error");u.customData=l,r(u)},a.type="text/javascript",a.charset="UTF-8",LPe().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});APe("Browser");var Hne=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var pv,rde;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(J,Q){function ce(){}ce.prototype=Q.prototype,J.D=Q.prototype,J.prototype=new ce,J.prototype.constructor=J,J.C=function(de,pe,be){for(var ye=Array(arguments.length-2),Ze=2;Ze<arguments.length;Ze++)ye[Ze-2]=arguments[Ze];return Q.prototype[pe].apply(de,ye)}}function r(){this.blockSize=-1}function a(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(a,r),a.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(J,Q,ce){ce||(ce=0);var de=Array(16);if(typeof Q=="string")for(var pe=0;16>pe;++pe)de[pe]=Q.charCodeAt(ce++)|Q.charCodeAt(ce++)<<8|Q.charCodeAt(ce++)<<16|Q.charCodeAt(ce++)<<24;else for(pe=0;16>pe;++pe)de[pe]=Q[ce++]|Q[ce++]<<8|Q[ce++]<<16|Q[ce++]<<24;Q=J.g[0],ce=J.g[1],pe=J.g[2];var be=J.g[3],ye=Q+(be^ce&(pe^be))+de[0]+3614090360&4294967295;Q=ce+(ye<<7&4294967295|ye>>>25),ye=be+(pe^Q&(ce^pe))+de[1]+3905402710&4294967295,be=Q+(ye<<12&4294967295|ye>>>20),ye=pe+(ce^be&(Q^ce))+de[2]+606105819&4294967295,pe=be+(ye<<17&4294967295|ye>>>15),ye=ce+(Q^pe&(be^Q))+de[3]+3250441966&4294967295,ce=pe+(ye<<22&4294967295|ye>>>10),ye=Q+(be^ce&(pe^be))+de[4]+4118548399&4294967295,Q=ce+(ye<<7&4294967295|ye>>>25),ye=be+(pe^Q&(ce^pe))+de[5]+1200080426&4294967295,be=Q+(ye<<12&4294967295|ye>>>20),ye=pe+(ce^be&(Q^ce))+de[6]+2821735955&4294967295,pe=be+(ye<<17&4294967295|ye>>>15),ye=ce+(Q^pe&(be^Q))+de[7]+4249261313&4294967295,ce=pe+(ye<<22&4294967295|ye>>>10),ye=Q+(be^ce&(pe^be))+de[8]+1770035416&4294967295,Q=ce+(ye<<7&4294967295|ye>>>25),ye=be+(pe^Q&(ce^pe))+de[9]+2336552879&4294967295,be=Q+(ye<<12&4294967295|ye>>>20),ye=pe+(ce^be&(Q^ce))+de[10]+4294925233&4294967295,pe=be+(ye<<17&4294967295|ye>>>15),ye=ce+(Q^pe&(be^Q))+de[11]+2304563134&4294967295,ce=pe+(ye<<22&4294967295|ye>>>10),ye=Q+(be^ce&(pe^be))+de[12]+1804603682&4294967295,Q=ce+(ye<<7&4294967295|ye>>>25),ye=be+(pe^Q&(ce^pe))+de[13]+4254626195&4294967295,be=Q+(ye<<12&4294967295|ye>>>20),ye=pe+(ce^be&(Q^ce))+de[14]+2792965006&4294967295,pe=be+(ye<<17&4294967295|ye>>>15),ye=ce+(Q^pe&(be^Q))+de[15]+1236535329&4294967295,ce=pe+(ye<<22&4294967295|ye>>>10),ye=Q+(pe^be&(ce^pe))+de[1]+4129170786&4294967295,Q=ce+(ye<<5&4294967295|ye>>>27),ye=be+(ce^pe&(Q^ce))+de[6]+3225465664&4294967295,be=Q+(ye<<9&4294967295|ye>>>23),ye=pe+(Q^ce&(be^Q))+de[11]+643717713&4294967295,pe=be+(ye<<14&4294967295|ye>>>18),ye=ce+(be^Q&(pe^be))+de[0]+3921069994&4294967295,ce=pe+(ye<<20&4294967295|ye>>>12),ye=Q+(pe^be&(ce^pe))+de[5]+3593408605&4294967295,Q=ce+(ye<<5&4294967295|ye>>>27),ye=be+(ce^pe&(Q^ce))+de[10]+38016083&4294967295,be=Q+(ye<<9&4294967295|ye>>>23),ye=pe+(Q^ce&(be^Q))+de[15]+3634488961&4294967295,pe=be+(ye<<14&4294967295|ye>>>18),ye=ce+(be^Q&(pe^be))+de[4]+3889429448&4294967295,ce=pe+(ye<<20&4294967295|ye>>>12),ye=Q+(pe^be&(ce^pe))+de[9]+568446438&4294967295,Q=ce+(ye<<5&4294967295|ye>>>27),ye=be+(ce^pe&(Q^ce))+de[14]+3275163606&4294967295,be=Q+(ye<<9&4294967295|ye>>>23),ye=pe+(Q^ce&(be^Q))+de[3]+4107603335&4294967295,pe=be+(ye<<14&4294967295|ye>>>18),ye=ce+(be^Q&(pe^be))+de[8]+1163531501&4294967295,ce=pe+(ye<<20&4294967295|ye>>>12),ye=Q+(pe^be&(ce^pe))+de[13]+2850285829&4294967295,Q=ce+(ye<<5&4294967295|ye>>>27),ye=be+(ce^pe&(Q^ce))+de[2]+4243563512&4294967295,be=Q+(ye<<9&4294967295|ye>>>23),ye=pe+(Q^ce&(be^Q))+de[7]+1735328473&4294967295,pe=be+(ye<<14&4294967295|ye>>>18),ye=ce+(be^Q&(pe^be))+de[12]+2368359562&4294967295,ce=pe+(ye<<20&4294967295|ye>>>12),ye=Q+(ce^pe^be)+de[5]+4294588738&4294967295,Q=ce+(ye<<4&4294967295|ye>>>28),ye=be+(Q^ce^pe)+de[8]+2272392833&4294967295,be=Q+(ye<<11&4294967295|ye>>>21),ye=pe+(be^Q^ce)+de[11]+1839030562&4294967295,pe=be+(ye<<16&4294967295|ye>>>16),ye=ce+(pe^be^Q)+de[14]+4259657740&4294967295,ce=pe+(ye<<23&4294967295|ye>>>9),ye=Q+(ce^pe^be)+de[1]+2763975236&4294967295,Q=ce+(ye<<4&4294967295|ye>>>28),ye=be+(Q^ce^pe)+de[4]+1272893353&4294967295,be=Q+(ye<<11&4294967295|ye>>>21),ye=pe+(be^Q^ce)+de[7]+4139469664&4294967295,pe=be+(ye<<16&4294967295|ye>>>16),ye=ce+(pe^be^Q)+de[10]+3200236656&4294967295,ce=pe+(ye<<23&4294967295|ye>>>9),ye=Q+(ce^pe^be)+de[13]+681279174&4294967295,Q=ce+(ye<<4&4294967295|ye>>>28),ye=be+(Q^ce^pe)+de[0]+3936430074&4294967295,be=Q+(ye<<11&4294967295|ye>>>21),ye=pe+(be^Q^ce)+de[3]+3572445317&4294967295,pe=be+(ye<<16&4294967295|ye>>>16),ye=ce+(pe^be^Q)+de[6]+76029189&4294967295,ce=pe+(ye<<23&4294967295|ye>>>9),ye=Q+(ce^pe^be)+de[9]+3654602809&4294967295,Q=ce+(ye<<4&4294967295|ye>>>28),ye=be+(Q^ce^pe)+de[12]+3873151461&4294967295,be=Q+(ye<<11&4294967295|ye>>>21),ye=pe+(be^Q^ce)+de[15]+530742520&4294967295,pe=be+(ye<<16&4294967295|ye>>>16),ye=ce+(pe^be^Q)+de[2]+3299628645&4294967295,ce=pe+(ye<<23&4294967295|ye>>>9),ye=Q+(pe^(ce|~be))+de[0]+4096336452&4294967295,Q=ce+(ye<<6&4294967295|ye>>>26),ye=be+(ce^(Q|~pe))+de[7]+1126891415&4294967295,be=Q+(ye<<10&4294967295|ye>>>22),ye=pe+(Q^(be|~ce))+de[14]+2878612391&4294967295,pe=be+(ye<<15&4294967295|ye>>>17),ye=ce+(be^(pe|~Q))+de[5]+4237533241&4294967295,ce=pe+(ye<<21&4294967295|ye>>>11),ye=Q+(pe^(ce|~be))+de[12]+1700485571&4294967295,Q=ce+(ye<<6&4294967295|ye>>>26),ye=be+(ce^(Q|~pe))+de[3]+2399980690&4294967295,be=Q+(ye<<10&4294967295|ye>>>22),ye=pe+(Q^(be|~ce))+de[10]+4293915773&4294967295,pe=be+(ye<<15&4294967295|ye>>>17),ye=ce+(be^(pe|~Q))+de[1]+2240044497&4294967295,ce=pe+(ye<<21&4294967295|ye>>>11),ye=Q+(pe^(ce|~be))+de[8]+1873313359&4294967295,Q=ce+(ye<<6&4294967295|ye>>>26),ye=be+(ce^(Q|~pe))+de[15]+4264355552&4294967295,be=Q+(ye<<10&4294967295|ye>>>22),ye=pe+(Q^(be|~ce))+de[6]+2734768916&4294967295,pe=be+(ye<<15&4294967295|ye>>>17),ye=ce+(be^(pe|~Q))+de[13]+1309151649&4294967295,ce=pe+(ye<<21&4294967295|ye>>>11),ye=Q+(pe^(ce|~be))+de[4]+4149444226&4294967295,Q=ce+(ye<<6&4294967295|ye>>>26),ye=be+(ce^(Q|~pe))+de[11]+3174756917&4294967295,be=Q+(ye<<10&4294967295|ye>>>22),ye=pe+(Q^(be|~ce))+de[2]+718787259&4294967295,pe=be+(ye<<15&4294967295|ye>>>17),ye=ce+(be^(pe|~Q))+de[9]+3951481745&4294967295,J.g[0]=J.g[0]+Q&4294967295,J.g[1]=J.g[1]+(pe+(ye<<21&4294967295|ye>>>11))&4294967295,J.g[2]=J.g[2]+pe&4294967295,J.g[3]=J.g[3]+be&4294967295}a.prototype.u=function(J,Q){Q===void 0&&(Q=J.length);for(var ce=Q-this.blockSize,de=this.B,pe=this.h,be=0;be<Q;){if(pe==0)for(;be<=ce;)l(this,J,be),be+=this.blockSize;if(typeof J=="string"){for(;be<Q;)if(de[pe++]=J.charCodeAt(be++),pe==this.blockSize){l(this,de),pe=0;break}}else for(;be<Q;)if(de[pe++]=J[be++],pe==this.blockSize){l(this,de),pe=0;break}}this.h=pe,this.o+=Q},a.prototype.v=function(){var J=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);J[0]=128;for(var Q=1;Q<J.length-8;++Q)J[Q]=0;var ce=8*this.o;for(Q=J.length-8;Q<J.length;++Q)J[Q]=ce&255,ce/=256;for(this.u(J),J=Array(16),Q=ce=0;4>Q;++Q)for(var de=0;32>de;de+=8)J[ce++]=this.g[Q]>>>de&255;return J};function u(J,Q){var ce=m;return Object.prototype.hasOwnProperty.call(ce,J)?ce[J]:ce[J]=Q(J)}function p(J,Q){this.h=Q;for(var ce=[],de=!0,pe=J.length-1;0<=pe;pe--){var be=J[pe]|0;de&&be==Q||(ce[pe]=be,de=!1)}this.g=ce}var m={};function v(J){return-128<=J&&128>J?u(J,function(Q){return new p([Q|0],0>Q?-1:0)}):new p([J|0],0>J?-1:0)}function w(J){if(isNaN(J)||!isFinite(J))return C;if(0>J)return q(w(-J));for(var Q=[],ce=1,de=0;J>=ce;de++)Q[de]=J/ce|0,ce*=4294967296;return new p(Q,0)}function R(J,Q){if(J.length==0)throw Error("number format error: empty string");if(Q=Q||10,2>Q||36<Q)throw Error("radix out of range: "+Q);if(J.charAt(0)=="-")return q(R(J.substring(1),Q));if(0<=J.indexOf("-"))throw Error('number format error: interior "-" character');for(var ce=w(Math.pow(Q,8)),de=C,pe=0;pe<J.length;pe+=8){var be=Math.min(8,J.length-pe),ye=parseInt(J.substring(pe,pe+be),Q);8>be?(be=w(Math.pow(Q,be)),de=de.j(be).add(w(ye))):(de=de.j(ce),de=de.add(w(ye)))}return de}var C=v(0),A=v(1),O=v(16777216);t=p.prototype,t.m=function(){if(F(this))return-q(this).m();for(var J=0,Q=1,ce=0;ce<this.g.length;ce++){var de=this.i(ce);J+=(0<=de?de:4294967296+de)*Q,Q*=4294967296}return J},t.toString=function(J){if(J=J||10,2>J||36<J)throw Error("radix out of range: "+J);if(U(this))return"0";if(F(this))return"-"+q(this).toString(J);for(var Q=w(Math.pow(J,6)),ce=this,de="";;){var pe=ne(ce,Q).g;ce=W(ce,pe.j(Q));var be=((0<ce.g.length?ce.g[0]:ce.h)>>>0).toString(J);if(ce=pe,U(ce))return be+de;for(;6>be.length;)be="0"+be;de=be+de}},t.i=function(J){return 0>J?0:J<this.g.length?this.g[J]:this.h};function U(J){if(J.h!=0)return!1;for(var Q=0;Q<J.g.length;Q++)if(J.g[Q]!=0)return!1;return!0}function F(J){return J.h==-1}t.l=function(J){return J=W(this,J),F(J)?-1:U(J)?0:1};function q(J){for(var Q=J.g.length,ce=[],de=0;de<Q;de++)ce[de]=~J.g[de];return new p(ce,~J.h).add(A)}t.abs=function(){return F(this)?q(this):this},t.add=function(J){for(var Q=Math.max(this.g.length,J.g.length),ce=[],de=0,pe=0;pe<=Q;pe++){var be=de+(this.i(pe)&65535)+(J.i(pe)&65535),ye=(be>>>16)+(this.i(pe)>>>16)+(J.i(pe)>>>16);de=ye>>>16,be&=65535,ye&=65535,ce[pe]=ye<<16|be}return new p(ce,ce[ce.length-1]&-2147483648?-1:0)};function W(J,Q){return J.add(q(Q))}t.j=function(J){if(U(this)||U(J))return C;if(F(this))return F(J)?q(this).j(q(J)):q(q(this).j(J));if(F(J))return q(this.j(q(J)));if(0>this.l(O)&&0>J.l(O))return w(this.m()*J.m());for(var Q=this.g.length+J.g.length,ce=[],de=0;de<2*Q;de++)ce[de]=0;for(de=0;de<this.g.length;de++)for(var pe=0;pe<J.g.length;pe++){var be=this.i(de)>>>16,ye=this.i(de)&65535,Ze=J.i(pe)>>>16,It=J.i(pe)&65535;ce[2*de+2*pe]+=ye*It,H(ce,2*de+2*pe),ce[2*de+2*pe+1]+=be*It,H(ce,2*de+2*pe+1),ce[2*de+2*pe+1]+=ye*Ze,H(ce,2*de+2*pe+1),ce[2*de+2*pe+2]+=be*Ze,H(ce,2*de+2*pe+2)}for(de=0;de<Q;de++)ce[de]=ce[2*de+1]<<16|ce[2*de];for(de=Q;de<2*Q;de++)ce[de]=0;return new p(ce,0)};function H(J,Q){for(;(J[Q]&65535)!=J[Q];)J[Q+1]+=J[Q]>>>16,J[Q]&=65535,Q++}function X(J,Q){this.g=J,this.h=Q}function ne(J,Q){if(U(Q))throw Error("division by zero");if(U(J))return new X(C,C);if(F(J))return Q=ne(q(J),Q),new X(q(Q.g),q(Q.h));if(F(Q))return Q=ne(J,q(Q)),new X(q(Q.g),Q.h);if(30<J.g.length){if(F(J)||F(Q))throw Error("slowDivide_ only works with positive integers.");for(var ce=A,de=Q;0>=de.l(J);)ce=te(ce),de=te(de);var pe=he(ce,1),be=he(de,1);for(de=he(de,2),ce=he(ce,2);!U(de);){var ye=be.add(de);0>=ye.l(J)&&(pe=pe.add(ce),be=ye),de=he(de,1),ce=he(ce,1)}return Q=W(J,pe.j(Q)),new X(pe,Q)}for(pe=C;0<=J.l(Q);){for(ce=Math.max(1,Math.floor(J.m()/Q.m())),de=Math.ceil(Math.log(ce)/Math.LN2),de=48>=de?1:Math.pow(2,de-48),be=w(ce),ye=be.j(Q);F(ye)||0<ye.l(J);)ce-=de,be=w(ce),ye=be.j(Q);U(be)&&(be=A),pe=pe.add(be),J=W(J,ye)}return new X(pe,J)}t.A=function(J){return ne(this,J).h},t.and=function(J){for(var Q=Math.max(this.g.length,J.g.length),ce=[],de=0;de<Q;de++)ce[de]=this.i(de)&J.i(de);return new p(ce,this.h&J.h)},t.or=function(J){for(var Q=Math.max(this.g.length,J.g.length),ce=[],de=0;de<Q;de++)ce[de]=this.i(de)|J.i(de);return new p(ce,this.h|J.h)},t.xor=function(J){for(var Q=Math.max(this.g.length,J.g.length),ce=[],de=0;de<Q;de++)ce[de]=this.i(de)^J.i(de);return new p(ce,this.h^J.h)};function te(J){for(var Q=J.g.length+1,ce=[],de=0;de<Q;de++)ce[de]=J.i(de)<<1|J.i(de-1)>>>31;return new p(ce,J.h)}function he(J,Q){var ce=Q>>5;Q%=32;for(var de=J.g.length-ce,pe=[],be=0;be<de;be++)pe[be]=0<Q?J.i(be+ce)>>>Q|J.i(be+ce+1)<<32-Q:J.i(be+ce);return new p(pe,J.h)}a.prototype.digest=a.prototype.v,a.prototype.reset=a.prototype.s,a.prototype.update=a.prototype.u,rde=a,p.prototype.add=p.prototype.add,p.prototype.multiply=p.prototype.j,p.prototype.modulo=p.prototype.A,p.prototype.compare=p.prototype.l,p.prototype.toNumber=p.prototype.m,p.prototype.toString=p.prototype.toString,p.prototype.getBits=p.prototype.i,p.fromNumber=w,p.fromString=R,pv=p}).apply(typeof Hne<"u"?Hne:typeof self<"u"?self:typeof window<"u"?window:{});var C2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ide,pC,sde,dD,B6,ade,ode,cde;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(k,ee,le){return k==Array.prototype||k==Object.prototype||(k[ee]=le.value),k};function r(k){k=[typeof globalThis=="object"&&globalThis,k,typeof window=="object"&&window,typeof self=="object"&&self,typeof C2=="object"&&C2];for(var ee=0;ee<k.length;++ee){var le=k[ee];if(le&&le.Math==Math)return le}throw Error("Cannot find global object")}var a=r(this);function l(k,ee){if(ee)e:{var le=a;k=k.split(".");for(var Se=0;Se<k.length-1;Se++){var He=k[Se];if(!(He in le))break e;le=le[He]}k=k[k.length-1],Se=le[k],ee=ee(Se),ee!=Se&&ee!=null&&e(le,k,{configurable:!0,writable:!0,value:ee})}}function u(k,ee){k instanceof String&&(k+="");var le=0,Se=!1,He={next:function(){if(!Se&&le<k.length){var ct=le++;return{value:ee(ct,k[ct]),done:!1}}return Se=!0,{done:!0,value:void 0}}};return He[Symbol.iterator]=function(){return He},He}l("Array.prototype.values",function(k){return k||function(){return u(this,function(ee,le){return le})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var p=p||{},m=this||self;function v(k){var ee=typeof k;return ee=ee!="object"?ee:k?Array.isArray(k)?"array":ee:"null",ee=="array"||ee=="object"&&typeof k.length=="number"}function w(k){var ee=typeof k;return ee=="object"&&k!=null||ee=="function"}function R(k,ee,le){return k.call.apply(k.bind,arguments)}function C(k,ee,le){if(!k)throw Error();if(2<arguments.length){var Se=Array.prototype.slice.call(arguments,2);return function(){var He=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(He,Se),k.apply(ee,He)}}return function(){return k.apply(ee,arguments)}}function A(k,ee,le){return A=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?R:C,A.apply(null,arguments)}function O(k,ee){var le=Array.prototype.slice.call(arguments,1);return function(){var Se=le.slice();return Se.push.apply(Se,arguments),k.apply(this,Se)}}function U(k,ee){function le(){}le.prototype=ee.prototype,k.aa=ee.prototype,k.prototype=new le,k.prototype.constructor=k,k.Qb=function(Se,He,ct){for(var Ut=Array(arguments.length-2),ii=2;ii<arguments.length;ii++)Ut[ii-2]=arguments[ii];return ee.prototype[He].apply(Se,Ut)}}function F(k){const ee=k.length;if(0<ee){const le=Array(ee);for(let Se=0;Se<ee;Se++)le[Se]=k[Se];return le}return[]}function q(k,ee){for(let le=1;le<arguments.length;le++){const Se=arguments[le];if(v(Se)){const He=k.length||0,ct=Se.length||0;k.length=He+ct;for(let Ut=0;Ut<ct;Ut++)k[He+Ut]=Se[Ut]}else k.push(Se)}}class W{constructor(ee,le){this.i=ee,this.j=le,this.h=0,this.g=null}get(){let ee;return 0<this.h?(this.h--,ee=this.g,this.g=ee.next,ee.next=null):ee=this.i(),ee}}function H(k){return/^[\s\xa0]*$/.test(k)}function X(){var k=m.navigator;return k&&(k=k.userAgent)?k:""}function ne(k){return ne[" "](k),k}ne[" "]=function(){};var te=X().indexOf("Gecko")!=-1&&!(X().toLowerCase().indexOf("webkit")!=-1&&X().indexOf("Edge")==-1)&&!(X().indexOf("Trident")!=-1||X().indexOf("MSIE")!=-1)&&X().indexOf("Edge")==-1;function he(k,ee,le){for(const Se in k)ee.call(le,k[Se],Se,k)}function J(k,ee){for(const le in k)ee.call(void 0,k[le],le,k)}function Q(k){const ee={};for(const le in k)ee[le]=k[le];return ee}const ce="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function de(k,ee){let le,Se;for(let He=1;He<arguments.length;He++){Se=arguments[He];for(le in Se)k[le]=Se[le];for(let ct=0;ct<ce.length;ct++)le=ce[ct],Object.prototype.hasOwnProperty.call(Se,le)&&(k[le]=Se[le])}}function pe(k){var ee=1;k=k.split(":");const le=[];for(;0<ee&&k.length;)le.push(k.shift()),ee--;return k.length&&le.push(k.join(":")),le}function be(k){m.setTimeout(()=>{throw k},0)}function ye(){var k=Me;let ee=null;return k.g&&(ee=k.g,k.g=k.g.next,k.g||(k.h=null),ee.next=null),ee}class Ze{constructor(){this.h=this.g=null}add(ee,le){const Se=It.get();Se.set(ee,le),this.h?this.h.next=Se:this.g=Se,this.h=Se}}var It=new W(()=>new St,k=>k.reset());class St{constructor(){this.next=this.g=this.h=null}set(ee,le){this.h=ee,this.g=le,this.next=null}reset(){this.next=this.g=this.h=null}}let lt,Le=!1,Me=new Ze,Ke=()=>{const k=m.Promise.resolve(void 0);lt=()=>{k.then(Rt)}};var Rt=()=>{for(var k;k=ye();){try{k.h.call(k.g)}catch(le){be(le)}var ee=It;ee.j(k),100>ee.h&&(ee.h++,k.next=ee.g,ee.g=k)}Le=!1};function rt(){this.s=this.s,this.C=this.C}rt.prototype.s=!1,rt.prototype.ma=function(){this.s||(this.s=!0,this.N())},rt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function mt(k,ee){this.type=k,this.g=this.target=ee,this.defaultPrevented=!1}mt.prototype.h=function(){this.defaultPrevented=!0};var yt=function(){if(!m.addEventListener||!Object.defineProperty)return!1;var k=!1,ee=Object.defineProperty({},"passive",{get:function(){k=!0}});try{const le=()=>{};m.addEventListener("test",le,ee),m.removeEventListener("test",le,ee)}catch{}return k}();function Ct(k,ee){if(mt.call(this,k?k.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,k){var le=this.type=k.type,Se=k.changedTouches&&k.changedTouches.length?k.changedTouches[0]:null;if(this.target=k.target||k.srcElement,this.g=ee,ee=k.relatedTarget){if(te){e:{try{ne(ee.nodeName);var He=!0;break e}catch{}He=!1}He||(ee=null)}}else le=="mouseover"?ee=k.fromElement:le=="mouseout"&&(ee=k.toElement);this.relatedTarget=ee,Se?(this.clientX=Se.clientX!==void 0?Se.clientX:Se.pageX,this.clientY=Se.clientY!==void 0?Se.clientY:Se.pageY,this.screenX=Se.screenX||0,this.screenY=Se.screenY||0):(this.clientX=k.clientX!==void 0?k.clientX:k.pageX,this.clientY=k.clientY!==void 0?k.clientY:k.pageY,this.screenX=k.screenX||0,this.screenY=k.screenY||0),this.button=k.button,this.key=k.key||"",this.ctrlKey=k.ctrlKey,this.altKey=k.altKey,this.shiftKey=k.shiftKey,this.metaKey=k.metaKey,this.pointerId=k.pointerId||0,this.pointerType=typeof k.pointerType=="string"?k.pointerType:Ot[k.pointerType]||"",this.state=k.state,this.i=k,k.defaultPrevented&&Ct.aa.h.call(this)}}U(Ct,mt);var Ot={2:"touch",3:"pen",4:"mouse"};Ct.prototype.h=function(){Ct.aa.h.call(this);var k=this.i;k.preventDefault?k.preventDefault():k.returnValue=!1};var vt="closure_listenable_"+(1e6*Math.random()|0),zt=0;function ln(k,ee,le,Se,He){this.listener=k,this.proxy=null,this.src=ee,this.type=le,this.capture=!!Se,this.ha=He,this.key=++zt,this.da=this.fa=!1}function Pn(k){k.da=!0,k.listener=null,k.proxy=null,k.src=null,k.ha=null}function ni(k){this.src=k,this.g={},this.h=0}ni.prototype.add=function(k,ee,le,Se,He){var ct=k.toString();k=this.g[ct],k||(k=this.g[ct]=[],this.h++);var Ut=nn(k,ee,Se,He);return-1<Ut?(ee=k[Ut],le||(ee.fa=!1)):(ee=new ln(ee,this.src,ct,!!Se,He),ee.fa=le,k.push(ee)),ee};function pr(k,ee){var le=ee.type;if(le in k.g){var Se=k.g[le],He=Array.prototype.indexOf.call(Se,ee,void 0),ct;(ct=0<=He)&&Array.prototype.splice.call(Se,He,1),ct&&(Pn(ee),k.g[le].length==0&&(delete k.g[le],k.h--))}}function nn(k,ee,le,Se){for(var He=0;He<k.length;++He){var ct=k[He];if(!ct.da&&ct.listener==ee&&ct.capture==!!le&&ct.ha==Se)return He}return-1}var ri="closure_lm_"+(1e6*Math.random()|0),un={};function ui(k,ee,le,Se,He){if(Array.isArray(ee)){for(var ct=0;ct<ee.length;ct++)ui(k,ee[ct],le,Se,He);return null}return le=So(le),k&&k[vt]?k.K(ee,le,w(Se)?!!Se.capture:!1,He):Cs(k,ee,le,!1,Se,He)}function Cs(k,ee,le,Se,He,ct){if(!ee)throw Error("Invalid event type");var Ut=w(He)?!!He.capture:!!He,ii=Fa(k);if(ii||(k[ri]=ii=new ni(k)),le=ii.add(ee,le,Se,Ut,ct),le.proxy)return le;if(Se=Jn(),le.proxy=Se,Se.src=k,Se.listener=le,k.addEventListener)yt||(He=Ut),He===void 0&&(He=!1),k.addEventListener(ee.toString(),Se,He);else if(k.attachEvent)k.attachEvent(us(ee.toString()),Se);else if(k.addListener&&k.removeListener)k.addListener(Se);else throw Error("addEventListener and attachEvent are unavailable.");return le}function Jn(){function k(le){return ee.call(k.src,k.listener,le)}const ee=ro;return k}function ds(k,ee,le,Se,He){if(Array.isArray(ee))for(var ct=0;ct<ee.length;ct++)ds(k,ee[ct],le,Se,He);else Se=w(Se)?!!Se.capture:!!Se,le=So(le),k&&k[vt]?(k=k.i,ee=String(ee).toString(),ee in k.g&&(ct=k.g[ee],le=nn(ct,le,Se,He),-1<le&&(Pn(ct[le]),Array.prototype.splice.call(ct,le,1),ct.length==0&&(delete k.g[ee],k.h--)))):k&&(k=Fa(k))&&(ee=k.g[ee.toString()],k=-1,ee&&(k=nn(ee,le,Se,He)),(le=-1<k?ee[k]:null)&&Ra(le))}function Ra(k){if(typeof k!="number"&&k&&!k.da){var ee=k.src;if(ee&&ee[vt])pr(ee.i,k);else{var le=k.type,Se=k.proxy;ee.removeEventListener?ee.removeEventListener(le,Se,k.capture):ee.detachEvent?ee.detachEvent(us(le),Se):ee.addListener&&ee.removeListener&&ee.removeListener(Se),(le=Fa(ee))?(pr(le,k),le.h==0&&(le.src=null,ee[ri]=null)):Pn(k)}}}function us(k){return k in un?un[k]:un[k]="on"+k}function ro(k,ee){if(k.da)k=!0;else{ee=new Ct(ee,this);var le=k.listener,Se=k.ha||k.src;k.fa&&Ra(k),k=le.call(Se,ee)}return k}function Fa(k){return k=k[ri],k instanceof ni?k:null}var hi="__closure_events_fn_"+(1e9*Math.random()>>>0);function So(k){return typeof k=="function"?k:(k[hi]||(k[hi]=function(ee){return k.handleEvent(ee)}),k[hi])}function Ri(){rt.call(this),this.i=new ni(this),this.M=this,this.F=null}U(Ri,rt),Ri.prototype[vt]=!0,Ri.prototype.removeEventListener=function(k,ee,le,Se){ds(this,k,ee,le,Se)};function Gr(k,ee){var le,Se=k.F;if(Se)for(le=[];Se;Se=Se.F)le.push(Se);if(k=k.M,Se=ee.type||ee,typeof ee=="string")ee=new mt(ee,k);else if(ee instanceof mt)ee.target=ee.target||k;else{var He=ee;ee=new mt(Se,k),de(ee,He)}if(He=!0,le)for(var ct=le.length-1;0<=ct;ct--){var Ut=ee.g=le[ct];He=Ca(Ut,Se,!0,ee)&&He}if(Ut=ee.g=k,He=Ca(Ut,Se,!0,ee)&&He,He=Ca(Ut,Se,!1,ee)&&He,le)for(ct=0;ct<le.length;ct++)Ut=ee.g=le[ct],He=Ca(Ut,Se,!1,ee)&&He}Ri.prototype.N=function(){if(Ri.aa.N.call(this),this.i){var k=this.i,ee;for(ee in k.g){for(var le=k.g[ee],Se=0;Se<le.length;Se++)Pn(le[Se]);delete k.g[ee],k.h--}}this.F=null},Ri.prototype.K=function(k,ee,le,Se){return this.i.add(String(k),ee,!1,le,Se)},Ri.prototype.L=function(k,ee,le,Se){return this.i.add(String(k),ee,!0,le,Se)};function Ca(k,ee,le,Se){if(ee=k.i.g[String(ee)],!ee)return!0;ee=ee.concat();for(var He=!0,ct=0;ct<ee.length;++ct){var Ut=ee[ct];if(Ut&&!Ut.da&&Ut.capture==le){var ii=Ut.listener,Bs=Ut.ha||Ut.src;Ut.fa&&pr(k.i,Ut),He=ii.call(Bs,Se)!==!1&&He}}return He&&!Se.defaultPrevented}function Ac(k,ee,le){if(typeof k=="function")le&&(k=A(k,le));else if(k&&typeof k.handleEvent=="function")k=A(k.handleEvent,k);else throw Error("Invalid listener argument");return 2147483647<Number(ee)?-1:m.setTimeout(k,ee||0)}function kc(k){k.g=Ac(()=>{k.g=null,k.i&&(k.i=!1,kc(k))},k.l);const ee=k.h;k.h=null,k.m.apply(null,ee)}class Pc extends rt{constructor(ee,le){super(),this.m=ee,this.l=le,this.h=null,this.i=!1,this.g=null}j(ee){this.h=arguments,this.g?this.i=!0:kc(this)}N(){super.N(),this.g&&(m.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ba(k){rt.call(this),this.h=k,this.g={}}U(Ba,rt);var Dc=[];function ia(k){he(k.g,function(ee,le){this.g.hasOwnProperty(le)&&Ra(ee)},k),k.g={}}Ba.prototype.N=function(){Ba.aa.N.call(this),ia(this)},Ba.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Lt=m.JSON.stringify,Ir=m.JSON.parse,We=class{stringify(k){return m.JSON.stringify(k,void 0)}parse(k){return m.JSON.parse(k,void 0)}};function $t(){}$t.prototype.h=null;function tr(k){return k.h||(k.h=k.i())}function mi(){}var Wr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Nn(){mt.call(this,"d")}U(Nn,mt);function Ci(){mt.call(this,"c")}U(Ci,mt);var Ar={},lr=null;function Qi(){return lr=lr||new Ri}Ar.La="serverreachability";function sh(k){mt.call(this,Ar.La,k)}U(sh,mt);function ol(k){const ee=Qi();Gr(ee,new sh(ee))}Ar.STAT_EVENT="statevent";function pp(k,ee){mt.call(this,Ar.STAT_EVENT,k),this.stat=ee}U(pp,mt);function gi(k){const ee=Qi();Gr(ee,new pp(ee,k))}Ar.Ma="timingevent";function fp(k,ee){mt.call(this,Ar.Ma,k),this.size=ee}U(fp,mt);function ah(k,ee){if(typeof k!="function")throw Error("Fn must not be null and must be a function");return m.setTimeout(function(){k()},ee)}function ec(){this.g=!0}ec.prototype.xa=function(){this.g=!1};function tc(k,ee,le,Se,He,ct){k.info(function(){if(k.g)if(ct)for(var Ut="",ii=ct.split("&"),Bs=0;Bs<ii.length;Bs++){var sr=ii[Bs].split("=");if(1<sr.length){var fr=sr[0];sr=sr[1];var Bi=fr.split("_");Ut=2<=Bi.length&&Bi[1]=="type"?Ut+(fr+"="+sr+"&"):Ut+(fr+"=redacted&")}}else Ut=null;else Ut=ct;return"XMLHTTP REQ ("+Se+") [attempt "+He+"]: "+ee+`
`+le+`
`+Ut})}function vn(k,ee,le,Se,He,ct,Ut){k.info(function(){return"XMLHTTP RESP ("+Se+") [ attempt "+He+"]: "+ee+`
`+le+`
`+ct+" "+Ut})}function Ll(k,ee,le,Se){k.info(function(){return"XMLHTTP TEXT ("+ee+"): "+Of(k,le)+(Se?" "+Se:"")})}function og(k,ee){k.info(function(){return"TIMEOUT: "+ee})}ec.prototype.info=function(){};function Of(k,ee){if(!k.g)return ee;if(!ee)return null;try{var le=JSON.parse(ee);if(le){for(k=0;k<le.length;k++)if(Array.isArray(le[k])){var Se=le[k];if(!(2>Se.length)){var He=Se[1];if(Array.isArray(He)&&!(1>He.length)){var ct=He[0];if(ct!="noop"&&ct!="stop"&&ct!="close")for(var Ut=1;Ut<He.length;Ut++)He[Ut]=""}}}}return Lt(le)}catch{return ee}}var nu={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},mp={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},gp;function Oc(){}U(Oc,$t),Oc.prototype.g=function(){return new XMLHttpRequest},Oc.prototype.i=function(){return{}},gp=new Oc;function Lc(k,ee,le,Se){this.j=k,this.i=ee,this.l=le,this.R=Se||1,this.U=new Ba(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Lf}function Lf(){this.i=null,this.g="",this.h=!1}var _p={},yp={};function jl(k,ee,le){k.L=1,k.v=To(hs(ee)),k.m=le,k.P=!0,jf(k,null)}function jf(k,ee){k.F=Date.now(),gd(k),k.A=hs(k.v);var le=k.A,Se=k.R;Array.isArray(Se)||(Se=[String(Se)]),Ff(le.i,"t",Se),k.C=0,le=k.j.J,k.h=new Lf,k.g=Kf(k.j,le?ee:null,!k.m),0<k.O&&(k.M=new Pc(A(k.Y,k,k.g),k.O)),ee=k.U,le=k.g,Se=k.ca;var He="readystatechange";Array.isArray(He)||(He&&(Dc[0]=He.toString()),He=Dc);for(var ct=0;ct<He.length;ct++){var Ut=ui(le,He[ct],Se||ee.handleEvent,!1,ee.h||ee);if(!Ut)break;ee.g[Ut.key]=Ut}ee=k.H?Q(k.H):{},k.m?(k.u||(k.u="POST"),ee["Content-Type"]="application/x-www-form-urlencoded",k.g.ea(k.A,k.u,k.m,ee)):(k.u="GET",k.g.ea(k.A,k.u,null,ee)),ol(),tc(k.i,k.u,k.A,k.l,k.R,k.m)}Lc.prototype.ca=function(k){k=k.target;const ee=this.M;ee&&Ns(k)==3?ee.j():this.Y(k)},Lc.prototype.Y=function(k){try{if(k==this.g)e:{const Bi=Ns(this.g);var ee=this.g.Ba();const Bc=this.g.Z();if(!(3>Bi)&&(Bi!=3||this.g&&(this.h.h||this.g.oa()||Sp(this.g)))){this.J||Bi!=4||ee==7||(ee==8||0>=Bc?ol(3):ol(2)),Zi(this);var le=this.g.Z();this.X=le;t:if(oh(this)){var Se=Sp(this.g);k="";var He=Se.length,ct=Ns(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ml(this),ch(this);var Ut="";break t}this.h.i=new m.TextDecoder}for(ee=0;ee<He;ee++)this.h.h=!0,k+=this.h.i.decode(Se[ee],{stream:!(ct&&ee==He-1)});Se.length=0,this.h.g+=k,this.C=0,Ut=this.h.g}else Ut=this.g.oa();if(this.o=le==200,vn(this.i,this.u,this.A,this.l,this.R,Bi,le),this.o){if(this.T&&!this.K){t:{if(this.g){var ii,Bs=this.g;if((ii=Bs.g?Bs.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!H(ii)){var sr=ii;break t}}sr=null}if(le=sr)Ll(this.i,this.l,le,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ru(this,le);else{this.o=!1,this.s=3,gi(12),Ml(this),ch(this);break e}}if(this.P){le=!0;let fs;for(;!this.J&&this.C<Ut.length;)if(fs=io(this,Ut),fs==yp){Bi==4&&(this.s=4,gi(14),le=!1),Ll(this.i,this.l,null,"[Incomplete Response]");break}else if(fs==_p){this.s=4,gi(15),Ll(this.i,this.l,Ut,"[Invalid Chunk]"),le=!1;break}else Ll(this.i,this.l,fs,null),ru(this,fs);if(oh(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Bi!=4||Ut.length!=0||this.h.h||(this.s=1,gi(16),le=!1),this.o=this.o&&le,!le)Ll(this.i,this.l,Ut,"[Invalid Chunked Response]"),Ml(this),ch(this);else if(0<Ut.length&&!this.W){this.W=!0;var fr=this.j;fr.g==this&&fr.ba&&!fr.M&&(fr.j.info("Great, no buffering proxy detected. Bytes received: "+Ut.length),ic(fr),fr.M=!0,gi(11))}}else Ll(this.i,this.l,Ut,null),ru(this,Ut);Bi==4&&Ml(this),this.o&&!this.J&&(Bi==4?Ii(this.j,this):(this.o=!1,gd(this)))}else Wf(this.g),le==400&&0<Ut.indexOf("Unknown SID")?(this.s=3,gi(12)):(this.s=0,gi(13)),Ml(this),ch(this)}}}catch{}finally{}};function oh(k){return k.g?k.u=="GET"&&k.L!=2&&k.j.Ca:!1}function io(k,ee){var le=k.C,Se=ee.indexOf(`
`,le);return Se==-1?yp:(le=Number(ee.substring(le,Se)),isNaN(le)?_p:(Se+=1,Se+le>ee.length?yp:(ee=ee.slice(Se,Se+le),k.C=Se+le,ee)))}Lc.prototype.cancel=function(){this.J=!0,Ml(this)};function gd(k){k.S=Date.now()+k.I,cg(k,k.I)}function cg(k,ee){if(k.B!=null)throw Error("WatchDog timer not null");k.B=ah(A(k.ba,k),ee)}function Zi(k){k.B&&(m.clearTimeout(k.B),k.B=null)}Lc.prototype.ba=function(){this.B=null;const k=Date.now();0<=k-this.S?(og(this.i,this.A),this.L!=2&&(ol(),gi(17)),Ml(this),this.s=2,ch(this)):cg(this,this.S-k)};function ch(k){k.j.G==0||k.J||Ii(k.j,k)}function Ml(k){Zi(k);var ee=k.M;ee&&typeof ee.ma=="function"&&ee.ma(),k.M=null,ia(k.U),k.g&&(ee=k.g,k.g=null,ee.abort(),ee.ma())}function ru(k,ee){try{var le=k.j;if(le.G!=0&&(le.g==k||Vr(le.h,k))){if(!k.K&&Vr(le.h,k)&&le.G==3){try{var Se=le.Da.g.parse(ee)}catch{Se=null}if(Array.isArray(Se)&&Se.length==3){var He=Se;if(He[0]==0){e:if(!le.u){if(le.g)if(le.g.F+3e3<k.F)du(le),Ed(le);else break e;ul(le),gi(18)}}else le.za=He[1],0<le.za-le.T&&37500>He[2]&&le.F&&le.v==0&&!le.C&&(le.C=ah(A(le.Za,le),6e3));if(1>=_d(le.h)&&le.ca){try{le.ca()}catch{}le.ca=void 0}}else Wa(le,11)}else if((k.K||le.g==k)&&du(le),!H(ee))for(He=le.Da.g.parse(ee),ee=0;ee<He.length;ee++){let sr=He[ee];if(le.T=sr[0],sr=sr[1],le.G==2)if(sr[0]=="c"){le.K=sr[1],le.ia=sr[2];const fr=sr[3];fr!=null&&(le.la=fr,le.j.info("VER="+le.la));const Bi=sr[4];Bi!=null&&(le.Aa=Bi,le.j.info("SVER="+le.Aa));const Bc=sr[5];Bc!=null&&typeof Bc=="number"&&0<Bc&&(Se=1.5*Bc,le.L=Se,le.j.info("backChannelRequestTimeoutMs_="+Se)),Se=le;const fs=k.g;if(fs){const wd=fs.g?fs.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(wd){var ct=Se.h;ct.g||wd.indexOf("spdy")==-1&&wd.indexOf("quic")==-1&&wd.indexOf("h2")==-1||(ct.j=ct.l,ct.g=new Set,ct.h&&(Ni(ct,ct.h),ct.h=null))}if(Se.D){const Fl=fs.g?fs.g.getResponseHeader("X-HTTP-Session-Id"):null;Fl&&(Se.ya=Fl,qn(Se.I,Se.D,Fl))}}le.G=3,le.l&&le.l.ua(),le.ba&&(le.R=Date.now()-k.F,le.j.info("Handshake RTT: "+le.R+"ms")),Se=le;var Ut=k;if(Se.qa=sc(Se,Se.J?Se.ia:null,Se.W),Ut.K){su(Se.h,Ut);var ii=Ut,Bs=Se.L;Bs&&(ii.I=Bs),ii.B&&(Zi(ii),gd(ii)),Se.g=Ut}else Ia(Se);0<le.i.length&&dl(le)}else sr[0]!="stop"&&sr[0]!="close"||Wa(le,7);else le.G==3&&(sr[0]=="stop"||sr[0]=="close"?sr[0]=="stop"?Wa(le,7):ph(le):sr[0]!="noop"&&le.l&&le.l.ta(sr),le.v=0)}}ol(4)}catch{}}var iu=class{constructor(k,ee){this.g=k,this.map=ee}};function lh(k){this.l=k||10,m.PerformanceNavigationTiming?(k=m.performance.getEntriesByType("navigation"),k=0<k.length&&(k[0].nextHopProtocol=="hq"||k[0].nextHopProtocol=="h2")):k=!!(m.chrome&&m.chrome.loadTimes&&m.chrome.loadTimes()&&m.chrome.loadTimes().wasFetchedViaSpdy),this.j=k?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Mf(k){return k.h?!0:k.g?k.g.size>=k.j:!1}function _d(k){return k.h?1:k.g?k.g.size:0}function Vr(k,ee){return k.h?k.h==ee:k.g?k.g.has(ee):!1}function Ni(k,ee){k.g?k.g.add(ee):k.h=ee}function su(k,ee){k.h&&k.h==ee?k.h=null:k.g&&k.g.has(ee)&&k.g.delete(ee)}lh.prototype.cancel=function(){if(this.i=so(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const k of this.g.values())k.cancel();this.g.clear()}};function so(k){if(k.h!=null)return k.i.concat(k.h.D);if(k.g!=null&&k.g.size!==0){let ee=k.i;for(const le of k.g.values())ee=ee.concat(le.D);return ee}return F(k.i)}function jc(k){if(k.V&&typeof k.V=="function")return k.V();if(typeof Map<"u"&&k instanceof Map||typeof Set<"u"&&k instanceof Set)return Array.from(k.values());if(typeof k=="string")return k.split("");if(v(k)){for(var ee=[],le=k.length,Se=0;Se<le;Se++)ee.push(k[Se]);return ee}ee=[],le=0;for(Se in k)ee[le++]=k[Se];return ee}function Uf(k){if(k.na&&typeof k.na=="function")return k.na();if(!k.V||typeof k.V!="function"){if(typeof Map<"u"&&k instanceof Map)return Array.from(k.keys());if(!(typeof Set<"u"&&k instanceof Set)){if(v(k)||typeof k=="string"){var ee=[];k=k.length;for(var le=0;le<k;le++)ee.push(le);return ee}ee=[],le=0;for(const Se in k)ee[le++]=Se;return ee}}}function Zt(k,ee){if(k.forEach&&typeof k.forEach=="function")k.forEach(ee,void 0);else if(v(k)||typeof k=="string")Array.prototype.forEach.call(k,ee,void 0);else for(var le=Uf(k),Se=jc(k),He=Se.length,ct=0;ct<He;ct++)ee.call(void 0,Se[ct],le&&le[ct],k)}var Oi=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function dh(k,ee){if(k){k=k.split("&");for(var le=0;le<k.length;le++){var Se=k[le].indexOf("="),He=null;if(0<=Se){var ct=k[le].substring(0,Se);He=k[le].substring(Se+1)}else ct=k[le];ee(ct,He?decodeURIComponent(He.replace(/\+/g," ")):"")}}}function nc(k){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,k instanceof nc){this.h=k.h,uh(this,k.j),this.o=k.o,this.g=k.g,cl(this,k.s),this.l=k.l;var ee=k.i,le=new Vl;le.i=ee.i,ee.g&&(le.g=new Map(ee.g),le.h=ee.h),Ul(this,le),this.m=k.m}else k&&(ee=String(k).match(Oi))?(this.h=!1,uh(this,ee[1]||"",!0),this.o=ao(ee[2]||""),this.g=ao(ee[3]||"",!0),cl(this,ee[4]),this.l=ao(ee[5]||"",!0),Ul(this,ee[6]||"",!0),this.m=ao(ee[7]||"")):(this.h=!1,this.i=new Vl(null,this.h))}nc.prototype.toString=function(){var k=[],ee=this.j;ee&&k.push(Na(ee,yd,!0),":");var le=this.g;return(le||ee=="file")&&(k.push("//"),(ee=this.o)&&k.push(Na(ee,yd,!0),"@"),k.push(encodeURIComponent(String(le)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),le=this.s,le!=null&&k.push(":",String(le))),(le=this.l)&&(this.g&&le.charAt(0)!="/"&&k.push("/"),k.push(Na(le,le.charAt(0)=="/"?vp:hh,!0))),(le=this.i.toString())&&k.push("?",le),(le=this.m)&&k.push("#",Na(le,Ep)),k.join("")};function hs(k){return new nc(k)}function uh(k,ee,le){k.j=le?ao(ee,!0):ee,k.j&&(k.j=k.j.replace(/:$/,""))}function cl(k,ee){if(ee){if(ee=Number(ee),isNaN(ee)||0>ee)throw Error("Bad port number "+ee);k.s=ee}else k.s=null}function Ul(k,ee,le){ee instanceof Vl?(k.i=ee,Mc(k.i,k.h)):(le||(ee=Na(ee,ou)),k.i=new Vl(ee,k.h))}function qn(k,ee,le){k.i.set(ee,le)}function To(k){return qn(k,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),k}function ao(k,ee){return k?ee?decodeURI(k.replace(/%25/g,"%2525")):decodeURIComponent(k):""}function Na(k,ee,le){return typeof k=="string"?(k=encodeURI(k).replace(ee,au),le&&(k=k.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),k):null}function au(k){return k=k.charCodeAt(0),"%"+(k>>4&15).toString(16)+(k&15).toString(16)}var yd=/[#\/\?@]/g,hh=/[#\?:]/g,vp=/[#\?]/g,ou=/[#\?@]/g,Ep=/#/g;function Vl(k,ee){this.h=this.g=null,this.i=k||null,this.j=!!ee}function rc(k){k.g||(k.g=new Map,k.h=0,k.i&&dh(k.i,function(ee,le){k.add(decodeURIComponent(ee.replace(/\+/g," ")),le)}))}t=Vl.prototype,t.add=function(k,ee){rc(this),this.i=null,k=Dn(this,k);var le=this.g.get(k);return le||this.g.set(k,le=[]),le.push(ee),this.h+=1,this};function Vf(k,ee){rc(k),ee=Dn(k,ee),k.g.has(ee)&&(k.i=null,k.h-=k.g.get(ee).length,k.g.delete(ee))}function xp(k,ee){return rc(k),ee=Dn(k,ee),k.g.has(ee)}t.forEach=function(k,ee){rc(this),this.g.forEach(function(le,Se){le.forEach(function(He){k.call(ee,He,Se,this)},this)},this)},t.na=function(){rc(this);const k=Array.from(this.g.values()),ee=Array.from(this.g.keys()),le=[];for(let Se=0;Se<ee.length;Se++){const He=k[Se];for(let ct=0;ct<He.length;ct++)le.push(ee[Se])}return le},t.V=function(k){rc(this);let ee=[];if(typeof k=="string")xp(this,k)&&(ee=ee.concat(this.g.get(Dn(this,k))));else{k=Array.from(this.g.values());for(let le=0;le<k.length;le++)ee=ee.concat(k[le])}return ee},t.set=function(k,ee){return rc(this),this.i=null,k=Dn(this,k),xp(this,k)&&(this.h-=this.g.get(k).length),this.g.set(k,[ee]),this.h+=1,this},t.get=function(k,ee){return k?(k=this.V(k),0<k.length?String(k[0]):ee):ee};function Ff(k,ee,le){Vf(k,ee),0<le.length&&(k.i=null,k.g.set(Dn(k,ee),F(le)),k.h+=le.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const k=[],ee=Array.from(this.g.keys());for(var le=0;le<ee.length;le++){var Se=ee[le];const ct=encodeURIComponent(String(Se)),Ut=this.V(Se);for(Se=0;Se<Ut.length;Se++){var He=ct;Ut[Se]!==""&&(He+="="+encodeURIComponent(String(Ut[Se]))),k.push(He)}}return this.i=k.join("&")};function Dn(k,ee){return ee=String(ee),k.j&&(ee=ee.toLowerCase()),ee}function Mc(k,ee){ee&&!k.j&&(rc(k),k.i=null,k.g.forEach(function(le,Se){var He=Se.toLowerCase();Se!=He&&(Vf(this,Se),Ff(this,He,le))},k)),k.j=ee}function Ei(k,ee){const le=new ec;if(m.Image){const Se=new Image;Se.onload=O(Ro,le,"TestLoadImage: loaded",!0,ee,Se),Se.onerror=O(Ro,le,"TestLoadImage: error",!1,ee,Se),Se.onabort=O(Ro,le,"TestLoadImage: abort",!1,ee,Se),Se.ontimeout=O(Ro,le,"TestLoadImage: timeout",!1,ee,Se),m.setTimeout(function(){Se.ontimeout&&Se.ontimeout()},1e4),Se.src=k}else ee(!1)}function lg(k,ee){const le=new ec,Se=new AbortController,He=setTimeout(()=>{Se.abort(),Ro(le,"TestPingServer: timeout",!1,ee)},1e4);fetch(k,{signal:Se.signal}).then(ct=>{clearTimeout(He),ct.ok?Ro(le,"TestPingServer: ok",!0,ee):Ro(le,"TestPingServer: server error",!1,ee)}).catch(()=>{clearTimeout(He),Ro(le,"TestPingServer: error",!1,ee)})}function Ro(k,ee,le,Se,He){try{He&&(He.onload=null,He.onerror=null,He.onabort=null,He.ontimeout=null),Se(le)}catch{}}function Bf(){this.g=new We}function vd(k,ee,le){const Se=le||"";try{Zt(k,function(He,ct){let Ut=He;w(He)&&(Ut=Lt(He)),ee.push(Se+ct+"="+encodeURIComponent(Ut))})}catch(He){throw ee.push(Se+"type="+encodeURIComponent("_badmap")),He}}function Uc(k){this.l=k.Ub||null,this.j=k.eb||!1}U(Uc,$t),Uc.prototype.g=function(){return new cu(this.l,this.j)},Uc.prototype.i=function(k){return function(){return k}}({});function cu(k,ee){Ri.call(this),this.D=k,this.o=ee,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}U(cu,Ri),t=cu.prototype,t.open=function(k,ee){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=k,this.A=ee,this.readyState=1,vr(this)},t.send=function(k){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const ee={headers:this.u,method:this.B,credentials:this.m,cache:void 0};k&&(ee.body=k),(this.D||m).fetch(new Request(this.A,ee)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Yn(this)),this.readyState=0},t.Sa=function(k){if(this.g&&(this.l=k,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=k.headers,this.readyState=2,vr(this)),this.g&&(this.readyState=3,vr(this),this.g)))if(this.responseType==="arraybuffer")k.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof m.ReadableStream<"u"&&"body"in k){if(this.j=k.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;lu(this)}else k.text().then(this.Ra.bind(this),this.ga.bind(this))};function lu(k){k.j.read().then(k.Pa.bind(k)).catch(k.ga.bind(k))}t.Pa=function(k){if(this.g){if(this.o&&k.value)this.response.push(k.value);else if(!this.o){var ee=k.value?k.value:new Uint8Array(0);(ee=this.v.decode(ee,{stream:!k.done}))&&(this.response=this.responseText+=ee)}k.done?Yn(this):vr(this),this.readyState==3&&lu(this)}},t.Ra=function(k){this.g&&(this.response=this.responseText=k,Yn(this))},t.Qa=function(k){this.g&&(this.response=k,Yn(this))},t.ga=function(){this.g&&Yn(this)};function Yn(k){k.readyState=4,k.l=null,k.j=null,k.v=null,vr(k)}t.setRequestHeader=function(k,ee){this.u.append(k,ee)},t.getResponseHeader=function(k){return this.h&&this.h.get(k.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const k=[],ee=this.h.entries();for(var le=ee.next();!le.done;)le=le.value,k.push(le[0]+": "+le[1]),le=ee.next();return k.join(`\r
`)};function vr(k){k.onreadystatechange&&k.onreadystatechange.call(k)}Object.defineProperty(cu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(k){this.m=k?"include":"same-origin"}});function zf(k){let ee="";return he(k,function(le,Se){ee+=Se,ee+=":",ee+=le,ee+=`\r
`}),ee}function bp(k,ee,le){e:{for(Se in le){var Se=!1;break e}Se=!0}Se||(le=zf(le),typeof k=="string"?le!=null&&encodeURIComponent(String(le)):qn(k,ee,le))}function es(k){Ri.call(this),this.headers=new Map,this.o=k||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}U(es,Ri);var ll=/^https?$/i,za=["POST","PUT"];t=es.prototype,t.Ha=function(k){this.J=k},t.ea=function(k,ee,le,Se){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+k);ee=ee?ee.toUpperCase():"GET",this.D=k,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():gp.g(),this.v=this.o?tr(this.o):tr(gp),this.g.onreadystatechange=A(this.Ea,this);try{this.B=!0,this.g.open(ee,String(k),!0),this.B=!1}catch(ct){Gf(this,ct);return}if(k=le||"",le=new Map(this.headers),Se)if(Object.getPrototypeOf(Se)===Object.prototype)for(var He in Se)le.set(He,Se[He]);else if(typeof Se.keys=="function"&&typeof Se.get=="function")for(const ct of Se.keys())le.set(ct,Se.get(ct));else throw Error("Unknown input type for opt_headers: "+String(Se));Se=Array.from(le.keys()).find(ct=>ct.toLowerCase()=="content-type"),He=m.FormData&&k instanceof m.FormData,!(0<=Array.prototype.indexOf.call(za,ee,void 0))||Se||He||le.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ct,Ut]of le)this.g.setRequestHeader(ct,Ut);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{_i(this),this.u=!0,this.g.send(k),this.u=!1}catch(ct){Gf(this,ct)}};function Gf(k,ee){k.h=!1,k.g&&(k.j=!0,k.g.abort(),k.j=!1),k.l=ee,k.m=5,wp(k),xs(k)}function wp(k){k.A||(k.A=!0,Gr(k,"complete"),Gr(k,"error"))}t.abort=function(k){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=k||7,Gr(this,"complete"),Gr(this,"abort"),xs(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),xs(this,!0)),es.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?kr(this):this.bb())},t.bb=function(){kr(this)};function kr(k){if(k.h&&typeof p<"u"&&(!k.v[1]||Ns(k)!=4||k.Z()!=2)){if(k.u&&Ns(k)==4)Ac(k.Ea,0,k);else if(Gr(k,"readystatechange"),Ns(k)==4){k.h=!1;try{const Ut=k.Z();e:switch(Ut){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var ee=!0;break e;default:ee=!1}var le;if(!(le=ee)){var Se;if(Se=Ut===0){var He=String(k.D).match(Oi)[1]||null;!He&&m.self&&m.self.location&&(He=m.self.location.protocol.slice(0,-1)),Se=!ll.test(He?He.toLowerCase():"")}le=Se}if(le)Gr(k,"complete"),Gr(k,"success");else{k.m=6;try{var ct=2<Ns(k)?k.g.statusText:""}catch{ct=""}k.l=ct+" ["+k.Z()+"]",wp(k)}}finally{xs(k)}}}}function xs(k,ee){if(k.g){_i(k);const le=k.g,Se=k.v[0]?()=>{}:null;k.g=null,k.v=null,ee||Gr(k,"ready");try{le.onreadystatechange=Se}catch{}}}function _i(k){k.I&&(m.clearTimeout(k.I),k.I=null)}t.isActive=function(){return!!this.g};function Ns(k){return k.g?k.g.readyState:0}t.Z=function(){try{return 2<Ns(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(k){if(this.g){var ee=this.g.responseText;return k&&ee.indexOf(k)==0&&(ee=ee.substring(k.length)),Ir(ee)}};function Sp(k){try{if(!k.g)return null;if("response"in k.g)return k.g.response;switch(k.H){case"":case"text":return k.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in k.g)return k.g.mozResponseArrayBuffer}return null}catch{return null}}function Wf(k){const ee={};k=(k.g&&2<=Ns(k)&&k.g.getAllResponseHeaders()||"").split(`\r
`);for(let Se=0;Se<k.length;Se++){if(H(k[Se]))continue;var le=pe(k[Se]);const He=le[0];if(le=le[1],typeof le!="string")continue;le=le.trim();const ct=ee[He]||[];ee[He]=ct,ct.push(le)}J(ee,function(Se){return Se.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ps(k,ee,le){return le&&le.internalChannelParams&&le.internalChannelParams[k]||ee}function Tp(k){this.Aa=0,this.i=[],this.j=new ec,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ps("failFast",!1,k),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ps("baseRetryDelayMs",5e3,k),this.cb=ps("retryDelaySeedMs",1e4,k),this.Wa=ps("forwardChannelMaxRetries",2,k),this.wa=ps("forwardChannelRequestTimeoutMs",2e4,k),this.pa=k&&k.xmlHttpFactory||void 0,this.Xa=k&&k.Tb||void 0,this.Ca=k&&k.useFetchStreams||!1,this.L=void 0,this.J=k&&k.supportsCrossDomainXhr||!1,this.K="",this.h=new lh(k&&k.concurrentRequestLimit),this.Da=new Bf,this.P=k&&k.fastHandshake||!1,this.O=k&&k.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=k&&k.Rb||!1,k&&k.xa&&this.j.xa(),k&&k.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&k&&k.detectBufferingProxy||!1,this.ja=void 0,k&&k.longPollingTimeout&&0<k.longPollingTimeout&&(this.ja=k.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=Tp.prototype,t.la=8,t.G=1,t.connect=function(k,ee,le,Se){gi(0),this.W=k,this.H=ee||{},le&&Se!==void 0&&(this.H.OSID=le,this.H.OAID=Se),this.F=this.X,this.I=sc(this,null,this.W),dl(this)};function ph(k){if(Hf(k),k.G==3){var ee=k.U++,le=hs(k.I);if(qn(le,"SID",k.K),qn(le,"RID",ee),qn(le,"TYPE","terminate"),fh(k,le),ee=new Lc(k,k.j,ee),ee.L=2,ee.v=To(hs(le)),le=!1,m.navigator&&m.navigator.sendBeacon)try{le=m.navigator.sendBeacon(ee.v.toString(),"")}catch{}!le&&m.Image&&(new Image().src=ee.v,le=!0),le||(ee.g=Kf(ee.j,null),ee.g.ea(ee.v)),ee.F=Date.now(),gd(ee)}dg(k)}function Ed(k){k.g&&(ic(k),k.g.cancel(),k.g=null)}function Hf(k){Ed(k),k.u&&(m.clearTimeout(k.u),k.u=null),du(k),k.h.cancel(),k.s&&(typeof k.s=="number"&&m.clearTimeout(k.s),k.s=null)}function dl(k){if(!Mf(k.h)&&!k.s){k.s=!0;var ee=k.Ga;lt||Ke(),Le||(lt(),Le=!0),Me.add(ee,k),k.B=0}}function Rp(k,ee){return _d(k.h)>=k.h.j-(k.s?1:0)?!1:k.s?(k.i=ee.D.concat(k.i),!0):k.G==1||k.G==2||k.B>=(k.Va?0:k.Wa)?!1:(k.s=ah(A(k.Ga,k,ee),Vc(k,k.B)),k.B++,!0)}t.Ga=function(k){if(this.s)if(this.s=null,this.G==1){if(!k){this.U=Math.floor(1e5*Math.random()),k=this.U++;const He=new Lc(this,this.j,k);let ct=this.o;if(this.S&&(ct?(ct=Q(ct),de(ct,this.S)):ct=this.S),this.m!==null||this.O||(He.H=ct,ct=null),this.P)e:{for(var ee=0,le=0;le<this.i.length;le++){t:{var Se=this.i[le];if("__data__"in Se.map&&(Se=Se.map.__data__,typeof Se=="string")){Se=Se.length;break t}Se=void 0}if(Se===void 0)break;if(ee+=Se,4096<ee){ee=le;break e}if(ee===4096||le===this.i.length-1){ee=le+1;break e}}ee=1e3}else ee=1e3;ee=Ga(this,He,ee),le=hs(this.I),qn(le,"RID",k),qn(le,"CVER",22),this.D&&qn(le,"X-HTTP-Session-Id",this.D),fh(this,le),ct&&(this.O?ee="headers="+encodeURIComponent(String(zf(ct)))+"&"+ee:this.m&&bp(le,this.m,ct)),Ni(this.h,He),this.Ua&&qn(le,"TYPE","init"),this.P?(qn(le,"$req",ee),qn(le,"SID","null"),He.T=!0,jl(He,le,null)):jl(He,le,ee),this.G=2}}else this.G==3&&(k?Li(this,k):this.i.length==0||Mf(this.h)||Li(this))};function Li(k,ee){var le;ee?le=ee.l:le=k.U++;const Se=hs(k.I);qn(Se,"SID",k.K),qn(Se,"RID",le),qn(Se,"AID",k.T),fh(k,Se),k.m&&k.o&&bp(Se,k.m,k.o),le=new Lc(k,k.j,le,k.B+1),k.m===null&&(le.H=k.o),ee&&(k.i=ee.D.concat(k.i)),ee=Ga(k,le,1e3),le.I=Math.round(.5*k.wa)+Math.round(.5*k.wa*Math.random()),Ni(k.h,le),jl(le,Se,ee)}function fh(k,ee){k.H&&he(k.H,function(le,Se){qn(ee,Se,le)}),k.l&&Zt({},function(le,Se){qn(ee,Se,le)})}function Ga(k,ee,le){le=Math.min(k.i.length,le);var Se=k.l?A(k.l.Na,k.l,k):null;e:{var He=k.i;let ct=-1;for(;;){const Ut=["count="+le];ct==-1?0<le?(ct=He[0].g,Ut.push("ofs="+ct)):ct=0:Ut.push("ofs="+ct);let ii=!0;for(let Bs=0;Bs<le;Bs++){let sr=He[Bs].g;const fr=He[Bs].map;if(sr-=ct,0>sr)ct=Math.max(0,He[Bs].g-100),ii=!1;else try{vd(fr,Ut,"req"+sr+"_")}catch{Se&&Se(fr)}}if(ii){Se=Ut.join("&");break e}}}return k=k.i.splice(0,le),ee.D=k,Se}function Ia(k){if(!k.g&&!k.u){k.Y=1;var ee=k.Fa;lt||Ke(),Le||(lt(),Le=!0),Me.add(ee,k),k.v=0}}function ul(k){return k.g||k.u||3<=k.v?!1:(k.Y++,k.u=ah(A(k.Fa,k),Vc(k,k.v)),k.v++,!0)}t.Fa=function(){if(this.u=null,xd(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var k=2*this.R;this.j.info("BP detection timer enabled: "+k),this.A=ah(A(this.ab,this),k)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,gi(10),Ed(this),xd(this))};function ic(k){k.A!=null&&(m.clearTimeout(k.A),k.A=null)}function xd(k){k.g=new Lc(k,k.j,"rpc",k.Y),k.m===null&&(k.g.H=k.o),k.g.O=0;var ee=hs(k.qa);qn(ee,"RID","rpc"),qn(ee,"SID",k.K),qn(ee,"AID",k.T),qn(ee,"CI",k.F?"0":"1"),!k.F&&k.ja&&qn(ee,"TO",k.ja),qn(ee,"TYPE","xmlhttp"),fh(k,ee),k.m&&k.o&&bp(ee,k.m,k.o),k.L&&(k.g.I=k.L);var le=k.g;k=k.ia,le.L=1,le.v=To(hs(ee)),le.m=null,le.P=!0,jf(le,k)}t.Za=function(){this.C!=null&&(this.C=null,Ed(this),ul(this),gi(19))};function du(k){k.C!=null&&(m.clearTimeout(k.C),k.C=null)}function Ii(k,ee){var le=null;if(k.g==ee){du(k),ic(k),k.g=null;var Se=2}else if(Vr(k.h,ee))le=ee.D,su(k.h,ee),Se=1;else return;if(k.G!=0){if(ee.o)if(Se==1){le=ee.m?ee.m.length:0,ee=Date.now()-ee.F;var He=k.B;Se=Qi(),Gr(Se,new fp(Se,le)),dl(k)}else Ia(k);else if(He=ee.s,He==3||He==0&&0<ee.X||!(Se==1&&Rp(k,ee)||Se==2&&ul(k)))switch(le&&0<le.length&&(ee=k.h,ee.i=ee.i.concat(le)),He){case 1:Wa(k,5);break;case 4:Wa(k,10);break;case 3:Wa(k,6);break;default:Wa(k,2)}}}function Vc(k,ee){let le=k.Ta+Math.floor(Math.random()*k.cb);return k.isActive()||(le*=2),le*ee}function Wa(k,ee){if(k.j.info("Error code "+ee),ee==2){var le=A(k.fb,k),Se=k.Xa;const He=!Se;Se=new nc(Se||"//www.google.com/images/cleardot.gif"),m.location&&m.location.protocol=="http"||uh(Se,"https"),To(Se),He?Ei(Se.toString(),le):lg(Se.toString(),le)}else gi(2);k.G=0,k.l&&k.l.sa(ee),dg(k),Hf(k)}t.fb=function(k){k?(this.j.info("Successfully pinged google.com"),gi(2)):(this.j.info("Failed to ping google.com"),gi(1))};function dg(k){if(k.G=0,k.ka=[],k.l){const ee=so(k.h);(ee.length!=0||k.i.length!=0)&&(q(k.ka,ee),q(k.ka,k.i),k.h.i.length=0,F(k.i),k.i.length=0),k.l.ra()}}function sc(k,ee,le){var Se=le instanceof nc?hs(le):new nc(le);if(Se.g!="")ee&&(Se.g=ee+"."+Se.g),cl(Se,Se.s);else{var He=m.location;Se=He.protocol,ee=ee?ee+"."+He.hostname:He.hostname,He=+He.port;var ct=new nc(null);Se&&uh(ct,Se),ee&&(ct.g=ee),He&&cl(ct,He),le&&(ct.l=le),Se=ct}return le=k.D,ee=k.ya,le&&ee&&qn(Se,le,ee),qn(Se,"VER",k.la),fh(k,Se),Se}function Kf(k,ee,le){if(ee&&!k.J)throw Error("Can't create secondary domain capable XhrIo object.");return ee=k.Ca&&!k.pa?new es(new Uc({eb:le})):new es(k.pa),ee.Ha(k.J),ee}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function qf(){}t=qf.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function In(){}In.prototype.g=function(k,ee){return new sa(k,ee)};function sa(k,ee){Ri.call(this),this.g=new Tp(ee),this.l=k,this.h=ee&&ee.messageUrlParams||null,k=ee&&ee.messageHeaders||null,ee&&ee.clientProtocolHeaderRequired&&(k?k["X-Client-Protocol"]="webchannel":k={"X-Client-Protocol":"webchannel"}),this.g.o=k,k=ee&&ee.initMessageHeaders||null,ee&&ee.messageContentType&&(k?k["X-WebChannel-Content-Type"]=ee.messageContentType:k={"X-WebChannel-Content-Type":ee.messageContentType}),ee&&ee.va&&(k?k["X-WebChannel-Client-Profile"]=ee.va:k={"X-WebChannel-Client-Profile":ee.va}),this.g.S=k,(k=ee&&ee.Sb)&&!H(k)&&(this.g.m=k),this.v=ee&&ee.supportsCrossDomainXhr||!1,this.u=ee&&ee.sendRawJson||!1,(ee=ee&&ee.httpSessionIdParam)&&!H(ee)&&(this.g.D=ee,k=this.h,k!==null&&ee in k&&(k=this.h,ee in k&&delete k[ee])),this.j=new Fc(this)}U(sa,Ri),sa.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},sa.prototype.close=function(){ph(this.g)},sa.prototype.o=function(k){var ee=this.g;if(typeof k=="string"){var le={};le.__data__=k,k=le}else this.u&&(le={},le.__data__=Lt(k),k=le);ee.i.push(new iu(ee.Ya++,k)),ee.G==3&&dl(ee)},sa.prototype.N=function(){this.g.l=null,delete this.j,ph(this.g),delete this.g,sa.aa.N.call(this)};function ac(k){Nn.call(this),k.__headers__&&(this.headers=k.__headers__,this.statusCode=k.__status__,delete k.__headers__,delete k.__status__);var ee=k.__sm__;if(ee){e:{for(const le in ee){k=le;break e}k=void 0}(this.i=k)&&(k=this.i,ee=ee!==null&&k in ee?ee[k]:void 0),this.data=ee}else this.data=k}U(ac,Nn);function bd(){Ci.call(this),this.status=1}U(bd,Ci);function Fc(k){this.g=k}U(Fc,qf),Fc.prototype.ua=function(){Gr(this.g,"a")},Fc.prototype.ta=function(k){Gr(this.g,new ac(k))},Fc.prototype.sa=function(k){Gr(this.g,new bd)},Fc.prototype.ra=function(){Gr(this.g,"b")},In.prototype.createWebChannel=In.prototype.g,sa.prototype.send=sa.prototype.o,sa.prototype.open=sa.prototype.m,sa.prototype.close=sa.prototype.close,cde=function(){return new In},ode=function(){return Qi()},ade=Ar,B6={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},nu.NO_ERROR=0,nu.TIMEOUT=8,nu.HTTP_ERROR=6,dD=nu,mp.COMPLETE="complete",sde=mp,mi.EventType=Wr,Wr.OPEN="a",Wr.CLOSE="b",Wr.ERROR="c",Wr.MESSAGE="d",Ri.prototype.listen=Ri.prototype.K,pC=mi,es.prototype.listenOnce=es.prototype.L,es.prototype.getLastError=es.prototype.Ka,es.prototype.getLastErrorCode=es.prototype.Ba,es.prototype.getStatus=es.prototype.Z,es.prototype.getResponseJson=es.prototype.Oa,es.prototype.getResponseText=es.prototype.oa,es.prototype.send=es.prototype.ea,es.prototype.setWithCredentials=es.prototype.Ha,ide=es}).apply(typeof C2<"u"?C2:typeof self<"u"?self:typeof window<"u"?window:{});const Kne="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Wo=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Wo.UNAUTHENTICATED=new Wo(null),Wo.GOOGLE_CREDENTIALS=new Wo("google-credentials-uid"),Wo.FIRST_PARTY=new Wo("first-party-uid"),Wo.MOCK_USER=new Wo("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Uw="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z_=new q8("@firebase/firestore");function db(){return Z_.logLevel}function jPe(t){Z_.setLogLevel(t)}function Pt(t,...e){if(Z_.logLevel<=oi.DEBUG){const r=e.map(dG);Z_.debug(`Firestore (${Uw}): ${t}`,...r)}}function Ma(t,...e){if(Z_.logLevel<=oi.ERROR){const r=e.map(dG);Z_.error(`Firestore (${Uw}): ${t}`,...r)}}function Jd(t,...e){if(Z_.logLevel<=oi.WARN){const r=e.map(dG);Z_.warn(`Firestore (${Uw}): ${t}`,...r)}}function dG(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(r){return JSON.stringify(r)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cn(t="Unexpected state"){const e=`FIRESTORE (${Uw}) INTERNAL ASSERTION FAILED: `+t;throw Ma(e),new Error(e)}function yn(t,e){t||cn()}function MPe(t,e){t||cn()}function Wt(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ot={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Nt extends Pf{constructor(e,r){super(e,r),this.code=e,this.message=r,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $o{constructor(){this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lde{constructor(e,r){this.user=r,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class dde{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,r){e.enqueueRetryable(()=>r(Wo.UNAUTHENTICATED))}shutdown(){}}class UPe{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,r){this.changeListener=r,e.enqueueRetryable(()=>r(this.token.user))}shutdown(){this.changeListener=null}}class VPe{constructor(e){this.t=e,this.currentUser=Wo.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,r){yn(this.o===void 0);let a=this.i;const l=v=>this.i!==a?(a=this.i,r(v)):Promise.resolve();let u=new $o;this.o=()=>{this.i++,this.currentUser=this.u(),u.resolve(),u=new $o,e.enqueueRetryable(()=>l(this.currentUser))};const p=()=>{const v=u;e.enqueueRetryable(async()=>{await v.promise,await l(this.currentUser)})},m=v=>{Pt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=v,this.o&&(this.auth.addAuthTokenListener(this.o),p())};this.t.onInit(v=>m(v)),setTimeout(()=>{if(!this.auth){const v=this.t.getImmediate({optional:!0});v?m(v):(Pt("FirebaseAuthCredentialsProvider","Auth not yet detected"),u.resolve(),u=new $o)}},0),p()}getToken(){const e=this.i,r=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(r).then(a=>this.i!==e?(Pt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):a?(yn(typeof a.accessToken=="string"),new lde(a.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return yn(e===null||typeof e=="string"),new Wo(e)}}class FPe{constructor(e,r,a){this.l=e,this.h=r,this.P=a,this.type="FirstParty",this.user=Wo.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class BPe{constructor(e,r,a){this.l=e,this.h=r,this.P=a}getToken(){return Promise.resolve(new FPe(this.l,this.h,this.P))}start(e,r){e.enqueueRetryable(()=>r(Wo.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class ude{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class zPe{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,r){yn(this.o===void 0);const a=u=>{u.error!=null&&Pt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${u.error.message}`);const p=u.token!==this.R;return this.R=u.token,Pt("FirebaseAppCheckTokenProvider",`Received ${p?"new":"existing"} token.`),p?r(u.token):Promise.resolve()};this.o=u=>{e.enqueueRetryable(()=>a(u))};const l=u=>{Pt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=u,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(u=>l(u)),setTimeout(()=>{if(!this.appCheck){const u=this.A.getImmediate({optional:!0});u?l(u):Pt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(r=>r?(yn(typeof r.token=="string"),this.R=r.token,new ude(r.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class GPe{getToken(){return Promise.resolve(new ude(""))}invalidateToken(){}start(e,r){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WPe(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),r=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(r);else for(let a=0;a<t;a++)r[a]=Math.floor(256*Math.random());return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uG{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=Math.floor(256/e.length)*e.length;let a="";for(;a.length<20;){const l=WPe(40);for(let u=0;u<l.length;++u)a.length<20&&l[u]<r&&(a+=e.charAt(l[u]%e.length))}return a}}function ir(t,e){return t<e?-1:t>e?1:0}function rw(t,e,r){return t.length===e.length&&t.every((a,l)=>r(a,e[l]))}function hde(t){return t+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fn{constructor(e,r){if(this.seconds=e,this.nanoseconds=r,r<0)throw new Nt(ot.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(r>=1e9)throw new Nt(ot.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(e<-62135596800)throw new Nt(ot.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Nt(ot.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return fn.fromMillis(Date.now())}static fromDate(e){return fn.fromMillis(e.getTime())}static fromMillis(e){const r=Math.floor(e/1e3),a=Math.floor(1e6*(e-1e3*r));return new fn(r,a)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ir(this.nanoseconds,e.nanoseconds):ir(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sn{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Sn(e)}static min(){return new Sn(new fn(0,0))}static max(){return new Sn(new fn(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vN{constructor(e,r,a){r===void 0?r=0:r>e.length&&cn(),a===void 0?a=e.length-r:a>e.length-r&&cn(),this.segments=e,this.offset=r,this.len=a}get length(){return this.len}isEqual(e){return vN.comparator(this,e)===0}child(e){const r=this.segments.slice(this.offset,this.limit());return e instanceof vN?e.forEach(a=>{r.push(a)}):r.push(e),this.construct(r)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}forEach(e){for(let r=this.offset,a=this.limit();r<a;r++)e(this.segments[r])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,r){const a=Math.min(e.length,r.length);for(let l=0;l<a;l++){const u=e.get(l),p=r.get(l);if(u<p)return-1;if(u>p)return 1}return e.length<r.length?-1:e.length>r.length?1:0}}class li extends vN{construct(e,r,a){return new li(e,r,a)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const r=[];for(const a of e){if(a.indexOf("//")>=0)throw new Nt(ot.INVALID_ARGUMENT,`Invalid segment (${a}). Paths must not contain // in them.`);r.push(...a.split("/").filter(l=>l.length>0))}return new li(r)}static emptyPath(){return new li([])}}const HPe=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ms extends vN{construct(e,r,a){return new Ms(e,r,a)}static isValidIdentifier(e){return HPe.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ms.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Ms(["__name__"])}static fromServerFormat(e){const r=[];let a="",l=0;const u=()=>{if(a.length===0)throw new Nt(ot.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);r.push(a),a=""};let p=!1;for(;l<e.length;){const m=e[l];if(m==="\\"){if(l+1===e.length)throw new Nt(ot.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const v=e[l+1];if(v!=="\\"&&v!=="."&&v!=="`")throw new Nt(ot.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);a+=v,l+=2}else m==="`"?(p=!p,l++):m!=="."||p?(a+=m,l++):(u(),l++)}if(u(),p)throw new Nt(ot.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ms(r)}static emptyPath(){return new Ms([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kt{constructor(e){this.path=e}static fromPath(e){return new Kt(li.fromString(e))}static fromName(e){return new Kt(li.fromString(e).popFirst(5))}static empty(){return new Kt(li.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&li.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,r){return li.comparator(e.path,r.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Kt(new li(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iw{constructor(e,r,a,l){this.indexId=e,this.collectionGroup=r,this.fields=a,this.indexState=l}}function z6(t){return t.fields.find(e=>e.kind===2)}function Jy(t){return t.fields.filter(e=>e.kind!==2)}function KPe(t,e){let r=ir(t.collectionGroup,e.collectionGroup);if(r!==0)return r;for(let a=0;a<Math.min(t.fields.length,e.fields.length);++a)if(r=qPe(t.fields[a],e.fields[a]),r!==0)return r;return ir(t.fields.length,e.fields.length)}iw.UNKNOWN_ID=-1;class fv{constructor(e,r){this.fieldPath=e,this.kind=r}}function qPe(t,e){const r=Ms.comparator(t.fieldPath,e.fieldPath);return r!==0?r:ir(t.kind,e.kind)}class sw{constructor(e,r){this.sequenceNumber=e,this.offset=r}static empty(){return new sw(0,Qd.min())}}function pde(t,e){const r=t.toTimestamp().seconds,a=t.toTimestamp().nanoseconds+1,l=Sn.fromTimestamp(a===1e9?new fn(r+1,0):new fn(r,a));return new Qd(l,Kt.empty(),e)}function fde(t){return new Qd(t.readTime,t.key,-1)}class Qd{constructor(e,r,a){this.readTime=e,this.documentKey=r,this.largestBatchId=a}static min(){return new Qd(Sn.min(),Kt.empty(),-1)}static max(){return new Qd(Sn.max(),Kt.empty(),-1)}}function hG(t,e){let r=t.readTime.compareTo(e.readTime);return r!==0?r:(r=Kt.comparator(t.documentKey,e.documentKey),r!==0?r:ir(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mde="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class gde{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function p0(t){if(t.code!==ot.FAILED_PRECONDITION||t.message!==mde)throw t;Pt("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $e{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(r=>{this.isDone=!0,this.result=r,this.nextCallback&&this.nextCallback(r)},r=>{this.isDone=!0,this.error=r,this.catchCallback&&this.catchCallback(r)})}catch(e){return this.next(void 0,e)}next(e,r){return this.callbackAttached&&cn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(r,this.error):this.wrapSuccess(e,this.result):new $e((a,l)=>{this.nextCallback=u=>{this.wrapSuccess(e,u).next(a,l)},this.catchCallback=u=>{this.wrapFailure(r,u).next(a,l)}})}toPromise(){return new Promise((e,r)=>{this.next(e,r)})}wrapUserFunction(e){try{const r=e();return r instanceof $e?r:$e.resolve(r)}catch(r){return $e.reject(r)}}wrapSuccess(e,r){return e?this.wrapUserFunction(()=>e(r)):$e.resolve(r)}wrapFailure(e,r){return e?this.wrapUserFunction(()=>e(r)):$e.reject(r)}static resolve(e){return new $e((r,a)=>{r(e)})}static reject(e){return new $e((r,a)=>{a(e)})}static waitFor(e){return new $e((r,a)=>{let l=0,u=0,p=!1;e.forEach(m=>{++l,m.next(()=>{++u,p&&u===l&&r()},v=>a(v))}),p=!0,u===l&&r()})}static or(e){let r=$e.resolve(!1);for(const a of e)r=r.next(l=>l?$e.resolve(l):a());return r}static forEach(e,r){const a=[];return e.forEach((l,u)=>{a.push(r.call(this,l,u))}),this.waitFor(a)}static mapArray(e,r){return new $e((a,l)=>{const u=e.length,p=new Array(u);let m=0;for(let v=0;v<u;v++){const w=v;r(e[w]).next(R=>{p[w]=R,++m,m===u&&a(p)},R=>l(R))}})}static doWhile(e,r){return new $e((a,l)=>{const u=()=>{e()===!0?r().next(()=>{u()},l):a()};u()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gL{constructor(e,r){this.action=e,this.transaction=r,this.aborted=!1,this.V=new $o,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{r.error?this.V.reject(new DC(e,r.error)):this.V.resolve()},this.transaction.onerror=a=>{const l=pG(a.target.error);this.V.reject(new DC(e,l))}}static open(e,r,a,l){try{return new gL(r,e.transaction(l,a))}catch(u){throw new DC(r,u)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(Pt("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const r=this.transaction.objectStore(e);return new $Pe(r)}}class Rf{constructor(e,r,a){this.name=e,this.version=r,this.p=a,Rf.S(vo())===12.2&&Ma("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return Pt("SimpleDb","Removing database:",e),ev(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!ale())return!1;if(Rf.v())return!0;const e=vo(),r=Rf.S(e),a=0<r&&r<10,l=_de(e),u=0<l&&l<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||a||u)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,r){return e.store(r)}static S(e){const r=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),a=r?r[1].split("_").slice(0,2).join("."):"-1";return Number(a)}async M(e){return this.db||(Pt("SimpleDb","Opening database:",this.name),this.db=await new Promise((r,a)=>{const l=indexedDB.open(this.name,this.version);l.onsuccess=u=>{const p=u.target.result;r(p)},l.onblocked=()=>{a(new DC(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},l.onerror=u=>{const p=u.target.error;p.name==="VersionError"?a(new Nt(ot.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):p.name==="InvalidStateError"?a(new Nt(ot.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+p)):a(new DC(e,p))},l.onupgradeneeded=u=>{Pt("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',u.oldVersion);const p=u.target.result;this.p.O(p,l.transaction,u.oldVersion,this.version).next(()=>{Pt("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=r=>this.N(r)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=r=>e(r))}async runTransaction(e,r,a,l){const u=r==="readonly";let p=0;for(;;){++p;try{this.db=await this.M(e);const m=gL.open(this.db,e,u?"readonly":"readwrite",a),v=l(m).next(w=>(m.g(),w)).catch(w=>(m.abort(w),$e.reject(w))).toPromise();return v.catch(()=>{}),await m.m,v}catch(m){const v=m,w=v.name!=="FirebaseError"&&p<3;if(Pt("SimpleDb","Transaction failed with error:",v.message,"Retrying:",w),this.close(),!w)return Promise.reject(v)}}}close(){this.db&&this.db.close(),this.db=void 0}}function _de(t){const e=t.match(/Android ([\d.]+)/i),r=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(r)}class YPe{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return ev(this.B.delete())}}class DC extends Nt{constructor(e,r){super(ot.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${r}`),this.name="IndexedDbTransactionError"}}function f0(t){return t.name==="IndexedDbTransactionError"}class $Pe{constructor(e){this.store=e}put(e,r){let a;return r!==void 0?(Pt("SimpleDb","PUT",this.store.name,e,r),a=this.store.put(r,e)):(Pt("SimpleDb","PUT",this.store.name,"<auto-key>",e),a=this.store.put(e)),ev(a)}add(e){return Pt("SimpleDb","ADD",this.store.name,e,e),ev(this.store.add(e))}get(e){return ev(this.store.get(e)).next(r=>(r===void 0&&(r=null),Pt("SimpleDb","GET",this.store.name,e,r),r))}delete(e){return Pt("SimpleDb","DELETE",this.store.name,e),ev(this.store.delete(e))}count(){return Pt("SimpleDb","COUNT",this.store.name),ev(this.store.count())}U(e,r){const a=this.options(e,r),l=a.index?this.store.index(a.index):this.store;if(typeof l.getAll=="function"){const u=l.getAll(a.range);return new $e((p,m)=>{u.onerror=v=>{m(v.target.error)},u.onsuccess=v=>{p(v.target.result)}})}{const u=this.cursor(a),p=[];return this.W(u,(m,v)=>{p.push(v)}).next(()=>p)}}G(e,r){const a=this.store.getAll(e,r===null?void 0:r);return new $e((l,u)=>{a.onerror=p=>{u(p.target.error)},a.onsuccess=p=>{l(p.target.result)}})}j(e,r){Pt("SimpleDb","DELETE ALL",this.store.name);const a=this.options(e,r);a.H=!1;const l=this.cursor(a);return this.W(l,(u,p,m)=>m.delete())}J(e,r){let a;r?a=e:(a={},r=e);const l=this.cursor(a);return this.W(l,r)}Y(e){const r=this.cursor({});return new $e((a,l)=>{r.onerror=u=>{const p=pG(u.target.error);l(p)},r.onsuccess=u=>{const p=u.target.result;p?e(p.primaryKey,p.value).next(m=>{m?p.continue():a()}):a()}})}W(e,r){const a=[];return new $e((l,u)=>{e.onerror=p=>{u(p.target.error)},e.onsuccess=p=>{const m=p.target.result;if(!m)return void l();const v=new YPe(m),w=r(m.primaryKey,m.value,v);if(w instanceof $e){const R=w.catch(C=>(v.done(),$e.reject(C)));a.push(R)}v.isDone?l():v.K===null?m.continue():m.continue(v.K)}}).next(()=>$e.waitFor(a))}options(e,r){let a;return e!==void 0&&(typeof e=="string"?a=e:r=e),{index:a,range:r}}cursor(e){let r="next";if(e.reverse&&(r="prev"),e.index){const a=this.store.index(e.index);return e.H?a.openKeyCursor(e.range,r):a.openCursor(e.range,r)}return this.store.openCursor(e.range,r)}}function ev(t){return new $e((e,r)=>{t.onsuccess=a=>{const l=a.target.result;e(l)},t.onerror=a=>{const l=pG(a.target.error);r(l)}})}let qne=!1;function pG(t){const e=Rf.S(vo());if(e>=12.2&&e<13){const r="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(r)>=0){const a=new Nt("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${r}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return qne||(qne=!0,setTimeout(()=>{throw a},0)),a}}return t}class XPe{constructor(e,r){this.asyncQueue=e,this.Z=r,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){Pt("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{Pt("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(r){f0(r)?Pt("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",r):await p0(r)}await this.X(6e4)})}}class JPe{constructor(e,r){this.localStore=e,this.persistence=r}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",r=>this.te(r,e))}te(e,r){const a=new Set;let l=r,u=!0;return $e.doWhile(()=>u===!0&&l>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(p=>{if(p!==null&&!a.has(p))return Pt("IndexBackfiller",`Processing collection: ${p}`),this.ne(e,p,l).next(m=>{l-=m,a.add(p)});u=!1})).next(()=>r-l)}ne(e,r,a){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,r).next(l=>this.localStore.localDocuments.getNextDocuments(e,r,l,a).next(u=>{const p=u.changes;return this.localStore.indexManager.updateIndexEntries(e,p).next(()=>this.re(l,u)).next(m=>(Pt("IndexBackfiller",`Updating offset: ${m}`),this.localStore.indexManager.updateCollectionGroup(e,r,m))).next(()=>p.size)}))}re(e,r){let a=e;return r.changes.forEach((l,u)=>{const p=fde(u);hG(p,a)>0&&(a=p)}),new Qd(a.readTime,a.documentKey,Math.max(r.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class od{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=a=>this.ie(a),this.se=a=>r.writeSequenceNumber(a))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}od.oe=-1;function JN(t){return t==null}function EN(t){return t===0&&1/t==-1/0}function yde(t){return typeof t=="number"&&Number.isInteger(t)&&!EN(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function il(t){let e="";for(let r=0;r<t.length;r++)e.length>0&&(e=Yne(e)),e=QPe(t.get(r),e);return Yne(e)}function QPe(t,e){let r=e;const a=t.length;for(let l=0;l<a;l++){const u=t.charAt(l);switch(u){case"\0":r+="";break;case"":r+="";break;default:r+=u}}return r}function Yne(t){return t+""}function Ef(t){const e=t.length;if(yn(e>=2),e===2)return yn(t.charAt(0)===""&&t.charAt(1)===""),li.emptyPath();const r=e-2,a=[];let l="";for(let u=0;u<e;){const p=t.indexOf("",u);switch((p<0||p>r)&&cn(),t.charAt(p+1)){case"":const m=t.substring(u,p);let v;l.length===0?v=m:(l+=m,v=l,l=""),a.push(v);break;case"":l+=t.substring(u,p),l+="\0";break;case"":l+=t.substring(u,p+1);break;default:cn()}u=p+2}return new li(a)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $ne=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uD(t,e){return[t,il(e)]}function vde(t,e,r){return[t,il(e),r]}const ZPe={},e2e=["prefixPath","collectionGroup","readTime","documentId"],t2e=["prefixPath","collectionGroup","documentId"],n2e=["collectionGroup","readTime","prefixPath","documentId"],r2e=["canonicalId","targetId"],i2e=["targetId","path"],s2e=["path","targetId"],a2e=["collectionId","parent"],o2e=["indexId","uid"],c2e=["uid","sequenceNumber"],l2e=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],d2e=["indexId","uid","orderedDocumentKey"],u2e=["userId","collectionPath","documentId"],h2e=["userId","collectionPath","largestBatchId"],p2e=["userId","collectionGroup","largestBatchId"],Ede=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],f2e=[...Ede,"documentOverlays"],xde=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],bde=xde,fG=[...bde,"indexConfiguration","indexState","indexEntries"],m2e=fG,g2e=[...fG,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G6 extends gde{constructor(e,r){super(),this._e=e,this.currentSequenceNumber=r}}function wo(t,e){const r=Wt(t);return Rf.F(r._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xne(t){let e=0;for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&e++;return e}function m0(t,e){for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&e(r,t[r])}function wde(t,e){const r=[];for(const a in t)Object.prototype.hasOwnProperty.call(t,a)&&r.push(e(t[a],a,t));return r}function Sde(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rs{constructor(e,r){this.comparator=e,this.root=r||Rc.EMPTY}insert(e,r){return new Rs(this.comparator,this.root.insert(e,r,this.comparator).copy(null,null,Rc.BLACK,null,null))}remove(e){return new Rs(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Rc.BLACK,null,null))}get(e){let r=this.root;for(;!r.isEmpty();){const a=this.comparator(e,r.key);if(a===0)return r.value;a<0?r=r.left:a>0&&(r=r.right)}return null}indexOf(e){let r=0,a=this.root;for(;!a.isEmpty();){const l=this.comparator(e,a.key);if(l===0)return r+a.left.size;l<0?a=a.left:(r+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((r,a)=>(e(r,a),!1))}toString(){const e=[];return this.inorderTraversal((r,a)=>(e.push(`${r}:${a}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new N2(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new N2(this.root,e,this.comparator,!1)}getReverseIterator(){return new N2(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new N2(this.root,e,this.comparator,!0)}}class N2{constructor(e,r,a,l){this.isReverse=l,this.nodeStack=[];let u=1;for(;!e.isEmpty();)if(u=r?a(e.key,r):1,r&&l&&(u*=-1),u<0)e=this.isReverse?e.left:e.right;else{if(u===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const r={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return r}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Rc{constructor(e,r,a,l,u){this.key=e,this.value=r,this.color=a??Rc.RED,this.left=l??Rc.EMPTY,this.right=u??Rc.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,r,a,l,u){return new Rc(e??this.key,r??this.value,a??this.color,l??this.left,u??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,r,a){let l=this;const u=a(e,l.key);return l=u<0?l.copy(null,null,null,l.left.insert(e,r,a),null):u===0?l.copy(null,r,null,null,null):l.copy(null,null,null,null,l.right.insert(e,r,a)),l.fixUp()}removeMin(){if(this.left.isEmpty())return Rc.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,r){let a,l=this;if(r(e,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(e,r),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),r(e,l.key)===0){if(l.right.isEmpty())return Rc.EMPTY;a=l.right.min(),l=l.copy(a.key,a.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(e,r))}return l.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Rc.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Rc.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,r)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw cn();const e=this.left.check();if(e!==this.right.check())throw cn();return e+(this.isRed()?0:1)}}Rc.EMPTY=null,Rc.RED=!0,Rc.BLACK=!1;Rc.EMPTY=new class{constructor(){this.size=0}get key(){throw cn()}get value(){throw cn()}get color(){throw cn()}get left(){throw cn()}get right(){throw cn()}copy(e,r,a,l,u){return this}insert(e,r,a){return new Rc(e,r)}remove(e,r){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class os{constructor(e){this.comparator=e,this.data=new Rs(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((r,a)=>(e(r),!1))}forEachInRange(e,r){const a=this.data.getIteratorFrom(e[0]);for(;a.hasNext();){const l=a.getNext();if(this.comparator(l.key,e[1])>=0)return;r(l.key)}}forEachWhile(e,r){let a;for(a=r!==void 0?this.data.getIteratorFrom(r):this.data.getIterator();a.hasNext();)if(!e(a.getNext().key))return}firstAfterOrEqual(e){const r=this.data.getIteratorFrom(e);return r.hasNext()?r.getNext().key:null}getIterator(){return new Jne(this.data.getIterator())}getIteratorFrom(e){return new Jne(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let r=this;return r.size<e.size&&(r=e,e=this),e.forEach(a=>{r=r.add(a)}),r}isEqual(e){if(!(e instanceof os)||this.size!==e.size)return!1;const r=this.data.getIterator(),a=e.data.getIterator();for(;r.hasNext();){const l=r.getNext().key,u=a.getNext().key;if(this.comparator(l,u)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(r=>{e.push(r)}),e}toString(){const e=[];return this.forEach(r=>e.push(r)),"SortedSet("+e.toString()+")"}copy(e){const r=new os(this.comparator);return r.data=e,r}}class Jne{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function tb(t){return t.hasNext()?t.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cd{constructor(e){this.fields=e,e.sort(Ms.comparator)}static empty(){return new cd([])}unionWith(e){let r=new os(Ms.comparator);for(const a of this.fields)r=r.add(a);for(const a of e)r=r.add(a);return new cd(r.toArray())}covers(e){for(const r of this.fields)if(r.isPrefixOf(e))return!0;return!1}isEqual(e){return rw(this.fields,e.fields,(r,a)=>r.isEqual(a))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tde extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _2e(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _a{constructor(e){this.binaryString=e}static fromBase64String(e){const r=function(l){try{return atob(l)}catch(u){throw typeof DOMException<"u"&&u instanceof DOMException?new Tde("Invalid base64 string: "+u):u}}(e);return new _a(r)}static fromUint8Array(e){const r=function(l){let u="";for(let p=0;p<l.length;++p)u+=String.fromCharCode(l[p]);return u}(e);return new _a(r)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(r){return btoa(r)}(this.binaryString)}toUint8Array(){return function(r){const a=new Uint8Array(r.length);for(let l=0;l<r.length;l++)a[l]=r.charCodeAt(l);return a}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ir(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}_a.EMPTY_BYTE_STRING=new _a("");const y2e=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function qm(t){if(yn(!!t),typeof t=="string"){let e=0;const r=y2e.exec(t);if(yn(!!r),r[1]){let l=r[1];l=(l+"000000000").substr(0,9),e=Number(l)}const a=new Date(t);return{seconds:Math.floor(a.getTime()/1e3),nanos:e}}return{seconds:Zs(t.seconds),nanos:Zs(t.nanos)}}function Zs(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Ym(t){return typeof t=="string"?_a.fromBase64String(t):_a.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _L(t){var e,r;return((r=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||r===void 0?void 0:r.stringValue)==="server_timestamp"}function yL(t){const e=t.mapValue.fields.__previous_value__;return _L(e)?yL(e):e}function xN(t){const e=qm(t.mapValue.fields.__local_write_time__.timestampValue);return new fn(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v2e{constructor(e,r,a,l,u,p,m,v,w){this.databaseId=e,this.appId=r,this.persistenceKey=a,this.host=l,this.ssl=u,this.forceLongPolling=p,this.autoDetectLongPolling=m,this.longPollingOptions=v,this.useFetchStreams=w}}class e0{constructor(e,r){this.projectId=e,this.database=r||"(default)"}static empty(){return new e0("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof e0&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A_={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},hD={nullValue:"NULL_VALUE"};function t0(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?_L(t)?4:Rde(t)?9007199254740991:vL(t)?10:11:cn()}function Af(t,e){if(t===e)return!0;const r=t0(t);if(r!==t0(e))return!1;switch(r){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return xN(t).isEqual(xN(e));case 3:return function(l,u){if(typeof l.timestampValue=="string"&&typeof u.timestampValue=="string"&&l.timestampValue.length===u.timestampValue.length)return l.timestampValue===u.timestampValue;const p=qm(l.timestampValue),m=qm(u.timestampValue);return p.seconds===m.seconds&&p.nanos===m.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(l,u){return Ym(l.bytesValue).isEqual(Ym(u.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(l,u){return Zs(l.geoPointValue.latitude)===Zs(u.geoPointValue.latitude)&&Zs(l.geoPointValue.longitude)===Zs(u.geoPointValue.longitude)}(t,e);case 2:return function(l,u){if("integerValue"in l&&"integerValue"in u)return Zs(l.integerValue)===Zs(u.integerValue);if("doubleValue"in l&&"doubleValue"in u){const p=Zs(l.doubleValue),m=Zs(u.doubleValue);return p===m?EN(p)===EN(m):isNaN(p)&&isNaN(m)}return!1}(t,e);case 9:return rw(t.arrayValue.values||[],e.arrayValue.values||[],Af);case 10:case 11:return function(l,u){const p=l.mapValue.fields||{},m=u.mapValue.fields||{};if(Xne(p)!==Xne(m))return!1;for(const v in p)if(p.hasOwnProperty(v)&&(m[v]===void 0||!Af(p[v],m[v])))return!1;return!0}(t,e);default:return cn()}}function bN(t,e){return(t.values||[]).find(r=>Af(r,e))!==void 0}function n0(t,e){if(t===e)return 0;const r=t0(t),a=t0(e);if(r!==a)return ir(r,a);switch(r){case 0:case 9007199254740991:return 0;case 1:return ir(t.booleanValue,e.booleanValue);case 2:return function(u,p){const m=Zs(u.integerValue||u.doubleValue),v=Zs(p.integerValue||p.doubleValue);return m<v?-1:m>v?1:m===v?0:isNaN(m)?isNaN(v)?0:-1:1}(t,e);case 3:return Qne(t.timestampValue,e.timestampValue);case 4:return Qne(xN(t),xN(e));case 5:return ir(t.stringValue,e.stringValue);case 6:return function(u,p){const m=Ym(u),v=Ym(p);return m.compareTo(v)}(t.bytesValue,e.bytesValue);case 7:return function(u,p){const m=u.split("/"),v=p.split("/");for(let w=0;w<m.length&&w<v.length;w++){const R=ir(m[w],v[w]);if(R!==0)return R}return ir(m.length,v.length)}(t.referenceValue,e.referenceValue);case 8:return function(u,p){const m=ir(Zs(u.latitude),Zs(p.latitude));return m!==0?m:ir(Zs(u.longitude),Zs(p.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return Zne(t.arrayValue,e.arrayValue);case 10:return function(u,p){var m,v,w,R;const C=u.fields||{},A=p.fields||{},O=(m=C.value)===null||m===void 0?void 0:m.arrayValue,U=(v=A.value)===null||v===void 0?void 0:v.arrayValue,F=ir(((w=O==null?void 0:O.values)===null||w===void 0?void 0:w.length)||0,((R=U==null?void 0:U.values)===null||R===void 0?void 0:R.length)||0);return F!==0?F:Zne(O,U)}(t.mapValue,e.mapValue);case 11:return function(u,p){if(u===A_.mapValue&&p===A_.mapValue)return 0;if(u===A_.mapValue)return 1;if(p===A_.mapValue)return-1;const m=u.fields||{},v=Object.keys(m),w=p.fields||{},R=Object.keys(w);v.sort(),R.sort();for(let C=0;C<v.length&&C<R.length;++C){const A=ir(v[C],R[C]);if(A!==0)return A;const O=n0(m[v[C]],w[R[C]]);if(O!==0)return O}return ir(v.length,R.length)}(t.mapValue,e.mapValue);default:throw cn()}}function Qne(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return ir(t,e);const r=qm(t),a=qm(e),l=ir(r.seconds,a.seconds);return l!==0?l:ir(r.nanos,a.nanos)}function Zne(t,e){const r=t.values||[],a=e.values||[];for(let l=0;l<r.length&&l<a.length;++l){const u=n0(r[l],a[l]);if(u)return u}return ir(r.length,a.length)}function aw(t){return W6(t)}function W6(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(r){const a=qm(r);return`time(${a.seconds},${a.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(r){return Ym(r).toBase64()}(t.bytesValue):"referenceValue"in t?function(r){return Kt.fromName(r).toString()}(t.referenceValue):"geoPointValue"in t?function(r){return`geo(${r.latitude},${r.longitude})`}(t.geoPointValue):"arrayValue"in t?function(r){let a="[",l=!0;for(const u of r.values||[])l?l=!1:a+=",",a+=W6(u);return a+"]"}(t.arrayValue):"mapValue"in t?function(r){const a=Object.keys(r.fields||{}).sort();let l="{",u=!0;for(const p of a)u?u=!1:l+=",",l+=`${p}:${W6(r.fields[p])}`;return l+"}"}(t.mapValue):cn()}function pD(t){switch(t0(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=yL(t);return e?16+pD(e):16;case 5:return 2*t.stringValue.length;case 6:return Ym(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(a){return(a.values||[]).reduce((l,u)=>l+pD(u),0)}(t.arrayValue);case 10:case 11:return function(a){let l=0;return m0(a.fields,(u,p)=>{l+=u.length+pD(p)}),l}(t.mapValue);default:throw cn()}}function Rv(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function H6(t){return!!t&&"integerValue"in t}function wN(t){return!!t&&"arrayValue"in t}function ere(t){return!!t&&"nullValue"in t}function tre(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function fD(t){return!!t&&"mapValue"in t}function vL(t){var e,r;return((r=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||r===void 0?void 0:r.stringValue)==="__vector__"}function OC(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return m0(t.mapValue.fields,(r,a)=>e.mapValue.fields[r]=OC(a)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let r=0;r<(t.arrayValue.values||[]).length;++r)e.arrayValue.values[r]=OC(t.arrayValue.values[r]);return e}return Object.assign({},t)}function Rde(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const Cde={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function E2e(t){return"nullValue"in t?hD:"booleanValue"in t?{booleanValue:!1}:"integerValue"in t||"doubleValue"in t?{doubleValue:NaN}:"timestampValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in t?{stringValue:""}:"bytesValue"in t?{bytesValue:""}:"referenceValue"in t?Rv(e0.empty(),Kt.empty()):"geoPointValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in t?{arrayValue:{}}:"mapValue"in t?vL(t)?Cde:{mapValue:{}}:cn()}function x2e(t){return"nullValue"in t?{booleanValue:!1}:"booleanValue"in t?{doubleValue:NaN}:"integerValue"in t||"doubleValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in t?{stringValue:""}:"stringValue"in t?{bytesValue:""}:"bytesValue"in t?Rv(e0.empty(),Kt.empty()):"referenceValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in t?{arrayValue:{}}:"arrayValue"in t?Cde:"mapValue"in t?vL(t)?{mapValue:{}}:A_:cn()}function nre(t,e){const r=n0(t.value,e.value);return r!==0?r:t.inclusive&&!e.inclusive?-1:!t.inclusive&&e.inclusive?1:0}function rre(t,e){const r=n0(t.value,e.value);return r!==0?r:t.inclusive&&!e.inclusive?1:!t.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cc{constructor(e){this.value=e}static empty(){return new Cc({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let r=this.value;for(let a=0;a<e.length-1;++a)if(r=(r.mapValue.fields||{})[e.get(a)],!fD(r))return null;return r=(r.mapValue.fields||{})[e.lastSegment()],r||null}}set(e,r){this.getFieldsMap(e.popLast())[e.lastSegment()]=OC(r)}setAll(e){let r=Ms.emptyPath(),a={},l=[];e.forEach((p,m)=>{if(!r.isImmediateParentOf(m)){const v=this.getFieldsMap(r);this.applyChanges(v,a,l),a={},l=[],r=m.popLast()}p?a[m.lastSegment()]=OC(p):l.push(m.lastSegment())});const u=this.getFieldsMap(r);this.applyChanges(u,a,l)}delete(e){const r=this.field(e.popLast());fD(r)&&r.mapValue.fields&&delete r.mapValue.fields[e.lastSegment()]}isEqual(e){return Af(this.value,e.value)}getFieldsMap(e){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let a=0;a<e.length;++a){let l=r.mapValue.fields[e.get(a)];fD(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},r.mapValue.fields[e.get(a)]=l),r=l}return r.mapValue.fields}applyChanges(e,r,a){m0(r,(l,u)=>e[l]=u);for(const l of a)delete e[l]}clone(){return new Cc(OC(this.value))}}function Nde(t){const e=[];return m0(t.fields,(r,a)=>{const l=new Ms([r]);if(fD(a)){const u=Nde(a.mapValue).fields;if(u.length===0)e.push(l);else for(const p of u)e.push(l.child(p))}else e.push(l)}),new cd(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class js{constructor(e,r,a,l,u,p,m){this.key=e,this.documentType=r,this.version=a,this.readTime=l,this.createTime=u,this.data=p,this.documentState=m}static newInvalidDocument(e){return new js(e,0,Sn.min(),Sn.min(),Sn.min(),Cc.empty(),0)}static newFoundDocument(e,r,a,l){return new js(e,1,r,Sn.min(),a,l,0)}static newNoDocument(e,r){return new js(e,2,r,Sn.min(),Sn.min(),Cc.empty(),0)}static newUnknownDocument(e,r){return new js(e,3,r,Sn.min(),Sn.min(),Cc.empty(),2)}convertToFoundDocument(e,r){return!this.createTime.isEqual(Sn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=r,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Cc.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Cc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Sn.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof js&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new js(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r0{constructor(e,r){this.position=e,this.inclusive=r}}function ire(t,e,r){let a=0;for(let l=0;l<t.position.length;l++){const u=e[l],p=t.position[l];if(u.field.isKeyField()?a=Kt.comparator(Kt.fromName(p.referenceValue),r.key):a=n0(p,r.data.field(u.field)),u.dir==="desc"&&(a*=-1),a!==0)break}return a}function sre(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let r=0;r<t.position.length;r++)if(!Af(t.position[r],e.position[r]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SN{constructor(e,r="asc"){this.field=e,this.dir=r}}function b2e(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ide{}class di extends Ide{constructor(e,r,a){super(),this.field=e,this.op=r,this.value=a}static create(e,r,a){return e.isKeyField()?r==="in"||r==="not-in"?this.createKeyFieldInFilter(e,r,a):new w2e(e,r,a):r==="array-contains"?new R2e(e,a):r==="in"?new Lde(e,a):r==="not-in"?new C2e(e,a):r==="array-contains-any"?new N2e(e,a):new di(e,r,a)}static createKeyFieldInFilter(e,r,a){return r==="in"?new S2e(e,a):new T2e(e,a)}matches(e){const r=e.data.field(this.field);return this.op==="!="?r!==null&&this.matchesComparison(n0(r,this.value)):r!==null&&t0(this.value)===t0(r)&&this.matchesComparison(n0(r,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return cn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class $i extends Ide{constructor(e,r){super(),this.filters=e,this.op=r,this.ae=null}static create(e,r){return new $i(e,r)}matches(e){return ow(this)?this.filters.find(r=>!r.matches(e))===void 0:this.filters.find(r=>r.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,r)=>e.concat(r.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function ow(t){return t.op==="and"}function K6(t){return t.op==="or"}function mG(t){return Ade(t)&&ow(t)}function Ade(t){for(const e of t.filters)if(e instanceof $i)return!1;return!0}function q6(t){if(t instanceof di)return t.field.canonicalString()+t.op.toString()+aw(t.value);if(mG(t))return t.filters.map(e=>q6(e)).join(",");{const e=t.filters.map(r=>q6(r)).join(",");return`${t.op}(${e})`}}function kde(t,e){return t instanceof di?function(a,l){return l instanceof di&&a.op===l.op&&a.field.isEqual(l.field)&&Af(a.value,l.value)}(t,e):t instanceof $i?function(a,l){return l instanceof $i&&a.op===l.op&&a.filters.length===l.filters.length?a.filters.reduce((u,p,m)=>u&&kde(p,l.filters[m]),!0):!1}(t,e):void cn()}function Pde(t,e){const r=t.filters.concat(e);return $i.create(r,t.op)}function Dde(t){return t instanceof di?function(r){return`${r.field.canonicalString()} ${r.op} ${aw(r.value)}`}(t):t instanceof $i?function(r){return r.op.toString()+" {"+r.getFilters().map(Dde).join(" ,")+"}"}(t):"Filter"}class w2e extends di{constructor(e,r,a){super(e,r,a),this.key=Kt.fromName(a.referenceValue)}matches(e){const r=Kt.comparator(e.key,this.key);return this.matchesComparison(r)}}class S2e extends di{constructor(e,r){super(e,"in",r),this.keys=Ode("in",r)}matches(e){return this.keys.some(r=>r.isEqual(e.key))}}class T2e extends di{constructor(e,r){super(e,"not-in",r),this.keys=Ode("not-in",r)}matches(e){return!this.keys.some(r=>r.isEqual(e.key))}}function Ode(t,e){var r;return(((r=e.arrayValue)===null||r===void 0?void 0:r.values)||[]).map(a=>Kt.fromName(a.referenceValue))}class R2e extends di{constructor(e,r){super(e,"array-contains",r)}matches(e){const r=e.data.field(this.field);return wN(r)&&bN(r.arrayValue,this.value)}}class Lde extends di{constructor(e,r){super(e,"in",r)}matches(e){const r=e.data.field(this.field);return r!==null&&bN(this.value.arrayValue,r)}}class C2e extends di{constructor(e,r){super(e,"not-in",r)}matches(e){if(bN(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const r=e.data.field(this.field);return r!==null&&!bN(this.value.arrayValue,r)}}class N2e extends di{constructor(e,r){super(e,"array-contains-any",r)}matches(e){const r=e.data.field(this.field);return!(!wN(r)||!r.arrayValue.values)&&r.arrayValue.values.some(a=>bN(this.value.arrayValue,a))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I2e{constructor(e,r=null,a=[],l=[],u=null,p=null,m=null){this.path=e,this.collectionGroup=r,this.orderBy=a,this.filters=l,this.limit=u,this.startAt=p,this.endAt=m,this.ue=null}}function Y6(t,e=null,r=[],a=[],l=null,u=null,p=null){return new I2e(t,e,r,a,l,u,p)}function Cv(t){const e=Wt(t);if(e.ue===null){let r=e.path.canonicalString();e.collectionGroup!==null&&(r+="|cg:"+e.collectionGroup),r+="|f:",r+=e.filters.map(a=>q6(a)).join(","),r+="|ob:",r+=e.orderBy.map(a=>function(u){return u.field.canonicalString()+u.dir}(a)).join(","),JN(e.limit)||(r+="|l:",r+=e.limit),e.startAt&&(r+="|lb:",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(a=>aw(a)).join(",")),e.endAt&&(r+="|ub:",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(a=>aw(a)).join(",")),e.ue=r}return e.ue}function QN(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let r=0;r<t.orderBy.length;r++)if(!b2e(t.orderBy[r],e.orderBy[r]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let r=0;r<t.filters.length;r++)if(!kde(t.filters[r],e.filters[r]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!sre(t.startAt,e.startAt)&&sre(t.endAt,e.endAt)}function rO(t){return Kt.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}function iO(t,e){return t.filters.filter(r=>r instanceof di&&r.field.isEqual(e))}function are(t,e,r){let a=hD,l=!0;for(const u of iO(t,e)){let p=hD,m=!0;switch(u.op){case"<":case"<=":p=E2e(u.value);break;case"==":case"in":case">=":p=u.value;break;case">":p=u.value,m=!1;break;case"!=":case"not-in":p=hD}nre({value:a,inclusive:l},{value:p,inclusive:m})<0&&(a=p,l=m)}if(r!==null){for(let u=0;u<t.orderBy.length;++u)if(t.orderBy[u].field.isEqual(e)){const p=r.position[u];nre({value:a,inclusive:l},{value:p,inclusive:r.inclusive})<0&&(a=p,l=r.inclusive);break}}return{value:a,inclusive:l}}function ore(t,e,r){let a=A_,l=!0;for(const u of iO(t,e)){let p=A_,m=!0;switch(u.op){case">=":case">":p=x2e(u.value),m=!1;break;case"==":case"in":case"<=":p=u.value;break;case"<":p=u.value,m=!1;break;case"!=":case"not-in":p=A_}rre({value:a,inclusive:l},{value:p,inclusive:m})>0&&(a=p,l=m)}if(r!==null){for(let u=0;u<t.orderBy.length;++u)if(t.orderBy[u].field.isEqual(e)){const p=r.position[u];rre({value:a,inclusive:l},{value:p,inclusive:r.inclusive})>0&&(a=p,l=r.inclusive);break}}return{value:a,inclusive:l}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ng{constructor(e,r=null,a=[],l=[],u=null,p="F",m=null,v=null){this.path=e,this.collectionGroup=r,this.explicitOrderBy=a,this.filters=l,this.limit=u,this.limitType=p,this.startAt=m,this.endAt=v,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function jde(t,e,r,a,l,u,p,m){return new ng(t,e,r,a,l,u,p,m)}function Vw(t){return new ng(t)}function cre(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function gG(t){return t.collectionGroup!==null}function Gb(t){const e=Wt(t);if(e.ce===null){e.ce=[];const r=new Set;for(const u of e.explicitOrderBy)e.ce.push(u),r.add(u.field.canonicalString());const a=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(p){let m=new os(Ms.comparator);return p.filters.forEach(v=>{v.getFlattenedFilters().forEach(w=>{w.isInequality()&&(m=m.add(w.field))})}),m})(e).forEach(u=>{r.has(u.canonicalString())||u.isKeyField()||e.ce.push(new SN(u,a))}),r.has(Ms.keyField().canonicalString())||e.ce.push(new SN(Ms.keyField(),a))}return e.ce}function sl(t){const e=Wt(t);return e.le||(e.le=Ude(e,Gb(t))),e.le}function Mde(t){const e=Wt(t);return e.he||(e.he=Ude(e,t.explicitOrderBy)),e.he}function Ude(t,e){if(t.limitType==="F")return Y6(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(l=>{const u=l.dir==="desc"?"asc":"desc";return new SN(l.field,u)});const r=t.endAt?new r0(t.endAt.position,t.endAt.inclusive):null,a=t.startAt?new r0(t.startAt.position,t.startAt.inclusive):null;return Y6(t.path,t.collectionGroup,e,t.filters,t.limit,r,a)}}function $6(t,e){const r=t.filters.concat([e]);return new ng(t.path,t.collectionGroup,t.explicitOrderBy.slice(),r,t.limit,t.limitType,t.startAt,t.endAt)}function sO(t,e,r){return new ng(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,r,t.startAt,t.endAt)}function ZN(t,e){return QN(sl(t),sl(e))&&t.limitType===e.limitType}function Vde(t){return`${Cv(sl(t))}|lt:${t.limitType}`}function ub(t){return`Query(target=${function(r){let a=r.path.canonicalString();return r.collectionGroup!==null&&(a+=" collectionGroup="+r.collectionGroup),r.filters.length>0&&(a+=`, filters: [${r.filters.map(l=>Dde(l)).join(", ")}]`),JN(r.limit)||(a+=", limit: "+r.limit),r.orderBy.length>0&&(a+=`, orderBy: [${r.orderBy.map(l=>function(p){return`${p.field.canonicalString()} (${p.dir})`}(l)).join(", ")}]`),r.startAt&&(a+=", startAt: ",a+=r.startAt.inclusive?"b:":"a:",a+=r.startAt.position.map(l=>aw(l)).join(",")),r.endAt&&(a+=", endAt: ",a+=r.endAt.inclusive?"a:":"b:",a+=r.endAt.position.map(l=>aw(l)).join(",")),`Target(${a})`}(sl(t))}; limitType=${t.limitType})`}function eI(t,e){return e.isFoundDocument()&&function(a,l){const u=l.key.path;return a.collectionGroup!==null?l.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(u):Kt.isDocumentKey(a.path)?a.path.isEqual(u):a.path.isImmediateParentOf(u)}(t,e)&&function(a,l){for(const u of Gb(a))if(!u.field.isKeyField()&&l.data.field(u.field)===null)return!1;return!0}(t,e)&&function(a,l){for(const u of a.filters)if(!u.matches(l))return!1;return!0}(t,e)&&function(a,l){return!(a.startAt&&!function(p,m,v){const w=ire(p,m,v);return p.inclusive?w<=0:w<0}(a.startAt,Gb(a),l)||a.endAt&&!function(p,m,v){const w=ire(p,m,v);return p.inclusive?w>=0:w>0}(a.endAt,Gb(a),l))}(t,e)}function Fde(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function Bde(t){return(e,r)=>{let a=!1;for(const l of Gb(t)){const u=A2e(l,e,r);if(u!==0)return u;a=a||l.field.isKeyField()}return 0}}function A2e(t,e,r){const a=t.field.isKeyField()?Kt.comparator(e.key,r.key):function(u,p,m){const v=p.data.field(u),w=m.data.field(u);return v!==null&&w!==null?n0(v,w):cn()}(t.field,e,r);switch(t.dir){case"asc":return a;case"desc":return-1*a;default:return cn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rg{constructor(e,r){this.mapKeyFn=e,this.equalsFn=r,this.inner={},this.innerSize=0}get(e){const r=this.mapKeyFn(e),a=this.inner[r];if(a!==void 0){for(const[l,u]of a)if(this.equalsFn(l,e))return u}}has(e){return this.get(e)!==void 0}set(e,r){const a=this.mapKeyFn(e),l=this.inner[a];if(l===void 0)return this.inner[a]=[[e,r]],void this.innerSize++;for(let u=0;u<l.length;u++)if(this.equalsFn(l[u][0],e))return void(l[u]=[e,r]);l.push([e,r]),this.innerSize++}delete(e){const r=this.mapKeyFn(e),a=this.inner[r];if(a===void 0)return!1;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],e))return a.length===1?delete this.inner[r]:a.splice(l,1),this.innerSize--,!0;return!1}forEach(e){m0(this.inner,(r,a)=>{for(const[l,u]of a)e(l,u)})}isEmpty(){return Sde(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k2e=new Rs(Kt.comparator);function ld(){return k2e}const zde=new Rs(Kt.comparator);function fC(...t){let e=zde;for(const r of t)e=e.insert(r.key,r);return e}function Gde(t){let e=zde;return t.forEach((r,a)=>e=e.insert(r,a.overlayedDocument)),e}function xf(){return LC()}function Wde(){return LC()}function LC(){return new rg(t=>t.toString(),(t,e)=>t.isEqual(e))}const P2e=new Rs(Kt.comparator),D2e=new os(Kt.comparator);function Nr(...t){let e=D2e;for(const r of t)e=e.add(r);return e}const O2e=new os(ir);function _G(){return O2e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yG(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:EN(e)?"-0":e}}function Hde(t){return{integerValue:""+t}}function Kde(t,e){return yde(e)?Hde(e):yG(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EL{constructor(){this._=void 0}}function L2e(t,e,r){return t instanceof cw?function(l,u){const p={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return u&&_L(u)&&(u=yL(u)),u&&(p.fields.__previous_value__=u),{mapValue:p}}(r,e):t instanceof Nv?Yde(t,e):t instanceof Iv?$de(t,e):function(l,u){const p=qde(l,u),m=lre(p)+lre(l.Pe);return H6(p)&&H6(l.Pe)?Hde(m):yG(l.serializer,m)}(t,e)}function j2e(t,e,r){return t instanceof Nv?Yde(t,e):t instanceof Iv?$de(t,e):r}function qde(t,e){return t instanceof lw?function(a){return H6(a)||function(u){return!!u&&"doubleValue"in u}(a)}(e)?e:{integerValue:0}:null}class cw extends EL{}class Nv extends EL{constructor(e){super(),this.elements=e}}function Yde(t,e){const r=Xde(e);for(const a of t.elements)r.some(l=>Af(l,a))||r.push(a);return{arrayValue:{values:r}}}class Iv extends EL{constructor(e){super(),this.elements=e}}function $de(t,e){let r=Xde(e);for(const a of t.elements)r=r.filter(l=>!Af(l,a));return{arrayValue:{values:r}}}class lw extends EL{constructor(e,r){super(),this.serializer=e,this.Pe=r}}function lre(t){return Zs(t.integerValue||t.doubleValue)}function Xde(t){return wN(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tI{constructor(e,r){this.field=e,this.transform=r}}function M2e(t,e){return t.field.isEqual(e.field)&&function(a,l){return a instanceof Nv&&l instanceof Nv||a instanceof Iv&&l instanceof Iv?rw(a.elements,l.elements,Af):a instanceof lw&&l instanceof lw?Af(a.Pe,l.Pe):a instanceof cw&&l instanceof cw}(t.transform,e.transform)}class U2e{constructor(e,r){this.version=e,this.transformResults=r}}class ta{constructor(e,r){this.updateTime=e,this.exists=r}static none(){return new ta}static exists(e){return new ta(void 0,e)}static updateTime(e){return new ta(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function mD(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class xL{}function Jde(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new Bw(t.key,ta.none()):new Fw(t.key,t.data,ta.none());{const r=t.data,a=Cc.empty();let l=new os(Ms.comparator);for(let u of e.fields)if(!l.has(u)){let p=r.field(u);p===null&&u.length>1&&(u=u.popLast(),p=r.field(u)),p===null?a.delete(u):a.set(u,p),l=l.add(u)}return new ig(t.key,a,new cd(l.toArray()),ta.none())}}function V2e(t,e,r){t instanceof Fw?function(l,u,p){const m=l.value.clone(),v=ure(l.fieldTransforms,u,p.transformResults);m.setAll(v),u.convertToFoundDocument(p.version,m).setHasCommittedMutations()}(t,e,r):t instanceof ig?function(l,u,p){if(!mD(l.precondition,u))return void u.convertToUnknownDocument(p.version);const m=ure(l.fieldTransforms,u,p.transformResults),v=u.data;v.setAll(Qde(l)),v.setAll(m),u.convertToFoundDocument(p.version,v).setHasCommittedMutations()}(t,e,r):function(l,u,p){u.convertToNoDocument(p.version).setHasCommittedMutations()}(0,e,r)}function jC(t,e,r,a){return t instanceof Fw?function(u,p,m,v){if(!mD(u.precondition,p))return m;const w=u.value.clone(),R=hre(u.fieldTransforms,v,p);return w.setAll(R),p.convertToFoundDocument(p.version,w).setHasLocalMutations(),null}(t,e,r,a):t instanceof ig?function(u,p,m,v){if(!mD(u.precondition,p))return m;const w=hre(u.fieldTransforms,v,p),R=p.data;return R.setAll(Qde(u)),R.setAll(w),p.convertToFoundDocument(p.version,R).setHasLocalMutations(),m===null?null:m.unionWith(u.fieldMask.fields).unionWith(u.fieldTransforms.map(C=>C.field))}(t,e,r,a):function(u,p,m){return mD(u.precondition,p)?(p.convertToNoDocument(p.version).setHasLocalMutations(),null):m}(t,e,r)}function F2e(t,e){let r=null;for(const a of t.fieldTransforms){const l=e.data.field(a.field),u=qde(a.transform,l||null);u!=null&&(r===null&&(r=Cc.empty()),r.set(a.field,u))}return r||null}function dre(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(a,l){return a===void 0&&l===void 0||!(!a||!l)&&rw(a,l,(u,p)=>M2e(u,p))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Fw extends xL{constructor(e,r,a,l=[]){super(),this.key=e,this.value=r,this.precondition=a,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class ig extends xL{constructor(e,r,a,l,u=[]){super(),this.key=e,this.data=r,this.fieldMask=a,this.precondition=l,this.fieldTransforms=u,this.type=1}getFieldMask(){return this.fieldMask}}function Qde(t){const e=new Map;return t.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){const a=t.data.field(r);e.set(r,a)}}),e}function ure(t,e,r){const a=new Map;yn(t.length===r.length);for(let l=0;l<r.length;l++){const u=t[l],p=u.transform,m=e.data.field(u.field);a.set(u.field,j2e(p,m,r[l]))}return a}function hre(t,e,r){const a=new Map;for(const l of t){const u=l.transform,p=r.data.field(l.field);a.set(l.field,L2e(u,p,e))}return a}class Bw extends xL{constructor(e,r){super(),this.key=e,this.precondition=r,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class vG extends xL{constructor(e,r){super(),this.key=e,this.precondition=r,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EG{constructor(e,r,a,l){this.batchId=e,this.localWriteTime=r,this.baseMutations=a,this.mutations=l}applyToRemoteDocument(e,r){const a=r.mutationResults;for(let l=0;l<this.mutations.length;l++){const u=this.mutations[l];u.key.isEqual(e.key)&&V2e(u,e,a[l])}}applyToLocalView(e,r){for(const a of this.baseMutations)a.key.isEqual(e.key)&&(r=jC(a,e,r,this.localWriteTime));for(const a of this.mutations)a.key.isEqual(e.key)&&(r=jC(a,e,r,this.localWriteTime));return r}applyToLocalDocumentSet(e,r){const a=Wde();return this.mutations.forEach(l=>{const u=e.get(l.key),p=u.overlayedDocument;let m=this.applyToLocalView(p,u.mutatedFields);m=r.has(l.key)?null:m;const v=Jde(p,m);v!==null&&a.set(l.key,v),p.isValidDocument()||p.convertToNoDocument(Sn.min())}),a}keys(){return this.mutations.reduce((e,r)=>e.add(r.key),Nr())}isEqual(e){return this.batchId===e.batchId&&rw(this.mutations,e.mutations,(r,a)=>dre(r,a))&&rw(this.baseMutations,e.baseMutations,(r,a)=>dre(r,a))}}class xG{constructor(e,r,a,l){this.batch=e,this.commitVersion=r,this.mutationResults=a,this.docVersions=l}static from(e,r,a){yn(e.mutations.length===a.length);let l=function(){return P2e}();const u=e.mutations;for(let p=0;p<u.length;p++)l=l.insert(u[p].key,a[p].version);return new xG(e,r,a,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bG{constructor(e,r){this.largestBatchId=e,this.mutation=r}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zde{constructor(e,r,a){this.alias=e,this.aggregateType=r,this.fieldPath=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B2e{constructor(e,r){this.count=e,this.unchangedNames=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ja,vi;function eue(t){switch(t){default:return cn();case ot.CANCELLED:case ot.UNKNOWN:case ot.DEADLINE_EXCEEDED:case ot.RESOURCE_EXHAUSTED:case ot.INTERNAL:case ot.UNAVAILABLE:case ot.UNAUTHENTICATED:return!1;case ot.INVALID_ARGUMENT:case ot.NOT_FOUND:case ot.ALREADY_EXISTS:case ot.PERMISSION_DENIED:case ot.FAILED_PRECONDITION:case ot.ABORTED:case ot.OUT_OF_RANGE:case ot.UNIMPLEMENTED:case ot.DATA_LOSS:return!0}}function tue(t){if(t===void 0)return Ma("GRPC error has no .code"),ot.UNKNOWN;switch(t){case Ja.OK:return ot.OK;case Ja.CANCELLED:return ot.CANCELLED;case Ja.UNKNOWN:return ot.UNKNOWN;case Ja.DEADLINE_EXCEEDED:return ot.DEADLINE_EXCEEDED;case Ja.RESOURCE_EXHAUSTED:return ot.RESOURCE_EXHAUSTED;case Ja.INTERNAL:return ot.INTERNAL;case Ja.UNAVAILABLE:return ot.UNAVAILABLE;case Ja.UNAUTHENTICATED:return ot.UNAUTHENTICATED;case Ja.INVALID_ARGUMENT:return ot.INVALID_ARGUMENT;case Ja.NOT_FOUND:return ot.NOT_FOUND;case Ja.ALREADY_EXISTS:return ot.ALREADY_EXISTS;case Ja.PERMISSION_DENIED:return ot.PERMISSION_DENIED;case Ja.FAILED_PRECONDITION:return ot.FAILED_PRECONDITION;case Ja.ABORTED:return ot.ABORTED;case Ja.OUT_OF_RANGE:return ot.OUT_OF_RANGE;case Ja.UNIMPLEMENTED:return ot.UNIMPLEMENTED;case Ja.DATA_LOSS:return ot.DATA_LOSS;default:return cn()}}(vi=Ja||(Ja={}))[vi.OK=0]="OK",vi[vi.CANCELLED=1]="CANCELLED",vi[vi.UNKNOWN=2]="UNKNOWN",vi[vi.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",vi[vi.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",vi[vi.NOT_FOUND=5]="NOT_FOUND",vi[vi.ALREADY_EXISTS=6]="ALREADY_EXISTS",vi[vi.PERMISSION_DENIED=7]="PERMISSION_DENIED",vi[vi.UNAUTHENTICATED=16]="UNAUTHENTICATED",vi[vi.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",vi[vi.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",vi[vi.ABORTED=10]="ABORTED",vi[vi.OUT_OF_RANGE=11]="OUT_OF_RANGE",vi[vi.UNIMPLEMENTED=12]="UNIMPLEMENTED",vi[vi.INTERNAL=13]="INTERNAL",vi[vi.UNAVAILABLE=14]="UNAVAILABLE",vi[vi.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let aO=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nue(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z2e=new pv([4294967295,4294967295],0);function pre(t){const e=nue().encode(t),r=new rde;return r.update(e),new Uint8Array(r.digest())}function fre(t){const e=new DataView(t.buffer),r=e.getUint32(0,!0),a=e.getUint32(4,!0),l=e.getUint32(8,!0),u=e.getUint32(12,!0);return[new pv([r,a],0),new pv([l,u],0)]}class wG{constructor(e,r,a){if(this.bitmap=e,this.padding=r,this.hashCount=a,r<0||r>=8)throw new mC(`Invalid padding: ${r}`);if(a<0)throw new mC(`Invalid hash count: ${a}`);if(e.length>0&&this.hashCount===0)throw new mC(`Invalid hash count: ${a}`);if(e.length===0&&r!==0)throw new mC(`Invalid padding when bitmap length is 0: ${r}`);this.Ie=8*e.length-r,this.Te=pv.fromNumber(this.Ie)}Ee(e,r,a){let l=e.add(r.multiply(pv.fromNumber(a)));return l.compare(z2e)===1&&(l=new pv([l.getBits(0),l.getBits(1)],0)),l.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const r=pre(e),[a,l]=fre(r);for(let u=0;u<this.hashCount;u++){const p=this.Ee(a,l,u);if(!this.de(p))return!1}return!0}static create(e,r,a){const l=e%8==0?0:8-e%8,u=new Uint8Array(Math.ceil(e/8)),p=new wG(u,l,r);return a.forEach(m=>p.insert(m)),p}insert(e){if(this.Ie===0)return;const r=pre(e),[a,l]=fre(r);for(let u=0;u<this.hashCount;u++){const p=this.Ee(a,l,u);this.Ae(p)}}Ae(e){const r=Math.floor(e/8),a=e%8;this.bitmap[r]|=1<<a}}class mC extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nI{constructor(e,r,a,l,u){this.snapshotVersion=e,this.targetChanges=r,this.targetMismatches=a,this.documentUpdates=l,this.resolvedLimboDocuments=u}static createSynthesizedRemoteEventForCurrentChange(e,r,a){const l=new Map;return l.set(e,rI.createSynthesizedTargetChangeForCurrentChange(e,r,a)),new nI(Sn.min(),l,new Rs(ir),ld(),Nr())}}class rI{constructor(e,r,a,l,u){this.resumeToken=e,this.current=r,this.addedDocuments=a,this.modifiedDocuments=l,this.removedDocuments=u}static createSynthesizedTargetChangeForCurrentChange(e,r,a){return new rI(a,r,Nr(),Nr(),Nr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gD{constructor(e,r,a,l){this.Re=e,this.removedTargetIds=r,this.key=a,this.Ve=l}}class rue{constructor(e,r){this.targetId=e,this.me=r}}class iue{constructor(e,r,a=_a.EMPTY_BYTE_STRING,l=null){this.state=e,this.targetIds=r,this.resumeToken=a,this.cause=l}}class mre{constructor(){this.fe=0,this.ge=_re(),this.pe=_a.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Nr(),r=Nr(),a=Nr();return this.ge.forEach((l,u)=>{switch(u){case 0:e=e.add(l);break;case 2:r=r.add(l);break;case 1:a=a.add(l);break;default:cn()}}),new rI(this.pe,this.ye,e,r,a)}Ce(){this.we=!1,this.ge=_re()}Fe(e,r){this.we=!0,this.ge=this.ge.insert(e,r)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,yn(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class G2e{constructor(e){this.Le=e,this.Be=new Map,this.ke=ld(),this.qe=gre(),this.Qe=new Rs(ir)}Ke(e){for(const r of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(r,e.Ve):this.Ue(r,e.key,e.Ve);for(const r of e.removedTargetIds)this.Ue(r,e.key,e.Ve)}We(e){this.forEachTarget(e,r=>{const a=this.Ge(r);switch(e.state){case 0:this.ze(r)&&a.De(e.resumeToken);break;case 1:a.Oe(),a.Se||a.Ce(),a.De(e.resumeToken);break;case 2:a.Oe(),a.Se||this.removeTarget(r);break;case 3:this.ze(r)&&(a.Ne(),a.De(e.resumeToken));break;case 4:this.ze(r)&&(this.je(r),a.De(e.resumeToken));break;default:cn()}})}forEachTarget(e,r){e.targetIds.length>0?e.targetIds.forEach(r):this.Be.forEach((a,l)=>{this.ze(l)&&r(l)})}He(e){const r=e.targetId,a=e.me.count,l=this.Je(r);if(l){const u=l.target;if(rO(u))if(a===0){const p=new Kt(u.path);this.Ue(r,p,js.newNoDocument(p,Sn.min()))}else yn(a===1);else{const p=this.Ye(r);if(p!==a){const m=this.Ze(e),v=m?this.Xe(m,e,p):1;if(v!==0){this.je(r);const w=v===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(r,w)}aO==null||aO.et(function(R,C,A,O,U){var F,q,W,H,X,ne;const te={localCacheCount:R,existenceFilterCount:C.count,databaseId:A.database,projectId:A.projectId},he=C.unchangedNames;return he&&(te.bloomFilter={applied:U===0,hashCount:(F=he==null?void 0:he.hashCount)!==null&&F!==void 0?F:0,bitmapLength:(H=(W=(q=he==null?void 0:he.bits)===null||q===void 0?void 0:q.bitmap)===null||W===void 0?void 0:W.length)!==null&&H!==void 0?H:0,padding:(ne=(X=he==null?void 0:he.bits)===null||X===void 0?void 0:X.padding)!==null&&ne!==void 0?ne:0,mightContain:J=>{var Q;return(Q=O==null?void 0:O.mightContain(J))!==null&&Q!==void 0&&Q}}),te}(p,e.me,this.Le.tt(),m,v))}}}}Ze(e){const r=e.me.unchangedNames;if(!r||!r.bits)return null;const{bits:{bitmap:a="",padding:l=0},hashCount:u=0}=r;let p,m;try{p=Ym(a).toUint8Array()}catch(v){if(v instanceof Tde)return Jd("Decoding the base64 bloom filter in existence filter failed ("+v.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw v}try{m=new wG(p,l,u)}catch(v){return Jd(v instanceof mC?"BloomFilter error: ":"Applying bloom filter failed: ",v),null}return m.Ie===0?null:m}Xe(e,r,a){return r.me.count===a-this.nt(e,r.targetId)?0:2}nt(e,r){const a=this.Le.getRemoteKeysForTarget(r);let l=0;return a.forEach(u=>{const p=this.Le.tt(),m=`projects/${p.projectId}/databases/${p.database}/documents/${u.path.canonicalString()}`;e.mightContain(m)||(this.Ue(r,u,null),l++)}),l}rt(e){const r=new Map;this.Be.forEach((u,p)=>{const m=this.Je(p);if(m){if(u.current&&rO(m.target)){const v=new Kt(m.target.path);this.ke.get(v)!==null||this.it(p,v)||this.Ue(p,v,js.newNoDocument(v,e))}u.be&&(r.set(p,u.ve()),u.Ce())}});let a=Nr();this.qe.forEach((u,p)=>{let m=!0;p.forEachWhile(v=>{const w=this.Je(v);return!w||w.purpose==="TargetPurposeLimboResolution"||(m=!1,!1)}),m&&(a=a.add(u))}),this.ke.forEach((u,p)=>p.setReadTime(e));const l=new nI(e,r,this.Qe,this.ke,a);return this.ke=ld(),this.qe=gre(),this.Qe=new Rs(ir),l}$e(e,r){if(!this.ze(e))return;const a=this.it(e,r.key)?2:0;this.Ge(e).Fe(r.key,a),this.ke=this.ke.insert(r.key,r),this.qe=this.qe.insert(r.key,this.st(r.key).add(e))}Ue(e,r,a){if(!this.ze(e))return;const l=this.Ge(e);this.it(e,r)?l.Fe(r,1):l.Me(r),this.qe=this.qe.insert(r,this.st(r).delete(e)),a&&(this.ke=this.ke.insert(r,a))}removeTarget(e){this.Be.delete(e)}Ye(e){const r=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let r=this.Be.get(e);return r||(r=new mre,this.Be.set(e,r)),r}st(e){let r=this.qe.get(e);return r||(r=new os(ir),this.qe=this.qe.insert(e,r)),r}ze(e){const r=this.Je(e)!==null;return r||Pt("WatchChangeAggregator","Detected inactive target",e),r}Je(e){const r=this.Be.get(e);return r&&r.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new mre),this.Le.getRemoteKeysForTarget(e).forEach(r=>{this.Ue(e,r,null)})}it(e,r){return this.Le.getRemoteKeysForTarget(e).has(r)}}function gre(){return new Rs(Kt.comparator)}function _re(){return new Rs(Kt.comparator)}const W2e={asc:"ASCENDING",desc:"DESCENDING"},H2e={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},K2e={and:"AND",or:"OR"};class q2e{constructor(e,r){this.databaseId=e,this.useProto3Json=r}}function X6(t,e){return t.useProto3Json||JN(e)?e:{value:e}}function dw(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function sue(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function Y2e(t,e){return dw(t,e.toTimestamp())}function Va(t){return yn(!!t),Sn.fromTimestamp(function(r){const a=qm(r);return new fn(a.seconds,a.nanos)}(t))}function SG(t,e){return J6(t,e).canonicalString()}function J6(t,e){const r=function(l){return new li(["projects",l.projectId,"databases",l.database])}(t).child("documents");return e===void 0?r:r.child(e)}function aue(t){const e=li.fromString(t);return yn(gue(e)),e}function TN(t,e){return SG(t.databaseId,e.path)}function Cf(t,e){const r=aue(e);if(r.get(1)!==t.databaseId.projectId)throw new Nt(ot.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+t.databaseId.projectId);if(r.get(3)!==t.databaseId.database)throw new Nt(ot.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+t.databaseId.database);return new Kt(lue(r))}function oue(t,e){return SG(t.databaseId,e)}function cue(t){const e=aue(t);return e.length===4?li.emptyPath():lue(e)}function Q6(t){return new li(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function lue(t){return yn(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function yre(t,e,r){return{name:TN(t,e),fields:r.value.mapValue.fields}}function due(t,e,r){const a=Cf(t,e.name),l=Va(e.updateTime),u=e.createTime?Va(e.createTime):Sn.min(),p=new Cc({mapValue:{fields:e.fields}}),m=js.newFoundDocument(a,l,u,p);return r&&m.setHasCommittedMutations(),r?m.setHasCommittedMutations():m}function $2e(t,e){return"found"in e?function(a,l){yn(!!l.found),l.found.name,l.found.updateTime;const u=Cf(a,l.found.name),p=Va(l.found.updateTime),m=l.found.createTime?Va(l.found.createTime):Sn.min(),v=new Cc({mapValue:{fields:l.found.fields}});return js.newFoundDocument(u,p,m,v)}(t,e):"missing"in e?function(a,l){yn(!!l.missing),yn(!!l.readTime);const u=Cf(a,l.missing),p=Va(l.readTime);return js.newNoDocument(u,p)}(t,e):cn()}function X2e(t,e){let r;if("targetChange"in e){e.targetChange;const a=function(w){return w==="NO_CHANGE"?0:w==="ADD"?1:w==="REMOVE"?2:w==="CURRENT"?3:w==="RESET"?4:cn()}(e.targetChange.targetChangeType||"NO_CHANGE"),l=e.targetChange.targetIds||[],u=function(w,R){return w.useProto3Json?(yn(R===void 0||typeof R=="string"),_a.fromBase64String(R||"")):(yn(R===void 0||R instanceof Buffer||R instanceof Uint8Array),_a.fromUint8Array(R||new Uint8Array))}(t,e.targetChange.resumeToken),p=e.targetChange.cause,m=p&&function(w){const R=w.code===void 0?ot.UNKNOWN:tue(w.code);return new Nt(R,w.message||"")}(p);r=new iue(a,l,u,m||null)}else if("documentChange"in e){e.documentChange;const a=e.documentChange;a.document,a.document.name,a.document.updateTime;const l=Cf(t,a.document.name),u=Va(a.document.updateTime),p=a.document.createTime?Va(a.document.createTime):Sn.min(),m=new Cc({mapValue:{fields:a.document.fields}}),v=js.newFoundDocument(l,u,p,m),w=a.targetIds||[],R=a.removedTargetIds||[];r=new gD(w,R,v.key,v)}else if("documentDelete"in e){e.documentDelete;const a=e.documentDelete;a.document;const l=Cf(t,a.document),u=a.readTime?Va(a.readTime):Sn.min(),p=js.newNoDocument(l,u),m=a.removedTargetIds||[];r=new gD([],m,p.key,p)}else if("documentRemove"in e){e.documentRemove;const a=e.documentRemove;a.document;const l=Cf(t,a.document),u=a.removedTargetIds||[];r=new gD([],u,l,null)}else{if(!("filter"in e))return cn();{e.filter;const a=e.filter;a.targetId;const{count:l=0,unchangedNames:u}=a,p=new B2e(l,u),m=a.targetId;r=new rue(m,p)}}return r}function RN(t,e){let r;if(e instanceof Fw)r={update:yre(t,e.key,e.value)};else if(e instanceof Bw)r={delete:TN(t,e.key)};else if(e instanceof ig)r={update:yre(t,e.key,e.data),updateMask:nDe(e.fieldMask)};else{if(!(e instanceof vG))return cn();r={verify:TN(t,e.key)}}return e.fieldTransforms.length>0&&(r.updateTransforms=e.fieldTransforms.map(a=>function(u,p){const m=p.transform;if(m instanceof cw)return{fieldPath:p.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(m instanceof Nv)return{fieldPath:p.field.canonicalString(),appendMissingElements:{values:m.elements}};if(m instanceof Iv)return{fieldPath:p.field.canonicalString(),removeAllFromArray:{values:m.elements}};if(m instanceof lw)return{fieldPath:p.field.canonicalString(),increment:m.Pe};throw cn()}(0,a))),e.precondition.isNone||(r.currentDocument=function(l,u){return u.updateTime!==void 0?{updateTime:Y2e(l,u.updateTime)}:u.exists!==void 0?{exists:u.exists}:cn()}(t,e.precondition)),r}function Z6(t,e){const r=e.currentDocument?function(u){return u.updateTime!==void 0?ta.updateTime(Va(u.updateTime)):u.exists!==void 0?ta.exists(u.exists):ta.none()}(e.currentDocument):ta.none(),a=e.updateTransforms?e.updateTransforms.map(l=>function(p,m){let v=null;if("setToServerValue"in m)yn(m.setToServerValue==="REQUEST_TIME"),v=new cw;else if("appendMissingElements"in m){const R=m.appendMissingElements.values||[];v=new Nv(R)}else if("removeAllFromArray"in m){const R=m.removeAllFromArray.values||[];v=new Iv(R)}else"increment"in m?v=new lw(p,m.increment):cn();const w=Ms.fromServerFormat(m.fieldPath);return new tI(w,v)}(t,l)):[];if(e.update){e.update.name;const l=Cf(t,e.update.name),u=new Cc({mapValue:{fields:e.update.fields}});if(e.updateMask){const p=function(v){const w=v.fieldPaths||[];return new cd(w.map(R=>Ms.fromServerFormat(R)))}(e.updateMask);return new ig(l,u,p,r,a)}return new Fw(l,u,r,a)}if(e.delete){const l=Cf(t,e.delete);return new Bw(l,r)}if(e.verify){const l=Cf(t,e.verify);return new vG(l,r)}return cn()}function J2e(t,e){return t&&t.length>0?(yn(e!==void 0),t.map(r=>function(l,u){let p=l.updateTime?Va(l.updateTime):Va(u);return p.isEqual(Sn.min())&&(p=Va(u)),new U2e(p,l.transformResults||[])}(r,e))):[]}function uue(t,e){return{documents:[oue(t,e.path)]}}function bL(t,e){const r={structuredQuery:{}},a=e.path;let l;e.collectionGroup!==null?(l=a,r.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(l=a.popLast(),r.structuredQuery.from=[{collectionId:a.lastSegment()}]),r.parent=oue(t,l);const u=function(w){if(w.length!==0)return mue($i.create(w,"and"))}(e.filters);u&&(r.structuredQuery.where=u);const p=function(w){if(w.length!==0)return w.map(R=>function(A){return{field:S_(A.field),direction:Z2e(A.dir)}}(R))}(e.orderBy);p&&(r.structuredQuery.orderBy=p);const m=X6(t,e.limit);return m!==null&&(r.structuredQuery.limit=m),e.startAt&&(r.structuredQuery.startAt=function(w){return{before:w.inclusive,values:w.position}}(e.startAt)),e.endAt&&(r.structuredQuery.endAt=function(w){return{before:!w.inclusive,values:w.position}}(e.endAt)),{_t:r,parent:l}}function hue(t,e,r,a){const{_t:l,parent:u}=bL(t,e),p={},m=[];let v=0;return r.forEach(w=>{const R=a?w.alias:"aggregate_"+v++;p[R]=w.alias,w.aggregateType==="count"?m.push({alias:R,count:{}}):w.aggregateType==="avg"?m.push({alias:R,avg:{field:S_(w.fieldPath)}}):w.aggregateType==="sum"&&m.push({alias:R,sum:{field:S_(w.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:m,structuredQuery:l.structuredQuery},parent:l.parent},ut:p,parent:u}}function pue(t){let e=cue(t.parent);const r=t.structuredQuery,a=r.from?r.from.length:0;let l=null;if(a>0){yn(a===1);const R=r.from[0];R.allDescendants?l=R.collectionId:e=e.child(R.collectionId)}let u=[];r.where&&(u=function(C){const A=fue(C);return A instanceof $i&&mG(A)?A.getFilters():[A]}(r.where));let p=[];r.orderBy&&(p=function(C){return C.map(A=>function(U){return new SN(hb(U.field),function(q){switch(q){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(U.direction))}(A))}(r.orderBy));let m=null;r.limit&&(m=function(C){let A;return A=typeof C=="object"?C.value:C,JN(A)?null:A}(r.limit));let v=null;r.startAt&&(v=function(C){const A=!!C.before,O=C.values||[];return new r0(O,A)}(r.startAt));let w=null;return r.endAt&&(w=function(C){const A=!C.before,O=C.values||[];return new r0(O,A)}(r.endAt)),jde(e,l,p,u,m,"F",v,w)}function Q2e(t,e){const r=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return cn()}}(e.purpose);return r==null?null:{"goog-listen-tags":r}}function fue(t){return t.unaryFilter!==void 0?function(r){switch(r.unaryFilter.op){case"IS_NAN":const a=hb(r.unaryFilter.field);return di.create(a,"==",{doubleValue:NaN});case"IS_NULL":const l=hb(r.unaryFilter.field);return di.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const u=hb(r.unaryFilter.field);return di.create(u,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const p=hb(r.unaryFilter.field);return di.create(p,"!=",{nullValue:"NULL_VALUE"});default:return cn()}}(t):t.fieldFilter!==void 0?function(r){return di.create(hb(r.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return cn()}}(r.fieldFilter.op),r.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(r){return $i.create(r.compositeFilter.filters.map(a=>fue(a)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return cn()}}(r.compositeFilter.op))}(t):cn()}function Z2e(t){return W2e[t]}function eDe(t){return H2e[t]}function tDe(t){return K2e[t]}function S_(t){return{fieldPath:t.canonicalString()}}function hb(t){return Ms.fromServerFormat(t.fieldPath)}function mue(t){return t instanceof di?function(r){if(r.op==="=="){if(tre(r.value))return{unaryFilter:{field:S_(r.field),op:"IS_NAN"}};if(ere(r.value))return{unaryFilter:{field:S_(r.field),op:"IS_NULL"}}}else if(r.op==="!="){if(tre(r.value))return{unaryFilter:{field:S_(r.field),op:"IS_NOT_NAN"}};if(ere(r.value))return{unaryFilter:{field:S_(r.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:S_(r.field),op:eDe(r.op),value:r.value}}}(t):t instanceof $i?function(r){const a=r.getFilters().map(l=>mue(l));return a.length===1?a[0]:{compositeFilter:{op:tDe(r.op),filters:a}}}(t):cn()}function nDe(t){const e=[];return t.fields.forEach(r=>e.push(r.canonicalString())),{fieldPaths:e}}function gue(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Om{constructor(e,r,a,l,u=Sn.min(),p=Sn.min(),m=_a.EMPTY_BYTE_STRING,v=null){this.target=e,this.targetId=r,this.purpose=a,this.sequenceNumber=l,this.snapshotVersion=u,this.lastLimboFreeSnapshotVersion=p,this.resumeToken=m,this.expectedCount=v}withSequenceNumber(e){return new Om(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,r){return new Om(this.target,this.targetId,this.purpose,this.sequenceNumber,r,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Om(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Om(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _ue{constructor(e){this.ct=e}}function rDe(t,e){let r;if(e.document)r=due(t.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const a=Kt.fromSegments(e.noDocument.path),l=kv(e.noDocument.readTime);r=js.newNoDocument(a,l),e.hasCommittedMutations&&r.setHasCommittedMutations()}else{if(!e.unknownDocument)return cn();{const a=Kt.fromSegments(e.unknownDocument.path),l=kv(e.unknownDocument.version);r=js.newUnknownDocument(a,l)}}return e.readTime&&r.setReadTime(function(l){const u=new fn(l[0],l[1]);return Sn.fromTimestamp(u)}(e.readTime)),r}function vre(t,e){const r=e.key,a={prefixPath:r.getCollectionPath().popLast().toArray(),collectionGroup:r.collectionGroup,documentId:r.path.lastSegment(),readTime:oO(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())a.document=function(u,p){return{name:TN(u,p.key),fields:p.data.value.mapValue.fields,updateTime:dw(u,p.version.toTimestamp()),createTime:dw(u,p.createTime.toTimestamp())}}(t.ct,e);else if(e.isNoDocument())a.noDocument={path:r.path.toArray(),readTime:Av(e.version)};else{if(!e.isUnknownDocument())return cn();a.unknownDocument={path:r.path.toArray(),version:Av(e.version)}}return a}function oO(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Av(t){const e=t.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function kv(t){const e=new fn(t.seconds,t.nanoseconds);return Sn.fromTimestamp(e)}function tv(t,e){const r=(e.baseMutations||[]).map(u=>Z6(t.ct,u));for(let u=0;u<e.mutations.length-1;++u){const p=e.mutations[u];if(u+1<e.mutations.length&&e.mutations[u+1].transform!==void 0){const m=e.mutations[u+1];p.updateTransforms=m.transform.fieldTransforms,e.mutations.splice(u+1,1),++u}}const a=e.mutations.map(u=>Z6(t.ct,u)),l=fn.fromMillis(e.localWriteTimeMs);return new EG(e.batchId,l,r,a)}function gC(t){const e=kv(t.readTime),r=t.lastLimboFreeSnapshotVersion!==void 0?kv(t.lastLimboFreeSnapshotVersion):Sn.min();let a;return a=function(u){return u.documents!==void 0}(t.query)?function(u){return yn(u.documents.length===1),sl(Vw(cue(u.documents[0])))}(t.query):function(u){return sl(pue(u))}(t.query),new Om(a,t.targetId,"TargetPurposeListen",t.lastListenSequenceNumber,e,r,_a.fromBase64String(t.resumeToken))}function yue(t,e){const r=Av(e.snapshotVersion),a=Av(e.lastLimboFreeSnapshotVersion);let l;l=rO(e.target)?uue(t.ct,e.target):bL(t.ct,e.target)._t;const u=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Cv(e.target),readTime:r,resumeToken:u,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:a,query:l}}function TG(t){const e=pue({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?sO(e,e.limit,"L"):e}function UF(t,e){return new bG(e.largestBatchId,Z6(t.ct,e.overlayMutation))}function Ere(t,e){const r=e.path.lastSegment();return[t,il(e.path.popLast()),r]}function xre(t,e,r,a){return{indexId:t,uid:e,sequenceNumber:r,readTime:Av(a.readTime),documentKey:il(a.documentKey.path),largestBatchId:a.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iDe{getBundleMetadata(e,r){return bre(e).get(r).next(a=>{if(a)return function(u){return{id:u.bundleId,createTime:kv(u.createTime),version:u.version}}(a)})}saveBundleMetadata(e,r){return bre(e).put(function(l){return{bundleId:l.id,createTime:Av(Va(l.createTime)),version:l.version}}(r))}getNamedQuery(e,r){return wre(e).get(r).next(a=>{if(a)return function(u){return{name:u.name,query:TG(u.bundledQuery),readTime:kv(u.readTime)}}(a)})}saveNamedQuery(e,r){return wre(e).put(function(l){return{name:l.name,readTime:Av(Va(l.readTime)),bundledQuery:l.bundledQuery}}(r))}}function bre(t){return wo(t,"bundles")}function wre(t){return wo(t,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wL{constructor(e,r){this.serializer=e,this.userId=r}static lt(e,r){const a=r.uid||"";return new wL(e,a)}getOverlay(e,r){return $R(e).get(Ere(this.userId,r)).next(a=>a?UF(this.serializer,a):null)}getOverlays(e,r){const a=xf();return $e.forEach(r,l=>this.getOverlay(e,l).next(u=>{u!==null&&a.set(l,u)})).next(()=>a)}saveOverlays(e,r,a){const l=[];return a.forEach((u,p)=>{const m=new bG(r,p);l.push(this.ht(e,m))}),$e.waitFor(l)}removeOverlaysForBatchId(e,r,a){const l=new Set;r.forEach(p=>l.add(il(p.getCollectionPath())));const u=[];return l.forEach(p=>{const m=IDBKeyRange.bound([this.userId,p,a],[this.userId,p,a+1],!1,!0);u.push($R(e).j("collectionPathOverlayIndex",m))}),$e.waitFor(u)}getOverlaysForCollection(e,r,a){const l=xf(),u=il(r),p=IDBKeyRange.bound([this.userId,u,a],[this.userId,u,Number.POSITIVE_INFINITY],!0);return $R(e).U("collectionPathOverlayIndex",p).next(m=>{for(const v of m){const w=UF(this.serializer,v);l.set(w.getKey(),w)}return l})}getOverlaysForCollectionGroup(e,r,a,l){const u=xf();let p;const m=IDBKeyRange.bound([this.userId,r,a],[this.userId,r,Number.POSITIVE_INFINITY],!0);return $R(e).J({index:"collectionGroupOverlayIndex",range:m},(v,w,R)=>{const C=UF(this.serializer,w);u.size()<l||C.largestBatchId===p?(u.set(C.getKey(),C),p=C.largestBatchId):R.done()}).next(()=>u)}ht(e,r){return $R(e).put(function(l,u,p){const[m,v,w]=Ere(u,p.mutation.key);return{userId:u,collectionPath:v,documentId:w,collectionGroup:p.mutation.key.getCollectionGroup(),largestBatchId:p.largestBatchId,overlayMutation:RN(l.ct,p.mutation)}}(this.serializer,this.userId,r))}}function $R(t){return wo(t,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sDe{Pt(e){return wo(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(r=>{const a=r==null?void 0:r.value;return a?_a.fromUint8Array(a):_a.EMPTY_BYTE_STRING})}setSessionToken(e,r){return this.Pt(e).put({name:"sessionToken",value:r.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nv{constructor(){}It(e,r){this.Tt(e,r),r.Et()}Tt(e,r){if("nullValue"in e)this.dt(r,5);else if("booleanValue"in e)this.dt(r,10),r.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(r,15),r.At(Zs(e.integerValue));else if("doubleValue"in e){const a=Zs(e.doubleValue);isNaN(a)?this.dt(r,13):(this.dt(r,15),EN(a)?r.At(0):r.At(a))}else if("timestampValue"in e){let a=e.timestampValue;this.dt(r,20),typeof a=="string"&&(a=qm(a)),r.Rt(`${a.seconds||""}`),r.At(a.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,r),this.ft(r);else if("bytesValue"in e)this.dt(r,30),r.gt(Ym(e.bytesValue)),this.ft(r);else if("referenceValue"in e)this.yt(e.referenceValue,r);else if("geoPointValue"in e){const a=e.geoPointValue;this.dt(r,45),r.At(a.latitude||0),r.At(a.longitude||0)}else"mapValue"in e?Rde(e)?this.dt(r,Number.MAX_SAFE_INTEGER):vL(e)?this.wt(e.mapValue,r):(this.St(e.mapValue,r),this.ft(r)):"arrayValue"in e?(this.bt(e.arrayValue,r),this.ft(r)):cn()}Vt(e,r){this.dt(r,25),this.Dt(e,r)}Dt(e,r){r.Rt(e)}St(e,r){const a=e.fields||{};this.dt(r,55);for(const l of Object.keys(a))this.Vt(l,r),this.Tt(a[l],r)}wt(e,r){var a,l;const u=e.fields||{};this.dt(r,53);const p="value",m=((l=(a=u[p].arrayValue)===null||a===void 0?void 0:a.values)===null||l===void 0?void 0:l.length)||0;this.dt(r,15),r.At(Zs(m)),this.Vt(p,r),this.Tt(u[p],r)}bt(e,r){const a=e.values||[];this.dt(r,50);for(const l of a)this.Tt(l,r)}yt(e,r){this.dt(r,37),Kt.fromName(e).path.forEach(a=>{this.dt(r,60),this.Dt(a,r)})}dt(e,r){e.At(r)}ft(e){e.At(2)}}nv.vt=new nv;function aDe(t){if(t===0)return 8;let e=0;return!(t>>4)&&(e+=4,t<<=4),!(t>>6)&&(e+=2,t<<=2),!(t>>7)&&(e+=1),e}function Sre(t){const e=64-function(a){let l=0;for(let u=0;u<8;++u){const p=aDe(255&a[u]);if(l+=p,p!==8)break}return l}(t);return Math.ceil(e/8)}class oDe{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const r=e[Symbol.iterator]();let a=r.next();for(;!a.done;)this.Ft(a.value),a=r.next();this.Mt()}xt(e){const r=e[Symbol.iterator]();let a=r.next();for(;!a.done;)this.Ot(a.value),a=r.next();this.Nt()}Lt(e){for(const r of e){const a=r.charCodeAt(0);if(a<128)this.Ft(a);else if(a<2048)this.Ft(960|a>>>6),this.Ft(128|63&a);else if(r<"\uD800"||"\uDBFF"<r)this.Ft(480|a>>>12),this.Ft(128|63&a>>>6),this.Ft(128|63&a);else{const l=r.codePointAt(0);this.Ft(240|l>>>18),this.Ft(128|63&l>>>12),this.Ft(128|63&l>>>6),this.Ft(128|63&l)}}this.Mt()}Bt(e){for(const r of e){const a=r.charCodeAt(0);if(a<128)this.Ot(a);else if(a<2048)this.Ot(960|a>>>6),this.Ot(128|63&a);else if(r<"\uD800"||"\uDBFF"<r)this.Ot(480|a>>>12),this.Ot(128|63&a>>>6),this.Ot(128|63&a);else{const l=r.codePointAt(0);this.Ot(240|l>>>18),this.Ot(128|63&l>>>12),this.Ot(128|63&l>>>6),this.Ot(128|63&l)}}this.Nt()}kt(e){const r=this.qt(e),a=Sre(r);this.Qt(1+a),this.buffer[this.position++]=255&a;for(let l=r.length-a;l<r.length;++l)this.buffer[this.position++]=255&r[l]}Kt(e){const r=this.qt(e),a=Sre(r);this.Qt(1+a),this.buffer[this.position++]=~(255&a);for(let l=r.length-a;l<r.length;++l)this.buffer[this.position++]=~(255&r[l])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const r=function(u){const p=new DataView(new ArrayBuffer(8));return p.setFloat64(0,u,!1),new Uint8Array(p.buffer)}(e),a=(128&r[0])!=0;r[0]^=a?255:128;for(let l=1;l<r.length;++l)r[l]^=a?255:0;return r}Ft(e){const r=255&e;r===0?(this.Ut(0),this.Ut(255)):r===255?(this.Ut(255),this.Ut(0)):this.Ut(r)}Ot(e){const r=255&e;r===0?(this.Gt(0),this.Gt(255)):r===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const r=e+this.position;if(r<=this.buffer.length)return;let a=2*this.buffer.length;a<r&&(a=r);const l=new Uint8Array(a);l.set(this.buffer),this.buffer=l}}class cDe{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class lDe{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class XR{constructor(){this.jt=new oDe,this.Ht=new cDe(this.jt),this.Jt=new lDe(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rv{constructor(e,r,a,l){this.indexId=e,this.documentKey=r,this.arrayValue=a,this.directionalValue=l}Zt(){const e=this.directionalValue.length,r=e===0||this.directionalValue[e-1]===255?e+1:e,a=new Uint8Array(r);return a.set(this.directionalValue,0),r!==e?a.set([0],this.directionalValue.length):++a[a.length-1],new rv(this.indexId,this.documentKey,this.arrayValue,a)}}function h_(t,e){let r=t.indexId-e.indexId;return r!==0?r:(r=Tre(t.arrayValue,e.arrayValue),r!==0?r:(r=Tre(t.directionalValue,e.directionalValue),r!==0?r:Kt.comparator(t.documentKey,e.documentKey)))}function Tre(t,e){for(let r=0;r<t.length&&r<e.length;++r){const a=t[r]-e[r];if(a!==0)return a}return t.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rre{constructor(e){this.Xt=new os((r,a)=>Ms.comparator(r.field,a.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const r of e.filters){const a=r;a.isInequality()?this.Xt=this.Xt.add(a):this.tn.push(a)}}get nn(){return this.Xt.size>1}rn(e){if(yn(e.collectionGroup===this.collectionId),this.nn)return!1;const r=z6(e);if(r!==void 0&&!this.sn(r))return!1;const a=Jy(e);let l=new Set,u=0,p=0;for(;u<a.length&&this.sn(a[u]);++u)l=l.add(a[u].fieldPath.canonicalString());if(u===a.length)return!0;if(this.Xt.size>0){const m=this.Xt.getIterator().getNext();if(!l.has(m.field.canonicalString())){const v=a[u];if(!this.on(m,v)||!this._n(this.en[p++],v))return!1}++u}for(;u<a.length;++u){const m=a[u];if(p>=this.en.length||!this._n(this.en[p++],m))return!1}return!0}an(){if(this.nn)return null;let e=new os(Ms.comparator);const r=[];for(const a of this.tn)if(!a.field.isKeyField())if(a.op==="array-contains"||a.op==="array-contains-any")r.push(new fv(a.field,2));else{if(e.has(a.field))continue;e=e.add(a.field),r.push(new fv(a.field,0))}for(const a of this.en)a.field.isKeyField()||e.has(a.field)||(e=e.add(a.field),r.push(new fv(a.field,a.dir==="asc"?0:1)));return new iw(iw.UNKNOWN_ID,this.collectionId,r,sw.empty())}sn(e){for(const r of this.tn)if(this.on(r,e))return!0;return!1}on(e,r){if(e===void 0||!e.field.isEqual(r.fieldPath))return!1;const a=e.op==="array-contains"||e.op==="array-contains-any";return r.kind===2===a}_n(e,r){return!!e.field.isEqual(r.fieldPath)&&(r.kind===0&&e.dir==="asc"||r.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vue(t){var e,r;if(yn(t instanceof di||t instanceof $i),t instanceof di){if(t instanceof Lde){const l=((r=(e=t.value.arrayValue)===null||e===void 0?void 0:e.values)===null||r===void 0?void 0:r.map(u=>di.create(t.field,"==",u)))||[];return $i.create(l,"or")}return t}const a=t.filters.map(l=>vue(l));return $i.create(a,t.op)}function dDe(t){if(t.getFilters().length===0)return[];const e=nz(vue(t));return yn(Eue(e)),ez(e)||tz(e)?[e]:e.getFilters()}function ez(t){return t instanceof di}function tz(t){return t instanceof $i&&mG(t)}function Eue(t){return ez(t)||tz(t)||function(r){if(r instanceof $i&&K6(r)){for(const a of r.getFilters())if(!ez(a)&&!tz(a))return!1;return!0}return!1}(t)}function nz(t){if(yn(t instanceof di||t instanceof $i),t instanceof di)return t;if(t.filters.length===1)return nz(t.filters[0]);const e=t.filters.map(a=>nz(a));let r=$i.create(e,t.op);return r=cO(r),Eue(r)?r:(yn(r instanceof $i),yn(ow(r)),yn(r.filters.length>1),r.filters.reduce((a,l)=>RG(a,l)))}function RG(t,e){let r;return yn(t instanceof di||t instanceof $i),yn(e instanceof di||e instanceof $i),r=t instanceof di?e instanceof di?function(l,u){return $i.create([l,u],"and")}(t,e):Cre(t,e):e instanceof di?Cre(e,t):function(l,u){if(yn(l.filters.length>0&&u.filters.length>0),ow(l)&&ow(u))return Pde(l,u.getFilters());const p=K6(l)?l:u,m=K6(l)?u:l,v=p.filters.map(w=>RG(w,m));return $i.create(v,"or")}(t,e),cO(r)}function Cre(t,e){if(ow(e))return Pde(e,t.getFilters());{const r=e.filters.map(a=>RG(t,a));return $i.create(r,"or")}}function cO(t){if(yn(t instanceof di||t instanceof $i),t instanceof di)return t;const e=t.getFilters();if(e.length===1)return cO(e[0]);if(Ade(t))return t;const r=e.map(l=>cO(l)),a=[];return r.forEach(l=>{l instanceof di?a.push(l):l instanceof $i&&(l.op===t.op?a.push(...l.filters):a.push(l))}),a.length===1?a[0]:$i.create(a,t.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uDe{constructor(){this.un=new CG}addToCollectionParentIndex(e,r){return this.un.add(r),$e.resolve()}getCollectionParents(e,r){return $e.resolve(this.un.getEntries(r))}addFieldIndex(e,r){return $e.resolve()}deleteFieldIndex(e,r){return $e.resolve()}deleteAllFieldIndexes(e){return $e.resolve()}createTargetIndexes(e,r){return $e.resolve()}getDocumentsMatchingTarget(e,r){return $e.resolve(null)}getIndexType(e,r){return $e.resolve(0)}getFieldIndexes(e,r){return $e.resolve([])}getNextCollectionGroupToUpdate(e){return $e.resolve(null)}getMinOffset(e,r){return $e.resolve(Qd.min())}getMinOffsetFromCollectionGroup(e,r){return $e.resolve(Qd.min())}updateCollectionGroup(e,r,a){return $e.resolve()}updateIndexEntries(e,r){return $e.resolve()}}class CG{constructor(){this.index={}}add(e){const r=e.lastSegment(),a=e.popLast(),l=this.index[r]||new os(li.comparator),u=!l.has(a);return this.index[r]=l.add(a),u}has(e){const r=e.lastSegment(),a=e.popLast(),l=this.index[r];return l&&l.has(a)}getEntries(e){return(this.index[e]||new os(li.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I2=new Uint8Array(0);class hDe{constructor(e,r){this.databaseId=r,this.cn=new CG,this.ln=new rg(a=>Cv(a),(a,l)=>QN(a,l)),this.uid=e.uid||""}addToCollectionParentIndex(e,r){if(!this.cn.has(r)){const a=r.lastSegment(),l=r.popLast();e.addOnCommittedListener(()=>{this.cn.add(r)});const u={collectionId:a,parent:il(l)};return Nre(e).put(u)}return $e.resolve()}getCollectionParents(e,r){const a=[],l=IDBKeyRange.bound([r,""],[hde(r),""],!1,!0);return Nre(e).U(l).next(u=>{for(const p of u){if(p.collectionId!==r)break;a.push(Ef(p.parent))}return a})}addFieldIndex(e,r){const a=JR(e),l=function(m){return{indexId:m.indexId,collectionGroup:m.collectionGroup,fields:m.fields.map(v=>[v.fieldPath.canonicalString(),v.kind])}}(r);delete l.indexId;const u=a.add(l);if(r.indexState){const p=rb(e);return u.next(m=>{p.put(xre(m,this.uid,r.indexState.sequenceNumber,r.indexState.offset))})}return u.next()}deleteFieldIndex(e,r){const a=JR(e),l=rb(e),u=nb(e);return a.delete(r.indexId).next(()=>l.delete(IDBKeyRange.bound([r.indexId],[r.indexId+1],!1,!0))).next(()=>u.delete(IDBKeyRange.bound([r.indexId],[r.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const r=JR(e),a=nb(e),l=rb(e);return r.j().next(()=>a.j()).next(()=>l.j())}createTargetIndexes(e,r){return $e.forEach(this.hn(r),a=>this.getIndexType(e,a).next(l=>{if(l===0||l===1){const u=new Rre(a).an();if(u!=null)return this.addFieldIndex(e,u)}}))}getDocumentsMatchingTarget(e,r){const a=nb(e);let l=!0;const u=new Map;return $e.forEach(this.hn(r),p=>this.Pn(e,p).next(m=>{l&&(l=!!m),u.set(p,m)})).next(()=>{if(l){let p=Nr();const m=[];return $e.forEach(u,(v,w)=>{Pt("IndexedDbIndexManager",`Using index ${function(X){return`id=${X.indexId}|cg=${X.collectionGroup}|f=${X.fields.map(ne=>`${ne.fieldPath}:${ne.kind}`).join(",")}`}(v)} to execute ${Cv(r)}`);const R=function(X,ne){const te=z6(ne);if(te===void 0)return null;for(const he of iO(X,te.fieldPath))switch(he.op){case"array-contains-any":return he.value.arrayValue.values||[];case"array-contains":return[he.value]}return null}(w,v),C=function(X,ne){const te=new Map;for(const he of Jy(ne))for(const J of iO(X,he.fieldPath))switch(J.op){case"==":case"in":te.set(he.fieldPath.canonicalString(),J.value);break;case"not-in":case"!=":return te.set(he.fieldPath.canonicalString(),J.value),Array.from(te.values())}return null}(w,v),A=function(X,ne){const te=[];let he=!0;for(const J of Jy(ne)){const Q=J.kind===0?are(X,J.fieldPath,X.startAt):ore(X,J.fieldPath,X.startAt);te.push(Q.value),he&&(he=Q.inclusive)}return new r0(te,he)}(w,v),O=function(X,ne){const te=[];let he=!0;for(const J of Jy(ne)){const Q=J.kind===0?ore(X,J.fieldPath,X.endAt):are(X,J.fieldPath,X.endAt);te.push(Q.value),he&&(he=Q.inclusive)}return new r0(te,he)}(w,v),U=this.In(v,w,A),F=this.In(v,w,O),q=this.Tn(v,w,C),W=this.En(v.indexId,R,U,A.inclusive,F,O.inclusive,q);return $e.forEach(W,H=>a.G(H,r.limit).next(X=>{X.forEach(ne=>{const te=Kt.fromSegments(ne.documentKey);p.has(te)||(p=p.add(te),m.push(te))})}))}).next(()=>m)}return $e.resolve(null)})}hn(e){let r=this.ln.get(e);return r||(e.filters.length===0?r=[e]:r=dDe($i.create(e.filters,"and")).map(a=>Y6(e.path,e.collectionGroup,e.orderBy,a.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,r),r)}En(e,r,a,l,u,p,m){const v=(r!=null?r.length:1)*Math.max(a.length,u.length),w=v/(r!=null?r.length:1),R=[];for(let C=0;C<v;++C){const A=r?this.dn(r[C/w]):I2,O=this.An(e,A,a[C%w],l),U=this.Rn(e,A,u[C%w],p),F=m.map(q=>this.An(e,A,q,!0));R.push(...this.createRange(O,U,F))}return R}An(e,r,a,l){const u=new rv(e,Kt.empty(),r,a);return l?u:u.Zt()}Rn(e,r,a,l){const u=new rv(e,Kt.empty(),r,a);return l?u.Zt():u}Pn(e,r){const a=new Rre(r),l=r.collectionGroup!=null?r.collectionGroup:r.path.lastSegment();return this.getFieldIndexes(e,l).next(u=>{let p=null;for(const m of u)a.rn(m)&&(!p||m.fields.length>p.fields.length)&&(p=m);return p})}getIndexType(e,r){let a=2;const l=this.hn(r);return $e.forEach(l,u=>this.Pn(e,u).next(p=>{p?a!==0&&p.fields.length<function(v){let w=new os(Ms.comparator),R=!1;for(const C of v.filters)for(const A of C.getFlattenedFilters())A.field.isKeyField()||(A.op==="array-contains"||A.op==="array-contains-any"?R=!0:w=w.add(A.field));for(const C of v.orderBy)C.field.isKeyField()||(w=w.add(C.field));return w.size+(R?1:0)}(u)&&(a=1):a=0})).next(()=>function(p){return p.limit!==null}(r)&&l.length>1&&a===2?1:a)}Vn(e,r){const a=new XR;for(const l of Jy(e)){const u=r.data.field(l.fieldPath);if(u==null)return null;const p=a.Yt(l.kind);nv.vt.It(u,p)}return a.zt()}dn(e){const r=new XR;return nv.vt.It(e,r.Yt(0)),r.zt()}mn(e,r){const a=new XR;return nv.vt.It(Rv(this.databaseId,r),a.Yt(function(u){const p=Jy(u);return p.length===0?0:p[p.length-1].kind}(e))),a.zt()}Tn(e,r,a){if(a===null)return[];let l=[];l.push(new XR);let u=0;for(const p of Jy(e)){const m=a[u++];for(const v of l)if(this.fn(r,p.fieldPath)&&wN(m))l=this.gn(l,p,m);else{const w=v.Yt(p.kind);nv.vt.It(m,w)}}return this.pn(l)}In(e,r,a){return this.Tn(e,r,a.position)}pn(e){const r=[];for(let a=0;a<e.length;++a)r[a]=e[a].zt();return r}gn(e,r,a){const l=[...e],u=[];for(const p of a.arrayValue.values||[])for(const m of l){const v=new XR;v.seed(m.zt()),nv.vt.It(p,v.Yt(r.kind)),u.push(v)}return u}fn(e,r){return!!e.filters.find(a=>a instanceof di&&a.field.isEqual(r)&&(a.op==="in"||a.op==="not-in"))}getFieldIndexes(e,r){const a=JR(e),l=rb(e);return(r?a.U("collectionGroupIndex",IDBKeyRange.bound(r,r)):a.U()).next(u=>{const p=[];return $e.forEach(u,m=>l.get([m.indexId,this.uid]).next(v=>{p.push(function(R,C){const A=C?new sw(C.sequenceNumber,new Qd(kv(C.readTime),new Kt(Ef(C.documentKey)),C.largestBatchId)):sw.empty(),O=R.fields.map(([U,F])=>new fv(Ms.fromServerFormat(U),F));return new iw(R.indexId,R.collectionGroup,O,A)}(m,v))})).next(()=>p)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(r=>r.length===0?null:(r.sort((a,l)=>{const u=a.indexState.sequenceNumber-l.indexState.sequenceNumber;return u!==0?u:ir(a.collectionGroup,l.collectionGroup)}),r[0].collectionGroup))}updateCollectionGroup(e,r,a){const l=JR(e),u=rb(e);return this.yn(e).next(p=>l.U("collectionGroupIndex",IDBKeyRange.bound(r,r)).next(m=>$e.forEach(m,v=>u.put(xre(v.indexId,this.uid,p,a)))))}updateIndexEntries(e,r){const a=new Map;return $e.forEach(r,(l,u)=>{const p=a.get(l.collectionGroup);return(p?$e.resolve(p):this.getFieldIndexes(e,l.collectionGroup)).next(m=>(a.set(l.collectionGroup,m),$e.forEach(m,v=>this.wn(e,l,v).next(w=>{const R=this.Sn(u,v);return w.isEqual(R)?$e.resolve():this.bn(e,u,v,w,R)}))))})}Dn(e,r,a,l){return nb(e).put({indexId:l.indexId,uid:this.uid,arrayValue:l.arrayValue,directionalValue:l.directionalValue,orderedDocumentKey:this.mn(a,r.key),documentKey:r.key.path.toArray()})}vn(e,r,a,l){return nb(e).delete([l.indexId,this.uid,l.arrayValue,l.directionalValue,this.mn(a,r.key),r.key.path.toArray()])}wn(e,r,a){const l=nb(e);let u=new os(h_);return l.J({index:"documentKeyIndex",range:IDBKeyRange.only([a.indexId,this.uid,this.mn(a,r)])},(p,m)=>{u=u.add(new rv(a.indexId,r,m.arrayValue,m.directionalValue))}).next(()=>u)}Sn(e,r){let a=new os(h_);const l=this.Vn(r,e);if(l==null)return a;const u=z6(r);if(u!=null){const p=e.data.field(u.fieldPath);if(wN(p))for(const m of p.arrayValue.values||[])a=a.add(new rv(r.indexId,e.key,this.dn(m),l))}else a=a.add(new rv(r.indexId,e.key,I2,l));return a}bn(e,r,a,l,u){Pt("IndexedDbIndexManager","Updating index entries for document '%s'",r.key);const p=[];return function(v,w,R,C,A){const O=v.getIterator(),U=w.getIterator();let F=tb(O),q=tb(U);for(;F||q;){let W=!1,H=!1;if(F&&q){const X=R(F,q);X<0?H=!0:X>0&&(W=!0)}else F!=null?H=!0:W=!0;W?(C(q),q=tb(U)):H?(A(F),F=tb(O)):(F=tb(O),q=tb(U))}}(l,u,h_,m=>{p.push(this.Dn(e,r,a,m))},m=>{p.push(this.vn(e,r,a,m))}),$e.waitFor(p)}yn(e){let r=1;return rb(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(a,l,u)=>{u.done(),r=l.sequenceNumber+1}).next(()=>r)}createRange(e,r,a){a=a.sort((p,m)=>h_(p,m)).filter((p,m,v)=>!m||h_(p,v[m-1])!==0);const l=[];l.push(e);for(const p of a){const m=h_(p,e),v=h_(p,r);if(m===0)l[0]=e.Zt();else if(m>0&&v<0)l.push(p),l.push(p.Zt());else if(v>0)break}l.push(r);const u=[];for(let p=0;p<l.length;p+=2){if(this.Cn(l[p],l[p+1]))return[];const m=[l[p].indexId,this.uid,l[p].arrayValue,l[p].directionalValue,I2,[]],v=[l[p+1].indexId,this.uid,l[p+1].arrayValue,l[p+1].directionalValue,I2,[]];u.push(IDBKeyRange.bound(m,v))}return u}Cn(e,r){return h_(e,r)>0}getMinOffsetFromCollectionGroup(e,r){return this.getFieldIndexes(e,r).next(Ire)}getMinOffset(e,r){return $e.mapArray(this.hn(r),a=>this.Pn(e,a).next(l=>l||cn())).next(Ire)}}function Nre(t){return wo(t,"collectionParents")}function nb(t){return wo(t,"indexEntries")}function JR(t){return wo(t,"indexConfiguration")}function rb(t){return wo(t,"indexState")}function Ire(t){yn(t.length!==0);let e=t[0].indexState.offset,r=e.largestBatchId;for(let a=1;a<t.length;a++){const l=t[a].indexState.offset;hG(l,e)<0&&(e=l),r<l.largestBatchId&&(r=l.largestBatchId)}return new Qd(e.readTime,e.documentKey,r)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Are={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class nl{constructor(e,r,a){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=r,this.maximumSequenceNumbersToCollect=a}static withCacheSize(e){return new nl(e,nl.DEFAULT_COLLECTION_PERCENTILE,nl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xue(t,e,r){const a=t.store("mutations"),l=t.store("documentMutations"),u=[],p=IDBKeyRange.only(r.batchId);let m=0;const v=a.J({range:p},(R,C,A)=>(m++,A.delete()));u.push(v.next(()=>{yn(m===1)}));const w=[];for(const R of r.mutations){const C=vde(e,R.key.path,r.batchId);u.push(l.delete(C)),w.push(R.key)}return $e.waitFor(u).next(()=>w)}function lO(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw cn();e=t.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */nl.DEFAULT_COLLECTION_PERCENTILE=10,nl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,nl.DEFAULT=new nl(41943040,nl.DEFAULT_COLLECTION_PERCENTILE,nl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),nl.DISABLED=new nl(-1,0,0);class SL{constructor(e,r,a,l){this.userId=e,this.serializer=r,this.indexManager=a,this.referenceDelegate=l,this.Fn={}}static lt(e,r,a,l){yn(e.uid!=="");const u=e.isAuthenticated()?e.uid:"";return new SL(u,r,a,l)}checkEmpty(e){let r=!0;const a=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return p_(e).J({index:"userMutationsIndex",range:a},(l,u,p)=>{r=!1,p.done()}).next(()=>r)}addMutationBatch(e,r,a,l){const u=pb(e),p=p_(e);return p.add({}).next(m=>{yn(typeof m=="number");const v=new EG(m,r,a,l),w=function(O,U,F){const q=F.baseMutations.map(H=>RN(O.ct,H)),W=F.mutations.map(H=>RN(O.ct,H));return{userId:U,batchId:F.batchId,localWriteTimeMs:F.localWriteTime.toMillis(),baseMutations:q,mutations:W}}(this.serializer,this.userId,v),R=[];let C=new os((A,O)=>ir(A.canonicalString(),O.canonicalString()));for(const A of l){const O=vde(this.userId,A.key.path,m);C=C.add(A.key.path.popLast()),R.push(p.put(w)),R.push(u.put(O,ZPe))}return C.forEach(A=>{R.push(this.indexManager.addToCollectionParentIndex(e,A))}),e.addOnCommittedListener(()=>{this.Fn[m]=v.keys()}),$e.waitFor(R).next(()=>v)})}lookupMutationBatch(e,r){return p_(e).get(r).next(a=>a?(yn(a.userId===this.userId),tv(this.serializer,a)):null)}Mn(e,r){return this.Fn[r]?$e.resolve(this.Fn[r]):this.lookupMutationBatch(e,r).next(a=>{if(a){const l=a.keys();return this.Fn[r]=l,l}return null})}getNextMutationBatchAfterBatchId(e,r){const a=r+1,l=IDBKeyRange.lowerBound([this.userId,a]);let u=null;return p_(e).J({index:"userMutationsIndex",range:l},(p,m,v)=>{m.userId===this.userId&&(yn(m.batchId>=a),u=tv(this.serializer,m)),v.done()}).next(()=>u)}getHighestUnacknowledgedBatchId(e){const r=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let a=-1;return p_(e).J({index:"userMutationsIndex",range:r,reverse:!0},(l,u,p)=>{a=u.batchId,p.done()}).next(()=>a)}getAllMutationBatches(e){const r=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return p_(e).U("userMutationsIndex",r).next(a=>a.map(l=>tv(this.serializer,l)))}getAllMutationBatchesAffectingDocumentKey(e,r){const a=uD(this.userId,r.path),l=IDBKeyRange.lowerBound(a),u=[];return pb(e).J({range:l},(p,m,v)=>{const[w,R,C]=p,A=Ef(R);if(w===this.userId&&r.path.isEqual(A))return p_(e).get(C).next(O=>{if(!O)throw cn();yn(O.userId===this.userId),u.push(tv(this.serializer,O))});v.done()}).next(()=>u)}getAllMutationBatchesAffectingDocumentKeys(e,r){let a=new os(ir);const l=[];return r.forEach(u=>{const p=uD(this.userId,u.path),m=IDBKeyRange.lowerBound(p),v=pb(e).J({range:m},(w,R,C)=>{const[A,O,U]=w,F=Ef(O);A===this.userId&&u.path.isEqual(F)?a=a.add(U):C.done()});l.push(v)}),$e.waitFor(l).next(()=>this.xn(e,a))}getAllMutationBatchesAffectingQuery(e,r){const a=r.path,l=a.length+1,u=uD(this.userId,a),p=IDBKeyRange.lowerBound(u);let m=new os(ir);return pb(e).J({range:p},(v,w,R)=>{const[C,A,O]=v,U=Ef(A);C===this.userId&&a.isPrefixOf(U)?U.length===l&&(m=m.add(O)):R.done()}).next(()=>this.xn(e,m))}xn(e,r){const a=[],l=[];return r.forEach(u=>{l.push(p_(e).get(u).next(p=>{if(p===null)throw cn();yn(p.userId===this.userId),a.push(tv(this.serializer,p))}))}),$e.waitFor(l).next(()=>a)}removeMutationBatch(e,r){return xue(e._e,this.userId,r).next(a=>(e.addOnCommittedListener(()=>{this.On(r.batchId)}),$e.forEach(a,l=>this.referenceDelegate.markPotentiallyOrphaned(e,l))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(r=>{if(!r)return $e.resolve();const a=IDBKeyRange.lowerBound(function(p){return[p]}(this.userId)),l=[];return pb(e).J({range:a},(u,p,m)=>{if(u[0]===this.userId){const v=Ef(u[1]);l.push(v)}else m.done()}).next(()=>{yn(l.length===0)})})}containsKey(e,r){return bue(e,this.userId,r)}Nn(e){return wue(e).get(this.userId).next(r=>r||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function bue(t,e,r){const a=uD(e,r.path),l=a[1],u=IDBKeyRange.lowerBound(a);let p=!1;return pb(t).J({range:u,H:!0},(m,v,w)=>{const[R,C,A]=m;R===e&&C===l&&(p=!0),w.done()}).next(()=>p)}function p_(t){return wo(t,"mutations")}function pb(t){return wo(t,"documentMutations")}function wue(t){return wo(t,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pv{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Pv(0)}static kn(){return new Pv(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pDe{constructor(e,r){this.referenceDelegate=e,this.serializer=r}allocateTargetId(e){return this.qn(e).next(r=>{const a=new Pv(r.highestTargetId);return r.highestTargetId=a.next(),this.Qn(e,r).next(()=>r.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(r=>Sn.fromTimestamp(new fn(r.lastRemoteSnapshotVersion.seconds,r.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(r=>r.highestListenSequenceNumber)}setTargetsMetadata(e,r,a){return this.qn(e).next(l=>(l.highestListenSequenceNumber=r,a&&(l.lastRemoteSnapshotVersion=a.toTimestamp()),r>l.highestListenSequenceNumber&&(l.highestListenSequenceNumber=r),this.Qn(e,l)))}addTargetData(e,r){return this.Kn(e,r).next(()=>this.qn(e).next(a=>(a.targetCount+=1,this.$n(r,a),this.Qn(e,a))))}updateTargetData(e,r){return this.Kn(e,r)}removeTargetData(e,r){return this.removeMatchingKeysForTargetId(e,r.targetId).next(()=>ib(e).delete(r.targetId)).next(()=>this.qn(e)).next(a=>(yn(a.targetCount>0),a.targetCount-=1,this.Qn(e,a)))}removeTargets(e,r,a){let l=0;const u=[];return ib(e).J((p,m)=>{const v=gC(m);v.sequenceNumber<=r&&a.get(v.targetId)===null&&(l++,u.push(this.removeTargetData(e,v)))}).next(()=>$e.waitFor(u)).next(()=>l)}forEachTarget(e,r){return ib(e).J((a,l)=>{const u=gC(l);r(u)})}qn(e){return kre(e).get("targetGlobalKey").next(r=>(yn(r!==null),r))}Qn(e,r){return kre(e).put("targetGlobalKey",r)}Kn(e,r){return ib(e).put(yue(this.serializer,r))}$n(e,r){let a=!1;return e.targetId>r.highestTargetId&&(r.highestTargetId=e.targetId,a=!0),e.sequenceNumber>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=e.sequenceNumber,a=!0),a}getTargetCount(e){return this.qn(e).next(r=>r.targetCount)}getTargetData(e,r){const a=Cv(r),l=IDBKeyRange.bound([a,Number.NEGATIVE_INFINITY],[a,Number.POSITIVE_INFINITY]);let u=null;return ib(e).J({range:l,index:"queryTargetsIndex"},(p,m,v)=>{const w=gC(m);QN(r,w.target)&&(u=w,v.done())}).next(()=>u)}addMatchingKeys(e,r,a){const l=[],u=T_(e);return r.forEach(p=>{const m=il(p.path);l.push(u.put({targetId:a,path:m})),l.push(this.referenceDelegate.addReference(e,a,p))}),$e.waitFor(l)}removeMatchingKeys(e,r,a){const l=T_(e);return $e.forEach(r,u=>{const p=il(u.path);return $e.waitFor([l.delete([a,p]),this.referenceDelegate.removeReference(e,a,u)])})}removeMatchingKeysForTargetId(e,r){const a=T_(e),l=IDBKeyRange.bound([r],[r+1],!1,!0);return a.delete(l)}getMatchingKeysForTargetId(e,r){const a=IDBKeyRange.bound([r],[r+1],!1,!0),l=T_(e);let u=Nr();return l.J({range:a,H:!0},(p,m,v)=>{const w=Ef(p[1]),R=new Kt(w);u=u.add(R)}).next(()=>u)}containsKey(e,r){const a=il(r.path),l=IDBKeyRange.bound([a],[hde(a)],!1,!0);let u=0;return T_(e).J({index:"documentTargetsIndex",H:!0,range:l},([p,m],v,w)=>{p!==0&&(u++,w.done())}).next(()=>u>0)}ot(e,r){return ib(e).get(r).next(a=>a?gC(a):null)}}function ib(t){return wo(t,"targets")}function kre(t){return wo(t,"targetGlobal")}function T_(t){return wo(t,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pre([t,e],[r,a]){const l=ir(t,r);return l===0?ir(e,a):l}class fDe{constructor(e){this.Un=e,this.buffer=new os(Pre),this.Wn=0}Gn(){return++this.Wn}zn(e){const r=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(r);else{const a=this.buffer.last();Pre(r,a)<0&&(this.buffer=this.buffer.delete(a).add(r))}}get maxValue(){return this.buffer.last()[0]}}class Sue{constructor(e,r,a){this.garbageCollector=e,this.asyncQueue=r,this.localStore=a,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){Pt("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(r){f0(r)?Pt("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",r):await p0(r)}await this.Hn(3e5)})}}class mDe{constructor(e,r){this.Jn=e,this.params=r}calculateTargetCount(e,r){return this.Jn.Yn(e).next(a=>Math.floor(r/100*a))}nthSequenceNumber(e,r){if(r===0)return $e.resolve(od.oe);const a=new fDe(r);return this.Jn.forEachTarget(e,l=>a.zn(l.sequenceNumber)).next(()=>this.Jn.Zn(e,l=>a.zn(l))).next(()=>a.maxValue)}removeTargets(e,r,a){return this.Jn.removeTargets(e,r,a)}removeOrphanedDocuments(e,r){return this.Jn.removeOrphanedDocuments(e,r)}collect(e,r){return this.params.cacheSizeCollectionThreshold===-1?(Pt("LruGarbageCollector","Garbage collection skipped; disabled"),$e.resolve(Are)):this.getCacheSize(e).next(a=>a<this.params.cacheSizeCollectionThreshold?(Pt("LruGarbageCollector",`Garbage collection skipped; Cache size ${a} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Are):this.Xn(e,r))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,r){let a,l,u,p,m,v,w;const R=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(C=>(C>this.params.maximumSequenceNumbersToCollect?(Pt("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${C}`),l=this.params.maximumSequenceNumbersToCollect):l=C,p=Date.now(),this.nthSequenceNumber(e,l))).next(C=>(a=C,m=Date.now(),this.removeTargets(e,a,r))).next(C=>(u=C,v=Date.now(),this.removeOrphanedDocuments(e,a))).next(C=>(w=Date.now(),db()<=oi.DEBUG&&Pt("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${p-R}ms
	Determined least recently used ${l} in `+(m-p)+`ms
	Removed ${u} targets in `+(v-m)+`ms
	Removed ${C} documents in `+(w-v)+`ms
Total Duration: ${w-R}ms`),$e.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:u,documentsRemoved:C})))}}function Tue(t,e){return new mDe(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gDe{constructor(e,r){this.db=e,this.garbageCollector=Tue(this,r)}Yn(e){const r=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(a=>r.next(l=>a+l))}er(e){let r=0;return this.Zn(e,a=>{r++}).next(()=>r)}forEachTarget(e,r){return this.db.getTargetCache().forEachTarget(e,r)}Zn(e,r){return this.tr(e,(a,l)=>r(l))}addReference(e,r,a){return A2(e,a)}removeReference(e,r,a){return A2(e,a)}removeTargets(e,r,a){return this.db.getTargetCache().removeTargets(e,r,a)}markPotentiallyOrphaned(e,r){return A2(e,r)}nr(e,r){return function(l,u){let p=!1;return wue(l).Y(m=>bue(l,m,u).next(v=>(v&&(p=!0),$e.resolve(!v)))).next(()=>p)}(e,r)}removeOrphanedDocuments(e,r){const a=this.db.getRemoteDocumentCache().newChangeBuffer(),l=[];let u=0;return this.tr(e,(p,m)=>{if(m<=r){const v=this.nr(e,p).next(w=>{if(!w)return u++,a.getEntry(e,p).next(()=>(a.removeEntry(p,Sn.min()),T_(e).delete(function(C){return[0,il(C.path)]}(p))))});l.push(v)}}).next(()=>$e.waitFor(l)).next(()=>a.apply(e)).next(()=>u)}removeTarget(e,r){const a=r.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,a)}updateLimboDocument(e,r){return A2(e,r)}tr(e,r){const a=T_(e);let l,u=od.oe;return a.J({index:"documentTargetsIndex"},([p,m],{path:v,sequenceNumber:w})=>{p===0?(u!==od.oe&&r(new Kt(Ef(l)),u),u=w,l=v):u=od.oe}).next(()=>{u!==od.oe&&r(new Kt(Ef(l)),u)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function A2(t,e){return T_(t).put(function(a,l){return{targetId:0,path:il(a.path),sequenceNumber:l}}(e,t.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rue{constructor(){this.changes=new rg(e=>e.toString(),(e,r)=>e.isEqual(r)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,r){this.assertNotApplied(),this.changes.set(e,js.newInvalidDocument(e).setReadTime(r))}getEntry(e,r){this.assertNotApplied();const a=this.changes.get(r);return a!==void 0?$e.resolve(a):this.getFromCache(e,r)}getEntries(e,r){return this.getAllFromCache(e,r)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _De{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,r,a){return Gy(e).put(a)}removeEntry(e,r,a){return Gy(e).delete(function(u,p){const m=u.path.toArray();return[m.slice(0,m.length-2),m[m.length-2],oO(p),m[m.length-1]]}(r,a))}updateMetadata(e,r){return this.getMetadata(e).next(a=>(a.byteSize+=r,this.rr(e,a)))}getEntry(e,r){let a=js.newInvalidDocument(r);return Gy(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(QR(r))},(l,u)=>{a=this.ir(r,u)}).next(()=>a)}sr(e,r){let a={size:0,document:js.newInvalidDocument(r)};return Gy(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(QR(r))},(l,u)=>{a={document:this.ir(r,u),size:lO(u)}}).next(()=>a)}getEntries(e,r){let a=ld();return this._r(e,r,(l,u)=>{const p=this.ir(l,u);a=a.insert(l,p)}).next(()=>a)}ar(e,r){let a=ld(),l=new Rs(Kt.comparator);return this._r(e,r,(u,p)=>{const m=this.ir(u,p);a=a.insert(u,m),l=l.insert(u,lO(p))}).next(()=>({documents:a,ur:l}))}_r(e,r,a){if(r.isEmpty())return $e.resolve();let l=new os(Lre);r.forEach(v=>l=l.add(v));const u=IDBKeyRange.bound(QR(l.first()),QR(l.last())),p=l.getIterator();let m=p.getNext();return Gy(e).J({index:"documentKeyIndex",range:u},(v,w,R)=>{const C=Kt.fromSegments([...w.prefixPath,w.collectionGroup,w.documentId]);for(;m&&Lre(m,C)<0;)a(m,null),m=p.getNext();m&&m.isEqual(C)&&(a(m,w),m=p.hasNext()?p.getNext():null),m?R.$(QR(m)):R.done()}).next(()=>{for(;m;)a(m,null),m=p.hasNext()?p.getNext():null})}getDocumentsMatchingQuery(e,r,a,l,u){const p=r.path,m=[p.popLast().toArray(),p.lastSegment(),oO(a.readTime),a.documentKey.path.isEmpty()?"":a.documentKey.path.lastSegment()],v=[p.popLast().toArray(),p.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Gy(e).U(IDBKeyRange.bound(m,v,!0)).next(w=>{u==null||u.incrementDocumentReadCount(w.length);let R=ld();for(const C of w){const A=this.ir(Kt.fromSegments(C.prefixPath.concat(C.collectionGroup,C.documentId)),C);A.isFoundDocument()&&(eI(r,A)||l.has(A.key))&&(R=R.insert(A.key,A))}return R})}getAllFromCollectionGroup(e,r,a,l){let u=ld();const p=Ore(r,a),m=Ore(r,Qd.max());return Gy(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(p,m,!0)},(v,w,R)=>{const C=this.ir(Kt.fromSegments(w.prefixPath.concat(w.collectionGroup,w.documentId)),w);u=u.insert(C.key,C),u.size===l&&R.done()}).next(()=>u)}newChangeBuffer(e){return new yDe(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(r=>r.byteSize)}getMetadata(e){return Dre(e).get("remoteDocumentGlobalKey").next(r=>(yn(!!r),r))}rr(e,r){return Dre(e).put("remoteDocumentGlobalKey",r)}ir(e,r){if(r){const a=rDe(this.serializer,r);if(!(a.isNoDocument()&&a.version.isEqual(Sn.min())))return a}return js.newInvalidDocument(e)}}function Cue(t){return new _De(t)}class yDe extends Rue{constructor(e,r){super(),this.cr=e,this.trackRemovals=r,this.lr=new rg(a=>a.toString(),(a,l)=>a.isEqual(l))}applyChanges(e){const r=[];let a=0,l=new os((u,p)=>ir(u.canonicalString(),p.canonicalString()));return this.changes.forEach((u,p)=>{const m=this.lr.get(u);if(r.push(this.cr.removeEntry(e,u,m.readTime)),p.isValidDocument()){const v=vre(this.cr.serializer,p);l=l.add(u.path.popLast());const w=lO(v);a+=w-m.size,r.push(this.cr.addEntry(e,u,v))}else if(a-=m.size,this.trackRemovals){const v=vre(this.cr.serializer,p.convertToNoDocument(Sn.min()));r.push(this.cr.addEntry(e,u,v))}}),l.forEach(u=>{r.push(this.cr.indexManager.addToCollectionParentIndex(e,u))}),r.push(this.cr.updateMetadata(e,a)),$e.waitFor(r)}getFromCache(e,r){return this.cr.sr(e,r).next(a=>(this.lr.set(r,{size:a.size,readTime:a.document.readTime}),a.document))}getAllFromCache(e,r){return this.cr.ar(e,r).next(({documents:a,ur:l})=>(l.forEach((u,p)=>{this.lr.set(u,{size:p,readTime:a.get(u).readTime})}),a))}}function Dre(t){return wo(t,"remoteDocumentGlobal")}function Gy(t){return wo(t,"remoteDocumentsV14")}function QR(t){const e=t.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Ore(t,e){const r=e.documentKey.path.toArray();return[t,oO(e.readTime),r.slice(0,r.length-2),r.length>0?r[r.length-1]:""]}function Lre(t,e){const r=t.path.toArray(),a=e.path.toArray();let l=0;for(let u=0;u<r.length-2&&u<a.length-2;++u)if(l=ir(r[u],a[u]),l)return l;return l=ir(r.length,a.length),l||(l=ir(r[r.length-2],a[a.length-2]),l||ir(r[r.length-1],a[a.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vDe{constructor(e,r){this.overlayedDocument=e,this.mutatedFields=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nue{constructor(e,r,a,l){this.remoteDocumentCache=e,this.mutationQueue=r,this.documentOverlayCache=a,this.indexManager=l}getDocument(e,r){let a=null;return this.documentOverlayCache.getOverlay(e,r).next(l=>(a=l,this.remoteDocumentCache.getEntry(e,r))).next(l=>(a!==null&&jC(a.mutation,l,cd.empty(),fn.now()),l))}getDocuments(e,r){return this.remoteDocumentCache.getEntries(e,r).next(a=>this.getLocalViewOfDocuments(e,a,Nr()).next(()=>a))}getLocalViewOfDocuments(e,r,a=Nr()){const l=xf();return this.populateOverlays(e,l,r).next(()=>this.computeViews(e,r,l,a).next(u=>{let p=fC();return u.forEach((m,v)=>{p=p.insert(m,v.overlayedDocument)}),p}))}getOverlayedDocuments(e,r){const a=xf();return this.populateOverlays(e,a,r).next(()=>this.computeViews(e,r,a,Nr()))}populateOverlays(e,r,a){const l=[];return a.forEach(u=>{r.has(u)||l.push(u)}),this.documentOverlayCache.getOverlays(e,l).next(u=>{u.forEach((p,m)=>{r.set(p,m)})})}computeViews(e,r,a,l){let u=ld();const p=LC(),m=function(){return LC()}();return r.forEach((v,w)=>{const R=a.get(w.key);l.has(w.key)&&(R===void 0||R.mutation instanceof ig)?u=u.insert(w.key,w):R!==void 0?(p.set(w.key,R.mutation.getFieldMask()),jC(R.mutation,w,R.mutation.getFieldMask(),fn.now())):p.set(w.key,cd.empty())}),this.recalculateAndSaveOverlays(e,u).next(v=>(v.forEach((w,R)=>p.set(w,R)),r.forEach((w,R)=>{var C;return m.set(w,new vDe(R,(C=p.get(w))!==null&&C!==void 0?C:null))}),m))}recalculateAndSaveOverlays(e,r){const a=LC();let l=new Rs((p,m)=>p-m),u=Nr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,r).next(p=>{for(const m of p)m.keys().forEach(v=>{const w=r.get(v);if(w===null)return;let R=a.get(v)||cd.empty();R=m.applyToLocalView(w,R),a.set(v,R);const C=(l.get(m.batchId)||Nr()).add(v);l=l.insert(m.batchId,C)})}).next(()=>{const p=[],m=l.getReverseIterator();for(;m.hasNext();){const v=m.getNext(),w=v.key,R=v.value,C=Wde();R.forEach(A=>{if(!u.has(A)){const O=Jde(r.get(A),a.get(A));O!==null&&C.set(A,O),u=u.add(A)}}),p.push(this.documentOverlayCache.saveOverlays(e,w,C))}return $e.waitFor(p)}).next(()=>a)}recalculateAndSaveOverlaysForDocumentKeys(e,r){return this.remoteDocumentCache.getEntries(e,r).next(a=>this.recalculateAndSaveOverlays(e,a))}getDocumentsMatchingQuery(e,r,a,l){return function(p){return Kt.isDocumentKey(p.path)&&p.collectionGroup===null&&p.filters.length===0}(r)?this.getDocumentsMatchingDocumentQuery(e,r.path):gG(r)?this.getDocumentsMatchingCollectionGroupQuery(e,r,a,l):this.getDocumentsMatchingCollectionQuery(e,r,a,l)}getNextDocuments(e,r,a,l){return this.remoteDocumentCache.getAllFromCollectionGroup(e,r,a,l).next(u=>{const p=l-u.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,r,a.largestBatchId,l-u.size):$e.resolve(xf());let m=-1,v=u;return p.next(w=>$e.forEach(w,(R,C)=>(m<C.largestBatchId&&(m=C.largestBatchId),u.get(R)?$e.resolve():this.remoteDocumentCache.getEntry(e,R).next(A=>{v=v.insert(R,A)}))).next(()=>this.populateOverlays(e,w,u)).next(()=>this.computeViews(e,v,w,Nr())).next(R=>({batchId:m,changes:Gde(R)})))})}getDocumentsMatchingDocumentQuery(e,r){return this.getDocument(e,new Kt(r)).next(a=>{let l=fC();return a.isFoundDocument()&&(l=l.insert(a.key,a)),l})}getDocumentsMatchingCollectionGroupQuery(e,r,a,l){const u=r.collectionGroup;let p=fC();return this.indexManager.getCollectionParents(e,u).next(m=>$e.forEach(m,v=>{const w=function(C,A){return new ng(A,null,C.explicitOrderBy.slice(),C.filters.slice(),C.limit,C.limitType,C.startAt,C.endAt)}(r,v.child(u));return this.getDocumentsMatchingCollectionQuery(e,w,a,l).next(R=>{R.forEach((C,A)=>{p=p.insert(C,A)})})}).next(()=>p))}getDocumentsMatchingCollectionQuery(e,r,a,l){let u;return this.documentOverlayCache.getOverlaysForCollection(e,r.path,a.largestBatchId).next(p=>(u=p,this.remoteDocumentCache.getDocumentsMatchingQuery(e,r,a,u,l))).next(p=>{u.forEach((v,w)=>{const R=w.getKey();p.get(R)===null&&(p=p.insert(R,js.newInvalidDocument(R)))});let m=fC();return p.forEach((v,w)=>{const R=u.get(v);R!==void 0&&jC(R.mutation,w,cd.empty(),fn.now()),eI(r,w)&&(m=m.insert(v,w))}),m})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EDe{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,r){return $e.resolve(this.hr.get(r))}saveBundleMetadata(e,r){return this.hr.set(r.id,function(l){return{id:l.id,version:l.version,createTime:Va(l.createTime)}}(r)),$e.resolve()}getNamedQuery(e,r){return $e.resolve(this.Pr.get(r))}saveNamedQuery(e,r){return this.Pr.set(r.name,function(l){return{name:l.name,query:TG(l.bundledQuery),readTime:Va(l.readTime)}}(r)),$e.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xDe{constructor(){this.overlays=new Rs(Kt.comparator),this.Ir=new Map}getOverlay(e,r){return $e.resolve(this.overlays.get(r))}getOverlays(e,r){const a=xf();return $e.forEach(r,l=>this.getOverlay(e,l).next(u=>{u!==null&&a.set(l,u)})).next(()=>a)}saveOverlays(e,r,a){return a.forEach((l,u)=>{this.ht(e,r,u)}),$e.resolve()}removeOverlaysForBatchId(e,r,a){const l=this.Ir.get(a);return l!==void 0&&(l.forEach(u=>this.overlays=this.overlays.remove(u)),this.Ir.delete(a)),$e.resolve()}getOverlaysForCollection(e,r,a){const l=xf(),u=r.length+1,p=new Kt(r.child("")),m=this.overlays.getIteratorFrom(p);for(;m.hasNext();){const v=m.getNext().value,w=v.getKey();if(!r.isPrefixOf(w.path))break;w.path.length===u&&v.largestBatchId>a&&l.set(v.getKey(),v)}return $e.resolve(l)}getOverlaysForCollectionGroup(e,r,a,l){let u=new Rs((w,R)=>w-R);const p=this.overlays.getIterator();for(;p.hasNext();){const w=p.getNext().value;if(w.getKey().getCollectionGroup()===r&&w.largestBatchId>a){let R=u.get(w.largestBatchId);R===null&&(R=xf(),u=u.insert(w.largestBatchId,R)),R.set(w.getKey(),w)}}const m=xf(),v=u.getIterator();for(;v.hasNext()&&(v.getNext().value.forEach((w,R)=>m.set(w,R)),!(m.size()>=l)););return $e.resolve(m)}ht(e,r,a){const l=this.overlays.get(a.key);if(l!==null){const p=this.Ir.get(l.largestBatchId).delete(a.key);this.Ir.set(l.largestBatchId,p)}this.overlays=this.overlays.insert(a.key,new bG(r,a));let u=this.Ir.get(r);u===void 0&&(u=Nr(),this.Ir.set(r,u)),this.Ir.set(r,u.add(a.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bDe{constructor(){this.sessionToken=_a.EMPTY_BYTE_STRING}getSessionToken(e){return $e.resolve(this.sessionToken)}setSessionToken(e,r){return this.sessionToken=r,$e.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NG{constructor(){this.Tr=new os(zo.Er),this.dr=new os(zo.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,r){const a=new zo(e,r);this.Tr=this.Tr.add(a),this.dr=this.dr.add(a)}Rr(e,r){e.forEach(a=>this.addReference(a,r))}removeReference(e,r){this.Vr(new zo(e,r))}mr(e,r){e.forEach(a=>this.removeReference(a,r))}gr(e){const r=new Kt(new li([])),a=new zo(r,e),l=new zo(r,e+1),u=[];return this.dr.forEachInRange([a,l],p=>{this.Vr(p),u.push(p.key)}),u}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const r=new Kt(new li([])),a=new zo(r,e),l=new zo(r,e+1);let u=Nr();return this.dr.forEachInRange([a,l],p=>{u=u.add(p.key)}),u}containsKey(e){const r=new zo(e,0),a=this.Tr.firstAfterOrEqual(r);return a!==null&&e.isEqual(a.key)}}class zo{constructor(e,r){this.key=e,this.wr=r}static Er(e,r){return Kt.comparator(e.key,r.key)||ir(e.wr,r.wr)}static Ar(e,r){return ir(e.wr,r.wr)||Kt.comparator(e.key,r.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wDe{constructor(e,r){this.indexManager=e,this.referenceDelegate=r,this.mutationQueue=[],this.Sr=1,this.br=new os(zo.Er)}checkEmpty(e){return $e.resolve(this.mutationQueue.length===0)}addMutationBatch(e,r,a,l){const u=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const p=new EG(u,r,a,l);this.mutationQueue.push(p);for(const m of l)this.br=this.br.add(new zo(m.key,u)),this.indexManager.addToCollectionParentIndex(e,m.key.path.popLast());return $e.resolve(p)}lookupMutationBatch(e,r){return $e.resolve(this.Dr(r))}getNextMutationBatchAfterBatchId(e,r){const a=r+1,l=this.vr(a),u=l<0?0:l;return $e.resolve(this.mutationQueue.length>u?this.mutationQueue[u]:null)}getHighestUnacknowledgedBatchId(){return $e.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return $e.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,r){const a=new zo(r,0),l=new zo(r,Number.POSITIVE_INFINITY),u=[];return this.br.forEachInRange([a,l],p=>{const m=this.Dr(p.wr);u.push(m)}),$e.resolve(u)}getAllMutationBatchesAffectingDocumentKeys(e,r){let a=new os(ir);return r.forEach(l=>{const u=new zo(l,0),p=new zo(l,Number.POSITIVE_INFINITY);this.br.forEachInRange([u,p],m=>{a=a.add(m.wr)})}),$e.resolve(this.Cr(a))}getAllMutationBatchesAffectingQuery(e,r){const a=r.path,l=a.length+1;let u=a;Kt.isDocumentKey(u)||(u=u.child(""));const p=new zo(new Kt(u),0);let m=new os(ir);return this.br.forEachWhile(v=>{const w=v.key.path;return!!a.isPrefixOf(w)&&(w.length===l&&(m=m.add(v.wr)),!0)},p),$e.resolve(this.Cr(m))}Cr(e){const r=[];return e.forEach(a=>{const l=this.Dr(a);l!==null&&r.push(l)}),r}removeMutationBatch(e,r){yn(this.Fr(r.batchId,"removed")===0),this.mutationQueue.shift();let a=this.br;return $e.forEach(r.mutations,l=>{const u=new zo(l.key,r.batchId);return a=a.delete(u),this.referenceDelegate.markPotentiallyOrphaned(e,l.key)}).next(()=>{this.br=a})}On(e){}containsKey(e,r){const a=new zo(r,0),l=this.br.firstAfterOrEqual(a);return $e.resolve(r.isEqual(l&&l.key))}performConsistencyCheck(e){return this.mutationQueue.length,$e.resolve()}Fr(e,r){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const r=this.vr(e);return r<0||r>=this.mutationQueue.length?null:this.mutationQueue[r]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SDe{constructor(e){this.Mr=e,this.docs=function(){return new Rs(Kt.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,r){const a=r.key,l=this.docs.get(a),u=l?l.size:0,p=this.Mr(r);return this.docs=this.docs.insert(a,{document:r.mutableCopy(),size:p}),this.size+=p-u,this.indexManager.addToCollectionParentIndex(e,a.path.popLast())}removeEntry(e){const r=this.docs.get(e);r&&(this.docs=this.docs.remove(e),this.size-=r.size)}getEntry(e,r){const a=this.docs.get(r);return $e.resolve(a?a.document.mutableCopy():js.newInvalidDocument(r))}getEntries(e,r){let a=ld();return r.forEach(l=>{const u=this.docs.get(l);a=a.insert(l,u?u.document.mutableCopy():js.newInvalidDocument(l))}),$e.resolve(a)}getDocumentsMatchingQuery(e,r,a,l){let u=ld();const p=r.path,m=new Kt(p.child("")),v=this.docs.getIteratorFrom(m);for(;v.hasNext();){const{key:w,value:{document:R}}=v.getNext();if(!p.isPrefixOf(w.path))break;w.path.length>p.length+1||hG(fde(R),a)<=0||(l.has(R.key)||eI(r,R))&&(u=u.insert(R.key,R.mutableCopy()))}return $e.resolve(u)}getAllFromCollectionGroup(e,r,a,l){cn()}Or(e,r){return $e.forEach(this.docs,a=>r(a))}newChangeBuffer(e){return new TDe(this)}getSize(e){return $e.resolve(this.size)}}class TDe extends Rue{constructor(e){super(),this.cr=e}applyChanges(e){const r=[];return this.changes.forEach((a,l)=>{l.isValidDocument()?r.push(this.cr.addEntry(e,l)):this.cr.removeEntry(a)}),$e.waitFor(r)}getFromCache(e,r){return this.cr.getEntry(e,r)}getAllFromCache(e,r){return this.cr.getEntries(e,r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RDe{constructor(e){this.persistence=e,this.Nr=new rg(r=>Cv(r),QN),this.lastRemoteSnapshotVersion=Sn.min(),this.highestTargetId=0,this.Lr=0,this.Br=new NG,this.targetCount=0,this.kr=Pv.Bn()}forEachTarget(e,r){return this.Nr.forEach((a,l)=>r(l)),$e.resolve()}getLastRemoteSnapshotVersion(e){return $e.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return $e.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),$e.resolve(this.highestTargetId)}setTargetsMetadata(e,r,a){return a&&(this.lastRemoteSnapshotVersion=a),r>this.Lr&&(this.Lr=r),$e.resolve()}Kn(e){this.Nr.set(e.target,e);const r=e.targetId;r>this.highestTargetId&&(this.kr=new Pv(r),this.highestTargetId=r),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,r){return this.Kn(r),this.targetCount+=1,$e.resolve()}updateTargetData(e,r){return this.Kn(r),$e.resolve()}removeTargetData(e,r){return this.Nr.delete(r.target),this.Br.gr(r.targetId),this.targetCount-=1,$e.resolve()}removeTargets(e,r,a){let l=0;const u=[];return this.Nr.forEach((p,m)=>{m.sequenceNumber<=r&&a.get(m.targetId)===null&&(this.Nr.delete(p),u.push(this.removeMatchingKeysForTargetId(e,m.targetId)),l++)}),$e.waitFor(u).next(()=>l)}getTargetCount(e){return $e.resolve(this.targetCount)}getTargetData(e,r){const a=this.Nr.get(r)||null;return $e.resolve(a)}addMatchingKeys(e,r,a){return this.Br.Rr(r,a),$e.resolve()}removeMatchingKeys(e,r,a){this.Br.mr(r,a);const l=this.persistence.referenceDelegate,u=[];return l&&r.forEach(p=>{u.push(l.markPotentiallyOrphaned(e,p))}),$e.waitFor(u)}removeMatchingKeysForTargetId(e,r){return this.Br.gr(r),$e.resolve()}getMatchingKeysForTargetId(e,r){const a=this.Br.yr(r);return $e.resolve(a)}containsKey(e,r){return $e.resolve(this.Br.containsKey(r))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IG{constructor(e,r){this.qr={},this.overlays={},this.Qr=new od(0),this.Kr=!1,this.Kr=!0,this.$r=new bDe,this.referenceDelegate=e(this),this.Ur=new RDe(this),this.indexManager=new uDe,this.remoteDocumentCache=function(l){return new SDe(l)}(a=>this.referenceDelegate.Wr(a)),this.serializer=new _ue(r),this.Gr=new EDe(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let r=this.overlays[e.toKey()];return r||(r=new xDe,this.overlays[e.toKey()]=r),r}getMutationQueue(e,r){let a=this.qr[e.toKey()];return a||(a=new wDe(r,this.referenceDelegate),this.qr[e.toKey()]=a),a}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,r,a){Pt("MemoryPersistence","Starting transaction:",e);const l=new CDe(this.Qr.next());return this.referenceDelegate.zr(),a(l).next(u=>this.referenceDelegate.jr(l).next(()=>u)).toPromise().then(u=>(l.raiseOnCommittedEvent(),u))}Hr(e,r){return $e.or(Object.values(this.qr).map(a=>()=>a.containsKey(e,r)))}}class CDe extends gde{constructor(e){super(),this.currentSequenceNumber=e}}class TL{constructor(e){this.persistence=e,this.Jr=new NG,this.Yr=null}static Zr(e){return new TL(e)}get Xr(){if(this.Yr)return this.Yr;throw cn()}addReference(e,r,a){return this.Jr.addReference(a,r),this.Xr.delete(a.toString()),$e.resolve()}removeReference(e,r,a){return this.Jr.removeReference(a,r),this.Xr.add(a.toString()),$e.resolve()}markPotentiallyOrphaned(e,r){return this.Xr.add(r.toString()),$e.resolve()}removeTarget(e,r){this.Jr.gr(r.targetId).forEach(l=>this.Xr.add(l.toString()));const a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(e,r.targetId).next(l=>{l.forEach(u=>this.Xr.add(u.toString()))}).next(()=>a.removeTargetData(e,r))}zr(){this.Yr=new Set}jr(e){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return $e.forEach(this.Xr,a=>{const l=Kt.fromPath(a);return this.ei(e,l).next(u=>{u||r.removeEntry(l,Sn.min())})}).next(()=>(this.Yr=null,r.apply(e)))}updateLimboDocument(e,r){return this.ei(e,r).next(a=>{a?this.Xr.delete(r.toString()):this.Xr.add(r.toString())})}Wr(e){return 0}ei(e,r){return $e.or([()=>$e.resolve(this.Jr.containsKey(r)),()=>this.persistence.getTargetCache().containsKey(e,r),()=>this.persistence.Hr(e,r)])}}class dO{constructor(e,r){this.persistence=e,this.ti=new rg(a=>il(a.path),(a,l)=>a.isEqual(l)),this.garbageCollector=Tue(this,r)}static Zr(e,r){return new dO(e,r)}zr(){}jr(e){return $e.resolve()}forEachTarget(e,r){return this.persistence.getTargetCache().forEachTarget(e,r)}Yn(e){const r=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(a=>r.next(l=>a+l))}er(e){let r=0;return this.Zn(e,a=>{r++}).next(()=>r)}Zn(e,r){return $e.forEach(this.ti,(a,l)=>this.nr(e,a,l).next(u=>u?$e.resolve():r(l)))}removeTargets(e,r,a){return this.persistence.getTargetCache().removeTargets(e,r,a)}removeOrphanedDocuments(e,r){let a=0;const l=this.persistence.getRemoteDocumentCache(),u=l.newChangeBuffer();return l.Or(e,p=>this.nr(e,p,r).next(m=>{m||(a++,u.removeEntry(p,Sn.min()))})).next(()=>u.apply(e)).next(()=>a)}markPotentiallyOrphaned(e,r){return this.ti.set(r,e.currentSequenceNumber),$e.resolve()}removeTarget(e,r){const a=r.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,a)}addReference(e,r,a){return this.ti.set(a,e.currentSequenceNumber),$e.resolve()}removeReference(e,r,a){return this.ti.set(a,e.currentSequenceNumber),$e.resolve()}updateLimboDocument(e,r){return this.ti.set(r,e.currentSequenceNumber),$e.resolve()}Wr(e){let r=e.key.toString().length;return e.isFoundDocument()&&(r+=pD(e.data.value)),r}nr(e,r,a){return $e.or([()=>this.persistence.Hr(e,r),()=>this.persistence.getTargetCache().containsKey(e,r),()=>{const l=this.ti.get(r);return $e.resolve(l!==void 0&&l>a)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NDe{constructor(e){this.serializer=e}O(e,r,a,l){const u=new gL("createOrUpgrade",r);a<1&&l>=1&&(function(v){v.createObjectStore("owner")}(e),function(v){v.createObjectStore("mutationQueues",{keyPath:"userId"}),v.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",$ne,{unique:!0}),v.createObjectStore("documentMutations")}(e),jre(e),function(v){v.createObjectStore("remoteDocuments")}(e));let p=$e.resolve();return a<3&&l>=3&&(a!==0&&(function(v){v.deleteObjectStore("targetDocuments"),v.deleteObjectStore("targets"),v.deleteObjectStore("targetGlobal")}(e),jre(e)),p=p.next(()=>function(v){const w=v.store("targetGlobal"),R={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Sn.min().toTimestamp(),targetCount:0};return w.put("targetGlobalKey",R)}(u))),a<4&&l>=4&&(a!==0&&(p=p.next(()=>function(v,w){return w.store("mutations").U().next(R=>{v.deleteObjectStore("mutations"),v.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",$ne,{unique:!0});const C=w.store("mutations"),A=R.map(O=>C.put(O));return $e.waitFor(A)})}(e,u))),p=p.next(()=>{(function(v){v.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),a<5&&l>=5&&(p=p.next(()=>this.ni(u))),a<6&&l>=6&&(p=p.next(()=>(function(v){v.createObjectStore("remoteDocumentGlobal")}(e),this.ri(u)))),a<7&&l>=7&&(p=p.next(()=>this.ii(u))),a<8&&l>=8&&(p=p.next(()=>this.si(e,u))),a<9&&l>=9&&(p=p.next(()=>{(function(v){v.objectStoreNames.contains("remoteDocumentChanges")&&v.deleteObjectStore("remoteDocumentChanges")})(e)})),a<10&&l>=10&&(p=p.next(()=>this.oi(u))),a<11&&l>=11&&(p=p.next(()=>{(function(v){v.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(v){v.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),a<12&&l>=12&&(p=p.next(()=>{(function(v){const w=v.createObjectStore("documentOverlays",{keyPath:u2e});w.createIndex("collectionPathOverlayIndex",h2e,{unique:!1}),w.createIndex("collectionGroupOverlayIndex",p2e,{unique:!1})})(e)})),a<13&&l>=13&&(p=p.next(()=>function(v){const w=v.createObjectStore("remoteDocumentsV14",{keyPath:e2e});w.createIndex("documentKeyIndex",t2e),w.createIndex("collectionGroupIndex",n2e)}(e)).next(()=>this._i(e,u)).next(()=>e.deleteObjectStore("remoteDocuments"))),a<14&&l>=14&&(p=p.next(()=>this.ai(e,u))),a<15&&l>=15&&(p=p.next(()=>function(v){v.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),v.createObjectStore("indexState",{keyPath:o2e}).createIndex("sequenceNumberIndex",c2e,{unique:!1}),v.createObjectStore("indexEntries",{keyPath:l2e}).createIndex("documentKeyIndex",d2e,{unique:!1})}(e))),a<16&&l>=16&&(p=p.next(()=>{r.objectStore("indexState").clear()}).next(()=>{r.objectStore("indexEntries").clear()})),a<17&&l>=17&&(p=p.next(()=>{(function(v){v.createObjectStore("globals",{keyPath:"name"})})(e)})),p}ri(e){let r=0;return e.store("remoteDocuments").J((a,l)=>{r+=lO(l)}).next(()=>{const a={byteSize:r};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",a)})}ni(e){const r=e.store("mutationQueues"),a=e.store("mutations");return r.U().next(l=>$e.forEach(l,u=>{const p=IDBKeyRange.bound([u.userId,-1],[u.userId,u.lastAcknowledgedBatchId]);return a.U("userMutationsIndex",p).next(m=>$e.forEach(m,v=>{yn(v.userId===u.userId);const w=tv(this.serializer,v);return xue(e,u.userId,w).next(()=>{})}))}))}ii(e){const r=e.store("targetDocuments"),a=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(l=>{const u=[];return a.J((p,m)=>{const v=new li(p),w=function(C){return[0,il(C)]}(v);u.push(r.get(w).next(R=>R?$e.resolve():(C=>r.put({targetId:0,path:il(C),sequenceNumber:l.highestListenSequenceNumber}))(v)))}).next(()=>$e.waitFor(u))})}si(e,r){e.createObjectStore("collectionParents",{keyPath:a2e});const a=r.store("collectionParents"),l=new CG,u=p=>{if(l.add(p)){const m=p.lastSegment(),v=p.popLast();return a.put({collectionId:m,parent:il(v)})}};return r.store("remoteDocuments").J({H:!0},(p,m)=>{const v=new li(p);return u(v.popLast())}).next(()=>r.store("documentMutations").J({H:!0},([p,m,v],w)=>{const R=Ef(m);return u(R.popLast())}))}oi(e){const r=e.store("targets");return r.J((a,l)=>{const u=gC(l),p=yue(this.serializer,u);return r.put(p)})}_i(e,r){const a=r.store("remoteDocuments"),l=[];return a.J((u,p)=>{const m=r.store("remoteDocumentsV14"),v=function(C){return C.document?new Kt(li.fromString(C.document.name).popFirst(5)):C.noDocument?Kt.fromSegments(C.noDocument.path):C.unknownDocument?Kt.fromSegments(C.unknownDocument.path):cn()}(p).path.toArray(),w={prefixPath:v.slice(0,v.length-2),collectionGroup:v[v.length-2],documentId:v[v.length-1],readTime:p.readTime||[0,0],unknownDocument:p.unknownDocument,noDocument:p.noDocument,document:p.document,hasCommittedMutations:!!p.hasCommittedMutations};l.push(m.put(w))}).next(()=>$e.waitFor(l))}ai(e,r){const a=r.store("mutations"),l=Cue(this.serializer),u=new IG(TL.Zr,this.serializer.ct);return a.U().next(p=>{const m=new Map;return p.forEach(v=>{var w;let R=(w=m.get(v.userId))!==null&&w!==void 0?w:Nr();tv(this.serializer,v).keys().forEach(C=>R=R.add(C)),m.set(v.userId,R)}),$e.forEach(m,(v,w)=>{const R=new Wo(w),C=wL.lt(this.serializer,R),A=u.getIndexManager(R),O=SL.lt(R,this.serializer,A,u.referenceDelegate);return new Nue(l,O,C,A).recalculateAndSaveOverlaysForDocumentKeys(new G6(r,od.oe),v).next()})})}}function jre(t){t.createObjectStore("targetDocuments",{keyPath:i2e}).createIndex("documentTargetsIndex",s2e,{unique:!0}),t.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",r2e,{unique:!0}),t.createObjectStore("targetGlobal")}const VF="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class AG{constructor(e,r,a,l,u,p,m,v,w,R,C=17){if(this.allowTabSynchronization=e,this.persistenceKey=r,this.clientId=a,this.ui=u,this.window=p,this.document=m,this.ci=w,this.li=R,this.hi=C,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=A=>Promise.resolve(),!AG.D())throw new Nt(ot.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new gDe(this,l),this.Ai=r+"main",this.serializer=new _ue(v),this.Ri=new Rf(this.Ai,this.hi,new NDe(this.serializer)),this.$r=new sDe,this.Ur=new pDe(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Cue(this.serializer),this.Gr=new iDe,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,R===!1&&Ma("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Nt(ot.FAILED_PRECONDITION,VF);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new od(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async r=>{if(this.started)return e(r)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async r=>{r.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>k2(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(r=>{r||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(r=>this.isPrimary&&!r?this.bi(e).next(()=>!1):!!r&&this.Di(e).next(()=>!0))).catch(e=>{if(f0(e))return Pt("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Pt("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return ZR(e).get("owner").next(r=>$e.resolve(this.vi(r)))}Ci(e){return k2(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const a=wo(r,"clientMetadata");return a.U().next(l=>{const u=this.xi(l,18e5),p=l.filter(m=>u.indexOf(m)===-1);return $e.forEach(p,m=>a.delete(m.clientId)).next(()=>p)})}).catch(()=>[]);if(this.Vi)for(const r of e)this.Vi.removeItem(this.Oi(r.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?$e.resolve(!0):ZR(e).get("owner").next(r=>{if(r!==null&&this.Mi(r.leaseTimestampMs,5e3)&&!this.Ni(r.ownerId)){if(this.vi(r)&&this.networkEnabled)return!0;if(!this.vi(r)){if(!r.allowTabSynchronization)throw new Nt(ot.FAILED_PRECONDITION,VF);return!1}}return!(!this.networkEnabled||!this.inForeground)||k2(e).U().next(a=>this.xi(a,5e3).find(l=>{if(this.clientId!==l.clientId){const u=!this.networkEnabled&&l.networkEnabled,p=!this.inForeground&&l.inForeground,m=this.networkEnabled===l.networkEnabled;if(u||p&&m)return!0}return!1})===void 0)}).next(r=>(this.isPrimary!==r&&Pt("IndexedDbPersistence",`Client ${r?"is":"is not"} eligible for a primary lease.`),r))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const r=new G6(e,od.oe);return this.bi(r).next(()=>this.Ci(r))}),this.Ri.close(),this.qi()}xi(e,r){return e.filter(a=>this.Mi(a.updateTimeMs,r)&&!this.Ni(a.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>k2(e).U().next(r=>this.xi(r,18e5).map(a=>a.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,r){return SL.lt(e,this.serializer,r,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new hDe(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return wL.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,r,a){Pt("IndexedDbPersistence","Starting transaction:",e);const l=r==="readonly"?"readonly":"readwrite",u=function(v){return v===17?g2e:v===16?m2e:v===15?fG:v===14?bde:v===13?xde:v===12?f2e:v===11?Ede:void cn()}(this.hi);let p;return this.Ri.runTransaction(e,l,u,m=>(p=new G6(m,this.Qr?this.Qr.next():od.oe),r==="readwrite-primary"?this.wi(p).next(v=>!!v||this.Si(p)).next(v=>{if(!v)throw Ma(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new Nt(ot.FAILED_PRECONDITION,mde);return a(p)}).next(v=>this.Di(p).next(()=>v)):this.Ki(p).next(()=>a(p)))).then(m=>(p.raiseOnCommittedEvent(),m))}Ki(e){return ZR(e).get("owner").next(r=>{if(r!==null&&this.Mi(r.leaseTimestampMs,5e3)&&!this.Ni(r.ownerId)&&!this.vi(r)&&!(this.li||this.allowTabSynchronization&&r.allowTabSynchronization))throw new Nt(ot.FAILED_PRECONDITION,VF)})}Di(e){const r={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ZR(e).put("owner",r)}static D(){return Rf.D()}bi(e){const r=ZR(e);return r.get("owner").next(a=>this.vi(a)?(Pt("IndexedDbPersistence","Releasing primary lease."),r.delete("owner")):$e.resolve())}Mi(e,r){const a=Date.now();return!(e<a-r)&&(!(e>a)||(Ma(`Detected an update time that is in the future: ${e} > ${a}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const r=/(?:Version|Mobile)\/1[456]/;sle()&&(navigator.appVersion.match(r)||navigator.userAgent.match(r))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var r;try{const a=((r=this.Vi)===null||r===void 0?void 0:r.getItem(this.Oi(e)))!==null;return Pt("IndexedDbPersistence",`Client '${e}' ${a?"is":"is not"} zombied in LocalStorage`),a}catch(a){return Ma("IndexedDbPersistence","Failed to get zombied client id.",a),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Ma("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function ZR(t){return wo(t,"owner")}function k2(t){return wo(t,"clientMetadata")}function kG(t,e){let r=t.projectId;return t.isDefaultDatabase||(r+="."+t.database),"firestore/"+e+"/"+r+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PG{constructor(e,r,a,l){this.targetId=e,this.fromCache=r,this.$i=a,this.Ui=l}static Wi(e,r){let a=Nr(),l=Nr();for(const u of r.docChanges)switch(u.type){case 0:a=a.add(u.doc.key);break;case 1:l=l.add(u.doc.key)}return new PG(e,r.fromCache,a,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IDe{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iue{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return sle()?8:_de(vo())>0?6:4}()}initialize(e,r){this.Ji=e,this.indexManager=r,this.Gi=!0}getDocumentsMatchingQuery(e,r,a,l){const u={result:null};return this.Yi(e,r).next(p=>{u.result=p}).next(()=>{if(!u.result)return this.Zi(e,r,l,a).next(p=>{u.result=p})}).next(()=>{if(u.result)return;const p=new IDe;return this.Xi(e,r,p).next(m=>{if(u.result=m,this.zi)return this.es(e,r,p,m.size)})}).next(()=>u.result)}es(e,r,a,l){return a.documentReadCount<this.ji?(db()<=oi.DEBUG&&Pt("QueryEngine","SDK will not create cache indexes for query:",ub(r),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),$e.resolve()):(db()<=oi.DEBUG&&Pt("QueryEngine","Query:",ub(r),"scans",a.documentReadCount,"local documents and returns",l,"documents as results."),a.documentReadCount>this.Hi*l?(db()<=oi.DEBUG&&Pt("QueryEngine","The SDK decides to create cache indexes for query:",ub(r),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,sl(r))):$e.resolve())}Yi(e,r){if(cre(r))return $e.resolve(null);let a=sl(r);return this.indexManager.getIndexType(e,a).next(l=>l===0?null:(r.limit!==null&&l===1&&(r=sO(r,null,"F"),a=sl(r)),this.indexManager.getDocumentsMatchingTarget(e,a).next(u=>{const p=Nr(...u);return this.Ji.getDocuments(e,p).next(m=>this.indexManager.getMinOffset(e,a).next(v=>{const w=this.ts(r,m);return this.ns(r,w,p,v.readTime)?this.Yi(e,sO(r,null,"F")):this.rs(e,w,r,v)}))})))}Zi(e,r,a,l){return cre(r)||l.isEqual(Sn.min())?$e.resolve(null):this.Ji.getDocuments(e,a).next(u=>{const p=this.ts(r,u);return this.ns(r,p,a,l)?$e.resolve(null):(db()<=oi.DEBUG&&Pt("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),ub(r)),this.rs(e,p,r,pde(l,-1)).next(m=>m))})}ts(e,r){let a=new os(Bde(e));return r.forEach((l,u)=>{eI(e,u)&&(a=a.add(u))}),a}ns(e,r,a,l){if(e.limit===null)return!1;if(a.size!==r.size)return!0;const u=e.limitType==="F"?r.last():r.first();return!!u&&(u.hasPendingWrites||u.version.compareTo(l)>0)}Xi(e,r,a){return db()<=oi.DEBUG&&Pt("QueryEngine","Using full collection scan to execute query:",ub(r)),this.Ji.getDocumentsMatchingQuery(e,r,Qd.min(),a)}rs(e,r,a,l){return this.Ji.getDocumentsMatchingQuery(e,a,l).next(u=>(r.forEach(p=>{u=u.insert(p.key,p)}),u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ADe{constructor(e,r,a,l){this.persistence=e,this.ss=r,this.serializer=l,this.os=new Rs(ir),this._s=new rg(u=>Cv(u),QN),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(a)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Nue(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",r=>e.collect(r,this.os))}}function Aue(t,e,r,a){return new ADe(t,e,r,a)}async function kue(t,e){const r=Wt(t);return await r.persistence.runTransaction("Handle user change","readonly",a=>{let l;return r.mutationQueue.getAllMutationBatches(a).next(u=>(l=u,r.ls(e),r.mutationQueue.getAllMutationBatches(a))).next(u=>{const p=[],m=[];let v=Nr();for(const w of l){p.push(w.batchId);for(const R of w.mutations)v=v.add(R.key)}for(const w of u){m.push(w.batchId);for(const R of w.mutations)v=v.add(R.key)}return r.localDocuments.getDocuments(a,v).next(w=>({hs:w,removedBatchIds:p,addedBatchIds:m}))})})}function kDe(t,e){const r=Wt(t);return r.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{const l=e.batch.keys(),u=r.cs.newChangeBuffer({trackRemovals:!0});return function(m,v,w,R){const C=w.batch,A=C.keys();let O=$e.resolve();return A.forEach(U=>{O=O.next(()=>R.getEntry(v,U)).next(F=>{const q=w.docVersions.get(U);yn(q!==null),F.version.compareTo(q)<0&&(C.applyToRemoteDocument(F,w),F.isValidDocument()&&(F.setReadTime(w.commitVersion),R.addEntry(F)))})}),O.next(()=>m.mutationQueue.removeMutationBatch(v,C))}(r,a,e,u).next(()=>u.apply(a)).next(()=>r.mutationQueue.performConsistencyCheck(a)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(a,l,e.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,function(m){let v=Nr();for(let w=0;w<m.mutationResults.length;++w)m.mutationResults[w].transformResults.length>0&&(v=v.add(m.batch.mutations[w].key));return v}(e))).next(()=>r.localDocuments.getDocuments(a,l))})}function Pue(t){const e=Wt(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",r=>e.Ur.getLastRemoteSnapshotVersion(r))}function PDe(t,e){const r=Wt(t),a=e.snapshotVersion;let l=r.os;return r.persistence.runTransaction("Apply remote event","readwrite-primary",u=>{const p=r.cs.newChangeBuffer({trackRemovals:!0});l=r.os;const m=[];e.targetChanges.forEach((R,C)=>{const A=l.get(C);if(!A)return;m.push(r.Ur.removeMatchingKeys(u,R.removedDocuments,C).next(()=>r.Ur.addMatchingKeys(u,R.addedDocuments,C)));let O=A.withSequenceNumber(u.currentSequenceNumber);e.targetMismatches.get(C)!==null?O=O.withResumeToken(_a.EMPTY_BYTE_STRING,Sn.min()).withLastLimboFreeSnapshotVersion(Sn.min()):R.resumeToken.approximateByteSize()>0&&(O=O.withResumeToken(R.resumeToken,a)),l=l.insert(C,O),function(F,q,W){return F.resumeToken.approximateByteSize()===0||q.snapshotVersion.toMicroseconds()-F.snapshotVersion.toMicroseconds()>=3e8?!0:W.addedDocuments.size+W.modifiedDocuments.size+W.removedDocuments.size>0}(A,O,R)&&m.push(r.Ur.updateTargetData(u,O))});let v=ld(),w=Nr();if(e.documentUpdates.forEach(R=>{e.resolvedLimboDocuments.has(R)&&m.push(r.persistence.referenceDelegate.updateLimboDocument(u,R))}),m.push(Due(u,p,e.documentUpdates).next(R=>{v=R.Ps,w=R.Is})),!a.isEqual(Sn.min())){const R=r.Ur.getLastRemoteSnapshotVersion(u).next(C=>r.Ur.setTargetsMetadata(u,u.currentSequenceNumber,a));m.push(R)}return $e.waitFor(m).next(()=>p.apply(u)).next(()=>r.localDocuments.getLocalViewOfDocuments(u,v,w)).next(()=>v)}).then(u=>(r.os=l,u))}function Due(t,e,r){let a=Nr(),l=Nr();return r.forEach(u=>a=a.add(u)),e.getEntries(t,a).next(u=>{let p=ld();return r.forEach((m,v)=>{const w=u.get(m);v.isFoundDocument()!==w.isFoundDocument()&&(l=l.add(m)),v.isNoDocument()&&v.version.isEqual(Sn.min())?(e.removeEntry(m,v.readTime),p=p.insert(m,v)):!w.isValidDocument()||v.version.compareTo(w.version)>0||v.version.compareTo(w.version)===0&&w.hasPendingWrites?(e.addEntry(v),p=p.insert(m,v)):Pt("LocalStore","Ignoring outdated watch update for ",m,". Current version:",w.version," Watch version:",v.version)}),{Ps:p,Is:l}})}function DDe(t,e){const r=Wt(t);return r.persistence.runTransaction("Get next mutation batch","readonly",a=>(e===void 0&&(e=-1),r.mutationQueue.getNextMutationBatchAfterBatchId(a,e)))}function uw(t,e){const r=Wt(t);return r.persistence.runTransaction("Allocate target","readwrite",a=>{let l;return r.Ur.getTargetData(a,e).next(u=>u?(l=u,$e.resolve(l)):r.Ur.allocateTargetId(a).next(p=>(l=new Om(e,p,"TargetPurposeListen",a.currentSequenceNumber),r.Ur.addTargetData(a,l).next(()=>l))))}).then(a=>{const l=r.os.get(a.targetId);return(l===null||a.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(r.os=r.os.insert(a.targetId,a),r._s.set(e,a.targetId)),a})}async function hw(t,e,r){const a=Wt(t),l=a.os.get(e),u=r?"readwrite":"readwrite-primary";try{r||await a.persistence.runTransaction("Release target",u,p=>a.persistence.referenceDelegate.removeTarget(p,l))}catch(p){if(!f0(p))throw p;Pt("LocalStore",`Failed to update sequence numbers for target ${e}: ${p}`)}a.os=a.os.remove(e),a._s.delete(l.target)}function uO(t,e,r){const a=Wt(t);let l=Sn.min(),u=Nr();return a.persistence.runTransaction("Execute query","readwrite",p=>function(v,w,R){const C=Wt(v),A=C._s.get(R);return A!==void 0?$e.resolve(C.os.get(A)):C.Ur.getTargetData(w,R)}(a,p,sl(e)).next(m=>{if(m)return l=m.lastLimboFreeSnapshotVersion,a.Ur.getMatchingKeysForTargetId(p,m.targetId).next(v=>{u=v})}).next(()=>a.ss.getDocumentsMatchingQuery(p,e,r?l:Sn.min(),r?u:Nr())).next(m=>(jue(a,Fde(e),m),{documents:m,Ts:u})))}function Oue(t,e){const r=Wt(t),a=Wt(r.Ur),l=r.os.get(e);return l?Promise.resolve(l.target):r.persistence.runTransaction("Get target data","readonly",u=>a.ot(u,e).next(p=>p?p.target:null))}function Lue(t,e){const r=Wt(t),a=r.us.get(e)||Sn.min();return r.persistence.runTransaction("Get new document changes","readonly",l=>r.cs.getAllFromCollectionGroup(l,e,pde(a,-1),Number.MAX_SAFE_INTEGER)).then(l=>(jue(r,e,l),l))}function jue(t,e,r){let a=t.us.get(e)||Sn.min();r.forEach((l,u)=>{u.readTime.compareTo(a)>0&&(a=u.readTime)}),t.us.set(e,a)}async function ODe(t,e,r,a){const l=Wt(t);let u=Nr(),p=ld();for(const w of r){const R=e.Es(w.metadata.name);w.document&&(u=u.add(R));const C=e.ds(w);C.setReadTime(e.As(w.metadata.readTime)),p=p.insert(R,C)}const m=l.cs.newChangeBuffer({trackRemovals:!0}),v=await uw(l,function(R){return sl(Vw(li.fromString(`__bundle__/docs/${R}`)))}(a));return l.persistence.runTransaction("Apply bundle documents","readwrite",w=>Due(w,m,p).next(R=>(m.apply(w),R)).next(R=>l.Ur.removeMatchingKeysForTargetId(w,v.targetId).next(()=>l.Ur.addMatchingKeys(w,u,v.targetId)).next(()=>l.localDocuments.getLocalViewOfDocuments(w,R.Ps,R.Is)).next(()=>R.Ps)))}async function LDe(t,e,r=Nr()){const a=await uw(t,sl(TG(e.bundledQuery))),l=Wt(t);return l.persistence.runTransaction("Save named query","readwrite",u=>{const p=Va(e.readTime);if(a.snapshotVersion.compareTo(p)>=0)return l.Gr.saveNamedQuery(u,e);const m=a.withResumeToken(_a.EMPTY_BYTE_STRING,p);return l.os=l.os.insert(m.targetId,m),l.Ur.updateTargetData(u,m).next(()=>l.Ur.removeMatchingKeysForTargetId(u,a.targetId)).next(()=>l.Ur.addMatchingKeys(u,r,a.targetId)).next(()=>l.Gr.saveNamedQuery(u,e))})}function Mre(t,e){return`firestore_clients_${t}_${e}`}function Ure(t,e,r){let a=`firestore_mutations_${t}_${r}`;return e.isAuthenticated()&&(a+=`_${e.uid}`),a}function FF(t,e){return`firestore_targets_${t}_${e}`}class hO{constructor(e,r,a,l){this.user=e,this.batchId=r,this.state=a,this.error=l}static Rs(e,r,a){const l=JSON.parse(a);let u,p=typeof l=="object"&&["pending","acknowledged","rejected"].indexOf(l.state)!==-1&&(l.error===void 0||typeof l.error=="object");return p&&l.error&&(p=typeof l.error.message=="string"&&typeof l.error.code=="string",p&&(u=new Nt(l.error.code,l.error.message))),p?new hO(e,r,l.state,u):(Ma("SharedClientState",`Failed to parse mutation state for ID '${r}': ${a}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class MC{constructor(e,r,a){this.targetId=e,this.state=r,this.error=a}static Rs(e,r){const a=JSON.parse(r);let l,u=typeof a=="object"&&["not-current","current","rejected"].indexOf(a.state)!==-1&&(a.error===void 0||typeof a.error=="object");return u&&a.error&&(u=typeof a.error.message=="string"&&typeof a.error.code=="string",u&&(l=new Nt(a.error.code,a.error.message))),u?new MC(e,a.state,l):(Ma("SharedClientState",`Failed to parse target state for ID '${e}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class pO{constructor(e,r){this.clientId=e,this.activeTargetIds=r}static Rs(e,r){const a=JSON.parse(r);let l=typeof a=="object"&&a.activeTargetIds instanceof Array,u=_G();for(let p=0;l&&p<a.activeTargetIds.length;++p)l=yde(a.activeTargetIds[p]),u=u.add(a.activeTargetIds[p]);return l?new pO(e,u):(Ma("SharedClientState",`Failed to parse client data for instance '${e}': ${r}`),null)}}class DG{constructor(e,r){this.clientId=e,this.onlineState=r}static Rs(e){const r=JSON.parse(e);return typeof r=="object"&&["Unknown","Online","Offline"].indexOf(r.onlineState)!==-1&&typeof r.clientId=="string"?new DG(r.clientId,r.onlineState):(Ma("SharedClientState",`Failed to parse online state: ${e}`),null)}}class rz{constructor(){this.activeTargetIds=_G()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class BF{constructor(e,r,a,l,u){this.window=e,this.ui=r,this.persistenceKey=a,this.ps=l,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Rs(ir),this.started=!1,this.bs=[];const p=a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=u,this.Ds=Mre(this.persistenceKey,this.ps),this.vs=function(v){return`firestore_sequence_number_${v}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new rz),this.Cs=new RegExp(`^firestore_clients_${p}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${p}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${p}_(\\d+)$`),this.xs=function(v){return`firestore_online_state_${v}`}(this.persistenceKey),this.Os=function(v){return`firestore_bundle_loaded_v2_${v}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const a of e){if(a===this.ps)continue;const l=this.getItem(Mre(this.persistenceKey,a));if(l){const u=pO.Rs(a,l);u&&(this.Ss=this.Ss.insert(u.clientId,u))}}this.Ns();const r=this.storage.getItem(this.xs);if(r){const a=this.Ls(r);a&&this.Bs(a)}for(const a of this.bs)this.ws(a);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let r=!1;return this.Ss.forEach((a,l)=>{l.activeTargetIds.has(e)&&(r=!0)}),r}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,r,a){this.qs(e,r,a),this.Qs(e)}addLocalQueryTarget(e,r=!0){let a="not-current";if(this.isActiveQueryTarget(e)){const l=this.storage.getItem(FF(this.persistenceKey,e));if(l){const u=MC.Rs(e,l);u&&(a=u.state)}}return r&&this.Ks.fs(e),this.Ns(),a}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(FF(this.persistenceKey,e))}updateQueryState(e,r,a){this.$s(e,r,a)}handleUserChange(e,r,a){r.forEach(l=>{this.Qs(l)}),this.currentUser=e,a.forEach(l=>{this.addPendingMutation(l)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const r=this.storage.getItem(e);return Pt("SharedClientState","READ",e,r),r}setItem(e,r){Pt("SharedClientState","SET",e,r),this.storage.setItem(e,r)}removeItem(e){Pt("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const r=e;if(r.storageArea===this.storage){if(Pt("SharedClientState","EVENT",r.key,r.newValue),r.key===this.Ds)return void Ma("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(r.key!==null){if(this.Cs.test(r.key)){if(r.newValue==null){const a=this.Gs(r.key);return this.zs(a,null)}{const a=this.js(r.key,r.newValue);if(a)return this.zs(a.clientId,a)}}else if(this.Fs.test(r.key)){if(r.newValue!==null){const a=this.Hs(r.key,r.newValue);if(a)return this.Js(a)}}else if(this.Ms.test(r.key)){if(r.newValue!==null){const a=this.Ys(r.key,r.newValue);if(a)return this.Zs(a)}}else if(r.key===this.xs){if(r.newValue!==null){const a=this.Ls(r.newValue);if(a)return this.Bs(a)}}else if(r.key===this.vs){const a=function(u){let p=od.oe;if(u!=null)try{const m=JSON.parse(u);yn(typeof m=="number"),p=m}catch(m){Ma("SharedClientState","Failed to read sequence number from WebStorage",m)}return p}(r.newValue);a!==od.oe&&this.sequenceNumberHandler(a)}else if(r.key===this.Os){const a=this.Xs(r.newValue);await Promise.all(a.map(l=>this.syncEngine.eo(l)))}}}else this.bs.push(r)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,r,a){const l=new hO(this.currentUser,e,r,a),u=Ure(this.persistenceKey,this.currentUser,e);this.setItem(u,l.Vs())}Qs(e){const r=Ure(this.persistenceKey,this.currentUser,e);this.removeItem(r)}Us(e){const r={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(r))}$s(e,r,a){const l=FF(this.persistenceKey,e),u=new MC(e,r,a);this.setItem(l,u.Vs())}Ws(e){const r=JSON.stringify(Array.from(e));this.setItem(this.Os,r)}Gs(e){const r=this.Cs.exec(e);return r?r[1]:null}js(e,r){const a=this.Gs(e);return pO.Rs(a,r)}Hs(e,r){const a=this.Fs.exec(e),l=Number(a[1]),u=a[2]!==void 0?a[2]:null;return hO.Rs(new Wo(u),l,r)}Ys(e,r){const a=this.Ms.exec(e),l=Number(a[1]);return MC.Rs(l,r)}Ls(e){return DG.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);Pt("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,r){const a=r?this.Ss.insert(e,r):this.Ss.remove(e),l=this.ks(this.Ss),u=this.ks(a),p=[],m=[];return u.forEach(v=>{l.has(v)||p.push(v)}),l.forEach(v=>{u.has(v)||m.push(v)}),this.syncEngine.io(p,m).then(()=>{this.Ss=a})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let r=_G();return e.forEach((a,l)=>{r=r.unionWith(l.activeTargetIds)}),r}}class Mue{constructor(){this.so=new rz,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,r,a){}addLocalQueryTarget(e,r=!0){return r&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,r,a){this.oo[e]=r}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new rz,Promise.resolve()}handleUserChange(e,r,a){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jDe{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vre{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){Pt("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){Pt("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let P2=null;function zF(){return P2===null?P2=function(){return 268435456+Math.round(2147483648*Math.random())}():P2++,"0x"+P2.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MDe={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UDe{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tl="WebChannelConnection";class VDe extends class{constructor(r){this.databaseInfo=r,this.databaseId=r.databaseId;const a=r.ssl?"https":"http",l=encodeURIComponent(this.databaseId.projectId),u=encodeURIComponent(this.databaseId.database);this.Do=a+"://"+r.host,this.vo=`projects/${l}/databases/${u}`,this.Co=this.databaseId.database==="(default)"?`project_id=${l}`:`project_id=${l}&database_id=${u}`}get Fo(){return!1}Mo(r,a,l,u,p){const m=zF(),v=this.xo(r,a.toUriEncodedString());Pt("RestConnection",`Sending RPC '${r}' ${m}:`,v,l);const w={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(w,u,p),this.No(r,v,w,l).then(R=>(Pt("RestConnection",`Received RPC '${r}' ${m}: `,R),R),R=>{throw Jd("RestConnection",`RPC '${r}' ${m} failed with error: `,R,"url: ",v,"request:",l),R})}Lo(r,a,l,u,p,m){return this.Mo(r,a,l,u,p)}Oo(r,a,l){r["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Uw}(),r["Content-Type"]="text/plain",this.databaseInfo.appId&&(r["X-Firebase-GMPID"]=this.databaseInfo.appId),a&&a.headers.forEach((u,p)=>r[p]=u),l&&l.headers.forEach((u,p)=>r[p]=u)}xo(r,a){const l=MDe[r];return`${this.Do}/v1/${a}:${l}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,r,a,l){const u=zF();return new Promise((p,m)=>{const v=new ide;v.setWithCredentials(!0),v.listenOnce(sde.COMPLETE,()=>{try{switch(v.getLastErrorCode()){case dD.NO_ERROR:const R=v.getResponseJson();Pt(tl,`XHR for RPC '${e}' ${u} received:`,JSON.stringify(R)),p(R);break;case dD.TIMEOUT:Pt(tl,`RPC '${e}' ${u} timed out`),m(new Nt(ot.DEADLINE_EXCEEDED,"Request time out"));break;case dD.HTTP_ERROR:const C=v.getStatus();if(Pt(tl,`RPC '${e}' ${u} failed with status:`,C,"response text:",v.getResponseText()),C>0){let A=v.getResponseJson();Array.isArray(A)&&(A=A[0]);const O=A==null?void 0:A.error;if(O&&O.status&&O.message){const U=function(q){const W=q.toLowerCase().replace(/_/g,"-");return Object.values(ot).indexOf(W)>=0?W:ot.UNKNOWN}(O.status);m(new Nt(U,O.message))}else m(new Nt(ot.UNKNOWN,"Server responded with status "+v.getStatus()))}else m(new Nt(ot.UNAVAILABLE,"Connection failed."));break;default:cn()}}finally{Pt(tl,`RPC '${e}' ${u} completed.`)}});const w=JSON.stringify(l);Pt(tl,`RPC '${e}' ${u} sending request:`,l),v.send(r,"POST",w,a,15)})}Bo(e,r,a){const l=zF(),u=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],p=cde(),m=ode(),v={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},w=this.longPollingOptions.timeoutSeconds;w!==void 0&&(v.longPollingTimeout=Math.round(1e3*w)),this.useFetchStreams&&(v.useFetchStreams=!0),this.Oo(v.initMessageHeaders,r,a),v.encodeInitMessageHeaders=!0;const R=u.join("");Pt(tl,`Creating RPC '${e}' stream ${l}: ${R}`,v);const C=p.createWebChannel(R,v);let A=!1,O=!1;const U=new UDe({Io:q=>{O?Pt(tl,`Not sending because RPC '${e}' stream ${l} is closed:`,q):(A||(Pt(tl,`Opening RPC '${e}' stream ${l} transport.`),C.open(),A=!0),Pt(tl,`RPC '${e}' stream ${l} sending:`,q),C.send(q))},To:()=>C.close()}),F=(q,W,H)=>{q.listen(W,X=>{try{H(X)}catch(ne){setTimeout(()=>{throw ne},0)}})};return F(C,pC.EventType.OPEN,()=>{O||(Pt(tl,`RPC '${e}' stream ${l} transport opened.`),U.yo())}),F(C,pC.EventType.CLOSE,()=>{O||(O=!0,Pt(tl,`RPC '${e}' stream ${l} transport closed`),U.So())}),F(C,pC.EventType.ERROR,q=>{O||(O=!0,Jd(tl,`RPC '${e}' stream ${l} transport errored:`,q),U.So(new Nt(ot.UNAVAILABLE,"The operation could not be completed")))}),F(C,pC.EventType.MESSAGE,q=>{var W;if(!O){const H=q.data[0];yn(!!H);const X=H,ne=X.error||((W=X[0])===null||W===void 0?void 0:W.error);if(ne){Pt(tl,`RPC '${e}' stream ${l} received error:`,ne);const te=ne.status;let he=function(ce){const de=Ja[ce];if(de!==void 0)return tue(de)}(te),J=ne.message;he===void 0&&(he=ot.INTERNAL,J="Unknown error status: "+te+" with message "+ne.message),O=!0,U.So(new Nt(he,J)),C.close()}else Pt(tl,`RPC '${e}' stream ${l} received:`,H),U.bo(H)}}),F(m,ade.STAT_EVENT,q=>{q.stat===B6.PROXY?Pt(tl,`RPC '${e}' stream ${l} detected buffering proxy`):q.stat===B6.NOPROXY&&Pt(tl,`RPC '${e}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{U.wo()},0),U}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uue(){return typeof window<"u"?window:null}function _D(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iI(t){return new q2e(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OG{constructor(e,r,a=1e3,l=1.5,u=6e4){this.ui=e,this.timerId=r,this.ko=a,this.qo=l,this.Qo=u,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const r=Math.floor(this.Ko+this.zo()),a=Math.max(0,Date.now()-this.Uo),l=Math.max(0,r-a);l>0&&Pt("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.Ko} ms, delay with jitter: ${r} ms, last attempt: ${a} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,l,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vue{constructor(e,r,a,l,u,p,m,v){this.ui=e,this.Ho=a,this.Jo=l,this.connection=u,this.authCredentialsProvider=p,this.appCheckCredentialsProvider=m,this.listener=v,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new OG(e,r)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,r){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():r&&r.code===ot.RESOURCE_EXHAUSTED?(Ma(r.toString()),Ma("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):r&&r.code===ot.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(r)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),r=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,l])=>{this.Yo===r&&this.P_(a,l)},a=>{e(()=>{const l=new Nt(ot.UNKNOWN,"Fetching auth token failed: "+a.message);return this.I_(l)})})}P_(e,r){const a=this.h_(this.Yo);this.stream=this.T_(e,r),this.stream.Eo(()=>{a(()=>this.listener.Eo())}),this.stream.Ro(()=>{a(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(l=>{a(()=>this.I_(l))}),this.stream.onMessage(l=>{a(()=>++this.e_==1?this.E_(l):this.onNext(l))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return Pt("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return r=>{this.ui.enqueueAndForget(()=>this.Yo===e?r():(Pt("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class FDe extends Vue{constructor(e,r,a,l,u,p){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",r,a,l,p),this.serializer=u}T_(e,r){return this.connection.Bo("Listen",e,r)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const r=X2e(this.serializer,e),a=function(u){if(!("targetChange"in u))return Sn.min();const p=u.targetChange;return p.targetIds&&p.targetIds.length?Sn.min():p.readTime?Va(p.readTime):Sn.min()}(e);return this.listener.d_(r,a)}A_(e){const r={};r.database=Q6(this.serializer),r.addTarget=function(u,p){let m;const v=p.target;if(m=rO(v)?{documents:uue(u,v)}:{query:bL(u,v)._t},m.targetId=p.targetId,p.resumeToken.approximateByteSize()>0){m.resumeToken=sue(u,p.resumeToken);const w=X6(u,p.expectedCount);w!==null&&(m.expectedCount=w)}else if(p.snapshotVersion.compareTo(Sn.min())>0){m.readTime=dw(u,p.snapshotVersion.toTimestamp());const w=X6(u,p.expectedCount);w!==null&&(m.expectedCount=w)}return m}(this.serializer,e);const a=Q2e(this.serializer,e);a&&(r.labels=a),this.a_(r)}R_(e){const r={};r.database=Q6(this.serializer),r.removeTarget=e,this.a_(r)}}class BDe extends Vue{constructor(e,r,a,l,u,p){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,a,l,p),this.serializer=u}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,r){return this.connection.Bo("Write",e,r)}E_(e){return yn(!!e.streamToken),this.lastStreamToken=e.streamToken,yn(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){yn(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const r=J2e(e.writeResults,e.commitTime),a=Va(e.commitTime);return this.listener.g_(a,r)}p_(){const e={};e.database=Q6(this.serializer),this.a_(e)}m_(e){const r={streamToken:this.lastStreamToken,writes:e.map(a=>RN(this.serializer,a))};this.a_(r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zDe extends class{}{constructor(e,r,a,l){super(),this.authCredentials=e,this.appCheckCredentials=r,this.connection=a,this.serializer=l,this.y_=!1}w_(){if(this.y_)throw new Nt(ot.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,r,a,l){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([u,p])=>this.connection.Mo(e,J6(r,a),l,u,p)).catch(u=>{throw u.name==="FirebaseError"?(u.code===ot.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new Nt(ot.UNKNOWN,u.toString())})}Lo(e,r,a,l,u){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([p,m])=>this.connection.Lo(e,J6(r,a),l,p,m,u)).catch(p=>{throw p.name==="FirebaseError"?(p.code===ot.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),p):new Nt(ot.UNKNOWN,p.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class GDe{constructor(e,r){this.asyncQueue=e,this.onlineStateHandler=r,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const r=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Ma(r),this.D_=!1):Pt("OnlineStateTracker",r)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WDe{constructor(e,r,a,l,u){this.localStore=e,this.datastore=r,this.asyncQueue=a,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=u,this.k_._o(p=>{a.enqueueAndForget(async()=>{g0(this)&&(Pt("RemoteStore","Restarting streams for network reachability change."),await async function(v){const w=Wt(v);w.L_.add(4),await zw(w),w.q_.set("Unknown"),w.L_.delete(4),await sI(w)}(this))})}),this.q_=new GDe(a,l)}}async function sI(t){if(g0(t))for(const e of t.B_)await e(!0)}async function zw(t){for(const e of t.B_)await e(!1)}function RL(t,e){const r=Wt(t);r.N_.has(e.targetId)||(r.N_.set(e.targetId,e),MG(r)?jG(r):Ww(r).r_()&&LG(r,e))}function pw(t,e){const r=Wt(t),a=Ww(r);r.N_.delete(e),a.r_()&&Fue(r,e),r.N_.size===0&&(a.r_()?a.o_():g0(r)&&r.q_.set("Unknown"))}function LG(t,e){if(t.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Sn.min())>0){const r=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(r)}Ww(t).A_(e)}function Fue(t,e){t.Q_.xe(e),Ww(t).R_(e)}function jG(t){t.Q_=new G2e({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.N_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),Ww(t).start(),t.q_.v_()}function MG(t){return g0(t)&&!Ww(t).n_()&&t.N_.size>0}function g0(t){return Wt(t).L_.size===0}function Bue(t){t.Q_=void 0}async function HDe(t){t.q_.set("Online")}async function KDe(t){t.N_.forEach((e,r)=>{LG(t,e)})}async function qDe(t,e){Bue(t),MG(t)?(t.q_.M_(e),jG(t)):t.q_.set("Unknown")}async function YDe(t,e,r){if(t.q_.set("Online"),e instanceof iue&&e.state===2&&e.cause)try{await async function(l,u){const p=u.cause;for(const m of u.targetIds)l.N_.has(m)&&(await l.remoteSyncer.rejectListen(m,p),l.N_.delete(m),l.Q_.removeTarget(m))}(t,e)}catch(a){Pt("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),a),await fO(t,a)}else if(e instanceof gD?t.Q_.Ke(e):e instanceof rue?t.Q_.He(e):t.Q_.We(e),!r.isEqual(Sn.min()))try{const a=await Pue(t.localStore);r.compareTo(a)>=0&&await function(u,p){const m=u.Q_.rt(p);return m.targetChanges.forEach((v,w)=>{if(v.resumeToken.approximateByteSize()>0){const R=u.N_.get(w);R&&u.N_.set(w,R.withResumeToken(v.resumeToken,p))}}),m.targetMismatches.forEach((v,w)=>{const R=u.N_.get(v);if(!R)return;u.N_.set(v,R.withResumeToken(_a.EMPTY_BYTE_STRING,R.snapshotVersion)),Fue(u,v);const C=new Om(R.target,v,w,R.sequenceNumber);LG(u,C)}),u.remoteSyncer.applyRemoteEvent(m)}(t,r)}catch(a){Pt("RemoteStore","Failed to raise snapshot:",a),await fO(t,a)}}async function fO(t,e,r){if(!f0(e))throw e;t.L_.add(1),await zw(t),t.q_.set("Offline"),r||(r=()=>Pue(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{Pt("RemoteStore","Retrying IndexedDB access"),await r(),t.L_.delete(1),await sI(t)})}function zue(t,e){return e().catch(r=>fO(t,r,e))}async function Gw(t){const e=Wt(t),r=i0(e);let a=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;$De(e);)try{const l=await DDe(e.localStore,a);if(l===null){e.O_.length===0&&r.o_();break}a=l.batchId,XDe(e,l)}catch(l){await fO(e,l)}Gue(e)&&Wue(e)}function $De(t){return g0(t)&&t.O_.length<10}function XDe(t,e){t.O_.push(e);const r=i0(t);r.r_()&&r.V_&&r.m_(e.mutations)}function Gue(t){return g0(t)&&!i0(t).n_()&&t.O_.length>0}function Wue(t){i0(t).start()}async function JDe(t){i0(t).p_()}async function QDe(t){const e=i0(t);for(const r of t.O_)e.m_(r.mutations)}async function ZDe(t,e,r){const a=t.O_.shift(),l=xG.from(a,e,r);await zue(t,()=>t.remoteSyncer.applySuccessfulWrite(l)),await Gw(t)}async function eOe(t,e){e&&i0(t).V_&&await async function(a,l){if(function(p){return eue(p)&&p!==ot.ABORTED}(l.code)){const u=a.O_.shift();i0(a).s_(),await zue(a,()=>a.remoteSyncer.rejectFailedWrite(u.batchId,l)),await Gw(a)}}(t,e),Gue(t)&&Wue(t)}async function Fre(t,e){const r=Wt(t);r.asyncQueue.verifyOperationInProgress(),Pt("RemoteStore","RemoteStore received new credentials");const a=g0(r);r.L_.add(3),await zw(r),a&&r.q_.set("Unknown"),await r.remoteSyncer.handleCredentialChange(e),r.L_.delete(3),await sI(r)}async function iz(t,e){const r=Wt(t);e?(r.L_.delete(2),await sI(r)):e||(r.L_.add(2),await zw(r),r.q_.set("Unknown"))}function Ww(t){return t.K_||(t.K_=function(r,a,l){const u=Wt(r);return u.w_(),new FDe(a,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,l)}(t.datastore,t.asyncQueue,{Eo:HDe.bind(null,t),Ro:KDe.bind(null,t),mo:qDe.bind(null,t),d_:YDe.bind(null,t)}),t.B_.push(async e=>{e?(t.K_.s_(),MG(t)?jG(t):t.q_.set("Unknown")):(await t.K_.stop(),Bue(t))})),t.K_}function i0(t){return t.U_||(t.U_=function(r,a,l){const u=Wt(r);return u.w_(),new BDe(a,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,l)}(t.datastore,t.asyncQueue,{Eo:()=>Promise.resolve(),Ro:JDe.bind(null,t),mo:eOe.bind(null,t),f_:QDe.bind(null,t),g_:ZDe.bind(null,t)}),t.B_.push(async e=>{e?(t.U_.s_(),await Gw(t)):(await t.U_.stop(),t.O_.length>0&&(Pt("RemoteStore",`Stopping write stream with ${t.O_.length} pending writes`),t.O_=[]))})),t.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UG{constructor(e,r,a,l,u){this.asyncQueue=e,this.timerId=r,this.targetTimeMs=a,this.op=l,this.removalCallback=u,this.deferred=new $o,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(p=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,r,a,l,u){const p=Date.now()+a,m=new UG(e,r,p,l,u);return m.start(a),m}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Nt(ot.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Hw(t,e){if(Ma("AsyncQueue",`${e}: ${t}`),f0(t))return new Nt(ot.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wb{constructor(e){this.comparator=e?(r,a)=>e(r,a)||Kt.comparator(r.key,a.key):(r,a)=>Kt.comparator(r.key,a.key),this.keyedMap=fC(),this.sortedSet=new Rs(this.comparator)}static emptySet(e){return new Wb(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const r=this.keyedMap.get(e);return r?this.sortedSet.indexOf(r):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((r,a)=>(e(r),!1))}add(e){const r=this.delete(e.key);return r.copy(r.keyedMap.insert(e.key,e),r.sortedSet.insert(e,null))}delete(e){const r=this.get(e);return r?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(r)):this}isEqual(e){if(!(e instanceof Wb)||this.size!==e.size)return!1;const r=this.sortedSet.getIterator(),a=e.sortedSet.getIterator();for(;r.hasNext();){const l=r.getNext().key,u=a.getNext().key;if(!l.isEqual(u))return!1}return!0}toString(){const e=[];return this.forEach(r=>{e.push(r.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,r){const a=new Wb;return a.comparator=this.comparator,a.keyedMap=e,a.sortedSet=r,a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bre{constructor(){this.W_=new Rs(Kt.comparator)}track(e){const r=e.doc.key,a=this.W_.get(r);a?e.type!==0&&a.type===3?this.W_=this.W_.insert(r,e):e.type===3&&a.type!==1?this.W_=this.W_.insert(r,{type:a.type,doc:e.doc}):e.type===2&&a.type===2?this.W_=this.W_.insert(r,{type:2,doc:e.doc}):e.type===2&&a.type===0?this.W_=this.W_.insert(r,{type:0,doc:e.doc}):e.type===1&&a.type===0?this.W_=this.W_.remove(r):e.type===1&&a.type===2?this.W_=this.W_.insert(r,{type:1,doc:a.doc}):e.type===0&&a.type===1?this.W_=this.W_.insert(r,{type:2,doc:e.doc}):cn():this.W_=this.W_.insert(r,e)}G_(){const e=[];return this.W_.inorderTraversal((r,a)=>{e.push(a)}),e}}class fw{constructor(e,r,a,l,u,p,m,v,w){this.query=e,this.docs=r,this.oldDocs=a,this.docChanges=l,this.mutatedKeys=u,this.fromCache=p,this.syncStateChanged=m,this.excludesMetadataChanges=v,this.hasCachedResults=w}static fromInitialDocuments(e,r,a,l,u){const p=[];return r.forEach(m=>{p.push({type:0,doc:m})}),new fw(e,r,Wb.emptySet(r),p,a,l,!0,!1,u)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ZN(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const r=this.docChanges,a=e.docChanges;if(r.length!==a.length)return!1;for(let l=0;l<r.length;l++)if(r[l].type!==a[l].type||!r[l].doc.isEqual(a[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tOe{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class nOe{constructor(){this.queries=zre(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(r,a){const l=Wt(r),u=l.queries;l.queries=zre(),u.forEach((p,m)=>{for(const v of m.j_)v.onError(a)})})(this,new Nt(ot.ABORTED,"Firestore shutting down"))}}function zre(){return new rg(t=>Vde(t),ZN)}async function VG(t,e){const r=Wt(t);let a=3;const l=e.query;let u=r.queries.get(l);u?!u.H_()&&e.J_()&&(a=2):(u=new tOe,a=e.J_()?0:1);try{switch(a){case 0:u.z_=await r.onListen(l,!0);break;case 1:u.z_=await r.onListen(l,!1);break;case 2:await r.onFirstRemoteStoreListen(l)}}catch(p){const m=Hw(p,`Initialization of query '${ub(e.query)}' failed`);return void e.onError(m)}r.queries.set(l,u),u.j_.push(e),e.Z_(r.onlineState),u.z_&&e.X_(u.z_)&&BG(r)}async function FG(t,e){const r=Wt(t),a=e.query;let l=3;const u=r.queries.get(a);if(u){const p=u.j_.indexOf(e);p>=0&&(u.j_.splice(p,1),u.j_.length===0?l=e.J_()?0:1:!u.H_()&&e.J_()&&(l=2))}switch(l){case 0:return r.queries.delete(a),r.onUnlisten(a,!0);case 1:return r.queries.delete(a),r.onUnlisten(a,!1);case 2:return r.onLastRemoteStoreUnlisten(a);default:return}}function rOe(t,e){const r=Wt(t);let a=!1;for(const l of e){const u=l.query,p=r.queries.get(u);if(p){for(const m of p.j_)m.X_(l)&&(a=!0);p.z_=l}}a&&BG(r)}function iOe(t,e,r){const a=Wt(t),l=a.queries.get(e);if(l)for(const u of l.j_)u.onError(r);a.queries.delete(e)}function BG(t){t.Y_.forEach(e=>{e.next()})}var sz,Gre;(Gre=sz||(sz={})).ea="default",Gre.Cache="cache";class zG{constructor(e,r,a){this.query=e,this.ta=r,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=a||{}}X_(e){if(!this.options.includeMetadataChanges){const a=[];for(const l of e.docChanges)l.type!==3&&a.push(l);e=new fw(e.query,e.docs,e.oldDocs,a,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let r=!1;return this.na?this.ia(e)&&(this.ta.next(e),r=!0):this.sa(e,this.onlineState)&&(this.oa(e),r=!0),this.ra=e,r}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let r=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),r=!0),r}sa(e,r){if(!e.fromCache||!this.J_())return!0;const a=r!=="Offline";return(!this.options._a||!a)&&(!e.docs.isEmpty()||e.hasCachedResults||r==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const r=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!r)&&this.options.includeMetadataChanges===!0}oa(e){e=fw.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==sz.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sOe{constructor(e,r){this.aa=e,this.byteLength=r}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wre{constructor(e){this.serializer=e}Es(e){return Cf(this.serializer,e)}ds(e){return e.metadata.exists?due(this.serializer,e.document,!1):js.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Va(e)}}class aOe{constructor(e,r,a){this.ca=e,this.localStore=r,this.serializer=a,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Hue(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let r=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++r;const a=li.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(a.get(a.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++r);return r!==this.progress.documentsLoaded?(this.progress.documentsLoaded=r,Object.assign({},this.progress)):null}ha(e){const r=new Map,a=new Wre(this.serializer);for(const l of e)if(l.metadata.queries){const u=a.Es(l.metadata.name);for(const p of l.metadata.queries){const m=(r.get(p)||Nr()).add(u);r.set(p,m)}}return r}async complete(){const e=await ODe(this.localStore,new Wre(this.serializer),this.documents,this.ca.id),r=this.ha(this.documents);for(const a of this.queries)await LDe(this.localStore,a,r.get(a.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function Hue(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kue{constructor(e){this.key=e}}class que{constructor(e){this.key=e}}class Yue{constructor(e,r){this.query=e,this.Ta=r,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Nr(),this.mutatedKeys=Nr(),this.Aa=Bde(e),this.Ra=new Wb(this.Aa)}get Va(){return this.Ta}ma(e,r){const a=r?r.fa:new Bre,l=r?r.Ra:this.Ra;let u=r?r.mutatedKeys:this.mutatedKeys,p=l,m=!1;const v=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,w=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(e.inorderTraversal((R,C)=>{const A=l.get(R),O=eI(this.query,C)?C:null,U=!!A&&this.mutatedKeys.has(A.key),F=!!O&&(O.hasLocalMutations||this.mutatedKeys.has(O.key)&&O.hasCommittedMutations);let q=!1;A&&O?A.data.isEqual(O.data)?U!==F&&(a.track({type:3,doc:O}),q=!0):this.ga(A,O)||(a.track({type:2,doc:O}),q=!0,(v&&this.Aa(O,v)>0||w&&this.Aa(O,w)<0)&&(m=!0)):!A&&O?(a.track({type:0,doc:O}),q=!0):A&&!O&&(a.track({type:1,doc:A}),q=!0,(v||w)&&(m=!0)),q&&(O?(p=p.add(O),u=F?u.add(R):u.delete(R)):(p=p.delete(R),u=u.delete(R)))}),this.query.limit!==null)for(;p.size>this.query.limit;){const R=this.query.limitType==="F"?p.last():p.first();p=p.delete(R.key),u=u.delete(R.key),a.track({type:1,doc:R})}return{Ra:p,fa:a,ns:m,mutatedKeys:u}}ga(e,r){return e.hasLocalMutations&&r.hasCommittedMutations&&!r.hasLocalMutations}applyChanges(e,r,a,l){const u=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const p=e.fa.G_();p.sort((R,C)=>function(O,U){const F=q=>{switch(q){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return cn()}};return F(O)-F(U)}(R.type,C.type)||this.Aa(R.doc,C.doc)),this.pa(a),l=l!=null&&l;const m=r&&!l?this.ya():[],v=this.da.size===0&&this.current&&!l?1:0,w=v!==this.Ea;return this.Ea=v,p.length!==0||w?{snapshot:new fw(this.query,e.Ra,u,p,e.mutatedKeys,v===0,w,!1,!!a&&a.resumeToken.approximateByteSize()>0),wa:m}:{wa:m}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Bre,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(r=>this.Ta=this.Ta.add(r)),e.modifiedDocuments.forEach(r=>{}),e.removedDocuments.forEach(r=>this.Ta=this.Ta.delete(r)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Nr(),this.Ra.forEach(a=>{this.Sa(a.key)&&(this.da=this.da.add(a.key))});const r=[];return e.forEach(a=>{this.da.has(a)||r.push(new que(a))}),this.da.forEach(a=>{e.has(a)||r.push(new Kue(a))}),r}ba(e){this.Ta=e.Ts,this.da=Nr();const r=this.ma(e.documents);return this.applyChanges(r,!0)}Da(){return fw.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class oOe{constructor(e,r,a){this.query=e,this.targetId=r,this.view=a}}class cOe{constructor(e){this.key=e,this.va=!1}}class lOe{constructor(e,r,a,l,u,p){this.localStore=e,this.remoteStore=r,this.eventManager=a,this.sharedClientState=l,this.currentUser=u,this.maxConcurrentLimboResolutions=p,this.Ca={},this.Fa=new rg(m=>Vde(m),ZN),this.Ma=new Map,this.xa=new Set,this.Oa=new Rs(Kt.comparator),this.Na=new Map,this.La=new NG,this.Ba={},this.ka=new Map,this.qa=Pv.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function dOe(t,e,r=!0){const a=CL(t);let l;const u=a.Fa.get(e);return u?(a.sharedClientState.addLocalQueryTarget(u.targetId),l=u.view.Da()):l=await $ue(a,e,r,!0),l}async function uOe(t,e){const r=CL(t);await $ue(r,e,!0,!1)}async function $ue(t,e,r,a){const l=await uw(t.localStore,sl(e)),u=l.targetId,p=t.sharedClientState.addLocalQueryTarget(u,r);let m;return a&&(m=await GG(t,e,u,p==="current",l.resumeToken)),t.isPrimaryClient&&r&&RL(t.remoteStore,l),m}async function GG(t,e,r,a,l){t.Ka=(C,A,O)=>async function(F,q,W,H){let X=q.view.ma(W);X.ns&&(X=await uO(F.localStore,q.query,!1).then(({documents:J})=>q.view.ma(J,X)));const ne=H&&H.targetChanges.get(q.targetId),te=H&&H.targetMismatches.get(q.targetId)!=null,he=q.view.applyChanges(X,F.isPrimaryClient,ne,te);return az(F,q.targetId,he.wa),he.snapshot}(t,C,A,O);const u=await uO(t.localStore,e,!0),p=new Yue(e,u.Ts),m=p.ma(u.documents),v=rI.createSynthesizedTargetChangeForCurrentChange(r,a&&t.onlineState!=="Offline",l),w=p.applyChanges(m,t.isPrimaryClient,v);az(t,r,w.wa);const R=new oOe(e,r,p);return t.Fa.set(e,R),t.Ma.has(r)?t.Ma.get(r).push(e):t.Ma.set(r,[e]),w.snapshot}async function hOe(t,e,r){const a=Wt(t),l=a.Fa.get(e),u=a.Ma.get(l.targetId);if(u.length>1)return a.Ma.set(l.targetId,u.filter(p=>!ZN(p,e))),void a.Fa.delete(e);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(l.targetId),a.sharedClientState.isActiveQueryTarget(l.targetId)||await hw(a.localStore,l.targetId,!1).then(()=>{a.sharedClientState.clearQueryState(l.targetId),r&&pw(a.remoteStore,l.targetId),mw(a,l.targetId)}).catch(p0)):(mw(a,l.targetId),await hw(a.localStore,l.targetId,!0))}async function pOe(t,e){const r=Wt(t),a=r.Fa.get(e),l=r.Ma.get(a.targetId);r.isPrimaryClient&&l.length===1&&(r.sharedClientState.removeLocalQueryTarget(a.targetId),pw(r.remoteStore,a.targetId))}async function fOe(t,e,r){const a=qG(t);try{const l=await function(p,m){const v=Wt(p),w=fn.now(),R=m.reduce((O,U)=>O.add(U.key),Nr());let C,A;return v.persistence.runTransaction("Locally write mutations","readwrite",O=>{let U=ld(),F=Nr();return v.cs.getEntries(O,R).next(q=>{U=q,U.forEach((W,H)=>{H.isValidDocument()||(F=F.add(W))})}).next(()=>v.localDocuments.getOverlayedDocuments(O,U)).next(q=>{C=q;const W=[];for(const H of m){const X=F2e(H,C.get(H.key).overlayedDocument);X!=null&&W.push(new ig(H.key,X,Nde(X.value.mapValue),ta.exists(!0)))}return v.mutationQueue.addMutationBatch(O,w,W,m)}).next(q=>{A=q;const W=q.applyToLocalDocumentSet(C,F);return v.documentOverlayCache.saveOverlays(O,q.batchId,W)})}).then(()=>({batchId:A.batchId,changes:Gde(C)}))}(a.localStore,e);a.sharedClientState.addPendingMutation(l.batchId),function(p,m,v){let w=p.Ba[p.currentUser.toKey()];w||(w=new Rs(ir)),w=w.insert(m,v),p.Ba[p.currentUser.toKey()]=w}(a,l.batchId,r),await sg(a,l.changes),await Gw(a.remoteStore)}catch(l){const u=Hw(l,"Failed to persist write");r.reject(u)}}async function Xue(t,e){const r=Wt(t);try{const a=await PDe(r.localStore,e);e.targetChanges.forEach((l,u)=>{const p=r.Na.get(u);p&&(yn(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1),l.addedDocuments.size>0?p.va=!0:l.modifiedDocuments.size>0?yn(p.va):l.removedDocuments.size>0&&(yn(p.va),p.va=!1))}),await sg(r,a,e)}catch(a){await p0(a)}}function Hre(t,e,r){const a=Wt(t);if(a.isPrimaryClient&&r===0||!a.isPrimaryClient&&r===1){const l=[];a.Fa.forEach((u,p)=>{const m=p.view.Z_(e);m.snapshot&&l.push(m.snapshot)}),function(p,m){const v=Wt(p);v.onlineState=m;let w=!1;v.queries.forEach((R,C)=>{for(const A of C.j_)A.Z_(m)&&(w=!0)}),w&&BG(v)}(a.eventManager,e),l.length&&a.Ca.d_(l),a.onlineState=e,a.isPrimaryClient&&a.sharedClientState.setOnlineState(e)}}async function mOe(t,e,r){const a=Wt(t);a.sharedClientState.updateQueryState(e,"rejected",r);const l=a.Na.get(e),u=l&&l.key;if(u){let p=new Rs(Kt.comparator);p=p.insert(u,js.newNoDocument(u,Sn.min()));const m=Nr().add(u),v=new nI(Sn.min(),new Map,new Rs(ir),p,m);await Xue(a,v),a.Oa=a.Oa.remove(u),a.Na.delete(e),KG(a)}else await hw(a.localStore,e,!1).then(()=>mw(a,e,r)).catch(p0)}async function gOe(t,e){const r=Wt(t),a=e.batch.batchId;try{const l=await kDe(r.localStore,e);HG(r,a,null),WG(r,a),r.sharedClientState.updateMutationState(a,"acknowledged"),await sg(r,l)}catch(l){await p0(l)}}async function _Oe(t,e,r){const a=Wt(t);try{const l=await function(p,m){const v=Wt(p);return v.persistence.runTransaction("Reject batch","readwrite-primary",w=>{let R;return v.mutationQueue.lookupMutationBatch(w,m).next(C=>(yn(C!==null),R=C.keys(),v.mutationQueue.removeMutationBatch(w,C))).next(()=>v.mutationQueue.performConsistencyCheck(w)).next(()=>v.documentOverlayCache.removeOverlaysForBatchId(w,R,m)).next(()=>v.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(w,R)).next(()=>v.localDocuments.getDocuments(w,R))})}(a.localStore,e);HG(a,e,r),WG(a,e),a.sharedClientState.updateMutationState(e,"rejected",r),await sg(a,l)}catch(l){await p0(l)}}async function yOe(t,e){const r=Wt(t);g0(r.remoteStore)||Pt("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const a=await function(p){const m=Wt(p);return m.persistence.runTransaction("Get highest unacknowledged batch id","readonly",v=>m.mutationQueue.getHighestUnacknowledgedBatchId(v))}(r.localStore);if(a===-1)return void e.resolve();const l=r.ka.get(a)||[];l.push(e),r.ka.set(a,l)}catch(a){const l=Hw(a,"Initialization of waitForPendingWrites() operation failed");e.reject(l)}}function WG(t,e){(t.ka.get(e)||[]).forEach(r=>{r.resolve()}),t.ka.delete(e)}function HG(t,e,r){const a=Wt(t);let l=a.Ba[a.currentUser.toKey()];if(l){const u=l.get(e);u&&(r?u.reject(r):u.resolve(),l=l.remove(e)),a.Ba[a.currentUser.toKey()]=l}}function mw(t,e,r=null){t.sharedClientState.removeLocalQueryTarget(e);for(const a of t.Ma.get(e))t.Fa.delete(a),r&&t.Ca.$a(a,r);t.Ma.delete(e),t.isPrimaryClient&&t.La.gr(e).forEach(a=>{t.La.containsKey(a)||Jue(t,a)})}function Jue(t,e){t.xa.delete(e.path.canonicalString());const r=t.Oa.get(e);r!==null&&(pw(t.remoteStore,r),t.Oa=t.Oa.remove(e),t.Na.delete(r),KG(t))}function az(t,e,r){for(const a of r)a instanceof Kue?(t.La.addReference(a.key,e),vOe(t,a)):a instanceof que?(Pt("SyncEngine","Document no longer in limbo: "+a.key),t.La.removeReference(a.key,e),t.La.containsKey(a.key)||Jue(t,a.key)):cn()}function vOe(t,e){const r=e.key,a=r.path.canonicalString();t.Oa.get(r)||t.xa.has(a)||(Pt("SyncEngine","New document in limbo: "+r),t.xa.add(a),KG(t))}function KG(t){for(;t.xa.size>0&&t.Oa.size<t.maxConcurrentLimboResolutions;){const e=t.xa.values().next().value;t.xa.delete(e);const r=new Kt(li.fromString(e)),a=t.qa.next();t.Na.set(a,new cOe(r)),t.Oa=t.Oa.insert(r,a),RL(t.remoteStore,new Om(sl(Vw(r.path)),a,"TargetPurposeLimboResolution",od.oe))}}async function sg(t,e,r){const a=Wt(t),l=[],u=[],p=[];a.Fa.isEmpty()||(a.Fa.forEach((m,v)=>{p.push(a.Ka(v,e,r).then(w=>{var R;if((w||r)&&a.isPrimaryClient){const C=w?!w.fromCache:(R=r==null?void 0:r.targetChanges.get(v.targetId))===null||R===void 0?void 0:R.current;a.sharedClientState.updateQueryState(v.targetId,C?"current":"not-current")}if(w){l.push(w);const C=PG.Wi(v.targetId,w);u.push(C)}}))}),await Promise.all(p),a.Ca.d_(l),await async function(v,w){const R=Wt(v);try{await R.persistence.runTransaction("notifyLocalViewChanges","readwrite",C=>$e.forEach(w,A=>$e.forEach(A.$i,O=>R.persistence.referenceDelegate.addReference(C,A.targetId,O)).next(()=>$e.forEach(A.Ui,O=>R.persistence.referenceDelegate.removeReference(C,A.targetId,O)))))}catch(C){if(!f0(C))throw C;Pt("LocalStore","Failed to update sequence numbers: "+C)}for(const C of w){const A=C.targetId;if(!C.fromCache){const O=R.os.get(A),U=O.snapshotVersion,F=O.withLastLimboFreeSnapshotVersion(U);R.os=R.os.insert(A,F)}}}(a.localStore,u))}async function EOe(t,e){const r=Wt(t);if(!r.currentUser.isEqual(e)){Pt("SyncEngine","User change. New user:",e.toKey());const a=await kue(r.localStore,e);r.currentUser=e,function(u,p){u.ka.forEach(m=>{m.forEach(v=>{v.reject(new Nt(ot.CANCELLED,p))})}),u.ka.clear()}(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(e,a.removedBatchIds,a.addedBatchIds),await sg(r,a.hs)}}function xOe(t,e){const r=Wt(t),a=r.Na.get(e);if(a&&a.va)return Nr().add(a.key);{let l=Nr();const u=r.Ma.get(e);if(!u)return l;for(const p of u){const m=r.Fa.get(p);l=l.unionWith(m.view.Va)}return l}}async function bOe(t,e){const r=Wt(t),a=await uO(r.localStore,e.query,!0),l=e.view.ba(a);return r.isPrimaryClient&&az(r,e.targetId,l.wa),l}async function wOe(t,e){const r=Wt(t);return Lue(r.localStore,e).then(a=>sg(r,a))}async function SOe(t,e,r,a){const l=Wt(t),u=await function(m,v){const w=Wt(m),R=Wt(w.mutationQueue);return w.persistence.runTransaction("Lookup mutation documents","readonly",C=>R.Mn(C,v).next(A=>A?w.localDocuments.getDocuments(C,A):$e.resolve(null)))}(l.localStore,e);u!==null?(r==="pending"?await Gw(l.remoteStore):r==="acknowledged"||r==="rejected"?(HG(l,e,a||null),WG(l,e),function(m,v){Wt(Wt(m).mutationQueue).On(v)}(l.localStore,e)):cn(),await sg(l,u)):Pt("SyncEngine","Cannot apply mutation batch with id: "+e)}async function TOe(t,e){const r=Wt(t);if(CL(r),qG(r),e===!0&&r.Qa!==!0){const a=r.sharedClientState.getAllActiveQueryTargets(),l=await Kre(r,a.toArray());r.Qa=!0,await iz(r.remoteStore,!0);for(const u of l)RL(r.remoteStore,u)}else if(e===!1&&r.Qa!==!1){const a=[];let l=Promise.resolve();r.Ma.forEach((u,p)=>{r.sharedClientState.isLocalQueryTarget(p)?a.push(p):l=l.then(()=>(mw(r,p),hw(r.localStore,p,!0))),pw(r.remoteStore,p)}),await l,await Kre(r,a),function(p){const m=Wt(p);m.Na.forEach((v,w)=>{pw(m.remoteStore,w)}),m.La.pr(),m.Na=new Map,m.Oa=new Rs(Kt.comparator)}(r),r.Qa=!1,await iz(r.remoteStore,!1)}}async function Kre(t,e,r){const a=Wt(t),l=[],u=[];for(const p of e){let m;const v=a.Ma.get(p);if(v&&v.length!==0){m=await uw(a.localStore,sl(v[0]));for(const w of v){const R=a.Fa.get(w),C=await bOe(a,R);C.snapshot&&u.push(C.snapshot)}}else{const w=await Oue(a.localStore,p);m=await uw(a.localStore,w),await GG(a,Que(w),p,!1,m.resumeToken)}l.push(m)}return a.Ca.d_(u),l}function Que(t){return jde(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function ROe(t){return function(r){return Wt(Wt(r).persistence).Qi()}(Wt(t).localStore)}async function COe(t,e,r,a){const l=Wt(t);if(l.Qa)return void Pt("SyncEngine","Ignoring unexpected query state notification.");const u=l.Ma.get(e);if(u&&u.length>0)switch(r){case"current":case"not-current":{const p=await Lue(l.localStore,Fde(u[0])),m=nI.createSynthesizedRemoteEventForCurrentChange(e,r==="current",_a.EMPTY_BYTE_STRING);await sg(l,p,m);break}case"rejected":await hw(l.localStore,e,!0),mw(l,e,a);break;default:cn()}}async function NOe(t,e,r){const a=CL(t);if(a.Qa){for(const l of e){if(a.Ma.has(l)&&a.sharedClientState.isActiveQueryTarget(l)){Pt("SyncEngine","Adding an already active target "+l);continue}const u=await Oue(a.localStore,l),p=await uw(a.localStore,u);await GG(a,Que(u),p.targetId,!1,p.resumeToken),RL(a.remoteStore,p)}for(const l of r)a.Ma.has(l)&&await hw(a.localStore,l,!1).then(()=>{pw(a.remoteStore,l),mw(a,l)}).catch(p0)}}function CL(t){const e=Wt(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Xue.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=xOe.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=mOe.bind(null,e),e.Ca.d_=rOe.bind(null,e.eventManager),e.Ca.$a=iOe.bind(null,e.eventManager),e}function qG(t){const e=Wt(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=gOe.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=_Oe.bind(null,e),e}function IOe(t,e,r){const a=Wt(t);(async function(u,p,m){try{const v=await p.getMetadata();if(await function(O,U){const F=Wt(O),q=Va(U.createTime);return F.persistence.runTransaction("hasNewerBundle","readonly",W=>F.Gr.getBundleMetadata(W,U.id)).then(W=>!!W&&W.createTime.compareTo(q)>=0)}(u.localStore,v))return await p.close(),m._completeWith(function(O){return{taskState:"Success",documentsLoaded:O.totalDocuments,bytesLoaded:O.totalBytes,totalDocuments:O.totalDocuments,totalBytes:O.totalBytes}}(v)),Promise.resolve(new Set);m._updateProgress(Hue(v));const w=new aOe(v,u.localStore,p.serializer);let R=await p.Ua();for(;R;){const A=await w.la(R);A&&m._updateProgress(A),R=await p.Ua()}const C=await w.complete();return await sg(u,C.Ia,void 0),await function(O,U){const F=Wt(O);return F.persistence.runTransaction("Save bundle","readwrite",q=>F.Gr.saveBundleMetadata(q,U))}(u.localStore,v),m._completeWith(C.progress),Promise.resolve(C.Pa)}catch(v){return Jd("SyncEngine",`Loading bundle failed with ${v}`),m._failWith(v),Promise.resolve(new Set)}})(a,e,r).then(l=>{a.sharedClientState.notifyBundleLoaded(l)})}class s0{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=iI(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,r){return null}Ha(e,r){return null}za(e){return Aue(this.persistence,new Iue,e.initialUser,this.serializer)}Ga(e){return new IG(TL.Zr,this.serializer)}Wa(e){return new Mue}async terminate(){var e,r;(e=this.gcScheduler)===null||e===void 0||e.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}s0.provider={build:()=>new s0};class AOe extends s0{constructor(e){super(),this.cacheSizeBytes=e}ja(e,r){yn(this.persistence.referenceDelegate instanceof dO);const a=this.persistence.referenceDelegate.garbageCollector;return new Sue(a,e.asyncQueue,r)}Ga(e){const r=this.cacheSizeBytes!==void 0?nl.withCacheSize(this.cacheSizeBytes):nl.DEFAULT;return new IG(a=>dO.Zr(a,r),this.serializer)}}class YG extends s0{constructor(e,r,a){super(),this.Ja=e,this.cacheSizeBytes=r,this.forceOwnership=a,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await qG(this.Ja.syncEngine),await Gw(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return Aue(this.persistence,new Iue,e.initialUser,this.serializer)}ja(e,r){const a=this.persistence.referenceDelegate.garbageCollector;return new Sue(a,e.asyncQueue,r)}Ha(e,r){const a=new JPe(r,this.persistence);return new XPe(e.asyncQueue,a)}Ga(e){const r=kG(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),a=this.cacheSizeBytes!==void 0?nl.withCacheSize(this.cacheSizeBytes):nl.DEFAULT;return new AG(this.synchronizeTabs,r,e.clientId,a,e.asyncQueue,Uue(),_D(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new Mue}}class Zue extends YG{constructor(e,r){super(e,r,!1),this.Ja=e,this.cacheSizeBytes=r,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const r=this.Ja.syncEngine;this.sharedClientState instanceof BF&&(this.sharedClientState.syncEngine={no:SOe.bind(null,r),ro:COe.bind(null,r),io:NOe.bind(null,r),Qi:ROe.bind(null,r),eo:wOe.bind(null,r)},await this.sharedClientState.start()),await this.persistence.yi(async a=>{await TOe(this.Ja.syncEngine,a),this.gcScheduler&&(a&&!this.gcScheduler.started?this.gcScheduler.start():a||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(a&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():a||this.indexBackfillerScheduler.stop())})}Wa(e){const r=Uue();if(!BF.D(r))throw new Nt(ot.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const a=kG(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new BF(r,e.asyncQueue,a,e.clientId,e.initialUser)}}class a0{async initialize(e,r){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>Hre(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=EOe.bind(null,this.syncEngine),await iz(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new nOe}()}createDatastore(e){const r=iI(e.databaseInfo.databaseId),a=function(u){return new VDe(u)}(e.databaseInfo);return function(u,p,m,v){return new zDe(u,p,m,v)}(e.authCredentials,e.appCheckCredentials,a,r)}createRemoteStore(e){return function(a,l,u,p,m){return new WDe(a,l,u,p,m)}(this.localStore,this.datastore,e.asyncQueue,r=>Hre(this.syncEngine,r,0),function(){return Vre.D()?new Vre:new jDe}())}createSyncEngine(e,r){return function(l,u,p,m,v,w,R){const C=new lOe(l,u,p,m,v,w);return R&&(C.Qa=!0),C}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,r)}async terminate(){var e,r;await async function(l){const u=Wt(l);Pt("RemoteStore","RemoteStore shutting down."),u.L_.add(5),await zw(u),u.k_.shutdown(),u.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()}}a0.provider={build:()=>new a0};function qre(t,e=10240){let r=0;return{async read(){if(r<t.byteLength){const a={value:t.slice(r,r+e),done:!1};return r+=e,a}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NL{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Ma("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,r){setTimeout(()=>{this.muted||e(r)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kOe{constructor(e,r){this.Xa=e,this.serializer=r,this.metadata=new $o,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(a=>{a&&a.ua()?this.metadata.resolve(a.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(a==null?void 0:a.aa)}`))},a=>this.metadata.reject(a))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const r=this.eu.decode(e),a=Number(r);isNaN(a)&&this.ru(`length string (${r}) is not valid number`);const l=await this.iu(a);return new sOe(JSON.parse(l),e.length+a)}su(){return this.buffer.findIndex(e=>e===123)}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const r=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),r}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const r=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),r}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const r=new Uint8Array(this.buffer.length+e.value.length);r.set(this.buffer),r.set(e.value,this.buffer.length),this.buffer=r}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class POe{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new Nt(ot.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const r=await async function(l,u){const p=Wt(l),m={documents:u.map(C=>TN(p.serializer,C))},v=await p.Lo("BatchGetDocuments",p.serializer.databaseId,li.emptyPath(),m,u.length),w=new Map;v.forEach(C=>{const A=$2e(p.serializer,C);w.set(A.key.toString(),A)});const R=[];return u.forEach(C=>{const A=w.get(C.toString());yn(!!A),R.push(A)}),R}(this.datastore,e);return r.forEach(a=>this.recordVersion(a)),r}set(e,r){this.write(r.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,r){try{this.write(r.toMutation(e,this.preconditionForUpdate(e)))}catch(a){this.lastTransactionError=a}this.writtenDocs.add(e.toString())}delete(e){this.write(new Bw(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(r=>{e.delete(r.key.toString())}),e.forEach((r,a)=>{const l=Kt.fromPath(a);this.mutations.push(new vG(l,this.precondition(l)))}),await async function(a,l){const u=Wt(a),p={writes:l.map(m=>RN(u.serializer,m))};await u.Mo("Commit",u.serializer.databaseId,li.emptyPath(),p)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let r;if(e.isFoundDocument())r=e.version;else{if(!e.isNoDocument())throw cn();r=Sn.min()}const a=this.readVersions.get(e.key.toString());if(a){if(!r.isEqual(a))throw new Nt(ot.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),r)}precondition(e){const r=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&r?r.isEqual(Sn.min())?ta.exists(!1):ta.updateTime(r):ta.none()}preconditionForUpdate(e){const r=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&r){if(r.isEqual(Sn.min()))throw new Nt(ot.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ta.updateTime(r)}return ta.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DOe{constructor(e,r,a,l,u){this.asyncQueue=e,this.datastore=r,this.options=a,this.updateFunction=l,this.deferred=u,this._u=a.maxAttempts,this.t_=new OG(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new POe(this.datastore),r=this.cu(e);r&&r.then(a=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(a)}).catch(l=>{this.lu(l)}))}).catch(a=>{this.lu(a)})})}cu(e){try{const r=this.updateFunction(e);return!JN(r)&&r.catch&&r.then?r:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(r){return this.deferred.reject(r),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const r=e.code;return r==="aborted"||r==="failed-precondition"||r==="already-exists"||!eue(r)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OOe{constructor(e,r,a,l,u){this.authCredentials=e,this.appCheckCredentials=r,this.asyncQueue=a,this.databaseInfo=l,this.user=Wo.UNAUTHENTICATED,this.clientId=uG.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=u,this.authCredentials.start(a,async p=>{Pt("FirestoreClient","Received user=",p.uid),await this.authCredentialListener(p),this.user=p}),this.appCheckCredentials.start(a,p=>(Pt("FirestoreClient","Received new app check token=",p),this.appCheckCredentialListener(p,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new $o;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){const a=Hw(r,"Failed to shutdown persistence");e.reject(a)}}),e.promise}}async function GF(t,e){t.asyncQueue.verifyOperationInProgress(),Pt("FirestoreClient","Initializing OfflineComponentProvider");const r=t.configuration;await e.initialize(r);let a=r.initialUser;t.setCredentialChangeListener(async l=>{a.isEqual(l)||(await kue(e.localStore,l),a=l)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function Yre(t,e){t.asyncQueue.verifyOperationInProgress();const r=await $G(t);Pt("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(r,t.configuration),t.setCredentialChangeListener(a=>Fre(e.remoteStore,a)),t.setAppCheckTokenChangeListener((a,l)=>Fre(e.remoteStore,l)),t._onlineComponents=e}async function $G(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Pt("FirestoreClient","Using user provided OfflineComponentProvider");try{await GF(t,t._uninitializedComponentsProvider._offline)}catch(e){const r=e;if(!function(l){return l.name==="FirebaseError"?l.code===ot.FAILED_PRECONDITION||l.code===ot.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(r))throw r;Jd("Error using user provided cache. Falling back to memory cache: "+r),await GF(t,new s0)}}else Pt("FirestoreClient","Using default OfflineComponentProvider"),await GF(t,new s0);return t._offlineComponents}async function IL(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Pt("FirestoreClient","Using user provided OnlineComponentProvider"),await Yre(t,t._uninitializedComponentsProvider._online)):(Pt("FirestoreClient","Using default OnlineComponentProvider"),await Yre(t,new a0))),t._onlineComponents}function ehe(t){return $G(t).then(e=>e.persistence)}function Kw(t){return $G(t).then(e=>e.localStore)}function the(t){return IL(t).then(e=>e.remoteStore)}function XG(t){return IL(t).then(e=>e.syncEngine)}function nhe(t){return IL(t).then(e=>e.datastore)}async function gw(t){const e=await IL(t),r=e.eventManager;return r.onListen=dOe.bind(null,e.syncEngine),r.onUnlisten=hOe.bind(null,e.syncEngine),r.onFirstRemoteStoreListen=uOe.bind(null,e.syncEngine),r.onLastRemoteStoreUnlisten=pOe.bind(null,e.syncEngine),r}function LOe(t){return t.asyncQueue.enqueue(async()=>{const e=await ehe(t),r=await the(t);return e.setNetworkEnabled(!0),function(l){const u=Wt(l);return u.L_.delete(0),sI(u)}(r)})}function jOe(t){return t.asyncQueue.enqueue(async()=>{const e=await ehe(t),r=await the(t);return e.setNetworkEnabled(!1),async function(l){const u=Wt(l);u.L_.add(0),await zw(u),u.q_.set("Offline")}(r)})}function MOe(t,e){const r=new $o;return t.asyncQueue.enqueueAndForget(async()=>async function(l,u,p){try{const m=await function(w,R){const C=Wt(w);return C.persistence.runTransaction("read document","readonly",A=>C.localDocuments.getDocument(A,R))}(l,u);m.isFoundDocument()?p.resolve(m):m.isNoDocument()?p.resolve(null):p.reject(new Nt(ot.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(m){const v=Hw(m,`Failed to get document '${u} from cache`);p.reject(v)}}(await Kw(t),e,r)),r.promise}function rhe(t,e,r={}){const a=new $o;return t.asyncQueue.enqueueAndForget(async()=>function(u,p,m,v,w){const R=new NL({next:A=>{R.Za(),p.enqueueAndForget(()=>FG(u,C));const O=A.docs.has(m);!O&&A.fromCache?w.reject(new Nt(ot.UNAVAILABLE,"Failed to get document because the client is offline.")):O&&A.fromCache&&v&&v.source==="server"?w.reject(new Nt(ot.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):w.resolve(A)},error:A=>w.reject(A)}),C=new zG(Vw(m.path),R,{includeMetadataChanges:!0,_a:!0});return VG(u,C)}(await gw(t),t.asyncQueue,e,r,a)),a.promise}function UOe(t,e){const r=new $o;return t.asyncQueue.enqueueAndForget(async()=>async function(l,u,p){try{const m=await uO(l,u,!0),v=new Yue(u,m.Ts),w=v.ma(m.documents),R=v.applyChanges(w,!1);p.resolve(R.snapshot)}catch(m){const v=Hw(m,`Failed to execute query '${u} against cache`);p.reject(v)}}(await Kw(t),e,r)),r.promise}function ihe(t,e,r={}){const a=new $o;return t.asyncQueue.enqueueAndForget(async()=>function(u,p,m,v,w){const R=new NL({next:A=>{R.Za(),p.enqueueAndForget(()=>FG(u,C)),A.fromCache&&v.source==="server"?w.reject(new Nt(ot.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):w.resolve(A)},error:A=>w.reject(A)}),C=new zG(m,R,{includeMetadataChanges:!0,_a:!0});return VG(u,C)}(await gw(t),t.asyncQueue,e,r,a)),a.promise}function VOe(t,e,r){const a=new $o;return t.asyncQueue.enqueueAndForget(async()=>{try{const l=await nhe(t);a.resolve(async function(p,m,v){var w;const R=Wt(p),{request:C,ut:A,parent:O}=hue(R.serializer,Mde(m),v);R.connection.Fo||delete C.parent;const U=(await R.Lo("RunAggregationQuery",R.serializer.databaseId,O,C,1)).filter(q=>!!q.result);yn(U.length===1);const F=(w=U[0].result)===null||w===void 0?void 0:w.aggregateFields;return Object.keys(F).reduce((q,W)=>(q[A[W]]=F[W],q),{})}(l,e,r))}catch(l){a.reject(l)}}),a.promise}function FOe(t,e){const r=new NL(e);return t.asyncQueue.enqueueAndForget(async()=>function(l,u){Wt(l).Y_.add(u),u.next()}(await gw(t),r)),()=>{r.Za(),t.asyncQueue.enqueueAndForget(async()=>function(l,u){Wt(l).Y_.delete(u)}(await gw(t),r))}}function BOe(t,e,r,a){const l=function(p,m){let v;return v=typeof p=="string"?nue().encode(p):p,function(R,C){return new kOe(R,C)}(function(R,C){if(R instanceof Uint8Array)return qre(R,C);if(R instanceof ArrayBuffer)return qre(new Uint8Array(R),C);if(R instanceof ReadableStream)return R.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(v),m)}(r,iI(e));t.asyncQueue.enqueueAndForget(async()=>{IOe(await XG(t),l,a)})}function zOe(t,e){return t.asyncQueue.enqueue(async()=>function(a,l){const u=Wt(a);return u.persistence.runTransaction("Get named query","readonly",p=>u.Gr.getNamedQuery(p,l))}(await Kw(t),e))}function GOe(t,e){return t.asyncQueue.enqueue(async()=>async function(a,l){const u=Wt(a),p=u.indexManager,m=[];return u.persistence.runTransaction("Configure indexes","readwrite",v=>p.getFieldIndexes(v).next(w=>function(C,A,O,U,F){C=[...C],A=[...A],C.sort(O),A.sort(O);const q=C.length,W=A.length;let H=0,X=0;for(;H<W&&X<q;){const ne=O(C[X],A[H]);ne<0?F(C[X++]):ne>0?U(A[H++]):(H++,X++)}for(;H<W;)U(A[H++]);for(;X<q;)F(C[X++])}(w,l,KPe,R=>{m.push(p.addFieldIndex(v,R))},R=>{m.push(p.deleteFieldIndex(v,R))})).next(()=>$e.waitFor(m)))}(await Kw(t),e))}function WOe(t,e){return t.asyncQueue.enqueue(async()=>function(a,l){Wt(a).ss.zi=l}(await Kw(t),e))}function HOe(t){return t.asyncQueue.enqueue(async()=>function(r){const a=Wt(r),l=a.indexManager;return a.persistence.runTransaction("Delete All Indexes","readwrite",u=>l.deleteAllFieldIndexes(u))}(await Kw(t)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function she(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $re=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JG(t,e,r){if(!r)throw new Nt(ot.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function ahe(t,e,r,a){if(e===!0&&a===!0)throw new Nt(ot.INVALID_ARGUMENT,`${t} and ${r} cannot be used together.`)}function Xre(t){if(!Kt.isDocumentKey(t))throw new Nt(ot.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Jre(t){if(Kt.isDocumentKey(t))throw new Nt(ot.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function AL(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(a){return a.constructor?a.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":cn()}function Xr(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Nt(ot.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const r=AL(t);throw new Nt(ot.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${r}`)}}return t}function ohe(t,e){if(e<=0)throw new Nt(ot.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qre{constructor(e){var r,a;if(e.host===void 0){if(e.ssl!==void 0)throw new Nt(ot.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(r=e.ssl)===null||r===void 0||r;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Nt(ot.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}ahe("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=she((a=e.experimentalLongPollingOptions)!==null&&a!==void 0?a:{}),function(u){if(u.timeoutSeconds!==void 0){if(isNaN(u.timeoutSeconds))throw new Nt(ot.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (must not be NaN)`);if(u.timeoutSeconds<5)throw new Nt(ot.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (minimum allowed value is 5)`);if(u.timeoutSeconds>30)throw new Nt(ot.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(a,l){return a.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class aI{constructor(e,r,a,l){this._authCredentials=e,this._appCheckCredentials=r,this._databaseId=a,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Qre({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Nt(ot.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Nt(ot.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Qre(e),e.credentials!==void 0&&(this._authCredentials=function(a){if(!a)return new dde;switch(a.type){case"firstParty":return new BPe(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new Nt(ot.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(r){const a=$re.get(r);a&&(Pt("ComponentProvider","Removing Datastore"),$re.delete(r),a.terminate())}(this),Promise.resolve()}}function che(t,e,r,a={}){var l;const u=(t=Xr(t,aI))._getSettings(),p=`${e}:${r}`;if(u.host!=="firestore.googleapis.com"&&u.host!==p&&Jd("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},u),{host:p,ssl:!1})),a.mockUserToken){let m,v;if(typeof a.mockUserToken=="string")m=a.mockUserToken,v=Wo.MOCK_USER;else{m=ile(a.mockUserToken,(l=t._app)===null||l===void 0?void 0:l.options.projectId);const w=a.mockUserToken.sub||a.mockUserToken.user_id;if(!w)throw new Nt(ot.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");v=new Wo(w)}t._authCredentials=new UPe(new lde(m,v))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jo{constructor(e,r,a){this.converter=r,this._query=a,this.type="query",this.firestore=e}withConverter(e){return new Jo(this.firestore,e,this._query)}}class Ta{constructor(e,r,a){this.converter=r,this._key=a,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new sp(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ta(this.firestore,e,this._key)}}class sp extends Jo{constructor(e,r,a){super(e,r,Vw(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ta(this.firestore,null,new Kt(e))}withConverter(e){return new sp(this.firestore,e,this._path)}}function mn(t,e,...r){if(t=zn(t),JG("collection","path",e),t instanceof aI){const a=li.fromString(e,...r);return Jre(a),new sp(t,null,a)}{if(!(t instanceof Ta||t instanceof sp))throw new Nt(ot.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=t._path.child(li.fromString(e,...r));return Jre(a),new sp(t.firestore,null,a)}}function KOe(t,e){if(t=Xr(t,aI),JG("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Nt(ot.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Jo(t,null,function(a){return new ng(li.emptyPath(),a)}(e))}function tt(t,e,...r){if(t=zn(t),arguments.length===1&&(e=uG.newId()),JG("doc","path",e),t instanceof aI){const a=li.fromString(e,...r);return Xre(a),new Ta(t,null,new Kt(a))}{if(!(t instanceof Ta||t instanceof sp))throw new Nt(ot.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=t._path.child(li.fromString(e,...r));return Xre(a),new Ta(t.firestore,t instanceof sp?t.converter:null,new Kt(a))}}function qOe(t,e){return t=zn(t),e=zn(e),(t instanceof Ta||t instanceof sp)&&(e instanceof Ta||e instanceof sp)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function QG(t,e){return t=zn(t),e=zn(e),t instanceof Jo&&e instanceof Jo&&t.firestore===e.firestore&&ZN(t._query,e._query)&&t.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zre{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new OG(this,"async_queue_retry"),this.Vu=()=>{const a=_D();a&&Pt("AsyncQueue","Visibility state changed to "+a.visibilityState),this.t_.jo()},this.mu=e;const r=_D();r&&typeof r.addEventListener=="function"&&r.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const r=_D();r&&typeof r.removeEventListener=="function"&&r.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const r=new $o;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(r.resolve,r.reject),r.promise)).then(()=>r.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!f0(e))throw e;Pt("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const r=this.mu.then(()=>(this.du=!0,e().catch(a=>{this.Eu=a,this.du=!1;const l=function(p){let m=p.message||"";return p.stack&&(m=p.stack.includes(p.message)?p.stack:p.message+`
`+p.stack),m}(a);throw Ma("INTERNAL UNHANDLED ERROR: ",l),a}).then(a=>(this.du=!1,a))));return this.mu=r,r}enqueueAfterDelay(e,r,a){this.fu(),this.Ru.indexOf(e)>-1&&(r=0);const l=UG.createAndSchedule(this,e,r,a,u=>this.yu(u));return this.Tu.push(l),l}fu(){this.Eu&&cn()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const r of this.Tu)if(r.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((r,a)=>r.targetTimeMs-a.targetTimeMs);for(const r of this.Tu)if(r.skipDelay(),e!=="all"&&r.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const r=this.Tu.indexOf(e);this.Tu.splice(r,1)}}function oz(t){return function(r,a){if(typeof r!="object"||r===null)return!1;const l=r;for(const u of a)if(u in l&&typeof l[u]=="function")return!0;return!1}(t,["next","error","complete"])}class lhe{constructor(){this._progressObserver={},this._taskCompletionResolver=new $o,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,r,a){this._progressObserver={next:e,error:r,complete:a}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,r){return this._taskCompletionResolver.promise.then(e,r)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YOe=-1;class ls extends aI{constructor(e,r,a,l){super(e,r,a,l),this.type="firestore",this._queue=new Zre,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Zre(e),this._firestoreClient=void 0,await e}}}function $Oe(t,e,r){r||(r="(default)");const a=Lw(t,"firestore");if(a.isInitialized(r)){const l=a.getImmediate({identifier:r}),u=a.getOptions(r);if(J_(u,e))return l;throw new Nt(ot.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new Nt(ot.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Nt(ot.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return a.initialize({options:e,instanceIdentifier:r})}function dhe(t,e){const r=typeof t=="object"?t:$8(),a=typeof t=="string"?t:e||"(default)",l=Lw(r,"firestore").getImmediate({identifier:a});if(!l._initialized){const u=tle("firestore");u&&che(l,...u)}return l}function ra(t){if(t._terminated)throw new Nt(ot.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||uhe(t),t._firestoreClient}function uhe(t){var e,r,a;const l=t._freezeSettings(),u=function(m,v,w,R){return new v2e(m,v,w,R.host,R.ssl,R.experimentalForceLongPolling,R.experimentalAutoDetectLongPolling,she(R.experimentalLongPollingOptions),R.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,l);t._componentsProvider||!((r=l.localCache)===null||r===void 0)&&r._offlineComponentProvider&&(!((a=l.localCache)===null||a===void 0)&&a._onlineComponentProvider)&&(t._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),t._firestoreClient=new OOe(t._authCredentials,t._appCheckCredentials,t._queue,u,t._componentsProvider&&function(m){const v=m==null?void 0:m._online.build();return{_offline:m==null?void 0:m._offline.build(v),_online:v}}(t._componentsProvider))}function XOe(t,e){Jd("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=t._freezeSettings();return hhe(t,a0.provider,{build:a=>new YG(a,r.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function JOe(t){Jd("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=t._freezeSettings();hhe(t,a0.provider,{build:r=>new Zue(r,e.cacheSizeBytes)})}function hhe(t,e,r){if((t=Xr(t,ls))._firestoreClient||t._terminated)throw new Nt(ot.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(t._componentsProvider||t._getSettings().localCache)throw new Nt(ot.FAILED_PRECONDITION,"SDK cache is already specified.");t._componentsProvider={_online:e,_offline:r},uhe(t)}function QOe(t){if(t._initialized&&!t._terminated)throw new Nt(ot.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new $o;return t._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(a){if(!Rf.D())return Promise.resolve();const l=a+"main";await Rf.delete(l)}(kG(t._databaseId,t._persistenceKey)),e.resolve()}catch(r){e.reject(r)}}),e.promise}function ZOe(t){return function(r){const a=new $o;return r.asyncQueue.enqueueAndForget(async()=>yOe(await XG(r),a)),a.promise}(ra(t=Xr(t,ls)))}function eLe(t){return LOe(ra(t=Xr(t,ls)))}function tLe(t){return jOe(ra(t=Xr(t,ls)))}function nLe(t){return kAe(t.app,"firestore",t._databaseId.database),t._delete()}function rLe(t,e){const r=ra(t=Xr(t,ls)),a=new lhe;return BOe(r,t._databaseId,e,a),a}function iLe(t,e){return zOe(ra(t=Xr(t,ls)),e).then(r=>r?new Jo(t,null,r.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _w{constructor(e="count",r){this._internalFieldPath=r,this.type="AggregateField",this.aggregateType=e}}class phe{constructor(e,r,a){this._userDataWriter=r,this._data=a,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o0{constructor(e){this._byteString=e}static fromBase64String(e){try{return new o0(_a.fromBase64String(e))}catch(r){throw new Nt(ot.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+r)}}static fromUint8Array(e){return new o0(_a.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _0{constructor(...e){for(let r=0;r<e.length;++r)if(e[r].length===0)throw new Nt(ot.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ms(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function sLe(){return new _0("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y0{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qw{constructor(e,r){if(!isFinite(e)||e<-90||e>90)throw new Nt(ot.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(r)||r<-180||r>180)throw new Nt(ot.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+r);this._lat=e,this._long=r}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ir(this._lat,e._lat)||ir(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oI{constructor(e){this._values=(e||[]).map(r=>r)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(a,l){if(a.length!==l.length)return!1;for(let u=0;u<a.length;++u)if(a[u]!==l[u])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aLe=/^__.*__$/;class oLe{constructor(e,r,a){this.data=e,this.fieldMask=r,this.fieldTransforms=a}toMutation(e,r){return this.fieldMask!==null?new ig(e,this.data,this.fieldMask,r,this.fieldTransforms):new Fw(e,this.data,r,this.fieldTransforms)}}class fhe{constructor(e,r,a){this.data=e,this.fieldMask=r,this.fieldTransforms=a}toMutation(e,r){return new ig(e,this.data,this.fieldMask,r,this.fieldTransforms)}}function mhe(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw cn()}}class kL{constructor(e,r,a,l,u,p){this.settings=e,this.databaseId=r,this.serializer=a,this.ignoreUndefinedProperties=l,u===void 0&&this.vu(),this.fieldTransforms=u||[],this.fieldMask=p||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new kL(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var r;const a=(r=this.path)===null||r===void 0?void 0:r.child(e),l=this.Fu({path:a,xu:!1});return l.Ou(e),l}Nu(e){var r;const a=(r=this.path)===null||r===void 0?void 0:r.child(e),l=this.Fu({path:a,xu:!1});return l.vu(),l}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return mO(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(r=>e.isPrefixOf(r))!==void 0||this.fieldTransforms.find(r=>e.isPrefixOf(r.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(mhe(this.Cu)&&aLe.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class cLe{constructor(e,r,a){this.databaseId=e,this.ignoreUndefinedProperties=r,this.serializer=a||iI(e)}Qu(e,r,a,l=!1){return new kL({Cu:e,methodName:r,qu:a,path:Ms.emptyPath(),xu:!1,ku:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Wv(t){const e=t._freezeSettings(),r=iI(t._databaseId);return new cLe(t._databaseId,!!e.ignoreUndefinedProperties,r)}function PL(t,e,r,a,l,u={}){const p=t.Qu(u.merge||u.mergeFields?2:0,e,r,l);sW("Data must be an object, but it was:",p,a);const m=yhe(a,p);let v,w;if(u.merge)v=new cd(p.fieldMask),w=p.fieldTransforms;else if(u.mergeFields){const R=[];for(const C of u.mergeFields){const A=CN(e,C,r);if(!p.contains(A))throw new Nt(ot.INVALID_ARGUMENT,`Field '${A}' is specified in your field mask but missing from your input data.`);Ehe(R,A)||R.push(A)}v=new cd(R),w=p.fieldTransforms.filter(C=>v.covers(C.field))}else v=null,w=p.fieldTransforms;return new oLe(new Cc(m),v,w)}class cI extends y0{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof cI}}function ghe(t,e,r){return new kL({Cu:3,qu:e.settings.qu,methodName:t._methodName,xu:r},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class ZG extends y0{_toFieldTransform(e){return new tI(e.path,new cw)}isEqual(e){return e instanceof ZG}}class eW extends y0{constructor(e,r){super(e),this.Ku=r}_toFieldTransform(e){const r=ghe(this,e,!0),a=this.Ku.map(u=>Hv(u,r)),l=new Nv(a);return new tI(e.path,l)}isEqual(e){return e instanceof eW&&J_(this.Ku,e.Ku)}}class tW extends y0{constructor(e,r){super(e),this.Ku=r}_toFieldTransform(e){const r=ghe(this,e,!0),a=this.Ku.map(u=>Hv(u,r)),l=new Iv(a);return new tI(e.path,l)}isEqual(e){return e instanceof tW&&J_(this.Ku,e.Ku)}}class nW extends y0{constructor(e,r){super(e),this.$u=r}_toFieldTransform(e){const r=new lw(e.serializer,Kde(e.serializer,this.$u));return new tI(e.path,r)}isEqual(e){return e instanceof nW&&this.$u===e.$u}}function rW(t,e,r,a){const l=t.Qu(1,e,r);sW("Data must be an object, but it was:",l,a);const u=[],p=Cc.empty();m0(a,(v,w)=>{const R=DL(e,v,r);w=zn(w);const C=l.Nu(R);if(w instanceof cI)u.push(R);else{const A=Hv(w,C);A!=null&&(u.push(R),p.set(R,A))}});const m=new cd(u);return new fhe(p,m,l.fieldTransforms)}function iW(t,e,r,a,l,u){const p=t.Qu(1,e,r),m=[CN(e,a,r)],v=[l];if(u.length%2!=0)throw new Nt(ot.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let A=0;A<u.length;A+=2)m.push(CN(e,u[A])),v.push(u[A+1]);const w=[],R=Cc.empty();for(let A=m.length-1;A>=0;--A)if(!Ehe(w,m[A])){const O=m[A];let U=v[A];U=zn(U);const F=p.Nu(O);if(U instanceof cI)w.push(O);else{const q=Hv(U,F);q!=null&&(w.push(O),R.set(O,q))}}const C=new cd(w);return new fhe(R,C,p.fieldTransforms)}function _he(t,e,r,a=!1){return Hv(r,t.Qu(a?4:3,e))}function Hv(t,e){if(vhe(t=zn(t)))return sW("Unsupported field value:",e,t),yhe(t,e);if(t instanceof y0)return function(a,l){if(!mhe(l.Cu))throw l.Bu(`${a._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Bu(`${a._methodName}() is not currently supported inside arrays`);const u=a._toFieldTransform(l);u&&l.fieldTransforms.push(u)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(a,l){const u=[];let p=0;for(const m of a){let v=Hv(m,l.Lu(p));v==null&&(v={nullValue:"NULL_VALUE"}),u.push(v),p++}return{arrayValue:{values:u}}}(t,e)}return function(a,l){if((a=zn(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return Kde(l.serializer,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const u=fn.fromDate(a);return{timestampValue:dw(l.serializer,u)}}if(a instanceof fn){const u=new fn(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:dw(l.serializer,u)}}if(a instanceof qw)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof o0)return{bytesValue:sue(l.serializer,a._byteString)};if(a instanceof Ta){const u=l.databaseId,p=a.firestore._databaseId;if(!p.isEqual(u))throw l.Bu(`Document reference is for database ${p.projectId}/${p.database} but should be for database ${u.projectId}/${u.database}`);return{referenceValue:SG(a.firestore._databaseId||l.databaseId,a._key.path)}}if(a instanceof oI)return function(p,m){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:p.toArray().map(v=>{if(typeof v!="number")throw m.Bu("VectorValues must only contain numeric values.");return yG(m.serializer,v)})}}}}}}(a,l);throw l.Bu(`Unsupported field value: ${AL(a)}`)}(t,e)}function yhe(t,e){const r={};return Sde(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):m0(t,(a,l)=>{const u=Hv(l,e.Mu(a));u!=null&&(r[a]=u)}),{mapValue:{fields:r}}}function vhe(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof fn||t instanceof qw||t instanceof o0||t instanceof Ta||t instanceof y0||t instanceof oI)}function sW(t,e,r){if(!vhe(r)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(r)){const a=AL(r);throw a==="an object"?e.Bu(t+" a custom object"):e.Bu(t+" "+a)}}function CN(t,e,r){if((e=zn(e))instanceof _0)return e._internalPath;if(typeof e=="string")return DL(t,e);throw mO("Field path arguments must be of type string or ",t,!1,void 0,r)}const lLe=new RegExp("[~\\*/\\[\\]]");function DL(t,e,r){if(e.search(lLe)>=0)throw mO(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new _0(...e.split("."))._internalPath}catch{throw mO(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function mO(t,e,r,a,l){const u=a&&!a.isEmpty(),p=l!==void 0;let m=`Function ${e}() called with invalid data`;r&&(m+=" (via `toFirestore()`)"),m+=". ";let v="";return(u||p)&&(v+=" (found",u&&(v+=` in field ${a}`),p&&(v+=` in document ${l}`),v+=")"),new Nt(ot.INVALID_ARGUMENT,m+t+v)}function Ehe(t,e){return t.some(r=>r.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NN{constructor(e,r,a,l,u){this._firestore=e,this._userDataWriter=r,this._key=a,this._document=l,this._converter=u}get id(){return this._key.path.lastSegment()}get ref(){return new Ta(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new dLe(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const r=this._document.data.field(OL("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r)}}}class dLe extends NN{data(){return super.data()}}function OL(t,e){return typeof e=="string"?DL(t,e):e instanceof _0?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xhe(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Nt(ot.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class aW{}class Yw extends aW{}function Mr(t,e,...r){let a=[];e instanceof aW&&a.push(e),a=a.concat(r),function(u){const p=u.filter(v=>v instanceof Kv).length,m=u.filter(v=>v instanceof $w).length;if(p>1||p>0&&m>0)throw new Nt(ot.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(a);for(const l of a)t=l._apply(t);return t}class $w extends Yw{constructor(e,r,a){super(),this._field=e,this._op=r,this._value=a,this.type="where"}static _create(e,r,a){return new $w(e,r,a)}_apply(e){const r=this._parse(e);return whe(e._query,r),new Jo(e.firestore,e.converter,$6(e._query,r))}_parse(e){const r=Wv(e.firestore);return function(u,p,m,v,w,R,C){let A;if(w.isKeyField()){if(R==="array-contains"||R==="array-contains-any")throw new Nt(ot.INVALID_ARGUMENT,`Invalid Query. You can't perform '${R}' queries on documentId().`);if(R==="in"||R==="not-in"){tie(C,R);const O=[];for(const U of C)O.push(eie(v,u,U));A={arrayValue:{values:O}}}else A=eie(v,u,C)}else R!=="in"&&R!=="not-in"&&R!=="array-contains-any"||tie(C,R),A=_he(m,p,C,R==="in"||R==="not-in");return di.create(w,R,A)}(e._query,"where",r,e.firestore._databaseId,this._field,this._op,this._value)}}function Kn(t,e,r){const a=e,l=OL("where",t);return $w._create(l,a,r)}class Kv extends aW{constructor(e,r){super(),this.type=e,this._queryConstraints=r}static _create(e,r){return new Kv(e,r)}_parse(e){const r=this._queryConstraints.map(a=>a._parse(e)).filter(a=>a.getFilters().length>0);return r.length===1?r[0]:$i.create(r,this._getOperator())}_apply(e){const r=this._parse(e);return r.getFilters().length===0?e:(function(l,u){let p=l;const m=u.getFlattenedFilters();for(const v of m)whe(p,v),p=$6(p,v)}(e._query,r),new Jo(e.firestore,e.converter,$6(e._query,r)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function uLe(...t){return t.forEach(e=>She("or",e)),Kv._create("or",t)}function hLe(...t){return t.forEach(e=>She("and",e)),Kv._create("and",t)}class LL extends Yw{constructor(e,r){super(),this._field=e,this._direction=r,this.type="orderBy"}static _create(e,r){return new LL(e,r)}_apply(e){const r=function(l,u,p){if(l.startAt!==null)throw new Nt(ot.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(l.endAt!==null)throw new Nt(ot.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new SN(u,p)}(e._query,this._field,this._direction);return new Jo(e.firestore,e.converter,function(l,u){const p=l.explicitOrderBy.concat([u]);return new ng(l.path,l.collectionGroup,p,l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt)}(e._query,r))}}function ih(t,e="asc"){const r=e,a=OL("orderBy",t);return LL._create(a,r)}class lI extends Yw{constructor(e,r,a){super(),this.type=e,this._limit=r,this._limitType=a}static _create(e,r,a){return new lI(e,r,a)}_apply(e){return new Jo(e.firestore,e.converter,sO(e._query,this._limit,this._limitType))}}function up(t){return ohe("limit",t),lI._create("limit",t,"F")}function pLe(t){return ohe("limitToLast",t),lI._create("limitToLast",t,"L")}class dI extends Yw{constructor(e,r,a){super(),this.type=e,this._docOrFields=r,this._inclusive=a}static _create(e,r,a){return new dI(e,r,a)}_apply(e){const r=bhe(e,this.type,this._docOrFields,this._inclusive);return new Jo(e.firestore,e.converter,function(l,u){return new ng(l.path,l.collectionGroup,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,u,l.endAt)}(e._query,r))}}function fLe(...t){return dI._create("startAt",t,!0)}function mLe(...t){return dI._create("startAfter",t,!1)}class uI extends Yw{constructor(e,r,a){super(),this.type=e,this._docOrFields=r,this._inclusive=a}static _create(e,r,a){return new uI(e,r,a)}_apply(e){const r=bhe(e,this.type,this._docOrFields,this._inclusive);return new Jo(e.firestore,e.converter,function(l,u){return new ng(l.path,l.collectionGroup,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,l.startAt,u)}(e._query,r))}}function gLe(...t){return uI._create("endBefore",t,!1)}function _Le(...t){return uI._create("endAt",t,!0)}function bhe(t,e,r,a){if(r[0]=zn(r[0]),r[0]instanceof NN)return function(u,p,m,v,w){if(!v)throw new Nt(ot.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${m}().`);const R=[];for(const C of Gb(u))if(C.field.isKeyField())R.push(Rv(p,v.key));else{const A=v.data.field(C.field);if(_L(A))throw new Nt(ot.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+C.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(A===null){const O=C.field.canonicalString();throw new Nt(ot.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${O}' (used as the orderBy) does not exist.`)}R.push(A)}return new r0(R,w)}(t._query,t.firestore._databaseId,e,r[0]._document,a);{const l=Wv(t.firestore);return function(p,m,v,w,R,C){const A=p.explicitOrderBy;if(R.length>A.length)throw new Nt(ot.INVALID_ARGUMENT,`Too many arguments provided to ${w}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const O=[];for(let U=0;U<R.length;U++){const F=R[U];if(A[U].field.isKeyField()){if(typeof F!="string")throw new Nt(ot.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${w}(), but got a ${typeof F}`);if(!gG(p)&&F.indexOf("/")!==-1)throw new Nt(ot.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${w}() must be a plain document ID, but '${F}' contains a slash.`);const q=p.path.child(li.fromString(F));if(!Kt.isDocumentKey(q))throw new Nt(ot.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${w}() must result in a valid document path, but '${q}' is not because it contains an odd number of segments.`);const W=new Kt(q);O.push(Rv(m,W))}else{const q=_he(v,w,F);O.push(q)}}return new r0(O,C)}(t._query,t.firestore._databaseId,l,e,r,a)}}function eie(t,e,r){if(typeof(r=zn(r))=="string"){if(r==="")throw new Nt(ot.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!gG(e)&&r.indexOf("/")!==-1)throw new Nt(ot.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);const a=e.path.child(li.fromString(r));if(!Kt.isDocumentKey(a))throw new Nt(ot.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${a}' is not because it has an odd number of segments (${a.length}).`);return Rv(t,new Kt(a))}if(r instanceof Ta)return Rv(t,r._key);throw new Nt(ot.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${AL(r)}.`)}function tie(t,e){if(!Array.isArray(t)||t.length===0)throw new Nt(ot.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function whe(t,e){const r=function(l,u){for(const p of l)for(const m of p.getFlattenedFilters())if(u.indexOf(m.op)>=0)return m.op;return null}(t.filters,function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(r!==null)throw r===e.op?new Nt(ot.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Nt(ot.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${r.toString()}' filters.`)}function She(t,e){if(!(e instanceof $w||e instanceof Kv))throw new Nt(ot.INVALID_ARGUMENT,`Function ${t}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class oW{convertValue(e,r="none"){switch(t0(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Zs(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,r);case 5:return e.stringValue;case 6:return this.convertBytes(Ym(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,r);case 11:return this.convertObject(e.mapValue,r);case 10:return this.convertVectorValue(e.mapValue);default:throw cn()}}convertObject(e,r){return this.convertObjectMap(e.fields,r)}convertObjectMap(e,r="none"){const a={};return m0(e,(l,u)=>{a[l]=this.convertValue(u,r)}),a}convertVectorValue(e){var r,a,l;const u=(l=(a=(r=e.fields)===null||r===void 0?void 0:r.value.arrayValue)===null||a===void 0?void 0:a.values)===null||l===void 0?void 0:l.map(p=>Zs(p.doubleValue));return new oI(u)}convertGeoPoint(e){return new qw(Zs(e.latitude),Zs(e.longitude))}convertArray(e,r){return(e.values||[]).map(a=>this.convertValue(a,r))}convertServerTimestamp(e,r){switch(r){case"previous":const a=yL(e);return a==null?null:this.convertValue(a,r);case"estimate":return this.convertTimestamp(xN(e));default:return null}}convertTimestamp(e){const r=qm(e);return new fn(r.seconds,r.nanos)}convertDocumentKey(e,r){const a=li.fromString(e);yn(gue(a));const l=new e0(a.get(1),a.get(3)),u=new Kt(a.popFirst(5));return l.isEqual(r)||Ma(`Document ${u} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${r.projectId}/${r.database}) instead.`),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jL(t,e,r){let a;return a=t?r&&(r.merge||r.mergeFields)?t.toFirestore(e,r):t.toFirestore(e):e,a}class yLe extends oW{constructor(e){super(),this.firestore=e}convertBytes(e){return new o0(e)}convertReference(e){const r=this.convertDocumentKey(e,this.firestore._databaseId);return new Ta(this.firestore,null,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vLe(t){return new _w("sum",CN("sum",t))}function ELe(t){return new _w("avg",CN("average",t))}function The(){return new _w("count")}function xLe(t,e){var r,a;return t instanceof _w&&e instanceof _w&&t.aggregateType===e.aggregateType&&((r=t._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())===((a=e._internalFieldPath)===null||a===void 0?void 0:a.canonicalString())}function bLe(t,e){return QG(t.query,e.query)&&J_(t.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k_{constructor(e,r){this.hasPendingWrites=e,this.fromCache=r}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Dv extends NN{constructor(e,r,a,l,u,p){super(e,r,a,l,p),this._firestore=e,this._firestoreImpl=e,this.metadata=u}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const r=new UC(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(r,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,r={}){if(this._document){const a=this._document.data.field(OL("DocumentSnapshot.get",e));if(a!==null)return this._userDataWriter.convertValue(a,r.serverTimestamps)}}}class UC extends Dv{data(e={}){return super.data(e)}}class Ov{constructor(e,r,a,l){this._firestore=e,this._userDataWriter=r,this._snapshot=l,this.metadata=new k_(l.hasPendingWrites,l.fromCache),this.query=a}get docs(){const e=[];return this.forEach(r=>e.push(r)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,r){this._snapshot.docs.forEach(a=>{e.call(r,new UC(this._firestore,this._userDataWriter,a.key,a,new k_(this._snapshot.mutatedKeys.has(a.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const r=!!e.includeMetadataChanges;if(r&&this._snapshot.excludesMetadataChanges)throw new Nt(ot.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===r||(this._cachedChanges=function(l,u){if(l._snapshot.oldDocs.isEmpty()){let p=0;return l._snapshot.docChanges.map(m=>{const v=new UC(l._firestore,l._userDataWriter,m.doc.key,m.doc,new k_(l._snapshot.mutatedKeys.has(m.doc.key),l._snapshot.fromCache),l.query.converter);return m.doc,{type:"added",doc:v,oldIndex:-1,newIndex:p++}})}{let p=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(m=>u||m.type!==3).map(m=>{const v=new UC(l._firestore,l._userDataWriter,m.doc.key,m.doc,new k_(l._snapshot.mutatedKeys.has(m.doc.key),l._snapshot.fromCache),l.query.converter);let w=-1,R=-1;return m.type!==0&&(w=p.indexOf(m.doc.key),p=p.delete(m.doc.key)),m.type!==1&&(p=p.add(m.doc),R=p.indexOf(m.doc.key)),{type:wLe(m.type),doc:v,oldIndex:w,newIndex:R}})}}(this,r),this._cachedChangesIncludeMetadataChanges=r),this._cachedChanges}}function wLe(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return cn()}}function SLe(t,e){return t instanceof Dv&&e instanceof Dv?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(t._document===null?e._document===null:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Ov&&e instanceof Ov&&t._firestore===e._firestore&&QG(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bn(t){t=Xr(t,Ta);const e=Xr(t.firestore,ls);return rhe(ra(e),t._key).then(r=>cW(e,t,r))}class v0 extends oW{constructor(e){super(),this.firestore=e}convertBytes(e){return new o0(e)}convertReference(e){const r=this.convertDocumentKey(e,this.firestore._databaseId);return new Ta(this.firestore,null,r)}}function TLe(t){t=Xr(t,Ta);const e=Xr(t.firestore,ls),r=ra(e),a=new v0(e);return MOe(r,t._key).then(l=>new Dv(e,a,t._key,l,new k_(l!==null&&l.hasLocalMutations,!0),t.converter))}function RLe(t){t=Xr(t,Ta);const e=Xr(t.firestore,ls);return rhe(ra(e),t._key,{source:"server"}).then(r=>cW(e,t,r))}function Cr(t){t=Xr(t,Jo);const e=Xr(t.firestore,ls),r=ra(e),a=new v0(e);return xhe(t._query),ihe(r,t._query).then(l=>new Ov(e,a,t,l))}function CLe(t){t=Xr(t,Jo);const e=Xr(t.firestore,ls),r=ra(e),a=new v0(e);return UOe(r,t._query).then(l=>new Ov(e,a,t,l))}function NLe(t){t=Xr(t,Jo);const e=Xr(t.firestore,ls),r=ra(e),a=new v0(e);return ihe(r,t._query,{source:"server"}).then(l=>new Ov(e,a,t,l))}function Yi(t,e,r){t=Xr(t,Ta);const a=Xr(t.firestore,ls),l=jL(t.converter,e,r);return Xw(a,[PL(Wv(a),"setDoc",t._key,l,t.converter!==null,r).toMutation(t._key,ta.none())])}function Xn(t,e,r,...a){t=Xr(t,Ta);const l=Xr(t.firestore,ls),u=Wv(l);let p;return p=typeof(e=zn(e))=="string"||e instanceof _0?iW(u,"updateDoc",t._key,e,r,a):rW(u,"updateDoc",t._key,e),Xw(l,[p.toMutation(t._key,ta.exists(!0))])}function Tc(t){return Xw(Xr(t.firestore,ls),[new Bw(t._key,ta.none())])}function Lv(t,e){const r=Xr(t.firestore,ls),a=tt(t),l=jL(t.converter,e);return Xw(r,[PL(Wv(t.firestore),"addDoc",a._key,l,t.converter!==null,{}).toMutation(a._key,ta.exists(!1))]).then(()=>a)}function na(t,...e){var r,a,l;t=zn(t);let u={includeMetadataChanges:!1,source:"default"},p=0;typeof e[p]!="object"||oz(e[p])||(u=e[p],p++);const m={includeMetadataChanges:u.includeMetadataChanges,source:u.source};if(oz(e[p])){const C=e[p];e[p]=(r=C.next)===null||r===void 0?void 0:r.bind(C),e[p+1]=(a=C.error)===null||a===void 0?void 0:a.bind(C),e[p+2]=(l=C.complete)===null||l===void 0?void 0:l.bind(C)}let v,w,R;if(t instanceof Ta)w=Xr(t.firestore,ls),R=Vw(t._key.path),v={next:C=>{e[p]&&e[p](cW(w,t,C))},error:e[p+1],complete:e[p+2]};else{const C=Xr(t,Jo);w=Xr(C.firestore,ls),R=C._query;const A=new v0(w);v={next:O=>{e[p]&&e[p](new Ov(w,A,C,O))},error:e[p+1],complete:e[p+2]},xhe(t._query)}return function(A,O,U,F){const q=new NL(F),W=new zG(O,q,U);return A.asyncQueue.enqueueAndForget(async()=>VG(await gw(A),W)),()=>{q.Za(),A.asyncQueue.enqueueAndForget(async()=>FG(await gw(A),W))}}(ra(w),R,m,v)}function ILe(t,e){return FOe(ra(t=Xr(t,ls)),oz(e)?e:{next:e})}function Xw(t,e){return function(a,l){const u=new $o;return a.asyncQueue.enqueueAndForget(async()=>fOe(await XG(a),l,u)),u.promise}(ra(t),e)}function cW(t,e,r){const a=r.docs.get(e._key),l=new v0(t);return new Dv(t,l,e._key,a,new k_(r.hasPendingWrites,r.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ALe(t){return Rhe(t,{count:The()})}function Rhe(t,e){const r=Xr(t.firestore,ls),a=ra(r),l=wde(e,(u,p)=>new Zde(p,u.aggregateType,u._internalFieldPath));return VOe(a,t._query,l).then(u=>function(m,v,w){const R=new v0(m);return new phe(v,R,w)}(r,t,u))}class kLe{constructor(e){this.kind="memory",this._onlineComponentProvider=a0.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=s0.provider}toJSON(){return{kind:this.kind}}}class PLe{constructor(e){let r;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),r=e.tabManager):(r=Che(void 0),r._initialize(e)),this._onlineComponentProvider=r._onlineComponentProvider,this._offlineComponentProvider=r._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class DLe{constructor(){this.kind="memoryEager",this._offlineComponentProvider=s0.provider}toJSON(){return{kind:this.kind}}}class OLe{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new AOe(e)}}toJSON(){return{kind:this.kind}}}function LLe(){return new DLe}function jLe(t){return new OLe(t==null?void 0:t.cacheSizeBytes)}function MLe(t){return new kLe(t)}function ULe(t){return new PLe(t)}class VLe{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=a0.provider,this._offlineComponentProvider={build:r=>new YG(r,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class FLe{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=a0.provider,this._offlineComponentProvider={build:r=>new Zue(r,e==null?void 0:e.cacheSizeBytes)}}}function Che(t){return new VLe(t==null?void 0:t.forceOwnership)}function BLe(){return new FLe}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zLe={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nhe{constructor(e,r){this._firestore=e,this._commitHandler=r,this._mutations=[],this._committed=!1,this._dataReader=Wv(e)}set(e,r,a){this._verifyNotCommitted();const l=R_(e,this._firestore),u=jL(l.converter,r,a),p=PL(this._dataReader,"WriteBatch.set",l._key,u,l.converter!==null,a);return this._mutations.push(p.toMutation(l._key,ta.none())),this}update(e,r,a,...l){this._verifyNotCommitted();const u=R_(e,this._firestore);let p;return p=typeof(r=zn(r))=="string"||r instanceof _0?iW(this._dataReader,"WriteBatch.update",u._key,r,a,l):rW(this._dataReader,"WriteBatch.update",u._key,r),this._mutations.push(p.toMutation(u._key,ta.exists(!0))),this}delete(e){this._verifyNotCommitted();const r=R_(e,this._firestore);return this._mutations=this._mutations.concat(new Bw(r._key,ta.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Nt(ot.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function R_(t,e){if((t=zn(t)).firestore!==e)throw new Nt(ot.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ihe extends class{constructor(r,a){this._firestore=r,this._transaction=a,this._dataReader=Wv(r)}get(r){const a=R_(r,this._firestore),l=new yLe(this._firestore);return this._transaction.lookup([a._key]).then(u=>{if(!u||u.length!==1)return cn();const p=u[0];if(p.isFoundDocument())return new NN(this._firestore,l,p.key,p,a.converter);if(p.isNoDocument())return new NN(this._firestore,l,a._key,null,a.converter);throw cn()})}set(r,a,l){const u=R_(r,this._firestore),p=jL(u.converter,a,l),m=PL(this._dataReader,"Transaction.set",u._key,p,u.converter!==null,l);return this._transaction.set(u._key,m),this}update(r,a,l,...u){const p=R_(r,this._firestore);let m;return m=typeof(a=zn(a))=="string"||a instanceof _0?iW(this._dataReader,"Transaction.update",p._key,a,l,u):rW(this._dataReader,"Transaction.update",p._key,a),this._transaction.update(p._key,m),this}delete(r){const a=R_(r,this._firestore);return this._transaction.delete(a._key),this}}{constructor(e,r){super(e,r),this._firestore=e}get(e){const r=R_(e,this._firestore),a=new v0(this._firestore);return super.get(e).then(l=>new Dv(this._firestore,a,r._key,l._document,new k_(!1,!1),r.converter))}}function y_(t,e,r){t=Xr(t,ls);const a=Object.assign(Object.assign({},zLe),r);return function(u){if(u.maxAttempts<1)throw new Nt(ot.INVALID_ARGUMENT,"Max attempts must be at least 1")}(a),function(u,p,m){const v=new $o;return u.asyncQueue.enqueueAndForget(async()=>{const w=await nhe(u);new DOe(u.asyncQueue,w,m,p,v).au()}),v.promise}(ra(t),l=>e(new Ihe(t,l)),a)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GLe(){return new cI("deleteField")}function ci(){return new ZG("serverTimestamp")}function WLe(...t){return new eW("arrayUnion",t)}function HLe(...t){return new tW("arrayRemove",t)}function Ss(t){return new nW("increment",t)}function KLe(t){return new oI(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qLe(t){return ra(t=Xr(t,ls)),new Nhe(t,e=>Xw(t,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YLe(t,e){const r=ra(t=Xr(t,ls));if(!r._uninitializedComponentsProvider||r._uninitializedComponentsProvider._offline.kind==="memory")return Jd("Cannot enable indexes when persistence is disabled"),Promise.resolve();const a=function(u){const p=typeof u=="string"?function(w){try{return JSON.parse(w)}catch(R){throw new Nt(ot.INVALID_ARGUMENT,"Failed to parse JSON: "+(R==null?void 0:R.message))}}(u):u,m=[];if(Array.isArray(p.indexes))for(const v of p.indexes){const w=nie(v,"collectionGroup"),R=[];if(Array.isArray(v.fields))for(const C of v.fields){const A=DL("setIndexConfiguration",nie(C,"fieldPath"));C.arrayConfig==="CONTAINS"?R.push(new fv(A,2)):C.order==="ASCENDING"?R.push(new fv(A,0)):C.order==="DESCENDING"&&R.push(new fv(A,1))}m.push(new iw(iw.UNKNOWN_ID,w,R,sw.empty()))}return m}(e);return GOe(r,a)}function nie(t,e){if(typeof t[e]!="string")throw new Nt(ot.INVALID_ARGUMENT,"Missing string value for: "+e);return t[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ahe{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function $Le(t){var e;t=Xr(t,ls);const r=rie.get(t);if(r)return r;if(((e=ra(t)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const a=new Ahe(t);return rie.set(t,a),a}function XLe(t){khe(t,!0)}function JLe(t){khe(t,!1)}function QLe(t){HOe(ra(t._firestore)).then(e=>Pt("deleting all persistent cache indexes succeeded")).catch(e=>Jd("deleting all persistent cache indexes failed",e))}function khe(t,e){WOe(ra(t._firestore),e).then(r=>Pt(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(r=>Jd(`setting persistent cache index auto creation isEnabled=${e} failed`,r))}const rie=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZLe(t){var e;const r=(e=ra(Xr(t.firestore,ls))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return r===void 0?null:bL(r,sl(t._query))._t}function eje(t,e){var r;const a=wde(e,(u,p)=>new Zde(p,u.aggregateType,u._internalFieldPath)),l=(r=ra(Xr(t.firestore,ls))._onlineComponents)===null||r===void 0?void 0:r.datastore.serializer;return l===void 0?null:hue(l,Mde(t._query),a,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tje{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return lW.instance.onExistenceFilterMismatch(e)}}class lW{constructor(){this.Uu=new Map}static get instance(){return D2||(D2=new lW,function(r){if(aO)throw new Error("a TestingHooksSpi instance is already set");aO=r}(D2)),D2}et(e){this.Uu.forEach(r=>r(e))}onExistenceFilterMismatch(e){const r=Symbol(),a=this.Uu;return a.set(r,e),()=>a.delete(r)}}let D2=null;(function(e,r=!0){(function(l){Uw=l})(Bv),Sv(new Q_("firestore",(a,{instanceIdentifier:l,options:u})=>{const p=a.getProvider("app").getImmediate(),m=new ls(new VPe(a.getProvider("auth-internal")),new zPe(a.getProvider("app-check-internal")),function(w,R){if(!Object.prototype.hasOwnProperty.apply(w.options,["projectId"]))throw new Nt(ot.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new e0(w.options.projectId,R)}(p,l),p);return u=Object.assign({useFetchStreams:r},u),m._setSettings(u),m},"PUBLIC").setMultipleInstances(!0)),Tf(Kne,"4.7.3",e),Tf(Kne,"4.7.3","esm2017")})();const nje=Object.freeze(Object.defineProperty({__proto__:null,AbstractUserDataWriter:oW,AggregateField:_w,AggregateQuerySnapshot:phe,Bytes:o0,CACHE_SIZE_UNLIMITED:YOe,CollectionReference:sp,DocumentReference:Ta,DocumentSnapshot:Dv,FieldPath:_0,FieldValue:y0,Firestore:ls,FirestoreError:Nt,GeoPoint:qw,LoadBundleTask:lhe,PersistentCacheIndexManager:Ahe,Query:Jo,QueryCompositeFilterConstraint:Kv,QueryConstraint:Yw,QueryDocumentSnapshot:UC,QueryEndAtConstraint:uI,QueryFieldFilterConstraint:$w,QueryLimitConstraint:lI,QueryOrderByConstraint:LL,QuerySnapshot:Ov,QueryStartAtConstraint:dI,SnapshotMetadata:k_,Timestamp:fn,Transaction:Ihe,VectorValue:oI,WriteBatch:Nhe,_AutoId:uG,_ByteString:_a,_DatabaseId:e0,_DocumentKey:Kt,_EmptyAppCheckTokenProvider:GPe,_EmptyAuthCredentialsProvider:dde,_FieldPath:Ms,_TestingHooks:tje,_cast:Xr,_debugAssert:MPe,_internalAggregationQueryToProtoRunAggregationQueryRequest:eje,_internalQueryToProtoQueryTarget:ZLe,_isBase64Available:_2e,_logWarn:Jd,_validateIsNotUsedTogether:ahe,addDoc:Lv,aggregateFieldEqual:xLe,aggregateQuerySnapshotEqual:bLe,and:hLe,arrayRemove:HLe,arrayUnion:WLe,average:ELe,clearIndexedDbPersistence:QOe,collection:mn,collectionGroup:KOe,connectFirestoreEmulator:che,count:The,deleteAllPersistentCacheIndexes:QLe,deleteDoc:Tc,deleteField:GLe,disableNetwork:tLe,disablePersistentCacheIndexAutoCreation:JLe,doc:tt,documentId:sLe,enableIndexedDbPersistence:XOe,enableMultiTabIndexedDbPersistence:JOe,enableNetwork:eLe,enablePersistentCacheIndexAutoCreation:XLe,endAt:_Le,endBefore:gLe,ensureFirestoreConfigured:ra,executeWrite:Xw,getAggregateFromServer:Rhe,getCountFromServer:ALe,getDoc:Bn,getDocFromCache:TLe,getDocFromServer:RLe,getDocs:Cr,getDocsFromCache:CLe,getDocsFromServer:NLe,getFirestore:dhe,getPersistentCacheIndexManager:$Le,increment:Ss,initializeFirestore:$Oe,limit:up,limitToLast:pLe,loadBundle:rLe,memoryEagerGarbageCollector:LLe,memoryLocalCache:MLe,memoryLruGarbageCollector:jLe,namedQuery:iLe,onSnapshot:na,onSnapshotsInSync:ILe,or:uLe,orderBy:ih,persistentLocalCache:ULe,persistentMultipleTabManager:BLe,persistentSingleTabManager:Che,query:Mr,queryEqual:QG,refEqual:qOe,runTransaction:y_,serverTimestamp:ci,setDoc:Yi,setIndexConfiguration:YLe,setLogLevel:jPe,snapshotEqual:SLe,startAfter:mLe,startAt:fLe,sum:vLe,terminate:nLe,updateDoc:Xn,vector:KLe,waitForPendingWrites:ZOe,where:Kn,writeBatch:qLe},Symbol.toStringTag,{value:"Module"}));var rje="firebase",ije="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Tf(rje,ije,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Phe="firebasestorage.googleapis.com",Dhe="storageBucket",sje=2*60*1e3,aje=10*60*1e3,oje=1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ya extends Pf{constructor(e,r,a=0){super(WF(e),`Firebase Storage: ${r} (${WF(e)})`),this.status_=a,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,ya.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return WF(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Fs;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Fs||(Fs={}));function WF(t){return"storage/"+t}function dW(){const t="An unknown error occurred, please check the error payload for server response.";return new ya(Fs.UNKNOWN,t)}function cje(t){return new ya(Fs.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function lje(t){return new ya(Fs.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function dje(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new ya(Fs.UNAUTHENTICATED,t)}function uje(){return new ya(Fs.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function hje(t){return new ya(Fs.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function Ohe(){return new ya(Fs.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Lhe(){return new ya(Fs.CANCELED,"User canceled the upload/download.")}function pje(t){return new ya(Fs.INVALID_URL,"Invalid URL '"+t+"'.")}function fje(t){return new ya(Fs.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function mje(){return new ya(Fs.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Dhe+"' property when initializing the app?")}function jhe(){return new ya(Fs.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function gje(){return new ya(Fs.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function _je(){return new ya(Fs.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function yje(t){return new ya(Fs.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function cz(t){return new ya(Fs.INVALID_ARGUMENT,t)}function Mhe(){return new ya(Fs.APP_DELETED,"The Firebase app was deleted.")}function vje(t){return new ya(Fs.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function VC(t,e){return new ya(Fs.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function eC(t){throw new ya(Fs.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kd{constructor(e,r){this.bucket=e,this.path_=r}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,r){let a;try{a=Kd.makeFromUrl(e,r)}catch{return new Kd(e,"")}if(a.path==="")return a;throw fje(e)}static makeFromUrl(e,r){let a=null;const l="([A-Za-z0-9.\\-_]+)";function u(ne){ne.path.charAt(ne.path.length-1)==="/"&&(ne.path_=ne.path_.slice(0,-1))}const p="(/(.*))?$",m=new RegExp("^gs://"+l+p,"i"),v={bucket:1,path:3};function w(ne){ne.path_=decodeURIComponent(ne.path)}const R="v[A-Za-z0-9_]+",C=r.replace(/[.]/g,"\\."),A="(/([^?#]*).*)?$",O=new RegExp(`^https?://${C}/${R}/b/${l}/o${A}`,"i"),U={bucket:1,path:3},F=r===Phe?"(?:storage.googleapis.com|storage.cloud.google.com)":r,q="([^?#]*)",W=new RegExp(`^https?://${F}/${l}/${q}`,"i"),X=[{regex:m,indices:v,postModify:u},{regex:O,indices:U,postModify:w},{regex:W,indices:{bucket:1,path:2},postModify:w}];for(let ne=0;ne<X.length;ne++){const te=X[ne],he=te.regex.exec(e);if(he){const J=he[te.indices.bucket];let Q=he[te.indices.path];Q||(Q=""),a=new Kd(J,Q),te.postModify(a);break}}if(a==null)throw pje(e);return a}}class Eje{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xje(t,e,r){let a=1,l=null,u=null,p=!1,m=0;function v(){return m===2}let w=!1;function R(...q){w||(w=!0,e.apply(null,q))}function C(q){l=setTimeout(()=>{l=null,t(O,v())},q)}function A(){u&&clearTimeout(u)}function O(q,...W){if(w){A();return}if(q){A(),R.call(null,q,...W);return}if(v()||p){A(),R.call(null,q,...W);return}a<64&&(a*=2);let X;m===1?(m=2,X=0):X=(a+Math.random())*1e3,C(X)}let U=!1;function F(q){U||(U=!0,A(),!w&&(l!==null?(q||(m=2),clearTimeout(l),C(0)):q||(m=1)))}return C(0),u=setTimeout(()=>{p=!0,F(!0)},r),F}function bje(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wje(t){return t!==void 0}function Sje(t){return typeof t=="function"}function Tje(t){return typeof t=="object"&&!Array.isArray(t)}function ML(t){return typeof t=="string"||t instanceof String}function iie(t){return uW()&&t instanceof Blob}function uW(){return typeof Blob<"u"}function sie(t,e,r,a){if(a<e)throw cz(`Invalid value for '${t}'. Expected ${e} or greater.`);if(a>r)throw cz(`Invalid value for '${t}'. Expected ${r} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hI(t,e,r){let a=e;return r==null&&(a=`https://${e}`),`${r}://${a}/v0${t}`}function Uhe(t){const e=encodeURIComponent;let r="?";for(const a in t)if(t.hasOwnProperty(a)){const l=e(a)+"="+e(t[a]);r=r+l+"&"}return r=r.slice(0,-1),r}var mv;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(mv||(mv={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vhe(t,e){const r=t>=500&&t<600,l=[408,429].indexOf(t)!==-1,u=e.indexOf(t)!==-1;return r||l||u}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rje{constructor(e,r,a,l,u,p,m,v,w,R,C,A=!0){this.url_=e,this.method_=r,this.headers_=a,this.body_=l,this.successCodes_=u,this.additionalRetryCodes_=p,this.callback_=m,this.errorCallback_=v,this.timeout_=w,this.progressCallback_=R,this.connectionFactory_=C,this.retry=A,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((O,U)=>{this.resolve_=O,this.reject_=U,this.start_()})}start_(){const e=(a,l)=>{if(l){a(!1,new O2(!1,null,!0));return}const u=this.connectionFactory_();this.pendingConnection_=u;const p=m=>{const v=m.loaded,w=m.lengthComputable?m.total:-1;this.progressCallback_!==null&&this.progressCallback_(v,w)};this.progressCallback_!==null&&u.addUploadProgressListener(p),u.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&u.removeUploadProgressListener(p),this.pendingConnection_=null;const m=u.getErrorCode()===mv.NO_ERROR,v=u.getStatus();if(!m||Vhe(v,this.additionalRetryCodes_)&&this.retry){const R=u.getErrorCode()===mv.ABORT;a(!1,new O2(!1,null,R));return}const w=this.successCodes_.indexOf(v)!==-1;a(!0,new O2(w,u))})},r=(a,l)=>{const u=this.resolve_,p=this.reject_,m=l.connection;if(l.wasSuccessCode)try{const v=this.callback_(m,m.getResponse());wje(v)?u(v):u()}catch(v){p(v)}else if(m!==null){const v=dW();v.serverResponse=m.getErrorText(),this.errorCallback_?p(this.errorCallback_(m,v)):p(v)}else if(l.canceled){const v=this.appDelete_?Mhe():Lhe();p(v)}else{const v=Ohe();p(v)}};this.canceled_?r(!1,new O2(!1,null,!0)):this.backoffId_=xje(e,r,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&bje(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class O2{constructor(e,r,a){this.wasSuccessCode=e,this.connection=r,this.canceled=!!a}}function Cje(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function Nje(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function Ije(t,e){e&&(t["X-Firebase-GMPID"]=e)}function Aje(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function kje(t,e,r,a,l,u,p=!0){const m=Uhe(t.urlParams),v=t.url+m,w=Object.assign({},t.headers);return Ije(w,e),Cje(w,r),Nje(w,u),Aje(w,a),new Rje(v,t.method,w,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,l,p)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pje(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function Dje(...t){const e=Pje();if(e!==void 0){const r=new e;for(let a=0;a<t.length;a++)r.append(t[a]);return r.getBlob()}else{if(uW())return new Blob(t);throw new ya(Fs.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function Oje(t,e,r){return t.webkitSlice?t.webkitSlice(e,r):t.mozSlice?t.mozSlice(e,r):t.slice?t.slice(e,r):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lje(t){if(typeof atob>"u")throw yje("base-64");return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bf={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class HF{constructor(e,r){this.data=e,this.contentType=r||null}}function jje(t,e){switch(t){case bf.RAW:return new HF(Fhe(e));case bf.BASE64:case bf.BASE64URL:return new HF(Bhe(t,e));case bf.DATA_URL:return new HF(Uje(e),Vje(e))}throw dW()}function Fhe(t){const e=[];for(let r=0;r<t.length;r++){let a=t.charCodeAt(r);if(a<=127)e.push(a);else if(a<=2047)e.push(192|a>>6,128|a&63);else if((a&64512)===55296)if(!(r<t.length-1&&(t.charCodeAt(r+1)&64512)===56320))e.push(239,191,189);else{const u=a,p=t.charCodeAt(++r);a=65536|(u&1023)<<10|p&1023,e.push(240|a>>18,128|a>>12&63,128|a>>6&63,128|a&63)}else(a&64512)===56320?e.push(239,191,189):e.push(224|a>>12,128|a>>6&63,128|a&63)}return new Uint8Array(e)}function Mje(t){let e;try{e=decodeURIComponent(t)}catch{throw VC(bf.DATA_URL,"Malformed data URL.")}return Fhe(e)}function Bhe(t,e){switch(t){case bf.BASE64:{const l=e.indexOf("-")!==-1,u=e.indexOf("_")!==-1;if(l||u)throw VC(t,"Invalid character '"+(l?"-":"_")+"' found: is it base64url encoded?");break}case bf.BASE64URL:{const l=e.indexOf("+")!==-1,u=e.indexOf("/")!==-1;if(l||u)throw VC(t,"Invalid character '"+(l?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let r;try{r=Lje(e)}catch(l){throw l.message.includes("polyfill")?l:VC(t,"Invalid character found")}const a=new Uint8Array(r.length);for(let l=0;l<r.length;l++)a[l]=r.charCodeAt(l);return a}class zhe{constructor(e){this.base64=!1,this.contentType=null;const r=e.match(/^data:([^,]+)?,/);if(r===null)throw VC(bf.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const a=r[1]||null;a!=null&&(this.base64=Fje(a,";base64"),this.contentType=this.base64?a.substring(0,a.length-7):a),this.rest=e.substring(e.indexOf(",")+1)}}function Uje(t){const e=new zhe(t);return e.base64?Bhe(bf.BASE64,e.rest):Mje(e.rest)}function Vje(t){return new zhe(t).contentType}function Fje(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rm{constructor(e,r){let a=0,l="";iie(e)?(this.data_=e,a=e.size,l=e.type):e instanceof ArrayBuffer?(r?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),a=this.data_.length):e instanceof Uint8Array&&(r?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),a=e.length),this.size_=a,this.type_=l}size(){return this.size_}type(){return this.type_}slice(e,r){if(iie(this.data_)){const a=this.data_,l=Oje(a,e,r);return l===null?null:new Rm(l)}else{const a=new Uint8Array(this.data_.buffer,e,r-e);return new Rm(a,!0)}}static getBlob(...e){if(uW()){const r=e.map(a=>a instanceof Rm?a.data_:a);return new Rm(Dje.apply(null,r))}else{const r=e.map(p=>ML(p)?jje(bf.RAW,p).data:p.data_);let a=0;r.forEach(p=>{a+=p.byteLength});const l=new Uint8Array(a);let u=0;return r.forEach(p=>{for(let m=0;m<p.length;m++)l[u++]=p[m]}),new Rm(l,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ghe(t){let e;try{e=JSON.parse(t)}catch{return null}return Tje(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bje(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function zje(t,e){const r=e.split("/").filter(a=>a.length>0).join("/");return t.length===0?r:t+"/"+r}function Whe(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gje(t,e){return e}class wl{constructor(e,r,a,l){this.server=e,this.local=r||e,this.writable=!!a,this.xform=l||Gje}}let L2=null;function Wje(t){return!ML(t)||t.length<2?t:Whe(t)}function hW(){if(L2)return L2;const t=[];t.push(new wl("bucket")),t.push(new wl("generation")),t.push(new wl("metageneration")),t.push(new wl("name","fullPath",!0));function e(u,p){return Wje(p)}const r=new wl("name");r.xform=e,t.push(r);function a(u,p){return p!==void 0?Number(p):p}const l=new wl("size");return l.xform=a,t.push(l),t.push(new wl("timeCreated")),t.push(new wl("updated")),t.push(new wl("md5Hash",null,!0)),t.push(new wl("cacheControl",null,!0)),t.push(new wl("contentDisposition",null,!0)),t.push(new wl("contentEncoding",null,!0)),t.push(new wl("contentLanguage",null,!0)),t.push(new wl("contentType",null,!0)),t.push(new wl("metadata","customMetadata",!0)),L2=t,L2}function Hje(t,e){function r(){const a=t.bucket,l=t.fullPath,u=new Kd(a,l);return e._makeStorageReference(u)}Object.defineProperty(t,"ref",{get:r})}function Kje(t,e,r){const a={};a.type="file";const l=r.length;for(let u=0;u<l;u++){const p=r[u];a[p.local]=p.xform(a,e[p.server])}return Hje(a,t),a}function Hhe(t,e,r){const a=Ghe(e);return a===null?null:Kje(t,a,r)}function qje(t,e,r,a){const l=Ghe(e);if(l===null||!ML(l.downloadTokens))return null;const u=l.downloadTokens;if(u.length===0)return null;const p=encodeURIComponent;return u.split(",").map(w=>{const R=t.bucket,C=t.fullPath,A="/b/"+p(R)+"/o/"+p(C),O=hI(A,r,a),U=Uhe({alt:"media",token:w});return O+U})[0]}function Khe(t,e){const r={},a=e.length;for(let l=0;l<a;l++){const u=e[l];u.writable&&(r[u.server]=t[u.local])}return JSON.stringify(r)}class Jw{constructor(e,r,a,l){this.url=e,this.method=r,this.handler=a,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mm(t){if(!t)throw dW()}function pW(t,e){function r(a,l){const u=Hhe(t,l,e);return Mm(u!==null),u}return r}function Yje(t,e){function r(a,l){const u=Hhe(t,l,e);return Mm(u!==null),qje(u,l,t.host,t._protocol)}return r}function pI(t){function e(r,a){let l;return r.getStatus()===401?r.getErrorText().includes("Firebase App Check token is invalid")?l=uje():l=dje():r.getStatus()===402?l=lje(t.bucket):r.getStatus()===403?l=hje(t.path):l=a,l.status=r.getStatus(),l.serverResponse=a.serverResponse,l}return e}function qhe(t){const e=pI(t);function r(a,l){let u=e(a,l);return a.getStatus()===404&&(u=cje(t.path)),u.serverResponse=l.serverResponse,u}return r}function $je(t,e,r){const a=e.fullServerUrl(),l=hI(a,t.host,t._protocol),u="GET",p=t.maxOperationRetryTime,m=new Jw(l,u,pW(t,r),p);return m.errorHandler=qhe(e),m}function Xje(t,e,r){const a=e.fullServerUrl(),l=hI(a,t.host,t._protocol),u="GET",p=t.maxOperationRetryTime,m=new Jw(l,u,Yje(t,r),p);return m.errorHandler=qhe(e),m}function Jje(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}function Yhe(t,e,r){const a=Object.assign({},r);return a.fullPath=t.path,a.size=e.size(),a.contentType||(a.contentType=Jje(null,e)),a}function $he(t,e,r,a,l){const u=e.bucketOnlyServerUrl(),p={"X-Goog-Upload-Protocol":"multipart"};function m(){let X="";for(let ne=0;ne<2;ne++)X=X+Math.random().toString().slice(2);return X}const v=m();p["Content-Type"]="multipart/related; boundary="+v;const w=Yhe(e,a,l),R=Khe(w,r),C="--"+v+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+R+`\r
--`+v+`\r
Content-Type: `+w.contentType+`\r
\r
`,A=`\r
--`+v+"--",O=Rm.getBlob(C,a,A);if(O===null)throw jhe();const U={name:w.fullPath},F=hI(u,t.host,t._protocol),q="POST",W=t.maxUploadRetryTime,H=new Jw(F,q,pW(t,r),W);return H.urlParams=U,H.headers=p,H.body=O.uploadData(),H.errorHandler=pI(e),H}class gO{constructor(e,r,a,l){this.current=e,this.total=r,this.finalized=!!a,this.metadata=l||null}}function fW(t,e){let r=null;try{r=t.getResponseHeader("X-Goog-Upload-Status")}catch{Mm(!1)}return Mm(!!r&&(e||["active"]).indexOf(r)!==-1),r}function Qje(t,e,r,a,l){const u=e.bucketOnlyServerUrl(),p=Yhe(e,a,l),m={name:p.fullPath},v=hI(u,t.host,t._protocol),w="POST",R={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${a.size()}`,"X-Goog-Upload-Header-Content-Type":p.contentType,"Content-Type":"application/json; charset=utf-8"},C=Khe(p,r),A=t.maxUploadRetryTime;function O(F){fW(F);let q;try{q=F.getResponseHeader("X-Goog-Upload-URL")}catch{Mm(!1)}return Mm(ML(q)),q}const U=new Jw(v,w,O,A);return U.urlParams=m,U.headers=R,U.body=C,U.errorHandler=pI(e),U}function Zje(t,e,r,a){const l={"X-Goog-Upload-Command":"query"};function u(w){const R=fW(w,["active","final"]);let C=null;try{C=w.getResponseHeader("X-Goog-Upload-Size-Received")}catch{Mm(!1)}C||Mm(!1);const A=Number(C);return Mm(!isNaN(A)),new gO(A,a.size(),R==="final")}const p="POST",m=t.maxUploadRetryTime,v=new Jw(r,p,u,m);return v.headers=l,v.errorHandler=pI(e),v}const aie=256*1024;function eMe(t,e,r,a,l,u,p,m){const v=new gO(0,0);if(p?(v.current=p.current,v.total=p.total):(v.current=0,v.total=a.size()),a.size()!==v.total)throw gje();const w=v.total-v.current;let R=w;l>0&&(R=Math.min(R,l));const C=v.current,A=C+R;let O="";R===0?O="finalize":w===R?O="upload, finalize":O="upload";const U={"X-Goog-Upload-Command":O,"X-Goog-Upload-Offset":`${v.current}`},F=a.slice(C,A);if(F===null)throw jhe();function q(ne,te){const he=fW(ne,["active","final"]),J=v.current+R,Q=a.size();let ce;return he==="final"?ce=pW(e,u)(ne,te):ce=null,new gO(J,Q,he==="final",ce)}const W="POST",H=e.maxUploadRetryTime,X=new Jw(r,W,q,H);return X.headers=U,X.body=F.uploadData(),X.progressCallback=m||null,X.errorHandler=pI(t),X}const id={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function KF(t){switch(t){case"running":case"pausing":case"canceling":return id.RUNNING;case"paused":return id.PAUSED;case"success":return id.SUCCESS;case"canceled":return id.CANCELED;case"error":return id.ERROR;default:return id.ERROR}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tMe{constructor(e,r,a){if(Sje(e)||r!=null||a!=null)this.next=e,this.error=r??void 0,this.complete=a??void 0;else{const u=e;this.next=u.next,this.error=u.error,this.complete=u.complete}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sb(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}class nMe{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=mv.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=mv.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=mv.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,r,a,l){if(this.sent_)throw eC("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(r,e,!0),l!==void 0)for(const u in l)l.hasOwnProperty(u)&&this.xhr_.setRequestHeader(u,l[u].toString());return a!==void 0?this.xhr_.send(a):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw eC("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw eC("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw eC("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw eC("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class rMe extends nMe{initXhr(){this.xhr_.responseType="text"}}function iv(){return new rMe}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iMe{constructor(e,r,a=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=r,this._metadata=a,this._mappings=hW(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=l=>{if(this._request=void 0,this._chunkMultiplier=1,l._codeEquals(Fs.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const u=this.isExponentialBackoffExpired();if(Vhe(l.status,[]))if(u)l=Ohe();else{this.sleepTime=Math.max(this.sleepTime*2,oje),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=l,this._transition("error")}},this._metadataErrorHandler=l=>{this._request=void 0,l._codeEquals(Fs.CANCELED)?this.completeTransitions_():(this._error=l,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((l,u)=>{this._resolve=l,this._reject=u,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const e=this._transferred;return r=>this._updateProgress(e+r)}_shouldDoResumable(e){return e.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([r,a])=>{switch(this._state){case"running":e(r,a);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((e,r)=>{const a=Qje(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),l=this._ref.storage._makeRequest(a,iv,e,r);this._request=l,l.getPromise().then(u=>{this._request=void 0,this._uploadUrl=u,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((r,a)=>{const l=Zje(this._ref.storage,this._ref._location,e,this._blob),u=this._ref.storage._makeRequest(l,iv,r,a);this._request=u,u.getPromise().then(p=>{p=p,this._request=void 0,this._updateProgress(p.current),this._needToFetchStatus=!1,p.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=aie*this._chunkMultiplier,r=new gO(this._transferred,this._blob.size()),a=this._uploadUrl;this._resolveToken((l,u)=>{let p;try{p=eMe(this._ref._location,this._ref.storage,a,this._blob,e,this._mappings,r,this._makeProgressCallback())}catch(v){this._error=v,this._transition("error");return}const m=this._ref.storage._makeRequest(p,iv,l,u,!1);this._request=m,m.getPromise().then(v=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(v.current),v.finalized?(this._metadata=v.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){aie*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,r)=>{const a=$je(this._ref.storage,this._ref._location,this._mappings),l=this._ref.storage._makeRequest(a,iv,e,r);this._request=l,l.getPromise().then(u=>{this._request=void 0,this._metadata=u,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,r)=>{const a=$he(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),l=this._ref.storage._makeRequest(a,iv,e,r);this._request=l,l.getPromise().then(u=>{this._request=void 0,this._metadata=u,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const r=this._transferred;this._transferred=e,this._transferred!==r&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const r=this._state==="paused";this._state=e,r&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=Lhe(),this._state=e,this._notifyObservers();break;case"error":this._state=e,this._notifyObservers();break;case"success":this._state=e,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const e=KF(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,r,a,l){const u=new tMe(r||void 0,a||void 0,l||void 0);return this._addObserver(u),()=>{this._removeObserver(u)}}then(e,r){return this._promise.then(e,r)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const r=this._observers.indexOf(e);r!==-1&&this._observers.splice(r,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(r=>{this._notifyObserver(r)})}_finishPromise(){if(this._resolve!==void 0){let e=!0;switch(KF(this._state)){case id.SUCCESS:sb(this._resolve.bind(null,this.snapshot))();break;case id.CANCELED:case id.ERROR:const r=this._reject;sb(r.bind(null,this._error))();break;default:e=!1;break}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(KF(this._state)){case id.RUNNING:case id.PAUSED:e.next&&sb(e.next.bind(e,this.snapshot))();break;case id.SUCCESS:e.complete&&sb(e.complete.bind(e))();break;case id.CANCELED:case id.ERROR:e.error&&sb(e.error.bind(e,this._error))();break;default:e.error&&sb(e.error.bind(e,this._error))()}}resume(){const e=this._state==="paused"||this._state==="pausing";return e&&this._transition("running"),e}pause(){const e=this._state==="running";return e&&this._transition("pausing"),e}cancel(){const e=this._state==="running"||this._state==="pausing";return e&&this._transition("canceling"),e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jv{constructor(e,r){this._service=e,r instanceof Kd?this._location=r:this._location=Kd.makeFromUrl(r,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,r){return new jv(e,r)}get root(){const e=new Kd(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Whe(this._location.path)}get storage(){return this._service}get parent(){const e=Bje(this._location.path);if(e===null)return null;const r=new Kd(this._location.bucket,e);return new jv(this._service,r)}_throwIfRoot(e){if(this._location.path==="")throw vje(e)}}function sMe(t,e,r){t._throwIfRoot("uploadBytes");const a=$he(t.storage,t._location,hW(),new Rm(e,!0),r);return t.storage.makeRequestWithTokens(a,iv).then(l=>({metadata:l,ref:t}))}function aMe(t,e,r){return t._throwIfRoot("uploadBytesResumable"),new iMe(t,new Rm(e),r)}function oMe(t){t._throwIfRoot("getDownloadURL");const e=Xje(t.storage,t._location,hW());return t.storage.makeRequestWithTokens(e,iv).then(r=>{if(r===null)throw _je();return r})}function cMe(t,e){const r=zje(t._location.path,e),a=new Kd(t._location.bucket,r);return new jv(t.storage,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lMe(t){return/^[A-Za-z]+:\/\//.test(t)}function dMe(t,e){return new jv(t,e)}function Xhe(t,e){if(t instanceof mW){const r=t;if(r._bucket==null)throw mje();const a=new jv(r,r._bucket);return e!=null?Xhe(a,e):a}else return e!==void 0?cMe(t,e):t}function uMe(t,e){if(e&&lMe(e)){if(t instanceof mW)return dMe(t,e);throw cz("To use ref(service, url), the first argument must be a Storage instance.")}else return Xhe(t,e)}function oie(t,e){const r=e==null?void 0:e[Dhe];return r==null?null:Kd.makeFromBucketSpec(r,t)}function hMe(t,e,r,a={}){t.host=`${e}:${r}`,t._protocol="http";const{mockUserToken:l}=a;l&&(t._overrideAuthToken=typeof l=="string"?l:ile(l,t.app.options.projectId))}class mW{constructor(e,r,a,l,u){this.app=e,this._authProvider=r,this._appCheckProvider=a,this._url=l,this._firebaseVersion=u,this._bucket=null,this._host=Phe,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=sje,this._maxUploadRetryTime=aje,this._requests=new Set,l!=null?this._bucket=Kd.makeFromBucketSpec(l,this._host):this._bucket=oie(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Kd.makeFromBucketSpec(this._url,e):this._bucket=oie(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){sie("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){sie("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const r=await e.getToken();if(r!==null)return r.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new jv(this,e)}_makeRequest(e,r,a,l,u=!0){if(this._deleted)return new Eje(Mhe());{const p=kje(e,this._appId,a,l,r,this._firebaseVersion,u);return this._requests.add(p),p.getPromise().then(()=>this._requests.delete(p),()=>this._requests.delete(p)),p}}async makeRequestWithTokens(e,r){const[a,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,r,a,l).getPromise()}}const cie="@firebase/storage",lie="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jhe="storage";function lz(t,e,r){return t=zn(t),sMe(t,e,r)}function pMe(t,e,r){return t=zn(t),aMe(t,e,r)}function _O(t){return t=zn(t),oMe(t)}function yO(t,e){return t=zn(t),uMe(t,e)}function Qhe(t=$8(),e){t=zn(t);const a=Lw(t,Jhe).getImmediate({identifier:e}),l=tle("storage");return l&&fMe(a,...l),a}function fMe(t,e,r,a={}){hMe(t,e,r,a)}function mMe(t,{instanceIdentifier:e}){const r=t.getProvider("app").getImmediate(),a=t.getProvider("auth-internal"),l=t.getProvider("app-check-internal");return new mW(r,a,l,e,Bv)}function gMe(){Sv(new Q_(Jhe,mMe,"PUBLIC").setMultipleInstances(!0)),Tf(cie,lie,""),Tf(cie,lie,"esm2017")}gMe();const _Me={apiKey:"AIzaSyCffarAiFnuo6YJrkjJRslU1mhKigHcBdQ",authDomain:"synclulu-4e6c0.firebaseapp.com",projectId:"synclulu-4e6c0",storageBucket:"synclulu-4e6c0.firebasestorage.app",messagingSenderId:"569653412196",appId:"1:569653412196:web:8b8cfb2fb650f703717a71",measurementId:"G-PFT3BVCTZ6"},gW=lle(_Me),ws=OPe(gW),De=dhe(gW),Zhe=Qhe(gW),yMe={},die=t=>{let e;const r=new Set,a=(R,C)=>{const A=typeof R=="function"?R(e):R;if(!Object.is(A,e)){const O=e;e=C??(typeof A!="object"||A===null)?A:Object.assign({},e,A),r.forEach(U=>U(e,O))}},l=()=>e,v={setState:a,getState:l,getInitialState:()=>w,subscribe:R=>(r.add(R),()=>r.delete(R)),destroy:()=>{(yMe?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},w=e=t(a,l,v);return v},vMe=t=>t?die(t):die;var epe={exports:{}},tpe={},npe={exports:{}},rpe={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yw=V;function EMe(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var xMe=typeof Object.is=="function"?Object.is:EMe,bMe=yw.useState,wMe=yw.useEffect,SMe=yw.useLayoutEffect,TMe=yw.useDebugValue;function RMe(t,e){var r=e(),a=bMe({inst:{value:r,getSnapshot:e}}),l=a[0].inst,u=a[1];return SMe(function(){l.value=r,l.getSnapshot=e,qF(l)&&u({inst:l})},[t,r,e]),wMe(function(){return qF(l)&&u({inst:l}),t(function(){qF(l)&&u({inst:l})})},[t]),TMe(r),r}function qF(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!xMe(t,r)}catch{return!0}}function CMe(t,e){return e()}var NMe=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?CMe:RMe;rpe.useSyncExternalStore=yw.useSyncExternalStore!==void 0?yw.useSyncExternalStore:NMe;npe.exports=rpe;var IMe=npe.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var UL=V,AMe=IMe;function kMe(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var PMe=typeof Object.is=="function"?Object.is:kMe,DMe=AMe.useSyncExternalStore,OMe=UL.useRef,LMe=UL.useEffect,jMe=UL.useMemo,MMe=UL.useDebugValue;tpe.useSyncExternalStoreWithSelector=function(t,e,r,a,l){var u=OMe(null);if(u.current===null){var p={hasValue:!1,value:null};u.current=p}else p=u.current;u=jMe(function(){function v(O){if(!w){if(w=!0,R=O,O=a(O),l!==void 0&&p.hasValue){var U=p.value;if(l(U,O))return C=U}return C=O}if(U=C,PMe(R,O))return U;var F=a(O);return l!==void 0&&l(U,F)?(R=O,U):(R=O,C=F)}var w=!1,R,C,A=r===void 0?null:r;return[function(){return v(e())},A===null?void 0:function(){return v(A())}]},[e,r,a,l]);var m=DMe(t,u[0],u[1]);return LMe(function(){p.hasValue=!0,p.value=m},[m]),MMe(m),m};epe.exports=tpe;var UMe=epe.exports;const VMe=VO(UMe),ipe={},{useDebugValue:FMe}=Yb,{useSyncExternalStoreWithSelector:BMe}=VMe;let uie=!1;const zMe=t=>t;function GMe(t,e=zMe,r){(ipe?"production":void 0)!=="production"&&r&&!uie&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),uie=!0);const a=BMe(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,r);return FMe(a),a}const WMe=t=>{(ipe?"production":void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof t=="function"?vMe(t):t,r=(a,l)=>GMe(e,a,l);return Object.assign(r,e),r},spe=t=>WMe,HMe={};function ape(t,e){let r;try{r=t()}catch{return}return{getItem:l=>{var u;const p=v=>v===null?null:JSON.parse(v,void 0),m=(u=r.getItem(l))!=null?u:null;return m instanceof Promise?m.then(p):p(m)},setItem:(l,u)=>r.setItem(l,JSON.stringify(u,void 0)),removeItem:l=>r.removeItem(l)}}const IN=t=>e=>{try{const r=t(e);return r instanceof Promise?r:{then(a){return IN(a)(r)},catch(a){return this}}}catch(r){return{then(a){return this},catch(a){return IN(a)(r)}}}},KMe=(t,e)=>(r,a,l)=>{let u={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:q=>q,version:0,merge:(q,W)=>({...W,...q}),...e},p=!1;const m=new Set,v=new Set;let w;try{w=u.getStorage()}catch{}if(!w)return t((...q)=>{console.warn(`[zustand persist middleware] Unable to update item '${u.name}', the given storage is currently unavailable.`),r(...q)},a,l);const R=IN(u.serialize),C=()=>{const q=u.partialize({...a()});let W;const H=R({state:q,version:u.version}).then(X=>w.setItem(u.name,X)).catch(X=>{W=X});if(W)throw W;return H},A=l.setState;l.setState=(q,W)=>{A(q,W),C()};const O=t((...q)=>{r(...q),C()},a,l);let U;const F=()=>{var q;if(!w)return;p=!1,m.forEach(H=>H(a()));const W=((q=u.onRehydrateStorage)==null?void 0:q.call(u,a()))||void 0;return IN(w.getItem.bind(w))(u.name).then(H=>{if(H)return u.deserialize(H)}).then(H=>{if(H)if(typeof H.version=="number"&&H.version!==u.version){if(u.migrate)return u.migrate(H.state,H.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return H.state}).then(H=>{var X;return U=u.merge(H,(X=a())!=null?X:O),r(U,!0),C()}).then(()=>{W==null||W(U,void 0),p=!0,v.forEach(H=>H(U))}).catch(H=>{W==null||W(void 0,H)})};return l.persist={setOptions:q=>{u={...u,...q},q.getStorage&&(w=q.getStorage())},clearStorage:()=>{w==null||w.removeItem(u.name)},getOptions:()=>u,rehydrate:()=>F(),hasHydrated:()=>p,onHydrate:q=>(m.add(q),()=>{m.delete(q)}),onFinishHydration:q=>(v.add(q),()=>{v.delete(q)})},F(),U||O},qMe=(t,e)=>(r,a,l)=>{let u={storage:ape(()=>localStorage),partialize:F=>F,version:0,merge:(F,q)=>({...q,...F}),...e},p=!1;const m=new Set,v=new Set;let w=u.storage;if(!w)return t((...F)=>{console.warn(`[zustand persist middleware] Unable to update item '${u.name}', the given storage is currently unavailable.`),r(...F)},a,l);const R=()=>{const F=u.partialize({...a()});return w.setItem(u.name,{state:F,version:u.version})},C=l.setState;l.setState=(F,q)=>{C(F,q),R()};const A=t((...F)=>{r(...F),R()},a,l);l.getInitialState=()=>A;let O;const U=()=>{var F,q;if(!w)return;p=!1,m.forEach(H=>{var X;return H((X=a())!=null?X:A)});const W=((q=u.onRehydrateStorage)==null?void 0:q.call(u,(F=a())!=null?F:A))||void 0;return IN(w.getItem.bind(w))(u.name).then(H=>{if(H)if(typeof H.version=="number"&&H.version!==u.version){if(u.migrate)return[!0,u.migrate(H.state,H.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,H.state];return[!1,void 0]}).then(H=>{var X;const[ne,te]=H;if(O=u.merge(te,(X=a())!=null?X:A),r(O,!0),ne)return R()}).then(()=>{W==null||W(O,void 0),O=a(),p=!0,v.forEach(H=>H(O))}).catch(H=>{W==null||W(void 0,H)})};return l.persist={setOptions:F=>{u={...u,...F},F.storage&&(w=F.storage)},clearStorage:()=>{w==null||w.removeItem(u.name)},getOptions:()=>u,rehydrate:()=>U(),hasHydrated:()=>p,onHydrate:F=>(m.add(F),()=>{m.delete(F)}),onFinishHydration:F=>(v.add(F),()=>{v.delete(F)})},u.skipHydration||U(),O||A},YMe=(t,e)=>"getStorage"in e||"serialize"in e||"deserialize"in e?((HMe?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),KMe(t,e)):qMe(t,e),ope=YMe,$Me=()=>{const t=localStorage.getItem("synclulu-language");if(t&&["de","en","es","fr","pt"].includes(t))return t;const e=navigator.language.split("-")[0];return["de","en","es","fr","pt"].includes(e)?e:"en"},Jr=spe()(ope(t=>({user:null,isAuthenticated:!1,isLoading:!0,location:null,locationError:null,locationPermission:null,nearbyUsers:[],searchRadius:500,isDiscovering:!1,chats:[],activeChat:null,language:$Me(),showXPToast:!1,xpToastAmount:0,xpToastReason:"",starProfile:null,starApplication:null,liveStarEvents:[],newsTicker:[],isVerifiedStar:!1,setUser:e=>t({user:e,isAuthenticated:!!e}),setLocation:e=>t({location:e}),setLocationError:e=>t({locationError:e}),setLocationPermission:e=>t({locationPermission:e}),setNearbyUsers:e=>t({nearbyUsers:e}),setSearchRadius:e=>t({searchRadius:e}),setIsDiscovering:e=>t({isDiscovering:e}),setChats:e=>t({chats:e}),setActiveChat:e=>t({activeChat:e}),setIsLoading:e=>t({isLoading:e}),setLanguage:e=>{localStorage.setItem("synclulu-language",e),t({language:e})},showXPGain:(e,r)=>t({showXPToast:!0,xpToastAmount:e,xpToastReason:r}),hideXPToast:()=>t({showXPToast:!1}),logout:()=>t({user:null,isAuthenticated:!1,location:null,nearbyUsers:[],chats:[],activeChat:null,starProfile:null,starApplication:null,isVerifiedStar:!1}),setStarProfile:e=>t({starProfile:e,isVerifiedStar:!!e}),setStarApplication:e=>t({starApplication:e}),setLiveStarEvents:e=>t({liveStarEvents:e}),setNewsTicker:e=>t({newsTicker:e})}),{name:"synclulu-store",storage:ape(()=>localStorage),partialize:t=>({user:t.user,isAuthenticated:t.isAuthenticated,language:t.language,searchRadius:t.searchRadius}),onRehydrateStorage:()=>t=>{var e;(e=t==null?void 0:t.user)!=null&&e.avatarUrl&&console.log("[Store] User rehydrated with avatar:",t.user.avatarUrl.slice(0,50)+"...")}})),Hb={maintenanceMode:!1,maintenanceMessage:"Wir machen eine kurze Pause, um das System fr dich zu perfektionieren. Gleich geht's weiter! ",maintenanceStartedAt:null,maintenanceEstimatedEnd:null,features:{referralSystem:!0,premiumPurchases:!1,voiceChat:!0,anonymousMode:!0,starEvents:!0},limits:{maxUsersPerRoom:8,maxRoomsPerUser:3,maxDailyXP:1e3,maxLevel:500,referralLinksPerUser:5},levelConfig:{baseXP:100,exponent:1.5,maxLevel:500,prestigeUnlockLevel:500,communityPrestigeThreshold:400},referralConfig:{linksPerUser:5,xpPerReferral:500,premiumDaysPerReferral:7,socialMultiplierEnabled:!0},updatedAt:new Date,updatedBy:"system"},cpe="system/config",lpe=async(t,e)=>{try{const r=tt(De,cpe);await Yi(r,{...t,updatedAt:new Date,updatedBy:e},{merge:!0})}catch(r){throw r}},XMe=async(t,e,r,a)=>{const l={maintenanceMode:t,maintenanceStartedAt:t?new Date:null,maintenanceEstimatedEnd:t&&a?new Date(Date.now()+a*60*1e3):null};r&&(l.maintenanceMessage=r),await lpe(l,e)},JMe=t=>{const e=tt(De,cpe);return na(e,r=>{var a,l,u;if(r.exists()){const p=r.data();t({...Hb,...p,maintenanceStartedAt:((a=p.maintenanceStartedAt)==null?void 0:a.toDate())||null,maintenanceEstimatedEnd:((l=p.maintenanceEstimatedEnd)==null?void 0:l.toDate())||null,updatedAt:((u=p.updatedAt)==null?void 0:u.toDate())||new Date})}else t(Hb)},r=>{console.warn("System config listener error, using defaults:",r.message),t(Hb)})},hie=()=>{const t="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";let e="";for(let r=0;r<5;r++)e+=t.charAt(Math.floor(Math.random()*t.length));return`synclulu-${e}`},QMe=()=>`ref_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,VL=async t=>{var p;const e=tt(De,"referrals",t),r=await Bn(e);if(r.exists()){const m=r.data();return{...m,links:m.links.map(v=>{var w,R;return{...v,createdAt:((w=v.createdAt)==null?void 0:w.toDate())||new Date,usedAt:((R=v.usedAt)==null?void 0:R.toDate())||null}}),createdAt:((p=m.createdAt)==null?void 0:p.toDate())||new Date}}const a=[],l=new Set;for(let m=0;m<Hb.referralConfig.linksPerUser;m++){let v=hie();for(;l.has(v);)v=hie();l.add(v),a.push({id:QMe(),code:v,createdAt:new Date,usedBy:null,usedAt:null,isActive:!0})}const u={userId:t,links:a,referredBy:null,referredByCode:null,totalReferrals:0,xpEarned:0,premiumDaysEarned:0,createdAt:new Date};return await Yi(e,{...u,links:a.map(m=>({...m,createdAt:fn.fromDate(m.createdAt)})),createdAt:fn.fromDate(u.createdAt)}),u},dpe=async t=>{var l;const e=tt(De,"referrals",t),r=await Bn(e);if(!r.exists())return null;const a=r.data();return{...a,links:a.links.map(u=>{var p,m;return{...u,createdAt:((p=u.createdAt)==null?void 0:p.toDate())||new Date,usedAt:((m=u.usedAt)==null?void 0:m.toDate())||null}}),createdAt:((l=a.createdAt)==null?void 0:l.toDate())||new Date}},upe=async t=>{var l,u;const e=t.toUpperCase().trim(),r=mn(De,"referrals"),a=await Cr(r);for(const p of a.docs){const w=(p.data().links||[]).find(R=>R.code===e&&R.isActive&&!R.usedBy);if(w)return{ownerId:p.id,link:{...w,createdAt:((l=w.createdAt)==null?void 0:l.toDate())||new Date,usedAt:((u=w.usedAt)==null?void 0:u.toDate())||null}}}return null},hpe=async(t,e,r)=>{try{const a=await upe(t);if(!a)return{success:!1,error:"Ungltiger oder bereits verwendeter Code"};if(a.ownerId===e)return{success:!1,error:"Du kannst deinen eigenen Code nicht verwenden"};const l=tt(De,"referrals",a.ownerId),u=await Bn(l);if(!u.exists())return{success:!1,error:"Referrer nicht gefunden"};const p=u.data(),m=Hb.referralConfig,v=p.links.map(A=>A.code===t.toUpperCase().trim()?{...A,usedBy:e,usedAt:fn.fromDate(new Date),isActive:!1}:A);await Xn(l,{links:v,totalReferrals:Ss(1),xpEarned:Ss(m.xpPerReferral),premiumDaysEarned:Ss(m.premiumDaysPerReferral)});const w=tt(De,"users",a.ownerId);await Xn(w,{xp:Ss(m.xpPerReferral),referralCount:Ss(1)});const R=tt(De,"referrals",e);await VL(e),await Xn(R,{referredBy:a.ownerId,referredByCode:t.toUpperCase().trim()});const C=tt(De,"users",e);return await Xn(C,{xp:Ss(m.xpPerReferral/2)}),{success:!0,referrerId:a.ownerId,xpAwarded:m.xpPerReferral,premiumDaysAwarded:m.premiumDaysPerReferral}}catch{return{success:!1,error:"Fehler beim Einlsen des Codes"}}},fI=async t=>{const e=await dpe(t);if(!e)return{totalLinks:0,usedLinks:0,availableLinks:0,totalReferrals:0,xpEarned:0,premiumDaysEarned:0};const r=e.links.filter(l=>l.usedBy!==null).length,a=e.links.filter(l=>l.isActive&&!l.usedBy).length;return{totalLinks:e.links.length,usedLinks:r,availableLinks:a,totalReferrals:e.totalReferrals,xpEarned:e.xpEarned,premiumDaysEarned:e.premiumDaysEarned}},ppe=t=>`${window.location.origin}/register?ref=${encodeURIComponent(t)}`,fpe=async t=>{try{const e=ppe(t);return await navigator.clipboard.writeText(e),!0}catch{return!1}},ZMe=async(t,e)=>{const r=ppe(t),a={title:"Komm zu synclulu! ",text:`${e} ldt dich zu synclulu ein - dem hyperlocal Community Network! Nutze meinen exklusiven Einladungslink:`,url:r};try{return navigator.share&&navigator.canShare(a)?(await navigator.share(a),!0):await fpe(t)}catch{return!1}};/*! Capacitor: https://capacitorjs.com/ - MIT License */var vw;(function(t){t.Unimplemented="UNIMPLEMENTED",t.Unavailable="UNAVAILABLE"})(vw||(vw={}));class YF extends Error{constructor(e,r,a){super(e),this.message=e,this.code=r,this.data=a}}const e5e=t=>{var e,r;return t!=null&&t.androidBridge?"android":!((r=(e=t==null?void 0:t.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||r===void 0)&&r.bridge?"ios":"web"},t5e=t=>{const e=t.CapacitorCustomPlatform||null,r=t.Capacitor||{},a=r.Plugins=r.Plugins||{},l=()=>e!==null?e.name:e5e(t),u=()=>l()!=="web",p=C=>{const A=w.get(C);return!!(A!=null&&A.platforms.has(l())||m(C))},m=C=>{var A;return(A=r.PluginHeaders)===null||A===void 0?void 0:A.find(O=>O.name===C)},v=C=>t.console.error(C),w=new Map,R=(C,A={})=>{const O=w.get(C);if(O)return console.warn(`Capacitor plugin "${C}" already registered. Cannot register plugins twice.`),O.proxy;const U=l(),F=m(C);let q;const W=async()=>(!q&&U in A?q=typeof A[U]=="function"?q=await A[U]():q=A[U]:e!==null&&!q&&"web"in A&&(q=typeof A.web=="function"?q=await A.web():q=A.web),q),H=(Q,ce)=>{var de,pe;if(F){const be=F==null?void 0:F.methods.find(ye=>ce===ye.name);if(be)return be.rtype==="promise"?ye=>r.nativePromise(C,ce.toString(),ye):(ye,Ze)=>r.nativeCallback(C,ce.toString(),ye,Ze);if(Q)return(de=Q[ce])===null||de===void 0?void 0:de.bind(Q)}else{if(Q)return(pe=Q[ce])===null||pe===void 0?void 0:pe.bind(Q);throw new YF(`"${C}" plugin is not implemented on ${U}`,vw.Unimplemented)}},X=Q=>{let ce;const de=(...pe)=>{const be=W().then(ye=>{const Ze=H(ye,Q);if(Ze){const It=Ze(...pe);return ce=It==null?void 0:It.remove,It}else throw new YF(`"${C}.${Q}()" is not implemented on ${U}`,vw.Unimplemented)});return Q==="addListener"&&(be.remove=async()=>ce()),be};return de.toString=()=>`${Q.toString()}() { [capacitor code] }`,Object.defineProperty(de,"name",{value:Q,writable:!1,configurable:!1}),de},ne=X("addListener"),te=X("removeListener"),he=(Q,ce)=>{const de=ne({eventName:Q},ce),pe=async()=>{const ye=await de;te({eventName:Q,callbackId:ye},ce)},be=new Promise(ye=>de.then(()=>ye({remove:pe})));return be.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await pe()},be},J=new Proxy({},{get(Q,ce){switch(ce){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return F?he:ne;case"removeListener":return te;default:return X(ce)}}});return a[C]=J,w.set(C,{name:C,proxy:J,platforms:new Set([...Object.keys(A),...F?[U]:[]])}),J};return r.convertFileSrc||(r.convertFileSrc=C=>C),r.getPlatform=l,r.handleError=v,r.isNativePlatform=u,r.isPluginAvailable=p,r.registerPlugin=R,r.Exception=YF,r.DEBUG=!!r.DEBUG,r.isLoggingEnabled=!!r.isLoggingEnabled,r},n5e=t=>t.Capacitor=t5e(t),P_=n5e(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),FL=P_.registerPlugin;class _W{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,r){let a=!1;this.listeners[e]||(this.listeners[e]=[],a=!0),this.listeners[e].push(r);const u=this.windowListeners[e];u&&!u.registered&&this.addWindowListener(u),a&&this.sendRetainedArgumentsForEvent(e);const p=async()=>this.removeListener(e,r);return Promise.resolve({remove:p})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,r,a){const l=this.listeners[e];if(!l){if(a){let u=this.retainedEventArguments[e];u||(u=[]),u.push(r),this.retainedEventArguments[e]=u}return}l.forEach(u=>u(r))}hasListeners(e){var r;return!!(!((r=this.listeners[e])===null||r===void 0)&&r.length)}registerWindowListener(e,r){this.windowListeners[r]={registered:!1,windowEventName:e,pluginEventName:r,handler:a=>{this.notifyListeners(r,a)}}}unimplemented(e="not implemented"){return new P_.Exception(e,vw.Unimplemented)}unavailable(e="not available"){return new P_.Exception(e,vw.Unavailable)}async removeListener(e,r){const a=this.listeners[e];if(!a)return;const l=a.indexOf(r);this.listeners[e].splice(l,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const r=this.retainedEventArguments[e];r&&(delete this.retainedEventArguments[e],r.forEach(a=>{this.notifyListeners(e,a)}))}}const pie=t=>encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),fie=t=>t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class r5e extends _W{async getCookies(){const e=document.cookie,r={};return e.split(";").forEach(a=>{if(a.length<=0)return;let[l,u]=a.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");l=fie(l).trim(),u=fie(u).trim(),r[l]=u}),r}async setCookie(e){try{const r=pie(e.key),a=pie(e.value),l=`; expires=${(e.expires||"").replace("expires=","")}`,u=(e.path||"/").replace("path=",""),p=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${r}=${a||""}${l}; path=${u}; ${p};`}catch(r){return Promise.reject(r)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(r){return Promise.reject(r)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const r of e)document.cookie=r.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}FL("CapacitorCookies",{web:()=>new r5e});const i5e=async t=>new Promise((e,r)=>{const a=new FileReader;a.onload=()=>{const l=a.result;e(l.indexOf(",")>=0?l.split(",")[1]:l)},a.onerror=l=>r(l),a.readAsDataURL(t)}),s5e=(t={})=>{const e=Object.keys(t);return Object.keys(t).map(l=>l.toLocaleLowerCase()).reduce((l,u,p)=>(l[u]=t[e[p]],l),{})},a5e=(t,e=!0)=>t?Object.entries(t).reduce((a,l)=>{const[u,p]=l;let m,v;return Array.isArray(p)?(v="",p.forEach(w=>{m=e?encodeURIComponent(w):w,v+=`${u}=${m}&`}),v.slice(0,-1)):(m=e?encodeURIComponent(p):p,v=`${u}=${m}`),`${a}&${v}`},"").substr(1):null,o5e=(t,e={})=>{const r=Object.assign({method:t.method||"GET",headers:t.headers},e),l=s5e(t.headers)["content-type"]||"";if(typeof t.data=="string")r.body=t.data;else if(l.includes("application/x-www-form-urlencoded")){const u=new URLSearchParams;for(const[p,m]of Object.entries(t.data||{}))u.set(p,m);r.body=u.toString()}else if(l.includes("multipart/form-data")||t.data instanceof FormData){const u=new FormData;if(t.data instanceof FormData)t.data.forEach((m,v)=>{u.append(v,m)});else for(const m of Object.keys(t.data))u.append(m,t.data[m]);r.body=u;const p=new Headers(r.headers);p.delete("content-type"),r.headers=p}else(l.includes("application/json")||typeof t.data=="object")&&(r.body=JSON.stringify(t.data));return r};class c5e extends _W{async request(e){const r=o5e(e,e.webFetchExtra),a=a5e(e.params,e.shouldEncodeUrlParams),l=a?`${e.url}?${a}`:e.url,u=await fetch(l,r),p=u.headers.get("content-type")||"";let{responseType:m="text"}=u.ok?e:{};p.includes("application/json")&&(m="json");let v,w;switch(m){case"arraybuffer":case"blob":w=await u.blob(),v=await i5e(w);break;case"json":v=await u.json();break;case"document":case"text":default:v=await u.text()}const R={};return u.headers.forEach((C,A)=>{R[A]=C}),{data:v,headers:R,status:u.status,url:u.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}FL("CapacitorHttp",{web:()=>new c5e});var mie;(function(t){t.Dark="DARK",t.Light="LIGHT",t.Default="DEFAULT"})(mie||(mie={}));var gie;(function(t){t.StatusBar="StatusBar",t.NavigationBar="NavigationBar"})(gie||(gie={}));class l5e extends _W{async setStyle(){this.unavailable("not available for web")}async setAnimation(){this.unavailable("not available for web")}async show(){this.unavailable("not available for web")}async hide(){this.unavailable("not available for web")}}FL("SystemBars",{web:()=>new l5e});const Kb=()=>P_.isNativePlatform();let $F=null;const yW=async()=>{if(!Kb())return null;if(!$F)try{$F=(await VN(()=>import("./index-CVheJYuc.js"),[])).FirebaseAuthentication}catch(t){return console.warn("FirebaseAuthentication plugin not available:",t),null}return $F},d5e=async()=>{try{const t=await yW();if(!t)return{success:!1,error:"Native auth not available"};const e=await t.signInWithGoogle();if(e.credential){const r=Gd.credential(e.credential.idToken,e.credential.accessToken);return{success:!0,user:(await uL(ws,r)).user}}return{success:!1,error:"No credential returned"}}catch(t){return console.error("Native Google sign-in error:",t),{success:!1,error:t.message||"Google sign-in failed"}}},u5e=async(t,e)=>{try{if(Kb()){const a=await yW();if(a)return{success:!0,user:(await a.signInWithEmailAndPassword({email:t,password:e})).user}}return{success:!0,user:(await Mle(ws,t,e)).user}}catch(r){return console.error("Email sign-in error:",r),{success:!1,error:r.message||"Sign-in failed"}}},h5e=async(t,e)=>{try{if(Kb()){const a=await yW();if(a)return{success:!0,user:(await a.createUserWithEmailAndPassword({email:t,password:e})).user}}return{success:!0,user:(await $N(ws,t,e)).user}}catch(r){return console.error("Email registration error:",r),{success:!1,error:r.message||"Registration failed"}}},_ie=["yunghundse@gmail.com","jan@butterbread.de","founder@synclulu.app"],qv=()=>{const{user:t,isAuthenticated:e,isLoading:r,setUser:a,setIsLoading:l,logout:u}=Jr();return V.useEffect(()=>{$ke(ws).then(A=>{A!=null&&A.user&&console.log("Google redirect login successful")}).catch(A=>{console.error("Redirect result error:",A)});const C=cke(ws,async A=>{var O,U;if(A){const F=await Bn(tt(De,"users",A.uid));if(F.exists()){const q=F.data(),W=_ie.includes(((O=A.email)==null?void 0:O.toLowerCase())||"");a({...q,id:A.uid,isAdmin:W})}else{const q={email:A.email||"",username:`user_${A.uid.slice(0,8)}`,displayName:A.displayName||"Anonymous",avatarUrl:A.photoURL||null,visibilityMode:"anonymous",isActive:!0,lastSeen:new Date,createdAt:new Date},W={email:q.email,username:q.username,displayName:q.displayName,visibilityMode:q.visibilityMode,isActive:q.isActive,lastSeen:ci(),createdAt:ci()};A.photoURL&&(W.avatarUrl=A.photoURL),await Yi(tt(De,"users",A.uid),W);const H=_ie.includes(((U=A.email)==null?void 0:U.toLowerCase())||"");a({...q,id:A.uid,isAdmin:H})}}else a(null);l(!1)});return()=>C()},[a,l]),{user:t,isAuthenticated:e,isLoading:r,signIn:async(C,A)=>{try{if(Kb()){const O=await u5e(C,A);return O.success?{success:!0}:{success:!1,error:O.error||"Login fehlgeschlagen"}}return await Mle(ws,C,A),{success:!0}}catch(O){let U="Login fehlgeschlagen";return O.code==="auth/invalid-credential"||O.code==="auth/wrong-password"?U="E-Mail oder Passwort ist falsch":O.code==="auth/user-not-found"?U="Kein Account mit dieser E-Mail gefunden":O.code==="auth/invalid-email"?U="Ungltige E-Mail-Adresse":O.code==="auth/too-many-requests"?U="Zu viele Versuche. Bitte warte einen Moment.":O.code==="auth/user-disabled"&&(U="Dieser Account wurde deaktiviert"),{success:!1,error:U}}},signUp:async(C,A,O,U)=>{try{let F;if(Kb()){const W=await h5e(C,A);if(!W.success)return{success:!1,error:W.error||"Registrierung fehlgeschlagen"};F={user:ws.currentUser}}else F=await $N(ws,C,A);const q={email:C,username:O,displayName:O,visibilityMode:"anonymous",isActive:!0,xp:0,level:1,lastSeen:ci(),createdAt:ci()};if(await Yi(tt(De,"users",F.user.uid),q),await VL(F.user.uid),U)try{await hpe(U,F.user.uid,O)}catch(W){console.log("Referral processing failed:",W)}return{success:!0}}catch(F){let q="Registrierung fehlgeschlagen";return F.code==="auth/email-already-in-use"?q="Diese E-Mail ist bereits registriert":F.code==="auth/invalid-email"?q="Ungltige E-Mail-Adresse":F.code==="auth/weak-password"?q="Passwort muss mindestens 6 Zeichen haben":F.code==="auth/operation-not-allowed"&&(q="Registrierung ist momentan nicht mglich"),{success:!1,error:q}}},signInWithGoogle:async()=>{try{if(Kb()){const A=await d5e();return A.success?{success:!0}:{success:!1,error:A.error||"Google Login fehlgeschlagen"}}const C=new Gd;C.setCustomParameters({prompt:"select_account"});try{return await lG(ws,C),{success:!0}}catch(A){if(A.code==="auth/popup-blocked"||A.code==="auth/popup-closed-by-user"||A.code==="auth/cancelled-popup-request")return console.log("Popup blocked, using redirect..."),await Kke(ws,C),{success:!0};throw A}}catch(C){let A="Google Login fehlgeschlagen";return C.code==="auth/popup-closed-by-user"?A="Login abgebrochen":C.code==="auth/account-exists-with-different-credential"?A="Ein Account mit dieser E-Mail existiert bereits":C.code==="auth/network-request-failed"&&(A="Netzwerkfehler - bitte prfe deine Verbindung"),{success:!1,error:A}}},resetPassword:async C=>{try{return await $1e(ws,C),{success:!0}}catch(A){let O="Fehler beim Zurcksetzen des Passworts";return A.code==="auth/user-not-found"?O="Kein Account mit dieser E-Mail gefunden":A.code==="auth/invalid-email"&&(O="Ungltige E-Mail-Adresse"),{success:!1,error:O}}},logout:async()=>{try{return await Fle(ws),u(),{success:!0}}catch(C){return{success:!1,error:C.message}}}}},mpe=()=>{const t=V.useRef(null),e=V.useCallback(()=>(t.current||(t.current=new(window.AudioContext||window.webkitAudioContext)),t.current),[]),r=V.useCallback((R,C,A="sine",O=.3)=>{try{const U=e();U.state==="suspended"&&U.resume();const F=U.createOscillator(),q=U.createGain();F.connect(q),q.connect(U.destination),F.type=A,F.frequency.setValueAtTime(R,U.currentTime),q.gain.setValueAtTime(0,U.currentTime),q.gain.linearRampToValueAtTime(O,U.currentTime+.02),q.gain.linearRampToValueAtTime(0,U.currentTime+C),F.start(U.currentTime),F.stop(U.currentTime+C)}catch{}},[e]),a=V.useCallback(()=>{r(523.25,.1,"sine",.2),setTimeout(()=>r(659.25,.1,"sine",.2),80),setTimeout(()=>r(783.99,.15,"sine",.25),160)},[r]),l=V.useCallback(()=>{r(523.25,.1,"sine",.15),setTimeout(()=>r(392,.15,"sine",.1),100)},[r]),u=V.useCallback(()=>{r(440,.15,"square",.15),setTimeout(()=>r(440,.15,"square",.15),200),setTimeout(()=>r(440,.15,"square",.15),400)},[r]),p=V.useCallback(()=>{r(880,.08,"sine",.2),setTimeout(()=>r(1108.73,.12,"sine",.25),60)},[r]),m=V.useCallback(()=>{r(220,.2,"sawtooth",.1)},[r]),v=V.useCallback(R=>{R?(r(440,.08,"sine",.15),setTimeout(()=>r(330,.1,"sine",.1),50)):(r(330,.08,"sine",.15),setTimeout(()=>r(440,.1,"sine",.15),50))},[r]),w=V.useCallback(()=>{r(587.33,.1,"sine",.2),setTimeout(()=>r(880,.15,"sine",.25),100)},[r]);return{playJoinSound:a,playLeaveSound:l,playWarningSound:u,playXPSound:p,playErrorSound:m,playMuteSound:v,playNotificationSound:w}},gpe=()=>{const[t,e]=V.useState(Hb),[r,a]=V.useState(!0);return V.useEffect(()=>{let l=!1;const u=setTimeout(()=>{r&&(console.warn("System config timeout - using defaults"),l=!0,a(!1))},3e3),p=JMe(m=>{l||(clearTimeout(u),e(m),a(!1))});return()=>{clearTimeout(u),p()}},[]),{config:t,isLoading:r,isMaintenanceMode:t.maintenanceMode,maintenanceMessage:t.maintenanceMessage,maintenanceEstimatedEnd:t.maintenanceEstimatedEnd,features:t.features,limits:t.limits,levelConfig:t.levelConfig,referralConfig:t.referralConfig}};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var p5e={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f5e=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),wt=(t,e)=>{const r=V.forwardRef(({color:a="currentColor",size:l=24,strokeWidth:u=2,absoluteStrokeWidth:p,className:m="",children:v,...w},R)=>V.createElement("svg",{ref:R,...p5e,width:l,height:l,stroke:a,strokeWidth:p?Number(u)*24/Number(l):u,className:["lucide",`lucide-${f5e(t)}`,m].join(" "),...w},[...e.map(([C,A])=>V.createElement(C,A)),...Array.isArray(v)?v:[v]]));return r.displayName=`${t}`,r};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dz=wt("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mI=wt("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rh=wt("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eo=wt("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _pe=wt("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m5e=wt("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vW=wt("AtSign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gv=wt("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ype=wt("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FC=wt("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kl=wt("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g5e=wt("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _5e=wt("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EW=wt("Cake",[["path",{d:"M20 21v-8a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v8",key:"1w3rig"}],["path",{d:"M4 16s.5-1 2-1 2.5 2 4 2 2.5-2 4-2 2.5 2 4 2 2-1 2-1",key:"n2jgmb"}],["path",{d:"M2 21h20",key:"1nyx9w"}],["path",{d:"M7 8v3",key:"1qtyvj"}],["path",{d:"M12 8v3",key:"hwp4zt"}],["path",{d:"M17 8v3",key:"1i6e5u"}],["path",{d:"M7 4h0.01",key:"hsw7lv"}],["path",{d:"M12 4h0.01",key:"1e3d8f"}],["path",{d:"M17 4h0.01",key:"p7cxgy"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ap=wt("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vO=wt("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sm=wt("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BC=wt("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _r=wt("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xW=wt("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dd=wt("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fi=wt("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ua=wt("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xo=wt("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y5e=wt("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uz=wt("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $m=wt("Compass",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76",key:"m9r19z"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bW=wt("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=wt("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hz=wt("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v5e=wt("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E5e=wt("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lp=wt("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pl=wt("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AN=wt("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vpe=wt("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BL=wt("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x5e=wt("Gamepad2",[["line",{x1:"6",x2:"10",y1:"11",y2:"11",key:"1gktln"}],["line",{x1:"8",x2:"8",y1:"9",y2:"13",key:"qnk9ow"}],["line",{x1:"15",x2:"15.01",y1:"12",y2:"12",key:"krot7o"}],["line",{x1:"18",x2:"18.01",y1:"10",y2:"10",key:"1lcuu1"}],["path",{d:"M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z",key:"mfqc10"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yie=wt("Ghost",[["path",{d:"M9 10h.01",key:"qbtxuw"}],["path",{d:"M15 10h.01",key:"1qmjsl"}],["path",{d:"M12 2a8 8 0 0 0-8 8v12l3-3 2.5 2.5L12 19l2.5 2.5L17 19l3 3V10a8 8 0 0 0-8-8z",key:"uwwb07"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _o=wt("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mv=wt("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b5e=wt("GraduationCap",[["path",{d:"M22 10v6M2 10l10-5 10 5-10 5z",key:"1ef52a"}],["path",{d:"M6 12v5c3 3 9 3 12 0v-5",key:"1f75yj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pz=wt("Hand",[["path",{d:"M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0",key:"aigmz7"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v2",key:"1n6bmn"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8",key:"a9iiix"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Epe=wt("Headphones",[["path",{d:"M3 14h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a9 9 0 0 1 18 0v7a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3",key:"1xhozi"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xpe=wt("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gI=wt("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wW=wt("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w5e=wt("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S5e=wt("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bpe=wt("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T5e=wt("Instagram",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vie=wt("Laptop",[["path",{d:"M20 16V7a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v9m16 0H4m16 0 1.28 2.55a1 1 0 0 1-.9 1.45H3.62a1 1 0 0 1-.9-1.45L4 16",key:"tarvll"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eie=wt("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R5e=wt("Linkedin",[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fi=wt("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yo=wt("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zL=wt("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c0=wt("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const no=wt("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wpe=wt("Map",[["polygon",{points:"3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21",key:"ok2ie8"}],["line",{x1:"9",x2:"9",y1:"3",y2:"18",key:"w34qz5"}],["line",{x1:"15",x2:"15",y1:"6",y2:"21",key:"volv9a"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hp=wt("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C5e=wt("Mic2",[["path",{d:"m12 8-9.04 9.06a2.82 2.82 0 1 0 3.98 3.98L16 12",key:"zoua8r"}],["circle",{cx:"17",cy:"7",r:"5",key:"1fomce"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SW=wt("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qo=wt("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N5e=wt("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I5e=wt("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A5e=wt("Music2",[["circle",{cx:"8",cy:"18",r:"4",key:"1fc0mg"}],["path",{d:"M12 18V2l7 4",key:"g04rme"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k5e=wt("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _I=wt("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XF=wt("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EO=wt("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P5e=wt("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D5e=wt("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Spe=wt("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ew=wt("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O5e=wt("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tpe=wt("Radar",[["path",{d:"M19.07 4.93A10 10 0 0 0 6.99 3.34",key:"z3du51"}],["path",{d:"M4 6h.01",key:"oypzma"}],["path",{d:"M2.29 9.62A10 10 0 1 0 21.31 8.35",key:"qzzz0"}],["path",{d:"M16.24 7.76A6 6 0 1 0 8.23 16.67",key:"1yjesh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M17.99 11.66A6 6 0 0 1 15.77 16.67",key:"1u2y91"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"m13.41 10.59 5.66-5.66",key:"mhq4k0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yd=wt("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _v=wt("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L5e=wt("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j5e=wt("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xw=wt("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xO=wt("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GL=wt("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M5e=wt("ShieldOff",[["path",{d:"M19.7 14a6.9 6.9 0 0 0 .3-2V5l-8-3-3.2 1.2",key:"342pvf"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M4.7 4.7 4 5v7c0 6 8 10 8 10a20.3 20.3 0 0 0 5.62-4.38",key:"p0ycf4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=wt("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rpe=wt("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kn=wt("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ji=wt("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U5e=wt("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V5e=wt("Tablet",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["line",{x1:"12",x2:"12.01",y1:"18",y2:"18",key:"1dp563"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F5e=wt("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B5e=wt("ThumbsDown",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z",key:"s6e0r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z5e=wt("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G5e=wt("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lm=wt("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fd=wt("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fz=wt("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W5e=wt("Twitter",[["path",{d:"M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z",key:"pff0z6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H5e=wt("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K_=wt("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cpe=wt("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xie=wt("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K5e=wt("UserMinus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const op=wt("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bO=wt("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const md=wt("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cr=wt("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Npe=wt("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WL=wt("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q5e=wt("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y5e=wt("Wifi",[["path",{d:"M5 13a10 10 0 0 1 14 0",key:"6v8j51"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $5e=wt("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Di=wt("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X5e=wt("Youtube",[["path",{d:"M2.5 17a24.12 24.12 0 0 1 0-10 2 2 0 0 1 1.4-1.4 49.56 49.56 0 0 1 16.2 0A2 2 0 0 1 21.5 7a24.12 24.12 0 0 1 0 10 2 2 0 0 1-1.4 1.4 49.55 49.55 0 0 1-16.2 0A2 2 0 0 1 2.5 17",key:"1q2vi4"}],["path",{d:"m10 15 5-3-5-3z",key:"1jp15x"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=wt("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Wd={de:{name:"German",flag:"",native:"Deutsch"},en:{name:"English",flag:"",native:"English"},es:{name:"Spanish",flag:"",native:"Espaol"},fr:{name:"French",flag:"",native:"Franais"},pt:{name:"Portuguese",flag:"",native:"Portugus"}},J5e={common:{save:{de:"Speichern",en:"Save",es:"Guardar",fr:"Enregistrer",pt:"Salvar"},cancel:{de:"Abbrechen",en:"Cancel",es:"Cancelar",fr:"Annuler",pt:"Cancelar"},confirm:{de:"Besttigen",en:"Confirm",es:"Confirmar",fr:"Confirmer",pt:"Confirmar"},delete:{de:"Lschen",en:"Delete",es:"Eliminar",fr:"Supprimer",pt:"Excluir"},edit:{de:"Bearbeiten",en:"Edit",es:"Editar",fr:"Modifier",pt:"Editar"},back:{de:"Zurck",en:"Back",es:"Atrs",fr:"Retour",pt:"Voltar"},next:{de:"Weiter",en:"Next",es:"Siguiente",fr:"Suivant",pt:"Prximo"},done:{de:"Fertig",en:"Done",es:"Hecho",fr:"Termin",pt:"Concludo"},loading:{de:"Ldt...",en:"Loading...",es:"Cargando...",fr:"Chargement...",pt:"Carregando..."},retry:{de:"Erneut versuchen",en:"Retry",es:"Reintentar",fr:"Ressayer",pt:"Tentar novamente"}},nav:{home:{de:"Home",en:"Home",es:"Inicio",fr:"Accueil",pt:"Incio"},discover:{de:"Entdecken",en:"Discover",es:"Descubrir",fr:"Dcouvrir",pt:"Descobrir"},messages:{de:"Nachrichten",en:"Messages",es:"Mensajes",fr:"Messages",pt:"Mensagens"},profile:{de:"Profil",en:"Profile",es:"Perfil",fr:"Profil",pt:"Perfil"}},profile:{title:{de:"Profil",en:"Profile",es:"Perfil",fr:"Profil",pt:"Perfil"},editProfile:{de:"Profil bearbeiten",en:"Edit Profile",es:"Editar perfil",fr:"Modifier le profil",pt:"Editar perfil"},bioPlaceholder:{de:"Erzhl was ber dich...",en:"Tell us about yourself...",es:"Cuntanos sobre ti...",fr:"Parlez-nous de vous...",pt:"Conte-nos sobre voc..."},noBio:{de:"Keine Bio. Ein Mensch der Geheimnisse.",en:"No bio. A person of mystery.",es:"Sin bio. Una persona misteriosa.",fr:"Pas de bio. Une personne mystrieuse.",pt:"Sem bio. Uma pessoa misteriosa."},stats:{friends:{de:"Freunde",en:"Friends",es:"Amigos",fr:"Amis",pt:"Amigos"},trust:{de:"Trust",en:"Trust",es:"Confianza",fr:"Confiance",pt:"Confiana"},voiceMin:{de:"Voice Min",en:"Voice Min",es:"Min de Voz",fr:"Min Vocal",pt:"Min de Voz"}},logout:{de:"Abmelden",en:"Log out",es:"Cerrar sesin",fr:"Dconnexion",pt:"Sair"},loggingOut:{de:"Wird abgemeldet...",en:"Logging out...",es:"Cerrando sesin...",fr:"Dconnexion...",pt:"Saindo..."}},level:{level:{de:"Level",en:"Level",es:"Nivel",fr:"Niveau",pt:"Nvel"},xpToNext:{de:"XP zum nchsten Level",en:"XP to next level",es:"XP para el siguiente nivel",fr:"XP pour le prochain niveau",pt:"XP para o prximo nvel"},titles:{newcomer:{de:"Newcomer",en:"Newcomer",es:"Novato",fr:"Nouveau",pt:"Novato"},dreamer:{de:"Dreamer",en:"Dreamer",es:"Soador",fr:"Rveur",pt:"Sonhador"},connector:{de:"Connector",en:"Connector",es:"Conector",fr:"Connecteur",pt:"Conector"},socialite:{de:"Socialite",en:"Socialite",es:"Socialit",fr:"Mondain",pt:"Socialite"},influencer:{de:"Influencer",en:"Influencer",es:"Influencer",fr:"Influenceur",pt:"Influenciador"},legend:{de:"Legend",en:"Legend",es:"Leyenda",fr:"Lgende",pt:"Lenda"}},levelUp:{de:"Du bist jetzt offiziell weniger irrelevant. Willkommen auf Level {level}.",en:"You're officially less irrelevant now. Welcome to Level {level}.",es:"Ahora eres oficialmente menos irrelevante. Bienvenido al Nivel {level}.",fr:"Tu es officiellement moins insignifiant maintenant. Bienvenue au Niveau {level}.",pt:"Voc agora  oficialmente menos irrelevante. Bem-vindo ao Nvel {level}."}},streak:{title:{de:"Streak",en:"Streak",es:"Racha",fr:"Srie",pt:"Sequncia"},days:{de:"Tage",en:"days",es:"das",fr:"jours",pt:"dias"},xpBoost:{de:"XP Boost",en:"XP Boost",es:"Bonus de XP",fr:"Bonus XP",pt:"Bnus de XP"},lost:{de:"Streak verloren. Das war wohl nichts. Aber hey, morgen ist ein neuer Tag.",en:"Streak lost. That didn't work out. But hey, tomorrow's a new day.",es:"Racha perdida. Eso no funcion. Pero oye, maana es un nuevo da.",fr:"Srie perdue. a n'a pas march. Mais bon, demain est un autre jour.",pt:"Sequncia perdida. No deu certo. Mas ei, amanh  um novo dia."},frozen:{de:"Streak eingefroren. Ausnahmsweise.",en:"Streak frozen. Just this once.",es:"Racha congelada. Solo por esta vez.",fr:"Srie gele. Exceptionnellement.",pt:"Sequncia congelada. S desta vez."}},visibility:{title:{de:"Wer darf dich sehen?",en:"Who can see you?",es:"Quin puede verte?",fr:"Qui peut te voir?",pt:"Quem pode te ver?"},public:{title:{de:"Alle in Reichweite",en:"Everyone nearby",es:"Todos cerca",fr:"Tout le monde  proximit",pt:"Todos por perto"},description:{de:"Jeder im Radius kann dich sehen",en:"Anyone in range can see you",es:"Cualquiera en el rango puede verte",fr:"Tout le monde dans le rayon peut te voir",pt:"Qualquer um no raio pode te ver"},hint:{de:"Alle sehen dich. Kein Verstecken.",en:"Everyone sees you. No hiding.",es:"Todos te ven. Sin esconderse.",fr:"Tout le monde te voit. Pas de cachette.",pt:"Todos te veem. Sem se esconder."}},friends:{title:{de:"Nur meine Freunde",en:"Only my friends",es:"Solo mis amigos",fr:"Seulement mes amis",pt:"Apenas meus amigos"},description:{de:"Fremde sehen dich nicht",en:"Strangers can't see you",es:"Los extraos no pueden verte",fr:"Les inconnus ne te voient pas",pt:"Estranhos no podem te ver"},hint:{de:"Nur deine Freunde sehen dich. Exklusivclub.",en:"Only your friends see you. Exclusive club.",es:"Solo tus amigos te ven. Club exclusivo.",fr:"Seuls tes amis te voient. Club exclusif.",pt:"S seus amigos te veem. Clube exclusivo."}},ghost:{title:{de:"Niemand (Ghost Mode) ",en:"Nobody (Ghost Mode) ",es:"Nadie (Modo Fantasma) ",fr:"Personne (Mode Fantme) ",pt:"Ningum (Modo Fantasma) "},description:{de:"Du bist komplett unsichtbar",en:"You're completely invisible",es:"Eres completamente invisible",fr:"Tu es compltement invisible",pt:"Voc est completamente invisvel"},hint:{de:"Ghost Mode aktiv. Du existierst nicht. Sehr dramatisch.",en:"Ghost Mode active. You don't exist. Very dramatic.",es:"Modo Fantasma activo. No existes. Muy dramtico.",fr:"Mode Fantme actif. Tu n'existes pas. Trs dramatique.",pt:"Modo Fantasma ativo. Voc no existe. Muito dramtico."}}},friendRadar:{title:{de:"Friend-Radar",en:"Friend Radar",es:"Radar de Amigos",fr:"Radar Amis",pt:"Radar de Amigos"},description:{de:"Benachrichtigung im 10km Radius",en:"Notification within 10km radius",es:"Notificacin en radio de 10km",fr:"Notification dans un rayon de 10km",pt:"Notificao em raio de 10km"},notification:{de:"{name} ist im 10km-Radius. Keine Sorge, er kann dich nicht hren  es sei denn, du willst es.",en:"{name} is within 10km. Don't worry, they can't hear you  unless you want them to.",es:"{name} est a 10km. No te preocupes, no pueden orte  a menos que quieras.",fr:"{name} est  10km. T'inquite, ils ne peuvent pas t'entendre  sauf si tu le veux.",pt:"{name} est a 10km. No se preocupe, eles no podem te ouvir  a menos que voc queira."},enabled:{de:"Friend-Radar aktiv",en:"Friend Radar active",es:"Radar de Amigos activo",fr:"Radar Amis actif",pt:"Radar de Amigos ativo"},disabled:{de:"Friend-Radar aus. Du willst also berrascht werden? Mutig.",en:"Friend Radar off. So you want to be surprised? Bold.",es:"Radar de Amigos apagado. Quieres sorpresas? Valiente.",fr:"Radar Amis dsactiv. Tu veux tre surpris? Audacieux.",pt:"Radar de Amigos desligado. Quer ser surpreendido? Corajoso."}},radius:{title:{de:"Suchradius",en:"Search Radius",es:"Radio de Bsqueda",fr:"Rayon de Recherche",pt:"Raio de Busca"},description:{de:"Wie weit siehst du andere?",en:"How far can you see others?",es:"Qu tan lejos puedes ver a otros?",fr:" quelle distance peux-tu voir les autres?",pt:"At onde voc pode ver os outros?"},hint:{max:{de:"Maximale Reichweite. Viel Spa mit dem Chaos.",en:"Maximum range. Have fun with the chaos.",es:"Alcance mximo. Divirtete con el caos.",fr:"Porte maximale. Amuse-toi avec le chaos.",pt:"Alcance mximo. Divirta-se com o caos."},min:{de:"Nur die Nchsten. Sehr... intim.",en:"Only the closest. Very... intimate.",es:"Solo los ms cercanos. Muy... ntimo.",fr:"Seulement les plus proches. Trs... intime.",pt:"Apenas os mais prximos. Muito... ntimo."},default:{de:"Sollte reichen.",en:"Should be enough.",es:"Debera ser suficiente.",fr:"a devrait suffire.",pt:"Deve ser suficiente."}},error:{de:"Nett versucht, aber die Physik lsst sich nicht austricksen. Wir kalibrieren den Radius neu.",en:"Nice try, but you can't trick physics. We're recalibrating the radius.",es:"Buen intento, pero no puedes engaar a la fsica. Recalibrando el radio.",fr:"Bien essay, mais tu ne peux pas tromper la physique. On recalibre le rayon.",pt:"Boa tentativa, mas voc no pode enganar a fsica. Recalibrando o raio."}},premium:{title:{de:"CATALYST",en:"CATALYST",es:"CATALYST",fr:"CATALYST",pt:"CATALYST"},upsell:{de:"Hr auf zu schleichen. Hol dir den Catalyst und sieh genau, wer in deiner Nhe ist, bevor sie dich sehen.",en:"Stop lurking. Get Catalyst and see exactly who is near you before they see you.",es:"Deja de acechar. Obtn Catalyst y ve exactamente quin est cerca antes de que te vean.",fr:"Arrte de rder. Prends Catalyst et vois exactement qui est prs de toi avant qu'ils te voient.",pt:"Pare de espreitar. Obtenha o Catalyst e veja exatamente quem est perto antes que te vejam."},upgrade:{de:"Jetzt upgraden",en:"Upgrade now",es:"Actualizar ahora",fr:"Mettre  niveau",pt:"Atualizar agora"},features:{xpBoost:{de:"1.5x XP Boost  permanent",en:"1.5x XP Boost  permanent",es:"1.5x Bonus de XP  permanente",fr:"1.5x Bonus XP  permanent",pt:"1.5x Bnus de XP  permanente"},exactDistance:{de:"Meter-genaue Distanzanzeige",en:"Meter-precise distance display",es:"Distancia precisa en metros",fr:"Distance prcise au mtre",pt:"Distncia precisa em metros"},profileStalker:{de:"Sieh wer dein Profil besucht",en:"See who viewed your profile",es:"Ve quin visit tu perfil",fr:"Vois qui a visit ton profil",pt:"Veja quem visitou seu perfil"},priorityListing:{de:"Immer oben in der Liste",en:"Always at the top of the list",es:"Siempre arriba en la lista",fr:"Toujours en haut de la liste",pt:"Sempre no topo da lista"}}},settings:{title:{de:"Einstellungen",en:"Settings",es:"Configuracin",fr:"Paramtres",pt:"Configuraes"},blockedUsers:{de:"Blockierte Nutzer",en:"Blocked Users",es:"Usuarios Bloqueados",fr:"Utilisateurs Bloqus",pt:"Usurios Bloqueados"},myStats:{de:"Meine Statistiken",en:"My Statistics",es:"Mis Estadsticas",fr:"Mes Statistiques",pt:"Minhas Estatsticas"},notifications:{de:"Benachrichtigungen",en:"Notifications",es:"Notificaciones",fr:"Notifications",pt:"Notificaes"},appDesign:{de:"App-Design",en:"App Design",es:"Diseo de la App",fr:"Design de l'App",pt:"Design do App"},language:{de:"Sprache",en:"Language",es:"Idioma",fr:"Langue",pt:"Idioma"},help:{de:"Hilfe & FAQ",en:"Help & FAQ",es:"Ayuda y FAQ",fr:"Aide et FAQ",pt:"Ajuda e FAQ"}},moderation:{shadowMuted:{de:"Deine Vibes sind gerade ziemlich toxic. Wir haben dich mal kurz stummgeschaltet, damit die anderen in Ruhe weiterreden knnen. Atme mal tief durch.",en:"Your vibes are pretty toxic right now. We've muted you for a bit so others can chat in peace. Take a deep breath.",es:"Tus vibes son bastante txicas ahora. Te silenciamos un rato para que otros puedan charlar en paz. Respira hondo.",fr:"Tes vibes sont assez toxiques l. On t'a mis en sourdine pour que les autres puissent discuter tranquilles. Respire un coup.",pt:"Suas vibes esto bem txicas agora. Te silenciamos um pouco para os outros conversarem em paz. Respire fundo."},tempBanned:{de:"OK, das war's erstmal fr dich. Du bist fr {hours}h auf Eis gelegt. Nutz die Zeit, um ber deine Lebensentscheidungen nachzudenken.",en:"OK, that's it for now. You're on ice for {hours}h. Use the time to reflect on your life choices.",es:"OK, eso es todo por ahora. Ests en hielo por {hours}h. Usa el tiempo para reflexionar sobre tus decisiones de vida.",fr:"OK, c'est fini pour l'instant. Tu es sur glace pour {hours}h. Profite pour rflchir  tes choix de vie.",pt:"OK,  isso por agora. Voc est no gelo por {hours}h. Use o tempo para refletir sobre suas escolhas de vida."},warning:{de:"Heads up: Noch ein Ausrutscher und du landest auf der Bank. Deine Entscheidung.",en:"Heads up: One more slip and you're benched. Your call.",es:"Aviso: Un error ms y ests en la banca. Tu decisin.",fr:"Attention: Un faux pas de plus et tu es sur le banc.  toi de voir.",pt:"Aviso: Mais um deslize e voc vai pro banco. Sua deciso."}},errors:{generic:{de:"Irgendwas ist schiefgelaufen. Wahrscheinlich nicht deine Schuld. Wahrscheinlich.",en:"Something went wrong. Probably not your fault. Probably.",es:"Algo sali mal. Probablemente no es tu culpa. Probablemente.",fr:"Quelque chose s'est mal pass. Probablement pas ta faute. Probablement.",pt:"Algo deu errado. Provavelmente no  sua culpa. Provavelmente."},network:{de:"Keine Verbindung. Das Internet hat dich verlassen, nicht wir.",en:"No connection. The internet left you, not us.",es:"Sin conexin. Internet te dej, no nosotros.",fr:"Pas de connexion. Internet t'a quitt, pas nous.",pt:"Sem conexo. A internet te deixou, no ns."},location:{de:"GPS-Signal verloren. Vielleicht stehst du in einem Bunker?",en:"GPS signal lost. Maybe you're in a bunker?",es:"Seal GPS perdida. Quizs ests en un bnker?",fr:"Signal GPS perdu. T'es peut-tre dans un bunker?",pt:"Sinal GPS perdido. Talvez voc esteja em um bunker?"}},empty:{friends:{de:"Noch keine Freunde. Das lsst sich ndern  geh raus und quatsch Leute an.",en:"No friends yet. That can change  go out and talk to people.",es:"An sin amigos. Eso puede cambiar  sal y habla con la gente.",fr:"Pas encore d'amis. a peut changer  sors et parle aux gens.",pt:"Ainda sem amigos. Isso pode mudar  saia e fale com as pessoas."},nearbyUsers:{de:"Niemand in Reichweite. Entweder bist du allein, oder alle verstecken sich vor dir.",en:"No one in range. Either you're alone, or everyone's hiding from you.",es:"Nadie en rango. O ests solo, o todos se esconden de ti.",fr:"Personne  porte. Soit t'es seul, soit tout le monde se cache de toi.",pt:"Ningum no alcance. Ou voc est sozinho, ou todos esto se escondendo de voc."},messages:{de:"Keine Nachrichten. Die Stille ist ohrenbetubend.",en:"No messages. The silence is deafening.",es:"Sin mensajes. El silencio es ensordecedor.",fr:"Pas de messages. Le silence est assourdissant.",pt:"Sem mensagens. O silncio  ensurdecedor."}},avatar:{title:{de:"Whle deinen Avatar",en:"Choose your avatar",es:"Elige tu avatar",fr:"Choisis ton avatar",pt:"Escolha seu avatar"},subtitle:{de:"Dein Avatar wird anderen angezeigt",en:"Your avatar will be shown to others",es:"Tu avatar se mostrar a otros",fr:"Ton avatar sera montr aux autres",pt:"Seu avatar ser mostrado aos outros"},selected:{de:"Ausgewhlt",en:"Selected",es:"Seleccionado",fr:"Slectionn",pt:"Selecionado"}},trust:{trusted:{de:"TRUSTED",en:"TRUSTED",es:"CONFIABLE",fr:"FIABLE",pt:"CONFIVEL"},reliable:{de:"RELIABLE",en:"RELIABLE",es:"FIABLE",fr:"SRIEUX",pt:"CONFIVEL"},neutral:{de:"NEUTRAL",en:"NEUTRAL",es:"NEUTRAL",fr:"NEUTRE",pt:"NEUTRO"},caution:{de:"VORSICHT",en:"CAUTION",es:"PRECAUCIN",fr:"ATTENTION",pt:"CUIDADO"}}};function ag(){const{language:t,setLanguage:e}=Jr(),r=V.useCallback((l,u)=>{const p=l.split(".");let m=J5e;for(const v of p)if(m&&typeof m=="object"&&v in m)m=m[v];else return console.warn(`Translation not found: ${l}`),l;if(m&&typeof m=="object"&&t in m){let v=m[t];return u&&Object.entries(u).forEach(([w,R])=>{v=v.replace(new RegExp(`{${w}}`,"g"),String(R))}),v}return console.warn(`Translation not found for language ${t}: ${l}`),l},[t]),a=V.useCallback(l=>{e(l),localStorage.setItem("synclulu-language",l)},[e]);return{t:r,language:t,setLanguage:a,languages:Wd,currentLanguage:Wd[t]}}const TW=({className:t="",size:e=200})=>c.jsxs("svg",{width:e,height:e*1.3,viewBox:"0 0 200 260",className:t,children:[c.jsx("ellipse",{cx:"100",cy:"20",rx:"45",ry:"8",fill:"none",stroke:"url(#haloGradient)",strokeWidth:"3",opacity:"0.8"}),c.jsx("ellipse",{cx:"100",cy:"75",rx:"40",ry:"35",fill:"url(#hairGradient)"}),c.jsx("circle",{cx:"70",cy:"60",r:"15",fill:"url(#hairGradient)"}),c.jsx("circle",{cx:"130",cy:"60",r:"15",fill:"url(#hairGradient)"}),c.jsx("circle",{cx:"60",cy:"80",r:"12",fill:"url(#hairGradient)"}),c.jsx("circle",{cx:"140",cy:"80",r:"12",fill:"url(#hairGradient)"}),c.jsx("ellipse",{cx:"100",cy:"45",rx:"35",ry:"10",fill:"white",stroke:"#2d3748",strokeWidth:"2"}),c.jsx("rect",{x:"70",y:"35",width:"60",height:"12",fill:"white",stroke:"#2d3748",strokeWidth:"2"}),c.jsx("text",{x:"100",y:"46",textAnchor:"middle",fontSize:"10",fill:"#4a5568",children:""}),c.jsx("ellipse",{cx:"100",cy:"95",rx:"35",ry:"32",fill:"#fce4c4"}),c.jsx("ellipse",{cx:"85",cy:"90",rx:"8",ry:"10",fill:"white"}),c.jsx("ellipse",{cx:"115",cy:"90",rx:"8",ry:"10",fill:"white"}),c.jsx("circle",{cx:"85",cy:"92",r:"5",fill:"#2d3748"}),c.jsx("circle",{cx:"115",cy:"92",r:"5",fill:"#2d3748"}),c.jsx("circle",{cx:"87",cy:"90",r:"2",fill:"white"}),c.jsx("circle",{cx:"117",cy:"90",r:"2",fill:"white"}),c.jsx("path",{d:"M75 82 Q85 78 92 82",fill:"none",stroke:"#2d3748",strokeWidth:"2"}),c.jsx("path",{d:"M108 82 Q115 78 125 82",fill:"none",stroke:"#2d3748",strokeWidth:"2"}),c.jsx("path",{d:"M92 108 Q100 105 108 108",fill:"none",stroke:"#2d3748",strokeWidth:"2"}),c.jsx("path",{d:"M65 130 Q60 160 65 200 L135 200 Q140 160 135 130 Z",fill:"#2d3748"}),c.jsx("path",{d:"M70 130 L100 155 L130 130",fill:"none",stroke:"#5a7fa8",strokeWidth:"3"}),c.jsx("rect",{x:"75",y:"125",width:"50",height:"15",fill:"#2d3748"}),c.jsx("path",{d:"M95 145 L100 165 L105 145 Z",fill:"#a8d5e5"}),c.jsx("circle",{cx:"100",cy:"142",r:"5",fill:"#a8d5e5"}),c.jsx("rect",{x:"60",y:"175",width:"20",height:"3",fill:"#5a7fa8"}),c.jsx("rect",{x:"60",y:"180",width:"20",height:"3",fill:"#5a7fa8"}),c.jsx("rect",{x:"120",y:"175",width:"20",height:"3",fill:"#5a7fa8"}),c.jsx("rect",{x:"120",y:"180",width:"20",height:"3",fill:"#5a7fa8"}),c.jsx("rect",{x:"50",y:"140",width:"18",height:"50",rx:"8",fill:"#2d3748"}),c.jsx("rect",{x:"132",y:"140",width:"18",height:"50",rx:"8",fill:"#2d3748"}),c.jsx("ellipse",{cx:"59",cy:"192",rx:"10",ry:"8",fill:"#fce4c4"}),c.jsx("ellipse",{cx:"141",cy:"192",rx:"10",ry:"8",fill:"#fce4c4"}),c.jsx("rect",{x:"75",y:"200",width:"20",height:"40",fill:"#2d3748"}),c.jsx("rect",{x:"105",y:"200",width:"20",height:"40",fill:"#2d3748"}),c.jsx("ellipse",{cx:"85",cy:"245",rx:"15",ry:"8",fill:"#1a202c"}),c.jsx("ellipse",{cx:"115",cy:"245",rx:"15",ry:"8",fill:"#1a202c"}),c.jsxs("defs",{children:[c.jsxs("linearGradient",{id:"haloGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[c.jsx("stop",{offset:"0%",stopColor:"#a8edea"}),c.jsx("stop",{offset:"50%",stopColor:"#e8d5f2"}),c.jsx("stop",{offset:"100%",stopColor:"#a8edea"})]}),c.jsxs("linearGradient",{id:"hairGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[c.jsx("stop",{offset:"0%",stopColor:"#a8edea"}),c.jsx("stop",{offset:"50%",stopColor:"#d4b8e8"}),c.jsx("stop",{offset:"100%",stopColor:"#f5d0e8"})]})]})]}),wO=({className:t="",size:e=200})=>c.jsxs("svg",{width:e,height:e,viewBox:"0 0 200 200",className:t,children:[c.jsx("ellipse",{cx:"100",cy:"15",rx:"40",ry:"7",fill:"none",stroke:"url(#pegasusHalo)",strokeWidth:"3",opacity:"0.8"}),c.jsx("g",{transform:"translate(10, 80)",children:c.jsx("path",{d:"M50 30 Q30 10 10 25 Q25 20 35 30 Q20 15 5 35 Q25 25 40 40 Q30 30 20 50 Q35 35 50 50 Z",fill:"white",stroke:"#e2e8f0",strokeWidth:"1"})}),c.jsx("g",{transform:"translate(140, 80) scale(-1, 1)",children:c.jsx("path",{d:"M50 30 Q30 10 10 25 Q25 20 35 30 Q20 15 5 35 Q25 25 40 40 Q30 30 20 50 Q35 35 50 50 Z",fill:"white",stroke:"#e2e8f0",strokeWidth:"1"})}),c.jsx("ellipse",{cx:"100",cy:"120",rx:"35",ry:"30",fill:"white",stroke:"#e2e8f0",strokeWidth:"2"}),c.jsx("path",{d:"M70 100 Q70 130 75 145 L125 145 Q130 130 130 100 Z",fill:"#7dd3fc"}),c.jsx("ellipse",{cx:"100",cy:"65",rx:"28",ry:"25",fill:"white",stroke:"#e2e8f0",strokeWidth:"2"}),c.jsx("ellipse",{cx:"78",cy:"45",rx:"8",ry:"12",fill:"white",stroke:"#e2e8f0",strokeWidth:"1"}),c.jsx("ellipse",{cx:"78",cy:"45",rx:"4",ry:"8",fill:"#fce7f3"}),c.jsx("ellipse",{cx:"122",cy:"45",rx:"8",ry:"12",fill:"white",stroke:"#e2e8f0",strokeWidth:"1"}),c.jsx("ellipse",{cx:"122",cy:"45",rx:"4",ry:"8",fill:"#fce7f3"}),c.jsx("path",{d:"M85 35 Q95 25 100 35 Q105 25 115 35",fill:"none",stroke:"white",strokeWidth:"8"}),c.jsx("circle",{cx:"88",cy:"62",r:"12",fill:"none",stroke:"#4a5568",strokeWidth:"2"}),c.jsx("circle",{cx:"112",cy:"62",r:"12",fill:"none",stroke:"#4a5568",strokeWidth:"2"}),c.jsx("line",{x1:"100",y1:"62",x2:"100",y2:"62",stroke:"#4a5568",strokeWidth:"2"}),c.jsx("line",{x1:"76",y1:"60",x2:"70",y2:"55",stroke:"#4a5568",strokeWidth:"2"}),c.jsx("line",{x1:"124",y1:"60",x2:"130",y2:"55",stroke:"#4a5568",strokeWidth:"2"}),c.jsx("circle",{cx:"88",cy:"62",r:"6",fill:"#1a202c"}),c.jsx("circle",{cx:"112",cy:"62",r:"6",fill:"#1a202c"}),c.jsx("circle",{cx:"90",cy:"60",r:"2",fill:"white"}),c.jsx("circle",{cx:"114",cy:"60",r:"2",fill:"white"}),c.jsx("ellipse",{cx:"100",cy:"75",rx:"8",ry:"5",fill:"#fce7f3"}),c.jsx("circle",{cx:"96",cy:"74",r:"2",fill:"#d1d5db"}),c.jsx("circle",{cx:"104",cy:"74",r:"2",fill:"#d1d5db"}),c.jsx("path",{d:"M92 82 Q100 88 108 82",fill:"none",stroke:"#4a5568",strokeWidth:"2"}),c.jsx("rect",{x:"80",y:"145",width:"12",height:"35",rx:"6",fill:"white",stroke:"#e2e8f0",strokeWidth:"1"}),c.jsx("rect",{x:"108",y:"145",width:"12",height:"35",rx:"6",fill:"white",stroke:"#e2e8f0",strokeWidth:"1"}),c.jsx("ellipse",{cx:"86",cy:"182",rx:"8",ry:"5",fill:"#1a202c"}),c.jsx("ellipse",{cx:"114",cy:"182",rx:"8",ry:"5",fill:"#1a202c"}),c.jsx("path",{d:"M130 130 Q150 140 145 160 Q140 150 135 155 Q145 145 140 165",fill:"none",stroke:"white",strokeWidth:"6",strokeLinecap:"round"}),c.jsx("defs",{children:c.jsxs("linearGradient",{id:"pegasusHalo",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[c.jsx("stop",{offset:"0%",stopColor:"#a8edea"}),c.jsx("stop",{offset:"50%",stopColor:"#d4b8e8"}),c.jsx("stop",{offset:"100%",stopColor:"#a8edea"})]})})]}),Q5e=({className:t="",size:e=200})=>c.jsxs("svg",{width:e,height:e*1.3,viewBox:"0 0 200 260",className:t,children:[c.jsx("ellipse",{cx:"100",cy:"15",rx:"45",ry:"8",fill:"none",stroke:"url(#girlHalo)",strokeWidth:"3",opacity:"0.8"}),c.jsx("ellipse",{cx:"100",cy:"70",rx:"55",ry:"50",fill:"url(#girlHairGradient)"}),c.jsx("circle",{cx:"55",cy:"55",r:"20",fill:"url(#girlHairGradient)"}),c.jsx("circle",{cx:"145",cy:"55",r:"20",fill:"url(#girlHairGradient)"}),c.jsx("circle",{cx:"45",cy:"80",r:"18",fill:"url(#girlHairGradient)"}),c.jsx("circle",{cx:"155",cy:"80",r:"18",fill:"url(#girlHairGradient)"}),c.jsx("circle",{cx:"50",cy:"110",r:"15",fill:"url(#girlHairGradient)"}),c.jsx("circle",{cx:"150",cy:"110",r:"15",fill:"url(#girlHairGradient)"}),c.jsx("circle",{cx:"60",cy:"130",r:"12",fill:"url(#girlHairGradient)"}),c.jsx("circle",{cx:"140",cy:"130",r:"12",fill:"url(#girlHairGradient)"}),c.jsx("ellipse",{cx:"100",cy:"90",rx:"35",ry:"38",fill:"#fce4c4"}),c.jsx("ellipse",{cx:"82",cy:"85",rx:"12",ry:"14",fill:"white"}),c.jsx("ellipse",{cx:"118",cy:"85",rx:"12",ry:"14",fill:"white"}),c.jsx("circle",{cx:"82",cy:"88",r:"8",fill:"#4a5568"}),c.jsx("circle",{cx:"118",cy:"88",r:"8",fill:"#4a5568"}),c.jsx("circle",{cx:"85",cy:"85",r:"3",fill:"white"}),c.jsx("circle",{cx:"121",cy:"85",r:"3",fill:"white"}),c.jsx("path",{d:"M70 72 Q82 68 90 72",fill:"none",stroke:"#9ca3af",strokeWidth:"2"}),c.jsx("path",{d:"M110 72 Q118 68 130 72",fill:"none",stroke:"#9ca3af",strokeWidth:"2"}),c.jsx("ellipse",{cx:"100",cy:"98",rx:"3",ry:"2",fill:"#e8c4a8"}),c.jsx("ellipse",{cx:"100",cy:"110",rx:"6",ry:"4",fill:"#f5a5a5"}),c.jsx("path",{d:"M94 108 Q100 106 106 108",fill:"none",stroke:"#e88a8a",strokeWidth:"1"}),c.jsx("path",{d:"M75 140 L100 160 L125 140",fill:"white"}),c.jsx("circle",{cx:"100",cy:"148",r:"4",fill:"#a8edea"}),c.jsx("path",{d:"M88 152 L100 158 L88 164 Z",fill:"#a8edea"}),c.jsx("path",{d:"M112 152 L100 158 L112 164 Z",fill:"#a8edea"}),c.jsx("circle",{cx:"100",cy:"158",r:"3",fill:"#7dd3fc"}),c.jsx("path",{d:"M70 145 Q55 200 65 240 L135 240 Q145 200 130 145 Z",fill:"#2d3748"}),c.jsx("path",{d:"M70 145 Q100 155 130 145 L125 160 Q100 165 75 160 Z",fill:"#2d3748"}),c.jsx("path",{d:"M55 155 Q45 180 50 200",fill:"none",stroke:"#2d3748",strokeWidth:"18",strokeLinecap:"round"}),c.jsx("path",{d:"M145 155 Q155 180 150 200",fill:"none",stroke:"#2d3748",strokeWidth:"18",strokeLinecap:"round"}),c.jsx("ellipse",{cx:"50",cy:"205",rx:"10",ry:"8",fill:"#fce4c4"}),c.jsx("ellipse",{cx:"150",cy:"205",rx:"10",ry:"8",fill:"#fce4c4"}),c.jsx("rect",{x:"80",y:"235",width:"15",height:"15",fill:"#fce4c4"}),c.jsx("rect",{x:"105",y:"235",width:"15",height:"15",fill:"#fce4c4"}),c.jsx("ellipse",{cx:"87",cy:"252",rx:"12",ry:"6",fill:"#2d3748"}),c.jsx("ellipse",{cx:"113",cy:"252",rx:"12",ry:"6",fill:"#2d3748"}),c.jsxs("defs",{children:[c.jsxs("linearGradient",{id:"girlHalo",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[c.jsx("stop",{offset:"0%",stopColor:"#a8edea"}),c.jsx("stop",{offset:"50%",stopColor:"#e8d5f2"}),c.jsx("stop",{offset:"100%",stopColor:"#a8edea"})]}),c.jsxs("linearGradient",{id:"girlHairGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[c.jsx("stop",{offset:"0%",stopColor:"#a8edea"}),c.jsx("stop",{offset:"30%",stopColor:"#c4b5e8"}),c.jsx("stop",{offset:"70%",stopColor:"#e8c5d8"}),c.jsx("stop",{offset:"100%",stopColor:"#a8edea"})]})]})]}),q_=({children:t,className:e="",delay:r=0})=>c.jsx("div",{className:`animate-bounce ${e}`,style:{animationDuration:"3s",animationDelay:`${r}s`,animationTimingFunction:"ease-in-out"},children:t}),Z5e=()=>{const{language:t,setLanguage:e,languages:r}=ag(),[a,l]=V.useState(!1);V.useEffect(()=>{const m=localStorage.getItem("synclulu-language");m&&["de","en","es","fr","pt"].includes(m)&&e(m)},[]);const u={de:{tagline:"Connect in the Clouds",subtitle:"Echte Begegnungen in deiner Nachbarschaft.",highlight:"Hyperlokal. Anonym. Algorithmus-frei.",start:"Jetzt starten",login:"Ich habe schon einen Account",radius:"Max 500m Radius",mode:"Anonym oder Offen",privacy:"Privacy First"},en:{tagline:"Connect in the Clouds",subtitle:"Real connections in your neighborhood.",highlight:"Hyperlocal. Anonymous. Algorithm-free.",start:"Get Started",login:"I already have an account",radius:"Max 500m Radius",mode:"Anonymous or Public",privacy:"Privacy First"},es:{tagline:"Conecta en las Nubes",subtitle:"Encuentros reales en tu vecindario.",highlight:"Hiperlocal. Annimo. Sin algoritmos.",start:"Comenzar",login:"Ya tengo una cuenta",radius:"Radio mx. 500m",mode:"Annimo o Pblico",privacy:"Privacidad Primero"},fr:{tagline:"Connectez dans les Nuages",subtitle:"De vraies rencontres dans votre quartier.",highlight:"Hyperlocal. Anonyme. Sans algorithme.",start:"Commencer",login:"J'ai dj un compte",radius:"Rayon max. 500m",mode:"Anonyme ou Public",privacy:"Confidentialit"},pt:{tagline:"Conecte nas Nuvens",subtitle:"Encontros reais no seu bairro.",highlight:"Hiperlocal. Annimo. Sem algoritmos.",start:"Comear",login:"J tenho uma conta",radius:"Raio mx. 500m",mode:"Annimo ou Pblico",privacy:"Privacidade"}},p=u[t]||u.de;return c.jsxs("div",{className:"min-h-screen min-h-[100dvh] bg-gradient-to-b from-violet-50 via-white to-purple-50 flex flex-col items-center justify-center px-6 py-12 relative overflow-hidden",children:[c.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[c.jsx("div",{className:"absolute top-10 right-10 w-72 h-72 bg-gradient-to-br from-violet-300/30 to-purple-400/20 rounded-full blur-3xl animate-pulse"}),c.jsx("div",{className:"absolute bottom-20 left-5 w-64 h-64 bg-gradient-to-tr from-pink-300/25 to-violet-300/20 rounded-full blur-3xl animate-pulse",style:{animationDelay:"1s"}}),c.jsx("div",{className:"absolute top-1/3 left-1/4 w-48 h-48 bg-gradient-to-r from-blue-200/20 to-purple-200/20 rounded-full blur-2xl animate-pulse",style:{animationDelay:"2s"}}),c.jsx("div",{className:"absolute top-20 left-10 text-4xl opacity-20 animate-bounce",style:{animationDuration:"3s"},children:""}),c.jsx("div",{className:"absolute top-40 right-20 text-3xl opacity-15 animate-bounce",style:{animationDuration:"4s",animationDelay:"0.5s"},children:""}),c.jsx("div",{className:"absolute bottom-40 left-20 text-2xl opacity-10 animate-bounce",style:{animationDuration:"3.5s",animationDelay:"1s"},children:""}),c.jsx("div",{className:"absolute bottom-10 left-4 opacity-40 hidden sm:block",children:c.jsx(q_,{delay:.5,children:c.jsx(Q5e,{size:100})})})]}),c.jsxs("div",{className:"absolute top-6 right-6 z-20",children:[c.jsxs("button",{onClick:()=>l(!a),className:"flex items-center gap-2 px-4 py-2 bg-white/80 backdrop-blur-sm rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-all",children:[c.jsx("span",{className:"text-lg",children:r[t].flag}),c.jsx("span",{className:"text-sm font-medium text-gray-700",children:r[t].native}),c.jsx(xW,{size:16,className:`text-gray-400 transition-transform ${a?"rotate-180":""}`})]}),a&&c.jsx("div",{className:"absolute top-full right-0 mt-2 bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden min-w-[180px] animate-fade-in",children:Object.entries(r).map(([m,v])=>c.jsxs("button",{onClick:()=>{e(m),l(!1)},className:`w-full px-4 py-3 flex items-center gap-3 hover:bg-violet-50 transition-colors ${t===m?"bg-violet-100":""}`,children:[c.jsx("span",{className:"text-xl",children:v.flag}),c.jsx("span",{className:"font-medium text-gray-800",children:v.native}),t===m&&c.jsx("span",{className:"ml-auto text-violet-600",children:""})]},m))})]}),c.jsxs("div",{className:"relative z-10 text-center max-w-sm",children:[c.jsxs("div",{className:"relative mb-10",children:[c.jsx("div",{className:"absolute inset-0 w-32 h-32 mx-auto bg-violet-400/40 rounded-3xl blur-2xl"}),c.jsx("div",{className:"relative w-32 h-32 mx-auto rounded-3xl bg-gradient-to-br from-violet-500 via-purple-500 to-violet-600 flex items-center justify-center shadow-2xl shadow-violet-500/30",children:c.jsx("span",{className:"text-6xl drop-shadow-lg",children:""})})]}),c.jsx("h1",{className:"font-display text-6xl font-bold mb-3 tracking-tight",children:c.jsx("span",{className:"bg-gradient-to-r from-violet-600 via-purple-600 to-violet-700 bg-clip-text text-transparent",children:"synclulu"})}),c.jsx("p",{className:"text-gray-800 text-xl font-display font-semibold mb-3",children:p.tagline}),c.jsxs("p",{className:"text-gray-500 mb-10 leading-relaxed",children:[p.subtitle,c.jsx("br",{}),c.jsx("span",{className:"font-semibold text-gray-700",children:p.highlight})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsx(Ju,{to:"/register",className:"block w-full py-4 bg-gradient-to-r from-violet-600 to-purple-600 text-white font-display font-bold text-center rounded-2xl shadow-lg shadow-violet-500/30 hover:shadow-xl hover:shadow-violet-500/40 transition-all transform hover:scale-[1.02]",children:p.start}),c.jsx(Ju,{to:"/login",className:"block w-full py-4 text-violet-600 font-display font-semibold text-center border-2 border-violet-200 rounded-2xl hover:border-violet-400 hover:bg-violet-50 transition-all",children:p.login})]}),c.jsxs("div",{className:"mt-12 grid grid-cols-3 gap-3",children:[c.jsxs("div",{className:"bg-white/60 backdrop-blur-sm rounded-2xl p-4 shadow-sm border border-gray-100",children:[c.jsx("div",{className:"text-2xl mb-2",children:""}),c.jsx("p",{className:"text-[11px] text-gray-600 font-medium leading-tight",children:p.radius})]}),c.jsxs("div",{className:"bg-white/60 backdrop-blur-sm rounded-2xl p-4 shadow-sm border border-gray-100",children:[c.jsx("div",{className:"text-2xl mb-2",children:""}),c.jsx("p",{className:"text-[11px] text-gray-600 font-medium leading-tight",children:p.mode})]}),c.jsxs("div",{className:"bg-white/60 backdrop-blur-sm rounded-2xl p-4 shadow-sm border border-gray-100",children:[c.jsx("div",{className:"text-2xl mb-2",children:""}),c.jsx("p",{className:"text-[11px] text-gray-600 font-medium leading-tight",children:p.privacy})]})]})]}),a&&c.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>l(!1)})]})},eUe=()=>{const[t,e]=V.useState(""),[r,a]=V.useState(""),[l,u]=V.useState(!1),[p,m]=V.useState(""),[v,w]=V.useState(!1),[R,C]=V.useState(!1),[A,O]=V.useState(!1),{signIn:U,signInWithGoogle:F,resetPassword:q}=qv(),W=yr(),H=async te=>{te.preventDefault(),m(""),w(!0);const he=await U(t,r);he.success?W("/"):m(he.error||"Login fehlgeschlagen"),w(!1)},X=async()=>{m(""),w(!0);const te=await F();te.success?W("/"):m(te.error||"Google Login fehlgeschlagen"),w(!1)},ne=async te=>{if(te.preventDefault(),m(""),w(!0),!t){m("Bitte gib deine E-Mail-Adresse ein"),w(!1);return}const he=await q(t);he.success?O(!0):m(he.error||"Fehler beim Zurcksetzen"),w(!1)};return R?c.jsxs("div",{className:"min-h-screen min-h-[100dvh] bg-[var(--synclulu-bg)] px-6 py-8 safe-top",children:[c.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[c.jsx("button",{onClick:()=>{C(!1),O(!1),m("")},className:"w-10 h-10 rounded-xl bg-[var(--synclulu-card)] flex items-center justify-center shadow-sm",children:c.jsx(Eo,{size:20,className:"text-[var(--synclulu-text)]"})}),c.jsx("h1",{className:"font-display text-2xl font-bold text-[var(--synclulu-text)]",children:"Passwort vergessen"})]}),A?c.jsxs("div",{className:"glass-card p-6 text-center",children:[c.jsx("div",{className:"w-16 h-16 mx-auto rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center mb-4",children:c.jsx(Sm,{size:32,className:"text-green-600 dark:text-green-400"})}),c.jsx("h2",{className:"font-display text-xl font-bold text-[var(--synclulu-text)] mb-2",children:"E-Mail gesendet!"}),c.jsxs("p",{className:"text-[var(--synclulu-muted)] mb-6",children:["Wir haben dir eine E-Mail an ",c.jsx("strong",{children:t})," gesendet. Folge dem Link in der E-Mail, um dein Passwort zurckzusetzen."]}),c.jsx("p",{className:"text-sm text-[var(--synclulu-muted)] mb-6",children:"Keine E-Mail erhalten? berprfe deinen Spam-Ordner oder versuche es erneut."}),c.jsx("button",{onClick:()=>{C(!1),O(!1)},className:"btn-primary w-full py-4 text-white font-display font-bold",children:"Zurck zum Login"})]}):c.jsxs("div",{className:"glass-card p-6",children:[c.jsx("p",{className:"text-[var(--synclulu-muted)] mb-6",children:"Gib deine E-Mail-Adresse ein und wir senden dir einen Link zum Zurcksetzen deines Passworts."}),c.jsxs("form",{onSubmit:ne,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-[var(--synclulu-muted)] mb-2",children:"E-Mail"}),c.jsxs("div",{className:"relative",children:[c.jsx(c0,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-[var(--synclulu-muted)]"}),c.jsx("input",{type:"email",value:t,onChange:te=>e(te.target.value),placeholder:"deine@email.de",required:!0,className:"w-full pl-12 pr-4 py-3 bg-[var(--synclulu-card)] border-2 border-[var(--synclulu-border)] rounded-xl focus:border-[var(--synclulu-violet)] focus:outline-none transition-colors text-[var(--synclulu-text)]"})]})]}),p&&c.jsx("p",{className:"text-red-500 text-sm text-center",children:p}),c.jsx("button",{type:"submit",disabled:v,className:"btn-primary w-full py-4 text-white font-display font-bold disabled:opacity-70",children:v?"Wird gesendet...":"Link senden"})]})]})]}):c.jsxs("div",{className:"min-h-screen min-h-[100dvh] bg-[var(--synclulu-bg)] px-6 py-8 safe-top",children:[c.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[c.jsx(Ju,{to:"/",className:"w-10 h-10 rounded-xl bg-[var(--synclulu-card)] flex items-center justify-center shadow-sm",children:c.jsx(Eo,{size:20,className:"text-[var(--synclulu-text)]"})}),c.jsx("h1",{className:"font-display text-2xl font-bold text-[var(--synclulu-text)]",children:"Login"})]}),c.jsx("div",{className:"flex justify-center mb-4",children:c.jsx(q_,{delay:0,children:c.jsx(wO,{size:100})})}),c.jsx("div",{className:"glass-card p-6 mb-6",children:c.jsxs("form",{onSubmit:H,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-[var(--synclulu-muted)] mb-2",children:"E-Mail"}),c.jsxs("div",{className:"relative",children:[c.jsx(c0,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-[var(--synclulu-muted)]"}),c.jsx("input",{type:"email",value:t,onChange:te=>e(te.target.value),placeholder:"deine@email.de",required:!0,className:"w-full pl-12 pr-4 py-3 bg-[var(--synclulu-card)] border-2 border-[var(--synclulu-border)] rounded-xl focus:border-[var(--synclulu-violet)] focus:outline-none transition-colors text-[var(--synclulu-text)]"})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("label",{className:"block text-sm font-medium text-[var(--synclulu-muted)]",children:"Passwort"}),c.jsx("button",{type:"button",onClick:()=>C(!0),className:"text-sm text-[var(--synclulu-violet)] font-medium hover:underline",children:"Passwort vergessen?"})]}),c.jsxs("div",{className:"relative",children:[c.jsx(yo,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-[var(--synclulu-muted)]"}),c.jsx("input",{type:l?"text":"password",value:r,onChange:te=>a(te.target.value),placeholder:"",required:!0,className:"w-full pl-12 pr-12 py-3 bg-[var(--synclulu-card)] border-2 border-[var(--synclulu-border)] rounded-xl focus:border-[var(--synclulu-violet)] focus:outline-none transition-colors text-[var(--synclulu-text)]"}),c.jsx("button",{type:"button",onClick:()=>u(!l),className:"absolute right-4 top-1/2 -translate-y-1/2 text-[var(--synclulu-muted)]",children:l?c.jsx(lp,{size:18}):c.jsx(Pl,{size:18})})]})]}),p&&c.jsx("p",{className:"text-red-500 text-sm text-center",children:p}),c.jsx("button",{type:"submit",disabled:v,className:"btn-primary w-full py-4 text-white font-display font-bold disabled:opacity-70",children:v?"Wird eingeloggt...":"Login"})]})}),c.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[c.jsx("div",{className:"flex-1 h-px bg-[var(--synclulu-border)]"}),c.jsx("span",{className:"text-sm text-[var(--synclulu-muted)]",children:"oder"}),c.jsx("div",{className:"flex-1 h-px bg-[var(--synclulu-border)]"})]}),c.jsx("div",{className:"space-y-3",children:c.jsxs("button",{onClick:X,disabled:v,className:"w-full py-4 bg-[var(--synclulu-card)] border-2 border-[var(--synclulu-border)] rounded-xl font-medium flex items-center justify-center gap-3 hover:border-[var(--synclulu-violet)] transition-colors disabled:opacity-70 text-[var(--synclulu-text)]",children:[c.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",children:[c.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),c.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),c.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),c.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Mit Google anmelden"]})}),c.jsxs("p",{className:"text-center text-[var(--synclulu-muted)] mt-8",children:["Noch kein Account?"," ",c.jsx(Ju,{to:"/register",className:"text-[var(--synclulu-violet)] font-semibold",children:"Registrieren"})]})]})};var SO={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */SO.exports;(function(t,e){(function(){var r,a="4.17.23",l=200,u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",p="Expected a function",m="Invalid `variable` option passed into `_.template`",v="__lodash_hash_undefined__",w=500,R="__lodash_placeholder__",C=1,A=2,O=4,U=1,F=2,q=1,W=2,H=4,X=8,ne=16,te=32,he=64,J=128,Q=256,ce=512,de=30,pe="...",be=800,ye=16,Ze=1,It=2,St=3,lt=1/0,Le=9007199254740991,Me=17976931348623157e292,Ke=NaN,Rt=4294967295,rt=Rt-1,mt=Rt>>>1,yt=[["ary",J],["bind",q],["bindKey",W],["curry",X],["curryRight",ne],["flip",ce],["partial",te],["partialRight",he],["rearg",Q]],Ct="[object Arguments]",Ot="[object Array]",vt="[object AsyncFunction]",zt="[object Boolean]",ln="[object Date]",Pn="[object DOMException]",ni="[object Error]",pr="[object Function]",nn="[object GeneratorFunction]",ri="[object Map]",un="[object Number]",ui="[object Null]",Cs="[object Object]",Jn="[object Promise]",ds="[object Proxy]",Ra="[object RegExp]",us="[object Set]",ro="[object String]",Fa="[object Symbol]",hi="[object Undefined]",So="[object WeakMap]",Ri="[object WeakSet]",Gr="[object ArrayBuffer]",Ca="[object DataView]",Ac="[object Float32Array]",kc="[object Float64Array]",Pc="[object Int8Array]",Ba="[object Int16Array]",Dc="[object Int32Array]",ia="[object Uint8Array]",Lt="[object Uint8ClampedArray]",Ir="[object Uint16Array]",We="[object Uint32Array]",$t=/\b__p \+= '';/g,tr=/\b(__p \+=) '' \+/g,mi=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Wr=/&(?:amp|lt|gt|quot|#39);/g,Nn=/[&<>"']/g,Ci=RegExp(Wr.source),Ar=RegExp(Nn.source),lr=/<%-([\s\S]+?)%>/g,Qi=/<%([\s\S]+?)%>/g,sh=/<%=([\s\S]+?)%>/g,ol=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,pp=/^\w*$/,gi=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,fp=/[\\^$.*+?()[\]{}|]/g,ah=RegExp(fp.source),ec=/^\s+/,tc=/\s/,vn=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Ll=/\{\n\/\* \[wrapped with (.+)\] \*/,og=/,? & /,Of=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,nu=/[()=,{}\[\]\/\s]/,mp=/\\(\\)?/g,gp=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Oc=/\w*$/,Lc=/^[-+]0x[0-9a-f]+$/i,Lf=/^0b[01]+$/i,_p=/^\[object .+?Constructor\]$/,yp=/^0o[0-7]+$/i,jl=/^(?:0|[1-9]\d*)$/,jf=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,oh=/($^)/,io=/['\n\r\u2028\u2029\\]/g,gd="\\ud800-\\udfff",cg="\\u0300-\\u036f",Zi="\\ufe20-\\ufe2f",ch="\\u20d0-\\u20ff",Ml=cg+Zi+ch,ru="\\u2700-\\u27bf",iu="a-z\\xdf-\\xf6\\xf8-\\xff",lh="\\xac\\xb1\\xd7\\xf7",Mf="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",_d="\\u2000-\\u206f",Vr=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ni="A-Z\\xc0-\\xd6\\xd8-\\xde",su="\\ufe0e\\ufe0f",so=lh+Mf+_d+Vr,jc="[']",Uf="["+gd+"]",Zt="["+so+"]",Oi="["+Ml+"]",dh="\\d+",nc="["+ru+"]",hs="["+iu+"]",uh="[^"+gd+so+dh+ru+iu+Ni+"]",cl="\\ud83c[\\udffb-\\udfff]",Ul="(?:"+Oi+"|"+cl+")",qn="[^"+gd+"]",To="(?:\\ud83c[\\udde6-\\uddff]){2}",ao="[\\ud800-\\udbff][\\udc00-\\udfff]",Na="["+Ni+"]",au="\\u200d",yd="(?:"+hs+"|"+uh+")",hh="(?:"+Na+"|"+uh+")",vp="(?:"+jc+"(?:d|ll|m|re|s|t|ve))?",ou="(?:"+jc+"(?:D|LL|M|RE|S|T|VE))?",Ep=Ul+"?",Vl="["+su+"]?",rc="(?:"+au+"(?:"+[qn,To,ao].join("|")+")"+Vl+Ep+")*",Vf="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",xp="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ff=Vl+Ep+rc,Dn="(?:"+[nc,To,ao].join("|")+")"+Ff,Mc="(?:"+[qn+Oi+"?",Oi,To,ao,Uf].join("|")+")",Ei=RegExp(jc,"g"),lg=RegExp(Oi,"g"),Ro=RegExp(cl+"(?="+cl+")|"+Mc+Ff,"g"),Bf=RegExp([Na+"?"+hs+"+"+vp+"(?="+[Zt,Na,"$"].join("|")+")",hh+"+"+ou+"(?="+[Zt,Na+yd,"$"].join("|")+")",Na+"?"+yd+"+"+vp,Na+"+"+ou,xp,Vf,dh,Dn].join("|"),"g"),vd=RegExp("["+au+gd+Ml+su+"]"),Uc=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,cu=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],lu=-1,Yn={};Yn[Ac]=Yn[kc]=Yn[Pc]=Yn[Ba]=Yn[Dc]=Yn[ia]=Yn[Lt]=Yn[Ir]=Yn[We]=!0,Yn[Ct]=Yn[Ot]=Yn[Gr]=Yn[zt]=Yn[Ca]=Yn[ln]=Yn[ni]=Yn[pr]=Yn[ri]=Yn[un]=Yn[Cs]=Yn[Ra]=Yn[us]=Yn[ro]=Yn[So]=!1;var vr={};vr[Ct]=vr[Ot]=vr[Gr]=vr[Ca]=vr[zt]=vr[ln]=vr[Ac]=vr[kc]=vr[Pc]=vr[Ba]=vr[Dc]=vr[ri]=vr[un]=vr[Cs]=vr[Ra]=vr[us]=vr[ro]=vr[Fa]=vr[ia]=vr[Lt]=vr[Ir]=vr[We]=!0,vr[ni]=vr[pr]=vr[So]=!1;var zf={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},bp={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},es={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},ll={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},za=parseFloat,Gf=parseInt,wp=typeof _f=="object"&&_f&&_f.Object===Object&&_f,kr=typeof self=="object"&&self&&self.Object===Object&&self,xs=wp||kr||Function("return this")(),_i=e&&!e.nodeType&&e,Ns=_i&&!0&&t&&!t.nodeType&&t,Sp=Ns&&Ns.exports===_i,Wf=Sp&&wp.process,ps=function(){try{var Ve=Ns&&Ns.require&&Ns.require("util").types;return Ve||Wf&&Wf.binding&&Wf.binding("util")}catch{}}(),Tp=ps&&ps.isArrayBuffer,ph=ps&&ps.isDate,Ed=ps&&ps.isMap,Hf=ps&&ps.isRegExp,dl=ps&&ps.isSet,Rp=ps&&ps.isTypedArray;function Li(Ve,ut,st){switch(st.length){case 0:return Ve.call(ut);case 1:return Ve.call(ut,st[0]);case 2:return Ve.call(ut,st[0],st[1]);case 3:return Ve.call(ut,st[0],st[1],st[2])}return Ve.apply(ut,st)}function fh(Ve,ut,st,en){for(var Zn=-1,si=Ve==null?0:Ve.length;++Zn<si;){var aa=Ve[Zn];ut(en,aa,st(aa),Ve)}return en}function Ga(Ve,ut){for(var st=-1,en=Ve==null?0:Ve.length;++st<en&&ut(Ve[st],st,Ve)!==!1;);return Ve}function Ia(Ve,ut){for(var st=Ve==null?0:Ve.length;st--&&ut(Ve[st],st,Ve)!==!1;);return Ve}function ul(Ve,ut){for(var st=-1,en=Ve==null?0:Ve.length;++st<en;)if(!ut(Ve[st],st,Ve))return!1;return!0}function ic(Ve,ut){for(var st=-1,en=Ve==null?0:Ve.length,Zn=0,si=[];++st<en;){var aa=Ve[st];ut(aa,st,Ve)&&(si[Zn++]=aa)}return si}function xd(Ve,ut){var st=Ve==null?0:Ve.length;return!!st&&bd(Ve,ut,0)>-1}function du(Ve,ut,st){for(var en=-1,Zn=Ve==null?0:Ve.length;++en<Zn;)if(st(ut,Ve[en]))return!0;return!1}function Ii(Ve,ut){for(var st=-1,en=Ve==null?0:Ve.length,Zn=Array(en);++st<en;)Zn[st]=ut(Ve[st],st,Ve);return Zn}function Vc(Ve,ut){for(var st=-1,en=ut.length,Zn=Ve.length;++st<en;)Ve[Zn+st]=ut[st];return Ve}function Wa(Ve,ut,st,en){var Zn=-1,si=Ve==null?0:Ve.length;for(en&&si&&(st=Ve[++Zn]);++Zn<si;)st=ut(st,Ve[Zn],Zn,Ve);return st}function dg(Ve,ut,st,en){var Zn=Ve==null?0:Ve.length;for(en&&Zn&&(st=Ve[--Zn]);Zn--;)st=ut(st,Ve[Zn],Zn,Ve);return st}function sc(Ve,ut){for(var st=-1,en=Ve==null?0:Ve.length;++st<en;)if(ut(Ve[st],st,Ve))return!0;return!1}var Kf=le("length");function qf(Ve){return Ve.split("")}function In(Ve){return Ve.match(Of)||[]}function sa(Ve,ut,st){var en;return st(Ve,function(Zn,si,aa){if(ut(Zn,si,aa))return en=si,!1}),en}function ac(Ve,ut,st,en){for(var Zn=Ve.length,si=st+(en?1:-1);en?si--:++si<Zn;)if(ut(Ve[si],si,Ve))return si;return-1}function bd(Ve,ut,st){return ut===ut?Np(Ve,ut,st):ac(Ve,k,st)}function Fc(Ve,ut,st,en){for(var Zn=st-1,si=Ve.length;++Zn<si;)if(en(Ve[Zn],ut))return Zn;return-1}function k(Ve){return Ve!==Ve}function ee(Ve,ut){var st=Ve==null?0:Ve.length;return st?Ut(Ve,ut)/st:Ke}function le(Ve){return function(ut){return ut==null?r:ut[Ve]}}function Se(Ve){return function(ut){return Ve==null?r:Ve[ut]}}function He(Ve,ut,st,en,Zn){return Zn(Ve,function(si,aa,xi){st=en?(en=!1,si):ut(st,si,aa,xi)}),st}function ct(Ve,ut){var st=Ve.length;for(Ve.sort(ut);st--;)Ve[st]=Ve[st].value;return Ve}function Ut(Ve,ut){for(var st,en=-1,Zn=Ve.length;++en<Zn;){var si=ut(Ve[en]);si!==r&&(st=st===r?si:st+si)}return st}function ii(Ve,ut){for(var st=-1,en=Array(Ve);++st<Ve;)en[st]=ut(st);return en}function Bs(Ve,ut){return Ii(ut,function(st){return[st,Ve[st]]})}function sr(Ve){return Ve&&Ve.slice(0,S0(Ve)+1).replace(ec,"")}function fr(Ve){return function(ut){return Ve(ut)}}function Bi(Ve,ut){return Ii(ut,function(st){return Ve[st]})}function Bc(Ve,ut){return Ve.has(ut)}function fs(Ve,ut){for(var st=-1,en=Ve.length;++st<en&&bd(ut,Ve[st],0)>-1;);return st}function wd(Ve,ut){for(var st=Ve.length;st--&&bd(ut,Ve[st],0)>-1;);return st}function Fl(Ve,ut){for(var st=Ve.length,en=0;st--;)Ve[st]===ut&&++en;return en}var iS=Se(zf),Yf=Se(bp);function Co(Ve){return"\\"+ll[Ve]}function ug(Ve,ut){return Ve==null?r:Ve[ut]}function Cp(Ve){return vd.test(Ve)}function uu(Ve){return Uc.test(Ve)}function hg(Ve){for(var ut,st=[];!(ut=Ve.next()).done;)st.push(ut.value);return st}function $f(Ve){var ut=-1,st=Array(Ve.size);return Ve.forEach(function(en,Zn){st[++ut]=[Zn,en]}),st}function pg(Ve,ut){return function(st){return Ve(ut(st))}}function hu(Ve,ut){for(var st=-1,en=Ve.length,Zn=0,si=[];++st<en;){var aa=Ve[st];(aa===ut||aa===R)&&(Ve[st]=R,si[Zn++]=st)}return si}function oc(Ve){var ut=-1,st=Array(Ve.size);return Ve.forEach(function(en){st[++ut]=en}),st}function w0(Ve){var ut=-1,st=Array(Ve.size);return Ve.forEach(function(en){st[++ut]=[en,en]}),st}function Np(Ve,ut,st){for(var en=st-1,Zn=Ve.length;++en<Zn;)if(Ve[en]===ut)return en;return-1}function sS(Ve,ut,st){for(var en=st+1;en--;)if(Ve[en]===ut)return en;return en}function Aa(Ve){return Cp(Ve)?hl(Ve):Kf(Ve)}function No(Ve){return Cp(Ve)?R0(Ve):qf(Ve)}function S0(Ve){for(var ut=Ve.length;ut--&&tc.test(Ve.charAt(ut)););return ut}var T0=Se(es);function hl(Ve){for(var ut=Ro.lastIndex=0;Ro.test(Ve);)++ut;return ut}function R0(Ve){return Ve.match(Ro)||[]}function fg(Ve){return Ve.match(Bf)||[]}var zs=function Ve(ut){ut=ut==null?xs:Sd.defaults(xs.Object(),ut,Sd.pick(xs,cu));var st=ut.Array,en=ut.Date,Zn=ut.Error,si=ut.Function,aa=ut.Math,xi=ut.Object,C0=ut.RegExp,Bl=ut.String,ka=ut.TypeError,Ip=st.prototype,mg=si.prototype,Ge=xi.prototype,Xf=ut["__core-js_shared__"],gg=mg.toString,Hr=Ge.hasOwnProperty,aS=0,pu=function(){var E=/[^.]+$/.exec(Xf&&Xf.keys&&Xf.keys.IE_PROTO||"");return E?"Symbol(src)_1."+E:""}(),Ap=Ge.toString,Yv=gg.call(xi),oS=xs._,Td=C0("^"+gg.call(Hr).replace(fp,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),fu=Sp?ut.Buffer:r,cc=ut.Symbol,mu=ut.Uint8Array,$v=fu?fu.allocUnsafe:r,zl=pg(xi.getPrototypeOf,xi),gu=xi.create,kp=Ge.propertyIsEnumerable,Jf=Ip.splice,Xv=cc?cc.isConcatSpreadable:r,Pp=cc?cc.iterator:r,_u=cc?cc.toStringTag:r,mh=function(){try{var E=Bp(xi,"defineProperty");return E({},"",{}),E}catch{}}(),Jv=ut.clearTimeout!==xs.clearTimeout&&ut.clearTimeout,N0=en&&en.now!==xs.Date.now&&en.now,lc=ut.setTimeout!==xs.setTimeout&&ut.setTimeout,Qf=aa.ceil,Rd=aa.floor,I0=xi.getOwnPropertySymbols,_=fu?fu.isBuffer:r,S=ut.isFinite,P=Ip.join,G=pg(xi.keys,xi),ae=aa.max,ge=aa.min,ke=en.now,Xe=ut.parseInt,nt=aa.random,Tt=Ip.reverse,Jt=Bp(ut,"DataView"),Tn=Bp(ut,"Map"),nr=Bp(ut,"Promise"),Gs=Bp(ut,"Set"),bs=Bp(ut,"WeakMap"),Ha=Bp(xi,"create"),Pa=bs&&new bs,pl={},Qv=bh(Jt),A0=bh(Tn),cS=bh(nr),_g=bh(Gs),lS=bh(bs),Zf=cc?cc.prototype:r,ts=Zf?Zf.valueOf:r,em=Zf?Zf.toString:r;function xe(E){if(Hs(E)&&!ar(E)&&!(E instanceof Pr)){if(E instanceof Io)return E;if(Hr.call(E,"__wrapped__"))return uA(E)}return new Io(E)}var Dp=function(){function E(){}return function(T){if(!ns(T))return{};if(gu)return gu(T);E.prototype=T;var j=new E;return E.prototype=r,j}}();function yg(){}function Io(E,T){this.__wrapped__=E,this.__actions__=[],this.__chain__=!!T,this.__index__=0,this.__values__=r}xe.templateSettings={escape:lr,evaluate:Qi,interpolate:sh,variable:"",imports:{_:xe}},xe.prototype=yg.prototype,xe.prototype.constructor=xe,Io.prototype=Dp(yg.prototype),Io.prototype.constructor=Io;function Pr(E){this.__wrapped__=E,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Rt,this.__views__=[]}function dS(){var E=new Pr(this.__wrapped__);return E.__actions__=dc(this.__actions__),E.__dir__=this.__dir__,E.__filtered__=this.__filtered__,E.__iteratees__=dc(this.__iteratees__),E.__takeCount__=this.__takeCount__,E.__views__=dc(this.__views__),E}function aj(){if(this.__filtered__){var E=new Pr(this);E.__dir__=-1,E.__filtered__=!0}else E=this.clone(),E.__dir__*=-1;return E}function Zv(){var E=this.__wrapped__.value(),T=this.__dir__,j=ar(E),Z=T<0,me=j?E.length:0,we=rA(0,me,this.__views__),Ae=we.start,Oe=we.end,ze=Oe-Ae,gt=Z?Oe:Ae-1,bt=this.__iteratees__,At=bt.length,Gt=0,En=ge(ze,this.__takeCount__);if(!j||!Z&&me==ze&&En==ze)return Sg(E,this.__actions__);var Ln=[];e:for(;ze--&&Gt<En;){gt+=T;for(var jn=-1,Gn=E[gt];++jn<At;){var Fr=bt[jn],Br=Fr.iteratee,co=Fr.type,lo=Br(Gn);if(co==It)Gn=lo;else if(!lo){if(co==Ze)continue e;break e}}Ln[Gt++]=Gn}return Ln}Pr.prototype=Dp(yg.prototype),Pr.prototype.constructor=Pr;function yu(E){var T=-1,j=E==null?0:E.length;for(this.clear();++T<j;){var Z=E[T];this.set(Z[0],Z[1])}}function uS(){this.__data__=Ha?Ha(null):{},this.size=0}function oj(E){var T=this.has(E)&&delete this.__data__[E];return this.size-=T?1:0,T}function cj(E){var T=this.__data__;if(Ha){var j=T[E];return j===v?r:j}return Hr.call(T,E)?T[E]:r}function lj(E){var T=this.__data__;return Ha?T[E]!==r:Hr.call(T,E)}function RI(E,T){var j=this.__data__;return this.size+=this.has(E)?0:1,j[E]=Ha&&T===r?v:T,this}yu.prototype.clear=uS,yu.prototype.delete=oj,yu.prototype.get=cj,yu.prototype.has=lj,yu.prototype.set=RI;function vu(E){var T=-1,j=E==null?0:E.length;for(this.clear();++T<j;){var Z=E[T];this.set(Z[0],Z[1])}}function hS(){this.__data__=[],this.size=0}function dj(E){var T=this.__data__,j=tE(T,E);if(j<0)return!1;var Z=T.length-1;return j==Z?T.pop():Jf.call(T,j,1),--this.size,!0}function uj(E){var T=this.__data__,j=tE(T,E);return j<0?r:T[j][1]}function k0(E){return tE(this.__data__,E)>-1}function hj(E,T){var j=this.__data__,Z=tE(j,E);return Z<0?(++this.size,j.push([E,T])):j[Z][1]=T,this}vu.prototype.clear=hS,vu.prototype.delete=dj,vu.prototype.get=uj,vu.prototype.has=k0,vu.prototype.set=hj;function gh(E){var T=-1,j=E==null?0:E.length;for(this.clear();++T<j;){var Z=E[T];this.set(Z[0],Z[1])}}function pj(){this.size=0,this.__data__={hash:new yu,map:new(Tn||vu),string:new yu}}function fj(E){var T=EE(this,E).delete(E);return this.size-=T?1:0,T}function mj(E){return EE(this,E).get(E)}function gj(E){return EE(this,E).has(E)}function CI(E,T){var j=EE(this,E),Z=j.size;return j.set(E,T),this.size+=j.size==Z?0:1,this}gh.prototype.clear=pj,gh.prototype.delete=fj,gh.prototype.get=mj,gh.prototype.has=gj,gh.prototype.set=CI;function tm(E){var T=-1,j=E==null?0:E.length;for(this.__data__=new gh;++T<j;)this.add(E[T])}function _j(E){return this.__data__.set(E,v),this}function yj(E){return this.__data__.has(E)}tm.prototype.add=tm.prototype.push=_j,tm.prototype.has=yj;function fl(E){var T=this.__data__=new vu(E);this.size=T.size}function vj(){this.__data__=new vu,this.size=0}function Ej(E){var T=this.__data__,j=T.delete(E);return this.size=T.size,j}function eE(E){return this.__data__.get(E)}function xj(E){return this.__data__.has(E)}function bj(E,T){var j=this.__data__;if(j instanceof vu){var Z=j.__data__;if(!Tn||Z.length<l-1)return Z.push([E,T]),this.size=++j.size,this;j=this.__data__=new gh(Z)}return j.set(E,T),this.size=j.size,this}fl.prototype.clear=vj,fl.prototype.delete=Ej,fl.prototype.get=eE,fl.prototype.has=xj,fl.prototype.set=bj;function NI(E,T){var j=ar(E),Z=!j&&Kp(E),me=!j&&!Z&&wh(E),we=!j&&!Z&&!me&&Mg(E),Ae=j||Z||me||we,Oe=Ae?ii(E.length,Bl):[],ze=Oe.length;for(var gt in E)(T||Hr.call(E,gt))&&!(Ae&&(gt=="length"||me&&(gt=="offset"||gt=="parent")||we&&(gt=="buffer"||gt=="byteLength"||gt=="byteOffset")||wu(gt,ze)))&&Oe.push(gt);return Oe}function II(E){var T=E.length;return T?E[dE(0,T-1)]:r}function wj(E,T){return TE(dc(E),yh(T,0,E.length))}function Sj(E){return TE(dc(E))}function vg(E,T,j){(j!==r&&!_l(E[T],j)||j===r&&!(T in E))&&_h(E,T,j)}function Eg(E,T,j){var Z=E[T];(!(Hr.call(E,T)&&_l(Z,j))||j===r&&!(T in E))&&_h(E,T,j)}function tE(E,T){for(var j=E.length;j--;)if(_l(E[j][0],T))return j;return-1}function Tj(E,T,j,Z){return Cd(E,function(me,we,Ae){T(Z,me,j(me),Ae)}),Z}function pS(E,T){return E&&Po(T,qa(T),E)}function Rj(E,T){return E&&Po(T,Do(T),E)}function _h(E,T,j){T=="__proto__"&&mh?mh(E,T,{configurable:!0,enumerable:!0,value:j,writable:!0}):E[T]=j}function fS(E,T){for(var j=-1,Z=T.length,me=st(Z),we=E==null;++j<Z;)me[j]=we?r:J0(E,T[j]);return me}function yh(E,T,j){return E===E&&(j!==r&&(E=E<=j?E:j),T!==r&&(E=E>=T?E:T)),E}function zc(E,T,j,Z,me,we){var Ae,Oe=T&C,ze=T&A,gt=T&O;if(j&&(Ae=me?j(E,Z,me,we):j(E)),Ae!==r)return Ae;if(!ns(E))return E;var bt=ar(E);if(bt){if(Ae=tM(E),!Oe)return dc(E,Ae)}else{var At=Ka(E),Gt=At==pr||At==nn;if(wh(E))return mE(E,Oe);if(At==Cs||At==Ct||Gt&&!me){if(Ae=ze||Gt?{}:US(E),!Oe)return ze?Kj(E,Rj(Ae,E)):NS(E,pS(Ae,E))}else{if(!vr[At])return me?E:{};Ae=wE(E,At,Oe)}}we||(we=new fl);var En=we.get(E);if(En)return En;we.set(E,Ae),i1(E)?E.forEach(function(Gn){Ae.add(zc(Gn,T,j,Gn,E,we))}):n1(E)&&E.forEach(function(Gn,Fr){Ae.set(Fr,zc(Gn,T,j,Fr,E,we))});var Ln=gt?ze?OS:U0:ze?Do:qa,jn=bt?r:Ln(E);return Ga(jn||E,function(Gn,Fr){jn&&(Fr=Gn,Gn=E[Fr]),Eg(Ae,Fr,zc(Gn,T,j,Fr,E,we))}),Ae}function AI(E){var T=qa(E);return function(j){return nE(j,E,T)}}function nE(E,T,j){var Z=j.length;if(E==null)return!Z;for(E=xi(E);Z--;){var me=j[Z],we=T[me],Ae=E[me];if(Ae===r&&!(me in E)||!we(Ae))return!1}return!0}function mS(E,T,j){if(typeof E!="function")throw new ka(p);return F0(function(){E.apply(r,j)},T)}function xg(E,T,j,Z){var me=-1,we=xd,Ae=!0,Oe=E.length,ze=[],gt=T.length;if(!Oe)return ze;j&&(T=Ii(T,fr(j))),Z?(we=du,Ae=!1):T.length>=l&&(we=Bc,Ae=!1,T=new tm(T));e:for(;++me<Oe;){var bt=E[me],At=j==null?bt:j(bt);if(bt=Z||bt!==0?bt:0,Ae&&At===At){for(var Gt=gt;Gt--;)if(T[Gt]===At)continue e;ze.push(bt)}else we(T,At,Z)||ze.push(bt)}return ze}var Cd=IS(Eu),bg=IS(gS,!0);function Cj(E,T){var j=!0;return Cd(E,function(Z,me,we){return j=!!T(Z,me,we),j}),j}function rE(E,T,j){for(var Z=-1,me=E.length;++Z<me;){var we=E[Z],Ae=T(we);if(Ae!=null&&(Oe===r?Ae===Ae&&!yl(Ae):j(Ae,Oe)))var Oe=Ae,ze=we}return ze}function kI(E,T,j,Z){var me=E.length;for(j=Er(j),j<0&&(j=-j>me?0:me+j),Z=Z===r||Z>me?me:Er(Z),Z<0&&(Z+=me),Z=j>Z?0:o1(Z);j<Z;)E[j++]=T;return E}function PI(E,T){var j=[];return Cd(E,function(Z,me,we){T(Z,me,we)&&j.push(Z)}),j}function oo(E,T,j,Z,me){var we=-1,Ae=E.length;for(j||(j=iA),me||(me=[]);++we<Ae;){var Oe=E[we];T>0&&j(Oe)?T>1?oo(Oe,T-1,j,Z,me):Vc(me,Oe):Z||(me[me.length]=Oe)}return me}var iE=AS(),DI=AS(!0);function Eu(E,T){return E&&iE(E,T,qa)}function gS(E,T){return E&&DI(E,T,qa)}function sE(E,T){return ic(T,function(j){return Tu(E[j])})}function nm(E,T){T=vh(T,E);for(var j=0,Z=T.length;E!=null&&j<Z;)E=E[Id(T[j++])];return j&&j==Z?E:r}function OI(E,T,j){var Z=T(E);return ar(E)?Z:Vc(Z,j(E))}function Ao(E){return E==null?E===r?hi:ui:_u&&_u in xi(E)?eM(E):oM(E)}function Op(E,T){return E>T}function Nj(E,T){return E!=null&&Hr.call(E,T)}function Ij(E,T){return E!=null&&T in xi(E)}function Aj(E,T,j){return E>=ge(T,j)&&E<ae(T,j)}function aE(E,T,j){for(var Z=j?du:xd,me=E[0].length,we=E.length,Ae=we,Oe=st(we),ze=1/0,gt=[];Ae--;){var bt=E[Ae];Ae&&T&&(bt=Ii(bt,fr(T))),ze=ge(bt.length,ze),Oe[Ae]=!j&&(T||me>=120&&bt.length>=120)?new tm(Ae&&bt):r}bt=E[0];var At=-1,Gt=Oe[0];e:for(;++At<me&&gt.length<ze;){var En=bt[At],Ln=T?T(En):En;if(En=j||En!==0?En:0,!(Gt?Bc(Gt,Ln):Z(gt,Ln,j))){for(Ae=we;--Ae;){var jn=Oe[Ae];if(!(jn?Bc(jn,Ln):Z(E[Ae],Ln,j)))continue e}Gt&&Gt.push(Ln),gt.push(En)}}return gt}function kj(E,T,j,Z){return Eu(E,function(me,we,Ae){T(Z,j(me),we,Ae)}),Z}function wg(E,T,j){T=vh(T,E),E=lA(E,T);var Z=E==null?E:E[Id(gl(T))];return Z==null?r:Li(Z,E,j)}function LI(E){return Hs(E)&&Ao(E)==Ct}function Pj(E){return Hs(E)&&Ao(E)==Gr}function Dj(E){return Hs(E)&&Ao(E)==ln}function Lp(E,T,j,Z,me){return E===T?!0:E==null||T==null||!Hs(E)&&!Hs(T)?E!==E&&T!==T:Oj(E,T,j,Z,Lp,me)}function Oj(E,T,j,Z,me,we){var Ae=ar(E),Oe=ar(T),ze=Ae?Ot:Ka(E),gt=Oe?Ot:Ka(T);ze=ze==Ct?Cs:ze,gt=gt==Ct?Cs:gt;var bt=ze==Cs,At=gt==Cs,Gt=ze==gt;if(Gt&&wh(E)){if(!wh(T))return!1;Ae=!0,bt=!1}if(Gt&&!bt)return we||(we=new fl),Ae||Mg(E)?nA(E,T,j,Z,me,we):Qj(E,T,ze,j,Z,me,we);if(!(j&U)){var En=bt&&Hr.call(E,"__wrapped__"),Ln=At&&Hr.call(T,"__wrapped__");if(En||Ln){var jn=En?E.value():E,Gn=Ln?T.value():T;return we||(we=new fl),me(jn,Gn,j,Z,we)}}return Gt?(we||(we=new fl),Zj(E,T,j,Z,me,we)):!1}function Lj(E){return Hs(E)&&Ka(E)==ri}function _S(E,T,j,Z){var me=j.length,we=me,Ae=!Z;if(E==null)return!we;for(E=xi(E);me--;){var Oe=j[me];if(Ae&&Oe[2]?Oe[1]!==E[Oe[0]]:!(Oe[0]in E))return!1}for(;++me<we;){Oe=j[me];var ze=Oe[0],gt=E[ze],bt=Oe[1];if(Ae&&Oe[2]){if(gt===r&&!(ze in E))return!1}else{var At=new fl;if(Z)var Gt=Z(gt,bt,ze,E,T,At);if(!(Gt===r?Lp(bt,gt,U|F,Z,At):Gt))return!1}}return!0}function jI(E){if(!ns(E)||rM(E))return!1;var T=Tu(E)?Td:_p;return T.test(bh(E))}function jj(E){return Hs(E)&&Ao(E)==Ra}function Mj(E){return Hs(E)&&Ka(E)==us}function yS(E){return Hs(E)&&FE(E.length)&&!!Yn[Ao(E)]}function MI(E){return typeof E=="function"?E:E==null?Wc:typeof E=="object"?ar(E)?FI(E[0],E[1]):VI(E):L1(E)}function oE(E){if(!zp(E))return G(E);var T=[];for(var j in xi(E))Hr.call(E,j)&&j!="constructor"&&T.push(j);return T}function Uj(E){if(!ns(E))return aM(E);var T=zp(E),j=[];for(var Z in E)Z=="constructor"&&(T||!Hr.call(E,Z))||j.push(Z);return j}function cE(E,T){return E<T}function UI(E,T){var j=-1,Z=hc(E)?st(E.length):[];return Cd(E,function(me,we,Ae){Z[++j]=T(me,we,Ae)}),Z}function VI(E){var T=xE(E);return T.length==1&&T[0][2]?oA(T[0][0],T[0][1]):function(j){return j===E||_S(j,E,T)}}function FI(E,T){return Ag(E)&&aA(T)?oA(Id(E),T):function(j){var Z=J0(j,E);return Z===r&&Z===T?ET(j,E):Lp(T,Z,U|F)}}function lE(E,T,j,Z,me){E!==T&&iE(T,function(we,Ae){if(me||(me=new fl),ns(we))Vj(E,T,Ae,j,lE,Z,me);else{var Oe=Z?Z(BS(E,Ae),we,Ae+"",E,T,me):r;Oe===r&&(Oe=we),vg(E,Ae,Oe)}},Do)}function Vj(E,T,j,Z,me,we,Ae){var Oe=BS(E,j),ze=BS(T,j),gt=Ae.get(ze);if(gt){vg(E,j,gt);return}var bt=we?we(Oe,ze,j+"",E,T,Ae):r,At=bt===r;if(At){var Gt=ar(ze),En=!Gt&&wh(ze),Ln=!Gt&&!En&&Mg(ze);bt=ze,Gt||En||Ln?ar(Oe)?bt=Oe:Ws(Oe)?bt=dc(Oe):En?(At=!1,bt=mE(ze,!0)):Ln?(At=!1,bt=XI(ze,!0)):bt=[]:X0(ze)||Kp(ze)?(bt=Oe,Kp(Oe)?bt=c1(Oe):(!ns(Oe)||Tu(Oe))&&(bt=US(ze))):At=!1}At&&(Ae.set(ze,bt),me(bt,ze,Z,we,Ae),Ae.delete(ze)),vg(E,j,bt)}function BI(E,T){var j=E.length;if(j)return T+=T<0?j:0,wu(T,j)?E[T]:r}function vS(E,T,j){T.length?T=Ii(T,function(we){return ar(we)?function(Ae){return nm(Ae,we.length===1?we[0]:we)}:we}):T=[Wc];var Z=-1;T=Ii(T,fr(On()));var me=UI(E,function(we,Ae,Oe){var ze=Ii(T,function(gt){return gt(we)});return{criteria:ze,index:++Z,value:we}});return ct(me,function(we,Ae){return Rg(we,Ae,j)})}function Fj(E,T){return zI(E,T,function(j,Z){return ET(E,Z)})}function zI(E,T,j){for(var Z=-1,me=T.length,we={};++Z<me;){var Ae=T[Z],Oe=nm(E,Ae);j(Oe,Ae)&&jp(we,vh(Ae,E),Oe)}return we}function GI(E){return function(T){return nm(T,E)}}function ES(E,T,j,Z){var me=Z?Fc:bd,we=-1,Ae=T.length,Oe=E;for(E===T&&(T=dc(T)),j&&(Oe=Ii(E,fr(j)));++we<Ae;)for(var ze=0,gt=T[we],bt=j?j(gt):gt;(ze=me(Oe,bt,ze,Z))>-1;)Oe!==E&&Jf.call(Oe,ze,1),Jf.call(E,ze,1);return E}function P0(E,T){for(var j=E?T.length:0,Z=j-1;j--;){var me=T[j];if(j==Z||me!==we){var we=me;wu(me)?Jf.call(E,me,1):Up(E,me)}}return E}function dE(E,T){return E+Rd(nt()*(T-E+1))}function D0(E,T,j,Z){for(var me=-1,we=ae(Qf((T-E)/(j||1)),0),Ae=st(we);we--;)Ae[Z?we:++me]=E,E+=j;return Ae}function xS(E,T){var j="";if(!E||T<1||T>Le)return j;do T%2&&(j+=E),T=Rd(T/2),T&&(E+=E);while(T);return j}function Dr(E,T){return GS(SE(E,T,Wc),E+"")}function Bj(E){return II(Ug(E))}function zj(E,T){var j=Ug(E);return TE(j,yh(T,0,j.length))}function jp(E,T,j,Z){if(!ns(E))return E;T=vh(T,E);for(var me=-1,we=T.length,Ae=we-1,Oe=E;Oe!=null&&++me<we;){var ze=Id(T[me]),gt=j;if(ze==="__proto__"||ze==="constructor"||ze==="prototype")return E;if(me!=Ae){var bt=Oe[ze];gt=Z?Z(bt,ze,Oe):r,gt===r&&(gt=ns(bt)?bt:wu(T[me+1])?[]:{})}Eg(Oe,ze,gt),Oe=Oe[ze]}return E}var WI=Pa?function(E,T){return Pa.set(E,T),E}:Wc,HI=mh?function(E,T){return mh(E,"toString",{configurable:!0,enumerable:!1,value:KE(T),writable:!0})}:Wc;function bS(E){return TE(Ug(E))}function Gc(E,T,j){var Z=-1,me=E.length;T<0&&(T=-T>me?0:me+T),j=j>me?me:j,j<0&&(j+=me),me=T>j?0:j-T>>>0,T>>>=0;for(var we=st(me);++Z<me;)we[Z]=E[Z+T];return we}function Gj(E,T){var j;return Cd(E,function(Z,me,we){return j=T(Z,me,we),!j}),!!j}function uE(E,T,j){var Z=0,me=E==null?Z:E.length;if(typeof T=="number"&&T===T&&me<=mt){for(;Z<me;){var we=Z+me>>>1,Ae=E[we];Ae!==null&&!yl(Ae)&&(j?Ae<=T:Ae<T)?Z=we+1:me=we}return me}return wS(E,T,Wc,j)}function wS(E,T,j,Z){var me=0,we=E==null?0:E.length;if(we===0)return 0;T=j(T);for(var Ae=T!==T,Oe=T===null,ze=yl(T),gt=T===r;me<we;){var bt=Rd((me+we)/2),At=j(E[bt]),Gt=At!==r,En=At===null,Ln=At===At,jn=yl(At);if(Ae)var Gn=Z||Ln;else gt?Gn=Ln&&(Z||Gt):Oe?Gn=Ln&&Gt&&(Z||!En):ze?Gn=Ln&&Gt&&!En&&(Z||!jn):En||jn?Gn=!1:Gn=Z?At<=T:At<T;Gn?me=bt+1:we=bt}return ge(we,rt)}function KI(E,T){for(var j=-1,Z=E.length,me=0,we=[];++j<Z;){var Ae=E[j],Oe=T?T(Ae):Ae;if(!j||!_l(Oe,ze)){var ze=Oe;we[me++]=Ae===0?0:Ae}}return we}function qI(E){return typeof E=="number"?E:yl(E)?Ke:+E}function ko(E){if(typeof E=="string")return E;if(ar(E))return Ii(E,ko)+"";if(yl(E))return em?em.call(E):"";var T=E+"";return T=="0"&&1/E==-lt?"-0":T}function Mp(E,T,j){var Z=-1,me=xd,we=E.length,Ae=!0,Oe=[],ze=Oe;if(j)Ae=!1,me=du;else if(we>=l){var gt=T?null:Xj(E);if(gt)return oc(gt);Ae=!1,me=Bc,ze=new tm}else ze=T?[]:Oe;e:for(;++Z<we;){var bt=E[Z],At=T?T(bt):bt;if(bt=j||bt!==0?bt:0,Ae&&At===At){for(var Gt=ze.length;Gt--;)if(ze[Gt]===At)continue e;T&&ze.push(At),Oe.push(bt)}else me(ze,At,j)||(ze!==Oe&&ze.push(At),Oe.push(bt))}return Oe}function Up(E,T){T=vh(T,E);var j=-1,Z=T.length;if(!Z)return!0;for(var me=E==null||typeof E!="object"&&typeof E!="function";++j<Z;){var we=T[j];if(typeof we=="string"){if(we==="__proto__"&&!Hr.call(E,"__proto__"))return!1;if(we==="constructor"&&j+1<Z&&typeof T[j+1]=="string"&&T[j+1]==="prototype"){if(me&&j===0)continue;return!1}}}var Ae=lA(E,T);return Ae==null||delete Ae[Id(gl(T))]}function hE(E,T,j,Z){return jp(E,T,j(nm(E,T)),Z)}function rm(E,T,j,Z){for(var me=E.length,we=Z?me:-1;(Z?we--:++we<me)&&T(E[we],we,E););return j?Gc(E,Z?0:we,Z?we+1:me):Gc(E,Z?we+1:0,Z?me:we)}function Sg(E,T){var j=E;return j instanceof Pr&&(j=j.value()),Wa(T,function(Z,me){return me.func.apply(me.thisArg,Vc([Z],me.args))},j)}function Tg(E,T,j){var Z=E.length;if(Z<2)return Z?Mp(E[0]):[];for(var me=-1,we=st(Z);++me<Z;)for(var Ae=E[me],Oe=-1;++Oe<Z;)Oe!=me&&(we[me]=xg(we[me]||Ae,E[Oe],T,j));return Mp(oo(we,1),T,j)}function YI(E,T,j){for(var Z=-1,me=E.length,we=T.length,Ae={};++Z<me;){var Oe=Z<we?T[Z]:r;j(Ae,E[Z],Oe)}return Ae}function pE(E){return Ws(E)?E:[]}function SS(E){return typeof E=="function"?E:Wc}function vh(E,T){return ar(E)?E:Ag(E,T)?[E]:HS(Ai(E))}var Wj=Dr;function Vp(E,T,j){var Z=E.length;return j=j===r?Z:j,!T&&j>=Z?E:Gc(E,T,j)}var fE=Jv||function(E){return xs.clearTimeout(E)};function mE(E,T){if(T)return E.slice();var j=E.length,Z=$v?$v(j):new E.constructor(j);return E.copy(Z),Z}function TS(E){var T=new E.constructor(E.byteLength);return new mu(T).set(new mu(E)),T}function Hj(E,T){var j=T?TS(E.buffer):E.buffer;return new E.constructor(j,E.byteOffset,E.byteLength)}function $I(E){var T=new E.constructor(E.source,Oc.exec(E));return T.lastIndex=E.lastIndex,T}function RS(E){return ts?xi(ts.call(E)):{}}function XI(E,T){var j=T?TS(E.buffer):E.buffer;return new E.constructor(j,E.byteOffset,E.length)}function Nd(E,T){if(E!==T){var j=E!==r,Z=E===null,me=E===E,we=yl(E),Ae=T!==r,Oe=T===null,ze=T===T,gt=yl(T);if(!Oe&&!gt&&!we&&E>T||we&&Ae&&ze&&!Oe&&!gt||Z&&Ae&&ze||!j&&ze||!me)return 1;if(!Z&&!we&&!gt&&E<T||gt&&j&&me&&!Z&&!we||Oe&&j&&me||!Ae&&me||!ze)return-1}return 0}function Rg(E,T,j){for(var Z=-1,me=E.criteria,we=T.criteria,Ae=me.length,Oe=j.length;++Z<Ae;){var ze=Nd(me[Z],we[Z]);if(ze){if(Z>=Oe)return ze;var gt=j[Z];return ze*(gt=="desc"?-1:1)}}return E.index-T.index}function Fp(E,T,j,Z){for(var me=-1,we=E.length,Ae=j.length,Oe=-1,ze=T.length,gt=ae(we-Ae,0),bt=st(ze+gt),At=!Z;++Oe<ze;)bt[Oe]=T[Oe];for(;++me<Ae;)(At||me<we)&&(bt[j[me]]=E[me]);for(;gt--;)bt[Oe++]=E[me++];return bt}function CS(E,T,j,Z){for(var me=-1,we=E.length,Ae=-1,Oe=j.length,ze=-1,gt=T.length,bt=ae(we-Oe,0),At=st(bt+gt),Gt=!Z;++me<bt;)At[me]=E[me];for(var En=me;++ze<gt;)At[En+ze]=T[ze];for(;++Ae<Oe;)(Gt||me<we)&&(At[En+j[Ae]]=E[me++]);return At}function dc(E,T){var j=-1,Z=E.length;for(T||(T=st(Z));++j<Z;)T[j]=E[j];return T}function Po(E,T,j,Z){var me=!j;j||(j={});for(var we=-1,Ae=T.length;++we<Ae;){var Oe=T[we],ze=Z?Z(j[Oe],E[Oe],Oe,j,E):r;ze===r&&(ze=E[Oe]),me?_h(j,Oe,ze):Eg(j,Oe,ze)}return j}function NS(E,T){return Po(E,jS(E),T)}function Kj(E,T){return Po(E,V0(E),T)}function O0(E,T){return function(j,Z){var me=ar(j)?fh:Tj,we=T?T():{};return me(j,E,On(Z,2),we)}}function Cg(E){return Dr(function(T,j){var Z=-1,me=j.length,we=me>1?j[me-1]:r,Ae=me>2?j[2]:r;for(we=E.length>3&&typeof we=="function"?(me--,we):r,Ae&&uc(j[0],j[1],Ae)&&(we=me<3?r:we,me=1),T=xi(T);++Z<me;){var Oe=j[Z];Oe&&E(T,Oe,Z,we)}return T})}function IS(E,T){return function(j,Z){if(j==null)return j;if(!hc(j))return E(j,Z);for(var me=j.length,we=T?me:-1,Ae=xi(j);(T?we--:++we<me)&&Z(Ae[we],we,Ae)!==!1;);return j}}function AS(E){return function(T,j,Z){for(var me=-1,we=xi(T),Ae=Z(T),Oe=Ae.length;Oe--;){var ze=Ae[E?Oe:++me];if(j(we[ze],ze,we)===!1)break}return T}}function qj(E,T,j){var Z=T&q,me=L0(E);function we(){var Ae=this&&this!==xs&&this instanceof we?me:E;return Ae.apply(Z?j:this,arguments)}return we}function Eh(E){return function(T){T=Ai(T);var j=Cp(T)?No(T):r,Z=j?j[0]:T.charAt(0),me=j?Vp(j,1).join(""):T.slice(1);return Z[E]()+me}}function Ng(E){return function(T){return Wa(HE(b1(T).replace(Ei,"")),E,"")}}function L0(E){return function(){var T=arguments;switch(T.length){case 0:return new E;case 1:return new E(T[0]);case 2:return new E(T[0],T[1]);case 3:return new E(T[0],T[1],T[2]);case 4:return new E(T[0],T[1],T[2],T[3]);case 5:return new E(T[0],T[1],T[2],T[3],T[4]);case 6:return new E(T[0],T[1],T[2],T[3],T[4],T[5]);case 7:return new E(T[0],T[1],T[2],T[3],T[4],T[5],T[6])}var j=Dp(E.prototype),Z=E.apply(j,T);return ns(Z)?Z:j}}function Yj(E,T,j){var Z=L0(E);function me(){for(var we=arguments.length,Ae=st(we),Oe=we,ze=Ig(me);Oe--;)Ae[Oe]=arguments[Oe];var gt=we<3&&Ae[0]!==ze&&Ae[we-1]!==ze?[]:hu(Ae,ze);if(we-=gt.length,we<j)return ZI(E,T,gE,me.placeholder,r,Ae,gt,r,r,j-we);var bt=this&&this!==xs&&this instanceof me?Z:E;return Li(bt,this,Ae)}return me}function JI(E){return function(T,j,Z){var me=xi(T);if(!hc(T)){var we=On(j,3);T=qa(T),j=function(Oe){return we(me[Oe],Oe,me)}}var Ae=E(T,j,Z);return Ae>-1?me[we?T[Ae]:Ae]:r}}function kS(E){return xh(function(T){var j=T.length,Z=j,me=Io.prototype.thru;for(E&&T.reverse();Z--;){var we=T[Z];if(typeof we!="function")throw new ka(p);if(me&&!Ae&&vE(we)=="wrapper")var Ae=new Io([],!0)}for(Z=Ae?Z:j;++Z<j;){we=T[Z];var Oe=vE(we),ze=Oe=="wrapper"?LS(we):r;ze&&VS(ze[0])&&ze[1]==(J|X|te|Q)&&!ze[4].length&&ze[9]==1?Ae=Ae[vE(ze[0])].apply(Ae,ze[3]):Ae=we.length==1&&VS(we)?Ae[Oe]():Ae.thru(we)}return function(){var gt=arguments,bt=gt[0];if(Ae&&gt.length==1&&ar(bt))return Ae.plant(bt).value();for(var At=0,Gt=j?T[At].apply(this,gt):bt;++At<j;)Gt=T[At].call(this,Gt);return Gt}})}function gE(E,T,j,Z,me,we,Ae,Oe,ze,gt){var bt=T&J,At=T&q,Gt=T&W,En=T&(X|ne),Ln=T&ce,jn=Gt?r:L0(E);function Gn(){for(var Fr=arguments.length,Br=st(Fr),co=Fr;co--;)Br[co]=arguments[co];if(En)var lo=Ig(Gn),Hc=Fl(Br,lo);if(Z&&(Br=Fp(Br,Z,me,En)),we&&(Br=CS(Br,we,Ae,En)),Fr-=Hc,En&&Fr<gt){var oa=hu(Br,lo);return ZI(E,T,gE,Gn.placeholder,j,Br,oa,Oe,ze,gt-Fr)}var kd=At?j:this,Th=Gt?kd[E]:E;return Fr=Br.length,Oe?Br=FS(Br,Oe):Ln&&Fr>1&&Br.reverse(),bt&&ze<Fr&&(Br.length=ze),this&&this!==xs&&this instanceof Gn&&(Th=jn||L0(Th)),Th.apply(kd,Br)}return Gn}function _E(E,T){return function(j,Z){return kj(j,E,T(Z),{})}}function j0(E,T){return function(j,Z){var me;if(j===r&&Z===r)return T;if(j!==r&&(me=j),Z!==r){if(me===r)return Z;typeof j=="string"||typeof Z=="string"?(j=ko(j),Z=ko(Z)):(j=qI(j),Z=qI(Z)),me=E(j,Z)}return me}}function PS(E){return xh(function(T){return T=Ii(T,fr(On())),Dr(function(j){var Z=this;return E(T,function(me){return Li(me,Z,j)})})})}function M0(E,T){T=T===r?" ":ko(T);var j=T.length;if(j<2)return j?xS(T,E):T;var Z=xS(T,Qf(E/Aa(T)));return Cp(T)?Vp(No(Z),0,E).join(""):Z.slice(0,E)}function $j(E,T,j,Z){var me=T&q,we=L0(E);function Ae(){for(var Oe=-1,ze=arguments.length,gt=-1,bt=Z.length,At=st(bt+ze),Gt=this&&this!==xs&&this instanceof Ae?we:E;++gt<bt;)At[gt]=Z[gt];for(;ze--;)At[gt++]=arguments[++Oe];return Li(Gt,me?j:this,At)}return Ae}function QI(E){return function(T,j,Z){return Z&&typeof Z!="number"&&uc(T,j,Z)&&(j=Z=r),T=Sh(T),j===r?(j=T,T=0):j=Sh(j),Z=Z===r?T<j?1:-1:Sh(Z),D0(T,j,Z,E)}}function yE(E){return function(T,j){return typeof T=="string"&&typeof j=="string"||(T=Gl(T),j=Gl(j)),E(T,j)}}function ZI(E,T,j,Z,me,we,Ae,Oe,ze,gt){var bt=T&X,At=bt?Ae:r,Gt=bt?r:Ae,En=bt?we:r,Ln=bt?r:we;T|=bt?te:he,T&=~(bt?he:te),T&H||(T&=-4);var jn=[E,T,me,En,At,Ln,Gt,Oe,ze,gt],Gn=j.apply(r,jn);return VS(E)&&zS(Gn,jn),Gn.placeholder=Z,WS(Gn,E,T)}function DS(E){var T=aa[E];return function(j,Z){if(j=Gl(j),Z=Z==null?0:ge(Er(Z),292),Z&&S(j)){var me=(Ai(j)+"e").split("e"),we=T(me[0]+"e"+(+me[1]+Z));return me=(Ai(we)+"e").split("e"),+(me[0]+"e"+(+me[1]-Z))}return T(j)}}var Xj=Gs&&1/oc(new Gs([,-0]))[1]==lt?function(E){return new Gs(E)}:Q0;function eA(E){return function(T){var j=Ka(T);return j==ri?$f(T):j==us?w0(T):Bs(T,E(T))}}function xu(E,T,j,Z,me,we,Ae,Oe){var ze=T&W;if(!ze&&typeof E!="function")throw new ka(p);var gt=Z?Z.length:0;if(gt||(T&=-97,Z=me=r),Ae=Ae===r?Ae:ae(Er(Ae),0),Oe=Oe===r?Oe:Er(Oe),gt-=me?me.length:0,T&he){var bt=Z,At=me;Z=me=r}var Gt=ze?r:LS(E),En=[E,T,j,Z,me,bt,At,we,Ae,Oe];if(Gt&&cA(En,Gt),E=En[0],T=En[1],j=En[2],Z=En[3],me=En[4],Oe=En[9]=En[9]===r?ze?0:E.length:ae(En[9]-gt,0),!Oe&&T&(X|ne)&&(T&=-25),!T||T==q)var Ln=qj(E,T,j);else T==X||T==ne?Ln=Yj(E,T,Oe):(T==te||T==(q|te))&&!me.length?Ln=$j(E,T,j,Z):Ln=gE.apply(r,En);var jn=Gt?WI:zS;return WS(jn(Ln,En),E,T)}function bu(E,T,j,Z){return E===r||_l(E,Ge[j])&&!Hr.call(Z,j)?T:E}function tA(E,T,j,Z,me,we){return ns(E)&&ns(T)&&(we.set(T,E),lE(E,T,r,tA,we),we.delete(T)),E}function Jj(E){return X0(E)?r:E}function nA(E,T,j,Z,me,we){var Ae=j&U,Oe=E.length,ze=T.length;if(Oe!=ze&&!(Ae&&ze>Oe))return!1;var gt=we.get(E),bt=we.get(T);if(gt&&bt)return gt==T&&bt==E;var At=-1,Gt=!0,En=j&F?new tm:r;for(we.set(E,T),we.set(T,E);++At<Oe;){var Ln=E[At],jn=T[At];if(Z)var Gn=Ae?Z(jn,Ln,At,T,E,we):Z(Ln,jn,At,E,T,we);if(Gn!==r){if(Gn)continue;Gt=!1;break}if(En){if(!sc(T,function(Fr,Br){if(!Bc(En,Br)&&(Ln===Fr||me(Ln,Fr,j,Z,we)))return En.push(Br)})){Gt=!1;break}}else if(!(Ln===jn||me(Ln,jn,j,Z,we))){Gt=!1;break}}return we.delete(E),we.delete(T),Gt}function Qj(E,T,j,Z,me,we,Ae){switch(j){case Ca:if(E.byteLength!=T.byteLength||E.byteOffset!=T.byteOffset)return!1;E=E.buffer,T=T.buffer;case Gr:return!(E.byteLength!=T.byteLength||!we(new mu(E),new mu(T)));case zt:case ln:case un:return _l(+E,+T);case ni:return E.name==T.name&&E.message==T.message;case Ra:case ro:return E==T+"";case ri:var Oe=$f;case us:var ze=Z&U;if(Oe||(Oe=oc),E.size!=T.size&&!ze)return!1;var gt=Ae.get(E);if(gt)return gt==T;Z|=F,Ae.set(E,T);var bt=nA(Oe(E),Oe(T),Z,me,we,Ae);return Ae.delete(E),bt;case Fa:if(ts)return ts.call(E)==ts.call(T)}return!1}function Zj(E,T,j,Z,me,we){var Ae=j&U,Oe=U0(E),ze=Oe.length,gt=U0(T),bt=gt.length;if(ze!=bt&&!Ae)return!1;for(var At=ze;At--;){var Gt=Oe[At];if(!(Ae?Gt in T:Hr.call(T,Gt)))return!1}var En=we.get(E),Ln=we.get(T);if(En&&Ln)return En==T&&Ln==E;var jn=!0;we.set(E,T),we.set(T,E);for(var Gn=Ae;++At<ze;){Gt=Oe[At];var Fr=E[Gt],Br=T[Gt];if(Z)var co=Ae?Z(Br,Fr,Gt,T,E,we):Z(Fr,Br,Gt,E,T,we);if(!(co===r?Fr===Br||me(Fr,Br,j,Z,we):co)){jn=!1;break}Gn||(Gn=Gt=="constructor")}if(jn&&!Gn){var lo=E.constructor,Hc=T.constructor;lo!=Hc&&"constructor"in E&&"constructor"in T&&!(typeof lo=="function"&&lo instanceof lo&&typeof Hc=="function"&&Hc instanceof Hc)&&(jn=!1)}return we.delete(E),we.delete(T),jn}function xh(E){return GS(SE(E,r,_A),E+"")}function U0(E){return OI(E,qa,jS)}function OS(E){return OI(E,Do,V0)}var LS=Pa?function(E){return Pa.get(E)}:Q0;function vE(E){for(var T=E.name+"",j=pl[T],Z=Hr.call(pl,T)?j.length:0;Z--;){var me=j[Z],we=me.func;if(we==null||we==E)return me.name}return T}function Ig(E){var T=Hr.call(xe,"placeholder")?xe:E;return T.placeholder}function On(){var E=xe.iteratee||TT;return E=E===TT?MI:E,arguments.length?E(arguments[0],arguments[1]):E}function EE(E,T){var j=E.__data__;return sA(T)?j[typeof T=="string"?"string":"hash"]:j.map}function xE(E){for(var T=qa(E),j=T.length;j--;){var Z=T[j],me=E[Z];T[j]=[Z,me,aA(me)]}return T}function Bp(E,T){var j=ug(E,T);return jI(j)?j:r}function eM(E){var T=Hr.call(E,_u),j=E[_u];try{E[_u]=r;var Z=!0}catch{}var me=Ap.call(E);return Z&&(T?E[_u]=j:delete E[_u]),me}var jS=I0?function(E){return E==null?[]:(E=xi(E),ic(I0(E),function(T){return kp.call(E,T)}))}:CT,V0=I0?function(E){for(var T=[];E;)Vc(T,jS(E)),E=zl(E);return T}:CT,Ka=Ao;(Jt&&Ka(new Jt(new ArrayBuffer(1)))!=Ca||Tn&&Ka(new Tn)!=ri||nr&&Ka(nr.resolve())!=Jn||Gs&&Ka(new Gs)!=us||bs&&Ka(new bs)!=So)&&(Ka=function(E){var T=Ao(E),j=T==Cs?E.constructor:r,Z=j?bh(j):"";if(Z)switch(Z){case Qv:return Ca;case A0:return ri;case cS:return Jn;case _g:return us;case lS:return So}return T});function rA(E,T,j){for(var Z=-1,me=j.length;++Z<me;){var we=j[Z],Ae=we.size;switch(we.type){case"drop":E+=Ae;break;case"dropRight":T-=Ae;break;case"take":T=ge(T,E+Ae);break;case"takeRight":E=ae(E,T-Ae);break}}return{start:E,end:T}}function bE(E){var T=E.match(Ll);return T?T[1].split(og):[]}function MS(E,T,j){T=vh(T,E);for(var Z=-1,me=T.length,we=!1;++Z<me;){var Ae=Id(T[Z]);if(!(we=E!=null&&j(E,Ae)))break;E=E[Ae]}return we||++Z!=me?we:(me=E==null?0:E.length,!!me&&FE(me)&&wu(Ae,me)&&(ar(E)||Kp(E)))}function tM(E){var T=E.length,j=new E.constructor(T);return T&&typeof E[0]=="string"&&Hr.call(E,"index")&&(j.index=E.index,j.input=E.input),j}function US(E){return typeof E.constructor=="function"&&!zp(E)?Dp(zl(E)):{}}function wE(E,T,j){var Z=E.constructor;switch(T){case Gr:return TS(E);case zt:case ln:return new Z(+E);case Ca:return Hj(E,j);case Ac:case kc:case Pc:case Ba:case Dc:case ia:case Lt:case Ir:case We:return XI(E,j);case ri:return new Z;case un:case ro:return new Z(E);case Ra:return $I(E);case us:return new Z;case Fa:return RS(E)}}function nM(E,T){var j=T.length;if(!j)return E;var Z=j-1;return T[Z]=(j>1?"& ":"")+T[Z],T=T.join(j>2?", ":" "),E.replace(vn,`{
/* [wrapped with `+T+`] */
`)}function iA(E){return ar(E)||Kp(E)||!!(Xv&&E&&E[Xv])}function wu(E,T){var j=typeof E;return T=T??Le,!!T&&(j=="number"||j!="symbol"&&jl.test(E))&&E>-1&&E%1==0&&E<T}function uc(E,T,j){if(!ns(j))return!1;var Z=typeof T;return(Z=="number"?hc(j)&&wu(T,j.length):Z=="string"&&T in j)?_l(j[T],E):!1}function Ag(E,T){if(ar(E))return!1;var j=typeof E;return j=="number"||j=="symbol"||j=="boolean"||E==null||yl(E)?!0:pp.test(E)||!ol.test(E)||T!=null&&E in xi(T)}function sA(E){var T=typeof E;return T=="string"||T=="number"||T=="symbol"||T=="boolean"?E!=="__proto__":E===null}function VS(E){var T=vE(E),j=xe[T];if(typeof j!="function"||!(T in Pr.prototype))return!1;if(E===j)return!0;var Z=LS(j);return!!Z&&E===Z[0]}function rM(E){return!!pu&&pu in E}var iM=Xf?Tu:NT;function zp(E){var T=E&&E.constructor,j=typeof T=="function"&&T.prototype||Ge;return E===j}function aA(E){return E===E&&!ns(E)}function oA(E,T){return function(j){return j==null?!1:j[E]===T&&(T!==r||E in xi(j))}}function sM(E){var T=jE(E,function(Z){return j.size===w&&j.clear(),Z}),j=T.cache;return T}function cA(E,T){var j=E[1],Z=T[1],me=j|Z,we=me<(q|W|J),Ae=Z==J&&j==X||Z==J&&j==Q&&E[7].length<=T[8]||Z==(J|Q)&&T[7].length<=T[8]&&j==X;if(!(we||Ae))return E;Z&q&&(E[2]=T[2],me|=j&q?0:H);var Oe=T[3];if(Oe){var ze=E[3];E[3]=ze?Fp(ze,Oe,T[4]):Oe,E[4]=ze?hu(E[3],R):T[4]}return Oe=T[5],Oe&&(ze=E[5],E[5]=ze?CS(ze,Oe,T[6]):Oe,E[6]=ze?hu(E[5],R):T[6]),Oe=T[7],Oe&&(E[7]=Oe),Z&J&&(E[8]=E[8]==null?T[8]:ge(E[8],T[8])),E[9]==null&&(E[9]=T[9]),E[0]=T[0],E[1]=me,E}function aM(E){var T=[];if(E!=null)for(var j in xi(E))T.push(j);return T}function oM(E){return Ap.call(E)}function SE(E,T,j){return T=ae(T===r?E.length-1:T,0),function(){for(var Z=arguments,me=-1,we=ae(Z.length-T,0),Ae=st(we);++me<we;)Ae[me]=Z[T+me];me=-1;for(var Oe=st(T+1);++me<T;)Oe[me]=Z[me];return Oe[T]=j(Ae),Li(E,this,Oe)}}function lA(E,T){return T.length<2?E:nm(E,Gc(T,0,-1))}function FS(E,T){for(var j=E.length,Z=ge(T.length,j),me=dc(E);Z--;){var we=T[Z];E[Z]=wu(we,j)?me[we]:r}return E}function BS(E,T){if(!(T==="constructor"&&typeof E[T]=="function")&&T!="__proto__")return E[T]}var zS=dA(WI),F0=lc||function(E,T){return xs.setTimeout(E,T)},GS=dA(HI);function WS(E,T,j){var Z=T+"";return GS(E,nM(Z,cM(bE(Z),j)))}function dA(E){var T=0,j=0;return function(){var Z=ke(),me=ye-(Z-j);if(j=Z,me>0){if(++T>=be)return arguments[0]}else T=0;return E.apply(r,arguments)}}function TE(E,T){var j=-1,Z=E.length,me=Z-1;for(T=T===r?Z:T;++j<T;){var we=dE(j,me),Ae=E[we];E[we]=E[j],E[j]=Ae}return E.length=T,E}var HS=sM(function(E){var T=[];return E.charCodeAt(0)===46&&T.push(""),E.replace(gi,function(j,Z,me,we){T.push(me?we.replace(mp,"$1"):Z||j)}),T});function Id(E){if(typeof E=="string"||yl(E))return E;var T=E+"";return T=="0"&&1/E==-lt?"-0":T}function bh(E){if(E!=null){try{return gg.call(E)}catch{}try{return E+""}catch{}}return""}function cM(E,T){return Ga(yt,function(j){var Z="_."+j[0];T&j[1]&&!xd(E,Z)&&E.push(Z)}),E.sort()}function uA(E){if(E instanceof Pr)return E.clone();var T=new Io(E.__wrapped__,E.__chain__);return T.__actions__=dc(E.__actions__),T.__index__=E.__index__,T.__values__=E.__values__,T}function B0(E,T,j){(j?uc(E,T,j):T===r)?T=1:T=ae(Er(T),0);var Z=E==null?0:E.length;if(!Z||T<1)return[];for(var me=0,we=0,Ae=st(Qf(Z/T));me<Z;)Ae[we++]=Gc(E,me,me+=T);return Ae}function hA(E){for(var T=-1,j=E==null?0:E.length,Z=0,me=[];++T<j;){var we=E[T];we&&(me[Z++]=we)}return me}function z0(){var E=arguments.length;if(!E)return[];for(var T=st(E-1),j=arguments[0],Z=E;Z--;)T[Z-1]=arguments[Z];return Vc(ar(j)?dc(j):[j],oo(T,1))}var kg=Dr(function(E,T){return Ws(E)?xg(E,oo(T,1,Ws,!0)):[]}),pA=Dr(function(E,T){var j=gl(T);return Ws(j)&&(j=r),Ws(E)?xg(E,oo(T,1,Ws,!0),On(j,2)):[]}),KS=Dr(function(E,T){var j=gl(T);return Ws(j)&&(j=r),Ws(E)?xg(E,oo(T,1,Ws,!0),r,j):[]});function RE(E,T,j){var Z=E==null?0:E.length;return Z?(T=j||T===r?1:Er(T),Gc(E,T<0?0:T,Z)):[]}function lM(E,T,j){var Z=E==null?0:E.length;return Z?(T=j||T===r?1:Er(T),T=Z-T,Gc(E,0,T<0?0:T)):[]}function dM(E,T){return E&&E.length?rm(E,On(T,3),!0,!0):[]}function uM(E,T){return E&&E.length?rm(E,On(T,3),!0):[]}function fA(E,T,j,Z){var me=E==null?0:E.length;return me?(j&&typeof j!="number"&&uc(E,T,j)&&(j=0,Z=me),kI(E,T,j,Z)):[]}function mA(E,T,j){var Z=E==null?0:E.length;if(!Z)return-1;var me=j==null?0:Er(j);return me<0&&(me=ae(Z+me,0)),ac(E,On(T,3),me)}function gA(E,T,j){var Z=E==null?0:E.length;if(!Z)return-1;var me=Z-1;return j!==r&&(me=Er(j),me=j<0?ae(Z+me,0):ge(me,Z-1)),ac(E,On(T,3),me,!0)}function _A(E){var T=E==null?0:E.length;return T?oo(E,1):[]}function qS(E){var T=E==null?0:E.length;return T?oo(E,lt):[]}function Gp(E,T){var j=E==null?0:E.length;return j?(T=T===r?1:Er(T),oo(E,T)):[]}function hM(E){for(var T=-1,j=E==null?0:E.length,Z={};++T<j;){var me=E[T];Z[me[0]]=me[1]}return Z}function Wp(E){return E&&E.length?E[0]:r}function yA(E,T,j){var Z=E==null?0:E.length;if(!Z)return-1;var me=j==null?0:Er(j);return me<0&&(me=ae(Z+me,0)),bd(E,T,me)}function ml(E){var T=E==null?0:E.length;return T?Gc(E,0,-1):[]}var pM=Dr(function(E){var T=Ii(E,pE);return T.length&&T[0]===E[0]?aE(T):[]}),fM=Dr(function(E){var T=gl(E),j=Ii(E,pE);return T===gl(j)?T=r:j.pop(),j.length&&j[0]===E[0]?aE(j,On(T,2)):[]}),vA=Dr(function(E){var T=gl(E),j=Ii(E,pE);return T=typeof T=="function"?T:r,T&&j.pop(),j.length&&j[0]===E[0]?aE(j,r,T):[]});function mM(E,T){return E==null?"":P.call(E,T)}function gl(E){var T=E==null?0:E.length;return T?E[T-1]:r}function EA(E,T,j){var Z=E==null?0:E.length;if(!Z)return-1;var me=Z;return j!==r&&(me=Er(j),me=me<0?ae(Z+me,0):ge(me,Z-1)),T===T?sS(E,T,me):ac(E,k,me,!0)}function gM(E,T){return E&&E.length?BI(E,Er(T)):r}var xA=Dr(bA);function bA(E,T){return E&&E.length&&T&&T.length?ES(E,T):E}function _M(E,T,j){return E&&E.length&&T&&T.length?ES(E,T,On(j,2)):E}function yM(E,T,j){return E&&E.length&&T&&T.length?ES(E,T,r,j):E}var YS=xh(function(E,T){var j=E==null?0:E.length,Z=fS(E,T);return P0(E,Ii(T,function(me){return wu(me,j)?+me:me}).sort(Nd)),Z});function $S(E,T){var j=[];if(!(E&&E.length))return j;var Z=-1,me=[],we=E.length;for(T=On(T,3);++Z<we;){var Ae=E[Z];T(Ae,Z,E)&&(j.push(Ae),me.push(Z))}return P0(E,me),j}function XS(E){return E==null?E:Tt.call(E)}function JS(E,T,j){var Z=E==null?0:E.length;return Z?(j&&typeof j!="number"&&uc(E,T,j)?(T=0,j=Z):(T=T==null?0:Er(T),j=j===r?Z:Er(j)),Gc(E,T,j)):[]}function vM(E,T){return uE(E,T)}function wA(E,T,j){return wS(E,T,On(j,2))}function EM(E,T){var j=E==null?0:E.length;if(j){var Z=uE(E,T);if(Z<j&&_l(E[Z],T))return Z}return-1}function QS(E,T){return uE(E,T,!0)}function G0(E,T,j){return wS(E,T,On(j,2),!0)}function SA(E,T){var j=E==null?0:E.length;if(j){var Z=uE(E,T,!0)-1;if(_l(E[Z],T))return Z}return-1}function ZS(E){return E&&E.length?KI(E):[]}function eT(E,T){return E&&E.length?KI(E,On(T,2)):[]}function TA(E){var T=E==null?0:E.length;return T?Gc(E,1,T):[]}function RA(E,T,j){return E&&E.length?(T=j||T===r?1:Er(T),Gc(E,0,T<0?0:T)):[]}function CE(E,T,j){var Z=E==null?0:E.length;return Z?(T=j||T===r?1:Er(T),T=Z-T,Gc(E,T<0?0:T,Z)):[]}function CA(E,T){return E&&E.length?rm(E,On(T,3),!1,!0):[]}function xM(E,T){return E&&E.length?rm(E,On(T,3)):[]}var bM=Dr(function(E){return Mp(oo(E,1,Ws,!0))}),NA=Dr(function(E){var T=gl(E);return Ws(T)&&(T=r),Mp(oo(E,1,Ws,!0),On(T,2))}),IA=Dr(function(E){var T=gl(E);return T=typeof T=="function"?T:r,Mp(oo(E,1,Ws,!0),r,T)});function Pg(E){return E&&E.length?Mp(E):[]}function tT(E,T){return E&&E.length?Mp(E,On(T,2)):[]}function nT(E,T){return T=typeof T=="function"?T:r,E&&E.length?Mp(E,r,T):[]}function W0(E){if(!(E&&E.length))return[];var T=0;return E=ic(E,function(j){if(Ws(j))return T=ae(j.length,T),!0}),ii(T,function(j){return Ii(E,le(j))})}function rT(E,T){if(!(E&&E.length))return[];var j=W0(E);return T==null?j:Ii(j,function(Z){return Li(T,r,Z)})}var AA=Dr(function(E,T){return Ws(E)?xg(E,T):[]}),wM=Dr(function(E){return Tg(ic(E,Ws))}),SM=Dr(function(E){var T=gl(E);return Ws(T)&&(T=r),Tg(ic(E,Ws),On(T,2))}),Dg=Dr(function(E){var T=gl(E);return T=typeof T=="function"?T:r,Tg(ic(E,Ws),r,T)}),TM=Dr(W0);function kA(E,T){return YI(E||[],T||[],Eg)}function iT(E,T){return YI(E||[],T||[],jp)}var RM=Dr(function(E){var T=E.length,j=T>1?E[T-1]:r;return j=typeof j=="function"?(E.pop(),j):r,rT(E,j)});function PA(E){var T=xe(E);return T.__chain__=!0,T}function CM(E,T){return T(E),E}function NE(E,T){return T(E)}var sT=xh(function(E){var T=E.length,j=T?E[0]:0,Z=this.__wrapped__,me=function(we){return fS(we,E)};return T>1||this.__actions__.length||!(Z instanceof Pr)||!wu(j)?this.thru(me):(Z=Z.slice(j,+j+(T?1:0)),Z.__actions__.push({func:NE,args:[me],thisArg:r}),new Io(Z,this.__chain__).thru(function(we){return T&&!we.length&&we.push(r),we}))});function DA(){return PA(this)}function OA(){return new Io(this.value(),this.__chain__)}function LA(){this.__values__===r&&(this.__values__=a1(this.value()));var E=this.__index__>=this.__values__.length,T=E?r:this.__values__[this.__index__++];return{done:E,value:T}}function IE(){return this}function aT(E){for(var T,j=this;j instanceof yg;){var Z=uA(j);Z.__index__=0,Z.__values__=r,T?me.__wrapped__=Z:T=Z;var me=Z;j=j.__wrapped__}return me.__wrapped__=E,T}function AE(){var E=this.__wrapped__;if(E instanceof Pr){var T=E;return this.__actions__.length&&(T=new Pr(this)),T=T.reverse(),T.__actions__.push({func:NE,args:[XS],thisArg:r}),new Io(T,this.__chain__)}return this.thru(XS)}function kE(){return Sg(this.__wrapped__,this.__actions__)}var jA=O0(function(E,T,j){Hr.call(E,j)?++E[j]:_h(E,j,1)});function Og(E,T,j){var Z=ar(E)?ul:Cj;return j&&uc(E,T,j)&&(T=r),Z(E,On(T,3))}function im(E,T){var j=ar(E)?ic:PI;return j(E,On(T,3))}var NM=JI(mA),H0=JI(gA);function IM(E,T){return oo(PE(E,T),1)}function AM(E,T){return oo(PE(E,T),lt)}function kM(E,T,j){return j=j===r?1:Er(j),oo(PE(E,T),j)}function MA(E,T){var j=ar(E)?Ga:Cd;return j(E,On(T,3))}function oT(E,T){var j=ar(E)?Ia:bg;return j(E,On(T,3))}var cT=O0(function(E,T,j){Hr.call(E,j)?E[j].push(T):_h(E,j,[T])});function UA(E,T,j,Z){E=hc(E)?E:Ug(E),j=j&&!Z?Er(j):0;var me=E.length;return j<0&&(j=ae(me+j,0)),BE(E)?j<=me&&E.indexOf(T,j)>-1:!!me&&bd(E,T,j)>-1}var PM=Dr(function(E,T,j){var Z=-1,me=typeof T=="function",we=hc(E)?st(E.length):[];return Cd(E,function(Ae){we[++Z]=me?Li(T,Ae,j):wg(Ae,T,j)}),we}),VA=O0(function(E,T,j){_h(E,j,T)});function PE(E,T){var j=ar(E)?Ii:UI;return j(E,On(T,3))}function K0(E,T,j,Z){return E==null?[]:(ar(T)||(T=T==null?[]:[T]),j=Z?r:j,ar(j)||(j=j==null?[]:[j]),vS(E,T,j))}var Su=O0(function(E,T,j){E[j?0:1].push(T)},function(){return[[],[]]});function FA(E,T,j){var Z=ar(E)?Wa:He,me=arguments.length<3;return Z(E,On(T,4),j,me,Cd)}function DM(E,T,j){var Z=ar(E)?dg:He,me=arguments.length<3;return Z(E,On(T,4),j,me,bg)}function OM(E,T){var j=ar(E)?ic:PI;return j(E,ME(On(T,3)))}function lT(E){var T=ar(E)?II:Bj;return T(E)}function BA(E,T,j){(j?uc(E,T,j):T===r)?T=1:T=Er(T);var Z=ar(E)?wj:zj;return Z(E,T)}function zA(E){var T=ar(E)?Sj:bS;return T(E)}function LM(E){if(E==null)return 0;if(hc(E))return BE(E)?Aa(E):E.length;var T=Ka(E);return T==ri||T==us?E.size:oE(E).length}function DE(E,T,j){var Z=ar(E)?sc:Gj;return j&&uc(E,T,j)&&(T=r),Z(E,On(T,3))}var Hp=Dr(function(E,T){if(E==null)return[];var j=T.length;return j>1&&uc(E,T[0],T[1])?T=[]:j>2&&uc(T[0],T[1],T[2])&&(T=[T[0]]),vS(E,oo(T,1),[])}),OE=N0||function(){return xs.Date.now()};function q0(E,T){if(typeof T!="function")throw new ka(p);return E=Er(E),function(){if(--E<1)return T.apply(this,arguments)}}function GA(E,T,j){return T=j?r:T,T=E&&T==null?E.length:T,xu(E,J,r,r,r,r,T)}function WA(E,T){var j;if(typeof T!="function")throw new ka(p);return E=Er(E),function(){return--E>0&&(j=T.apply(this,arguments)),E<=1&&(T=r),j}}var dT=Dr(function(E,T,j){var Z=q;if(j.length){var me=hu(j,Ig(dT));Z|=te}return xu(E,Z,T,j,me)}),HA=Dr(function(E,T,j){var Z=q|W;if(j.length){var me=hu(j,Ig(HA));Z|=te}return xu(T,Z,E,j,me)});function LE(E,T,j){T=j?r:T;var Z=xu(E,X,r,r,r,r,r,T);return Z.placeholder=LE.placeholder,Z}function KA(E,T,j){T=j?r:T;var Z=xu(E,ne,r,r,r,r,r,T);return Z.placeholder=KA.placeholder,Z}function qA(E,T,j){var Z,me,we,Ae,Oe,ze,gt=0,bt=!1,At=!1,Gt=!0;if(typeof E!="function")throw new ka(p);T=Gl(T)||0,ns(j)&&(bt=!!j.leading,At="maxWait"in j,we=At?ae(Gl(j.maxWait)||0,T):we,Gt="trailing"in j?!!j.trailing:Gt);function En(oa){var kd=Z,Th=me;return Z=me=r,gt=oa,Ae=E.apply(Th,kd),Ae}function Ln(oa){return gt=oa,Oe=F0(Fr,T),bt?En(oa):Ae}function jn(oa){var kd=oa-ze,Th=oa-gt,z1=T-kd;return At?ge(z1,we-Th):z1}function Gn(oa){var kd=oa-ze,Th=oa-gt;return ze===r||kd>=T||kd<0||At&&Th>=we}function Fr(){var oa=OE();if(Gn(oa))return Br(oa);Oe=F0(Fr,jn(oa))}function Br(oa){return Oe=r,Gt&&Z?En(oa):(Z=me=r,Ae)}function co(){Oe!==r&&fE(Oe),gt=0,Z=ze=me=Oe=r}function lo(){return Oe===r?Ae:Br(OE())}function Hc(){var oa=OE(),kd=Gn(oa);if(Z=arguments,me=this,ze=oa,kd){if(Oe===r)return Ln(ze);if(At)return fE(Oe),Oe=F0(Fr,T),En(ze)}return Oe===r&&(Oe=F0(Fr,T)),Ae}return Hc.cancel=co,Hc.flush=lo,Hc}var jM=Dr(function(E,T){return mS(E,1,T)}),YA=Dr(function(E,T,j){return mS(E,Gl(T)||0,j)});function uT(E){return xu(E,ce)}function jE(E,T){if(typeof E!="function"||T!=null&&typeof T!="function")throw new ka(p);var j=function(){var Z=arguments,me=T?T.apply(this,Z):Z[0],we=j.cache;if(we.has(me))return we.get(me);var Ae=E.apply(this,Z);return j.cache=we.set(me,Ae)||we,Ae};return j.cache=new(jE.Cache||gh),j}jE.Cache=gh;function ME(E){if(typeof E!="function")throw new ka(p);return function(){var T=arguments;switch(T.length){case 0:return!E.call(this);case 1:return!E.call(this,T[0]);case 2:return!E.call(this,T[0],T[1]);case 3:return!E.call(this,T[0],T[1],T[2])}return!E.apply(this,T)}}function MM(E){return WA(2,E)}var $A=Wj(function(E,T){T=T.length==1&&ar(T[0])?Ii(T[0],fr(On())):Ii(oo(T,1),fr(On()));var j=T.length;return Dr(function(Z){for(var me=-1,we=ge(Z.length,j);++me<we;)Z[me]=T[me].call(this,Z[me]);return Li(E,this,Z)})}),Y0=Dr(function(E,T){var j=hu(T,Ig(Y0));return xu(E,te,r,T,j)}),hT=Dr(function(E,T){var j=hu(T,Ig(hT));return xu(E,he,r,T,j)}),XA=xh(function(E,T){return xu(E,Q,r,r,r,T)});function UE(E,T){if(typeof E!="function")throw new ka(p);return T=T===r?T:Er(T),Dr(E,T)}function JA(E,T){if(typeof E!="function")throw new ka(p);return T=T==null?0:ae(Er(T),0),Dr(function(j){var Z=j[T],me=Vp(j,0,T);return Z&&Vc(me,Z),Li(E,this,me)})}function UM(E,T,j){var Z=!0,me=!0;if(typeof E!="function")throw new ka(p);return ns(j)&&(Z="leading"in j?!!j.leading:Z,me="trailing"in j?!!j.trailing:me),qA(E,T,{leading:Z,maxWait:T,trailing:me})}function pT(E){return GA(E,1)}function VM(E,T){return Y0(SS(T),E)}function FM(){if(!arguments.length)return[];var E=arguments[0];return ar(E)?E:[E]}function $0(E){return zc(E,O)}function fT(E,T){return T=typeof T=="function"?T:r,zc(E,O,T)}function QA(E){return zc(E,C|O)}function mT(E,T){return T=typeof T=="function"?T:r,zc(E,C|O,T)}function gT(E,T){return T==null||nE(E,T,qa(T))}function _l(E,T){return E===T||E!==E&&T!==T}var BM=yE(Op),zM=yE(function(E,T){return E>=T}),Kp=LI(function(){return arguments}())?LI:function(E){return Hs(E)&&Hr.call(E,"callee")&&!kp.call(E,"callee")},ar=st.isArray,ZA=Tp?fr(Tp):Pj;function hc(E){return E!=null&&FE(E.length)&&!Tu(E)}function Ws(E){return Hs(E)&&hc(E)}function GM(E){return E===!0||E===!1||Hs(E)&&Ao(E)==zt}var wh=_||NT,WM=ph?fr(ph):Dj;function Lg(E){return Hs(E)&&E.nodeType===1&&!X0(E)}function jg(E){if(E==null)return!0;if(hc(E)&&(ar(E)||typeof E=="string"||typeof E.splice=="function"||wh(E)||Mg(E)||Kp(E)))return!E.length;var T=Ka(E);if(T==ri||T==us)return!E.size;if(zp(E))return!oE(E).length;for(var j in E)if(Hr.call(E,j))return!1;return!0}function _T(E,T){return Lp(E,T)}function e1(E,T,j){j=typeof j=="function"?j:r;var Z=j?j(E,T):r;return Z===r?Lp(E,T,r,j):!!Z}function VE(E){if(!Hs(E))return!1;var T=Ao(E);return T==ni||T==Pn||typeof E.message=="string"&&typeof E.name=="string"&&!X0(E)}function HM(E){return typeof E=="number"&&S(E)}function Tu(E){if(!ns(E))return!1;var T=Ao(E);return T==pr||T==nn||T==vt||T==ds}function t1(E){return typeof E=="number"&&E==Er(E)}function FE(E){return typeof E=="number"&&E>-1&&E%1==0&&E<=Le}function ns(E){var T=typeof E;return E!=null&&(T=="object"||T=="function")}function Hs(E){return E!=null&&typeof E=="object"}var n1=Ed?fr(Ed):Lj;function KM(E,T){return E===T||_S(E,T,xE(T))}function qM(E,T,j){return j=typeof j=="function"?j:r,_S(E,T,xE(T),j)}function YM(E){return r1(E)&&E!=+E}function $M(E){if(iM(E))throw new Zn(u);return jI(E)}function XM(E){return E===null}function JM(E){return E==null}function r1(E){return typeof E=="number"||Hs(E)&&Ao(E)==un}function X0(E){if(!Hs(E)||Ao(E)!=Cs)return!1;var T=zl(E);if(T===null)return!0;var j=Hr.call(T,"constructor")&&T.constructor;return typeof j=="function"&&j instanceof j&&gg.call(j)==Yv}var yT=Hf?fr(Hf):jj;function QM(E){return t1(E)&&E>=-Le&&E<=Le}var i1=dl?fr(dl):Mj;function BE(E){return typeof E=="string"||!ar(E)&&Hs(E)&&Ao(E)==ro}function yl(E){return typeof E=="symbol"||Hs(E)&&Ao(E)==Fa}var Mg=Rp?fr(Rp):yS;function s1(E){return E===r}function ZM(E){return Hs(E)&&Ka(E)==So}function e5(E){return Hs(E)&&Ao(E)==Ri}var t5=yE(cE),n5=yE(function(E,T){return E<=T});function a1(E){if(!E)return[];if(hc(E))return BE(E)?No(E):dc(E);if(Pp&&E[Pp])return hg(E[Pp]());var T=Ka(E),j=T==ri?$f:T==us?oc:Ug;return j(E)}function Sh(E){if(!E)return E===0?E:0;if(E=Gl(E),E===lt||E===-lt){var T=E<0?-1:1;return T*Me}return E===E?E:0}function Er(E){var T=Sh(E),j=T%1;return T===T?j?T-j:T:0}function o1(E){return E?yh(Er(E),0,Rt):0}function Gl(E){if(typeof E=="number")return E;if(yl(E))return Ke;if(ns(E)){var T=typeof E.valueOf=="function"?E.valueOf():E;E=ns(T)?T+"":T}if(typeof E!="string")return E===0?E:+E;E=sr(E);var j=Lf.test(E);return j||yp.test(E)?Gf(E.slice(2),j?2:8):Lc.test(E)?Ke:+E}function c1(E){return Po(E,Do(E))}function r5(E){return E?yh(Er(E),-Le,Le):E===0?E:0}function Ai(E){return E==null?"":ko(E)}var i5=Cg(function(E,T){if(zp(T)||hc(T)){Po(T,qa(T),E);return}for(var j in T)Hr.call(T,j)&&Eg(E,j,T[j])}),l1=Cg(function(E,T){Po(T,Do(T),E)}),zE=Cg(function(E,T,j,Z){Po(T,Do(T),E,Z)}),s5=Cg(function(E,T,j,Z){Po(T,qa(T),E,Z)}),a5=xh(fS);function d1(E,T){var j=Dp(E);return T==null?j:pS(j,T)}var o5=Dr(function(E,T){E=xi(E);var j=-1,Z=T.length,me=Z>2?T[2]:r;for(me&&uc(T[0],T[1],me)&&(Z=1);++j<Z;)for(var we=T[j],Ae=Do(we),Oe=-1,ze=Ae.length;++Oe<ze;){var gt=Ae[Oe],bt=E[gt];(bt===r||_l(bt,Ge[gt])&&!Hr.call(E,gt))&&(E[gt]=we[gt])}return E}),c5=Dr(function(E){return E.push(r,tA),Li(f1,r,E)});function l5(E,T){return sa(E,On(T,3),Eu)}function d5(E,T){return sa(E,On(T,3),gS)}function u5(E,T){return E==null?E:iE(E,On(T,3),Do)}function u1(E,T){return E==null?E:DI(E,On(T,3),Do)}function vT(E,T){return E&&Eu(E,On(T,3))}function h1(E,T){return E&&gS(E,On(T,3))}function h5(E){return E==null?[]:sE(E,qa(E))}function p5(E){return E==null?[]:sE(E,Do(E))}function J0(E,T,j){var Z=E==null?r:nm(E,T);return Z===r?j:Z}function f5(E,T){return E!=null&&MS(E,T,Nj)}function ET(E,T){return E!=null&&MS(E,T,Ij)}var m5=_E(function(E,T,j){T!=null&&typeof T.toString!="function"&&(T=Ap.call(T)),E[T]=j},KE(Wc)),g5=_E(function(E,T,j){T!=null&&typeof T.toString!="function"&&(T=Ap.call(T)),Hr.call(E,T)?E[T].push(j):E[T]=[j]},On),p1=Dr(wg);function qa(E){return hc(E)?NI(E):oE(E)}function Do(E){return hc(E)?NI(E,!0):Uj(E)}function _5(E,T){var j={};return T=On(T,3),Eu(E,function(Z,me,we){_h(j,T(Z,me,we),Z)}),j}function y5(E,T){var j={};return T=On(T,3),Eu(E,function(Z,me,we){_h(j,me,T(Z,me,we))}),j}var v5=Cg(function(E,T,j){lE(E,T,j)}),f1=Cg(function(E,T,j,Z){lE(E,T,j,Z)}),m1=xh(function(E,T){var j={};if(E==null)return j;var Z=!1;T=Ii(T,function(we){return we=vh(we,E),Z||(Z=we.length>1),we}),Po(E,OS(E),j),Z&&(j=zc(j,C|A|O,Jj));for(var me=T.length;me--;)Up(j,T[me]);return j});function E5(E,T){return GE(E,ME(On(T)))}var g1=xh(function(E,T){return E==null?{}:Fj(E,T)});function GE(E,T){if(E==null)return{};var j=Ii(OS(E),function(Z){return[Z]});return T=On(T),zI(E,j,function(Z,me){return T(Z,me[0])})}function x5(E,T,j){T=vh(T,E);var Z=-1,me=T.length;for(me||(me=1,E=r);++Z<me;){var we=E==null?r:E[Id(T[Z])];we===r&&(Z=me,we=j),E=Tu(we)?we.call(E):we}return E}function b5(E,T,j){return E==null?E:jp(E,T,j)}function _1(E,T,j,Z){return Z=typeof Z=="function"?Z:r,E==null?E:jp(E,T,j,Z)}var y1=eA(qa),xT=eA(Do);function v1(E,T,j){var Z=ar(E),me=Z||wh(E)||Mg(E);if(T=On(T,4),j==null){var we=E&&E.constructor;me?j=Z?new we:[]:ns(E)?j=Tu(we)?Dp(zl(E)):{}:j={}}return(me?Ga:Eu)(E,function(Ae,Oe,ze){return T(j,Ae,Oe,ze)}),j}function w5(E,T){return E==null?!0:Up(E,T)}function S5(E,T,j){return E==null?E:hE(E,T,SS(j))}function T5(E,T,j,Z){return Z=typeof Z=="function"?Z:r,E==null?E:hE(E,T,SS(j),Z)}function Ug(E){return E==null?[]:Bi(E,qa(E))}function R5(E){return E==null?[]:Bi(E,Do(E))}function C5(E,T,j){return j===r&&(j=T,T=r),j!==r&&(j=Gl(j),j=j===j?j:0),T!==r&&(T=Gl(T),T=T===T?T:0),yh(Gl(E),T,j)}function E1(E,T,j){return T=Sh(T),j===r?(j=T,T=0):j=Sh(j),E=Gl(E),Aj(E,T,j)}function bT(E,T,j){if(j&&typeof j!="boolean"&&uc(E,T,j)&&(T=j=r),j===r&&(typeof T=="boolean"?(j=T,T=r):typeof E=="boolean"&&(j=E,E=r)),E===r&&T===r?(E=0,T=1):(E=Sh(E),T===r?(T=E,E=0):T=Sh(T)),E>T){var Z=E;E=T,T=Z}if(j||E%1||T%1){var me=nt();return ge(E+me*(T-E+za("1e-"+((me+"").length-1))),T)}return dE(E,T)}var x1=Ng(function(E,T,j){return T=T.toLowerCase(),E+(j?et(T):T)});function et(E){return WE(Ai(E).toLowerCase())}function b1(E){return E=Ai(E),E&&E.replace(jf,iS).replace(lg,"")}function N5(E,T,j){E=Ai(E),T=ko(T);var Z=E.length;j=j===r?Z:yh(Er(j),0,Z);var me=j;return j-=T.length,j>=0&&E.slice(j,me)==T}function I5(E){return E=Ai(E),E&&Ar.test(E)?E.replace(Nn,Yf):E}function A5(E){return E=Ai(E),E&&ah.test(E)?E.replace(fp,"\\$&"):E}var k5=Ng(function(E,T,j){return E+(j?"-":"")+T.toLowerCase()}),wT=Ng(function(E,T,j){return E+(j?" ":"")+T.toLowerCase()}),P5=Eh("toLowerCase");function D5(E,T,j){E=Ai(E),T=Er(T);var Z=T?Aa(E):0;if(!T||Z>=T)return E;var me=(T-Z)/2;return M0(Rd(me),j)+E+M0(Qf(me),j)}function pc(E,T,j){E=Ai(E),T=Er(T);var Z=T?Aa(E):0;return T&&Z<T?E+M0(T-Z,j):E}function w1(E,T,j){E=Ai(E),T=Er(T);var Z=T?Aa(E):0;return T&&Z<T?M0(T-Z,j)+E:E}function O5(E,T,j){return j||T==null?T=0:T&&(T=+T),Xe(Ai(E).replace(ec,""),T||0)}function S1(E,T,j){return(j?uc(E,T,j):T===r)?T=1:T=Er(T),xS(Ai(E),T)}function L5(){var E=arguments,T=Ai(E[0]);return E.length<3?T:T.replace(E[1],E[2])}var ST=Ng(function(E,T,j){return E+(j?"_":"")+T.toLowerCase()});function T1(E,T,j){return j&&typeof j!="number"&&uc(E,T,j)&&(T=j=r),j=j===r?Rt:j>>>0,j?(E=Ai(E),E&&(typeof T=="string"||T!=null&&!yT(T))&&(T=ko(T),!T&&Cp(E))?Vp(No(E),0,j):E.split(T,j)):[]}var R1=Ng(function(E,T,j){return E+(j?" ":"")+WE(T)});function j5(E,T,j){return E=Ai(E),j=j==null?0:yh(Er(j),0,E.length),T=ko(T),E.slice(j,j+T.length)==T}function M5(E,T,j){var Z=xe.templateSettings;j&&uc(E,T,j)&&(T=r),E=Ai(E),T=zE({},T,Z,bu);var me=zE({},T.imports,Z.imports,bu),we=qa(me),Ae=Bi(me,we),Oe,ze,gt=0,bt=T.interpolate||oh,At="__p += '",Gt=C0((T.escape||oh).source+"|"+bt.source+"|"+(bt===sh?gp:oh).source+"|"+(T.evaluate||oh).source+"|$","g"),En="//# sourceURL="+(Hr.call(T,"sourceURL")?(T.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++lu+"]")+`
`;E.replace(Gt,function(Gn,Fr,Br,co,lo,Hc){return Br||(Br=co),At+=E.slice(gt,Hc).replace(io,Co),Fr&&(Oe=!0,At+=`' +
__e(`+Fr+`) +
'`),lo&&(ze=!0,At+=`';
`+lo+`;
__p += '`),Br&&(At+=`' +
((__t = (`+Br+`)) == null ? '' : __t) +
'`),gt=Hc+Gn.length,Gn}),At+=`';
`;var Ln=Hr.call(T,"variable")&&T.variable;if(!Ln)At=`with (obj) {
`+At+`
}
`;else if(nu.test(Ln))throw new Zn(m);At=(ze?At.replace($t,""):At).replace(tr,"$1").replace(mi,"$1;"),At="function("+(Ln||"obj")+`) {
`+(Ln?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Oe?", __e = _.escape":"")+(ze?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+At+`return __p
}`;var jn=A1(function(){return si(we,En+"return "+At).apply(r,Ae)});if(jn.source=At,VE(jn))throw jn;return jn}function C1(E){return Ai(E).toLowerCase()}function U5(E){return Ai(E).toUpperCase()}function V5(E,T,j){if(E=Ai(E),E&&(j||T===r))return sr(E);if(!E||!(T=ko(T)))return E;var Z=No(E),me=No(T),we=fs(Z,me),Ae=wd(Z,me)+1;return Vp(Z,we,Ae).join("")}function N1(E,T,j){if(E=Ai(E),E&&(j||T===r))return E.slice(0,S0(E)+1);if(!E||!(T=ko(T)))return E;var Z=No(E),me=wd(Z,No(T))+1;return Vp(Z,0,me).join("")}function F5(E,T,j){if(E=Ai(E),E&&(j||T===r))return E.replace(ec,"");if(!E||!(T=ko(T)))return E;var Z=No(E),me=fs(Z,No(T));return Vp(Z,me).join("")}function B5(E,T){var j=de,Z=pe;if(ns(T)){var me="separator"in T?T.separator:me;j="length"in T?Er(T.length):j,Z="omission"in T?ko(T.omission):Z}E=Ai(E);var we=E.length;if(Cp(E)){var Ae=No(E);we=Ae.length}if(j>=we)return E;var Oe=j-Aa(Z);if(Oe<1)return Z;var ze=Ae?Vp(Ae,0,Oe).join(""):E.slice(0,Oe);if(me===r)return ze+Z;if(Ae&&(Oe+=ze.length-Oe),yT(me)){if(E.slice(Oe).search(me)){var gt,bt=ze;for(me.global||(me=C0(me.source,Ai(Oc.exec(me))+"g")),me.lastIndex=0;gt=me.exec(bt);)var At=gt.index;ze=ze.slice(0,At===r?Oe:At)}}else if(E.indexOf(ko(me),Oe)!=Oe){var Gt=ze.lastIndexOf(me);Gt>-1&&(ze=ze.slice(0,Gt))}return ze+Z}function I1(E){return E=Ai(E),E&&Ci.test(E)?E.replace(Wr,T0):E}var z5=Ng(function(E,T,j){return E+(j?" ":"")+T.toUpperCase()}),WE=Eh("toUpperCase");function HE(E,T,j){return E=Ai(E),T=j?r:T,T===r?uu(E)?fg(E):In(E):E.match(T)||[]}var A1=Dr(function(E,T){try{return Li(E,r,T)}catch(j){return VE(j)?j:new Zn(j)}}),G5=xh(function(E,T){return Ga(T,function(j){j=Id(j),_h(E,j,dT(E[j],E))}),E});function k1(E){var T=E==null?0:E.length,j=On();return E=T?Ii(E,function(Z){if(typeof Z[1]!="function")throw new ka(p);return[j(Z[0]),Z[1]]}):[],Dr(function(Z){for(var me=-1;++me<T;){var we=E[me];if(Li(we[0],this,Z))return Li(we[1],this,Z)}})}function W5(E){return AI(zc(E,C))}function KE(E){return function(){return E}}function P1(E,T){return E==null||E!==E?T:E}var qp=kS(),D1=kS(!0);function Wc(E){return E}function TT(E){return MI(typeof E=="function"?E:zc(E,C))}function H5(E){return VI(zc(E,C))}function K5(E,T){return FI(E,zc(T,C))}var O1=Dr(function(E,T){return function(j){return wg(j,E,T)}}),q5=Dr(function(E,T){return function(j){return wg(E,j,T)}});function RT(E,T,j){var Z=qa(T),me=sE(T,Z);j==null&&!(ns(T)&&(me.length||!Z.length))&&(j=T,T=E,E=this,me=sE(T,qa(T)));var we=!(ns(j)&&"chain"in j)||!!j.chain,Ae=Tu(E);return Ga(me,function(Oe){var ze=T[Oe];E[Oe]=ze,Ae&&(E.prototype[Oe]=function(){var gt=this.__chain__;if(we||gt){var bt=E(this.__wrapped__),At=bt.__actions__=dc(this.__actions__);return At.push({func:ze,args:arguments,thisArg:E}),bt.__chain__=gt,bt}return ze.apply(E,Vc([this.value()],arguments))})}),E}function Y5(){return xs._===this&&(xs._=oS),this}function Q0(){}function $5(E){return E=Er(E),Dr(function(T){return BI(T,E)})}var sm=PS(Ii),X5=PS(ul),J5=PS(sc);function L1(E){return Ag(E)?le(Id(E)):GI(E)}function Q5(E){return function(T){return E==null?r:nm(E,T)}}var j1=QI(),M1=QI(!0);function CT(){return[]}function NT(){return!1}function Z5(){return{}}function qE(){return""}function eU(){return!0}function IT(E,T){if(E=Er(E),E<1||E>Le)return[];var j=Rt,Z=ge(E,Rt);T=On(T),E-=Rt;for(var me=ii(Z,T);++j<E;)T(j);return me}function U1(E){return ar(E)?Ii(E,Id):yl(E)?[E]:dc(HS(Ai(E)))}function AT(E){var T=++aS;return Ai(E)+T}var tU=j0(function(E,T){return E+T},0),YE=DS("ceil"),Ad=j0(function(E,T){return E/T},1),Z0=DS("floor");function V1(E){return E&&E.length?rE(E,Wc,Op):r}function F1(E,T){return E&&E.length?rE(E,On(T,2),Op):r}function nU(E){return ee(E,Wc)}function rU(E,T){return ee(E,On(T,2))}function iU(E){return E&&E.length?rE(E,Wc,cE):r}function sU(E,T){return E&&E.length?rE(E,On(T,2),cE):r}var kT=j0(function(E,T){return E*T},1),B1=DS("round"),PT=j0(function(E,T){return E-T},0);function aU(E){return E&&E.length?Ut(E,Wc):0}function oU(E,T){return E&&E.length?Ut(E,On(T,2)):0}return xe.after=q0,xe.ary=GA,xe.assign=i5,xe.assignIn=l1,xe.assignInWith=zE,xe.assignWith=s5,xe.at=a5,xe.before=WA,xe.bind=dT,xe.bindAll=G5,xe.bindKey=HA,xe.castArray=FM,xe.chain=PA,xe.chunk=B0,xe.compact=hA,xe.concat=z0,xe.cond=k1,xe.conforms=W5,xe.constant=KE,xe.countBy=jA,xe.create=d1,xe.curry=LE,xe.curryRight=KA,xe.debounce=qA,xe.defaults=o5,xe.defaultsDeep=c5,xe.defer=jM,xe.delay=YA,xe.difference=kg,xe.differenceBy=pA,xe.differenceWith=KS,xe.drop=RE,xe.dropRight=lM,xe.dropRightWhile=dM,xe.dropWhile=uM,xe.fill=fA,xe.filter=im,xe.flatMap=IM,xe.flatMapDeep=AM,xe.flatMapDepth=kM,xe.flatten=_A,xe.flattenDeep=qS,xe.flattenDepth=Gp,xe.flip=uT,xe.flow=qp,xe.flowRight=D1,xe.fromPairs=hM,xe.functions=h5,xe.functionsIn=p5,xe.groupBy=cT,xe.initial=ml,xe.intersection=pM,xe.intersectionBy=fM,xe.intersectionWith=vA,xe.invert=m5,xe.invertBy=g5,xe.invokeMap=PM,xe.iteratee=TT,xe.keyBy=VA,xe.keys=qa,xe.keysIn=Do,xe.map=PE,xe.mapKeys=_5,xe.mapValues=y5,xe.matches=H5,xe.matchesProperty=K5,xe.memoize=jE,xe.merge=v5,xe.mergeWith=f1,xe.method=O1,xe.methodOf=q5,xe.mixin=RT,xe.negate=ME,xe.nthArg=$5,xe.omit=m1,xe.omitBy=E5,xe.once=MM,xe.orderBy=K0,xe.over=sm,xe.overArgs=$A,xe.overEvery=X5,xe.overSome=J5,xe.partial=Y0,xe.partialRight=hT,xe.partition=Su,xe.pick=g1,xe.pickBy=GE,xe.property=L1,xe.propertyOf=Q5,xe.pull=xA,xe.pullAll=bA,xe.pullAllBy=_M,xe.pullAllWith=yM,xe.pullAt=YS,xe.range=j1,xe.rangeRight=M1,xe.rearg=XA,xe.reject=OM,xe.remove=$S,xe.rest=UE,xe.reverse=XS,xe.sampleSize=BA,xe.set=b5,xe.setWith=_1,xe.shuffle=zA,xe.slice=JS,xe.sortBy=Hp,xe.sortedUniq=ZS,xe.sortedUniqBy=eT,xe.split=T1,xe.spread=JA,xe.tail=TA,xe.take=RA,xe.takeRight=CE,xe.takeRightWhile=CA,xe.takeWhile=xM,xe.tap=CM,xe.throttle=UM,xe.thru=NE,xe.toArray=a1,xe.toPairs=y1,xe.toPairsIn=xT,xe.toPath=U1,xe.toPlainObject=c1,xe.transform=v1,xe.unary=pT,xe.union=bM,xe.unionBy=NA,xe.unionWith=IA,xe.uniq=Pg,xe.uniqBy=tT,xe.uniqWith=nT,xe.unset=w5,xe.unzip=W0,xe.unzipWith=rT,xe.update=S5,xe.updateWith=T5,xe.values=Ug,xe.valuesIn=R5,xe.without=AA,xe.words=HE,xe.wrap=VM,xe.xor=wM,xe.xorBy=SM,xe.xorWith=Dg,xe.zip=TM,xe.zipObject=kA,xe.zipObjectDeep=iT,xe.zipWith=RM,xe.entries=y1,xe.entriesIn=xT,xe.extend=l1,xe.extendWith=zE,RT(xe,xe),xe.add=tU,xe.attempt=A1,xe.camelCase=x1,xe.capitalize=et,xe.ceil=YE,xe.clamp=C5,xe.clone=$0,xe.cloneDeep=QA,xe.cloneDeepWith=mT,xe.cloneWith=fT,xe.conformsTo=gT,xe.deburr=b1,xe.defaultTo=P1,xe.divide=Ad,xe.endsWith=N5,xe.eq=_l,xe.escape=I5,xe.escapeRegExp=A5,xe.every=Og,xe.find=NM,xe.findIndex=mA,xe.findKey=l5,xe.findLast=H0,xe.findLastIndex=gA,xe.findLastKey=d5,xe.floor=Z0,xe.forEach=MA,xe.forEachRight=oT,xe.forIn=u5,xe.forInRight=u1,xe.forOwn=vT,xe.forOwnRight=h1,xe.get=J0,xe.gt=BM,xe.gte=zM,xe.has=f5,xe.hasIn=ET,xe.head=Wp,xe.identity=Wc,xe.includes=UA,xe.indexOf=yA,xe.inRange=E1,xe.invoke=p1,xe.isArguments=Kp,xe.isArray=ar,xe.isArrayBuffer=ZA,xe.isArrayLike=hc,xe.isArrayLikeObject=Ws,xe.isBoolean=GM,xe.isBuffer=wh,xe.isDate=WM,xe.isElement=Lg,xe.isEmpty=jg,xe.isEqual=_T,xe.isEqualWith=e1,xe.isError=VE,xe.isFinite=HM,xe.isFunction=Tu,xe.isInteger=t1,xe.isLength=FE,xe.isMap=n1,xe.isMatch=KM,xe.isMatchWith=qM,xe.isNaN=YM,xe.isNative=$M,xe.isNil=JM,xe.isNull=XM,xe.isNumber=r1,xe.isObject=ns,xe.isObjectLike=Hs,xe.isPlainObject=X0,xe.isRegExp=yT,xe.isSafeInteger=QM,xe.isSet=i1,xe.isString=BE,xe.isSymbol=yl,xe.isTypedArray=Mg,xe.isUndefined=s1,xe.isWeakMap=ZM,xe.isWeakSet=e5,xe.join=mM,xe.kebabCase=k5,xe.last=gl,xe.lastIndexOf=EA,xe.lowerCase=wT,xe.lowerFirst=P5,xe.lt=t5,xe.lte=n5,xe.max=V1,xe.maxBy=F1,xe.mean=nU,xe.meanBy=rU,xe.min=iU,xe.minBy=sU,xe.stubArray=CT,xe.stubFalse=NT,xe.stubObject=Z5,xe.stubString=qE,xe.stubTrue=eU,xe.multiply=kT,xe.nth=gM,xe.noConflict=Y5,xe.noop=Q0,xe.now=OE,xe.pad=D5,xe.padEnd=pc,xe.padStart=w1,xe.parseInt=O5,xe.random=bT,xe.reduce=FA,xe.reduceRight=DM,xe.repeat=S1,xe.replace=L5,xe.result=x5,xe.round=B1,xe.runInContext=Ve,xe.sample=lT,xe.size=LM,xe.snakeCase=ST,xe.some=DE,xe.sortedIndex=vM,xe.sortedIndexBy=wA,xe.sortedIndexOf=EM,xe.sortedLastIndex=QS,xe.sortedLastIndexBy=G0,xe.sortedLastIndexOf=SA,xe.startCase=R1,xe.startsWith=j5,xe.subtract=PT,xe.sum=aU,xe.sumBy=oU,xe.template=M5,xe.times=IT,xe.toFinite=Sh,xe.toInteger=Er,xe.toLength=o1,xe.toLower=C1,xe.toNumber=Gl,xe.toSafeInteger=r5,xe.toString=Ai,xe.toUpper=U5,xe.trim=V5,xe.trimEnd=N1,xe.trimStart=F5,xe.truncate=B5,xe.unescape=I1,xe.uniqueId=AT,xe.upperCase=z5,xe.upperFirst=WE,xe.each=MA,xe.eachRight=oT,xe.first=Wp,RT(xe,function(){var E={};return Eu(xe,function(T,j){Hr.call(xe.prototype,j)||(E[j]=T)}),E}(),{chain:!1}),xe.VERSION=a,Ga(["bind","bindKey","curry","curryRight","partial","partialRight"],function(E){xe[E].placeholder=xe}),Ga(["drop","take"],function(E,T){Pr.prototype[E]=function(j){j=j===r?1:ae(Er(j),0);var Z=this.__filtered__&&!T?new Pr(this):this.clone();return Z.__filtered__?Z.__takeCount__=ge(j,Z.__takeCount__):Z.__views__.push({size:ge(j,Rt),type:E+(Z.__dir__<0?"Right":"")}),Z},Pr.prototype[E+"Right"]=function(j){return this.reverse()[E](j).reverse()}}),Ga(["filter","map","takeWhile"],function(E,T){var j=T+1,Z=j==Ze||j==St;Pr.prototype[E]=function(me){var we=this.clone();return we.__iteratees__.push({iteratee:On(me,3),type:j}),we.__filtered__=we.__filtered__||Z,we}}),Ga(["head","last"],function(E,T){var j="take"+(T?"Right":"");Pr.prototype[E]=function(){return this[j](1).value()[0]}}),Ga(["initial","tail"],function(E,T){var j="drop"+(T?"":"Right");Pr.prototype[E]=function(){return this.__filtered__?new Pr(this):this[j](1)}}),Pr.prototype.compact=function(){return this.filter(Wc)},Pr.prototype.find=function(E){return this.filter(E).head()},Pr.prototype.findLast=function(E){return this.reverse().find(E)},Pr.prototype.invokeMap=Dr(function(E,T){return typeof E=="function"?new Pr(this):this.map(function(j){return wg(j,E,T)})}),Pr.prototype.reject=function(E){return this.filter(ME(On(E)))},Pr.prototype.slice=function(E,T){E=Er(E);var j=this;return j.__filtered__&&(E>0||T<0)?new Pr(j):(E<0?j=j.takeRight(-E):E&&(j=j.drop(E)),T!==r&&(T=Er(T),j=T<0?j.dropRight(-T):j.take(T-E)),j)},Pr.prototype.takeRightWhile=function(E){return this.reverse().takeWhile(E).reverse()},Pr.prototype.toArray=function(){return this.take(Rt)},Eu(Pr.prototype,function(E,T){var j=/^(?:filter|find|map|reject)|While$/.test(T),Z=/^(?:head|last)$/.test(T),me=xe[Z?"take"+(T=="last"?"Right":""):T],we=Z||/^find/.test(T);me&&(xe.prototype[T]=function(){var Ae=this.__wrapped__,Oe=Z?[1]:arguments,ze=Ae instanceof Pr,gt=Oe[0],bt=ze||ar(Ae),At=function(Fr){var Br=me.apply(xe,Vc([Fr],Oe));return Z&&Gt?Br[0]:Br};bt&&j&&typeof gt=="function"&&gt.length!=1&&(ze=bt=!1);var Gt=this.__chain__,En=!!this.__actions__.length,Ln=we&&!Gt,jn=ze&&!En;if(!we&&bt){Ae=jn?Ae:new Pr(this);var Gn=E.apply(Ae,Oe);return Gn.__actions__.push({func:NE,args:[At],thisArg:r}),new Io(Gn,Gt)}return Ln&&jn?E.apply(this,Oe):(Gn=this.thru(At),Ln?Z?Gn.value()[0]:Gn.value():Gn)})}),Ga(["pop","push","shift","sort","splice","unshift"],function(E){var T=Ip[E],j=/^(?:push|sort|unshift)$/.test(E)?"tap":"thru",Z=/^(?:pop|shift)$/.test(E);xe.prototype[E]=function(){var me=arguments;if(Z&&!this.__chain__){var we=this.value();return T.apply(ar(we)?we:[],me)}return this[j](function(Ae){return T.apply(ar(Ae)?Ae:[],me)})}}),Eu(Pr.prototype,function(E,T){var j=xe[T];if(j){var Z=j.name+"";Hr.call(pl,Z)||(pl[Z]=[]),pl[Z].push({name:T,func:j})}}),pl[gE(r,W).name]=[{name:"wrapper",func:r}],Pr.prototype.clone=dS,Pr.prototype.reverse=aj,Pr.prototype.value=Zv,xe.prototype.at=sT,xe.prototype.chain=DA,xe.prototype.commit=OA,xe.prototype.next=LA,xe.prototype.plant=aT,xe.prototype.reverse=AE,xe.prototype.toJSON=xe.prototype.valueOf=xe.prototype.value=kE,xe.prototype.first=xe.prototype.head,Pp&&(xe.prototype[Pp]=IE),xe},Sd=zs();Ns?((Ns.exports=Sd)._=Sd,_i._=Sd):xs._=Sd}).call(_f)})(SO,SO.exports);var Ipe=SO.exports;const tUe=()=>{const t=yr(),[e]=Dw(),{user:r,setUser:a,language:l,setLanguage:u}=Jr();ag();const[p,m]=V.useState("language"),[v,w]=V.useState(!1),[R,C]=V.useState(!1),[A,O]=V.useState(!1),[U,F]=V.useState(!1),[q,W]=V.useState(!0),[H,X]=V.useState(0),[ne,te]=V.useState(""),[he,J]=V.useState(!1),[Q,ce]=V.useState("idle"),[de,pe]=V.useState(null),[be,ye]=V.useState(null),[Ze,It]=V.useState((r==null?void 0:r.username)||""),[St,lt]=V.useState((r==null?void 0:r.displayName)||""),[Le,Me]=V.useState(""),[Ke,Rt]=V.useState(""),[rt,mt]=V.useState(""),[yt,Ct]=V.useState(""),[Ot,vt]=V.useState(""),[zt,ln]=V.useState(!1),[Pn,ni]=V.useState(!1),[pr,nn]=V.useState(null),[ri,un]=V.useState(null),ui=new Date().getFullYear(),Cs=Array.from({length:80},(Lt,Ir)=>ui-18-Ir),Jn=Array.from({length:31},(Lt,Ir)=>Ir+1),ds=[{value:1,label:"Januar"},{value:2,label:"Februar"},{value:3,label:"Mrz"},{value:4,label:"April"},{value:5,label:"Mai"},{value:6,label:"Juni"},{value:7,label:"Juli"},{value:8,label:"August"},{value:9,label:"September"},{value:10,label:"Oktober"},{value:11,label:"November"},{value:12,label:"Dezember"}];V.useEffect(()=>{const Lt=e.get("ref")||e.get("code")||e.get("invite");if(Lt){const Ir=Lt.trim().toUpperCase().replace(/\s+/g,"");te(Ir),Ra(Ir)}},[e]);const Ra=async Lt=>{var We;const Ir=Lt.trim().toUpperCase().replace(/\s+/g,"");if(!Ir||Ir.length<5){ce("idle"),pe(null);return}J(!0),pe(null);try{const $t=await upe(Ir);if($t){const{ownerId:tr,link:mi}=$t;tr===(r==null?void 0:r.id)?(ce("invalid"),pe(" Du kannst deinen eigenen Code nicht verwenden")):mi.usedBy?(ce("invalid"),pe(" Dieser Code wurde bereits eingelst")):mi.isActive===!1?(ce("invalid"),pe(" Dieser Code wurde deaktiviert")):(ce("valid"),ye(tr),pe(null))}else ce("invalid"),pe(" Code nicht gefunden oder bereits vollstndig eingelst")}catch($t){console.error("Error checking invite code:",$t),ce("invalid"),($t==null?void 0:$t.code)==="unavailable"||(We=$t==null?void 0:$t.message)!=null&&We.includes("network")?pe(" Server nicht erreichbar - bitte spter erneut versuchen"):($t==null?void 0:$t.code)==="permission-denied"?pe(" Zugriff verweigert - Code konnte nicht geprft werden"):pe(" Verbindungsfehler - bitte erneut versuchen")}finally{J(!1)}},us=Lt=>{const We=Lt.trim().toUpperCase().replace(/[^A-Z0-9-\s]/g,"").replace(/\s+/g,"");te(We),ce("idle"),pe(null),We.length>=5&&Ra(We)},ro=V.useCallback(Ipe.debounce(async Lt=>{if(!Lt||Lt.length<3){nn(null),un(Lt.length>0?"Mindestens 3 Zeichen":null);return}if(Lt.length>20){nn(!1),un("Maximal 20 Zeichen");return}if(!/^[a-z0-9_]+$/.test(Lt)){nn(!1),un("Nur Kleinbuchstaben, Zahlen & Unterstriche");return}if(["admin","synclulu","support","help","system","mod","moderator"].includes(Lt)){nn(!1),un("Dieser Username ist reserviert");return}ni(!0),un(null);try{const We=mn(De,"users"),$t=Mr(We,Kn("username","==",Lt)),tr=await Cr($t),mi=tr.empty||tr.docs.every(Wr=>Wr.id===(r==null?void 0:r.id));nn(mi),mi||un("Username bereits vergeben")}catch(We){console.error("Error checking username:",We),un("Prfung fehlgeschlagen"),nn(null)}finally{ni(!1)}},500),[r==null?void 0:r.id]),Fa=Lt=>{const Ir=Lt.toLowerCase().replace(/[^a-z0-9_]/g,"");It(Ir),nn(null),un(null),Ir&&ro(Ir)},hi=[{icon:c.jsx(Xo,{size:64,className:"text-synclulu-violet"}),title:"Willkommen in der Wolke",description:"synclulu verbindet dich mit Menschen in deiner Nhe ber Voice-Chat. Tippe auf die Wolke um loszulegen."},{icon:c.jsx(no,{size:64,className:"text-green-500"}),title:"Hyperlokal",description:"Du siehst nur Menschen im Umkreis von max. 500m. Echte Nachbarn, echte Gesprche."},{icon:c.jsx(Pl,{size:64,className:"text-purple-500"}),title:"Anonym oder Offen",description:'Du entscheidest bei jedem Chat ob du als du selbst oder als "Wanderer" anonym bleibst.'},{icon:c.jsx(yo,{size:64,className:"text-blue-500"}),title:"Privacy First",description:"Deine Daten gehren dir. Kein Tracking, keine Algorithmen. Du hast die volle Kontrolle."},{icon:c.jsx(cr,{size:64,className:"text-amber-500"}),title:"Community Regeln",description:"Respekt ist Pflicht. Belstigung, Hate Speech und unangemessenes Verhalten fhren zum Ausschluss."}],So=Lt=>{u(Lt),localStorage.setItem("synclulu-language",Lt)},Ri=()=>{m("invite")},Gr=()=>{m("age")},Ca=()=>{v&&m("terms")},Ac=()=>{R&&A&&U&&m(q?"tutorial":"profile")},kc=()=>{H<hi.length-1?X(H+1):m("profile")},Pc=()=>{m("profile")},Ba=()=>{if(!Ke||!rt||!yt)return!1;const Lt=parseInt(Ke),Ir=parseInt(rt),We=parseInt(yt),$t=new Date(We,Ir-1,Lt);if($t.getDate()!==Lt||$t.getMonth()!==Ir-1||$t.getFullYear()!==We)return!1;const tr=new Date;return tr.getFullYear()-We-(tr.getMonth()<Ir-1||tr.getMonth()===Ir-1&&tr.getDate()<Lt?1:0)>=18},Dc=async()=>{if(!(!r||!Ze.trim()||!pr||!Ba())){ln(!0);try{const Lt=new Date(parseInt(yt),parseInt(rt)-1,parseInt(Ke)),Ir={username:Ze.trim().toLowerCase().replace(/\s+/g,"_"),displayName:St.trim()||Ze.trim(),bio:Le.trim(),birthDate:Lt,birthDay:parseInt(Ke),birthMonth:parseInt(rt),birthYear:parseInt(yt),showBirthdateOnProfile:!0,city:Ot.trim(),language:l,onboardingCompleted:!0,onboardingCompletedAt:new Date,isOver18Verified:!0,termsAcceptedAt:new Date,privacyAcceptedAt:new Date,communityGuidelinesAcceptedAt:new Date,usernameLastChanged:new Date,usernameChangeCount:0};if(await Xn(tt(De,"users",r.id),Ir),Q==="valid"&&ne&&be)try{(await hpe(ne,r.id,Ze)).success&&console.log("Referral code applied successfully")}catch(We){console.error("Error applying referral code:",We)}else try{await VL(r.id)}catch(We){console.error("Error initializing referrals:",We)}a({...r,...Ir}),t("/")}catch(Lt){console.error("Error saving profile:",Lt)}finally{ln(!1)}}},ia=Ze.trim()&&pr&&!Pn&&Ba();return c.jsxs("div",{className:"min-h-screen page-gradient theme-transition flex flex-col",children:[c.jsx("div",{className:"px-6 pt-6",children:c.jsx("div",{className:"flex gap-2",children:["language","invite","age","terms","tutorial","profile"].map((Lt,Ir)=>c.jsx("div",{className:`h-1 flex-1 rounded-full transition-colors ${["language","invite","age","terms","tutorial","profile"].indexOf(p)>=Ir?"bg-synclulu-violet":"bg-[var(--synclulu-surface)]"}`},Lt))})}),p==="language"&&c.jsxs("div",{className:"flex-1 flex flex-col px-6 py-8",children:[c.jsxs("div",{className:"flex-1",children:[c.jsx("div",{className:"flex items-center justify-center gap-3 mb-6",children:c.jsx("div",{className:"w-16 h-16 rounded-full bg-synclulu-violet/10 flex items-center justify-center",children:c.jsx(Mv,{size:32,className:"text-synclulu-violet"})})}),c.jsx("h1",{className:"font-display text-2xl font-bold text-synclulu-text text-center mb-2",children:"Whle deine Sprache"}),c.jsx("p",{className:"text-synclulu-muted text-center mb-6",children:"Choose your language"}),c.jsx("div",{className:"space-y-3",children:Object.keys(Wd).map(Lt=>c.jsxs("button",{onClick:()=>So(Lt),className:`w-full flex items-center gap-4 p-4 rounded-2xl border-2 transition-all ${l===Lt?"border-synclulu-violet bg-synclulu-violet/5":"border-[var(--synclulu-border)] hover:border-[var(--synclulu-border)]"}`,children:[c.jsx("span",{className:"text-2xl",children:Wd[Lt].flag}),c.jsxs("div",{className:"flex-1 text-left",children:[c.jsx("p",{className:"font-semibold text-synclulu-text",children:Wd[Lt].native}),c.jsx("p",{className:"text-xs text-synclulu-muted",children:Wd[Lt].name})]}),l===Lt&&c.jsx(_r,{size:20,className:"text-synclulu-violet"})]},Lt))})]}),c.jsx("button",{onClick:Ri,className:"w-full py-4 bg-synclulu-violet text-white font-bold rounded-xl transition-opacity",children:"Weiter"})]}),p==="invite"&&c.jsxs("div",{className:"flex-1 flex flex-col px-6 py-8",children:[c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[c.jsx("button",{onClick:()=>m("language"),className:"p-2 -m-2",children:c.jsx(dd,{size:24,className:"text-synclulu-muted"})}),c.jsx("h1",{className:"font-display text-2xl font-bold text-synclulu-text",children:"Einladungscode"})]}),c.jsx("div",{className:"flex items-center justify-center mb-6",children:c.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center shadow-lg shadow-purple-500/30",children:c.jsx(_o,{size:40,className:"text-white"})})}),c.jsx("p",{className:"text-synclulu-muted text-center mb-6",children:"Hast du einen Einladungscode von einem Freund erhalten? Gib ihn hier ein um Bonus-XP zu erhalten!"}),c.jsxs("div",{className:"mb-6",children:[c.jsx("label",{className:"block text-sm font-semibold text-synclulu-text mb-2",children:"Einladungscode (optional)"}),c.jsxs("div",{className:"relative",children:[c.jsx(z5e,{size:20,className:"absolute left-4 top-1/2 -translate-y-1/2 text-synclulu-muted"}),c.jsx("input",{type:"text",value:ne,onChange:Lt=>us(Lt.target.value),placeholder:"z.B. synclulu-ABC12",maxLength:15,className:`w-full pl-12 pr-12 py-4 border-2 rounded-xl focus:outline-none transition-colors font-mono text-lg tracking-wider ${Q==="valid"?"border-green-400 bg-green-50 focus:border-green-500":Q==="invalid"?"border-red-300 bg-red-50 focus:border-red-500":"border-[var(--synclulu-border)] focus:border-synclulu-violet"}`}),c.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2",children:he?c.jsx(fi,{size:20,className:"text-[var(--synclulu-muted)] animate-spin"}):Q==="valid"?c.jsx(_r,{size:20,className:"text-green-500"}):Q==="invalid"?c.jsx(Di,{size:20,className:"text-red-500"}):null})]}),de&&c.jsx("p",{className:"text-red-500 text-sm mt-2",children:de}),Q==="valid"&&c.jsx("div",{className:"mt-3 p-3 bg-green-100 rounded-xl border border-green-200",children:c.jsxs("p",{className:"text-green-800 text-sm font-medium flex items-center gap-2",children:[c.jsx(kn,{size:16}),"Code gltig! Du erhltst 125 Bonus-XP bei der Registrierung."]})})]}),c.jsx("div",{className:"p-4 bg-purple-50 rounded-2xl",children:c.jsxs("p",{className:"text-sm text-purple-800",children:[c.jsx("strong",{children:" Tipp:"})," Ohne Einladungscode kannst du dich trotzdem registrieren. Nach der Registrierung erhltst du eigene Einladungscodes zum Teilen!"]})})]}),c.jsx("button",{onClick:Gr,className:"w-full py-4 bg-synclulu-violet text-white font-bold rounded-xl transition-opacity flex items-center justify-center gap-2",children:Q==="valid"?c.jsxs(c.Fragment,{children:[c.jsx(_r,{size:20}),"Weiter mit Code"]}):"Weiter ohne Code"})]}),p==="age"&&c.jsxs("div",{className:"flex-1 flex flex-col px-6 py-8",children:[c.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-center",children:[c.jsx("div",{className:"w-20 h-20 rounded-full bg-amber-100 flex items-center justify-center mb-6",children:c.jsx(rh,{size:40,className:"text-amber-600"})}),c.jsx("h1",{className:"font-display text-2xl font-bold text-synclulu-text mb-4",children:"Altersverifikation"}),c.jsx("p",{className:"text-synclulu-muted mb-8 max-w-sm",children:"synclulu ist eine Plattform fr Erwachsene. Du musst mindestens 18 Jahre alt sein um die App zu nutzen."}),c.jsxs("label",{className:"flex items-start gap-3 p-4 bg-[var(--synclulu-card)] rounded-xl border-2 border-[var(--synclulu-border)] cursor-pointer mb-6 text-left max-w-sm",children:[c.jsx("input",{type:"checkbox",checked:v,onChange:Lt=>w(Lt.target.checked),className:"mt-1 w-5 h-5 rounded border-[var(--synclulu-border)] text-synclulu-violet focus:ring-synclulu-violet"}),c.jsxs("div",{children:[c.jsx("p",{className:"font-semibold text-synclulu-text",children:"Ich besttige, dass ich 18 Jahre oder lter bin"}),c.jsx("p",{className:"text-sm text-synclulu-muted mt-1",children:"Falsche Angaben fhren zur sofortigen Sperrung des Accounts."})]})]}),c.jsx("p",{className:"text-xs text-synclulu-muted max-w-sm",children:"Bei Verdacht auf Minderjhrigkeit kann eine ID-Verifikation angefordert werden."})]}),c.jsxs("div",{className:"flex gap-3",children:[c.jsx("button",{onClick:()=>m("invite"),className:"py-4 px-6 border-2 border-[var(--synclulu-border)] text-synclulu-muted font-semibold rounded-xl",children:c.jsx(dd,{size:20})}),c.jsx("button",{onClick:Ca,disabled:!v,className:"flex-1 py-4 bg-synclulu-violet text-white font-bold rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-opacity",children:"Weiter"})]})]}),p==="terms"&&c.jsxs("div",{className:"flex-1 flex flex-col px-6 py-8",children:[c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[c.jsx("button",{onClick:()=>m("age"),className:"p-2 -m-2",children:c.jsx(dd,{size:24,className:"text-synclulu-muted"})}),c.jsx("h1",{className:"font-display text-2xl font-bold text-synclulu-text",children:"Nutzungsbedingungen"})]}),c.jsx("p",{className:"text-synclulu-muted mb-6",children:"Bitte lies und akzeptiere unsere Richtlinien um fortzufahren."}),c.jsxs("div",{className:"space-y-4 mb-6",children:[c.jsxs("label",{className:"flex items-start gap-3 p-4 bg-[var(--synclulu-card)] rounded-xl border-2 border-[var(--synclulu-border)] cursor-pointer",children:[c.jsx("input",{type:"checkbox",checked:R,onChange:Lt=>C(Lt.target.checked),className:"mt-1 w-5 h-5 rounded border-[var(--synclulu-border)] text-synclulu-violet focus:ring-synclulu-violet"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("p",{className:"font-semibold text-synclulu-text",children:"AGB akzeptieren"}),c.jsxs("p",{className:"text-sm text-synclulu-muted",children:["Ich habe die"," ",c.jsx("a",{href:"/impressum",className:"text-synclulu-violet underline",children:"Allgemeinen Geschftsbedingungen"})," ","gelesen und akzeptiere diese."]})]})]}),c.jsxs("label",{className:"flex items-start gap-3 p-4 bg-[var(--synclulu-card)] rounded-xl border-2 border-[var(--synclulu-border)] cursor-pointer",children:[c.jsx("input",{type:"checkbox",checked:A,onChange:Lt=>O(Lt.target.checked),className:"mt-1 w-5 h-5 rounded border-[var(--synclulu-border)] text-synclulu-violet focus:ring-synclulu-violet"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("p",{className:"font-semibold text-synclulu-text",children:"Datenschutz akzeptieren"}),c.jsxs("p",{className:"text-sm text-synclulu-muted",children:["Ich habe die"," ",c.jsx("a",{href:"/datenschutz",className:"text-synclulu-violet underline",children:"Datenschutzerklrung"})," ","gelesen und akzeptiere diese."]})]})]}),c.jsxs("label",{className:"flex items-start gap-3 p-4 bg-[var(--synclulu-card)] rounded-xl border-2 border-[var(--synclulu-border)] cursor-pointer",children:[c.jsx("input",{type:"checkbox",checked:U,onChange:Lt=>F(Lt.target.checked),className:"mt-1 w-5 h-5 rounded border-[var(--synclulu-border)] text-synclulu-violet focus:ring-synclulu-violet"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("p",{className:"font-semibold text-synclulu-text",children:"Community-Regeln akzeptieren"}),c.jsx("p",{className:"text-sm text-synclulu-muted",children:"Ich verpflichte mich zu respektvollem Umgang. Belstigung, Hate Speech und unangemessenes Verhalten sind verboten."})]})]})]}),c.jsxs("label",{className:"flex items-center gap-3 p-4 bg-purple-50 rounded-xl cursor-pointer",children:[c.jsx("input",{type:"checkbox",checked:q,onChange:Lt=>W(Lt.target.checked),className:"w-5 h-5 rounded border-[var(--synclulu-border)] text-synclulu-violet focus:ring-synclulu-violet"}),c.jsxs("div",{children:[c.jsx("p",{className:"font-semibold text-synclulu-text",children:"App-Einfhrung anzeigen"}),c.jsx("p",{className:"text-sm text-synclulu-muted",children:"Kurze Erklrung wie synclulu funktioniert"})]})]})]}),c.jsx("button",{onClick:Ac,disabled:!R||!A||!U,className:"w-full py-4 bg-synclulu-violet text-white font-bold rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-opacity",children:"Weiter"})]}),p==="tutorial"&&c.jsxs("div",{className:"flex-1 flex flex-col px-6 py-8",children:[c.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-center",children:[c.jsx("div",{className:"mb-8",children:hi[H].icon}),c.jsx("h2",{className:"font-display text-2xl font-bold text-synclulu-text mb-4",children:hi[H].title}),c.jsx("p",{className:"text-synclulu-muted max-w-sm mb-8",children:hi[H].description}),c.jsx("div",{className:"flex gap-2",children:hi.map((Lt,Ir)=>c.jsx("div",{className:`w-2 h-2 rounded-full transition-colors ${Ir===H?"bg-synclulu-violet w-6":"bg-[var(--synclulu-border)]"}`},Ir))})]}),c.jsxs("div",{className:"flex gap-3",children:[c.jsx("button",{onClick:Pc,className:"flex-1 py-4 border-2 border-[var(--synclulu-border)] text-synclulu-muted font-semibold rounded-xl",children:"berspringen"}),c.jsx("button",{onClick:kc,className:"flex-1 py-4 bg-synclulu-violet text-white font-bold rounded-xl flex items-center justify-center gap-2",children:H<hi.length-1?c.jsxs(c.Fragment,{children:["Weiter ",c.jsx(Fi,{size:20})]}):c.jsxs(c.Fragment,{children:["Los geht's ",c.jsx(kn,{size:20})]})})]})]}),p==="profile"&&c.jsxs("div",{className:"flex-1 flex flex-col px-6 py-8 overflow-y-auto",children:[c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[c.jsx("button",{onClick:()=>m("tutorial"),className:"p-2 -m-2",children:c.jsx(dd,{size:24,className:"text-synclulu-muted"})}),c.jsx("h1",{className:"font-display text-2xl font-bold text-synclulu-text",children:"Dein Profil"})]}),c.jsx("p",{className:"text-synclulu-muted mb-6",children:"Richte dein Profil ein. Du kannst diese Angaben spter jederzeit ndern."}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-semibold text-synclulu-text mb-2",children:"Benutzername *"}),c.jsxs("div",{className:"relative",children:[c.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-synclulu-muted",children:"@"}),c.jsx("input",{type:"text",value:Ze,onChange:Lt=>Fa(Lt.target.value),placeholder:"dein_name",maxLength:20,className:`w-full pl-8 pr-12 py-3 border-2 rounded-xl focus:outline-none transition-colors ${ri?"border-red-300 focus:border-red-500":pr?"border-green-300 focus:border-green-500":"border-[var(--synclulu-border)] focus:border-synclulu-violet"}`}),c.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2",children:Pn?c.jsx(fi,{size:20,className:"text-[var(--synclulu-muted)] animate-spin"}):pr===!0?c.jsx(_r,{size:20,className:"text-green-500"}):pr===!1?c.jsx(Di,{size:20,className:"text-red-500"}):null})]}),ri&&c.jsx("p",{className:"text-red-500 text-xs mt-1",children:ri}),pr&&c.jsxs("p",{className:"text-green-600 text-xs mt-1",children:[" @",Ze," ist verfgbar"]}),c.jsx("p",{className:"text-xs text-synclulu-muted mt-1",children:"Einzigartig, nur Kleinbuchstaben, Zahlen & Unterstriche"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-semibold text-synclulu-text mb-2",children:"Anzeigename"}),c.jsx("input",{type:"text",value:St,onChange:Lt=>lt(Lt.target.value),placeholder:"Wie sollen dich andere sehen?",maxLength:30,className:"w-full px-4 py-3 border-2 border-[var(--synclulu-border)] rounded-xl focus:border-synclulu-violet focus:outline-none"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-semibold text-synclulu-text mb-2",children:"Geburtsdatum *"}),c.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[c.jsxs("select",{value:Ke,onChange:Lt=>Rt(Lt.target.value),className:"px-3 py-3 border-2 border-[var(--synclulu-border)] rounded-xl focus:border-synclulu-violet focus:outline-none bg-[var(--synclulu-card)]",children:[c.jsx("option",{value:"",children:"Tag"}),Jn.map(Lt=>c.jsx("option",{value:Lt,children:Lt},Lt))]}),c.jsxs("select",{value:rt,onChange:Lt=>mt(Lt.target.value),className:"px-3 py-3 border-2 border-[var(--synclulu-border)] rounded-xl focus:border-synclulu-violet focus:outline-none bg-[var(--synclulu-card)]",children:[c.jsx("option",{value:"",children:"Monat"}),ds.map(Lt=>c.jsx("option",{value:Lt.value,children:Lt.label},Lt.value))]}),c.jsxs("select",{value:yt,onChange:Lt=>Ct(Lt.target.value),className:"px-3 py-3 border-2 border-[var(--synclulu-border)] rounded-xl focus:border-synclulu-violet focus:outline-none bg-[var(--synclulu-card)]",children:[c.jsx("option",{value:"",children:"Jahr"}),Cs.map(Lt=>c.jsx("option",{value:Lt,children:Lt},Lt))]})]}),Ke&&rt&&yt&&!Ba()&&c.jsx("p",{className:"text-red-500 text-xs mt-1",children:"Du musst mindestens 18 Jahre alt sein"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-semibold text-synclulu-text mb-2",children:"Stadt / Region"}),c.jsx("input",{type:"text",value:Ot,onChange:Lt=>vt(Lt.target.value),placeholder:"z.B. Berlin, Mnchen...",maxLength:50,className:"w-full px-4 py-3 border-2 border-[var(--synclulu-border)] rounded-xl focus:border-synclulu-violet focus:outline-none"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-semibold text-synclulu-text mb-2",children:"ber dich"}),c.jsx("textarea",{value:Le,onChange:Lt=>Me(Lt.target.value),placeholder:"Erzhl etwas ber dich... (optional)",maxLength:200,rows:3,className:"w-full px-4 py-3 border-2 border-[var(--synclulu-border)] rounded-xl focus:border-synclulu-violet focus:outline-none resize-none"}),c.jsxs("p",{className:"text-xs text-synclulu-muted mt-1 text-right",children:[Le.length,"/200"]})]})]})]}),c.jsx("button",{onClick:Dc,disabled:!ia||zt,className:"w-full py-4 bg-synclulu-violet text-white font-bold rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-opacity flex items-center justify-center gap-2 mt-6",children:zt?c.jsxs(c.Fragment,{children:[c.jsx(fi,{size:20,className:"animate-spin"}),"Speichern..."]}):c.jsxs(c.Fragment,{children:[c.jsx(Sm,{size:20}),"Profil speichern & starten"]})})]})]})},RW=V.createContext({});function yI(t){const e=V.useRef(null);return e.current===null&&(e.current=t()),e.current}const Ape=typeof window<"u",CW=Ape?V.useLayoutEffect:V.useEffect,HL=V.createContext(null);function NW(t,e){t.indexOf(e)===-1&&t.push(e)}function IW(t,e){const r=t.indexOf(e);r>-1&&t.splice(r,1)}const kf=(t,e,r)=>r>e?e:r<t?t:r;let AW=()=>{};const Xm={},kpe=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function Ppe(t){return typeof t=="object"&&t!==null}const Dpe=t=>/^0[^.\s]+$/u.test(t);function kW(t){let e;return()=>(e===void 0&&(e=t()),e)}const eh=t=>t,nUe=(t,e)=>r=>e(t(r)),vI=(...t)=>t.reduce(nUe),kN=(t,e,r)=>{const a=e-t;return a===0?1:(r-t)/a};class PW{constructor(){this.subscriptions=[]}add(e){return NW(this.subscriptions,e),()=>IW(this.subscriptions,e)}notify(e,r,a){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](e,r,a);else for(let u=0;u<l;u++){const p=this.subscriptions[u];p&&p(e,r,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Um=t=>t*1e3,Qu=t=>t/1e3;function Ope(t,e){return e?t*(1e3/e):0}const Lpe=(t,e,r)=>(((1-3*r+3*e)*t+(3*r-6*e))*t+3*e)*t,rUe=1e-7,iUe=12;function sUe(t,e,r,a,l){let u,p,m=0;do p=e+(r-e)/2,u=Lpe(p,a,l)-t,u>0?r=p:e=p;while(Math.abs(u)>rUe&&++m<iUe);return p}function EI(t,e,r,a){if(t===e&&r===a)return eh;const l=u=>sUe(u,0,1,t,r);return u=>u===0||u===1?u:Lpe(l(u),e,a)}const jpe=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,Mpe=t=>e=>1-t(1-e),Upe=EI(.33,1.53,.69,.99),DW=Mpe(Upe),Vpe=jpe(DW),Fpe=t=>(t*=2)<1?.5*DW(t):.5*(2-Math.pow(2,-10*(t-1))),OW=t=>1-Math.sin(Math.acos(t)),Bpe=Mpe(OW),zpe=jpe(OW),aUe=EI(.42,0,1,1),oUe=EI(0,0,.58,1),Gpe=EI(.42,0,.58,1),cUe=t=>Array.isArray(t)&&typeof t[0]!="number",Wpe=t=>Array.isArray(t)&&typeof t[0]=="number",lUe={linear:eh,easeIn:aUe,easeInOut:Gpe,easeOut:oUe,circIn:OW,circInOut:zpe,circOut:Bpe,backIn:DW,backInOut:Vpe,backOut:Upe,anticipate:Fpe},dUe=t=>typeof t=="string",bie=t=>{if(Wpe(t)){AW(t.length===4);const[e,r,a,l]=t;return EI(e,r,a,l)}else if(dUe(t))return lUe[t];return t},j2=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function uUe(t,e){let r=new Set,a=new Set,l=!1,u=!1;const p=new WeakSet;let m={delta:0,timestamp:0,isProcessing:!1};function v(R){p.has(R)&&(w.schedule(R),t()),R(m)}const w={schedule:(R,C=!1,A=!1)=>{const U=A&&l?r:a;return C&&p.add(R),U.has(R)||U.add(R),R},cancel:R=>{a.delete(R),p.delete(R)},process:R=>{if(m=R,l){u=!0;return}l=!0,[r,a]=[a,r],r.forEach(v),r.clear(),l=!1,u&&(u=!1,w.process(R))}};return w}const hUe=40;function Hpe(t,e){let r=!1,a=!0;const l={delta:0,timestamp:0,isProcessing:!1},u=()=>r=!0,p=j2.reduce((X,ne)=>(X[ne]=uUe(u),X),{}),{setup:m,read:v,resolveKeyframes:w,preUpdate:R,update:C,preRender:A,render:O,postRender:U}=p,F=()=>{const X=Xm.useManualTiming?l.timestamp:performance.now();r=!1,Xm.useManualTiming||(l.delta=a?1e3/60:Math.max(Math.min(X-l.timestamp,hUe),1)),l.timestamp=X,l.isProcessing=!0,m.process(l),v.process(l),w.process(l),R.process(l),C.process(l),A.process(l),O.process(l),U.process(l),l.isProcessing=!1,r&&e&&(a=!1,t(F))},q=()=>{r=!0,a=!0,l.isProcessing||t(F)};return{schedule:j2.reduce((X,ne)=>{const te=p[ne];return X[ne]=(he,J=!1,Q=!1)=>(r||q(),te.schedule(he,J,Q)),X},{}),cancel:X=>{for(let ne=0;ne<j2.length;ne++)p[j2[ne]].cancel(X)},state:l,steps:p}}const{schedule:Es,cancel:Jm,state:Sc,steps:JF}=Hpe(typeof requestAnimationFrame<"u"?requestAnimationFrame:eh,!0);let yD;function pUe(){yD=void 0}const Tl={now:()=>(yD===void 0&&Tl.set(Sc.isProcessing||Xm.useManualTiming?Sc.timestamp:performance.now()),yD),set:t=>{yD=t,queueMicrotask(pUe)}},Kpe=t=>e=>typeof e=="string"&&e.startsWith(t),qpe=Kpe("--"),fUe=Kpe("var(--"),LW=t=>fUe(t)?mUe.test(t.split("/*")[0].trim()):!1,mUe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu;function wie(t){return typeof t!="string"?!1:t.split("/*")[0].includes("var(--")}const Qw={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},PN={...Qw,transform:t=>kf(0,1,t)},M2={...Qw,default:1},zC=t=>Math.round(t*1e5)/1e5,jW=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function gUe(t){return t==null}const _Ue=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,MW=(t,e)=>r=>!!(typeof r=="string"&&_Ue.test(r)&&r.startsWith(t)||e&&!gUe(r)&&Object.prototype.hasOwnProperty.call(r,e)),Ype=(t,e,r)=>a=>{if(typeof a!="string")return a;const[l,u,p,m]=a.match(jW);return{[t]:parseFloat(l),[e]:parseFloat(u),[r]:parseFloat(p),alpha:m!==void 0?parseFloat(m):1}},yUe=t=>kf(0,255,t),QF={...Qw,transform:t=>Math.round(yUe(t))},cv={test:MW("rgb","red"),parse:Ype("red","green","blue"),transform:({red:t,green:e,blue:r,alpha:a=1})=>"rgba("+QF.transform(t)+", "+QF.transform(e)+", "+QF.transform(r)+", "+zC(PN.transform(a))+")"};function vUe(t){let e="",r="",a="",l="";return t.length>5?(e=t.substring(1,3),r=t.substring(3,5),a=t.substring(5,7),l=t.substring(7,9)):(e=t.substring(1,2),r=t.substring(2,3),a=t.substring(3,4),l=t.substring(4,5),e+=e,r+=r,a+=a,l+=l),{red:parseInt(e,16),green:parseInt(r,16),blue:parseInt(a,16),alpha:l?parseInt(l,16)/255:1}}const mz={test:MW("#"),parse:vUe,transform:cv.transform},xI=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),m_=xI("deg"),Nf=xI("%"),_n=xI("px"),EUe=xI("vh"),xUe=xI("vw"),Sie={...Nf,parse:t=>Nf.parse(t)/100,transform:t=>Nf.transform(t*100)},Ib={test:MW("hsl","hue"),parse:Ype("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:r,alpha:a=1})=>"hsla("+Math.round(t)+", "+Nf.transform(zC(e))+", "+Nf.transform(zC(r))+", "+zC(PN.transform(a))+")"},Za={test:t=>cv.test(t)||mz.test(t)||Ib.test(t),parse:t=>cv.test(t)?cv.parse(t):Ib.test(t)?Ib.parse(t):mz.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?cv.transform(t):Ib.transform(t),getAnimatableNone:t=>{const e=Za.parse(t);return e.alpha=0,Za.transform(e)}},bUe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function wUe(t){var e,r;return isNaN(t)&&typeof t=="string"&&(((e=t.match(jW))==null?void 0:e.length)||0)+(((r=t.match(bUe))==null?void 0:r.length)||0)>0}const $pe="number",Xpe="color",SUe="var",TUe="var(",Tie="${}",RUe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function DN(t){const e=t.toString(),r=[],a={color:[],number:[],var:[]},l=[];let u=0;const m=e.replace(RUe,v=>(Za.test(v)?(a.color.push(u),l.push(Xpe),r.push(Za.parse(v))):v.startsWith(TUe)?(a.var.push(u),l.push(SUe),r.push(v)):(a.number.push(u),l.push($pe),r.push(parseFloat(v))),++u,Tie)).split(Tie);return{values:r,split:m,indexes:a,types:l}}function Jpe(t){return DN(t).values}function Qpe(t){const{split:e,types:r}=DN(t),a=e.length;return l=>{let u="";for(let p=0;p<a;p++)if(u+=e[p],l[p]!==void 0){const m=r[p];m===$pe?u+=zC(l[p]):m===Xpe?u+=Za.transform(l[p]):u+=l[p]}return u}}const CUe=t=>typeof t=="number"?0:Za.test(t)?Za.getAnimatableNone(t):t;function NUe(t){const e=Jpe(t);return Qpe(t)(e.map(CUe))}const l0={test:wUe,parse:Jpe,createTransformer:Qpe,getAnimatableNone:NUe};function ZF(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+(e-t)*6*r:r<1/2?e:r<2/3?t+(e-t)*(2/3-r)*6:t}function IUe({hue:t,saturation:e,lightness:r,alpha:a}){t/=360,e/=100,r/=100;let l=0,u=0,p=0;if(!e)l=u=p=r;else{const m=r<.5?r*(1+e):r+e-r*e,v=2*r-m;l=ZF(v,m,t+1/3),u=ZF(v,m,t),p=ZF(v,m,t-1/3)}return{red:Math.round(l*255),green:Math.round(u*255),blue:Math.round(p*255),alpha:a}}function TO(t,e){return r=>r>0?e:t}const pa=(t,e,r)=>t+(e-t)*r,eB=(t,e,r)=>{const a=t*t,l=r*(e*e-a)+a;return l<0?0:Math.sqrt(l)},AUe=[mz,cv,Ib],kUe=t=>AUe.find(e=>e.test(t));function Rie(t){const e=kUe(t);if(!e)return!1;let r=e.parse(t);return e===Ib&&(r=IUe(r)),r}const Cie=(t,e)=>{const r=Rie(t),a=Rie(e);if(!r||!a)return TO(t,e);const l={...r};return u=>(l.red=eB(r.red,a.red,u),l.green=eB(r.green,a.green,u),l.blue=eB(r.blue,a.blue,u),l.alpha=pa(r.alpha,a.alpha,u),cv.transform(l))},gz=new Set(["none","hidden"]);function PUe(t,e){return gz.has(t)?r=>r<=0?t:e:r=>r>=1?e:t}function DUe(t,e){return r=>pa(t,e,r)}function UW(t){return typeof t=="number"?DUe:typeof t=="string"?LW(t)?TO:Za.test(t)?Cie:jUe:Array.isArray(t)?Zpe:typeof t=="object"?Za.test(t)?Cie:OUe:TO}function Zpe(t,e){const r=[...t],a=r.length,l=t.map((u,p)=>UW(u)(u,e[p]));return u=>{for(let p=0;p<a;p++)r[p]=l[p](u);return r}}function OUe(t,e){const r={...t,...e},a={};for(const l in r)t[l]!==void 0&&e[l]!==void 0&&(a[l]=UW(t[l])(t[l],e[l]));return l=>{for(const u in a)r[u]=a[u](l);return r}}function LUe(t,e){const r=[],a={color:0,var:0,number:0};for(let l=0;l<e.values.length;l++){const u=e.types[l],p=t.indexes[u][a[u]],m=t.values[p]??0;r[l]=m,a[u]++}return r}const jUe=(t,e)=>{const r=l0.createTransformer(e),a=DN(t),l=DN(e);return a.indexes.var.length===l.indexes.var.length&&a.indexes.color.length===l.indexes.color.length&&a.indexes.number.length>=l.indexes.number.length?gz.has(t)&&!l.values.length||gz.has(e)&&!a.values.length?PUe(t,e):vI(Zpe(LUe(a,l),l.values),r):TO(t,e)};function efe(t,e,r){return typeof t=="number"&&typeof e=="number"&&typeof r=="number"?pa(t,e,r):UW(t)(t,e)}const MUe=t=>{const e=({timestamp:r})=>t(r);return{start:(r=!0)=>Es.update(e,r),stop:()=>Jm(e),now:()=>Sc.isProcessing?Sc.timestamp:Tl.now()}},tfe=(t,e,r=10)=>{let a="";const l=Math.max(Math.round(e/r),2);for(let u=0;u<l;u++)a+=Math.round(t(u/(l-1))*1e4)/1e4+", ";return`linear(${a.substring(0,a.length-2)})`},RO=2e4;function VW(t){let e=0;const r=50;let a=t.next(e);for(;!a.done&&e<RO;)e+=r,a=t.next(e);return e>=RO?1/0:e}function UUe(t,e=100,r){const a=r({...t,keyframes:[0,e]}),l=Math.min(VW(a),RO);return{type:"keyframes",ease:u=>a.next(l*u).value/e,duration:Qu(l)}}const VUe=5;function nfe(t,e,r){const a=Math.max(e-VUe,0);return Ope(r-t(a),e-a)}const wa={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},tB=.001;function FUe({duration:t=wa.duration,bounce:e=wa.bounce,velocity:r=wa.velocity,mass:a=wa.mass}){let l,u,p=1-e;p=kf(wa.minDamping,wa.maxDamping,p),t=kf(wa.minDuration,wa.maxDuration,Qu(t)),p<1?(l=w=>{const R=w*p,C=R*t,A=R-r,O=_z(w,p),U=Math.exp(-C);return tB-A/O*U},u=w=>{const C=w*p*t,A=C*r+r,O=Math.pow(p,2)*Math.pow(w,2)*t,U=Math.exp(-C),F=_z(Math.pow(w,2),p);return(-l(w)+tB>0?-1:1)*((A-O)*U)/F}):(l=w=>{const R=Math.exp(-w*t),C=(w-r)*t+1;return-tB+R*C},u=w=>{const R=Math.exp(-w*t),C=(r-w)*(t*t);return R*C});const m=5/t,v=zUe(l,u,m);if(t=Um(t),isNaN(v))return{stiffness:wa.stiffness,damping:wa.damping,duration:t};{const w=Math.pow(v,2)*a;return{stiffness:w,damping:p*2*Math.sqrt(a*w),duration:t}}}const BUe=12;function zUe(t,e,r){let a=r;for(let l=1;l<BUe;l++)a=a-t(a)/e(a);return a}function _z(t,e){return t*Math.sqrt(1-e*e)}const GUe=["duration","bounce"],WUe=["stiffness","damping","mass"];function Nie(t,e){return e.some(r=>t[r]!==void 0)}function HUe(t){let e={velocity:wa.velocity,stiffness:wa.stiffness,damping:wa.damping,mass:wa.mass,isResolvedFromDuration:!1,...t};if(!Nie(t,WUe)&&Nie(t,GUe))if(t.visualDuration){const r=t.visualDuration,a=2*Math.PI/(r*1.2),l=a*a,u=2*kf(.05,1,1-(t.bounce||0))*Math.sqrt(l);e={...e,mass:wa.mass,stiffness:l,damping:u}}else{const r=FUe(t);e={...e,...r,mass:wa.mass},e.isResolvedFromDuration=!0}return e}function CO(t=wa.visualDuration,e=wa.bounce){const r=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:a,restDelta:l}=r;const u=r.keyframes[0],p=r.keyframes[r.keyframes.length-1],m={done:!1,value:u},{stiffness:v,damping:w,mass:R,duration:C,velocity:A,isResolvedFromDuration:O}=HUe({...r,velocity:-Qu(r.velocity||0)}),U=A||0,F=w/(2*Math.sqrt(v*R)),q=p-u,W=Qu(Math.sqrt(v/R)),H=Math.abs(q)<5;a||(a=H?wa.restSpeed.granular:wa.restSpeed.default),l||(l=H?wa.restDelta.granular:wa.restDelta.default);let X;if(F<1){const te=_z(W,F);X=he=>{const J=Math.exp(-F*W*he);return p-J*((U+F*W*q)/te*Math.sin(te*he)+q*Math.cos(te*he))}}else if(F===1)X=te=>p-Math.exp(-W*te)*(q+(U+W*q)*te);else{const te=W*Math.sqrt(F*F-1);X=he=>{const J=Math.exp(-F*W*he),Q=Math.min(te*he,300);return p-J*((U+F*W*q)*Math.sinh(Q)+te*q*Math.cosh(Q))/te}}const ne={calculatedDuration:O&&C||null,next:te=>{const he=X(te);if(O)m.done=te>=C;else{let J=te===0?U:0;F<1&&(J=te===0?Um(U):nfe(X,te,he));const Q=Math.abs(J)<=a,ce=Math.abs(p-he)<=l;m.done=Q&&ce}return m.value=m.done?p:he,m},toString:()=>{const te=Math.min(VW(ne),RO),he=tfe(J=>ne.next(te*J).value,te,30);return te+"ms "+he},toTransition:()=>{}};return ne}CO.applyToOptions=t=>{const e=UUe(t,100,CO);return t.ease=e.ease,t.duration=Um(e.duration),t.type="keyframes",t};function yz({keyframes:t,velocity:e=0,power:r=.8,timeConstant:a=325,bounceDamping:l=10,bounceStiffness:u=500,modifyTarget:p,min:m,max:v,restDelta:w=.5,restSpeed:R}){const C=t[0],A={done:!1,value:C},O=Q=>m!==void 0&&Q<m||v!==void 0&&Q>v,U=Q=>m===void 0?v:v===void 0||Math.abs(m-Q)<Math.abs(v-Q)?m:v;let F=r*e;const q=C+F,W=p===void 0?q:p(q);W!==q&&(F=W-C);const H=Q=>-F*Math.exp(-Q/a),X=Q=>W+H(Q),ne=Q=>{const ce=H(Q),de=X(Q);A.done=Math.abs(ce)<=w,A.value=A.done?W:de};let te,he;const J=Q=>{O(A.value)&&(te=Q,he=CO({keyframes:[A.value,U(A.value)],velocity:nfe(X,Q,A.value),damping:l,stiffness:u,restDelta:w,restSpeed:R}))};return J(0),{calculatedDuration:null,next:Q=>{let ce=!1;return!he&&te===void 0&&(ce=!0,ne(Q),J(Q)),te!==void 0&&Q>=te?he.next(Q-te):(!ce&&ne(Q),A)}}}function KUe(t,e,r){const a=[],l=r||Xm.mix||efe,u=t.length-1;for(let p=0;p<u;p++){let m=l(t[p],t[p+1]);if(e){const v=Array.isArray(e)?e[p]||eh:e;m=vI(v,m)}a.push(m)}return a}function rfe(t,e,{clamp:r=!0,ease:a,mixer:l}={}){const u=t.length;if(AW(u===e.length),u===1)return()=>e[0];if(u===2&&e[0]===e[1])return()=>e[1];const p=t[0]===t[1];t[0]>t[u-1]&&(t=[...t].reverse(),e=[...e].reverse());const m=KUe(e,a,l),v=m.length,w=R=>{if(p&&R<t[0])return e[0];let C=0;if(v>1)for(;C<t.length-2&&!(R<t[C+1]);C++);const A=kN(t[C],t[C+1],R);return m[C](A)};return r?R=>w(kf(t[0],t[u-1],R)):w}function qUe(t,e){const r=t[t.length-1];for(let a=1;a<=e;a++){const l=kN(0,e,a);t.push(pa(r,1,l))}}function YUe(t){const e=[0];return qUe(e,t.length-1),e}function $Ue(t,e){return t.map(r=>r*e)}function XUe(t,e){return t.map(()=>e||Gpe).splice(0,t.length-1)}function GC({duration:t=300,keyframes:e,times:r,ease:a="easeInOut"}){const l=cUe(a)?a.map(bie):bie(a),u={done:!1,value:e[0]},p=$Ue(r&&r.length===e.length?r:YUe(e),t),m=rfe(p,e,{ease:Array.isArray(l)?l:XUe(e,l)});return{calculatedDuration:t,next:v=>(u.value=m(v),u.done=v>=t,u)}}const JUe=t=>t!==null;function FW(t,{repeat:e,repeatType:r="loop"},a,l=1){const u=t.filter(JUe),m=l<0||e&&r!=="loop"&&e%2===1?0:u.length-1;return!m||a===void 0?u[m]:a}const QUe={decay:yz,inertia:yz,tween:GC,keyframes:GC,spring:CO};function ife(t){typeof t.type=="string"&&(t.type=QUe[t.type])}class BW{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,r){return this.finished.then(e,r)}}const ZUe=t=>t/100;class KL extends BW{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var a,l;const{motionValue:r}=this.options;r&&r.updatedAt!==Tl.now()&&this.tick(Tl.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(l=(a=this.options).onStop)==null||l.call(a))},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;ife(e);const{type:r=GC,repeat:a=0,repeatDelay:l=0,repeatType:u,velocity:p=0}=e;let{keyframes:m}=e;const v=r||GC;v!==GC&&typeof m[0]!="number"&&(this.mixKeyframes=vI(ZUe,efe(m[0],m[1])),m=[0,100]);const w=v({...e,keyframes:m});u==="mirror"&&(this.mirroredGenerator=v({...e,keyframes:[...m].reverse(),velocity:-p})),w.calculatedDuration===null&&(w.calculatedDuration=VW(w));const{calculatedDuration:R}=w;this.calculatedDuration=R,this.resolvedDuration=R+l,this.totalDuration=this.resolvedDuration*(a+1)-l,this.generator=w}updateTime(e){const r=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=r}tick(e,r=!1){const{generator:a,totalDuration:l,mixKeyframes:u,mirroredGenerator:p,resolvedDuration:m,calculatedDuration:v}=this;if(this.startTime===null)return a.next(0);const{delay:w=0,keyframes:R,repeat:C,repeatType:A,repeatDelay:O,type:U,onUpdate:F,finalKeyframe:q}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-l/this.speed,this.startTime)),r?this.currentTime=e:this.updateTime(e);const W=this.currentTime-w*(this.playbackSpeed>=0?1:-1),H=this.playbackSpeed>=0?W<0:W>l;this.currentTime=Math.max(W,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=l);let X=this.currentTime,ne=a;if(C){const Q=Math.min(this.currentTime,l)/m;let ce=Math.floor(Q),de=Q%1;!de&&Q>=1&&(de=1),de===1&&ce--,ce=Math.min(ce,C+1),!!(ce%2)&&(A==="reverse"?(de=1-de,O&&(de-=O/m)):A==="mirror"&&(ne=p)),X=kf(0,1,de)*m}const te=H?{done:!1,value:R[0]}:ne.next(X);u&&(te.value=u(te.value));let{done:he}=te;!H&&v!==null&&(he=this.playbackSpeed>=0?this.currentTime>=l:this.currentTime<=0);const J=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&he);return J&&U!==yz&&(te.value=FW(R,this.options,q,this.speed)),F&&F(te.value),J&&this.finish(),te}then(e,r){return this.finished.then(e,r)}get duration(){return Qu(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Qu(e)}get time(){return Qu(this.currentTime)}set time(e){var r;e=Um(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),(r=this.driver)==null||r.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(Tl.now());const r=this.playbackSpeed!==e;this.playbackSpeed=e,r&&(this.time=Qu(this.currentTime))}play(){var l,u;if(this.isStopped)return;const{driver:e=MUe,startTime:r}=this.options;this.driver||(this.driver=e(p=>this.tick(p))),(u=(l=this.options).onPlay)==null||u.call(l);const a=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=a):this.holdTime!==null?this.startTime=a-this.holdTime:this.startTime||(this.startTime=r??a),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Tl.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var e,r;this.notifyFinished(),this.teardown(),this.state="finished",(r=(e=this.options).onComplete)==null||r.call(e)}cancel(){var e,r;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(r=(e=this.options).onCancel)==null||r.call(e)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){var r;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(r=this.driver)==null||r.stop(),e.observe(this)}}function eVe(t){for(let e=1;e<t.length;e++)t[e]??(t[e]=t[e-1])}const lv=t=>t*180/Math.PI,vz=t=>{const e=lv(Math.atan2(t[1],t[0]));return Ez(e)},tVe={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:vz,rotateZ:vz,skewX:t=>lv(Math.atan(t[1])),skewY:t=>lv(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},Ez=t=>(t=t%360,t<0&&(t+=360),t),Iie=vz,Aie=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),kie=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),nVe={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:Aie,scaleY:kie,scale:t=>(Aie(t)+kie(t))/2,rotateX:t=>Ez(lv(Math.atan2(t[6],t[5]))),rotateY:t=>Ez(lv(Math.atan2(-t[2],t[0]))),rotateZ:Iie,rotate:Iie,skewX:t=>lv(Math.atan(t[4])),skewY:t=>lv(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function xz(t){return t.includes("scale")?1:0}function bz(t,e){if(!t||t==="none")return xz(e);const r=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let a,l;if(r)a=nVe,l=r;else{const m=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);a=tVe,l=m}if(!l)return xz(e);const u=a[e],p=l[1].split(",").map(iVe);return typeof u=="function"?u(p):p[u]}const rVe=(t,e)=>{const{transform:r="none"}=getComputedStyle(t);return bz(r,e)};function iVe(t){return parseFloat(t.trim())}const Zw=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],eS=new Set(Zw),Pie=t=>t===Qw||t===_n,sVe=new Set(["x","y","z"]),aVe=Zw.filter(t=>!sVe.has(t));function oVe(t){const e=[];return aVe.forEach(r=>{const a=t.getValue(r);a!==void 0&&(e.push([r,a.get()]),a.set(r.startsWith("scale")?1:0))}),e}const D_={width:({x:t},{paddingLeft:e="0",paddingRight:r="0"})=>t.max-t.min-parseFloat(e)-parseFloat(r),height:({y:t},{paddingTop:e="0",paddingBottom:r="0"})=>t.max-t.min-parseFloat(e)-parseFloat(r),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:(t,{transform:e})=>bz(e,"x"),y:(t,{transform:e})=>bz(e,"y")};D_.translateX=D_.x;D_.translateY=D_.y;const yv=new Set;let wz=!1,Sz=!1,Tz=!1;function sfe(){if(Sz){const t=Array.from(yv).filter(a=>a.needsMeasurement),e=new Set(t.map(a=>a.element)),r=new Map;e.forEach(a=>{const l=oVe(a);l.length&&(r.set(a,l),a.render())}),t.forEach(a=>a.measureInitialState()),e.forEach(a=>{a.render();const l=r.get(a);l&&l.forEach(([u,p])=>{var m;(m=a.getValue(u))==null||m.set(p)})}),t.forEach(a=>a.measureEndState()),t.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}Sz=!1,wz=!1,yv.forEach(t=>t.complete(Tz)),yv.clear()}function afe(){yv.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(Sz=!0)})}function cVe(){Tz=!0,afe(),sfe(),Tz=!1}class zW{constructor(e,r,a,l,u,p=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=r,this.name=a,this.motionValue=l,this.element=u,this.isAsync=p}scheduleResolve(){this.state="scheduled",this.isAsync?(yv.add(this),wz||(wz=!0,Es.read(afe),Es.resolveKeyframes(sfe))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:r,element:a,motionValue:l}=this;if(e[0]===null){const u=l==null?void 0:l.get(),p=e[e.length-1];if(u!==void 0)e[0]=u;else if(a&&r){const m=a.readValue(r,p);m!=null&&(e[0]=m)}e[0]===void 0&&(e[0]=p),l&&u===void 0&&l.set(e[0])}eVe(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),yv.delete(this)}cancel(){this.state==="scheduled"&&(yv.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const lVe=t=>t.startsWith("--");function dVe(t,e,r){lVe(e)?t.style.setProperty(e,r):t.style[e]=r}const uVe=kW(()=>window.ScrollTimeline!==void 0),hVe={};function pVe(t,e){const r=kW(t);return()=>hVe[e]??r()}const ofe=pVe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),_C=([t,e,r,a])=>`cubic-bezier(${t}, ${e}, ${r}, ${a})`,Die={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:_C([0,.65,.55,1]),circOut:_C([.55,0,1,.45]),backIn:_C([.31,.01,.66,-.59]),backOut:_C([.33,1.53,.69,.99])};function cfe(t,e){if(t)return typeof t=="function"?ofe()?tfe(t,e):"ease-out":Wpe(t)?_C(t):Array.isArray(t)?t.map(r=>cfe(r,e)||Die.easeOut):Die[t]}function fVe(t,e,r,{delay:a=0,duration:l=300,repeat:u=0,repeatType:p="loop",ease:m="easeOut",times:v}={},w=void 0){const R={[e]:r};v&&(R.offset=v);const C=cfe(m,l);Array.isArray(C)&&(R.easing=C);const A={delay:a,duration:l,easing:Array.isArray(C)?"linear":C,fill:"both",iterations:u+1,direction:p==="reverse"?"alternate":"normal"};return w&&(A.pseudoElement=w),t.animate(R,A)}function lfe(t){return typeof t=="function"&&"applyToOptions"in t}function mVe({type:t,...e}){return lfe(t)&&ofe()?t.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class gVe extends BW{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,this.manualStartTime=null,!e)return;const{element:r,name:a,keyframes:l,pseudoElement:u,allowFlatten:p=!1,finalKeyframe:m,onComplete:v}=e;this.isPseudoElement=!!u,this.allowFlatten=p,this.options=e,AW(typeof e.type!="string");const w=mVe(e);this.animation=fVe(r,a,l,w,u),w.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!u){const R=FW(l,this.options,m,this.speed);this.updateMotionValue?this.updateMotionValue(R):dVe(r,a,R),this.animation.cancel()}v==null||v(),this.notifyFinished()}}play(){this.isStopped||(this.manualStartTime=null,this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var e,r;(r=(e=this.animation).finish)==null||r.call(e)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var e,r;this.isPseudoElement||(r=(e=this.animation).commitStyles)==null||r.call(e)}get duration(){var r,a;const e=((a=(r=this.animation.effect)==null?void 0:r.getComputedTiming)==null?void 0:a.call(r).duration)||0;return Qu(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Qu(e)}get time(){return Qu(Number(this.animation.currentTime)||0)}set time(e){this.manualStartTime=null,this.finishedTime=null,this.animation.currentTime=Um(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return this.manualStartTime??Number(this.animation.startTime)}set startTime(e){this.manualStartTime=this.animation.startTime=e}attachTimeline({timeline:e,observe:r}){var a;return this.allowFlatten&&((a=this.animation.effect)==null||a.updateTiming({easing:"linear"})),this.animation.onfinish=null,e&&uVe()?(this.animation.timeline=e,eh):r(this)}}const dfe={anticipate:Fpe,backInOut:Vpe,circInOut:zpe};function _Ve(t){return t in dfe}function yVe(t){typeof t.ease=="string"&&_Ve(t.ease)&&(t.ease=dfe[t.ease])}const nB=10;class vVe extends gVe{constructor(e){yVe(e),ife(e),super(e),e.startTime!==void 0&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:r,onUpdate:a,onComplete:l,element:u,...p}=this.options;if(!r)return;if(e!==void 0){r.set(e);return}const m=new KL({...p,autoplay:!1}),v=Math.max(nB,Tl.now()-this.startTime),w=kf(0,nB,v-nB);r.setWithVelocity(m.sample(Math.max(0,v-w)).value,m.sample(v).value,w),m.stop()}}const Oie=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(l0.test(t)||t==="0")&&!t.startsWith("url("));function EVe(t){const e=t[0];if(t.length===1)return!0;for(let r=0;r<t.length;r++)if(t[r]!==e)return!0}function xVe(t,e,r,a){const l=t[0];if(l===null)return!1;if(e==="display"||e==="visibility")return!0;const u=t[t.length-1],p=Oie(l,e),m=Oie(u,e);return!p||!m?!1:EVe(t)||(r==="spring"||lfe(r))&&a}function Rz(t){t.duration=0,t.type="keyframes"}const bVe=new Set(["opacity","clipPath","filter","transform"]),wVe=kW(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function SVe(t){var R;const{motionValue:e,name:r,repeatDelay:a,repeatType:l,damping:u,type:p}=t;if(!(((R=e==null?void 0:e.owner)==null?void 0:R.current)instanceof HTMLElement))return!1;const{onUpdate:v,transformTemplate:w}=e.owner.getProps();return wVe()&&r&&bVe.has(r)&&(r!=="transform"||!w)&&!v&&!a&&l!=="mirror"&&u!==0&&p!=="inertia"}const TVe=40;class RVe extends BW{constructor({autoplay:e=!0,delay:r=0,type:a="keyframes",repeat:l=0,repeatDelay:u=0,repeatType:p="loop",keyframes:m,name:v,motionValue:w,element:R,...C}){var U;super(),this.stop=()=>{var F,q;this._animation&&(this._animation.stop(),(F=this.stopTimeline)==null||F.call(this)),(q=this.keyframeResolver)==null||q.cancel()},this.createdAt=Tl.now();const A={autoplay:e,delay:r,type:a,repeat:l,repeatDelay:u,repeatType:p,name:v,motionValue:w,element:R,...C},O=(R==null?void 0:R.KeyframeResolver)||zW;this.keyframeResolver=new O(m,(F,q,W)=>this.onKeyframesResolved(F,q,A,!W),v,w,R),(U=this.keyframeResolver)==null||U.scheduleResolve()}onKeyframesResolved(e,r,a,l){var q,W;this.keyframeResolver=void 0;const{name:u,type:p,velocity:m,delay:v,isHandoff:w,onUpdate:R}=a;this.resolvedAt=Tl.now(),xVe(e,u,p,m)||((Xm.instantAnimations||!v)&&(R==null||R(FW(e,a,r))),e[0]=e[e.length-1],Rz(a),a.repeat=0);const A={startTime:l?this.resolvedAt?this.resolvedAt-this.createdAt>TVe?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:r,...a,keyframes:e},O=!w&&SVe(A),U=(W=(q=A.motionValue)==null?void 0:q.owner)==null?void 0:W.current,F=O?new vVe({...A,element:U}):new KL(A);F.finished.then(()=>{this.notifyFinished()}).catch(eh),this.pendingTimeline&&(this.stopTimeline=F.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=F}get finished(){return this._animation?this.animation.finished:this._finished}then(e,r){return this.finished.finally(e).then(()=>{})}get animation(){var e;return this._animation||((e=this.keyframeResolver)==null||e.resume(),cVe()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var e;this._animation&&this.animation.cancel(),(e=this.keyframeResolver)==null||e.cancel()}}function ufe(t,e,r,a=0,l=1){const u=Array.from(t).sort((w,R)=>w.sortNodePosition(R)).indexOf(e),p=t.size,m=(p-1)*a;return typeof r=="function"?r(u,p):l===1?u*a:m-u*a}const CVe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function NVe(t){const e=CVe.exec(t);if(!e)return[,];const[,r,a,l]=e;return[`--${r??a}`,l]}function hfe(t,e,r=1){const[a,l]=NVe(t);if(!a)return;const u=window.getComputedStyle(e).getPropertyValue(a);if(u){const p=u.trim();return kpe(p)?parseFloat(p):p}return LW(l)?hfe(l,e,r+1):l}const IVe={type:"spring",stiffness:500,damping:25,restSpeed:10},AVe=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),kVe={type:"keyframes",duration:.8},PVe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},DVe=(t,{keyframes:e})=>e.length>2?kVe:eS.has(t)?t.startsWith("scale")?AVe(e[1]):IVe:PVe,OVe=t=>t!==null;function LVe(t,{repeat:e,repeatType:r="loop"},a){const l=t.filter(OVe),u=e&&r!=="loop"&&e%2===1?0:l.length-1;return l[u]}function GW(t,e){return(t==null?void 0:t[e])??(t==null?void 0:t.default)??t}function jVe({when:t,delay:e,delayChildren:r,staggerChildren:a,staggerDirection:l,repeat:u,repeatType:p,repeatDelay:m,from:v,elapsed:w,...R}){return!!Object.keys(R).length}const WW=(t,e,r,a={},l,u)=>p=>{const m=GW(a,t)||{},v=m.delay||a.delay||0;let{elapsed:w=0}=a;w=w-Um(v);const R={keyframes:Array.isArray(r)?r:[null,r],ease:"easeOut",velocity:e.getVelocity(),...m,delay:-w,onUpdate:A=>{e.set(A),m.onUpdate&&m.onUpdate(A)},onComplete:()=>{p(),m.onComplete&&m.onComplete()},name:t,motionValue:e,element:u?void 0:l};jVe(m)||Object.assign(R,DVe(t,R)),R.duration&&(R.duration=Um(R.duration)),R.repeatDelay&&(R.repeatDelay=Um(R.repeatDelay)),R.from!==void 0&&(R.keyframes[0]=R.from);let C=!1;if((R.type===!1||R.duration===0&&!R.repeatDelay)&&(Rz(R),R.delay===0&&(C=!0)),(Xm.instantAnimations||Xm.skipAnimations)&&(C=!0,Rz(R),R.delay=0),R.allowFlatten=!m.type&&!m.ease,C&&!u&&e.get()!==void 0){const A=LVe(R.keyframes,m);if(A!==void 0){Es.update(()=>{R.onUpdate(A),R.onComplete()});return}}return m.isSync?new KL(R):new RVe(R)};function Lie(t){const e=[{},{}];return t==null||t.values.forEach((r,a)=>{e[0][a]=r.get(),e[1][a]=r.getVelocity()}),e}function HW(t,e,r,a){if(typeof e=="function"){const[l,u]=Lie(a);e=e(r!==void 0?r:t.custom,l,u)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[l,u]=Lie(a);e=e(r!==void 0?r:t.custom,l,u)}return e}function qb(t,e,r){const a=t.getProps();return HW(a,e,r!==void 0?r:a.custom,t)}const pfe=new Set(["width","height","top","left","right","bottom",...Zw]),jie=30,MVe=t=>!isNaN(parseFloat(t)),WC={current:void 0};class UVe{constructor(e,r={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=a=>{var u;const l=Tl.now();if(this.updatedAt!==l&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&((u=this.events.change)==null||u.notify(this.current),this.dependents))for(const p of this.dependents)p.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=r.owner}setCurrent(e){this.current=e,this.updatedAt=Tl.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=MVe(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,r){this.events[e]||(this.events[e]=new PW);const a=this.events[e].add(r);return e==="change"?()=>{a(),Es.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,r){this.passiveEffect=e,this.stopPassiveEffect=r}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,r,a){this.set(r),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-a}jump(e,r=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,r&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var e;(e=this.events.change)==null||e.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return WC.current&&WC.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const e=Tl.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>jie)return 0;const r=Math.min(this.updatedAt-this.prevUpdatedAt,jie);return Ope(parseFloat(this.current)-parseFloat(this.prevFrameValue),r)}start(e){return this.stop(),new Promise(r=>{this.hasAnimated=!0,this.animation=e(r),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var e,r;(e=this.dependents)==null||e.clear(),(r=this.events.destroy)==null||r.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Uv(t,e){return new UVe(t,e)}const Cz=t=>Array.isArray(t);function VVe(t,e,r){t.hasValue(e)?t.getValue(e).set(r):t.addValue(e,Uv(r))}function FVe(t){return Cz(t)?t[t.length-1]||0:t}function BVe(t,e){const r=qb(t,e);let{transitionEnd:a={},transition:l={},...u}=r||{};u={...u,...a};for(const p in u){const m=FVe(u[p]);VVe(t,p,m)}}const qo=t=>!!(t&&t.getVelocity);function zVe(t){return!!(qo(t)&&t.add)}function Nz(t,e){const r=t.getValue("willChange");if(zVe(r))return r.add(e);if(!r&&Xm.WillChange){const a=new Xm.WillChange("auto");t.addValue("willChange",a),a.add(e)}}function KW(t){return t.replace(/([A-Z])/g,e=>`-${e.toLowerCase()}`)}const GVe="framerAppearId",ffe="data-"+KW(GVe);function mfe(t){return t.props[ffe]}function WVe({protectedKeys:t,needsAnimating:e},r){const a=t.hasOwnProperty(r)&&e[r]!==!0;return e[r]=!1,a}function gfe(t,e,{delay:r=0,transitionOverride:a,type:l}={}){let{transition:u=t.getDefaultTransition(),transitionEnd:p,...m}=e;const v=u==null?void 0:u.reduceMotion;a&&(u=a);const w=[],R=l&&t.animationState&&t.animationState.getState()[l];for(const C in m){const A=t.getValue(C,t.latestValues[C]??null),O=m[C];if(O===void 0||R&&WVe(R,C))continue;const U={delay:r,...GW(u||{},C)},F=A.get();if(F!==void 0&&!A.isAnimating&&!Array.isArray(O)&&O===F&&!U.velocity)continue;let q=!1;if(window.MotionHandoffAnimation){const X=mfe(t);if(X){const ne=window.MotionHandoffAnimation(X,C,Es);ne!==null&&(U.startTime=ne,q=!0)}}Nz(t,C);const W=v??t.shouldReduceMotion;A.start(WW(C,A,O,W&&pfe.has(C)?{type:!1}:U,t,q));const H=A.animation;H&&w.push(H)}return p&&Promise.all(w).then(()=>{Es.update(()=>{p&&BVe(t,p)})}),w}function Iz(t,e,r={}){var v;const a=qb(t,e,r.type==="exit"?(v=t.presenceContext)==null?void 0:v.custom:void 0);let{transition:l=t.getDefaultTransition()||{}}=a||{};r.transitionOverride&&(l=r.transitionOverride);const u=a?()=>Promise.all(gfe(t,a,r)):()=>Promise.resolve(),p=t.variantChildren&&t.variantChildren.size?(w=0)=>{const{delayChildren:R=0,staggerChildren:C,staggerDirection:A}=l;return HVe(t,e,w,R,C,A,r)}:()=>Promise.resolve(),{when:m}=l;if(m){const[w,R]=m==="beforeChildren"?[u,p]:[p,u];return w().then(()=>R())}else return Promise.all([u(),p(r.delay)])}function HVe(t,e,r=0,a=0,l=0,u=1,p){const m=[];for(const v of t.variantChildren)v.notify("AnimationStart",e),m.push(Iz(v,e,{...p,delay:r+(typeof a=="function"?0:a)+ufe(t.variantChildren,v,a,l,u)}).then(()=>v.notify("AnimationComplete",e)));return Promise.all(m)}function KVe(t,e,r={}){t.notify("AnimationStart",e);let a;if(Array.isArray(e)){const l=e.map(u=>Iz(t,u,r));a=Promise.all(l)}else if(typeof e=="string")a=Iz(t,e,r);else{const l=typeof e=="function"?qb(t,e,r.custom):e;a=Promise.all(gfe(t,l,r))}return a.then(()=>{t.notify("AnimationComplete",e)})}const qVe={test:t=>t==="auto",parse:t=>t},_fe=t=>e=>e.test(t),yfe=[Qw,_n,Nf,m_,xUe,EUe,qVe],Mie=t=>yfe.find(_fe(t));function YVe(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||Dpe(t):!0}const $Ve=new Set(["brightness","contrast","saturate","opacity"]);function XVe(t){const[e,r]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[a]=r.match(jW)||[];if(!a)return t;const l=r.replace(a,"");let u=$Ve.has(e)?1:0;return a!==r&&(u*=100),e+"("+u+l+")"}const JVe=/\b([a-z-]*)\(.*?\)/gu,Az={...l0,getAnimatableNone:t=>{const e=t.match(JVe);return e?e.map(XVe).join(" "):t}},Uie={...Qw,transform:Math.round},QVe={rotate:m_,rotateX:m_,rotateY:m_,rotateZ:m_,scale:M2,scaleX:M2,scaleY:M2,scaleZ:M2,skew:m_,skewX:m_,skewY:m_,distance:_n,translateX:_n,translateY:_n,translateZ:_n,x:_n,y:_n,z:_n,perspective:_n,transformPerspective:_n,opacity:PN,originX:Sie,originY:Sie,originZ:_n},qW={borderWidth:_n,borderTopWidth:_n,borderRightWidth:_n,borderBottomWidth:_n,borderLeftWidth:_n,borderRadius:_n,borderTopLeftRadius:_n,borderTopRightRadius:_n,borderBottomRightRadius:_n,borderBottomLeftRadius:_n,width:_n,maxWidth:_n,height:_n,maxHeight:_n,top:_n,right:_n,bottom:_n,left:_n,inset:_n,insetBlock:_n,insetBlockStart:_n,insetBlockEnd:_n,insetInline:_n,insetInlineStart:_n,insetInlineEnd:_n,padding:_n,paddingTop:_n,paddingRight:_n,paddingBottom:_n,paddingLeft:_n,paddingBlock:_n,paddingBlockStart:_n,paddingBlockEnd:_n,paddingInline:_n,paddingInlineStart:_n,paddingInlineEnd:_n,margin:_n,marginTop:_n,marginRight:_n,marginBottom:_n,marginLeft:_n,marginBlock:_n,marginBlockStart:_n,marginBlockEnd:_n,marginInline:_n,marginInlineStart:_n,marginInlineEnd:_n,fontSize:_n,backgroundPositionX:_n,backgroundPositionY:_n,...QVe,zIndex:Uie,fillOpacity:PN,strokeOpacity:PN,numOctaves:Uie},ZVe={...qW,color:Za,backgroundColor:Za,outlineColor:Za,fill:Za,stroke:Za,borderColor:Za,borderTopColor:Za,borderRightColor:Za,borderBottomColor:Za,borderLeftColor:Za,filter:Az,WebkitFilter:Az},vfe=t=>ZVe[t];function Efe(t,e){let r=vfe(t);return r!==Az&&(r=l0),r.getAnimatableNone?r.getAnimatableNone(e):void 0}const e4e=new Set(["auto","none","0"]);function t4e(t,e,r){let a=0,l;for(;a<t.length&&!l;){const u=t[a];typeof u=="string"&&!e4e.has(u)&&DN(u).values.length&&(l=t[a]),a++}if(l&&r)for(const u of e)t[u]=Efe(r,l)}class n4e extends zW{constructor(e,r,a,l,u){super(e,r,a,l,u,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:r,name:a}=this;if(!r||!r.current)return;super.readKeyframes();for(let R=0;R<e.length;R++){let C=e[R];if(typeof C=="string"&&(C=C.trim(),LW(C))){const A=hfe(C,r.current);A!==void 0&&(e[R]=A),R===e.length-1&&(this.finalKeyframe=C)}}if(this.resolveNoneKeyframes(),!pfe.has(a)||e.length!==2)return;const[l,u]=e,p=Mie(l),m=Mie(u),v=wie(l),w=wie(u);if(v!==w&&D_[a]){this.needsMeasurement=!0;return}if(p!==m)if(Pie(p)&&Pie(m))for(let R=0;R<e.length;R++){const C=e[R];typeof C=="string"&&(e[R]=parseFloat(C))}else D_[a]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:r}=this,a=[];for(let l=0;l<e.length;l++)(e[l]===null||YVe(e[l]))&&a.push(l);a.length&&t4e(e,a,r)}measureInitialState(){const{element:e,unresolvedKeyframes:r,name:a}=this;if(!e||!e.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=D_[a](e.measureViewportBox(),window.getComputedStyle(e.current)),r[0]=this.measuredOrigin;const l=r[r.length-1];l!==void 0&&e.getValue(a,l).jump(l,!1)}measureEndState(){var m;const{element:e,name:r,unresolvedKeyframes:a}=this;if(!e||!e.current)return;const l=e.getValue(r);l&&l.jump(this.measuredOrigin,!1);const u=a.length-1,p=a[u];a[u]=D_[r](e.measureViewportBox(),window.getComputedStyle(e.current)),p!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=p),(m=this.removedTransforms)!=null&&m.length&&this.removedTransforms.forEach(([v,w])=>{e.getValue(v).set(w)}),this.resolveNoneKeyframes()}}function r4e(t,e,r){if(t==null)return[];if(t instanceof EventTarget)return[t];if(typeof t=="string"){let a=document;const l=(r==null?void 0:r[t])??a.querySelectorAll(t);return l?Array.from(l):[]}return Array.from(t).filter(a=>a!=null)}const xfe=(t,e)=>e&&typeof t=="number"?e.transform(t):t;function kz(t){return Ppe(t)&&"offsetHeight"in t}const{schedule:YW}=Hpe(queueMicrotask,!1),Zh={x:!1,y:!1};function bfe(){return Zh.x||Zh.y}function i4e(t){return t==="x"||t==="y"?Zh[t]?null:(Zh[t]=!0,()=>{Zh[t]=!1}):Zh.x||Zh.y?null:(Zh.x=Zh.y=!0,()=>{Zh.x=Zh.y=!1})}function wfe(t,e){const r=r4e(t),a=new AbortController,l={passive:!0,...e,signal:a.signal};return[r,l,()=>a.abort()]}function Vie(t){return!(t.pointerType==="touch"||bfe())}function s4e(t,e,r={}){const[a,l,u]=wfe(t,r),p=m=>{if(!Vie(m))return;const{target:v}=m,w=e(v,m);if(typeof w!="function"||!v)return;const R=C=>{Vie(C)&&(w(C),v.removeEventListener("pointerleave",R))};v.addEventListener("pointerleave",R,l)};return a.forEach(m=>{m.addEventListener("pointerenter",p,l)}),u}const Sfe=(t,e)=>e?t===e?!0:Sfe(t,e.parentElement):!1,$W=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,a4e=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function Tfe(t){return a4e.has(t.tagName)||t.isContentEditable===!0}const vD=new WeakSet;function Fie(t){return e=>{e.key==="Enter"&&t(e)}}function rB(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const o4e=(t,e)=>{const r=t.currentTarget;if(!r)return;const a=Fie(()=>{if(vD.has(r))return;rB(r,"down");const l=Fie(()=>{rB(r,"up")}),u=()=>rB(r,"cancel");r.addEventListener("keyup",l,e),r.addEventListener("blur",u,e)});r.addEventListener("keydown",a,e),r.addEventListener("blur",()=>r.removeEventListener("keydown",a),e)};function Bie(t){return $W(t)&&!bfe()}function c4e(t,e,r={}){const[a,l,u]=wfe(t,r),p=m=>{const v=m.currentTarget;if(!Bie(m))return;vD.add(v);const w=e(v,m),R=(O,U)=>{window.removeEventListener("pointerup",C),window.removeEventListener("pointercancel",A),vD.has(v)&&vD.delete(v),Bie(O)&&typeof w=="function"&&w(O,{success:U})},C=O=>{R(O,v===window||v===document||r.useGlobalTarget||Sfe(v,O.target))},A=O=>{R(O,!1)};window.addEventListener("pointerup",C,l),window.addEventListener("pointercancel",A,l)};return a.forEach(m=>{(r.useGlobalTarget?window:m).addEventListener("pointerdown",p,l),kz(m)&&(m.addEventListener("focus",w=>o4e(w,l)),!Tfe(m)&&!m.hasAttribute("tabindex")&&(m.tabIndex=0))}),u}function Rfe(t){return Ppe(t)&&"ownerSVGElement"in t}function l4e(t){return Rfe(t)&&t.tagName==="svg"}function d4e(...t){const e=!Array.isArray(t[0]),r=e?0:-1,a=t[0+r],l=t[1+r],u=t[2+r],p=t[3+r],m=rfe(l,u,p);return e?m(a):m}function u4e(t,e,r={}){const a=t.get();let l=null,u=a,p;const m=typeof a=="string"?a.replace(/[\d.-]/g,""):void 0,v=()=>{l&&(l.stop(),l=null)},w=()=>{v();const R=Gie(t.get()),C=Gie(u);R!==C&&(l=new KL({keyframes:[R,C],velocity:t.getVelocity(),type:"spring",restDelta:.001,restSpeed:.01,...r,onUpdate:p}))};if(t.attach((R,C)=>{u=R,p=A=>C(zie(A,m)),Es.postRender(()=>{var A;w(),(A=t.events.animationStart)==null||A.notify(),l==null||l.then(()=>{var O;(O=t.events.animationComplete)==null||O.notify()})})},v),qo(e)){const R=e.on("change",A=>t.set(zie(A,m))),C=t.on("destroy",R);return()=>{R(),C()}}return v}function zie(t,e){return e?t+e:t}function Gie(t){return typeof t=="number"?t:parseFloat(t)}const h4e=[...yfe,Za,l0],p4e=t=>h4e.find(_fe(t)),Wie=()=>({translate:0,scale:1,origin:0,originPoint:0}),Ab=()=>({x:Wie(),y:Wie()}),Hie=()=>({min:0,max:0}),fo=()=>({x:Hie(),y:Hie()}),Pz={current:null},Cfe={current:!1},f4e=typeof window<"u";function m4e(){if(Cfe.current=!0,!!f4e)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>Pz.current=t.matches;t.addEventListener("change",e),e()}else Pz.current=!1}const g4e=new WeakMap;function qL(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function ON(t){return typeof t=="string"||Array.isArray(t)}const XW=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],JW=["initial",...XW];function YL(t){return qL(t.animate)||JW.some(e=>ON(t[e]))}function Nfe(t){return!!(YL(t)||t.variants)}function _4e(t,e,r){for(const a in e){const l=e[a],u=r[a];if(qo(l))t.addValue(a,l);else if(qo(u))t.addValue(a,Uv(l,{owner:t}));else if(u!==l)if(t.hasValue(a)){const p=t.getValue(a);p.liveStyle===!0?p.jump(l):p.hasAnimated||p.set(l)}else{const p=t.getStaticValue(a);t.addValue(a,Uv(p!==void 0?p:l,{owner:t}))}}for(const a in r)e[a]===void 0&&t.removeValue(a);return e}const Kie=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];let NO={};function Ife(t){NO=t}function y4e(){return NO}class v4e{scrapeMotionValuesFromProps(e,r,a){return{}}constructor({parent:e,props:r,presenceContext:a,reducedMotionConfig:l,blockInitialAnimation:u,visualState:p},m={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=zW,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const A=Tl.now();this.renderScheduledAt<A&&(this.renderScheduledAt=A,Es.render(this.render,!1,!0))};const{latestValues:v,renderState:w}=p;this.latestValues=v,this.baseTarget={...v},this.initialValues=r.initial?{...v}:{},this.renderState=w,this.parent=e,this.props=r,this.presenceContext=a,this.depth=e?e.depth+1:0,this.reducedMotionConfig=l,this.options=m,this.blockInitialAnimation=!!u,this.isControllingVariants=YL(r),this.isVariantNode=Nfe(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:R,...C}=this.scrapeMotionValuesFromProps(r,{},this);for(const A in C){const O=C[A];v[A]!==void 0&&qo(O)&&O.set(v[A])}}mount(e){var r;this.current=e,g4e.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((a,l)=>this.bindToMotionValue(l,a)),this.reducedMotionConfig==="never"?this.shouldReduceMotion=!1:this.reducedMotionConfig==="always"?this.shouldReduceMotion=!0:(Cfe.current||m4e(),this.shouldReduceMotion=Pz.current),(r=this.parent)==null||r.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var e;this.projection&&this.projection.unmount(),Jm(this.notifyUpdate),Jm(this.render),this.valueSubscriptions.forEach(r=>r()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(e=this.parent)==null||e.removeChild(this);for(const r in this.events)this.events[r].clear();for(const r in this.features){const a=this.features[r];a&&(a.unmount(),a.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,r){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const a=eS.has(e);a&&this.onBindTransform&&this.onBindTransform();const l=r.on("change",p=>{this.latestValues[e]=p,this.props.onUpdate&&Es.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let u;typeof window<"u"&&window.MotionCheckAppearSync&&(u=window.MotionCheckAppearSync(this,e,r)),this.valueSubscriptions.set(e,()=>{l(),u&&u(),r.owner&&r.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in NO){const r=NO[e];if(!r)continue;const{isEnabled:a,Feature:l}=r;if(!this.features[e]&&l&&a(this.props)&&(this.features[e]=new l(this)),this.features[e]){const u=this.features[e];u.isMounted?u.update():(u.mount(),u.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):fo()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,r){this.latestValues[e]=r}update(e,r){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=r;for(let a=0;a<Kie.length;a++){const l=Kie[a];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const u="on"+l,p=e[u];p&&(this.propEventSubscriptions[l]=this.on(l,p))}this.prevMotionValues=_4e(this,this.scrapeMotionValuesFromProps(e,this.prevProps||{},this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const r=this.getClosestVariantNode();if(r)return r.variantChildren&&r.variantChildren.add(e),()=>r.variantChildren.delete(e)}addValue(e,r){const a=this.values.get(e);r!==a&&(a&&this.removeValue(e),this.bindToMotionValue(e,r),this.values.set(e,r),this.latestValues[e]=r.get())}removeValue(e){this.values.delete(e);const r=this.valueSubscriptions.get(e);r&&(r(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,r){if(this.props.values&&this.props.values[e])return this.props.values[e];let a=this.values.get(e);return a===void 0&&r!==void 0&&(a=Uv(r===null?void 0:r,{owner:this}),this.addValue(e,a)),a}readValue(e,r){let a=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return a!=null&&(typeof a=="string"&&(kpe(a)||Dpe(a))?a=parseFloat(a):!p4e(a)&&l0.test(r)&&(a=Efe(e,r)),this.setBaseTarget(e,qo(a)?a.get():a)),qo(a)?a.get():a}setBaseTarget(e,r){this.baseTarget[e]=r}getBaseTarget(e){var u;const{initial:r}=this.props;let a;if(typeof r=="string"||typeof r=="object"){const p=HW(this.props,r,(u=this.presenceContext)==null?void 0:u.custom);p&&(a=p[e])}if(r&&a!==void 0)return a;const l=this.getBaseTargetFromProps(this.props,e);return l!==void 0&&!qo(l)?l:this.initialValues[e]!==void 0&&a===void 0?void 0:this.baseTarget[e]}on(e,r){return this.events[e]||(this.events[e]=new PW),this.events[e].add(r)}notify(e,...r){this.events[e]&&this.events[e].notify(...r)}scheduleRenderMicrotask(){YW.render(this.render)}}class Afe extends v4e{constructor(){super(...arguments),this.KeyframeResolver=n4e}sortInstanceNodePosition(e,r){return e.compareDocumentPosition(r)&2?1:-1}getBaseTargetFromProps(e,r){const a=e.style;return a?a[r]:void 0}removeValueFromRenderState(e,{vars:r,style:a}){delete r[e],delete a[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;qo(e)&&(this.childSubscription=e.on("change",r=>{this.current&&(this.current.textContent=`${r}`)}))}}class E0{constructor(e){this.isMounted=!1,this.node=e}update(){}}function kfe({top:t,left:e,right:r,bottom:a}){return{x:{min:e,max:r},y:{min:t,max:a}}}function E4e({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function x4e(t,e){if(!e)return t;const r=e({x:t.left,y:t.top}),a=e({x:t.right,y:t.bottom});return{top:r.y,left:r.x,bottom:a.y,right:a.x}}function iB(t){return t===void 0||t===1}function Dz({scale:t,scaleX:e,scaleY:r}){return!iB(t)||!iB(e)||!iB(r)}function Qy(t){return Dz(t)||Pfe(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function Pfe(t){return qie(t.x)||qie(t.y)}function qie(t){return t&&t!=="0%"}function IO(t,e,r){const a=t-r,l=e*a;return r+l}function Yie(t,e,r,a,l){return l!==void 0&&(t=IO(t,l,a)),IO(t,r,a)+e}function Oz(t,e=0,r=1,a,l){t.min=Yie(t.min,e,r,a,l),t.max=Yie(t.max,e,r,a,l)}function Dfe(t,{x:e,y:r}){Oz(t.x,e.translate,e.scale,e.originPoint),Oz(t.y,r.translate,r.scale,r.originPoint)}const $ie=.999999999999,Xie=1.0000000000001;function b4e(t,e,r,a=!1){const l=r.length;if(!l)return;e.x=e.y=1;let u,p;for(let m=0;m<l;m++){u=r[m],p=u.projectionDelta;const{visualElement:v}=u.options;v&&v.props.style&&v.props.style.display==="contents"||(a&&u.options.layoutScroll&&u.scroll&&u!==u.root&&Pb(t,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),p&&(e.x*=p.x.scale,e.y*=p.y.scale,Dfe(t,p)),a&&Qy(u.latestValues)&&Pb(t,u.latestValues))}e.x<Xie&&e.x>$ie&&(e.x=1),e.y<Xie&&e.y>$ie&&(e.y=1)}function kb(t,e){t.min=t.min+e,t.max=t.max+e}function Jie(t,e,r,a,l=.5){const u=pa(t.min,t.max,l);Oz(t,e,r,u,a)}function Pb(t,e){Jie(t.x,e.x,e.scaleX,e.scale,e.originX),Jie(t.y,e.y,e.scaleY,e.scale,e.originY)}function Ofe(t,e){return kfe(x4e(t.getBoundingClientRect(),e))}function w4e(t,e,r){const a=Ofe(t,r),{scroll:l}=e;return l&&(kb(a.x,l.offset.x),kb(a.y,l.offset.y)),a}const S4e={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},T4e=Zw.length;function R4e(t,e,r){let a="",l=!0;for(let u=0;u<T4e;u++){const p=Zw[u],m=t[p];if(m===void 0)continue;let v=!0;if(typeof m=="number")v=m===(p.startsWith("scale")?1:0);else{const w=parseFloat(m);v=p.startsWith("scale")?w===1:w===0}if(!v||r){const w=xfe(m,qW[p]);if(!v){l=!1;const R=S4e[p]||p;a+=`${R}(${w}) `}r&&(e[p]=w)}}return a=a.trim(),r?a=r(e,l?"":a):l&&(a="none"),a}function QW(t,e,r){const{style:a,vars:l,transformOrigin:u}=t;let p=!1,m=!1;for(const v in e){const w=e[v];if(eS.has(v)){p=!0;continue}else if(qpe(v)){l[v]=w;continue}else{const R=xfe(w,qW[v]);v.startsWith("origin")?(m=!0,u[v]=R):a[v]=R}}if(e.transform||(p||r?a.transform=R4e(e,t.transform,r):a.transform&&(a.transform="none")),m){const{originX:v="50%",originY:w="50%",originZ:R=0}=u;a.transformOrigin=`${v} ${w} ${R}`}}function Lfe(t,{style:e,vars:r},a,l){const u=t.style;let p;for(p in e)u[p]=e[p];l==null||l.applyProjectionStyles(u,a);for(p in r)u.setProperty(p,r[p])}function Qie(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const tC={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(_n.test(t))t=parseFloat(t);else return t;const r=Qie(t,e.target.x),a=Qie(t,e.target.y);return`${r}% ${a}%`}},C4e={correct:(t,{treeScale:e,projectionDelta:r})=>{const a=t,l=l0.parse(t);if(l.length>5)return a;const u=l0.createTransformer(t),p=typeof l[0]!="number"?1:0,m=r.x.scale*e.x,v=r.y.scale*e.y;l[0+p]/=m,l[1+p]/=v;const w=pa(m,v,.5);return typeof l[2+p]=="number"&&(l[2+p]/=w),typeof l[3+p]=="number"&&(l[3+p]/=w),u(l)}},Lz={borderRadius:{...tC,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:tC,borderTopRightRadius:tC,borderBottomLeftRadius:tC,borderBottomRightRadius:tC,boxShadow:C4e};function jfe(t,{layout:e,layoutId:r}){return eS.has(t)||t.startsWith("origin")||(e||r!==void 0)&&(!!Lz[t]||t==="opacity")}function ZW(t,e,r){var p;const a=t.style,l=e==null?void 0:e.style,u={};if(!a)return u;for(const m in a)(qo(a[m])||l&&qo(l[m])||jfe(m,t)||((p=r==null?void 0:r.getValue(m))==null?void 0:p.liveStyle)!==void 0)&&(u[m]=a[m]);return u}function N4e(t){return window.getComputedStyle(t)}class I4e extends Afe{constructor(){super(...arguments),this.type="html",this.renderInstance=Lfe}readValueFromInstance(e,r){var a;if(eS.has(r))return(a=this.projection)!=null&&a.isProjecting?xz(r):rVe(e,r);{const l=N4e(e),u=(qpe(r)?l.getPropertyValue(r):l[r])||0;return typeof u=="string"?u.trim():u}}measureInstanceViewportBox(e,{transformPagePoint:r}){return Ofe(e,r)}build(e,r,a){QW(e,r,a.transformTemplate)}scrapeMotionValuesFromProps(e,r,a){return ZW(e,r,a)}}const A4e={offset:"stroke-dashoffset",array:"stroke-dasharray"},k4e={offset:"strokeDashoffset",array:"strokeDasharray"};function P4e(t,e,r=1,a=0,l=!0){t.pathLength=1;const u=l?A4e:k4e;t[u.offset]=`${-a}`,t[u.array]=`${e} ${r}`}const D4e=["offsetDistance","offsetPath","offsetRotate","offsetAnchor"];function Mfe(t,{attrX:e,attrY:r,attrScale:a,pathLength:l,pathSpacing:u=1,pathOffset:p=0,...m},v,w,R){if(QW(t,m,w),v){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:C,style:A}=t;C.transform&&(A.transform=C.transform,delete C.transform),(A.transform||C.transformOrigin)&&(A.transformOrigin=C.transformOrigin??"50% 50%",delete C.transformOrigin),A.transform&&(A.transformBox=(R==null?void 0:R.transformBox)??"fill-box",delete C.transformBox);for(const O of D4e)C[O]!==void 0&&(A[O]=C[O],delete C[O]);e!==void 0&&(C.x=e),r!==void 0&&(C.y=r),a!==void 0&&(C.scale=a),l!==void 0&&P4e(C,l,u,p,!1)}const Ufe=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]),Vfe=t=>typeof t=="string"&&t.toLowerCase()==="svg";function O4e(t,e,r,a){Lfe(t,e,void 0,a);for(const l in e.attrs)t.setAttribute(Ufe.has(l)?l:KW(l),e.attrs[l])}function Ffe(t,e,r){const a=ZW(t,e,r);for(const l in t)if(qo(t[l])||qo(e[l])){const u=Zw.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;a[u]=t[l]}return a}class L4e extends Afe{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=fo}getBaseTargetFromProps(e,r){return e[r]}readValueFromInstance(e,r){if(eS.has(r)){const a=vfe(r);return a&&a.default||0}return r=Ufe.has(r)?r:KW(r),e.getAttribute(r)}scrapeMotionValuesFromProps(e,r,a){return Ffe(e,r,a)}build(e,r,a){Mfe(e,r,this.isSVGTag,a.transformTemplate,a.style)}renderInstance(e,r,a,l){O4e(e,r,a,l)}mount(e){this.isSVGTag=Vfe(e.tagName),super.mount(e)}}const j4e=JW.length;function Bfe(t){if(!t)return;if(!t.isControllingVariants){const r=t.parent?Bfe(t.parent)||{}:{};return t.props.initial!==void 0&&(r.initial=t.props.initial),r}const e={};for(let r=0;r<j4e;r++){const a=JW[r],l=t.props[a];(ON(l)||l===!1)&&(e[a]=l)}return e}function zfe(t,e){if(!Array.isArray(e))return!1;const r=e.length;if(r!==t.length)return!1;for(let a=0;a<r;a++)if(e[a]!==t[a])return!1;return!0}const M4e=[...XW].reverse(),U4e=XW.length;function V4e(t){return e=>Promise.all(e.map(({animation:r,options:a})=>KVe(t,r,a)))}function F4e(t){let e=V4e(t),r=Zie(),a=!0;const l=v=>(w,R)=>{var A;const C=qb(t,R,v==="exit"?(A=t.presenceContext)==null?void 0:A.custom:void 0);if(C){const{transition:O,transitionEnd:U,...F}=C;w={...w,...F,...U}}return w};function u(v){e=v(t)}function p(v){const{props:w}=t,R=Bfe(t.parent)||{},C=[],A=new Set;let O={},U=1/0;for(let q=0;q<U4e;q++){const W=M4e[q],H=r[W],X=w[W]!==void 0?w[W]:R[W],ne=ON(X),te=W===v?H.isActive:null;te===!1&&(U=q);let he=X===R[W]&&X!==w[W]&&ne;if(he&&a&&t.manuallyAnimateOnMount&&(he=!1),H.protectedKeys={...O},!H.isActive&&te===null||!X&&!H.prevProp||qL(X)||typeof X=="boolean")continue;const J=B4e(H.prevProp,X);let Q=J||W===v&&H.isActive&&!he&&ne||q>U&&ne,ce=!1;const de=Array.isArray(X)?X:[X];let pe=de.reduce(l(W),{});te===!1&&(pe={});const{prevResolvedValues:be={}}=H,ye={...be,...pe},Ze=lt=>{Q=!0,A.has(lt)&&(ce=!0,A.delete(lt)),H.needsAnimating[lt]=!0;const Le=t.getValue(lt);Le&&(Le.liveStyle=!1)};for(const lt in ye){const Le=pe[lt],Me=be[lt];if(O.hasOwnProperty(lt))continue;let Ke=!1;Cz(Le)&&Cz(Me)?Ke=!zfe(Le,Me):Ke=Le!==Me,Ke?Le!=null?Ze(lt):A.add(lt):Le!==void 0&&A.has(lt)?Ze(lt):H.protectedKeys[lt]=!0}H.prevProp=X,H.prevResolvedValues=pe,H.isActive&&(O={...O,...pe}),a&&t.blockInitialAnimation&&(Q=!1);const It=he&&J;Q&&(!It||ce)&&C.push(...de.map(lt=>{const Le={type:W};if(typeof lt=="string"&&a&&!It&&t.manuallyAnimateOnMount&&t.parent){const{parent:Me}=t,Ke=qb(Me,lt);if(Me.enteringChildren&&Ke){const{delayChildren:Rt}=Ke.transition||{};Le.delay=ufe(Me.enteringChildren,t,Rt)}}return{animation:lt,options:Le}}))}if(A.size){const q={};if(typeof w.initial!="boolean"){const W=qb(t,Array.isArray(w.initial)?w.initial[0]:w.initial);W&&W.transition&&(q.transition=W.transition)}A.forEach(W=>{const H=t.getBaseTarget(W),X=t.getValue(W);X&&(X.liveStyle=!0),q[W]=H??null}),C.push({animation:q})}let F=!!C.length;return a&&(w.initial===!1||w.initial===w.animate)&&!t.manuallyAnimateOnMount&&(F=!1),a=!1,F?e(C):Promise.resolve()}function m(v,w){var C;if(r[v].isActive===w)return Promise.resolve();(C=t.variantChildren)==null||C.forEach(A=>{var O;return(O=A.animationState)==null?void 0:O.setActive(v,w)}),r[v].isActive=w;const R=p(v);for(const A in r)r[A].protectedKeys={};return R}return{animateChanges:p,setActive:m,setAnimateFunction:u,getState:()=>r,reset:()=>{r=Zie()}}}function B4e(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!zfe(e,t):!1}function Wy(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Zie(){return{animate:Wy(!0),whileInView:Wy(),whileHover:Wy(),whileTap:Wy(),whileDrag:Wy(),whileFocus:Wy(),exit:Wy()}}function ese(t,e){t.min=e.min,t.max=e.max}function Xh(t,e){ese(t.x,e.x),ese(t.y,e.y)}function tse(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}const Gfe=1e-4,z4e=1-Gfe,G4e=1+Gfe,Wfe=.01,W4e=0-Wfe,H4e=0+Wfe;function Rl(t){return t.max-t.min}function K4e(t,e,r){return Math.abs(t-e)<=r}function nse(t,e,r,a=.5){t.origin=a,t.originPoint=pa(e.min,e.max,t.origin),t.scale=Rl(r)/Rl(e),t.translate=pa(r.min,r.max,t.origin)-t.originPoint,(t.scale>=z4e&&t.scale<=G4e||isNaN(t.scale))&&(t.scale=1),(t.translate>=W4e&&t.translate<=H4e||isNaN(t.translate))&&(t.translate=0)}function HC(t,e,r,a){nse(t.x,e.x,r.x,a?a.originX:void 0),nse(t.y,e.y,r.y,a?a.originY:void 0)}function rse(t,e,r){t.min=r.min+e.min,t.max=t.min+Rl(e)}function q4e(t,e,r){rse(t.x,e.x,r.x),rse(t.y,e.y,r.y)}function ise(t,e,r){t.min=e.min-r.min,t.max=t.min+Rl(e)}function AO(t,e,r){ise(t.x,e.x,r.x),ise(t.y,e.y,r.y)}function sse(t,e,r,a,l){return t-=e,t=IO(t,1/r,a),l!==void 0&&(t=IO(t,1/l,a)),t}function Y4e(t,e=0,r=1,a=.5,l,u=t,p=t){if(Nf.test(e)&&(e=parseFloat(e),e=pa(p.min,p.max,e/100)-p.min),typeof e!="number")return;let m=pa(u.min,u.max,a);t===u&&(m-=e),t.min=sse(t.min,e,r,m,l),t.max=sse(t.max,e,r,m,l)}function ase(t,e,[r,a,l],u,p){Y4e(t,e[r],e[a],e[l],e.scale,u,p)}const $4e=["x","scaleX","originX"],X4e=["y","scaleY","originY"];function ose(t,e,r,a){ase(t.x,e,$4e,r?r.x:void 0,a?a.x:void 0),ase(t.y,e,X4e,r?r.y:void 0,a?a.y:void 0)}function cse(t){return t.translate===0&&t.scale===1}function Hfe(t){return cse(t.x)&&cse(t.y)}function lse(t,e){return t.min===e.min&&t.max===e.max}function J4e(t,e){return lse(t.x,e.x)&&lse(t.y,e.y)}function dse(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function Kfe(t,e){return dse(t.x,e.x)&&dse(t.y,e.y)}function use(t){return Rl(t.x)/Rl(t.y)}function hse(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}function qu(t){return[t("x"),t("y")]}function Q4e(t,e,r){let a="";const l=t.x.translate/e.x,u=t.y.translate/e.y,p=(r==null?void 0:r.z)||0;if((l||u||p)&&(a=`translate3d(${l}px, ${u}px, ${p}px) `),(e.x!==1||e.y!==1)&&(a+=`scale(${1/e.x}, ${1/e.y}) `),r){const{transformPerspective:w,rotate:R,rotateX:C,rotateY:A,skewX:O,skewY:U}=r;w&&(a=`perspective(${w}px) ${a}`),R&&(a+=`rotate(${R}deg) `),C&&(a+=`rotateX(${C}deg) `),A&&(a+=`rotateY(${A}deg) `),O&&(a+=`skewX(${O}deg) `),U&&(a+=`skewY(${U}deg) `)}const m=t.x.scale*e.x,v=t.y.scale*e.y;return(m!==1||v!==1)&&(a+=`scale(${m}, ${v})`),a||"none"}const qfe=["TopLeft","TopRight","BottomLeft","BottomRight"],Z4e=qfe.length,pse=t=>typeof t=="string"?parseFloat(t):t,fse=t=>typeof t=="number"||_n.test(t);function e3e(t,e,r,a,l,u){l?(t.opacity=pa(0,r.opacity??1,t3e(a)),t.opacityExit=pa(e.opacity??1,0,n3e(a))):u&&(t.opacity=pa(e.opacity??1,r.opacity??1,a));for(let p=0;p<Z4e;p++){const m=`border${qfe[p]}Radius`;let v=mse(e,m),w=mse(r,m);if(v===void 0&&w===void 0)continue;v||(v=0),w||(w=0),v===0||w===0||fse(v)===fse(w)?(t[m]=Math.max(pa(pse(v),pse(w),a),0),(Nf.test(w)||Nf.test(v))&&(t[m]+="%")):t[m]=w}(e.rotate||r.rotate)&&(t.rotate=pa(e.rotate||0,r.rotate||0,a))}function mse(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const t3e=Yfe(0,.5,Bpe),n3e=Yfe(.5,.95,eh);function Yfe(t,e,r){return a=>a<t?0:a>e?1:r(kN(t,e,a))}function r3e(t,e,r){const a=qo(t)?t:Uv(t);return a.start(WW("",a,e,r)),a.animation}function LN(t,e,r,a={passive:!0}){return t.addEventListener(e,r,a),()=>t.removeEventListener(e,r)}const i3e=(t,e)=>t.depth-e.depth;class s3e{constructor(){this.children=[],this.isDirty=!1}add(e){NW(this.children,e),this.isDirty=!0}remove(e){IW(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(i3e),this.isDirty=!1,this.children.forEach(e)}}function a3e(t,e){const r=Tl.now(),a=({timestamp:l})=>{const u=l-r;u>=e&&(Jm(a),t(u-e))};return Es.setup(a,!0),()=>Jm(a)}function ED(t){return qo(t)?t.get():t}class o3e{constructor(){this.members=[]}add(e){NW(this.members,e),e.scheduleRender()}remove(e){if(IW(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const r=this.members[this.members.length-1];r&&this.promote(r)}}relegate(e){const r=this.members.findIndex(l=>e===l);if(r===0)return!1;let a;for(let l=r;l>=0;l--){const u=this.members[l];if(u.isPresent!==!1){a=u;break}}return a?(this.promote(a),!0):!1}promote(e,r){const a=this.lead;if(e!==a&&(this.prevLead=a,this.lead=e,e.show(),a)){a.instance&&a.scheduleRender(),e.scheduleRender();const l=a.options.layoutDependency,u=e.options.layoutDependency;l!==void 0&&u!==void 0&&l===u||(e.resumeFrom=a,r&&(e.resumeFrom.preserveOpacity=!0),a.snapshot&&(e.snapshot=a.snapshot,e.snapshot.latestValues=a.animationValues||a.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0));const{crossfade:m}=e.options;m===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:r,resumingFrom:a}=e;r.onExitComplete&&r.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const xD={hasAnimatedSinceResize:!0,hasEverUpdated:!1},sB=["","X","Y","Z"],c3e=1e3;let l3e=0;function aB(t,e,r,a){const{latestValues:l}=e;l[t]&&(r[t]=l[t],e.setStaticValue(t,0),a&&(a[t]=0))}function $fe(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const r=mfe(e);if(window.MotionHasOptimisedAnimation(r,"transform")){const{layout:l,layoutId:u}=t.options;window.MotionCancelOptimisedAnimation(r,"transform",Es,!(l||u))}const{parent:a}=t;a&&!a.hasCheckedOptimisedAppear&&$fe(a)}function Xfe({attachResizeListener:t,defaultParent:e,measureScroll:r,checkIsScrollRoot:a,resetTransform:l}){return class{constructor(p={},m=e==null?void 0:e()){this.id=l3e++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(h3e),this.nodes.forEach(g3e),this.nodes.forEach(_3e),this.nodes.forEach(p3e)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=p,this.root=m?m.root||m:this,this.path=m?[...m.path,m]:[],this.parent=m,this.depth=m?m.depth+1:0;for(let v=0;v<this.path.length;v++)this.path[v].shouldResetTransform=!0;this.root===this&&(this.nodes=new s3e)}addEventListener(p,m){return this.eventHandlers.has(p)||this.eventHandlers.set(p,new PW),this.eventHandlers.get(p).add(m)}notifyListeners(p,...m){const v=this.eventHandlers.get(p);v&&v.notify(...m)}hasListeners(p){return this.eventHandlers.has(p)}mount(p){if(this.instance)return;this.isSVG=Rfe(p)&&!l4e(p),this.instance=p;const{layoutId:m,layout:v,visualElement:w}=this.options;if(w&&!w.current&&w.mount(p),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(v||m)&&(this.isLayoutDirty=!0),t){let R,C=0;const A=()=>this.root.updateBlockedByResize=!1;Es.read(()=>{C=window.innerWidth}),t(p,()=>{const O=window.innerWidth;O!==C&&(C=O,this.root.updateBlockedByResize=!0,R&&R(),R=a3e(A,250),xD.hasAnimatedSinceResize&&(xD.hasAnimatedSinceResize=!1,this.nodes.forEach(yse)))})}m&&this.root.registerSharedNode(m,this),this.options.animate!==!1&&w&&(m||v)&&this.addEventListener("didUpdate",({delta:R,hasLayoutChanged:C,hasRelativeLayoutChanged:A,layout:O})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const U=this.options.transition||w.getDefaultTransition()||b3e,{onLayoutAnimationStart:F,onLayoutAnimationComplete:q}=w.getProps(),W=!this.targetLayout||!Kfe(this.targetLayout,O),H=!C&&A;if(this.options.layoutRoot||this.resumeFrom||H||C&&(W||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const X={...GW(U,"layout"),onPlay:F,onComplete:q};(w.shouldReduceMotion||this.options.layoutRoot)&&(X.delay=0,X.type=!1),this.startAnimation(X),this.setAnimationOrigin(R,H)}else C||yse(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=O})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const p=this.getStack();p&&p.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Jm(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(y3e),this.animationId++)}getTransformTemplate(){const{visualElement:p}=this.options;return p&&p.getProps().transformTemplate}willUpdate(p=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&$fe(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let R=0;R<this.path.length;R++){const C=this.path[R];C.shouldResetTransform=!0,C.updateScroll("snapshot"),C.options.layoutRoot&&C.willUpdate(!1)}const{layoutId:m,layout:v}=this.options;if(m===void 0&&!v)return;const w=this.getTransformTemplate();this.prevTransformTemplateValue=w?w(this.latestValues,""):void 0,this.updateSnapshot(),p&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(gse);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(_se);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(m3e),this.nodes.forEach(d3e),this.nodes.forEach(u3e)):this.nodes.forEach(_se),this.clearAllSnapshots();const m=Tl.now();Sc.delta=kf(0,1e3/60,m-Sc.timestamp),Sc.timestamp=m,Sc.isProcessing=!0,JF.update.process(Sc),JF.preRender.process(Sc),JF.render.process(Sc),Sc.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,YW.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(f3e),this.sharedNodes.forEach(v3e)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Es.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Es.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Rl(this.snapshot.measuredBox.x)&&!Rl(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let v=0;v<this.path.length;v++)this.path[v].updateScroll();const p=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=fo(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:m}=this.options;m&&m.notify("LayoutMeasure",this.layout.layoutBox,p?p.layoutBox:void 0)}updateScroll(p="measure"){let m=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===p&&(m=!1),m&&this.instance){const v=a(this.instance);this.scroll={animationId:this.root.animationId,phase:p,isRoot:v,offset:r(this.instance),wasRoot:this.scroll?this.scroll.isRoot:v}}}resetTransform(){if(!l)return;const p=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,m=this.projectionDelta&&!Hfe(this.projectionDelta),v=this.getTransformTemplate(),w=v?v(this.latestValues,""):void 0,R=w!==this.prevTransformTemplateValue;p&&this.instance&&(m||Qy(this.latestValues)||R)&&(l(this.instance,w),this.shouldResetTransform=!1,this.scheduleRender())}measure(p=!0){const m=this.measurePageBox();let v=this.removeElementScroll(m);return p&&(v=this.removeTransform(v)),w3e(v),{animationId:this.root.animationId,measuredBox:m,layoutBox:v,latestValues:{},source:this.id}}measurePageBox(){var w;const{visualElement:p}=this.options;if(!p)return fo();const m=p.measureViewportBox();if(!(((w=this.scroll)==null?void 0:w.wasRoot)||this.path.some(S3e))){const{scroll:R}=this.root;R&&(kb(m.x,R.offset.x),kb(m.y,R.offset.y))}return m}removeElementScroll(p){var v;const m=fo();if(Xh(m,p),(v=this.scroll)!=null&&v.wasRoot)return m;for(let w=0;w<this.path.length;w++){const R=this.path[w],{scroll:C,options:A}=R;R!==this.root&&C&&A.layoutScroll&&(C.wasRoot&&Xh(m,p),kb(m.x,C.offset.x),kb(m.y,C.offset.y))}return m}applyTransform(p,m=!1){const v=fo();Xh(v,p);for(let w=0;w<this.path.length;w++){const R=this.path[w];!m&&R.options.layoutScroll&&R.scroll&&R!==R.root&&Pb(v,{x:-R.scroll.offset.x,y:-R.scroll.offset.y}),Qy(R.latestValues)&&Pb(v,R.latestValues)}return Qy(this.latestValues)&&Pb(v,this.latestValues),v}removeTransform(p){const m=fo();Xh(m,p);for(let v=0;v<this.path.length;v++){const w=this.path[v];if(!w.instance||!Qy(w.latestValues))continue;Dz(w.latestValues)&&w.updateSnapshot();const R=fo(),C=w.measurePageBox();Xh(R,C),ose(m,w.latestValues,w.snapshot?w.snapshot.layoutBox:void 0,R)}return Qy(this.latestValues)&&ose(m,this.latestValues),m}setTargetDelta(p){this.targetDelta=p,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(p){this.options={...this.options,...p,crossfade:p.crossfade!==void 0?p.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Sc.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(p=!1){var O;const m=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=m.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=m.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=m.isSharedProjectionDirty);const v=!!this.resumingFrom||this!==m;if(!(p||v&&this.isSharedProjectionDirty||this.isProjectionDirty||(O=this.parent)!=null&&O.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:R,layoutId:C}=this.options;if(!this.layout||!(R||C))return;this.resolvedRelativeTargetAt=Sc.timestamp;const A=this.getClosestProjectingParent();A&&this.linkedParentVersion!==A.layoutVersion&&!A.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(A&&A.layout?this.createRelativeTarget(A,this.layout.layoutBox,A.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=fo(),this.targetWithTransforms=fo()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),q4e(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Xh(this.target,this.layout.layoutBox),Dfe(this.target,this.targetDelta)):Xh(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,A&&!!A.resumingFrom==!!this.resumingFrom&&!A.options.layoutScroll&&A.target&&this.animationProgress!==1?this.createRelativeTarget(A,this.target,A.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||Dz(this.parent.latestValues)||Pfe(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(p,m,v){this.relativeParent=p,this.linkedParentVersion=p.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=fo(),this.relativeTargetOrigin=fo(),AO(this.relativeTargetOrigin,m,v),Xh(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){var U;const p=this.getLead(),m=!!this.resumingFrom||this!==p;let v=!0;if((this.isProjectionDirty||(U=this.parent)!=null&&U.isProjectionDirty)&&(v=!1),m&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(v=!1),this.resolvedRelativeTargetAt===Sc.timestamp&&(v=!1),v)return;const{layout:w,layoutId:R}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(w||R))return;Xh(this.layoutCorrected,this.layout.layoutBox);const C=this.treeScale.x,A=this.treeScale.y;b4e(this.layoutCorrected,this.treeScale,this.path,m),p.layout&&!p.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(p.target=p.layout.layoutBox,p.targetWithTransforms=fo());const{target:O}=p;if(!O){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(tse(this.prevProjectionDelta.x,this.projectionDelta.x),tse(this.prevProjectionDelta.y,this.projectionDelta.y)),HC(this.projectionDelta,this.layoutCorrected,O,this.latestValues),(this.treeScale.x!==C||this.treeScale.y!==A||!hse(this.projectionDelta.x,this.prevProjectionDelta.x)||!hse(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",O))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(p=!0){var m;if((m=this.options.visualElement)==null||m.scheduleRender(),p){const v=this.getStack();v&&v.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Ab(),this.projectionDelta=Ab(),this.projectionDeltaWithTransform=Ab()}setAnimationOrigin(p,m=!1){const v=this.snapshot,w=v?v.latestValues:{},R={...this.latestValues},C=Ab();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!m;const A=fo(),O=v?v.source:void 0,U=this.layout?this.layout.source:void 0,F=O!==U,q=this.getStack(),W=!q||q.members.length<=1,H=!!(F&&!W&&this.options.crossfade===!0&&!this.path.some(x3e));this.animationProgress=0;let X;this.mixTargetDelta=ne=>{const te=ne/1e3;vse(C.x,p.x,te),vse(C.y,p.y,te),this.setTargetDelta(C),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(AO(A,this.layout.layoutBox,this.relativeParent.layout.layoutBox),E3e(this.relativeTarget,this.relativeTargetOrigin,A,te),X&&J4e(this.relativeTarget,X)&&(this.isProjectionDirty=!1),X||(X=fo()),Xh(X,this.relativeTarget)),F&&(this.animationValues=R,e3e(R,w,this.latestValues,te,H,W)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=te},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(p){var m,v,w;this.notifyListeners("animationStart"),(m=this.currentAnimation)==null||m.stop(),(w=(v=this.resumingFrom)==null?void 0:v.currentAnimation)==null||w.stop(),this.pendingAnimation&&(Jm(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Es.update(()=>{xD.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Uv(0)),this.currentAnimation=r3e(this.motionValue,[0,1e3],{...p,velocity:0,isSync:!0,onUpdate:R=>{this.mixTargetDelta(R),p.onUpdate&&p.onUpdate(R)},onStop:()=>{},onComplete:()=>{p.onComplete&&p.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const p=this.getStack();p&&p.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(c3e),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const p=this.getLead();let{targetWithTransforms:m,target:v,layout:w,latestValues:R}=p;if(!(!m||!v||!w)){if(this!==p&&this.layout&&w&&Jfe(this.options.animationType,this.layout.layoutBox,w.layoutBox)){v=this.target||fo();const C=Rl(this.layout.layoutBox.x);v.x.min=p.target.x.min,v.x.max=v.x.min+C;const A=Rl(this.layout.layoutBox.y);v.y.min=p.target.y.min,v.y.max=v.y.min+A}Xh(m,v),Pb(m,R),HC(this.projectionDeltaWithTransform,this.layoutCorrected,m,R)}}registerSharedNode(p,m){this.sharedNodes.has(p)||this.sharedNodes.set(p,new o3e),this.sharedNodes.get(p).add(m);const w=m.options.initialPromotionConfig;m.promote({transition:w?w.transition:void 0,preserveFollowOpacity:w&&w.shouldPreserveFollowOpacity?w.shouldPreserveFollowOpacity(m):void 0})}isLead(){const p=this.getStack();return p?p.lead===this:!0}getLead(){var m;const{layoutId:p}=this.options;return p?((m=this.getStack())==null?void 0:m.lead)||this:this}getPrevLead(){var m;const{layoutId:p}=this.options;return p?(m=this.getStack())==null?void 0:m.prevLead:void 0}getStack(){const{layoutId:p}=this.options;if(p)return this.root.sharedNodes.get(p)}promote({needsReset:p,transition:m,preserveFollowOpacity:v}={}){const w=this.getStack();w&&w.promote(this,v),p&&(this.projectionDelta=void 0,this.needsReset=!0),m&&this.setOptions({transition:m})}relegate(){const p=this.getStack();return p?p.relegate(this):!1}resetSkewAndRotation(){const{visualElement:p}=this.options;if(!p)return;let m=!1;const{latestValues:v}=p;if((v.z||v.rotate||v.rotateX||v.rotateY||v.rotateZ||v.skewX||v.skewY)&&(m=!0),!m)return;const w={};v.z&&aB("z",p,w,this.animationValues);for(let R=0;R<sB.length;R++)aB(`rotate${sB[R]}`,p,w,this.animationValues),aB(`skew${sB[R]}`,p,w,this.animationValues);p.render();for(const R in w)p.setStaticValue(R,w[R]),this.animationValues&&(this.animationValues[R]=w[R]);p.scheduleRender()}applyProjectionStyles(p,m){if(!this.instance||this.isSVG)return;if(!this.isVisible){p.visibility="hidden";return}const v=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,p.visibility="",p.opacity="",p.pointerEvents=ED(m==null?void 0:m.pointerEvents)||"",p.transform=v?v(this.latestValues,""):"none";return}const w=this.getLead();if(!this.projectionDelta||!this.layout||!w.target){this.options.layoutId&&(p.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,p.pointerEvents=ED(m==null?void 0:m.pointerEvents)||""),this.hasProjected&&!Qy(this.latestValues)&&(p.transform=v?v({},""):"none",this.hasProjected=!1);return}p.visibility="";const R=w.animationValues||w.latestValues;this.applyTransformsToTarget();let C=Q4e(this.projectionDeltaWithTransform,this.treeScale,R);v&&(C=v(R,C)),p.transform=C;const{x:A,y:O}=this.projectionDelta;p.transformOrigin=`${A.origin*100}% ${O.origin*100}% 0`,w.animationValues?p.opacity=w===this?R.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:R.opacityExit:p.opacity=w===this?R.opacity!==void 0?R.opacity:"":R.opacityExit!==void 0?R.opacityExit:0;for(const U in Lz){if(R[U]===void 0)continue;const{correct:F,applyTo:q,isCSSVariable:W}=Lz[U],H=C==="none"?R[U]:F(R[U],w);if(q){const X=q.length;for(let ne=0;ne<X;ne++)p[q[ne]]=H}else W?this.options.visualElement.renderState.vars[U]=H:p[U]=H}this.options.layoutId&&(p.pointerEvents=w===this?ED(m==null?void 0:m.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(p=>{var m;return(m=p.currentAnimation)==null?void 0:m.stop()}),this.root.nodes.forEach(gse),this.root.sharedNodes.clear()}}}function d3e(t){t.updateLayout()}function u3e(t){var r;const e=((r=t.resumeFrom)==null?void 0:r.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&e&&t.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:l}=t.layout,{animationType:u}=t.options,p=e.source!==t.layout.source;u==="size"?qu(C=>{const A=p?e.measuredBox[C]:e.layoutBox[C],O=Rl(A);A.min=a[C].min,A.max=A.min+O}):Jfe(u,e.layoutBox,a)&&qu(C=>{const A=p?e.measuredBox[C]:e.layoutBox[C],O=Rl(a[C]);A.max=A.min+O,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[C].max=t.relativeTarget[C].min+O)});const m=Ab();HC(m,a,e.layoutBox);const v=Ab();p?HC(v,t.applyTransform(l,!0),e.measuredBox):HC(v,a,e.layoutBox);const w=!Hfe(m);let R=!1;if(!t.resumeFrom){const C=t.getClosestProjectingParent();if(C&&!C.resumeFrom){const{snapshot:A,layout:O}=C;if(A&&O){const U=fo();AO(U,e.layoutBox,A.layoutBox);const F=fo();AO(F,a,O.layoutBox),Kfe(U,F)||(R=!0),C.options.layoutRoot&&(t.relativeTarget=F,t.relativeTargetOrigin=U,t.relativeParent=C)}}}t.notifyListeners("didUpdate",{layout:a,snapshot:e,delta:v,layoutDelta:m,hasLayoutChanged:w,hasRelativeLayoutChanged:R})}else if(t.isLead()){const{onExitComplete:a}=t.options;a&&a()}t.options.transition=void 0}function h3e(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function p3e(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function f3e(t){t.clearSnapshot()}function gse(t){t.clearMeasurements()}function _se(t){t.isLayoutDirty=!1}function m3e(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function yse(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function g3e(t){t.resolveTargetDelta()}function _3e(t){t.calcProjection()}function y3e(t){t.resetSkewAndRotation()}function v3e(t){t.removeLeadSnapshot()}function vse(t,e,r){t.translate=pa(e.translate,0,r),t.scale=pa(e.scale,1,r),t.origin=e.origin,t.originPoint=e.originPoint}function Ese(t,e,r,a){t.min=pa(e.min,r.min,a),t.max=pa(e.max,r.max,a)}function E3e(t,e,r,a){Ese(t.x,e.x,r.x,a),Ese(t.y,e.y,r.y,a)}function x3e(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const b3e={duration:.45,ease:[.4,0,.1,1]},xse=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),bse=xse("applewebkit/")&&!xse("chrome/")?Math.round:eh;function wse(t){t.min=bse(t.min),t.max=bse(t.max)}function w3e(t){wse(t.x),wse(t.y)}function Jfe(t,e,r){return t==="position"||t==="preserve-aspect"&&!K4e(use(e),use(r),.2)}function S3e(t){var e;return t!==t.root&&((e=t.scroll)==null?void 0:e.wasRoot)}const T3e=Xfe({attachResizeListener:(t,e)=>LN(t,"resize",e),measureScroll:()=>{var t,e;return{x:document.documentElement.scrollLeft||((t=document.body)==null?void 0:t.scrollLeft)||0,y:document.documentElement.scrollTop||((e=document.body)==null?void 0:e.scrollTop)||0}},checkIsScrollRoot:()=>!0}),oB={current:void 0},Qfe=Xfe({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!oB.current){const t=new T3e({});t.mount(window),t.setOptions({layoutScroll:!0}),oB.current=t}return oB.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),bI=V.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function Sse(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function R3e(...t){return e=>{let r=!1;const a=t.map(l=>{const u=Sse(l,e);return!r&&typeof u=="function"&&(r=!0),u});if(r)return()=>{for(let l=0;l<a.length;l++){const u=a[l];typeof u=="function"?u():Sse(t[l],null)}}}}function C3e(...t){return V.useCallback(R3e(...t),t)}class N3e extends V.Component{getSnapshotBeforeUpdate(e){const r=this.props.childRef.current;if(r&&e.isPresent&&!this.props.isPresent){const a=r.offsetParent,l=kz(a)&&a.offsetWidth||0,u=kz(a)&&a.offsetHeight||0,p=this.props.sizeRef.current;p.height=r.offsetHeight||0,p.width=r.offsetWidth||0,p.top=r.offsetTop,p.left=r.offsetLeft,p.right=l-p.width-p.left,p.bottom=u-p.height-p.top}return null}componentDidUpdate(){}render(){return this.props.children}}function I3e({children:t,isPresent:e,anchorX:r,anchorY:a,root:l}){var C;const u=V.useId(),p=V.useRef(null),m=V.useRef({width:0,height:0,top:0,left:0,right:0,bottom:0}),{nonce:v}=V.useContext(bI),w=((C=t.props)==null?void 0:C.ref)??(t==null?void 0:t.ref),R=C3e(p,w);return V.useInsertionEffect(()=>{const{width:A,height:O,top:U,left:F,right:q,bottom:W}=m.current;if(e||!p.current||!A||!O)return;const H=r==="left"?`left: ${F}`:`right: ${q}`,X=a==="bottom"?`bottom: ${W}`:`top: ${U}`;p.current.dataset.motionPopId=u;const ne=document.createElement("style");v&&(ne.nonce=v);const te=l??document.head;return te.appendChild(ne),ne.sheet&&ne.sheet.insertRule(`
          [data-motion-pop-id="${u}"] {
            position: absolute !important;
            width: ${A}px !important;
            height: ${O}px !important;
            ${H}px !important;
            ${X}px !important;
          }
        `),()=>{te.contains(ne)&&te.removeChild(ne)}},[e]),c.jsx(N3e,{isPresent:e,childRef:p,sizeRef:m,children:V.cloneElement(t,{ref:R})})}const A3e=({children:t,initial:e,isPresent:r,onExitComplete:a,custom:l,presenceAffectsLayout:u,mode:p,anchorX:m,anchorY:v,root:w})=>{const R=yI(k3e),C=V.useId();let A=!0,O=V.useMemo(()=>(A=!1,{id:C,initial:e,isPresent:r,custom:l,onExitComplete:U=>{R.set(U,!0);for(const F of R.values())if(!F)return;a&&a()},register:U=>(R.set(U,!1),()=>R.delete(U))}),[r,R,a]);return u&&A&&(O={...O}),V.useMemo(()=>{R.forEach((U,F)=>R.set(F,!1))},[r]),V.useEffect(()=>{!r&&!R.size&&a&&a()},[r]),p==="popLayout"&&(t=c.jsx(I3e,{isPresent:r,anchorX:m,anchorY:v,root:w,children:t})),c.jsx(HL.Provider,{value:O,children:t})};function k3e(){return new Map}function Zfe(t=!0){const e=V.useContext(HL);if(e===null)return[!0,null];const{isPresent:r,onExitComplete:a,register:l}=e,u=V.useId();V.useEffect(()=>{if(t)return l(u)},[t]);const p=V.useCallback(()=>t&&a&&a(u),[u,a,t]);return!r&&a?[!1,p]:[!0]}const U2=t=>t.key||"";function Tse(t){const e=[];return V.Children.forEach(t,r=>{V.isValidElement(r)&&e.push(r)}),e}const Ur=({children:t,custom:e,initial:r=!0,onExitComplete:a,presenceAffectsLayout:l=!0,mode:u="sync",propagate:p=!1,anchorX:m="left",anchorY:v="top",root:w})=>{const[R,C]=Zfe(p),A=V.useMemo(()=>Tse(t),[t]),O=p&&!R?[]:A.map(U2),U=V.useRef(!0),F=V.useRef(A),q=yI(()=>new Map),W=V.useRef(new Set),[H,X]=V.useState(A),[ne,te]=V.useState(A);CW(()=>{U.current=!1,F.current=A;for(let Q=0;Q<ne.length;Q++){const ce=U2(ne[Q]);O.includes(ce)?(q.delete(ce),W.current.delete(ce)):q.get(ce)!==!0&&q.set(ce,!1)}},[ne,O.length,O.join("-")]);const he=[];if(A!==H){let Q=[...A];for(let ce=0;ce<ne.length;ce++){const de=ne[ce],pe=U2(de);O.includes(pe)||(Q.splice(ce,0,de),he.push(de))}return u==="wait"&&he.length&&(Q=he),te(Tse(Q)),X(A),null}const{forceRender:J}=V.useContext(RW);return c.jsx(c.Fragment,{children:ne.map(Q=>{const ce=U2(Q),de=p&&!R?!1:A===ne||O.includes(ce),pe=()=>{if(W.current.has(ce))return;if(W.current.add(ce),q.has(ce))q.set(ce,!0);else return;let be=!0;q.forEach(ye=>{ye||(be=!1)}),be&&(J==null||J(),te(F.current),p&&(C==null||C()),a&&a())};return c.jsx(A3e,{isPresent:de,initial:!U.current||r?void 0:!1,custom:e,presenceAffectsLayout:l,mode:u,root:w,onExitComplete:de?void 0:pe,anchorX:m,anchorY:v,children:Q},ce)})})},eme=V.createContext({strict:!1}),Rse={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]};let Cse=!1;function P3e(){if(Cse)return;const t={};for(const e in Rse)t[e]={isEnabled:r=>Rse[e].some(a=>!!r[a])};Ife(t),Cse=!0}function tme(){return P3e(),y4e()}function D3e(t){const e=tme();for(const r in t)e[r]={...e[r],...t[r]};Ife(e)}const O3e=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function kO(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||O3e.has(t)}let nme=t=>!kO(t);function L3e(t){typeof t=="function"&&(nme=e=>e.startsWith("on")?!kO(e):t(e))}try{L3e(require("@emotion/is-prop-valid").default)}catch{}function j3e(t,e,r){const a={};for(const l in t)l==="values"&&typeof t.values=="object"||(nme(l)||r===!0&&kO(l)||!e&&!kO(l)||t.draggable&&l.startsWith("onDrag"))&&(a[l]=t[l]);return a}const $L=V.createContext({});function M3e(t,e){if(YL(t)){const{initial:r,animate:a}=t;return{initial:r===!1||ON(r)?r:void 0,animate:ON(a)?a:void 0}}return t.inherit!==!1?e:{}}function U3e(t){const{initial:e,animate:r}=M3e(t,V.useContext($L));return V.useMemo(()=>({initial:e,animate:r}),[Nse(e),Nse(r)])}function Nse(t){return Array.isArray(t)?t.join(" "):t}const e9=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function rme(t,e,r){for(const a in e)!qo(e[a])&&!jfe(a,r)&&(t[a]=e[a])}function V3e({transformTemplate:t},e){return V.useMemo(()=>{const r=e9();return QW(r,e,t),Object.assign({},r.vars,r.style)},[e])}function F3e(t,e){const r=t.style||{},a={};return rme(a,r,t),Object.assign(a,V3e(t,e)),a}function B3e(t,e){const r={},a=F3e(t,e);return t.drag&&t.dragListener!==!1&&(r.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(r.tabIndex=0),r.style=a,r}const ime=()=>({...e9(),attrs:{}});function z3e(t,e,r,a){const l=V.useMemo(()=>{const u=ime();return Mfe(u,e,Vfe(a),t.transformTemplate,t.style),{...u.attrs,style:{...u.style}}},[e]);if(t.style){const u={};rme(u,t.style,t),l.style={...u,...l.style}}return l}const G3e=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function t9(t){return typeof t!="string"||t.includes("-")?!1:!!(G3e.indexOf(t)>-1||/[A-Z]/u.test(t))}function W3e(t,e,r,{latestValues:a},l,u=!1,p){const v=(p??t9(t)?z3e:B3e)(e,a,l,t),w=j3e(e,typeof t=="string",u),R=t!==V.Fragment?{...w,...v,ref:r}:{},{children:C}=e,A=V.useMemo(()=>qo(C)?C.get():C,[C]);return V.createElement(t,{...R,children:A})}function H3e({scrapeMotionValuesFromProps:t,createRenderState:e},r,a,l){return{latestValues:K3e(r,a,l,t),renderState:e()}}function K3e(t,e,r,a){const l={},u=a(t,{});for(const A in u)l[A]=ED(u[A]);let{initial:p,animate:m}=t;const v=YL(t),w=Nfe(t);e&&w&&!v&&t.inherit!==!1&&(p===void 0&&(p=e.initial),m===void 0&&(m=e.animate));let R=r?r.initial===!1:!1;R=R||p===!1;const C=R?m:p;if(C&&typeof C!="boolean"&&!qL(C)){const A=Array.isArray(C)?C:[C];for(let O=0;O<A.length;O++){const U=HW(t,A[O]);if(U){const{transitionEnd:F,transition:q,...W}=U;for(const H in W){let X=W[H];if(Array.isArray(X)){const ne=R?X.length-1:0;X=X[ne]}X!==null&&(l[H]=X)}for(const H in F)l[H]=F[H]}}}return l}const sme=t=>(e,r)=>{const a=V.useContext($L),l=V.useContext(HL),u=()=>H3e(t,e,a,l);return r?u():yI(u)},q3e=sme({scrapeMotionValuesFromProps:ZW,createRenderState:e9}),Y3e=sme({scrapeMotionValuesFromProps:Ffe,createRenderState:ime}),$3e=Symbol.for("motionComponentSymbol");function X3e(t,e,r){const a=V.useRef(r);V.useInsertionEffect(()=>{a.current=r});const l=V.useRef(null);return V.useCallback(u=>{var m;u&&((m=t.onMount)==null||m.call(t,u)),e&&(u?e.mount(u):e.unmount());const p=a.current;if(typeof p=="function")if(u){const v=p(u);typeof v=="function"&&(l.current=v)}else l.current?(l.current(),l.current=null):p(u);else p&&(p.current=u)},[e])}const ame=V.createContext({});function yC(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function J3e(t,e,r,a,l,u){var W,H;const{visualElement:p}=V.useContext($L),m=V.useContext(eme),v=V.useContext(HL),w=V.useContext(bI).reducedMotion,R=V.useRef(null),C=V.useRef(!1);a=a||m.renderer,!R.current&&a&&(R.current=a(t,{visualState:e,parent:p,props:r,presenceContext:v,blockInitialAnimation:v?v.initial===!1:!1,reducedMotionConfig:w,isSVG:u}),C.current&&R.current&&(R.current.manuallyAnimateOnMount=!0));const A=R.current,O=V.useContext(ame);A&&!A.projection&&l&&(A.type==="html"||A.type==="svg")&&Q3e(R.current,r,l,O);const U=V.useRef(!1);V.useInsertionEffect(()=>{A&&U.current&&A.update(r,v)});const F=r[ffe],q=V.useRef(!!F&&!((W=window.MotionHandoffIsComplete)!=null&&W.call(window,F))&&((H=window.MotionHasOptimisedAnimation)==null?void 0:H.call(window,F)));return CW(()=>{C.current=!0,A&&(U.current=!0,window.MotionIsMounted=!0,A.updateFeatures(),A.scheduleRenderMicrotask(),q.current&&A.animationState&&A.animationState.animateChanges())}),V.useEffect(()=>{A&&(!q.current&&A.animationState&&A.animationState.animateChanges(),q.current&&(queueMicrotask(()=>{var X;(X=window.MotionHandoffMarkAsComplete)==null||X.call(window,F)}),q.current=!1),A.enteringChildren=void 0)}),A}function Q3e(t,e,r,a){const{layoutId:l,layout:u,drag:p,dragConstraints:m,layoutScroll:v,layoutRoot:w,layoutCrossfade:R}=e;t.projection=new r(t.latestValues,e["data-framer-portal-id"]?void 0:ome(t.parent)),t.projection.setOptions({layoutId:l,layout:u,alwaysMeasureLayout:!!p||m&&yC(m),visualElement:t,animationType:typeof u=="string"?u:"both",initialPromotionConfig:a,crossfade:R,layoutScroll:v,layoutRoot:w})}function ome(t){if(t)return t.options.allowProjection!==!1?t.projection:ome(t.parent)}function cB(t,{forwardMotionProps:e=!1,type:r}={},a,l){a&&D3e(a);const u=r?r==="svg":t9(t),p=u?Y3e:q3e;function m(w,R){let C;const A={...V.useContext(bI),...w,layoutId:Z3e(w)},{isStatic:O}=A,U=U3e(w),F=p(w,O);if(!O&&Ape){eFe();const q=tFe(A);C=q.MeasureLayout,U.visualElement=J3e(t,F,A,l,q.ProjectionNode,u)}return c.jsxs($L.Provider,{value:U,children:[C&&U.visualElement?c.jsx(C,{visualElement:U.visualElement,...A}):null,W3e(t,w,X3e(F,U.visualElement,R),F,O,e,u)]})}m.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const v=V.forwardRef(m);return v[$3e]=t,v}function Z3e({layoutId:t}){const e=V.useContext(RW).id;return e&&t!==void 0?e+"-"+t:t}function eFe(t,e){V.useContext(eme).strict}function tFe(t){const e=tme(),{drag:r,layout:a}=e;if(!r&&!a)return{};const l={...r,...a};return{MeasureLayout:r!=null&&r.isEnabled(t)||a!=null&&a.isEnabled(t)?l.MeasureLayout:void 0,ProjectionNode:l.ProjectionNode}}function nFe(t,e){if(typeof Proxy>"u")return cB;const r=new Map,a=(u,p)=>cB(u,p,t,e),l=(u,p)=>a(u,p);return new Proxy(l,{get:(u,p)=>p==="create"?a:(r.has(p)||r.set(p,cB(p,void 0,t,e)),r.get(p))})}const rFe=(t,e)=>e.isSVG??t9(t)?new L4e(e):new I4e(e,{allowProjection:t!==V.Fragment});class iFe extends E0{constructor(e){super(e),e.animationState||(e.animationState=F4e(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();qL(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:r}=this.node.prevProps||{};e!==r&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)==null||e.call(this)}}let sFe=0;class aFe extends E0{constructor(){super(...arguments),this.id=sFe++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:r}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===a)return;const l=this.node.animationState.setActive("exit",!e);r&&!e&&l.then(()=>{r(this.id)})}mount(){const{register:e,onExitComplete:r}=this.node.presenceContext||{};r&&r(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const oFe={animation:{Feature:iFe},exit:{Feature:aFe}};function wI(t){return{point:{x:t.pageX,y:t.pageY}}}const cFe=t=>e=>$W(e)&&t(e,wI(e));function KC(t,e,r,a){return LN(t,e,cFe(r),a)}const cme=({current:t})=>t?t.ownerDocument.defaultView:null,Ise=(t,e)=>Math.abs(t-e);function lFe(t,e){const r=Ise(t.x,e.x),a=Ise(t.y,e.y);return Math.sqrt(r**2+a**2)}const Ase=new Set(["auto","scroll"]);class lme{constructor(e,r,{transformPagePoint:a,contextWindow:l=window,dragSnapToOrigin:u=!1,distanceThreshold:p=3,element:m}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.scrollPositions=new Map,this.removeScrollListeners=null,this.onElementScroll=O=>{this.handleScroll(O.target)},this.onWindowScroll=()=>{this.handleScroll(window)},this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const O=dB(this.lastMoveEventInfo,this.history),U=this.startEvent!==null,F=lFe(O.offset,{x:0,y:0})>=this.distanceThreshold;if(!U&&!F)return;const{point:q}=O,{timestamp:W}=Sc;this.history.push({...q,timestamp:W});const{onStart:H,onMove:X}=this.handlers;U||(H&&H(this.lastMoveEvent,O),this.startEvent=this.lastMoveEvent),X&&X(this.lastMoveEvent,O)},this.handlePointerMove=(O,U)=>{this.lastMoveEvent=O,this.lastMoveEventInfo=lB(U,this.transformPagePoint),Es.update(this.updatePoint,!0)},this.handlePointerUp=(O,U)=>{this.end();const{onEnd:F,onSessionEnd:q,resumeAnimation:W}=this.handlers;if((this.dragSnapToOrigin||!this.startEvent)&&W&&W(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const H=dB(O.type==="pointercancel"?this.lastMoveEventInfo:lB(U,this.transformPagePoint),this.history);this.startEvent&&F&&F(O,H),q&&q(O,H)},!$W(e))return;this.dragSnapToOrigin=u,this.handlers=r,this.transformPagePoint=a,this.distanceThreshold=p,this.contextWindow=l||window;const v=wI(e),w=lB(v,this.transformPagePoint),{point:R}=w,{timestamp:C}=Sc;this.history=[{...R,timestamp:C}];const{onSessionStart:A}=r;A&&A(e,dB(w,this.history)),this.removeListeners=vI(KC(this.contextWindow,"pointermove",this.handlePointerMove),KC(this.contextWindow,"pointerup",this.handlePointerUp),KC(this.contextWindow,"pointercancel",this.handlePointerUp)),m&&this.startScrollTracking(m)}startScrollTracking(e){let r=e.parentElement;for(;r;){const a=getComputedStyle(r);(Ase.has(a.overflowX)||Ase.has(a.overflowY))&&this.scrollPositions.set(r,{x:r.scrollLeft,y:r.scrollTop}),r=r.parentElement}this.scrollPositions.set(window,{x:window.scrollX,y:window.scrollY}),window.addEventListener("scroll",this.onElementScroll,{capture:!0,passive:!0}),window.addEventListener("scroll",this.onWindowScroll,{passive:!0}),this.removeScrollListeners=()=>{window.removeEventListener("scroll",this.onElementScroll,{capture:!0}),window.removeEventListener("scroll",this.onWindowScroll)}}handleScroll(e){const r=this.scrollPositions.get(e);if(!r)return;const a=e===window,l=a?{x:window.scrollX,y:window.scrollY}:{x:e.scrollLeft,y:e.scrollTop},u={x:l.x-r.x,y:l.y-r.y};u.x===0&&u.y===0||(a?this.lastMoveEventInfo&&(this.lastMoveEventInfo.point.x+=u.x,this.lastMoveEventInfo.point.y+=u.y):this.history.length>0&&(this.history[0].x-=u.x,this.history[0].y-=u.y),this.scrollPositions.set(e,l),Es.update(this.updatePoint,!0))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),this.removeScrollListeners&&this.removeScrollListeners(),this.scrollPositions.clear(),Jm(this.updatePoint)}}function lB(t,e){return e?{point:e(t.point)}:t}function kse(t,e){return{x:t.x-e.x,y:t.y-e.y}}function dB({point:t},e){return{point:t,delta:kse(t,dme(e)),offset:kse(t,dFe(e)),velocity:uFe(e,.1)}}function dFe(t){return t[0]}function dme(t){return t[t.length-1]}function uFe(t,e){if(t.length<2)return{x:0,y:0};let r=t.length-1,a=null;const l=dme(t);for(;r>=0&&(a=t[r],!(l.timestamp-a.timestamp>Um(e)));)r--;if(!a)return{x:0,y:0};const u=Qu(l.timestamp-a.timestamp);if(u===0)return{x:0,y:0};const p={x:(l.x-a.x)/u,y:(l.y-a.y)/u};return p.x===1/0&&(p.x=0),p.y===1/0&&(p.y=0),p}function hFe(t,{min:e,max:r},a){return e!==void 0&&t<e?t=a?pa(e,t,a.min):Math.max(t,e):r!==void 0&&t>r&&(t=a?pa(r,t,a.max):Math.min(t,r)),t}function Pse(t,e,r){return{min:e!==void 0?t.min+e:void 0,max:r!==void 0?t.max+r-(t.max-t.min):void 0}}function pFe(t,{top:e,left:r,bottom:a,right:l}){return{x:Pse(t.x,r,l),y:Pse(t.y,e,a)}}function Dse(t,e){let r=e.min-t.min,a=e.max-t.max;return e.max-e.min<t.max-t.min&&([r,a]=[a,r]),{min:r,max:a}}function fFe(t,e){return{x:Dse(t.x,e.x),y:Dse(t.y,e.y)}}function mFe(t,e){let r=.5;const a=Rl(t),l=Rl(e);return l>a?r=kN(e.min,e.max-a,t.min):a>l&&(r=kN(t.min,t.max-l,e.min)),kf(0,1,r)}function gFe(t,e){const r={};return e.min!==void 0&&(r.min=e.min-t.min),e.max!==void 0&&(r.max=e.max-t.min),r}const jz=.35;function _Fe(t=jz){return t===!1?t=0:t===!0&&(t=jz),{x:Ose(t,"left","right"),y:Ose(t,"top","bottom")}}function Ose(t,e,r){return{min:Lse(t,e),max:Lse(t,r)}}function Lse(t,e){return typeof t=="number"?t:t[e]||0}const yFe=new WeakMap;class vFe{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=fo(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:r=!1,distanceThreshold:a}={}){const{presenceContext:l}=this.visualElement;if(l&&l.isPresent===!1)return;const u=C=>{r?(this.stopAnimation(),this.snapToCursor(wI(C).point)):this.pauseAnimation()},p=(C,A)=>{this.stopAnimation();const{drag:O,dragPropagation:U,onDragStart:F}=this.getProps();if(O&&!U&&(this.openDragLock&&this.openDragLock(),this.openDragLock=i4e(O),!this.openDragLock))return;this.latestPointerEvent=C,this.latestPanInfo=A,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),qu(W=>{let H=this.getAxisMotionValue(W).get()||0;if(Nf.test(H)){const{projection:X}=this.visualElement;if(X&&X.layout){const ne=X.layout.layoutBox[W];ne&&(H=Rl(ne)*(parseFloat(H)/100))}}this.originPoint[W]=H}),F&&Es.postRender(()=>F(C,A)),Nz(this.visualElement,"transform");const{animationState:q}=this.visualElement;q&&q.setActive("whileDrag",!0)},m=(C,A)=>{this.latestPointerEvent=C,this.latestPanInfo=A;const{dragPropagation:O,dragDirectionLock:U,onDirectionLock:F,onDrag:q}=this.getProps();if(!O&&!this.openDragLock)return;const{offset:W}=A;if(U&&this.currentDirection===null){this.currentDirection=EFe(W),this.currentDirection!==null&&F&&F(this.currentDirection);return}this.updateAxis("x",A.point,W),this.updateAxis("y",A.point,W),this.visualElement.render(),q&&q(C,A)},v=(C,A)=>{this.latestPointerEvent=C,this.latestPanInfo=A,this.stop(C,A),this.latestPointerEvent=null,this.latestPanInfo=null},w=()=>qu(C=>{var A;return this.getAnimationState(C)==="paused"&&((A=this.getAxisMotionValue(C).animation)==null?void 0:A.play())}),{dragSnapToOrigin:R}=this.getProps();this.panSession=new lme(e,{onSessionStart:u,onStart:p,onMove:m,onSessionEnd:v,resumeAnimation:w},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:R,distanceThreshold:a,contextWindow:cme(this.visualElement),element:this.visualElement.current})}stop(e,r){const a=e||this.latestPointerEvent,l=r||this.latestPanInfo,u=this.isDragging;if(this.cancel(),!u||!l||!a)return;const{velocity:p}=l;this.startAnimation(p);const{onDragEnd:m}=this.getProps();m&&Es.postRender(()=>m(a,l))}cancel(){this.isDragging=!1;const{projection:e,animationState:r}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.endPanSession();const{dragPropagation:a}=this.getProps();!a&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),r&&r.setActive("whileDrag",!1)}endPanSession(){this.panSession&&this.panSession.end(),this.panSession=void 0}updateAxis(e,r,a){const{drag:l}=this.getProps();if(!a||!V2(e,l,this.currentDirection))return;const u=this.getAxisMotionValue(e);let p=this.originPoint[e]+a[e];this.constraints&&this.constraints[e]&&(p=hFe(p,this.constraints[e],this.elastic[e])),u.set(p)}resolveConstraints(){var u;const{dragConstraints:e,dragElastic:r}=this.getProps(),a=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(u=this.visualElement.projection)==null?void 0:u.layout,l=this.constraints;e&&yC(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&a?this.constraints=pFe(a.layoutBox,e):this.constraints=!1,this.elastic=_Fe(r),l!==this.constraints&&a&&this.constraints&&!this.hasMutatedConstraints&&qu(p=>{this.constraints!==!1&&this.getAxisMotionValue(p)&&(this.constraints[p]=gFe(a.layoutBox[p],this.constraints[p]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:r}=this.getProps();if(!e||!yC(e))return!1;const a=e.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const u=w4e(a,l.root,this.visualElement.getTransformPagePoint());let p=fFe(l.layout.layoutBox,u);if(r){const m=r(E4e(p));this.hasMutatedConstraints=!!m,m&&(p=kfe(m))}return p}startAnimation(e){const{drag:r,dragMomentum:a,dragElastic:l,dragTransition:u,dragSnapToOrigin:p,onDragTransitionEnd:m}=this.getProps(),v=this.constraints||{},w=qu(R=>{if(!V2(R,r,this.currentDirection))return;let C=v&&v[R]||{};p&&(C={min:0,max:0});const A=l?200:1e6,O=l?40:1e7,U={type:"inertia",velocity:a?e[R]:0,bounceStiffness:A,bounceDamping:O,timeConstant:750,restDelta:1,restSpeed:10,...u,...C};return this.startAxisValueAnimation(R,U)});return Promise.all(w).then(m)}startAxisValueAnimation(e,r){const a=this.getAxisMotionValue(e);return Nz(this.visualElement,e),a.start(WW(e,a,0,r,this.visualElement,!1))}stopAnimation(){qu(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){qu(e=>{var r;return(r=this.getAxisMotionValue(e).animation)==null?void 0:r.pause()})}getAnimationState(e){var r;return(r=this.getAxisMotionValue(e).animation)==null?void 0:r.state}getAxisMotionValue(e){const r=`_drag${e.toUpperCase()}`,a=this.visualElement.getProps(),l=a[r];return l||this.visualElement.getValue(e,(a.initial?a.initial[e]:void 0)||0)}snapToCursor(e){qu(r=>{const{drag:a}=this.getProps();if(!V2(r,a,this.currentDirection))return;const{projection:l}=this.visualElement,u=this.getAxisMotionValue(r);if(l&&l.layout){const{min:p,max:m}=l.layout.layoutBox[r],v=u.get()||0;u.set(e[r]-pa(p,m,.5)+v)}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:r}=this.getProps(),{projection:a}=this.visualElement;if(!yC(r)||!a||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};qu(p=>{const m=this.getAxisMotionValue(p);if(m&&this.constraints!==!1){const v=m.get();l[p]=mFe({min:v,max:v},this.constraints[p])}});const{transformTemplate:u}=this.visualElement.getProps();this.visualElement.current.style.transform=u?u({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),qu(p=>{if(!V2(p,e,null))return;const m=this.getAxisMotionValue(p),{min:v,max:w}=this.constraints[p];m.set(pa(v,w,l[p]))})}addListeners(){if(!this.visualElement.current)return;yFe.set(this.visualElement,this);const e=this.visualElement.current,r=KC(e,"pointerdown",v=>{const{drag:w,dragListener:R=!0}=this.getProps(),C=v.target,A=C!==e&&Tfe(C);w&&R&&!A&&this.start(v)}),a=()=>{const{dragConstraints:v}=this.getProps();yC(v)&&v.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,u=l.addEventListener("measure",a);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),Es.read(a);const p=LN(window,"resize",()=>this.scalePositionWithinConstraints()),m=l.addEventListener("didUpdate",({delta:v,hasLayoutChanged:w})=>{this.isDragging&&w&&(qu(R=>{const C=this.getAxisMotionValue(R);C&&(this.originPoint[R]+=v[R].translate,C.set(C.get()+v[R].translate))}),this.visualElement.render())});return()=>{p(),r(),u(),m&&m()}}getProps(){const e=this.visualElement.getProps(),{drag:r=!1,dragDirectionLock:a=!1,dragPropagation:l=!1,dragConstraints:u=!1,dragElastic:p=jz,dragMomentum:m=!0}=e;return{...e,drag:r,dragDirectionLock:a,dragPropagation:l,dragConstraints:u,dragElastic:p,dragMomentum:m}}}function V2(t,e,r){return(e===!0||e===t)&&(r===null||r===t)}function EFe(t,e=10){let r=null;return Math.abs(t.y)>e?r="y":Math.abs(t.x)>e&&(r="x"),r}class xFe extends E0{constructor(e){super(e),this.removeGroupControls=eh,this.removeListeners=eh,this.controls=new vFe(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||eh}update(){const{dragControls:e}=this.node.getProps(),{dragControls:r}=this.node.prevProps||{};e!==r&&(this.removeGroupControls(),e&&(this.removeGroupControls=e.subscribe(this.controls)))}unmount(){this.removeGroupControls(),this.removeListeners(),this.controls.isDragging||this.controls.endPanSession()}}const jse=t=>(e,r)=>{t&&Es.postRender(()=>t(e,r))};class bFe extends E0{constructor(){super(...arguments),this.removePointerDownListener=eh}onPointerDown(e){this.session=new lme(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:cme(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:r,onPan:a,onPanEnd:l}=this.node.getProps();return{onSessionStart:jse(e),onStart:jse(r),onMove:a,onEnd:(u,p)=>{delete this.session,l&&Es.postRender(()=>l(u,p))}}}mount(){this.removePointerDownListener=KC(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}let uB=!1;class wFe extends V.Component{componentDidMount(){const{visualElement:e,layoutGroup:r,switchLayoutGroup:a,layoutId:l}=this.props,{projection:u}=e;u&&(r.group&&r.group.add(u),a&&a.register&&l&&a.register(u),uB&&u.root.didUpdate(),u.addEventListener("animationComplete",()=>{this.safeToRemove()}),u.setOptions({...u.options,layoutDependency:this.props.layoutDependency,onExitComplete:()=>this.safeToRemove()})),xD.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:r,visualElement:a,drag:l,isPresent:u}=this.props,{projection:p}=a;return p&&(p.isPresent=u,e.layoutDependency!==r&&p.setOptions({...p.options,layoutDependency:r}),uB=!0,l||e.layoutDependency!==r||r===void 0||e.isPresent!==u?p.willUpdate():this.safeToRemove(),e.isPresent!==u&&(u?p.promote():p.relegate()||Es.postRender(()=>{const m=p.getStack();(!m||!m.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),YW.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:r,switchLayoutGroup:a}=this.props,{projection:l}=e;uB=!0,l&&(l.scheduleCheckAfterUnmount(),r&&r.group&&r.group.remove(l),a&&a.deregister&&a.deregister(l))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function ume(t){const[e,r]=Zfe(),a=V.useContext(RW);return c.jsx(wFe,{...t,layoutGroup:a,switchLayoutGroup:V.useContext(ame),isPresent:e,safeToRemove:r})}const SFe={pan:{Feature:bFe},drag:{Feature:xFe,ProjectionNode:Qfe,MeasureLayout:ume}};function Mse(t,e,r){const{props:a}=t;t.animationState&&a.whileHover&&t.animationState.setActive("whileHover",r==="Start");const l="onHover"+r,u=a[l];u&&Es.postRender(()=>u(e,wI(e)))}class TFe extends E0{mount(){const{current:e}=this.node;e&&(this.unmount=s4e(e,(r,a)=>(Mse(this.node,a,"Start"),l=>Mse(this.node,l,"End"))))}unmount(){}}class RFe extends E0{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=vI(LN(this.node.current,"focus",()=>this.onFocus()),LN(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function Use(t,e,r){const{props:a}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&a.whileTap&&t.animationState.setActive("whileTap",r==="Start");const l="onTap"+(r==="End"?"":r),u=a[l];u&&Es.postRender(()=>u(e,wI(e)))}class CFe extends E0{mount(){const{current:e}=this.node;e&&(this.unmount=c4e(e,(r,a)=>(Use(this.node,a,"Start"),(l,{success:u})=>Use(this.node,l,u?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Mz=new WeakMap,hB=new WeakMap,NFe=t=>{const e=Mz.get(t.target);e&&e(t)},IFe=t=>{t.forEach(NFe)};function AFe({root:t,...e}){const r=t||document;hB.has(r)||hB.set(r,{});const a=hB.get(r),l=JSON.stringify(e);return a[l]||(a[l]=new IntersectionObserver(IFe,{root:t,...e})),a[l]}function kFe(t,e,r){const a=AFe(e);return Mz.set(t,r),a.observe(t),()=>{Mz.delete(t),a.unobserve(t)}}const PFe={some:0,all:1};class DFe extends E0{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:r,margin:a,amount:l="some",once:u}=e,p={root:r?r.current:void 0,rootMargin:a,threshold:typeof l=="number"?l:PFe[l]},m=v=>{const{isIntersecting:w}=v;if(this.isInView===w||(this.isInView=w,u&&!w&&this.hasEnteredView))return;w&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",w);const{onViewportEnter:R,onViewportLeave:C}=this.node.getProps(),A=w?R:C;A&&A(v)};return kFe(this.node.current,p,m)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:r}=this.node;["amount","margin","root"].some(OFe(e,r))&&this.startObserver()}unmount(){}}function OFe({viewport:t={}},{viewport:e={}}={}){return r=>t[r]!==e[r]}const LFe={inView:{Feature:DFe},tap:{Feature:CFe},focus:{Feature:RFe},hover:{Feature:TFe}},jFe={layout:{ProjectionNode:Qfe,MeasureLayout:ume}},MFe={...oFe,...LFe,...SFe,...jFe},Ne=nFe(MFe,rFe);function hme(t){const e=yI(()=>Uv(t)),{isStatic:r}=V.useContext(bI);if(r){const[,a]=V.useState(t);V.useEffect(()=>e.on("change",a),[])}return e}function pme(t,e){const r=hme(e()),a=()=>r.set(e());return a(),CW(()=>{const l=()=>Es.preRender(a,!1,!0),u=t.map(p=>p.on("change",l));return()=>{u.forEach(p=>p()),Jm(a)}}),r}function UFe(t){WC.current=[],t();const e=pme(WC.current,t);return WC.current=void 0,e}function VFe(t,e,r,a){if(typeof t=="function")return UFe(t);const u=d4e(e,r,a);return Array.isArray(t)?Vse(t,u):Vse([t],([p])=>u(p))}function Vse(t,e){const r=yI(()=>[]);return pme(t,()=>{r.length=0;const a=t.length;for(let l=0;l<a;l++)r[l]=t[l].get();return e(r)})}function FFe(t,e={}){const{isStatic:r}=V.useContext(bI),a=()=>qo(t)?t.get():t;if(r)return VFe(a);const l=hme(a());return V.useInsertionEffect(()=>u4e(l,t,e),[l,JSON.stringify(e)]),l}function BFe(t,e={}){return FFe(t,{type:"spring",...e})}const Fse={enableHighAccuracy:!0,timeout:15e3,maximumAge:0};async function zFe(t,e){var r;try{const a=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${t}&lon=${e}&zoom=16&addressdetails=1`,{headers:{"Accept-Language":"de","User-Agent":"syncluluApp/1.0"}});if(!a.ok)return null;const l=await a.json(),u=l.address||{},p=u.suburb||u.neighbourhood||u.quarter||u.city_district||u.district,m=u.city||u.town||u.village||u.municipality;return{district:p,city:m,country:u.country,formatted:p?`${p}, ${m||""}`:m||((r=l.display_name)==null?void 0:r.split(",")[0])||"Unbekannter Ort"}}catch(a){return console.error("Reverse geocoding error:",a),null}}function GFe(){const[t,e]=V.useState(null),[r,a]=V.useState(null),[l,u]=V.useState(null),[p,m]=V.useState(!0),[v,w]=V.useState(!1),[R,C]=V.useState(!1),A=V.useRef(null),O=V.useRef(null),U=V.useRef(null),F=V.useCallback(X=>{const ne={latitude:X.coords.latitude,longitude:X.coords.longitude,accuracy:X.coords.accuracy,timestamp:X.timestamp};e(ne),m(!1),u(null),w(X.coords.accuracy>100),(!U.current||Math.abs(U.current.lat-ne.latitude)>.001||Math.abs(U.current.lon-ne.longitude)>.001)&&(O.current&&clearTimeout(O.current),O.current=setTimeout(async()=>{const he=await zFe(ne.latitude,ne.longitude);he&&(a(he),U.current={lat:ne.latitude,lon:ne.longitude})},500))},[]),q=V.useCallback(X=>{switch(m(!1),X.code){case X.PERMISSION_DENIED:u("Standort-Zugriff verweigert"),C(!0);break;case X.POSITION_UNAVAILABLE:u("Standort nicht verfgbar"),w(!0);break;case X.TIMEOUT:u("Standort-Anfrage timeout"),w(!0);break;default:u("Unbekannter Standort-Fehler")}console.error("GPS Error:",X.message)},[]),W=V.useCallback(()=>{if(!navigator.geolocation){u("Geolocation wird nicht untersttzt"),m(!1);return}m(!0),u(null),C(!1),navigator.geolocation.getCurrentPosition(F,q,Fse),A.current=navigator.geolocation.watchPosition(F,q,{...Fse,maximumAge:1e4})},[F,q]),H=V.useCallback(()=>{A.current!==null&&(navigator.geolocation.clearWatch(A.current),A.current=null),W()},[W]);return V.useEffect(()=>(W(),()=>{A.current!==null&&navigator.geolocation.clearWatch(A.current),O.current&&clearTimeout(O.current)}),[W]),{location:t,geocoded:r,error:l,isLoading:p,isWeak:v,isDenied:R,retry:H}}const fme=t=>{switch(t){case"hot":return"#ef4444";case"sehr_aktiv":return"#f97316";case"aktiv":return"#a855f7";default:return"#6b7280"}},mme=t=>{switch(t){case"hot":return"rgba(239, 68, 68, 0.5)";case"sehr_aktiv":return"rgba(249, 115, 22, 0.4)";case"aktiv":return"rgba(168, 85, 247, 0.3)";default:return"rgba(107, 114, 128, 0.2)"}},Uz=t=>t<1e3?`${Math.round(t)}m`:`${(t/1e3).toFixed(1)}km`,WFe=(t,e,r,a,l)=>{const u=(e-a)*l*100+50,p=(r-t)*l*100+50;return{x:Math.max(5,Math.min(95,u)),y:Math.max(5,Math.min(95,p))}},HFe=V.memo(function(){return c.jsxs("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-20",children:[c.jsx(Ne.div,{className:"absolute inset-0 rounded-full",style:{background:"rgba(139, 92, 246, 0.3)"},animate:{scale:[1,2.5,1],opacity:[.6,0,.6]},transition:{duration:2,repeat:1/0}}),c.jsx(Ne.div,{className:"absolute inset-0 rounded-full",style:{background:"rgba(139, 92, 246, 0.4)"},animate:{scale:[1,1.8,1],opacity:[.7,0,.7]},transition:{duration:2,repeat:1/0,delay:.3}}),c.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center",style:{background:"linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%)",boxShadow:"0 0 20px rgba(139, 92, 246, 0.6), 0 0 40px rgba(139, 92, 246, 0.3)"},children:c.jsx("div",{className:"w-2 h-2 rounded-full bg-white"})})]})}),KFe=V.memo(function({hotspot:e,position:r,isSelected:a,onClick:l}){const u=fme(e.activityLevel),p=mme(e.activityLevel);return c.jsxs(Ne.button,{onClick:l,initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},whileTap:{scale:.9},className:"absolute z-10",style:{left:`${r.x}%`,top:`${r.y}%`,transform:"translate(-50%, -50%)"},children:[a&&c.jsx(Ne.div,{className:"absolute inset-0 rounded-full",style:{border:`2px solid ${u}`,transform:"scale(1.8)"},animate:{scale:[1.8,2.2,1.8],opacity:[.8,.4,.8]},transition:{duration:1.5,repeat:1/0}}),e.activityLevel==="hot"&&c.jsx(Ne.div,{className:"absolute inset-0 rounded-full",style:{background:p},animate:{scale:[1,2,1],opacity:[.5,0,.5]},transition:{duration:1,repeat:1/0}}),c.jsxs("div",{className:"relative w-10 h-10 rounded-full flex items-center justify-center",style:{background:`linear-gradient(135deg, ${u} 0%, ${u}dd 100%)`,boxShadow:`0 0 15px ${p}`,border:a?"2px solid white":"none"},children:[c.jsx(cr,{size:16,className:"text-white"}),c.jsx("div",{className:"absolute -top-1 -right-1 min-w-[18px] h-[18px] rounded-full flex items-center justify-center px-1",style:{background:"#050505",border:`2px solid ${u}`},children:c.jsx("span",{className:"text-[9px] font-bold text-white",children:e.userCount>99?"99+":e.userCount})})]}),a&&c.jsx(Ne.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},className:"absolute top-full mt-1 left-1/2 -translate-x-1/2 whitespace-nowrap",children:c.jsx("div",{className:"px-2 py-1 rounded-lg text-[10px] font-medium text-white",style:{background:"rgba(5, 5, 5, 0.9)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.name})})]})}),qFe=V.memo(function(){return c.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:[[20,40,60,80].map(e=>c.jsx("div",{className:"absolute left-0 right-0 h-px",style:{top:`${e}%`,background:"linear-gradient(90deg, transparent 0%, rgba(139, 92, 246, 0.1) 50%, transparent 100%)"}},`h-${e}`)),[20,40,60,80].map(e=>c.jsx("div",{className:"absolute top-0 bottom-0 w-px",style:{left:`${e}%`,background:"linear-gradient(180deg, transparent 0%, rgba(139, 92, 246, 0.1) 50%, transparent 100%)"}},`v-${e}`)),c.jsx("div",{className:"absolute left-1/2 top-0 bottom-0 w-px",style:{background:"rgba(139, 92, 246, 0.2)"}}),c.jsx("div",{className:"absolute top-1/2 left-0 right-0 h-px",style:{background:"rgba(139, 92, 246, 0.2)"}})]})}),YFe=V.memo(function(){return c.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:c.jsx(Ne.div,{className:"absolute left-1/2 top-1/2 w-full h-full origin-center",style:{background:"conic-gradient(from 0deg, transparent 0deg, rgba(139, 92, 246, 0.15) 30deg, transparent 60deg)",transform:"translate(-50%, -50%)"},animate:{rotate:360},transition:{duration:4,repeat:1/0,ease:"linear"}})})}),$Fe=V.memo(function({maxDistance:e}){const r=[.25,.5,.75,1];return c.jsxs("div",{className:"absolute inset-0 pointer-events-none flex items-center justify-center",children:[r.map(a=>c.jsx("div",{className:"absolute rounded-full",style:{width:`${a*90}%`,height:`${a*90}%`,border:"1px dashed rgba(139, 92, 246, 0.15)"}},a)),c.jsx("span",{className:"absolute text-[8px] text-white/20 font-medium",style:{top:"12%",left:"52%"},children:Uz(e*.25)}),c.jsx("span",{className:"absolute text-[8px] text-white/20 font-medium",style:{top:"25%",left:"52%"},children:Uz(e*.5)})]})}),XFe=V.memo(function({userLocation:e,hotspots:r,selectedHotspotId:a,onHotspotSelect:l,onHotspotJoin:u,maxDistance:p=2e3,isLoading:m=!1}){const[v,w]=V.useState(null),R=a??v,C=r.find(U=>U.id===R),A=V.useMemo(()=>{if(!e)return[];const U=40/p;return r.filter(F=>(F.distance||0)<=p).map(F=>({hotspot:F,position:WFe(F.latitude,F.longitude,e.lat,e.lng,U)}))},[r,e,p]),O=V.useCallback(U=>{w(U),l==null||l(U)},[l]);return!e&&!m?c.jsx("div",{className:"relative w-full aspect-[4/3] rounded-[24px] overflow-hidden",style:{background:"rgba(5, 5, 5, 0.9)",border:"1px solid rgba(255, 255, 255, 0.06)"},children:c.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-4",children:[c.jsx(Ne.div,{animate:{scale:[1,1.1,1],opacity:[.5,1,.5]},transition:{duration:2,repeat:1/0},children:c.jsx($m,{size:48,className:"text-white/20"})}),c.jsx("p",{className:"text-sm text-white/40 text-center px-8",children:"Aktiviere GPS um die Nebula-Karte zu sehen"})]})}):c.jsxs("div",{className:"relative",children:[c.jsxs("div",{className:"relative w-full aspect-[4/3] rounded-[24px] overflow-hidden",style:{background:"radial-gradient(circle at center, rgba(139, 92, 246, 0.05) 0%, rgba(5, 5, 5, 0.95) 70%)",border:"1px solid rgba(139, 92, 246, 0.2)",boxShadow:"inset 0 0 40px rgba(139, 92, 246, 0.1)"},children:[c.jsx(qFe,{}),c.jsx($Fe,{maxDistance:p}),c.jsx(YFe,{}),m&&c.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-30",children:c.jsx(Ne.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},children:c.jsx(Yd,{size:32,className:"text-violet-400"})})}),!m&&A.map(({hotspot:U,position:F})=>c.jsx(KFe,{hotspot:U,position:F,isSelected:R===U.id,onClick:()=>O(U.id)},U.id)),e&&c.jsx(HFe,{}),!m&&r.length===0&&c.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center z-20",children:[c.jsx(Vs,{size:32,className:"text-white/20 mb-2"}),c.jsx("p",{className:"text-xs text-white/30 text-center",children:"Keine Wlkchen in deiner Nhe"})]}),c.jsx("div",{className:"absolute top-3 right-3 z-20",children:c.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{background:"rgba(5, 5, 5, 0.8)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:c.jsx(_I,{size:14,className:"text-violet-400"})})})]}),c.jsx(Ur,{children:C&&c.jsx(Ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"mt-3",children:c.jsxs("div",{className:"p-4 rounded-2xl",style:{background:"rgba(5, 5, 5, 0.9)",border:"1px solid rgba(139, 92, 246, 0.2)"},children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsxs("div",{children:[c.jsx("h4",{className:"font-bold text-white",children:C.name}),c.jsxs("p",{className:"text-xs text-white/40",children:[Uz(C.distance||0)," entfernt  ",C.userCount," Personen"]})]}),c.jsx("div",{className:"px-2 py-1 rounded-full text-[10px] font-bold uppercase",style:{background:mme(C.activityLevel),color:fme(C.activityLevel)},children:C.activityLevel})]}),c.jsx(Ne.button,{whileTap:{scale:.98},onClick:()=>u==null?void 0:u(C.id),className:"w-full py-3 rounded-xl text-sm font-bold text-white",style:{background:"linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%)"},children:"Jetzt beitreten"})]})})})]})}),pB=V.memo(function({icon:e,title:r,description:a,isGranted:l,isLoading:u,onRequest:p}){return c.jsxs(Ne.button,{whileTap:{scale:.98},onClick:p,disabled:l||u,className:"w-full flex items-center gap-4 p-4 rounded-2xl transition-all",style:{background:l?"rgba(16, 185, 129, 0.1)":"rgba(255, 255, 255, 0.03)",border:l?"1px solid rgba(16, 185, 129, 0.3)":"1px solid rgba(255, 255, 255, 0.08)"},children:[c.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${l?"bg-emerald-500/20":"bg-gradient-to-r from-violet-500 to-purple-600"}`,children:u?c.jsx(fi,{size:22,className:"text-white animate-spin"}):c.jsx(e,{size:22,className:l?"text-emerald-400":"text-white"})}),c.jsxs("div",{className:"flex-1 text-left",children:[c.jsx("h4",{className:"text-sm font-semibold text-white",children:r}),c.jsx("p",{className:"text-xs text-white/50",children:a})]}),l?c.jsx("div",{className:"w-6 h-6 rounded-full bg-emerald-500 flex items-center justify-center",children:c.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}):c.jsx(Fi,{size:20,className:"text-white/30"})]})}),JFe=V.memo(function({isVisible:e,missingPermissions:r,onRequestGeolocation:a,onRequestMicrophone:l,onRequestNotifications:u,onOpenSettings:p}){const[m,v]=V.useState(null),[w,R]=V.useState(new Set),C=async(q,W)=>{v(q),await W()&&R(X=>new Set(X).add(q)),v(null)},A=w.has("geo")||!r.includes("Standort (GPS)"),O=w.has("mic")||!r.includes("Mikrofon"),U=w.has("notif")||!r.includes("Benachrichtigungen"),F=A&&O&&U;return c.jsx(Ur,{children:e&&!F&&c.jsxs(Ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[1000] flex items-center justify-center p-4",style:{background:"rgba(5, 5, 5, 0.95)",backdropFilter:"blur(40px)",WebkitBackdropFilter:"blur(40px)"},children:[c.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[c.jsx(Ne.div,{className:"absolute w-96 h-96 rounded-full bg-violet-600/20 blur-3xl",style:{left:"10%",top:"20%"},animate:{scale:[1,1.2,1],opacity:[.2,.3,.2]},transition:{duration:8,repeat:1/0}}),c.jsx(Ne.div,{className:"absolute w-80 h-80 rounded-full bg-purple-600/20 blur-3xl",style:{right:"10%",bottom:"20%"},animate:{scale:[1.2,1,1.2],opacity:[.3,.2,.3]},transition:{duration:6,repeat:1/0}})]}),c.jsxs(Ne.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},className:"relative max-w-md w-full",children:[c.jsxs("div",{className:"text-center mb-8",children:[c.jsx(Ne.div,{className:"w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-r from-violet-500 to-purple-600 flex items-center justify-center",animate:{boxShadow:["0 0 30px rgba(139, 92, 246, 0.3)","0 0 60px rgba(139, 92, 246, 0.5)","0 0 30px rgba(139, 92, 246, 0.3)"]},transition:{duration:2,repeat:1/0},children:c.jsx(cs,{size:36,className:"text-white"})}),c.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Nebula-Verbindung"}),c.jsxs("p",{className:"text-sm text-white/60 max-w-xs mx-auto",children:["synclulu bentigt deine ",c.jsx("span",{className:"text-violet-400",children:"permanente Aura (GPS)"})," und deine ",c.jsx("span",{className:"text-violet-400",children:"Stimme (Mikrofon)"}),", um die Nebula stabil zu halten."]})]}),c.jsxs("div",{className:"space-y-3 mb-6",children:[c.jsx(pB,{icon:no,title:"Standort (GPS)",description:"Fr Hotspots und Leute in deiner Nhe",isGranted:A,isLoading:m==="geo",onRequest:()=>C("geo",a)}),c.jsx(pB,{icon:Qo,title:"Mikrofon",description:"Fr Voice-Chats in Wlkchen",isGranted:O,isLoading:m==="mic",onRequest:()=>C("mic",l)}),c.jsx(pB,{icon:kl,title:"Benachrichtigungen",description:"Fr Sterne, Anfragen und Updates",isGranted:U,isLoading:m==="notif",onRequest:()=>C("notif",u)})]}),c.jsx("div",{className:"p-4 rounded-xl mb-4",style:{background:"rgba(255, 255, 255, 0.02)",border:"1px solid rgba(255, 255, 255, 0.05)"},children:c.jsx("p",{className:"text-xs text-white/40 text-center",children:"Tippe auf jede Berechtigung, um sie zu aktivieren. Falls der Browser blockiert, ffne die Systemeinstellungen."})}),c.jsxs(Ne.button,{whileTap:{scale:.98},onClick:p,className:"w-full flex items-center justify-center gap-2 py-3 rounded-xl",style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[c.jsx(xO,{size:18,className:"text-white/60"}),c.jsx("span",{className:"text-sm text-white/60",children:"Systemeinstellungen ffnen"})]}),c.jsx("div",{className:"mt-6 flex justify-center gap-2",children:[A,O,U].map((q,W)=>c.jsx(Ne.div,{className:`w-2 h-2 rounded-full ${q?"bg-emerald-500":"bg-white/20"}`,animate:q?{scale:[1,1.3,1]}:{},transition:{duration:.3}},W))})]})]})})});function QFe(){const[t,e]=V.useState({geolocation:"unknown",microphone:"unknown",notifications:"unknown"}),[r,a]=V.useState(!0),l=V.useCallback(async()=>{a(!0);const C={geolocation:"unknown",microphone:"unknown",notifications:"unknown"};try{if("permissions"in navigator)try{const A=await navigator.permissions.query({name:"geolocation"});C.geolocation=A.state,A.onchange=()=>{e(O=>({...O,geolocation:A.state}))}}catch{try{await new Promise((O,U)=>{navigator.geolocation.getCurrentPosition(O,U,{timeout:5e3})}),C.geolocation="granted"}catch{C.geolocation="denied"}}if("permissions"in navigator)try{const A=await navigator.permissions.query({name:"microphone"});C.microphone=A.state,A.onchange=()=>{e(O=>({...O,microphone:A.state}))}}catch{C.microphone="prompt"}if("Notification"in window){const A=Notification.permission;C.notifications=A==="default"?"prompt":A}return e(C),a(!1),C.geolocation==="granted"}catch(A){return console.error("Permission check error:",A),a(!1),!1}},[]),u=V.useCallback(async()=>{try{return await new Promise((C,A)=>{navigator.geolocation.getCurrentPosition(C,A,{enableHighAccuracy:!0,timeout:15e3})}),e(C=>({...C,geolocation:"granted"})),!0}catch{return e(A=>({...A,geolocation:"denied"})),!1}},[]),p=V.useCallback(async()=>{try{return(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(A=>A.stop()),e(A=>({...A,microphone:"granted"})),!0}catch{return e(A=>({...A,microphone:"denied"})),!1}},[]),m=V.useCallback(async()=>{try{const C=await Notification.requestPermission(),A=C==="default"?"prompt":C;return e(O=>({...O,notifications:A})),C==="granted"}catch{return!1}},[]),v=V.useCallback(()=>{const C=/iPad|iPhone|iPod/.test(navigator.userAgent),A=/Android/.test(navigator.userAgent);alert(C?'ffne die Einstellungen-App  synclulu  Aktiviere Standort auf "Immer" und Mikrofon.':A?"ffne Einstellungen  Apps  synclulu  Berechtigungen  Aktiviere Standort und Mikrofon.":"Bitte aktiviere Standort und Mikrofon in deinen Browser-Einstellungen fr diese Seite.")},[]);V.useEffect(()=>{l()},[l]);const w=t.geolocation==="denied",R=[];return t.geolocation!=="granted"&&R.push("Standort (GPS)"),t.microphone!=="granted"&&R.push("Mikrofon"),t.notifications!=="granted"&&R.push("Benachrichtigungen"),{permissions:t,isBlocked:w,isLoading:r,missingPermissions:R,checkPermissions:l,requestGeolocation:u,requestMicrophone:p,requestNotifications:m,openSystemSettings:v}}const ZFe=V.memo(function({userProfile:e,unreadNotifications:r,unreadMessages:a,onProfileClick:l,onNotificationsClick:u}){var p;return c.jsx("div",{className:"absolute top-0 left-0 right-0 z-50 px-5 pt-12 pb-4",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs(Ne.button,{whileTap:{scale:.95},onClick:l,className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-11 h-11 rounded-2xl overflow-hidden",style:{background:"rgba(139, 92, 246, 0.2)",border:"1px solid rgba(139, 92, 246, 0.3)"},children:e!=null&&e.photoURL?c.jsx("img",{src:e.photoURL,alt:e.displayName,className:"w-full h-full object-cover"}):c.jsx("div",{className:"w-full h-full flex items-center justify-center",children:c.jsx("span",{className:"text-base font-semibold text-white/70",children:((p=e==null?void 0:e.displayName)==null?void 0:p.charAt(0).toUpperCase())||"?"})})}),c.jsxs("div",{className:"text-left",children:[c.jsx("p",{className:"text-sm font-semibold text-white",children:(e==null?void 0:e.displayName)||"Hallo"}),c.jsxs("p",{className:"text-[10px] text-white/40",children:[(e==null?void 0:e.auraScore)||0," Aura"]})]})]}),c.jsx("div",{className:"flex items-center gap-2",children:c.jsxs(Ne.button,{whileTap:{scale:.95},onClick:u,className:"relative w-10 h-10 rounded-xl flex items-center justify-center",style:{background:"rgba(255, 255, 255, 0.05)"},children:[c.jsx(kl,{size:18,className:"text-white/60"}),r>0&&c.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 rounded-full bg-violet-500 flex items-center justify-center",children:c.jsx("span",{className:"text-[9px] font-bold text-white",children:r>9?"9+":r})})]})})]})})}),eBe=V.memo(function({nearbyCount:e,activeRooms:r}){return c.jsx("div",{className:"absolute top-28 left-5 right-5 z-40",children:c.jsxs("div",{className:"flex items-center justify-between px-4 py-3 rounded-2xl",style:{background:"rgba(0, 0, 0, 0.6)",backdropFilter:"blur(20px)",border:"1px solid rgba(255, 255, 255, 0.05)"},children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-400 animate-pulse"}),c.jsxs("span",{className:"text-xs text-white/60",children:[c.jsx("span",{className:"text-white font-medium",children:e})," in der Nhe"]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(cr,{size:14,className:"text-violet-400"}),c.jsxs("span",{className:"text-xs text-white/60",children:[c.jsx("span",{className:"text-white font-medium",children:r})," aktive Wlkchen"]})]})]})})});function tBe(){const t=yr(),{user:e}=qv(),[r,a]=V.useState(null),[l,u]=V.useState([]),[p,m]=V.useState(0),[v,w]=V.useState(0),[R,C]=V.useState(null),{isBlocked:A,missingPermissions:O,requestGeolocation:U,requestMicrophone:F,requestNotifications:q,openSystemSettings:W}=QFe(),{location:H,isLoading:X,isDenied:ne}=GFe(),te=H?{lat:H.latitude,lng:H.longitude}:null,he=V.useMemo(()=>l.reduce((J,Q)=>J+Q.userCount,0),[l]);return V.useEffect(()=>{if(!(e!=null&&e.uid))return;(async()=>{try{const Q=await Bn(tt(De,"users",e.uid));if(Q.exists()){const ce=Q.data();a({displayName:ce.displayName||ce.username||"Anonym",photoURL:ce.photoURL,auraScore:ce.auraScore||0})}}catch(Q){console.error("Error fetching profile:",Q)}})()},[e==null?void 0:e.uid]),V.useEffect(()=>{const J=Mr(mn(De,"rooms"),Kn("isActive","==",!0),ih("userCount","desc"),up(20)),Q=na(J,ce=>{const de=[];ce.docs.forEach(pe=>{var ye,Ze;const be=pe.data();(ye=be.location)!=null&&ye.latitude&&((Ze=be.location)!=null&&Ze.longitude)&&de.push({id:pe.id,name:be.name||"Unbenannt",latitude:be.location.latitude,longitude:be.location.longitude,userCount:be.userCount||0,activityLevel:nBe(be.userCount||0),category:be.category})}),u(de)},ce=>{console.error("Error fetching hotspots:",ce),u([])});return()=>Q()},[]),V.useEffect(()=>{if(!(e!=null&&e.uid))return;const J=Mr(mn(De,"notifications"),Kn("userId","==",e.uid),Kn("read","==",!1)),Q=na(J,ce=>{m(ce.size)});return()=>Q()},[e==null?void 0:e.uid]),c.jsxs("div",{className:"fixed inset-0 overflow-hidden",style:{background:"#050505"},children:[c.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:"radial-gradient(ellipse at 50% 0%, rgba(139, 92, 246, 0.06) 0%, transparent 60%)"}}),c.jsx(ZFe,{userProfile:r,unreadNotifications:p,unreadMessages:v,onProfileClick:()=>t("/profile"),onNotificationsClick:()=>t("/notifications")}),c.jsx(eBe,{nearbyCount:he,activeRooms:l.length}),c.jsx("div",{className:"absolute inset-0 pt-40 pb-24",children:c.jsx(XFe,{userLocation:te,hotspots:l,selectedHotspotId:R,onHotspotSelect:C,onHotspotJoin:J=>t(`/room/${J}`),maxDistance:2e3,isLoading:X&&!te})}),c.jsx(JFe,{isVisible:A||ne,missingPermissions:O,onRequestGeolocation:U,onRequestMicrophone:F,onRequestNotifications:q,onOpenSettings:W})]})}const nBe=t=>t>=20?"hot":t>=10?"sehr_aktiv":t>=5?"aktiv":"ruhig",gme={activeCloud:{primary:"#8b5cf6",secondary:"#c084fc",glow:"rgba(139, 92, 246, 0.5)"},friendOnline:{primary:"#10b981",secondary:"#34d399",glow:"rgba(16, 185, 129, 0.5)"},newHotspot:{primary:"#f59e0b",secondary:"#fbbf24",glow:"rgba(245, 158, 11, 0.5)"},regionalBonus:{primary:"#ec4899",secondary:"#f472b6",glow:"rgba(236, 72, 153, 0.5)"}},_me=V.memo(({node:t,onTap:e,isScanning:r})=>{const a=gme[t.type],l=t.type==="activeCloud"?24:t.type==="friendOnline"?20:16;return c.jsxs(Ne.g,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:r?[.3,1,.3]:1},exit:{scale:0,opacity:0},transition:{scale:{type:"spring",stiffness:300,damping:20},opacity:r?{repeat:1/0,duration:1.5}:{duration:.3}},whileHover:{scale:1.3},whileTap:{scale:.9},onClick:()=>e(t),style:{cursor:"pointer"},children:[c.jsx(Ne.circle,{cx:t.x*100,cy:t.y*100,r:l*1.5,fill:a.glow,animate:{r:[l*1.5,l*2,l*1.5],opacity:[.3,.5,.3]},transition:{repeat:1/0,duration:2+Math.random(),ease:"easeInOut"}}),c.jsx("circle",{cx:t.x*100,cy:t.y*100,r:l,fill:`url(#gradient-${t.type})`,stroke:a.primary,strokeWidth:"0.5"}),c.jsx("circle",{cx:t.x*100,cy:t.y*100,r:l*.4,fill:"rgba(255, 255, 255, 0.3)"}),t.count>0&&t.type==="activeCloud"&&c.jsxs("g",{children:[c.jsx("circle",{cx:t.x*100+l*.7,cy:t.y*100-l*.7,r:6,fill:"#ef4444",stroke:"#0a0a0a",strokeWidth:"1"}),c.jsx("text",{x:t.x*100+l*.7,y:t.y*100-l*.7+2,fill:"white",fontSize:"5",textAnchor:"middle",fontWeight:"bold",children:t.count>9?"9+":t.count})]}),t.isNew&&c.jsx(Ne.circle,{cx:t.x*100-l*.7,cy:t.y*100-l*.7,r:4,fill:"#fbbf24",animate:{scale:[1,1.3,1]},transition:{repeat:1/0,duration:1}})]})});_me.displayName="NetworkNode";const yme=V.memo(({from:t,to:e,strength:r=.5})=>c.jsx(Ne.line,{x1:t.x*100,y1:t.y*100,x2:e.x*100,y2:e.y*100,stroke:"rgba(139, 92, 246, 0.3)",strokeWidth:.5+r*.5,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.3+r*.4},transition:{duration:1,ease:"easeOut"}}));yme.displayName="NetworkEdge";const vme=V.memo(()=>c.jsx(Ne.circle,{cx:"50",cy:"50",r:"5",fill:"none",stroke:"rgba(139, 92, 246, 0.8)",strokeWidth:"1",initial:{r:5,opacity:1},animate:{r:60,opacity:0},transition:{repeat:1/0,duration:1.5,ease:"easeOut"}}));vme.displayName="ScanEffect";const rBe=V.memo(({nodes:t,edges:e,onNodeTap:r,onScan:a,isScanning:l=!1,className:u=""})=>{const[p,m]=V.useState({x:0,y:0}),[v,w]=V.useState(!1),[R,C]=V.useState(!1),A=V.useRef(null),O=V.useRef({x:0,y:0}),U=V.useRef(null),F=V.useMemo(()=>{const X=new Map;return t.forEach(ne=>X.set(ne.id,ne)),X},[t]),q=V.useCallback(X=>{w(!0),O.current={x:X.clientX-p.x,y:X.clientY-p.y},U.current=setTimeout(async()=>{"vibrate"in navigator&&navigator.vibrate([20,10,30]),C(!0);try{await a()}finally{C(!1)}},600)},[p,a]),W=V.useCallback(X=>{if(!v)return;U.current&&(clearTimeout(U.current),U.current=null);const ne=X.clientX-O.current.x,te=X.clientY-O.current.y,he=100;m({x:Math.max(-he,Math.min(he,ne)),y:Math.max(-he,Math.min(he,te))})},[v]),H=V.useCallback(()=>{w(!1),U.current&&(clearTimeout(U.current),U.current=null)},[]);return V.useEffect(()=>()=>{U.current&&clearTimeout(U.current)},[]),c.jsxs(Ne.div,{ref:A,className:`relative w-full h-full overflow-hidden ${u}`,style:{touchAction:"none",cursor:v?"grabbing":"grab"},onPointerDown:q,onPointerMove:W,onPointerUp:H,onPointerLeave:H,children:[c.jsx("div",{className:"absolute inset-0",style:{background:"radial-gradient(ellipse at center, rgba(30, 20, 50, 0.8) 0%, transparent 70%)"}}),c.jsxs(Ne.svg,{className:"absolute inset-0 w-full h-full",viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid meet",style:{x:p.x*.3,y:p.y*.3},children:[c.jsxs("defs",{children:[Object.entries(gme).map(([X,ne])=>c.jsxs("radialGradient",{id:`gradient-${X}`,cx:"30%",cy:"30%",r:"70%",children:[c.jsx("stop",{offset:"0%",stopColor:ne.secondary}),c.jsx("stop",{offset:"100%",stopColor:ne.primary})]},X)),c.jsxs("filter",{id:"glow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[c.jsx("feGaussianBlur",{stdDeviation:"2",result:"blur"}),c.jsxs("feMerge",{children:[c.jsx("feMergeNode",{in:"blur"}),c.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),c.jsx("g",{filter:"url(#glow)",children:e.map((X,ne)=>{const te=F.get(X.from),he=F.get(X.to);return!te||!he?null:c.jsx(yme,{from:te,to:he,strength:X.strength},`edge-${ne}`)})}),c.jsx(Ur,{children:(R||l)&&c.jsx(vme,{})}),c.jsx("g",{filter:"url(#glow)",children:c.jsx(Ur,{children:t.map(X=>c.jsx(_me,{node:X,onTap:r,isScanning:R||l},X.id))})})]}),c.jsx(Ur,{children:(R||l)&&c.jsx(Ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:c.jsx("div",{className:"bg-purple-600/20 backdrop-blur-sm px-6 py-3 rounded-full border border-purple-500/30",children:c.jsx("p",{className:"text-sm font-semibold text-purple-300",children:"Scanne nach neuen Vibes..."})})})}),c.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 pointer-events-none",children:c.jsx("p",{className:"text-[10px] text-white/20 font-medium tracking-wider uppercase",children:"Gedrckt halten zum Scannen"})})]})});rBe.displayName="AuraNetwork";const iBe=V.memo(({node:t,onClose:e,onJoinRoom:r,onViewProfile:a,onExplore:l})=>{if(!t)return null;const u=()=>{switch(t.type){case"activeCloud":return c.jsx(Xo,{size:20,className:"text-purple-400"});case"friendOnline":return c.jsx(md,{size:20,className:"text-emerald-400"});case"newHotspot":return c.jsx(kn,{size:20,className:"text-amber-400"});case"regionalBonus":return c.jsx(no,{size:20,className:"text-pink-400"})}},p=()=>{switch(t.type){case"activeCloud":return"Aktives Wlkchen";case"friendOnline":return"Freund online";case"newHotspot":return"Neuer Hotspot";case"regionalBonus":return"Regional Bonus"}},m=()=>{switch(t.type){case"activeCloud":return"from-purple-500/20 to-purple-600/20 border-purple-500/30";case"friendOnline":return"from-emerald-500/20 to-emerald-600/20 border-emerald-500/30";case"newHotspot":return"from-amber-500/20 to-amber-600/20 border-amber-500/30";case"regionalBonus":return"from-pink-500/20 to-pink-600/20 border-pink-500/30"}},v=()=>{switch(t.type){case"activeCloud":t.roomId&&r(t.roomId);break;case"friendOnline":t.userId&&a(t.userId);break;case"newHotspot":case"regionalBonus":l();break}};return c.jsx(Ur,{children:c.jsx(Ne.div,{initial:{y:50,opacity:0},animate:{y:0,opacity:1},exit:{y:50,opacity:0},transition:{type:"spring",damping:25,stiffness:300},className:"absolute bottom-24 left-4 right-4 z-50",children:c.jsxs("div",{className:`bg-gradient-to-br ${m()} backdrop-blur-xl rounded-3xl p-5 border shadow-2xl`,style:{boxShadow:"0 10px 40px rgba(0, 0, 0, 0.4)"},children:[c.jsx(Ne.button,{whileTap:{scale:.9},onClick:e,className:"absolute top-3 right-3 w-8 h-8 rounded-full bg-white/10 flex items-center justify-center",children:c.jsx(Di,{size:16,className:"text-white/60"})}),c.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[c.jsx("div",{className:"w-14 h-14 rounded-2xl bg-white/10 flex items-center justify-center overflow-hidden",children:t.avatarUrl?c.jsx("img",{src:t.avatarUrl,alt:"",className:"w-full h-full object-cover"}):u()}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-white/40 mb-1",children:p()}),c.jsx("h3",{className:"font-bold text-white text-lg truncate",children:t.name}),c.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[t.count>0&&c.jsxs("div",{className:"flex items-center gap-1 text-white/60 text-xs",children:[c.jsx(cr,{size:12}),c.jsxs("span",{children:[t.count," aktiv"]})]}),t.xpMultiplier&&t.xpMultiplier>1&&c.jsxs("div",{className:"flex items-center gap-1 text-amber-400 text-xs",children:[c.jsx(Vs,{size:12}),c.jsxs("span",{children:[t.xpMultiplier,"x XP"]})]})]})]})]}),c.jsxs("div",{className:"flex gap-3",children:[t.type==="friendOnline"&&c.jsxs(Ne.button,{whileTap:{scale:.95},onClick:()=>t.userId&&a(t.userId),className:"flex-1 py-3 rounded-xl bg-white/10 text-white font-semibold text-sm flex items-center justify-center gap-2",children:[c.jsx(hp,{size:16}),"Nachricht"]}),c.jsxs(Ne.button,{whileTap:{scale:.95},onClick:v,className:"flex-1 py-3 rounded-xl bg-white/20 text-white font-bold text-sm flex items-center justify-center gap-2",style:{background:t.type==="activeCloud"?"linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)":t.type==="friendOnline"?"linear-gradient(135deg, #10b981 0%, #059669 100%)":"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)"},children:[t.type==="activeCloud"&&c.jsxs(c.Fragment,{children:[c.jsx(op,{size:16}),"Beitreten"]}),t.type==="friendOnline"&&c.jsxs(c.Fragment,{children:[c.jsx(md,{size:16}),"Profil"]}),(t.type==="newHotspot"||t.type==="regionalBonus")&&c.jsxs(c.Fragment,{children:[c.jsx(_pe,{size:16}),"Erkunden"]})]})]}),c.jsx("p",{className:"text-center text-[10px] text-white/30 mt-3",children:"Tippe auerhalb zum Schlieen"})]})})})});iBe.displayName="AuraQuickPreview";const sBe={niedrig:{color:"from-gray-500 to-gray-600",textColor:"text-gray-400",pulseColor:"bg-gray-500",icon:""},mittel:{color:"from-blue-500 to-indigo-600",textColor:"text-blue-400",pulseColor:"bg-blue-500",icon:""},hoch:{color:"from-violet-500 to-purple-600",textColor:"text-violet-400",pulseColor:"bg-violet-500",icon:""},extrem:{color:"from-amber-500 to-orange-600",textColor:"text-amber-400",pulseColor:"bg-amber-500",icon:""}};V.memo(function({currentLocation:e="Standort ermitteln...",vibeLevel:r="mittel",nearestHotspot:a,isLoading:l=!1}){const[u,p]=V.useState(0),m=sBe[r];V.useEffect(()=>{if(!a)return;const w=setInterval(()=>{p(R=>(R+1)%3)},4e3);return()=>clearInterval(w)},[a]);const v=w=>w<1e3?`${Math.round(w)}m`:`${(w/1e3).toFixed(1)}km`;return c.jsxs(Ne.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"relative",children:[c.jsxs("div",{className:"relative flex items-center gap-2 px-3 py-2 rounded-2xl overflow-hidden",style:{background:"rgba(255, 255, 255, 0.03)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",border:"1px solid rgba(255, 255, 255, 0.08)"},children:[c.jsx("div",{className:`absolute inset-0 opacity-20 bg-gradient-to-r ${m.color}`,style:{animation:"shimmer 3s ease-in-out infinite"}}),c.jsxs("div",{className:"relative flex-shrink-0",children:[c.jsx(no,{size:16,className:"text-violet-400"}),c.jsx(Ne.div,{className:`absolute -top-0.5 -right-0.5 w-2 h-2 rounded-full ${m.pulseColor}`,animate:{scale:[1,1.5,1],opacity:[1,.5,1]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}})]}),c.jsx("div",{className:"flex items-center gap-2 min-w-0",children:c.jsx(Ur,{mode:"wait",children:l?c.jsx(Ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex items-center gap-2",children:c.jsx("div",{className:"w-20 h-3 rounded bg-white/10 animate-pulse"})},"loading"):u===0?c.jsx(Ne.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},className:"flex items-center gap-1.5",children:c.jsx("span",{className:"text-xs text-white/90 font-medium truncate max-w-[120px]",children:e})},"location"):u===1?c.jsxs(Ne.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},className:"flex items-center gap-1.5",children:[c.jsx(Vs,{size:12,className:m.textColor}),c.jsxs("span",{className:`text-xs font-medium ${m.textColor}`,children:["Vibe: ",r.charAt(0).toUpperCase()+r.slice(1)]}),c.jsx("span",{className:"text-sm",children:m.icon})]},"vibe"):c.jsxs(Ne.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},className:"flex items-center gap-1.5",children:[c.jsx(_I,{size:12,className:"text-emerald-400"}),c.jsx("span",{className:"text-xs text-white/90 font-medium truncate max-w-[100px]",children:(a==null?void 0:a.name)||"Kein Hotspot"}),c.jsx("span",{className:"text-xs text-emerald-400 font-bold",children:a?v(a.distance):""})]},"hotspot")})}),c.jsx("div",{className:"flex-shrink-0 ml-1",children:c.jsx(Ne.div,{animate:{opacity:[.5,1,.5]},transition:{duration:1.5,repeat:1/0},children:c.jsx(Y5e,{size:12,className:"text-emerald-500"})})})]}),c.jsx("div",{className:`absolute inset-0 -z-10 blur-xl opacity-30 bg-gradient-to-r ${m.color}`,style:{transform:"scale(0.8)"}})]})});let fB=null;const n9=()=>(fB||(fB=new(window.AudioContext||window.webkitAudioContext)),fB),f_={tap:{frequency:1800,duration:.03,volume:.08,type:"sine"},click:{frequency:2200,duration:.02,volume:.06,type:"sine"},pop:{frequency:800,duration:.05,volume:.1,type:"sine"},success:{frequencies:[880,1320],duration:.1,volume:.08},error:{frequency:200,duration:.15,volume:.05,type:"triangle"},swoosh:{startFreq:400,endFreq:800,duration:.08,volume:.04},notification:{frequencies:[1046,1318,1568],duration:.08,volume:.1},scrollTick:{frequency:3e3,duration:.008,volume:.02,type:"sine"}},fb=(t,e,r,a="sine")=>{try{const l=n9(),u=l.createOscillator(),p=l.createGain();u.connect(p),p.connect(l.destination),u.type=a,u.frequency.setValueAtTime(t,l.currentTime),p.gain.setValueAtTime(0,l.currentTime),p.gain.linearRampToValueAtTime(r,l.currentTime+.005),p.gain.linearRampToValueAtTime(0,l.currentTime+e),u.start(l.currentTime),u.stop(l.currentTime+e+.01)}catch{console.debug("Audio feedback unavailable")}},aBe=(t,e,r,a)=>{try{const l=n9(),u=l.createOscillator(),p=l.createGain();u.connect(p),p.connect(l.destination),u.type="sine",u.frequency.setValueAtTime(t,l.currentTime),u.frequency.exponentialRampToValueAtTime(e,l.currentTime+r),p.gain.setValueAtTime(0,l.currentTime),p.gain.linearRampToValueAtTime(a,l.currentTime+.01),p.gain.linearRampToValueAtTime(0,l.currentTime+r),u.start(l.currentTime),u.stop(l.currentTime+r+.01)}catch{console.debug("Audio feedback unavailable")}},Bse=(t,e,r,a=.03)=>{t.forEach((l,u)=>{setTimeout(()=>{fb(l,e,r/t.length)},u*a*1e3)})};let Jh=!0,Em=1;const Ki={setEnabled:t=>{Jh=t},setVolume:t=>{Em=Math.max(0,Math.min(1,t))},init:()=>{try{const t=n9();t.state==="suspended"&&t.resume()}catch{console.debug("Audio context initialization failed")}},tap:()=>{if(!Jh)return;const t=f_.tap;fb(t.frequency,t.duration,t.volume*Em,t.type)},click:()=>{if(!Jh)return;const t=f_.click;fb(t.frequency,t.duration,t.volume*Em,t.type)},pop:()=>{if(!Jh)return;const t=f_.pop;fb(t.frequency,t.duration,t.volume*Em,t.type)},success:()=>{if(!Jh)return;const t=f_.success;Bse(t.frequencies,t.duration,t.volume*Em)},error:()=>{if(!Jh)return;const t=f_.error;fb(t.frequency,t.duration,t.volume*Em,t.type)},swoosh:()=>{if(!Jh)return;const t=f_.swoosh;aBe(t.startFreq,t.endFreq,t.duration,t.volume*Em)},notification:()=>{if(!Jh)return;const t=f_.notification;Bse(t.frequencies,t.duration,t.volume*Em,.05)},scrollTick:()=>{if(!Jh)return;const t=f_.scrollTick;fb(t.frequency,t.duration,t.volume*Em,t.type)},haptic:(t="light")=>{if(Jh&&"vibrate"in navigator){const e={light:10,medium:20,heavy:30};navigator.vibrate(e[t])}},feedback:(t="tap")=>{if(Jh)switch(t){case"tap":Ki.tap(),Ki.haptic("light");break;case"click":Ki.click(),Ki.haptic("light");break;case"success":Ki.success(),Ki.haptic("medium");break;case"error":Ki.error(),Ki.haptic("heavy");break}}},oBe=t=>{switch(t){case 1:return{icon:as,color:"from-amber-400 to-yellow-500",text:"#1"};case 2:return{icon:Ji,color:"from-gray-300 to-gray-400",text:"#2"};case 3:return{icon:Ji,color:"from-amber-600 to-orange-700",text:"#3"};default:return{icon:kn,color:"from-violet-500 to-purple-600",text:`#${t}`}}},cBe=V.memo(function({star:e,onClick:r}){const a=oBe(e.rank);a.icon;const l=()=>{Ki.click(),r()};return c.jsx(Ne.button,{onClick:l,whileTap:{scale:.95},className:"flex-shrink-0 relative group",style:{width:"85px"},children:c.jsxs("div",{className:"relative rounded-xl p-2 overflow-hidden",style:{background:"rgba(255, 255, 255, 0.03)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",border:"1px solid rgba(255, 255, 255, 0.08)"},children:[e.rank===1&&c.jsx(Ne.div,{className:"absolute -top-1 left-1/2 -translate-x-1/2 z-10",animate:{y:[0,-2,0],rotate:[-5,5,-5]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:c.jsx(as,{size:16,className:"text-amber-400 fill-amber-400"})}),c.jsxs("div",{className:"relative mx-auto mb-1.5",children:[c.jsx("div",{className:`absolute inset-0 rounded-full bg-gradient-to-r ${a.color} blur-md opacity-40`,style:{transform:"scale(1.1)"}}),c.jsx("div",{className:`relative w-11 h-11 rounded-full bg-gradient-to-r ${a.color} p-0.5`,children:c.jsx("div",{className:"w-full h-full rounded-full bg-[#0a0a0a] flex items-center justify-center overflow-hidden",children:e.avatarUrl?c.jsx("img",{src:e.avatarUrl,alt:e.displayName,className:"w-full h-full object-cover"}):c.jsx("span",{className:"text-sm font-bold text-white/60",children:e.displayName.charAt(0).toUpperCase()})})}),c.jsx("div",{className:`absolute -bottom-0.5 -right-0.5 w-5 h-5 rounded-full bg-gradient-to-r ${a.color} flex items-center justify-center`,style:{boxShadow:"0 2px 6px rgba(0,0,0,0.3)"},children:c.jsx("span",{className:"text-[8px] font-bold text-white",children:a.text})})]}),c.jsx("p",{className:"text-[10px] text-white/90 font-medium text-center truncate mb-0.5",children:e.displayName}),c.jsxs("div",{className:"flex items-center justify-center gap-0.5",children:[c.jsx(fd,{size:8,className:"text-emerald-400"}),c.jsxs("span",{className:"text-[9px] font-bold text-emerald-400",children:["+",e.auraChange,"%"]})]}),c.jsx(Ne.div,{className:`absolute inset-0 bg-gradient-to-r ${a.color} opacity-0 group-hover:opacity-10 transition-opacity duration-300 rounded-2xl`})]})})}),lBe=V.memo(function(){return c.jsx("div",{className:"flex gap-2 overflow-hidden px-4",children:[1,2,3,4,5].map(e=>c.jsxs("div",{className:"flex-shrink-0 w-[85px] rounded-xl p-2",style:{background:"rgba(255, 255, 255, 0.03)"},children:[c.jsx("div",{className:"w-11 h-11 rounded-full bg-white/5 animate-pulse mx-auto mb-1.5"}),c.jsx("div",{className:"w-12 h-2 rounded bg-white/5 animate-pulse mx-auto mb-1"}),c.jsx("div",{className:"w-10 h-2 rounded bg-white/5 animate-pulse mx-auto"})]},e))})});V.memo(function({stars:e,isLoading:r=!1,onCreatorClick:a}){const l=yr(),u=V.useRef(null),p=m=>{a?a(m):l(`/user/${m}`)};return c.jsxs("div",{className:"relative",children:[c.jsxs("div",{className:"flex items-center justify-between px-4 mb-3",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-violet-500 to-purple-600 flex items-center justify-center",children:c.jsx(fd,{size:16,className:"text-white"})}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-sm font-bold text-white",children:"Rising Stars"}),c.jsx("p",{className:"text-[10px] text-white/40",children:"Letzte 60 Minuten"})]})]}),c.jsx(Ne.button,{whileTap:{scale:.95},className:"text-xs text-violet-400 font-medium",children:"Alle anzeigen"})]}),r?c.jsx(lBe,{}):e.length===0?c.jsx("div",{className:"px-4",children:c.jsxs("div",{className:"rounded-2xl p-6 text-center",style:{background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 255, 255, 0.05)"},children:[c.jsx(kn,{size:24,className:"text-white/20 mx-auto mb-2"}),c.jsx("p",{className:"text-xs text-white/40",children:"Noch keine Rising Stars in dieser Stunde"})]})}):c.jsx("div",{ref:u,className:"flex gap-2 overflow-x-auto px-4 pb-2 scrollbar-hide",style:{scrollSnapType:"x mandatory",WebkitOverflowScrolling:"touch"},children:e.map(m=>c.jsx("div",{style:{scrollSnapAlign:"start"},children:c.jsx(cBe,{star:m,onClick:()=>p(m.id)})},m.id))}),c.jsx("div",{className:"absolute top-12 left-0 w-8 h-32 pointer-events-none",style:{background:"linear-gradient(to right, #050505, transparent)"}}),c.jsx("div",{className:"absolute top-12 right-0 w-8 h-32 pointer-events-none",style:{background:"linear-gradient(to left, #050505, transparent)"}})]})});const dBe={ruhig:{color:"bg-gray-500",textColor:"text-gray-400",pulseSpeed:3,label:"Ruhig"},aktiv:{color:"bg-blue-500",textColor:"text-blue-400",pulseSpeed:2,label:"Aktiv"},sehr_aktiv:{color:"bg-violet-500",textColor:"text-violet-400",pulseSpeed:1.5,label:"Sehr Aktiv"},hot:{color:"bg-amber-500",textColor:"text-amber-400",pulseSpeed:1,label:" Hot"}},uBe=t=>t<1e3?`${Math.round(t)}m`:`${(t/1e3).toFixed(1)}km`,hBe=V.memo(function({hotspot:e,index:r,onClick:a}){const l=dBe[e.activityLevel],u=()=>{Ki.tap(),a()};return c.jsx(Ne.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:r*.1},whileTap:{scale:.98},onClick:u,className:"w-full group",children:c.jsxs("div",{className:"relative flex items-center gap-3 p-3 rounded-2xl overflow-hidden transition-all duration-300",style:{background:"rgba(255, 255, 255, 0.03)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",border:"1px solid rgba(255, 255, 255, 0.05)"},children:[c.jsxs("div",{className:"relative flex-shrink-0",children:[c.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:[1,2,3].map(p=>c.jsx(Ne.div,{className:`absolute w-10 h-10 rounded-full ${l.color} opacity-20`,animate:{scale:[1,1.5+p*.3],opacity:[.3,0]},transition:{duration:l.pulseSpeed,repeat:1/0,delay:p*.3,ease:"easeOut"}},p))}),c.jsx("div",{className:`relative w-10 h-10 rounded-full ${l.color} flex items-center justify-center`,style:{boxShadow:`0 0 20px ${l.color==="bg-amber-500"?"rgba(245, 158, 11, 0.4)":"rgba(139, 92, 246, 0.3)"}`},children:e.activityLevel==="hot"?c.jsx(BL,{size:18,className:"text-white"}):c.jsx(Yd,{size:18,className:"text-white"})}),e.isNew&&c.jsx(Ne.div,{className:"absolute -top-1 -right-1 w-4 h-4 rounded-full bg-emerald-500 flex items-center justify-center",animate:{scale:[1,1.2,1]},transition:{duration:1,repeat:1/0},children:c.jsx("span",{className:"text-[8px] font-bold text-white",children:"N"})})]}),c.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("h4",{className:"text-sm font-semibold text-white truncate",children:e.name}),e.isFriendInside&&c.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded-full bg-emerald-500/20 text-emerald-400",children:"Freund drin"})]}),c.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(no,{size:10,className:"text-white/40"}),c.jsx("span",{className:"text-xs text-white/40",children:uBe(e.distance)})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(cr,{size:10,className:"text-white/40"}),c.jsxs("span",{className:"text-xs text-white/40",children:[e.userCount,e.maxUsers&&`/${e.maxUsers}`]})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(Vs,{size:10,className:l.textColor}),c.jsx("span",{className:`text-xs font-medium ${l.textColor}`,children:l.label})]})]})]}),c.jsx(Fi,{size:18,className:"text-white/20 group-hover:text-white/40 transition-colors flex-shrink-0"}),c.jsx(Ne.div,{className:"absolute inset-0 bg-white/0 group-hover:bg-white/5 transition-colors duration-300 rounded-2xl"})]})})}),pBe=V.memo(function(){return c.jsx("div",{className:"space-y-2 px-4",children:[1,2,3].map(e=>c.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-2xl",style:{background:"rgba(255, 255, 255, 0.03)"},children:[c.jsx("div",{className:"w-10 h-10 rounded-full bg-white/5 animate-pulse"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("div",{className:"w-24 h-3 rounded bg-white/5 animate-pulse mb-2"}),c.jsx("div",{className:"w-32 h-2 rounded bg-white/5 animate-pulse"})]})]},e))})});V.memo(function({hotspots:e,isLoading:r=!1,maxItems:a=5,onHotspotClick:l}){const u=yr(),p=v=>{l?l(v):u(`/room/${v}`)},m=e.slice(0,a);return c.jsxs("div",{className:"relative",children:[c.jsxs("div",{className:"flex items-center justify-between px-4 mb-3",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-emerald-500 to-teal-600 flex items-center justify-center",children:c.jsx(Yd,{size:16,className:"text-white"})}),c.jsx(Ne.div,{className:"absolute -top-0.5 -right-0.5 w-2.5 h-2.5 rounded-full bg-red-500",animate:{scale:[1,1.3,1],opacity:[1,.7,1]},transition:{duration:1,repeat:1/0}})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-sm font-bold text-white",children:"Hotspot-Radar"}),c.jsx("p",{className:"text-[10px] text-white/40",children:"Live in deiner Nhe"})]})]}),c.jsx(Ne.button,{whileTap:{scale:.95},className:"text-xs text-emerald-400 font-medium",onClick:()=>u("/discover"),children:"Karte ffnen"})]}),r?c.jsx(pBe,{}):m.length===0?c.jsx("div",{className:"px-4",children:c.jsxs(Ne.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"rounded-2xl p-6 text-center relative overflow-hidden",style:{background:"linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, rgba(5, 5, 5, 0.9) 100%)",border:"1px solid rgba(16, 185, 129, 0.15)"},children:[c.jsx(Ne.div,{className:"absolute inset-0 rounded-2xl",style:{background:"radial-gradient(circle at center, rgba(16, 185, 129, 0.1) 0%, transparent 70%)"},animate:{scale:[1,1.1,1],opacity:[.3,.5,.3]},transition:{duration:3,repeat:1/0,ease:"easeInOut"}}),c.jsxs("div",{className:"relative",children:[c.jsx(Ne.div,{className:"w-14 h-14 rounded-full bg-gradient-to-r from-emerald-500/20 to-teal-500/20 flex items-center justify-center mx-auto mb-3",animate:{scale:[1,1.05,1]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:c.jsx(Yd,{size:24,className:"text-emerald-400"})}),c.jsx("h4",{className:"text-sm font-bold text-white mb-1",children:"Niemand in Reichweite"}),c.jsx("p",{className:"text-xs text-white/40",children:"Gerade sind keine Wlkchen aktiv in deiner Nhe."}),c.jsx("p",{className:"text-[10px] text-emerald-400/60 mt-2",children:"Probier es spter nochmal oder erweitere deinen Radius"})]})]})}):c.jsx(Ur,{mode:"popLayout",children:c.jsx("div",{className:"space-y-2 px-4",children:m.map((v,w)=>c.jsx(hBe,{hotspot:v,index:w,onClick:()=>p(v.id)},v.id))})}),e.length>a&&c.jsx(Ne.button,{whileTap:{scale:.98},onClick:()=>u("/discover"),className:"w-full mt-3 px-4",children:c.jsxs("div",{className:"py-2 rounded-xl text-center text-xs text-white/40 hover:text-white/60 transition-colors",style:{background:"rgba(255, 255, 255, 0.02)",border:"1px dashed rgba(255, 255, 255, 0.1)"},children:["+",e.length-a," weitere Hotspots anzeigen"]})})]})});const Eme={hotspot:{icon:Vs,gradient:"from-violet-500 to-purple-600",bgColor:"rgba(139, 92, 246, 0.1)",borderColor:"rgba(139, 92, 246, 0.2)"},friend_nearby:{icon:cr,gradient:"from-emerald-500 to-teal-600",bgColor:"rgba(16, 185, 129, 0.1)",borderColor:"rgba(16, 185, 129, 0.2)"},trending_area:{icon:kn,gradient:"from-amber-500 to-orange-600",bgColor:"rgba(245, 158, 11, 0.1)",borderColor:"rgba(245, 158, 11, 0.2)"},new_discovery:{icon:$m,gradient:"from-blue-500 to-indigo-600",bgColor:"rgba(59, 130, 246, 0.1)",borderColor:"rgba(59, 130, 246, 0.2)"}},xme=t=>t<1e3?`${Math.round(t)}m entfernt`:`${(t/1e3).toFixed(1)}km entfernt`,fBe=V.memo(function({suggestion:e,onAction:r,onDismiss:a}){const l=Eme[e.type],u=l.icon;return c.jsxs(Ne.div,{layout:!0,initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.95},className:"relative overflow-hidden rounded-2xl",style:{background:l.bgColor,border:`1px solid ${l.borderColor}`},children:[c.jsx(Ne.div,{className:`absolute inset-0 bg-gradient-to-r ${l.gradient} opacity-5`,animate:{x:["-100%","100%"]},transition:{duration:3,repeat:1/0,ease:"linear"}}),c.jsxs("div",{className:"relative p-4",children:[c.jsxs("div",{className:"flex items-start justify-between mb-3",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:`absolute inset-0 rounded-full bg-gradient-to-r ${l.gradient} blur-md opacity-50`}),c.jsx("div",{className:`relative w-10 h-10 rounded-full bg-gradient-to-r ${l.gradient} flex items-center justify-center`,children:c.jsx(u,{size:18,className:"text-white"})})]}),c.jsxs("div",{children:[c.jsx("h4",{className:"text-sm font-bold text-white",children:e.title}),c.jsx("p",{className:"text-xs text-white/60",children:e.subtitle})]})]}),c.jsx(Ne.button,{whileTap:{scale:.9},onClick:a,className:"w-6 h-6 rounded-full bg-white/10 flex items-center justify-center",children:c.jsx(Di,{size:12,className:"text-white/40"})})]}),c.jsxs("div",{className:"flex items-center gap-4 mb-3 text-xs text-white/50",children:[c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(no,{size:10}),c.jsx("span",{children:e.location})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(_I,{size:10}),c.jsx("span",{children:xme(e.distance)})]}),e.userCount!==void 0&&c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(cr,{size:10}),c.jsxs("span",{children:[e.userCount," aktiv"]})]})]}),c.jsxs("div",{className:"mb-4",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{className:"text-[10px] text-white/40",children:"Aktivitts-Level"}),c.jsxs("span",{className:"text-[10px] font-bold text-white/60",children:[e.activityScore,"%"]})]}),c.jsx("div",{className:"h-1.5 rounded-full bg-white/10 overflow-hidden",children:c.jsx(Ne.div,{className:`h-full rounded-full bg-gradient-to-r ${l.gradient}`,initial:{width:0},animate:{width:`${e.activityScore}%`},transition:{duration:1,ease:"easeOut"}})})]}),c.jsxs(Ne.button,{whileTap:{scale:.98},onClick:r,className:`w-full py-2.5 rounded-xl bg-gradient-to-r ${l.gradient} flex items-center justify-center gap-2`,style:{boxShadow:"0 4px 15px rgba(0,0,0,0.2)"},children:[c.jsx("span",{className:"text-sm font-semibold text-white",children:e.actionLabel}),c.jsx(_pe,{size:16,className:"text-white"})]})]})]})}),mBe=V.memo(function({suggestion:e,onAction:r}){const a=Eme[e.type],l=a.icon;return c.jsxs(Ne.button,{whileTap:{scale:.98},onClick:r,className:"flex-shrink-0 flex items-center gap-2 px-3 py-2 rounded-xl",style:{background:a.bgColor,border:`1px solid ${a.borderColor}`},children:[c.jsx("div",{className:`w-6 h-6 rounded-full bg-gradient-to-r ${a.gradient} flex items-center justify-center`,children:c.jsx(l,{size:12,className:"text-white"})}),c.jsx("span",{className:"text-xs text-white/80 font-medium max-w-[120px] truncate",children:e.title}),c.jsx("span",{className:"text-[10px] text-white/40",children:xme(e.distance).replace(" entfernt","")})]})});V.memo(function({suggestions:e,isLoading:r=!1,onSuggestionClick:a,onDismiss:l}){const u=yr(),[p,m]=V.useState(new Set),v=O=>{a?a(O):O.targetId&&(O.type==="hotspot"||O.type==="trending_area"?u(`/room/${O.targetId}`):O.type==="friend_nearby"?u(`/user/${O.targetId}`):u("/discover"))},w=O=>{m(U=>new Set(U).add(O)),l==null||l(O)},R=e.filter(O=>!p.has(O.id)),C=R[0],A=R.slice(1,4);return r?c.jsx("div",{className:"px-4",children:c.jsxs("div",{className:"rounded-2xl p-4",style:{background:"rgba(255, 255, 255, 0.03)"},children:[c.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[c.jsx("div",{className:"w-10 h-10 rounded-full bg-white/5 animate-pulse"}),c.jsxs("div",{children:[c.jsx("div",{className:"w-24 h-3 rounded bg-white/5 animate-pulse mb-1"}),c.jsx("div",{className:"w-32 h-2 rounded bg-white/5 animate-pulse"})]})]}),c.jsx("div",{className:"w-full h-8 rounded-xl bg-white/5 animate-pulse"})]})}):R.length===0?c.jsx("div",{className:"px-4",children:c.jsxs(Ne.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"rounded-2xl p-5 text-center relative overflow-hidden",style:{background:"linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(5, 5, 5, 0.9) 100%)",border:"1px solid rgba(59, 130, 246, 0.15)"},children:[c.jsx(Ne.div,{className:"absolute inset-0 rounded-2xl",style:{background:"radial-gradient(circle at center, rgba(59, 130, 246, 0.08) 0%, transparent 70%)"},animate:{scale:[1,1.1,1],opacity:[.3,.5,.3]},transition:{duration:4,repeat:1/0,ease:"easeInOut"}}),c.jsxs("div",{className:"relative",children:[c.jsx(Ne.div,{className:"w-12 h-12 rounded-full bg-gradient-to-r from-blue-500/20 to-indigo-500/20 flex items-center justify-center mx-auto mb-3",animate:{scale:[1,1.05,1]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:c.jsx($m,{size:22,className:"text-blue-400"})}),c.jsx("h4",{className:"text-sm font-bold text-white mb-1",children:"Kein Vibe gerade"}),c.jsx("p",{className:"text-xs text-white/40 max-w-[200px] mx-auto",children:"Gerade gibt es keine besonderen Aktivitten in deiner Nhe."})]})]})}):c.jsxs("div",{className:"space-y-3",children:[c.jsx("div",{className:"flex items-center justify-between px-4",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-indigo-600 flex items-center justify-center",children:c.jsx($m,{size:16,className:"text-white"})}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-sm font-bold text-white",children:"Pathfinder"}),c.jsx("p",{className:"text-[10px] text-white/40",children:"Vorschlge fr dich"})]})]})}),C&&c.jsx("div",{className:"px-4",children:c.jsx(Ur,{mode:"wait",children:c.jsx(fBe,{suggestion:C,onAction:()=>v(C),onDismiss:()=>w(C.id)},C.id)})}),A.length>0&&c.jsx("div",{className:"flex gap-2 overflow-x-auto px-4 pb-1 scrollbar-hide",children:A.map(O=>c.jsx(mBe,{suggestion:O,onAction:()=>v(O)},O.id))})]})});function gBe(t={}){const{enabled:e=!0,volume:r=1}=t,a=V.useRef(!1);V.useEffect(()=>{if(!a.current){const U=()=>{Ki.init(),a.current=!0,document.removeEventListener("touchstart",U),document.removeEventListener("click",U)};return document.addEventListener("touchstart",U,{once:!0}),document.addEventListener("click",U,{once:!0}),()=>{document.removeEventListener("touchstart",U),document.removeEventListener("click",U)}}},[]),V.useEffect(()=>{Ki.setEnabled(e),Ki.setVolume(r)},[e,r]);const l=V.useCallback(()=>{Ki.tap(),Ki.haptic("light")},[]),u=V.useCallback(()=>{Ki.click(),Ki.haptic("light")},[]),p=V.useCallback(()=>{Ki.pop(),Ki.haptic("medium")},[]),m=V.useCallback(()=>{Ki.success(),Ki.haptic("medium")},[]),v=V.useCallback(()=>{Ki.error(),Ki.haptic("heavy")},[]),w=V.useCallback(()=>{Ki.swoosh()},[]),R=V.useCallback(()=>{Ki.notification(),Ki.haptic("medium")},[]),C=V.useCallback(()=>{Ki.scrollTick()},[]),A=V.useRef(0),O=V.useCallback(U=>{const F=Date.now();F-A.current>50&&(Ki.scrollTick(),A.current=F)},[]);return{tap:l,click:u,pop:p,success:m,error:v,swoosh:w,notification:R,scrollTick:C,onScroll:O,audio:Ki}}const zse=[{id:"discover",icon:$m,label:"Entdecken",path:"/discover",gradient:"from-emerald-500 to-teal-600"},{id:"map",icon:wpe,label:"Karte",path:"/radar",gradient:"from-blue-500 to-indigo-600"},{id:"messages",icon:hp,label:"Chat",path:"/messages",gradient:"from-pink-500 to-rose-600"}],_Be=V.memo(function({item:e,isActive:r,isExpanded:a,index:l,totalItems:u,badge:p,onClick:m}){const v=e.icon,w=a?-60+l*60:0,R=a?80:0,C=Math.sin(w*Math.PI/180)*R,A=-Math.cos(w*Math.PI/180)*R;return c.jsxs(Ne.button,{onClick:m,initial:{opacity:0,scale:0},animate:{opacity:a?1:0,scale:a?1:0,x:C,y:A},transition:{type:"spring",stiffness:400,damping:25,delay:a?l*.05:0},className:"absolute",style:{pointerEvents:a?"auto":"none"},children:[r&&c.jsx(Ne.div,{className:`absolute inset-0 rounded-full bg-gradient-to-r ${e.gradient} blur-xl opacity-40`,style:{transform:"scale(1.5)"}}),c.jsxs("div",{className:`relative w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300 ${r?`bg-gradient-to-r ${e.gradient}`:"bg-white/10 hover:bg-white/15"}`,style:{boxShadow:r?"0 4px 20px rgba(0,0,0,0.3)":"0 2px 10px rgba(0,0,0,0.2)"},children:[c.jsx(v,{size:20,className:r?"text-white":"text-white/70"}),p!==void 0&&p>0&&c.jsx(Ne.div,{initial:{scale:0},animate:{scale:1},className:"absolute -top-1 -right-1 min-w-[18px] h-[18px] rounded-full bg-red-500 flex items-center justify-center px-1",children:c.jsx("span",{className:"text-[10px] font-bold text-white",children:p>99?"99+":p})})]}),c.jsx(Ur,{children:a&&c.jsx(Ne.span,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,y:5},className:"absolute -bottom-5 left-1/2 -translate-x-1/2 text-[10px] text-white/60 whitespace-nowrap",children:e.label})})]})});V.memo(function({unreadMessages:e=0,newDiscoveries:r=0,onCreateClick:a}){const l=yr(),u=dp(),[p,m]=V.useState(!1),{tap:v,pop:w,swoosh:R}=gBe(),C=F=>{if(F==="messages")return e||void 0;if(F==="discover")return r||void 0},A=F=>{v(),l(F),m(!1)},O=()=>{w(),m(!p)},U=()=>{R(),m(!1),a==null||a()};return c.jsxs("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50",children:[c.jsx(Ur,{children:p&&c.jsx(Ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/40 backdrop-blur-sm",style:{zIndex:-1},onClick:()=>m(!1)})}),c.jsxs("div",{className:"relative flex items-center justify-center",children:[zse.map((F,q)=>c.jsx(_Be,{item:F,isActive:u.pathname===F.path,isExpanded:p,index:q,totalItems:zse.length,badge:C(F.id),onClick:()=>A(F.path)},F.id)),c.jsx(Ur,{children:p&&c.jsx(c.Fragment,{children:c.jsxs(Ne.button,{initial:{opacity:0,scale:0,y:0},animate:{opacity:1,scale:1,y:-100},exit:{opacity:0,scale:0,y:0},transition:{type:"spring",stiffness:400,damping:25,delay:.15},onClick:U,className:"absolute",children:[c.jsx("div",{className:"w-14 h-14 rounded-full bg-gradient-to-r from-violet-500 to-purple-600 flex items-center justify-center",style:{boxShadow:"0 4px 20px rgba(139, 92, 246, 0.4)"},children:c.jsx(kn,{size:22,className:"text-white"})}),c.jsx("span",{className:"absolute -bottom-5 left-1/2 -translate-x-1/2 text-[10px] text-white/60 whitespace-nowrap",children:"Erstellen"})]})})}),c.jsxs(Ne.button,{onClick:O,whileTap:{scale:.95},animate:{rotate:p?45:0},className:"relative z-10",children:[c.jsx(Ne.div,{className:"absolute inset-0 rounded-full bg-violet-500",animate:{scale:[1,1.3,1],opacity:[.3,0,.3]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}),c.jsx("div",{className:"relative w-16 h-16 rounded-full bg-gradient-to-r from-violet-500 to-purple-600 flex items-center justify-center",style:{boxShadow:"0 4px 30px rgba(139, 92, 246, 0.5)"},children:c.jsx(Ne.div,{animate:{rotate:0},children:p?c.jsx(Di,{size:24,className:"text-white"}):c.jsx(Yd,{size:24,className:"text-white"})})}),!p&&e+r>0&&c.jsx(Ne.div,{initial:{scale:0},animate:{scale:1},className:"absolute -top-1 -right-1 min-w-[20px] h-[20px] rounded-full bg-red-500 flex items-center justify-center px-1",children:c.jsx("span",{className:"text-[10px] font-bold text-white",children:e+r>99?"99+":e+r})})]})]}),c.jsx(Ur,{children:!p&&c.jsx(Ne.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,y:5},className:"absolute -bottom-5 left-1/2 -translate-x-1/2",children:c.jsx("span",{className:"text-[10px] text-white/40 whitespace-nowrap",children:"Tippe zum Navigieren"})})})]})});const bme={nebula:{label:"Verified",labelDe:"Verifiziert",icon:kn,primaryColor:"#8B5CF6",secondaryColor:"#A78BFA",glowColor:"rgba(139, 92, 246, 0.6)",gradient:"from-purple-500 via-violet-500 to-purple-600"},supernova:{label:"Supernova",labelDe:"Supernova",icon:Ji,primaryColor:"#F59E0B",secondaryColor:"#FBBF24",glowColor:"rgba(245, 158, 11, 0.6)",gradient:"from-amber-400 via-yellow-500 to-orange-500"},galaxy:{label:"Galaxy",labelDe:"Galaxie",icon:Vs,primaryColor:"#EC4899",secondaryColor:"#F472B6",glowColor:"rgba(236, 72, 153, 0.6)",gradient:"from-pink-500 via-rose-500 to-fuchsia-500"},universe:{label:"Universe",labelDe:"Universum",icon:as,primaryColor:"#06B6D4",secondaryColor:"#22D3EE",glowColor:"rgba(6, 182, 212, 0.6)",gradient:"from-cyan-400 via-teal-500 to-emerald-500"},founder:{label:"Founder",labelDe:"Grnder",icon:cs,primaryColor:"#FFD700",secondaryColor:"#FFF8DC",glowColor:"rgba(255, 215, 0, 0.8)",gradient:"from-yellow-300 via-amber-400 to-yellow-500"}},yBe={sm:{badge:"w-4 h-4",icon:10,text:"text-[10px]"},md:{badge:"w-5 h-5",icon:12,text:"text-xs"},lg:{badge:"w-6 h-6",icon:14,text:"text-sm"},xl:{badge:"w-8 h-8",icon:18,text:"text-base"}},jN=({tier:t,size:e="md",showLabel:r=!1,animated:a=!0,className:l=""})=>{const u=bme[t],p=yBe[e],m=u.icon;return c.jsxs("div",{className:`inline-flex items-center gap-1.5 ${l}`,children:[c.jsxs("div",{className:"relative",children:[a&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:`absolute inset-0 ${p.badge} rounded-full opacity-60`,style:{background:`radial-gradient(circle, ${u.glowColor} 0%, transparent 70%)`,animation:"nebulaPulse 2s ease-in-out infinite"}}),c.jsx("div",{className:"absolute inset-[-2px] rounded-full",style:{background:`conic-gradient(from 0deg, ${u.primaryColor}, ${u.secondaryColor}, ${u.primaryColor})`,animation:"nebulaRotate 3s linear infinite",opacity:.4}})]}),c.jsx("div",{className:`relative ${p.badge} rounded-full flex items-center justify-center bg-gradient-to-br ${u.gradient} shadow-lg`,style:{boxShadow:a?`0 0 12px ${u.glowColor}`:"none"},children:c.jsx(m,{size:p.icon,className:"text-white drop-shadow-md",strokeWidth:2.5})}),a&&t!=="nebula"&&c.jsx("div",{className:"absolute inset-0 pointer-events-none",children:[...Array(3)].map((v,w)=>c.jsx("div",{className:"absolute w-1 h-1 bg-white rounded-full opacity-80",style:{top:`${20+w*25}%`,left:`${10+w*30}%`,animation:`sparkle ${1.5+w*.3}s ease-in-out infinite ${w*.2}s`}},w))})]}),r&&c.jsx("span",{className:`font-semibold ${p.text} bg-gradient-to-r ${u.gradient} bg-clip-text text-transparent`,children:u.label}),c.jsx("style",{children:`
        @keyframes nebulaPulse {
          0%, 100% { transform: scale(1); opacity: 0.6; }
          50% { transform: scale(1.4); opacity: 0.3; }
        }

        @keyframes nebulaRotate {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }

        @keyframes sparkle {
          0%, 100% { opacity: 0; transform: scale(0); }
          50% { opacity: 1; transform: scale(1); }
        }
      `})]})},vBe=({tier:t,children:e,intensity:r="normal",className:a=""})=>{const l=bme[t],u={subtle:{blur:"20px",opacity:.3},normal:{blur:"30px",opacity:.5},intense:{blur:"40px",opacity:.7}},{blur:p,opacity:m}=u[r];return c.jsxs("div",{className:`relative ${a}`,children:[c.jsx("div",{className:"absolute inset-[-10px] rounded-full pointer-events-none",style:{background:`radial-gradient(circle, ${l.glowColor} 0%, transparent 70%)`,filter:`blur(${p})`,opacity:m,animation:"auraBreath 3s ease-in-out infinite"}}),c.jsx("div",{className:"relative z-10",children:e}),c.jsx("style",{children:`
        @keyframes auraBreath {
          0%, 100% { transform: scale(1); opacity: ${m}; }
          50% { transform: scale(1.1); opacity: ${m*.6}; }
        }
      `})]})},EBe={influencer:{en:"Influencer",de:"Influencer",emoji:""},entrepreneur:{en:"Entrepreneur",de:"Unternehmer",emoji:""},artist:{en:"Artist",de:"Knstler",emoji:""},athlete:{en:"Athlete",de:"Sportler",emoji:""},musician:{en:"Musician",de:"Musiker",emoji:""},actor:{en:"Actor",de:"Schauspieler",emoji:""},journalist:{en:"Journalist",de:"Journalist",emoji:""},politician:{en:"Politician",de:"Politiker",emoji:""},scientist:{en:"Scientist",de:"Wissenschaftler",emoji:""},creator:{en:"Creator",de:"Creator",emoji:""},other:{en:"Public Figure",de:"Persnlichkeit",emoji:""}},wme=({category:t,size:e="md"})=>{const r=EBe[t];return c.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-gray-800/60 border border-gray-700/50 ${e==="sm"?"text-[10px]":"text-xs"}`,children:[c.jsx("span",{children:r.emoji}),c.jsx("span",{className:"text-gray-300",children:r.de})]})},Sme="MIbamchs82Ve7y0ecX2TpPyymbw1",Tme="#050505";function Y_(t="light"){if(typeof navigator<"u"&&navigator.vibrate){const e={light:10,medium:20,heavy:40};navigator.vibrate(e[t])}}const xBe={initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.5,transition:{duration:.2}}},bBe={scale:[1,1.05,1],transition:{repeat:1/0,duration:2,ease:"easeInOut"}},wBe={initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10}},Rme=V.memo(({participant:t,isVisible:e,onClose:r,onViewProfile:a,onGiveStar:l,onMute:u,canMute:p})=>e?c.jsx(Ne.div,{variants:wBe,initial:"initial",animate:"animate",exit:"exit",className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 z-50",onClick:m=>m.stopPropagation(),children:c.jsxs("div",{className:"glass-card p-2 min-w-[160px] rounded-[24px] border border-white/10 backdrop-blur-xl bg-black/60",children:[c.jsxs("button",{onClick:()=>{Y_("light"),a(),r()},className:"w-full flex items-center gap-3 px-4 py-3 rounded-[16px] hover:bg-white/10 transition-colors text-white/90",children:[c.jsx(md,{size:18,className:"text-purple-400"}),c.jsx("span",{className:"text-sm font-medium",children:"Profil ansehen"})]}),c.jsxs("button",{onClick:()=>{Y_("medium"),l(),r()},className:"w-full flex items-center gap-3 px-4 py-3 rounded-[16px] hover:bg-white/10 transition-colors text-white/90",children:[c.jsx(Ji,{size:18,className:"text-yellow-400"}),c.jsx("span",{className:"text-sm font-medium",children:"Stern schenken"})]}),p&&u&&c.jsxs("button",{onClick:()=>{Y_("light"),u(),r()},className:"w-full flex items-center gap-3 px-4 py-3 rounded-[16px] hover:bg-white/10 transition-colors text-white/90",children:[c.jsx(q5e,{size:18,className:"text-red-400"}),c.jsx("span",{className:"text-sm font-medium",children:"Stummschalten"})]})]})}):null);Rme.displayName="UserMenu";const Cme=V.memo(({participant:t,isCurrentUser:e,isFounderViewer:r,onViewProfile:a,onGiveStar:l,onMute:u})=>{const[p,m]=V.useState(!1),v=t.isFounder||t.id===Sme,w=()=>{e||(Y_("light"),m(!p))};return c.jsxs(Ne.div,{layout:!0,variants:xBe,initial:"initial",animate:"animate",exit:"exit",whileTap:{scale:.98},onClick:w,className:`
        relative rounded-[40px] border flex flex-col items-center justify-center p-6
        transition-all duration-300 shadow-2xl cursor-pointer
        ${e?"border-purple-500/50 bg-white/5":"border-white/5 bg-[#111]"}
        ${v?"ring-2 ring-purple-500/30":""}
      `,style:{boxShadow:v?"0 0 40px rgba(168, 85, 247, 0.15), 0 25px 50px -12px rgba(0, 0, 0, 0.5)":"0 25px 50px -12px rgba(0, 0, 0, 0.5)"},children:[v&&c.jsx("div",{className:"absolute inset-0 rounded-[40px] overflow-hidden pointer-events-none",children:c.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-600/10 via-transparent to-fuchsia-600/10 animate-nebula-gradient"})}),c.jsxs("div",{className:"relative group",children:[c.jsxs(Ne.div,{animate:t.isSpeaking?bBe:{},className:"relative",children:[t.avatarUrl?c.jsx("img",{src:t.avatarUrl,alt:t.displayName,className:`
                w-24 h-24 md:w-32 md:h-32 rounded-full object-cover shadow-2xl
                ${t.isSpeaking?"ring-4 ring-purple-500 ring-offset-2 ring-offset-[#111]":"ring-2 ring-white/10"}
              `}):c.jsx("div",{className:`
                w-24 h-24 md:w-32 md:h-32 rounded-full bg-gradient-to-br from-purple-600 to-fuchsia-600
                flex items-center justify-center shadow-2xl
                ${t.isSpeaking?"ring-4 ring-purple-500 ring-offset-2 ring-offset-[#111]":"ring-2 ring-white/10"}
              `,children:c.jsx("span",{className:"text-3xl font-bold text-white",children:t.displayName.charAt(0).toUpperCase()})}),t.isMuted&&c.jsx("div",{className:"absolute -bottom-1 -right-1 bg-red-500/90 rounded-full p-1.5 backdrop-blur-sm",children:c.jsx(SW,{size:12,className:"text-white"})}),t.isSpeaking&&!t.isMuted&&c.jsx("div",{className:"absolute -bottom-1 -right-1 bg-green-500/90 rounded-full p-1.5 backdrop-blur-sm",children:c.jsx(WL,{size:12,className:"text-white"})})]}),v&&c.jsx(Ne.div,{initial:{scale:0},animate:{scale:1},className:"absolute -top-2 -right-2 bg-gradient-to-r from-purple-600 to-fuchsia-600 px-2.5 py-1 rounded-full shadow-lg",children:c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(as,{size:10,className:"text-white"}),c.jsx("span",{className:"text-[8px] font-black uppercase text-white",children:"Founder"})]})}),t.isHost&&!v&&c.jsx("div",{className:"absolute -top-2 -right-2 bg-amber-500/90 px-2 py-0.5 rounded-full",children:c.jsx("span",{className:"text-[8px] font-black uppercase text-white",children:"Host"})})]}),c.jsx("h3",{className:`
        mt-4 font-bold text-sm uppercase tracking-widest
        ${v?"text-purple-300":"text-white/80"}
      `,children:t.displayName}),c.jsxs("div",{className:"mt-2 flex items-center gap-1.5 opacity-60",children:[c.jsx(kn,{size:10,className:"text-purple-400"}),c.jsxs("span",{className:"text-[10px] text-white/70",children:["Level ",t.level]})]}),c.jsx(Ur,{children:p&&c.jsx(Rme,{participant:t,isVisible:p,onClose:()=>m(!1),onViewProfile:a,onGiveStar:l,onMute:u,canMute:r&&!e})}),p&&c.jsx("div",{className:"fixed inset-0 z-40",onClick:R=>{R.stopPropagation(),m(!1)}})]})});Cme.displayName="FluidUserCard";const Nme=V.memo(({roomName:t,participants:e})=>c.jsxs("div",{className:"h-20 flex items-center justify-between px-6 md:px-8 z-10 relative",children:[c.jsxs("div",{className:"flex flex-col",children:[c.jsx("span",{className:"text-[10px] font-black text-purple-500 uppercase tracking-widest",children:"Active Cloud"}),c.jsx("h2",{className:"text-white font-bold text-lg",children:t})]}),c.jsxs("div",{className:"flex -space-x-3",children:[e.slice(0,4).map(r=>c.jsx("div",{className:`
            w-8 h-8 rounded-full border-2 border-[${Tme}] overflow-hidden
            ${r.isFounder?"ring-1 ring-purple-500":""}
          `,children:r.avatarUrl?c.jsx("img",{src:r.avatarUrl,alt:"",className:"w-full h-full object-cover"}):c.jsx("div",{className:"w-full h-full bg-gradient-to-br from-purple-600 to-fuchsia-600 flex items-center justify-center",children:c.jsx("span",{className:"text-[10px] font-bold text-white",children:r.displayName.charAt(0)})})},r.id)),e.length>4&&c.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-[#050505] bg-white/10 flex items-center justify-center",children:c.jsxs("span",{className:"text-[10px] text-white/70",children:["+",e.length-4]})})]})]}));Nme.displayName="RoomHeader";const Ime=V.memo(({isMuted:t,onMuteToggle:e,onLeave:r,isExiting:a})=>{const l=()=>{Y_("light"),e()},u=()=>{Y_("heavy"),r()};return c.jsxs(Ne.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},className:`h-28 md:h-32 px-6 md:px-10 flex items-center justify-around
                 glass-nav border-t border-white/5 bg-black/40 backdrop-blur-3xl
                 mx-4 mb-4 rounded-[32px]`,children:[c.jsx(Ne.button,{whileTap:{scale:.95},onClick:l,className:`
          p-4 md:p-5 rounded-[24px] transition-all duration-300
          ${t?"bg-red-500/20 text-red-400 border border-red-500/30":"bg-white/5 text-white hover:bg-white/10 border border-white/10"}
        `,children:t?c.jsx(SW,{size:24}):c.jsx(Qo,{size:24})}),c.jsx(Ne.button,{whileTap:{scale:.95},onClick:()=>Y_("light"),className:`p-4 md:p-5 rounded-[24px] bg-white/5 text-white hover:bg-white/10
                   border border-white/10 transition-all duration-300`,children:c.jsx(Ji,{size:24,className:"text-yellow-400"})}),c.jsx(Ne.button,{whileTap:{scale:.95},onClick:u,disabled:a,className:`
          px-8 md:px-10 py-4 md:py-5 rounded-[24px] font-black tracking-tight
          transition-all duration-300 shadow-xl
          ${a?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-red-600 text-white shadow-red-900/40 hover:bg-red-500 active:scale-95"}
        `,children:a?"WIRD BEENDET...":"VERLASSEN"})]})});Ime.displayName="ControlCenter";const SBe=({roomId:t,roomName:e,participants:r,currentUserId:a,onLeave:l,onMuteToggle:u,onKickUser:p,onMuteUser:m,onSendFriendRequest:v,isMuted:w})=>{const R=yr(),[C,A]=V.useState(!1),O=a===Sme,U=V.useCallback(async()=>{if(!C){A(!0);try{await l()}catch(W){console.error("[FluidRoom] Exit error:",W)}R("/discover")}},[l,R,C]),F=V.useCallback((W,H)=>{H.offset.y>100&&H.velocity.y>0&&(Y_("medium"),U())},[U]),q=W=>W===1?"grid-cols-1":W===2?"grid-cols-1 md:grid-cols-2":"grid-cols-2";return c.jsxs(Ne.div,{drag:"y",dragConstraints:{top:0,bottom:0},dragElastic:.2,onDragEnd:F,className:"fixed inset-0 z-[100] flex flex-col overflow-hidden",style:{backgroundColor:Tme},children:[c.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-purple-600/10 blur-[120px] pointer-events-none"}),c.jsx("div",{className:"absolute bottom-[-10%] right-[-10%] w-[30%] h-[30%] bg-fuchsia-600/5 blur-[100px] pointer-events-none"}),c.jsx("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 w-12 h-1 bg-white/20 rounded-full"}),c.jsx(Nme,{roomName:e,participants:r}),c.jsx("div",{className:"flex-1 p-4 overflow-hidden",children:c.jsx(Ne.div,{layout:!0,className:`grid gap-4 h-full ${q(r.length)}`,children:c.jsx(Ur,{mode:"popLayout",children:r.map(W=>c.jsx(Cme,{participant:W,isCurrentUser:W.id===a,isFounderViewer:O,onViewProfile:()=>{R(`/user/${W.id}`)},onGiveStar:()=>{console.log("[FluidRoom] Give star to:",W.id)},onMute:m?()=>m(W.id):void 0},W.id))})})}),c.jsx(Ime,{isMuted:w,onMuteToggle:u,onLeave:U,isExiting:C})]})},r9={empty:{messages:"Keine Nachrichten. Die Stille ist ohrenbetubend.",lounges:"Keine Lounges in der Nhe. Zeit, selbst eine zu erstellen?",stats:"Noch keine Stats. Fang an zu reden, dann gibts auch was zu zeigen."}},i9=t=>t>=76?{name:"Legend",emoji:""}:t>=51?{name:"Influencer",emoji:""}:t>=31?{name:"Socialite",emoji:""}:t>=16?{name:"Connector",emoji:""}:t>=6?{name:"Dreamer",emoji:""}:{name:"Newcomer",emoji:""},Ame=t=>t>=30?2:t>=14?1.8:t>=7?1.6:t>=6?1.5:t>=5?1.4:t>=4?1.3:t>=3?1.2:t>=2?1.1:1,PO=t=>Math.floor(Math.pow(t,1.5)*100);var kme={exports:{}};(function(t,e){(function(r,a){t.exports=a()})(_f,function(){function r(n,i){return i.forEach(function(s){s&&typeof s!="string"&&!Array.isArray(s)&&Object.keys(s).forEach(function(o){if(o!=="default"&&!(o in n)){var d=Object.getOwnPropertyDescriptor(s,o);Object.defineProperty(n,o,d.get?d:{enumerable:!0,get:function(){return s[o]}})}})}),Object.freeze(n)}var a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof _f<"u"?_f:typeof self<"u"?self:{};function l(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var u=function(n){try{return!!n()}catch{return!0}},p=!u(function(){var n=(function(){}).bind();return typeof n!="function"||n.hasOwnProperty("prototype")}),m=p,v=Function.prototype,w=v.call,R=m&&v.bind.bind(w,w),C=m?R:function(n){return function(){return w.apply(n,arguments)}},A=C({}.isPrototypeOf),O=function(n){return n&&n.Math===Math&&n},U=O(typeof globalThis=="object"&&globalThis)||O(typeof window=="object"&&window)||O(typeof self=="object"&&self)||O(typeof a=="object"&&a)||O(typeof a=="object"&&a)||function(){return this}()||Function("return this")(),F=p,q=Function.prototype,W=q.apply,H=q.call,X=typeof Reflect=="object"&&Reflect.apply||(F?H.bind(W):function(){return H.apply(W,arguments)}),ne=C,te=ne({}.toString),he=ne("".slice),J=function(n){return he(te(n),8,-1)},Q=J,ce=C,de=function(n){if(Q(n)==="Function")return ce(n)},pe=typeof document=="object"&&document.all,be=pe===void 0&&pe!==void 0?function(n){return typeof n=="function"||n===pe}:function(n){return typeof n=="function"},ye={},Ze=!u(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),It=p,St=Function.prototype.call,lt=It?St.bind(St):function(){return St.apply(St,arguments)},Le={},Me={}.propertyIsEnumerable,Ke=Object.getOwnPropertyDescriptor,Rt=Ke&&!Me.call({1:2},1);Le.f=Rt?function(n){var i=Ke(this,n);return!!i&&i.enumerable}:Me;var rt,mt,yt=function(n,i){return{enumerable:!(1&n),configurable:!(2&n),writable:!(4&n),value:i}},Ct=u,Ot=J,vt=Object,zt=C("".split),ln=Ct(function(){return!vt("z").propertyIsEnumerable(0)})?function(n){return Ot(n)==="String"?zt(n,""):vt(n)}:vt,Pn=function(n){return n==null},ni=Pn,pr=TypeError,nn=function(n){if(ni(n))throw new pr("Can't call method on "+n);return n},ri=ln,un=nn,ui=function(n){return ri(un(n))},Cs=be,Jn=function(n){return typeof n=="object"?n!==null:Cs(n)},ds={},Ra=ds,us=U,ro=be,Fa=function(n){return ro(n)?n:void 0},hi=function(n,i){return arguments.length<2?Fa(Ra[n])||Fa(us[n]):Ra[n]&&Ra[n][i]||us[n]&&us[n][i]},So=U.navigator,Ri=So&&So.userAgent,Gr=Ri?String(Ri):"",Ca=U,Ac=Gr,kc=Ca.process,Pc=Ca.Deno,Ba=kc&&kc.versions||Pc&&Pc.version,Dc=Ba&&Ba.v8;Dc&&(mt=(rt=Dc.split("."))[0]>0&&rt[0]<4?1:+(rt[0]+rt[1])),!mt&&Ac&&(!(rt=Ac.match(/Edge\/(\d+)/))||rt[1]>=74)&&(rt=Ac.match(/Chrome\/(\d+)/))&&(mt=+rt[1]);var ia=mt,Lt=ia,Ir=u,We=U.String,$t=!!Object.getOwnPropertySymbols&&!Ir(function(){var n=Symbol("symbol detection");return!We(n)||!(Object(n)instanceof Symbol)||!Symbol.sham&&Lt&&Lt<41}),tr=$t&&!Symbol.sham&&typeof Symbol.iterator=="symbol",mi=hi,Wr=be,Nn=A,Ci=Object,Ar=tr?function(n){return typeof n=="symbol"}:function(n){var i=mi("Symbol");return Wr(i)&&Nn(i.prototype,Ci(n))},lr=String,Qi=function(n){try{return lr(n)}catch{return"Object"}},sh=be,ol=Qi,pp=TypeError,gi=function(n){if(sh(n))return n;throw new pp(ol(n)+" is not a function")},fp=gi,ah=Pn,ec=function(n,i){var s=n[i];return ah(s)?void 0:fp(s)},tc=lt,vn=be,Ll=Jn,og=TypeError,Of={exports:{}},nu=U,mp=Object.defineProperty,gp=U,Oc=function(n,i){try{mp(nu,n,{value:i,configurable:!0,writable:!0})}catch{nu[n]=i}return i},Lc="__core-js_shared__",Lf=Of.exports=gp[Lc]||Oc(Lc,{});(Lf.versions||(Lf.versions=[])).push({version:"3.46.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.46.0/LICENSE",source:"https://github.com/zloirock/core-js"});var _p=Of.exports,yp=_p,jl=function(n,i){return yp[n]||(yp[n]=i||{})},jf=nn,oh=Object,io=function(n){return oh(jf(n))},gd=io,cg=C({}.hasOwnProperty),Zi=Object.hasOwn||function(n,i){return cg(gd(n),i)},ch=C,Ml=0,ru=Math.random(),iu=ch(1.1.toString),lh=function(n){return"Symbol("+(n===void 0?"":n)+")_"+iu(++Ml+ru,36)},Mf=jl,_d=Zi,Vr=lh,Ni=$t,su=tr,so=U.Symbol,jc=Mf("wks"),Uf=su?so.for||so:so&&so.withoutSetter||Vr,Zt=function(n){return _d(jc,n)||(jc[n]=Ni&&_d(so,n)?so[n]:Uf("Symbol."+n)),jc[n]},Oi=lt,dh=Jn,nc=Ar,hs=ec,uh=function(n,i){var s,o;if(vn(s=n.toString)&&!Ll(o=tc(s,n))||vn(s=n.valueOf)&&!Ll(o=tc(s,n)))return o;throw new og("Can't convert object to primitive value")},cl=TypeError,Ul=Zt("toPrimitive"),qn=function(n,i){if(!dh(n)||nc(n))return n;var s,o=hs(n,Ul);if(o){if(s=Oi(o,n,i),!dh(s)||nc(s))return s;throw new cl("Can't convert object to primitive value")}return uh(n)},To=Ar,ao=function(n){var i=qn(n,"string");return To(i)?i:i+""},Na=Jn,au=U.document,yd=Na(au)&&Na(au.createElement),hh=function(n){return yd?au.createElement(n):{}},vp=hh,ou=!Ze&&!u(function(){return Object.defineProperty(vp("div"),"a",{get:function(){return 7}}).a!==7}),Ep=Ze,Vl=lt,rc=Le,Vf=yt,xp=ui,Ff=ao,Dn=Zi,Mc=ou,Ei=Object.getOwnPropertyDescriptor;ye.f=Ep?Ei:function(n,i){if(n=xp(n),i=Ff(i),Mc)try{return Ei(n,i)}catch{}if(Dn(n,i))return Vf(!Vl(rc.f,n,i),n[i])};var lg=u,Ro=be,Bf=/#|\.prototype\./,vd=function(n,i){var s=cu[Uc(n)];return s===Yn||s!==lu&&(Ro(i)?lg(i):!!i)},Uc=vd.normalize=function(n){return String(n).replace(Bf,".").toLowerCase()},cu=vd.data={},lu=vd.NATIVE="N",Yn=vd.POLYFILL="P",vr=vd,zf=gi,bp=p,es=de(de.bind),ll=function(n,i){return zf(n),i===void 0?n:bp?es(n,i):function(){return n.apply(i,arguments)}},za={},Gf=Ze&&u(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),wp=Jn,kr=String,xs=TypeError,_i=function(n){if(wp(n))return n;throw new xs(kr(n)+" is not an object")},Ns=Ze,Sp=ou,Wf=Gf,ps=_i,Tp=ao,ph=TypeError,Ed=Object.defineProperty,Hf=Object.getOwnPropertyDescriptor,dl="enumerable",Rp="configurable",Li="writable";za.f=Ns?Wf?function(n,i,s){if(ps(n),i=Tp(i),ps(s),typeof n=="function"&&i==="prototype"&&"value"in s&&Li in s&&!s[Li]){var o=Hf(n,i);o&&o[Li]&&(n[i]=s.value,s={configurable:Rp in s?s[Rp]:o[Rp],enumerable:dl in s?s[dl]:o[dl],writable:!1})}return Ed(n,i,s)}:Ed:function(n,i,s){if(ps(n),i=Tp(i),ps(s),Sp)try{return Ed(n,i,s)}catch{}if("get"in s||"set"in s)throw new ph("Accessors not supported");return"value"in s&&(n[i]=s.value),n};var fh=za,Ga=yt,Ia=Ze?function(n,i,s){return fh.f(n,i,Ga(1,s))}:function(n,i,s){return n[i]=s,n},ul=U,ic=X,xd=de,du=be,Ii=ye.f,Vc=vr,Wa=ds,dg=ll,sc=Ia,Kf=Zi,qf=function(n){var i=function(s,o,d){if(this instanceof i){switch(arguments.length){case 0:return new n;case 1:return new n(s);case 2:return new n(s,o)}return new n(s,o,d)}return ic(n,this,arguments)};return i.prototype=n.prototype,i},In=function(n,i){var s,o,d,h,f,g,y,x,b,N=n.target,I=n.global,D=n.stat,$=n.proto,z=I?ul:D?ul[N]:ul[N]&&ul[N].prototype,K=I?Wa:Wa[N]||sc(Wa,N,{})[N],ie=K.prototype;for(h in i)o=!(s=Vc(I?h:N+(D?".":"#")+h,n.forced))&&z&&Kf(z,h),g=K[h],o&&(y=n.dontCallGetSet?(b=Ii(z,h))&&b.value:z[h]),f=o&&y?y:i[h],(s||$||typeof g!=typeof f)&&(x=n.bind&&o?dg(f,ul):n.wrap&&o?qf(f):$&&du(f)?xd(f):f,(n.sham||f&&f.sham||g&&g.sham)&&sc(x,"sham",!0),sc(K,h,x),$&&(Kf(Wa,d=N+"Prototype")||sc(Wa,d,{}),sc(Wa[d],h,f),n.real&&ie&&(s||!ie[h])&&sc(ie,h,f)))},sa=Math.ceil,ac=Math.floor,bd=Math.trunc||function(n){var i=+n;return(i>0?ac:sa)(i)},Fc=bd,k=function(n){var i=+n;return i!=i||i===0?0:Fc(i)},ee=k,le=Math.max,Se=Math.min,He=function(n,i){var s=ee(n);return s<0?le(s+i,0):Se(s,i)},ct=k,Ut=Math.min,ii=function(n){var i=ct(n);return i>0?Ut(i,9007199254740991):0},Bs=ii,sr=function(n){return Bs(n.length)},fr=ui,Bi=He,Bc=sr,fs=function(n){return function(i,s,o){var d=fr(i),h=Bc(d);if(h===0)return!n&&-1;var f,g=Bi(o,h);if(n&&s!=s){for(;h>g;)if((f=d[g++])!=f)return!0}else for(;h>g;g++)if((n||g in d)&&d[g]===s)return n||g||0;return!n&&-1}},wd={includes:fs(!0),indexOf:fs(!1)},Fl=wd.includes;In({target:"Array",proto:!0,forced:u(function(){return!Array(1).includes()})},{includes:function(n){return Fl(this,n,arguments.length>1?arguments[1]:void 0)}});var iS=U,Yf=ds,Co=function(n,i){var s=Yf[n+"Prototype"],o=s&&s[i];if(o)return o;var d=iS[n],h=d&&d.prototype;return h&&h[i]},ug=Co("Array","includes"),Cp=Jn,uu=J,hg=Zt("match"),$f=function(n){var i;return Cp(n)&&((i=n[hg])!==void 0?!!i:uu(n)==="RegExp")},pg=$f,hu=TypeError,oc={};oc[Zt("toStringTag")]="z";var w0=String(oc)==="[object z]",Np=w0,sS=be,Aa=J,No=Zt("toStringTag"),S0=Object,T0=Aa(function(){return arguments}())==="Arguments",hl=Np?Aa:function(n){var i,s,o;return n===void 0?"Undefined":n===null?"Null":typeof(s=function(d,h){try{return d[h]}catch{}}(i=S0(n),No))=="string"?s:T0?Aa(i):(o=Aa(i))==="Object"&&sS(i.callee)?"Arguments":o},R0=hl,fg=String,zs=function(n){if(R0(n)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return fg(n)},Sd=Zt("match"),Ve=In,ut=function(n){if(pg(n))throw new hu("The method doesn't accept regular expressions");return n},st=nn,en=zs,Zn=function(n){var i=/./;try{"/./"[n](i)}catch{try{return i[Sd]=!1,"/./"[n](i)}catch{}}return!1},si=C("".indexOf);Ve({target:"String",proto:!0,forced:!Zn("includes")},{includes:function(n){return!!~si(en(st(this)),en(ut(n)),arguments.length>1?arguments[1]:void 0)}});var aa=Co("String","includes"),xi=A,C0=ug,Bl=aa,ka=Array.prototype,Ip=String.prototype,mg=function(n){var i=n.includes;return n===ka||xi(ka,n)&&i===ka.includes?C0:typeof n=="string"||n===Ip||xi(Ip,n)&&i===Ip.includes?Bl:i},Ge=l(mg),Xf=gi,gg=io,Hr=ln,aS=sr,pu=TypeError,Ap="Reduce of empty array with no initial value",Yv=function(n){return function(i,s,o,d){var h=gg(i),f=Hr(h),g=aS(h);if(Xf(s),g===0&&o<2)throw new pu(Ap);var y=n?g-1:0,x=n?-1:1;if(o<2)for(;;){if(y in f){d=f[y],y+=x;break}if(y+=x,n?y<0:g<=y)throw new pu(Ap)}for(;n?y>=0:g>y;y+=x)y in f&&(d=s(d,f[y],y,h));return d}},oS={left:Yv(!1)},Td=u,fu=function(n,i){var s=[][n];return!!s&&Td(function(){s.call(null,i||function(){return 1},1)})},cc=U,mu=Gr,$v=J,zl=function(n){return mu.slice(0,n.length)===n},gu=zl("Bun/")?"BUN":zl("Cloudflare-Workers")?"CLOUDFLARE":zl("Deno/")?"DENO":zl("Node.js/")?"NODE":cc.Bun&&typeof Bun.version=="string"?"BUN":cc.Deno&&typeof Deno.version=="object"?"DENO":$v(cc.process)==="process"?"NODE":cc.window&&cc.document?"BROWSER":"REST",kp=gu==="NODE",Jf=oS.left;In({target:"Array",proto:!0,forced:!kp&&ia>79&&ia<83||!fu("reduce")},{reduce:function(n){var i=arguments.length;return Jf(this,n,i,i>1?arguments[1]:void 0)}});var Xv=Co("Array","reduce"),Pp=A,_u=Xv,mh=Array.prototype,Jv=function(n){var i=n.reduce;return n===mh||Pp(mh,n)&&i===mh.reduce?_u:i},N0=Jv,lc=l(N0),Qf=J,Rd=Array.isArray||function(n){return Qf(n)==="Array"},I0=In,_=Rd,S=C([].reverse),P=[1,2];I0({target:"Array",proto:!0,forced:String(P)===String(P.reverse())},{reverse:function(){return _(this)&&(this.length=this.length),S(this)}});var G=Co("Array","reverse"),ae=A,ge=G,ke=Array.prototype,Xe=function(n){var i=n.reverse;return n===ke||ae(ke,n)&&i===ke.reverse?ge:i},nt=Xe,Tt=l(nt),Jt=lh,Tn=jl("keys"),nr=function(n){return Tn[n]||(Tn[n]=Jt(n))},Gs=!u(function(){function n(){}return n.prototype.constructor=null,Object.getPrototypeOf(new n)!==n.prototype}),bs=Zi,Ha=be,Pa=io,pl=Gs,Qv=nr("IE_PROTO"),A0=Object,cS=A0.prototype,_g=pl?A0.getPrototypeOf:function(n){var i=Pa(n);if(bs(i,Qv))return i[Qv];var s=i.constructor;return Ha(s)&&i instanceof s?s.prototype:i instanceof A0?cS:null},lS=C,Zf=gi,ts=Jn,em=function(n){return ts(n)||n===null},xe=String,Dp=TypeError,yg=function(n,i,s){try{return lS(Zf(Object.getOwnPropertyDescriptor(n,i)[s]))}catch{}},Io=Jn,Pr=nn,dS=function(n){if(em(n))return n;throw new Dp("Can't set "+xe(n)+" as a prototype")},aj=Object.setPrototypeOf||("__proto__"in{}?function(){var n,i=!1,s={};try{(n=yg(Object.prototype,"__proto__","set"))(s,[]),i=s instanceof Array}catch{}return function(o,d){return Pr(o),dS(d),Io(o)&&(i?n(o,d):o.__proto__=d),o}}():void 0),Zv={},yu={},uS=Zi,oj=ui,cj=wd.indexOf,lj=yu,RI=C([].push),vu=function(n,i){var s,o=oj(n),d=0,h=[];for(s in o)!uS(lj,s)&&uS(o,s)&&RI(h,s);for(;i.length>d;)uS(o,s=i[d++])&&(~cj(h,s)||RI(h,s));return h},hS=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],dj=vu,uj=hS.concat("length","prototype");Zv.f=Object.getOwnPropertyNames||function(n){return dj(n,uj)};var k0={};k0.f=Object.getOwnPropertySymbols;var hj=hi,gh=Zv,pj=k0,fj=_i,mj=C([].concat),gj=hj("Reflect","ownKeys")||function(n){var i=gh.f(fj(n)),s=pj.f;return s?mj(i,s(n)):i},CI=Zi,tm=gj,_j=ye,yj=za,fl={},vj=vu,Ej=hS,eE=Object.keys||function(n){return vj(n,Ej)},xj=Ze,bj=Gf,NI=za,II=_i,wj=ui,Sj=eE;fl.f=xj&&!bj?Object.defineProperties:function(n,i){II(n);for(var s,o=wj(i),d=Sj(i),h=d.length,f=0;h>f;)NI.f(n,s=d[f++],o[s]);return n};var vg,Eg=hi("document","documentElement"),tE=_i,Tj=fl,pS=hS,Rj=yu,_h=Eg,fS=hh,yh="prototype",zc="script",AI=nr("IE_PROTO"),nE=function(){},mS=function(n){return"<"+zc+">"+n+"</"+zc+">"},xg=function(n){n.write(mS("")),n.close();var i=n.parentWindow.Object;return n=null,i},Cd=function(){try{vg=new ActiveXObject("htmlfile")}catch{}var n,i,s;Cd=typeof document<"u"?document.domain&&vg?xg(vg):(i=fS("iframe"),s="java"+zc+":",i.style.display="none",_h.appendChild(i),i.src=String(s),(n=i.contentWindow.document).open(),n.write(mS("document.F=Object")),n.close(),n.F):xg(vg);for(var o=pS.length;o--;)delete Cd[yh][pS[o]];return Cd()};Rj[AI]=!0;var bg=Object.create||function(n,i){var s;return n!==null?(nE[yh]=tE(n),s=new nE,nE[yh]=null,s[AI]=n):s=Cd(),i===void 0?s:Tj.f(s,i)},Cj=Jn,rE=Ia,kI=Error,PI=C("".replace),oo=String(new kI("zxcasd").stack),iE=/\n\s*at [^:]*:[^\n]*/,DI=iE.test(oo),Eu=yt,gS=!u(function(){var n=new Error("a");return!("stack"in n)||(Object.defineProperty(n,"stack",Eu(1,7)),n.stack!==7)}),sE=Ia,nm=function(n,i){if(DI&&typeof n=="string"&&!kI.prepareStackTrace)for(;i--;)n=PI(n,iE,"");return n},OI=gS,Ao=Error.captureStackTrace,Op={},Nj=Op,Ij=Zt("iterator"),Aj=Array.prototype,aE=function(n){return n!==void 0&&(Nj.Array===n||Aj[Ij]===n)},kj=hl,wg=ec,LI=Pn,Pj=Op,Dj=Zt("iterator"),Lp=function(n){if(!LI(n))return wg(n,Dj)||wg(n,"@@iterator")||Pj[kj(n)]},Oj=lt,Lj=gi,_S=_i,jI=Qi,jj=Lp,Mj=TypeError,yS=function(n,i){var s=arguments.length<2?jj(n):i;if(Lj(s))return _S(Oj(s,n));throw new Mj(jI(n)+" is not iterable")},MI=lt,oE=_i,Uj=ec,cE=function(n,i,s){var o,d;oE(n);try{if(!(o=Uj(n,"return"))){if(i==="throw")throw s;return s}o=MI(o,n)}catch(h){d=!0,o=h}if(i==="throw")throw s;if(d)throw o;return oE(o),s},UI=ll,VI=lt,FI=_i,lE=Qi,Vj=aE,BI=sr,vS=A,Fj=yS,zI=Lp,GI=cE,ES=TypeError,P0=function(n,i){this.stopped=n,this.result=i},dE=P0.prototype,D0=function(n,i,s){var o,d,h,f,g,y,x,b=s&&s.that,N=!(!s||!s.AS_ENTRIES),I=!(!s||!s.IS_RECORD),D=!(!s||!s.IS_ITERATOR),$=!(!s||!s.INTERRUPTED),z=UI(i,b),K=function(oe){return o&&GI(o,"normal"),new P0(!0,oe)},ie=function(oe){return N?(FI(oe),$?z(oe[0],oe[1],K):z(oe[0],oe[1])):$?z(oe,K):z(oe)};if(I)o=n.iterator;else if(D)o=n;else{if(!(d=zI(n)))throw new ES(lE(n)+" is not iterable");if(Vj(d)){for(h=0,f=BI(n);f>h;h++)if((g=ie(n[h]))&&vS(dE,g))return g;return new P0(!1)}o=Fj(n,d)}for(y=I?n.next:o.next;!(x=VI(y,o)).done;){try{g=ie(x.value)}catch(oe){GI(o,"throw",oe)}if(typeof g=="object"&&g&&vS(dE,g))return g}return new P0(!1)},xS=zs,Dr=In,Bj=A,zj=_g,jp=aj,WI=function(n,i,s){for(var o=tm(i),d=yj.f,h=_j.f,f=0;f<o.length;f++){var g=o[f];CI(n,g)||s&&CI(s,g)||d(n,g,h(i,g))}},HI=bg,bS=Ia,Gc=yt,Gj=function(n,i){Cj(i)&&"cause"in i&&rE(n,"cause",i.cause)},uE=function(n,i,s,o){OI&&(Ao?Ao(n,i):sE(n,"stack",nm(s,o)))},wS=D0,KI=function(n,i){return n===void 0?arguments.length<2?"":i:xS(n)},qI=Zt("toStringTag"),ko=Error,Mp=[].push,Up=function(n,i){var s,o=Bj(hE,this);jp?s=jp(new ko,o?zj(this):hE):(s=o?this:HI(hE),bS(s,qI,"Error")),i!==void 0&&bS(s,"message",KI(i)),uE(s,Up,s.stack,1),arguments.length>2&&Gj(s,arguments[2]);var d=[];return wS(n,Mp,{that:d}),bS(s,"errors",d),s};jp?jp(Up,ko):WI(Up,ko,{name:!0});var hE=Up.prototype=HI(ko.prototype,{constructor:Gc(1,Up),message:Gc(1,""),name:Gc(1,"AggregateError")});Dr({global:!0},{AggregateError:Up});var rm,Sg,Tg,YI=be,pE=U.WeakMap,SS=YI(pE)&&/native code/.test(String(pE)),vh=U,Wj=Jn,Vp=Ia,fE=Zi,mE=_p,TS=nr,Hj=yu,$I="Object already initialized",RS=vh.TypeError,XI=vh.WeakMap;if(SS||mE.state){var Nd=mE.state||(mE.state=new XI);Nd.get=Nd.get,Nd.has=Nd.has,Nd.set=Nd.set,rm=function(n,i){if(Nd.has(n))throw new RS($I);return i.facade=n,Nd.set(n,i),i},Sg=function(n){return Nd.get(n)||{}},Tg=function(n){return Nd.has(n)}}else{var Rg=TS("state");Hj[Rg]=!0,rm=function(n,i){if(fE(n,Rg))throw new RS($I);return i.facade=n,Vp(n,Rg,i),i},Sg=function(n){return fE(n,Rg)?n[Rg]:{}},Tg=function(n){return fE(n,Rg)}}var Fp,CS,dc,Po={set:rm,get:Sg,has:Tg,enforce:function(n){return Tg(n)?Sg(n):rm(n,{})},getterFor:function(n){return function(i){var s;if(!Wj(i)||(s=Sg(i)).type!==n)throw new RS("Incompatible receiver, "+n+" required");return s}}},NS=Ze,Kj=Zi,O0=Function.prototype,Cg=NS&&Object.getOwnPropertyDescriptor,IS=Kj(O0,"name"),AS={PROPER:IS&&(function(){}).name==="something",CONFIGURABLE:IS&&(!NS||NS&&Cg(O0,"name").configurable)},qj=Ia,Eh=function(n,i,s,o){return o&&o.enumerable?n[i]=s:qj(n,i,s),n},Ng=u,L0=be,Yj=Jn,JI=bg,kS=_g,gE=Eh,_E=Zt("iterator"),j0=!1;[].keys&&("next"in(dc=[].keys())?(CS=kS(kS(dc)))!==Object.prototype&&(Fp=CS):j0=!0);var PS=!Yj(Fp)||Ng(function(){var n={};return Fp[_E].call(n)!==n});L0((Fp=PS?{}:JI(Fp))[_E])||gE(Fp,_E,function(){return this});var M0={IteratorPrototype:Fp,BUGGY_SAFARI_ITERATORS:j0},$j=hl,QI=w0?{}.toString:function(){return"[object "+$j(this)+"]"},yE=w0,ZI=za.f,DS=Ia,Xj=Zi,eA=QI,xu=Zt("toStringTag"),bu=function(n,i,s,o){var d=s?n:n&&n.prototype;d&&(Xj(d,xu)||ZI(d,xu,{configurable:!0,value:i}),o&&!yE&&DS(d,"toString",eA))},tA=M0.IteratorPrototype,Jj=bg,nA=yt,Qj=bu,Zj=Op,xh=function(){return this},U0=function(n,i,s,o){var d=i+" Iterator";return n.prototype=Jj(tA,{next:nA(+!o,s)}),Qj(n,d,!1,!0),Zj[d]=xh,n},OS=In,LS=lt,vE=AS,Ig=U0,On=_g,EE=bu,xE=Eh,Bp=Op,eM=M0,jS=vE.PROPER,V0=eM.BUGGY_SAFARI_ITERATORS,Ka=Zt("iterator"),rA="keys",bE="values",MS="entries",tM=function(){return this},US=function(n,i,s,o,d,h,f){Ig(s,i,o);var g,y,x,b=function(ie){if(ie===d&&z)return z;if(!V0&&ie&&ie in D)return D[ie];switch(ie){case rA:case bE:case MS:return function(){return new s(this,ie)}}return function(){return new s(this)}},N=i+" Iterator",I=!1,D=n.prototype,$=D[Ka]||D["@@iterator"]||d&&D[d],z=!V0&&$||b(d),K=i==="Array"&&D.entries||$;if(K&&(g=On(K.call(new n)))!==Object.prototype&&g.next&&(EE(g,N,!0,!0),Bp[N]=tM),jS&&d===bE&&$&&$.name!==bE&&(I=!0,z=function(){return LS($,this)}),d)if(y={values:b(bE),keys:h?z:b(rA),entries:b(MS)},f)for(x in y)(V0||I||!(x in D))&&xE(D,x,y[x]);else OS({target:i,proto:!0,forced:V0||I},y);return f&&D[Ka]!==z&&xE(D,Ka,z,{}),Bp[i]=z,y},wE=function(n,i){return{value:n,done:i}},nM=ui,iA=Op,wu=Po;za.f;var uc=US,Ag=wE,sA="Array Iterator",VS=wu.set,rM=wu.getterFor(sA);uc(Array,"Array",function(n,i){VS(this,{type:sA,target:nM(n),index:0,kind:i})},function(){var n=rM(this),i=n.target,s=n.index++;if(!i||s>=i.length)return n.target=null,Ag(void 0,!0);switch(n.kind){case"keys":return Ag(s,!1);case"values":return Ag(i[s],!1)}return Ag([s,i[s]],!1)},"values"),iA.Arguments=iA.Array;var iM=za,zp=function(n,i,s){return iM.f(n,i,s)},aA=hi,oA=zp,sM=Ze,cA=Zt("species"),aM=A,oM=TypeError,SE=function(n,i){if(aM(i,n))return n;throw new oM("Incorrect invocation")},lA=be,FS=_p,BS=C(Function.toString);lA(FS.inspectSource)||(FS.inspectSource=function(n){return BS(n)});var zS=FS.inspectSource,F0=C,GS=u,WS=be,dA=hl,TE=zS,HS=function(){},Id=hi("Reflect","construct"),bh=/^\s*(?:class|function)\b/,cM=F0(bh.exec),uA=!bh.test(HS),B0=function(n){if(!WS(n))return!1;try{return Id(HS,[],n),!0}catch{return!1}},hA=function(n){if(!WS(n))return!1;switch(dA(n)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return uA||!!cM(bh,TE(n))}catch{return!0}};hA.sham=!0;var z0,kg,pA,KS,RE=!Id||GS(function(){var n;return B0(B0.call)||!B0(Object)||!B0(function(){n=!0})||n})?hA:B0,lM=RE,dM=Qi,uM=TypeError,fA=_i,mA=function(n){if(lM(n))return n;throw new uM(dM(n)+" is not a constructor")},gA=Pn,_A=Zt("species"),qS=function(n,i){var s,o=fA(n).constructor;return o===void 0||gA(s=fA(o)[_A])?i:mA(s)},Gp=C([].slice),hM=TypeError,Wp=function(n,i){if(n<i)throw new hM("Not enough arguments");return n},yA=/(?:ipad|iphone|ipod).*applewebkit/i.test(Gr),ml=U,pM=X,fM=ll,vA=be,mM=Zi,gl=u,EA=Eg,gM=Gp,xA=hh,bA=Wp,_M=yA,yM=kp,YS=ml.setImmediate,$S=ml.clearImmediate,XS=ml.process,JS=ml.Dispatch,vM=ml.Function,wA=ml.MessageChannel,EM=ml.String,QS=0,G0={},SA="onreadystatechange";gl(function(){z0=ml.location});var ZS=function(n){if(mM(G0,n)){var i=G0[n];delete G0[n],i()}},eT=function(n){return function(){ZS(n)}},TA=function(n){ZS(n.data)},RA=function(n){ml.postMessage(EM(n),z0.protocol+"//"+z0.host)};YS&&$S||(YS=function(n){bA(arguments.length,1);var i=vA(n)?n:vM(n),s=gM(arguments,1);return G0[++QS]=function(){pM(i,void 0,s)},kg(QS),QS},$S=function(n){delete G0[n]},yM?kg=function(n){XS.nextTick(eT(n))}:JS&&JS.now?kg=function(n){JS.now(eT(n))}:wA&&!_M?(KS=(pA=new wA).port2,pA.port1.onmessage=TA,kg=fM(KS.postMessage,KS)):ml.addEventListener&&vA(ml.postMessage)&&!ml.importScripts&&z0&&z0.protocol!=="file:"&&!gl(RA)?(kg=RA,ml.addEventListener("message",TA,!1)):kg=SA in xA("script")?function(n){EA.appendChild(xA("script"))[SA]=function(){EA.removeChild(this),ZS(n)}}:function(n){setTimeout(eT(n),0)});var CE={set:YS,clear:$S},CA=U,xM=Ze,bM=Object.getOwnPropertyDescriptor,NA=function(n){if(!xM)return CA[n];var i=bM(CA,n);return i&&i.value},IA=function(){this.head=null,this.tail=null};IA.prototype={add:function(n){var i={item:n,next:null},s=this.tail;s?s.next=i:this.head=i,this.tail=i},get:function(){var n=this.head;if(n)return(this.head=n.next)===null&&(this.tail=null),n.item}};var Pg,tT,nT,W0,rT,AA=IA,wM=/ipad|iphone|ipod/i.test(Gr)&&typeof Pebble<"u",SM=/web0s(?!.*chrome)/i.test(Gr),Dg=U,TM=NA,kA=ll,iT=CE.set,RM=AA,PA=yA,CM=wM,NE=SM,sT=kp,DA=Dg.MutationObserver||Dg.WebKitMutationObserver,OA=Dg.document,LA=Dg.process,IE=Dg.Promise,aT=TM("queueMicrotask");if(!aT){var AE=new RM,kE=function(){var n,i;for(sT&&(n=LA.domain)&&n.exit();i=AE.get();)try{i()}catch(s){throw AE.head&&Pg(),s}n&&n.enter()};PA||sT||NE||!DA||!OA?!CM&&IE&&IE.resolve?((W0=IE.resolve(void 0)).constructor=IE,rT=kA(W0.then,W0),Pg=function(){rT(kE)}):sT?Pg=function(){LA.nextTick(kE)}:(iT=kA(iT,Dg),Pg=function(){iT(kE)}):(tT=!0,nT=OA.createTextNode(""),new DA(kE).observe(nT,{characterData:!0}),Pg=function(){nT.data=tT=!tT}),aT=function(n){AE.head||Pg(),AE.add(n)}}var jA=aT,Og=function(n){try{return{error:!1,value:n()}}catch(i){return{error:!0,value:i}}},im=U.Promise,NM=U,H0=im,IM=be,AM=vr,kM=zS,MA=Zt,oT=gu,cT=ia,UA=H0&&H0.prototype,PM=MA("species"),VA=IM(NM.PromiseRejectionEvent),PE=AM("Promise",function(){var n=kM(H0),i=n!==String(H0);if(!i&&cT===66||!UA.catch||!UA.finally)return!0;if(!cT||cT<51||!/native code/.test(n)){var s=new H0(function(d){d(1)}),o=function(d){d(function(){},function(){})};if((s.constructor={})[PM]=o,!(s.then(function(){})instanceof o))return!0}return!(i||oT!=="BROWSER"&&oT!=="DENO"||VA)}),K0={CONSTRUCTOR:PE,REJECTION_EVENT:VA},Su={},FA=gi,DM=TypeError,OM=function(n){var i,s;this.promise=new n(function(o,d){if(i!==void 0||s!==void 0)throw new DM("Bad Promise constructor");i=o,s=d}),this.resolve=FA(i),this.reject=FA(s)};Su.f=function(n){return new OM(n)};var lT,BA,zA,LM=In,DE=kp,Hp=U,OE=ds,q0=lt,GA=Eh,WA=bu,dT=function(n){var i=aA(n);sM&&i&&!i[cA]&&oA(i,cA,{configurable:!0,get:function(){return this}})},HA=gi,LE=be,KA=Jn,qA=SE,jM=qS,YA=CE.set,uT=jA,jE=function(n,i){try{arguments.length===1?console.error(n):console.error(n,i)}catch{}},ME=Og,MM=AA,$A=Po,Y0=im,hT=K0,XA=Su,UE="Promise",JA=hT.CONSTRUCTOR,UM=hT.REJECTION_EVENT,pT=$A.getterFor(UE),VM=$A.set,FM=Y0&&Y0.prototype,$0=Y0,fT=FM,QA=Hp.TypeError,mT=Hp.document,gT=Hp.process,_l=XA.f,BM=_l,zM=!!(mT&&mT.createEvent&&Hp.dispatchEvent),Kp="unhandledrejection",ar=function(n){var i;return!(!KA(n)||!LE(i=n.then))&&i},ZA=function(n,i){var s,o,d,h=i.value,f=i.state===1,g=f?n.ok:n.fail,y=n.resolve,x=n.reject,b=n.domain;try{g?(f||(i.rejection===2&&WM(i),i.rejection=1),g===!0?s=h:(b&&b.enter(),s=g(h),b&&(b.exit(),d=!0)),s===n.promise?x(new QA("Promise-chain cycle")):(o=ar(s))?q0(o,s,y,x):y(s)):x(h)}catch(N){b&&!d&&b.exit(),x(N)}},hc=function(n,i){n.notified||(n.notified=!0,uT(function(){for(var s,o=n.reactions;s=o.get();)ZA(s,n);n.notified=!1,i&&!n.rejection&&GM(n)}))},Ws=function(n,i,s){var o,d;zM?((o=mT.createEvent("Event")).promise=i,o.reason=s,o.initEvent(n,!1,!0),Hp.dispatchEvent(o)):o={promise:i,reason:s},!UM&&(d=Hp["on"+n])?d(o):n===Kp&&jE("Unhandled promise rejection",s)},GM=function(n){q0(YA,Hp,function(){var i,s=n.facade,o=n.value;if(wh(n)&&(i=ME(function(){DE?gT.emit("unhandledRejection",o,s):Ws(Kp,s,o)}),n.rejection=DE||wh(n)?2:1,i.error))throw i.value})},wh=function(n){return n.rejection!==1&&!n.parent},WM=function(n){q0(YA,Hp,function(){var i=n.facade;DE?gT.emit("rejectionHandled",i):Ws("rejectionhandled",i,n.value)})},Lg=function(n,i,s){return function(o){n(i,o,s)}},jg=function(n,i,s){n.done||(n.done=!0,s&&(n=s),n.value=i,n.state=2,hc(n,!0))},_T=function(n,i,s){if(!n.done){n.done=!0,s&&(n=s);try{if(n.facade===i)throw new QA("Promise can't be resolved itself");var o=ar(i);o?uT(function(){var d={done:!1};try{q0(o,i,Lg(_T,d,n),Lg(jg,d,n))}catch(h){jg(d,h,n)}}):(n.value=i,n.state=1,hc(n,!1))}catch(d){jg({done:!1},d,n)}}};JA&&(fT=($0=function(n){qA(this,fT),HA(n),q0(lT,this);var i=pT(this);try{n(Lg(_T,i),Lg(jg,i))}catch(s){jg(i,s)}}).prototype,(lT=function(n){VM(this,{type:UE,done:!1,notified:!1,parent:!1,reactions:new MM,rejection:!1,state:0,value:null})}).prototype=GA(fT,"then",function(n,i){var s=pT(this),o=_l(jM(this,$0));return s.parent=!0,o.ok=!LE(n)||n,o.fail=LE(i)&&i,o.domain=DE?gT.domain:void 0,s.state===0?s.reactions.add(o):uT(function(){ZA(o,s)}),o.promise}),BA=function(){var n=new lT,i=pT(n);this.promise=n,this.resolve=Lg(_T,i),this.reject=Lg(jg,i)},XA.f=_l=function(n){return n===$0||n===zA?new BA(n):BM(n)}),LM({global:!0,wrap:!0,forced:JA},{Promise:$0}),zA=OE.Promise,WA($0,UE,!1,!0),dT(UE);var e1=Zt("iterator"),VE=!1;try{var HM=0,Tu={next:function(){return{done:!!HM++}},return:function(){VE=!0}};Tu[e1]=function(){return this},Array.from(Tu,function(){throw 2})}catch{}var t1=im,FE=function(n,i){try{if(!i&&!VE)return!1}catch{return!1}var s=!1;try{var o={};o[e1]=function(){return{next:function(){return{done:s=!0}}}},n(o)}catch{}return s},ns=K0.CONSTRUCTOR||!FE(function(n){t1.all(n).then(void 0,function(){})}),Hs=lt,n1=gi,KM=Su,qM=Og,YM=D0;In({target:"Promise",stat:!0,forced:ns},{all:function(n){var i=this,s=KM.f(i),o=s.resolve,d=s.reject,h=qM(function(){var f=n1(i.resolve),g=[],y=0,x=1;YM(n,function(b){var N=y++,I=!1;x++,Hs(f,i,b).then(function(D){I||(I=!0,g[N]=D,--x||o(g))},d)}),--x||o(g)});return h.error&&d(h.value),s.promise}});var $M=In,XM=K0.CONSTRUCTOR;im&&im.prototype,$M({target:"Promise",proto:!0,forced:XM,real:!0},{catch:function(n){return this.then(void 0,n)}});var JM=lt,r1=gi,X0=Su,yT=Og,QM=D0;In({target:"Promise",stat:!0,forced:ns},{race:function(n){var i=this,s=X0.f(i),o=s.reject,d=yT(function(){var h=r1(i.resolve);QM(n,function(f){JM(h,i,f).then(s.resolve,o)})});return d.error&&o(d.value),s.promise}});var i1=Su;In({target:"Promise",stat:!0,forced:K0.CONSTRUCTOR},{reject:function(n){var i=i1.f(this);return(0,i.reject)(n),i.promise}});var BE=_i,yl=Jn,Mg=Su,s1=function(n,i){if(BE(n),yl(i)&&i.constructor===n)return i;var s=Mg.f(n);return(0,s.resolve)(i),s.promise},ZM=In,e5=im,t5=K0.CONSTRUCTOR,n5=s1,a1=hi("Promise"),Sh=!t5;ZM({target:"Promise",stat:!0,forced:!0},{resolve:function(n){return n5(Sh&&this===a1?e5:this,n)}});var Er=lt,o1=gi,Gl=Su,c1=Og,r5=D0;In({target:"Promise",stat:!0,forced:ns},{allSettled:function(n){var i=this,s=Gl.f(i),o=s.resolve,d=s.reject,h=c1(function(){var f=o1(i.resolve),g=[],y=0,x=1;r5(n,function(b){var N=y++,I=!1;x++,Er(f,i,b).then(function(D){I||(I=!0,g[N]={status:"fulfilled",value:D},--x||o(g))},function(D){I||(I=!0,g[N]={status:"rejected",reason:D},--x||o(g))})}),--x||o(g)});return h.error&&d(h.value),s.promise}});var Ai=lt,i5=gi,l1=hi,zE=Su,s5=Og,a5=D0,d1="No one promise resolved";In({target:"Promise",stat:!0,forced:ns},{any:function(n){var i=this,s=l1("AggregateError"),o=zE.f(i),d=o.resolve,h=o.reject,f=s5(function(){var g=i5(i.resolve),y=[],x=0,b=1,N=!1;a5(n,function(I){var D=x++,$=!1;b++,Ai(g,i,I).then(function(z){$||N||(N=!0,d(z))},function(z){$||N||($=!0,y[D]=z,--b||h(new s(y,d1)))})}),--b||h(new s(y,d1))});return f.error&&h(f.value),o.promise}});var o5=In,c5=X,l5=Gp,d5=Su,u5=gi,u1=Og,vT=U.Promise,h1=!1;o5({target:"Promise",stat:!0,forced:!vT||!vT.try||u1(function(){vT.try(function(n){h1=n===8},8)}).error||!h1},{try:function(n){var i=arguments.length>1?l5(arguments,1):[],s=d5.f(this),o=u1(function(){return c5(u5(n),void 0,i)});return(o.error?s.reject:s.resolve)(o.value),s.promise}});var h5=Su;In({target:"Promise",stat:!0},{withResolvers:function(){var n=h5.f(this);return{promise:n.promise,resolve:n.resolve,reject:n.reject}}});var p5=In,J0=im,f5=u,ET=hi,m5=be,g5=qS,p1=s1,qa=J0&&J0.prototype;p5({target:"Promise",proto:!0,real:!0,forced:!!J0&&f5(function(){qa.finally.call({then:function(){}},function(){})})},{finally:function(n){var i=g5(this,ET("Promise")),s=m5(n);return this.then(s?function(o){return p1(i,n()).then(function(){return o})}:n,s?function(o){return p1(i,n()).then(function(){throw o})}:n)}});var Do=C,_5=k,y5=zs,v5=nn,f1=Do("".charAt),m1=Do("".charCodeAt),E5=Do("".slice),g1=function(n){return function(i,s){var o,d,h=y5(v5(i)),f=_5(s),g=h.length;return f<0||f>=g?n?"":void 0:(o=m1(h,f))<55296||o>56319||f+1===g||(d=m1(h,f+1))<56320||d>57343?n?f1(h,f):o:n?E5(h,f,f+2):d-56320+(o-55296<<10)+65536}},GE={codeAt:g1(!1),charAt:g1(!0)},x5=GE.charAt,b5=zs,_1=Po,y1=US,xT=wE,v1="String Iterator",w5=_1.set,S5=_1.getterFor(v1);y1(String,"String",function(n){w5(this,{type:v1,string:b5(n),index:0})},function(){var n,i=S5(this),s=i.string,o=i.index;return o>=s.length?xT(void 0,!0):(n=x5(s,o),i.index+=n.length,xT(n,!1))});var T5=ds.Promise,Ug={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},R5=U,C5=bu,E1=Op;for(var bT in Ug)C5(R5[bT],bT),E1[bT]=E1.Array;var x1=T5,et=l(x1),b1=Co("Array","values"),N5=hl,I5=Zi,A5=A,k5=b1,wT=Array.prototype,P5={DOMTokenList:!0,NodeList:!0},D5=function(n){var i=n.values;return n===wT||A5(wT,n)&&i===wT.values||I5(P5,N5(n))?k5:i},pc=l(D5),w1=Qi,O5=TypeError,S1=Gp,L5=Math.floor,ST=function(n,i){var s=n.length;if(s<8)for(var o,d,h=1;h<s;){for(d=h,o=n[h];d&&i(n[d-1],o)>0;)n[d]=n[--d];d!==h++&&(n[d]=o)}else for(var f=L5(s/2),g=ST(S1(n,0,f),i),y=ST(S1(n,f),i),x=g.length,b=y.length,N=0,I=0;N<x||I<b;)n[N+I]=N<x&&I<b?i(g[N],y[I])<=0?g[N++]:y[I++]:N<x?g[N++]:y[I++];return n},T1=ST,R1=Gr.match(/firefox\/(\d+)/i),j5=!!R1&&+R1[1],M5=/MSIE|Trident/.test(Gr),C1=Gr.match(/AppleWebKit\/(\d+)\./),U5=!!C1&&+C1[1],V5=In,N1=C,F5=gi,B5=io,I1=sr,z5=function(n,i){if(!delete n[i])throw new O5("Cannot delete property "+w1(i)+" of "+w1(n))},WE=zs,HE=u,A1=T1,G5=fu,k1=j5,W5=M5,KE=ia,P1=U5,qp=[],D1=N1(qp.sort),Wc=N1(qp.push),TT=HE(function(){qp.sort(void 0)}),H5=HE(function(){qp.sort(null)}),K5=G5("sort"),O1=!HE(function(){if(KE)return KE<70;if(!(k1&&k1>3)){if(W5)return!0;if(P1)return P1<603;var n,i,s,o,d="";for(n=65;n<76;n++){switch(i=String.fromCharCode(n),n){case 66:case 69:case 70:case 72:s=3;break;case 68:case 71:s=4;break;default:s=2}for(o=0;o<47;o++)qp.push({k:i+o,v:s})}for(qp.sort(function(h,f){return f.v-h.v}),o=0;o<qp.length;o++)i=qp[o].k.charAt(0),d.charAt(d.length-1)!==i&&(d+=i);return d!=="DGBEFHACIJK"}});V5({target:"Array",proto:!0,forced:TT||!H5||!K5||!O1},{sort:function(n){n!==void 0&&F5(n);var i=B5(this);if(O1)return n===void 0?D1(i):D1(i,n);var s,o,d=[],h=I1(i);for(o=0;o<h;o++)o in i&&Wc(d,i[o]);for(A1(d,function(f){return function(g,y){return y===void 0?-1:g===void 0?1:f!==void 0?+f(g,y)||0:WE(g)>WE(y)?1:-1}}(n)),s=I1(d),o=0;o<s;)i[o]=d[o++];for(;o<h;)z5(i,o++);return i}});var q5=Co("Array","sort"),RT=A,Y5=q5,Q0=Array.prototype,$5=function(n){var i=n.sort;return n===Q0||RT(Q0,n)&&i===Q0.sort?Y5:i},sm=l($5),X5=In,J5=C,L1=He,Q5=RangeError,j1=String.fromCharCode,M1=String.fromCodePoint,CT=J5([].join);X5({target:"String",stat:!0,forced:!!M1&&M1.length!==1},{fromCodePoint:function(n){for(var i,s=[],o=arguments.length,d=0;o>d;){if(i=+arguments[d++],L1(i,1114111)!==i)throw new Q5(i+" is not a valid code point");s[d]=i<65536?j1(i):j1(55296+((i-=65536)>>10),i%1024+56320)}return CT(s,"")}});var NT=u,Z5=Zt("iterator"),qE=!NT(function(){var n=new URL("b?a=1&b=2&c=3","https://a"),i=n.searchParams,s=new URLSearchParams("a=1&a=2&b=3"),o="";return n.pathname="c%20d",i.forEach(function(d,h){i.delete("b"),o+=h+d}),s.delete("a",2),s.delete("b",void 0),!n.toJSON||!s.has("a",1)||s.has("a",2)||!s.has("a",void 0)||s.has("b")||!i.size&&!0||!i.sort||n.href!=="https://a/c%20d?a=1&c=3"||i.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!i[Z5]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||o!=="a1c3"||new URL("https://x",void 0).host!=="x"}),eU=Eh,IT=In,U1=U,AT=NA,tU=hi,YE=lt,Ad=C,Z0=Ze,V1=qE,F1=Eh,nU=zp,rU=function(n,i,s){for(var o in i)s&&s.unsafe&&n[o]?n[o]=i[o]:eU(n,o,i[o],s);return n},iU=bu,sU=U0,kT=Po,B1=SE,PT=be,aU=Zi,oU=ll,E=hl,T=_i,j=Jn,Z=zs,me=bg,we=yt,Ae=yS,Oe=Lp,ze=wE,gt=Wp,bt=T1,At=Zt("iterator"),Gt="URLSearchParams",En=Gt+"Iterator",Ln=kT.set,jn=kT.getterFor(Gt),Gn=kT.getterFor(En),Fr=AT("fetch"),Br=AT("Request"),co=AT("Headers"),lo=Br&&Br.prototype,Hc=co&&co.prototype,oa=U1.TypeError,kd=U1.encodeURIComponent,Th=String.fromCharCode,z1=tU("String","fromCodePoint"),Dge=parseInt,G1=Ad("".charAt),w9=Ad([].join),Vg=Ad([].push),S9=Ad("".replace),Oge=Ad([].shift),T9=Ad([].splice),R9=Ad("".split),C9=Ad("".slice),Lge=Ad(/./.exec),jge=/\+/g,Mge=/^[0-9a-f]+$/i,N9=function(n,i){var s=C9(n,i,i+2);return Lge(Mge,s)?Dge(s,16):NaN},Uge=function(n){for(var i=0,s=128;s>0&&n&s;s>>=1)i++;return i},Vge=function(n){var i=null;switch(n.length){case 1:i=n[0];break;case 2:i=(31&n[0])<<6|63&n[1];break;case 3:i=(15&n[0])<<12|(63&n[1])<<6|63&n[2];break;case 4:i=(7&n[0])<<18|(63&n[1])<<12|(63&n[2])<<6|63&n[3]}return i>1114111?null:i},I9=function(n){for(var i=(n=S9(n,jge," ")).length,s="",o=0;o<i;){var d=G1(n,o);if(d==="%"){if(G1(n,o+1)==="%"||o+3>i){s+="%",o++;continue}var h=N9(n,o+1);if(h!=h){s+=d,o++;continue}o+=2;var f=Uge(h);if(f===0)d=Th(h);else{if(f===1||f>4){s+="",o++;continue}for(var g=[h],y=1;y<f&&!(++o+3>i||G1(n,o)!=="%");){var x=N9(n,o+1);if(x!=x){o+=3;break}if(x>191||x<128)break;Vg(g,x),o+=2,y++}if(g.length!==f){s+="";continue}var b=Vge(g);b===null?s+="":d=z1(b)}}s+=d,o++}return s},Fge=/[!'()~]|%20/g,Bge={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},zge=function(n){return Bge[n]},A9=function(n){return S9(kd(n),Fge,zge)},cU=sU(function(n,i){Ln(this,{type:En,target:jn(n).entries,index:0,kind:i})},Gt,function(){var n=Gn(this),i=n.target,s=n.index++;if(!i||s>=i.length)return n.target=null,ze(void 0,!0);var o=i[s];switch(n.kind){case"keys":return ze(o.key,!1);case"values":return ze(o.value,!1)}return ze([o.key,o.value],!1)},!0),k9=function(n){this.entries=[],this.url=null,n!==void 0&&(j(n)?this.parseObject(n):this.parseQuery(typeof n=="string"?G1(n,0)==="?"?C9(n,1):n:Z(n)))};k9.prototype={type:Gt,bindURL:function(n){this.url=n,this.update()},parseObject:function(n){var i,s,o,d,h,f,g,y=this.entries,x=Oe(n);if(x)for(s=(i=Ae(n,x)).next;!(o=YE(s,i)).done;){if(h=(d=Ae(T(o.value))).next,(f=YE(h,d)).done||(g=YE(h,d)).done||!YE(h,d).done)throw new oa("Expected sequence with length 2");Vg(y,{key:Z(f.value),value:Z(g.value)})}else for(var b in n)aU(n,b)&&Vg(y,{key:b,value:Z(n[b])})},parseQuery:function(n){if(n)for(var i,s,o=this.entries,d=R9(n,"&"),h=0;h<d.length;)(i=d[h++]).length&&(s=R9(i,"="),Vg(o,{key:I9(Oge(s)),value:I9(w9(s,"="))}))},serialize:function(){for(var n,i=this.entries,s=[],o=0;o<i.length;)n=i[o++],Vg(s,A9(n.key)+"="+A9(n.value));return w9(s,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var W1=function(){B1(this,$E);var n=Ln(this,new k9(arguments.length>0?arguments[0]:void 0));Z0||(this.size=n.entries.length)},$E=W1.prototype;if(rU($E,{append:function(n,i){var s=jn(this);gt(arguments.length,2),Vg(s.entries,{key:Z(n),value:Z(i)}),Z0||this.length++,s.updateURL()},delete:function(n){for(var i=jn(this),s=gt(arguments.length,1),o=i.entries,d=Z(n),h=s<2?void 0:arguments[1],f=h===void 0?h:Z(h),g=0;g<o.length;){var y=o[g];if(y.key!==d||f!==void 0&&y.value!==f)g++;else if(T9(o,g,1),f!==void 0)break}Z0||(this.size=o.length),i.updateURL()},get:function(n){var i=jn(this).entries;gt(arguments.length,1);for(var s=Z(n),o=0;o<i.length;o++)if(i[o].key===s)return i[o].value;return null},getAll:function(n){var i=jn(this).entries;gt(arguments.length,1);for(var s=Z(n),o=[],d=0;d<i.length;d++)i[d].key===s&&Vg(o,i[d].value);return o},has:function(n){for(var i=jn(this).entries,s=gt(arguments.length,1),o=Z(n),d=s<2?void 0:arguments[1],h=d===void 0?d:Z(d),f=0;f<i.length;){var g=i[f++];if(g.key===o&&(h===void 0||g.value===h))return!0}return!1},set:function(n,i){var s=jn(this);gt(arguments.length,1);for(var o,d=s.entries,h=!1,f=Z(n),g=Z(i),y=0;y<d.length;y++)(o=d[y]).key===f&&(h?T9(d,y--,1):(h=!0,o.value=g));h||Vg(d,{key:f,value:g}),Z0||(this.size=d.length),s.updateURL()},sort:function(){var n=jn(this);bt(n.entries,function(i,s){return i.key>s.key?1:-1}),n.updateURL()},forEach:function(n){for(var i,s=jn(this).entries,o=oU(n,arguments.length>1?arguments[1]:void 0),d=0;d<s.length;)o((i=s[d++]).value,i.key,this)},keys:function(){return new cU(this,"keys")},values:function(){return new cU(this,"values")},entries:function(){return new cU(this,"entries")}},{enumerable:!0}),F1($E,At,$E.entries,{}),F1($E,"toString",function(){return jn(this).serialize()},{enumerable:!0}),Z0&&nU($E,"size",{get:function(){return jn(this).entries.length},configurable:!0,enumerable:!0}),iU(W1,Gt),IT({global:!0,forced:!V1},{URLSearchParams:W1}),!V1&&PT(co)){var Gge=Ad(Hc.has),Wge=Ad(Hc.set),P9=function(n){if(j(n)){var i,s=n.body;if(E(s)===Gt)return i=n.headers?new co(n.headers):new co,Gge(i,"content-type")||Wge(i,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),me(n,{body:we(0,Z(s)),headers:we(0,i)})}return n};if(PT(Fr)&&IT({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(n){return Fr(n,arguments.length>1?P9(arguments[1]):{})}}),PT(Br)){var lU=function(n){return B1(this,lo),new Br(n,arguments.length>1?P9(arguments[1]):{})};lo.constructor=lU,lU.prototype=lo,IT({global:!0,dontCallGetSet:!0,forced:!0},{Request:lU})}}var Ru,Hge={URLSearchParams:W1,getState:jn},Kge=ds.URLSearchParams,D9=Ze,qge=C,Yge=lt,$ge=u,dU=eE,Xge=k0,Jge=Le,Qge=io,Zge=ln,XE=Object.assign,O9=Object.defineProperty,e_e=qge([].concat),t_e=!XE||$ge(function(){if(D9&&XE({b:1},XE(O9({},"a",{enumerable:!0,get:function(){O9(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var n={},i={},s=Symbol("assign detection"),o="abcdefghijklmnopqrst";return n[s]=7,o.split("").forEach(function(d){i[d]=d}),XE({},n)[s]!==7||dU(XE({},i)).join("")!==o})?function(n,i){for(var s=Qge(n),o=arguments.length,d=1,h=Xge.f,f=Jge.f;o>d;)for(var g,y=Zge(arguments[d++]),x=h?e_e(dU(y),h(y)):dU(y),b=x.length,N=0;b>N;)g=x[N++],D9&&!Yge(f,y,g)||(s[g]=y[g]);return s}:XE,n_e=_i,r_e=cE,i_e=Ze,s_e=za,a_e=yt,uU=function(n,i,s){i_e?s_e.f(n,i,a_e(0,s)):n[i]=s},o_e=ll,c_e=lt,l_e=io,d_e=function(n,i,s,o){try{return o?i(n_e(s)[0],s[1]):i(s)}catch(d){r_e(n,"throw",d)}},u_e=aE,h_e=RE,p_e=sr,L9=uU,f_e=yS,m_e=Lp,j9=Array,ey=C,hU=2147483647,g_e=/[^\0-\u007E]/,M9=/[.\u3002\uFF0E\uFF61]/g,U9="Overflow: input needs wider integers to process",V9=RangeError,__e=ey(M9.exec),JE=Math.floor,pU=String.fromCharCode,F9=ey("".charCodeAt),B9=ey([].join),Fg=ey([].push),y_e=ey("".replace),v_e=ey("".split),E_e=ey("".toLowerCase),z9=function(n){return n+22+75*(n<26)},x_e=function(n,i,s){var o=0;for(n=s?JE(n/700):n>>1,n+=JE(n/i);n>455;)n=JE(n/35),o+=36;return JE(o+36*n/(n+38))},b_e=function(n){var i=[];n=function(ie){for(var oe=[],fe=0,Ee=ie.length;fe<Ee;){var Te=F9(ie,fe++);if(Te>=55296&&Te<=56319&&fe<Ee){var _e=F9(ie,fe++);(64512&_e)==56320?Fg(oe,((1023&Te)<<10)+(1023&_e)+65536):(Fg(oe,Te),fe--)}else Fg(oe,Te)}return oe}(n);var s,o,d=n.length,h=128,f=0,g=72;for(s=0;s<n.length;s++)(o=n[s])<128&&Fg(i,pU(o));var y=i.length,x=y;for(y&&Fg(i,"-");x<d;){var b=hU;for(s=0;s<n.length;s++)(o=n[s])>=h&&o<b&&(b=o);var N=x+1;if(b-h>JE((hU-f)/N))throw new V9(U9);for(f+=(b-h)*N,h=b,s=0;s<n.length;s++){if((o=n[s])<h&&++f>hU)throw new V9(U9);if(o===h){for(var I=f,D=36;;){var $=D<=g?1:D>=g+26?26:D-g;if(I<$)break;var z=I-$,K=36-$;Fg(i,pU(z9($+z%K))),I=JE(z/K),D+=36}Fg(i,pU(z9(I))),g=x_e(f,N,x===y),f=0,x++}}f++,h++}return B9(i,"")},w_e=In,fU=Ze,S_e=qE,mU=U,G9=ll,Cu=C,H1=Eh,Nu=zp,T_e=SE,gU=Zi,_U=t_e,QE=function(n){var i=l_e(n),s=h_e(this),o=arguments.length,d=o>1?arguments[1]:void 0,h=d!==void 0;h&&(d=o_e(d,o>2?arguments[2]:void 0));var f,g,y,x,b,N,I=m_e(i),D=0;if(!I||this===j9&&u_e(I))for(f=p_e(i),g=s?new this(f):j9(f);f>D;D++)N=h?d(i[D],D):i[D],L9(g,D,N);else for(g=s?new this:[],b=(x=f_e(i,I)).next;!(y=c_e(b,x)).done;D++)N=h?d_e(x,d,[y.value,D],!0):y.value,L9(g,D,N);return g.length=D,g},Rh=Gp,R_e=GE.codeAt,C_e=function(n){var i,s,o=[],d=v_e(y_e(E_e(n),M9,"."),".");for(i=0;i<d.length;i++)s=d[i],Fg(o,__e(g_e,s)?"xn--"+b_e(s):s);return B9(o,".")},am=zs,N_e=bu,I_e=Wp,W9=Hge,H9=Po,A_e=H9.set,K1=H9.getterFor("URL"),k_e=W9.URLSearchParams,P_e=W9.getState,DT=mU.URL,yU=mU.TypeError,q1=mU.parseInt,D_e=Math.floor,K9=Math.pow,Iu=Cu("".charAt),Ch=Cu(/./.exec),OT=Cu([].join),O_e=Cu(1.1.toString),L_e=Cu([].pop),ZE=Cu([].push),vU=Cu("".replace),j_e=Cu([].shift),M_e=Cu("".split),LT=Cu("".slice),Y1=Cu("".toLowerCase),U_e=Cu([].unshift),EU="Invalid scheme",ty="Invalid host",q9="Invalid port",Y9=/[a-z]/i,V_e=/[\d+-.a-z]/i,xU=/\d/,F_e=/^0x/i,B_e=/^[0-7]+$/,z_e=/^\d+$/,$9=/^[\da-f]+$/i,G_e=/[\0\t\n\r #%/:<>?@[\\\]^|]/,W_e=/[\0\t\n\r #/:<>?@[\\\]^|]/,H_e=/^[\u0000-\u0020]+/,K_e=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,q_e=/[\t\n\r]/g,jT=function(n){var i,s,o,d;if(typeof n=="number"){for(i=[],s=0;s<4;s++)U_e(i,n%256),n=D_e(n/256);return OT(i,".")}if(typeof n=="object"){for(i="",o=function(h){for(var f=null,g=1,y=null,x=0,b=0;b<8;b++)h[b]!==0?(x>g&&(f=y,g=x),y=null,x=0):(y===null&&(y=b),++x);return x>g?y:f}(n),s=0;s<8;s++)d&&n[s]===0||(d&&(d=!1),o===s?(i+=s?":":"::",d=!0):(i+=O_e(n[s],16),s<7&&(i+=":")));return"["+i+"]"}return n},$1={},X9=_U({},$1,{" ":1,'"':1,"<":1,">":1,"`":1}),J9=_U({},X9,{"#":1,"?":1,"{":1,"}":1}),bU=_U({},J9,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Bg=function(n,i){var s=R_e(n,0);return s>32&&s<127&&!gU(i,n)?n:encodeURIComponent(n)},X1={ftp:21,file:null,http:80,https:443,ws:80,wss:443},MT=function(n,i){var s;return n.length===2&&Ch(Y9,Iu(n,0))&&((s=Iu(n,1))===":"||!i&&s==="|")},Q9=function(n){var i;return n.length>1&&MT(LT(n,0,2))&&(n.length===2||(i=Iu(n,2))==="/"||i==="\\"||i==="?"||i==="#")},Y_e=function(n){return n==="."||Y1(n)==="%2e"},wU={},Z9={},SU={},eH={},tH={},TU={},nH={},rH={},J1={},Q1={},RU={},CU={},NU={},IU={},iH={},AU={},ex={},Yp={},sH={},ny={},om={},kU=function(n,i,s){var o,d,h,f=am(n);if(i){if(d=this.parse(f))throw new yU(d);this.searchParams=null}else{if(s!==void 0&&(o=new kU(s,!0)),d=this.parse(f,null,o))throw new yU(d);(h=P_e(new k_e)).bindURL(this),this.searchParams=h}};kU.prototype={type:"URL",parse:function(n,i,s){var o,d,h,f,g,y=this,x=i||wU,b=0,N="",I=!1,D=!1,$=!1;for(n=am(n),i||(y.scheme="",y.username="",y.password="",y.host=null,y.port=null,y.path=[],y.query=null,y.fragment=null,y.cannotBeABaseURL=!1,n=vU(n,H_e,""),n=vU(n,K_e,"$1")),n=vU(n,q_e,""),o=QE(n);b<=o.length;){switch(d=o[b],x){case wU:if(!d||!Ch(Y9,d)){if(i)return EU;x=SU;continue}N+=Y1(d),x=Z9;break;case Z9:if(d&&(Ch(V_e,d)||d==="+"||d==="-"||d==="."))N+=Y1(d);else{if(d!==":"){if(i)return EU;N="",x=SU,b=0;continue}if(i&&(y.isSpecial()!==gU(X1,N)||N==="file"&&(y.includesCredentials()||y.port!==null)||y.scheme==="file"&&!y.host))return;if(y.scheme=N,i)return void(y.isSpecial()&&X1[y.scheme]===y.port&&(y.port=null));N="",y.scheme==="file"?x=IU:y.isSpecial()&&s&&s.scheme===y.scheme?x=eH:y.isSpecial()?x=rH:o[b+1]==="/"?(x=tH,b++):(y.cannotBeABaseURL=!0,ZE(y.path,""),x=sH)}break;case SU:if(!s||s.cannotBeABaseURL&&d!=="#")return EU;if(s.cannotBeABaseURL&&d==="#"){y.scheme=s.scheme,y.path=Rh(s.path),y.query=s.query,y.fragment="",y.cannotBeABaseURL=!0,x=om;break}x=s.scheme==="file"?IU:TU;continue;case eH:if(d!=="/"||o[b+1]!=="/"){x=TU;continue}x=J1,b++;break;case tH:if(d==="/"){x=Q1;break}x=Yp;continue;case TU:if(y.scheme=s.scheme,d===Ru)y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=Rh(s.path),y.query=s.query;else if(d==="/"||d==="\\"&&y.isSpecial())x=nH;else if(d==="?")y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=Rh(s.path),y.query="",x=ny;else{if(d!=="#"){y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=Rh(s.path),y.path.length--,x=Yp;continue}y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=Rh(s.path),y.query=s.query,y.fragment="",x=om}break;case nH:if(!y.isSpecial()||d!=="/"&&d!=="\\"){if(d!=="/"){y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,x=Yp;continue}x=Q1}else x=J1;break;case rH:if(x=J1,d!=="/"||Iu(N,b+1)!=="/")continue;b++;break;case J1:if(d!=="/"&&d!=="\\"){x=Q1;continue}break;case Q1:if(d==="@"){I&&(N="%40"+N),I=!0,h=QE(N);for(var z=0;z<h.length;z++){var K=h[z];if(K!==":"||$){var ie=Bg(K,bU);$?y.password+=ie:y.username+=ie}else $=!0}N=""}else if(d===Ru||d==="/"||d==="?"||d==="#"||d==="\\"&&y.isSpecial()){if(I&&N==="")return"Invalid authority";b-=QE(N).length+1,N="",x=RU}else N+=d;break;case RU:case CU:if(i&&y.scheme==="file"){x=AU;continue}if(d!==":"||D){if(d===Ru||d==="/"||d==="?"||d==="#"||d==="\\"&&y.isSpecial()){if(y.isSpecial()&&N==="")return ty;if(i&&N===""&&(y.includesCredentials()||y.port!==null))return;if(f=y.parseHost(N))return f;if(N="",x=ex,i)return;continue}d==="["?D=!0:d==="]"&&(D=!1),N+=d}else{if(N==="")return ty;if(f=y.parseHost(N))return f;if(N="",x=NU,i===CU)return}break;case NU:if(!Ch(xU,d)){if(d===Ru||d==="/"||d==="?"||d==="#"||d==="\\"&&y.isSpecial()||i){if(N!==""){var oe=q1(N,10);if(oe>65535)return q9;y.port=y.isSpecial()&&oe===X1[y.scheme]?null:oe,N=""}if(i)return;x=ex;continue}return q9}N+=d;break;case IU:if(y.scheme="file",d==="/"||d==="\\")x=iH;else{if(!s||s.scheme!=="file"){x=Yp;continue}switch(d){case Ru:y.host=s.host,y.path=Rh(s.path),y.query=s.query;break;case"?":y.host=s.host,y.path=Rh(s.path),y.query="",x=ny;break;case"#":y.host=s.host,y.path=Rh(s.path),y.query=s.query,y.fragment="",x=om;break;default:Q9(OT(Rh(o,b),""))||(y.host=s.host,y.path=Rh(s.path),y.shortenPath()),x=Yp;continue}}break;case iH:if(d==="/"||d==="\\"){x=AU;break}s&&s.scheme==="file"&&!Q9(OT(Rh(o,b),""))&&(MT(s.path[0],!0)?ZE(y.path,s.path[0]):y.host=s.host),x=Yp;continue;case AU:if(d===Ru||d==="/"||d==="\\"||d==="?"||d==="#"){if(!i&&MT(N))x=Yp;else if(N===""){if(y.host="",i)return;x=ex}else{if(f=y.parseHost(N))return f;if(y.host==="localhost"&&(y.host=""),i)return;N="",x=ex}continue}N+=d;break;case ex:if(y.isSpecial()){if(x=Yp,d!=="/"&&d!=="\\")continue}else if(i||d!=="?")if(i||d!=="#"){if(d!==Ru&&(x=Yp,d!=="/"))continue}else y.fragment="",x=om;else y.query="",x=ny;break;case Yp:if(d===Ru||d==="/"||d==="\\"&&y.isSpecial()||!i&&(d==="?"||d==="#")){if((g=Y1(g=N))===".."||g==="%2e."||g===".%2e"||g==="%2e%2e"?(y.shortenPath(),d==="/"||d==="\\"&&y.isSpecial()||ZE(y.path,"")):Y_e(N)?d==="/"||d==="\\"&&y.isSpecial()||ZE(y.path,""):(y.scheme==="file"&&!y.path.length&&MT(N)&&(y.host&&(y.host=""),N=Iu(N,0)+":"),ZE(y.path,N)),N="",y.scheme==="file"&&(d===Ru||d==="?"||d==="#"))for(;y.path.length>1&&y.path[0]==="";)j_e(y.path);d==="?"?(y.query="",x=ny):d==="#"&&(y.fragment="",x=om)}else N+=Bg(d,J9);break;case sH:d==="?"?(y.query="",x=ny):d==="#"?(y.fragment="",x=om):d!==Ru&&(y.path[0]+=Bg(d,$1));break;case ny:i||d!=="#"?d!==Ru&&(d==="'"&&y.isSpecial()?y.query+="%27":y.query+=d==="#"?"%23":Bg(d,$1)):(y.fragment="",x=om);break;case om:d!==Ru&&(y.fragment+=Bg(d,X9))}b++}},parseHost:function(n){var i,s,o;if(Iu(n,0)==="["){if(Iu(n,n.length-1)!=="]"||(i=function(d){var h,f,g,y,x,b,N,I=[0,0,0,0,0,0,0,0],D=0,$=null,z=0,K=function(){return Iu(d,z)};if(K()===":"){if(Iu(d,1)!==":")return;z+=2,$=++D}for(;K();){if(D===8)return;if(K()!==":"){for(h=f=0;f<4&&Ch($9,K());)h=16*h+q1(K(),16),z++,f++;if(K()==="."){if(f===0||(z-=f,D>6))return;for(g=0;K();){if(y=null,g>0){if(!(K()==="."&&g<4))return;z++}if(!Ch(xU,K()))return;for(;Ch(xU,K());){if(x=q1(K(),10),y===null)y=x;else{if(y===0)return;y=10*y+x}if(y>255)return;z++}I[D]=256*I[D]+y,++g!=2&&g!==4||D++}if(g!==4)return;break}if(K()===":"){if(z++,!K())return}else if(K())return;I[D++]=h}else{if($!==null)return;z++,$=++D}}if($!==null)for(b=D-$,D=7;D!==0&&b>0;)N=I[D],I[D--]=I[$+b-1],I[$+--b]=N;else if(D!==8)return;return I}(LT(n,1,-1)),!i))return ty;this.host=i}else if(this.isSpecial()){if(n=C_e(n),Ch(G_e,n)||(i=function(d){var h,f,g,y,x,b,N,I=M_e(d,".");if(I.length&&I[I.length-1]===""&&I.length--,(h=I.length)>4)return d;for(f=[],g=0;g<h;g++){if((y=I[g])==="")return d;if(x=10,y.length>1&&Iu(y,0)==="0"&&(x=Ch(F_e,y)?16:8,y=LT(y,x===8?1:2)),y==="")b=0;else{if(!Ch(x===10?z_e:x===8?B_e:$9,y))return d;b=q1(y,x)}ZE(f,b)}for(g=0;g<h;g++)if(b=f[g],g===h-1){if(b>=K9(256,5-h))return null}else if(b>255)return null;for(N=L_e(f),g=0;g<f.length;g++)N+=f[g]*K9(256,3-g);return N}(n),i===null))return ty;this.host=i}else{if(Ch(W_e,n))return ty;for(i="",s=QE(n),o=0;o<s.length;o++)i+=Bg(s[o],$1);this.host=i}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return gU(X1,this.scheme)},shortenPath:function(){var n=this.path,i=n.length;!i||this.scheme==="file"&&i===1&&MT(n[0],!0)||n.length--},serialize:function(){var n=this,i=n.scheme,s=n.username,o=n.password,d=n.host,h=n.port,f=n.path,g=n.query,y=n.fragment,x=i+":";return d!==null?(x+="//",n.includesCredentials()&&(x+=s+(o?":"+o:"")+"@"),x+=jT(d),h!==null&&(x+=":"+h)):i==="file"&&(x+="//"),x+=n.cannotBeABaseURL?f[0]:f.length?"/"+OT(f,"/"):"",g!==null&&(x+="?"+g),y!==null&&(x+="#"+y),x},setHref:function(n){var i=this.parse(n);if(i)throw new yU(i);this.searchParams.update()},getOrigin:function(){var n=this.scheme,i=this.port;if(n==="blob")try{return new tx(n.path[0]).origin}catch{return"null"}return n!=="file"&&this.isSpecial()?n+"://"+jT(this.host)+(i!==null?":"+i:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(n){this.parse(am(n)+":",wU)},getUsername:function(){return this.username},setUsername:function(n){var i=QE(am(n));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var s=0;s<i.length;s++)this.username+=Bg(i[s],bU)}},getPassword:function(){return this.password},setPassword:function(n){var i=QE(am(n));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var s=0;s<i.length;s++)this.password+=Bg(i[s],bU)}},getHost:function(){var n=this.host,i=this.port;return n===null?"":i===null?jT(n):jT(n)+":"+i},setHost:function(n){this.cannotBeABaseURL||this.parse(n,RU)},getHostname:function(){var n=this.host;return n===null?"":jT(n)},setHostname:function(n){this.cannotBeABaseURL||this.parse(n,CU)},getPort:function(){var n=this.port;return n===null?"":am(n)},setPort:function(n){this.cannotHaveUsernamePasswordPort()||((n=am(n))===""?this.port=null:this.parse(n,NU))},getPathname:function(){var n=this.path;return this.cannotBeABaseURL?n[0]:n.length?"/"+OT(n,"/"):""},setPathname:function(n){this.cannotBeABaseURL||(this.path=[],this.parse(n,ex))},getSearch:function(){var n=this.query;return n?"?"+n:""},setSearch:function(n){(n=am(n))===""?this.query=null:(Iu(n,0)==="?"&&(n=LT(n,1)),this.query="",this.parse(n,ny)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var n=this.fragment;return n?"#"+n:""},setHash:function(n){(n=am(n))!==""?(Iu(n,0)==="#"&&(n=LT(n,1)),this.fragment="",this.parse(n,om)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var tx=function(n){var i=T_e(this,vl),s=I_e(arguments.length,1)>1?arguments[1]:void 0,o=A_e(i,new kU(n,!1,s));fU||(i.href=o.serialize(),i.origin=o.getOrigin(),i.protocol=o.getProtocol(),i.username=o.getUsername(),i.password=o.getPassword(),i.host=o.getHost(),i.hostname=o.getHostname(),i.port=o.getPort(),i.pathname=o.getPathname(),i.search=o.getSearch(),i.searchParams=o.getSearchParams(),i.hash=o.getHash())},vl=tx.prototype,Au=function(n,i){return{get:function(){return K1(this)[n]()},set:i&&function(s){return K1(this)[i](s)},configurable:!0,enumerable:!0}};if(fU&&(Nu(vl,"href",Au("serialize","setHref")),Nu(vl,"origin",Au("getOrigin")),Nu(vl,"protocol",Au("getProtocol","setProtocol")),Nu(vl,"username",Au("getUsername","setUsername")),Nu(vl,"password",Au("getPassword","setPassword")),Nu(vl,"host",Au("getHost","setHost")),Nu(vl,"hostname",Au("getHostname","setHostname")),Nu(vl,"port",Au("getPort","setPort")),Nu(vl,"pathname",Au("getPathname","setPathname")),Nu(vl,"search",Au("getSearch","setSearch")),Nu(vl,"searchParams",Au("getSearchParams")),Nu(vl,"hash",Au("getHash","setHash"))),H1(vl,"toJSON",function(){return K1(this).serialize()},{enumerable:!0}),H1(vl,"toString",function(){return K1(this).serialize()},{enumerable:!0}),DT){var aH=DT.createObjectURL,oH=DT.revokeObjectURL;aH&&H1(tx,"createObjectURL",G9(aH,DT)),oH&&H1(tx,"revokeObjectURL",G9(oH,DT))}N_e(tx,"URL"),w_e({global:!0,forced:!S_e,sham:!fU},{URL:tx});var $_e=In,cH=u,X_e=Wp,lH=zs,J_e=qE,PU=hi("URL"),Q_e=J_e&&cH(function(){PU.canParse()}),Z_e=cH(function(){return PU.canParse.length!==1});$_e({target:"URL",stat:!0,forced:!Q_e||Z_e},{canParse:function(n){var i=X_e(arguments.length,1),s=lH(n),o=i<2||arguments[1]===void 0?void 0:lH(arguments[1]);try{return!!new PU(s,o)}catch{return!1}}});var e0e=In,t0e=Wp,dH=zs,n0e=qE,r0e=hi("URL");e0e({target:"URL",stat:!0,forced:!n0e},{parse:function(n){var i=t0e(arguments.length,1),s=dH(n),o=i<2||arguments[1]===void 0?void 0:dH(arguments[1]);try{return new r0e(s,o)}catch{return null}}});var Z1=l(ds.URL);let uH=!0,hH=!0;function ek(n,i,s){const o=n.match(i);return o&&o.length>=s&&parseInt(o[s],10)}function ry(n,i,s){if(!n.RTCPeerConnection)return;const o=n.RTCPeerConnection.prototype,d=o.addEventListener;o.addEventListener=function(f,g){if(f!==i)return d.apply(this,arguments);const y=x=>{const b=s(x);b&&(g.handleEvent?g.handleEvent(b):g(b))};return this._eventMap=this._eventMap||{},this._eventMap[i]||(this._eventMap[i]=new Map),this._eventMap[i].set(g,y),d.apply(this,[f,y])};const h=o.removeEventListener;o.removeEventListener=function(f,g){if(f!==i||!this._eventMap||!this._eventMap[i])return h.apply(this,arguments);if(!this._eventMap[i].has(g))return h.apply(this,arguments);const y=this._eventMap[i].get(g);return this._eventMap[i].delete(g),this._eventMap[i].size===0&&delete this._eventMap[i],Object.keys(this._eventMap).length===0&&delete this._eventMap,h.apply(this,[f,y])},Object.defineProperty(o,"on"+i,{get(){return this["_on"+i]},set(f){this["_on"+i]&&(this.removeEventListener(i,this["_on"+i]),delete this["_on"+i]),f&&this.addEventListener(i,this["_on"+i]=f)},enumerable:!0,configurable:!0})}function i0e(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(uH=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function s0e(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(hH=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function pH(){if(typeof window=="object"){if(uH)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function DU(n,i){hH&&console.warn(n+" is deprecated, please use "+i+" instead.")}function fH(n){return Object.prototype.toString.call(n)==="[object Object]"}function mH(n){var i;return fH(n)?lc(i=Object.keys(n)).call(i,function(s,o){const d=fH(n[o]),h=d?mH(n[o]):n[o],f=d&&!Object.keys(h).length;return h===void 0||f?s:Object.assign(s,{[o]:h})},{}):n}function OU(n,i,s){i&&!s.has(i.id)&&(s.set(i.id,i),Object.keys(i).forEach(o=>{o.endsWith("Id")?OU(n,n.get(i[o]),s):o.endsWith("Ids")&&i[o].forEach(d=>{OU(n,n.get(d),s)})}))}function gH(n,i,s){const o=s?"outbound-rtp":"inbound-rtp",d=new Map;if(i===null)return d;const h=[];return n.forEach(f=>{f.type==="track"&&f.trackIdentifier===i.id&&h.push(f)}),h.forEach(f=>{n.forEach(g=>{g.type===o&&g.trackId===f.id&&OU(n,g,d)})}),d}const _H=pH;function yH(n,i){const s=n&&n.navigator;if(!s.mediaDevices)return;const o=function(f){if(typeof f!="object"||f.mandatory||f.optional)return f;const g={};return Object.keys(f).forEach(y=>{if(y==="require"||y==="advanced"||y==="mediaSource")return;const x=typeof f[y]=="object"?f[y]:{ideal:f[y]};x.exact!==void 0&&typeof x.exact=="number"&&(x.min=x.max=x.exact);const b=function(N,I){return N?N+I.charAt(0).toUpperCase()+I.slice(1):I==="deviceId"?"sourceId":I};if(x.ideal!==void 0){g.optional=g.optional||[];let N={};typeof x.ideal=="number"?(N[b("min",y)]=x.ideal,g.optional.push(N),N={},N[b("max",y)]=x.ideal,g.optional.push(N)):(N[b("",y)]=x.ideal,g.optional.push(N))}x.exact!==void 0&&typeof x.exact!="number"?(g.mandatory=g.mandatory||{},g.mandatory[b("",y)]=x.exact):["min","max"].forEach(N=>{x[N]!==void 0&&(g.mandatory=g.mandatory||{},g.mandatory[b(N,y)]=x[N])})}),f.advanced&&(g.optional=(g.optional||[]).concat(f.advanced)),g},d=function(f,g){if(i.version>=61)return g(f);if((f=JSON.parse(JSON.stringify(f)))&&typeof f.audio=="object"){const y=function(x,b,N){b in x&&!(N in x)&&(x[N]=x[b],delete x[b])};y((f=JSON.parse(JSON.stringify(f))).audio,"autoGainControl","googAutoGainControl"),y(f.audio,"noiseSuppression","googNoiseSuppression"),f.audio=o(f.audio)}if(f&&typeof f.video=="object"){let y=f.video.facingMode;y=y&&(typeof y=="object"?y:{ideal:y});const x=i.version<66;if(y&&(y.exact==="user"||y.exact==="environment"||y.ideal==="user"||y.ideal==="environment")&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||x)){let b;if(delete f.video.facingMode,y.exact==="environment"||y.ideal==="environment"?b=["back","rear"]:y.exact!=="user"&&y.ideal!=="user"||(b=["front"]),b)return s.mediaDevices.enumerateDevices().then(N=>{N=N.filter(D=>D.kind==="videoinput");let I=N.find(D=>b.some($=>{var z;return Ge(z=D.label.toLowerCase()).call(z,$)}));return!I&&N.length&&Ge(b).call(b,"back")&&(I=N[N.length-1]),I&&(f.video.deviceId=y.exact?{exact:I.deviceId}:{ideal:I.deviceId}),f.video=o(f.video),_H("chrome: "+JSON.stringify(f)),g(f)})}f.video=o(f.video)}return _H("chrome: "+JSON.stringify(f)),g(f)},h=function(f){return i.version>=64?f:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[f.name]||f.name,message:f.message,constraint:f.constraint||f.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(s.getUserMedia=(function(f,g,y){d(f,x=>{s.webkitGetUserMedia(x,g,b=>{y&&y(h(b))})})}).bind(s),s.mediaDevices.getUserMedia){const f=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(g){return d(g,y=>f(y).then(x=>{if(y.audio&&!x.getAudioTracks().length||y.video&&!x.getVideoTracks().length)throw x.getTracks().forEach(b=>{b.stop()}),new DOMException("","NotFoundError");return x},x=>et.reject(h(x))))}}}function vH(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function EH(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});const i=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",o=>{let d;d=n.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(f=>f.track&&f.track.id===o.track.id):{track:o.track};const h=new Event("track");h.track=o.track,h.receiver=d,h.transceiver={receiver:d},h.streams=[s.stream],this.dispatchEvent(h)}),s.stream.getTracks().forEach(o=>{let d;d=n.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(f=>f.track&&f.track.id===o.id):{track:o};const h=new Event("track");h.track=o,h.receiver=d,h.transceiver={receiver:d},h.streams=[s.stream],this.dispatchEvent(h)})},this.addEventListener("addstream",this._ontrackpoly)),i.apply(this,arguments)}}else ry(n,"track",i=>(i.transceiver||Object.defineProperty(i,"transceiver",{value:{receiver:i.receiver}}),i))}function xH(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const i=function(d,h){return{track:h,get dtmf(){return this._dtmf===void 0&&(h.kind==="audio"?this._dtmf=d.createDTMFSender(h):this._dtmf=null),this._dtmf},_pc:d}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const d=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(f,g){let y=d.apply(this,arguments);return y||(y=i(this,f),this._senders.push(y)),y};const h=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(f){h.apply(this,arguments);const g=this._senders.indexOf(f);g!==-1&&this._senders.splice(g,1)}}const s=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(d){this._senders=this._senders||[],s.apply(this,[d]),d.getTracks().forEach(h=>{this._senders.push(i(this,h))})};const o=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(d){this._senders=this._senders||[],o.apply(this,[d]),d.getTracks().forEach(h=>{const f=this._senders.find(g=>g.track===h);f&&this._senders.splice(this._senders.indexOf(f),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const i=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const s=i.apply(this,[]);return s.forEach(o=>o._pc=this),s},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function bH(n){if(!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[s,o,d]=arguments;if(arguments.length>0&&typeof s=="function")return i.apply(this,arguments);if(i.length===0&&(arguments.length===0||typeof s!="function"))return i.apply(this,[]);const h=function(g){const y={};return g.result().forEach(x=>{const b={id:x.id,timestamp:x.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[x.type]||x.type};x.names().forEach(N=>{b[N]=x.stat(N)}),y[b.id]=b}),y},f=function(g){return new Map(Object.keys(g).map(y=>[y,g[y]]))};if(arguments.length>=2){const g=function(y){o(f(h(y)))};return i.apply(this,[g,s])}return new et((g,y)=>{i.apply(this,[function(x){g(f(h(x)))},y])}).then(o,d)}}function wH(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const s=n.RTCPeerConnection.prototype.getSenders;s&&(n.RTCPeerConnection.prototype.getSenders=function(){const d=s.apply(this,[]);return d.forEach(h=>h._pc=this),d});const o=n.RTCPeerConnection.prototype.addTrack;o&&(n.RTCPeerConnection.prototype.addTrack=function(){const d=o.apply(this,arguments);return d._pc=this,d}),n.RTCRtpSender.prototype.getStats=function(){const d=this;return this._pc.getStats().then(h=>gH(h,d.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const s=n.RTCPeerConnection.prototype.getReceivers;s&&(n.RTCPeerConnection.prototype.getReceivers=function(){const o=s.apply(this,[]);return o.forEach(d=>d._pc=this),o}),ry(n,"track",o=>(o.receiver._pc=o.srcElement,o)),n.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(d=>gH(d,o.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype)||!("getStats"in n.RTCRtpReceiver.prototype))return;const i=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const s=arguments[0];let o,d,h;return this.getSenders().forEach(f=>{f.track===s&&(o?h=!0:o=f)}),this.getReceivers().forEach(f=>(f.track===s&&(d?h=!0:d=f),f.track===s)),h||o&&d?et.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():d?d.getStats():et.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}function SH(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(h=>this._shimmedLocalStreams[h][0])};const i=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(h,f){if(!f)return i.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const g=i.apply(this,arguments);return this._shimmedLocalStreams[f.id]?this._shimmedLocalStreams[f.id].indexOf(g)===-1&&this._shimmedLocalStreams[f.id].push(g):this._shimmedLocalStreams[f.id]=[f,g],g};const s=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(h){this._shimmedLocalStreams=this._shimmedLocalStreams||{},h.getTracks().forEach(y=>{if(this.getSenders().find(b=>b.track===y))throw new DOMException("Track already exists.","InvalidAccessError")});const f=this.getSenders();s.apply(this,arguments);const g=this.getSenders().filter(y=>f.indexOf(y)===-1);this._shimmedLocalStreams[h.id]=[h].concat(g)};const o=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(h){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[h.id],o.apply(this,arguments)};const d=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(h){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},h&&Object.keys(this._shimmedLocalStreams).forEach(f=>{const g=this._shimmedLocalStreams[f].indexOf(h);g!==-1&&this._shimmedLocalStreams[f].splice(g,1),this._shimmedLocalStreams[f].length===1&&delete this._shimmedLocalStreams[f]}),d.apply(this,arguments)}}function TH(n,i){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&i.version>=65)return SH(n);const s=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const y=s.apply(this);return this._reverseStreams=this._reverseStreams||{},y.map(x=>this._reverseStreams[x.id])};const o=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(y){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},y.getTracks().forEach(x=>{if(this.getSenders().find(N=>N.track===x))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[y.id]){const x=new n.MediaStream(y.getTracks());this._streams[y.id]=x,this._reverseStreams[x.id]=y,y=x}o.apply(this,[y])};const d=n.RTCPeerConnection.prototype.removeStream;function h(y,x){let b=x.sdp;return Object.keys(y._reverseStreams||[]).forEach(N=>{const I=y._reverseStreams[N],D=y._streams[I.id];b=b.replace(new RegExp(D.id,"g"),I.id)}),new RTCSessionDescription({type:x.type,sdp:b})}n.RTCPeerConnection.prototype.removeStream=function(y){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.apply(this,[this._streams[y.id]||y]),delete this._reverseStreams[this._streams[y.id]?this._streams[y.id].id:y.id],delete this._streams[y.id]},n.RTCPeerConnection.prototype.addTrack=function(y,x){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const b=[].slice.call(arguments,1);if(b.length!==1||!b[0].getTracks().find(D=>D===y))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(D=>D.track===y))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const I=this._streams[x.id];if(I)I.addTrack(y),et.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const D=new n.MediaStream([y]);this._streams[x.id]=D,this._reverseStreams[D.id]=x,this.addStream(D)}return this.getSenders().find(D=>D.track===y)},["createOffer","createAnswer"].forEach(function(y){const x=n.RTCPeerConnection.prototype[y],b={[y](){const N=arguments;return arguments.length&&typeof arguments[0]=="function"?x.apply(this,[I=>{const D=h(this,I);N[0].apply(null,[D])},I=>{N[1]&&N[1].apply(null,I)},arguments[2]]):x.apply(this,arguments).then(I=>h(this,I))}};n.RTCPeerConnection.prototype[y]=b[y]});const f=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(y,x){let b=x.sdp;return Object.keys(y._reverseStreams||[]).forEach(N=>{const I=y._reverseStreams[N],D=y._streams[I.id];b=b.replace(new RegExp(I.id,"g"),D.id)}),new RTCSessionDescription({type:x.type,sdp:b})}(this,arguments[0]),f.apply(this,arguments)):f.apply(this,arguments)};const g=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const y=g.get.apply(this);return y.type===""?y:h(this,y)}}),n.RTCPeerConnection.prototype.removeTrack=function(y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!y._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(y._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let x;this._streams=this._streams||{},Object.keys(this._streams).forEach(b=>{this._streams[b].getTracks().find(N=>y.track===N)&&(x=this._streams[b])}),x&&(x.getTracks().length===1?this.removeStream(this._reverseStreams[x.id]):x.removeTrack(y.track),this.dispatchEvent(new Event("negotiationneeded")))}}function LU(n,i){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const o=n.RTCPeerConnection.prototype[s],d={[s](){return arguments[0]=new(s==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};n.RTCPeerConnection.prototype[s]=d[s]})}function RH(n,i){ry(n,"negotiationneeded",s=>{const o=s.target;if(!(i.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")||o.signalingState==="stable")return s})}var CH=Object.freeze({__proto__:null,fixNegotiationNeeded:RH,shimAddTrackRemoveTrack:TH,shimAddTrackRemoveTrackWithNative:SH,shimGetDisplayMedia:function(n,i){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(typeof i=="function"?n.navigator.mediaDevices.getDisplayMedia=function(s){return i(s).then(o=>{const d=s.video&&s.video.width,h=s.video&&s.video.height,f=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:f||3}},d&&(s.video.mandatory.maxWidth=d),h&&(s.video.mandatory.maxHeight=h),n.navigator.mediaDevices.getUserMedia(s)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:xH,shimGetStats:bH,shimGetUserMedia:yH,shimMediaStream:vH,shimOnTrack:EH,shimPeerConnection:LU,shimSenderReceiverGetStats:wH});function NH(n,i){const s=n&&n.navigator,o=n&&n.MediaStreamTrack;if(s.getUserMedia=function(d,h,f){DU("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(d).then(h,f)},!(i.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){const d=function(f,g,y){g in f&&!(y in f)&&(f[y]=f[g],delete f[g])},h=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(f){return typeof f=="object"&&typeof f.audio=="object"&&(f=JSON.parse(JSON.stringify(f)),d(f.audio,"autoGainControl","mozAutoGainControl"),d(f.audio,"noiseSuppression","mozNoiseSuppression")),h(f)},o&&o.prototype.getSettings){const f=o.prototype.getSettings;o.prototype.getSettings=function(){const g=f.apply(this,arguments);return d(g,"mozAutoGainControl","autoGainControl"),d(g,"mozNoiseSuppression","noiseSuppression"),g}}if(o&&o.prototype.applyConstraints){const f=o.prototype.applyConstraints;o.prototype.applyConstraints=function(g){return this.kind==="audio"&&typeof g=="object"&&(g=JSON.parse(JSON.stringify(g)),d(g,"autoGainControl","mozAutoGainControl"),d(g,"noiseSuppression","mozNoiseSuppression")),f.apply(this,[g])}}}}function IH(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function jU(n,i){if(typeof n!="object"||!n.RTCPeerConnection&&!n.mozRTCPeerConnection)return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(d){const h=n.RTCPeerConnection.prototype[d],f={[d](){return arguments[0]=new(d==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),h.apply(this,arguments)}};n.RTCPeerConnection.prototype[d]=f[d]});const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[d,h,f]=arguments;return o.apply(this,[d||null]).then(g=>{if(i.version<53&&!h)try{g.forEach(y=>{y.type=s[y.type]||y.type})}catch(y){if(y.name!=="TypeError")throw y;g.forEach((x,b)=>{g.set(b,Object.assign({},x,{type:s[x.type]||x.type}))})}return g}).then(h,f)}}function AH(n){if(typeof n!="object"||!n.RTCPeerConnection||!n.RTCRtpSender||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const i=n.RTCPeerConnection.prototype.getSenders;i&&(n.RTCPeerConnection.prototype.getSenders=function(){const o=i.apply(this,[]);return o.forEach(d=>d._pc=this),o});const s=n.RTCPeerConnection.prototype.addTrack;s&&(n.RTCPeerConnection.prototype.addTrack=function(){const o=s.apply(this,arguments);return o._pc=this,o}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):et.resolve(new Map)}}function kH(n){if(typeof n!="object"||!n.RTCPeerConnection||!n.RTCRtpSender||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const i=n.RTCPeerConnection.prototype.getReceivers;i&&(n.RTCPeerConnection.prototype.getReceivers=function(){const s=i.apply(this,[]);return s.forEach(o=>o._pc=this),s}),ry(n,"track",s=>(s.receiver._pc=s.srcElement,s)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function PH(n){n.RTCPeerConnection&&!("removeStream"in n.RTCPeerConnection.prototype)&&(n.RTCPeerConnection.prototype.removeStream=function(i){DU("removeStream","removeTrack"),this.getSenders().forEach(s=>{var o;s.track&&Ge(o=i.getTracks()).call(o,s.track)&&this.removeTrack(s)})})}function DH(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function OH(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype.addTransceiver;i&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const o=s.length>0;o&&s.forEach(h=>{if("rid"in h&&!/^[a-z0-9]{0,16}$/i.test(h.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in h&&!(parseFloat(h.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in h&&!(parseFloat(h.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const d=i.apply(this,arguments);if(o){const{sender:h}=d,f=h.getParameters();(!("encodings"in f)||f.encodings.length===1&&Object.keys(f.encodings[0]).length===0)&&(f.encodings=s,h.sendEncodings=s,this.setParametersPromises.push(h.setParameters(f).then(()=>{delete h.sendEncodings}).catch(()=>{delete h.sendEncodings})))}return d})}function LH(n){if(typeof n!="object"||!n.RTCRtpSender)return;const i=n.RTCRtpSender.prototype.getParameters;i&&(n.RTCRtpSender.prototype.getParameters=function(){const s=i.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function jH(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?et.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}function MH(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?et.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}var UH=Object.freeze({__proto__:null,shimAddTransceiver:OH,shimCreateAnswer:MH,shimCreateOffer:jH,shimGetDisplayMedia:function(n,i){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(s){if(!s||!s.video){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,et.reject(o)}return s.video===!0?s.video={mediaSource:i}:s.video.mediaSource=i,n.navigator.mediaDevices.getUserMedia(s)})},shimGetParameters:LH,shimGetUserMedia:NH,shimOnTrack:IH,shimPeerConnection:jU,shimRTCDataChannel:DH,shimReceiverGetStats:kH,shimRemoveStream:PH,shimSenderGetStats:AH});function VH(n){if(typeof n=="object"&&n.RTCPeerConnection){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const i=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(s){var o;this._localStreams||(this._localStreams=[]),Ge(o=this._localStreams).call(o,s)||this._localStreams.push(s),s.getAudioTracks().forEach(d=>i.call(this,d,s)),s.getVideoTracks().forEach(d=>i.call(this,d,s))},n.RTCPeerConnection.prototype.addTrack=function(s){for(var o=arguments.length,d=new Array(o>1?o-1:0),h=1;h<o;h++)d[h-1]=arguments[h];return d&&d.forEach(f=>{var g;this._localStreams?Ge(g=this._localStreams).call(g,f)||this._localStreams.push(f):this._localStreams=[f]}),i.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(i){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(i);if(s===-1)return;this._localStreams.splice(s,1);const o=i.getTracks();this.getSenders().forEach(d=>{Ge(o).call(o,d.track)&&this.removeTrack(d)})})}}function FH(n){if(typeof n=="object"&&n.RTCPeerConnection&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(d=>{var h;if(this._remoteStreams||(this._remoteStreams=[]),Ge(h=this._remoteStreams).call(h,d))return;this._remoteStreams.push(d);const f=new Event("addstream");f.stream=d,this.dispatchEvent(f)})})}});const i=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(d=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(d)>=0)return;s._remoteStreams.push(d);const h=new Event("addstream");h.stream=d,s.dispatchEvent(h)})}),i.apply(s,arguments)}}}function BH(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype,s=i.createOffer,o=i.createAnswer,d=i.setLocalDescription,h=i.setRemoteDescription,f=i.addIceCandidate;i.createOffer=function(y,x){const b=arguments.length>=2?arguments[2]:arguments[0],N=s.apply(this,[b]);return x?(N.then(y,x),et.resolve()):N},i.createAnswer=function(y,x){const b=arguments.length>=2?arguments[2]:arguments[0],N=o.apply(this,[b]);return x?(N.then(y,x),et.resolve()):N};let g=function(y,x,b){const N=d.apply(this,[y]);return b?(N.then(x,b),et.resolve()):N};i.setLocalDescription=g,g=function(y,x,b){const N=h.apply(this,[y]);return b?(N.then(x,b),et.resolve()):N},i.setRemoteDescription=g,g=function(y,x,b){const N=f.apply(this,[y]);return b?(N.then(x,b),et.resolve()):N},i.addIceCandidate=g}function zH(n){const i=n&&n.navigator;if(i.mediaDevices&&i.mediaDevices.getUserMedia){const s=i.mediaDevices,o=s.getUserMedia.bind(s);i.mediaDevices.getUserMedia=d=>o(GH(d))}!i.getUserMedia&&i.mediaDevices&&i.mediaDevices.getUserMedia&&(i.getUserMedia=(function(s,o,d){i.mediaDevices.getUserMedia(s).then(o,d)}).bind(i))}function GH(n){return n&&n.video!==void 0?Object.assign({},n,{video:mH(n.video)}):n}function WH(n){if(!n.RTCPeerConnection)return;const i=n.RTCPeerConnection;n.RTCPeerConnection=function(s,o){if(s&&s.iceServers){const d=[];for(let h=0;h<s.iceServers.length;h++){let f=s.iceServers[h];!f.hasOwnProperty("urls")&&f.hasOwnProperty("url")?(DU("RTCIceServer.url","RTCIceServer.urls"),f=JSON.parse(JSON.stringify(f)),f.urls=f.url,delete f.url,d.push(f)):d.push(s.iceServers[h])}s.iceServers=d}return new i(s,o)},n.RTCPeerConnection.prototype=i.prototype,"generateCertificate"in i&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:()=>i.generateCertificate})}function HH(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function KH(n){const i=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(s){if(s){s.offerToReceiveAudio!==void 0&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const o=this.getTransceivers().find(h=>h.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):s.offerToReceiveAudio!==!0||o||this.addTransceiver("audio",{direction:"recvonly"}),s.offerToReceiveVideo!==void 0&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const d=this.getTransceivers().find(h=>h.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&d?d.direction==="sendrecv"?d.setDirection?d.setDirection("sendonly"):d.direction="sendonly":d.direction==="recvonly"&&(d.setDirection?d.setDirection("inactive"):d.direction="inactive"):s.offerToReceiveVideo!==!0||d||this.addTransceiver("video",{direction:"recvonly"})}return i.apply(this,arguments)}}function qH(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}var YH=Object.freeze({__proto__:null,shimAudioContext:qH,shimCallbacksAPI:BH,shimConstraints:GH,shimCreateOfferLegacy:KH,shimGetUserMedia:zH,shimLocalStreamsAPI:VH,shimRTCIceServerUrls:WH,shimRemoteStreamsAPI:FH,shimTrackEventTransceiver:HH}),$H=`	
\v\f\r \u2028\u2029\uFEFF`,a0e=nn,o0e=zs,MU=$H,XH=C("".replace),c0e=RegExp("^["+MU+"]+"),l0e=RegExp("(^|[^"+MU+"])["+MU+"]+$"),d0e=function(n){return function(i){var s=o0e(a0e(i));return 1&n&&(s=XH(s,c0e,"")),2&n&&(s=XH(s,l0e,"$1")),s}},u0e={trim:d0e(3)},h0e=AS.PROPER,p0e=u,JH=$H,f0e=u0e.trim;In({target:"String",proto:!0,forced:function(n){return p0e(function(){return!!JH[n]()||""[n]()!==""||h0e&&JH[n].name!==n})}("trim")},{trim:function(){return f0e(this)}});var m0e=Co("String","trim"),g0e=A,_0e=m0e,UU=String.prototype,y0e=function(n){var i=n.trim;return typeof n=="string"||n===UU||g0e(UU,n)&&i===UU.trim?_0e:i},Oo=l(y0e),QH={exports:{}};(function(n){const i={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};i.localCName=i.generateIdentifier(),i.splitLines=function(s){return s.trim().split(`
`).map(o=>o.trim())},i.splitSections=function(s){return s.split(`
m=`).map((o,d)=>(d>0?"m="+o:o).trim()+`\r
`)},i.getDescription=function(s){const o=i.splitSections(s);return o&&o[0]},i.getMediaSections=function(s){const o=i.splitSections(s);return o.shift(),o},i.matchPrefix=function(s,o){return i.splitLines(s).filter(d=>d.indexOf(o)===0)},i.parseCandidate=function(s){let o;o=s.indexOf("a=candidate:")===0?s.substring(12).split(" "):s.substring(10).split(" ");const d={foundation:o[0],component:{1:"rtp",2:"rtcp"}[o[1]]||o[1],protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]};for(let h=8;h<o.length;h+=2)switch(o[h]){case"raddr":d.relatedAddress=o[h+1];break;case"rport":d.relatedPort=parseInt(o[h+1],10);break;case"tcptype":d.tcpType=o[h+1];break;case"ufrag":d.ufrag=o[h+1],d.usernameFragment=o[h+1];break;default:d[o[h]]===void 0&&(d[o[h]]=o[h+1])}return d},i.writeCandidate=function(s){const o=[];o.push(s.foundation);const d=s.component;d==="rtp"?o.push(1):d==="rtcp"?o.push(2):o.push(d),o.push(s.protocol.toUpperCase()),o.push(s.priority),o.push(s.address||s.ip),o.push(s.port);const h=s.type;return o.push("typ"),o.push(h),h!=="host"&&s.relatedAddress&&s.relatedPort&&(o.push("raddr"),o.push(s.relatedAddress),o.push("rport"),o.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(o.push("ufrag"),o.push(s.usernameFragment||s.ufrag)),"candidate:"+o.join(" ")},i.parseIceOptions=function(s){return s.substring(14).split(" ")},i.parseRtpMap=function(s){let o=s.substring(9).split(" ");const d={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),d.name=o[0],d.clockRate=parseInt(o[1],10),d.channels=o.length===3?parseInt(o[2],10):1,d.numChannels=d.channels,d},i.writeRtpMap=function(s){let o=s.payloadType;s.preferredPayloadType!==void 0&&(o=s.preferredPayloadType);const d=s.channels||s.numChannels||1;return"a=rtpmap:"+o+" "+s.name+"/"+s.clockRate+(d!==1?"/"+d:"")+`\r
`},i.parseExtmap=function(s){const o=s.substring(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1],attributes:o.slice(2).join(" ")}},i.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+(s.attributes?" "+s.attributes:"")+`\r
`},i.parseFmtp=function(s){const o={};let d;const h=s.substring(s.indexOf(" ")+1).split(";");for(let f=0;f<h.length;f++)d=h[f].trim().split("="),o[d[0].trim()]=d[1];return o},i.writeFmtp=function(s){let o="",d=s.payloadType;if(s.preferredPayloadType!==void 0&&(d=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){const h=[];Object.keys(s.parameters).forEach(f=>{s.parameters[f]!==void 0?h.push(f+"="+s.parameters[f]):h.push(f)}),o+="a=fmtp:"+d+" "+h.join(";")+`\r
`}return o},i.parseRtcpFb=function(s){const o=s.substring(s.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},i.writeRtcpFb=function(s){let o="",d=s.payloadType;return s.preferredPayloadType!==void 0&&(d=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach(h=>{o+="a=rtcp-fb:"+d+" "+h.type+(h.parameter&&h.parameter.length?" "+h.parameter:"")+`\r
`}),o},i.parseSsrcMedia=function(s){const o=s.indexOf(" "),d={ssrc:parseInt(s.substring(7,o),10)},h=s.indexOf(":",o);return h>-1?(d.attribute=s.substring(o+1,h),d.value=s.substring(h+1)):d.attribute=s.substring(o+1),d},i.parseSsrcGroup=function(s){const o=s.substring(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(d=>parseInt(d,10))}},i.getMid=function(s){const o=i.matchPrefix(s,"a=mid:")[0];if(o)return o.substring(6)},i.parseFingerprint=function(s){const o=s.substring(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1].toUpperCase()}},i.getDtlsParameters=function(s,o){return{role:"auto",fingerprints:i.matchPrefix(s+o,"a=fingerprint:").map(i.parseFingerprint)}},i.writeDtlsParameters=function(s,o){let d="a=setup:"+o+`\r
`;return s.fingerprints.forEach(h=>{d+="a=fingerprint:"+h.algorithm+" "+h.value+`\r
`}),d},i.parseCryptoLine=function(s){const o=s.substring(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},i.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?i.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},i.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;const o=s.substring(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},i.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},i.getCryptoParameters=function(s,o){return i.matchPrefix(s+o,"a=crypto:").map(i.parseCryptoLine)},i.getIceParameters=function(s,o){const d=i.matchPrefix(s+o,"a=ice-ufrag:")[0],h=i.matchPrefix(s+o,"a=ice-pwd:")[0];return d&&h?{usernameFragment:d.substring(12),password:h.substring(10)}:null},i.writeIceParameters=function(s){let o="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(o+=`a=ice-lite\r
`),o},i.parseRtpParameters=function(s){const o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},d=i.splitLines(s)[0].split(" ");o.profile=d[2];for(let f=3;f<d.length;f++){const g=d[f],y=i.matchPrefix(s,"a=rtpmap:"+g+" ")[0];if(y){const x=i.parseRtpMap(y),b=i.matchPrefix(s,"a=fmtp:"+g+" ");switch(x.parameters=b.length?i.parseFmtp(b[0]):{},x.rtcpFeedback=i.matchPrefix(s,"a=rtcp-fb:"+g+" ").map(i.parseRtcpFb),o.codecs.push(x),x.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(x.name.toUpperCase())}}}i.matchPrefix(s,"a=extmap:").forEach(f=>{o.headerExtensions.push(i.parseExtmap(f))});const h=i.matchPrefix(s,"a=rtcp-fb:* ").map(i.parseRtcpFb);return o.codecs.forEach(f=>{h.forEach(g=>{f.rtcpFeedback.find(y=>y.type===g.type&&y.parameter===g.parameter)||f.rtcpFeedback.push(g)})}),o},i.writeRtpDescription=function(s,o){let d="";d+="m="+s+" ",d+=o.codecs.length>0?"9":"0",d+=" "+(o.profile||"UDP/TLS/RTP/SAVPF")+" ",d+=o.codecs.map(f=>f.preferredPayloadType!==void 0?f.preferredPayloadType:f.payloadType).join(" ")+`\r
`,d+=`c=IN IP4 0.0.0.0\r
`,d+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(f=>{d+=i.writeRtpMap(f),d+=i.writeFmtp(f),d+=i.writeRtcpFb(f)});let h=0;return o.codecs.forEach(f=>{f.maxptime>h&&(h=f.maxptime)}),h>0&&(d+="a=maxptime:"+h+`\r
`),o.headerExtensions&&o.headerExtensions.forEach(f=>{d+=i.writeExtmap(f)}),d},i.parseRtpEncodingParameters=function(s){const o=[],d=i.parseRtpParameters(s),h=d.fecMechanisms.indexOf("RED")!==-1,f=d.fecMechanisms.indexOf("ULPFEC")!==-1,g=i.matchPrefix(s,"a=ssrc:").map(I=>i.parseSsrcMedia(I)).filter(I=>I.attribute==="cname"),y=g.length>0&&g[0].ssrc;let x;const b=i.matchPrefix(s,"a=ssrc-group:FID").map(I=>I.substring(17).split(" ").map(D=>parseInt(D,10)));b.length>0&&b[0].length>1&&b[0][0]===y&&(x=b[0][1]),d.codecs.forEach(I=>{if(I.name.toUpperCase()==="RTX"&&I.parameters.apt){let D={ssrc:y,codecPayloadType:parseInt(I.parameters.apt,10)};y&&x&&(D.rtx={ssrc:x}),o.push(D),h&&(D=JSON.parse(JSON.stringify(D)),D.fec={ssrc:y,mechanism:f?"red+ulpfec":"red"},o.push(D))}}),o.length===0&&y&&o.push({ssrc:y});let N=i.matchPrefix(s,"b=");return N.length&&(N=N[0].indexOf("b=TIAS:")===0?parseInt(N[0].substring(7),10):N[0].indexOf("b=AS:")===0?1e3*parseInt(N[0].substring(5),10)*.95-16e3:void 0,o.forEach(I=>{I.maxBitrate=N})),o},i.parseRtcpParameters=function(s){const o={},d=i.matchPrefix(s,"a=ssrc:").map(g=>i.parseSsrcMedia(g)).filter(g=>g.attribute==="cname")[0];d&&(o.cname=d.value,o.ssrc=d.ssrc);const h=i.matchPrefix(s,"a=rtcp-rsize");o.reducedSize=h.length>0,o.compound=h.length===0;const f=i.matchPrefix(s,"a=rtcp-mux");return o.mux=f.length>0,o},i.writeRtcpParameters=function(s){let o="";return s.reducedSize&&(o+=`a=rtcp-rsize\r
`),s.mux&&(o+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(o+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),o},i.parseMsid=function(s){let o;const d=i.matchPrefix(s,"a=msid:");if(d.length===1)return o=d[0].substring(7).split(" "),{stream:o[0],track:o[1]};const h=i.matchPrefix(s,"a=ssrc:").map(f=>i.parseSsrcMedia(f)).filter(f=>f.attribute==="msid");return h.length>0?(o=h[0].value.split(" "),{stream:o[0],track:o[1]}):void 0},i.parseSctpDescription=function(s){const o=i.parseMLine(s),d=i.matchPrefix(s,"a=max-message-size:");let h;d.length>0&&(h=parseInt(d[0].substring(19),10)),isNaN(h)&&(h=65536);const f=i.matchPrefix(s,"a=sctp-port:");if(f.length>0)return{port:parseInt(f[0].substring(12),10),protocol:o.fmt,maxMessageSize:h};const g=i.matchPrefix(s,"a=sctpmap:");if(g.length>0){const y=g[0].substring(10).split(" ");return{port:parseInt(y[0],10),protocol:y[1],maxMessageSize:h}}},i.writeSctpDescription=function(s,o){let d=[];return d=s.protocol!=="DTLS/SCTP"?["m="+s.kind+" 9 "+s.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:["m="+s.kind+" 9 "+s.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&d.push("a=max-message-size:"+o.maxMessageSize+`\r
`),d.join("")},i.generateSessionId=function(){return Math.random().toString().substr(2,22)},i.writeSessionBoilerplate=function(s,o,d){let h;const f=o!==void 0?o:2;return h=s||i.generateSessionId(),`v=0\r
o=`+(d||"thisisadapterortc")+" "+h+" "+f+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},i.getDirection=function(s,o){const d=i.splitLines(s);for(let h=0;h<d.length;h++)switch(d[h]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return d[h].substring(2)}return o?i.getDirection(o):"sendrecv"},i.getKind=function(s){return i.splitLines(s)[0].split(" ")[0].substring(2)},i.isRejected=function(s){return s.split(" ",2)[1]==="0"},i.parseMLine=function(s){const o=i.splitLines(s)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},i.parseOLine=function(s){const o=i.matchPrefix(s,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},i.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;const o=i.splitLines(s);for(let d=0;d<o.length;d++)if(o[d].length<2||o[d].charAt(1)!=="=")return!1;return!0},n.exports=i})(QH);var ZH=QH.exports,nx=l(ZH),v0e=r({__proto__:null,default:nx},[ZH]);function tk(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const i=n.RTCIceCandidate;n.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&((s=JSON.parse(JSON.stringify(s))).candidate=s.candidate.substr(2)),s.candidate&&s.candidate.length){const o=new i(s),d=nx.parseCandidate(s.candidate),h=Object.assign(o,d);return h.toJSON=function(){return{candidate:h.candidate,sdpMid:h.sdpMid,sdpMLineIndex:h.sdpMLineIndex,usernameFragment:h.usernameFragment}},h}return new i(s)},n.RTCIceCandidate.prototype=i.prototype,ry(n,"icecandidate",s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new n.RTCIceCandidate(s.candidate),writable:"false"}),s))}function VU(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||ry(n,"icecandidate",i=>{if(i.candidate){const s=nx.parseCandidate(i.candidate.candidate);s.type==="relay"&&(i.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return i})}function nk(n,i){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const s=function(g){if(!g||!g.sdp)return!1;const y=nx.splitSections(g.sdp);return y.shift(),y.some(x=>{const b=nx.parseMLine(x);return b&&b.kind==="application"&&b.protocol.indexOf("SCTP")!==-1})},o=function(g){const y=g.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(y===null||y.length<2)return-1;const x=parseInt(y[1],10);return x!=x?-1:x},d=function(g){let y=65536;return i.browser==="firefox"&&(y=i.version<57?g===-1?16384:2147483637:i.version<60?i.version===57?65535:65536:2147483637),y},h=function(g,y){let x=65536;i.browser==="firefox"&&i.version===57&&(x=65535);const b=nx.matchPrefix(g.sdp,"a=max-message-size:");return b.length>0?x=parseInt(b[0].substr(19),10):i.browser==="firefox"&&y!==-1&&(x=2147483637),x},f=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,i.browser==="chrome"&&i.version>=76){const{sdpSemantics:g}=this.getConfiguration();g==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){const g=o(arguments[0]),y=d(g),x=h(arguments[0],g);let b;b=y===0&&x===0?Number.POSITIVE_INFINITY:y===0||x===0?Math.max(y,x):Math.min(y,x);const N={};Object.defineProperty(N,"maxMessageSize",{get:()=>b}),this._sctp=N}return f.apply(this,arguments)}}function rk(n){if(!n.RTCPeerConnection||!("createDataChannel"in n.RTCPeerConnection.prototype))return;function i(o,d){const h=o.send;o.send=function(){const f=arguments[0],g=f.length||f.size||f.byteLength;if(o.readyState==="open"&&d.sctp&&g>d.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+d.sctp.maxMessageSize+" bytes)");return h.apply(o,arguments)}}const s=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const o=s.apply(this,arguments);return i(o,this),o},ry(n,"datachannel",o=>(i(o.channel,o.target),o))}function FU(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const i=n.RTCPeerConnection.prototype;Object.defineProperty(i,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(i,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(s=>{const o=i[s];i[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=d=>{const h=d.target;if(h._lastConnectionState!==h.connectionState){h._lastConnectionState=h.connectionState;const f=new Event("connectionstatechange",d);h.dispatchEvent(f)}return d},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function BU(n,i){if(!n.RTCPeerConnection||i.browser==="chrome"&&i.version>=71||i.browser==="safari"&&i.version>=605)return;const s=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const d=o.sdp.split(`
`).filter(h=>Oo(h).call(h)!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&o instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:o.type,sdp:d}):o.sdp=d}return s.apply(this,arguments)}}function ik(n,i){if(!n.RTCPeerConnection||!n.RTCPeerConnection.prototype)return;const s=n.RTCPeerConnection.prototype.addIceCandidate;s&&s.length!==0&&(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(i.browser==="chrome"&&i.version<78||i.browser==="firefox"&&i.version<68||i.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?et.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),et.resolve())})}function sk(n,i){if(!n.RTCPeerConnection||!n.RTCPeerConnection.prototype)return;const s=n.RTCPeerConnection.prototype.setLocalDescription;s&&s.length!==0&&(n.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return s.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer"}return o.sdp||o.type!=="offer"&&o.type!=="answer"?s.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(d=>s.apply(this,[d]))})}var E0e=Object.freeze({__proto__:null,removeExtmapAllowMixed:BU,shimAddIceCandidateNullOrEmpty:ik,shimConnectionState:FU,shimMaxMessageSize:nk,shimParameterlessSetLocalDescription:sk,shimRTCIceCandidate:tk,shimRTCIceCandidateRelayProtocol:VU,shimSendThrowTypeError:rk});(function(){let{window:n}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const s=pH,o=function(h){const f={browser:null,version:null};if(h===void 0||!h.navigator)return f.browser="Not a browser.",f;const{navigator:g}=h;if(g.mozGetUserMedia)f.browser="firefox",f.version=ek(g.userAgent,/Firefox\/(\d+)\./,1);else if(g.webkitGetUserMedia||h.isSecureContext===!1&&h.webkitRTCPeerConnection)f.browser="chrome",f.version=ek(g.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!h.RTCPeerConnection||!g.userAgent.match(/AppleWebKit\/(\d+)\./))return f.browser="Not a supported browser.",f;f.browser="safari",f.version=ek(g.userAgent,/AppleWebKit\/(\d+)\./,1),f.supportsUnifiedPlan=h.RTCRtpTransceiver&&"currentDirection"in h.RTCRtpTransceiver.prototype}return f}(n),d={browserDetails:o,commonShim:E0e,extractVersion:ek,disableLog:i0e,disableWarnings:s0e,sdp:v0e};switch(o.browser){case"chrome":if(!CH||!LU||!i.shimChrome)return s("Chrome shim is not included in this adapter release."),d;if(o.version===null)return s("Chrome shim can not determine version, not shimming."),d;s("adapter.js shimming chrome."),d.browserShim=CH,ik(n,o),sk(n),yH(n,o),vH(n),LU(n,o),EH(n),TH(n,o),xH(n),bH(n),wH(n),RH(n,o),tk(n),VU(n),FU(n),nk(n,o),rk(n),BU(n,o);break;case"firefox":if(!UH||!jU||!i.shimFirefox)return s("Firefox shim is not included in this adapter release."),d;s("adapter.js shimming firefox."),d.browserShim=UH,ik(n,o),sk(n),NH(n,o),jU(n,o),IH(n),PH(n),AH(n),kH(n),DH(n),OH(n),LH(n),jH(n),MH(n),tk(n),FU(n),nk(n,o),rk(n);break;case"safari":if(!YH||!i.shimSafari)return s("Safari shim is not included in this adapter release."),d;s("adapter.js shimming safari."),d.browserShim=YH,ik(n,o),sk(n),WH(n),KH(n),BH(n),VH(n),FH(n),HH(n),zH(n),qH(n),tk(n),VU(n),nk(n,o),rk(n),BU(n,o);break;default:s("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var x0e=u,e7=U.RegExp,b0e=!x0e(function(){var n=!0;try{e7(".","d")}catch{n=!1}var i={},s="",o=n?"dgimsy":"gimsy",d=function(g,y){Object.defineProperty(i,g,{get:function(){return s+=y,!0}})},h={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var f in n&&(h.hasIndices="d"),h)d(f,h[f]);return Object.getOwnPropertyDescriptor(e7.prototype,"flags").get.call(i)!==o||s!==o}),w0e=_i,S0e=lt,T0e=Zi,R0e=A,t7={correct:b0e},C0e=function(){var n=w0e(this),i="";return n.hasIndices&&(i+="d"),n.global&&(i+="g"),n.ignoreCase&&(i+="i"),n.multiline&&(i+="m"),n.dotAll&&(i+="s"),n.unicode&&(i+="u"),n.unicodeSets&&(i+="v"),n.sticky&&(i+="y"),i},N0e=RegExp.prototype,zU=t7.correct?function(n){return n.flags}:function(n){return t7.correct||!R0e(N0e,n)||T0e(n,"flags")?n.flags:S0e(C0e,n)},GU=C,I0e=Math.floor,WU=GU("".charAt),A0e=GU("".replace),HU=GU("".slice),k0e=/\$([$&'`]|\d{1,2})/g,P0e=In,D0e=lt,KU=C,n7=nn,O0e=be,L0e=Jn,j0e=$f,rx=zs,M0e=ec,U0e=zU,V0e=function(n,i,s,o,d,h){var f=s+n.length,g=o.length,y=k0e;return A0e(h,y,function(x,b){var N;switch(WU(b,0)){case"$":return"$";case"&":return n;case"`":return HU(i,0,s);case"'":return HU(i,f);case"<":N=d[HU(b,1,-1)];break;default:var I=+b;if(I===0)return x;if(I>g){var D=I0e(I/10);return D===0?x:D<=g?o[D-1]===void 0?WU(b,1):o[D-1]+WU(b,1):x}N=o[I-1]}return N===void 0?"":N})},F0e=Zt("replace"),B0e=TypeError,qU=KU("".indexOf),z0e=KU("".replace),r7=KU("".slice),G0e=Math.max;P0e({target:"String",proto:!0},{replaceAll:function(n,i){var s,o,d,h,f,g,y,x,b,N,I=n7(this),D=0,$="";if(L0e(n)){if((s=j0e(n))&&(o=rx(n7(U0e(n))),!~qU(o,"g")))throw new B0e("`.replaceAll` does not allow non-global regexes");if(d=M0e(n,F0e))return D0e(d,n,I,i);if(s)return z0e(rx(I),n,i)}for(h=rx(I),f=rx(n),(g=O0e(i))||(i=rx(i)),y=f.length,x=G0e(1,y),b=qU(h,f);b!==-1;)N=g?rx(i(f,b,h)):V0e(f,h,b,[],void 0,i),$+=r7(h,D,b)+N,D=b+y,b=b+x>h.length?-1:qU(h,f,b+x);return D<h.length&&($+=r7(h,D)),$}});var W0e=Co("String","replaceAll"),H0e=A,K0e=W0e,YU=String.prototype,q0e=function(n){var i=n.replaceAll;return typeof n=="string"||n===YU||H0e(YU,n)&&i===YU.replaceAll?K0e:i},Y0e=l(q0e),$U=U;In({global:!0,forced:$U.globalThis!==$U},{globalThis:$U});var i7=l(U),XU={exports:{}};(function(n,i){(function(s,o){var d="function",h="undefined",f="object",g="string",y="major",x="model",b="name",N="type",I="vendor",D="version",$="architecture",z="console",K="mobile",ie="tablet",oe="smarttv",fe="wearable",Ee="embedded",Te="Amazon",_e="Apple",Re="ASUS",je="BlackBerry",Be="Browser",dt="Chrome",Ht="Firefox",Bt="Google",dn="Honor",sn="Huawei",Qn="LG",ei="Microsoft",Ue="Motorola",Qe="Nvidia",ft="OnePlus",Fe="Opera",B="OPPO",ue="Samsung",ve="Sharp",Ye="Sony",Qt="Xiaomi",jr="Zebra",Os="Facebook",Bd="Chromium OS",c_="Mac OS",s2=" Browser",Qx=function(ss){for(var vs={},$r=0;$r<ss.length;$r++)vs[ss[$r].toUpperCase()]=ss[$r];return vs},a2=function(ss,vs){return typeof ss===g&&Fy(vs).indexOf(Fy(ss))!==-1},Fy=function(ss){return ss.toLowerCase()},FR=function(ss,vs){if(typeof ss===g)return ss=ss.replace(/^\s\s*/,""),typeof vs===h?ss:ss.substring(0,500)},By=function(ss,vs){for(var $r,Jc,qh,Vi,vm,Vn,Yh=0;Yh<vs.length&&!vm;){var zy=vs[Yh],ff=vs[Yh+1];for($r=Jc=0;$r<zy.length&&!vm&&zy[$r];)if(vm=zy[$r++].exec(ss))for(qh=0;qh<ff.length;qh++)Vn=vm[++Jc],typeof(Vi=ff[qh])===f&&Vi.length>0?Vi.length===2?typeof Vi[1]==d?this[Vi[0]]=Vi[1].call(this,Vn):this[Vi[0]]=Vi[1]:Vi.length===3?typeof Vi[1]!==d||Vi[1].exec&&Vi[1].test?this[Vi[0]]=Vn?Vn.replace(Vi[1],Vi[2]):o:this[Vi[0]]=Vn?Vi[1].call(this,Vn,Vi[2]):o:Vi.length===4&&(this[Vi[0]]=Vn?Vi[3].call(this,Vn.replace(Vi[1],Vi[2])):o):this[Vi]=Vn||o;Yh+=2}},l_=function(ss,vs){for(var $r in vs)if(typeof vs[$r]===f&&vs[$r].length>0){for(var Jc=0;Jc<vs[$r].length;Jc++)if(a2(vs[$r][Jc],ss))return $r==="?"?o:$r}else if(a2(vs[$r],ss))return $r==="?"?o:$r;return vs.hasOwnProperty("*")?vs["*"]:ss},qee={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Yee={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[D,[b,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[D,[b,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[b,D],[/opios[\/ ]+([\w\.]+)/i],[D,[b,Fe+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[D,[b,Fe+" GX"]],[/\bopr\/([\w\.]+)/i],[D,[b,Fe]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[D,[b,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[D,[b,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[b,D],[/quark(?:pc)?\/([-\w\.]+)/i],[D,[b,"Quark"]],[/\bddg\/([\w\.]+)/i],[D,[b,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[D,[b,"UC"+Be]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[D,[b,"WeChat"]],[/konqueror\/([\w\.]+)/i],[D,[b,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[D,[b,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[D,[b,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[D,[b,"Smart Lenovo "+Be]],[/(avast|avg)\/([\w\.]+)/i],[[b,/(.+)/,"$1 Secure "+Be],D],[/\bfocus\/([\w\.]+)/i],[D,[b,Ht+" Focus"]],[/\bopt\/([\w\.]+)/i],[D,[b,Fe+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[D,[b,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[D,[b,"Dolphin"]],[/coast\/([\w\.]+)/i],[D,[b,Fe+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[D,[b,"MIUI"+s2]],[/fxios\/([\w\.-]+)/i],[D,[b,Ht]],[/\bqihoobrowser\/?([\w\.]*)/i],[D,[b,"360"]],[/\b(qq)\/([\w\.]+)/i],[[b,/(.+)/,"$1Browser"],D],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[b,/(.+)/,"$1"+s2],D],[/samsungbrowser\/([\w\.]+)/i],[D,[b,ue+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[D,[b,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[b,"Sogou Mobile"],D],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[b,D],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[b],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[D,b],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[b,Os],D],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[b,D],[/\bgsa\/([\w\.]+) .*safari\//i],[D,[b,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[D,[b,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[D,[b,dt+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[b,dt+" WebView"],D],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[D,[b,"Android "+Be]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[b,D],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[D,[b,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[D,b],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[b,[D,l_,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[b,D],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[b,"Netscape"],D],[/(wolvic|librewolf)\/([\w\.]+)/i],[b,D],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[D,[b,Ht+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[b,[D,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[b,[D,/master.|lts./,""]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[$,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[$,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[$,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[$,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[$,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[$,/ower/,"",Fy]],[/ sun4\w[;\)]/i],[[$,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[$,Fy]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[x,[I,ue],[N,ie]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[x,[I,ue],[N,K]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[x,[I,_e],[N,K]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[x,[I,_e],[N,ie]],[/(macintosh);/i],[x,[I,_e]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[x,[I,ve],[N,K]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[x,[I,dn],[N,ie]],[/honor([-\w ]+)[;\)]/i],[x,[I,dn],[N,K]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[x,[I,sn],[N,ie]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[x,[I,sn],[N,K]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[x,/_/g," "],[I,Qt],[N,ie]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[x,/_/g," "],[I,Qt],[N,K]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[x,[I,B],[N,K]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[x,[I,l_,{OnePlus:["304","403","203"],"*":B}],[N,ie]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[x,[I,"Vivo"],[N,K]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[x,[I,"Realme"],[N,K]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[x,[I,Ue],[N,K]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[x,[I,Ue],[N,ie]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[x,[I,Qn],[N,ie]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv|watch)\w+)/i,/\blg-?([\d\w]+) bui/i],[x,[I,Qn],[N,K]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[x,[I,"Lenovo"],[N,ie]],[/(nokia) (t[12][01])/i],[I,x,[N,ie]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[x,/_/g," "],[N,K],[I,"Nokia"]],[/(pixel (c|tablet))\b/i],[x,[I,Bt],[N,ie]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[x,[I,Bt],[N,K]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[x,[I,Ye],[N,K]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[x,"Xperia Tablet"],[I,Ye],[N,ie]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[x,[I,ft],[N,K]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[x,[I,Te],[N,ie]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[x,/(.+)/g,"Fire Phone $1"],[I,Te],[N,K]],[/(playbook);[-\w\),; ]+(rim)/i],[x,I,[N,ie]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[x,[I,je],[N,K]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[x,[I,Re],[N,ie]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[x,[I,Re],[N,K]],[/(nexus 9)/i],[x,[I,"HTC"],[N,ie]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[I,[x,/_/g," "],[N,K]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[x,[I,"TCL"],[N,ie]],[/(itel) ((\w+))/i],[[I,Fy],x,[N,l_,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[x,[I,"Acer"],[N,ie]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[x,[I,"Meizu"],[N,K]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[x,[I,"Ulefone"],[N,K]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[x,[I,"Energizer"],[N,K]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[x,[I,"Cat"],[N,K]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[x,[I,"Smartfren"],[N,K]],[/droid.+; (a(?:015|06[35]|142p?))/i],[x,[I,"Nothing"],[N,K]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[x,[I,"Archos"],[N,ie]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[x,[I,"Archos"],[N,K]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[I,x,[N,ie]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (hmd|imo) ([\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[I,x,[N,K]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[I,x,[N,ie]],[/(surface duo)/i],[x,[I,ei],[N,ie]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[x,[I,"Fairphone"],[N,K]],[/(u304aa)/i],[x,[I,"AT&T"],[N,K]],[/\bsie-(\w*)/i],[x,[I,"Siemens"],[N,K]],[/\b(rct\w+) b/i],[x,[I,"RCA"],[N,ie]],[/\b(venue[\d ]{2,7}) b/i],[x,[I,"Dell"],[N,ie]],[/\b(q(?:mv|ta)\w+) b/i],[x,[I,"Verizon"],[N,ie]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[x,[I,"Barnes & Noble"],[N,ie]],[/\b(tm\d{3}\w+) b/i],[x,[I,"NuVision"],[N,ie]],[/\b(k88) b/i],[x,[I,"ZTE"],[N,ie]],[/\b(nx\d{3}j) b/i],[x,[I,"ZTE"],[N,K]],[/\b(gen\d{3}) b.+49h/i],[x,[I,"Swiss"],[N,K]],[/\b(zur\d{3}) b/i],[x,[I,"Swiss"],[N,ie]],[/\b((zeki)?tb.*\b) b/i],[x,[I,"Zeki"],[N,ie]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[I,"Dragon Touch"],x,[N,ie]],[/\b(ns-?\w{0,9}) b/i],[x,[I,"Insignia"],[N,ie]],[/\b((nxa|next)-?\w{0,9}) b/i],[x,[I,"NextBook"],[N,ie]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[I,"Voice"],x,[N,K]],[/\b(lvtel\-)?(v1[12]) b/i],[[I,"LvTel"],x,[N,K]],[/\b(ph-1) /i],[x,[I,"Essential"],[N,K]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[x,[I,"Envizen"],[N,ie]],[/\b(trio[-\w\. ]+) b/i],[x,[I,"MachSpeed"],[N,ie]],[/\btu_(1491) b/i],[x,[I,"Rotor"],[N,ie]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[x,[I,Qe],[N,ie]],[/(sprint) (\w+)/i],[I,x,[N,K]],[/(kin\.[onetw]{3})/i],[[x,/\./g," "],[I,ei],[N,K]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[x,[I,jr],[N,ie]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[x,[I,jr],[N,K]],[/smart-tv.+(samsung)/i],[I,[N,oe]],[/hbbtv.+maple;(\d+)/i],[[x,/^/,"SmartTV"],[I,ue],[N,oe]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[I,Qn],[N,oe]],[/(apple) ?tv/i],[I,[x,_e+" TV"],[N,oe]],[/crkey/i],[[x,dt+"cast"],[I,Bt],[N,oe]],[/droid.+aft(\w+)( bui|\))/i],[x,[I,Te],[N,oe]],[/(shield \w+ tv)/i],[x,[I,Qe],[N,oe]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[x,[I,ve],[N,oe]],[/(bravia[\w ]+)( bui|\))/i],[x,[I,Ye],[N,oe]],[/(mi(tv|box)-?\w+) bui/i],[x,[I,Qt],[N,oe]],[/Hbbtv.*(technisat) (.*);/i],[I,x,[N,oe]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[I,FR],[x,FR],[N,oe]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[x,[N,oe]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[N,oe]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[I,x,[N,z]],[/droid.+; (shield)( bui|\))/i],[x,[I,Qe],[N,z]],[/(playstation \w+)/i],[x,[I,Ye],[N,z]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[x,[I,ei],[N,z]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[x,[I,ue],[N,fe]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[I,x,[N,fe]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[x,[I,B],[N,fe]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[x,[I,_e],[N,fe]],[/(opwwe\d{3})/i],[x,[I,ft],[N,fe]],[/(moto 360)/i],[x,[I,Ue],[N,fe]],[/(smartwatch 3)/i],[x,[I,Ye],[N,fe]],[/(g watch r)/i],[x,[I,Qn],[N,fe]],[/droid.+; (wt63?0{2,3})\)/i],[x,[I,jr],[N,fe]],[/droid.+; (glass) \d/i],[x,[I,Bt],[N,fe]],[/(pico) (4|neo3(?: link|pro)?)/i],[I,x,[N,fe]],[/; (quest( \d| pro)?)/i],[x,[I,Os],[N,fe]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[I,[N,Ee]],[/(aeobc)\b/i],[x,[I,Te],[N,Ee]],[/(homepod).+mac os/i],[x,[I,_e],[N,Ee]],[/windows iot/i],[[N,Ee]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[x,[N,K]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[x,[N,ie]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[N,ie]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[N,K]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[x,[I,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[D,[b,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[b,D],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[D,[b,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[b,D],[/ladybird\//i],[[b,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[D,b]],os:[[/microsoft (windows) (vista|xp)/i],[b,D],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[b,[D,l_,qee]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[D,l_,qee],[b,"Windows"]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[D,/_/g,"."],[b,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[b,c_],[D,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[D,b],[/(ubuntu) ([\w\.]+) like android/i],[[b,/(.+)/,"$1 Touch"],D],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/; ]?([\d\.]*)/i],[b,D],[/\(bb(10);/i],[D,[b,je]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[D,[b,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[D,[b,Ht+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[D,[b,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[D,[b,"watchOS"]],[/crkey\/([\d\.]+)/i],[D,[b,dt+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[b,Bd],D],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[b,D],[/(sunos) ?([\w\.\d]*)/i],[[b,"Solaris"],D],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[b,D]]},Kh=function(ss,vs){if(typeof ss===f&&(vs=ss,ss=o),!(this instanceof Kh))return new Kh(ss,vs).getResult();var $r=typeof s!==h&&s.navigator?s.navigator:o,Jc=ss||($r&&$r.userAgent?$r.userAgent:""),qh=$r&&$r.userAgentData?$r.userAgentData:o,Vi=vs?function(Vn,Yh){var zy={};for(var ff in Vn)Yh[ff]&&Yh[ff].length%2==0?zy[ff]=Yh[ff].concat(Vn[ff]):zy[ff]=Vn[ff];return zy}(Yee,vs):Yee,vm=$r&&$r.userAgent==Jc;return this.getBrowser=function(){var Vn={};return Vn[b]=o,Vn[D]=o,By.call(Vn,Jc,Vi.browser),Vn[y]=function(Yh){return typeof Yh===g?Yh.replace(/[^\d\.]/g,"").split(".")[0]:o}(Vn[D]),vm&&$r&&$r.brave&&typeof $r.brave.isBrave==d&&(Vn[b]="Brave"),Vn},this.getCPU=function(){var Vn={};return Vn[$]=o,By.call(Vn,Jc,Vi.cpu),Vn},this.getDevice=function(){var Vn={};return Vn[I]=o,Vn[x]=o,Vn[N]=o,By.call(Vn,Jc,Vi.device),vm&&!Vn[N]&&qh&&qh.mobile&&(Vn[N]=K),vm&&Vn[x]=="Macintosh"&&$r&&typeof $r.standalone!==h&&$r.maxTouchPoints&&$r.maxTouchPoints>2&&(Vn[x]="iPad",Vn[N]=ie),Vn},this.getEngine=function(){var Vn={};return Vn[b]=o,Vn[D]=o,By.call(Vn,Jc,Vi.engine),Vn},this.getOS=function(){var Vn={};return Vn[b]=o,Vn[D]=o,By.call(Vn,Jc,Vi.os),vm&&!Vn[b]&&qh&&qh.platform&&qh.platform!="Unknown"&&(Vn[b]=qh.platform.replace(/chrome os/i,Bd).replace(/macos/i,c_)),Vn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Jc},this.setUA=function(Vn){return Jc=typeof Vn===g&&Vn.length>500?FR(Vn,500):Vn,this},this.setUA(Jc),this};Kh.VERSION="0.7.41",Kh.BROWSER=Qx([b,D,y]),Kh.CPU=Qx([$]),Kh.DEVICE=Qx([x,I,N,z,K,oe,ie,fe,Ee]),Kh.ENGINE=Kh.OS=Qx([b,D]),n.exports&&(i=n.exports=Kh),i.UAParser=Kh;var Zx=typeof s!==h&&(s.jQuery||s.Zepto);if(Zx&&!Zx.ua){var o2=new Kh;Zx.ua=o2.getResult(),Zx.ua.get=function(){return o2.getUA()},Zx.ua.set=function(ss){o2.setUA(ss);var vs=o2.getResult();for(var $r in vs)Zx.ua[$r]=vs[$r]}}})(typeof window=="object"?window:a)})(XU,XU.exports);var $0e=l(XU.exports),s7=CE.clear;In({global:!0,bind:!0,forced:U.clearImmediate!==s7},{clearImmediate:s7});var a7=U,X0e=X,J0e=be,Q0e=gu,Z0e=Gr,eye=Gp,tye=Wp,nye=a7.Function,rye=/MSIE .\./.test(Z0e)||Q0e==="BUN"&&function(){var n=a7.Bun.version.split(".");return n.length<3||n[0]==="0"&&(n[1]<3||n[1]==="3"&&n[2]==="0")}(),iye=In,o7=U,c7=CE.set,sye=function(n,i){var s=1;return rye?function(o,d){var h=tye(arguments.length,1)>s,f=J0e(o)?o:nye(o),g=h?eye(arguments,s):[],y=h?function(){X0e(f,this,g)}:f;return n(y)}:n},l7=o7.setImmediate?sye(c7):c7;iye({global:!0,bind:!0,forced:o7.setImmediate!==l7},{setImmediate:l7});var d7=l(ds.setImmediate),aye=U,oye=jA,cye=gi,lye=Wp,dye=Ze;In({global:!0,dontCallGetSet:!0,forced:u(function(){return dye&&Object.getOwnPropertyDescriptor(aye,"queueMicrotask").value.length!==1})},{queueMicrotask:function(n){lye(arguments.length,1),oye(cye(n))}});var u7=l(ds.queueMicrotask);function h7(n,i){return function(){return n.apply(i,arguments)}}const{toString:uye}=Object.prototype,{getPrototypeOf:JU}=Object,{iterator:ak,toStringTag:p7}=Symbol,ok=(QU=Object.create(null),n=>{const i=uye.call(n);return QU[i]||(QU[i]=i.slice(8,-1).toLowerCase())});var QU;const Nh=n=>(n=n.toLowerCase(),i=>ok(i)===n),ck=n=>i=>typeof i===n,{isArray:ix}=Array,sx=ck("undefined");function UT(n){return n!==null&&!sx(n)&&n.constructor!==null&&!sx(n.constructor)&&Wl(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const f7=Nh("ArrayBuffer"),hye=ck("string"),Wl=ck("function"),m7=ck("number"),VT=n=>n!==null&&typeof n=="object",lk=n=>{if(ok(n)!=="object")return!1;const i=JU(n);return!(i!==null&&i!==Object.prototype&&Object.getPrototypeOf(i)!==null||p7 in n||ak in n)},pye=Nh("Date"),fye=Nh("File"),mye=Nh("Blob"),gye=Nh("FileList"),_ye=Nh("URLSearchParams"),[yye,vye,Eye,xye]=["ReadableStream","Request","Response","Headers"].map(Nh);function FT(n,i){let s,o,{allOwnKeys:d=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n!=null)if(typeof n!="object"&&(n=[n]),ix(n))for(s=0,o=n.length;s<o;s++)i.call(null,n[s],s,n);else{if(UT(n))return;const h=d?Object.getOwnPropertyNames(n):Object.keys(n),f=h.length;let g;for(s=0;s<f;s++)g=h[s],i.call(null,n[g],g,n)}}function g7(n,i){if(UT(n))return null;i=i.toLowerCase();const s=Object.keys(n);let o,d=s.length;for(;d-- >0;)if(o=s[d],i===o.toLowerCase())return o;return null}const iy=i7!==void 0?i7:typeof self<"u"?self:typeof window<"u"?window:_f,_7=n=>!sx(n)&&n!==iy,bye=(ZU=typeof Uint8Array<"u"&&JU(Uint8Array),n=>ZU&&n instanceof ZU);var ZU;const wye=Nh("HTMLFormElement"),y7=(n=>{let{hasOwnProperty:i}=n;return(s,o)=>i.call(s,o)})(Object.prototype),Sye=Nh("RegExp"),v7=(n,i)=>{const s=Object.getOwnPropertyDescriptors(n),o={};FT(s,(d,h)=>{let f;(f=i(d,h,n))!==!1&&(o[h]=f||d)}),Object.defineProperties(n,o)},Tye=Nh("AsyncFunction"),E7=(x7=typeof d7=="function",b7=Wl(iy.postMessage),x7?d7:b7?(eV="axios@".concat(Math.random()),dk=[],iy.addEventListener("message",n=>{let{source:i,data:s}=n;i===iy&&s===eV&&dk.length&&dk.shift()()},!1),n=>{dk.push(n),iy.postMessage(eV,"*")}):n=>setTimeout(n));var x7,b7,eV,dk;const Rye=u7!==void 0?u7.bind(iy):typeof process<"u"&&process.nextTick||E7;var at={isArray:ix,isArrayBuffer:f7,isBuffer:UT,isFormData:n=>{let i;return n&&(typeof FormData=="function"&&n instanceof FormData||Wl(n.append)&&((i=ok(n))==="formdata"||i==="object"&&Wl(n.toString)&&n.toString()==="[object FormData]"))},isArrayBufferView:function(n){let i;return i=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(n):n&&n.buffer&&f7(n.buffer),i},isString:hye,isNumber:m7,isBoolean:n=>n===!0||n===!1,isObject:VT,isPlainObject:lk,isEmptyObject:n=>{if(!VT(n)||UT(n))return!1;try{return Object.keys(n).length===0&&Object.getPrototypeOf(n)===Object.prototype}catch{return!1}},isReadableStream:yye,isRequest:vye,isResponse:Eye,isHeaders:xye,isUndefined:sx,isDate:pye,isFile:fye,isBlob:mye,isRegExp:Sye,isFunction:Wl,isStream:n=>VT(n)&&Wl(n.pipe),isURLSearchParams:_ye,isTypedArray:bye,isFileList:gye,forEach:FT,merge:function n(){const{caseless:i,skipUndefined:s}=_7(this)&&this||{},o={},d=(h,f)=>{const g=i&&g7(o,f)||f;lk(o[g])&&lk(h)?o[g]=n(o[g],h):lk(h)?o[g]=n({},h):ix(h)?o[g]=h.slice():s&&sx(h)||(o[g]=h)};for(let h=0,f=arguments.length;h<f;h++)arguments[h]&&FT(arguments[h],d);return o},extend:function(n,i,s){let{allOwnKeys:o}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return FT(i,(d,h)=>{s&&Wl(d)?n[h]=h7(d,s):n[h]=d},{allOwnKeys:o}),n},trim:n=>Oo(n)?Oo(n).call(n):n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),inherits:(n,i,s,o)=>{n.prototype=Object.create(i.prototype,o),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:i.prototype}),s&&Object.assign(n.prototype,s)},toFlatObject:(n,i,s,o)=>{let d,h,f;const g={};if(i=i||{},n==null)return i;do{for(d=Object.getOwnPropertyNames(n),h=d.length;h-- >0;)f=d[h],o&&!o(f,n,i)||g[f]||(i[f]=n[f],g[f]=!0);n=s!==!1&&JU(n)}while(n&&(!s||s(n,i))&&n!==Object.prototype);return i},kindOf:ok,kindOfTest:Nh,endsWith:(n,i,s)=>{n=String(n),(s===void 0||s>n.length)&&(s=n.length),s-=i.length;const o=n.indexOf(i,s);return o!==-1&&o===s},toArray:n=>{if(!n)return null;if(ix(n))return n;let i=n.length;if(!m7(i))return null;const s=new Array(i);for(;i-- >0;)s[i]=n[i];return s},forEachEntry:(n,i)=>{const s=(n&&n[ak]).call(n);let o;for(;(o=s.next())&&!o.done;){const d=o.value;i.call(n,d[0],d[1])}},matchAll:(n,i)=>{let s;const o=[];for(;(s=n.exec(i))!==null;)o.push(s);return o},isHTMLForm:wye,hasOwnProperty:y7,hasOwnProp:y7,reduceDescriptors:v7,freezeMethods:n=>{v7(n,(i,s)=>{if(Wl(n)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const o=n[s];Wl(o)&&(i.enumerable=!1,"writable"in i?i.writable=!1:i.set||(i.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))})},toObjectSet:(n,i)=>{const s={},o=d=>{d.forEach(h=>{s[h]=!0})};return ix(n)?o(n):o(String(n).split(i)),s},toCamelCase:n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,s,o){return s.toUpperCase()+o}),noop:()=>{},toFiniteNumber:(n,i)=>n!=null&&Number.isFinite(n=+n)?n:i,findKey:g7,global:iy,isContextDefined:_7,isSpecCompliantForm:function(n){return!!(n&&Wl(n.append)&&n[p7]==="FormData"&&n[ak])},toJSONObject:n=>{const i=new Array(10),s=(o,d)=>{if(VT(o)){if(i.indexOf(o)>=0)return;if(UT(o))return o;if(!("toJSON"in o)){i[d]=o;const h=ix(o)?[]:{};return FT(o,(f,g)=>{const y=s(f,d+1);!sx(y)&&(h[g]=y)}),i[d]=void 0,h}}return o};return s(n,0)},isAsyncFn:Tye,isThenable:n=>n&&(VT(n)||Wl(n))&&Wl(n.then)&&Wl(n.catch),setImmediate:E7,asap:Rye,isIterable:n=>n!=null&&Wl(n[ak])};function wr(n,i,s,o,d){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",i&&(this.code=i),s&&(this.config=s),o&&(this.request=o),d&&(this.response=d,this.status=d.status?d.status:null)}at.inherits(wr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:at.toJSONObject(this.config),code:this.code,status:this.status}}});const w7=wr.prototype,S7={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{S7[n]={value:n}}),Object.defineProperties(wr,S7),Object.defineProperty(w7,"isAxiosError",{value:!0}),wr.from=(n,i,s,o,d,h)=>{const f=Object.create(w7);at.toFlatObject(n,f,function(x){return x!==Error.prototype},x=>x!=="isAxiosError");const g=n&&n.message?n.message:"Error",y=i==null&&n?n.code:i;return wr.call(f,g,y,s,o,d),n&&f.cause==null&&Object.defineProperty(f,"cause",{value:n,configurable:!0}),f.name=n&&n.name||"Error",h&&Object.assign(f,h),f};function tV(n){return at.isPlainObject(n)||at.isArray(n)}function T7(n){return at.endsWith(n,"[]")?n.slice(0,-2):n}function R7(n,i,s){return n?n.concat(i).map(function(o,d){return o=T7(o),!s&&d?"["+o+"]":o}).join(s?".":""):i}const Cye=at.toFlatObject(at,{},null,function(n){return/^is[A-Z]/.test(n)});function uk(n,i,s){if(!at.isObject(n))throw new TypeError("target must be an object");i=i||new FormData;const o=(s=at.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(I,D){return!at.isUndefined(D[I])})).metaTokens,d=s.visitor||x,h=s.dots,f=s.indexes,g=(s.Blob||typeof Blob<"u"&&Blob)&&at.isSpecCompliantForm(i);if(!at.isFunction(d))throw new TypeError("visitor must be a function");function y(I){if(I===null)return"";if(at.isDate(I))return I.toISOString();if(at.isBoolean(I))return I.toString();if(!g&&at.isBlob(I))throw new wr("Blob is not supported. Use a Buffer instead.");return at.isArrayBuffer(I)||at.isTypedArray(I)?g&&typeof Blob=="function"?new Blob([I]):Buffer.from(I):I}function x(I,D,$){let z=I;if(I&&!$&&typeof I=="object"){if(at.endsWith(D,"{}"))D=o?D:D.slice(0,-2),I=JSON.stringify(I);else if(at.isArray(I)&&function(K){return at.isArray(K)&&!K.some(tV)}(I)||(at.isFileList(I)||at.endsWith(D,"[]"))&&(z=at.toArray(I)))return D=T7(D),z.forEach(function(K,ie){!at.isUndefined(K)&&K!==null&&i.append(f===!0?R7([D],ie,h):f===null?D:D+"[]",y(K))}),!1}return!!tV(I)||(i.append(R7($,D,h),y(I)),!1)}const b=[],N=Object.assign(Cye,{defaultVisitor:x,convertValue:y,isVisitable:tV});if(!at.isObject(n))throw new TypeError("data must be an object");return function I(D,$){if(!at.isUndefined(D)){if(b.indexOf(D)!==-1)throw Error("Circular reference detected in "+$.join("."));b.push(D),at.forEach(D,function(z,K){(!(at.isUndefined(z)||z===null)&&d.call(i,z,at.isString(K)?Oo(K).call(K):K,$,N))===!0&&I(z,$?$.concat(K):[K])}),b.pop()}}(n),i}function C7(n){const i={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(s){return i[s]})}function nV(n,i){this._pairs=[],n&&uk(n,this,i)}const N7=nV.prototype;function Nye(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function I7(n,i,s){if(!i)return n;const o=s&&s.encode||Nye;at.isFunction(s)&&(s={serialize:s});const d=s&&s.serialize;let h;if(h=d?d(i,s):at.isURLSearchParams(i)?i.toString():new nV(i,s).toString(o),h){const f=n.indexOf("#");f!==-1&&(n=n.slice(0,f)),n+=(n.indexOf("?")===-1?"?":"&")+h}return n}N7.append=function(n,i){this._pairs.push([n,i])},N7.toString=function(n){const i=n?function(s){return n.call(this,s,C7)}:C7;return this._pairs.map(function(s){return i(s[0])+"="+i(s[1])},"").join("&")};var A7=class{constructor(){this.handlers=[]}use(n,i,s){return this.handlers.push({fulfilled:n,rejected:i,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(n){this.handlers[n]&&(this.handlers[n]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(n){at.forEach(this.handlers,function(i){i!==null&&n(i)})}},k7={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},P7={exports:{}},Iye=In,Aye=Ze,D7=za.f;Iye({target:"Object",stat:!0,forced:Object.defineProperty!==D7,sham:!Aye},{defineProperty:D7});var O7=ds.Object,kye=P7.exports=function(n,i,s){return O7.defineProperty(n,i,s)};O7.defineProperty.sham&&(kye.sham=!0);var L7=l(P7.exports),Pye=TypeError,j7=Rd,Dye=RE,Oye=Jn,Lye=Zt("species"),M7=Array,jye=function(n){var i;return j7(n)&&(i=n.constructor,(Dye(i)&&(i===M7||j7(i.prototype))||Oye(i)&&(i=i[Lye])===null)&&(i=void 0)),i===void 0?M7:i},U7=function(n,i){return new(jye(n))(i===0?0:i)},Mye=u,Uye=ia,Vye=Zt("species"),V7=function(n){return Uye>=51||!Mye(function(){var i=[];return(i.constructor={})[Vye]=function(){return{foo:1}},i[n](Boolean).foo!==1})},Fye=In,Bye=u,zye=Rd,Gye=Jn,Wye=io,Hye=sr,F7=function(n){if(n>9007199254740991)throw Pye("Maximum allowed index exceeded");return n},B7=uU,Kye=U7,qye=V7,Yye=ia,z7=Zt("isConcatSpreadable"),$ye=Yye>=51||!Bye(function(){var n=[];return n[z7]=!1,n.concat()[0]!==n}),Xye=function(n){if(!Gye(n))return!1;var i=n[z7];return i!==void 0?!!i:zye(n)};Fye({target:"Array",proto:!0,forced:!$ye||!qye("concat")},{concat:function(n){var i,s,o,d,h,f=Wye(this),g=Kye(f,0),y=0;for(i=-1,o=arguments.length;i<o;i++)if(Xye(h=i===-1?f:arguments[i]))for(d=Hye(h),F7(y+d),s=0;s<d;s++,y++)s in h&&B7(g,y,h[s]);else F7(y+1),B7(g,y++,h);return g.length=y,g}});var G7={},Jye=J,Qye=ui,W7=Zv.f,Zye=Gp,H7=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];G7.f=function(n){return H7&&Jye(n)==="Window"?function(i){try{return W7(i)}catch{return Zye(H7)}}(n):W7(Qye(n))};var ax={},eve=Zt;ax.f=eve;var K7=ds,tve=Zi,nve=ax,rve=za.f,ca=function(n){var i=K7.Symbol||(K7.Symbol={});tve(i,n)||rve(i,n,{value:nve.f(n)})},ive=lt,sve=hi,ave=Zt,ove=Eh,q7=function(){var n=sve("Symbol"),i=n&&n.prototype,s=i&&i.valueOf,o=ave("toPrimitive");i&&!i[o]&&ove(i,o,function(d){return ive(s,this)},{})},cve=ll,lve=ln,dve=io,uve=sr,hve=U7,Y7=C([].push),pve=function(n){var i=n===1,s=n===2,o=n===3,d=n===4,h=n===6,f=n===7,g=n===5||h;return function(y,x,b,N){for(var I,D,$=dve(y),z=lve($),K=uve(z),ie=cve(x,b),oe=0,fe=N||hve,Ee=i?fe(y,K):s||f?fe(y,0):void 0;K>oe;oe++)if((g||oe in z)&&(D=ie(I=z[oe],oe,$),n))if(i)Ee[oe]=D;else if(D)switch(n){case 3:return!0;case 5:return I;case 6:return oe;case 2:Y7(Ee,I)}else switch(n){case 4:return!1;case 7:Y7(Ee,I)}return h?-1:o||d?d:Ee}},$7={forEach:pve(0)},hk=In,BT=U,rV=lt,fve=C,ox=Ze,cx=$t,mve=u,Lo=Zi,gve=A,iV=_i,pk=ui,sV=ao,_ve=zs,aV=yt,lx=bg,X7=eE,yve=Zv,J7=G7,vve=k0,Q7=ye,Z7=za,Eve=fl,eK=Le,tK=Eh,xve=zp,oV=jl,nK=yu,rK=lh,bve=Zt,wve=ax,Sve=ca,Tve=q7,Rve=bu,iK=Po,fk=$7.forEach,Hl=nr("hidden"),mk="Symbol",zT="prototype",Cve=iK.set,sK=iK.getterFor(mk),Ih=Object[zT],sy=BT.Symbol,gk=sy&&sy[zT],Nve=BT.RangeError,Ive=BT.TypeError,cV=BT.QObject,aK=Q7.f,ay=Z7.f,oK=J7.f,Ave=eK.f,cK=fve([].push),cm=oV("symbols"),GT=oV("op-symbols"),kve=oV("wks"),lV=!cV||!cV[zT]||!cV[zT].findChild,lK=function(n,i,s){var o=aK(Ih,i);o&&delete Ih[i],ay(n,i,s),o&&n!==Ih&&ay(Ih,i,o)},dV=ox&&mve(function(){return lx(ay({},"a",{get:function(){return ay(this,"a",{value:7}).a}})).a!==7})?lK:ay,uV=function(n,i){var s=cm[n]=lx(gk);return Cve(s,{type:mk,tag:n,description:i}),ox||(s.description=i),s},_k=function(n,i,s){n===Ih&&_k(GT,i,s),iV(n);var o=sV(i);return iV(s),Lo(cm,o)?(s.enumerable?(Lo(n,Hl)&&n[Hl][o]&&(n[Hl][o]=!1),s=lx(s,{enumerable:aV(0,!1)})):(Lo(n,Hl)||ay(n,Hl,aV(1,lx(null))),n[Hl][o]=!0),dV(n,o,s)):ay(n,o,s)},hV=function(n,i){iV(n);var s=pk(i),o=X7(s).concat(pK(s));return fk(o,function(d){ox&&!rV(dK,s,d)||_k(n,d,s[d])}),n},dK=function(n){var i=sV(n),s=rV(Ave,this,i);return!(this===Ih&&Lo(cm,i)&&!Lo(GT,i))&&(!(s||!Lo(this,i)||!Lo(cm,i)||Lo(this,Hl)&&this[Hl][i])||s)},uK=function(n,i){var s=pk(n),o=sV(i);if(s!==Ih||!Lo(cm,o)||Lo(GT,o)){var d=aK(s,o);return!d||!Lo(cm,o)||Lo(s,Hl)&&s[Hl][o]||(d.enumerable=!0),d}},hK=function(n){var i=oK(pk(n)),s=[];return fk(i,function(o){Lo(cm,o)||Lo(nK,o)||cK(s,o)}),s},pK=function(n){var i=n===Ih,s=oK(i?GT:pk(n)),o=[];return fk(s,function(d){!Lo(cm,d)||i&&!Lo(Ih,d)||cK(o,cm[d])}),o};cx||(sy=function(){if(gve(gk,this))throw new Ive("Symbol is not a constructor");var n=arguments.length&&arguments[0]!==void 0?_ve(arguments[0]):void 0,i=rK(n),s=function(o){var d=this===void 0?BT:this;d===Ih&&rV(s,GT,o),Lo(d,Hl)&&Lo(d[Hl],i)&&(d[Hl][i]=!1);var h=aV(1,o);try{dV(d,i,h)}catch(f){if(!(f instanceof Nve))throw f;lK(d,i,h)}};return ox&&lV&&dV(Ih,i,{configurable:!0,set:s}),uV(i,n)},tK(gk=sy[zT],"toString",function(){return sK(this).tag}),tK(sy,"withoutSetter",function(n){return uV(rK(n),n)}),eK.f=dK,Z7.f=_k,Eve.f=hV,Q7.f=uK,yve.f=J7.f=hK,vve.f=pK,wve.f=function(n){return uV(bve(n),n)},ox&&xve(gk,"description",{configurable:!0,get:function(){return sK(this).description}})),hk({global:!0,wrap:!0,forced:!cx,sham:!cx},{Symbol:sy}),fk(X7(kve),function(n){Sve(n)}),hk({target:mk,stat:!0,forced:!cx},{useSetter:function(){lV=!0},useSimple:function(){lV=!1}}),hk({target:"Object",stat:!0,forced:!cx,sham:!ox},{create:function(n,i){return i===void 0?lx(n):hV(lx(n),i)},defineProperty:_k,defineProperties:hV,getOwnPropertyDescriptor:uK}),hk({target:"Object",stat:!0,forced:!cx},{getOwnPropertyNames:hK}),Tve(),Rve(sy,mk),nK[Hl]=!0;var fK=$t&&!!Symbol.for&&!!Symbol.keyFor,Pve=In,Dve=hi,Ove=Zi,Lve=zs,mK=jl,jve=fK,pV=mK("string-to-symbol-registry"),Mve=mK("symbol-to-string-registry");Pve({target:"Symbol",stat:!0,forced:!jve},{for:function(n){var i=Lve(n);if(Ove(pV,i))return pV[i];var s=Dve("Symbol")(i);return pV[i]=s,Mve[s]=i,s}});var Uve=In,Vve=Zi,Fve=Ar,Bve=Qi,zve=fK,gK=jl("symbol-to-string-registry");Uve({target:"Symbol",stat:!0,forced:!zve},{keyFor:function(n){if(!Fve(n))throw new TypeError(Bve(n)+" is not a symbol");if(Vve(gK,n))return gK[n]}});var _K=Rd,Gve=be,yK=J,Wve=zs,vK=C([].push),Hve=In,EK=hi,xK=X,Kve=lt,WT=C,bK=u,wK=be,SK=Ar,TK=Gp,qve=function(n){if(Gve(n))return n;if(_K(n)){for(var i=n.length,s=[],o=0;o<i;o++){var d=n[o];typeof d=="string"?vK(s,d):typeof d!="number"&&yK(d)!=="Number"&&yK(d)!=="String"||vK(s,Wve(d))}var h=s.length,f=!0;return function(g,y){if(f)return f=!1,y;if(_K(this))return y;for(var x=0;x<h;x++)if(s[x]===g)return y}}},Yve=$t,$ve=String,zg=EK("JSON","stringify"),yk=WT(/./.exec),RK=WT("".charAt),Xve=WT("".charCodeAt),Jve=WT("".replace),Qve=WT(1.1.toString),Zve=/[\uD800-\uDFFF]/g,CK=/^[\uD800-\uDBFF]$/,NK=/^[\uDC00-\uDFFF]$/,IK=!Yve||bK(function(){var n=EK("Symbol")("stringify detection");return zg([n])!=="[null]"||zg({a:n})!=="{}"||zg(Object(n))!=="{}"}),AK=bK(function(){return zg("\uDF06\uD834")!=='"\\udf06\\ud834"'||zg("\uDEAD")!=='"\\udead"'}),eEe=function(n,i){var s=TK(arguments),o=qve(i);if(wK(o)||n!==void 0&&!SK(n))return s[1]=function(d,h){if(wK(o)&&(h=Kve(o,this,$ve(d),h)),!SK(h))return h},xK(zg,null,s)},tEe=function(n,i,s){var o=RK(s,i-1),d=RK(s,i+1);return yk(CK,n)&&!yk(NK,d)||yk(NK,n)&&!yk(CK,o)?"\\u"+Qve(Xve(n,0),16):n};zg&&Hve({target:"JSON",stat:!0,forced:IK||AK},{stringify:function(n,i,s){var o=TK(arguments),d=xK(IK?eEe:zg,null,o);return AK&&typeof d=="string"?Jve(d,Zve,tEe):d}});var kK=k0,nEe=io;In({target:"Object",stat:!0,forced:!$t||u(function(){kK.f(1)})},{getOwnPropertySymbols:function(n){var i=kK.f;return i?i(nEe(n)):[]}}),ca("asyncDispose"),ca("asyncIterator"),ca("dispose"),ca("hasInstance"),ca("isConcatSpreadable"),ca("iterator"),ca("match"),ca("matchAll"),ca("replace"),ca("search"),ca("species"),ca("split");var rEe=q7;ca("toPrimitive"),rEe();var iEe=hi,sEe=bu;ca("toStringTag"),sEe(iEe("Symbol"),"Symbol"),ca("unscopables"),bu(U.JSON,"JSON",!0);var aEe=ds.Symbol,oEe=Zt,cEe=za.f,PK=oEe("metadata"),DK=Function.prototype;DK[PK]===void 0&&cEe(DK,PK,{value:null}),ca("metadata");var lEe=aEe,dEe=C,fV=hi("Symbol"),uEe=fV.keyFor,hEe=dEe(fV.prototype.valueOf),OK=fV.isRegisteredSymbol||function(n){try{return uEe(hEe(n))!==void 0}catch{return!1}};In({target:"Symbol",stat:!0},{isRegisteredSymbol:OK});for(var pEe=jl,LK=hi,fEe=C,mEe=Ar,gEe=Zt,vk=LK("Symbol"),jK=vk.isWellKnownSymbol,MK=LK("Object","getOwnPropertyNames"),_Ee=fEe(vk.prototype.valueOf),UK=pEe("wks"),mV=0,VK=MK(vk),yEe=VK.length;mV<yEe;mV++)try{var FK=VK[mV];mEe(vk[FK])&&gEe(FK)}catch{}var BK=function(n){if(jK&&jK(n))return!0;try{for(var i=_Ee(n),s=0,o=MK(UK),d=o.length;s<d;s++)if(UK[o[s]]==i)return!0}catch{}return!1};In({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:BK}),ca("customMatcher"),ca("observable"),In({target:"Symbol",stat:!0},{isRegistered:OK}),In({target:"Symbol",stat:!0,forced:!0},{isWellKnown:BK}),ca("matcher"),ca("metadataKey"),ca("patternMatch"),ca("replaceAll");var dx=l(lEe),zK=l(ax.f("iterator"));function HT(n){return HT=typeof dx=="function"&&typeof zK=="symbol"?function(i){return typeof i}:function(i){return i&&typeof dx=="function"&&i.constructor===dx&&i!==dx.prototype?"symbol":typeof i},HT(n)}var vEe=l(ax.f("toPrimitive"));function EEe(n){var i=function(s,o){if(HT(s)!="object"||!s)return s;var d=s[vEe];if(d!==void 0){var h=d.call(s,o);if(HT(h)!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(s)}(n,"string");return HT(i)=="symbol"?i:i+""}function Y(n,i,s){return(i=EEe(i))in n?L7(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}var GK=l(Kge),xEe={isBrowser:!0,classes:{URLSearchParams:GK!==void 0?GK:nV,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const gV=typeof window<"u"&&typeof document<"u",_V=typeof navigator=="object"&&navigator||void 0,bEe=gV&&(!_V||["ReactNative","NativeScript","NS"].indexOf(_V.product)<0),wEe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",SEe=gV&&window.location.href||"http://localhost";function WK(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function HK(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?WK(Object(s),!0).forEach(function(o){Y(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):WK(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}var Kc=HK(HK({},Object.freeze({__proto__:null,hasBrowserEnv:gV,hasStandardBrowserEnv:bEe,hasStandardBrowserWebWorkerEnv:wEe,navigator:_V,origin:SEe})),xEe);function KK(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function TEe(n,i){return uk(n,new Kc.classes.URLSearchParams,function(s){for(var o=1;o<arguments.length;o++){var d=arguments[o]!=null?arguments[o]:{};o%2?KK(Object(d),!0).forEach(function(h){Y(s,h,d[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(d)):KK(Object(d)).forEach(function(h){Object.defineProperty(s,h,Object.getOwnPropertyDescriptor(d,h))})}return s}({visitor:function(s,o,d,h){return Kc.isNode&&at.isBuffer(s)?(this.append(o,s.toString("base64")),!1):h.defaultVisitor.apply(this,arguments)}},i))}var REe=GE.charAt,qK=lt,CEe=_i,NEe=be,IEe=J,AEe=/./.exec,kEe=TypeError,PEe=In,YK=lt,$K=de,DEe=U0,Ek=wE,XK=nn,JK=ii,KT=zs,OEe=_i,LEe=Jn,jEe=J,MEe=$f,QK=zU,UEe=ec,VEe=u,FEe=qS,BEe=function(n,i,s){return i+(s?REe(n,i).length:1)},zEe=function(n,i){var s=n.exec;if(NEe(s)){var o=qK(s,n,i);return o!==null&&CEe(o),o}if(IEe(n)==="RegExp")return qK(AEe,n,i);throw new kEe("RegExp#exec called on incompatible receiver")},ZK=Po,GEe=Zt("matchAll"),eq="RegExp String",tq=eq+" Iterator",WEe=ZK.set,HEe=ZK.getterFor(tq),KEe=TypeError,yV=$K("".indexOf),xk=$K("".matchAll),vV=!!xk&&!VEe(function(){xk("a",/./)}),qEe=DEe(function(n,i,s,o){WEe(this,{type:tq,regexp:n,string:i,global:s,unicode:o,done:!1})},eq,function(){var n=HEe(this);if(n.done)return Ek(void 0,!0);var i=n.regexp,s=n.string,o=zEe(i,s);return o===null?(n.done=!0,Ek(void 0,!0)):n.global?(KT(o[0])===""&&(i.lastIndex=BEe(s,JK(i.lastIndex),n.unicode)),Ek(o,!1)):(n.done=!0,Ek(o,!1))}),nq=function(n){var i,s,o,d=OEe(this),h=KT(n),f=FEe(d,RegExp),g=KT(QK(d));return i=new f(f===RegExp?d.source:d,g),s=!!~yV(g,"g"),o=!!~yV(g,"u"),i.lastIndex=JK(d.lastIndex),new qEe(i,h,s,o)};PEe({target:"String",proto:!0,forced:vV},{matchAll:function(n){var i,s,o,d,h=XK(this);if(LEe(n)){if(MEe(n)&&(i=KT(XK(QK(n))),!~yV(i,"g")))throw new KEe("`.matchAll` does not allow non-global regexes");if(vV)return xk(h,n);if((o=UEe(n,GEe))===void 0&&jEe(n)==="RegExp"&&(o=nq),o)return YK(o,n,h)}else if(vV)return xk(h,n);return s=KT(h),d=new RegExp(n,"g"),YK(nq,d,s)}});var YEe=Co("String","matchAll"),$Ee=A,XEe=YEe,EV=String.prototype,JEe=function(n){var i=n.matchAll;return typeof n=="string"||n===EV||$Ee(EV,n)&&i===EV.matchAll?XEe:i},QEe=l(JEe);function rq(n){function i(s,o,d,h){let f=s[h++];if(f==="__proto__")return!0;const g=Number.isFinite(+f),y=h>=s.length;return f=!f&&at.isArray(d)?d.length:f,y?(at.hasOwnProp(d,f)?d[f]=[d[f],o]:d[f]=o,!g):(d[f]&&at.isObject(d[f])||(d[f]=[]),i(s,o,d[f],h)&&at.isArray(d[f])&&(d[f]=function(x){const b={},N=Object.keys(x);let I;const D=N.length;let $;for(I=0;I<D;I++)$=N[I],b[$]=x[$];return b}(d[f])),!g)}if(at.isFormData(n)&&at.isFunction(n.entries)){const s={};return at.forEachEntry(n,(o,d)=>{i(function(h){return QEe(at).call(at,/\w+|\[(\w*)]/g,h).map(f=>f[0]==="[]"?"":f[1]||f[0])}(o),d,s,0)}),s}return null}const xV={transitional:k7,adapter:["xhr","http","fetch"],transformRequest:[function(n,i){const s=i.getContentType()||"",o=s.indexOf("application/json")>-1,d=at.isObject(n);if(d&&at.isHTMLForm(n)&&(n=new FormData(n)),at.isFormData(n))return o?JSON.stringify(rq(n)):n;if(at.isArrayBuffer(n)||at.isBuffer(n)||at.isStream(n)||at.isFile(n)||at.isBlob(n)||at.isReadableStream(n))return n;if(at.isArrayBufferView(n))return n.buffer;if(at.isURLSearchParams(n))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let h;if(d){if(s.indexOf("application/x-www-form-urlencoded")>-1)return TEe(n,this.formSerializer).toString();if((h=at.isFileList(n))||s.indexOf("multipart/form-data")>-1){const f=this.env&&this.env.FormData;return uk(h?{"files[]":n}:n,f&&new f,this.formSerializer)}}return d||o?(i.setContentType("application/json",!1),function(f,g,y){if(at.isString(f))try{return(g||JSON.parse)(f),Oo(at).call(at,f)}catch(x){if(x.name!=="SyntaxError")throw x}return(y||JSON.stringify)(f)}(n)):n}],transformResponse:[function(n){const i=this.transitional||xV.transitional,s=i&&i.forcedJSONParsing,o=this.responseType==="json";if(at.isResponse(n)||at.isReadableStream(n))return n;if(n&&at.isString(n)&&(s&&!this.responseType||o)){const d=!(i&&i.silentJSONParsing)&&o;try{return JSON.parse(n,this.parseReviver)}catch(h){if(d)throw h.name==="SyntaxError"?wr.from(h,wr.ERR_BAD_RESPONSE,this,null,this.response):h}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Kc.classes.FormData,Blob:Kc.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};at.forEach(["delete","get","head","post","put","patch"],n=>{xV.headers[n]={}});var bV=xV;const ZEe=at.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),iq=Symbol("internals");function qT(n){var i;return n&&Oo(i=String(n)).call(i).toLowerCase()}function bk(n){return n===!1||n==null?n:at.isArray(n)?n.map(bk):String(n)}function wV(n,i,s,o,d){return at.isFunction(o)?o.call(this,i,s):(d&&(i=s),at.isString(i)?at.isString(o)?i.indexOf(o)!==-1:at.isRegExp(o)?o.test(i):void 0:void 0)}class wk{constructor(i){i&&this.set(i)}set(i,s,o){const d=this;function h(y,x,b){const N=qT(x);if(!N)throw new Error("header name must be a non-empty string");const I=at.findKey(d,N);(!I||d[I]===void 0||b===!0||b===void 0&&d[I]!==!1)&&(d[I||x]=bk(y))}const f=(y,x)=>at.forEach(y,(b,N)=>h(b,N,x));if(at.isPlainObject(i)||i instanceof this.constructor)f(i,s);else if(at.isString(i)&&(i=Oo(i).call(i))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Oo(g=i).call(g)))f((y=>{const x={};let b,N,I;return y&&y.split(`
`).forEach(function(D){var $,z;I=D.indexOf(":"),b=Oo($=D.substring(0,I)).call($).toLowerCase(),N=Oo(z=D.substring(I+1)).call(z),!b||x[b]&&ZEe[b]||(b==="set-cookie"?x[b]?x[b].push(N):x[b]=[N]:x[b]=x[b]?x[b]+", "+N:N)}),x})(i),s);else if(at.isObject(i)&&at.isIterable(i)){let y,x,b={};for(const N of i){if(!at.isArray(N))throw TypeError("Object iterator must return a key-value pair");b[x=N[0]]=(y=b[x])?at.isArray(y)?[...y,N[1]]:[y,N[1]]:N[1]}f(b,s)}else i!=null&&h(s,i,o);var g;return this}get(i,s){if(i=qT(i)){const o=at.findKey(this,i);if(o){const d=this[o];if(!s)return d;if(s===!0)return function(h){const f=Object.create(null),g=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let y;for(;y=g.exec(h);)f[y[1]]=y[2];return f}(d);if(at.isFunction(s))return s.call(this,d,o);if(at.isRegExp(s))return s.exec(d);throw new TypeError("parser must be boolean|regexp|function")}}}has(i,s){if(i=qT(i)){const o=at.findKey(this,i);return!(!o||this[o]===void 0||s&&!wV(0,this[o],o,s))}return!1}delete(i,s){const o=this;let d=!1;function h(f){if(f=qT(f)){const g=at.findKey(o,f);!g||s&&!wV(0,o[g],g,s)||(delete o[g],d=!0)}}return at.isArray(i)?i.forEach(h):h(i),d}clear(i){const s=Object.keys(this);let o=s.length,d=!1;for(;o--;){const h=s[o];i&&!wV(0,this[h],h,i,!0)||(delete this[h],d=!0)}return d}normalize(i){const s=this,o={};return at.forEach(this,(d,h)=>{var f;const g=at.findKey(o,h);if(g)return s[g]=bk(d),void delete s[h];const y=i?function(x){return Oo(x).call(x).toLowerCase().replace(/([a-z\d])(\w*)/g,(b,N,I)=>N.toUpperCase()+I)}(h):Oo(f=String(h)).call(f);y!==h&&delete s[h],s[y]=bk(d),o[y]=!0}),this}concat(){for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return this.constructor.concat(this,...s)}toJSON(i){const s=Object.create(null);return at.forEach(this,(o,d)=>{o!=null&&o!==!1&&(s[d]=i&&at.isArray(o)?o.join(", "):o)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(i=>{let[s,o]=i;return s+": "+o}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(i){return i instanceof this?i:new this(i)}static concat(i){const s=new this(i);for(var o=arguments.length,d=new Array(o>1?o-1:0),h=1;h<o;h++)d[h-1]=arguments[h];return d.forEach(f=>s.set(f)),s}static accessor(i){const s=(this[iq]=this[iq]={accessors:{}}).accessors,o=this.prototype;function d(h){const f=qT(h);s[f]||(function(g,y){const x=at.toCamelCase(" "+y);["get","set","has"].forEach(b=>{Object.defineProperty(g,b+x,{value:function(N,I,D){return this[b].call(this,y,N,I,D)},configurable:!0})})}(o,h),s[f]=!0)}return at.isArray(i)?i.forEach(d):d(i),this}}wk.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),at.reduceDescriptors(wk.prototype,(n,i)=>{let{value:s}=n,o=i[0].toUpperCase()+i.slice(1);return{get:()=>s,set(d){this[o]=d}}}),at.freezeMethods(wk);var Ah=wk;function SV(n,i){const s=this||bV,o=i||s,d=Ah.from(o.headers);let h=o.data;return at.forEach(n,function(f){h=f.call(s,h,d.normalize(),i?i.status:void 0)}),d.normalize(),h}function sq(n){return!(!n||!n.__CANCEL__)}function ux(n,i,s){wr.call(this,n??"canceled",wr.ERR_CANCELED,i,s),this.name="CanceledError"}function aq(n,i,s){const o=s.config.validateStatus;s.status&&o&&!o(s.status)?i(new wr("Request failed with status code "+s.status,[wr.ERR_BAD_REQUEST,wr.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):n(s)}at.inherits(ux,wr,{__CANCEL__:!0});const Sk=function(n,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,o=0;const d=function(h,f){h=h||10;const g=new Array(h),y=new Array(h);let x,b=0,N=0;return f=f!==void 0?f:1e3,function(I){const D=Date.now(),$=y[N];x||(x=D),g[b]=I,y[b]=D;let z=N,K=0;for(;z!==b;)K+=g[z++],z%=h;if(b=(b+1)%h,b===N&&(N=(N+1)%h),D-x<f)return;const ie=$&&D-$;return ie?Math.round(1e3*K/ie):void 0}}(50,250);return function(h,f){let g,y,x=0,b=1e3/f;const N=function(I){x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),g=null,y&&(clearTimeout(y),y=null),h(...I)};return[function(){const I=Date.now(),D=I-x;for(var $=arguments.length,z=new Array($),K=0;K<$;K++)z[K]=arguments[K];D>=b?N(z,I):(g=z,y||(y=setTimeout(()=>{y=null,N(g)},b-D)))},()=>g&&N(g)]}(h=>{const f=h.loaded,g=h.lengthComputable?h.total:void 0,y=f-o,x=d(y);o=f,n({loaded:f,total:g,progress:g?f/g:void 0,bytes:y,rate:x||void 0,estimated:x&&g&&f<=g?(g-f)/x:void 0,event:h,lengthComputable:g!=null,[i?"download":"upload"]:!0})},s)},oq=(n,i)=>{const s=n!=null;return[o=>i[0]({lengthComputable:s,total:n,loaded:o}),i[1]]},cq=n=>function(){for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return at.asap(()=>n(...s))};var exe=Kc.hasStandardBrowserEnv?((n,i)=>s=>(s=new Z1(s,Kc.origin),n.protocol===s.protocol&&n.host===s.host&&(i||n.port===s.port)))(new Z1(Kc.origin),Kc.navigator&&/(msie|trident)/i.test(Kc.navigator.userAgent)):()=>!0,txe=Kc.hasStandardBrowserEnv?{write(n,i,s,o,d,h,f){if(typeof document>"u")return;const g=["".concat(n,"=").concat(encodeURIComponent(i))];at.isNumber(s)&&g.push("expires=".concat(new Date(s).toUTCString())),at.isString(o)&&g.push("path=".concat(o)),at.isString(d)&&g.push("domain=".concat(d)),h===!0&&g.push("secure"),at.isString(f)&&g.push("SameSite=".concat(f)),document.cookie=g.join("; ")},read(n){if(typeof document>"u")return null;const i=document.cookie.match(new RegExp("(?:^|; )"+n+"=([^;]*)"));return i?decodeURIComponent(i[1]):null},remove(n){this.write(n,"",Date.now()-864e5,"/")}}:{write(){},read:()=>null,remove(){}};function lq(n,i,s){let o=!function(d){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(d)}(i);return n&&(o||s==0)?function(d,h){return h?d.replace(/\/?\/$/,"")+"/"+h.replace(/^\/+/,""):d}(n,i):i}function dq(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function TV(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?dq(Object(s),!0).forEach(function(o){Y(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):dq(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}const uq=n=>n instanceof Ah?TV({},n):n;function oy(n,i){i=i||{};const s={};function o(x,b,N,I){return at.isPlainObject(x)&&at.isPlainObject(b)?at.merge.call({caseless:I},x,b):at.isPlainObject(b)?at.merge({},b):at.isArray(b)?b.slice():b}function d(x,b,N,I){return at.isUndefined(b)?at.isUndefined(x)?void 0:o(void 0,x,0,I):o(x,b,0,I)}function h(x,b){if(!at.isUndefined(b))return o(void 0,b)}function f(x,b){return at.isUndefined(b)?at.isUndefined(x)?void 0:o(void 0,x):o(void 0,b)}function g(x,b,N){return N in i?o(x,b):N in n?o(void 0,x):void 0}const y={url:h,method:h,data:h,baseURL:f,transformRequest:f,transformResponse:f,paramsSerializer:f,timeout:f,timeoutMessage:f,withCredentials:f,withXSRFToken:f,adapter:f,responseType:f,xsrfCookieName:f,xsrfHeaderName:f,onUploadProgress:f,onDownloadProgress:f,decompress:f,maxContentLength:f,maxBodyLength:f,beforeRedirect:f,transport:f,httpAgent:f,httpsAgent:f,cancelToken:f,socketPath:f,responseEncoding:f,validateStatus:g,headers:(x,b,N)=>d(uq(x),uq(b),0,!0)};return at.forEach(Object.keys(TV(TV({},n),i)),function(x){const b=y[x]||d,N=b(n[x],i[x],x);at.isUndefined(N)&&b!==g||(s[x]=N)}),s}var hq=n=>{const i=oy({},n);let{data:s,withXSRFToken:o,xsrfHeaderName:d,xsrfCookieName:h,headers:f,auth:g}=i;if(i.headers=f=Ah.from(f),i.url=I7(lq(i.baseURL,i.url,i.allowAbsoluteUrls),n.params,n.paramsSerializer),g&&f.set("Authorization","Basic "+btoa((g.username||"")+":"+(g.password?unescape(encodeURIComponent(g.password)):""))),at.isFormData(s)){if(Kc.hasStandardBrowserEnv||Kc.hasStandardBrowserWebWorkerEnv)f.setContentType(void 0);else if(at.isFunction(s.getHeaders)){const y=s.getHeaders(),x=["content-type","content-length"];Object.entries(y).forEach(b=>{let[N,I]=b;Ge(x).call(x,N.toLowerCase())&&f.set(N,I)})}}if(Kc.hasStandardBrowserEnv&&(o&&at.isFunction(o)&&(o=o(i)),o||o!==!1&&exe(i.url))){const y=d&&h&&txe.read(h);y&&f.set(d,y)}return i},nxe=typeof XMLHttpRequest<"u"&&function(n){return new et(function(i,s){const o=hq(n);let d=o.data;const h=Ah.from(o.headers).normalize();let f,g,y,x,b,{responseType:N,onUploadProgress:I,onDownloadProgress:D}=o;function $(){x&&x(),b&&b(),o.cancelToken&&o.cancelToken.unsubscribe(f),o.signal&&o.signal.removeEventListener("abort",f)}let z=new XMLHttpRequest;function K(){if(!z)return;const oe=Ah.from("getAllResponseHeaders"in z&&z.getAllResponseHeaders());aq(function(fe){i(fe),$()},function(fe){s(fe),$()},{data:N&&N!=="text"&&N!=="json"?z.response:z.responseText,status:z.status,statusText:z.statusText,headers:oe,config:n,request:z}),z=null}z.open(o.method.toUpperCase(),o.url,!0),z.timeout=o.timeout,"onloadend"in z?z.onloadend=K:z.onreadystatechange=function(){z&&z.readyState===4&&(z.status!==0||z.responseURL&&z.responseURL.indexOf("file:")===0)&&setTimeout(K)},z.onabort=function(){z&&(s(new wr("Request aborted",wr.ECONNABORTED,n,z)),z=null)},z.onerror=function(oe){const fe=new wr(oe&&oe.message?oe.message:"Network Error",wr.ERR_NETWORK,n,z);fe.event=oe||null,s(fe),z=null},z.ontimeout=function(){let oe=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const fe=o.transitional||k7;o.timeoutErrorMessage&&(oe=o.timeoutErrorMessage),s(new wr(oe,fe.clarifyTimeoutError?wr.ETIMEDOUT:wr.ECONNABORTED,n,z)),z=null},d===void 0&&h.setContentType(null),"setRequestHeader"in z&&at.forEach(h.toJSON(),function(oe,fe){z.setRequestHeader(fe,oe)}),at.isUndefined(o.withCredentials)||(z.withCredentials=!!o.withCredentials),N&&N!=="json"&&(z.responseType=o.responseType),D&&([y,b]=Sk(D,!0),z.addEventListener("progress",y)),I&&z.upload&&([g,x]=Sk(I),z.upload.addEventListener("progress",g),z.upload.addEventListener("loadend",x)),(o.cancelToken||o.signal)&&(f=oe=>{z&&(s(!oe||oe.type?new ux(null,n,z):oe),z.abort(),z=null)},o.cancelToken&&o.cancelToken.subscribe(f),o.signal&&(o.signal.aborted?f():o.signal.addEventListener("abort",f)));const ie=function(oe){const fe=/^([-+\w]{1,25})(:?\/\/|:)/.exec(oe);return fe&&fe[1]||""}(o.url);ie&&Kc.protocols.indexOf(ie)===-1?s(new wr("Unsupported protocol "+ie+":",wr.ERR_BAD_REQUEST,n)):z.send(d||null)})},rxe=(n,i)=>{const{length:s}=n=n?n.filter(Boolean):[];if(i||s){let o,d=new AbortController;const h=function(x){if(!o){o=!0,g();const b=x instanceof Error?x:this.reason;d.abort(b instanceof wr?b:new ux(b instanceof Error?b.message:b))}};let f=i&&setTimeout(()=>{f=null,h(new wr("timeout ".concat(i," of ms exceeded"),wr.ETIMEDOUT))},i);const g=()=>{n&&(f&&clearTimeout(f),f=null,n.forEach(x=>{x.unsubscribe?x.unsubscribe(h):x.removeEventListener("abort",h)}),n=null)};n.forEach(x=>x.addEventListener("abort",h));const{signal:y}=d;return y.unsubscribe=()=>at.asap(g),y}},RV=l(x1),pq=ax.f("asyncIterator"),ixe=l(pq);function CV(n,i){this.v=n,this.k=i}function fc(n){return function(){return new YT(n.apply(this,arguments))}}function YT(n){var i,s;function o(h,f){try{var g=n[h](f),y=g.value,x=y instanceof CV;RV.resolve(x?y.v:y).then(function(b){if(x){var N=h==="return"?"return":"next";if(!y.k||b.done)return o(N,b);b=n[N](b).value}d(g.done?"return":"normal",b)},function(b){o("throw",b)})}catch(b){d("throw",b)}}function d(h,f){switch(h){case"return":i.resolve({value:f,done:!0});break;case"throw":i.reject(f);break;default:i.resolve({value:f,done:!1})}(i=i.next)?o(i.key,i.arg):s=null}this._invoke=function(h,f){return new RV(function(g,y){var x={key:h,arg:f,resolve:g,reject:y,next:null};s?s=s.next=x:(i=s=x,o(h,f))})},typeof n.return!="function"&&(this.return=void 0)}function hn(n){return new CV(n,0)}function hx(n){var i={},s=!1;function o(d,h){return s=!0,h=new RV(function(f){f(n[d](h))}),{done:!1,value:new CV(h,1)}}return i[dx!==void 0&&zK||"@@iterator"]=function(){return this},i.next=function(d){return s?(s=!1,d):o("next",d)},typeof n.throw=="function"&&(i.throw=function(d){if(s)throw s=!1,d;return o("throw",d)}),typeof n.return=="function"&&(i.return=function(d){return s?(s=!1,d):o("return",d)}),i}YT.prototype[typeof dx=="function"&&ixe||"@@asyncIterator"]=function(){return this},YT.prototype.next=function(n){return this._invoke("next",n)},YT.prototype.throw=function(n){return this._invoke("throw",n)},YT.prototype.return=function(n){return this._invoke("return",n)};var Tk=l(pq);function NV(n){var i,s,o,d=2;for(typeof Symbol<"u"&&(s=Tk,o=Symbol.iterator);d--;){if(s&&(i=n[s])!=null)return i.call(n);if(o&&(i=n[o])!=null)return new Rk(i.call(n));s="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function Rk(n){function i(s){if(Object(s)!==s)return et.reject(new TypeError(s+" is not an object."));var o=s.done;return et.resolve(s.value).then(function(d){return{value:d,done:o}})}return Rk=function(s){this.s=s,this.n=s.next},Rk.prototype={s:null,n:null,next:function(){return i(this.n.apply(this.s,arguments))},return:function(s){var o=this.s.return;return o===void 0?et.resolve({value:s,done:!0}):i(o.apply(this.s,arguments))},throw:function(s){var o=this.s.return;return o===void 0?et.reject(s):i(o.apply(this.s,arguments))}},new Rk(n)}const sxe=function*(n,i){let s=n.byteLength;if(!i||s<i)return void(yield n);let o,d=0;for(;d<s;)o=d+i,yield n.slice(d,o),d=o},axe=function(){var n=fc(function*(i,s){var o,d=!1,h=!1;try{for(var f,g=NV(oxe(i));d=!(f=yield hn(g.next())).done;d=!1){const y=f.value;yield*hx(NV(sxe(y,s)))}}catch(y){h=!0,o=y}finally{try{d&&g.return!=null&&(yield hn(g.return()))}finally{if(h)throw o}}});return function(i,s){return n.apply(this,arguments)}}(),oxe=function(){var n=fc(function*(i){if(i[Tk])return void(yield*hx(NV(i)));const s=i.getReader();try{for(;;){const{done:o,value:d}=yield hn(s.read());if(o)break;yield d}}finally{yield hn(s.cancel())}});return function(i){return n.apply(this,arguments)}}(),fq=(n,i,s,o)=>{const d=axe(n,i);let h,f=0,g=y=>{h||(h=!0,o&&o(y))};return new ReadableStream({async pull(y){try{const{done:x,value:b}=await d.next();if(x)return g(),void y.close();let N=b.byteLength;if(s){let I=f+=N;s(I)}y.enqueue(new Uint8Array(b))}catch(x){throw g(x),x}},cancel:y=>(g(y),d.return())},{highWaterMark:2})};function mq(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function gq(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?mq(Object(s),!0).forEach(function(o){Y(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):mq(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}const{isFunction:Ck}=at,cxe=(n=>{let{Request:i,Response:s}=n;return{Request:i,Response:s}})(at.global),{ReadableStream:_q,TextEncoder:yq}=at.global,vq=function(n){try{for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];return!!n(...s)}catch{return!1}},lxe=n=>{n=at.merge.call({skipUndefined:!0},cxe,n);const{fetch:i,Request:s,Response:o}=n,d=i?Ck(i):typeof fetch=="function",h=Ck(s),f=Ck(o);if(!d)return!1;const g=d&&Ck(_q),y=d&&(typeof yq=="function"?(x=new yq,$=>x.encode($)):async $=>new Uint8Array(await new s($).arrayBuffer()));var x;const b=h&&g&&vq(()=>{let $=!1;const z=new s(Kc.origin,{body:new _q,method:"POST",get duplex(){return $=!0,"half"}}).headers.has("Content-Type");return $&&!z}),N=f&&g&&vq(()=>at.isReadableStream(new o("").body)),I={stream:N&&($=>$.body)};d&&["text","arrayBuffer","blob","formData","stream"].forEach($=>{!I[$]&&(I[$]=(z,K)=>{let ie=z&&z[$];if(ie)return ie.call(z);throw new wr("Response type '".concat($,"' is not supported"),wr.ERR_NOT_SUPPORT,K)})});const D=async($,z)=>{const K=at.toFiniteNumber($.getContentLength());return K??(async ie=>ie==null?0:at.isBlob(ie)?ie.size:at.isSpecCompliantForm(ie)?(await new s(Kc.origin,{method:"POST",body:ie}).arrayBuffer()).byteLength:at.isArrayBufferView(ie)||at.isArrayBuffer(ie)?ie.byteLength:(at.isURLSearchParams(ie)&&(ie+=""),at.isString(ie)?(await y(ie)).byteLength:void 0))(z)};return async $=>{let{url:z,method:K,data:ie,signal:oe,cancelToken:fe,timeout:Ee,onDownloadProgress:Te,onUploadProgress:_e,responseType:Re,headers:je,withCredentials:Be="same-origin",fetchOptions:dt}=hq($),Ht=i||fetch;Re=Re?(Re+"").toLowerCase():"text";let Bt=rxe([oe,fe&&fe.toAbortSignal()],Ee),dn=null;const sn=Bt&&Bt.unsubscribe&&(()=>{Bt.unsubscribe()});let Qn;try{if(_e&&b&&K!=="get"&&K!=="head"&&(Qn=await D(je,ie))!==0){let B,ue=new s(z,{method:"POST",body:ie,duplex:"half"});if(at.isFormData(ie)&&(B=ue.headers.get("content-type"))&&je.setContentType(B),ue.body){const[ve,Ye]=oq(Qn,Sk(cq(_e)));ie=fq(ue.body,65536,ve,Ye)}}at.isString(Be)||(Be=Be?"include":"omit");const ei=h&&"credentials"in s.prototype,Ue=gq(gq({},dt),{},{signal:Bt,method:K.toUpperCase(),headers:je.normalize().toJSON(),body:ie,duplex:"half",credentials:ei?Be:void 0});dn=h&&new s(z,Ue);let Qe=await(h?Ht(dn,dt):Ht(z,Ue));const ft=N&&(Re==="stream"||Re==="response");if(N&&(Te||ft&&sn)){const B={};["status","statusText","headers"].forEach(Qt=>{B[Qt]=Qe[Qt]});const ue=at.toFiniteNumber(Qe.headers.get("content-length")),[ve,Ye]=Te&&oq(ue,Sk(cq(Te),!0))||[];Qe=new o(fq(Qe.body,65536,ve,()=>{Ye&&Ye(),sn&&sn()}),B)}Re=Re||"text";let Fe=await I[at.findKey(I,Re)||"text"](Qe,$);return!ft&&sn&&sn(),await new et((B,ue)=>{aq(B,ue,{data:Fe,headers:Ah.from(Qe.headers),status:Qe.status,statusText:Qe.statusText,config:$,request:dn})})}catch(ei){throw sn&&sn(),ei&&ei.name==="TypeError"&&/Load failed|fetch/i.test(ei.message)?Object.assign(new wr("Network Error",wr.ERR_NETWORK,$,dn),{cause:ei.cause||ei}):wr.from(ei,ei&&ei.code,$,dn)}}},dxe=new Map,Eq=n=>{let i=n&&n.env||{};const{fetch:s,Request:o,Response:d}=i,h=[o,d,s];let f,g,y=h.length,x=dxe;for(;y--;)f=h[y],g=x.get(f),g===void 0&&x.set(f,g=y?new Map:lxe(i)),x=g;return g};Eq();const IV={http:null,xhr:nxe,fetch:{get:Eq}};at.forEach(IV,(n,i)=>{if(n){try{Object.defineProperty(n,"name",{value:i})}catch{}Object.defineProperty(n,"adapterName",{value:i})}});const xq=n=>"- ".concat(n),uxe=n=>at.isFunction(n)||n===null||n===!1;var bq={getAdapter:function(n,i){n=at.isArray(n)?n:[n];const{length:s}=n;let o,d;const h={};for(let f=0;f<s;f++){let g;if(o=n[f],d=o,!uxe(o)&&(d=IV[(g=String(o)).toLowerCase()],d===void 0))throw new wr("Unknown adapter '".concat(g,"'"));if(d&&(at.isFunction(d)||(d=d.get(i))))break;h[g||"#"+f]=d}if(!d){const f=Object.entries(h).map(g=>{let[y,x]=g;return"adapter ".concat(y," ")+(x===!1?"is not supported by the environment":"is not available in the build")});throw new wr("There is no suitable adapter to dispatch the request "+(s?f.length>1?`since :
`+f.map(xq).join(`
`):" "+xq(f[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return d},adapters:IV};function AV(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new ux(null,n)}function wq(n){return AV(n),n.headers=Ah.from(n.headers),n.data=SV.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),bq.getAdapter(n.adapter||bV.adapter,n)(n).then(function(i){return AV(n),i.data=SV.call(n,n.transformResponse,i),i.headers=Ah.from(i.headers),i},function(i){return sq(i)||(AV(n),i&&i.response&&(i.response.data=SV.call(n,n.transformResponse,i.response),i.response.headers=Ah.from(i.response.headers))),et.reject(i)})}const Sq="1.13.2",Nk={};["object","boolean","number","function","string","symbol"].forEach((n,i)=>{Nk[n]=function(s){return typeof s===n||"a"+(i<1?"n ":" ")+n}});const Tq={};Nk.transitional=function(n,i,s){function o(d,h){return"[Axios v"+Sq+"] Transitional option '"+d+"'"+h+(s?". "+s:"")}return(d,h,f)=>{if(n===!1)throw new wr(o(h," has been removed"+(i?" in "+i:"")),wr.ERR_DEPRECATED);return i&&!Tq[h]&&(Tq[h]=!0,console.warn(o(h," has been deprecated since v"+i+" and will be removed in the near future"))),!n||n(d,h,f)}},Nk.spelling=function(n){return(i,s)=>(console.warn("".concat(s," is likely a misspelling of ").concat(n)),!0)};var Ik={assertOptions:function(n,i,s){if(typeof n!="object")throw new wr("options must be an object",wr.ERR_BAD_OPTION_VALUE);const o=Object.keys(n);let d=o.length;for(;d-- >0;){const h=o[d],f=i[h];if(f){const g=n[h],y=g===void 0||f(g,h,n);if(y!==!0)throw new wr("option "+h+" must be "+y,wr.ERR_BAD_OPTION_VALUE)}else if(s!==!0)throw new wr("Unknown option "+h,wr.ERR_BAD_OPTION)}},validators:Nk};const $p=Ik.validators;let Ak=class{constructor(n){this.defaults=n||{},this.interceptors={request:new A7,response:new A7}}async request(n,i){try{return await this._request(n,i)}catch(s){if(s instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const d=o.stack?o.stack.replace(/^.+\n/,""):"";try{s.stack?d&&!String(s.stack).endsWith(d.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+d):s.stack=d}catch{}}throw s}}_request(n,i){typeof n=="string"?(i=i||{}).url=n:i=n||{},i=oy(this.defaults,i);const{transitional:s,paramsSerializer:o,headers:d}=i;s!==void 0&&Ik.assertOptions(s,{silentJSONParsing:$p.transitional($p.boolean),forcedJSONParsing:$p.transitional($p.boolean),clarifyTimeoutError:$p.transitional($p.boolean)},!1),o!=null&&(at.isFunction(o)?i.paramsSerializer={serialize:o}:Ik.assertOptions(o,{encode:$p.function,serialize:$p.function},!0)),i.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?i.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:i.allowAbsoluteUrls=!0),Ik.assertOptions(i,{baseUrl:$p.spelling("baseURL"),withXsrfToken:$p.spelling("withXSRFToken")},!0),i.method=(i.method||this.defaults.method||"get").toLowerCase();let h=d&&at.merge(d.common,d[i.method]);d&&at.forEach(["delete","get","head","post","put","patch","common"],D=>{delete d[D]}),i.headers=Ah.concat(h,d);const f=[];let g=!0;this.interceptors.request.forEach(function(D){typeof D.runWhen=="function"&&D.runWhen(i)===!1||(g=g&&D.synchronous,f.unshift(D.fulfilled,D.rejected))});const y=[];let x;this.interceptors.response.forEach(function(D){y.push(D.fulfilled,D.rejected)});let b,N=0;if(!g){const D=[wq.bind(this),void 0];for(D.unshift(...f),D.push(...y),b=D.length,x=et.resolve(i);N<b;)x=x.then(D[N++],D[N++]);return x}b=f.length;let I=i;for(;N<b;){const D=f[N++],$=f[N++];try{I=D(I)}catch(z){$.call(this,z);break}}try{x=wq.call(this,I)}catch(D){return et.reject(D)}for(N=0,b=y.length;N<b;)x=x.then(y[N++],y[N++]);return x}getUri(n){return I7(lq((n=oy(this.defaults,n)).baseURL,n.url,n.allowAbsoluteUrls),n.params,n.paramsSerializer)}};at.forEach(["delete","get","head","options"],function(n){Ak.prototype[n]=function(i,s){return this.request(oy(s||{},{method:n,url:i,data:(s||{}).data}))}}),at.forEach(["post","put","patch"],function(n){function i(s){return function(o,d,h){return this.request(oy(h||{},{method:n,headers:s?{"Content-Type":"multipart/form-data"}:{},url:o,data:d}))}}Ak.prototype[n]=i(),Ak.prototype[n+"Form"]=i(!0)});var kk=Ak;class kV{constructor(i){if(typeof i!="function")throw new TypeError("executor must be a function.");let s;this.promise=new et(function(d){s=d});const o=this;this.promise.then(d=>{if(!o._listeners)return;let h=o._listeners.length;for(;h-- >0;)o._listeners[h](d);o._listeners=null}),this.promise.then=d=>{let h;const f=new et(g=>{o.subscribe(g),h=g}).then(d);return f.cancel=function(){o.unsubscribe(h)},f},i(function(d,h,f){o.reason||(o.reason=new ux(d,h,f),s(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(i){this.reason?i(this.reason):this._listeners?this._listeners.push(i):this._listeners=[i]}unsubscribe(i){if(!this._listeners)return;const s=this._listeners.indexOf(i);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const i=new AbortController,s=o=>{i.abort(o)};return this.subscribe(s),i.signal.unsubscribe=()=>this.unsubscribe(s),i.signal}static source(){let i;return{token:new kV(function(o){i=o}),cancel:i}}}var hxe=kV;const PV={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(PV).forEach(n=>{let[i,s]=n;PV[s]=i});var pxe=PV;const Ya=function n(i){const s=new kk(i),o=h7(kk.prototype.request,s);return at.extend(o,kk.prototype,s,{allOwnKeys:!0}),at.extend(o,s,null,{allOwnKeys:!0}),o.create=function(d){return n(oy(i,d))},o}(bV);Ya.Axios=kk,Ya.CanceledError=ux,Ya.CancelToken=hxe,Ya.isCancel=sq,Ya.VERSION=Sq,Ya.toFormData=uk,Ya.AxiosError=wr,Ya.Cancel=Ya.CanceledError,Ya.all=function(n){return et.all(n)},Ya.spread=function(n){return function(i){return n.apply(null,i)}},Ya.isAxiosError=function(n){return at.isObject(n)&&n.isAxiosError===!0},Ya.mergeConfig=oy,Ya.AxiosHeaders=Ah,Ya.formToJSON=n=>rq(at.isHTMLForm(n)?new FormData(n):n),Ya.getAdapter=bq.getAdapter,Ya.HttpStatusCode=pxe,Ya.default=Ya;var mc=Ya;const fxe=()=>{};function $T(){const n={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:fxe};return n.promise=new et((i,s)=>{n.resolve=o=>{n.isFinished||(n.isResolved=!0,n.isFinished=!0,i(o),n.value=o)},n.reject=o=>{n.isFinished||(n.isRejected=!0,n.isFinished=!0,s(o))}}),n}const Pk=new Map,Dk=new Map,Xp=new Map;let Is=function(n){return n.WIN_10="Windows 10",n.WIN_81="Windows 8.1",n.WIN_8="Windows 8",n.WIN_7="Windows 7",n.WIN_VISTA="Windows Vista",n.WIN_SERVER_2003="Windows Server 2003",n.WIN_XP="Windows XP",n.WIN_2000="Windows 2000",n.ANDROID="Android",n.HARMONY_OS="HarmonyOS",n.OPEN_BSD="Open BSD",n.SUN_OS="Sun OS",n.LINUX="Linux",n.IOS="iOS",n.MAC_OS="Mac OS",n.CHROMIUM_OS="Chromium OS",n.QNX="QNX",n.UNIX="UNIX",n.BEOS="BeOS",n.OS_2="OS/2",n.SEARCH_BOT="Search Bot",n}({}),$n=function(n){return n.CHROME="Chrome",n.SAFARI="Safari",n.EDGE="Edge",n.FIREFOX="Firefox",n.OPERA="OPR",n.QQ="QQBrowser",n.WECHAT="MicroMessenger",n}({});const Rq=new $0e;let kh=Rq.getResult(),DV=null;function Wn(n){if(!DV){kh=Rq.getResult();const i=function(g){if(g.engine.name==="Blink"&&g.browser.name!=="WeChat")return $n.CHROME;switch(g.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return $n.CHROME;case"Safari":case"Mobile Safari":return $n.SAFARI;case"Edge":return $n.EDGE;case"Firefox":return $n.FIREFOX;case"QQ":case"QQBrowser":return $n.QQ;case"Opera":return $n.OPERA;case"WeChat":return $n.WECHAT;default:return g.browser.name||""}}(kh),s=Cq(kh),o=function(g){return g.os.name==="Windows"?g.os.version?g.os.name+" "+g.os.version:g.os.name:g.os.name||""}(kh),d=kh.os.version,h=Cq(kh,!1),f=kh.device.type;if(!(i&&s&&o&&d))return{name:i,version:s,os:o,osVersion:d,browserVersion:h,deviceType:f};DV={name:i,version:s,os:o,osVersion:d,browserVersion:h,deviceType:f}}return DV}function Cq(n){let i,s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return i=n.engine.name==="Blink"?n.engine.version||"":n.browser.version||"",s?i.split(".")[0]:i}function Ok(){return Wn().os}function Nq(){const n=Wn();return"".concat(n.os," ").concat(n.osVersion)}function Lk(){const n=Wn();return!!(kh.engine.name==="WebKit"&&n.os===Is.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&n.name!==$n.SAFARI||$a()&&n.name!==$n.SAFARI)}function lm(){return Wn().name===$n.CHROME}function Ks(){return Wn().name===$n.SAFARI}function Iq(){const n=Wn();if(n.name!==$n.SAFARI||!n.browserVersion)return!1;const i=n.browserVersion.split(".");return Number(i[0])>15||Number(i[0])===15&&Number(i[1])>=4}function Aq(){return Wn().name===$n.EDGE}function Kr(){return Wn().name===$n.FIREFOX}function $a(){return Wn().os===Is.IOS}function Ph(n){const i=Wn();return!(i.name!==$n.CHROME||!i.osVersion)&&Number(i.version)>=n}function kq(n){const i=Wn();return!(i.name!==$n.CHROME||!i.osVersion)&&Number(i.version)<n}function OV(n,i,s){const o=Wn();return!(o.name!==n||!o.osVersion)&&(s?Number(o.version)>=i&&Number(o.version)<=s:Number(o.version)===i)}function Gg(n){const i=Wn();return!(i.name!==$n.EDGE||!i.osVersion)&&Number(i.version)>=n}function LV(n){const i=Wn();return!(i.name!==$n.FIREFOX||!i.osVersion)&&Number(i.version)>=n}function Pq(n){const i=Wn();return!(i.name!==$n.SAFARI||!i.osVersion)&&Number(i.version)>=n}function Dq(n,i,s){const o=Wn();if(o.os!==Is.IOS||!o.osVersion)return!1;const d=o.osVersion.split(".");return s?i&&Number(d[0])===n&&Number(d[1])>i||Number(d[0])>n:i?Number(d[0])===n&&Number(d[1])>=i||Number(d[0])>n:Number(d[0])>=n}function Oq(n,i,s){const o=Wn();if(o.os!==Is.IOS||!o.osVersion)return!1;const d=o.osVersion.split(".");return s?i&&Number(d[0])===n&&Number(d[1])<i||Number(d[0])<n:i?Number(d[0])===n&&Number(d[1])<=i||Number(d[0])<n:Number(d[0])<=n}function jV(n,i,s){const o=Wn();if(o.name!==$n.SAFARI||!o.osVersion||!o.browserVersion)return!1;const d=o.browserVersion.split(".");return s?i&&Number(d[0])===n&&Number(d[1])<i||Number(d[0])<n:i?Number(d[0])===n&&Number(d[1])<=i||Number(d[0])<n:Number(d[0])<=n}function cy(n){const i=Wn();return!(i.name!==$n.OPERA||!i.osVersion)&&Number(i.version)>=n}function Lq(){const n=Wn();if(n.os!==Is.IOS||!n.osVersion)return!1;const i=n.osVersion.split(".");return Number(i[0])<14||Number(i[0])===14&&Number(i[1])<=6}function px(){const n=Wn();if(n.os!==Is.IOS||!n.osVersion)return!1;const i=n.osVersion.split(".");return Number(i[0])===15}function MV(){const n=Wn();if(n.os!==Is.IOS||!n.osVersion)return!1;const i=n.osVersion.split(".");return Number(i[0])===16}function jq(){const n=Wn();if(n.os!==Is.IOS||!n.osVersion)return!1;const i=n.osVersion.split(".");return Number(i[0])===15&&Number(i[1])>=1}function ku(){return Ks()&&navigator.maxTouchPoints>0}function Mq(){return Wn().name===$n.WECHAT}function Uq(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function Vq(){const n=Ok();return function(){const{deviceType:i}=Wn();return i==="mobile"||i==="tablet"}()||n===Is.ANDROID||n===Is.IOS||n===Is.HARMONY_OS}function Jp(){const n=Wn();return n.name!==$n.EDGE&&n.name!==$n.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function XT(){return Ok()===Is.ANDROID}function JT(){const n=Wn();return XT()&&(n.name===$n.CHROME||n.name===$n.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function tn(n,i,s){return(i=function(o){var d=function(h,f){if(typeof h!="object"||!h)return h;var g=h[Symbol.toPrimitive];if(g!==void 0){var y=g.call(h,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(h)}(o);return typeof d=="symbol"?d:d+""}(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function Fq(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function Je(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?Fq(Object(s),!0).forEach(function(o){tn(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):Fq(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}let se=function(n){return n.UNEXPECTED_ERROR="UNEXPECTED_ERROR",n.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",n.TIMEOUT="TIMEOUT",n.INVALID_PARAMS="INVALID_PARAMS",n.NOT_READABLE="NOT_READABLE",n.NOT_SUPPORTED="NOT_SUPPORTED",n.INVALID_OPERATION="INVALID_OPERATION",n.OPERATION_ABORTED="OPERATION_ABORTED",n.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",n.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",n.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",n.DATACHANNEL_FAILED="DATACHANNEL_FAILED",n.NETWORK_ERROR="NETWORK_ERROR",n.NETWORK_TIMEOUT="NETWORK_TIMEOUT",n.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",n.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",n.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",n.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",n.ELECTRON_IS_NULL="ELECTRON_IS_NULL",n.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",n.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",n.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",n.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",n.PERMISSION_DENIED="PERMISSION_DENIED",n.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",n.TRACK_IS_DISABLED="TRACK_IS_DISABLED",n.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",n.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",n.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",n.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",n.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",n.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",n.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",n.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",n.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",n.UID_CONFLICT="UID_CONFLICT",n.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",n.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",n.TOKEN_EXPIRE="TOKEN_EXPIRE",n.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",n.INVALID_TRACK="INVALID_TRACK",n.SENDER_NOT_FOUND="SENDER_NOT_FOUND",n.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",n.SET_ANSWER_FAILED="SET_ANSWER_FAILED",n.ICE_FAILED="ICE_FAILED",n.PC_CLOSED="PC_CLOSED",n.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",n.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",n.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",n.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",n.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",n.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",n.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",n.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",n.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",n.INVALID_REMOTE_USER="INVALID_REMOTE_USER",n.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",n.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",n.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",n.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",n.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",n.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",n.WS_ABORT="WS_ABORT",n.WS_DISCONNECT="WS_DISCONNECT",n.WS_ERR="WS_ERR",n.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",n.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",n.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",n.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",n.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",n.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",n.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",n.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",n.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",n.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",n.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",n.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",n.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",n.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",n.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",n.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",n.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",n.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",n.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",n.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",n.INVALID_PLUGIN="INVALID_PLUGIN",n.DISCONNECT_P2P="DISCONNECT_P2P",n.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",n.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",n.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",n.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",n.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",n.PROHIBITED_OPERATION="PROHIBITED_OPERATION",n.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",n.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",n}({}),Pe=class extends Error{constructor(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0;super(i),tn(this,"code",void 0),tn(this,"message",void 0),tn(this,"data",void 0),tn(this,"name","AgoraRTCException"),this.code=n,this.message="AgoraRTCError ".concat(this.code,": ").concat(i),this.data=s}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",i=arguments.length>1?arguments[1]:void 0;return n==="error"&&(i||console).error(this.toString()),n==="warning"&&(i||console).warn(this.toString()),this}throw(n){throw this.print("error",n),this}};function Pu(n,i){if(typeof n!="boolean")throw new Pe(se.INVALID_PARAMS,"Invalid ".concat(i,": The value is of the boolean type."))}function zi(n,i,s){if(!Ge(s).call(s,n))throw new Pe(se.INVALID_PARAMS,"".concat(i," can only be set as ").concat(JSON.stringify(s)))}function Sr(n,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(n<s||n>o||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(d){return typeof d=="number"&&d%1==0}(n))throw new Pe(se.INVALID_PARAMS,"invalid ".concat(i,": the value range is [").concat(s,", ").concat(o,"]. integer only"))}function UV(n,i){if(typeof n!="number"){if(!(n.min||n.max||n.ideal||n.exact))throw new Pe(se.INVALID_PARAMS,"".concat(i," is not a valid ConstrainLong"));n.min!==void 0&&Sr(n.min,"".concat(i,".min"),0,1/0),n.max!==void 0&&Sr(n.max,"".concat(i,".max"),1,1/0),n.exact!==void 0&&Sr(n.exact,"".concat(i,".exact"),1,1/0),n.ideal!==void 0&&Sr(n.ideal,"".concat(i,".ideal"),1,1/0)}else Sr(n,i,1,1/0)}function la(n,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,d=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(n==null)throw new Pe(se.INVALID_PARAMS,"".concat(i||"param"," cannot be empty"));if(!Bq(n,s,o,d))throw new Pe(se.INVALID_PARAMS,"Invalid ".concat(i||"string param",": Length of the string: [").concat(s,",").concat(o,"].").concat(d?" ASCII characters only.":""))}function dm(n,i){if(!Array.isArray(n))throw new Pe(se.INVALID_PARAMS,"".concat(i," should be an array"))}function bi(n){return n==null}function Bq(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,o=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof n=="string"&&n.length<=s&&n.length>=i&&(!o||function(d){if(typeof d!="string")return!1;for(let h=0;h<d.length;h+=1){const f=d.charCodeAt(h);if(f<0||f>255)return!1}return!0}(n))}function zq(n,i,s){if("getBigUint64"in DataView.prototype)return n.getBigUint64(i,s);const o=n.getUint32(i,s),d=n.getUint32(i+4,s),h=0,f=+!s;return BigInt(o*f+d*h)<<BigInt(32)|BigInt(o*h+d*f)}function Gq(n,i,s,o){if("setBigUint64"in DataView.prototype)return n.setBigUint64(i,s,o);const d=Number(s>>BigInt(32)),h=Number(s&BigInt(4294967295));n.setUint32(i,d,o),n.setUint32(i+4,h,o)}var QT=function(n){return n.COVERED="COVERED",n.POSITION="POSITION",n.SIZE="SIZE",n.STYLE="STYLE",n}(QT||{}),VV=function(n){return n.UNMOUNTED="UNMOUNTED",n.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",n}(VV||{});const Wq=new class{constructor(){tn(this,"_clientSize",null),tn(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),tn(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),tn(this,"getStyle",n=>window.getComputedStyle(n,null)),tn(this,"checkCssVisibleProperty",n=>{var i;let s=!0;const o=this.getStyle(n),{display:d,visibility:h,opacity:f,filter:g}=o;return(d==="none"||Ge(i=["hidden","collapse"]).call(i,h)||Number(f)<.1)&&(s=!1),!!s&&(g&&g.split(" ").filter(y=>{var x;const b=y.split("(")[0];return Ge(x=["brightness","blur","opacity"]).call(x,b)}).map(y=>{const[x,b]=y.split(/\(|\)/);return[x,Number(b.match(/^[0-9\.]+/))]}).forEach(y=>{const[x,b]=y;switch(x){case"brightness":(b<.1||b>3)&&(s=!1);break;case"blur":b>3&&(s=!1);break;case"opacity":b<.1&&(s=!1)}}),s)}),tn(this,"checkPropertyUpToAllParentNodes",(n,i)=>{let s=!0,o=!0;const d=f=>i(f);let h=n;for(;h&&o;)d(h)||(s=!1,o=!1),h=h.parentElement,h||(o=!1);return s}),tn(this,"checkActualCssVisibleIncludeInherit",n=>this.checkPropertyUpToAllParentNodes(n,this.checkCssVisibleProperty)),tn(this,"getSizeAboutClient",n=>{const{width:i,height:s,left:o,right:d,top:h,bottom:f}=n.getBoundingClientRect(),g=this.getClientWidth(),y=this.getClientHeight();return{width:i,height:s,left:o,right:d,top:h,bottom:f,clientWidth:g,clientHeight:y,clientMin:Math.min(g,y)}}),tn(this,"checkActualSize",()=>{const{width:n,height:i,clientMin:s}=this._clientSize;return this.checkSizeIsVisible(n,i,s)}),tn(this,"elementFromPoint",(n,i)=>document.elementFromPoint?document.elementFromPoint(n,i):null),tn(this,"checkCoverForAPoint",(n,i,s)=>{const o=this.elementFromPoint(n,i);return o!==null&&o!==s}),tn(this,"getPointPositionList",()=>{const{width:n,height:i,left:s,top:o}=this._clientSize,d=n/6,h=i/6,f=[],g=10**6;for(let y=0;y<5;y++)for(let x=0;x<5;x++){const b=(s*g+(y===0?.1:y===4?(d*y*g-1e5)/g:d*y)*g)/g,N=(o*g+(x===0?.1:x===4?(h*x*g-1e5)/g:h*x)*g)/g;f.push({x:b,y:N})}return[...f]}),tn(this,"checkElementCover",n=>this.getPointPositionList().map(i=>this.checkCoverForAPoint(i.x,i.y,n)).filter(i=>!!i).length>6),tn(this,"checkSizeIsVisible",(n,i,s)=>(n>50||s/n<=10)&&(i>50||s/i<=10)),tn(this,"checkSizeOfPartInClient",()=>{const{left:n,right:i,top:s,bottom:o,clientHeight:d,clientWidth:h,clientMin:f}=this._clientSize;let g,y,x,b;if(n<0)g=0;else{if(!(n<h))return!1;g=n}if(i<0)return!1;if(y=i<h?i:h,s<0)x=0;else{if(!(s<d))return!1;x=s}if(o<0)return!1;b=o<d?o:d;const N=y-g,I=b-x;return this.checkSizeIsVisible(N,I,f)}),tn(this,"returnHiddenResult",n=>(this._clientSize=null,{visible:!1,reason:n})),tn(this,"checkOneElementVisible",n=>{if(n instanceof HTMLElement){if(this.checkElementIsMountedOnDom(n)){if(this.checkActualCssVisibleIncludeInherit(n)){if(this._clientSize=this.getSizeAboutClient(n),this.checkElementCover(n))return this.returnHiddenResult(QT.COVERED);{const i=this.checkActualSize(),s=this.checkSizeOfPartInClient();return i&&!s?this.returnHiddenResult(QT.POSITION):i?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(QT.SIZE)}}return this.returnHiddenResult(QT.STYLE)}return this.returnHiddenResult(VV.UNMOUNTED)}return this.returnHiddenResult(VV.INVALID_HTML_ELEMENT)}),tn(this,"checkElementIsMountedOnDom",n=>this.checkPropertyUpToAllParentNodes(n,i=>i.nodeName.toUpperCase()!=="HTML"?i.parentElement!==null:!!document.documentElement))}};function FV(n){return new TextEncoder().encode(n)}const Hq=function(n,i){const s=new Uint8Array(n.byteLength+i.byteLength);return s.set(new Uint8Array(n),0),s.set(new Uint8Array(i),n.byteLength),s},BV=async n=>function(i,s){let o="";return new Uint8Array(i).forEach(d=>{o+=d.toString(s).padStart(2,"0")}),o}(await crypto.subtle.digest("SHA-256",FV(n)),16);let ai=class{constructor(){tn(this,"_events",{}),tn(this,"addListener",this.on)}getListeners(n){return this._events[n]?this._events[n].map(i=>i.listener):[]}on(n,i){this._events[n]||(this._events[n]=[]);const s=this._events[n];this._indexOfListener(s,i)===-1&&s.push({listener:i,once:!1})}once(n,i){this._events[n]||(this._events[n]=[]);const s=this._events[n];this._indexOfListener(s,i)===-1&&s.push({listener:i,once:!0})}off(n,i){if(!this._events[n])return;const s=this._events[n],o=this._indexOfListener(s,i);o!==-1&&s.splice(o,1),this._events[n].length===0&&delete this._events[n]}removeAllListeners(n){n?delete this._events[n]:this._events={}}emit(n){this._events[n]||(this._events[n]=[]);const i=this._events[n].map(h=>h);for(var s=arguments.length,o=new Array(s>1?s-1:0),d=1;d<s;d++)o[d-1]=arguments[d];for(let h=0;h<i.length;h+=1){const f=i[h];f.once&&this.off(n,f.listener),f.listener.apply(this,o||[])}}safeEmit(n){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];[...this._events[n]||[]].forEach(d=>{d.once&&this.off(n,d.listener);try{d.listener.apply(this,s)}catch(h){console.error("safeEmit event:".concat(n," error ").concat(h==null?void 0:h.toString()))}})}_indexOfListener(n,i){let s=n.length;for(;s--;)if(n[s].listener===i)return s;return-1}},ZT=null;function Kq(){if(ZT)return ZT;if(window.electron)return ZT=window.electron;if(!window.require)return null;try{return ZT=window.require("electron"),ZT}catch{return null}}let Qr=function(n){return n.CREATE_CLIENT="createClient",n.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",n.SET_AREA="setArea",n.PRELOAD="PRELOAD",n.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",n.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",n.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",n.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",n.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",n.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",n.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",n.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",n.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",n.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",n.START_PROXY_SERVER="Client.startProxyServer",n.STOP_PROXY_SERVER="Client.stopProxyServer",n.SET_PROXY_SERVER="Client.setProxyServer",n.SET_TURN_SERVER="Client.setTurnServer",n.SET_CLIENT_ROLE="Client.setClientRole",n.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",n.ENABLE_DUAL_STREAM="Client.enableDualStream",n.DISABLE_DUAL_STREAM="Client.disableDualStream",n.JOIN="Client.join",n.LEAVE="Client.leave",n.PUBLISH="Client.publish",n.UNPUBLISH="Client.unpublish",n.SUBSCRIBE="Client.subscribe",n.MASS_SUBSCRIBE="Client.massSubscribe",n.MASS_UNSUBSCRIBE="Client.massUnsubscribe",n.UNSUBSCRIBE="Client.unsubscribe",n.RENEW_TOKEN="Client.renewToken",n.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",n.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",n.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",n.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",n.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",n.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",n.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",n.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",n.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",n.START_LIVE_STREAMING="Client.startLiveStreaming",n.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",n.STOP_LIVE_STREAMING="Client.stopLiveStreaming",n.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",n.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",n.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",n.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",n.SET_CONFIG_DISTRIBUTE="_configDistribute",n.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",n.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",n.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",n.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",n.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",n.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",n.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",n.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",n.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",n.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",n.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",n.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",n.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",n.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",n.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",n.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",n.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",n.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",n.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",n.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",n.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",n.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",n.STREAM_TYPE_CHANGE="streamTypeChange",n.CONNECTION_STATE_CHANGE="connectionStateChange",n.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",n.IMAGE_MODERATION_UPLOAD="imageModerationUpload",n.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",n.PRELOAD_MEDIA_FAILED="preloadMediaFailed",n.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",n.VOS_FALLBACK_CN="vosFallbackCN",n.DATACHANNEL_FAILBACK="datachannelFailback",n}({}),Tr=function(n){return n.TRACER="tracer",n}({});function qq(n){return Sr(n.timeout,"config.timeout",0,1e5),Sr(n.timeoutFactor,"config.timeoutFactor",0,100,!1),Sr(n.maxRetryCount,"config.maxRetryConfig",0,1/0),Sr(n.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let mxe=function(n){return n[n.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",n[n.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",n[n.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",n}({}),Rn=function(n){return n.LEAVE="LEAVE",n.NETWORK_ERROR="NETWORK_ERROR",n.SERVER_ERROR="SERVER_ERROR",n.UID_BANNED="UID_BANNED",n.FALLBACK="FALLBACK",n.IP_BANNED="IP_BANNED",n.CHANNEL_BANNED="CHANNEL_BANNED",n.LICENSE_MISSING="LICENSE_MISSING",n.LICENSE_EXPIRED="LICENSE_EXPIRED",n.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",n.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",n.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",n.LICENSE_ILLEGAL="LICENSE_ILLEGAL",n.TOKEN_EXPIRE="TOKEN_EXPIRE",n.FALLBACK_TO_HLS="FALLBACK_TO_HLS",n.UID_CONFLICT="UID_CONFLICT",n}({});function ly(n){if(!Array.isArray(n)||n.length<1)return!1;try{n.forEach(i=>{if(!i.urls)throw Error()})}catch{return!1}return!0}function Yq(n){return la(n.turnServerURL,"turnServerURL"),la(n.username,"username"),la(n.password,"password"),n.udpport&&Sr(n.udpport,"udpport",1,99999,!0),n.forceturn&&Pu(n.forceturn,"forceturn"),n.security&&Pu(n.security,"security"),n.tcpport&&Sr(n.tcpport,"tcpport",1,99999,!0),!0}let fx=function(n){return n[n.AUTO_SIMULCAST_STREAM=-1]="AUTO_SIMULCAST_STREAM",n[n.DISABLE_SIMULCAST_STREM=0]="DISABLE_SIMULCAST_STREM",n[n.ENABLE_SIMULCAST_STREAM=1]="ENABLE_SIMULCAST_STREAM",n}({});function zV(n){return n.level!==void 0&&zi(n.level,"level",[1,2,3]),n.delay!==void 0&&Sr(n.delay,"delay",0,3e3,!0),!0}let gn=function(n){return n.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",n.AUDIO_METADATA="audio-metadata",n.AUDIO_PTS="audio-pts",n.CONNECTION_STATE_CHANGE="connection-state-change",n.MEDIA_RECONNECT_START="media-reconnect-start",n.MEDIA_RECONNECT_END="media-reconnect-end",n.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",n.USER_JOINED="user-joined",n.USER_LEAVED="user-left",n.USER_PUBLISHED="user-published",n.USER_UNPUBLISHED="user-unpublished",n.USER_INFO_UPDATED="user-info-updated",n.CLIENT_BANNED="client-banned",n.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",n.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",n.VOLUME_INDICATOR="volume-indicator",n.CRYPT_ERROR="crypt-error",n.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",n.NETWORK_QUALITY="network-quality",n.STREAM_TYPE_CHANGED="stream-type-changed",n.STREAM_FALLBACK="stream-fallback",n.RECEIVE_METADATA="receive-metadata",n.STREAM_MESSAGE="stream-message",n.LIVE_STREAMING_ERROR="live-streaming-error",n.LIVE_STREAMING_WARNING="live-streaming-warning",n.EXCEPTION="exception",n.ERROR="error",n.P2P_LOST="p2p_lost",n.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",n.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",n.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",n.PUBLISHED_USER_LIST="published-user-list",n.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",n.CONTENT_INSPECT_ERROR="content-inspect-error",n.CONTENT_INSPECT_RESULT="content-inspect-result",n.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",n.FALLBACK_TO_HLS="fallback-to-hls",n.FIRST_VIDEO_BUFFER_READY="first-video-buffer-ready",n.FIRST_VIDEO_PRE_RENDER="first-video-pre-render",n.AV1_DECODABLE_RESULT="av1-decodable-result",n}({}),GV=function(n){return n.CONFIG="config",n.VOSERROR="vos_error",n.AP_ERROR="ap_error",n}({}),va=function(n){return n.NETWORK_ERROR="NETWORK_ERROR",n.SERVER_ERROR="SERVER_ERROR",n.MULTI_IP="MULTI_IP",n.TIMEOUT="TIMEOUT",n.OFFLINE="OFFLINE",n.LEAVE="LEAVE",n.P2P_FAILED="P2P_FAILED",n.FALLBACK="FALLBACK",n.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",n}({}),jo=function(n){return n.ONLINE="ONLINE",n.OFFLINE="OFFLINE",n}({}),dy=function(n){return n.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",n.ONLINE="ONLINE",n.OFFLINE="OFFLINE",n}({});function rs(n,i){for(var s=arguments.length,o=new Array(s>2?s-2:0),d=2;d<s;d++)o[d-2]=arguments[d];return n.getListeners(i).length===0?et.reject(new Pe(se.UNEXPECTED_ERROR,"can not emit promise")):new et((h,f)=>{n.emit(i,...o,h,f)})}function Or(n,i){if(n.getListeners(i).length===0)return et.resolve();for(var s=arguments.length,o=new Array(s>2?s-2:0),d=2;d<s;d++)o[d-2]=arguments[d];return rs(n,i,...o)}function El(n,i){if(n.getListeners(i).length===0)return null;for(var s=arguments.length,o=new Array(s>2?s-2:0),d=2;d<s;d++)o[d-2]=arguments[d];return uy(n,i,...o)}function uy(n,i){let s=null,o=null;for(var d=arguments.length,h=new Array(d>2?d-2:0),f=2;f<d;f++)h[f-2]=arguments[f];if(n.emit(i,...h,g=>{s=g},g=>{o=g}),o!==null)throw o;if(s===null)throw new Pe(se.UNEXPECTED_ERROR,"handler is not sync");return s}const wi=new class extends ai{set networkState(n){this.emit(dy.NETWORK_STATE_CHANGE,n,this._networkState),n===jo.ONLINE?this.emit(dy.ONLINE):n===jo.OFFLINE&&(this.onlineWaiter=new et(i=>{this.once(dy.ONLINE,()=>{this.onlineWaiter=void 0,i(jo.ONLINE)})}),this.emit(dy.OFFLINE)),this._networkState=n}get networkState(){return this._networkState}get isOnline(){return this._networkState===jo.ONLINE}constructor(){super(),tn(this,"_moduleName","network-indicator"),tn(this,"_networkState",jo.ONLINE),tn(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=jo.ONLINE}),window.addEventListener("offline",()=>{this.networkState=jo.OFFLINE})}},gc=[];for(let n=0;n<256;++n)gc.push((n+256).toString(16).slice(1));const $q=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);let WV;const gxe=new Uint8Array(16);function _xe(){return $q?$q():function(s,o,d){var h,f,g,y;const x=(h=(f=(s=s||{}).random)!==null&&f!==void 0?f:(g=(y=s).rng)===null||g===void 0?void 0:g.call(y))!==null&&h!==void 0?h:function(){if(!WV){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");WV=crypto.getRandomValues.bind(crypto)}return WV(gxe)}();if(x.length<16)throw new Error("Random bytes length must be >= 16");if(x[6]=15&x[6]|64,x[8]=63&x[8]|128,o){if((d=d||0)<0||d+16>o.length)throw new RangeError("UUID byte range ".concat(d,":").concat(d+15," is out of buffer bounds"));for(let b=0;b<16;++b)o[d+b]=x[b];return o}return function(b){let N=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(gc[b[N+0]]+gc[b[N+1]]+gc[b[N+2]]+gc[b[N+3]]+"-"+gc[b[N+4]]+gc[b[N+5]]+"-"+gc[b[N+6]]+gc[b[N+7]]+"-"+gc[b[N+8]]+gc[b[N+9]]+"-"+gc[b[N+10]]+gc[b[N+11]]+gc[b[N+12]]+gc[b[N+13]]+gc[b[N+14]]+gc[b[N+15]]).toLowerCase()}(x)}(n,i,void 0);var n,i}function jk(n,i){const s=n.indexOf(i);s!==-1&&n.splice(s,1)}function mx(n){const i=[];return n.forEach(s=>{i.indexOf(s)===-1&&i.push(s)}),i}function Mk(n){et!==void 0?et.resolve().then(n):setTimeout(n,0)}function qr(n){return JSON.parse(JSON.stringify(n))}function hy(n){try{return qr(n)}catch{return n}}const Xq={};function Wg(n,i){Xq[i]||(Xq[i]=!0,n())}function py(n){const i=window.atob(n),s=new Uint8Array(new ArrayBuffer(i.length));for(let o=0;o<i.length;o+=1)s[o]=i.charCodeAt(o);return s}function Hg(n){let i="";for(let s=0;s<n.length;s+=1)i+=String.fromCharCode(n[s]);return window.btoa(i)}function Jq(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,s=new TextEncoder().encode(n);if(s.length>i)s=s.slice(0,i);else if(s.length<i){const o=new Uint8Array(i);o.set(s),s=o}return s}function Qq(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];const o=lc(i).call(i,(f,g)=>f+g.length,0),d=new Uint8Array(new ArrayBuffer(o));let h=0;return i.forEach(f=>{d.set(f,h),h+=f.length}),d}function Qp(n){return window.TextEncoder?new TextEncoder().encode(n).length:n.length}function Zq(n){let i=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&n.realFormData&&(n=n.realFormData),n.forEach(s=>{i+=typeof s=="string"?Qp(s):s.size}),i+138}function yxe(n){const i=new Pe(se.TIMEOUT,"timeout");return new et((s,o)=>{window.setTimeout(()=>o(i),n)})}function As(n){return new et(i=>{window.setTimeout(i,n)})}function dr(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,i=arguments.length>1?arguments[1]:void 0;const s=Math.random().toString(16).substr(2,n).toLowerCase();return s.length===n?"".concat(i).concat(s):"".concat(i).concat(s)+dr(n-s.length,"")}function fy(){let n,i=!1;try{var s;n=Y0e(s=_xe()).call(s,"-","")}catch{i=!0}return!i&&n&&n.length===32||(n=dr(32,"")),n.toUpperCase()}const eR=()=>{},eY=new class{constructor(){tn(this,"fnMap",new Map)}throttleByKey(n,i,s,o){for(var d=arguments.length,h=new Array(d>4?d-4:0),f=4;f<d;f++)h[f-4]=arguments[f];if(this.fnMap.has(i)){const g=this.fnMap.get(i);if(g.threshold!==s){g.fn(...g.args),clearTimeout(g.timer);const y=window.setTimeout(()=>{const x=this.fnMap.get(i);x&&x.fn(...x.args),this.fnMap.delete(i)},s);this.fnMap.set(i,{fn:n,threshold:s,timer:y,args:h,skipFn:o})}else g.skipFn&&g.skipFn(...g.args),this.fnMap.set(i,Je(Je({},g),{},{fn:n,args:h,skipFn:o}))}else{const g=window.setTimeout(()=>{const y=this.fnMap.get(i);y&&y.fn(...y.args),this.fnMap.delete(i)},s);this.fnMap.set(i,{fn:n,threshold:s,timer:g,args:h,skipFn:o})}}},tY=eY.throttleByKey.bind(eY);function nY(n){return typeof n=="object"&&n!==null&&!(n instanceof RegExp)}function HV(n,i){if(!nY(n)||!nY(i)||Array.isArray(n)&&!Array.isArray(i)||!Array.isArray(n)&&Array.isArray(i))return i;if(Array.isArray(i)&&Array.isArray(n)){const s=[...n];for(let o=0;o<i.length;o++)s[o]=HV(n[o],i[o]);return s}{const s=Je({},n);for(const o in i)Object.prototype.hasOwnProperty.call(i,o)&&(Object.prototype.hasOwnProperty.call(n,o)?s[o]=HV(n[o],i[o]):s[o]=i[o]);return s}}function rY(n,i){let s=[0];if(s=new Array(i).fill(0),n===0)return s;let o=0;for(;n>0&&(s[o]=255&n,n>>=8,o++,o!==i););return s}function gx(n){return typeof n=="number"?n:n.exact||n.ideal||n.max||n.min||0}function KV(n,i){try{return typeof n=="object"&&typeof i=="object"&&JSON.stringify(n)===JSON.stringify(i)}catch{return!1}}function qV(n){return lc(n).call(n,(i,s)=>i+s,0)}function iY(n){const i="0123456789abcdef";function s(fe){let Ee,Te="";for(Ee=0;Ee<=3;Ee++)Te+=i.charAt(fe>>8*Ee+4&15)+i.charAt(fe>>8*Ee&15);return Te}function o(fe,Ee){const Te=(65535&fe)+(65535&Ee);return(fe>>16)+(Ee>>16)+(Te>>16)<<16|65535&Te}function d(fe,Ee,Te,_e,Re,je){return o(function(Be,dt){return Be<<dt|Be>>>32-dt}(o(o(Ee,fe),o(_e,je)),Re),Te)}function h(fe,Ee,Te,_e,Re,je,Be){return d(Ee&Te|~Ee&_e,fe,Ee,Re,je,Be)}function f(fe,Ee,Te,_e,Re,je,Be){return d(Ee&_e|Te&~_e,fe,Ee,Re,je,Be)}function g(fe,Ee,Te,_e,Re,je,Be){return d(Ee^Te^_e,fe,Ee,Re,je,Be)}function y(fe,Ee,Te,_e,Re,je,Be){return d(Te^(Ee|~_e),fe,Ee,Re,je,Be)}const x=function(fe){let Ee;const Te=1+(fe.length+8>>6),_e=new Array(16*Te);for(Ee=0;Ee<16*Te;Ee++)_e[Ee]=0;for(Ee=0;Ee<fe.length;Ee++)_e[Ee>>2]|=fe.charCodeAt(Ee)<<Ee%4*8;return _e[Ee>>2]|=128<<Ee%4*8,_e[16*Te-2]=8*fe.length,_e}(n);let b,N,I,D,$,z=1732584193,K=-271733879,ie=-1732584194,oe=271733878;for(b=0;b<x.length;b+=16)N=z,I=K,D=ie,$=oe,z=h(z,K,ie,oe,x[b+0],7,-680876936),oe=h(oe,z,K,ie,x[b+1],12,-389564586),ie=h(ie,oe,z,K,x[b+2],17,606105819),K=h(K,ie,oe,z,x[b+3],22,-1044525330),z=h(z,K,ie,oe,x[b+4],7,-176418897),oe=h(oe,z,K,ie,x[b+5],12,1200080426),ie=h(ie,oe,z,K,x[b+6],17,-1473231341),K=h(K,ie,oe,z,x[b+7],22,-45705983),z=h(z,K,ie,oe,x[b+8],7,1770035416),oe=h(oe,z,K,ie,x[b+9],12,-1958414417),ie=h(ie,oe,z,K,x[b+10],17,-42063),K=h(K,ie,oe,z,x[b+11],22,-1990404162),z=h(z,K,ie,oe,x[b+12],7,1804603682),oe=h(oe,z,K,ie,x[b+13],12,-40341101),ie=h(ie,oe,z,K,x[b+14],17,-1502002290),K=h(K,ie,oe,z,x[b+15],22,1236535329),z=f(z,K,ie,oe,x[b+1],5,-165796510),oe=f(oe,z,K,ie,x[b+6],9,-1069501632),ie=f(ie,oe,z,K,x[b+11],14,643717713),K=f(K,ie,oe,z,x[b+0],20,-373897302),z=f(z,K,ie,oe,x[b+5],5,-701558691),oe=f(oe,z,K,ie,x[b+10],9,38016083),ie=f(ie,oe,z,K,x[b+15],14,-660478335),K=f(K,ie,oe,z,x[b+4],20,-405537848),z=f(z,K,ie,oe,x[b+9],5,568446438),oe=f(oe,z,K,ie,x[b+14],9,-1019803690),ie=f(ie,oe,z,K,x[b+3],14,-187363961),K=f(K,ie,oe,z,x[b+8],20,1163531501),z=f(z,K,ie,oe,x[b+13],5,-1444681467),oe=f(oe,z,K,ie,x[b+2],9,-51403784),ie=f(ie,oe,z,K,x[b+7],14,1735328473),K=f(K,ie,oe,z,x[b+12],20,-1926607734),z=g(z,K,ie,oe,x[b+5],4,-378558),oe=g(oe,z,K,ie,x[b+8],11,-2022574463),ie=g(ie,oe,z,K,x[b+11],16,1839030562),K=g(K,ie,oe,z,x[b+14],23,-35309556),z=g(z,K,ie,oe,x[b+1],4,-1530992060),oe=g(oe,z,K,ie,x[b+4],11,1272893353),ie=g(ie,oe,z,K,x[b+7],16,-155497632),K=g(K,ie,oe,z,x[b+10],23,-1094730640),z=g(z,K,ie,oe,x[b+13],4,681279174),oe=g(oe,z,K,ie,x[b+0],11,-358537222),ie=g(ie,oe,z,K,x[b+3],16,-722521979),K=g(K,ie,oe,z,x[b+6],23,76029189),z=g(z,K,ie,oe,x[b+9],4,-640364487),oe=g(oe,z,K,ie,x[b+12],11,-421815835),ie=g(ie,oe,z,K,x[b+15],16,530742520),K=g(K,ie,oe,z,x[b+2],23,-995338651),z=y(z,K,ie,oe,x[b+0],6,-198630844),oe=y(oe,z,K,ie,x[b+7],10,1126891415),ie=y(ie,oe,z,K,x[b+14],15,-1416354905),K=y(K,ie,oe,z,x[b+5],21,-57434055),z=y(z,K,ie,oe,x[b+12],6,1700485571),oe=y(oe,z,K,ie,x[b+3],10,-1894986606),ie=y(ie,oe,z,K,x[b+10],15,-1051523),K=y(K,ie,oe,z,x[b+1],21,-2054922799),z=y(z,K,ie,oe,x[b+8],6,1873313359),oe=y(oe,z,K,ie,x[b+15],10,-30611744),ie=y(ie,oe,z,K,x[b+6],15,-1560198380),K=y(K,ie,oe,z,x[b+13],21,1309151649),z=y(z,K,ie,oe,x[b+4],6,-145523070),oe=y(oe,z,K,ie,x[b+11],10,-1120210379),ie=y(ie,oe,z,K,x[b+2],15,718787259),K=y(K,ie,oe,z,x[b+9],21,-343485551),z=o(z,N),K=o(K,I),ie=o(ie,D),oe=o(oe,$);return s(z)+s(K)+s(ie)+s(oe)}let vxe=1,sY=console,qs=class{static setLogger(n){sY=n}constructor(n,i){tn(this,"id",void 0),tn(this,"lockingPromise",et.resolve()),tn(this,"locks",0),tn(this,"name",""),tn(this,"lockId",void 0),this.lockId=vxe++,n&&(this.name=n),i&&(this.id=i),this.logger("created")}logger(n,i){const s=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),o=n==="created"?"is ".concat(n,"."):"is ".concat(n,", current queue ").concat(this.locks,". ").concat(i??"");sY.debug("".concat(s," ").concat(o))}setId(n){this.id=n}get isLocked(){return this.locks>0}lock(n){let i;this.locks+=1,this.logger("locked",n);const s=new et(d=>{i=()=>{this.locks-=1,this.logger("unlocked",n),d()}}),o=this.lockingPromise.then(()=>i);return this.lockingPromise=this.lockingPromise.then(()=>s),o}};function _x(n,i){return function(s,o,d){const h=d.value;if(typeof h!="function")throw new Error("Cannot use mutex on object property.");return d.value=async function(){const f=this[i];if(!f)throw new Error("mutex property key ".concat(i," doesn't exist on ").concat(n));const g=await f.lock("From ".concat(n,".").concat(o));try{for(var y=arguments.length,x=new Array(y),b=0;b<y;b++)x[b]=arguments[b];return await h.apply(this,x)}finally{g()}},d}}const Gi={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Uk(n,i){const s=Math.floor(i.timeout*Math.pow(i.timeoutFactor,n));return Math.min(i.maxRetryTimeout,s)}function Dh(n,i,s,o){const d=Object.assign({},Gi,o);let h=d.timeout;const f=async()=>{await function(x){return new et(b=>{window.setTimeout(b,x)})}(h),h*=d.timeoutFactor,h=Math.min(d.maxRetryTimeout,h)};let g=!1;const y=new et(async(x,b)=>{i=i||(()=>!1),s=s||(()=>!0);for(let N=0;N<d.maxRetryCount;N+=1){if(g)return b(new Pe(se.OPERATION_ABORTED));try{const I=await n();if(!i(I,N)||N+1===d.maxRetryCount)return x(I);await f()}catch(I){if(!s(I,N)||N+1===d.maxRetryCount)return b(I);await f()}}});return y.cancel=()=>g=!0,y}let Vk,YV=class{constructor(n){tn(this,"input",[]),tn(this,"size",void 0),this.size=n}add(n){this.input.push(n),this.input.length>this.size&&this.input.splice(0,1)}mean(){var n;return this.input.length===0?0:lc(n=this.input).call(n,(i,s)=>i+s)/this.input.length}},Fk=0,$V=0;function XV(n,i,s,o){return new et((d,h)=>{i.responseType=i.responseType||"json",i.data&&!s?(i.data=JSON.stringify(i.data),Fk+=Qp(i.data)):s&&(i.data.size?Fk+=i.data.size:i.data instanceof FormData?Fk+=Zq(i.data):Fk+=Qp(JSON.stringify(i.data))),i.headers=i.headers||{},i.headers["Content-Type"]=i.headers["Content-Type"]||"application/json",i.method="POST",i.url=n,mc.request(i).then(f=>{typeof f.data=="string"?$V+=Qp(f.data):f.data instanceof ArrayBuffer||f.data instanceof Uint8Array?$V+=f.data.byteLength:$V+=Qp(JSON.stringify(f.data)),d(f.data)}).catch(f=>{mc.isCancel(f)?h(new Pe(se.OPERATION_ABORTED,"cancel token canceled")):f.code==="ECONNABORTED"?h(new Pe(se.NETWORK_TIMEOUT,f.message)):f.response?h(new Pe(se.NETWORK_RESPONSE_ERROR,f.response.status)):h(new Pe(se.NETWORK_ERROR,f.message))})})}async function Exe(n,i){const s=new Blob([i.data],{type:"buffer"});return await XV(n,Je(Je({},i),{},{data:s,headers:{"Content-Type":"application/octet-stream"}}),!0)}const aY=()=>window.isSecureContext!==void 0;function Du(n){if(Array.isArray(n))return n.map(s=>s);if(!oY(n))return n;const i={};for(const s in n){const o=n[s];oY(o)||Array.isArray(o)?i[s]=Du(o):i[s]=o}return i}function oY(n){return!(typeof n!="object"||Array.isArray(n)||!n)}let JV=class{constructor(n){tn(this,"input",[]),tn(this,"size",void 0),this.size=n}add(n){this.input.push(n),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Ou={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},tR={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],transport:{bytesSent:0,bytesReceived:0,packetsSent:0,packetsReceived:0},selectedCandidatePair:{id:"unknown",localCandidate:Ou,remoteCandidate:Ou},updateInterval:0},cY={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},lY={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},dY={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},uY={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let QV=class{constructor(n,i){tn(this,"onFirstVideoReceived",void 0),tn(this,"onFirstVideoDecoded",void 0),tn(this,"onFirstAudioReceived",void 0),tn(this,"onFirstVideoDecodedTimeout",void 0),tn(this,"onFirstAudioDecoded",void 0),tn(this,"onSelectedLocalCandidateChanged",void 0),tn(this,"onSelectedRemoteCandidateChanged",void 0),tn(this,"videoIsReady",!1),tn(this,"videoIsReady2",{}),tn(this,"pc",void 0),tn(this,"options",void 0),tn(this,"intervalTimer",void 0),tn(this,"stats",Du(tR)),tn(this,"isFirstVideoReceived",{}),tn(this,"isFirstVideoDecoded",{}),tn(this,"isFirstAudioReceived",{}),tn(this,"isFirstAudioDecoded",{}),tn(this,"isFirstVideoDecodedTimeout",{}),tn(this,"lossRateWindowStats",[]),this.pc=n,this.options=i,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new et(n=>{n({local:Je({},Ou),remote:Je({},Ou)})})}setVideoIsReady(n){this.videoIsReady=n}setVideoIsReady2(n,i){this.videoIsReady2[n]=i}getVideoIsReady(n){return this.videoIsReady2[n]||!1}setIsFirstAudioDecoded(n){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(n){this.lossRateWindowStats.push(n),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const i=this.lossRateWindowStats.length,s=["videoSend","audioSend","videoRecv","audioRecv"];let o=0,d=0,h=0,f=0;for(const g of s)n[g].forEach((y,x)=>{if(!this.lossRateWindowStats[i-1][g][x]||!this.lossRateWindowStats[0][g][x])return;const b=this.lossRateWindowStats[i-1][g][x].packets-this.lossRateWindowStats[0][g][x].packets,N=this.lossRateWindowStats[i-1][g][x].packetsLost-this.lossRateWindowStats[0][g][x].packetsLost;g==="videoSend"||g==="audioSend"?(o+=b,h+=N):(d+=b,f+=N),Number.isNaN(b)||Number.isNaN(b)?y.packetLostRate=0:y.packetLostRate=b<=0||N<=0?0:N/(b+N)});n.sendPacketLossRate=o<=0||h<=0?0:h/(o+h),n.recvPacketLossRate=d<=0||f<=0?0:f/(d+f)}},xxe=class extends QV{constructor(){super(...arguments),tn(this,"_stats",tR),tn(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const n=await this._getStats(),i=this.statsResponsesToObjects(n);this._stats=Du(tR);const s=i.filter(d=>d.type==="ssrc");this.processSSRCStats(s);const o=i.find(d=>d.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(n){this._stats.bitrate={actualEncoded:Number(n.googActualEncBitrate),targetEncoded:Number(n.googTargetEncBitrate),retransmit:Number(n.googRetransmitBitrate),transmit:Number(n.googTransmitBitrate)},this._stats.sendBandwidth=Number(n.googAvailableSendBandwidth)}processSSRCStats(n){n.forEach(i=>{var s;const o=Ge(s=i.id).call(s,"send");switch("".concat(i.mediaType,"_").concat(o?"send":"recv")){case"video_send":{const d=Du(lY);d.codec=i.googCodecName,d.adaptionChangeReason="none",i.googCpuLimitedResolution&&(d.adaptionChangeReason="cpu"),i.googBandwidthLimitedResolution&&(d.adaptionChangeReason="bandwidth"),d.avgEncodeMs=Number(i.googAvgEncodeMs),d.inputFrame={width:Number(i.googFrameWidthInput)||Number(i.googFrameWidthSent),height:Number(i.googFrameHeightInput)||Number(i.googFrameHeightSent),frameRate:Number(i.googFrameRateInput)},d.sentFrame={width:Number(i.googFrameWidthSent),height:Number(i.googFrameHeightSent),frameRate:Number(i.googFrameRateInput)},d.firsCount=Number(i.googFirReceived),d.nacksCount=Number(i.googNacksReceived),d.plisCount=Number(i.googPlisReceived),d.frameCount=Number(i.framesEncoded),d.bytes=Number(i.bytesSent),d.packets=Number(i.packetsSent),d.packetsLost=Number(i.packetsLost),d.ssrc=Number(i.ssrc),d.rttMs=Number(i.googRtt||0),this._stats.videoSend.push(d),this._stats.rtt=d.rttMs;break}case"video_recv":{const d=Du(cY),h=this.lastDecodeVideoReceiverStats.get(Number(i.ssrc));if(d.codec=i.googCodecName,d.targetDelayMs=Number(i.googTargetDelayMs),d.renderDelayMs=Number(i.googRenderDelayMs),d.currentDelayMs=Number(i.googCurrentDelayMs),d.minPlayoutDelayMs=Number(i.googMinPlayoutDelayMs),d.decodeMs=Number(i.googDecodeMs),d.maxDecodeMs=Number(i.googMaxDecodeMs),d.receivedFrame={width:Number(i.googFrameWidthReceived),height:Number(i.googFrameHeightReceived),frameRate:Number(i.googFrameRateReceived)},d.decodedFrame={width:Number(i.googFrameWidthReceived),height:Number(i.googFrameHeightReceived),frameRate:Number(i.googFrameRateDecoded)},d.decodeFrameRate=Number(i.googFrameRateDecoded),d.outputFrame={width:Number(i.googFrameWidthReceived),height:Number(i.googFrameHeightReceived),frameRate:Number(i.googFrameRateOutput)},d.jitterBufferMs=Number(i.googJitterBufferMs),d.firsCount=Number(i.googFirsSent),d.nacksCount=Number(i.googNacksSent),d.plisCount=Number(i.googPlisSent),d.framesDecodeCount=Number(i.framesDecoded),d.bytes=Number(i.bytesReceived),d.packets=Number(i.packetsReceived),d.packetsLost=Number(i.packetsLost),d.ssrc=Number(i.ssrc),d.packets>0&&!this.isFirstVideoReceived[d.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(d.ssrc),this.isFirstVideoReceived[d.ssrc]=!0),d.framesDecodeCount>0&&!this.isFirstVideoDecoded[d.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(d.ssrc,d.decodedFrame.width,d.decodedFrame.height),this.isFirstVideoDecoded[d.ssrc]=!0),h){const f=h.stats,g=Date.now()-h.lts;d.framesDecodeFreezeTime=f.framesDecodeFreezeTime,d.framesDecodeInterval=f.framesDecodeInterval,d.framesDecodeCount>f.framesDecodeCount&&this.isFirstVideoDecoded[d.ssrc]?(h.lts=Date.now(),d.framesDecodeInterval=g,d.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(i.ssrc,10))?d.framesDecodeFreezeTime+=d.framesDecodeInterval:this.setVideoIsReady2(parseInt(i.ssrc,10),!0))):d.framesDecodeCount<h.stats.framesDecodeCount&&(d.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(d.ssrc,{stats:Je({},d),lts:Date.now()}),this._stats.videoRecv.push(d);break}case"audio_recv":{const d=Du(uY);d.codec=i.googCodecName,d.outputLevel=Math.abs(Number(i.audioOutputLevel))/32767,d.decodingCNG=Number(i.googDecodingCNG),d.decodingCTN=Number(i.googDecodingCTN),d.decodingCTSG=Number(i.googDecodingCTSG),d.decodingNormal=Number(i.googDecodingNormal),d.decodingPLC=Number(i.googDecodingPLC),d.decodingPLCCNG=Number(i.googDecodingPLCCNG),d.expandRate=Number(i.googExpandRate),d.accelerateRate=Number(i.googAccelerateRate),d.preemptiveExpandRate=Number(i.googPreemptiveExpandRate),d.secondaryDecodedRate=Number(i.googSecondaryDecodedRate),d.speechExpandRate=Number(i.googSpeechExpandRate),d.preferredJitterBufferMs=Number(i.googPreferredJitterBufferMs),d.jitterBufferMs=Number(i.googJitterBufferMs),d.jitterMs=Number(i.googJitterReceived),d.bytes=Number(i.bytesReceived),d.packets=Number(i.packetsReceived),d.packetsLost=Number(i.packetsLost),d.ssrc=Number(i.ssrc),d.receivedFrames=Number(i.googDecodingCTN)||Number(i.packetsReceived),d.droppedFrames=Number(i.googDecodingPLC)+Number(i.googDecodingPLCCNG)||Number(i.packetsLost),d.receivedFrames>0&&!this.isFirstAudioReceived[d.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(d.ssrc),this.isFirstAudioReceived[d.ssrc]=!0),d.decodingNormal>0&&!this.isFirstAudioDecoded[d.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(d.ssrc),this.isFirstAudioDecoded[d.ssrc]=!0),this._stats.audioRecv.push(d);break}case"audio_send":{const d=Du(dY);d.codec=i.googCodecName,d.inputLevel=Math.abs(Number(i.audioInputLevel))/32767,d.aecReturnLoss=Number(i.googEchoCancellationReturnLoss||0),d.aecReturnLossEnhancement=Number(i.googEchoCancellationReturnLossEnhancement||0),d.residualEchoLikelihood=Number(i.googResidualEchoLikelihood||0),d.residualEchoLikelihoodRecentMax=Number(i.googResidualEchoLikelihoodRecentMax||0),d.bytes=Number(i.bytesSent),d.packets=Number(i.packetsSent),d.packetsLost=Number(i.packetsLost),d.ssrc=Number(i.ssrc),d.rttMs=Number(i.googRtt||0),this._stats.rtt=d.rttMs,this._stats.audioSend.push(d);break}}})}_getStats(){return new et((n,i)=>{this.pc.getStats(n,i)})}statsResponsesToObjects(n){const i=[];return n.result().forEach(s=>{const o={id:s.id,timestamp:s.timestamp.valueOf().toString(),type:s.type};s.names().forEach(d=>{o[d]=s.stat(d)}),i.push(o)}),i}},yx=function(n){return n.BANDWIDTH="bandwidth",n.CPU="cpu",n.NONE="none",n.OTHER="other",n}({}),Bk=function(n){return n.L1T1="L1T1",n.L1T2="L1T2",n.L1T3="L1T3",n.L1T3_KEY="L1T3_KEY",n.L2T1_KEY="L2T1_KEY",n.L2T2_KEY="L2T2_KEY",n.L2T3_KEY="L2T3_KEY",n.L3T1_KEY="L3T1_KEY",n.L3T2_KEY="L3T2_KEY",n.L3T3_KEY="L3T3_KEY",n}({}),ZV=function(n){return n[n.new=0]="new",n[n.connecting=1]="connecting",n[n.connected=2]="connected",n[n.disconnected=3]="disconnected",n[n.failed=4]="failed",n[n.closed=5]="closed",n}({}),Kl=function(n){return n.CERTIFICATE="certificate",n.CODEC="codec",n.CANDIDATE_PAIR="candidate-pair",n.LOCAL_CANDIDATE="local-candidate",n.REMOTE_CANDIDATE="remote-candidate",n.INBOUND="inbound-rtp",n.TRACK="track",n.OUTBOUND="outbound-rtp",n.PC="peer-connection",n.REMOTE_INBOUND="remote-inbound-rtp",n.REMOTE_OUTBOUND="remote-outbound-rtp",n.TRANSPORT="transport",n.CSRC="csrc",n.DATA_CHANNEL="data-channel",n.STREAM="stream",n.SENDER="sender",n.RECEIVER="receiver",n}({});var vx=function(n){return n[n.kNone=1]="kNone",n[n.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",n[n.kBytesToBits=8]="kBytesToBits",n}(vx||{});function nR(n,i,s,o){let d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:vx.kNone;if(!i)return;const h=Number(i[s]);if(typeof h!="number")return;const f=Number(i[o]);if(typeof f!="number")return;if(!n)return f?h/f*d:void 0;const g=Number(n[s]);if(typeof g!="number")return;const y=Number(n[o]);if(typeof y!="number")return;const x=f-y;return x?(h-g)/x*d:void 0}let hY=class extends QV{constructor(){super(...arguments),tn(this,"_stats",tR),tn(this,"report",void 0),tn(this,"lastDecodeVideoReceiverStats",new Map),tn(this,"lastVideoFramesRecv",new Map),tn(this,"lastVideoFramesSent",new Map),tn(this,"lastVideoFramesDecode",new Map),tn(this,"lastVideoFramesOutput",new Map),tn(this,"lastVideoJBDelay",new Map),tn(this,"lastAudioJBDelay",new Map),tn(this,"mediaBytesSent",new Map),tn(this,"mediaBytesRetransmit",new Map),tn(this,"mediaBytesTargetEncode",new Map),tn(this,"lastDecodeAudioReceiverStats",new Map),tn(this,"lastAudioConcealment",new Map),tn(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Du(tR),this.report.forEach(n=>{switch(n.type){case Kl.OUTBOUND:case Kl.INBOUND:{const i=n.mediaType||n.kind,s=!i&&"frameWidth"in n,o=!i&&!("frameWidth"in n);n.type===Kl.OUTBOUND?i==="audio"||o?this.processAudioOutboundStats(n):(i==="video"||s)&&this.processVideoOutboundStats(n):n.type===Kl.INBOUND&&(i==="audio"||o?this.processAudioInboundStats(n):(i==="video"||s)&&this.processVideoInboundStats(n));break}case Kl.TRANSPORT:{this.processTransportStats(n);const i=this.report.get(n.selectedCandidatePairId);i&&this.processCandidatePairStats(i);break}case Kl.CANDIDATE_PAIR:n.selected&&this.processCandidatePairStats(n)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const n=await this.pc.getStats(),i={local:Je({},Ou),remote:Je({},Ou)};return n.forEach(s=>{let o;if(s.type===Kl.TRANSPORT&&(o=n.get(s.selectedCandidatePairId)),s.type===Kl.CANDIDATE_PAIR&&s.selected&&(o=s),o){const d=(h,f)=>{h.type=f.type,h.id=f.id,f.address&&(h.address=f.address),f.candidateType&&(h.candidateType=f.candidateType),f.port&&(h.port=f.port),f.priority&&(h.priority=f.priority),f.protocol&&(h.protocol=f.protocol),f.relayProtocol&&(h.relayProtocol=f.relayProtocol)};if(o.localCandidateId){const h=n.get(o.localCandidateId);h&&d(i.local,h)}if(o.remoteCandidateId){const h=n.get(o.remoteCandidateId);h&&d(i.remote,h)}}}),i}processCandidatePairStats(n){if(this._stats.sendBandwidth=n.availableOutgoingBitrate||0,n.currentRoundTripTime&&(this._stats.rtt=1e3*n.currentRoundTripTime),this._stats.videoSend.forEach(i=>{n.currentRoundTripTime&&(i.rttMs=1e3*n.currentRoundTripTime)}),this._stats.audioSend.forEach(i=>{n.currentRoundTripTime&&(i.rttMs=1e3*n.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=n.id,n.localCandidateId){const i=this.report.get(n.localCandidateId);i&&this.processCandidateStats(i)}if(n.remoteCandidateId){const i=this.report.get(n.remoteCandidateId);i&&this.processCandidateStats(i)}}processCandidateStats(n){let i;n.type===Kl.LOCAL_CANDIDATE&&(i=this._stats.selectedCandidatePair.localCandidate),n.type===Kl.REMOTE_CANDIDATE&&(i=this._stats.selectedCandidatePair.remoteCandidate),i&&(i.type=n.type,i.id=n.id,n.address&&(i.address=n.address),n.candidateType&&(i.candidateType=n.candidateType),n.port&&(i.port=n.port),n.priority&&(i.priority=n.priority),n.protocol&&(i.protocol=n.protocol),n.relayProtocol&&(i.relayProtocol=n.relayProtocol),n.type===Kl.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==i.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Je({},i),Je({},this.stats.selectedCandidatePair.localCandidate)),n.type===Kl.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==i.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Je({},i),Je({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(n){let i=this._stats.audioRecv.find(o=>o.ssrc===n.ssrc);i||(i=Du(uY),this._stats.audioRecv.push(i)),i.ssrc=n.ssrc,i.packets=n.packetsReceived,i.packetsLost=n.packetsLost,i.packetsDiscarded=n.packetsDiscarded,i.bytes=n.bytesReceived,i.jitterMs=1e3*n.jitter,i.retransmittedBytesReceived=n.retransmittedBytesReceived,i.retransmittedPacketsReceived=n.retransmittedPacketsReceived,i.totalProcessingDelay=n.totalProcessingDelay,i.jitterBufferEmittedCount=n.jitterBufferEmittedCount,i.estimatedPlayoutTimestamp=n.estimatedPlayoutTimestamp;const s=this.lastDecodeAudioReceiverStats.get(i.ssrc);i.avgProcessingDelayMs=nR(s,i,"totalProcessingDelay","jitterBufferEmittedCount",vx.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(n,n.trackId,i),this.calculateAudioFreeze(i,s,n),n.codecId&&(i.codec=this.getCodecFromCodecStats(n.codecId)),i.receivedFrames||(i.receivedFrames=n.packetsReceived),i.droppedFrames||(i.droppedFrames=n.packetsLost),i.receivedFrames>0&&!this.isFirstAudioReceived[i.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(i.ssrc),this.isFirstAudioReceived[i.ssrc]=!0),i.outputLevel&&i.outputLevel>0&&!this.isFirstAudioDecoded[i.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(i.ssrc),this.isFirstAudioDecoded[i.ssrc]=!0),typeof n.concealedSamples=="number"&&(i.concealedSamples=n.concealedSamples),this.lastDecodeAudioReceiverStats.set(i.ssrc,Je({},i))}calculateAudioFreeze(n,i,s){const o=this.lastAudioConcealment.get(n.ssrc);if(i!=null&&o!=null){const d=o.lts,h=s.timestamp,f=h-d;if(f<=0)return;const g=n.concealedSamples-i.concealedSamples-0,y=o.nonSilent+g,x=n.totalSamplesReceived-i.totalSamplesReceived;if(x<=0)return;const b=80*x/f,N=200*x/f,I=f/x;let D=0;n.freezeSamples80=i.freezeSamples80,n.freezeMs80=i.freezeMs80,y>b&&(o.plc80>0?(n.freezeSamples80+=g,n.freezeMs80+=Math.round(g*I)):(n.freezeSamples80+=y,n.freezeMs80+=Math.round(y*I)),D=o.plc80+1);let $=0;n.freezeSamples200=i.freezeSamples200,n.freezeMs200=i.freezeMs200,y>N&&(o.plc200>0?(n.freezeSamples200+=g,n.freezeMs200+=Math.round(g*I)):(n.freezeSamples200+=y,n.freezeMs200+=Math.round(y*I)),$=o.plc200+1),this.lastAudioConcealment.set(n.ssrc,{nonSilent:g,lts:h,plc80:D,plc200:$})}else n.freezeSamples80=0,n.freezeSamples200=0,n.freezeMs80=0,n.freezeMs200=0,this.lastAudioConcealment.set(n.ssrc,{nonSilent:0,lts:s.timestamp,plc80:0,plc200:0})}processVideoInboundStats(n){let i=this._stats.videoRecv.find(f=>f.ssrc===n.ssrc);i||(i=Du(cY),this._stats.videoRecv.push(i)),i.ssrc=n.ssrc,i.packets=n.packetsReceived,i.packetsLost=n.packetsLost,i.bytes=n.bytesReceived,i.firsCount=n.firCount,i.nacksCount=n.nackCount,i.plisCount=n.pliCount,i.framesDecodeCount=n.framesDecoded,i.framesDroppedCount=n.framesDropped,i.totalInterFrameDelay=n.totalInterFrameDelay,i.totalSquaredInterFrameDelay=n.totalSquaredInterFrameDelay,i.totalFreezesDuration=n.totalFreezesDuration,i.totalProcessingDelay=n.totalProcessingDelay,i.packetsDiscarded=n.packetsDiscarded,i.framesAssembledFromMultiplePackets=n.framesAssembledFromMultiplePackets,i.totalAssemblyTime=n.totalAssemblyTime,i.keyFramesDecoded=n.keyFramesDecoded,i.retransmittedBytesReceived=n.retransmittedBytesReceived,i.retransmittedPacketsReceived=n.retransmittedPacketsReceived,i.estimatedPlayoutTimestamp=n.estimatedPlayoutTimestamp;const s=this.lastDecodeVideoReceiverStats.get(i.ssrc),o=this.lastVideoFramesDecode.get(i.ssrc),d=this.lastVideoFramesOutput.get(i.ssrc),h=Date.now();if(i.framesDecodeCount>0&&!this.isFirstVideoDecoded[i.ssrc]){const f=i.decodedFrame?i.decodedFrame.width:0,g=i.decodedFrame?i.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(i.ssrc,f,g),this.isFirstVideoDecoded[i.ssrc]=!0}if(s){const f=s.stats,g=h-s.lts;i.framesDecodeFreezeTime=f.framesDecodeFreezeTime,i.framesDecodeInterval=f.framesDecodeInterval,!this.isFirstVideoDecoded[i.ssrc]&&g>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[i.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(i.ssrc),this.isFirstVideoDecodedTimeout[i.ssrc]=!0),i.framesDecodeCount>f.framesDecodeCount&&this.isFirstVideoDecoded[i.ssrc]?(s.lts=Date.now(),i.framesDecodeInterval=g,i.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc))?i.framesDecodeFreezeTime+=i.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):i.framesDecodeCount<f.framesDecodeCount&&(i.framesDecodeInterval=0),n.framesDecoded&&n.qpSum&&(s.stats.framesDecodeCount>n.framesDecoded?i.qpSumPerFrame=n.qpSum/n.framesDecoded:i.qpSumPerFrame=(n.qpSum-s.qpSum)/(n.framesDecoded-s.stats.framesDecodeCount))}n.totalDecodeTime&&(i.decodeMs=1e3*n.totalDecodeTime,i.avgDecodeMs=nR(s==null?void 0:s.stats,i,"decodeMs","framesDecodeCount")),i.avgProcessingDelayMs=nR(s==null?void 0:s.stats,i,"totalProcessingDelay","framesDecodeCount",vx.kMillisecondsFromSeconds),i.avgFramesAssembledFromMultiplePacketsMs=nR(s==null?void 0:s.stats,i,"totalAssemblyTime","framesAssembledFromMultiplePackets",vx.kMillisecondsFromSeconds),i.avgInterFrameDelayMs=nR(s==null?void 0:s.stats,i,"totalInterFrameDelay","framesDecodeCount",vx.kMillisecondsFromSeconds),o&&h-o.lts>=800?(i.decodeFrameRate=Math.round((i.framesDecodeCount-o.count)/((h-o.lts)/1e3)),this.lastVideoFramesDecode.set(i.ssrc,{count:i.framesDecodeCount,lts:h,rate:i.decodeFrameRate})):o?i.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(i.ssrc,{count:i.framesDecodeCount,lts:h,rate:0}),i.framesDroppedCount&&n.framesReceived&&(d&&h-d.lts>=800?(i.outputFrameRate=Math.round((n.framesReceived-i.framesDroppedCount-d.count)/((h-d.lts)/1e3)),this.lastVideoFramesOutput.set(i.ssrc,{count:n.framesReceived-i.framesDroppedCount,lts:h,rate:Math.max(i.outputFrameRate,0)})):d?i.outputFrameRate=d.rate:this.lastVideoFramesOutput.set(i.ssrc,{count:n.framesReceived-i.framesDroppedCount,lts:h,rate:0})),this.processVideoTrackReceiverStats(n,n.trackId,i),n.codecId&&(i.codec=this.getCodecFromCodecStats(n.codecId)),n.framerateMean&&(i.framesRateFirefox=n.framerateMean),i.packets>0&&!this.isFirstVideoReceived[i.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(i.ssrc),this.isFirstVideoReceived[i.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(i.ssrc,{stats:Je({},i),lts:s?s.lts:Date.now(),qpSum:n.qpSum})}processVideoOutboundStats(n){let i=this._stats.videoSend.find(o=>o.ssrc===n.ssrc);i||(i=Du(lY),this._stats.videoSend.push(i));const s=this.mediaBytesSent.get(n.ssrc);if(s)s.add(n.bytesSent);else{const o=new JV(10);o.add(n.bytesSent),this.mediaBytesSent.set(n.ssrc,o)}if(n.retransmittedBytesSent!==void 0){const o=this.mediaBytesRetransmit.get(n.ssrc);if(o)o.add(n.retransmittedBytesSent);else{const d=new JV(10);d.add(n.retransmittedBytesSent),this.mediaBytesRetransmit.set(n.ssrc,d)}}if(n.totalEncodedBytesTarget){const o=this.mediaBytesTargetEncode.get(n.ssrc);if(o)o.add(n.totalEncodedBytesTarget);else{const d=new JV(10);d.add(n.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(n.ssrc,d)}}if(i.ssrc=n.ssrc,i.bytes=n.bytesSent,i.packets=n.packetsSent,i.firsCount=n.firCount,i.nacksCount=n.nackCount,i.plisCount=n.pliCount,i.frameCount=n.framesEncoded,i.adaptionChangeReason=n.qualityLimitationReason,i.scalabilityMode=n.scalabilityMode,i.retransmittedBytesSent=n.retransmittedBytesSent,i.retransmittedPacketsSent=n.retransmittedPacketsSent,i.hugeFramesSent=n.hugeFramesSent,i.keyFramesEncoded=n.keyFramesEncoded,i.targetBitrate=n.targetBitrate,n.totalEncodeTime&&n.framesEncoded){const o=this.lastEncoderMs.get(n.ssrc);if(!o||o.lastFrameCount>n.framesEncoded)i.avgEncodeMs=1e3*n.totalEncodeTime/n.framesEncoded;else{const d=n.framesEncoded-o.lastFrameCount,h=n.totalEncodeTime-o.lastEncoderTime;i.avgEncodeMs=1e3*h/d}}if(n.framesEncoded&&n.qpSum){const o=this.lastEncoderMs.get(n.ssrc);!o||o.lastFrameCount>n.framesEncoded?i.qpSumPerFrame=n.qpSum/n.framesEncoded:i.qpSumPerFrame=(n.qpSum-o.lastQpSum)/(n.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(n.ssrc,{lastFrameCount:n.framesEncoded,lastEncoderTime:n.totalEncodeTime,lastQpSum:n.qpSum,lts:Date.now()}),n.codecId&&(i.codec=this.getCodecFromCodecStats(n.codecId)),n.mediaSourceId&&this.processVideoMediaSource(n.mediaSourceId,i),this.processVideoTrackSenderStats(n,n.trackId,i),n.remoteId)this.processRemoteInboundStats(n.remoteId,i);else{const o=this.findRemoteStatsId(n.ssrc,Kl.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,i)}}processAudioOutboundStats(n){let i=this._stats.audioSend.find(s=>s.ssrc===n.ssrc);if(i||(i=Du(dY),this._stats.audioSend.push(i)),i.ssrc=n.ssrc,i.packets=n.packetsSent,i.bytes=n.bytesSent,i.retransmittedBytesSent=n.retransmittedBytesSent,i.retransmittedPacketsSent=n.retransmittedPacketsSent,n.mediaSourceId&&this.processAudioMediaSource(n.mediaSourceId,i),n.codecId&&(i.codec=this.getCodecFromCodecStats(n.codecId)),this.processAudioTrackSenderStats(n,n.trackId,i),n.remoteId)this.processRemoteInboundStats(n.remoteId,i);else{const s=this.findRemoteStatsId(n.ssrc,Kl.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,i)}}processTransportStats(n){this._stats.transport.bytesReceived=n.bytesReceived||this._stats.transport.bytesReceived,this._stats.transport.bytesSent=n.bytesSent||this._stats.transport.bytesSent,this._stats.transport.packetsReceived=n.packetsReceived||this._stats.transport.packetsReceived,this._stats.transport.packetsSent=n.packetsSent||this._stats.transport.packetsSent}findRemoteStatsId(n,i){var s;const o=Array.from(pc(s=this.report).call(s)).find(d=>d.type===i&&d.ssrc===n);return o?o.id:null}processVideoMediaSource(n,i){const s=this.report.get(n);s&&s.width&&s.height&&s.framesPerSecond&&(i.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})}processAudioMediaSource(n,i){const s=this.report.get(n);s&&(i.inputLevel=s.audioLevel)}processVideoTrackSenderStats(n,i,s){var o,d,h,f;const g=i?this.report.get(i):void 0,y=(o=g==null?void 0:g.framesSent)!==null&&o!==void 0?o:n.framesSent;if(typeof y!="number")return;let x=(d=g==null?void 0:g.frameWidth)!==null&&d!==void 0?d:n.frameWidth,b=(h=g==null?void 0:g.frameHeight)!==null&&h!==void 0?h:n.frameHeight,N=(f=g==null?void 0:g.framesPerSecond)!==null&&f!==void 0?f:n.framesPerSecond;if(typeof x=="number"&&typeof b=="number"||(x=0,b=0),N==null){const I=Date.now(),D=this.lastVideoFramesSent.get(s.ssrc);D&&I-D.lts>=800?(N=Math.round((y-D.count)/((I-D.lts)/1e3)),this.lastVideoFramesSent.set(s.ssrc,{count:y,lts:I,rate:N})):D?N=D.rate:this.lastVideoFramesSent.set(s.ssrc,{count:y,lts:I,rate:0})}s.sentFrame={width:x,height:b,frameRate:Math.max(0,N)}}processVideoTrackReceiverStats(n,i,s){var o,d,h,f,g;const y=i?this.report.get(i):void 0,x=(o=y==null?void 0:y.framesReceived)!==null&&o!==void 0?o:n.framesReceived,b=(d=y==null?void 0:y.frameWidth)!==null&&d!==void 0?d:n.frameWidth,N=(h=y==null?void 0:y.frameHeight)!==null&&h!==void 0?h:n.frameHeight,I=(f=y==null?void 0:y.jitterBufferDelay)!==null&&f!==void 0?f:n.jitterBufferDelay,D=(g=y==null?void 0:y.jitterBufferEmittedCount)!==null&&g!==void 0?g:n.jitterBufferEmittedCount;if(typeof x=="number"){const $=this.lastVideoFramesRecv.get(s.ssrc),z=Date.now();s.framesReceivedCount=x;let K=0;$&&z-$.lts>=800?(K=Math.round((x-$.count)/((z-$.lts)/1e3)),this.lastVideoFramesRecv.set(s.ssrc,{count:x,lts:z,rate:K})):$?K=$.rate:this.lastVideoFramesRecv.set(s.ssrc,{count:x,lts:z,rate:0}),s.receivedFrame={width:b||0,height:N||0,frameRate:K||0},s.decodedFrame={width:b||0,height:N||0,frameRate:s.decodeFrameRate||0},s.outputFrame={width:b||0,height:N||0,frameRate:s.outputFrameRate||s.decodeFrameRate||0}}if(I&&D){const $=this.lastVideoJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let z=$.jitterBufferMs;const K=D-$.jitterBufferEmittedCount;K>0&&(z=1e3*(I-$.jitterBufferDelay)/K),s.jitterBufferMs=z,s.currentDelayMs=Math.round(z),this.lastVideoJBDelay.set(s.ssrc,{jitterBufferDelay:I,jitterBufferEmittedCount:D,jitterBufferMs:s.currentDelayMs})}}processAudioTrackSenderStats(n,i,s){var o,d,h,f;const g=i?this.report.get(i):void 0,y=(o=(d=g==null?void 0:g.echoReturnLoss)!==null&&d!==void 0?d:n.echoReturnLoss)!==null&&o!==void 0?o:0,x=(h=(f=g==null?void 0:g.echoReturnLossEnhancement)!==null&&f!==void 0?f:n.echoReturnLossEnhancement)!==null&&h!==void 0?h:0;s.aecReturnLoss=y,s.aecReturnLossEnhancement=x}processAudioTrackReceiverStats(n,i,s){var o,d,h,f,g,y,x,b,N;const I=i?this.report.get(i):void 0,D=(o=I==null?void 0:I.removedSamplesForAcceleration)!==null&&o!==void 0?o:n.removedSamplesForAcceleration,$=(d=I==null?void 0:I.totalSamplesReceived)!==null&&d!==void 0?d:n.totalSamplesReceived,z=(h=I==null?void 0:I.jitterBufferDelay)!==null&&h!==void 0?h:n.jitterBufferDelay,K=(f=I==null?void 0:I.jitterBufferEmittedCount)!==null&&f!==void 0?f:n.jitterBufferEmittedCount,ie=(g=I==null?void 0:I.audioLevel)!==null&&g!==void 0?g:n==null?void 0:n.audioLevel,oe=(y=I==null?void 0:I.totalSamplesDuration)!==null&&y!==void 0?y:n==null?void 0:n.totalSamplesDuration,fe=(x=I==null?void 0:I.concealedSamples)!==null&&x!==void 0?x:n.concealedSamples,Ee=(b=I==null?void 0:I.silentConcealedSamples)!==null&&b!==void 0?b:n.silentConcealedSamples,Te=(N=I==null?void 0:I.concealmentEvents)!==null&&N!==void 0?N:n.concealmentEvents;if(typeof $=="number"&&(s.totalSamplesReceived=$),typeof Ee=="number"&&(s.silentConcealedSamples=Ee),typeof Te=="number"&&(s.concealmentEvents=Te),typeof fe=="number"&&(s.concealedSamples=fe),D&&$&&(s.accelerateRate=D/$),z&&K){const Re=this.lastAudioJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let je=Re.jitterBufferMs;const Be=K-Re.jitterBufferEmittedCount;Be>0&&(je=1e3*(z-Re.jitterBufferDelay)/Be),s.jitterBufferMs=Math.round(je),this.lastAudioJBDelay.set(s.ssrc,{jitterBufferDelay:z,jitterBufferEmittedCount:K,jitterBufferMs:s.jitterBufferMs})}s.outputLevel=ie;let _e=1920;oe&&$&&(_e=$/oe/50,s.receivedFrames=Math.round($/_e)),fe&&(s.droppedFrames=Math.round(fe/_e))}processRemoteInboundStats(n,i){const s=this.report.get(n);s&&(i.packetsLost=s.packetsLost,s.roundTripTime&&(i.rttMs=1e3*s.roundTripTime),s.jitter&&(i.jitterMs=1e3*s.jitter),s.timestamp&&(i.timestamp=s.timestamp))}getCodecFromCodecStats(n){const i=this.report.get(n);if(!i)return"";const s=i.mimeType.match(/\/(.*)$/);return s&&s[1]?s[1]:""}updateSendBitrate(){let n=0,i=null,s=null;this.mediaBytesSent.forEach(d=>{n+=d.diffMean()}),this.mediaBytesRetransmit.forEach(d=>{i=i===null?d.diffMean():i+d.diffMean()}),this.mediaBytesTargetEncode.forEach(d=>{s=s===null?d.diffMean():s+d.diffMean()});const o=i!==null?n-i:n;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*n/(this.options.updateInterval/1e3)},i!==null&&(this._stats.bitrate.retransmit=8*i/(this.options.updateInterval/1e3)),s!==null&&(this._stats.bitrate.targetEncoded=8*s/(this.options.updateInterval/1e3))}},bxe=class extends QV{updateStats(){return et.resolve()}};function zk(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const h=function(){const f=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return f&&f[0]?Number(f[0].split("/")[1]):null}();return h?h<76?new xxe(n,{updateInterval:i,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:d}):new hY(n,{updateInterval:i,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:d}):function(f){if(!window.RTCStatsReport)return!1;const g=f.getStats();return!!(g instanceof et||function(y){return!!y&&(typeof y=="object"||typeof y=="function")&&typeof y.then=="function"}(g))}(n)?new hY(n,{updateInterval:i,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:d}):new bxe(n,{updateInterval:i,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:d})}const pY="websdk_ng_install_id";function e4(){try{if(re("INSTALL_ID"))return re("INSTALL_ID");let n=window.localStorage.getItem(pY);return n||(n=fy(),window.localStorage.setItem(pY,n)),xr("INSTALL_ID",n),n}catch{return}}const Pd=function(n){if(n.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return n;const i=n.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(i&&i[1]&&i[2]){const s=i[1],o=i[2];return"".concat(s,".").concat(o)}return"4.0.0.999"}("4.24.2"),t4=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let my=function(n){return n.Default="default",n.Auto="auto",n.Relay="relay",n.SdRtn="sd-rtn",n}({});const Ea=function(){const n="us".concat("erna","me"),i="pa".concat("sswo","rd"),s=["t","s","t"];s.splice(1,0,"e");const o=s.join(""),d=[];for(let g=0;g<6;g++)d.push("1");const h=d.join(""),f={};return f[n]=o,f[i]=h,Object.assign(f,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Ea;const Gk={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},n4={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},r4="v4.24.2-0-g002485b1-dirty(12/12/2025, 5:26:54 PM)",i4={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",TURN_DOMAINS:["edge.agora.io"],USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,FLS_FALLBACK_TIMEOUT:3e4,RTE_DETAIL_REPORT_INTERVAL:6e4,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0,UPDATE_RTP_CAP_IN_HOST:!1,IOS_BG_TAG:!0,IOS_AUTO_RESTART_BG_TAG:!0,IGNORE_UID_CHECK:!1,ENABLE_UP_SPS_PPS:!1,ENABLE_DOWN_SPS_PPS:!1,NO_EDGES_RETRY:!0,BUFFER_READY_FRAMES:3,FLS_SYNC_AV_PLAY_LIMIT:0,FLS_BUFFER_WAIT_TIME:1500,VOS_CONFIGURE:void 0,ENABLE_QUALITY_FALLBACK:!1,QUALITY_FALLBACK_REHEARSAL:!0,ENABLE_FLS_AV1_FIRST:!1,ENABLE_AP_MULTI_IP:!0,FLS_ENABLE_AV1_DETECT:!0,FLS_ENABLE_AV1_DECODE_DETECT:!0},ur=Je(Je(Je(Je({},i4),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_MANAGER_WSS:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_WSS:"",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,DC_JOIN_WITH_FAILBACK:4e3,DC_CONNECTION_TIMEOUT:2e3,DC_PINGPONG_INTERVAL:2e3,DC_DEBUG_LOG:!1,UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:n4,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},Gk),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,REMOTE_VIDEO_STREAM_TYPE:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_FORCE_HLS:!1,MAX_WEBAUDIO_VOLUME:300,ENABLE_VOS_FALLBACK:!1,ENABLE_FALLBACK_TO_HLS:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!0,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1,IGNORE_RTC_DEVICE_CHECK:!1,FLS_AUTOPLAY_EMITS:!1,ENABLE_DUAL_STREAM_FLAG:!1,FORBID_MODIFY_LOCAL_OFFER_SDP:!1,RESERVE_MID_1_MLINE:!1});function xr(n,i,s){var o,d,h;Ge(o=Object.keys(ur)).call(o,n)&&(!s&&Ge(d=Object.keys(ql)).call(d,n)||(ur[n]=i,n!=="ENABLE_VIDEO_SEI"&&n!=="ENABLE_AUDIO_TOPN"&&n!=="ENABLE_AUDIO_METADATA"&&n!=="ENABLE_AUDIO_PTS"||i!==!0||(ur.ENABLE_ENCODED_TRANSFORM=!0),n==="USE_NEW_NETWORK_CONFIG"&&i&&(h=!!i,ur.USE_NEW_NETWORK_CONFIG=h,h&&(ur.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],ur.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],ur.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ur.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],ur.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",ur.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",ur.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),n==="ENABLE_PRE_SUB"&&i&&(ur.ENABLE_INSTANT_VIDEO=!0,ur.ENABLE_PREALLOC_PC=!0),n==="ENABLE_SVC"&&i&&(ur.ENABLE_AUT_CC=!0),n==="NEW_FORCE_TURN"&&i&&(ur.NEW_TURN_MODE||(ur.NEW_TURN_MODE=4))))}function re(n){if(n==="TURN_DOMAINS"){const i=ur.TURN_DOMAINS;return Ge(i).call(i,re("TURN_DOMAIN"))?i:[re("TURN_DOMAIN")].concat(i)}return ur[n]}t4||(ur.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],ur.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],ur.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],ur.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ur.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],ur.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],ur.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",ur.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",ur.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",ur.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",ur.AREAS=["NORTH_AMERICA","OVERSEA"]);let fY=function(n){return n[n.REALTIME=1]="REALTIME",n}({});const ql={};var qt=function(n){return n.SET_SESSION_ID="SET_SESSION_ID",n.SET_RTE_URL="SET_RTE_URL",n.SET_RTE_SID="SET_RTE_SID",n.SET_P2P_ID="SET_P2P_id",n.SET_DC_ID="SET_DC_id",n.SET_UID="SET_UID",n.SET_INT_UID="SET_INT_UID",n.SET_PUB_ID="SET_PUB_ID",n.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",n.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",n.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",n.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",n.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",n.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",n.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",n.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",n.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",n.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",n.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",n.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",n.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",n.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",n.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",n.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",n.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",n.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",n.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",n.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",n.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",n.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",n.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",n.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",n.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",n.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",n.RESET_KEY_METRICS="RESET_KEY_METRICS",n.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",n.SET_USE_P2P="SET_USE_P2P",n.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",n}(qt||{});let gy=function(n){return n.h264="h264",n.h265="h265",n.vp8="vp8",n.vp9="vp9",n.av1="av1",n}({});(function(n){n.opus="opus",n.pcma="pcma",n.pcmu="pcmu",n.g722="g722"})({});const mY=128,wxe=96,gY=1e3,Ex=10;let Sxe=0;var _Y=(()=>{var n={8:(o,d,h)=>{h.r(d),h.d(d,{Parser:()=>Be,Printer:()=>sn,parse:()=>Qe,print:()=>ft});const f=`
`,g="".concat("\r").concat(f),y=" ";let x;function b(Fe){return Fe>="0"&&Fe<="9"}function N(Fe){return Fe>="!"&&Fe<="~"}function I(Fe){return N(Fe)||Fe>=""&&Fe<=""}function D(Fe){return Fe==="!"||Fe>="#"&&Fe<="'"||Fe>="*"&&Fe<="+"||Fe>="-"&&Fe<="."||Fe>="0"&&Fe<="9"||Fe>="A"&&Fe<="Z"||Fe>="^"&&Fe<="~"}function $(Fe){return Fe>="1"&&Fe<="9"}function z(Fe){return Fe>="A"&&Fe<="Z"||Fe>="a"&&Fe<="z"}function K(Fe){return Fe==="d"||Fe==="h"||Fe==="m"||Fe==="s"}function ie(Fe){return Fe>""&&Fe<"	"||Fe>"\v"&&Fe<"\f"||Fe>""&&Fe<""}function oe(Fe){return z(Fe)||b(Fe)||Fe==="+"||Fe==="/"}function fe(Fe){return b(Fe)||z(Fe)||Fe==="+"||Fe==="/"||Fe==="-"||Fe==="_"}function Ee(Fe){return z(Fe)||b(Fe)||Fe==="+"||Fe==="/"}function Te(Fe,B){var ue=Object.keys(Fe);if(Object.getOwnPropertySymbols){var ve=Object.getOwnPropertySymbols(Fe);B&&(ve=ve.filter(function(Ye){return Object.getOwnPropertyDescriptor(Fe,Ye).enumerable})),ue.push.apply(ue,ve)}return ue}function _e(Fe){for(var B=1;B<arguments.length;B++){var ue=arguments[B]!=null?arguments[B]:{};B%2?Te(Object(ue),!0).forEach(function(ve){Re(Fe,ve,ue[ve])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Fe,Object.getOwnPropertyDescriptors(ue)):Te(Object(ue)).forEach(function(ve){Object.defineProperty(Fe,ve,Object.getOwnPropertyDescriptor(ue,ve))})}return Fe}function Re(Fe,B,ue){return B in Fe?Object.defineProperty(Fe,B,{value:ue,enumerable:!0,configurable:!0,writable:!0}):Fe[B]=ue,Fe}(function(Fe){Fe.VERSION="v",Fe.ORIGIN="o",Fe.SESSION_NAME="s",Fe.INFORMATION="i",Fe.URI="u",Fe.EMAIL="e",Fe.PHONE="p",Fe.CONNECTION="c",Fe.BANDWIDTH="b",Fe.TIME="t",Fe.REPEAT="r",Fe.ZONE_ADJUSTMENTS="z",Fe.KEY="k",Fe.ATTRIBUTE="a",Fe.MEDIA="m"})(x||(x={}));class je{consumeText(B,ue){let ve=ue;for(;ve<B.length;){const Ye=B[ve];if(Ye==="\0"||Ye==="\r"||Ye===f)break;ve+=1}if(ve-ue==0)throw new Error("Invalid text, at ".concat(B));return ve}consumeUnicastAddress(B,ue,ve){return this.consumeTill(B,ue,y)}consumeOneOrMore(B,ue,ve){let Ye=ue;for(;ve(B[Ye]);)Ye++;if(Ye-ue==0)throw new Error("Invalid rule at ".concat(ue,"."));return Ye}consumeSpace(B,ue){if(B[ue]===y)return ue+1;throw new Error("Invalid space at ".concat(ue,"."))}consumeIP4Address(B,ue){let ve=ue;for(let Ye=0;Ye<4;Ye++)if(ve=this.consumeDecimalUChar(B,ve),Ye!==3){if(B[ve]!==".")throw new Error("Invalid IP4 address.");ve++}return ve}consumeDecimalUChar(B,ue){let ve=ue;for(let Qt=0;Qt<3&&b(B[ve]);Qt++,ve++);if(ve-ue==0)throw new Error("Invalid decimal uchar.");const Ye=parseInt(B.slice(ue,ve));if(Ye>=0&&Ye<=255)return ve;throw new Error("Invalid decimal uchar")}consumeIP6Address(B,ue){let ve=this.consumeHexpart(B,ue);return B[ve]===":"&&(ve+=1,ve=this.consumeIP4Address(B,ve)),ve}consumeHexpart(B,ue){let ve=ue;if(B[ve]===":"&&B[ve+1]===":"){ve+=2;try{ve=this.consumeHexseq(B,ve)}catch{}return ve}if(ve=this.consumeHexseq(B,ve),B[ve]===":"&&B[ve+1]===":"){ve+=2;try{ve=this.consumeHexseq(B,ve)}catch{}return ve}return ve}consumeHexseq(B,ue){let ve=ue;for(;ve=this.consumeHex4(B,ve),B[ve]===":"&&B[ve+1]!==":";)ve+=1;return ve}consumeHex4(B,ue){let ve=0;for(;ve<4;ve++)if(!((Ye=B[ue+ve])>="0"&&Ye<="9"||Ye>="a"&&Ye<="f"||Ye>="A"&&Ye<="F")){if(ve===0)throw new Error("Invalid hex 4");break}var Ye;return ue+ve}consumeFQDN(B,ue){let ve=ue;for(;b(B[ve])||z(B[ve])||B[ve]==="-"||B[ve]===".";)ve+=1;if(ve-ue<4)throw new Error("Invalid FQDN");return ve}consumeExtnAddr(B,ue){return this.consumeOneOrMore(B,ue,I)}consumeMulticastAddress(B,ue,ve){switch(ve){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(B,ue);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(B,ue);default:try{return this.consumeFQDN(B,ue)}catch{return this.consumeExtnAddr(B,ue)}}}consumeIP6MulticastAddress(B,ue){const ve=this.consumeHexpart(B,ue);return B[ve]==="/"?this.consumeInteger(B,ve+1):ve}consumeIP4MulticastAddress(B,ue){let ve=ue+3;const Ye=B.slice(ue,ve),Qt=parseInt(Ye);if(Qt<224||Qt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let jr=0;jr<3;jr++){if(B[ve]!==".")throw new Error("Invalid IP4 multicast address.");ve+=1,ve=this.consumeDecimalUChar(B,ve)}return B[ve]==="/"&&(ve+=1),ve=this.consumeTTL(B,ve),B[ve]==="/"&&(ve=this.consumeInteger(B,ve)),ve}consumeInteger(B,ue){if(!$(B[ue]))throw new Error("Invalid integer.");for(ue+=1;b(B[ue]);)ue+=1;return ue}consumeTTL(B,ue){if(B[ue]==="0")return ue+1;if(!$(B[ue]))throw new Error("Invalid TTL.");ue+=1;for(let ve=0;ve<2&&b(B[ue]);ve++)ue+=1;return ue}consumeToken(B,ue){return this.consumeOneOrMore(B,ue,D)}consumeTime(B,ue){let ve=ue;if(B[ve]==="0")return ve+1;for($(B[ve])&&(ve+=1);b(B[ve]);)ve++;if(ve-ue<10)throw new Error("Invalid time");return ve}consumeAddress(B,ue){return this.consumeTill(B,ue,y)}consumeTypedTime(B,ue){let ve=ue;return ve=this.consumeOneOrMore(B,ve,b),K(B[ve])?ve+1:ve}consumeRepeatInterval(B,ue){if(!$(B[ue]))throw new Error("Invalid repeat interval");for(ue+=1;b(B[ue]);)ue+=1;return K(B[ue])&&(ue+=1),ue}consumePort(B,ue){return this.consumeOneOrMore(B,ue,b)}consume(B,ue,ve){for(let Ye=0;Ye<ve.length;Ye++){if(ue+Ye>=B.length)throw new Error("consume exceeding value length");if(B[ue+Ye]!==ve[Ye])throw new Error("consume ".concat(ve," failed at ").concat(Ye))}return ue+ve.length}consumeTill(B,ue,ve){let Ye=ue;for(;Ye<B.length&&(typeof ve!="string"||B[Ye]!==ve)&&(typeof ve!="function"||!ve(B[Ye]));)Ye++;return Ye}}class Be extends je{constructor(){super(),Re(this,"records",[]),Re(this,"currentLine",0)}parse(B){const ue=this.probeEOL(B);this.records=B.split(ue).filter(l_=>!!Oo(l_).call(l_)).map(this.parseLine),this.currentLine=0;const ve=this.parseVersion(),Ye=this.parseOrigin(),Qt=this.parseSessionName(),jr=this.parseInformation(),Os=this.parseUri(),Bd=this.parseEmail(),c_=this.parsePhone(),s2=this.parseConnection(),Qx=this.parseBandWidth(),a2=this.parseTimeFields(),Fy=this.parseKey(),FR=this.parseSessionAttribute(),By=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:ve,origin:Ye,sessionName:Qt,information:jr,uri:Os,emails:Bd,phones:c_,connection:s2,bandwidths:Qx,timeFields:a2,key:Fy,attributes:FR,mediaDescriptions:By}}getCurrentRecord(){const B=this.records[this.currentLine];if(!B)throw new Error("Record doesn't exit.");return B}probeEOL(B){for(let ue=0;ue<B.length;ue++)if(B[ue]===f)return B[ue-1]==="\r"?g:f;throw new Error("Invalid newline character.")}parseLine(B,ue){if(B.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const ve=B[0];if(B[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:ve,value:B.slice(2),line:ue,cur:0}}parseSessionAttribute(){const B=new Ht;for(;this.currentLine<this.records.length;){const ue=this.getCurrentRecord();if(ue.type!==x.ATTRIBUTE)break;const ve={attField:this.extractOneOrMore(ue,Ye=>D(Ye)&&Ye!==":"),_cur:0};ue.value[ue.cur]===":"&&(ue.cur+=1,ve.attValue=this.extractOneOrMore(ue,ie)),B.parse(ve),this.currentLine++}return B.digest()}parseMediaAttributes(B){const ue=new Bt(B);for(;this.currentLine<this.records.length;){const ve=this.getCurrentRecord();if(ve.type!==x.ATTRIBUTE)break;const Ye={attField:this.extractOneOrMore(ve,Qt=>D(Qt)&&Qt!==":"),_cur:0};ve.value[ve.cur]===":"&&(ve.cur+=1,Ye.attValue=this.extractOneOrMore(ve,ie)),ue.parse(Ye),this.currentLine++}return ue.digest()}parseKey(){const B=this.getCurrentRecord();if(B.type===x.KEY){if(B.value==="prompt"||B.value==="clear:"||B.value==="base64:"||B.value==="uri:")return B.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const B=this.getCurrentRecord();if(B.type===x.ZONE_ADJUSTMENTS){const ue=[];for(;;)try{const ve=this.extract(B,this.consumeTime);this.consumeSpaceForRecord(B);let Ye=!1;B.value[B.cur]==="-"&&(Ye=!0,B.cur+=1);const Qt=this.extract(B,this.consumeTypedTime);ue.push({time:ve,typedTime:Qt,back:Ye})}catch{break}if(ue.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ue}return[]}parseRepeat(){const B=[];for(;;){const ue=this.getCurrentRecord();if(ue.type!==x.REPEAT)break;{const ve=this.extract(ue,this.consumeRepeatInterval),Ye=this.parseTypedTime(ue);B.push({repeatInterval:ve,typedTimes:Ye}),this.currentLine++}}return B}parseTypedTime(B){const ue=[];for(;;)try{this.consumeSpaceForRecord(B),ue.push(this.extract(B,this.consumeTypedTime))}catch{break}if(ue.length===0)throw new Error("Invalid typed time.");return ue}parseTime(){const B=this.getCurrentRecord(),ue=this.extract(B,this.consumeTime);this.consumeSpaceForRecord(B);const ve=this.extract(B,this.consumeTime);return this.currentLine++,{startTime:ue,stopTime:ve}}parseBandWidth(){const B=[];for(;this.currentLine<this.records.length;){const ue=this.getCurrentRecord();if(ue.type!==x.BANDWIDTH)break;{const ve=this.extractOneOrMore(ue,D);if(ue.value[ue.cur]!==":")throw new Error("Invalid bandwidth field.");ue.cur++;const Ye=this.extractOneOrMore(ue,b);B.push({bwtype:ve,bandwidth:Ye}),this.currentLine++}}return B}parseVersion(){const B=this.getCurrentRecord();if(B.type!==x.VERSION)throw new Error("first sdp record must be version");const ue=B.value.slice(0,this.consumeOneOrMore(B.value,0,b));if(ue.length!==B.value.length)throw new Error('invalid proto version, "v='.concat(B.value,'"'));return this.currentLine++,ue}parseOrigin(){const B=this.getCurrentRecord();if(B.type!==x.ORIGIN)throw new Error("second line of sdp must be origin");const ue=this.extractOneOrMore(B,I);this.consumeSpaceForRecord(B);const ve=this.extractOneOrMore(B,b);this.consumeSpaceForRecord(B);const Ye=this.extractOneOrMore(B,b);this.consumeSpaceForRecord(B);const Qt=this.extractOneOrMore(B,D);this.consumeSpaceForRecord(B);const jr=this.extractOneOrMore(B,D);this.consumeSpaceForRecord(B);const Os=this.extract(B,this.consumeUnicastAddress);return this.currentLine++,{username:ue,sessId:ve,sessVersion:Ye,nettype:Qt,addrtype:jr,unicastAddress:Os}}parseSessionName(){const B=this.getCurrentRecord();if(B.type===x.SESSION_NAME){const ue=this.extract(B,this.consumeText);return this.currentLine++,ue}}parseInformation(){const B=this.getCurrentRecord();if(B.type!==x.INFORMATION)return;const ue=this.extract(B,this.consumeText);return this.currentLine++,ue}parseUri(){const B=this.getCurrentRecord();if(B.type===x.URI)return this.currentLine++,B.value}parseEmail(){const B=[];for(;;){const ue=this.getCurrentRecord();if(ue.type!==x.EMAIL)break;B.push(ue.value),this.currentLine++}return B}parsePhone(){const B=[];for(;;){const ue=this.getCurrentRecord();if(ue.type!==x.PHONE)break;B.push(ue.value),this.currentLine++}return B}parseConnection(){const B=this.getCurrentRecord();if(B.type===x.CONNECTION){const ue=this.extractOneOrMore(B,D);this.consumeSpaceForRecord(B);const ve=this.extractOneOrMore(B,D);this.consumeSpaceForRecord(B);const Ye=this.extract(B,this.consumeAddress);return this.currentLine++,{nettype:ue,addrtype:ve,address:Ye}}}parseMedia(){const B=this.getCurrentRecord(),ue=this.extract(B,this.consumeToken);this.consumeSpaceForRecord(B);let ve=this.extract(B,this.consumePort);B.value[B.cur]==="/"&&(B.cur+=1,ve+=this.extract(B,this.consumeInteger)),this.consumeSpaceForRecord(B);const Ye=[];for(Ye.push(this.extract(B,this.consumeToken));B.value[B.cur]==="/";)B.cur+=1,Ye.push(this.extract(B,this.consumeToken));if(Ye.length===0)throw new Error("Invalid proto");const Qt=this.parseFmt(B);return this.currentLine++,{mediaType:ue,port:ve,protos:Ye,fmts:Qt}}parseTimeFields(){const B=[];for(;this.getCurrentRecord().type===x.TIME;){const ue=this.parseTime(),ve=this.parseRepeat(),Ye=this.parseZone();B.push({time:ue,repeats:ve,zones:Ye})}return B}parseMediaDescription(){const B=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===x.MEDIA;){const ue=this.parseMedia(),ve=this.parseInformation(),Ye=this.parseConnections(),Qt=this.parseBandWidth(),jr=this.parseKey(),Os=this.parseMediaAttributes(ue);B.push({media:ue,information:ve,connections:Ye,bandwidths:Qt,key:jr,attributes:Os})}return B}parseConnections(){const B=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===x.CONNECTION;)B.push(this.parseConnection());return B}parseFmt(B){const ue=[];for(;;)try{this.consumeSpaceForRecord(B),ue.push(this.extract(B,this.consumeToken))}catch{break}if(ue.length===0)throw new Error("Invalid fmts");return ue}extract(B,ue){for(var ve=arguments.length,Ye=new Array(ve>2?ve-2:0),Qt=2;Qt<ve;Qt++)Ye[Qt-2]=arguments[Qt];const jr=ue.call(this,B.value,B.cur,...Ye),Os=B.value.slice(B.cur,jr);return B.cur=jr,Os}extractOneOrMore(B,ue){const ve=this.consumeOneOrMore(B.value,B.cur,ue),Ye=B.value.slice(B.cur,ve);return B.cur=ve,Ye}consumeSpaceForRecord(B){if(B.value[B.cur]!==y)throw new Error("Invalid space at ".concat(B.cur,"."));B.cur+=1}}class dt extends je{constructor(){super(...arguments),Re(this,"attributes",void 0),Re(this,"digested",!1)}extractOneOrMore(B,ue,ve){const Ye=this.consumeOneOrMore(B.attValue,B._cur,ue),Qt=B.attValue.slice(B._cur,Ye),[jr,Os]=ve||[];if(typeof jr=="number"&&Qt.length<jr)throw new Error("error in length, should be more or equal than ".concat(jr," characters."));if(typeof Os=="number"&&Qt.length>Os)throw new Error("error in length, should be less or equal than ".concat(Os," characters."));return B._cur=Ye,Qt}consumeAttributeSpace(B){if(B.attValue[B._cur]!==y)throw new Error("Invalid space at ".concat(B._cur,"."));B._cur+=1}extract(B,ue){if(!B.attValue)throw new Error("Nothing to extract from attValue.");for(var ve=arguments.length,Ye=new Array(ve>2?ve-2:0),Qt=2;Qt<ve;Qt++)Ye[Qt-2]=arguments[Qt];const jr=ue.call(this,B.attValue,B._cur,...Ye),Os=B.attValue.slice(B._cur,jr);return B._cur=jr,Os}atEnd(B){if(!B.attValue)throw new Error;return B._cur>=B.attValue.length}peekChar(B){if(!B.attValue)throw new Error;return B.attValue[B._cur]}peek(B,ue){if(!B.attValue)throw new Error;for(let ve=0;ve<ue.length;ve++)if(ue[ve]!==B.attValue[B._cur+ve])return!1;return!0}parseIceUfrag(B){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(B,oe,[4,256])}parseIcePwd(B){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(B,oe,[22,256])}parseIceOptions(B){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ue=[];for(;!this.atEnd(B);){ue.push(this.extractOneOrMore(B,oe));try{this.consumeAttributeSpace(B)}catch(ve){if(this.atEnd(B))break;throw ve}}this.attributes.iceOptions=ue}parseFingerprint(B){const ue=this.extract(B,this.consumeToken);this.consumeAttributeSpace(B);const ve=this.extract(B,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ue,fingerprint:ve})}parseExtmap(B){const ue=this.extractOneOrMore(B,b);let ve;this.peekChar(B)==="/"&&(this.extract(B,this.consume,"/"),ve=this.extract(B,this.consumeToken)),this.consumeAttributeSpace(B);const Ye=this.extract(B,this.consumeTill,y),Qt=_e(_e({entry:parseInt(ue,10)},ve&&{direction:ve}),{},{extensionName:Ye});this.peekChar(B)===y&&(this.consumeAttributeSpace(B),Qt.extensionAttributes=this.extract(B,this.consumeTill)),this.attributes.extmaps.push(Qt)}parseSetup(B){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ue=this.extract(B,this.consumeTill);if(ue!=="active"&&ue!=="passive"&&ue!=="actpass"&&ue!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ue}}class Ht extends dt{constructor(){super(...arguments),Re(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(B){if(this.digested)throw new Error("already digested");try{switch(B.attField){case"group":this.parseGroup(B);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(B);break;case"ice-pwd":this.parseIcePwd(B);break;case"ice-options":this.parseIceOptions(B);break;case"fingerprint":this.parseFingerprint(B);break;case"setup":this.parseSetup(B);break;case"tls-id":this.parseTlsId(B);break;case"identity":this.parseIdentity(B);break;case"extmap":this.parseExtmap(B);break;case"msid-semantic":this.parseMsidSemantic(B);break;default:B.ignored=!0,this.attributes.unrecognized.push(B)}}catch(ue){throw console.error("parsing session attribute ".concat(B.attField,' error, "a=').concat(B.attField,":").concat(B.attValue,'"')),ue}if(!B.ignored&&B.attValue&&!this.atEnd(B))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(B){const ue=this.extract(B,this.consumeToken),ve=[];for(;!this.atEnd(B)&&this.peekChar(B)===y;)this.consumeAttributeSpace(B),ve.push(this.extract(B,this.consumeToken));this.attributes.groups.push({semantic:ue,identificationTag:ve})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(B){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(B,fe)}parseIdentity(B){const ue=this.extractOneOrMore(B,Ee),ve=[];for(;!this.atEnd(B)&&this.peekChar(B)===y;){this.consumeAttributeSpace(B);const Ye=this.extract(B,this.consumeToken);this.extract(B,this.consume,"=");const Qt=this.extractOneOrMore(B,jr=>jr!==y&&ie(jr));ve.push({name:Ye,value:Qt})}this.attributes.identities.push({assertionValue:ue,extensions:ve})}parseMsidSemantic(B){this.peekChar(B)===y&&this.consumeAttributeSpace(B);const ue={semantic:this.extract(B,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(B)}catch{break}if(this.peekChar(B)==="*"){this.extract(B,this.consume,"*"),ue.applyForAll=!0;break}{const ve=this.extract(B,this.consumeTill,y);ue.identifierList.push(ve)}}this.attributes.msidSemantic=ue}}class Bt extends dt{constructor(B){super(),Re(this,"attributes",void 0),B.protos.indexOf("RTP")!==-1||B.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(B){if(this.digested)throw new Error("already digested");try{switch(B.attField){case"extmap":this.parseExtmap(B);break;case"setup":this.parseSetup(B);break;case"ice-ufrag":this.parseIceUfrag(B);break;case"ice-pwd":this.parseIcePwd(B);break;case"ice-options":this.parseIceOptions(B);break;case"candidate":this.parseCandidate(B);break;case"remote-candidate":this.parseRemoteCandidate(B);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(B);break;case"rtpmap":this.parseRtpmap(B);break;case"ptime":this.parsePtime(B);break;case"maxptime":this.parseMaxPtime(B);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(B);break;case"ssrc":this.parseSSRC(B);break;case"fmtp":this.parseFmtp(B);break;case"rtcp-fb":this.parseRtcpFb(B);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(B);break;case"mid":this.parseMid(B);break;case"msid":this.parseMsid(B);break;case"imageattr":this.parseImageAttr(B);break;case"rid":this.parseRid(B);break;case"simulcast":this.parseSimulcast(B);break;case"sctp-port":this.parseSctpPort(B);break;case"max-message-size":this.parseMaxMessageSize(B);break;case"ssrc-group":this.parseSSRCGroup(B);break;default:B.ignored=!0,this.attributes.unrecognized.push(B)}}catch(ue){throw console.error("parsing media attribute ".concat(B.attField,' error, "a=').concat(B.attField,":").concat(B.attValue,'"')),ue}if(!B.ignored&&B.attValue&&!this.atEnd(B))throw new Error("attribute parsing error")}parseCandidate(B){const ue=this.extractOneOrMore(B,oe,[1,32]);this.consumeAttributeSpace(B);const ve=this.extractOneOrMore(B,b,[1,5]);this.consumeAttributeSpace(B);const Ye=this.extract(B,this.consumeToken);this.consumeAttributeSpace(B);const Qt=this.extractOneOrMore(B,b,[1,10]);this.consumeAttributeSpace(B);const jr=this.extract(B,this.consumeAddress);this.consumeAttributeSpace(B);const Os=this.extract(B,this.consumePort);this.consumeAttributeSpace(B),this.extract(B,this.consume,"typ"),this.consumeAttributeSpace(B);const Bd={foundation:ue,componentId:ve,transport:Ye,priority:Qt,connectionAddress:jr,port:Os,type:this.extract(B,this.consumeToken),extension:{}};for(this.peek(B," raddr")&&(this.extract(B,this.consume," raddr"),this.consumeAttributeSpace(B),Bd.relAddr=this.extract(B,this.consumeAddress)),this.peek(B," rport")&&(this.extract(B,this.consume," rport"),this.consumeAttributeSpace(B),Bd.relPort=this.extract(B,this.consumePort));this.peekChar(B)===y;){this.consumeAttributeSpace(B);const c_=this.extract(B,this.consumeToken);this.consumeAttributeSpace(B),Bd.extension[c_]=this.extractOneOrMore(B,N)}this.attributes.candidates.push(Bd)}parseRemoteCandidate(B){const ue=[];for(;;){const ve=this.extractOneOrMore(B,b,[1,5]);this.consumeAttributeSpace(B);const Ye=this.extract(B,this.consumeAddress);this.consumeAttributeSpace(B);const Qt=this.extract(B,this.consumePort);ue.push({componentId:ve,connectionAddress:Ye,port:Qt});try{this.consumeAttributeSpace(B)}catch{break}}this.attributes.remoteCandidatesList.push(ue)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(B){const ue=this.extract(B,this.consumeToken);this.consumeAttributeSpace(B);const ve=this.extract(B,this.consumeTill,"/");this.extract(B,this.consume,"/");const Ye={encodingName:ve,clockRate:this.extractOneOrMore(B,b)};this.atEnd(B)||this.peekChar(B)!=="/"||(this.extract(B,this.consume,"/"),Ye.encodingParameters=parseInt(this.extract(B,this.consumeTill),10));const Qt=this.attributes.payloads.find(jr=>jr.payloadType===parseInt(ue,10));Qt?Qt.rtpMap=Ye:this.attributes.payloads.push({payloadType:parseInt(ue,10),rtpMap:Ye,rtcpFeedbacks:[]})}parsePtime(B){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(B,this.consumeTill)}parseMaxPtime(B){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(B,this.consumeTill)}parseDirection(B){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=B.attField}parseSSRC(B){const ue=this.extractOneOrMore(B,b);this.consumeAttributeSpace(B);const ve=this.extract(B,this.consumeTill,":");let Ye;this.peekChar(B)===":"&&(this.extract(B,this.consume,":"),Ye=this.extract(B,this.consumeTill));const Qt=this.attributes.ssrcs.find(jr=>jr.ssrcId===parseInt(ue,10));Qt?Qt.attributes[ve]=Ye:this.attributes.ssrcs.push({ssrcId:parseInt(ue,10),attributes:{[ve]:Ye}})}parseFmtp(B){const ue=this.extract(B,this.consumeTill,y);this.consumeAttributeSpace(B);const ve=this.extract(B,this.consumeTill),Ye={};ve.split(";").forEach(jr=>{let[Os,Bd]=jr.split("=");Os=Oo(Os).call(Os);const c_=typeof Bd=="string"?Oo(Bd).call(Bd):null;typeof Os=="string"&&Os.length>0&&(Ye[Os]=c_)});const Qt=this.attributes.payloads.find(jr=>jr.payloadType===parseInt(ue,10));Qt?Qt.fmtp={parameters:Ye}:this.attributes.payloads.push({payloadType:parseInt(ue,10),rtcpFeedbacks:[],fmtp:{parameters:Ye}})}parseFmtParameters(B){const ue={},ve=this.extract(B,this.consumeTill,"=");B._cur++;const Ye=this.extract(B,this.consumeTill,";");for(ue[ve]=Ye;B.attValue[B._cur]===";";){const Qt=this.extract(B,this.consumeTill,"=");B._cur++;const jr=this.extract(B,this.consumeTill,";");ue[Qt]=jr}return ue}parseRtcpFb(B){let ue="";ue=this.peekChar(B)==="*"?this.extract(B,this.consume,"*"):this.extract(B,this.consumeTill,y),this.consumeAttributeSpace(B);const ve=this.extract(B,this.consumeTill,y);let Ye;if(ve==="trr-int")Ye={type:ve,interval:this.extract(B,this.consumeTill)};else{const Qt={type:ve};this.peekChar(B)===y&&(this.consumeAttributeSpace(B),Qt.parameter=this.extract(B,this.consumeToken),this.peekChar(B)===y&&(Qt.additional=this.extract(B,this.consumeTill))),Ye=Qt}if(ue==="*")this.attributes.rtcpFeedbackWildcards.push(Ye);else{const Qt=this.attributes.payloads.find(jr=>jr.payloadType===parseInt(ue,10));Qt?Qt.rtcpFeedbacks.push(Ye):this.attributes.payloads.push({payloadType:parseInt(ue,10),rtcpFeedbacks:[Ye]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(B){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ue={port:this.extract(B,this.consumePort)};this.peekChar(B)===y&&(this.consumeAttributeSpace(B),ue.netType=this.extractOneOrMore(B,D),this.consumeAttributeSpace(B),ue.addressType=this.extractOneOrMore(B,D),this.consumeAttributeSpace(B),ue.address=this.extract(B,this.consumeAddress)),this.attributes.rtcp=ue}parseMsid(B){const ue={id:this.extractOneOrMore(B,D,[1,64])};this.peekChar(B)===y&&(this.consumeAttributeSpace(B),ue.appdata=this.extractOneOrMore(B,D,[1,64])),this.attributes.msids.push(ue)}parseImageAttr(B){this.attributes.imageattr.push(B.attValue)}parseRid(B){const ue=this.extractOneOrMore(B,Ye=>z(Ye)||b(Ye)||Ye==="_"||Ye==="-");this.consumeAttributeSpace(B);const ve={id:ue,direction:this.extract(B,this.consumeToken),params:[]};if(this.peekChar(B)===y){if(this.consumeAttributeSpace(B),this.peek(B,"pt=")){this.extract(B,this.consume,"pt=");const Ye=[];for(;;){const Qt=this.extract(B,this.consumeToken);Ye.push(Qt);try{this.extract(B,this.consume,",")}catch{break}}ve.payloads=Ye,this.peekChar(B)===y&&this.extract(B,this.consume,y)}for(;;){const Ye=this.extract(B,this.consumeToken);switch(Ye){case"depend":{const Qt={type:Ye,rids:this.extract(B,this.consume,"=").split(",")};ve.params.push(Qt);break}default:{const Qt={type:Ye};this.peekChar(B)==="="&&(this.extract(B,this.consume,"="),Qt.val=this.extract(B,this.consumeTill,";")),ve.params.push(Qt)}}try{this.extract(B,this.consume,";")}catch{break}}}this.attributes.rids.push(ve)}parseSimulcast(B){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=B.attValue,this.extract(B,this.consumeTill)}parseSctpPort(B){this.attributes.sctpPort=this.extractOneOrMore(B,b,[1,5])}parseMaxMessageSize(B){this.attributes.maxMessageSize=this.extractOneOrMore(B,b,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(B){this.attributes.mid=this.extract(B,this.consumeToken)}parseSSRCGroup(B){const ue=this.extract(B,this.consumeToken),ve=[];for(;;)try{this.consumeAttributeSpace(B);const Ye=this.extract(B,this.consumeInteger);ve.push(parseInt(Ye,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ue,ssrcIds:ve})}}function dn(Fe,B,ue){return B in Fe?Object.defineProperty(Fe,B,{value:ue,enumerable:!0,configurable:!0,writable:!0}):Fe[B]=ue,Fe}class sn{constructor(){dn(this,"eol",g)}print(B,ue){let ve="";return ue&&(this.eol=ue),ve+=this.printVersion(B.version),ve+=this.printOrigin(B.origin),ve+=this.printSessionName(B.sessionName),ve+=this.printInformation(B.information),ve+=this.printUri(B.uri),ve+=this.printEmail(B.emails),ve+=this.printPhone(B.phones),ve+=this.printConnection(B.connection),ve+=this.printBandwidth(B.bandwidths),ve+=this.printTimeFields(B.timeFields),ve+=this.printKey(B.key),ve+=this.printSessionAttributes(B.attributes),ve+=this.printMediaDescription(B.mediaDescriptions),ve}printVersion(B){return"v=".concat(B).concat(this.eol)}printOrigin(B){return"o=".concat(B.username," ").concat(B.sessId," ").concat(B.sessVersion," ").concat(B.nettype," ").concat(B.addrtype," ").concat(B.unicastAddress).concat(this.eol)}printSessionName(B){return B?"s=".concat(B).concat(this.eol):""}printInformation(B){return B?"i=".concat(B).concat(this.eol):""}printUri(B){return B?"u=".concat(B).concat(this.eol):""}printEmail(B){let ue="";for(const ve of B)ue+="e=".concat(ve).concat(this.eol);return ue}printPhone(B){let ue="";for(const ve of B)ue+="e=".concat(ve).concat(this.eol);return ue}printConnection(B){return B?"c=".concat(B.nettype," ").concat(B.addrtype," ").concat(B.address).concat(this.eol):""}printBandwidth(B){let ue="";for(const ve of B)ue+="b=".concat(ve.bwtype,":").concat(ve.bandwidth).concat(this.eol);return ue}printTimeFields(B){let ue="";for(const ve of B){ue+="t=".concat(ve.time.startTime," ").concat(ve.time.startTime).concat(this.eol);for(const Ye of ve.repeats)ue+="r=".concat(Ye.repeatInterval," ").concat(Ye.typedTimes.join(" ")).concat(this.eol);ve.zoneAdjustments&&(ue+="z=",ue+="z=".concat(ve.zoneAdjustments.map(Ye=>"".concat(Ye.time," ").concat(Ye.back?"-":""," ").concat(Ye.typedTime)).join(" ")).concat(this.eol),ue+=this.eol)}return ue}printKey(B){return B?"k=".concat(B).concat(this.eol):""}printAttributes(B){let ue="";for(const ve of B)ue+="a=".concat(ve.attField).concat(ve.attValue?":".concat(ve.attValue):"").concat(this.eol);return ue}printMediaDescription(B){let ue="";for(const ve of B)ue+=this.printMedia(ve.media),ue+=this.printInformation(ve.information),ue+=this.printConnections(ve.connections),ue+=this.printBandwidth(ve.bandwidths),ue+=this.printKey(ve.key),ue+=this.printMediaAttributes(ve);return ue}printConnections(B){let ue="";for(const ve of B)ue+=this.printConnection(ve);return ue}printMedia(B){return"m=".concat(B.mediaType," ").concat(B.port," ").concat(B.protos.join("/")," ").concat(B.fmts.join(" ")).concat(this.eol)}printSessionAttributes(B){return new ei(this.eol).print(B)}printMediaAttributes(B){return new Ue(this.eol).print(B)}}class Qn{constructor(B){dn(this,"eol",void 0),this.eol=B}printIceUfrag(B){return B===void 0?"":"a=ice-ufrag:".concat(B).concat(this.eol)}printIcePwd(B){return B===void 0?"":"a=ice-pwd:".concat(B).concat(this.eol)}printIceOptions(B){return B===void 0?"":"a=ice-options:".concat(B.join(y)).concat(this.eol)}printFingerprints(B){return B.length>0?B.map(ue=>"a=fingerprint:".concat(ue.hashFunction).concat(y).concat(ue.fingerprint)).join(this.eol)+this.eol:""}printExtmap(B){return B.map(ue=>"a=extmap:".concat(ue.entry).concat(ue.direction?"/".concat(ue.direction):"").concat(y).concat(ue.extensionName).concat(ue.extensionAttributes?"".concat(y).concat(ue.extensionAttributes):"").concat(this.eol)).join("")}printSetup(B){return B===void 0?"":"a=setup:".concat(B).concat(this.eol)}printUnrecognized(B){return B.map(ue=>"a=".concat(ue.attField).concat(ue.attValue?":".concat(ue.attValue):"").concat(this.eol)).join("")}}class ei extends Qn{print(B){let ue="";return ue+=this.printGroups(B.groups),ue+=this.printMsidSemantic(B.msidSemantic),ue+=this.printIceLite(B.iceLite),ue+=this.printIceUfrag(B.iceUfrag),ue+=this.printIcePwd(B.icePwd),ue+=this.printIceOptions(B.iceOptions),ue+=this.printFingerprints(B.fingerprints),ue+=this.printSetup(B.setup),ue+=this.printTlsId(B.tlsId),ue+=this.printIdentity(B.identities),ue+=this.printExtmap(B.extmaps),ue+=this.printUnrecognized(B.unrecognized),ue}printGroups(B){let ue="";return B.length>0&&(ue+=B.map(ve=>"a=group:".concat(ve.semantic).concat(ve.identificationTag.map(Ye=>"".concat(y).concat(Ye)).join("")).concat(this.eol)).join("")),ue}printIceLite(B){return B===void 0?"":"a=ice-lite"+this.eol}printTlsId(B){return B?"a=tls-id:".concat(B).concat(this.eol):""}printIdentity(B){return B.length===0?"":B.map(ue=>"a=identity:".concat(ue.assertionValue).concat(ue.extensions.map(ve=>"".concat(y).concat(ve.name).concat(ve.value?"=".concat(ve.value):"")))).join(this.eol)+this.eol}printMsidSemantic(B){if(!B)return"";let ue="a=msid-semantic:".concat(B.semantic);return B.applyForAll?ue+="".concat(y,"*"):B.identifierList.length>0&&(ue+=B.identifierList.map(ve=>"".concat(y).concat(ve))),ue+this.eol}}class Ue extends Qn{print(B){const ue=B.attributes;let ve="";return ve+=this.printRTCP(ue.rtcp),ve+=this.printIceUfrag(ue.iceUfrag),ve+=this.printIcePwd(ue.icePwd),ve+=this.printIceOptions(ue.iceOptions),ve+=this.printCandidates(ue.candidates),ve+=this.printRemoteCandidatesList(ue.remoteCandidatesList),ve+=this.printEndOfCandidates(ue.endOfCandidates),ve+=this.printFingerprints(ue.fingerprints),ve+=this.printSetup(ue.setup),ve+=this.printMid(ue.mid),ve+=this.printExtmap(ue.extmaps),ve+=this.printRTPRelated(ue),ve+=this.printPtime(ue.ptime),ve+=this.printMaxPtime(ue.maxPtime),ve+=this.printDirection(ue.direction),ve+=this.printSSRCGroups(ue.ssrcGroups),ve+=this.printSSRC(ue.ssrcs),ve+=this.printRTCPMux(ue.rtcpMux),ve+=this.printRTCPMuxOnly(ue.rtcpMuxOnly),ve+=this.printRTCPRsize(ue.rtcpRsize),ve+=this.printMSId(ue.msids),ve+=this.printImageattr(ue.imageattr),ve+=this.printRid(ue.rids),ve+=this.printSimulcast(ue.simulcast),ve+=this.printSCTPPort(ue.sctpPort),ve+=this.printMaxMessageSize(ue.maxMessageSize),ve+=this.printUnrecognized(ue.unrecognized),ve}printCandidates(B){return B.map(ue=>"a=candidate:".concat(ue.foundation).concat(y).concat(ue.componentId).concat(y).concat(ue.transport).concat(y).concat(ue.priority).concat(y).concat(ue.connectionAddress).concat(y).concat(ue.port).concat(y,"typ").concat(y).concat(ue.type).concat(ue.relAddr?"".concat(y,"raddr").concat(y).concat(ue.relAddr):"").concat(ue.relPort?"".concat(y,"rport").concat(y).concat(ue.relPort):"").concat(Object.keys(ue.extension).map(ve=>"".concat(y).concat(ve).concat(y).concat(ue.extension[ve])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(B){return B.map(ue=>"a=remote-candidates:".concat(ue.join(y)).concat(this.eol)).join("")}printEndOfCandidates(B){return B===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(B){if(!B.payloads)return"";const ue=B.payloads;let ve="";ve+=B.rtcpFeedbackWildcards.map(Ye=>this.printRTCPFeedback("*",Ye)).join("");for(const Ye of ue)ve+=this.printRtpMap(Ye.payloadType,Ye.rtpMap),ve+=this.printFmtp(Ye.payloadType,Ye.fmtp),ve+=Ye.rtcpFeedbacks.map(Qt=>this.printRTCPFeedback(Ye.payloadType,Qt)).join("");return ve}printFmtp(B,ue){if(!ue)return"";const ve=Object.keys(ue.parameters);return ve.length===1&&ue.parameters[ve[0]]===null?"a=fmtp:".concat(B).concat(y).concat(ve[0]).concat(this.eol):"a=fmtp:".concat(B).concat(y).concat(Object.keys(ue.parameters).map(Ye=>"".concat(Ye,"=").concat(ue.parameters[Ye])).join(";")).concat(this.eol)}printRtpMap(B,ue){return ue?"a=rtpmap:".concat(B).concat(y).concat(ue.encodingName,"/").concat(ue.clockRate).concat(ue.encodingParameters?"/".concat(ue.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(B,ue){let ve="a=rtcp-fb:".concat(B).concat(y),Ye=ue;return Ye.type==="trr-int"?ve+="ttr-int".concat(y).concat(Ye.interval):(ve+="".concat(Ye.type),Ye.parameter&&(ve+="".concat(y).concat(Ye.parameter),Ye.additional&&(ve+="".concat(y).concat(Ye.additional)))),ve+this.eol}printPtime(B){return B===void 0?"":"a=ptime:".concat(B).concat(this.eol)}printMaxPtime(B){return B===void 0?"":"a=maxptime:".concat(B).concat(this.eol)}printDirection(B){return B===void 0?"":"a=".concat(B).concat(this.eol)}printSSRC(B){return B.map(ue=>Object.keys(ue.attributes).map(ve=>"a=ssrc:".concat(ue.ssrcId.toString(10)).concat(y).concat(ve).concat(ue.attributes[ve]?":".concat(ue.attributes[ve]):"").concat(this.eol)).join("")).join("")}printRTCPMux(B){return B===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(B){return B===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(B){return B===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(B){if(B===void 0)return"";let ue="a=rtcp:".concat(B.port);return B.netType&&(ue+="".concat(y).concat(B.netType)),B.addressType&&(ue+="".concat(y).concat(B.addressType)),B.address&&(ue+="".concat(y).concat(B.address)),ue+this.eol}printMSId(B){return B.map(ue=>"a=msid:".concat(ue.id).concat(ue.appdata?"".concat(y).concat(ue.appdata):"").concat(this.eol)).join("")}printImageattr(B){return B.map(ue=>"a=imageattr:".concat(ue).concat(this.eol)).join("")}printRid(B){return B.map(ue=>{let ve="a=rid:".concat(ue.id).concat(y).concat(ue.direction);return ue.payloads&&(ve+="".concat(y,"pt=").concat(ue.payloads.join(","))),ue.params.length>0&&(ve+="".concat(y).concat(ue.params.map(Ye=>Ye.type==="depend"?"depend=".concat(Ye.rids.join(",")):"".concat(Ye.type,"=").concat(Ye.val)).join(";"))),ve+this.eol}).join("")}printSimulcast(B){return B===void 0?"":"a=simulcast:".concat(B).concat(this.eol)}printSCTPPort(B){return B===void 0?"":"a=sctp-port:".concat(B).concat(this.eol)}printMaxMessageSize(B){return B===void 0?"":"a=max-message-size:".concat(B).concat(this.eol)}printMid(B){return B===void 0?"":"a=mid:".concat(B).concat(this.eol)}printSSRCGroups(B){return B.map(ue=>"a=ssrc-group:".concat(ue.semantic).concat(ue.ssrcIds.map(ve=>"".concat(y).concat(ve.toString(10))).join("")).concat(this.eol)).join("")}}function Qe(Fe){return new Be().parse(Fe)}function ft(Fe,B){return new sn().print(Fe,B)}}},i={};function s(o){if(i[o])return i[o].exports;var d=i[o]={exports:{}};return n[o](d,d.exports,s),d.exports}return s.d=(o,d)=>{for(var h in d)s.o(d,h)&&!s.o(o,h)&&Object.defineProperty(o,h,{enumerable:!0,get:d[h]})},s.o=(o,d)=>Object.prototype.hasOwnProperty.call(o,d),s.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},s(8)})();function Mo(n){return _Y.parse(n)}function um(n,i){return _Y.print(n,i)}var Txe=Co("Array","keys"),Rxe=hl,Cxe=Zi,Nxe=A,Ixe=Txe,s4=Array.prototype,Axe={DOMTokenList:!0,NodeList:!0},kxe=function(n){var i=n.keys;return n===s4||Nxe(s4,n)&&i===s4.keys||Cxe(Axe,Rxe(n))?Ixe:i},Xa=l(kxe);function Si(n,i,s){return(i=function(o){var d=function(h,f){if(typeof h!="object"||!h)return h;var g=h[Symbol.toPrimitive];if(g!==void 0){var y=g.call(h,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(h)}(o);return typeof d=="symbol"?d:d+""}(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function yY(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function on(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?yY(Object(s),!0).forEach(function(o){Si(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):yY(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}function Wk(n,i){return Wk=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,o){return s.__proto__=o,s},Wk(n,i)}function a4(){a4=function(d,h){return new s(d,void 0,h)};var n=RegExp.prototype,i=new WeakMap;function s(d,h,f){var g=RegExp(d,h);return i.set(g,f||i.get(d)),Wk(g,s.prototype)}function o(d,h){var f,g=i.get(h);return lc(f=Object.keys(g)).call(f,function(y,x){var b=g[x];if(typeof b=="number")y[x]=d[b];else{for(var N=0;d[b[N]]===void 0&&N+1<b.length;)N++;y[x]=d[b[N]]}return y},Object.create(null))}return function(d,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function");d.prototype=Object.create(h&&h.prototype,{constructor:{value:d,writable:!0,configurable:!0}}),Object.defineProperty(d,"prototype",{writable:!1}),h&&Wk(d,h)}(s,RegExp),s.prototype.exec=function(d){var h=n.exec.call(this,d);if(h){h.groups=o(h,this);var f=h.indices;f&&(f.groups=o(f,this))}return h},s.prototype[Symbol.replace]=function(d,h){if(typeof h=="string"){var f=i.get(this);return n[Symbol.replace].call(this,d,h.replace(/\$<([^>]+)(>|$)/g,function(y,x,b){if(b==="")return y;var N=f[x];return Array.isArray(N)?"$"+N.join("$"):typeof N=="number"?"$"+N:""}))}if(typeof h=="function"){var g=this;return n[Symbol.replace].call(this,d,function(){var y=arguments;return typeof y[y.length-1]!="object"&&(y=[].slice.call(y)).push(o(y,g)),h.apply(this,y)})}return n[Symbol.replace].call(this,d,h)},a4.apply(this,arguments)}const vY=new class extends ai{constructor(){super(...arguments),Si(this,"currentUploadLogID",0)}reportLogUploadError(n){const{errorRange:i}=n;i[i.length-1]&&i[i.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=i[i.length-1],this.emit("REPORT_LOG_UPLOAD",n))}};class Pxe{constructor(i){Si(this,"logger",void 0),Si(this,"prefixLists",[]),this.logger=i}debug(){for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];this.logger.debug(...this.prefixLists,...s)}info(){for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];this.logger.info(...this.prefixLists,...s)}warning(){for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];this.logger.warning(...this.prefixLists,...s)}error(){for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];this.logger.error(...this.prefixLists,...s)}prefix(i){return this.prefixLists.push(i),this}popPrefix(){return this.prefixLists.pop(),this}}function o4(){const n=new Date;return n.toTimeString().split(" ")[0]+":"+n.getMilliseconds()}function EY(){const n=new Date,i=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return i?(i==null?void 0:i[0])+":"+n.getUTCMilliseconds():n.toTimeString().split(" ")[0]+":"+n.getMilliseconds()}const Dd={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Hk=Date.now(),rR=n=>{for(const i in Dd)if(Object.prototype.hasOwnProperty.call(Dd,i)&&Dd[i]===n)return i;return"DEFAULT"},M=new class{constructor(){Si(this,"proxyServerURL",void 0),Si(this,"logLevel",Dd.DEBUG),Si(this,"uploadState","collecting"),Si(this,"uploadLogWaitingList",[]),Si(this,"uploadLogUploadingList",[]),Si(this,"uploadErrorCount",0),Si(this,"currentLogID",0),Si(this,"url",void 0),Si(this,"extLog",(n,i)=>{this.appendLogToWaitingList(n,...i)})}debug(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];const o=[Dd.DEBUG].concat(i);this.log.apply(this,o)}info(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];const o=[Dd.INFO].concat(i);this.log.apply(this,o)}warning(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];const o=[Dd.WARNING].concat(i);this.log.apply(this,o)}warn(){this.warning(...arguments)}error(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];const o=[Dd.ERROR].concat(i);this.log.apply(this,o)}upload(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];const o=[Dd.DEBUG].concat(i);this.uploadLog.apply(this,o)}setLogLevel(n){n=Math.min(Math.max(0,n),4),this.logLevel=n}enableLogUpload(){xr("UPLOAD_LOG",!0)}disableLogUpload(){xr("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(n){this.proxyServerURL=n}prefix(n){return new Pxe(this).prefix(n)}log(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];if(Date.now()-Hk<100)return void setTimeout(()=>{this.log(...i)},Date.now()-Hk);const o=Math.max(0,Math.min(4,i[0]));if(i[0]=o4()+" Agora-SDK [".concat(rR(o),"]:"),this.appendLogToWaitingList(o,...i),o<this.logLevel)return;const d=o4()+" %cAgora-SDK [".concat(rR(o),"]:");let h=[];if(!re("USE_NEW_LOG"))switch(o){case Dd.DEBUG:h=[d,"color: #64B5F6;"].concat(i.slice(1)),console.log.apply(console,h);break;case Dd.INFO:h=[d,"color: #1E88E5; font-weight: bold;"].concat(i.slice(1)),console.log.apply(console,h);break;case Dd.WARNING:h=[d,"color: #FB8C00; font-weight: bold;"].concat(i.slice(1)),console.warn.apply(console,h);break;case Dd.ERROR:h=[d,"color: #B00020; font-weight: bold;"].concat(i.slice(1)),console.error.apply(console,h)}}uploadLog(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];if(Date.now()-Hk<100)return void setTimeout(()=>{this.uploadLog(...i)},Date.now()-Hk);const o=Math.max(0,Math.min(4,i[0]));i[0]=o4()+" Agora-SDK [".concat(rR(o),"]:"),this.appendLogToWaitingList(o,...i)}appendLogToWaitingList(n){if(!re("UPLOAD_LOG"))return;for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];Array.isArray(s[0])?s[0][0]=EY()+" Agora-SDK [".concat(rR(n),"]:"):s[0]=EY()+" Agora-SDK [".concat(rR(n),"]:");let d="";s.forEach(h=>{typeof h=="object"&&(h=JSON.stringify(h)),d+="".concat(h," ")}),this.uploadLogWaitingList.push({payload_str:d,log_level:n,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const n=this.uploadLogUploadingList,i={sdk_version:Pd,process_id:re("PROCESS_ID"),payload:JSON.stringify(n)};return Dh(async()=>{const s=await mc.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(re("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(re("LOG_UPLOAD_SERVER"),"/upload/v1")),i,{responseType:"text"});if(s.data!=="OK"){const o=new Error("unexpected upload log response");throw o.response=s,o}},()=>(this.uploadLogUploadingList=[],!1),s=>{const o={status:-1,message:s.message,errorRange:n.map(d=>d.log_item_id)};return s.response?(o.status=s.response.status,o.data=s.response.data,o.headers=s.response.headers):s.request&&(o.status=s.request.status),vY.reportLogUploadError(o),!0},{timeout:re("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:re("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,re("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),re("UPLOAD_LOG_INTERVAL"))}).catch(n=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),re("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),re("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var xY;function Dxe(n){return la(n.reportId,"params.reportId",0,100,!1),la(n.category,"params.category",0,100,!1),la(n.event,"params.event",0,100,!1),la(n.label,"params.label",0,100,!1),Sr(n.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(xY={}).FREE="free",xY.UPLOADING="uploading",function(n){n[n.MISC=0]="MISC",n[n.INTERNAL_EVENT=1]="INTERNAL_EVENT",n[n.PUBLIC_EVENT=2]="PUBLIC_EVENT",n[n.WEB_EVENT=3]="WEB_EVENT",n[n.INTERNAL_API=4]="INTERNAL_API",n[n.WEB_API=5]="WEB_API",n[n.PUBLIC_API=6]="PUBLIC_API"}({});const Oxe={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let ms=function(n){return n.PUBLISH="publish",n.SUBSCRIBE="subscribe",n.WS_COMPRESSOR_INIT="ws_compressor_init",n.SESSION_INIT="session_init",n.JOIN_CHOOSE_SERVER="join_choose_server",n.RTE_DETAIL="rte_detail_stats",n.REQ_USER_ACCOUNT="req_user_account",n.JOIN_GATEWAY="join_gateway",n.REJOIN_GATEWAY="rejoin_gateway",n.STREAM_SWITCH="stream_switch",n.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",n.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",n.FIRST_VIDEO_RECEIVED="first_video_received",n.FIRST_AUDIO_RECEIVED="first_audio_received",n.FIRST_VIDEO_DECODE="first_video_decode",n.FIRST_AUDIO_DECODE="first_audio_decode",n.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",n.ON_ADD_AUDIO_STREAM="on_add_audio_stream",n.ON_ADD_VIDEO_STREAM="on_add_video_stream",n.ON_UPDATE_STREAM="on_update_stream",n.ON_REMOVE_STREAM="on_remove_stream",n.USER_ANALYTICS="req_user_analytics",n.PC_STATS="pc_stats",n.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",n.AB_TEST="ab_test",n}({}),Zr=function(n){return n.SESSION="io.agora.pb.Wrtc.Session",n.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",n.RTE_DETAIL="io.agora.pb.Wrtc.RteDetailStats",n.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",n.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",n.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",n.PUBLISH="io.agora.pb.Wrtc.Publish",n.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",n.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",n.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",n.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",n.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",n.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",n.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",n.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",n.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",n.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",n.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",n.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",n.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",n.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",n.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",n.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",n.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",n.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",n.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",n.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",n.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",n.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",n.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",n.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",n.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",n.PC_STATS="io.agora.pb.Wrtc.PCStats",n.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",n.AB_TEST="io.agora.pb.Wrtc.ABTest",n}({});(function(n){n[n.WORKER_EVENT=156]="WORKER_EVENT",n[n.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Lxe=function(n){return n[n.SESSION=26]="SESSION",n[n.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",n[n.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",n[n.JOIN_GATEWAY=28]="JOIN_GATEWAY",n[n.PUBLISH=30]="PUBLISH",n[n.SUBSCRIBE=29]="SUBSCRIBE",n[n.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",n[n.STREAM_SWITCH=32]="STREAM_SWITCH",n[n.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",n[n.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",n[n.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",n[n.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",n[n.API_INVOKE=41]="API_INVOKE",n[n.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",n[n.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",n[n.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",n[n.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",n[n.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",n[n.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",n[n.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",n[n.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",n[n.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",n[n.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",n[n.WORKER_EVENT=156]="WORKER_EVENT",n[n.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",n[n.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",n[n.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",n[n.USER_ANALYTICS=1e4]="USER_ANALYTICS",n[n.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",n}({});function Vt(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(i,s,o){const d=o.value;if(typeof d=="function"){const h=n.className||i.__className__||(i.constructor.name==="AgoraRTCClient"?"Client":i.constructor.name);o.value=function(){for(var f,g=arguments.length,y=new Array(g),x=0;x<g;x++)y[x]=arguments[x];let b=y;if(n.argsMap)try{b=n.argsMap(this,...y)}catch(I){M.warning(I),b=[]}try{JSON.stringify(b)}catch{M.warning("arguments for method ".concat(h,".").concat(String(s)," not serializable for apiInvoke.")),b=[]}const N=(n.report||_t).reportApiInvoke(this._sessionId||null,{id:this._clientId||((f=this.store)===null||f===void 0?void 0:f.clientId)||this._ID,name:"".concat(h,".").concat(String(s)),options:b,tag:Tr.TRACER,reportResult:n.reportResult},n.throttleTime);try{const I=d.apply(this,y);return I instanceof et?I.then(D=>(N.onSuccess(n.reportResult&&D),D)).catch(D=>{throw N.onError(D),D}):(N.onSuccess(n.reportResult&&I),I)}catch(I){throw N.onError(I),I}}}return o}}const _t=new class{constructor(){Si(this,"baseInfoMap",new Map),Si(this,"proxyServer",void 0),Si(this,"eventUploadTimer",void 0),Si(this,"setSessionIdTimer",void 0),Si(this,"url",void 0),Si(this,"sids",new Set),Si(this,"backupUrl",void 0),Si(this,"_appId",void 0),Si(this,"_aid",0),Si(this,"keyEventUploadPendingItems",[]),Si(this,"normalEventUploadPendingItems",[]),Si(this,"apiInvokeUploadPendingItems",[]),Si(this,"apiInvokeCount",0),Si(this,"apiInvokeLoggedCount",0),Si(this,"ltsList",[]),Si(this,"lastSendNormalEventTime",Date.now()),Si(this,"customReportCounterTimer",void 0),Si(this,"customReportCount",0),Si(this,"extApiInvoke",async n=>{for(const i of n){const s=on(on({},i),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Tr.TRACER});this.sendApiInvoke(s)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),re("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),re("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(n){return this.baseInfoMap.get(n)}setAppId(n){this._appId=n,this._aid=parseInt(n.replace(/[a-fA-F0-9]{8}/g,i=>{let[s,o]=i;return s+o}),16)||0}reportApiInvoke(n,i,s){i.timeout=i.timeout||6e4,i.reportResult=i.reportResult===void 0||i.reportResult;const o=Date.now();this.apiInvokeCount+=1;const d=this.apiInvokeCount,h=!!re("SHOW_REPORT_INVOKER_LOG"),f=!!re("SHOW_REPORT_USER_INVOKER_LOG"),g=h||f&&i.id;g&&(this.apiInvokeLoggedCount+=1);const y=this.apiInvokeLoggedCount;function x(D,$){if(g){let z="[apiInvoke-".concat(y,"]");if(i.id&&(z+="[".concat(i.id,"]")),i.name&&(z+="[".concat(i.name,"]"),i.name===Qr.JOIN))return M.info("".concat(z," ").concat(D));M.info("".concat(z," ").concat(D),D==="start"?i.options:$||"")}}const b=()=>({tag:i.tag,invokeId:d,sid:n,name:i.name,apiInvokeTime:o,options:i.options,states:i.states||null});x("start");let N=!1;As(i.timeout).then(()=>{N||(this.sendApiInvoke(on(on({},b()),{},{error:se.API_INVOKE_TIMEOUT,success:!1})),x("timeout"))});const I=new Pe(se.UNEXPECTED_ERROR,"".concat(i.name,": this api invoke is end"));return{onSuccess:D=>{const $=()=>{if(N)throw I;return N=!0,this.sendApiInvoke(on(on({},b()),{},{success:!0},i.reportResult&&{result:D})),x("onSuccess"),D};return s?tY($,i.name+"Success",s,()=>N=!0):$()},onError:D=>{const $=()=>{if(N)throw D;N=!0,this.sendApiInvoke(on(on({},b()),{},{success:!1,error:D})),x("onFailure",D.toString())};return s?tY($,i.name+"Error",s,()=>N=!0):$()}}}_send(n,i,s){this.send({type:n,data:i},s)}_sendApiInvoke(n){return this.sendApiInvoke(n)}sessionInit(n,i){if(this.baseInfoMap.has(n))return;const s=Date.now(),o=this.createBaseInfo(n,s);o.cname=i.cname,o.rteUrl=i.rteUrl;const d=Object.assign({},{willUploadConsoleLog:re("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:t4?"global":"oversea",areas:re("AREAS")&&re("AREAS").join(",")},i.extend),{stringUid:h,channelProfile:f,channelMode:g,isABTestSuccess:y,lsid:x,clientRole:b}=i,N=Date.now(),I=on(on({},o),{},{eventType:ms.SESSION_INIT,appid:i.appid,browser:navigator.userAgent,buildFormat:i.buildFormat,build:r4,lts:N,elapse:N-s,extend:JSON.stringify(d),mode:i.mode,process:re("PROCESS_ID"),appType:re("APP_TYPE"),success:!0,version:Pd,stringUid:h,channelProfile:f,channelMode:g,isABTestSuccess:y,lsid:x,clientType:Ge(D=window.navigator.userAgent).call(D,"AgoraWebView")?42:20,clientRole:b,serviceId:re("PROCESS_ID"),extensionID:re("PLUGIN_INFO").join(",")||"",rteUrl:i.rteUrl,rteSid:i.rteSid});var D;this.send({type:Zr.SESSION,data:I},!0)}reportRteDetail(n){const i=this.baseInfoMap.get(n);if(!i)return;const s=i.info,o=Date.now(),d=on(on({},s),{},{eventType:ms.RTE_DETAIL,lts:o,success:!0,elapse:o-i.startTime,vid:s.vid===void 0?0:Number(s.vid),ua:navigator.userAgent});this.send({type:Zr.RTE_DETAIL,data:d},!0)}joinChooseServer(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const o=s.info;i.vid&&(o.vid=i.vid);const d=Date.now(),h=on(on({},o),{},{role:i.role,eventType:ms.JOIN_CHOOSE_SERVER,lts:d,eventElapse:i.elapse||d-i.lts,chooseServerAddr:i.csAddr,errorCode:i.ec,elapse:d-s.startTime,success:i.succ,chooseServerAddrList:JSON.stringify(i.serverList),uid:i.uid?parseInt(i.uid):null,cid:i.cid?parseInt(i.cid):null,chooseServerIp:i.csIp||"",opid:i.opid,unilbsServerIds:i.unilbsServerIds,extend:i.extend||void 0,isHttp3:i.isHttp3,corssRegionTagReq:i.corssRegionTagReq||void 0,corssRegionTagRes:i.corssRegionTagRes||void 0,ua:navigator.userAgent,resourceTimingInfo:i.resourceTimingInfo||void 0});this.send({type:Zr.JOIN_CHOOSE_SERVER,data:h},!0)}reqUserAccount(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const o=s.info,d=Date.now(),h=on(on({},o),{},{eventType:ms.REQ_USER_ACCOUNT,lts:d,success:i.success,serverAddress:i.serverAddr,stringUid:i.stringUid,uid:i.uid,errorCode:i.errorCode,elapse:i.elapse||d-s.startTime,eventElapse:d-i.lts,extend:JSON.stringify(i.extend)});this.send({type:Zr.REQ_USER_ACCOUNT,data:h},!0)}joinGateway(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const o=s.info;i.vid&&(o.vid=i.vid),o.uid=i.uid,o.cid=i.cid;const d=Date.now(),{firstSuccess:h,addr:f,isProxy:g}=i,y=d-s.startTime,x=on(on({},o),{},{eventType:ms.JOIN_GATEWAY,lts:d,gatewayAddr:i.addr,success:i.succ,errorCode:i.ec,errorMsg:i.errorMsg||"",elapse:y,eventElapse:d-i.lts,firstSuccess:h,signalChannel:i.signalChannel,preload:i.preload?1:0,installId:e4(),isABTestSuccess:i.isABTestSuccess?1:0,gatewayIp:null,gatewayPort:null,isProxy:g?1:0}),b=x.success?1:0;if(i.succ&&(s.lastJoinSuccessTime=d),f)if(x.signalChannel==="1"){const N=a4(/(\d+\.\d+\.\d+\.\d+):(\d+)/,{ip:1,port:2}),I=f.match(N);x.gatewayIp=I&&I.groups?I.groups.ip:"",x.gatewayPort=I&&I.groups?I.groups.port:""}else if(g){const N=f.match(/h=(\d{1,3}-){3}\d{1,3}/g),I=f.match(/p=[0-9]{1,6}/g);x.gatewayIp=N&&N.length?N[0].split("=")[1].replace(/-/g,"."):"",x.gatewayPort=I&&I.length?I[0].split("=")[1]:""}else{const N=f.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),I=f.match(/(:|p=)[0-9]{1,6}/g);x.gatewayIp=N&&N.length?N[0].split("//")[1].replace(/-/g,"."):"",x.gatewayPort=I&&I.length?I[0].split(/:|p=/g)[1]:""}if(h)this.send({type:Zr.JOIN_GATEWAY,data:x},!0);else{let N={isSuccess:b,port:x.gatewayPort};delete x.success,delete x.eventType,delete x.firstSuccess,delete x.gatewayPort,x.vid=Number(x.vid);const I=Object.assign({},x,N,{eventType:ms.REJOIN_GATEWAY});this.send({type:Zr.RE_JOIN_GATEWAY,data:I},!0)}}joinChannelTimeout(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const o=Date.now(),d=on(on({},s.info),{},{lts:o,timeout:i,elapse:o-s.startTime});this.send({type:Zr.JOIN_CHANNEL_TIMEOUT,data:d},!0)}publish(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const o=s.info,d=Date.now(),h=on(on({},o),{},{eventType:ms.PUBLISH,lts:d,eventElapse:i.eventElapse,elapse:d-s.startTime,success:i.succ,errorCode:i.ec,videoName:i.videoName,audioName:i.audioName,screenName:i.screenName,screenshare:i.screenshare,audio:i.audio,video:i.video,p2pid:i.p2pid,publishRequestid:i.publishRequestid});this.send({type:Zr.PUBLISH,data:h},!0)}subscribe(n,i,s){const o=this.baseInfoMap.get(n);if(!o)return;const d=o.info,h=Date.now(),f=on(on({},d),{},{eventType:ms.SUBSCRIBE,lts:h,eventElapse:i.eventElapse,elapse:h-o.startTime,success:i.succ,errorCode:i.ec,video:i.video,audio:i.audio,subscribeRequestid:i.subscribeRequestid,p2pid:i.p2pid,preSsrc:i.preSsrc?1:0},s&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof i.peerid=="string"?f.peerSuid=i.peerid:f.peer=i.peerid,this.send({type:Zr.SUBSCRIBE,data:f},!0)}wsCompressorInit(n){var i;const s=[...Xa(i=this.baseInfoMap).call(i)],o=s.length?s[0]:"UnableToGetSid",d=this.baseInfoMap.get(o);if(!d)return;const h=d.info,f=Date.now(),g=on(on({},h),{},{eventType:ms.WS_COMPRESSOR_INIT,lts:f,eventElapse:n.eventElapse,elapse:f-d.startTime,status:n.status?1:2});this.send({type:Zr.WS_COMPRESSOR_INIT,data:g},!0)}firstXLAPeerFirstVideoFrame(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const o=s.info,d=Date.now(),h=i.peerPubStatusMs-(s.lastJoinSuccessTime||d),f=on(on({},o),{},{elapse:d-s.startTime,eventType:ms.XLA_PEER_FIRST_VIDEO_FRAME,lts:d,peer:i.peer,width:i.width,height:i.height,ssrc:i.ssrc,p2pid:i.p2pid,peerPublishDuration:i.peerPublishDuration,joinChannelSuccessElapse:h,peerPubStatusMs:i.peerPubStatusMs-i.joinChannelStart,availablePublish:i.peerPublishDuration>h?1:0,preloadStart:Math.max(i.preloadStart-i.joinChannelStart,0),preloadEnd:Math.max(i.preloadEnd-i.joinChannelStart,0),encrypt:Math.max(i.apStart-i.joinChannelStart,0),ap:Math.max(i.apEnd-i.joinChannelStart,0),sua:Math.max(i.suaEnd-i.joinChannelStart,0),beforeConnect:Math.max(i.beforeConnect-i.joinChannelStart,0),peerRecevier:Math.max(i.peerReceiver-i.joinChannelStart,0),ice:Math.max(i.ice-i.joinChannelStart,0),pc:Math.max(i.pc-i.joinChannelStart,0),signalConnected:Math.max(i.signalConnected-i.joinChannelStart,0),joinReq:Math.max(i.joinReq-i.joinChannelStart,0),joinRes:Math.max(i.joinRes-i.joinChannelStart,0),userJoinNotify:Math.max(i.userJoinNotify-i.joinChannelStart,0),videoSsrcNotify:Math.max(i.videoAddNotify-i.joinChannelStart,0),subscribeDelayMs:Math.max(i.subscribeStart-i.videoAddNotify,0),subscribeStart:Math.max(i.subscribeStart-i.joinChannelStart,0),subscribeEnd:Math.max(i.subscribeEnd-i.joinChannelStart,0),firstReceived:Math.max(i.firstReceived-i.joinChannelStart,0),firstDecoded:Math.max(i.firstDecoded-i.joinChannelStart,0),firstPreRender:Math.max(i.firstPreRender-i.joinChannelStart,0),firstRender:Math.max(i.firstRender-i.joinChannelStart,0),playDelayMs:Math.max(i.playStart-i.subscribeEnd,0),playStart:Math.max(i.playStart-i.joinChannelStart,0),playEnd:Math.max(i.playEnd-i.joinChannelStart,0),isPreSub:i.isPreSub?1:0,isPrePc:i.isPrePc?1:0,isPreInstantVideo:i.isPreInstantVideo?1:0,firstReceivedEncodedFrame:i.firstReceivedEncodedFrame?Math.max(i.firstReceivedEncodedFrame-i.joinChannelStart,0):void 0,frameType:i.frameType||"",rtpTimestamp:i.rtpTimestamp||0,framePayloadType:i.framePayloadType||0,frameDataLength:i.frameDataLength||0,mimeType:i.mimeType||""});this.send({type:Zr.XLA_PEER_FIRST_VIDEO_FRAME,data:f},!0)}firstRemoteVideoDecode(n,i,s,o){const d=this.baseInfoMap.get(n);if(!d)return;const h=d.info,f=Date.now(),g=on(on(on({},h),o),{},{elapse:f-d.startTime,eventType:i,lts:f,firstDecodeFrame:Math.max((o.firstFrame||f)-d.startTime,0),apEnd:Math.max(o.apEnd-d.startTime,0),apStart:Math.max(o.apStart-d.startTime,0),joinGwEnd:Math.max(o.joinGwEnd-d.startTime,0),joinGwStart:Math.max(o.joinGwStart-d.startTime,0),pcEnd:Math.max(o.pcEnd-d.startTime,0),pcStart:Math.max(o.pcStart-d.startTime,0),subscriberEnd:Math.max(o.subscriberEnd-d.startTime,0),subscriberStart:Math.max(o.subscriberStart-d.startTime,0),videoAddNotify:Math.max(o.videoAddNotify-d.startTime,0)});this.send({type:s,data:g},!0)}firstRemoteFrame(n,i,s,o){const d=this.baseInfoMap.get(n);if(!d)return;const h=d.info,f=Date.now(),g=on(on(on({},h),o),{},{elapse:f-d.startTime,eventType:i,lts:f});this.send({type:s,data:g},!0)}abTest(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const o=s.info,d=Date.now(),h=on(on(on({},o),i),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:d-s.startTime,eventType:ms.AB_TEST,lts:d});this.send({type:Zr.AB_TEST,data:h},!0)}pcStats(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const o=s.info,d=Date.now(),h=on(on(on({},o),i),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:d-s.startTime,eventType:ms.PC_STATS,lts:d,preallocation:i.preallocation?1:0});this.send({type:Zr.PC_STATS,data:h},!0)}updateRemoteRTPCapabilities(n,i){if(n){const s=this.baseInfoMap.get(n);if(!s)return;const o=s.info,d=Date.now(),h=on(on(on({},o),i),{},{vid:o.vid===void 0?0:Number(o.vid),eventType:ms.UPDATE_REMOTE_RTPCAPABILITIES,lts:d});this.send({type:Zr.UPDATE_REMOTE_RTPCAPABILITIES,data:h},!0)}}onGatewayStream(n,i,s,o){const d=this.baseInfoMap.get(n);if(!d)return;const h=d.info,f=Date.now(),g=on(on(on({},h),o),{},{eventType:i,lts:f});this.send({type:s,data:g},!0)}streamSwitch(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const o=s.info,d=Date.now(),h=on(on({},o),{},{eventType:ms.STREAM_SWITCH,lts:d,isDual:i.isdual,elapse:d-s.startTime,success:i.succ});this.send({type:Zr.STREAM_SWITCH,data:h},!0)}requestProxyAppCenter(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const o=s.info,d=Date.now(),h=on(on({},o),{},{eventType:ms.REQUEST_PROXY_APPCENTER,lts:d,eventElapse:d-i.lts,elapse:d-s.startTime,APAddr:i.APAddr,workerManagerList:i.workerManagerList,response:i.response,errorCode:i.ec,success:i.succ});this.send({type:Zr.REQUEST_PROXY_APPCENTER,data:h},!0)}requestProxyWorkerManager(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const o=s.info,d=Date.now(),h=on(on({},o),{},{eventType:ms.REQUEST_PROXY_WORKER_MANAGER,lts:d,eventElapse:d-i.lts,elapse:d-s.startTime,workerManagerAddr:i.workerManagerAddr,response:i.response,errorCode:i.ec,success:i.succ});this.send({type:Zr.REQUEST_PROXY_WORKER_MANAGER,data:h},!0)}setProxyServer(n){this.proxyServer=n,n?M.debug("reportProxyServerurl: ".concat(n)):M.debug("disable reportProxyServerurl: ".concat(n))}peerPublishStatus(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const o=s.info,d=Date.now(),h=on(on({},o),{},{subscribeElapse:i.subscribeElapse,peer:i.peer,peerPublishDuration:Math.max(i.audioPublishDuration,i.videoPublishDuration),audiotag:i.audioPublishDuration>0?1:-1,videotag:i.videoPublishDuration>0?1:-1,lts:d,elapse:d-s.startTime,joinChannelSuccessElapse:d-(s.lastJoinSuccessTime||d),peerPublishDurationVideo:i.videoPublishDuration,peerPublishDurationAudio:i.audioPublishDuration});this.send({type:Zr.PEER_PUBLISH_STATUS,data:h},!0)}workerEvent(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const o=s.info,d=Date.now();(function(h,f,g){const y=h[f];if(!y||typeof y!="string")return[h];h[f]="";const x=Qp(JSON.stringify(h));let b=0;const N=[];let I=0;for(let D=0;D<y.length;D++)I+=y.charCodeAt(D)<=127?1:3,I<=g-x||(N[N.length]=Je(Je({},h),{},{[f]:y.substring(b,D)}),b=D,I=y.charCodeAt(D)<=127?1:3);return b!==y.length-1&&(N[N.length]=Je(Je({},h),{},{[f]:y.substring(b)})),N})(on(on(on({},o),i),{},{elapse:d-s.startTime,lts:d,productType:"WebRTC"}),"payload",1300).forEach(h=>this.send({type:Zr.WORKER_EVENT,data:h},!0))}apworkerEvent(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const o=s.info,d=Date.now(),h=on(on(on({},o),i),{},{elapse:d-s.startTime,lts:d});this.send({type:Zr.AP_WORKER_EVENT,data:h},!0)}joinWebProxyAP(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const o=s.info,d=Date.now(),h=on(on(on({},o),i),{},{elapse:d-s.startTime,lts:d,extend:i.extend||void 0});this.send({type:Zr.JOIN_WEB_PROXY_AP,data:h},!0)}WebSocketQuit(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const o=s.info,d=Date.now(),h=on(on(on({},o),i),{},{elapse:d-s.startTime,lts:d});this.send({type:Zr.WEBSOCKET_QUIT,data:h},!0)}async sendCustomReportMessage(n,i){if(this.customReportCount+=i.length,this.customReportCount>re("CUSTOM_REPORT_LIMIT"))throw new Pe(se.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const s=Date.now(),o=i.map(d=>({type:Zr.USER_ANALYTICS,data:on(on({sid:n},d),{},{lts:s})}));try{re("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(o):await this.postDataToStatsCollector(o)}catch(d){throw M.error("send custom report message failed",d.toString()),new Pe(se.CUSTOM_REPORT_SEND_FAILED,d.message)}}sendApiInvoke(n){const i=re("NOT_REPORT_EVENT");if(n.tag&&Ge(i)&&Ge(i).call(i,n.tag))return!1;if(n.sid===null)return this.apiInvokeUploadPendingItems.push(n),!1;const s=this.baseInfoMap.get(n.sid);if(!s)return this.apiInvokeUploadPendingItems.push(n),!1;const{cname:o,uid:d,cid:h}=s.info;let f;if(n.lts=n.lts||Date.now(),n.error)if(n.error instanceof Pe){const{code:y,message:x}=n.error;f=y||x||n.error.toString()}else f=n.error.toString();const g={invokeId:n.invokeId,sid:n.sid,cname:o,cid:h,uid:d,lts:n.lts,success:n.success,elapse:n.lts-s.startTime,execElapse:n.lts-n.apiInvokeTime,apiName:n.name,options:n.options?JSON.stringify(n.options):void 0,execStates:n.states?JSON.stringify(n.states):void 0,execResult:n.result?JSON.stringify(n.result):void 0,errorCode:n.error?f:void 0,errorMsg:n.error?JSON.stringify(n.error):void 0};return this.send({type:Zr.API_INVOKE,data:g},!1),!0}addSid(n){this.sids.add(n)}removeSid(n){this.sids.delete(n)}appendSessionId(){const n=this.apiInvokeUploadPendingItems;if(n.length===0)return;const i=Array.from(this.sids).find(s=>s!==null);i&&n.forEach(s=>{s&&(s.sid=i,this.sendApiInvoke(Object.assign({},s)))}),n.length=0}send(n,i){if(i)return this.keyEventUploadPendingItems.push(n),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(n),this.normalEventUploadPendingItems.length>re("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(n,i){const s=[],o=[];for(;n.length;){const h=n.shift();s.length<20?s.push(h):o.push(h)}n.push(...o);for(const h of[...s]){var d;this.ltsList.indexOf(h.data.lts)!==-1?(h.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(h.data.lts)):(this.ltsList.push(h.data.lts),sm(d=this.ltsList).call(d,(f,g)=>f-g))}return i||(this.lastSendNormalEventTime=Date.now()),re("ENABLE_EVENT_REPORT")&&s.length&&(re("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(s):this.postDataToStatsCollector(s)).catch((h=>f=>{re("EVENT_REPORT_RETRY")&&(i?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(h):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(h),this.normalEventUploadPendingItems.length>re("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-re("NORMAL_EVENT_QUEUE_CAPACITY")),M.warning("report: drop normal events"))))})(s)),n}async postDataToStatsCollector2(n){wi.networkState===jo.OFFLINE&&await et.race([wi.onlineWaiter,As(2*Gi.maxRetryTimeout)]);const i=d=>{let h=new Uint8Array;return d.forEach(f=>{const g=FV(JSON.stringify(f.data)),y=new ArrayBuffer(5),x=(N=>{let I=0;return Object.entries(Zr).forEach(D=>{let[$,z]=D;z===N.type&&(I=Lxe[$])}),I})(f),b=new DataView(y);b.setUint16(0,g.byteLength,!0),b.setUint8(2,255&x),b.setUint8(3,x>>>8&255),b.setUint8(4,x>>>16&255),h=Hq(h,new Uint8Array(y)),h=Hq(h,g)}),h},s="event";let o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(s):"https://".concat(re("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(s);for(let d=0;d<2;d+=1){d===1&&(o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(s):"https://".concat(re("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(s));try{await XV(o,{timeout:1e4,data:i(n),headers:on(on({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(h){if(d===1)throw h;continue}return}}async postDataToStatsCollector(n){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=(g=>{const y=g&&g.data.sid&&this.baseInfoMap.get(g.data.sid);return y&&y.info.vid&&+y.info.vid||0})(n[0]),o=s?void 0:this._aid,d={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:n.map(g=>JSON.stringify(g)),vid:s,aid:o};wi.networkState===jo.OFFLINE&&await et.race([wi.onlineWaiter,As(2*Gi.maxRetryTimeout)]);const h=i?"/events/proto-raws":"/events/messages";let f=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("EVENT_REPORT_DOMAIN"),"&p=").concat(re("STATS_COLLECTOR_PORT"),"&d=").concat(h):"https://".concat(re("EVENT_REPORT_DOMAIN"),":").concat(re("STATS_COLLECTOR_PORT")).concat(h));for(let g=0;g<2;g+=1){g===1&&(f=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(re("STATS_COLLECTOR_PORT"),"&d=").concat(h):"https://".concat(re("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(re("STATS_COLLECTOR_PORT")).concat(h)));try{i?await Exe(f,{timeout:1e4,data:d}):await XV(f,{timeout:1e4,data:d})}catch(y){if(g===1)throw y;continue}return}}createBaseInfo(n,i){const s=Object.assign({},Oxe);return s.sid=n,this.baseInfoMap.set(n,{info:s,startTime:i}),s}reportResourceTiming(n,i){const s=performance.getEntriesByName(n),o=s[s.length-1];o&&this.reportApiInvoke(i,{name:"Client.resourceTiming",options:o,tag:Tr.TRACER}).onSuccess()}};vY.on("REPORT_LOG_UPLOAD",n=>{n.networkState=wi.networkState,_t.reportApiInvoke(null,{name:"logUploadError",options:n,tag:Tr.TRACER}).onSuccess("logUploadError")});let Ce=class extends Pe{constructor(n){super(n,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Si(this,"name","AgoraRTCException")}print(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(n,M)}throw(){super.throw(M)}};const ks={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1,supportSuppressLocalAudioPlayback:!1,supportRestrictOwnAudio:!1};function xn(){return ks}function bY(){return"setSinkId"in HTMLAudioElement.prototype&&(!re("RESTRICTION_SET_PLAYBACK_DEVICE")||(lm()||Aq())&&!Vq())}function Kk(){return!ks.supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&Jp()}function iR(n){return!(Kr()||kq(87)||Kk()||!re("ENABLE_PRE_SUB")&&(n==null||!n.autoSubscribe||re("FORCE_DISABLE_AUTO_SUB")))}function wY(n){return re("ENABLE_INSTANT_VIDEO")?re("ENABLE_INSTANT_VIDEO"):!(n==null||!n.autoSubscribe||re("FORCE_DISABLE_AUTO_SUB"))}function SY(){return navigator.mediaDevices&&"getSupportedConstraints"in navigator.mediaDevices}function TY(){if(SY()){const n=navigator.mediaDevices.getSupportedConstraints();return!(!("suppressLocalAudioPlayback"in n)||!n.suppressLocalAudioPlayback)}return Ph(141)||Gg(141)||cy(141)}function RY(){if(SY()){const n=navigator.mediaDevices.getSupportedConstraints();return!(!("restrictOwnAudio"in n)||!n.restrictOwnAudio)}return Ph(141)||Gg(141)||cy(125)}let da=function(n){return n.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",n.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",n.IOS_INTERRUPTION_START="ios-interruption-start",n.IOS_INTERRUPTION_END="ios-interruption-end",n.STATE_CHANGE="state-change",n}({});function xx(n,i,s){return{sampleRate:n,stereo:i,bitrate:s}}function Hn(n,i,s,o,d){return{width:n,height:i,frameRate:s,bitrateMin:o,bitrateMax:d}}function Lu(n,i,s,o,d){return{width:{max:n},height:{max:i},frameRate:s,bitrateMin:o,bitrateMax:d}}function c4(n,i){return{numSpatialLayers:n,numTemporalLayers:i}}const jxe={"90p":Hn(160,90),"90p_1":Hn(160,90),"120p":Hn(160,120,15,30,65),"120p_1":Hn(160,120,15,30,65),"120p_3":Hn(120,120,15,30,50),"120p_4":Hn(212,120),"180p":Hn(320,180,15,30,140),"180p_1":Hn(320,180,15,30,140),"180p_3":Hn(180,180,15,30,100),"180p_4":Hn(240,180,15,30,120),"240p":Hn(320,240,15,40,200),"240p_1":Hn(320,240,15,40,200),"240p_3":Hn(240,240,15,40,140),"240p_4":Hn(424,240,15,40,220),"360p":Hn(640,360,15,80,400),"360p_1":Hn(640,360,15,80,400),"360p_3":Hn(360,360,15,80,260),"360p_4":Hn(640,360,30,80,600),"360p_6":Hn(360,360,30,80,400),"360p_7":Hn(480,360,15,80,320),"360p_8":Hn(480,360,30,80,490),"360p_9":Hn(640,360,15,80,800),"360p_10":Hn(640,360,24,80,800),"360p_11":Hn(640,360,24,80,1e3),"480p":Hn(640,480,15,100,500),"480p_1":Hn(640,480,15,100,500),"480p_2":Hn(640,480,30,100,1e3),"480p_3":Hn(480,480,15,100,400),"480p_4":Hn(640,480,30,100,750),"480p_6":Hn(480,480,30,100,600),"480p_8":Hn(848,480,15,100,610),"480p_9":Hn(848,480,30,100,930),"480p_10":Hn(640,480,10,100,400),"720p":Hn(1280,720,15,120,1130),"720p_auto":Hn(1280,720,30,900,3e3),"720p_1":Hn(1280,720,15,120,1130),"720p_2":Hn(1280,720,30,120,2e3),"720p_3":Hn(1280,720,30,120,1710),"720p_5":Hn(960,720,15,120,910),"720p_6":Hn(960,720,30,120,1380),"1080p":Hn(1920,1080,15,120,2080),"1080p_1":Hn(1920,1080,15,120,2080),"1080p_2":Hn(1920,1080,30,120,3e3),"1080p_3":Hn(1920,1080,30,120,3150),"1080p_5":Hn(1920,1080,60,120,4780),"1440p":Hn(2560,1440,30,120,4850),"1440p_1":Hn(2560,1440,30,120,4850),"1440p_2":Hn(2560,1440,60,120,7350),"4k":Hn(3840,2160,30,120,8910),"4k_1":Hn(3840,2160,30,120,8910),"4k_3":Hn(3840,2160,60,120,13500)},Mxe={"480p":Lu(640,480,5),"480p_1":Lu(640,480,5),"480p_2":Lu(640,480,30),"480p_3":Lu(640,480,15),"720p":Lu(1280,720,5),"720p_auto":Hn(1280,720,30,900,3e3),"720p_1":Lu(1280,720,5),"720p_2":Lu(1280,720,30),"720p_3":Lu(1280,720,15),"1080p":Lu(1920,1080,5),"1080p_1":Lu(1920,1080,5),"1080p_2":Lu(1920,1080,30),"1080p_3":Lu(1920,1080,15)},Uxe={"1SL1TL":c4(1,1),"3SL3TL":c4(3,3),"2SL3TL":c4(2,3)};function ju(n){return n||(n="480p_1"),typeof n=="string"?Object.assign({},jxe[n]):n}function l4(n){return typeof n=="string"?Object.assign({},Mxe[n]):n}function qk(n){return typeof n=="string"?Object.assign({},Uxe[n]):n}const Vxe={speech_low_quality:xx(16e3,!1),speech_standard:xx(32e3,!1,18),music_standard:xx(48e3,!1),standard_stereo:xx(48e3,!0,56),high_quality:xx(48e3,!1,128),high_quality_stereo:xx(48e3,!0,192)};function Yk(n){return typeof n=="string"?Object.assign({},Vxe[n]):n}const _y=[];function CY(n){return zi(n,"mediaSource",["screen","window","application"]),!0}let Et=function(n){return n.NEED_RENEGOTIATE="@need_renegotiate",n.NEED_REPLACE_TRACK="@need_replace_track",n.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",n.NEED_CLOSE="@need_close",n.NEED_ENABLE_TRACK="@need_enable_track",n.NEED_DISABLE_TRACK="@need_disable_track",n.NEED_SESSION_ID="@need_sid",n.SET_OPTIMIZATION_MODE="@set_optimization_mode",n.GET_STATS="@get_stats",n.GET_RTC_STATS="@get_rtc_stats",n.GET_LOW_VIDEO_TRACK="@get_low_video_track",n.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",n.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",n.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",n.NEED_MUTE_TRACK="@need_mute_track",n.NEED_UNMUTE_TRACK="@need_unmute_track",n}({}),or=function(n){return n.SCREEN_TRACK="screen_track",n.CUSTOM_TRACK="custome_track",n.LOW_STREAM="low_stream",n.SCREEN_LOW_TRACK="screen_low_track",n}({}),bx=function(n){return n[n.HIGH_STREAM=0]="HIGH_STREAM",n[n.LOW_STREAM=1]="LOW_STREAM",n}({}),Fxe=function(n){return n[n.HIGH_STREAM=0]="HIGH_STREAM",n[n.LOW_STREAM=1]="LOW_STREAM",n[n.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",n[n.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",n[n.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",n[n.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",n[n.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",n[n.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",n}({}),Bxe=function(n){return n[n.DISABLE=0]="DISABLE",n[n.LOW_STREAM=1]="LOW_STREAM",n[n.AUDIO_ONLY=2]="AUDIO_ONLY",n[n.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",n[n.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",n[n.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",n[n.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",n[n.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",n[n.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",n}({}),yy=function(n){return n.TRANSCEIVER_UPDATED="transceiver-updated",n.SEI_TO_SEND="sei-to-send",n.SEI_RECEIVED="sei-received",n.TRACK_UPDATED="track-updated",n}({}),wx=function(n){return n.SOURCE_STATE_CHANGE="source-state-change",n.TRACK_ENDED="track-ended",n.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",n.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",n.CLOSED="closed",n}({}),Od=function(n){return n.FIRST_FRAME_DECODED="first-frame-decoded",n.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",n.VIDEO_STATE_CHANGED="video-state-changed",n.PLAY_START="play-start",n.PLAY_END="play-end",n.FIRST_FRAME_RENDER="first-frame-render",n}({}),Sx=function(n){return n.AUDIO="audio",n.VIDEO="video",n.DATA="data",n}({}),Yl=function(n){return n.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",n.RECEIVE_TRACK_BUFFER="receive_track_buffer",n.ON_AUDIO_BUFFER="on_audio_buffer",n.UPDATE_SOURCE="update_source",n}({});(function(n){n.UPDATE_TRACK_SOURCE="update-track-source"})({});const d4={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},u4={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},NY={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},zxe={uplinkNetworkQuality:0,downlinkNetworkQuality:0},IY={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Uo=function(n){return n.ON_TRACK="on_track",n.ON_NODE="on_node",n}({}),$l=function(n){return n.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",n.REQUEST_CONSTRAINTS="request_constraints",n}({}),sR=function(n){return n.IDLE="IDLE",n.INITING="INITING",n.INITEND="INITEND",n}({}),vy=function(n){return n.STATE_CHANGE="state_change",n.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",n.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",n.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",n}({}),Da=function(n){return n.NONE="none",n.INIT="init",n.CANPLAY="canplay",n.PLAYING="playing",n.PAUSED="paused",n.SUSPEND="suspend",n.STALLED="stalled",n.WAITING="waiting",n.ERROR="error",n.DESTROYED="destroyed",n.ABORT="abort",n.ENDED="ended",n.EMPTIED="emptied",n.LOADEDDATA="loadeddata",n}({}),Zp=function(n){return n[n.VideoStateStopped=0]="VideoStateStopped",n[n.VideoStateStarting=1]="VideoStateStarting",n[n.VideoStateDecoding=2]="VideoStateDecoding",n[n.VideoStateFrozen=3]="VideoStateFrozen",n}({});const h4={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let $k=function(n){return n.OPEN="open",n.MESSAGE="message",n.CLOSE="close",n.CLOSING="closing",n.ERROR="error",n}({});function An(n,i,s,o,d){var h,f,g={};return Object.keys(o).forEach(function(y){g[y]=o[y]}),g.enumerable=!!g.enumerable,g.configurable=!!g.configurable,("value"in g||g.initializer)&&(g.writable=!0),g=lc(h=Tt(f=s.slice()).call(f)).call(h,function(y,x){return x(n,i,y)||y},g),d&&g.initializer!==void 0&&(g.value=g.initializer?g.initializer.call(d):void 0,g.initializer=void 0),g.initializer===void 0?(Object.defineProperty(n,i,g),null):g}function Ie(n,i,s){return(i=function(o){var d=function(h,f){if(typeof h!="object"||!h)return h;var g=h[Symbol.toPrimitive];if(g!==void 0){var y=g.call(h,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(h)}(o);return typeof d=="symbol"?d:d+""}(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function AY(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function zr(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?AY(Object(s),!0).forEach(function(o){Ie(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):AY(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}class kY extends ai{set _mediaStreamTrack(i){i!==this.mediaStreamTrack&&(this.safeEmit(yy.TRACK_UPDATED,i),this.mediaStreamTrack=i)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(i,s){super(),Ie(this,"trackMediaType",void 0),Ie(this,"_ID",void 0),Ie(this,"_rtpTransceiver",void 0),Ie(this,"_lowRtpTransceiver",void 0),Ie(this,"_hints",[]),Ie(this,"_isClosed",!1),Ie(this,"_originMediaStreamTrack",void 0),Ie(this,"mediaStreamTrack",void 0),Ie(this,"_external",{}),this._ID=s||dr(8,"track-"),this._originMediaStreamTrack=i,this.mediaStreamTrack=i,function(o){Ge(_y).call(_y,o)||_y.push(o)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(i){return i||Wg(()=>{var s;_t.reportApiInvoke(null,{name:Qr.GET_MEDIA_STREAM_TRACK,options:[],tag:Tr.TRACER}).onSuccess(((s=this._mediaStreamTrack)===null||s===void 0?void 0:s.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(i){return i===bx.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(i){const s=_y.indexOf(i);s!==-1&&_y.splice(s,1)}(this),this.emit(wx.CLOSED),this.removeAllListeners(yy.SEI_RECEIVED)}_updateRtpTransceiver(i,s){if(s===bx.LOW_STREAM){if(this._lowRtpTransceiver===i)return;this._lowRtpTransceiver=i}else{if(this._rtpTransceiver===i)return;this._rtpTransceiver=i}this.emit(yy.TRANSCEIVER_UPDATED,i,s)}}class Tx extends kY{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(i,s){super(i,s),Ie(this,"_enabled",!0),Ie(this,"_muted",!1),Ie(this,"_isExternalTrack",!1),Ie(this,"_isClosed",!1),Ie(this,"_enabledMutex",void 0),Ie(this,"processor",void 0),Ie(this,"_processorContext",void 0),Ie(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new qs("".concat(this.getTrackId())),i.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var i,s;return(i=(s=this._originMediaStreamTrack)===null||s===void 0?void 0:s.label)!==null&&i!==void 0?i:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,M.debug("[".concat(this.getTrackId(),"] close")),this.emit(Et.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(i,s){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=o,i!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop()),i.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=i,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Or(this,Et.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){M.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(wx.TRACK_ENDED)}stateCheck(i,s){if(M.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(i,": ").concat(s,"]")),Pu(s,i),this._enabled&&this._muted&&i==="enabled"&&s===!1)throw new Pe(se.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",M);if(!this._enabled&&!this._muted&&i==="muted"&&s===!0)throw new Pe(se.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",M)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():et.resolve([])}}const PY=window.AudioContext||window.webkitAudioContext;let p4,Xl=null;const br=new class extends ai{constructor(){super(...arguments),Ie(this,"prevState",void 0),Ie(this,"curState",void 0),Ie(this,"currentTime",void 0),Ie(this,"currentTimeStuckAt",void 0),Ie(this,"interruptDetectorTrack",void 0),Ie(this,"onLocalAudioTrackMute",()=>{M.info("ios15-interruption-start"),this.emit(da.IOS_15_16_INTERRUPTION_START)}),Ie(this,"onLocalAudioTrackUnmute",async()=>{M.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?M.info("ios15-interruption-end-canceled"):(Xl&&await Xl.suspend(),this.emit(da.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(n){M.debug("webaudio bindInterruptDetectorTrack ".concat(n.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=n,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(n){M.debug("webaudio unbindInterruptDetectorTrack ".concat(n.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===n&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Rx(){if(!Xl){if(function(){if(!PY)return void M.error("your browser is not support web audio");M.info("create audio context");const n=zr({},re("WEBAUDIO_INIT_OPTIONS"));M.debug("audio context init option:",JSON.stringify(n)),Xl=new PY(n),br.curState=Xl.state,Xl.onstatechange=()=>{br.prevState=br.curState,br.curState=Xl?Xl.state:void 0;const{prevState:i,curState:s}=br,o=s==="running",d=s==="interrupted",h=i==="running",f=i==="suspended",g=i==="interrupted",y=Wn().osVersion;($a()||ku())&&h&&d&&(M.info("ios".concat(y,"-interruption-start")),br.emit(da.IOS_INTERRUPTION_START)),($a()||ku())&&(f||g)&&o&&(M.info("ios".concat(y,"-interruption-end")),br.emit(da.IOS_INTERRUPTION_END)),i!==s&&br.emit(da.STATE_CHANGE,s,i)},setInterval(()=>{var i;const s=(i=Xl)===null||i===void 0?void 0:i.currentTime;br.currentTime!==s?(br.currentTimeStuckAt&&(M.debug("AudioContext current time resume at ".concat(s)),br.currentTimeStuckAt=void 0),br.currentTime=s):(s!==br.currentTimeStuckAt&&(_t.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:s},tag:Tr.TRACER}).onSuccess(),M.warning("AudioContext current time stuck at ".concat(s))),br.currentTimeStuckAt=s)},5e3),async function(i){const s=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let o,d,h=!1,f=!1,g=!1;function y(ie){i.state==="running"?x(!1):$a()||ku()?i.state==="suspended"&&(x(!0),ie&&i.resume().then(b,b)):i.state!=="closed"&&(x(!0),ie&&i.resume().then(b,b))}function x(ie){if(h!==ie){h=ie;for(let oe=0,fe=s;oe<fe.length;oe+=1){const Ee=fe[oe];ie?window.addEventListener(Ee,N,{capture:!0,passive:!0}):window.removeEventListener(Ee,N,{capture:!0,passive:!0})}}}function b(){y(!1)}function N(){y(!0)}function I(){let ie;try{ie=o.play(),ie?ie.then(z,z):(o.addEventListener("playing",z),o.addEventListener("abort",z),o.addEventListener("error",z))}catch{z()}}function D(ie){g||(o.paused?ie?($(!1),g=!0,I()):$(!0):$(!1))}function $(ie){if(f!==ie){f=ie;for(let oe=0,fe=s;oe<fe.length;oe++){const Ee=fe[oe];ie?window.addEventListener(Ee,K,{capture:!0,passive:!0}):window.removeEventListener(Ee,K,{capture:!0,passive:!0})}}}function z(){o.removeEventListener("playing",z),o.removeEventListener("abort",z),o.removeEventListener("error",z),g=!1,D(!1)}function K(){D(!0)}if($a()&&re("IOS_BG_TAG")){const ie=i.createMediaStreamDestination(),oe=document.createElement("div");oe.innerHTML="<audio x-webkit-airplay='deny'></audio>",o=oe.children.item(0),o.controls=!1,o.disableRemotePlayback=!0,o.preload="auto",o.srcObject=ie.stream,d=()=>{if(re("IOS_AUTO_RESTART_BG_TAG")&&o&&o.srcObject&&!g&&(!o.paused||f!==!0)){o.paused||o.pause();try{g=!0,I()}catch{g=!1}return!0}},D(!0)}return br.on(da.STATE_CHANGE,function(){y(!0)}),y(!1),d}(Xl).then(i=>{p4=i})}(),!Xl)throw new Pe(se.NOT_SUPPORTED,"can not create audio context");return Xl}return Xl}function Ey(n){if(function(){if(f4!==null)return f4;const o=Rx(),d=o.createBufferSource(),h=o.createGain(),f=o.createGain();d.connect(h),d.connect(f),d.disconnect(h);let g=!1;try{d.disconnect(h)}catch{g=!0}return d.disconnect(),f4=g,g}())return;const i=n.connect,s=n.disconnect;n.connect=(o,d,h)=>{var f;return n._inputNodes||(n._inputNodes=[]),Ge(f=n._inputNodes).call(f,o)||(o instanceof AudioNode?(n._inputNodes.push(o),i.call(n,o,d,h)):i.call(n,o,d)),n},n.disconnect=(o,d,h)=>{s.call(n),o?jk(n._inputNodes,o):n._inputNodes=[];for(const f of n._inputNodes)i.call(n,f)}}let f4=null;function m4(n,i){let s=!1;const o=1/i;if(re("DISABLE_WEBAUDIO")){const d=window.setInterval(()=>{s?window.clearInterval(d):n(performance.now()/1e3)},1e3*o)}else{const d=Rx();let h=d.createGain();h.gain.value=0,h.connect(d.destination);const f=()=>{if(s)return void(h=null);const g=d.createOscillator();g.onended=f,g.connect(h),g.start(0),g.stop(d.currentTime+o),n(d.currentTime)};f()}return()=>{s=!0}}class DY{constructor(){Ie(this,"context",void 0),Ie(this,"analyserNode",void 0),Ie(this,"sourceNode",void 0),this.context=Rx(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(i){if(i!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=i,i==null||i.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||$a()||ku()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const i=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(i);else{const o=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(o);for(let d=0;d<i.length;++d)i[d]=o[d]/128-1}const s=lc(i).call(i,(o,d)=>o+d*d,0)/i.length;return Math.max(10*Math.log10(s)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var i,s;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(s=this.sourceNode)===null||s===void 0||s.connect(this.analyserNode)}catch{M.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class OY extends ai{get processSourceNode(){return this.sourceNode}set processedNode(i){var s;if(!this.isDestroyed&&this._processedNode!==i){try{var o;(o=this.sourceNode)===null||o===void 0||o.disconnect(this.outputNode)}catch{}(s=this._processedNode)===null||s===void 0||s.disconnect(),this._processedNode=i,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Ie(this,"outputNode",void 0),Ie(this,"outputTrack",void 0),Ie(this,"isPlayed",!1),Ie(this,"sourceNode",void 0),Ie(this,"context",void 0),Ie(this,"audioBufferNode",void 0),Ie(this,"destNode",void 0),Ie(this,"audioOutputLevel",0),Ie(this,"volumeLevelAnalyser",void 0),Ie(this,"_processedNode",void 0),Ie(this,"playNode",void 0),Ie(this,"isDestroyed",!1),Ie(this,"onNoAudioInput",void 0),Ie(this,"isNoAudioInput",!1),Ie(this,"_noAudioInputCount",0),this.context=Rx(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Ey(this.outputNode),this.volumeLevelAnalyser=new DY}startGetAudioBuffer(i){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(i),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=s=>{this.emit(Yl.ON_AUDIO_BUFFER,function(o){for(let d=0;d<o.outputBuffer.numberOfChannels;d+=1){const h=o.outputBuffer.getChannelData(d);for(let f=0;f<h.length;f+=1)h[f]=0}return o.inputBuffer}(s))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!xn().webAudioMediaStreamDest)throw new Pe(se.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(i){this.context.state!=="running"&&Mk(()=>{br.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=i||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(i>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;$a()||ku()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const s=this.volumeLevelAnalyser.getAnalyserNode();let o;s.getFloatTimeDomainData?(o=new Float32Array(s.fftSize),s.getFloatTimeDomainData(o)):(o=new Uint8Array(s.fftSize),s.getByteTimeDomainData(o));let d=!1;for(let h=0;h<o.length;h++)o[h]!==0&&(d=!0);return d?(this.isNoAudioInput=!1,!0):(await As(200),await this.checkHasAudioInput(i?i+1:1)&&d)}getAudioVolume(){return this.outputNode.gain.value}setVolume(i){this.outputNode.gain.setValueAtTime(i,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var i,s;(i=this.processedNode)===null||i===void 0||i.disconnect(),(s=this.sourceNode)===null||s===void 0||s.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var i;this.processedNode?(i=this.processedNode)===null||i===void 0||i.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class g4 extends OY{get isFreeze(){return!1}constructor(i,s,o){var d;if(super(),Ie(this,"sourceNode",void 0),Ie(this,"track",void 0),Ie(this,"clonedTrack",void 0),Ie(this,"audioElement",void 0),Ie(this,"isCurrentTrackCloned",!1),Ie(this,"isRemoteTrack",!1),Ie(this,"originVolumeLevelAnalyser",void 0),Ie(this,"rebuildWebAudio",async()=>{if(M.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void M.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>M.info("resume success")),M.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const g=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?g.stop():this.isCurrentTrackCloned=!0;const y=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(y),Ey(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const x=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(x,this.context.currentTime),Ey(this.outputNode),this.emit(Yl.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=y,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),i.kind!=="audio")throw new Pe(se.UNEXPECTED_ERROR);this.track=i;const h=new MediaStream([this.track]);if(this.isRemoteTrack=!!s,this.sourceNode=this.context.createMediaStreamSource(h),Ey(this.sourceNode),o){const g=o.clone();g.enabled=!0,this.clonedTrack=g,M.debug("create an unmuted track ".concat(g.id," from the original track ").concat(o.id," to get the volume"));const y=this.context.createMediaStreamSource(new MediaStream([g]));Ey(y),this.originVolumeLevelAnalyser=new DY,this.originVolumeLevelAnalyser.updateSource(y)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=h;const f=Wn();s&&f.os===Is.IOS&&Number((d=f.osVersion)===null||d===void 0?void 0:d.split(".")[0])<15&&(br.on(da.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(g=>{g||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(i){this.sourceNode.disconnect(),this.track=i,this.isCurrentTrackCloned=!1;const s=new MediaStream([i]);this.sourceNode=this.context.createMediaStreamSource(s),Ey(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Yl.UPDATE_SOURCE),this.audioElement.srcObject=s}destroy(){var i;this.audioElement.srcObject=null,this.audioElement.remove(),br.off("state-change",this.rebuildWebAudio),(i=this.originVolumeLevelAnalyser)===null||i===void 0||i.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(i){return this.context.createMediaStreamSource(new MediaStream([i]))}updateOriginTrack(i){const s=i.clone();s.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=s),M.debug("create an unmuted track ".concat(s.id," from the original track ").concat(i.id," to get the volume"));const o=this.context.createMediaStreamSource(new MediaStream([s]));Ey(o),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(o)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function LY(n,i,s){const o=(h,f)=>h?typeof h!="number"?h.max||h.exact||h.ideal||h.min||f:h:f,d={audio:!!s&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxHeight:o(i.height,1080),maxWidth:o(i.width,1920)}}};return i.frameRate&&typeof i.frameRate!="number"?(d.video.mandatory.maxFrameRate=i.frameRate.max,d.video.mandatory.minFrameRate=i.frameRate.min):typeof i.frameRate=="number"&&(d.video.mandatory.maxFrameRate=i.frameRate),await navigator.mediaDevices.getUserMedia(d)}async function Gxe(n,i){const s=await jY(n.mediaSource),{sourceId:o,audio:d}=await function(h){let f=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new et((g,y)=>{const x=document.createElement("div");x.innerText="share screen",x.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const b=document.createElement("div");b.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const N=document.createElement("div");N.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",N.setAttribute("style","height: 12%;");const I=document.createElement("div");I.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const D=document.createElement("div");D.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const $=document.createElement("button");$.innerHTML="cancel",$.setAttribute("style","width: 85px;"),$.onclick=()=>{document.body.removeChild(ie);const oe=new Error("NotAllowedError");oe.name="NotAllowedError",y(oe)};let z=f;const K=document.createElement("div");if(f){const oe=document.createElement("input");oe.setAttribute("type","checkbox");const fe=document.createElement("span");oe.setAttribute("style","margin-right: 6px;"),fe.innerText="Share audio",oe.checked=z,oe.onchange=()=>{z=oe.checked},K.appendChild(oe),K.appendChild(fe)}D.appendChild(K),D.appendChild($),b.appendChild(N),b.appendChild(I),b.appendChild(D);const ie=document.createElement("div");ie.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),ie.appendChild(x),ie.appendChild(b),document.body.appendChild(ie),h.map(oe=>{if(oe.id){const fe=document.createElement("div");fe.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let Ee=oe.thumbnail;try{const{width:Te}=Ee.getSize();Te>1920&&(Ee=Ee.resize({width:1920}))}catch(Te){throw Te&&Te.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),Te}fe.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+Ee.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+oe.name.replace(/[\u00A0-\u9999<>\&]/g,function(Te){return"&#"+Te.charCodeAt(0)+";"})+"</span>",fe.onclick=()=>{document.body.removeChild(ie),g({sourceId:oe.id,audio:z})},I.appendChild(fe)}})})}(s,i);return await LY(o,n,d)}async function jY(n){let i=["window","screen"];n!=="application"&&n!=="window"||(i=["window"]),n==="screen"&&(i=["screen"]);const s=Kq();if(!s)throw console.error("failed to fetch electron, please mount it to window"),new Pe(se.ELECTRON_IS_NULL);let o=null;try{var d;o=((d=s.desktopCapturer)===null||d===void 0?void 0:d.getSources({types:i}))||s.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:i})}catch{o=null}o&&o.then||(o=new et((h,f)=>{s.desktopCapturer.getSources({types:i},(g,y)=>{g?f(g):h(y)})}));try{return await o}catch(h){throw new Pe(se.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,h.toString())}}const _4=new qs("safari");let MY=!1,UY=!1;async function Jl(n,i){let s=0,o=null;for(;s<2;)try{o=await Wxe(n,i,s>0);break}catch(d){if(d instanceof Pe)throw M.error("[".concat(i,"] ").concat(d.toString())),d;const h=Xk(d.name||d.code||d,d.message);if(h.code===se.MEDIA_OPTION_INVALID){M.debug("[".concat(i,"] detect media option invalid, retry")),s+=1,await As(500);continue}throw M.error("[".concat(i,"] ").concat(h.toString())),h}if(!o)throw new Pe(se.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return o}async function Wxe(n,i,s){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Pe(se.NOT_SUPPORTED,"can not find getUserMedia");s&&(n.video&&(delete n.video.width,delete n.video.height),n.screen&&(delete n.screen.width,delete n.screen.height));const o=xn(),d=new MediaStream;if(n.audioSource&&d.addTrack(n.audioSource),n.videoSource&&d.addTrack(n.videoSource),!n.audio&&!n.video&&!n.screen)return M.debug("Using Video Source/ Audio Source"),d;if(n.screen)if(Kq())n.screen.sourceId?Cx(d,await LY(n.screen.sourceId,n.screen,!!n.screenAudio)):Cx(d,await Gxe(n.screen,!!n.screenAudio));else if(lm()&&n.screen.extensionId&&n.screen.mandatory){if(!o.getStreamFromExtension)throw new Pe(se.NOT_SUPPORTED,"This browser does not support screen sharing");M.debug("[".concat(i,'] Screen access on chrome stable, looking for extension"'));const I=await(f=n.screen.extensionId,g=i,new et((D,$)=>{try{chrome.runtime.sendMessage(f,{getStream:!0},z=>{if(!z||!z.streamId)return M.error("[".concat(g,"] No response from Chrome Plugin. Plugin not installed properly"),z),void $(new Pe(se.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));D(z.streamId)})}catch(z){M.error("[".concat(g,"] AgoraRTC screensharing plugin is not accessible(").concat(f,")"),z.toString()),$(new Pe(se.CHROME_PLUGIN_NOT_INSTALL))}}));n.screen.mandatory.chromeMediaSourceId=I,Cx(d,await navigator.mediaDevices.getUserMedia({video:{mandatory:n.screen.mandatory}}))}else if(o.getDisplayMedia){var h;n.screen.mediaSource&&CY(n.screen.mediaSource);const I={width:n.screen.width,height:n.screen.height,frameRate:n.screen.frameRate,displaySurface:(h=n.screen.displaySurface)!==null&&h!==void 0?h:n.screen.mediaSource==="screen"?"monitor":n.screen.mediaSource},{selfBrowserSurface:D,surfaceSwitching:$,systemAudio:z,preferCurrentTab:K,windowAudio:ie,monitorTypeSurfaces:oe}=n.screen,fe={selfBrowserSurface:D,surfaceSwitching:$,systemAudio:z,preferCurrentTab:K,windowAudio:ie,monitorTypeSurfaces:oe};!D&&delete fe.selfBrowserSurface,!$&&delete fe.surfaceSwitching,!z&&delete fe.systemAudio,!K&&delete fe.preferCurrentTab,!ie&&delete fe.windowAudio,!oe&&delete fe.monitorTypeSurfaces,M.debug("[".concat(i,"] getDisplayMedia:"),JSON.stringify({video:I,audio:n.screenAudio,controls:fe})),Cx(d,await navigator.mediaDevices.getDisplayMedia(zr({video:I,audio:n.screenAudio},fe)))}else{if(!Kr())throw M.error("[".concat(i,"] This browser does not support screenSharing")),new Pe(se.NOT_SUPPORTED,"This browser does not support screen sharing");{n.screen.mediaSource&&CY(n.screen.mediaSource);const I={video:{mediaSource:n.screen.mediaSource,width:n.screen.width,height:n.screen.height,frameRate:n.screen.frameRate}};M.debug("[".concat(i,"] getUserMedia: ").concat(JSON.stringify(I))),Cx(d,await navigator.mediaDevices.getUserMedia(I))}}var f,g;if(!n.video&&!n.audio)return d;let y={video:n.video,audio:n.audio},x=re("MEDIA_DEVICE_CONSTRAINTS");if(x)try{typeof x=="string"&&(x=JSON.parse(x)),y=HV(y,x)}catch{}M.debug("[".concat(i,"] GetUserMedia"),JSON.stringify(y)),Wn();let b,N=null;(Ks()||$a()||Lk())&&(N=await _4.lock());try{b=await navigator.mediaDevices.getUserMedia(y)}catch(I){throw N&&N(),I}return y.audio&&(MY=!0),y.video&&(UY=!0),Cx(d,b),N&&N(),d}function Xk(n,i){switch(n){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Pe(se.MEDIA_OPTION_INVALID,"".concat(n,": ").concat(i));case"NotFoundError":case"DevicesNotFoundError":return new Pe(se.DEVICE_NOT_FOUND,"".concat(n,": ").concat(i));case"NotSupportedError":return new Pe(se.NOT_SUPPORTED,"".concat(n,": ").concat(i));case"NotReadableError":return new Pe(se.NOT_READABLE,"".concat(n,": ").concat(i));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Pe(se.PERMISSION_DENIED,"".concat(n,": ").concat(i));case"ConstraintNotSatisfiedError":return new Pe(se.CONSTRAINT_NOT_SATISFIED,"".concat(n,": ").concat(i));default:return M.error("getUserMedia unexpected error",n),new Pe(se.UNEXPECTED_ERROR,"".concat(n,": ").concat(i))}}function Cx(n,i){const s=n.getVideoTracks()[0],o=n.getAudioTracks()[0],d=i.getVideoTracks()[0],h=i.getAudioTracks()[0];h&&(o&&n.removeTrack(o),n.addTrack(h)),d&&(s&&n.removeTrack(s),n.addTrack(d))}const Ql=new class extends ai{get state(){return this._state}set state(n){n!==this._state&&(this.emit(vy.STATE_CHANGE,n),this._state=n)}constructor(){super(),Ie(this,"_state",sR.IDLE),Ie(this,"isAccessMicrophonePermission",!1),Ie(this,"isAccessCameraPermission",!1),Ie(this,"lastAccessMicrophonePermission",!1),Ie(this,"lastAccessCameraPermission",!1),Ie(this,"checkdeviceMatched",!1),Ie(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(re("ENUMERATE_DEVICES_INTERVAL")||(XT()||Ok()===Is.HARMONY_OS)&&Jp())&&this.updateDevicesInfo()},re("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(n=>M.error(n.toString()))}async enumerateDevices(n,i){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new Pe(se.NOT_SUPPORTED,"enumerateDevices() not supported.");const o=await navigator.mediaDevices.enumerateDevices(),d=this.checkMediaDeviceInfoIsOk(o);let h=!this.isAccessMicrophonePermission&&n,f=!this.isAccessCameraPermission&&i;d.audio&&(h=!1),d.video&&(f=!1);let g=null,y=null,x=null;if(!s&&(h||f)){if(_4.isLocked&&(M.debug("[device manager] wait GUM lock"),(await _4.lock())(),M.debug("[device manager] GUM unlock")),MY&&(h=!1,this.isAccessMicrophonePermission=!0),UY&&(f=!1,this.isAccessCameraPermission=!0),M.debug("[device manager] check media device permissions",n,i,h,f),h&&f){try{x=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(b){const N=Xk(b.name||b.code||b,b.message);if(N.code===se.PERMISSION_DENIED)throw N;M.warning("getUserMedia failed in getDevices",N)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(h){try{g=await navigator.mediaDevices.getUserMedia({audio:n})}catch(b){const N=Xk(b.name||b.code||b,b.message);if(N.code===se.PERMISSION_DENIED)throw N;M.warning("getUserMedia failed in getDevices",N)}this.isAccessMicrophonePermission=!0}else if(f){try{y=await navigator.mediaDevices.getUserMedia({video:i})}catch(b){const N=Xk(b.name||b.code||b,b.message);if(N.code===se.PERMISSION_DENIED)throw N;M.warning("getUserMedia failed in getDevices",N)}this.isAccessCameraPermission=!0}M.debug("[device manager] mic permission",n,"cam permission",i)}try{const b=await navigator.mediaDevices.enumerateDevices();return g&&g.getTracks().forEach(N=>N.stop()),y&&y.getTracks().forEach(N=>N.stop()),x&&x.getTracks().forEach(N=>N.stop()),g=null,y=null,x=null,b}catch(b){return g&&g.getTracks().forEach(N=>N.stop()),y&&y.getTracks().forEach(N=>N.stop()),x&&x.getTracks().forEach(N=>N.stop()),g=null,y=null,x=null,new Pe(se.ENUMERATE_DEVICES_FAILED,b.toString()).throw()}}async getRecordingDevices(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,n)).filter(i=>i.kind==="audioinput")}async getCamerasDevices(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,n)).filter(i=>i.kind==="videoinput")}async getSpeakers(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,n)).filter(i=>i.kind==="audiooutput")}searchDeviceIdByName(n){let i=null;return this.deviceInfoMap.forEach(s=>{s.device.label===n&&(i=s.device.deviceId)}),i}async getDeviceById(n){const i=(await this.enumerateDevices(!0,!0,!0)).find(s=>s.deviceId===n);if(!i)throw new Pe(se.DEVICE_NOT_FOUND,"deviceId: ".concat(n));return i}async init(){this.state=sR.INITING;try{await this.updateDevicesInfo(),this.state=sR.INITEND}catch(n){throw this.state=sR.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")?(M.warning("Device Detection functionality cannot start properly.",n.toString()),n):new Pe(se.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.")}}async updateDevicesInfo(){const n=await this.enumerateDevices(!0,!0,!0),i=Date.now(),s=[];if(n[0]&&n[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const d=n.find(f=>f.kind==="audioinput"&&f.deviceId==="default"),h=n.find(f=>f.kind==="audiooutput"&&f.deviceId==="default");d&&h?h.groupId===d.groupId?M.debug("[device-check] default input ".concat(d.label," and output ").concat(h.label," is the same group")):M.debug("[device-check] default input ".concat(d.label," and output ").concat(h.label," is not the same group")):M.debug("[device-check] default input or output not found")}const o=this.checkMediaDeviceInfoIsOk(n);if(n.forEach(d=>{if(!d.deviceId)return;const h=this.deviceInfoMap.get("".concat(d.kind,"_").concat(d.deviceId));if((h?h.state:"INACTIVE")!=="ACTIVE"){const f={initAt:i,updateAt:i,device:d,state:"ACTIVE"};this.deviceInfoMap.set("".concat(d.kind,"_").concat(d.deviceId),f),s.push(f)}h&&(h.updateAt=i)}),this.deviceInfoMap.forEach((d,h)=>{d.state==="ACTIVE"&&d.updateAt!==i&&(d.state="INACTIVE",s.push(d))}),this.state!==sR.INITEND)return o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));s.forEach(d=>{switch(d.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(vy.RECORDING_DEVICE_CHANGED,d);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(vy.CAMERA_DEVICE_CHANGED,d);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(vy.PLAYOUT_DEVICE_CHANGED,d)}}),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(n){const i=n.filter(d=>d.kind==="audioinput"),s=n.filter(d=>d.kind==="videoinput"),o={audio:!1,video:!1};for(const d of i)if(d.label&&d.deviceId){o.audio=!0;break}for(const d of s)if(d.label&&d.deviceId){o.video=!0;break}return o}};let y4=!1;const _c=new class extends ai{constructor(){super(...arguments),Ie(this,"onAutoplayFailed",void 0),Ie(this,"onAudioAutoplayFailed",void 0)}};function VY(){if(y4)return re("FLS_AUTOPLAY_EMITS")?(_c.onAutoplayFailed&&_c.onAutoplayFailed(),_c.emit("autoplay-failed")):void 0;{const n=i=>{i.preventDefault(),y4=!1,JT()?document.body.removeEventListener("click",n,!0):(document.body.removeEventListener("touchstart",n,!0),document.body.removeEventListener("mousedown",n,!0))};y4=!0,JT()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0)),M.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),_c.onAutoplayFailed?_c.onAutoplayFailed():_c.onAudioAutoplayFailed?M.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):M.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),_c.emit("autoplay-failed")}}function FY(n,i,s,o){if(!n)return;const d=_t.getBaseInfoBySessionId(n);if(!d)return;const h=d.info,f=Date.now(),g=zr(zr({},h),{},{vid:h.vid===void 0?0:Number(h.vid),lts:f,elapse:f-d.startTime,cbRegistered:_c.onAutoplayFailed||_c.onAudioAutoplayFailed?1:-1,errorMsg:s,mediaType:i,trackId:o,extend:void 0});_t.send({type:Zr.AUTOPLAY_FAILED,data:g},!0)}const Hxe=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],uo=new class{constructor(){Ie(this,"onAutoplayFailed",void 0),Ie(this,"elementMap",new Map),Ie(this,"elementStateMap",new Map),Ie(this,"elementsNeedToResume",[]),Ie(this,"sinkIdMap",new Map),Ie(this,"autoResumeAfterInterruption",n=>et.all(Array.from(this.elementMap.entries()).map(async i=>{let[s,o]=i;const d=this.elementStateMap.get(s),h=o.srcObject.getAudioTracks()[0],f=h&&h.readyState;if(M.debug("resume after interrupted, ele: ".concat(d," audio: ").concat(f," ").concat(n)),f==="live"){if(n)return o.pause(),o.play();if(br.curState==="running")return px()?(o.pause(),o.play()):d&&d==="paused"?o.play():void 0}}))),Ie(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(n=>{let[i,s]=n;const o=s.srcObject.getAudioTracks()[0];o&&o.readyState==="live"&&(M.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())})}),this.autoResumeAudioElement(),br.on(da.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),br.on(da.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),br.on(da.STATE_CHANGE,()=>{$a()&&br.prevState==="suspended"&&br.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(n,i){const s=this.elementMap.get(n);if(this.sinkIdMap.set(n,i),s)try{await s.setSinkId(i)}catch(o){throw new Pe(se.PERMISSION_DENIED,"can not set sink id: "+o.toString())}}play(n,i,s,o){if(this.elementMap.has(i))return;const d=document.createElement("audio");d.autoplay=!0,d.srcObject=new MediaStream([n]),this.bindAudioElementEvents(i,d),this.elementMap.set(i,d),this.elementStateMap.set(i,Da.INIT),this.setVolume(i,s);const h=this.sinkIdMap.get(i);if(h)try{d.setSinkId(h).catch(g=>{M.warning("[".concat(i,"] set sink id failed"),g.toString())})}catch(g){M.warning("[".concat(i,"] set sink id failed"),g.toString())}const f=d.play();f&&f.then&&f.catch(g=>{o&&FY(o,"audio",g.message,i),M.warning("audio element play warning",g.toString()),this.elementMap.has(i)&&g.name==="NotAllowedError"&&(M.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(d),Mk(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),VY()}))})}updateTrack(n,i){const s=this.elementMap.get(n);s&&(s.srcObject=new MediaStream([i]))}isPlaying(n){return this.elementMap.has(n)&&this.elementStateMap.get(n)==="playing"}setVolume(n,i){const s=this.elementMap.get(n);s&&(i=Math.max(0,Math.min(100,i)),s.volume=i/100)}getVolume(n){const i=this.elementMap.get(n);return i?i.volume:0}stop(n){const i=this.elementMap.get(n);if(this.sinkIdMap.delete(n),!i)return;const s=this.elementsNeedToResume.indexOf(i);this.elementsNeedToResume.splice(s,1),i.srcObject=null,i.remove(),this.elementMap.delete(n),this.elementStateMap.delete(n)}bindAudioElementEvents(n,i){Hxe.forEach(s=>{i.addEventListener(s,o=>{const d=this.elementStateMap.get(n),h=o.type==="pause"?"paused":o.type;if(M.debug("[".concat(n,"] audio-element-status change ").concat(d," => ").concat(h)),o.type==="error"){const f=i==null?void 0:i.error;f&&M.error("[".concat(n,"] media error, code: ").concat(f.code,", message: ").concat(f.message))}this.elementStateMap.set(n,h)})})}getPlayerState(n){return this.elementStateMap.get(n)||"uninit"}autoResumeAudioElement(){const n=()=>{this.elementsNeedToResume.forEach(i=>{i.play().then(s=>{M.debug("Auto resume audio element success")}).catch(s=>{M.warning("Auto resume audio element failed!",s)})}),this.elementsNeedToResume=[]};new et(i=>{document.body?i():window.addEventListener("load",()=>i())}).then(()=>{JT()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0))})}};function ki(){return function(n,i,s){const o=s.value;return typeof o=="function"&&(s.value=function(){this._isClosed&&new Pe(se.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",M);for(var d=arguments.length,h=new Array(d),f=0;f<d;f++)h[f]=arguments[f];const g=o.apply(this,h);return g instanceof et?new et((y,x)=>{g.then(y).catch(x)}):g}),s}}class BY extends ai{constructor(i){super(),Ie(this,"name","VideoProcessorDestination"),Ie(this,"ID","0"),Ie(this,"_source",void 0),Ie(this,"videoContext",void 0),Ie(this,"inputTrack",void 0),this.videoContext=i}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Pe(se.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Pe(se.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(i){if(i.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);i.track&&i.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=i.track,this.emit(Uo.ON_TRACK,i.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Uo.ON_TRACK,void 0)}}class zY extends ai{set chained(i){this._chained=i}get chained(){return this._chained}constructor(i,s){super(),Ie(this,"constraintsMap",new Map),Ie(this,"statsRegistry",[]),Ie(this,"usageRegistry",[]),Ie(this,"trackId",void 0),Ie(this,"direction",void 0),Ie(this,"_chained",!1),this.trackId=i,this.direction=s}async getConstraints(){return await rs(this,$l.REQUEST_CONSTRAINTS)}async requestApplyConstraints(i,s){var o;return M.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),i&&this.constraintsMap.set(s,i),Or(this,$l.REQUEST_UPDATE_CONSTRAINTS,Array.from(pc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(i){var s;if(this.constraintsMap.has(i))return M.info("processor ".concat(i.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(i),Or(this,$l.REQUEST_UPDATE_CONSTRAINTS,Array.from(pc(s=this.constraintsMap).call(s)))}registerStats(i,s,o){this.statsRegistry.find(d=>d.processorID===i.ID&&d.processorName===i.name&&d.type===s)||this.statsRegistry.push({processorName:i.name,processorID:i.ID,type:s,cb:o})}unregisterStats(i,s){const o=this.statsRegistry.findIndex(d=>d.processorID===i.ID&&d.processorName===i.name&&d.type===s);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const i=[];for(const{processorID:s,processorName:o,type:d,cb:h}of this.statsRegistry)try{const f=h();i.push({processorID:s,processorName:o,type:d,stats:f})}catch(f){M.error(new Pe(se.UNEXPECTED_ERROR,f.message))}return i}registerUsage(i,s){this.usageRegistry.find(o=>o.processorID===i.ID&&o.processorName===i.name)||this.usageRegistry.push({processorID:i.ID,processorName:i.name,cb:s})}unregisterUsage(i){const s=this.usageRegistry.findIndex(o=>o.processorID===i.ID&&o.processorName===i.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const i=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let o=s();o instanceof et&&(o=await o),i.push(zr(zr({},o),{},{direction:this.direction}))}catch(o){M.error("gather extension usage error",o)}return i}getDirection(){return this.direction}}class GY extends ai{constructor(i){super(),Ie(this,"name","AudioProcessorDestination"),Ie(this,"ID","0"),Ie(this,"inputTrack",void 0),Ie(this,"inputNode",void 0),Ie(this,"audioProcessorContext",void 0),Ie(this,"_source",void 0),this.audioProcessorContext=i}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Pe(se.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Pe(se.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Uo.ON_TRACK,void 0),this.emit(Uo.ON_NODE,void 0)}updateInput(i){if(i.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);i.track&&this.inputTrack!==i.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=i.track,this.emit(Uo.ON_TRACK,this.inputTrack)),i.node&&this.inputNode!==i.node&&(this.audioProcessorContext.chained=!0,this.inputNode=i.node,this.emit(Uo.ON_NODE,this.inputNode))}}class WY extends ai{set chained(i){this._chained=i}get chained(){return this._chained}constructor(i,s,o){super(),Ie(this,"constraintsMap",new Map),Ie(this,"statsRegistry",[]),Ie(this,"audioContext",void 0),Ie(this,"trackId",void 0),Ie(this,"direction",void 0),Ie(this,"usageRegistry",[]),Ie(this,"_chained",!1),this.audioContext=i,this.trackId=s,this.direction=o}async getConstraints(){return rs(this,$l.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(i,s){var o;return M.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),i&&this.constraintsMap.set(s,i),Or(this,$l.REQUEST_UPDATE_CONSTRAINTS,Array.from(pc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(i){var s;if(this.constraintsMap.has(i))return this.constraintsMap.delete(i),Or(this,$l.REQUEST_UPDATE_CONSTRAINTS,Array.from(pc(s=this.constraintsMap).call(s)))}registerStats(i,s,o){this.statsRegistry.find(d=>d.processorID===i.ID&&d.processorName===i.name&&d.type===s)||this.statsRegistry.push({processorName:i.name,processorID:i.ID,type:s,cb:o})}unregisterStats(i,s){const o=this.statsRegistry.findIndex(d=>d.processorID===i.ID&&d.processorName===i.name&&d.type===s);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const i=[];for(const{processorID:s,processorName:o,type:d,cb:h}of this.statsRegistry)try{const f=h();i.push({processorID:s,processorName:o,type:d,stats:f})}catch(f){M.error(new Pe(se.UNEXPECTED_ERROR,f.message))}return i}registerUsage(i,s){this.usageRegistry.find(o=>o.processorID===i.ID&&o.processorName===i.name)||this.usageRegistry.push({processorID:i.ID,processorName:i.name,cb:s})}unregisterUsage(i){const s=this.usageRegistry.findIndex(o=>o.processorID===i.ID&&o.processorName===i.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const i=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let o=s();o instanceof et&&(o=await o),i.push(zr(zr({},o),{},{direction:this.direction}))}catch(o){M.error("gather extension usage error",o)}return i}getDirection(){return this.direction}}class v4 extends ai{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Ie(this,"context",void 0),Ie(this,"processSourceNode",void 0),Ie(this,"outputTrack",void 0),Ie(this,"processedNode",void 0),Ie(this,"clonedTrack",void 0),Ie(this,"outputNode",void 0),this.outputNode=new Kxe}setVolume(){}createOutputTrack(){throw new Pe(se.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Kxe{disconnect(){}connect(){}}function HY(n){return new et((i,s)=>{let o=!1;const d=document.createElement("video");d.setAttribute("autoplay",""),d.setAttribute("muted",""),d.muted=!0,d.autoplay=!0,d.setAttribute("playsinline",""),d.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(d);const h=$a()?"canplay":"playing";d.addEventListener(h,()=>{const f=d.videoWidth,g=d.videoHeight;!f&&Kr()||(o=!0,d.srcObject=null,d.remove(),i([f,g]))}),d.srcObject=new MediaStream([n]),d.play().catch(eR),setTimeout(()=>{o||(d.srcObject=null,d.remove(),i([d.videoWidth,d.videoHeight]))},4e3)})}function Jk(n){const i={};n.facingMode&&(i.facingMode=n.facingMode),n.cameraId&&(i.deviceId={exact:n.cameraId});const s=ju(n.encoderConfig);return s.width!=null&&(i.width=s.width),s.height!=null&&(i.height=s.height),!Uq()&&s.frameRate&&(i.frameRate=s.frameRate),Aq()&&typeof i.frameRate=="object"&&(i.frameRate.max=60),Kr()&&(i.frameRate={ideal:30,max:30}),i}function KY(n){const i={};return Uq()||(n.AGC!==void 0&&(i.autoGainControl=n.AGC),n.AEC!==void 0&&(i.echoCancellation=n.AEC),n.ANS!==void 0&&(i.noiseSuppression=n.ANS,lm()&&n.ANS&&(i.googHighpassFilter=n.ANS))),i}function qY(n){const i=KY(n);if(n.encoderConfig){const s=Yk(n.encoderConfig);i.channelCount=s.stereo?2:1,i.sampleRate=s.sampleRate,i.sampleSize=s.sampleSize}return n.microphoneId&&(i.deviceId={exact:n.microphoneId}),XT()&&(i.sampleRate=void 0),i}const YY=n=>{const i=n._encoderConfig;if(!i)return;const{frameRate:s,width:o,height:d}=n.getMediaStreamTrackSettings();let{frameRate:h=s,width:f=o,height:g=d}=i;if(!h||!f||!g)return;f=gx(f),g=gx(g),h=gx(h);const{max:y,min:x}=function(D,$,z){const K=200*Math.pow(z/15,.6)*Math.pow(D*$/640/360,.75);return{min:Math.floor(K),max:Math.floor(4*K)}}(f,g,h),{bitrateMax:b,bitrateMin:N}=i||{};b||M.debug("calculate bitrate: [w: ".concat(f,", h: ").concat(g,", fps: ").concat(h,"] => [brMax: ").concat(b,", brMin: ").concat(N,"]"));const{maxFramerate:I}=re("ENCODER_CONFIG_LIMIT");return I&&typeof I=="number"&&(h=Math.min(h,I)),{frameRate:h,bitrateMax:b||y,bitrateMin:N||x,scaleResolutionDownBy:1,scale:0}},$Y=async(n,i,s)=>await(async(o,d,h)=>{const f=function(x){const b=[];for(let N=0;N<x.length;N+=2)b.push(parseInt(x.slice(N,N+2),16));return Uint8Array.from(b)}(iY(""+d+h)).slice(0,16),g=f.slice(0,12),y=await window.crypto.subtle.importKey("raw",f,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:g},y,o))})(n.buffer,i,s),E4=n=>{const i=document.createElement("canvas");return i.width=2,i.height=2,new et((s,o)=>{i.toBlob(async d=>{if(i.remove(),d){const h=await XY(d);s({buffer:h,width:i.width,height:i.height})}else o(new Pe(se.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},n,1)})},XY=async n=>{const i=await n.arrayBuffer();return new Uint8Array(i)};var JY,QY,ZY,e$,t$,n$,r$,i$,s$,a$,o$,c$,l$,d$,u$,h$,p$,f$,yi,m$,g$,_$,y$,v$,E$,ef,x$,b$,w$,S$,T$,R$,C$,N$,I$,A$,k$,P$,D$,xa;let Pi=(JY=Vt({argsMap:(n,i)=>[n.getTrackId(),i],throttleTime:300}),QY=Vt({argsMap:(n,i)=>[n.getTrackId(),i]}),ZY=ki(),e$=_x("LocalAudioTrack","_enabledMutex"),t$=Vt({argsMap:(n,i)=>[n.getTrackId(),i]}),n$=ki(),r$=_x("LocalAudioTrack","_enabledMutex"),i$=Vt({argsMap:(n,i)=>[n.getTrackId(),i]}),s$=ki(),a$=ki(),o$=ki(),c$=Vt({argsMap:n=>[n.getTrackId()]}),l$=ki(),d$=Vt({argsMap:n=>[n.getTrackId()]}),u$=ki(),h$=Vt({argsMap:n=>[n.getTrackId()]}),p$=Vt({argsMap:(n,i)=>[n.getTrackId(),i.name]}),f$=Vt({argsMap:n=>[n.getTrackId()]}),An((yi=class extends Tx{get _source(){return this.initWebAudio()}set _source(n){this._trackSource=n}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?uo.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(n,i,s,o){super(n,s),Ie(this,"trackMediaType",Sx.AUDIO),Ie(this,"_encoderConfig",void 0),Ie(this,"_trackSource",void 0),Ie(this,"metadata",[]),Ie(this,"_enabled",!0),Ie(this,"_volume",100),Ie(this,"_useAudioElement",!0),Ie(this,"_bypassWebAudio",!1),Ie(this,"processor",void 0),Ie(this,"_processorContext",void 0),Ie(this,"_processorDestination",void 0),Ie(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=i,this._getOriginVolumeLevel=!!o,this._trackSource=new v4,re("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),re("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Ks()&&!Xl?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(n){Sr(n,"volume",0,1e3),this._volume=n,this._source.setVolume(n/100),this._useAudioElement&&uo.setVolume(this.getTrackId(),n);try{if(this._bypassWebAudio)return void M.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const i=this._source.createOutputTrack();this._mediaStreamTrack!==i&&(this._mediaStreamTrack=i,Or(this,Et.NEED_REPLACE_TRACK,this).then(()=>{M.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(s=>{M.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(n){if(!this._useAudioElement||!bY())throw new Pe(se.NOT_SUPPORTED,"your browser does not support setting the audio output device");await uo.setSinkID(this.getTrackId(),n)}async setEnabled(n,i,s){return this._setEnabled(n,i,s)}async _setEnabled(n,i,s){if(!s){if(n===this._enabled)return;this.stateCheck("enabled",n)}if(M.info("[".concat(this.getTrackId(),"] start setEnabled"),n),n){this._originMediaStreamTrack.enabled=!0;try{s||(this._enabled=!0),await Or(this,Et.NEED_ENABLE_TRACK,this),M.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(n," success"))}catch(o){throw s||(this._enabled=!1),M.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}}else{this._originMediaStreamTrack.enabled=!1,s||(this._enabled=!1);try{await Or(this,Et.NEED_DISABLE_TRACK,this)}catch(o){throw s||(this._enabled=!0),M.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}}}async setMuted(n){n!==this._muted&&(this.stateCheck("muted",n),this._muted=n,this._originMediaStreamTrack.enabled=!n,M.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(n)),n?await Or(this,Et.NEED_MUTE_TRACK,this):await Or(this,Et.NEED_UNMUTE_TRACK,this))}getStats(){return Wg(()=>{M.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),El(this,Et.GET_STATS)||zr({},d4)}setAudioFrameCallback(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!n)return this._source.removeAllListeners(Yl.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(i),this._source.removeAllListeners(Yl.ON_AUDIO_BUFFER),this._source.on(Yl.ON_AUDIO_BUFFER,s=>n(s))}play(){M.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(M.debug("[".concat(this.getTrackId(),"] start audio playback in element")),uo.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){M.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?uo.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let n=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];M.debug("[".concat(this.getTrackId(),"] update player source track")),n&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&uo.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(n,i){this._originMediaStreamTrack!==n&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),i&&this._originMediaStreamTrack.stop()),n.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=n,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:n,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Or(this,Et.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(n))}renewMediaStreamTrack(n){return et.resolve(void 0)}pipe(n){if(this._bypassWebAudio)throw new Pe(se.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===n)return n;if(n._source)throw new Pe(se.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),n}unpipe(){var n;if(!this.processor)return;const i=this.processor;(n=this._source.processSourceNode)===null||n===void 0||n.disconnect(),this.processor._source=!1,this.processor=void 0,i.reset()}bindProcessorDestinationEvents(n){n.on(Uo.ON_TRACK,async i=>{i?i!==this._mediaStreamTrack&&(this._mediaStreamTrack=i,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(i),await Or(this,Et.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Or(this,Et.NEED_REPLACE_TRACK,this))}),n.on(Uo.ON_NODE,i=>{this._source.processedNode=i})}unbindProcessorDestinationEvents(n){n.removeAllListeners(Uo.ON_TRACK),n.removeAllListeners(Uo.ON_NODE)}bindProcessorContextEvents(n){n.on($l.REQUEST_CONSTRAINTS,async i=>{i(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(n){n.removeAllListeners($l.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof v4&&(this._trackSource=new g4(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const n=new WY(this._source.context,this.getTrackId(),"local"),i=new GY(n);return this._processorContext=n,this._processorDestination=i,this.bindProcessorContextEvents(n),this.bindProcessorDestinationEvents(i),this._source.on(Yl.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:n})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(uo.stop(this.getTrackId()),this._source.play()),Or(this,Et.NEED_REPLACE_MIXING_TRACK,this).then(()=>{M.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(s=>{M.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),s)})),{processorContext:n,processorDestination:i}}}).prototype,"setVolume",[JY],Object.getOwnPropertyDescriptor(yi.prototype,"setVolume"),yi.prototype),An(yi.prototype,"setPlaybackDevice",[QY,ZY],Object.getOwnPropertyDescriptor(yi.prototype,"setPlaybackDevice"),yi.prototype),An(yi.prototype,"setEnabled",[e$,t$,n$],Object.getOwnPropertyDescriptor(yi.prototype,"setEnabled"),yi.prototype),An(yi.prototype,"setMuted",[r$,i$,s$],Object.getOwnPropertyDescriptor(yi.prototype,"setMuted"),yi.prototype),An(yi.prototype,"getStats",[a$],Object.getOwnPropertyDescriptor(yi.prototype,"getStats"),yi.prototype),An(yi.prototype,"setAudioFrameCallback",[o$],Object.getOwnPropertyDescriptor(yi.prototype,"setAudioFrameCallback"),yi.prototype),An(yi.prototype,"play",[c$,l$],Object.getOwnPropertyDescriptor(yi.prototype,"play"),yi.prototype),An(yi.prototype,"stop",[d$,u$],Object.getOwnPropertyDescriptor(yi.prototype,"stop"),yi.prototype),An(yi.prototype,"close",[h$],Object.getOwnPropertyDescriptor(yi.prototype,"close"),yi.prototype),An(yi.prototype,"pipe",[p$],Object.getOwnPropertyDescriptor(yi.prototype,"pipe"),yi.prototype),An(yi.prototype,"unpipe",[f$],Object.getOwnPropertyDescriptor(yi.prototype,"unpipe"),yi.prototype),yi),aR=(m$=Vt({argsMap:(n,i)=>[n.getTrackId(),i]}),g$=ki(),_$=_x("MicrophoneAudioTrack","_enabledMutex"),y$=Vt({argsMap:(n,i,s)=>[n.getTrackId(),i,s]}),v$=ki(),E$=Vt({argsMap:n=>[n.getTrackId()]}),An((ef=class extends Pi{get __className__(){return"MicrophoneAudioTrack"}constructor(n,i,s,o){super(n,i.encoderConfig?Yk(i.encoderConfig):{},o,re("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Ie(this,"_config",void 0),Ie(this,"_deviceName","default"),Ie(this,"_constraints",void 0),Ie(this,"_originalConstraints",void 0),Ie(this,"_enabled",!0),this._config=i,this._constraints=s,this._originalConstraints=s,this._deviceName=n.label,typeof i.bypassWebAudio=="boolean"&&(this._bypassWebAudio=i.bypassWebAudio),(px()||MV())&&br.bindInterruptDetectorTrack(this)}async setDevice(n){if(M.info("[".concat(this.getTrackId(),"] start set device to ").concat(n)),this._enabled)try{const i=await Ql.getDeviceById(n),s={};s.audio=zr({},this._constraints),s.audio.deviceId={exact:n},this._originMediaStreamTrack.stop();let o=null;try{o=await Jl(s,this.getTrackId())}catch(d){throw M.error("[".concat(this.getTrackId(),"] setDevice failed"),d.toString()),o=await Jl({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),d}await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=i.label,this._config.microphoneId=n,this._constraints.deviceId={exact:n}}catch(i){throw M.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{const i=await Ql.getDeviceById(n);this._deviceName=i.label,this._config.microphoneId=n,this._constraints.deviceId={exact:n}}catch(i){throw M.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}M.info("[".concat(this.getTrackId(),"] set device to ").concat(n," success"))}async setEnabled(n,i,s){if(i)return M.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(n);if(!s){if(n===this._enabled)return;this.stateCheck("enabled",n)}if(M.info("[".concat(this.getTrackId(),"] start setEnabled"),n),re("AUTO_RESET_AUDIO_ROUTE")&&($a()||ku())){const f=navigator.audioSession;f&&(n||(f.type="playback"),f.type="auto")}if(!n){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),s||(this._enabled=!1);try{await Or(this,Et.NEED_DISABLE_TRACK,this)}catch(f){throw M.error("[".concat(this.getTrackId(),"] setEnabled false failed"),f.toString()),f}return}const d=zr({},this._constraints),h=Ql.searchDeviceIdByName(this._deviceName);h&&!d.deviceId&&(d.deviceId=h);try{s||(this._enabled=!0);const f=await Jl({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(f.getAudioTracks()[0],!1),await Or(this,Et.NEED_ENABLE_TRACK,this)}catch(f){throw s||(this._enabled=!1),M.error("[".concat(this.getTrackId(),"] setEnabled true failed"),f.toString()),f}M.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(px()||MV())&&br.unbindInterruptDetectorTrack(this),_y.some(n=>function(i){return"__className__"in i&&i.__className__==="MicrophoneAudioTrack"}(n))||p4&&p4()&&(_t.reportApiInvoke(null,{name:"BG_AUDIO_TAG_RESTART",options:{},tag:Tr.TRACER}).onSuccess(),M.debug("restart background audio tag success"))}onTrackEnded(){if(($a()||ku())&&this._enabled&&!this._isClosed&&br.duringInterruption){const n=async()=>{br.off(da.IOS_INTERRUPTION_END,n),this._enabled&&!this._isClosed&&(M.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};br.on(da.IOS_INTERRUPTION_END,n)}else M.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(wx.TRACK_ENDED)}async renewMediaStreamTrack(n){const i=n||this._constraints,s=Ql.searchDeviceIdByName(this._deviceName);if(s&&!i.deviceId&&(i.deviceId=s),this._constraints=i,this._enabled){this._originMediaStreamTrack.stop();const o=await Jl({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(n){super.bindProcessorContextEvents(n),n.on($l.REQUEST_UPDATE_CONSTRAINTS,async(i,s,o)=>{try{const d=Object.assign({},this._originalConstraints,...i);await this.renewMediaStreamTrack(d),s()}catch(d){o(d)}})}unbindProcessorContextEvents(n){super.unbindProcessorContextEvents(n),n.removeAllListeners($l.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[m$,g$],Object.getOwnPropertyDescriptor(ef.prototype,"setDevice"),ef.prototype),An(ef.prototype,"setEnabled",[_$,y$,v$],Object.getOwnPropertyDescriptor(ef.prototype,"setEnabled"),ef.prototype),An(ef.prototype,"close",[E$],Object.getOwnPropertyDescriptor(ef.prototype,"close"),ef.prototype),ef),qxe=(x$=Vt({argsMap:(n,i)=>[n.getTrackId(),i,n.duration]}),b$=ki(),w$=Vt({argsMap:n=>[n.getTrackId()]}),S$=ki(),T$=Vt({argsMap:n=>[n.getTrackId()]}),R$=ki(),C$=Vt({argsMap:n=>[n.getTrackId()]}),N$=ki(),I$=Vt({argsMap:n=>[n.getTrackId()]}),A$=ki(),k$=Vt({argsMap:n=>[n.getTrackId()]}),P$=Vt({argsMap:n=>[n.getTrackId()]}),D$=ki(),An((xa=class extends Pi{get __className__(){return"BufferSourceAudioTrack"}constructor(n,i,s,o){super(i.createOutputTrack(),s,o),Ie(this,"source",void 0),Ie(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=n,this._bufferSource=i,this._bufferSource.on(Yl.AUDIO_SOURCE_STATE_CHANGE,d=>{this.safeEmit(wx.SOURCE_STATE_CHANGE,d)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(n){n&&this._bufferSource.updateOptions(n),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(n){this._bufferSource.seekAudioBuffer(n)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(n){Sr(n,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(n)}}).prototype,"startProcessAudioBuffer",[x$,b$],Object.getOwnPropertyDescriptor(xa.prototype,"startProcessAudioBuffer"),xa.prototype),An(xa.prototype,"pauseProcessAudioBuffer",[w$,S$],Object.getOwnPropertyDescriptor(xa.prototype,"pauseProcessAudioBuffer"),xa.prototype),An(xa.prototype,"seekAudioBuffer",[T$,R$],Object.getOwnPropertyDescriptor(xa.prototype,"seekAudioBuffer"),xa.prototype),An(xa.prototype,"resumeProcessAudioBuffer",[C$,N$],Object.getOwnPropertyDescriptor(xa.prototype,"resumeProcessAudioBuffer"),xa.prototype),An(xa.prototype,"stopProcessAudioBuffer",[I$,A$],Object.getOwnPropertyDescriptor(xa.prototype,"stopProcessAudioBuffer"),xa.prototype),An(xa.prototype,"close",[k$],Object.getOwnPropertyDescriptor(xa.prototype,"close"),xa.prototype),An(xa.prototype,"setAudioBufferPlaybackSpeed",[P$,D$],Object.getOwnPropertyDescriptor(xa.prototype,"setAudioBufferPlaybackSpeed"),xa.prototype),xa);class gs extends Pi{get __className__(){return"MixingAudioTrack"}get isActive(){for(const i of this.trackList)if(i._enabled&&!i._isClosed&&!i.muted)return!0;return!1}constructor(){const i=Rx().createMediaStreamDestination();super(i.stream.getAudioTracks()[0],void 0,dr(8,"track-mix-")),Ie(this,"trackList",void 0),Ie(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=i,this.trackList=[]}hasAudioTrack(i){return this.trackList.indexOf(i)!==-1}addAudioTrack(i){this.trackList.indexOf(i)===-1?(M.debug("add ".concat(i.getTrackId()," to mixing track")),i._source.outputNode.connect(this.destNode),this.trackList.push(i),this.updateEncoderConfig()):M.debug("track ".concat(i.getTrackId()," is already added"))}removeAudioTrack(i){if(this.trackList.indexOf(i)!==-1){M.debug("remove ".concat(i.getTrackId()," from mixing track"));try{i._source.outputNode.disconnect(this.destNode)}catch{}jk(this.trackList,i),this.updateEncoderConfig()}}updateEncoderConfig(){const i={};this.trackList.forEach(s=>{s._encoderConfig&&((s._encoderConfig.bitrate||0)>(i.bitrate||0)&&(i.bitrate=s._encoderConfig.bitrate),(s._encoderConfig.sampleRate||0)>(i.sampleRate||0)&&(i.sampleRate=s._encoderConfig.sampleRate),(s._encoderConfig.sampleSize||0)>(i.sampleSize||0)&&(i.sampleSize=s._encoderConfig.sampleSize),s._encoderConfig.stereo&&(i.stereo=!0))}),this._encoderConfig=i}_updateRtpTransceiver(i){this._rtpTransceiver!==i&&(this._rtpTransceiver=i,this.trackList.forEach(s=>{s instanceof gs?s.emit(yy.TRANSCEIVER_UPDATED,i):s._updateRtpTransceiver(i)}))}}class Yxe extends OY{set currentState(i){i!==this._currentState&&(this._currentState=i,this.safeEmit(Yl.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Ie(this,"audioBuffer",void 0),Ie(this,"sourceNode",void 0),Ie(this,"startPlayTime",0),Ie(this,"startPlayOffset",0),Ie(this,"pausePlayTime",0),Ie(this,"options",void 0),Ie(this,"currentLoopCount",0),Ie(this,"currentPlaybackSpeed",100),Ie(this,"_currentState","stopped"),this.audioBuffer=i,this.options=s,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(i){this.currentState==="stopped"?(this.options=i,this.startPlayOffset=this.options.startPlayTime||0):M.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(i){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=i,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=i))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(i){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=i/100),this.currentPlaybackSpeed=i}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const i=this.context.createBufferSource();return i.buffer=this.audioBuffer,i.loop=!!this.options.loop,i.connect(this.outputNode),i.playbackRate.value=this.currentPlaybackSpeed/100,i}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const O$=new Map;function L$(n,i){if(n.length===0||i.length===0)return 1/0;const s=qV(n),o=qV(i);return Math.floor(o/s)}class x4{get rendFrameRate(){const i=Math.max(1,L$(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/i)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:Da.DESTROYED}set videoElementStatus(i){i!==this._videoElementStatus&&(M.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(i)),this._videoElementStatus=i)}get videoState(){return this._videoState}set videoState(i){var s;i!==this._videoState&&(this._videoState=i,(s=this.onVideoStateChanged)===null||s===void 0||s.call(this,this.videoState))}constructor(i){Ie(this,"trackId",void 0),Ie(this,"config",void 0),Ie(this,"onFirstVideoFrameDecoded",void 0),Ie(this,"onFirstVideoFrameRender",void 0),Ie(this,"onVideoBufferReady",void 0),Ie(this,"onVideoStateChanged",void 0),Ie(this,"freezeTimeCounterList",[]),Ie(this,"renderFreezeAccTime",0),Ie(this,"renderFreezeAccTime2",0),Ie(this,"isKeepLastFrame",!1),Ie(this,"isDestroyed",!1),Ie(this,"timeUpdatedCount",0),Ie(this,"freezeTime",0),Ie(this,"playbackTime",0),Ie(this,"lastTimeUpdatedTime",0),Ie(this,"autoplayFailed",!1),Ie(this,"videoTrack",void 0),Ie(this,"videoElement",void 0),Ie(this,"cacheVideoElement",void 0),Ie(this,"cancelRVFId",void 0),Ie(this,"internal",!1),Ie(this,"_render_interframe_delays",[]),Ie(this,"_render_interframe_delays_sizes",[]),Ie(this,"_videoState",Zp.VideoStateStopped),Ie(this,"videoElementCheckInterval",void 0),Ie(this,"videoElementFreezeTimeout",void 0),Ie(this,"_videoElementStatus",Da.NONE),Ie(this,"_isInPage",!0),Ie(this,"isGettingVideoDimensions",!1),Ie(this,"startGetVideoDimensions",()=>{const s=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return M.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(s,500)};!this.isGettingVideoDimensions&&s()}),Ie(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&br.curState==="running"&&(M.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Nq())),jq()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Ie(this,"handleVideoEvents",s=>{switch(s.type){case"play":case"playing":s.type==="play"&&M.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=Da.PLAYING;break;case"loadeddata":if(this.videoState=Zp.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Da.CANPLAY;break;case"stalled":this.videoElementStatus=Da.STALLED;break;case"suspend":this.videoElementStatus=Da.SUSPEND;break;case"pause":this.videoElementStatus=Da.PAUSED,$a()||ku()||Ks()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(M.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Da.WAITING;break;case"abort":this.videoElementStatus=Da.ABORT;break;case"ended":this.videoElementStatus=Da.ENDED;break;case"emptied":this.videoElementStatus=Da.EMPTIED;break;case"error":{const o=this.videoElement.error;o&&(this.videoElementStatus=Da.ERROR,M.error("[".concat(this.trackId,"] media error: ").concat(o.message," (").concat(o.code,")")));break}case"timeupdate":{const o=performance.now();if(this.timeUpdatedCount+=1,this.onVideoBufferReady&&this.timeUpdatedCount>re("BUFFER_READY_FRAMES")&&this.onVideoBufferReady(),this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=o);const d=o-this.lastTimeUpdatedTime,h=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=o,xl.lastVisibleTime<xl.lastHiddenTime||h<xl.lastHiddenTime||h<xl.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(d>re("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=d),this.playbackTime+=d;this.playbackTime>=6e3;){this.playbackTime-=6e3;const f=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(f),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Ie(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(M.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Nq())),jq()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=i.trackId,this.config=i,i.element instanceof HTMLVideoElement?this.videoElement=i.element:this.videoElement=document.createElement("video"),br.on(da.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),br.on(da.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var i;return(i=this.videoElement.parentElement)!==null&&i!==void 0?i:void 0}updateConfig(i){this.config=i,this.trackId=i.trackId,i.element!==this.videoElement&&(this.destroy(),this.videoElement=i.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(i){this.videoTrack!==i&&(this.videoTrack=i,this.initVideoElement())}play(i){const s=this.videoElement.play();s&&s.catch&&s.catch(d=>{i&&FY(i,"video",d.message,this.trackId),d.name==="NotAllowedError"?(M.warning("detected video element autoplay failed",d),this.autoplayFailed=!0,this.handleAutoPlayFailed()):M.warning("[".concat(this.trackId,"] play warning: "),d)});const o=Wn();if((o.name==="Safari"&&Number(o.version)===15||px())&&s&&s.then){const d=()=>{this.config.mirror&&!this.config.noStyle&&(this.videoElement.style.transform="rotateY(180deg)")};s.then(d).catch(d)}}getCurrentFrame(){const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const s=i.getContext("2d");if(!s)return M.error("create canvas context failed!"),new ImageData(2,2);s.drawImage(this.videoElement,0,0,i.width,i.height);const o=s.getImageData(0,0,i.width,i.height);return i.remove(),o}async getCurrentFrameToUint8Array(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const o=document.createElement("canvas");o.width=this.videoElement.videoWidth,o.height=this.videoElement.videoHeight;const d=o.getContext("2d");return d?(d.drawImage(this.videoElement,0,0,o.width,o.height),new et((h,f)=>{o.toBlob(async g=>{if(o.remove(),g){const y=await XY(g);h({buffer:y,width:o.width,height:o.height})}else f(new Pe(se.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},i,s<0?.1:s>1?1:s)})):await E4(i)}destroy(){let i=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.isDestroyed=!0,br.off(da.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),br.off(da.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),i?this.videoElement.pause():this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Zp.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Da.INIT,!this.videoElementCheckInterval&&(j$.forEach(h=>{this.videoElement.addEventListener(h,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(h){return h!==document.body&&document.body.contains(h)}(this.videoElement)},1e3),re("ENABLE_VIDEO_FRAME_CALLBACK"))){var i,s;let h;const f=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",f),this.videoElementFreezeTimeout=window.setTimeout(g,re("VIDEO_FREEZE_DURATION")))},g=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Zp.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Zp.VideoStateFrozen:document.addEventListener("visibilitychange",f))},y=(x,b)=>{if(this.videoElementStatus===Da.PLAYING){if(h){const D=b.presentationTime-h.presentationTime,$=b.presentedFrames-h.presentedFrames;this._render_interframe_delays_sizes.push($),this._render_interframe_delays.push(D);const z=qV(this._render_interframe_delays_sizes),K=z-this._render_interframe_delays_sizes[0];if(z>30&&K>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===Zp.VideoStateStarting&&(this.videoState=Zp.VideoStateDecoding),this.videoState===Zp.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(g,re("VIDEO_FREEZE_DURATION"))),D<re("VIDEO_FREEZE_DURATION")&&this.videoState===Zp.VideoStateFrozen&&(this.videoState=Zp.VideoStateDecoding),D>re("VIDEO_FREEZE_DURATION")&&xl.lastVisibleTime>=xl.lastHiddenTime&&h.timestamp>xl.lastVisibleTime&&h.timestamp>xl.lastHiddenTime){const ie=Math.min(66,L$(this._render_interframe_delays_sizes,this._render_interframe_delays)),oe=Math.max(0,D-($-1)*ie);this.renderFreezeAccTime2+=oe>ie?oe:0,this.renderFreezeAccTime+=D}}h=zr(zr({},b),{},{timestamp:x})}else this.isSkipCalcRenderFreezeTime()&&(h=zr(zr({},b),{},{timestamp:x}));var N,I;re("ENABLE_VIDEO_FRAME_CALLBACK")&&(this.cancelRVFId=(N=(I=this.videoElement).requestVideoFrameCallback)===null||N===void 0?void 0:N.call(I,y))};this.cancelRVFId=(i=(s=this.videoElement).requestVideoFrameCallback)===null||i===void 0?void 0:i.call(s,y)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),XT()&&!re("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const o=Wn();this.config.noStyle||(o.name==="Safari"&&Number(o.version)===15||px()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover"),this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Kr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Kr()&&this.videoElement.load());const d=this.videoElement.play();d!==void 0&&d.catch(h=>{M.debug("[".concat(this.trackId,"] playback interrupted"),h.toString())})}resetVideoElement(){var i,s;j$.forEach(o=>{this.videoElement&&this.videoElement.removeEventListener(o,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.cancelRVFId&&this.videoElement&&((i=(s=this.videoElement).cancelVideoFrameCallback)===null||i===void 0||i.call(s,this.cancelRVFId),this.cancelRVFId=void 0),this.videoElementStatus=Da.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===Da.DESTROYED||this.internal}handleAutoPlayFailed(){const i=s=>{s.preventDefault(),this.videoElement.play().then(()=>{M.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(o=>{M.error(o)}),this.autoplayFailed=!1,JT()?document.body.removeEventListener("click",i,!0):(document.body.removeEventListener("touchstart",i,!0),document.body.removeEventListener("mousedown",i,!0))};JT()?document.body.addEventListener("click",i,!0):(document.body.addEventListener("touchstart",i,!0),document.body.addEventListener("mousedown",i,!0)),VY()}}const j$=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Qk extends x4{constructor(i){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(i),Ie(this,"container",void 0),Ie(this,"slot",void 0),this.slot=i.element,this.internal=s,this.updateConfig(i)}updateConfig(i){this.config=i,this.trackId=i.trackId;const s=i.element;var o;!this.internal||this.slot?(s!==this.slot&&(this.destroy(),this.slot=s),this.createElements()):(this.slot=s,s&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(o=this.slot)===null||o===void 0||o.appendChild(this.container)):this.createElements())}updateVideoTrack(i){this.videoTrack!==i&&(this.videoTrack=i,this.createElements())}play(i){var s;(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)&&super.play(i)}getCurrentFrame(){var i;return(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(i){var s;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(i,o):await E4(i)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var i;this.container.remove(),(i=this.slot)===null||i===void 0||i.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var i;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",re("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(i=this.slot)===null||i===void 0||i.appendChild(this.container)}mountedVideoElement(){var i;!this.container||(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var i;if((i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var i;(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var M$,U$,V$,F$,B$,z$,G$,W$,H$,K$,q$,Y$,$$,X$,J$,Q$,Z$,eX,tX,nX,rX,iX,sX,aX,oX,cX,lX,dX,bn,uX,hX,pX,fX,mX,gX,_X,yX,Zl;let Rr=(M$=Vt({argsMap:(n,i,s)=>[n.getTrackId(),typeof i=="string"?i:i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),U$=ki(),V$=Vt({argsMap:n=>[n.getTrackId()]}),F$=_x("LocalVideoTrack","_enabledMutex"),B$=Vt({argsMap:(n,i)=>[n.getTrackId(),i]}),z$=ki(),G$=_x("LocalVideoTrack","_enabledMutex"),W$=Vt({argsMap:(n,i)=>[n.getTrackId(),i]}),H$=ki(),K$=Vt({argsMap:(n,i)=>[n.getTrackId(),i,n._saveEncodeBitrateRatio]}),q$=ki(),Y$=Vt({argsMap:(n,i)=>[n.getTrackId(),i]}),$$=ki(),X$=ki(),J$=Vt({argsMap:(n,i,s)=>[n.getTrackId(),i,s]}),Q$=ki(),Z$=ki(),eX=ki(),tX=Vt({argsMap:n=>[n.getTrackId()]}),nX=ki(),rX=ki(),iX=ki(),sX=ki(),aX=ki(),oX=Vt({argsMap:(n,i)=>[n.getTrackId(),i.name]}),cX=Vt({argsMap:n=>[n.getTrackId()]}),lX=Vt({argsMap:n=>[n.getTrackId()]}),dX=Vt({argsMap:(n,i,s)=>[n.getTrackId(),i.label,s]}),bn=class Pme extends Tx{get videoHeight(){if(Ks()){const{height:i}=this._mediaStreamTrack.getSettings();return this._videoHeight=i,this._videoHeight}return this._videoHeight}get videoWidth(){if(Ks()){const{width:i}=this._mediaStreamTrack.getSettings();return this._videoWidth=i,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Da.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(i){this._processorContext=i}get __className__(){return"LocalVideoTrack"}constructor(i,s,o,d,h,f){if(super(i,h),Ie(this,"trackMediaType",Sx.VIDEO),Ie(this,"_player",void 0),Ie(this,"isUseScaleResolutionDownBy",!1),Ie(this,"_videoVisibleTimer",null),Ie(this,"_previousVideoVisibleStatus",void 0),Ie(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Ie(this,"_encoderConfig",void 0),Ie(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Ie(this,"_optimizationMode",void 0),Ie(this,"_saveEncodeBitrateRatio",1),Ie(this,"_videoHeight",void 0),Ie(this,"_videoWidth",void 0),Ie(this,"_forceBitrateLimit",void 0),Ie(this,"_enabled",!0),Ie(this,"_processorDestination",void 0),Ie(this,"_processorContext",void 0),Ks()){const{width:g,height:y}=i.getSettings();this._videoWidth=g,this._videoHeight=y}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=o,this._optimizationMode=d,this._hints=f||[],s&&this._hints.indexOf(or.CUSTOM_TRACK)!==-1?this._encoderConfig=qr(s):this._encoderConfig=s,this._hints.indexOf(or.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(OV($n.CHROME,115)&&Ok().indexOf("Windows")!==-1){const g=function(y,x){if("VideoFrame"in window&&"TransformStream"in window&&xn().supportWebRTCInsertableStream){const b=new MediaStreamTrackProcessor(y),N=new MediaStreamTrackGenerator({kind:"video"});let I,D,$=Date.now();const z=()=>{K&&(clearInterval(K),K=void 0),I&&(I.close(),I=void 0),y.stop(),D=void 0,N.removeEventListener("ended",z)};let K=window.setInterval(()=>{if(D&&I&&Date.now()-$>1e3)try{N.readyState==="live"?D.enqueue(I.clone()):z()}catch{z()}},1e3);const ie=new TransformStream({transform:(oe,fe)=>{N.readyState==="live"?(D=fe,$=Date.now(),I===void 0?(I=oe,fe.enqueue(oe.clone())):(fe.enqueue(I),I=oe)):oe.close()}});return N.addEventListener("ended",z),b.readable.pipeThrough(ie).pipeTo(N.writable),N}}(i);g&&(M.info("local screen video track begin to inject frame"),this._mediaStreamTrack=g)}s&&this._hints.indexOf(or.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(s),this._processorContext=new zY(this.getTrackId(),"local"),this._processorDestination=new BY(this.processorContext),this.bindProcessorDestinationEvents()}play(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof i=="string"){const d=document.getElementById(i);d?i=d:(M.warning("[".concat(this.getTrackId(),'] can not find "#').concat(i,'" element, use document.body')),i=document.body)}M.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(s));const o=zr(zr(zr({},this._getDefaultPlayerConfig()),s),{},{trackId:this.getTrackId(),element:i});this._player?this._player.updateConfig(o):(i instanceof HTMLVideoElement?this._player=new x4(o):this._player=new Qk(o),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const d=this.getVideoElementVisibleStatus();this.safeEmit(wx.VIDEO_ELEMENT_VISIBLE_STATUS,d)}catch{}},re("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,M.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(i,s){if(!s){if(i===this._enabled)return;this.stateCheck("enabled",i)}if(M.info("[".concat(this.getTrackId(),"] start setEnabled"),i),!i){this._originMediaStreamTrack.enabled=!1;try{await Or(this,Et.NEED_DISABLE_TRACK,this)}catch(o){throw M.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}return s||(this._enabled=!1),void M.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Or(this,Et.NEED_ENABLE_TRACK,this)}catch(o){throw M.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}M.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}async setMuted(i){i!==this._muted&&(this.stateCheck("muted",i),this._muted=i,this._originMediaStreamTrack.enabled=!i,M.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(i)),i?await Or(this,Et.NEED_MUTE_TRACK,this):await Or(this,Et.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*i),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*i),M.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(i)),this._saveEncodeBitrateRatio=1;try{await Or(this,Et.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(M)}}}async setEncoderConfiguration(i,s){if(!this._enabled)throw new Pe(se.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(i=ju(i),re("USE_STANDARD_BITRATE_DEFAULT")&&(delete i.bitrateMax,delete i.bitrateMin),this._forceBitrateLimit&&(i.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:i.bitrateMax,i.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:i.bitrateMin),i.width||i.height||i.frameRate){const o=Jk({encoderConfig:i});(Ks()||$a()||ku())&&(o.deviceId=void 0),M.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(i),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(d){const h=new Pe(se.UNEXPECTED_ERROR,d.toString());throw M.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}}this._encoderConfig=i,this._hints.indexOf(or.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Or(this,Et.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(M)}}getStats(){return Wg(()=>{M.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),El(this,Et.GET_STATS)||zr({},u4)}async setBeautyEffect(i){M.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(i,s):await E4(i)}async findClosestProfile(){const{width:i,height:s,frameRate:o}=this.getMediaStreamTrackSettings(),{width:d,height:h,frameRate:f}=this._encoderConfig||{},g=gx(this._videoWidth||i||d||0),y=gx(this._videoHeight||s||h||0),x=function(b,N,I){if(!Array.isArray(re("VIDEO_ENCODER_CONFIG_LIST"))||re("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const D=Math.min(b,N);return!(D>=480)&&zr(zr({},re("VIDEO_ENCODER_CONFIG_LIST").find($=>$.height>D)),{},{frameRate:I})}(g,y,gx(o||f||15));if(x)return M.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(g,"x").concat(y," => ").concat(JSON.stringify(x))),this.setEncoderConfiguration(x)}async setBitrateLimit(i){M.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(i))),i&&(this._forceBitrateLimit=i,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<i.max_bitrate?this._encoderConfig.bitrateMax:i.max_bitrate:this._encoderConfig.bitrateMax=i.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=i.min_bitrate))}async setOptimizationMode(i){if(i!=="motion"&&i!=="detail"&&i!=="balanced")return void M.error(se.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const s=this._optimizationMode;try{this._optimizationMode=i,await Or(this,Et.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(o){throw this._optimizationMode=s,M.error("[".concat(this.getTrackId(),"] set optimization mode failed"),o.toString()),o}M.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(i,")"))}setScalabiltyMode(i){if(i.numSpatialLayers===1&&i.numTemporalLayers!==1)return M.error(se.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=i,M.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(i,")"))}updateMediaStreamTrackResolution(){HY(this._originMediaStreamTrack).then(i=>{let[s,o]=i;this._videoHeight=o,this._videoWidth=s}).catch(eR)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(i){if(!this._enabled)throw new Pe(se.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");M.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(i)),i=ju(i),this._forceBitrateLimit&&(i.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:i.bitrateMax,i.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:i.bitrateMin),this._encoderConfig=i,this._hints.indexOf(or.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Or(this,Et.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(M)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:i,height:s,frameRate:o}=this.getMediaStreamTrackSettings();if(!i||!s||!o)return;const{bitrateMax:d,bitrateMin:h}=this._encoderConfig;if(h==null||d==null){const{max:f,min:g}=function(y,x,b,N,I){const D=re("BITRATE_ADAPTER_TYPE");if(D==="DEFAULT_BITRATE")return{min:N,max:I};if(I===void 0){const $=Math.floor(200*Math.pow(b/15,.6)*Math.pow(y*x/640/360,.75));I=D==="STANDARD_BITRATE"?4*$:2*$,N=N??$}else N=N??Math.floor(I/10);return{min:N,max:I}}(i,s,o,h,d);if(this._encoderConfig.bitrateMin=g,this._encoderConfig.bitrateMax=f,re("VIDEO_STANDARD_BITRATE_VERSION")&&h==null&&d==null){const[y,x]=function(b,N,I){const D=4*Math.floor(2e5*Math.pow(I/15,.6)*Math.pow(b*N/230400,.75)),$=b*N,z=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),K=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let ie=pc(z).call(z).next().value,oe=1;if(z.has($))ie=z.get($);else{var fe;const dt=sm(fe=Array.from(z.entries())).call(fe,(Bt,dn)=>{let[sn]=Bt,[Qn]=dn;return sn-Qn}),Ht=dt.find(Bt=>{let[dn]=Bt;return dn>$});if(Ht){const Bt=dt.indexOf(Ht);if(Bt>0){const dn=dt[Bt-1],sn=($-dn[0])/(Ht[0]-dn[0]);ie=dn[1]+sn*(Ht[1]-dn[1])}else ie=Ht[1]}else ie=dt[dt.length-1][1]}if(K.has($))oe=K.get($);else{var Ee;const dt=sm(Ee=Array.from(K.entries())).call(Ee,(Bt,dn)=>{let[sn]=Bt,[Qn]=dn;return sn-Qn}),Ht=dt.find(Bt=>{let[dn]=Bt;return dn>$});if(Ht){const Bt=dt.indexOf(Ht);if(Bt>0){const dn=dt[Bt-1],sn=($-dn[0])/(Ht[0]-dn[0]);oe=dn[1]+sn*(Ht[1]-dn[1])}else oe=Ht[1]}else oe=dt[dt.length-1][1]}const Te=re("VIDEO_NEW_BITRATE_RATIO");Te&&Te>0&&(ie=Te/100);const _e=Math.floor(D*ie),Re=Math.floor(65e4*Math.pow(b*N/230400,.5)*Math.pow(I/15,.69));let je=_e;const Be=re("VIDEO_STANDARD_BITRATE_VERSION");return Be&&Be>0&&(Be===1?je=D:Be===2?je=_e:Be===3&&(je=Re)),[Math.floor(je/1e3),oe]}(i,s,o);this._encoderConfig.bitrateMax=y,this._encoderConfig.bitrateMin=g?Math.min(g,y):y,this._saveEncodeBitrateRatio=x,M.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(i,", h: ").concat(s,", fps: ").concat(o,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else M.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(i,", h: ").concat(s,", fps: ").concat(o,"] => [brMax: ").concat(f,", brMin: ").concat(g,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var i,s;const o=this==null||(i=this._player)===null||i===void 0?void 0:i.getContainerElement(),d={track:this,element:this==null||(s=this._player)===null||s===void 0?void 0:s.getVideoElement(),slot:o==null?void 0:o.parentElement},{element:h,slot:f}=d;if(this.isPlaying&&h instanceof HTMLVideoElement&&f instanceof HTMLElement){const g=Wq.checkOneElementVisible(h),y=Object.assign({},g);if(y.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=y.visible;const x=_t.reportApiInvoke(null,{tag:Tr.TRACER,name:Qr.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});y.visible?x.onSuccess("Video is visible"):x.onSuccess("Invisible because of ".concat(y.reason))}return y}return}catch(o){throw new Pe(se.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}async renewMediaStreamTrack(i){}pipe(i){if(this.processor===i)return i;if(i._source)throw new Pe(se.INVALID_OPERATION,"Processor ".concat(i.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=i,this.processor._source=this,i.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),i}unpipe(){if(!this.processor)return;const i=this.processor;this.processor._source=void 0,this.processor=void 0,i.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(i){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;i&&(o=zr(zr({},o),ju(i))),o=hy(o);const d=dr(8,"track-video-cloned-"),h=new Pme(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,o,hy(this._scalabilityMode),this._optimizationMode,d,hy(this._hints));return i&&o&&h.setEncoderConfiguration(o),M.debug("clone video track from ".concat(this.getTrackId()," to ").concat(d,", clone ").concat(s)),h}async replaceTrack(i,s){if(!(i instanceof MediaStreamTrack))throw new Pe(se.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(i.kind!=="video")throw new Pe(se.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(i,s,!0),this.updateMediaStreamTrackResolution()}sendSeiData(i){if(Wg(()=>{_t.reportApiInvoke(null,{name:Qr.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Tr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!re("ENABLE_VIDEO_SEI")||!re("ENABLE_ENCODED_TRANSFORM"))return void M.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(i instanceof Uint8Array==0)return new Pe(se.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const s=this.getRTCRtpTransceiver();if(!s)return void M.warning("Video track is not published, SEI can not be send");const o=s.sender.getParameters();if(o.codecs.length===0)return;const d=o.codecs[0].mimeType.toLocaleLowerCase();d==="video/h264"||d==="video/h265"?this.safeEmit("sei-to-send",i):M.warning("SEI is not supported by ".concat(d))}bindProcessorDestinationEvents(){this.processorDestination.on(Uo.ON_TRACK,async i=>{i?i!==this._mediaStreamTrack&&(this._mediaStreamTrack=i,this._updatePlayerSource(),await Or(this,Et.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Or(this,Et.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Uo.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners($l.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners($l.REQUEST_CONSTRAINTS)}},An(bn.prototype,"play",[M$,U$],Object.getOwnPropertyDescriptor(bn.prototype,"play"),bn.prototype),An(bn.prototype,"stop",[V$],Object.getOwnPropertyDescriptor(bn.prototype,"stop"),bn.prototype),An(bn.prototype,"setEnabled",[F$,B$,z$],Object.getOwnPropertyDescriptor(bn.prototype,"setEnabled"),bn.prototype),An(bn.prototype,"setMuted",[G$,W$,H$],Object.getOwnPropertyDescriptor(bn.prototype,"setMuted"),bn.prototype),An(bn.prototype,"setSaveEncodeBitrateRatio",[K$,q$],Object.getOwnPropertyDescriptor(bn.prototype,"setSaveEncodeBitrateRatio"),bn.prototype),An(bn.prototype,"setEncoderConfiguration",[Y$,$$],Object.getOwnPropertyDescriptor(bn.prototype,"setEncoderConfiguration"),bn.prototype),An(bn.prototype,"getStats",[X$],Object.getOwnPropertyDescriptor(bn.prototype,"getStats"),bn.prototype),An(bn.prototype,"setBeautyEffect",[J$,Q$],Object.getOwnPropertyDescriptor(bn.prototype,"setBeautyEffect"),bn.prototype),An(bn.prototype,"getCurrentFrameData",[Z$],Object.getOwnPropertyDescriptor(bn.prototype,"getCurrentFrameData"),bn.prototype),An(bn.prototype,"getCurrentFrameImage",[eX],Object.getOwnPropertyDescriptor(bn.prototype,"getCurrentFrameImage"),bn.prototype),An(bn.prototype,"findClosestProfile",[tX,nX],Object.getOwnPropertyDescriptor(bn.prototype,"findClosestProfile"),bn.prototype),An(bn.prototype,"setBitrateLimit",[rX],Object.getOwnPropertyDescriptor(bn.prototype,"setBitrateLimit"),bn.prototype),An(bn.prototype,"setOptimizationMode",[iX],Object.getOwnPropertyDescriptor(bn.prototype,"setOptimizationMode"),bn.prototype),An(bn.prototype,"setScalabiltyMode",[sX],Object.getOwnPropertyDescriptor(bn.prototype,"setScalabiltyMode"),bn.prototype),An(bn.prototype,"updateMediaStreamTrackResolution",[aX],Object.getOwnPropertyDescriptor(bn.prototype,"updateMediaStreamTrackResolution"),bn.prototype),An(bn.prototype,"pipe",[oX],Object.getOwnPropertyDescriptor(bn.prototype,"pipe"),bn.prototype),An(bn.prototype,"unpipe",[cX],Object.getOwnPropertyDescriptor(bn.prototype,"unpipe"),bn.prototype),An(bn.prototype,"close",[lX],Object.getOwnPropertyDescriptor(bn.prototype,"close"),bn.prototype),An(bn.prototype,"replaceTrack",[dX],Object.getOwnPropertyDescriptor(bn.prototype,"replaceTrack"),bn.prototype),bn),Zk=(uX=Vt({argsMap:(n,i)=>[n.getTrackId(),i]}),hX=ki(),pX=_x("CameraVideoTrack","_enabledMutex"),fX=Vt({argsMap:(n,i)=>[n.getTrackId(),i]}),mX=ki(),gX=Vt({argsMap:(n,i)=>[n.getTrackId(),i]}),_X=ki(),yX=Vt({argsMap:n=>[n.getTrackId()]}),Zl=class Dme extends Rr{get __className__(){return"CameraVideoTrack"}constructor(i,s,o,d,h,f){super(i,ju(s.encoderConfig),d,h,f),Ie(this,"_config",void 0),Ie(this,"_originalConstraints",void 0),Ie(this,"_constraints",void 0),Ie(this,"_enabled",!0),Ie(this,"_deviceName","default"),Ie(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(px()||MV())&&!function(){const g=Wn();if(g.os!==Is.IOS||!g.osVersion)return!1;const y=g.osVersion.split(".");return Number(y[0])===15&&Number(y[1])>=2}()&&Mq()&&this._enabled&&!this._isClosed&&(M.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=s,this._originalConstraints=o,this._constraints=o,this._deviceName=i.label,this._encoderConfig=ju(this._config.encoderConfig),br.on(da.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),br.on(da.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(i){return typeof i=="string"?this._setDeviceById(i):i.deviceId?this._setDeviceById(i.deviceId):i.facingMode?this._setDeviceByFacingModel(i.facingMode):void 0}async _setDeviceById(i){if(M.info("[".concat(this.getTrackId(),"] set device to ").concat(i)),this._enabled)try{const s=await Ql.getDeviceById(i),o={};o.video=zr({},this._constraints),o.video.deviceId={exact:i},o.video.facingMode=void 0,this._originMediaStreamTrack.stop();let d=null;try{d=await Jl(o,this.getTrackId())}catch(h){throw M.error("[".concat(this.getTrackId(),"] setDevice failed"),h.toString()),d=await Jl({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),h}await this._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=s.label,this._config.cameraId=i,this._constraints.deviceId={exact:i}}catch(s){throw M.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=await Ql.getDeviceById(i);this._deviceName=s.label,this._config.cameraId=i,this._constraints.deviceId={exact:i}}catch(s){throw M.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}M.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(i){M.info("[".concat(this.getTrackId(),"] set facingMode ").concat(i));const s={video:zr(zr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:i}})};if(this._enabled){this._originMediaStreamTrack.stop();let o=null;try{o=await Jl(s,this.getTrackId())}catch(d){throw M.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),d.toString()),o=await Jl({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),d}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=i,this._config.cameraId=void 0,this._constraints=zr({},s.video),M.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(i,s){if(!s){if(i===this._enabled)return;this.stateCheck("enabled",i)}if(M.info("[".concat(this.getTrackId(),"] start setEnabled"),i),i){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const o=await Jl({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1)}await Or(this,Et.NEED_ENABLE_TRACK,this)}catch(o){throw M.error("[".concat(this.getTrackId(),"] setEnabled true error"),o.toString()),o}this.updateMediaStreamTrackResolution(),M.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),s||(this._enabled=!1);try{await Or(this,Et.NEED_DISABLE_TRACK,this)}catch(o){throw M.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}M.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(i,s){if(!this._enabled)throw new Pe(se.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");i=ju(i),re("USE_STANDARD_BITRATE_DEFAULT")&&(delete i.bitrateMax,delete i.bitrateMin),this._forceBitrateLimit&&(i.bitrateMax=this._forceBitrateLimit.max_bitrate||i.bitrateMax,i.bitrateMin=this._forceBitrateLimit.min_bitrate||i.bitrateMin);const o=qr(this._config);o.encoderConfig=i;const d=Jk(o);(Ks()||$a()||ku())&&(d.deviceId=void 0),M.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(i),JSON.stringify(d));try{await this._originMediaStreamTrack.applyConstraints(d),this.updateMediaStreamTrackResolution()}catch(h){const f=new Pe(se.UNEXPECTED_ERROR,h.toString());throw M.error("[".concat(this.getTrackId(),"] applyConstraints error"),f.toString()),f}this._config=o,this._constraints=d,this._originalConstraints=d,this._encoderConfig=i,this._hints.indexOf(or.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Or(this,Et.NEED_UPDATE_VIDEO_ENCODER,this)}catch(h){return h.throw(M)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if(($a()||ku())&&this._enabled&&!this._isClosed&&br.duringInterruption){const i=async()=>{br.off(da.IOS_INTERRUPTION_END,i),this._enabled&&!this._isClosed&&(M.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};br.on(da.IOS_INTERRUPTION_END,i)}else M.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(wx.TRACK_ENDED)}async renewMediaStreamTrack(i){const s=i||this._constraints,o=Ql.searchDeviceIdByName(this._deviceName);if(o&&!s.deviceId&&(s.deviceId={exact:o}),this._enabled){const d=await Jl({video:s},this.getTrackId());this._constraints=s,await this._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),br.off(da.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),br.off(da.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(i){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;i&&(o=zr(zr({},o),ju(i))),o=hy(o);const d=dr(8,"track-cam-cloned-"),h=new Dme(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,hy(zr(zr({},this._config),{},{encoderConfig:o})),hy(this._constraints),hy(this._scalabilityMode),this._optimizationMode,d);return i&&o&&h.setEncoderConfiguration(o),M.debug("clone track from ".concat(this.getTrackId()," to ").concat(d,", clone ").concat(s)),h}bindProcessorContextEvents(){this.processorContext.on($l.REQUEST_UPDATE_CONSTRAINTS,async(i,s,o)=>{try{const d=Object.assign({},this._originalConstraints,...i);await this.renewMediaStreamTrack(d),s()}catch(d){o(d)}}),this.processorContext.on($l.REQUEST_CONSTRAINTS,async i=>{i(this._originMediaStreamTrack.getSettings())})}},An(Zl.prototype,"setDevice",[uX,hX],Object.getOwnPropertyDescriptor(Zl.prototype,"setDevice"),Zl.prototype),An(Zl.prototype,"setEnabled",[pX,fX,mX],Object.getOwnPropertyDescriptor(Zl.prototype,"setEnabled"),Zl.prototype),An(Zl.prototype,"setEncoderConfiguration",[gX,_X],Object.getOwnPropertyDescriptor(Zl.prototype,"setEncoderConfiguration"),Zl.prototype),An(Zl.prototype,"close",[yX],Object.getOwnPropertyDescriptor(Zl.prototype,"close"),Zl.prototype),Zl);function vX(n){const i=dr(8,"track-cus-"),s=_t.reportApiInvoke(null,{id:i,tag:Tr.TRACER,name:Qr.CREATE_CUSTOM_AUDIO_TRACK,options:[n]}),o=new Pi(n.mediaStreamTrack,n.encoderConfig?Yk(n.encoderConfig):{},i,!1);return M.info("create custom audio track success with config",n,"trackId",o.getTrackId()),s.onSuccess(o.getTrackId()),o}function b4(n,i,s,o){s.optimizationMode&&(o&&o.width&&o.height?(s.encoderConfig=zr(zr({},o),{},{bitrateMin:o.bitrateMin,bitrateMax:o.bitrateMax}),s.optimizationMode!=="motion"&&s.optimizationMode!=="detail"||(i.contentHint=s.optimizationMode,i.contentHint===s.optimizationMode?M.debug("[".concat(n,"] set content hint to"),s.optimizationMode):M.debug("[".concat(n,"] set content hint failed")))):M.warning("[".concat(n,"] can not apply optimization mode bitrate config, no encoderConfig")))}var EX,xX,bX,wX,Ld,SX,TX,RX,CX,NX,IX,AX,ba;class kX extends kY{getUserId(){return this._userId}constructor(i,s,o,d){super(i,"track-".concat(i.kind,"-").concat(s,"-").concat(d.clientId,"_").concat(dr(5,""))),Ie(this,"_userId",void 0),Ie(this,"_uintId",void 0),Ie(this,"_isDestroyed",!1),Ie(this,"store",void 0),Ie(this,"processor",void 0),Ie(this,"processorContext",void 0),this._userId=s,this._uintId=o,this.store=d}_updateOriginMediaStreamTrack(i){this._originMediaStreamTrack=i,this._mediaStreamTrack=i,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,M.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Nx=(EX=Vt({argsMap:(n,i,s)=>[n.getTrackId(),typeof i=="string"?i:i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),xX=Vt({argsMap:n=>[n.getTrackId()]}),bX=Vt({argsMap:(n,i)=>[n.getTrackId(),i.name]}),wX=Vt({argsMap:n=>[n.getTrackId()]}),An((Ld=class extends kX{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Da.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(n,i,s,o,d){super(n,i,s,o),Ie(this,"_videoVisibleTimer",null),Ie(this,"_previousVideoVisibleStatus",void 0),Ie(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Ie(this,"trackMediaType",Sx.VIDEO),Ie(this,"_videoWidth",void 0),Ie(this,"_videoHeight",void 0),Ie(this,"_player",void 0),Ie(this,"_prePlayer",void 0),Ie(this,"processorDestination",void 0),Ie(this,"processorContext",void 0),this._prePlayer=d,this.updateMediaStreamTrackResolution(),this.processorContext=new zY(this.getTrackId(),"remote"),this.processorDestination=new BY(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Wg(()=>{M.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),El(this,Et.GET_STATS)||zr({},IY)}play(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(Od.PLAY_START),typeof n=="string"){const o=document.getElementById(n);o?n=o:(M.warning("[".concat(this.getTrackId(),'] can not find "#').concat(n,'" element, use document.body')),n=document.body)}M.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));const s=zr(zr({fit:"cover"},i),{},{trackId:this.getTrackId(),element:n});if(this._player)this._player.updateConfig(s);else{let o=!1,d=!1;n instanceof HTMLVideoElement?(this._player=new x4(s),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,d=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,o=this._player.videoState>0,this._player.updateConfig(s)):this._player=new Qk(s),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Od.FIRST_FRAME_DECODED),d&&this.safeEmit(Od.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=h=>{this.safeEmit(Od.VIDEO_STATE_CHANGED,h)},o&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(Od.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},re("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(Od.PLAY_END)}stop(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(n),this._player=void 0,M.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){HY(this._originMediaStreamTrack).then(n=>{let[i,s]=n;this._videoHeight=s,this._videoWidth=i}).catch(eR)}_updatePlayerSource(){M.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var n,i;const s=this==null||(n=this._player)===null||n===void 0?void 0:n.getContainerElement(),o={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:d,slot:h}=o;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const f=Wq.checkOneElementVisible(d),g=Object.assign({},f);if(g.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=g.visible;const y=_t.reportApiInvoke(null,{tag:Tr.TRACER,name:Qr.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});g.visible?y.onSuccess("Video is visible"):y.onSuccess("Invisible because of ".concat(g.reason))}return g}return}catch(s){throw new Pe(se.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}pipe(n){if(this.processor===n)return n;if(n._source)throw new Pe(se.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),n}unpipe(){if(!this.processor)return;const n=this.processor;this.processor._source=void 0,this.processor=void 0,n.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Uo.ON_TRACK,async n=>{n?n!==this._mediaStreamTrack&&(this._mediaStreamTrack=n,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Uo.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(n){this.emit(yy.SEI_RECEIVED,n)}}).prototype,"play",[EX],Object.getOwnPropertyDescriptor(Ld.prototype,"play"),Ld.prototype),An(Ld.prototype,"stop",[xX],Object.getOwnPropertyDescriptor(Ld.prototype,"stop"),Ld.prototype),An(Ld.prototype,"pipe",[bX],Object.getOwnPropertyDescriptor(Ld.prototype,"pipe"),Ld.prototype),An(Ld.prototype,"unpipe",[wX],Object.getOwnPropertyDescriptor(Ld.prototype,"unpipe"),Ld.prototype),Ld),Ix=(SX=Vt({argsMap:(n,i)=>[n.getTrackId(),i],throttleTime:300}),TX=Vt({argsMap:(n,i)=>[n.getTrackId(),i],throttleTime:300}),RX=Vt({argsMap:(n,i)=>[n.getTrackId(),i]}),CX=Vt({argsMap:n=>[n.getTrackId()]}),NX=Vt({argsMap:n=>[n.getTrackId()]}),IX=Vt({argsMap:(n,i)=>[n.getTrackId(),i.name]}),AX=Vt({argsMap:n=>[n.getTrackId()]}),An((ba=class extends kX{get isPlaying(){return this._useAudioElement?uo.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(n,i,s,o){super(n,i,s,o),Ie(this,"trackMediaType",Sx.AUDIO),Ie(this,"_source",void 0),Ie(this,"_useAudioElement",!0),Ie(this,"_volume",100),Ie(this,"processorContext",void 0),Ie(this,"processorDestination",void 0),Ie(this,"_played",!1),Ie(this,"_bypassWebAudio",!1),re("DISABLE_WEBAUDIO")?(this._source=new v4,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new g4(n,!0),re("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Yl.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Od.FIRST_FRAME_DECODED)}),this.processorContext=new WY(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new GY(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Yl.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!n)return this._source.removeAllListeners(Yl.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(i),this._source.removeAllListeners(Yl.ON_AUDIO_BUFFER),this._source.on(Yl.ON_AUDIO_BUFFER,s=>n(s))}setVolume(n){this._volume=n,this._useAudioElement?uo.setVolume(this.getTrackId(),n):this._source.setVolume(n/100)}setAmplifiedVolume(n){this._useAudioElement&&this._played&&(uo.stop(this.getTrackId()),this._source.play()),this._useAudioElement=!1,n=Math.min(n,re("MAX_WEBAUDIO_VOLUME")),this._volume=n,this._source.setVolume(n/100)}async setPlaybackDevice(n){if(!this._useAudioElement||!bY())throw new Pe(se.NOT_SUPPORTED,"your browser does not support setting the audio output device");await uo.setSinkID(this.getTrackId(),n)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getVolume(){return this._useAudioElement?uo.getVolume(this.getTrackId()):this._source instanceof g4?this._source.getAudioVolume():0}getStats(){return Wg(()=>{M.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),El(this,Et.GET_STATS)||zr({},NY)}play(){M.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(M.debug("[".concat(this.getTrackId(),"] use audio element to play")),uo.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):(M.debug("[".concat(this.getTrackId(),"] use audio context to play")),this._source.play())}stop(){M.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?uo.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let n=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];M.debug("[".concat(this.getTrackId(),"] update player source track")),n&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&uo.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(n){if(this._bypassWebAudio)throw new Pe(se.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===n)return n;if(n._source)throw new Pe(se.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),n}unpipe(){var n;if(this._bypassWebAudio)throw new Pe(se.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const i=this.processor;(n=this._source.processSourceNode)===null||n===void 0||n.disconnect(),this.processor._source=!1,this.processor=void 0,i.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Uo.ON_TRACK,async n=>{n?n!==this._mediaStreamTrack&&(this._mediaStreamTrack=n,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(n)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Uo.ON_NODE,n=>{this._source.processedNode=n;const i=!n;this._useAudioElement!==i&&(this._played?(this.stop(),this._useAudioElement=i,this.play()):this._useAudioElement=i)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Uo.ON_TRACK),this.processorDestination.removeAllListeners(Uo.ON_NODE)}}).prototype,"setVolume",[SX],Object.getOwnPropertyDescriptor(ba.prototype,"setVolume"),ba.prototype),An(ba.prototype,"setAmplifiedVolume",[TX],Object.getOwnPropertyDescriptor(ba.prototype,"setAmplifiedVolume"),ba.prototype),An(ba.prototype,"setPlaybackDevice",[RX],Object.getOwnPropertyDescriptor(ba.prototype,"setPlaybackDevice"),ba.prototype),An(ba.prototype,"play",[CX],Object.getOwnPropertyDescriptor(ba.prototype,"play"),ba.prototype),An(ba.prototype,"stop",[NX],Object.getOwnPropertyDescriptor(ba.prototype,"stop"),ba.prototype),An(ba.prototype,"pipe",[IX],Object.getOwnPropertyDescriptor(ba.prototype,"pipe"),ba.prototype),An(ba.prototype,"unpipe",[AX],Object.getOwnPropertyDescriptor(ba.prototype,"unpipe"),ba.prototype),ba);const xl=new class extends ai{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Ie(this,"_lastHiddenTime",0),Ie(this,"_lastVisibleTime",0),Ie(this,"needUploadStats",[]),Ie(this,"isCollectingStats",!1),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),this.isCollectingStats&&this.needUploadStats.push(document.visibilityState==="visible"?1:0),M.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}startCollectStats(){this.isCollectingStats=!0,this.needUploadStats.push(this.visibility==="visible"?1:0)}stopCollectStats(){this.isCollectingStats=!1,this.needUploadStats.length=0}};class PX extends ai{constructor(i,s){super(),Ie(this,"trackMediaType",Sx.DATA),Ie(this,"_version",1),Ie(this,"_type",3),Ie(this,"_config",void 0),Ie(this,"_originDataChannel",void 0),Ie(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Ie(this,"_dataStreamPacketHandler",{serialize:o=>o,deserialize:o=>o}),Ie(this,"_datachannelEventMap",new Map),this._config=i,s&&(this._originDataChannel=s,this._bandDataChannelEvents(s)),this._initPacketHeader()}useDataStream(i){this._dataStreamPacketHandler=i}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return re("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var i,s;return(i=(s=this._originDataChannel)===null||s===void 0?void 0:s.readyState)!==null&&i!==void 0?i:"connecting"}get _originDataChannelId(){var i,s;return(i=(s=this._originDataChannel)===null||s===void 0?void 0:s.id)!==null&&i!==void 0?i:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new et((i,s)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&i();const o=setTimeout(()=>{var d;s(new Pe(se.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((d=this._originDataChannel)===null||d===void 0?void 0:d.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(o),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),i()},this._originDataChannel.onerror=()=>{throw clearTimeout(o),new Pe(se.DATACHANNEL_CONNECTION_TIMEOUT)}}else s(new Pe(se.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(i){this._originDataChannel=i,this._bandDataChannelEvents(i)}_initPacketHeader(){const i=new DataView(this._dataStreamPacketHeader);i.setUint16(0,this._version),i.setUint8(2,this._type),i.setUint8(3,this._config.id)}_bandDataChannelEvents(i){this._unbindDataChannelEvents(i),[$k.OPEN,$k.CLOSE,$k.ERROR].forEach(s=>{const o=()=>{this.emit(s)};this._datachannelEventMap.set(s,o),i.addEventListener(s,o)})}_unbindDataChannelEvents(i){Array.from(this._datachannelEventMap.entries()).forEach(s=>{let[o,d]=s;i.removeEventListener(o,d)}),this._datachannelEventMap.clear()}}class $xe extends PX{constructor(i){super(i),Ie(this,"_messageListener",void 0),this._messageListener=s=>{if(s.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const o=s.data.slice(0,this._dataStreamPacketHeader.byteLength),d=new DataView(o).getUint8(3);if(d!==this.id)return void(re("SHOW_DATASTREAM2_LOG")&&M.debug("invalid datachannel id: ".concat(d," !== ").concat(this.id)));let h=s.data.slice(this._dataStreamPacketHeader.byteLength);h=this._dataStreamPacketHandler.deserialize(h),this.emit($k.MESSAGE,h)}}_updateOriginDataChannel(i){super._updateOriginDataChannel(i),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Xxe extends PX{send(i){if(this._originDataChannel){let s=i;s=this._dataStreamPacketHandler.serialize(i);const o=new Uint8Array(this._dataStreamPacketHeader.byteLength+s.byteLength);o.set(new Uint8Array(this._dataStreamPacketHeader),0),o.set(new Uint8Array(s),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(o.buffer)}}}function eP(){const n=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcixuPVtdLHI9W107bGV0IGg9bnVsbDtlLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9dD0+e3QuZGF0YS5zZWkmJm4ucHVzaCh0LmRhdGEuc2VpKSx0LmRhdGEubWV0YWRhdGEmJnIucHVzaCh0LmRhdGEubWV0YWRhdGEpfSxzZWxmLnBvc3RNZXNzYWdlKCJzdGFydGVkIik7Y29uc3QgcD1lLnJlYWRhYmxlLmdldFJlYWRlcigpLFU9ZS53cml0YWJsZS5nZXRXcml0ZXIoKTsic2VpLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KG4udmFsdWUuZGF0YSkpLHI9YShuLnZhbHVlLHQpO2lmKHImJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtzZWk6cn0pLCFoKXtjb25zdCB0PW4udmFsdWUuZ2V0TWV0YWRhdGEoKXx8e307aD17dHlwZTpuLnZhbHVlLnR5cGUscnRwVGltZXN0YW1wOm4udmFsdWUudGltZXN0YW1wLHBheWxvYWRUeXBlOnQucGF5bG9hZFR5cGV8fDAsc3NyYzp0LnN5bmNocm9uaXphdGlvblNvdXJjZXx8MCxsZW5ndGg6bi52YWx1ZS5kYXRhLmJ5dGVMZW5ndGgsLi4uIm1pbWVUeXBlImluIHQ/e21pbWVUeXBlOnQubWltZVR5cGV9Ont9fSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7Zmlyc3RGcmFtZUluZm86aH0pfX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToic2VpLXR4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigoYT0+e2lmKCFhLmRvbmUpe2lmKGEudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KGEudmFsdWUuZGF0YSkpLGU9bi5zaGlmdCgpO2lmKGUpe2NvbnN0IG49byhhLnZhbHVlLmRhdGEsZSx0KTtuJiYoYS52YWx1ZS5kYXRhPW4pfX1VLndyaXRlKGEudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtwLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PW5ldyBEYXRhVmlldyhuLnZhbHVlLmRhdGEpLGE9dC5nZXRVaW50OCgwKTtsZXQgcjtpZigwIT0oMTI4JmEpJiY3MSE9PWEpe2NvbnN0IGU9ZnVuY3Rpb24odCl7aWYodC5ieXRlTGVuZ3RoPD0wKXJldHVybltdO2NvbnN0IGU9W107bGV0IG49MDtmb3IoO248dC5ieXRlTGVuZ3RoOyl7Y29uc3QgYT0oMTI4JnQuZ2V0VWludDgobikpPj43LHI9MTI3JnQuZ2V0VWludDgobik7aWYoIShhJiZuKzQ8PXQuYnl0ZUxlbmd0aCkpe24rKzticmVha317Y29uc3QgYT10LmdldFVpbnQzMihuLCExKSxvPSgxNjc3NjE5MiZhKT4+MTAsaT0xMDIzJmE7ZS5wdXNoKHtwdDpyLHRzX29mZnNldDpvLGxlbmd0aDppLGRhdGE6bmV3IFVpbnQ4QXJyYXl9KSxuKz00fX1sZXQgYT10LmJ5dGVMZW5ndGgtbjtmb3IoY29uc3QgciBvZiBlKXtpZihyLmxlbmd0aD5hKXJldHVybiBjb25zb2xlLndhcm4oIkJyb2tlbiByZWQgcGF5bG9hZCIpLFtdO3IubGVuZ3RoPjAmJihyLmRhdGE9bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sci5sZW5ndGgpLG4rPXIubGVuZ3RoLGEtPXIubGVuZ3RoKX1pZihhPjApe2NvbnN0IHI9e3B0OmUubGVuZ3RoPjA/ZVtlLmxlbmd0aC0xXS5wdDowLHRzX29mZnNldDowLGxlbmd0aDphLGRhdGE6bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sYSl9O2UucHVzaChyKX1yZXR1cm4gZX0odCk7aWYoZS5sZW5ndGg+MCl7Y29uc3QgdD1mdW5jdGlvbih0KXtsZXQgZT0wO2ZvcihsZXQgbj0wO248dC5sZW5ndGg7bisrKWUrPW48dC5sZW5ndGgtMT80OjEsZSs9dFtuXS5sZW5ndGg7Y29uc3Qgbj1uZXcgVWludDhBcnJheShlKTtsZXQgYT0wO2ZvcihsZXQgZT0wO2U8dC5sZW5ndGg7ZSsrKWlmKGU8dC5sZW5ndGgtMSl7Y29uc3Qgcj0oMjE0NzQ4MzY0OHwoMTI3JnRbZV0ucHQpPDwyNHwoMjYyMTQzJnRbZV0udHNfb2Zmc2V0KTw8MTB8MTAyMyZ0W2VdLmxlbmd0aCk+Pj4wO25bYSsrXT1yPj4yNCYyNTUsblthKytdPXI+PjE2JjI1NSxuW2ErK109cj4+OCYyNTUsblthKytdPTI1NSZyfWVsc2UgblthKytdPTEyNyZ0W2VdLnB0O2Zvcihjb25zdCBlIG9mIHQpbi5zZXQoZS5kYXRhLGEpLGErPWUubGVuZ3RoO3JldHVybiBufShlLm1hcCgodD0+e2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>Z1.revokeObjectURL(n),0),new Worker(Z1.createObjectURL(n))}const DX=71,w4=1,S4=2,T4=1,OX=2;var Kg=function(n){return n[n.AUDIO_LEVEL=1]="AUDIO_LEVEL",n[n.METADATA=2]="METADATA",n[n.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",n}(Kg||{});function R4(n){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=n.getUint8(0);if(s!==DX)return;const o=n.getUint16(1),d=w4+S4+o,h=new Uint8Array(n.byteLength-d);h.set(new Uint8Array(n.buffer,d,n.byteLength-d));const f={m:s,tlvLen:o,tlv:[],frame:h};let g=w4+S4;for(;g<d;){const y=n.getUint8(g),x=n.getUint16(g+T4),b=T4+OX;if(y===Kg.AUDIO_LEVEL){let N=n.getUint8(g+b);for(let I=1;I<x;I++)N=N<<8|n.getUint8(g+b+I);f.tlv.push({tag:y,length:x,value:i?127^N>>1:127&N})}else if(y===Kg.METADATA||y===Kg.AUDIO_64_BIT_PTS){const N=new Uint8Array(x);for(let I=0;I<x;I++)N[I]=n.getUint8(g+b+I);f.tlv.push({tag:y,length:x,value:N})}g+=b+x}return f}const tP=new Map,nP=127,xy=1e-10,C4=139/13,rP=new Map;function N4(n,i,s){const o="".concat(n,"-").concat(i,"-").concat(s);let d=0;return rP.has(o)?d=rP.get(o):(d=Math.log(function(f,g){const y=f-g;g<y&&(g=y);let x=1;for(let b=f,N=1;b>g;b--,N++)x=x*b/N;return x}(i,n))+n*Math.log(.5)+(i-n)*Math.log(1-.5)-Math.log(s)+s*n,rP.set(o,d)),d<xy&&(d=xy),d}function LX(n,i,s){const o=i.length,d=n.length/o;let h=!1;for(let f=0,g=0;f<o;f++){let y=0;for(let x=g+d;g<x;g++)n[g]>s&&y++;i[f]!==y&&(i[f]=y,h=!0)}return h}window.cache=rP;let Jxe=0;class jX{constructor(i){Ie(this,"id",void 0),Ie(this,"immediates",[]),Ie(this,"lastNonSilence",-1),Ie(this,"immediateSpeechActivityScore",xy),Ie(this,"lastLevelChangedTime",Date.now()),Ie(this,"levels",[]),Ie(this,"longs",[]),Ie(this,"longSpeechActivityScore",xy),Ie(this,"mediums",[]),Ie(this,"mediumSpeechActivityScore",xy),Ie(this,"minLevel",0),Ie(this,"nextMinLevel",0),Ie(this,"nextMinLevelWindowLength",0),Ie(this,"energyScore",0),this.id=i||"".concat(Jxe++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const i=this.immediates,s=this.levels,o=this.minLevel+C4;let d=!1;for(let h=0;h<i.length;++h){let f=s[h];f<o&&(f=0);const g=Math.floor(f/C4);i[h]!==g&&(i[h]=g,d=!0)}return d}computeLongs(){return LX(this.mediums,this.longs,4)}computeMediums(){return LX(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=N4(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(i){this.longSpeechActivityScore=N4(this.longs[0],10,47),this.longSpeechActivityScore>xy&&(this.lastNonSilence=i)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=N4(this.mediums[0],5,24)}evaluateSpeechActivityScores(i){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(i)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var i;return"[".concat(Tt(i=[...this.levels]).call(i).join(),"]")}getSpeechActivityScore(i){switch(i){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+i)}}levelChanged(i,s){if(this.lastLevelChangedTime<=s){this.lastLevelChangedTime=s;let o=i;return i<0&&(o=0),i>nP&&(o=nP),this.levels.unshift(o),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(o),o>=this.minLevel+C4?o:o/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(i){if(i!==0){if(this.minLevel===0||this.minLevel>i)return this.minLevel=i,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=i,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>i&&(this.nextMinLevel=i),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let s=Math.sqrt(this.minLevel*this.nextMinLevel);s<0?s=0:s>nP&&(s=nP),this.minLevel=s,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Qxe{constructor(i){Ie(this,"algorithm",void 0),this.algorithm=i}execute(){let i=!this.algorithm;if(!i)try{const s=this.algorithm.runInDecisionMaker(this);s<=0?i=!0:setTimeout(this.execute.bind(this),s)}catch{i=!0}i&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class I4{constructor(i,s,o){Ie(this,"isDominant",void 0),Ie(this,"energyRanking",void 0),Ie(this,"energyScore",void 0),this.isDominant=i,this.energyRanking=s,this.energyScore=o}}class Zxe extends ai{constructor(i){super(),Ie(this,"dominantId",null),Ie(this,"lastDecisionTime",0),Ie(this,"lastLevelChangedTime",0),Ie(this,"lastLevelIdleTime",0),Ie(this,"relativeSpeechActivities",[]),Ie(this,"speakers",new Map),Ie(this,"enableSilence",!1),Ie(this,"timeoutToSilenceInterval",0),Ie(this,"decisionMaker",null),Ie(this,"loudest",[]),Ie(this,"numLoudestToTrack",3),Ie(this,"energyExpireTimeMs",250),Ie(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=i,this.enableSilence=i>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,s=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=i,s!=null&&(this.energyExpireTimeMs=s),o!=null&&(this.energyAlphaPct=o),this.loudest.length>i&&this.loudest.splice(i)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(i){return this.loudest.some(s=>s.id===i)}levelChanged(i,s){const o=Date.now(),d=this.getOrCreateSpeaker(i);this.lastLevelChangedTime<o&&(this.lastLevelChangedTime=o,this.maybeStartDecisionMaker());const h=d.levelChanged(s,o);return this.updateLoudestList(d,h,o)}runInDecisionMaker(i){return this.decisionMaker!==i||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(i){this.decisionMaker===i&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(i){i.forEach(s=>{this.speakers.has(s.id)||this.speakers.set(s.id,s)})}removeSpeakers(i){i.forEach(s=>{this.speakers.delete(s.id)})}getOrCreateSpeaker(i){let s=this.speakers.get(i);return s||(s=new jX(i),this.speakers.set(i,s),this.maybeStartDecisionMaker()),s}updateLoudestList(i,s,o){const d=i.id===this.dominantId;if(s<0){let y=0;for(;y<this.loudest.length&&this.loudest[y]!==i;)++y;return new I4(d,y,i.energyScore)}if(i.energyScore=Math.floor((this.energyAlphaPct*s+(100-this.energyAlphaPct)*i.energyScore+50)/100),this.numLoudestToTrack===0)return new I4(d,0,i.energyScore);const h=o-this.energyExpireTimeMs;let f=0;for(;f<this.loudest.length;){const y=this.loudest[f];if(y.getLastLevelChangedTime()<h&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(f,1);else if(y.id!==i.id)++f;else if(this.loudest.splice(f,1),this.loudest.length<this.numLoudestToTrack)break}let g=0;for(;g<this.loudest.length&&!(this.loudest[g].energyScore<i.energyScore);)++g;return g<this.numLoudestToTrack&&(this.loudest.splice(g,0,i),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new I4(d,g,i.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Qxe(this),this.decisionMaker.execute())}makeDecision(i){let s=null,o=null;const d=this.speakers.size;let h=null;if(d===0)h=null;else if(d===1){var f;const g=pc(f=this.speakers).call(f).next().value;this.enableSilence&&g&&(h=g.id,g.evaluateSpeechActivityScores(i),i-g.lastNonSilence>this.timeoutToSilenceInterval&&(h=null))}else{let g=this.dominantId==null?null:this.speakers.get(this.dominantId);if(g==null){const b=this.speakers.entries().next();b.value&&(h=b.value[0],g=b.value[1])}else h=g.id;g!=null&&g.evaluateSpeechActivityScores(i);const y=this.relativeSpeechActivities;let x=2;for(const b of this.speakers.entries()){const[N,I]=b;if(I===g)continue;I.evaluateSpeechActivityScores(i);for(let K=0;K<y.length;++K){const ie=g==null?xy:g.getSpeechActivityScore(K);y[K]=Math.log(I.getSpeechActivityScore(K)/ie)}const D=y[0],$=y[1],z=y[2];D>3&&$>2&&z>0&&$>x&&(x=$,h=N)}this.enableSilence&&g!=null&&h===g.id&&i-g.lastNonSilence>this.timeoutToSilenceInterval&&(h=null)}h==null&&!this.enableSilence||h===this.dominantId||(s=this.dominantId,this.dominantId=h,o=this.dominantId),o==null&&!this.enableSilence||o===s||this.emit("ActiveSpeakerChanged",o)}_runInDecisionMaker(){const i=Date.now(),s=300-(i-this.lastLevelIdleTime);let o=0;s<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(i),this.lastLevelIdleTime=i):o=s;let d=300-(i-this.lastDecisionTime);return d<=0&&(this.lastDecisionTime=i,this.makeDecision(i),d=300-(Date.now()-i)),d>0&&o>d&&(o=d),o}timeoutIdleLevels(i){const s=[];for(const d of pc(o=this.speakers).call(o)){var o;const h=i-d.getLastLevelChangedTime();36e5<h&&(this.dominantId==null||d.id!==this.dominantId)?s.push(d.id):300<h&&d.levelTimedOut()}s.forEach(d=>this.speakers.delete(d))}}const Ax=new Map;let Oh=null,iP=null;const MX=3;let by=[];const Lh=new Map,sP=new Map;class ebe{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(i,s){Ie(this,"id",void 0),Ie(this,"track",void 0),Ie(this,"score",0),Ie(this,"active",!0),Ie(this,"muted",!1),Ie(this,"timer",0),Ie(this,"actives",0),Ie(this,"inactives",0),this.id=i,this.track=s,this.setActive(Lh.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const i=this.active;this.active=this.activeRate>=.8;const{actives:s,inactives:o}=function(){const d=[],h=[];return Array.from(pc(Lh).call(Lh)).forEach(f=>{f.active?d.push(f):h.push(f)}),{actives:d,inactives:h}}();if(s.length>3){let d;s.forEach(h=>{(!d||d.score>h.score)&&(d=h)}),d&&d.setActive(!1)}if(s.length<3&&o.length>0){let d;o.forEach(h=>{(!d||d.score<h.score)&&h.id!==this.id&&(d=h)}),d&&i&&!this.active&&(d.samples>40&&d.activeRate-this.activeRate>.4?d.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(i){this.active=i,this.resetTimer(),this.setMuted(!i)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const i=function(s){let o;return Array.from(pc(Lh).call(Lh)).forEach(d=>{!d.active||d.id===s||d.samples<40||(!o||d.score<o.score)&&(o=d)}),o}(this.id);i&&this.activeRate-i.activeRate>.4&&(i.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const i=function(s){let o;return Array.from(pc(Lh).call(Lh)).forEach(d=>{d.active||d.id===s||d.samples<40||(!o||d.score>o.score)&&(o=d)}),o}(this.id);i&&i.activeRate-this.activeRate>.4&&(i.setActive(!0),this.setActive(!1))}addSample(i){i?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(i){this.track&&(this.track.enabled=!i,this.muted=i)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let aP;function UX(n){const i=Lh.get(n);i&&(Lh.delete(n),i.clearTimer())}const oP=new Map,tbe=new Map,A4="video/h264",k4="video/h265";function VX(n,i,s){let o=new Uint8Array(n,i,s),d=[],h=0;for(;d.length<s;)h+3<s&&o[h]===0&&o[h+1]===0&&o[h+2]===3&&(o[h+3]===0||o[h+3]===1||o[h+3]===2||o[h+3]===3)?(d.push(o[h],o[h+1],o[h+3]),h+=4):(d.push(o[h]),h++);return new Uint8Array(d)}function FX(n){const i=n.length;let s=[],o=0;for(;o<i;)o+2<i&&n[o]===0&&n[o+1]===0&&(n[o+2]===0||n[o+2]===1||n[o+2]===2||n[o+2]===3)?(s.push(n[o],n[o+1],3,n[o+2]),o+=3):(s.push(n[o]),o++);return new Uint8Array(s)}function BX(n){if(n.length<5)return"";let i=-1;for(let d=0;d<n.length-3;d++){if(n[d]===0&&n[d+1]===0&&n[d+2]===1){i=d;break}if(d<n.length-4&&n[d]===0&&n[d+1]===0&&n[d+2]===0&&n[d+3]===1){i=d;break}}if(i===-1)return"";const s=i+(n[i+2]===0?4:3);if(s>=n.length)return"";const o=n[s];return 128&o?"":(o>>1&63)>=32||s+1<n.length&&!(248&n[s+1])?k4:(31&o)<=31?A4:""}const cP=new Map,oR=new Map;(function(){const n=Wn();ks.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),ks.getStreamFromExtension=n.name===$n.CHROME&&Number(n.version)>34,ks.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const i=new RTCPeerConnection;let s=!1;try{i.addTransceiver("audio"),s=!0}catch{}return i.close(),s}(),ks.supportMinBitrate=n.name===$n.CHROME||n.name===$n.EDGE,ks.supportSetRtpSenderParameters=function(){const i=Wn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Jp()||!(!Ks()&&!Lk())||i.name===$n.FIREFOX&&Number(i.version)>=64)}(),n.name===$n.SAFARI&&(Number(n.version)>=14?ks.supportDualStream=!0:ks.supportDualStream=!1),ks.webAudioMediaStreamDest=function(){const i=Wn();return!(i.name===$n.SAFARI&&Number(i.version)<12)}(),ks.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",ks.supportWebGL=typeof WebGLRenderingContext<"u",ks.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Jp()||(ks.webAudioWithAEC=!0),ks.supportShareAudio=function(){const i=Wn();return(i.os===Is.WIN_10||i.os===Is.WIN_81||i.os===Is.WIN_7||i.os===Is.LINUX||i.os===Is.MAC_OS||i.os===Is.CHROMIUM_OS)&&i.name===$n.CHROME&&Number(i.version)>=74}(),ks.supportDataChannel=!!(Ph(76)||LV(68)||Pq(14)),ks.supportPCSetConfiguration=function(){const i=window.RTCPeerConnection;return!Kr()&&!!i&&i.prototype.setConfiguration instanceof Function}(),ks.supportWebRTCEncodedTransform=Ph(87)||Iq()||LV(117),ks.supportWebRTCInsertableStream=function(){const i=Wn();return(i.name===$n.CHROME||i.name===$n.EDGE)&&Number(i.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),ks.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,ks.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,ks.supportSuppressLocalAudioPlayback=TY(),ks.supportRestrictOwnAudio=RY(),Mk(()=>{ks.supportDualStreamEncoding=function(){const i=Wn();return!!re("DISABLE_WEBAUDIO")||i.name==="Safari"&&Number(i.version)>=14||!!(i.name==="Chrome"&&/Windows/i.test(i.os||"")&&Number(i.version)>=100&&re("CHROME_DUAL_STREAM_USE_ENCODING"))}(),M.debug("browser ua: ",navigator.userAgent),M.info("browser info: ",n),M.info("browser compatibility: ",ks)})})();const nbe=["CHINA","GLOBAL"],zX=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],wy=[],kx=[];function Sy(n,i){return!!i&&wy.some(s=>s.uid===n&&s.channelName===i)}function P4(){return kx.length>0}var rbe=$7.forEach,GX=fu("forEach")?[].forEach:function(n){return rbe(this,n,arguments.length>1?arguments[1]:void 0)};In({target:"Array",proto:!0,forced:[].forEach!==GX},{forEach:GX});var ibe=Co("Array","forEach"),sbe=hl,abe=Zi,obe=A,cbe=ibe,D4=Array.prototype,lbe={DOMTokenList:!0,NodeList:!0},dbe=function(n){var i=n.forEach;return n===D4||obe(D4,n)&&i===D4.forEach||abe(lbe,sbe(n))?cbe:i},ube=l(dbe),hbe=io,WX=eE;In({target:"Object",stat:!0,forced:u(function(){WX(1)})},{keys:function(n){return WX(hbe(n))}});var pbe=l(ds.Object.keys),fbe=l(N0),mbe=l(nt),gbe=In,HX=Rd,_be=RE,ybe=Jn,KX=He,vbe=sr,Ebe=ui,xbe=uU,bbe=Zt,wbe=Gp,Sbe=V7("slice"),Tbe=bbe("species"),O4=Array,Rbe=Math.max;gbe({target:"Array",proto:!0,forced:!Sbe},{slice:function(n,i){var s,o,d,h=Ebe(this),f=vbe(h),g=KX(n,f),y=KX(i===void 0?f:i,f);if(HX(h)&&(s=h.constructor,(_be(s)&&(s===O4||HX(s.prototype))||ybe(s)&&(s=s[Tbe])===null)&&(s=void 0),s===O4||s===void 0))return wbe(h,g,y);for(o=new(s===void 0?O4:s)(Rbe(y-g,0)),d=0;g<y;g++,d++)g in h&&xbe(o,d,h[g]);return o.length=d,o}});var Cbe=Co("Array","slice"),Nbe=A,Ibe=Cbe,L4=Array.prototype,Abe=function(n){var i=n.slice;return n===L4||Nbe(L4,n)&&i===L4.slice?Ibe:i},kbe=l(Abe);function it(n,i,s,o,d){var h,f,g,y={};return ube(h=pbe(o)).call(h,function(x){y[x]=o[x]}),y.enumerable=!!y.enumerable,y.configurable=!!y.configurable,("value"in y||y.initializer)&&(y.writable=!0),y=fbe(f=mbe(g=kbe(s).call(s)).call(g)).call(f,function(x,b){return b(n,i,x)||x},y),d&&y.initializer!==void 0&&(y.value=y.initializer?y.initializer.call(d):void 0,y.initializer=void 0),y.initializer===void 0?(L7(n,i,y),null):y}let lP=function(n){return n[n.ACCESS_POINT=101]="ACCESS_POINT",n[n.UNILBS=201]="UNILBS",n[n.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",n}({}),j4=function(n){return n[n.IIIEGAL_APPID=1]="IIIEGAL_APPID",n[n.IIIEGAL_UID=2]="IIIEGAL_UID",n[n.INTERNAL_ERROR=3]="INTERNAL_ERROR",n}({}),jd=function(n){return n[n.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",n[n.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",n[n.INTERNAL_ERROR=8]="INTERNAL_ERROR",n[n.NO_AUTHORIZED=9]="NO_AUTHORIZED",n[n.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",n[n.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",n[n.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",n[n.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",n[n.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",n[n.USER_OVERLOAD=16]="USER_OVERLOAD",n[n.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",n[n.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",n[n.REQ_DOWNGRADE_FALLBACK=27]="REQ_DOWNGRADE_FALLBACK",n}({}),Vo=function(n){return n[n.NO_FLAG_SET=100]="NO_FLAG_SET",n[n.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",n[n.INVALID_FALG_SET=102]="INVALID_FALG_SET",n[n.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",n[n.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",n[n.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",n[n.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",n[n.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",n[n.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",n[n.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",n[n.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",n[n.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",n[n.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",n[n.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",n[n.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",n[n.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",n[n.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",n[n.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",n[n.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",n}({}),jt=function(n){return n[n.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",n[n.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",n[n.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",n[n.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",n[n.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",n[n.K_TICKET_INVALID=7]="K_TICKET_INVALID",n[n.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",n[n.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",n[n.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",n[n.K_UID_BANNED=14]="K_UID_BANNED",n[n.K_IP_BANNED=15]="K_IP_BANNED",n[n.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",n[n.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",n[n.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",n[n.K_VOS_FALLBACK=30]="K_VOS_FALLBACK",n[n.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",n[n.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",n[n.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",n[n.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",n[n.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",n[n.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",n[n.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",n[n.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",n[n.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",n[n.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",n[n.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",n[n.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",n[n.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",n[n.ERR_INVALID_UID=117]="ERR_INVALID_UID",n[n.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",n[n.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",n[n.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",n[n.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",n[n.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",n[n.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",n[n.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",n[n.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",n[n.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",n[n.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",n[n.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",n[n.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",n[n.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",n[n.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",n[n.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",n[n.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",n[n.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",n[n.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",n[n.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",n[n.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",n[n.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",n[n.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",n[n.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",n[n.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",n[n.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",n[n.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",n[n.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",n[n.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",n[n.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",n[n.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",n[n.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",n[n.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",n[n.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",n[n.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",n[n.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",n[n.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",n[n.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",n}({}),Cn=function(n){return n.CONNECTING="connecting",n.CONNECTED="connected",n.RECONNECTING="reconnecting",n.CLOSED="closed",n}({}),xt=function(n){return n.WS_CONNECTED="ws_connected",n.WS_RECONNECTING="ws_reconnecting",n.WS_CLOSED="ws_closed",n.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",n.ON_BINARY_DATA="on_binary_data",n.REQUEST_RECOVER="request_recover",n.REQUEST_JOIN_INFO="request_join_info",n.REQUEST_REJOIN_INFO="req_rejoin_info",n.IS_P2P_DISCONNECTED="is_p2p_dis",n.DISCONNECT_P2P="dis_p2p",n.ABORT_P2P_EXECUTION="abort_p2p_execution",n.NEED_RENEW_SESSION="need-sid",n.REPORT_JOIN_GATEWAY="report_join_gateway",n.REQUEST_TIMEOUT="request_timeout",n.REQUEST_SUCCESS="request_success",n.JOIN_RESPONSE="join_response",n.PRE_CONNECT_PC="pre_connect_pc",n.DATACHANNEL_PRECONNECT="datachannel_preconnect",n.DATACHANNEL_CONNECTING="datachannel_connecting",n.DATACHANNEL_FAILBACK="datachannel_failback",n.P2P_CONNECTION="p2p_connection",n.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",n.P2P_SUBSCRIBE="p2p_subscribe",n.P2P_UNSUBSCRIBE="p2p_unsubscribe",n.P2P_EXCHANGE_SDP="p2p_exchange_sdp",n.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",n.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",n.RECOVER_NOTIFICATION="recover_notification",n.VOS_FALLBACK="vos_fallback",n.VOS_FALLBACK_PROMISE="vos_fallback_promise",n}({}),kt=function(n){return n.PING="ping",n.PING_BACK="ping_back",n.JOIN="join_v3",n.REJOIN="rejoin_v3",n.LEAVE="leave",n.SET_CLIENT_ROLE="set_client_role",n.PUBLISH="publish",n.PUBLISH_DATASTREAM="publish_datastream",n.UNPUBLISH="unpublish",n.UNPUBLISH_DATASTREAM="unpublish_datastream",n.SUBSCRIBE="subscribe",n.PRE_SUBSCRIBE="pre_subscribe",n.SUBSCRIBE_DATASTREAM="subscribe_datastream",n.SUBSCRIBE_STREAMS="subscribe_streams",n.UNSUBSCRIBE="unsubscribe",n.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",n.UNSUBSCRIBE_STREAMS="unsubscribe_streams",n.SUBSCRIBE_CHANGE="subscribe_change",n.TRAFFIC_STATS="traffic_stats",n.RENEW_TOKEN="renew_token",n.SET_DUAL_STREAM_MODE="set_dual_stream_mode",n.SWITCH_VIDEO_STREAM="switch_video_stream",n.DEFAULT_VIDEO_STREAM="default_video_stream",n.SET_FALLBACK_OPTION="set_fallback_option",n.CONFIGURE="configure",n.GATEWAY_INFO="gateway_info",n.CONTROL="control",n.SEND_METADATA="send_metadata",n.DATA_STREAM="data_stream",n.PICK_SVC_LAYER="pick_svc_layer",n.RESTART_ICE="restart_ice",n.CONNECT_PC="connect_pc",n.SET_VIDEO_PROFILE="set_video_profile",n.SET_PARAMETER="set_parameter",n.SET_RTM2_FLAG="set_rtm2_flag",n.DOWNGRADE_CODEC="downgrade_codec",n}({}),Ty=function(n){return n.WRTC_STATS="wrtc_stats",n.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",n.DENOISER_STATS="denoiser_stats",n.EXTENSION_USAGE_STATS="extension_usage_stats",n}({}),Yt=function(n){return n.ON_USER_ONLINE="on_user_online",n.ON_USER_OFFLINE="on_user_offline",n.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",n.ON_PUBLISH_STREAM="on_publish_stream",n.ON_UPLINK_STATS="on_uplink_stats",n.ON_P2P_LOST="on_p2p_lost",n.ON_REMOVE_STREAM="on_remove_stream",n.ON_ADD_AUDIO_STREAM="on_add_audio_stream",n.ON_ADD_VIDEO_STREAM="on_add_video_stream",n.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",n.ON_USER_BANNED="on_user_banned",n.ON_USER_LICENSE_BANNED="on_user_license_banned",n.ON_NOTIFICATION="on_notification",n.ON_CRYPT_ERROR="on_crypt_error",n.MUTE_AUDIO="mute_audio",n.MUTE_VIDEO="mute_video",n.UNMUTE_AUDIO="unmute_audio",n.UNMUTE_VIDEO="unmute_video",n.ON_P2P_OK="on_p2p_ok",n.RECEIVE_METADATA="receive_metadata",n.ON_DATA_STREAM="on_data_stream",n.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",n.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",n.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",n.ENABLE_LOCAL_VIDEO="enable_local_video",n.DISABLE_LOCAL_VIDEO="disable_local_video",n.ENABLE_LOCAL_AUDIO="enable_local_audio",n.DISABLE_LOCAL_AUDIO="disable_local_audio",n.ON_PUBLISHED_USER_LIST="on_published_user_list",n.ENABLE_MULTI_STREAM="enable_multi_stream",n}({}),Fo=function(n){return n.SEND_ONLY="SEND_ONLY",n.RECEIVE_ONLY="RECEIVE_ONLY",n}({}),an=function(n){return n.CONNECTED="websocket:connected",n.RECONNECTING="websocket:reconnecting",n.WILL_RECONNECT="websocket:will_reconnect",n.CLOSED="websocket:closed",n.FAILED="websocket:failed",n.ON_MESSAGE="websocket:on_message",n.REQUEST_NEW_URLS="websocket:request_new_urls",n.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",n.ON_FALLBACK="websocket:on_fallback",n}({});function dP(n){if(typeof n!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(n))throw M.error("Invalid Channel Name ".concat(n)),new Ce(se.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function uP(n){if(i=n,!(typeof i=="number"&&Math.floor(i)===i&&0<=i&&i<=4294967295||Bq(n,1,255)))throw new Ce(se.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var i;typeof n=="string"&&M.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let hm=function(n){return n.TRANSCODE="mix_streaming",n.RAW="raw_streaming",n}({});const Pbe={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},M4={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function U4(n,i){la(n.url,"".concat(i,".url"),1,1e3,!1),bi(n.x)||Sr(n.x,"".concat(i,".x"),0,1e4),bi(n.y)||Sr(n.y,"".concat(i,".y"),0,1e4),bi(n.width)||Sr(n.width,"".concat(i,".width"),0,1e4),bi(n.height)||Sr(n.height,"".concat(i,".height"),0,1e4),bi(n.zOrder)||Sr(n.zOrder,"".concat(i,".zOrder"),0,255),bi(n.alpha)||Sr(n.alpha,"".concat(i,".alpha"),0,1,!1)}const Dbe={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let qg=function(n){return n.WARNING="@live_uap-warning",n.ERROR="@line_uap-error",n.PUBLISH_STREAM_STATUS="@live_uap-publish-status",n.WORKER_STATUS="@live_uap-worker-status",n.REQUEST_NEW_ADDRESS="@live_uap-request-address",n}({}),V4=function(n){return n.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",n}({}),_s=function(n){return n[n.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",n[n.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",n[n.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",n[n.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",n[n.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",n[n.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",n[n.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",n[n.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",n[n.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",n[n.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",n[n.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",n[n.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",n[n.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",n[n.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",n[n.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",n[n.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",n[n.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",n[n.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",n[n.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",n[n.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",n[n.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",n}({});function qX(n){if(!n.channelName)throw new Ce(se.INVALID_PARAMS,"invalid channelName in info");if(typeof n.uid!="number")throw new Ce(se.INVALID_PARAMS,"invalid uid in info, uid must be a number");return n.token&&la(n.token,"info.token",1,2047),uP(n.uid),dP(n.channelName),!0}let yc=function(n){return n[n.SetSdkProfile=0]="SetSdkProfile",n[n.SetSourceChannel=1]="SetSourceChannel",n[n.SetSourceUserId=2]="SetSourceUserId",n[n.SetDestChannel=3]="SetDestChannel",n[n.StartPacketTransfer=4]="StartPacketTransfer",n[n.StopPacketTransfer=5]="StopPacketTransfer",n[n.UpdateDestChannel=6]="UpdateDestChannel",n[n.Reconnect=7]="Reconnect",n[n.SetVideoProfile=8]="SetVideoProfile",n}({}),pm=function(n){return n.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",n.NETWORK_CONNECTED="NETWORK_CONNECTED",n.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",n.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",n.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",n.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",n.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",n.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",n.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",n.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",n}({}),qc=function(n){return n.RELAY_STATE_IDLE="RELAY_STATE_IDLE",n.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",n.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",n.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",n}({}),Px=function(n){return n.RELAY_OK="RELAY_OK",n.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",n.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",n.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",n}({}),hr=function(n){return n.High="high",n.Low="low",n.Audio="audio",n.Screen="screen",n.ScreenLow="screen_low",n}({}),Mi=function(n){return n.DISCONNECT="disconnect",n.CONNECTION_STATE_CHANGE="connection-state-change",n.NETWORK_QUALITY="network-quality",n.STREAM_TYPE_CHANGE="stream-type-change",n.IS_P2P_DISCONNECTED="is-p2p-dis",n.DISCONNECT_P2P="dis-p2p",n.REQUEST_NEW_GATEWAY_LIST="req-gate-url",n.NEED_RENEW_SESSION="need-sid",n.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",n.JOIN_RESPONSE="join-response",n.RESET_CONNECTION_EVENTS="reset-connection-events",n.PRE_CONNECT_PC="pre-connect_pc",n.UPDATE_GATEWAY_CONFIG="update-gateway-config",n.VOS_FALLBACK="vos-fallback",n.VOS_FALLBACK_PROMISE="vos-fallback-promise",n.RESET_SIGNAL="reset-signal",n.DATACHANNEL_FAILBACK="datachannel-failback",n}({}),hP=function(n){return n.P2P_DISCONNECTED="P2P_DISCONNECTED",n.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",n.TIMEOUT="TIMEOUT",n.UNKNOWN_REASON="UNKNOWN_REASON",n}({}),Ps=function(n){return n[n.Nothing=0]="Nothing",n[n.Audio=1]="Audio",n[n.LwoVideo=2]="LwoVideo",n[n.Video=4]="Video",n[n.Data=8]="Data",n[n.DataStream0=256]="DataStream0",n[n.DataStream1=512]="DataStream1",n[n.DataStream2=1024]="DataStream2",n[n.DataStream3=2048]="DataStream3",n[n.DataStream4=4096]="DataStream4",n[n.DataStream5=8192]="DataStream5",n[n.DataStream6=16384]="DataStream6",n[n.DataStream7=32768]="DataStream7",n}({}),er=function(n){return n.CHINA="CHINA",n.ASIA="ASIA",n.NORTH_AMERICA="NORTH_AMERICA",n.EUROPE="EUROPE",n.JAPAN="JAPAN",n.INDIA="INDIA",n.KOREA="KOREA",n.HKMC="HKMC",n.US="US",n.OCEANIA="OCEANIA",n.SOUTH_AMERICA="SOUTH_AMERICA",n.AFRICA="AFRICA",n.OVERSEA="OVERSEA",n.GLOBAL="GLOBAL",n.EXTENSIONS="EXTENSIONS",n}({});const YX=[er.AFRICA,er.ASIA,er.CHINA,er.EUROPE,er.GLOBAL,er.INDIA,er.JAPAN,er.NORTH_AMERICA,er.OCEANIA,er.OVERSEA,er.SOUTH_AMERICA];let Oa=function(n){return n.CHINA="CN",n.ASIA="AS",n.NORTH_AMERICA="NA",n.EUROPE="EU",n.JAPAN="JP",n.INDIA="IN",n.KOREA="KR",n.HKMC="HK",n.US="US",n.OCEANIA="OC",n.SOUTH_AMERICA="SA",n.AFRICA="AF",n.OVERSEA="OVERSEA",n.GLOBAL="GLOBAL",n.EXTENSIONS="GLOBAL",n}({});const pP={CHINA:{},ASIA:{CODE:Oa.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Oa.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Oa.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Oa.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Oa.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Oa.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Oa.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Oa.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Oa.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Oa.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Oa.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Oa.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Oa.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};t4&&(pP.CHINA={CODE:Oa.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let jh=function(n){return n.UPDATE_BITRATE_LIMIT="update_bitrate_limit",n.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",n.UPDATE_REMOTE_VIDEO_STREAM_TYPE="update_remote_video_stream_type",n.FALLBACK_TO_HLS="fallback_to_hls",n.UPDATE_VOS_CONFIGURE="update_vos_configure",n}({});function $X(n){return!!n&&!(!n.uplink||!n.id)&&n.uplink.max_bitrate!==void 0&&n.uplink.min_bitrate!==void 0}class XX extends ai{constructor(i,s){super(),Y(this,"onICEConnectionStateChange",void 0),Y(this,"onConnectionStateChange",void 0),Y(this,"onDTLSTransportStateChange",void 0),Y(this,"onDTLSTransportError",void 0),Y(this,"onICETransportStateChange",void 0),Y(this,"onFirstAudioReceived",void 0),Y(this,"onFirstVideoReceived",void 0),Y(this,"onFirstAudioDecoded",void 0),Y(this,"onFirstVideoDecoded",void 0),Y(this,"onFirstVideoRender",void 0),Y(this,"onFirstVideoBufferReady",void 0),Y(this,"onFirstVideoDecodedTimeout",void 0),Y(this,"onSelectedLocalCandidateChanged",void 0),Y(this,"onSelectedRemoteCandidateChanged",void 0),Y(this,"onICECandidateError",void 0),Y(this,"getLocalVideoStats",void 0)}}class fP extends XX{constructor(i,s){super(i,s),Y(this,"establishPromise",void 0)}}let pt=function(n){return n.VIDEO="video",n.AUDIO="audio",n}({}),Ys=function(n){return n.UDP_RELAY="udp_relay",n.UDP_TCP_RELAY="udp_tcp_relay",n.TCP_RELAY="tcp_relay",n.RELAY="relay",n}({}),fm=function(n){return n[n.FIRST_CONNECTION=0]="FIRST_CONNECTION",n[n.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",n[n.RELAY_RESTART=2]="RELAY_RESTART",n[n.TCP_RESTART=3]="TCP_RESTART",n[n.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",n[n.OLD_RESTART=11]="OLD_RESTART",n[n.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",n}({});const JX=["disconnected","failed"];let qe=function(n){return n.LocalVideoTrack="videoTrack",n.LocalAudioTrack="audioTrack",n.LocalVideoLowTrack="videoLowTrack",n}({}),rr=function(n){return n.New="new",n.Connected="connected",n.Reconnecting="reconnecting",n.Disconnected="disconnected",n}({}),Dt=function(n){return n.AudioMetadata="audioMetadata",n.AudioPts="audioPts",n.StateChange="stateChange",n.IceConnectionStateChange="iceConnectionStateChange",n.RequestMuteLocal="requestMuteLocal",n.RequestUnmuteLocal="requestUnmuteLocal",n.RequestRePublish="requestRePublish",n.RequestRePublishDataChannel="requestRePublishDataChannel",n.RequestReSubscribe="requestReSubscribe",n.RequestUploadStats="requestUploadStats",n.RequestUpload="requestUpload",n.MediaReconnectStart="MediaReconnectStart",n.MediaReconnectEnd="MediaReconnectEnd",n.NeedSignalRTT="NeedSignalRTT",n.RequestRestartICE="RequestRestartIce",n.PeerConnectionStateChange="PeerConnectionStateChange",n.RequestReconnect="RequestReconnect",n.RequestReconnectPC="RequestReconnectPC",n.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",n.P2PLost="P2PLost",n.UpdateVideoEncoder="UpdateVideoEncoder",n.ConnectionTypeChange="ConnectionTypeChange",n.RequestLowStreamParameter="RequestLowStreamParameter",n.QueryClientConnectionState="QueryClientConnectionState",n.LocalCandidate="LocalCandidate",n.RequestP2PMuteLocal="requestP2PMuteLocal",n.RequestP2PUnPublish="RequestP2PUnPublish",n.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",n.RequestP2PMuteRemote="RequestP2PMuteRemote",n.RequestP2PRestartICE="RequestP2PRestartICE",n.FirstVideoPreRender="FirstVideoPreRender",n.FirstVideoBufferReady="FirstVideoBufferReady",n}({}),Mu=function(n){return n.CONNECTING="CONNECTING",n.RECONNECTING="RECONNECTING",n.CONNECTED="CONNECTED",n.CLOSED="CLOSED",n}({}),Uu=function(n){return n[n.CONNECT_AP=0]="CONNECT_AP",n[n.AP_CONNECTED=1]="AP_CONNECTED",n[n.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",n[n.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",n[n.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",n[n.CONNECT_WORKER=5]="CONNECT_WORKER",n[n.WORKER_CONNECTED=6]="WORKER_CONNECTED",n[n.CLOSED=7]="CLOSED",n}({}),$s=function(n){return n.CONNECTION_STATE_CHANGE="connection-state-change",n.STATE_CHANGE="state-change",n.INSPECT_RESULT="inspect-result",n.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",n.REQUEST_NEW_WORKER_URL="request-new-worker-url",n}({}),Yg=function(n){return n.NETWORK_ERROR="NETWORK_ERROR",n.SERVER_ERROR="SERVER_ERROR",n.MULTI_IP="MULTI_IP",n.TIMEOUT="TIMEOUT",n.OFFLINE="OFFLINE",n.LEAVE="LEAVE",n.P2P_FAILED="P2P_FAILED",n.FALLBACK="FALLBACK",n}({}),ys=function(n){return n.CONNECTED="transmitter:connected",n.RECONNECTING="transmitter:reconnecting",n.WILL_RECONNECT="transmitter:will_reconnect",n.CLOSED="transmitter:closed",n.FAILED="transmitter:failed",n.ON_MESSAGE="transmitter:on_message",n.REQUEST_NEW_URLS="transmitter:request_new_urls",n.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",n.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",n.FAILBACK="transmitter:failback",n.PRE_CONNECT_PC="transmitter:pre_connect_pc",n}({}),tf=function(n){return n.CAMERA_CHANGED="camera-changed",n.MICROPHONE_CHANGED="microphone-changed",n.PLAYBACK_DEVICE_CHANGED="playback-device-changed",n.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",n.AUTOPLAY_FAILED="autoplay-failed",n.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",n.SECURITY_POLICY_VIOLATION="security-policy-violation",n}({}),Md=function(n){return n.CONNECTING="CONNECTING",n.RECONNECTING="RECONNECTING",n.CONNECTED="CONNECTED",n.CLOSED="CLOSED",n}({}),Mh=function(n){return n.CONNECTION_STATE_CHANGE="connection-state-change",n.STATE_CHANGE="state-change",n.INSPECT_RESULT="inspect-result",n.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",n.REQUEST_NEW_WORKER_URL="request-new-worker-url",n}({}),Dx=function(n){return n[n.CONNECT_AP=0]="CONNECT_AP",n[n.AP_CONNECTED=1]="AP_CONNECTED",n[n.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",n[n.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",n[n.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",n[n.CONNECT_WORKER=5]="CONNECT_WORKER",n[n.WORKER_CONNECTED=6]="WORKER_CONNECTED",n[n.CLOSED=7]="CLOSED",n}({}),Ui=function(n){return n.CALL="call",n.CANDIDATE="candidate",n.PUBLISH="publish",n.UNPUBLISH="unpublish",n.CONTROL="control",n.RESTART_ICE="restart_ice",n.ACK="ack",n.RESPONSE="response",n.JOIN="join",n.CHECK="check",n}({}),Ox=function(n){return n.ABORT="abort",n}({}),$g=function(n){return n.MUTE_LOCAL_AUDIO="mute_local_audio",n.MUTE_LOCAL_VIDEO="mute_local_video",n.UNMUTE_LOCAL_AUDIO="unmute_local_audio",n.UNMUTE_LOCAL_VIDEO="unmute_local_video",n}({}),Obe=function(n){return n.P2P_TOKEN_TIMEOUT="p2p_token_timeout",n.P2P_TOKEN_CHANGED="p2p_token_changed",n}({});const Lbe={[lP.ACCESS_POINT]:{[Vo.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Vo.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Vo.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Vo.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Vo.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Vo.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Vo.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Vo.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Vo.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Vo.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Vo.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Vo.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Vo.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Vo.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Vo.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Vo.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Vo.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Vo.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[lP.UNILBS]:{[jd.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[jd.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[jd.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[jd.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[jd.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[jd.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[jd.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[jd.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[jd.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[jd.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[jd.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[jd.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1},[jd.REQ_DOWNGRADE_FALLBACK]:{desc:"request downgrade fallback",retry:!1}},[lP.STRING_UID_ALLOCATOR]:{[j4.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[j4.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[j4.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Lx(n){const i=Lbe[Math.floor(n/1e4)];if(!i)return{desc:"unknown error",retry:!1};const s=i[n%1e4];if(!s){if(Math.floor(n/1e4)===lP.ACCESS_POINT){const o=n%1e4;if(o.toString()[0]==="1")return{desc:n.toString(),retry:!1};if(o.toString()[0]==="2")return{desc:n.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return s}const jbe={[jt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[jt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[jt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[jt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[jt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[jt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[jt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[jt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[jt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[jt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[jt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[jt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[jt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[jt.K_VOS_FALLBACK]:{desc:"K_VOS_FALLBACK",action:"tryNext"},[jt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[jt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[jt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[jt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[jt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[jt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[jt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[jt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[jt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[jt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[jt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[jt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[jt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[jt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[jt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[jt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[jt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[jt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[jt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[jt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[jt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[jt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[jt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[jt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[jt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[jt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[jt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[jt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[jt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[jt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[jt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[jt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[jt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[jt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[jt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[jt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[jt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[jt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[jt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[jt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[jt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[jt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[jt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[jt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[jt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[jt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[jt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[jt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[jt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[jt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[jt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Ry(n){return jbe[n]||{desc:"UNKNOWN_ERROR_".concat(n),action:"failed"}}function QX(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function F4(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?QX(Object(s),!0).forEach(function(o){Y(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):QX(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}function B4(n,i){if(typeof n=="string")return n;const{proxy:s,host:o,port:d}=n;if(i){const h=re("JOIN_GATEWAY_FALLBACK_PORT")||443;return h===443?"wss://".concat(o,"/ws/?p=").concat(Number(d)+150):"wss://".concat(o,":").concat(h,"/ws/?p=").concat(Number(d)+150)}return s?"wss://".concat(s,"/ws/?h=").concat(o,"&p=").concat(d):"wss://".concat(o,":").concat(d)}const Mbe=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Ube=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Vbe=/wss:\/\/(.+):([0-9]+)\/?/,Fbe=/wss:\/\/(.[^\/]+)\/?/;let Bbe=0;class zbe{constructor(i,s){Y(this,"id",0),Y(this,"store",void 0),Y(this,"recordIndex",void 0),Y(this,"websockets",[]),Y(this,"try443PortDuration",2e3),Y(this,"forceCloseWSDuration",5e3),Y(this,"try443PortTimeout",null),Y(this,"forceCloseTimeout",null),Y(this,"isTry443PortFailed",!1),Y(this,"isNormalPortFailed",!1),Y(this,"useDoubleDomain",!1),Y(this,"useProxy",!1),Y(this,"startTime",Date.now()),this.id=++Bbe,this.try443PortDuration=re("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=i||5e3,this.store=s}closeAllWebsockets(){this.websockets.forEach(i=>{i.onopen=null,i.onclose=null,i.onmessage=null,i.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var i;const s=Date.now()-this.startTime;for(var o=arguments.length,d=new Array(o),h=0;h<o;h++)d[h]=arguments[h];M.debug("[choose-best-ws ".concat((i=this.store)===null||i===void 0?void 0:i.clientId," ").concat(this.id,"] ").concat(s,"ms:"),...d)}createWebSocket(i,s,o){this.logger("createWebSocket:",i,{isTry443Port:s,hasTimeoutDetection:o});const d=re("GATEWAY_DOMAINS"),h=Date.now(),f=[],g=d.find(I=>{var D;return Ge(D=i.host).call(D,I)});g||(this.useDoubleDomain=!1);const y=[];if(this.useDoubleDomain)d.forEach(I=>{y.push(B4(F4(F4({},i),{},{host:i.host.replace(g,I)}),s))});else{const I=F4({},i);if(s&&g){const D=d.find($=>$!==g);D&&(I.host=I.host.replace(g,D))}y.push(B4(I,s))}try{y.forEach(I=>{const D=new WebSocket(I);D.binaryType="arraybuffer",f.push(D),this.logger("ws is connecting:",D.url)})}catch(I){if(this.logger("ws create failed"),f.forEach(D=>D.close()),f.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(i,s,o);if(!s&&Number(i.port)!==443)return this.createWebSocket(i,!0,o);throw new Ce(se.WS_ERR,"init websocket failed! Error: ".concat(I.toString()))}const x=$T();this.store&&this.store.recordJoinChannelService({urls:f.map(I=>I.url),service:"gateway"},this.recordIndex),f.forEach(I=>{I.onopen=()=>{this.logger("onopen: ws ".concat(I.url," open cost ").concat(Date.now()-h,"ms")),this.websockets.forEach(D=>{D!==I&&(D.onopen=null,D.onclose=null,D.onmessage=null,D.close(),this.logger("close backup websocket: ".concat(D.url)))}),this.websockets.length=0,x.resolve(I)},I.onclose=D=>{this.logger("onclose: ws ".concat(I.url," closed cost ").concat(Date.now()-h,"ms state: ").concat(I.readyState));const $=f.every(z=>z.readyState===WebSocket.CLOSED||z.readyState===WebSocket.CLOSING);this.logger("".concat(s?"443":"47xx"," websocket closed, all failed: ").concat($)),$&&(s||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(D.reason)),x.reject({code:D.code,reason:hP.A_ROUND_WS_FAILED})):!s&&$&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),N()),s?this.isTry443PortFailed=$:this.isNormalPortFailed=$},I.onmessage=D=>this.logger("".concat(I.url," onmessage: ").concat(D.data))}),this.websockets.push(...f);const b=()=>{this.websockets.forEach(I=>I.readyState!==WebSocket.OPEN&&I.close())},N=()=>{if(x.isResolved)return b();Wn().os===Is.MAC_OS&&Kr()&&b(),this.createWebSocket(i,!0,!0).then(I=>{x.resolve(I)}).catch(I=>{this.isNormalPortFailed&&x.reject(I),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",x.isResolved),this.forceCloseTimeout=null,b()},this.forceCloseWSDuration)};return o||(()=>{if(s||this.useProxy)return this.logger("add 5s timeout at ".concat(s?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,b()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",x.isResolved),this.try443PortTimeout=null,N()},this.try443PortDuration)})(),x.promise}chooseBestWebsocket(i,s,o,d){return this.useDoubleDomain=!!s,typeof i=="string"&&(i=function(h){let f,g,y;return[,f,g,y]=h.match(Mbe)||[],f||([,g,y]=h.match(Ube)||[]),g&&y||([,g,y]=h.match(Vbe)||[]),g&&y||([,g]=h.match(Fbe)||[]),g||M.warning("un-destructible url: ",h),{proxy:f,host:g,port:y||"443"}}(i)),this.recordIndex=d,this.useProxy=!!i.proxy,o&&this.useProxy&&(M.warn("cannot use 443 only when use proxy"),o=!1),this.createWebSocket(i,!!o,!1).finally(()=>this.clearTimeout())}}function ZX(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}class eJ extends ai{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(i){var s;Ge(s=["tryNext","recover"]).call(s,i)&&this.resetReconnectCount(i),this._reconnectMode=i}get state(){return this._state}set state(i){i!==this._state&&(this._state=i,this._state==="reconnecting"?this.emit(an.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(an.CONNECTED):this._state==="closed"?this.emit(an.CLOSED):this._state==="failed"&&this.emit(an.FAILED))}resetReconnectCount(i){M.debug("websocket reset reconnect count, reason: "+i),this.reconnectCount=0}constructor(i,s){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2],d=arguments.length>3&&arguments[3]!==void 0&&arguments[3],h=arguments.length>4&&arguments[4]!==void 0&&arguments[4],f=arguments.length>5?arguments[5]:void 0;super(),Y(this,"_websocketUrl",null),Y(this,"connectionID",0),Y(this,"currentURLIndex",0),Y(this,"urls",[]),Y(this,"_reconnectMode","tryNext"),Y(this,"reconnectReason",void 0),Y(this,"_initMutex",void 0),Y(this,"name",void 0),Y(this,"_state","closed"),Y(this,"reconnectInterrupter",void 0),Y(this,"websocket",void 0),Y(this,"retryConfig",void 0),Y(this,"reconnectCount",0),Y(this,"forceCloseTimeout",5e3),Y(this,"onlineReconnectListener",void 0),Y(this,"useCompress",void 0),Y(this,"tryDoubleDomain",!1),Y(this,"use443PortOnly",!1),Y(this,"wsInflateLength",0),Y(this,"wsDeflateLength",0),Y(this,"closeEstablishingWs",()=>{}),Y(this,"store",void 0),Y(this,"joinGatewayRecordIndex",void 0),this.store=f,this.name=i,this.retryConfig=function(N){for(var I=1;I<arguments.length;I++){var D=arguments[I]!=null?arguments[I]:{};I%2?ZX(Object(D),!0).forEach(function($){Y(N,$,D[$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(D)):ZX(Object(D)).forEach(function($){Object.defineProperty(N,$,Object.getOwnPropertyDescriptor(D,$))})}return N}({},s),this.useCompress=o,this.tryDoubleDomain=d,this.use443PortOnly=h,this._initMutex=new qs("websocket",f?f.clientId:void 0);const{timeout:g,timeoutFactor:y}=s,x=Math.max(300,Math.floor(3*g/5)),b=Math.max(1.2,Math.floor(8*y)/10);jo.ONLINE&&(this.retryConfig.timeout=x,this.retryConfig.timeoutFactor=b),wi.on(dy.NETWORK_STATE_CHANGE,(N,I)=>{N!==I&&(this.resetReconnectCount("network state change: ".concat(I," -> ").concat(N)),N===jo.ONLINE?(this.retryConfig.timeout=x,this.retryConfig.timeoutFactor=b):(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=y))})}getConnection(){return this.websocket||void 0}async init(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const o=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=s,this.urls=i,this.state="connecting";try{var d;const h=$T(),f=this.urls[this.currentURLIndex];(d=this.store)===null||d===void 0||d.beforeConnect(),function(g){return!(Kk()||re("USE_NEW_TOKEN")||!re("ENABLE_PREALLOC_PC")&&(g==null||!g.autoSubscribe||re("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(ys.PRE_CONNECT_PC),this.createWebSocketConnection(f).then(h.resolve).catch(h.reject),this.once(an.CLOSED,()=>{h.reject(new Pe(se.WS_DISCONNECT))}),this.once(an.CONNECTED,h.resolve),await h.promise}catch{}finally{o()}}close(i,s){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const o=this.websocket;s?setTimeout(()=>o.close(),500):o.close(),this.websocket=void 0,this._websocketUrl=null}this.state=i?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(i,s){if(!this.websocket)return void M.warning("[".concat(this.name,"] can not reconnect, no websocket"));i!==void 0&&(this.reconnectMode=i),M.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(s)]},this.joinGatewayRecordIndex);const o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:s})}sendMessage(i){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Pe(se.WS_ABORT,"websocket is not ready");try{s||(i=JSON.stringify(i)),this.websocket.send(i)}catch(o){throw new Pe(se.WS_ERR,"send websocket message error"+o.toString())}}setWsInflateData(i){this.wsDeflateLength=this.wsDeflateLength+i.originLength,this.wsInflateLength=this.wsInflateLength+i.compressedLength}getWsInflateData(){const i=this.wsInflateLength,s=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:i,wsDeflateLength:s}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(i){var s;const o=$T();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const d=b=>{var N;(N=this.store)===null||N===void 0||N.signalChannelOpen(),M.debug("[".concat(this.name,"] websocket opened:"),b),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),o.resolve()},h=async b=>{var N;if(M.debug("[".concat(this.name,"] websocket close ").concat((N=this.websocket)===null||N===void 0?void 0:N.url,", code: ").concat(b.code,", reason: ").concat(b.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)o.reject(new Pe(se.WS_DISCONNECT,"websocket close: ".concat(b.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=b.reason,this.state="reconnecting");const I=El(this,an.WILL_RECONNECT,this.reconnectMode,b.reason)||this.reconnectMode,D=await this.reconnectWithAction(I);if(this.state==="closed")return void M.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!D)return o.reject(new Pe(se.WS_DISCONNECT,"websocket reconnect failed: ".concat(b.code))),this.close(!0);o.resolve()}},f=b=>{this.emit(an.ON_MESSAGE,b)},g=b=>{M.warn("[".concat(this.connectionID,"] ws open error ").concat(b))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),re("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(i=re("GATEWAY_WSS_ADDRESS")),M.debug("[".concat(this.name,"] start connect, url:"),i);const y=(s=this.store)===null||s===void 0?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var x;this._websocketUrl=B4(i);const b=await this.chooseBestWebsocketConnection(i);this.websocket=b,d&&d(this.websocket.url),this.websocket.onclose=h,this.websocket.onmessage=f,this.websocket.onerror=g,(x=this.store)===null||x===void 0||x.recordJoinChannelService({endTs:Date.now(),status:"success"},y),this.joinGatewayRecordIndex=y}catch(b){const N=this.state==="closed",I=b instanceof Pe,D=I&&b.code===se.WS_ABORT,$=I&&b.code===se.WS_ERR,z=I?b.message:b&&(b.reason||b.toString());M.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(z)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:D?"aborted":"error",errors:[b]},y),N||$?(o.reject(N?new Pe(se.WS_DISCONNECT,"websocket is closed: ".concat(z)):new Pe(se.WS_ERR,"init websocket failed: ".concat(z))),$&&M.error("[".concat(this.name,"] init websocket failed: ").concat(z))):h&&h(b)}return o.promise}async reconnectWithAction(i){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;M.warning("[choose-best-ws] action: =>",i),this.onlineReconnectListener||wi.isOnline||!wi.onlineWaiter||(this.onlineReconnectListener=wi.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let o=!0;if(this.reconnectInterrupter=()=>o=!1,s){const f=Uk(this.reconnectCount,this.retryConfig);M.debug("[".concat(this.name,"] wait ").concat(f,"ms to reconnect websocket, mode: ").concat(i)),await et.race([As(f),this.onlineReconnectListener||new et(()=>{})])}if(this._state==="closed"||!o)return!1;this.reconnectCount+=1;const d=async(f,g)=>{this.emit(an.RECONNECT_CREATE_CONNECTION,g),await this.createWebSocketConnection(f)};try{if(i==="retry")await d(this.urls[this.currentURLIndex],i);else if(i==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);M.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await d(this.urls[this.currentURLIndex],i)}else i==="recover"&&(M.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await rs(this,an.REQUEST_NEW_URLS),this.currentURLIndex=0,await d(this.urls[this.currentURLIndex],i))}catch(f){var h;M.error("[".concat(this.name,"] reconnect failed ").concat(f&&f.toString()));const g=f==null||(h=f.data)===null||h===void 0?void 0:h.desc;if(Array.isArray(g)){if(Ge(g).call(g,"dynamic key expired"))return this.emit(an.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1;if(Ge(g).call(g,"request downgrade fallback"))return this.emit(an.ON_FALLBACK),!1}return this.reconnectWithAction(i,s)}return!0}}class z4 extends eJ{constructor(i,s){super(i,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(i,s){const o=$T(),d=function(f,g){return new zbe(f,g)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{M.debug("[choose-best-ws] close establishing websockets"),d.closeAllWebsockets(),o.reject(new Pe(se.WS_ABORT,"choose best websocket aborted"))};const h=re("GATEWAY_DOMAINS");return M.debug("[choose-best-ws] currentDomain: ",i,", domains: ",h,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),d.chooseBestWebsocket(i,this.tryDoubleDomain,this.use443PortOnly,s).then(o.resolve).catch(o.reject),o.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class cR extends eJ{constructor(i,s){super(i,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(i,s){return new et((o,d)=>{let h=!1;const f=[];this.closeEstablishingWs=()=>{M.debug("[choose-best-ws] close establishing websockets"),f.forEach($=>{$.onclose=null,$.onopen=null,$.onmessage=null,$.close()}),d(new Pe(se.WS_ABORT,"choose best websocket aborted"))};const g=re("GATEWAY_DOMAINS");let y;const x=i.indexOf("?h="),b=g.find($=>x!==-1?Ge(i).call(i,$,x):Ge(i).call(i,$));M.debug("[choose-best-ws] currentDomain: ",b,", domains: ",g);let N=!this.tryDoubleDomain||!b;if(!N&&b){var I;const $=Date.now();try{g.forEach(z=>{const K=x===-1?i.replace(b,z):i.substr(0,x)+i.substr(x).replace(b,z),ie=new WebSocket(K);ie.binaryType="arraybuffer",f.push(ie),M.debug("[choose-best-ws] ws is connecting:",ie.url)})}catch{for(M.debug("[choose-best-ws] ws create failed, fallback to single url"),f.forEach(K=>K.close());f.length;)f.pop();N=!0}(I=this.store)===null||I===void 0||I.recordJoinChannelService({urls:f.map(z=>z.url),service:"gateway"},s),f.forEach(z=>{z.onopen=()=>{if(h)return;const K=Date.now()-$;M.debug("[choose-best-ws] ws open cost ".concat(K,"ms")),f.filter(ie=>ie!==z).forEach(ie=>{M.debug("[choose-best-ws]close backup websocket: ".concat(ie.url)),ie.close()}),h=!0,o(z)},z.onclose=K=>{y=K,!h&&(f.find(ie=>!(ie.readyState===WebSocket.CLOSED||ie.readyState===WebSocket.CLOSING))||(M.debug("[choose-best-ws] all websocket is closed"),h=!0,d(y)))},z.onmessage=K=>{M.debug("[choose-best-ws]".concat(z.url," onmessage: ").concat(K.data))}}),As(this.forceCloseTimeout).then(()=>{f.forEach(z=>{z.readyState!==WebSocket.OPEN&&z.close()})})}if(N){var D;let $;M.debug("[choose-best-ws] use single url: ",i),(D=this.store)===null||D===void 0||D.recordJoinChannelService({urls:[i],service:"gateway"},s);try{$=new WebSocket(i),f.push($),$.binaryType="arraybuffer"}catch(z){const K=new Pe(se.WS_ERR,"init websocket failed! Error: ".concat(z.toString()));return M.error("[".concat(this.name,"]").concat(K)),void d(K)}$.onopen=()=>{o($)},$.onclose=z=>{d(z)},$.onmessage=z=>{M.debug("[choose-best-ws]".concat($.url," onmessage: ").concat(z.data))},As(this.forceCloseTimeout).then(()=>{$&&$.readyState!==WebSocket.OPEN&&$.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class tJ extends ai{get connectionState(){return this._connectionState}set connectionState(i){i!==this._connectionState&&(this._connectionState=i,i===Cn.CONNECTED?this.emit(xt.WS_CONNECTED):i===Cn.RECONNECTING?this.emit(xt.WS_RECONNECTING,this._websocketReconnectReason):i===Cn.CLOSED&&this.emit(xt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(i,s){super(),Y(this,"__name__","AgoraRTCSignal"),Y(this,"_disconnectedReason",void 0),Y(this,"_websocketReconnectReason",void 0),Y(this,"_connectionState",Cn.CLOSED),Y(this,"reconnectToken",void 0),Y(this,"websocket",void 0),Y(this,"openConnectionTime",void 0),Y(this,"clientId",void 0),Y(this,"lastMsgTime",Date.now()),Y(this,"uploadCache",[]),Y(this,"uploadCacheInterval",void 0),Y(this,"rttRolling",new YV(5)),Y(this,"pingpongTimer",void 0),Y(this,"wsInflateDataTimer",void 0),Y(this,"pingpongTimeoutCount",0),Y(this,"ortc",void 0),Y(this,"joinResponse",void 0),Y(this,"multiIpOption",void 0),Y(this,"initError",void 0),Y(this,"spec",void 0),Y(this,"store",void 0),Y(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(xt.ON_BINARY_DATA,o.data);const d=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(d,"_id")){const h="res-@".concat(d._id);this.emit(h,d._result,d._message)}else if(Object.prototype.hasOwnProperty.call(d,"_type")){if(this.emit(d._type,d._message),d._type===Yt.ON_NOTIFICATION&&this.handleNotification(d._message),d._type===Yt.ON_USER_BANNED)switch(d._message.error_code){case 14:this.close(Rn.UID_BANNED);break;case 15:this.close(Rn.IP_BANNED);break;case 16:this.close(Rn.CHANNEL_BANNED)}if(d._type===Yt.ON_USER_LICENSE_BANNED)switch(d._message.error_code){case jt.ERR_LICENSE_MISSING:this.close(Rn.LICENSE_MISSING);break;case jt.ERR_LICENSE_EXPIRED:this.close(Rn.LICENSE_EXPIRED);break;case jt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Rn.LICENSE_MINUTES_EXCEEDED);break;case jt.ERR_LICENSE_PERIOD_INVALID:this.close(Rn.LICENSE_PERIOD_INVALID);break;case jt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Rn.LICENSE_MULTIPLE_SDK_SERVICE);break;case jt.ERR_LICENSE_ILLEGAL:this.close(Rn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=i.clientId,this.spec=i,this.store=s,this.websocket=new z4("gateway-".concat(this.clientId),this.spec.retryConfig,!0,re("JOIN_GATEWAY_USE_DUAL_DOMAIN"),re("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Cn.CONNECTED&&this.reconnect("retry",va.OFFLINE)})}async request(i,s,o,d){const h=dr(6,""),f={_id:h,_type:i,_message:s},g=this.websocket.connectionID,y=()=>new et(($,z)=>{if(this.connectionState===Cn.CONNECTED)return $();const K=()=>{this.off(xt.WS_CLOSED,ie),$()},ie=()=>{this.off(xt.WS_CONNECTED,K),z(new Ce(se.WS_ABORT))};this.once(xt.WS_CONNECTED,K),this.once(xt.WS_CLOSED,ie),i!==kt.PUBLISH&&i!==kt.PUBLISH_DATASTREAM&&i!==kt.SUBSCRIBE&&i!==kt.SUBSCRIBE_DATASTREAM&&i!==kt.UNSUBSCRIBE&&i!==kt.UNSUBSCRIBE_DATASTREAM&&i!==kt.UNPUBLISH&&i!==kt.UNPUBLISH_DATASTREAM&&i!==kt.CONTROL&&i!==kt.RESTART_ICE||this.once(xt.DISCONNECT_P2P,()=>{z(new Ce(se.DISCONNECT_P2P))}),i!==kt.PUBLISH&&i!==kt.RESTART_ICE||this.once(xt.ABORT_P2P_EXECUTION,()=>{z(new Ce(se.DISCONNECT_P2P))})});if(this.connectionState!==Cn.CONNECTING&&this.connectionState!==Cn.RECONNECTING||i===kt.JOIN||i===kt.REJOIN||await y(),this.websocket.sendMessage(f,!0),d)return;const x=new et(($,z)=>{let K=!1;const ie=(fe,Ee)=>{K=!0,$({isSuccess:fe==="success",message:Ee||{}}),this.off(xt.WS_CLOSED,oe),this.off(xt.WS_RECONNECTING,oe),this.emit(xt.REQUEST_SUCCESS,i,s)};this.once("res-@".concat(h),ie);const oe=()=>{z(new Ce(se.WS_ABORT,"type: ".concat(i))),this.off(xt.WS_CLOSED,oe),this.off(xt.WS_RECONNECTING,oe),this.off("res-@".concat(h),ie)};this.once(xt.WS_CLOSED,oe),this.once(xt.WS_RECONNECTING,oe),As(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==g||K||(M.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(i)),this.emit(xt.REQUEST_TIMEOUT,i,s))})});let b=null;try{b=await x}catch($){if(this.connectionState===Cn.CLOSED||i===kt.LEAVE)throw new Ce(se.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?$.throw():i===kt.JOIN||i===kt.REJOIN?null:(await y(),await this.request(i,s))}if(b.isSuccess)return b.message;const N=Number(b.message.error_code||b.message.code),I=Ry(N),D=new Ce(se.UNEXPECTED_RESPONSE,"".concat(I.desc,": ").concat(b.message.error_str),{code:N,data:b.message,desc:I.desc});return I.action==="success"?b.message:(M.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(i,", error_code: ").concat(N,", message: ").concat(I.desc,", action: ").concat(I.action)),N===jt.ERR_TOO_MANY_BROADCASTERS?((i===kt.JOIN||i===kt.REJOIN)&&(this.initError=D,this.close()),D.throw()):I.action==="failed"?D.throw():I.action==="quit"?(this.initError=D,this.close(),D.throw()):(N===jt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=b.message.option,M.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",va.MULTI_IP)):this.reconnect(I.action,va.SERVER_ERROR),i===kt.JOIN||i===kt.REJOIN?null:await this.request(i,s)))}waitMessage(i,s){return new et(o=>{const d=h=>{(!s||s(h))&&(this.off(i,d),o(h))};this.on(i,d)})}uploadWRTCStats(i){if(!this.store.sessionId)return void M.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:i};this.upload(Ty.WRTC_STATS,s)}upload(i,s){const o={_type:i,_message:s};try{this.websocket.sendMessage(o)}catch{const h=re("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>h&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Cn.CONNECTED)return;const f=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(f._type,f._message)},re("UPLOAD_CACHE_INTERVAL")||2e3))}}send(i,s){const o={_type:i,_message:s};this.websocket.sendMessage(o)}init(i){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new et((s,o)=>{this.once(xt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(xt.WS_CLOSED,d=>o(this.initError||new Ce(se.WS_ABORT,d))),this.connectionState=Cn.CONNECTING,this.websocket.init(i).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=i||Rn.LEAVE,this.connectionState=Cn.CLOSED,M.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(xt.ABORT_P2P_EXECUTION),this.store.signalConnected();const i=await rs(this,xt.REQUEST_JOIN_INFO);this.store.joinReq();const s=await this.request(kt.JOIN,i);if(this.ortc=i==null?void 0:i.ortc,this.store.joinRep(),!s)return this.emit(xt.REPORT_JOIN_GATEWAY,hP.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(xt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Cn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Ce(se.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const i=uy(this,xt.REQUEST_REJOIN_INFO);i.token=this.reconnectToken;const s=await this.request(kt.REJOIN,i);return!!s&&(this.connectionState=Cn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),s.peers&&s.peers.forEach(o=>{this.emit(Yt.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(Yt.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(Yt.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(Yt.MUTE_AUDIO,{uid:o.uid}):this.emit(Yt.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(Yt.MUTE_VIDEO,{uid:o.uid}):this.emit(Yt.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(Yt.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(Yt.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(Yt.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(Yt.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(Yt.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(i,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(i,s)}async downgradeCodec(i){if(!this.ortc)return!1;const s={downgrade_codec:i,ortc:this.ortc};return!!await this.request(kt.DOWNGRADE_CODEC,s)}handleNotification(i){M.debug("[".concat(this.clientId,"] receive notification: "),i);const s=Ry(i.code);if(i.code===28&&"detail"in i&&(M.info("[".concat(this.clientId,"] receive recover notification: "),i.detail),this.emit(xt.RECOVER_NOTIFICATION,i.detail)),s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?i.code===jt.ERR_REPEAT_JOIN_CHANNEL&&re("IGNORE_UID_CHECK")?void this.close(Rn.UID_CONFLICT):(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Rn.UID_BANNED),void this.close()):i.code===jt.K_VOS_FALLBACK&&"detail"in i?(M.info("[".concat(this.clientId,"] receive vos fallback notification: "),i.detail),i.detail==="FALLBACKCN"&&re("ENABLE_QUALITY_FALLBACK")?void rs(this,xt.VOS_FALLBACK_PROMISE,i.detail).then(()=>{this.reconnect("recover",s.desc)}).catch(o=>{M.debug("[".concat(this.clientId,"] cancel vos fallback cn, error: "),o)}):i.detail==="fallback_hls"&&re("ENABLE_FALLBACK_TO_HLS")?(this.emit(xt.VOS_FALLBACK,i.detail),void this.close(Rn.FALLBACK_TO_HLS)):this.reconnect(s.action,s.desc)):void this.reconnect(s.action,va.SERVER_ERROR);M.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const i=re("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=i&&(M.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>re("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",va.TIMEOUT):this.request(kt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-s;this.rttRolling.add(o),re("REPORT_STATS")&&this.send(kt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWsInflateData(){const{wsInflateLength:i,wsDeflateLength:s}=this.websocket.getWsInflateData();i!==0&&s!==0&&this.upload(Ty.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:i})}handleWebsocketEvents(){this.websocket.on(an.RECONNECT_CREATE_CONNECTION,i=>{this.emit(xt.WS_RECONNECT_CREATE_CONNECTION,i)}),this.websocket.on(an.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(an.CLOSED,()=>{this.connectionState=Cn.CLOSED}),this.websocket.on(an.FAILED,()=>{this._disconnectedReason=Rn.NETWORK_ERROR,this.connectionState=Cn.CLOSED}),this.websocket.on(an.RECONNECTING,i=>{this._websocketReconnectReason=i,this.joinResponse=void 0,this.connectionState===Cn.CONNECTED?this.connectionState=Cn.RECONNECTING:this.connectionState=Cn.CONNECTING}),this.websocket.on(an.WILL_RECONNECT,(i,s,o)=>{const d=uy(this,xt.IS_P2P_DISCONNECTED),h=d||i!=="retry";d&&i==="retry"&&(M.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),i="tryNext",s=hP.P2P_DISCONNECTED),h&&(M.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(i)),this.emit(xt.REPORT_JOIN_GATEWAY,s||hP.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(xt.DISCONNECT_P2P)),o(i)}),this.websocket.on(an.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(i=>{M.warning("[".concat(this.clientId,"] rejoin failed ").concat(i)),this.reconnect("tryNext",va.SERVER_ERROR)}):this.join().catch(i=>{if(this.emit(xt.REPORT_JOIN_GATEWAY,i,this.url||""),i instanceof Ce){if(i.code===se.UNEXPECTED_RESPONSE&&i.data.code===jt.ERR_NO_AUTHORIZED)return this.initError=new Ce(se.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Rn.TOKEN_EXPIRE);M.error("[".concat(this.clientId,"] join gateway request failed"),i.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",va.SERVER_ERROR):(this.initError=i,this.close())}})}),this.websocket.on(an.REQUEST_NEW_URLS,(i,s)=>{rs(this,xt.REQUEST_RECOVER,this.multiIpOption).then(i).catch(s)}),this.websocket.on(an.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Yt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(ys.PRE_CONNECT_PC,()=>{this.emit(xt.PRE_CONNECT_PC)}),this.websocket.on(an.ON_FALLBACK,()=>{re("ENABLE_FALLBACK_TO_HLS")&&this.emit(xt.VOS_FALLBACK,"fallback_hls")})}}let Gbe=function(n){return n.NATIVE_RTC="native_rtc",n.NATIVE_RTM="native_rtm",n.WEB_RTC="web_rtc",n.WEB_RTM="web_rtm",n}({}),Wi=function(n){return n[n.CHOOSE_SERVER=11]="CHOOSE_SERVER",n[n.CLOUD_PROXY=18]="CLOUD_PROXY",n[n.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",n[n.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",n}({});function nJ(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function mP(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?nJ(Object(s),!0).forEach(function(o){Y(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):nJ(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}let G4=0;function Vu(n){const i=re("TURN_DOMAINS");G4=(G4+1)%i.length;const s=i[G4]||"edge.agora.io";return n.match(/^[\.\:\d]+$/)?"".concat(n.replace(/[^\d]/g,"-"),".").concat(s):(M.debug("Cannot recognized as ip address: ".concat(n,", use as host2")),n)}function gP(n){try{const i=re("TURN_DOMAINS"),s=re("GATEWAY_DOMAINS").concat(i).find(o=>Ge(n).call(n,o));return s?n.split(".".concat(s))[0].replace(/-/g,"."):n}catch{return M.debug("serverUrlToIp error, fallback to url",n),n}}function W4(n,i){n.addresses||(n.addresses=[]);const s=function(g,y){if(re("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return g.map(N=>{let{ip:I,port:D}=N;return{address:"".concat(I,":").concat(D)}});const x=re("GATEWAY_DOMAINS");let b=x[1]&&Ge(y).call(y,x[1])?1:0;return g.map(N=>{let{domain_prefix:I,port:D,ip:$}=N;if(I)return{address:"".concat(I,".").concat(x[b++%x.length],":").concat(D)};const z=/^[\.\:\d]+$/.test($),K=z?"".concat($.replace(/[^\d]/g,"-"),".").concat(x[b++%x.length],":").concat(D):"".concat($,":").concat(D);return z||M.debug("Cannot recognized as ip address: ".concat($,", use as host3")),{ip:$,port:D,address:K}})}(n.addresses,i),o=Array.isArray(n.detail)&&n.detail[18];if(o&&typeof o=="string"){const g=o.split(";");for(let y=0;y<g.length;y++){var d;const x=Oo(d=g[y]).call(d);s[y]&&x&&(s[y].ip6=x)}}const h=n.detail&&n.detail.candidate;let f;if(h){const[g,y]=h.split(":");g&&y&&(f={port:Number(y),ip:g,address:"".concat(g,":").concat(y)})}return{gatewayAddrs:s,apGatewayAddress:f,uid:n.uid,cid:n.cid,cert:n.cert,vid:n.detail&&n.detail[8],uni_lbs_ip:n.detail&&n.detail[1],res:n,csIp:n.detail&&n.detail[502]}}function vc(n){return typeof n=="number"?n:n.exact||n.ideal||n.max||n.min||0}function rJ(n){const i=n._encoderConfig;if(!i)return{};const s={resolution:i.width&&i.height?"".concat(vc(i.width),"x").concat(vc(i.height)):void 0,maxVideoBW:i.bitrateMax,minVideoBW:i.bitrateMin};return typeof i.frameRate=="number"?(s.maxFrameRate=i.frameRate,s.minFrameRate=i.frameRate):i.frameRate&&(s.maxFrameRate=i.frameRate.max||i.frameRate.ideal||i.frameRate.exact||i.frameRate.min,s.minFrameRate=i.frameRate.min||i.frameRate.ideal||i.frameRate.exact||i.frameRate.max),s}function _P(n){return n>=0&&n<.17?1:n>=.17&&n<.36?2:n>=.36&&n<.59?3:n>=.59&&n<=1?4:n>1?5:0}function lR(n,i){let s,o,d;switch(i){case Wi.CHOOSE_SERVER:o=4096,d="choose server";break;case Wi.CLOUD_PROXY:o=1048576,d="proxy";break;case Wi.CLOUD_PROXY_5:o=4194304,d="proxy5";break;case Wi.CLOUD_PROXY_FALLBACK:o=4194310,d="proxy fallback";break;default:throw new Ce(se.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:n.detail&&n.detail[502],retry:!1})}if(n.response_body.forEach(h=>{h.buffer&&h.buffer.flag===o&&(s={code:h.buffer.code,addresses:(h.buffer.edges_services||[]).map(f=>mP(mP({},f),{},{ticket:h.buffer.cert})),server_ts:n.enter_ts,uid:h.buffer.uid,cid:h.buffer.cid,cname:h.buffer.cname,detail:mP(mP({},h.buffer.detail),n.detail),flag:h.buffer.flag,opid:n.opid,cert:h.buffer.cert})}),!s)throw new Ce(se.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(d," from multi unilbs response"),{csIp:n.detail&&n.detail[502]});return s}async function iJ(n,i){return await et.all(n.addresses.map(async s=>({address:Vu(s.ip),tcpport:s.port,udpport:s.port,username:i&&re("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?i.toString():Ea.username,password:i&&re("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await BV(i.toString()):Ea.password})))}function H4(n,i){const s=i.getMediaStreamTrack(!0).getSettings(),o=i.videoHeight||s.height,d=i.videoWidth||s.width;return o&&d?Math.max(Math.min(o,d)/Math.min(vc(n.height),vc(n.width)),1):(M.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Xg(n){let{candidateType:i,relayProtocol:s,type:o,address:d,port:h,protocol:f}=n;const g={candidateType:i,relayProtocol:s,protocol:f};if(o!=="local-candidate"){const y=d.split(".");y.length>=4&&(y[1]="*",y[2]="*"),g.address=y.join("."),g.port=h}return g}function nf(n){const i=n.split(":"),s=n.split(/[-.]/),o=Ge(n).call(n,"-")?"-":".";let d=n;return i.length>1?s.length>1?(s[1]="**",d=s[0]+o+"**:"+i[i.length-1]):d=i.length>2?i[0]+o+"**:"+i[i.length-1]:"**:"+i[i.length-1]:s.length>1&&(d=s[0]+o+"**"),d}function sJ(n,i){return n.getTransceivers().find(s=>s.sender.track===i||s.receiver.track===i)}function dR(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:re("SVC_MODE");if(re("ENABLE_SVC"))return function(i){return i in Bk}(n)?n:Bk.L1T3}const aJ={[pt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[pt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function oJ(n){n.send&&(jx(pt.VIDEO,n.send.videoExtensions),jx(pt.AUDIO,n.send.audioExtensions)),n.recv&&(jx(pt.VIDEO,n.recv.videoExtensions),jx(pt.AUDIO,n.recv.audioExtensions)),n.sendrecv&&(jx(pt.VIDEO,n.sendrecv.videoExtensions),jx(pt.AUDIO,n.sendrecv.audioExtensions))}function cJ(n,i){n.send&&(yP(pt.VIDEO,n.send.videoExtensions,i.send.videoExtensions),yP(pt.AUDIO,n.send.audioExtensions,i.send.audioExtensions)),n.recv&&(yP(pt.VIDEO,n.recv.videoExtensions,i.recv.videoExtensions),yP(pt.AUDIO,n.recv.audioExtensions,i.recv.audioExtensions))}function yP(n,i,s){i.forEach(o=>{var d;const h=aJ[n].find(g=>{var y;let{key:x}=g;return Ge(y=o.extensionName).call(y,x)});if(!h)return;const f=s.find(g=>{let{extensionName:y}=g;return Ge(y).call(y,h.key)});f&&Ge(d=f.extensionName).call(d,"gdpr_forbidden")&&(o.extensionName=f.extensionName)})}function jx(n,i){i.forEach(s=>{var o;const d=aJ[n].find(h=>{var f;let{key:g}=h;return Ge(f=s.extensionName).call(f,g)});Ge(o=s.extensionName).call(o,"gdpr_forbidden")&&d&&(s.extensionName=d.extensionName)})}function lJ(n){return n==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||Ge(n).call(n,"abs-send-time")}function vP(n){return n==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||Ge(n).call(n,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function dJ(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function uJ(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?dJ(Object(s),!0).forEach(function(o){Y(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):dJ(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}function uR(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0;const{filterRTX:d,filterVideoFec:h,filterAudioFec:f,filterAudioCodec:g,filterVideoCodec:y,unsupportedVideoUplinkCodec:x,unsupportedVideoDownlinkCodec:b}=i,{useXR:N}=s;let I=[],D=[],$=[],z=[],K=!1,ie=!1;if(Mo(n).mediaDescriptions.forEach(fe=>{o&&o!==fe.attributes.direction||(fe.media.mediaType!=="video"||K||(D=fe.attributes.payloads,z=fe.attributes.extmaps,K=!0),fe.media.mediaType!=="audio"||ie||(I=fe.attributes.payloads,$=fe.attributes.extmaps,ie=!0))}),!z||D.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!$||I.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(D.forEach(fe=>{var Ee;(Ee=fe.rtpMap)!==null&&Ee!==void 0&&Ee.clockRate&&(fe.rtpMap.clockRate=parseInt(fe.rtpMap.clockRate)),N&&fe.rtcpFeedbacks.push({type:"rrtr"})}),I.forEach(fe=>{var Ee;(Ee=fe.rtpMap)!==null&&Ee!==void 0&&Ee.clockRate&&(fe.rtpMap.clockRate=parseInt(fe.rtpMap.clockRate)),N&&fe.rtcpFeedbacks.push({type:"rrtr"})}),d&&(I=I.filter(fe=>{var Ee;return((Ee=fe.rtpMap)===null||Ee===void 0?void 0:Ee.encodingName.toLowerCase())!=="rtx"}),D=D.filter(fe=>{var Ee;return((Ee=fe.rtpMap)===null||Ee===void 0?void 0:Ee.encodingName.toLowerCase())!=="rtx"})),h){const fe=D.filter(_e=>{var Re;return/(red)|(ulpfec)|(flexfec)/i.test(((Re=_e.rtpMap)===null||Re===void 0?void 0:Re.encodingName)||"")}),Ee=Jg(fe,D).map(_e=>_e.payloadType),Te=[...fe.map(_e=>_e.payloadType),...Ee];D=D.filter(_e=>!Ge(Te).call(Te,_e.payloadType))}if(f&&(I=I.filter(fe=>{var Ee;return!/(red)|(ulpfec)|(flexfec)/i.test(((Ee=fe.rtpMap)===null||Ee===void 0?void 0:Ee.encodingName)||"")})),g&&(g==null?void 0:g.length)>0&&(I=I.filter(fe=>{var Ee;return Ge(g).call(g,((Ee=fe.rtpMap)===null||Ee===void 0?void 0:Ee.encodingName.toLowerCase())||"")})),y&&(y==null?void 0:y.length)>0){const fe=D.filter(Ee=>{var Te;return Ge(y).call(y,((Te=Ee.rtpMap)===null||Te===void 0?void 0:Te.encodingName.toLowerCase())||"")});D=fe.concat(d?[]:Jg(fe,D))}const oe=re("UNSUPPORTED_VIDEO_CODEC");if(oe&&oe.length>0){const fe=D.filter(_e=>_e.rtpMap&&Ge(oe).call(oe,_e.rtpMap.encodingName.toLowerCase())),Ee=Jg(fe,D),Te=fe.concat(Ee).map(_e=>_e.payloadType);D=D.filter(_e=>!Ge(Te).call(Te,_e.payloadType)),M.debug("unsupportedVideoCodec: ".concat(oe,", toBeRemoved: ").concat(Te))}if(x&&x.length>0&&o==="sendonly"){const fe=D.filter(_e=>_e.rtpMap&&Ge(x).call(x,_e.rtpMap.encodingName.toLowerCase())),Ee=Jg(fe,D),Te=fe.concat(Ee).map(_e=>_e.payloadType);D=D.filter(_e=>!Ge(Te).call(Te,_e.payloadType)),M.debug("unsupportedVideoUplinkCodec: ".concat(x,", toBeRemoved: ").concat(Te))}if(b&&b.length>0&&o==="recvonly"){const fe=D.filter(_e=>_e.rtpMap&&Ge(b).call(b,_e.rtpMap.encodingName.toLowerCase())),Ee=Jg(fe,D),Te=fe.concat(Ee).map(_e=>_e.payloadType);D=D.filter(_e=>!Ge(Te).call(Te,_e.payloadType)),M.debug("unsupportedVideoDownlinkCodec: ".concat(b,", toBeRemoved: ").concat(Te))}return{audioCodecs:I,videoCodecs:D,audioExtensions:$,videoExtensions:z}}function rf(n){const i=Mo(n);let s,o;for(const d of i.mediaDescriptions){if(!s){const h=d.attributes.iceUfrag,f=d.attributes.icePwd;if(!h||!f)throw new Error("Cannot get iceUfrag or icePwd from SDP.");s={iceUfrag:h,icePwd:f}}if(!o){const h=d.attributes.fingerprints;h.length>0&&(o={fingerprints:h})}}if(!o&&i.attributes.fingerprints.length>0&&(o={fingerprints:i.attributes.fingerprints}),!o||!s)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:s,dtlsParameters:o}}function K4(n,i){const s=[],o=n.attributes.ssrcGroups.filter(f=>f.semantic==="FID"),d=n.attributes.ssrcGroups.find(f=>f.semantic==="SIM"),h=n.attributes.ssrcs;if(d)d.ssrcIds.forEach(f=>{var g;const y=(g=o.find(x=>x.ssrcIds[0]===f))===null||g===void 0?void 0:g.ssrcIds[1];s.push({ssrcId:f,rtx:i?y:void 0})});else if(o.length>0){const f=o[0].ssrcIds[0],g=o[0].ssrcIds[1];s.push({ssrcId:f,rtx:i?g:void 0})}else{if(h.length===0)throw new Error("No ssrcs found on local media description.");s.push({ssrcId:h[0].ssrcId})}return s}function hJ(n,i,s){const{cname:o}=n;let d=[];i&&(d=pJ(i)),d.length===0&&(d=n.iceParameters.candidates.map(b=>({foundation:b.foundation,componentId:"1",transport:b.protocol,priority:b.priority.toString(),connectionAddress:b.ip,port:b.port.toString(),type:b.type,extension:{}})),M.debug("Using candidates from gateway."));const h={fingerprints:n.dtlsParameters.fingerprints.map(b=>({hashFunction:b.algorithm,fingerprint:b.fingerprint}))},f={iceUfrag:n.iceParameters.iceUfrag,icePwd:n.iceParameters.icePwd};let g;switch(n.dtlsParameters.role){case"server":g="passive";break;case"client":g="active";break;case"auto":g="actpass"}const y=pR(n.rtpCapabilities),x=[];return Array.isArray(s)&&s.length>0&&s.forEach(b=>{x.push({kind:pt.VIDEO,ssrcMsg:[{ssrcId:b.v,rtx:b.v_rtx}],mslabel:"".concat(b.v,"_").concat(b.a)},{kind:pt.AUDIO,ssrcMsg:[{ssrcId:b.a}],mslabel:"".concat(b.v,"_").concat(b.a)})}),{dtlsParameters:h,iceParameters:f,candidates:d,rtpCapabilities:y,setup:g,cname:o,preSSRCs:x}}function pJ(n){let i=[];return n.ip&&typeof n.port=="number"&&(i=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:n.ip,port:n.port.toString(),type:"host",extension:{}}],M.debug("Using remote candidate from AP ".concat(nf(n.ip),":").concat(n.port)),n.ip6&&(i.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:n.ip6,port:n.port.toString(),type:"host",extension:{}}),M.debug("Using IPV6 remote candidate from AP ".concat(nf(n.ip6),":").concat(n.port)))),i}function hR(n,i,s){const o=[],d=[];return n.forEach(h=>{let{ssrcId:f,rtx:g}=h;const y=dr(8,"track-"),x={ssrcId:f,attributes:uJ({label:y,mslabel:s=s||dr(10,""),msid:"".concat(s," ").concat(y)},i&&{cname:i})};if(o.push(x),g!==void 0){const b={ssrcId:g,attributes:uJ({label:y,mslabel:s,msid:"".concat(s," ").concat(y)},i&&{cname:i})};o.push(b),d.push({semantic:"FID",ssrcIds:[f,g]})}}),n.length>1&&d.push({semantic:"SIM",ssrcIds:n.map(h=>{let{ssrcId:f}=h;return f})}),{ssrcs:o,ssrcGroups:d}}function Cy(n,i){i instanceof Pi&&n.attributes.payloads.forEach(s=>{var o;const d=(o=s.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase();if(!d||["opus","pcmu","pcma","g722"].indexOf(d)===-1)return;s.fmtp||(s.fmtp={parameters:{}}),d==="opus"&&typeof re("OPUS_PTIME")=="number"?s.fmtp.parameters.ptime=re("OPUS_PTIME"):s.fmtp.parameters.minptime="10",s.fmtp.parameters.useinbandfec="1";const h=i._encoderConfig;h&&(d!=="pcmu"&&d!=="pcma"&&d!=="g722"&&(h.bitrate&&!Kr()&&(s.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*h.bitrate))),h.sampleRate&&(s.fmtp.parameters.maxplaybackrate="".concat(h.sampleRate),s.fmtp.parameters["sprop-maxcapturerate"]="".concat(h.sampleRate)),h.stereo&&(s.fmtp.parameters.stereo="1",s.fmtp.parameters["sprop-stereo"]="1")),i instanceof aR&&d==="opus"&&i._config.DTX&&(s.fmtp.parameters.usedtx="1"))})}function q4(n){const i=n.attributes.unrecognized.findIndex(s=>s.attField==="x-google-flag"&&s.attValue==="conference");i!==-1&&n.attributes.unrecognized.splice(i,1)}function Y4(n,i){var s;if(n.attributes.payloads.forEach(d=>{var h;((h=d.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())==="h264"&&d.fmtp&&d.fmtp.parameters&&re("ENABLE_UP_SPS_PPS")&&(d.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),!(i instanceof Rr&&i._encoderConfig&&i._hints.indexOf(or.SCREEN_TRACK)===-1))return;const o=i._encoderConfig;xn().supportMinBitrate&&o.bitrateMin&&n.attributes.payloads.forEach(d=>{var h,f;Ge(h=["h264","h265","vp8","vp9","av1"]).call(h,((f=d.rtpMap)===null||f===void 0?void 0:f.encodingName.toLowerCase())||"")&&(d.fmtp||(d.fmtp={parameters:{}}),d.fmtp.parameters["x-google-min-bitrate"]="".concat(o.bitrateMin))}),xn().supportMinBitrate&&!Ge(s=i._hints).call(s,or.LOW_STREAM)&&o.bitrateMax&&n.attributes.payloads.forEach(d=>{var h,f;Ge(h=["h264","h265","vp8","vp9","av1"]).call(h,((f=d.rtpMap)===null||f===void 0?void 0:f.encodingName.toLowerCase())||"")&&(d.fmtp||(d.fmtp={parameters:{}}),d.fmtp.parameters["x-google-start-bitrate"]="".concat(re("X_GOOGLE_START_BITRATE")||Math.floor(o.bitrateMax)))})}function fJ(n){if(n.media.mediaType!=="video")return;const i=Wn();if(i.name!==$n.SAFARI&&i.os!==Is.IOS)return;const s=n.attributes.extmaps.findIndex(o=>/video-orientation/g.test(o.extensionName));s!==-1&&n.attributes.extmaps.splice(s,1)}function EP(n,i,s){if(!i)return;let o,d;if(n.media.mediaType==="video"?(o=s.videoExtensions,d=s.videoCodecs):(o=s.audioExtensions,d=s.audioCodecs),i.twcc===!0){const h=o.find(f=>vP(f.extensionName));if(h){const f=h.extensionName;n.attributes.extmaps.find(y=>vP(y.extensionName))||n.attributes.extmaps.push({entry:h.entry,extensionName:f}),function(y,x){return x.filter(b=>!!y.find(N=>N.payloadType===b.payloadType&&!!N.rtcpFeedbacks.find(I=>I.type==="transport-cc")))}(d,n.attributes.payloads).forEach(y=>{y.rtcpFeedbacks.find(x=>x.type==="transport-cc")||y.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(i.twcc===!1){const h=n.attributes.extmaps.findIndex(f=>vP(f.extensionName));h!==-1&&n.attributes.extmaps.splice(h,1),n.attributes.payloads.forEach(f=>{const g=f.rtcpFeedbacks.findIndex(y=>y.type==="transport-cc");g!==-1&&f.rtcpFeedbacks.splice(g,1)})}if(i.remb===!0){const h=o.find(f=>lJ(f.extensionName));if(h){const f=h.extensionName;n.attributes.extmaps.find(y=>y.extensionName===f)||n.attributes.extmaps.push({entry:h.entry,extensionName:f}),function(y,x){return x.filter(b=>!!y.find(N=>N.payloadType===b.payloadType&&!!N.rtcpFeedbacks.find(I=>I.type==="goog-remb")))}(d,n.attributes.payloads).forEach(y=>{y.rtcpFeedbacks.find(x=>x.type==="goog-remb")||y.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(i.remb===!1){const h=n.attributes.extmaps.findIndex(f=>lJ(f.extensionName));h!==-1&&n.attributes.extmaps.splice(h,1),n.attributes.payloads.forEach(f=>{const g=f.rtcpFeedbacks.findIndex(y=>y.type==="goog-remb");g!==-1&&f.rtcpFeedbacks.splice(g,1)})}}function $4(n,i,s){if(Kr()||n.media.mediaType!=="video"||!(i instanceof Rr)||s!=="vp9"&&s!=="vp8"||s==="vp8"&&!re("SIMULCAST")||s==="vp9"&&re("ENABLE_SVC")||i._scalabilityMode===void 0||i._scalabilityMode.numSpatialLayers<=1)return;const o=s==="vp8"?2:i._scalabilityMode.numSpatialLayers,d=n.attributes.ssrcs[0],h=n.attributes.ssrcGroups.find(g=>g.semantic==="FID"&&g.ssrcIds[0]===d.ssrcId),f={semantic:"SIM",ssrcIds:[d.ssrcId]};for(let g=1;g<o;g++)n.attributes.ssrcs.push({ssrcId:d.ssrcId+g,attributes:qr(d.attributes)}),f.ssrcIds.push(d.ssrcId+g),h&&(n.attributes.ssrcs.push({ssrcId:h.ssrcIds[1]+g,attributes:qr(d.attributes)}),n.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[d.ssrcId+g,h.ssrcIds[1]+g]}));n.attributes.ssrcGroups.unshift(f)}async function mJ(){try{const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:Bk.L1T3}]});const i=await n.createOffer();if(!i.sdp)return void n.close();const s=Mo(i.sdp).mediaDescriptions[0];if(!s)return;const o=s.attributes.extmaps.find(d=>d.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return n.close(),o}catch{return}}async function X4(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new RTCPeerConnection;s.addTransceiver("video",{direction:"sendonly"}),s.addTransceiver("audio",{direction:"sendonly"}),s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"});const o=(await s.createOffer()).sdp,{send:d,recv:h,sendrecv:f}=function(){let g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},x=arguments.length>2?arguments[2]:void 0;const b=uR(x,g,y,"sendonly"),N=uR(x,g,y,"recvonly"),I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},$={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Fu(b,N,"videoExtensions",I,D,$),Fu(b,N,"videoCodecs",I,D,$),Fu(b,N,"audioExtensions",I,D,$),Fu(b,N,"audioCodecs",I,D,$),re("RAISE_H264_BASELINE_PRIORITY")){const z=[],K=[];if($.videoCodecs.forEach((ie,oe)=>{var fe;if(((fe=ie.rtpMap)===null||fe===void 0?void 0:fe.encodingName.toLocaleLowerCase())==="h264"){var Ee,Te;const _e=$.videoCodecs[oe+1],Re=_e&&vJ(ie,_e),je=(Ee=ie.fmtp)===null||Ee===void 0?void 0:Ee.parameters["profile-level-id"],Be=(Te=ie.fmtp)===null||Te===void 0?void 0:Te.parameters["packetization-mode"];!je||je!==re("FIRST_H264_PROFILE_LEVEL_ID")||re("FIRST_PACKETIZATION_MODE")&&Be!==re("FIRST_PACKETIZATION_MODE")?Re?K.push([ie,_e]):K.push([ie]):Re?z.push([ie,_e]):z.push([ie])}}),z.length>0&&K.length>0){M.debug("raising H264 baseline profile priority"),$.videoCodecs.forEach((oe,fe)=>{var Ee;if(((Ee=oe.rtpMap)===null||Ee===void 0?void 0:Ee.encodingName.toLocaleLowerCase())==="h264"){const Te=vJ(oe,$.videoCodecs[fe+1]),_e=z.shift()||K.shift()||[];_e.length>0&&(Te?$.videoCodecs.splice(fe,2,..._e):$.videoCodecs.splice(fe,1,..._e))}});const ie=D.videoCodecs.filter(oe=>{var fe,Ee;return((fe=oe.rtpMap)===null||fe===void 0?void 0:fe.encodingName.toLocaleLowerCase())==="h264"&&((Ee=oe.fmtp)===null||Ee===void 0?void 0:Ee.parameters["profile-level-id"])!==re("FIRST_H264_PROFILE_LEVEL_ID")});if(ie.length>0){const oe=Jg(ie,D.videoCodecs).map(Ee=>Ee.payloadType),fe=[...ie.map(Ee=>Ee.payloadType),...oe];D.videoCodecs=D.videoCodecs.filter(Ee=>!Ge(fe).call(fe,Ee.payloadType))}re("FILTER_SEND_H264_BASELINE")&&(I.videoCodecs=I.videoCodecs.filter(oe=>{var fe,Ee;return!(((fe=oe.rtpMap)===null||fe===void 0?void 0:fe.encodingName.toLocaleLowerCase())==="h264"&&((Ee=oe.fmtp)===null||Ee===void 0?void 0:Ee.parameters["profile-level-id"])!==re("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:I,recv:D,sendrecv:$}}return{send:I,recv:D,sendrecv:$}}(n,i,o);try{s.close()}catch{}return{send:d,recv:h,sendrecv:f}}function gJ(){const n={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},i=uR(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Fu(n,i,"videoExtensions",s,o,d),Fu(n,i,"videoCodecs",s,o,d),Fu(n,i,"audioExtensions",s,o,d),Fu(n,i,"audioCodecs",s,o,d),re("RAISE_H264_BASELINE_PRIORITY")){const h=d.videoCodecs.findIndex(f=>f.rtpMap&&f.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&f.fmtp&&f.fmtp.parameters["profile-level-id"]==="42001f");if(h!==-1){const f=d.videoCodecs.findIndex(g=>g.rtpMap&&g.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(f<h){M.debug("raising H264 baseline profile priority");const g=d.videoCodecs[h];d.videoCodecs.splice(h,1),d.videoCodecs.splice(f,0,g)}f!==-1&&(o.videoCodecs=o.videoCodecs.filter(g=>!(g.rtpMap&&g.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&g.fmtp&&g.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:s,recv:o,sendrecv:d}}function Fu(n,i,s,o,d,h){if(s==="videoExtensions"||s==="audioExtensions"){const f=[];return n[s].forEach(g=>{i[s].some((y,x)=>{if(g.entry===y.entry&&g.extensionName===y.extensionName)return f.push(x),!0})?h[s].push(g):o[s].push(g)}),void i[s].forEach((g,y)=>{f.indexOf(y)===-1&&d[s].push(g)})}if(s==="videoCodecs"||s==="audioCodecs"){const f=[];return n[s].forEach(g=>{i[s].some((y,x)=>{if(g.payloadType===y.payloadType&&JSON.stringify(g)===JSON.stringify(y))return f.push(x),!0})?h[s].push(g):o[s].push(g)}),void i[s].forEach((g,y)=>{f.indexOf(y)===-1&&d[s].push(g)})}}function pR(n){const{send:i,recv:s,sendrecv:o}=n;if(!o){if(!i||!s)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:i,recv:s}}let d,h;return i?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...i.audioCodecs,...o.audioCodecs],d.videoCodecs=[...i.videoCodecs,...o.videoCodecs],d.audioExtensions=[...i.audioExtensions,...o.audioExtensions],d.videoExtensions=[...i.videoExtensions,...o.videoExtensions]):d=qr(o),s?(h={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},h.audioCodecs=[...s.audioCodecs,...o.audioCodecs],h.videoCodecs=[...s.videoCodecs,...o.videoCodecs],h.audioExtensions=[...s.audioExtensions,...o.audioExtensions],h.videoExtensions=[...s.videoExtensions,...o.videoExtensions]):h=qr(o),{send:d,recv:h}}function Mx(n){n.media.mediaType==="audio"&&n.attributes.payloads.filter(i=>{var s;return((s=i.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())==="opus"}).forEach(i=>{i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"})}function fR(n,i,s,o){let d=[];if(n===pt.VIDEO){if(re("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(d=i.videoCodecs.filter(h=>{var f;return Ge(f=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(f,o)&&h&&h.fmtp&&h.fmtp.parameters["profile-level-id"]===re("H264_PROFILE_LEVEL_ID")})),!Array.isArray(d)||d.length===0){let h=[];const f=[],g=[],y=[];if(s.videoCodecs.forEach(x=>{const b=x.rtpMap&&x.rtpMap.encodingName.toLowerCase()||"";Ge(b).call(b,o)?h.push(x):Ge(b).call(b,"vp9")?f.push(x):Ge(b).call(b,"vp8")?g.push(x):Ge(b).call(b,"h264")&&y.push(x)}),h.length===0){let x="";f.length!==0?(h=f,x="vp9"):g.length!==0?(h=g,x="vp8"):y.length!==0&&(h=y,x="h264"),M.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(x))}h.length!==0&&(d=i.videoCodecs.filter(x=>h.some(b=>b.payloadType===x.payloadType)))}if(d.length===0&&(M.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(i.videoCodecs[0].rtpMap&&i.videoCodecs[0].rtpMap.encodingName)),d=i.videoCodecs),re("USE_PUB_RTX")||re("USE_SUB_RTX")){const h=Jg(d,i.videoCodecs);d=[...d,...h]}}else{d=i.audioCodecs.filter(f=>{var g;return Ge(g=f.rtpMap&&f.rtpMap.encodingName.toLowerCase()||"").call(g,o)});const h=i.audioCodecs.filter(f=>{var g;return Ge(g=f.rtpMap&&f.rtpMap.encodingName.toLowerCase()||"").call(g,"red")});d.length===0&&(M.warning("codec ".concat(o," not included in rtpCapabilities, fallback to opus")),d=i.audioCodecs.filter(f=>{var g;return Ge(g=f.rtpMap&&f.rtpMap.encodingName.toLowerCase()||"").call(g,"opus")})),re("ENABLE_AUDIO_RED")&&h.length!==0&&(d=[...h,...d])}return d}function Jg(n,i){const s=n.map(o=>o.payloadType.toString());return i.filter(o=>o.rtpMap&&o.rtpMap.encodingName==="rtx"&&o.fmtp&&o.fmtp.parameters.apt&&Ge(s).call(s,o.fmtp&&o.fmtp.parameters.apt))}async function Yc(n,i,s){const o=i.toString(),d=_J(o,"offer","remote","exchangeSDP");await n.setRemoteDescription({type:"offer",sdp:o});const h=await n.createAnswer();if(!h.sdp)throw new Error("cannot get answer sdp");let f=h.sdp;f=J4(f,s||{}),d==null||d(f||""),await n.setLocalDescription({type:"answer",sdp:f})}function J4(n,i,s){if(re("FORBID_MODIFY_LOCAL_OFFER_SDP"))return n;const o=Mo(n),{useXR:d}=i;return o.mediaDescriptions.forEach(h=>{var f;h.attributes.mid&&(Array.isArray(s)&&!Ge(s).call(s,h.attributes.mid)||(h.media.mediaType==="audio"&&Mx(h),h.media.mediaType==="video"&&function(g){g.media.mediaType==="video"&&re("ENABLE_DOWN_SPS_PPS")&&g.attributes.payloads.filter(y=>{var x;return((x=y.rtpMap)===null||x===void 0?void 0:x.encodingName.toLowerCase())==="h264"}).forEach(y=>{y.fmtp||(y.fmtp={parameters:{}}),y.fmtp.parameters["sps-pps-idr-in-keyframe"]="1"})}(h),d&&Ge(f=["audio","video"]).call(f,h.media.mediaType)&&h.attributes.payloads.forEach(g=>{g.rtcpFeedbacks.findIndex(y=>y.type==="rrtr")===-1&&g.rtcpFeedbacks.push({type:"rrtr"})})))}),um(o)}function _J(n,i,s,o){if(re("SDP_LOGGING"))return M.upload("exchanging ".concat(s," ").concat(i," SDP during P2PConnection.").concat(o,`
`),n),i==="offer"?d=>{_J(d,"answer",s==="local"?"remote":"local",o)}:void 0}async function yJ(n,i,s){try{var o;if(!xn().supportSetRtpSenderParameters||!function(y){return y==="vp9"||y==="av1"}(n)||!re("ENABLE_SVC"))return;const d={},h={},f=i.getParameters(),g=(o=f.encodings)===null||o===void 0?void 0:o[0];h.scalabilityMode=dR(s),g&&Object.assign(g,h),Object.assign(f,d),await i.setParameters(f),M.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(f.encodings)))}catch(d){M.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",d)}}function xP(n){const i=re("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(i)&&i.length>0)&&i.some(s=>Ge(n).call(n,s))}function vJ(n,i){try{var s;return((s=n.fmtp)===null||s===void 0?void 0:s.parameters.apt)===i.payloadType.toString()}catch{return!1}}function EJ(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function bl(n,i){return typeof re(n)===i?re(n):void 0}function Wbe(){try{const n=re("EXPERIMENTS")||{};return typeof n=="string"||Array.isArray(n)?{}:function(i){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?arguments[s]:{};s%2?EJ(Object(o),!0).forEach(function(d){Y(i,d,o[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):EJ(Object(o)).forEach(function(d){Object.defineProperty(i,d,Object.getOwnPropertyDescriptor(o,d))})}return i}({},n)}catch(n){return M.debug("handle gateway attributes failed: ",n),{}}}const xJ={};function sf(n){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&M.debug("install service ".concat(n.name)),xJ[n.name]=n}function Uh(n){const i=xJ[n];if(!i)throw new Pe(se.INVALID_OPERATION,"".concat(n," not found, please use AgoraRTC.use(").concat(n,"Service) to load it first"));return i}function bJ(n,i){return Uh("DataStream").create(n,i)}function bP(){return Uh("InterceptFrame").create()}function wJ(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function Xs(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?wJ(Object(s),!0).forEach(function(o){Y(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):wJ(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}const Q4=new Map;class Hbe extends ai{get state(){return this._state}set state(i){if(i===this._state)return;const s=this._state;this._state=i,i==="DISCONNECTED"&&this._disconnectedReason?this.emit(Mi.CONNECTION_STATE_CHANGE,i,s,this._disconnectedReason):this.emit(Mi.CONNECTION_STATE_CHANGE,i,s)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(i){M.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(i)),this._joinGatewayStartTime=i}constructor(i,s){var o,d,h;super(),Y(this,"store",void 0),Y(this,"joinInfo",void 0),Y(this,"key",void 0),Y(this,"ntpOffset",0),Y(this,"usingProxy",!1),Y(this,"signal",void 0),Y(this,"role",void 0),Y(this,"isPreallocation",void 0),Y(this,"isPreSub",void 0),Y(this,"inChannelInfo",{joinAt:null,duration:0}),Y(this,"spec",void 0),Y(this,"_state","DISCONNECTED"),Y(this,"_statsCollector",void 0),Y(this,"_disconnectedReason",void 0),Y(this,"isSignalRecover",!1),Y(this,"hasChangeBGPAddress",!1),Y(this,"trafficStatsInterval",void 0),Y(this,"networkQualityInterval",void 0),Y(this,"_joinGatewayStartTime",0),Y(this,"_signalTimeout",!1),Y(this,"_clientRoleOptions",void 0),Y(this,"_isProactiveJoin",!1),this.store=i,this.spec=s,this.signal=this.store.useP2P?(o={spec:Xs(Xs({},s),{},{retryConfig:s.websocketRetryConfig}),store:i},(d=(h=Uh("P2PChannel")).createSubmodule)===null||d===void 0?void 0:d.call(h,o)):this.store.useDcSignal?function(f){return Uh("DataChannelSignal").create(f)}({spec:Xs(Xs({},s),{},{retryConfig:s.websocketRetryConfig}),store:i}):new tJ(Xs(Xs({},s),{},{retryConfig:s.websocketRetryConfig}),i),this._statsCollector=s.statsCollector,this.role=s.role||"audience",this._clientRoleOptions=s.clientRoleOptions,this.handleSignalEvents()}setUsingProxy(i){this.usingProxy=i}async join(i,s,o){if(this.store.useDcSignal){let b=!1;i.cloudProxyServer!=="disabled"?(M.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(i.cloudProxyServer,")")),b=!0):"".concat(i.apResponse.cid,"_").concat(i.apResponse.cert).length>255||"".concat(i.apResponse.cid,"_").concat(i.apResponse.cert).length<22?(M.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),b=!0):i.apResponse.addresses.some(N=>N.fingerprint)||re("FINGERPRINT")||(M.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),b=!0),b&&this.resetSignal()}this.store.joinGatewayStart(),i.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const d=Date.now();let h=Q4.get(i.cname);if(h||(h=new Map,Q4.set(i.cname,h)),this._isProactiveJoin=!0,h.has(i.uid)){const b=new Ce(se.UID_CONFLICT);throw _t.joinGateway(i.sid,{lts:d,succ:!1,ec:b.code,addr:null,uid:i.uid,cid:i.cid,firstSuccess:this._isProactiveJoin,isProxy:!!i.proxyServer||this.usingProxy,signalChannel:this.store.useDcSignal?"1":"0",preload:i.preload}),b}h.set(i.uid,!0),this.joinInfo=i,this.key=s;let f=0;this.joinGatewayStartTime=d;const g=i.proxyServer,y=this.store.useDcSignal?"datachannel":"websocket";try{M.debug("[".concat(this.store.clientId,"] use ").concat(y," join uid ").concat(f));const b=i.gatewayAddrs.map(I=>{let{address:D}=I;const[$,z]=D.split(":"),K={host:$,port:z};return i.proxyServer&&(K.proxy=i.proxyServer),K});let N;N=this.store.useDcSignal?await this.signal.init(i.apResponse.addresses):await this.signal.init(b),f=N.uid,M.debug("[".concat(this.store.clientId,"] ").concat(y," join uid ").concat(f," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(b){var x;throw b.code===se.INIT_DATACHANNEL_TIMEOUT&&this.signal.__name__==="AgoraRTCSignal"||_t.joinGateway(i.sid,{lts:d,succ:!1,ec:((x=b.data)===null||x===void 0?void 0:x.desc)||b.code,errorMsg:b.message,addr:this.signal.url,uid:i.uid,cid:i.cid,firstSuccess:this._isProactiveJoin,isProxy:!!g||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:i.preload}),b&&b.code===se.INIT_DATACHANNEL_TIMEOUT?(M.warning("[".concat(this.store.clientId,"] User join datachannel failed"),b.toString()),this.resetSignal(),b):(M.error("[".concat(this.store.clientId,"] User join failed"),b.toString()),h.delete(i.uid),this.signal.close(),b)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),M.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(b=>{M.warning("[".concat(this.store.clientId,"] get traffic stats error"),b.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Mi.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Mi.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Mi.NETWORK_QUALITY,{uplinkNetworkQuality:_P(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:_P(this._statsCollector.trafficStats.B_dnq)}):this.emit(Mi.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),f}async leave(){let i=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){s!==Rn.FALLBACK&&(this.state="DISCONNECTING");try{i||this.signal.connectionState!==Cn.CONNECTED||await function(o,d){return d===1/0?o:et.race([o,yxe(d)])}(this.signal.request(kt.LEAVE,void 0,!0),3e3)}catch(o){M.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),o)}this.signal.close(s),s!==Rn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(i,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ce(se.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const d={state:"offer",p2p_id:this.store.p2pId,ortc:s,mode:this.spec.mode,extend:re("PUB_EXTEND"),twcc:!!re("PUBLISH_TWCC"),rtx:!!re("USE_PUB_RTX")};try{return(await this.signal.request(kt.PUBLISH,d,!0))._message}catch(h){if(o&&h.data&&h.data.code===jt.ERR_PUBLISH_REQUEST_INVALID)return M.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),h.toString()),await this.tryUnpubBeforeRepub(i,s),this.publish(i,s,!1);throw h}}async publishDataChannel(i,s,o){var d;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ce(se.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const h={stream_id:s.streamId,ordered:s.ordered?1:0,max_retrans_times:(d=s.maxRetransmits)!==null&&d!==void 0?d:10,channel_id:s.channelId,metadata:s.metadata};try{await this.signal.request(kt.PUBLISH_DATASTREAM,h,!0)}catch(f){if(o&&f.data&&f.data.code===jt.ERR_PUBLISH_REQUEST_INVALID)return M.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),f.toString()),await this.tryUnpubDataChannelBeforeRepub(i,s),this.publishDataChannel(i,s,!1);throw f}}async unpublish(i,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ce(se.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(kt.UNPUBLISH,{stream_id:s,ortc:i},!0)}catch(o){M.warning("[".concat(this.store.clientId,"] unpublish warning: "),o)}}async unpublishDataChannel(i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ce(se.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await et.all(i.map(s=>this.signal.request(kt.UNPUBLISH_DATASTREAM,{channel_id:s},!0)))}catch(s){M.warning("unpublish datachannels warning: ",s)}}async presubscribe(i,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ce(se.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const d={stream_id:i,stream_type:s,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!re("SUBSCRIBE_TWCC"),rtx:!!re("USE_SUB_RTX")||void 0,extend:re("SUB_EXTEND"),svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return await this.signal.request(kt.PRE_SUBSCRIBE,d,!0)}catch(h){if(o&&h.data&&h.data.code===jt.ERR_SUBSCRIBE_REQUEST_INVALID)return M.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),h.toString()),this.presubscribe(i,s,!1);throw h}}async subscribe(i,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ce(se.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const d={stream_id:i,stream_type:s.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!re("SUBSCRIBE_TWCC"),rtx:!!re("USE_SUB_RTX"),extend:re("SUB_EXTEND"),ssrcId:s.ssrcId,svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return(await this.signal.request(kt.SUBSCRIBE,d,!0))._message}catch(h){if(o&&h.data&&h.data.code===jt.ERR_SUBSCRIBE_REQUEST_INVALID)return M.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),h.toString()),await this.tryUnsubBeforeResub(i,s),await this.subscribe(i,s,!1);throw h}}async subscribeDataChannel(i,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ce(se.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const d={uid:i,stream_id:s.id,channel_id:s.datachannelId};try{return void await this.signal.request(kt.SUBSCRIBE_DATASTREAM,d,!0)}catch(h){if(o&&h.data&&h.data.code===jt.ERR_SUBSCRIBE_REQUEST_INVALID)return M.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),h.toString()),await this.tryUnsubDataChannelBeforeResub(i,s),await this.subscribeDataChannel(i,s,!1);throw h}}async subscribeAll(i,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ce(se.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const o={p2p_id:this.store.p2pId,users:i,dtx:!1,rtx:!!re("USE_SUB_RTX"),twcc:!!re("SUBSCRIBE_TWCC"),svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return await this.signal.request(kt.SUBSCRIBE_STREAMS,o,!0)}catch(d){if(s&&d.data&&d.data.code===jt.ERR_SUBSCRIBE_REQUEST_INVALID)return M.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),d.toString()),await this.tryMassUnsubBeforeResub(i),await this.subscribeAll(i,!1);throw d}}async setVideoProfile(i){const s=function(o){if(!(o.bitrateMax&&o.bitrateMin&&o.frameRate&&o.height&&o.width))return;let d=o.frameRate,h=o.width,f=o.height,g=!0;return typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,d||(g=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,h||(g=!1)),typeof f!="number"&&(f=f.exact||f.ideal||f.max||f.min||0,d||(g=!1)),g?{stream_type:0,width:h,height:f,fps:d,start_bps:1e3*o.bitrateMax,min_bps:1e3*o.bitrateMin,target_bps:1e3*o.bitrateMax}:void 0}(i);if(s)return this.signal.request(kt.SET_VIDEO_PROFILE,s);M.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(i,s){try{await this.signal.request(kt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:i,stream_id:s},!0)}catch(o){M.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),o)}}async unsubscribeDataChannel(i,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ce(se.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await et.all(i.map(o=>this.signal.request(kt.UNSUBSCRIBE_DATASTREAM,{stream_id:o,uid:s},!0)))}catch(o){M.warning("unsubscribeDataChannel warning: ",o)}}async massUnsubscribe(i){try{await this.signal.request(kt.UNSUBSCRIBE_STREAMS,i,!0)}catch(s){M.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),s)}}async reconnectPC(i){const{iceParameters:s,dtlsParameters:o,rtpCapabilities:d}=i;return{gatewayEstablishParams:await this.signal.request(kt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:s,dtlsParameters:o,rtpCapabilities:d}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(kt.GATEWAY_INFO)}async renewToken(i){await this.signal.request(kt.RENEW_TOKEN,i),this.key=i.token}updateClientRole(i,s){s&&(this._clientRoleOptions=Object.assign({},s)),re("CLIENT_ROLE_OPTIONS")&&(M.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(re("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},re("CLIENT_ROLE_OPTIONS"))),this.role=i}async setClientRole(i,s){if(s&&(this._clientRoleOptions=Object.assign({},s)),re("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},re("CLIENT_ROLE_OPTIONS")),M.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(re("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=i);let o,d=0;i==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(o=this._clientRoleOptions.delay,d=1):d=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:d=0;const h=Object.assign({},s);delete h.delay,delete h.level,await this.signal.request(kt.SET_CLIENT_ROLE,Xs(Xs({role:i,level:d,delay:o},h),{},{client_ts:Date.now()})),this.role=i}async setDualStreamMode(i,s,o){await this.signal.request(kt.SET_DUAL_STREAM_MODE,{mode:i},o,s)}async setRemoteVideoStreamType(i,s){await this.signal.request(kt.SWITCH_VIDEO_STREAM,{stream_id:i,stream_type:s})}async setDefaultRemoteVideoStreamType(i){await this.signal.request(kt.DEFAULT_VIDEO_STREAM,{stream_type:i})}async setStreamFallbackOption(i,s){await this.signal.request(kt.SET_FALLBACK_OPTION,{stream_id:i,fallback_type:s})}async pickSVCLayer(i,s){await this.signal.request(kt.PICK_SVC_LAYER,{stream_id:i,spatial_layer:s.spatialLayer,temporal_layer:s.temporalLayer})}async setRTM2Flag(i){await this.signal.request(kt.SET_RTM2_FLAG,{rtm2_flag:i})}async sendExtensionMessage(i,s,o){if(this.store.useP2P)return this.signal.sendExtensionMessage(i,s,o)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Xs({},this.inChannelInfo)}async setConfigure(i){if(i&&Array.isArray(i)&&i.length!==0)return this.signal.request(kt.CONFIGURE,i)}async getGatewayVersion(){return(await this.signal.request(kt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const i=Q4.get(this.joinInfo.cname);i&&i.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0),this.usingProxy=!1}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const i=function(s){let o;return o=s.startsWith("dc")?s.match(/(dc\:\/\/)?([^:]+):(\d+)/):s.match(/(wss\:\/\/)?([^:]+):(\d+)/),o?{username:Ea.username,password:Ea.password,turnServerURL:o[2],tcpport:parseInt(o[3])+30,udpport:parseInt(o[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],i&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Xs(Xs({},Ea),{},{turnServerURL:i.turnServerURL,tcpport:i.tcpport,udpport:i.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const i=await this.signal.request(kt.TRAFFIC_STATS,void 0,!0);i.timestamp=Date.now(),i.ntp_offset!=null&&(this.ntpOffset=i.ntp_offset),i.peer_delay.forEach(s=>{const o=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(d=>d.peer_uid===s.peer_uid);o&&o.B_st!==s.B_st&&Mk(()=>{this.emit(Mi.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)})}),this._statsCollector.updateTrafficStats(i)}getJoinMessage(i){var s,o,d,h;if(!this.joinInfo||!this.key)throw new Ce(se.UNEXPECTED_ERROR,"can not generate join message, no join info");const f=Object.assign({},this.joinInfo.apResponse);let g=re("REPORT_APP_SCENARIO");if(typeof g!="string")try{g=JSON.stringify(g)}catch{g=void 0}var y;g&&g.length>128&&(g=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Mi.UPDATE_GATEWAY_CONFIG),y=this.store.clientId,Ge(kx).call(kx,y)||kx.push(y);const x=iR(this.store),b=!((s=this.isPreallocation)===null||s===void 0||!s.call(this)),N=wY(this.store),I=Wbe(),D=Ph(87)||Iq()||LV(117),$=(function(){const oe=Wn();if(oe.name!==$n.SAFARI||!oe.browserVersion)return!1;const fe=oe.browserVersion.split(".");return Number(fe[0])>18||Number(fe[0])===18&&Number(fe[1])>=4}()||Dq(18,4,!1))&&jV(18,6,!0)&&this.spec.codec==="h264"&&re("ENABLE_ABSSENDTIME_AS_SENTTS"),z=!(((o=f.detail)===null||o===void 0?void 0:o[3])!=="CN"||!re("ENABLE_QUALITY_FALLBACK"))&&re("ENABLE_QUALITY_FALLBACK"),K=!!re("ENABLE_AP_MULTI_IP")&&((d=f.detail)===null||d===void 0?void 0:d[5])==="multi-ip",ie=Xs({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Pd,browser:navigator.userAgent,process_id:re("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:K||this.hasChangeBGPAddress,ap_response:f,extend:re("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:g,attributes:{userAttributes:Xs(Xs({enableEncodedTransform:(!!re("ENABLE_AUDIO_METADATA")||!!re("ENABLE_AUDIO_PTS"))&&D||!!re("ENABLE_AUDIO_TOPN")&&OV($n.CHROME,87,116)||void 0,enableAudioMetadata:!!re("ENABLE_AUDIO_METADATA")&&D,enableAudioPts:!!re("ENABLE_AUDIO_PTS")&&D,topnSmoothLevel:re("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:re("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:re("TOPN_SWITCH_HOLD_MS"),topnAudioGain:re("TOPN_AUDIO_GAIN"),enableNetworkQualityProbe:this.store.networkQualityProbe,enablePublishedUserList:re("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:re("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:bl("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:bl("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:bl("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:re("USE_PUB_RTX")===!0||re("USE_SUB_RTX")===!0||void 0,disableFEC:re("DISABLE_FEC"),enableNTPReport:!!re("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:N,enableFulllinkAvSync:!!re("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:bl("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!re("FORCE_ENABLE_AUT_CC")||!Kk()&&(!!re("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!re("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:bl("USE_XR","boolean"),enableLossbasedBwe:bl("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!re("FORCE_ENABLE_AUT_CC")||!Kk()&&(!!re("ENABLE_AUT_CC")||void 0),enableCCFallback:bl("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:b,preSubNum:x?bl("PRE_SUB_NUM","number"):void 0,enablePubTWCC:bl("PUBLISH_TWCC","boolean"),enableSubTWCC:bl("SUBSCRIBE_TWCC","boolean"),enablePubRTX:bl("USE_PUB_RTX","boolean"),enableSubRTX:bl("USE_SUB_RTX","boolean"),enableSubSVC:re("ENABLE_SVC")?re("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0,enableSvcExtended:re("ENABLE_SVC")&&Array.isArray(re("SVC_EXTENDED"))&&re("SVC_EXTENDED").length!==0?re("SVC_EXTENDED"):void 0,enableVosFallback:re("ENABLE_VOS_FALLBACK"),enableQualityFallback:z},I),{},{audioDuplicate:bl("ENABLE_AUDIO_RED","boolean")?(h=bl("AUDIO_DUPLICATE_NUM","number"))!==null&&h!==void 0?h:2:void 0,senttsUsesAbsSendTime:!!$||void 0,enableDualStreamFlag:bl("ENABLE_DUAL_STREAM_FLAG","boolean")})},join_ts:this.joinGatewayStartTime},i);return this.joinInfo.stringUid&&(ie.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(ie.aes_mode=this.joinInfo.aesmode,re("ENCRYPT_AES")?(ie.aes_secret=this.joinInfo.aespassword,ie.aes_encrypt=!0):ie.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(ie.aes_salt=this.joinInfo.aessalt)),f.addresses[this.signal.websocket.currentURLIndex]&&(ie.ap_response.ticket=f.addresses[this.signal.websocket.currentURLIndex].ticket,delete f.addresses),this.joinInfo.defaultVideoStream!==void 0&&(ie.default_video_stream=this.joinInfo.defaultVideoStream),ie}getRejoinMessage(){if(!this.joinInfo)throw new Ce(se.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(xt.WS_RECONNECT_CREATE_CONNECTION,i=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(xt.WS_RECONNECTING,i=>{this.joinInfo&&_t.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i||va.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",_t.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(xt.WS_CLOSED,i=>{let s;switch(i){case Rn.LEAVE:s=va.LEAVE;break;case Rn.UID_BANNED:case Rn.IP_BANNED:case Rn.CHANNEL_BANNED:case Rn.SERVER_ERROR:s=va.SERVER_ERROR;break;case Rn.FALLBACK:s=va.FALLBACK;break;case Rn.LICENSE_MISSING:case Rn.LICENSE_EXPIRED:case Rn.LICENSE_MINUTES_EXCEEDED:case Rn.LICENSE_PERIOD_INVALID:case Rn.LICENSE_MULTIPLE_SDK_SERVICE:case Rn.LICENSE_ILLEGAL:case Rn.TOKEN_EXPIRE:s=i;break;default:s=va.NETWORK_ERROR}M.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(s||"undefined -> "+va.NETWORK_ERROR)),this.joinInfo&&_t.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:i===Rn.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this._disconnectedReason=i,i!==Rn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(xt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const i=re("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;i&&(i.level||i.delay)&&(M.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(i.level,", delay: ").concat(i.delay)),this.setClientRole(this.role,i))}if(_t.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const i=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!i)return void M.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(i));xr("EVENT_REPORT_DOMAIN",i[1]),xr("EVENT_REPORT_BACKUP_DOMAIN",i[1]),xr("LOG_UPLOAD_SERVER","".concat(i[1],":6444"))}}}),this.signal.on(Yt.ON_UPLINK_STATS,i=>{this._statsCollector.updateUplinkStats(i)}),this.signal.on(xt.REQUEST_RECOVER,(i,s,o)=>{if(!this.joinInfo)return o(new Ce(se.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));i&&(this.joinInfo.multiIP=i,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,rs(this,Mi.REQUEST_NEW_GATEWAY_LIST).then(s).catch(o)}),this.signal.on(xt.REQUEST_JOIN_INFO,async(i,s,o)=>{var d,h,f;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void i(this.getJoinMessage({ortc:{}}));const g=qr((d=this.joinInfo)===null||d===void 0?void 0:d.turnServer);if(re("NEW_TURN_MODE")&&g&&((h=this.joinInfo)===null||h===void 0?void 0:h.cloudProxyServer)==="disabled"){var y;let I=g.servers.map(z=>"turnServerURL"in z&&re("USE_TURN_IP")?Xs(Xs({},z),{},{turnServerURL:gP(z.turnServerURL)}):z),D=(y=g.serversFromGateway)===null||y===void 0?void 0:y.map(z=>re("USE_TURN_IP")?Xs(Xs({},z),{},{turnServerURL:gP(z.turnServerURL)}):z);const $=this.signal.currentURLIndex;I.length>0&&(I=[I[$%I.length]],g.servers=I),Array.isArray(D)&&D.length>0&&(D=[D[0]],g.serversFromGateway=D),M.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat($))}const{iceParameters:x,dtlsParameters:b,rtpCapabilities:N}=await rs(this,Mi.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:g,cloudProxyServer:(f=this.joinInfo)===null||f===void 0?void 0:f.cloudProxyServer});try{i(this.getJoinMessage({ortc:{iceParameters:x,dtlsParameters:b,rtpCapabilities:N,version:"2"}}))}catch(I){s(I)}}),this.signal.on(xt.REQUEST_REJOIN_INFO,i=>{i(this.getRejoinMessage())}),this.signal.on(xt.REPORT_JOIN_GATEWAY,(i,s)=>{if(!this.joinInfo)return;let o,d="";var h;i instanceof Ce?(o=((h=i.data)===null||h===void 0?void 0:h.desc)||i.code,d=i.message):o=i,_t.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:o,errorMsg:d,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload})}),this.signal.on(xt.IS_P2P_DISCONNECTED,i=>{i(uy(this,Mi.IS_P2P_DISCONNECTED))}),this.signal.on(xt.DISCONNECT_P2P,()=>{this.emit(Mi.DISCONNECT_P2P)}),this.signal.on(xt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(xt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(xt.JOIN_RESPONSE,i=>{const s=this.getCurrentGatewayAddress();this.emit(Mi.JOIN_RESPONSE,i,s)}),this.signal.on(xt.PRE_CONNECT_PC,async(i,s)=>{if(this.joinInfo){var o,d;this.updateTurnConfigFromSignal();const f=this.getCurrentGatewayAddress(),g=qr((o=this.joinInfo)===null||o===void 0?void 0:o.turnServer);if(re("NEW_TURN_MODE")&&g&&((d=this.joinInfo)===null||d===void 0?void 0:d.cloudProxyServer)==="disabled"){var h;let x=g.servers.map(I=>"turnServerURL"in I&&re("USE_TURN_IP")?Xs(Xs({},I),{},{turnServerURL:gP(I.turnServerURL)}):I),b=(h=g.serversFromGateway)===null||h===void 0?void 0:h.map(I=>re("USE_TURN_IP")?Xs(Xs({},I),{},{turnServerURL:gP(I.turnServerURL)}):I);const N=this.signal.currentURLIndex;x.length>0&&(x=[x[N%x.length]],g.servers=x),Array.isArray(b)&&b.length>0&&(b=[b[0]],g.serversFromGateway=b),M.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(N,",in pre pc"))}const y=re("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(f&&y){const x=pJ(f);rs(this,Mi.PRE_CONNECT_PC,{candidates:x,fingerprint:y,turnServer:g}).then(b=>{i==null||i(b)}).catch(s||(()=>{}))}}}),this.signal.on(xt.RECOVER_NOTIFICATION,i=>{this.joinInfo&&typeof re("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(re("AP_REQUEST_DETAIL"),";").concat(i))}),this.signal.on(xt.VOS_FALLBACK,i=>{this.emit(Mi.VOS_FALLBACK,i)}),this.signal.on(xt.DATACHANNEL_FAILBACK,i=>{M.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(Mi.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(i,s){try{await this.signal.request(kt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:i,ortc:[s]},!0)}catch(o){throw M.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),o),o}}async tryUnsubDataChannelBeforeResub(i,s){try{await this.signal.request(kt.UNSUBSCRIBE,{stream_id:s.id},!0)}catch(o){throw M.warning("unsubscribe datachannel warning",o),o}}async tryUnpubBeforeRepub(i,s){try{await this.signal.request(kt.UNPUBLISH,{stream_id:i,ortc:s},!0)}catch(o){throw M.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),o),o}}async tryUnpubDataChannelBeforeRepub(i,s){try{await this.signal.request(kt.UNPUBLISH_DATASTREAM,{channnel_id:s.channelId},!0)}catch(o){throw M.warning("unpublish datastream warning: ",o),o}}async tryMassUnsubBeforeResub(i){const s={users:i.map(o=>({stream_id:o.stream_id,stream_type:o.stream_type}))};try{await this.signal.request(kt.UNSUBSCRIBE_STREAMS,s,!0)}catch(o){throw M.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),o),o}}async muteLocal(i,s){const o={action:i.find(d=>d.stream_type===hr.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:i,stream_id:s};try{await this.signal.request(kt.CONTROL,o,!0,!0)}catch(d){throw M.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),d),d}}async unmuteLocal(i,s){const o={action:i.find(d=>d.stream_type===hr.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:i,stream_id:s};try{await this.signal.request(kt.CONTROL,o,!0,!0)}catch(d){throw M.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),d),d}}async muteRemote(i,s){const o={action:i===pt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(kt.CONTROL,o,!0,!0)}catch(d){throw M.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),d),d}}async unmuteRemote(i,s){const o={action:i===pt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(kt.CONTROL,o,!0,!0)}catch(d){throw M.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),d),d}}uploadWRTCStats(i){this.signal.uploadWRTCStats(i)}upload(i,s){this.signal.upload(i,s)}getSignalRTT(){return this.signal.rtt}async restartICE(i){const s={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:i};try{return await this.signal.request(kt.RESTART_ICE,s,!0)}catch(o){throw M.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),o),o}}reconnect(i,s){this.state==="CONNECTED"&&this.signal.reconnect(i||void 0,s||va.P2P_FAILED)}getCurrentGatewayAddress(){var i,s;if(!re("GATEWAY_WSS_ADDRESS"))return re("USE_CANDIDATE_FROM_AP_DETAIL")&&(i=this.joinInfo)!==null&&i!==void 0&&i.apGatewayAddress?(M.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(s=this.joinInfo)!==null&&s!==void 0&&s.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(i){await this.signal.request(kt.SET_PARAMETER,{enablePublishAudioFilter:i})}downgradeCodec(i){this.signal.downgradeCodec(i)}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(Rn.FALLBACK)),this.store.useDcSignal=!1,this.signal=new tJ(Xs(Xs({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(Mi.RESET_SIGNAL)}}let wP=0,Z4=0;function Vh(n,i,s,o){return new et((d,h)=>{i.timeout=i.timeout||re("HTTP_CONNECT_TIMEOUT"),i.responseType=i.responseType||"json",i.data&&!s?(i.data=JSON.stringify(i.data),wP+=Qp(i.data)):s&&(i.data.size?wP+=i.data.size:i.data instanceof FormData?wP+=Zq(i.data):wP+=Qp(JSON.stringify(i.data))),i.headers=i.headers||{},i.headers["Content-Type"]=i.headers["Content-Type"]||"application/json",i.method="POST",i.url=n,mc.request(i).then(f=>{typeof f.data=="string"?Z4+=Qp(f.data):f.data instanceof ArrayBuffer||f.data instanceof Uint8Array?Z4+=f.data.byteLength:Z4+=Qp(JSON.stringify(f.data)),o&&d({data:f.data,headers:f.headers}),d(f.data)}).catch(f=>{mc.isCancel(f)?h(new Ce(se.OPERATION_ABORTED,"cancel token canceled")):f.code==="ECONNABORTED"?h(new Ce(se.NETWORK_TIMEOUT,f.message)):f.response?h(new Ce(se.NETWORK_RESPONSE_ERROR,f.response.status)):h(new Ce(se.NETWORK_ERROR,f.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var n;function i(Ue){var Qe=0;return function(){return Qe<Ue.length?{done:!1,value:Ue[Qe++]}:{done:!0}}}var s=typeof Object.defineProperties=="function"?Object.defineProperty:function(Ue,Qe,ft){return Ue==Array.prototype||Ue==Object.prototype||(Ue[Qe]=ft.value),Ue},o,d=function(Ue){Ue=[typeof globalThis=="object"&&globalThis,Ue,typeof window=="object"&&window,typeof self=="object"&&self,typeof a=="object"&&a];for(var Qe=0;Qe<Ue.length;++Qe){var ft=Ue[Qe];if(ft&&ft.Math==Math)return ft}throw Error("Cannot find global object")}(this);function h(Ue,Qe){if(Qe)e:{var ft=d;Ue=Ue.split(".");for(var Fe=0;Fe<Ue.length-1;Fe++){var B=Ue[Fe];if(!(B in ft))break e;ft=ft[B]}(Qe=Qe(Fe=ft[Ue=Ue[Ue.length-1]]))!=Fe&&Qe!=null&&s(ft,Ue,{configurable:!0,writable:!0,value:Qe})}}function f(Ue){return(Ue={next:Ue})[Symbol.iterator]=function(){return this},Ue}function g(Ue){var Qe=typeof Symbol<"u"&&Symbol.iterator&&Ue[Symbol.iterator];return Qe?Qe.call(Ue):{next:i(Ue)}}if(h("Symbol",function(Ue){function Qe(B,ue){this.A=B,s(this,"description",{configurable:!0,writable:!0,value:ue})}if(Ue)return Ue;Qe.prototype.toString=function(){return this.A};var ft="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Fe=0;return function B(ue){if(this instanceof B)throw new TypeError("Symbol is not a constructor");return new Qe(ft+(ue||"")+"_"+Fe++,ue)}}),h("Symbol.iterator",function(Ue){if(Ue)return Ue;Ue=Symbol("Symbol.iterator");for(var Qe="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),ft=0;ft<Qe.length;ft++){var Fe=d[Qe[ft]];typeof Fe=="function"&&typeof Fe.prototype[Ue]!="function"&&s(Fe.prototype,Ue,{configurable:!0,writable:!0,value:function(){return f(i(this))}})}return Ue}),typeof Object.setPrototypeOf=="function")o=Object.setPrototypeOf;else{var y;e:{var x={};try{x.__proto__={a:!0},y=x.a;break e}catch{}y=!1}o=y?function(Ue,Qe){if(Ue.__proto__=Qe,Ue.__proto__!==Qe)throw new TypeError(Ue+" is not extensible");return Ue}:null}var b=o;function N(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function I(Ue){if(Ue.m)throw new TypeError("Generator is already running");Ue.m=!0}function D(Ue,Qe){return Ue.h=3,{value:Qe}}function $(Ue){this.g=new N,this.G=Ue}function z(Ue,Qe,ft,Fe){try{var B=Qe.call(Ue.g.j,ft);if(!(B instanceof Object))throw new TypeError("Iterator result "+B+" is not an object");if(!B.done)return Ue.g.m=!1,B;var ue=B.value}catch(ve){return Ue.g.j=null,Ue.g.s(ve),K(Ue)}return Ue.g.j=null,Fe.call(Ue.g,ue),K(Ue)}function K(Ue){for(;Ue.g.h;)try{var Qe=Ue.G(Ue.g);if(Qe)return Ue.g.m=!1,{value:Qe.value,done:!1}}catch(ft){Ue.g.v=void 0,Ue.g.s(ft)}if(Ue.g.m=!1,Ue.g.l){if(Qe=Ue.g.l,Ue.g.l=null,Qe.F)throw Qe.D;return{value:Qe.return,done:!0}}return{value:void 0,done:!0}}function ie(Ue){this.next=function(Qe){return Ue.o(Qe)},this.throw=function(Qe){return Ue.s(Qe)},this.return=function(Qe){return function(ft,Fe){I(ft.g);var B=ft.g.j;return B?z(ft,"return"in B?B.return:function(ue){return{value:ue,done:!0}},Fe,ft.g.return):(ft.g.return(Fe),K(ft))}(Ue,Qe)},this[Symbol.iterator]=function(){return this}}function oe(Ue,Qe){return Qe=new ie(new $(Qe)),b&&Ue.prototype&&b(Qe,Ue.prototype),Qe}if(N.prototype.o=function(Ue){this.v=Ue},N.prototype.s=function(Ue){this.l={D:Ue,F:!0},this.h=this.C||this.u},N.prototype.return=function(Ue){this.l={return:Ue},this.h=this.u},$.prototype.o=function(Ue){return I(this.g),this.g.j?z(this,this.g.j.next,Ue,this.g.o):(this.g.o(Ue),K(this))},$.prototype.s=function(Ue){return I(this.g),this.g.j?z(this,this.g.j.throw,Ue,this.g.o):(this.g.s(Ue),K(this))},h("Array.prototype.entries",function(Ue){return Ue||function(){return function(Qe,ft){Qe instanceof String&&(Qe+="");var Fe=0,B=!1,ue={next:function(){if(!B&&Fe<Qe.length){var ve=Fe++;return{value:ft(ve,Qe[ve]),done:!1}}return B=!0,{done:!0,value:void 0}}};return ue[Symbol.iterator]=function(){return ue},ue}(this,function(Qe,ft){return[Qe,ft]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var fe=function(Ue,Qe){for(var ft=0;ft<Ue.length;ft++)Qe(Ue[ft])},Ee=function(Ue){return Ue.replace(/\r?\n|\r/g,`\r
`)},Te=function(Ue,Qe,ft){return Qe instanceof Blob?(ft=ft!==void 0?ft+"":typeof Qe.name=="string"?Qe.name:"blob",Qe.name===ft&&Object.prototype.toString.call(Qe)!=="[object Blob]"||(Qe=new File([Qe],ft)),[String(Ue),Qe]):[String(Ue),String(Qe)]},_e=function(Ue,Qe){if(Ue.length<Qe)throw new TypeError(Qe+" argument required, but only "+Ue.length+" present.")},Re=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,je=Re.FormData,Be=Re.XMLHttpRequest&&Re.XMLHttpRequest.prototype.send,dt=Re.Request&&Re.fetch,Ht=Re.navigator&&Re.navigator.sendBeacon,Bt=Re.Element&&Re.Element.prototype,dn=Re.Symbol&&Symbol.toStringTag;dn&&(Blob.prototype[dn]||(Blob.prototype[dn]="Blob"),"File"in Re&&!File.prototype[dn]&&(File.prototype[dn]="File"));try{new File([],"")}catch{Re.File=function(Qe,ft,Fe){return Qe=new Blob(Qe,Fe||{}),Object.defineProperties(Qe,{name:{value:ft},lastModified:{value:+(Fe&&Fe.lastModified!==void 0?new Date(Fe.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),dn&&Object.defineProperty(Qe,dn,{value:"File"}),Qe}}var sn=function(Ue){return Ue.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Qn=function(Ue){this.i=[];var Qe=this;Ue&&fe(Ue.elements,function(ft){if(ft.name&&!ft.disabled&&ft.type!=="submit"&&ft.type!=="button"&&!ft.matches("form fieldset[disabled] *"))if(ft.type==="file"){var Fe=ft.files&&ft.files.length?ft.files:[new File([],"",{type:"application/octet-stream"})];fe(Fe,function(B){Qe.append(ft.name,B)})}else ft.type==="select-multiple"||ft.type==="select-one"?fe(ft.options,function(B){!B.disabled&&B.selected&&Qe.append(ft.name,B.value)}):ft.type==="checkbox"||ft.type==="radio"?ft.checked&&Qe.append(ft.name,ft.value):(Fe=ft.type==="textarea"?Ee(ft.value):ft.value,Qe.append(ft.name,Fe))})};if((n=Qn.prototype).append=function(Ue,Qe,ft){_e(arguments,2),this.i.push(Te(Ue,Qe,ft))},n.delete=function(Ue){_e(arguments,1);var Qe=[];Ue=String(Ue),fe(this.i,function(ft){ft[0]!==Ue&&Qe.push(ft)}),this.i=Qe},n.entries=function Ue(){var Qe,ft=this;return oe(Ue,function(Fe){if(Fe.h==1&&(Qe=0),Fe.h!=3)return Qe<ft.i.length?Fe=D(Fe,ft.i[Qe]):(Fe.h=0,Fe=void 0),Fe;Qe++,Fe.h=2})},n.forEach=function(Ue,Qe){_e(arguments,1);for(var ft=g(this),Fe=ft.next();!Fe.done;Fe=ft.next()){var B=g(Fe.value);Fe=B.next().value,B=B.next().value,Ue.call(Qe,B,Fe,this)}},n.get=function(Ue){_e(arguments,1);var Qe=this.i;Ue=String(Ue);for(var ft=0;ft<Qe.length;ft++)if(Qe[ft][0]===Ue)return Qe[ft][1];return null},n.getAll=function(Ue){_e(arguments,1);var Qe=[];return Ue=String(Ue),fe(this.i,function(ft){ft[0]===Ue&&Qe.push(ft[1])}),Qe},n.has=function(Ue){_e(arguments,1),Ue=String(Ue);for(var Qe=0;Qe<this.i.length;Qe++)if(this.i[Qe][0]===Ue)return!0;return!1},n.keys=function Ue(){var Qe,ft,Fe,B,ue=this;return oe(Ue,function(ve){if(ve.h==1&&(Qe=g(ue),ft=Qe.next()),ve.h!=3)return ft.done?void(ve.h=0):(Fe=ft.value,B=g(Fe),D(ve,B.next().value));ft=Qe.next(),ve.h=2})},n.set=function(Ue,Qe,ft){_e(arguments,2),Ue=String(Ue);var Fe=[],B=Te(Ue,Qe,ft),ue=!0;fe(this.i,function(ve){ve[0]===Ue?ue&&(ue=!Fe.push(B)):Fe.push(ve)}),ue&&Fe.push(B),this.i=Fe},n.values=function Ue(){var Qe,ft,Fe,B,ue=this;return oe(Ue,function(ve){if(ve.h==1&&(Qe=g(ue),ft=Qe.next()),ve.h!=3)return ft.done?void(ve.h=0):(Fe=ft.value,(B=g(Fe)).next(),D(ve,B.next().value));ft=Qe.next(),ve.h=2})},Qn.prototype._asNative=function(){for(var Ue=new je,Qe=g(this),ft=Qe.next();!ft.done;ft=Qe.next()){var Fe=g(ft.value);ft=Fe.next().value,Fe=Fe.next().value,Ue.append(ft,Fe)}return Ue},Qn.prototype._blob=function(){var Ue="----formdata-polyfill-"+Math.random(),Qe=[],ft="--"+Ue+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Fe,B){return typeof Fe=="string"?Qe.push(ft+sn(Ee(B))+`"\r
\r
`+Ee(Fe)+`\r
`):Qe.push(ft+sn(Ee(B))+'"; filename="'+sn(Fe.name)+`"\r
Content-Type: `+(Fe.type||"application/octet-stream")+`\r
\r
`,Fe,`\r
`)}),Qe.push("--"+Ue+"--"),new Blob(Qe,{type:"multipart/form-data; boundary="+Ue})},Qn.prototype[Symbol.iterator]=function(){return this.entries()},Qn.prototype.toString=function(){return"[object FormData]"},Bt&&!Bt.matches&&(Bt.matches=Bt.matchesSelector||Bt.mozMatchesSelector||Bt.msMatchesSelector||Bt.oMatchesSelector||Bt.webkitMatchesSelector||function(Ue){for(var Qe=(Ue=(this.document||this.ownerDocument).querySelectorAll(Ue)).length;0<=--Qe&&Ue.item(Qe)!==this;);return-1<Qe}),dn&&(Qn.prototype[dn]="FormData"),Be){var ei=Re.XMLHttpRequest.prototype.setRequestHeader;Re.XMLHttpRequest.prototype.setRequestHeader=function(Ue,Qe){ei.call(this,Ue,Qe),Ue.toLowerCase()==="content-type"&&(this.B=!0)},Re.XMLHttpRequest.prototype.send=function(Ue){Ue instanceof Qn?(Ue=Ue._blob(),this.B||this.setRequestHeader("Content-Type",Ue.type),Be.call(this,Ue)):Be.call(this,Ue)}}dt&&(Re.fetch=function(Ue,Qe){return Qe&&Qe.body&&Qe.body instanceof Qn&&(Qe.body=Qe.body._blob()),dt.call(this,Ue,Qe)}),Ht&&(Re.navigator.sendBeacon=function(Ue,Qe){return Qe instanceof Qn&&(Qe=Qe._asNative()),Ht.call(this,Ue,Qe)}),Re.FormData=Qn}})();const mR=()=>{const n=re("AREAS");return n.length===0&&n.push(er.GLOBAL),lc(n).call(n,(i,s,o)=>{const d=SJ(s);return d?o===0?d:"".concat(i,",").concat(d):i},"")},SJ=n=>n===er.OVERSEA?"".concat(Oa.ASIA,",").concat(Oa.EUROPE,",").concat(Oa.AFRICA,",").concat(Oa.NORTH_AMERICA,",").concat(Oa.SOUTH_AMERICA,",").concat(Oa.OCEANIA):Oa[n],Kbe=n=>{const i={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return n.map(s=>{const o=pP[s],d=Object.keys(o);d&&d.map(h=>{h!=="CODE"&&(i[h]=i[h].concat(o[h]))})}),i},SP={GLOBAL:{ASIA:[er.CHINA,er.JAPAN,er.INDIA,er.KOREA,er.HKMC],EUROPE:[],NORTH_AMERICA:[er.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},TP=Object.keys(SP[er.GLOBAL]),e3=[er.CHINA,er.NORTH_AMERICA,er.EUROPE,er.ASIA,er.JAPAN,er.INDIA,er.OCEANIA,er.SOUTH_AMERICA,er.AFRICA,er.KOREA,er.HKMC,er.US],qbe=function(n,i){let s=[];if(Ge(n).call(n,er.GLOBAL)){const h=[er.GLOBAL,er.OVERSEA],f=Object.keys(pP);if(i===er.GLOBAL)throw new Ce(se.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(i===er.CHINA)s=[er.OVERSEA];else if(d=i,Ge(TP).call(TP,d)){const g=(o=i,SP[er.GLOBAL][o]||[]),y=[...h,i,...g];s=f.filter(x=>!Ge(y).call(y,x))}else if(function(g){let y=!1;return TP.forEach(x=>{var b;Ge(b=SP[er.GLOBAL][x]).call(b,g)&&(y=!0)}),y}(i)){const g=function(x){let b;return TP.forEach(N=>{var I;Ge(I=SP[er.GLOBAL][N]).call(I,x)&&(b=N)}),b}(i),y=[...h,g,i];s=f.filter(x=>!Ge(y).call(y,x))}else s=n;s=function(g){const y=[];return e3.forEach(x=>{Ge(g).call(g,x)&&y.push(x)}),y.concat(g.filter(x=>!Ge(e3).call(e3,x)))}(s)}else s=n;var o,d;return s};function TJ(n){var i,s;if(!n&&Ge(i=re("AREAS")).call(i,er.EXTENSIONS))return M.debug("update area from ap : reset"),void t3(nbe,!0);if(!Ge(s=re("AREAS")).call(s,er.GLOBAL)||!n)return;let o=pP.EXTENSIONS;o&&(o={CODE:SJ(er.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(n,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(n,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(n,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(n,".agora.io"),"cds-ap-web-2-".concat(n,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(n,".agora.io"),"sua-ap-web-2-".concat(n,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(n,".agora.io"),"uap-ap-web-2-".concat(n,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(n,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(n,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(n,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(n,".agora.io")]},M.debug("update area from ap success: ".concat(n,",config is "),o),xr("AREAS",[er.EXTENSIONS],!0),Object.keys(o).map(d=>{d==="LOG_UPLOAD_SERVER"||d==="EVENT_REPORT_DOMAIN"||d==="EVENT_REPORT_BACKUP_DOMAIN"||d==="PROXY_SERVER_TYPE3"?xr(d,o[d][0]):xr(d,o[d])}))}function t3(n){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=_t.reportApiInvoke(null,{name:Qr.SET_AREA,options:n,tag:Tr.TRACER});try{let o=[];if(typeof n=="string"&&(o=[n]),Array.isArray(n)&&(n.forEach(h=>{if(!Ge(YX).call(YX,h))throw new Ce(se.INVALID_PARAMS,"invalid area code")}),o=n),Object.prototype.toString.call(n)==="[object Object]"){const{areaCode:h,excludedArea:f}=n;if(!h)throw new Ce(se.INVALID_PARAMS,"area code is needed");let g=h;typeof h=="string"&&(g=[h]),o=f?qbe(g,f):g}if(!i){if(ql.AREAS){const h=new Ce(se.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return s.onError(h),void M.warning("setArea is prohibited because of config-distribute")}if(Ge(o).call(o,er.GLOBAL)&&re("AREAS")===er.EXTENSIONS){const h=new Ce(se.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return s.onError(h),void M.warning("setArea is prohibited because of ap extensions")}}xr("AREAS",o,i);const d=Kbe(o);Object.keys(d).map(h=>{h==="LOG_UPLOAD_SERVER"||h==="EVENT_REPORT_DOMAIN"||h==="EVENT_REPORT_BACKUP_DOMAIN"||h==="PROXY_SERVER_TYPE3"?xr(h,d[h][0]):xr(h,d[h])}),M.debug("set area success:",o.join(","))}catch(o){throw s.onError(o),o}s.onSuccess()}function RJ(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function af(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?RJ(Object(s),!0).forEach(function(o){Y(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):RJ(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}let n3=1;function Ybe(n,i,s,o,d){n3+=1;const h={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(Date.now()/1e3),seq:n3,requestId:n3,version:Pd,cname:s.cname},f={service_name:i,json_body:JSON.stringify(h)};let g,y,x=n[0];return Dh(async()=>{g=Date.now();const b=await Vh(x,{data:f,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(y=Date.now()-g,b.code!==0){const D=new Ce(se.UNEXPECTED_RESPONSE,"live streaming ap error, code"+b.code,{retry:!0,responseTime:y});throw M.error(D.toString()),D}const N=JSON.parse(b.json_body);if(N.code!==200){const D=new Ce(se.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(N.code,", reason: ").concat(N.reason),{code:N.code,responseTime:y});throw M.error(D.toString()),D}if(!N.servers||N.servers.length===0){const D=new Ce(se.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:N.code,responseTime:y});throw M.error(D.toString()),D}const I=function(D,$){return{addressList:D.servers.map(z=>"wss://".concat(z.address.replace(/\./g,"-"),".").concat(re("WORKER_DOMAIN"),":").concat(z.wss,"?serviceName=").concat(encodeURIComponent($))),workerToken:D.workerToken,vid:D.vid}}(N,i);return re("LIVE_STREAMING_ADDRESS")&&(I.addressList=re("LIVE_STREAMING_ADDRESS")instanceof Array?re("LIVE_STREAMING_ADDRESS"):[re("LIVE_STREAMING_ADDRESS")]),af(af({},I),{},{responseTime:y})},(b,N)=>(_t.apworkerEvent(s.sid,{success:!0,sc:200,serviceName:i,responseDetail:JSON.stringify(b.addressList),firstSuccess:N===0,responseTime:y,serverIp:n[N%n.length]}),!1),(b,N)=>(_t.apworkerEvent(s.sid,{success:!1,sc:b.data&&b.data.code||200,serviceName:i,responseTime:y,serverIp:n[N%n.length]}),!!(b.code!==se.OPERATION_ABORTED&&b.code!==se.UNEXPECTED_RESPONSE||b.data&&b.data.retry)&&(x=n[(N+1)%n.length],!0)),d)}let r3=1;function CJ(n,i,s,o){let{url:d,areaCode:h}=n;const{clientId:f,sid:g}=i,y=Date.now();let x;const b=i.role,[N,I]=s3(i,h,[Wi.CHOOSE_SERVER]);let D=wi.networkState;return Dh(async()=>{D&&wi.networkState===jo.OFFLINE&&wi.onlineWaiter&&await et.race([wi.onlineWaiter,As(o&&o.maxRetryTimeout||Gi.maxRetryTimeout)]),D=wi.networkState;const{data:$,headers:z}=await Vh(d,{data:N,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);x=z.http3==="1"?1:-1,_t.reportResourceTiming(d,g),IJ($,d,i,y,[Wi.CHOOSE_SERVER],x);const K=lR($,Wi.CHOOSE_SERVER);return i3(K),W4(K,d)},$=>($&&_t.joinChooseServer(g,{role:b,lts:y,succ:!0,csAddr:d,opid:I,serverList:$.gatewayAddrs.map(z=>z.address),ec:null,cid:$.cid.toString(),uid:$.uid.toString(),csIp:$.csIp,unilbsServerIds:[Wi.CHOOSE_SERVER].toString(),isHttp3:x,corssRegionTagReq:i.apRequestDetail,corssRegionTagRes:$.res.detail&&$.res.detail[38],vid:$.vid}),!1),$=>$.code!==se.OPERATION_ABORTED&&($.code===se.CAN_NOT_GET_GATEWAY_SERVER?$.data.retry:(_t.joinChooseServer(g,{role:b,lts:y,succ:!1,csAddr:d,serverList:null,opid:I,ec:$.code,csIp:$.data&&$.data.csIp,unilbsServerIds:[Wi.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:D}),isHttp3:x,corssRegionTagReq:i.apRequestDetail}),M.warning("[".concat(f||"sid-".concat(g.slice(0,6)),"] Choose server network error, retry"),$),!0)),o)}function NJ(n,i,s,o){let d,{url:h,areaCode:f,serviceIds:g}=n;const y=Date.now(),x=i.role,[b,N]=s3(i,f,g);let I;return Dh(async()=>{I&&wi.networkState===jo.OFFLINE&&wi.onlineWaiter&&await et.race([wi.onlineWaiter,As(o&&o.maxRetryTimeout||Gi.maxRetryTimeout)]),I=wi.networkState;const{data:D,headers:$}=await Vh(h,{data:b,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);d=$.http3==="1"?1:-1,_t.reportResourceTiming(h,i.sid),IJ(D,h,i,y,g,d);const z=lR(D,Wi.CHOOSE_SERVER),K=lR(D,i.cloudProxyServer==="proxy5"?Wi.CLOUD_PROXY_5:i.cloudProxyServer==="proxy3"||i.cloudProxyServer==="proxy4"?Wi.CLOUD_PROXY:Wi.CLOUD_PROXY_FALLBACK),ie=performance.getEntriesByName(h),oe=ie[ie.length-1];let fe;return oe&&(fe={name:oe.name,protocol:"nextHopProtocol"in oe?oe.nextHopProtocol:"",dnscost:"domainLookupEnd"in oe&&"domainLookupStart"in oe&&typeof oe.domainLookupEnd=="number"&&typeof oe.domainLookupStart=="number"?oe.domainLookupEnd-oe.domainLookupStart:-1,tcpTlsCost:"connectEnd"in oe&&"connectStart"in oe&&typeof oe.connectEnd=="number"&&typeof oe.connectStart=="number"?oe.connectEnd-oe.connectStart:-1,reqCost:"requestStart"in oe&&typeof oe.requestStart=="number"&&"responseEnd"in oe&&typeof oe.responseEnd=="number"?oe.responseEnd-oe.requestStart:-1,handleCost:"leave_ts"in D&&"enter_ts"in D&&typeof D.leave_ts=="number"&&typeof D.enter_ts=="number"?D.leave_ts-D.enter_ts:-1}),i3(z),{gatewayInfo:W4(z,h),proxyInfo:K,url:h,resourceTimingInfo:fe}},D=>{var $;return D.gatewayInfo&&_t.joinChooseServer(i.sid,{role:x,lts:y,succ:!0,csAddr:h,serverList:D.gatewayInfo.gatewayAddrs.map(z=>z.address),ec:null,opid:N,cid:D.gatewayInfo.cid.toString(),uid:D.gatewayInfo.uid.toString(),csIp:D.gatewayInfo.csIp,unilbsServerIds:g.toString(),isHttp3:d,corssRegionTagReq:i.apRequestDetail,corssRegionTagRes:D.gatewayInfo.res.detail&&D.gatewayInfo.res.detail[38],vid:($=D.gatewayInfo)===null||$===void 0?void 0:$.vid,resourceTimingInfo:D.resourceTimingInfo?JSON.stringify(D.resourceTimingInfo):void 0}),D.proxyInfo&&_t.joinWebProxyAP(i.sid,{lts:y,sucess:1,apServerAddr:h,turnServerAddrList:D.proxyInfo.addresses.map(z=>z.ip).join(","),errorCode:null,eventType:i.cloudProxyServer,unilbsServerIds:g.toString()}),!1},D=>D.code!==se.OPERATION_ABORTED&&(D.code===se.CAN_NOT_GET_GATEWAY_SERVER?D.data.retry:(_t.joinWebProxyAP(i.sid,{lts:y,sucess:0,apServerAddr:h,turnServerAddrList:null,errorCode:D.code,eventType:i.cloudProxyServer,unilbsServerIds:g.toString(),extend:JSON.stringify({networkState:I})}),M.warning("[".concat(i.clientId,"] multi unilbs network error, retry"),D),!0)),o)}const IJ=(n,i,s,o,d,h)=>{const{sid:f,clientId:g,cloudProxyServer:y}=s,x=[],b=N=>{N.flag===4096?_t.joinChooseServer(f,{role:s.role,lts:o,succ:!1,csAddr:i,opid:n.opid,serverList:null,ec:N.error.message,csIp:N.error.data&&N.error.data.csIp,unilbsServerIds:d.toString(),isHttp3:h,corssRegionTagReq:s.apRequestDetail}):N.flag!==1048576&&N.flag!==4194304&&N.flag!==4194310||_t.joinWebProxyAP(f,{lts:o,sucess:0,apServerAddr:i,turnServerAddrList:null,errorCode:N.error.code,eventType:y,unilbsServerIds:d.toString()})};if(n.response_body.forEach(N=>{const I=N.buffer.code;if(N.uri===23&&I===0&&!N.buffer.edges_services)if(N.buffer.flag===4194310)M.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),N.buffer.edges_services=[];else{const D={error:new Ce(se.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:re("NO_EDGES_RETRY"),csIp:n.detail[502]}),flag:N.buffer.flag};x.push(D),b(D)}if(I!==0){const D=Lx(I),$={error:new Ce(se.CAN_NOT_GET_GATEWAY_SERVER,D.desc,{desc:D.desc,retry:D.retry,csIp:n.detail[502]}),flag:N.buffer.flag};N.buffer.flag===4194310?M.warning($.error.toString()):x.push($),b($)}}),x.length)throw M.warning("[".concat(g||"sid-".concat(f.slice(0,6)),"] multi unilbs ").concat(i," failed, ").concat(x.map(N=>"flag: ".concat(N.flag,", message: ").concat(N.error.message,", retry: ").concat(N.error.data.retry)).join(" | "))),new Ce(se.CAN_NOT_GET_GATEWAY_SERVER,x.map(N=>"flag: ".concat(N.flag,", message: ").concat(N.error.message)).join(" | "),{retry:!!x.find(N=>N.error.data.retry),csIp:n.detail[502],desc:[...new Set(x.map(N=>{var I;return N==null||(I=N.error)===null||I===void 0||(I=I.data)===null||I===void 0?void 0:I.desc}).filter(N=>!!N))]})},i3=n=>{var i,s,o,d;if(n.addresses&&n.addresses.length===0&&n.code===0)throw new Ce(se.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:n.detail&&n.detail[502]});if(re("AP_AREA")&&((o=n.detail)!==null&&o!==void 0&&o[23]&&typeof((d=n.detail)===null||d===void 0?void 0:d[23])=="string"?TJ(n.detail[23].toLowerCase()):TJ()),(i=n.detail)!==null&&i!==void 0&&i[19]&&typeof((s=n.detail)===null||s===void 0?void 0:s[19])=="string"){const f=n.detail[19],g=f==null?void 0:f.split(";");for(let y=0;y<g.length;y++){var h;const x=Oo(h=g[y]).call(h);n.addresses[y]&&g&&(n.addresses[y].fingerprint=x)}}if(re("GATEWAY_ADDRESS")&&re("GATEWAY_ADDRESS").length>0){M.debug("assign gateway address to",re("GATEWAY_ADDRESS"));const f=re("GATEWAY_ADDRESS").map(g=>{var y,x;const b=(y=(x=n.addresses.find(N=>N.ip===g.ip&&N.port===g.port))===null||x===void 0?void 0:x.fingerprint)!==null&&y!==void 0?y:"";return{ip:g.ip,port:g.port,ticket:n.addresses[0]&&n.addresses[0].ticket,fingerprint:g.fingerprint||b}});n.addresses=f}},$be=(n,i)=>{if(n.response_body&&n.response_body.length){const s=n.response_body[0];if(s.buffer.code!==0){const o=Lx(s.buffer.code);throw new Ce(se.UPDATE_TICKET_FAILED,"[".concat(s.buffer.code,"]: ").concat(o.desc),{retry:o.retry})}return s.buffer.ticket}throw M.debug("update ticket request received ap response without response body:",i),new Ce(se.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},s3=(n,i,s)=>{const o=Math.floor(Math.random()*1e12),d=n.role==="host"?"1":n.role==="audience"?"2":void 0,h={appid:n.appId,client_ts:Date.now(),opid:o,sid:n.sid,request_bodies:[{uri:22,buffer:{cname:n.cname,detail:af(af(af({6:n.stringUid,11:i,12:re("USE_NEW_TOKEN")?"1":void 0},d?{17:d}:{}),{},{22:i},n.apRequestDetail?{33:n.apRequestDetail}:{}),n.apRTM?{26:"RTM2"}:{}),key:n.token,service_ids:s,uid:n.uid||0}}]};h.request_bodies.forEach(g=>{n.multiIP&&n.multiIP.gateway_ip&&(g.buffer.detail[5]=JSON.stringify({vocs_ip:[n.multiIP.uni_lbs_ip],vos_ip:[n.multiIP.gateway_ip]}))});const f=new FormData;return f.append("request",JSON.stringify(h)),[f,o]},Xbe=(n,i)=>{const s=Math.floor(Math.random()*1e12),o={appid:n.appId,client_ts:Date.now(),opid:s,sid:n.sid,request_bodies:[{uri:28,buffer:{cname:n.cname,detail:{1:"",6:n.stringUid,12:"1"},token:n.token,service_ids:i,uid:n.uid||0,edges_services:n.apResponse.addresses.map(h=>({ip:h.ip,port:h.port}))}}]},d=new FormData;return d.append("request",JSON.stringify(o)),[d,s]};let Ux=0;function Vx(n){return et.all(n.map(i=>i.then(s=>{throw s},s=>s))).then(i=>{throw i},i=>i)}const gR=async n=>{let{fragementLength:i,referenceList:s,asyncMapHandler:o,allFailedhandler:d,promisesCollector:h}=n,f=0;const g=i;let y,x=0;const b=async()=>{const N=(()=>{const I=f*g,D=I+g;return s.slice(I,D).map(o)})();h&&h.push(...N);try{y=await Vx(N)}catch(I){if(x+=g,f++,!(x>=s.length))return void await b();d(I)}N.forEach(I=>I.cancel())};return await b(),y},AJ=async n=>{let{referenceList:i,asyncMapHandler:s,closeFn:o}=n;const d=i.length;let h=0;const f=async()=>{const g=s(i.shift());try{return await g}catch(y){if(h++,h>=d||o!=null&&o(y))throw y;return f()}};return f()};async function Jbe(){if(typeof VideoDecoder>"u")return!0;let n;const i=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],s=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],o=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],d=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],h=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],f=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new et((y,x)=>{let b;(async function(){n&&n.state!=="closed"||await async function(){n=new VideoDecoder({output:I=>{I.close(),clearTimeout(b),y(!0)},error:I=>{clearTimeout(b),y(!1)}}),await n.configure({codec:"av01.0.05M.08",width:160,height:90})}();const N=[i,s,o,d,h,f];for(let I=0;I<N.length;I++){const D=new EncodedVideoChunk({type:I==0?"key":"delta",timestamp:33333*I,duration:33333,data:new Uint8Array(N[I])});try{await n.decode(D)}catch{return void y(!1)}}})(),b=setTimeout(()=>{y(!1)},5e3)})}async function RP(n,i,s,o){return{gatewayInfo:await async function(h,f,g,y){let x=null;const b=[],N=async()=>{const D=re("WEBCS_DOMAIN").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(K=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(K+"/api/v2/transpond/webrtc?v=2"):"https://".concat(K,"/api/v2/transpond/webrtc?v=2"),areaCode:mR()})),$=y.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(K=>K.url)}),z=await gR({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:K=>(M.debug("[".concat(h.clientId,"] Connect to choose_server:"),K.url),CJ(K,h,f,g)),allFailedhandler:K=>{throw y.recordJoinChannelService({endTs:Date.now(),status:"error",errors:K},$),K[0]},promisesCollector:b});return y.recordJoinChannelService({endTs:Date.now(),status:"success"},$),z},I=async()=>{if(await As(1e3),x!==null)return x;const D=re("WEBCS_DOMAIN_BACKUP_LIST").map(K=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(K+"/api/v2/transpond/webrtc?v=2"):"https://".concat(K,"/api/v2/transpond/webrtc?v=2"),areaCode:mR()})),$=y.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(K=>K.url)}),z=await gR({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:K=>(M.debug("[".concat(h.clientId,"] Connect to backup choose_server:"),K.url),CJ(K,h,f,g)),allFailedhandler:K=>{throw y.recordJoinChannelService({endTs:Date.now(),status:"error",errors:K},$),K[0]},promisesCollector:b});return y.recordJoinChannelService({endTs:Date.now(),status:"success"},$),z};try{return x=await Vx([N(),I()]),b.length&&b.forEach(D=>D.cancel&&typeof D.cancel=="function"&&D.cancel()),x}catch(D){throw D[0]}}(n,i,s,o)}}async function kJ(n,i,s,o,d){const h=n.cloudProxyServer;if(h==="disabled"){if(n.useLocalAccessPoint)return await RP(n,i,s,d);if(re("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:I,proxyInfo:D}=await OJ(n,i,s,d);if(n.turnServer&&n.turnServer.mode!=="auto")return{gatewayInfo:I};const $=D.map(z=>({turnServerURL:z.address,tcpport:z.tcpport||Ea.tcpport,udpport:z.udpport||Ea.udpport,username:z.username||Ea.username,password:z.password||Ea.password,forceturn:!1,security:!0}));if(d.useP2P){var f;const z=(f=n.uid)!==null&&f!==void 0?f:I.uid,K="glb:".concat(z.toString()),ie=await BV(K),oe=D.map(fe=>({turnServerURL:fe.address,tcpport:fe.tcpport||Ea.tcpport,udpport:fe.udpport||Ea.udpport,username:K,password:ie,forceturn:!1,security:!0}));$.push(...oe)}return n.turnServer={mode:"manual",servers:$},{gatewayInfo:I}}return await RP(n,i,s,d)}const{proxyInfo:g,gatewayInfo:y}=await OJ(n,i,s,d),x={gatewayInfo:y},b=g.map(I=>({turnServerURL:I.address,tcpport:h==="proxy3"?void 0:I.tcpport?I.tcpport:Ea.tcpport,udpport:h==="proxy4"?void 0:I.udpport?I.udpport:Ea.udpport,username:I.username||Ea.username,password:I.password||Ea.password,forceturn:h!=="proxy4",security:h==="proxy5"}));if(d.useP2P){var N;const I=(N=n.uid)!==null&&N!==void 0?N:y.uid,D="glb:".concat(I.toString()),$=await BV(D),z=g.map(K=>({turnServerURL:K.address,tcpport:h==="proxy3"?void 0:K.tcpport||Ea.tcpport,udpport:h==="proxy4"?void 0:K.udpport||Ea.udpport,username:D,password:$,forceturn:h!=="proxy4",security:h==="proxy5"}));b.push(...z)}return n.turnServer={mode:"manual",servers:b},M.debug("[".concat(n.clientId,"] set proxy server: ").concat(n.proxyServer,", mode: ").concat(h)),x}async function PJ(n,i,s,o,d){const h=re("ACCOUNT_REGISTER").slice(0,re("AJAX_REQUEST_CONCURRENT"));let f=[];f=i.proxyServer?h.map(y=>"https://".concat(i.proxyServer,"/ap/?url=").concat(y+"/api/v1")):h.map(y=>"https://".concat(y,"/api/v1"));const g=d==null?void 0:d.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:f});try{const y=await async function(x,b,N,I,D){const $=Date.now(),z={sid:N.sid,opid:10,appid:N.appId,string_uid:b};let K=x[0];const ie=await Dh(()=>Vh(K+"".concat(K.indexOf("?")===-1?"?":"&","action=stringuid"),{data:z,cancelToken:I,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(oe,fe)=>{if(oe.code===0){if(oe.uid<=0||oe.uid>=Math.pow(2,32))throw M.error("Invalid Uint Uid ".concat(b," => ").concat(oe.uid),oe),_t.reqUserAccount(z.sid,{lts:$,success:!1,serverAddr:K,stringUid:z.string_uid,uid:oe.uid,errorCode:se.INVALID_UINT_UID_FROM_STRING_UID,extend:z}),new Ce(se.INVALID_UINT_UID_FROM_STRING_UID);return _t.reqUserAccount(z.sid,{lts:$,success:!0,serverAddr:K,stringUid:z.string_uid,uid:oe.uid,errorCode:null,extend:z}),!1}const Ee=Lx(oe.code);return Ee.retry&&(K=x[(fe+1)%x.length]),_t.reqUserAccount(z.sid,{lts:$,success:!1,serverAddr:K,stringUid:z.string_uid,uid:oe.uid,errorCode:Ee.desc,extend:z}),Ee.retry},(oe,fe)=>oe.code!==se.OPERATION_ABORTED&&(_t.reqUserAccount(z.sid,{lts:$,success:!1,serverAddr:K,stringUid:z.string_uid,uid:null,errorCode:oe.code,extend:z}),K=x[(fe+1)%x.length],!0),D);if(ie.code!==0){const oe=Lx(ie.code);throw new Ce(se.UNEXPECTED_RESPONSE,oe.desc)}return ie}(f,n,i,s,o);return d==null||d.recordJoinChannelService({status:"success",endTs:Date.now()},g),y.uid}catch(y){throw d==null||d.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[y]},g),y}}async function Qbe(n,i,s){const o=re("ACCOUNT_REGISTER");let d=[];d=i.proxyServer?o.map(h=>"https://".concat(i.proxyServer,"/ap/?url=").concat(h+"/api/v1")):o.map(h=>"https://".concat(h,"/api/v1"));try{return await AJ({referenceList:d,asyncMapHandler:f=>async function(g,y,x,b){const N=Date.now(),I={sid:x.sid,opid:10,appid:x.appId,string_uid:y};try{const D=await Vh(g+"".concat(g.indexOf("?")===-1?"?":"&","action=stringuid"),{data:I,cancelToken:b,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(D.code!==0){const $=Lx(D.code);throw new Ce(se.UNEXPECTED_RESPONSE,"preload sua error:".concat($.desc),$)}if(D.uid<=0||D.uid>=Math.pow(2,32))throw new Ce(se.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:N,url:g,req:I,uid:D.uid,elapse:Date.now()-N}}catch(D){throw D}}(f,n,i,s),closeFn:f=>f.code===se.OPERATION_ABORTED||f.code===se.UNEXPECTED_RESPONSE&&!f.data.retry})}catch(h){throw h}}async function Zbe(n,i,s){const o=re("CDS_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(y=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(y+"/api/v1"):"https://".concat(y,"/api/v1?action=config")),d=o.map(y=>function(x,b,N,I){const D=Wn(),$={flag:64,cipher_method:0,features:af(af(af(af(af({install_id:e4(),device:D.name,system:D.os,system_general:navigator.userAgent,vendor:b.appId,version:Pd,cname:b.cname,session_id:b.sid,proxyServer:b.proxyServer,sdk_type:Gbe.WEB_RTC,browser_name:D.name,browser_version:D.version,user_agent:navigator.userAgent,channel_name:b.cname},b.stringUid&&{string_uid:b.stringUid}),b.uid&&{uid:b.uid+""}),D.os&&{os_name:D.os}),D.osVersion&&{os_version:D.osVersion}),{},{detail:""})};return Dh(()=>Vh(x,{data:$,timeout:1e3,cancelToken:N,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,z=>z.code!==se.OPERATION_ABORTED,I)}(y,n,i,s));let h=null,f=null,g={};try{h=await Vx(d)}catch(y){if(y.code===se.OPERATION_ABORTED)throw y;f=y}if(d.forEach(y=>y.cancel()),_t.reportApiInvoke(n.sid,{name:Qr.REQUEST_CONFIG_DISTRIBUTE,options:{error:f,res:h}}).onSuccess(),h&&h.test_tags)try{g=function(y){if(!y.test_tags)return{};const x=y.test_tags,b=Object.keys(x),N={};return b.forEach(I=>{var D;const $=Oo(D=I.slice(4)).call(D),z=JSON.parse(x[I]),K=z[1];N[$]={tag:z[0]||"",value:K}}),N}(h)}catch{}return g}async function DJ(n,i){const s=re("WEBCS_DOMAIN").concat(re("WEBCS_DOMAIN_BACKUP_LIST")).map(o=>({url:"https://".concat(o,"/api/v2/transpond/webrtc?v=2"),areaCode:mR(),serviceIds:[Wi.CHOOSE_SERVER,Wi.CLOUD_PROXY_FALLBACK]}));try{return await AJ({referenceList:s,asyncMapHandler:d=>async function(h,f,g){let y,{url:x,areaCode:b,serviceIds:N}=h;const I=Date.now(),[D,$]=s3(f,b,N);let z=wi.networkState;try{z&&wi.networkState===jo.OFFLINE&&wi.onlineWaiter&&await et.race([wi.onlineWaiter,As(Gi.maxRetryTimeout)]),z=wi.networkState;const{data:K,headers:ie}=await Vh(x,{data:D,cancelToken:g,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);y=ie.http3==="1"?1:-1,(Te=>{const _e=[];if(Te.response_body.forEach(Re=>{const je=Re.buffer.code;if(Re.uri===23&&je===0&&!Re.buffer.edges_services)if(Re.buffer.flag===4194310)Re.buffer.edges_services=[];else{const Be={error:new Ce(se.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:re("NO_EDGES_RETRY"),csIp:Te.detail[502]}),flag:Re.buffer.flag};_e.push(Be)}if(je!==0){const Be=Lx(je),dt={error:new Ce(se.CAN_NOT_GET_GATEWAY_SERVER,Be.desc,{desc:Be.desc,retry:Be.retry,csIp:Te.detail[502]}),flag:Re.buffer.flag};Re.buffer.flag===4194310?M.warning(dt.error.toString()):_e.push(dt)}}),_e.length)throw new Ce(se.CAN_NOT_GET_GATEWAY_SERVER,_e.map(Re=>"flag: ".concat(Re.flag,", message: ").concat(Re.error.message)).join(" | "),{retry:!!_e.find(Re=>Re.error.data.retry),csIp:Te.detail[502],desc:[...new Set(_e.map(Re=>{var je;return Re==null||(je=Re.error)===null||je===void 0||(je=je.data)===null||je===void 0?void 0:je.desc}).filter(Re=>!!Re))]})})(K);const fe=lR(K,Wi.CHOOSE_SERVER),Ee=lR(K,Wi.CLOUD_PROXY_FALLBACK);return i3(fe),{gatewayInfo:W4(fe,x),proxyInfo:Ee,opid:$,requestTime:I,url:x,isHttp3:y,elapse:Date.now()-I}}catch(K){throw K}}(d,n,i),closeFn:d=>d.code===se.OPERATION_ABORTED||d.code===se.CAN_NOT_GET_GATEWAY_SERVER&&!d.data.retry})}catch(o){throw o}}async function OJ(n,i,s,o){const d=re("PROXY_SERVER_TYPE3"),h=(D,$,z)=>{let K=z||d;return Array.isArray(K)&&(K=$%2==0&&d[1]||d[0]),"https://".concat(K,"/ap/?url=").concat(D)};let f=null;const g=[],y=async()=>{const D=re("WEBCS_DOMAIN").slice(0,re("AJAX_REQUEST_CONCURRENT")).map((K,ie)=>{let oe;return oe=n.cloudProxyServer==="disabled"&&n.proxyServer?h("".concat(K,"/api/v2/transpond/webrtc?v=2"),ie,n.proxyServer):n.cloudProxyServer==="disabled"||n.cloudProxyServer==="fallback"?"https://".concat(K,"/api/v2/transpond/webrtc?v=2"):h("".concat(K,"/api/v2/transpond/webrtc?v=2"),ie),{url:oe,areaCode:mR(),serviceIds:[Wi.CHOOSE_SERVER,n.cloudProxyServer==="proxy5"?Wi.CLOUD_PROXY_5:n.cloudProxyServer==="proxy3"||n.cloudProxyServer==="proxy4"?Wi.CLOUD_PROXY:Wi.CLOUD_PROXY_FALLBACK]}}),$=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(K=>K.url)}),z=await gR({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:K=>(M.debug("[".concat(n.clientId,"] Connect to choose_server:"),K.url),NJ(K,n,i,s)),allFailedhandler:K=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:K},$),K[0]},promisesCollector:g});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},$),z},x=async()=>{if(await As(1e3),f!==null)return f;const D=re("WEBCS_DOMAIN_BACKUP_LIST").map((K,ie)=>{let oe;return oe=n.cloudProxyServer==="disabled"&&n.proxyServer?h("".concat(K,"/api/v2/transpond/webrtc?v=2"),ie,n.proxyServer):n.cloudProxyServer==="disabled"||n.cloudProxyServer==="fallback"?"https://".concat(K,"/api/v2/transpond/webrtc?v=2"):h("".concat(K,"/api/v2/transpond/webrtc?v=2"),ie),{url:oe,areaCode:mR(),serviceIds:[Wi.CHOOSE_SERVER,n.cloudProxyServer==="proxy5"?Wi.CLOUD_PROXY_5:n.cloudProxyServer==="proxy3"||n.cloudProxyServer==="proxy4"?Wi.CLOUD_PROXY:Wi.CLOUD_PROXY_FALLBACK]}}),$=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(K=>K.url)}),z=await gR({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:K=>(M.debug("[".concat(n.clientId,"] Connect to backup choose_server:"),K.url),NJ(K,n,i,s)),allFailedhandler:K=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:K},$),K[0]},promisesCollector:g});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},$),z};let b,N,I;try{({gatewayInfo:b,proxyInfo:N,url:I}=await Vx([y(),x()]))}catch(D){throw D[0]}if(g.length&&g.forEach(D=>D.cancel&&typeof D.cancel=="function"&&D.cancel()),!b||!N)throw new Ce(se.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(n.apUrl=I,n.cloudProxyServer!=="disabled"&&Array.isArray(d)&&I){const D=/^https?:\/\/(.+?)(\/.*)?$/.exec(I)[1];Ge(d).call(d,D)&&(n.proxyServer=D,M.setProxyServer(D),_t.setProxyServer(D))}return f={gatewayInfo:b,proxyInfo:await iJ(N,b.uid)},f}async function ewe(n,i,s){const o=re("UAP_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(h=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(h+"/api/v1?action=uap"):"https://".concat(h,"/api/v1?action=uap")),d=o.map(h=>function(f,g,y,x){const b={command:"convergeAllocateEdge",sid:g.sid,appId:g.appId,token:g.token,ts:Date.now(),version:Pd,cname:g.cname,uid:g.uid.toString(),requestId:r3,seq:r3};r3+=1;const N={service_name:"tele_channel",json_body:JSON.stringify(b)};return Dh(async()=>{const I=await Vh(f,{data:N,cancelToken:y,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(I.code!==0){const $=new Ce(se.UNEXPECTED_RESPONSE,"cross channel ap error, code"+I.code,{retry:!0});throw M.error($.toString()),$}const D=JSON.parse(I.json_body);if(D.code!==200){const $=new Ce(se.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(D.code,", reason: ").concat(D.reason));throw M.error($.toString()),$}if(!D.servers||D.servers.length===0){const $=new Ce(se.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw M.error($.toString()),$}return{vid:D.vid,workerToken:D.workerToken,addressList:(re("CHANNEL_MEDIA_RELAY_SERVERS")||D.servers).map($=>"wss://".concat($.address.replace(/\./g,"-"),".").concat(re("WORKER_DOMAIN"),":").concat($.wss))}},void 0,I=>!!(I.code!==se.OPERATION_ABORTED&&I.code!==se.UNEXPECTED_RESPONSE||I.data&&I.data.retry),x)}(h,n,i,s));try{const h=await Vx(d);return d.forEach(f=>f.cancel()),h}catch(h){throw h[0]}}async function twe(n,i,s){let o=null;const d=[],h=async f=>{const g=re(f?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(y=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(y+"/api/v2/transpond/webrtc?v=2"):"https://".concat(y,"/api/v2/transpond/webrtc?v=2"));return f&&(await As(1e3),o!==null)?o:await gR({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:y=>(M.debug("[".concat(n.clientId,"] update ticket, Connect to ").concat(f?"backup":""," choose_server:"),y),function(x,b,N,I){const[D]=Xbe(b,[Wi.CHOOSE_SERVER]);let $=wi.networkState;return Dh(async()=>{$&&wi.networkState===jo.OFFLINE&&wi.onlineWaiter&&await et.race([wi.onlineWaiter,As(I&&I.maxRetryTimeout||Gi.maxRetryTimeout)]),$=wi.networkState;const z=await Vh(x,{data:D,cancelToken:N,headers:{"Content-Type":"multipart/form-data;"}},!0);return $be(z,x)},()=>!1,z=>z.code!==se.OPERATION_ABORTED&&(z.code===se.UPDATE_TICKET_FAILED?z.data.retry:(M.warning("[".concat(b.clientId,"] update ticket network error, retry"),z),!0)),I)}(y,n,i,s)),allFailedhandler:y=>{throw y[0]},promisesCollector:d})};try{return o=await Vx([h(!1),h(!0)]),d.length&&d.forEach(f=>f.cancel&&typeof f.cancel=="function"&&f.cancel()),o}catch(f){throw f[0]}}function LJ(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function a3(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?LJ(Object(s),!0).forEach(function(o){Y(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):LJ(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}class nwe extends ai{get isSuccess(){return!!this.configs}constructor(i,s){super(),Y(this,"configs",void 0),Y(this,"store",void 0),Y(this,"joinInfo",void 0),Y(this,"cancelToken",void 0),Y(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),Y(this,"interval",void 0),Y(this,"mutex",void 0),Y(this,"mutableParamsRead",!1),Y(this,"configCache",{}),Y(this,"limit_bitrate",void 0),this.mutex=new qs("config-distribute",i),this.store=s}startGetConfigDistribute(i,s){this.joinInfo=i,this.cancelToken=s,this.interval&&this.stopGetConfigDistribute(),re("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},re("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,_t.reportApiInvoke(null,{options:void 0,name:Qr.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Tr.TRACER}).onSuccess(JSON.stringify(ql))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void M.debug("[config-distribute] get config distribute interrupted have no joininfo");let i;const s=await this.mutex.lock();try{i=await Zbe(this.joinInfo,this.cancelToken,this.retryConfig),M.debug("[config-distribute] get config distribute",JSON.stringify(i));const o=function(d){var h;const f=sm(h=Object.keys(d).filter(x=>/^webrtc_ng_global_parameter/.test(x))).call(h);for(let x=0;x<f.length;x++)for(let b=f.length-1;b>x;b--){const N=f[b],I=d[N].value;if(typeof I.__priority=="number"){const D=I.__priority,$=f[b-1],z=d[$].value;if(typeof z.__priority=="number"){if(!(D>z.__priority))continue;{const K=N;f[b]=f[b-1],f[b-1]=K}}else{const K=N;f[b]=f[b-1],f[b-1]=K}}}const g=Date.now(),y={};return f.forEach(x=>{const b=d[x].value.__expires;b&&b<=g||(y[x]=d[x])}),y}(i);this.cacheGlobalParameterConfig(o),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=o}catch(o){const d=new Ce(se.NETWORK_RESPONSE_ERROR,o);M.warning("[config-distribute] ".concat(d.toString()))}finally{s()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(i){$X(i)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==i.id&&this.emit(jh.UPDATE_BITRATE_LIMIT,i):this.emit(jh.UPDATE_BITRATE_LIMIT,i))}getLowStreamConfigDistribute(){return this.limit_bitrate&&a3({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(i){try{const s={},o=Object.keys(i),d=[];o.forEach(h=>{const f=i[h].value;s[h]=f;const g=f.__id;if(g&&this.configCache[h]&&this.configCache[h].__id===g)return;const y=f.__type,x=i[h].value,b=i[h].tag;let N=0;y?y===fY.REALTIME&&(N=1):Object.keys(x).some(I=>Object.prototype.hasOwnProperty.call(i4,I)||!P4()&&Object.prototype.hasOwnProperty.call(Gk,I)?(N=1,!0):void 0),d.push({tag:b,isApplied:N,feature:h,params:JSON.stringify(f)})}),d.forEach(h=>{let{tag:f,feature:g,params:y,isApplied:x}=h;this.store.sessionId&&_t.abTest(this.store.sessionId,{intSucc:1,isApplied:x,tag:f,feature:g,params:y,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=s}catch(s){M.debug("handleABTestConfigDistribute error",s)}}cacheGlobalParameterConfig(i){const s=function(d){const h={};return Object.keys(d).forEach(f=>{const g=d[f].value,y=g.__expires,x=g.__type;Object.keys(g).forEach(b=>{b==="__id"||b==="__type"||b==="__priority"||b==="__expires"||Object.prototype.hasOwnProperty.call(h,b)||(h[b]=a3(a3({value:g[b]},y&&{expires:y}),x&&{type:x}))})}),h}(i);try{var o;const d=(o=s.LIMIT_BITRATE)===null||o===void 0?void 0:o.value;delete s.LIMIT_BITRATE,d&&$X(d)&&this.handleBitrateLimit(d),this.limit_bitrate=d,this.handleGlobalParameterConfig(s),this.handleABTestConfigDistribute(i),function(g){try{const y=Date.now();Object.keys(g).forEach(x=>{const{value:b,type:N,expires:I}=g[x];I&&I<=y||((N===fY.REALTIME||Object.prototype.hasOwnProperty.call(i4,x))&&(ql[x]=b,ur[x]=b,M.debug("Update realtime parameters from config distribute",x,b)),N||P4()||!Object.prototype.hasOwnProperty.call(Gk,x)||(ql[x]=b,ur[x]=b,M.debug("Update gateway parameters from config distribute",x,b)))})}catch(y){M.error("Error update config immediately: ".concat(g),y.message)}}(s);const h=JSON.stringify(s),f=window.btoa(h);window.localStorage.setItem("websdk_ng_global_parameter",f),M.debug("Caching global parameters ".concat(h))}catch(d){M.error("Error caching global parameters:",d.message)}}handleGlobalParameterConfig(i){try{const s=Date.now();Object.keys(i).forEach(o=>{switch(o){case"CLIENT_ROLE_OPTIONS":if(Object.prototype.hasOwnProperty.call(ur,o)){const{value:h,expires:f}=i[o];if(f&&f<=s)return;KV(ur[o],h)||(ql[o]=h,ur[o]=h,this.emit(jh.UPDATE_CLIENT_ROLE_OPTIONS,h),M.debug("Updating client role options: ".concat(JSON.stringify(h))))}break;case"REMOTE_VIDEO_STREAM_TYPE":if(Object.prototype.hasOwnProperty.call(ur,o)){var d;const{value:h,expires:f}=i[o];if(f&&f<=s)return;typeof h=="number"&&Ge(d=[0,1,4,5,6,7,8,9]).call(d,h)&&(ql[o]={value:h},ur[o]=h,this.emit(jh.UPDATE_REMOTE_VIDEO_STREAM_TYPE,h),M.debug("Updating client remote stream type: ".concat(JSON.stringify(h))))}break;case"ENABLE_FORCE_HLS":if(Object.prototype.hasOwnProperty.call(ur,o)){const{value:h,expires:f}=i[o];if(f&&f<=s)return;KV(ur[o],h)||(ql[o]=h,ur[o]=h,this.emit(jh.FALLBACK_TO_HLS,h),M.debug("Updating enable force hls: ".concat(JSON.stringify(h))))}break;case"VOS_CONFIGURE":if(Object.prototype.hasOwnProperty.call(ur,o)){const{value:h,expires:f}=i[o];if(f&&f<=s)return;KV(ur[o],h)||(ql[o]=h,ur[o]=h,this.emit(jh.UPDATE_VOS_CONFIGURE,h),M.debug("Updating vos configure: ".concat(JSON.stringify(h))))}}})}catch(s){M.error("Error handling global parameter config:",s.message)}}}class rwe extends ai{constructor(){super(...arguments),Y(this,"resultStorage",new Map)}setLocalAudioStats(i,s,o){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",i,this.checkAudioInputLevel(o,s)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",i,this.checkSendAudioBitrate(o,s))}setLocalVideoStats(i,s,o){this.record("SEND_VIDEO_BITRATE_TOO_LOW",i,this.checkSendVideoBitrate(o,s)),this.record("FRAMERATE_INPUT_TOO_LOW",i,this.checkFramerateInput(o,s)),this.record("FRAMERATE_SENT_TOO_LOW",i,this.checkFramerateSent(o)),!s.muted&&this.record("VIDEO_ENCODE_FAILED",i,this.checResolutionSent(o))}setRemoteAudioStats(i,s){const o=i.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",o,this.checkAudioOutputLevel(s))}setRemoteVideoStats(i,s){const o=i.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",o,this.checkVideoDecode(s))}record(i,s,o){if(re("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(i)||this.resultStorage.set(i,{result:[],isPrevNormal:!0});const d=this.resultStorage.get(i);if(!d)return;d.result.push(o);const h=i==="VIDEO_ENCODE_FAILED"?re("ENCODE_EXCEPTION_TIMES"):5;if(d.result.length>=h){var f;const g=Ge(f=d.result).call(f,!0);d.isPrevNormal&&!g&&this.emit("exception",o3[i],i,s),!d.isPrevNormal&&g&&this.emit("exception",o3[i]+2e3,i+"_RECOVER",s),d.isPrevNormal=g,d.result=[]}}checkAudioOutputLevel(i){return!(i.receiveBitrate>0&&i.receiveLevel===0)}checkAudioInputLevel(i,s){return s instanceof gs&&!s.isActive||!!s.muted||i.sendVolumeLevel!==0}checkFramerateInput(i,s){let o=null;s._encoderConfig&&s._encoderConfig.frameRate&&(o=vc(s._encoderConfig.frameRate));const d=i.captureFrameRate;return!o||!d||!(o>10&&d<5||o<10&&o>=5&&d<=1)}checkFramerateSent(i){return!(i.captureFrameRate&&i.sendFrameRate&&i.captureFrameRate>5&&i.sendFrameRate<=1)}checResolutionSent(i){var s;return!(!i.codecType||Ge(s=re("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(s,i.codecType.toLocaleLowerCase()))||!i.captureFrameRate||i.sendFrameRate!==0||i.sendResolutionWidth!==0||i.sendResolutionHeight!==0}checkSendVideoBitrate(i,s){return!!s.muted||i.sendBitrate!==0}checkSendAudioBitrate(i,s){return s instanceof gs&&!s.isActive||!!s.muted||i.sendBitrate!==0}checkVideoDecode(i){return i.receiveBitrate===0||i.decodeFrameRate!==0}}const o3={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},La=new class{markSubscribeStart(n,i){performance.mark("agora-web-sdk/".concat(n,"/subscribe-").concat(i))}markPublishStart(n,i){performance.mark("agora-web-sdk/".concat(n,"/publish-").concat(i))}measureFromSubscribeStart(n,i){const s=performance.getEntriesByName("agora-web-sdk/".concat(n,"/subscribe-").concat(i));if(s.length>0){const o=s[s.length-1];return Math.round(performance.now()-o.startTime)}return 0}measureFromPublishStart(n,i){const s=performance.getEntriesByName("agora-web-sdk/".concat(n,"/publish-").concat(i));if(s.length>0){const o=s[s.length-1];return Math.round(performance.now()-o.startTime)}return 0}};function jJ(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function Ny(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?jJ(Object(s),!0).forEach(function(o){Y(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):jJ(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}class _R{constructor(i){Y(this,"store",void 0),Y(this,"onStatsException",void 0),Y(this,"onUploadPublishDuration",void 0),Y(this,"onStatsChanged",void 0),Y(this,"onVideoCodecChanged",void 0),Y(this,"localStats",new Map),Y(this,"remoteStats",new Map),Y(this,"updateStatsInterval",void 0),Y(this,"trafficStats",void 0),Y(this,"trafficStatsPeerList",[]),Y(this,"uplinkStats",void 0),Y(this,"exceptionMonitor",void 0),Y(this,"p2pChannel",void 0),Y(this,"scalabilityMode",Bk.L1T1),Y(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=i,this.exceptionMonitor=new rwe,this.exceptionMonitor.on("exception",(s,o,d)=>{this.onStatsException&&this.onStatsException(s,o,d)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(qe.LocalAudioTrack)||Ny({},d4)}getLocalVideoTrackStats(){return this.localStats.get(qe.LocalVideoTrack)||Ny({},u4)}getRemoteAudioTrackStats(i){const s=(h,f)=>{if(!this.trafficStats)return f;const g=this.trafficStats.peer_delay.find(y=>y.peer_uid===h);return g&&(f.publishDuration=g.B_ppad+(Date.now()-this.trafficStats.timestamp)),f},o={};if(i){var d;const h=(d=this.remoteStats.get(i))===null||d===void 0?void 0:d.audioStats;h&&(o[i]=s(i,h))}else Array.from(this.remoteStats.entries()).forEach(h=>{let[f,{audioStats:g}]=h;g&&(o[f]=s(f,g))});return o}getRemoteNetworkQualityStats(i){const s={};if(i){var o;const d=(o=this.remoteStats.get(i))===null||o===void 0?void 0:o.networkStats;d&&(s[i]=d)}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{networkStats:f}]=d;f&&(s[h]=f)});return s}getNetworkQuality(){let i=0,s=0;return this.trafficStats&&(i=_P(this.trafficStats.B_unq),s=_P(this.trafficStats.B_dnq)),{uplinkNetworkQuality:i,downlinkNetworkQuality:s}}getRemoteVideoTrackStats(i){const s=(h,f)=>{if(!this.trafficStats)return f;const g=this.trafficStats.peer_delay.find(y=>y.peer_uid===h);return g&&(f.publishDuration=g.B_ppvd+(Date.now()-this.trafficStats.timestamp)),f},o={};if(i){var d;const h=(d=this.remoteStats.get(i))===null||d===void 0?void 0:d.videoStats;h&&(o[i]=s(i,h))}else Array.from(this.remoteStats.entries()).forEach(h=>{let[f,{videoStats:g}]=h;g&&(o[f]=s(f,g))});return o}getRTCStats(){let i=0,s=0,o=0,d=0;const h=this.localStats.get(qe.LocalAudioTrack);h&&(i+=h.sendBytes,s+=h.sendBitrate);const f=this.localStats.get(qe.LocalVideoTrack);f&&(i+=f.sendBytes,s+=f.sendBitrate);const g=this.localStats.get(qe.LocalVideoLowTrack);g&&(i+=g.sendBytes,s+=g.sendBitrate),this.remoteStats.forEach(x=>{let{audioStats:b,videoStats:N}=x;b&&(o+=b.receiveBytes,d+=b.receiveBitrate),N&&(o+=N.receiveBytes,d+=N.receiveBitrate)});let y=1;return this.trafficStats&&(y+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:y,SendBitrate:s,SendBytes:i,RecvBytes:o,RecvBitrate:d,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(i){this.localStats.set(i,void 0)}removeLocalStats(i){i?this.localStats.delete(i):this.localStats.clear()}addRemoteStats(i){this.remoteStats.set(i,{})}removeRemoteStats(i){i?this.remoteStats.delete(i):this.remoteStats.clear()}addP2PChannel(i){this.p2pChannel=i}updateTrafficStats(i){i.peer_delay=i.peer_delay.filter(s=>s.B_ppad!==void 0||s.B_ppvd!==void 0),i.peer_delay.filter(s=>this.trafficStatsPeerList.indexOf(s.peer_uid)===-1).forEach(s=>{var o;const d=(o=this.p2pChannel)===null||o===void 0?void 0:o.getRemoteMedia(s.peer_uid),h=d!=null&&d.videoSSRC?La.measureFromSubscribeStart(this.store.clientId,d.videoSSRC):0,f=d!=null&&d.audioSSRC?La.measureFromSubscribeStart(this.store.clientId,d.audioSSRC):0;s.B_ppad!==void 0&&s.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(s.peer_uid,s.B_ppad,s.B_ppvd,h>f?h:f),this.trafficStatsPeerList.push(s.peer_uid))}),this.trafficStats=i}updateUplinkStats(i){this.uplinkStats&&this.uplinkStats.B_fir!==i.B_fir&&M.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(i.B_fir)),this.uplinkStats=i}static isRemoteVideoFreeze(i,s,o){if(!i)return!1;const d=!!o&&s.framesDecodeFreezeTime>o.framesDecodeFreezeTime,h=!o||s.framesDecodeCount>o.framesDecodeCount;return d||!h}static isRemoteAudioFreeze(i){return!!i&&i._isFreeze()}isLocalVideoFreeze(i){return!(!i.inputFrame||!i.sentFrame)&&i.inputFrame.frameRate>5&&i.sentFrame.frameRate<3}updateLocalStats(i){Array.from(this.localStats.entries()).forEach(s=>{let[o,d]=s;switch(o){case qe.LocalVideoTrack:case qe.LocalVideoLowTrack:{const g=d,y=Ny({},u4),x=i.getStats(),b=i.getLocalMedia(o);if(x){const N=x.videoSend.find(I=>I.ssrc===(b==null?void 0:b.ssrcs[0].ssrcId));if(N){const I=i.getLocalVideoSize(),D=i.getEncoderConfig(qe.LocalVideoTrack);var h;(N.codec==="H264"||N.codec==="H265"||N.codec==="VP8"||N.codec==="VP9"||N.codec==="AV1X"||N.codec==="AV1")&&(y.codecType=N.codec,(g==null?void 0:g.codecType)!==N.codec&&((h=this.onVideoCodecChanged)===null||h===void 0||h.call(this,N.codec.toLocaleLowerCase()))),y.sendBytes=N.bytes,y.sendBitrate=g?8*Math.max(0,y.sendBytes-g.sendBytes):0,N.inputFrame?(y.captureFrameRate=N.inputFrame.frameRate,y.captureResolutionHeight=N.inputFrame.height,y.captureResolutionWidth=N.inputFrame.width):I&&(y.captureResolutionWidth=I.width,y.captureResolutionHeight=I.height),N.sentFrame?(y.sendFrameRate=N.sentFrame.frameRate,y.sendResolutionHeight=N.sentFrame.height,y.sendResolutionWidth=N.sentFrame.width):I&&(y.sendResolutionWidth=I.width,y.sendResolutionHeight=I.height),N.avgEncodeMs&&(y.encodeDelay=N.avgEncodeMs),D&&D.bitrateMax?y.targetSendBitrate=1e3*D.bitrateMax:N.targetBitrate&&(y.targetSendBitrate=N.targetBitrate),y.sendPackets=N.packets,y.sendPacketsLost=N.packetsLost,y.sendJitterMs=N.jitterMs,y.sendRttMs=N.rttMs,y.totalDuration=g?g.totalDuration+1:1,y.totalFreezeTime=g?g.totalFreezeTime:0,this.isLocalVideoFreeze(N)&&(y.totalFreezeTime+=1),N.scalabilityMode&&this.scalabilityMode!==N.scalabilityMode&&(M.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(N.scalabilityMode)),this.scalabilityMode=N.scalabilityMode)}this.trafficStats&&(y.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var f;this.localStats.set(o,y),((g==null?void 0:g.sendResolutionWidth)!==y.sendResolutionWidth||(g==null?void 0:g.sendResolutionHeight)!==y.sendResolutionHeight)&&((f=this.onStatsChanged)===null||f===void 0||f.call(this,"resolution",{width:y.sendResolutionWidth,height:y.sendResolutionHeight})),y&&b&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,b.track,y);break}case qe.LocalAudioTrack:{const g=d,y=Ny({},d4),x=i.getStats(),b=i.getLocalMedia(o);if(x){const N=x.audioSend.find(I=>I.ssrc===(b==null?void 0:b.ssrcs[0].ssrcId));if(N){if(N.codec!=="opus"&&N.codec!=="aac"&&N.codec!=="PCMU"&&N.codec!=="PCMA"&&N.codec!=="G722"||(y.codecType=N.codec),N.inputLevel)y.sendVolumeLevel=Math.round(32767*N.inputLevel);else{const I=i.getLocalAudioVolume();I&&(y.sendVolumeLevel=Math.round(32767*I))}y.sendBytes=N.bytes,y.sendPackets=N.packets,y.sendPacketsLost=N.packetsLost,y.sendJitterMs=N.jitterMs,y.sendRttMs=N.rttMs,y.sendBitrate=g?8*Math.max(0,y.sendBytes-g.sendBytes):0}}this.trafficStats&&(y.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(qe.LocalAudioTrack,y),y&&b&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,b.track,y);break}}})}updateRemoteStats(i){Array.from(this.remoteStats.entries()).forEach(s=>{var o,d;let[h,{videoStats:f,audioStats:g,videoPcStats:y}]=s;const x=g,b=f,N=y,I=Ny({},NY),D=Ny({},IY),$=Ny({},zxe),{audioTrack:z,videoTrack:K,audioSSRC:ie,videoSSRC:oe}=i.getRemoteMedia(h);let fe;fe=this.store.useP2P?i.getStats(!0):i.getStats();const Ee=(o=fe)===null||o===void 0?void 0:o.audioRecv.find(je=>je.ssrc===ie),Te=(d=fe)===null||d===void 0?void 0:d.videoRecv.find(je=>je.ssrc===oe),_e=this.trafficStats&&this.trafficStats.peer_delay.find(je=>je.peer_uid===h);if(Ee&&(Ee.codec!=="opus"&&Ee.codec!=="aac"&&Ee.codec!=="PCMU"&&Ee.codec!=="PCMA"&&Ee.codec!=="G722"||(I.codecType=Ee.codec),Ee.outputLevel?I.receiveLevel=Math.round(32767*Ee.outputLevel):z&&(I.receiveLevel=Math.round(32767*z.getVolumeLevel())),I.receiveBytes=Ee.bytes,I.receivePackets=Ee.packets,I.receivePacketsLost=Ee.packetsLost,I.receivePacketsDiscarded=Ee.packetsDiscarded,I.packetLossRate=I.receivePacketsLost/(I.receivePackets+I.receivePacketsLost),I.receiveBitrate=x?8*Math.max(0,I.receiveBytes-x.receiveBytes):0,I.totalDuration=x?x.totalDuration+1:1,I.totalFreezeTime=x?x.totalFreezeTime:0,I.freezeRate=I.totalFreezeTime/I.totalDuration,I.receiveDelay=Ee.jitterBufferMs,I.totalDuration>10&&_R.isRemoteAudioFreeze(z)&&(I.totalFreezeTime+=1)),Te){var Re;Te.codec!=="H264"&&Te.codec!=="H265"&&Te.codec!=="VP8"&&Te.codec!=="VP9"&&Te.codec!=="AV1X"&&Te.codec!=="AV1"||(D.codecType=Te.codec),D.receiveBytes=Te.bytes,D.receiveBitrate=b?8*Math.max(0,D.receiveBytes-b.receiveBytes):0,D.decodeFrameRate=Te.decodeFrameRate<0?0:Te.decodeFrameRate,D.renderFrameRate=Te.decodeFrameRate<0?0:Te.decodeFrameRate,Te.outputFrame&&(D.renderFrameRate=Te.outputFrame.frameRate),Te.receivedFrame?(D.receiveFrameRate=Te.receivedFrame.frameRate,D.receiveResolutionHeight=Te.receivedFrame.height,D.receiveResolutionWidth=Te.receivedFrame.width):K&&(D.receiveResolutionHeight=K._videoHeight||0,D.receiveResolutionWidth=K._videoWidth||0),Te.framesRateFirefox!==void 0&&(D.receiveFrameRate=Math.round(Te.framesRateFirefox)),D.receivePackets=Te.packets,D.receivePacketsLost=Te.packetsLost,D.packetLossRate=D.receivePacketsLost/(D.receivePackets+D.receivePacketsLost);const je=b?b.totalFreezeTime:0,Be=b?b.totalDuration:0;D.totalDuration=b?b.totalDuration+1:1,D.totalFreezeTime=(Re=Te.totalFreezesDuration)!==null&&Re!==void 0?Re:je||0,D.receiveDelay=Te.jitterBufferMs||0;const dt=!!oe&&i.getRemoteVideoIsReady(oe);Te.totalFreezesDuration===void 0&&K&&dt&&_R.isRemoteVideoFreeze(K,Te,N)&&(D.totalFreezeTime+=1),D.freezeRate=Math.max(0,Math.min((D.totalFreezeTime-je)/(D.totalDuration-Be),1))}_e&&(I.end2EndDelay=_e.B_ad,D.end2EndDelay=_e.B_vd,I.transportDelay=_e.B_ed,D.transportDelay=_e.B_ed,I.currentPacketLossRate=_e.B_ealr4/100,D.currentPacketLossRate=_e.B_evlr4/100,$.uplinkNetworkQuality=_e.B_punq?_e.B_punq:0,$.downlinkNetworkQuality=_e.B_pdnq?_e.B_pdnq:0),this.remoteStats.set(h,{audioStats:I,videoStats:D,videoPcStats:Te,networkStats:$}),z&&this.exceptionMonitor.setRemoteAudioStats(z,I),K&&this.exceptionMonitor.setRemoteVideoStats(K,D)})}}class MJ{constructor(){Y(this,"destChannelMediaInfos",new Map),Y(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(i){qX(i),this.srcChannelMediaInfo=i}addDestChannelInfo(i){qX(i),this.destChannelMediaInfos.set(i.channelName,i)}removeDestChannelInfo(i){dP(i),this.destChannelMediaInfos.delete(i)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function UJ(n){if(!(n instanceof MJ))return new Ce(se.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const i=n.getSrcChannelMediaInfo(),s=n.getDestChannelMediaInfo();if(!i)return new Ce(se.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(s.size===0)return new Ce(se.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Qg{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(i,s){Y(this,"uid",void 0),Y(this,"_uintid",void 0),Y(this,"_trust_in_room_",!0),Y(this,"_trust_audio_enabled_state_",!0),Y(this,"_trust_video_enabled_state_",!0),Y(this,"_trust_audio_mute_state_",!0),Y(this,"_trust_video_mute_state_",!0),Y(this,"_audio_muted_",!1),Y(this,"_video_muted_",!1),Y(this,"_audio_enabled_",!0),Y(this,"_video_enabled_",!0),Y(this,"_audio_added_",!1),Y(this,"_video_added_",!1),Y(this,"_is_pre_created",!1),Y(this,"_video_pre_subscribed",!1),Y(this,"_audio_pre_subscribed",!1),Y(this,"_trust_video_stream_added_state_",!0),Y(this,"_trust_audio_stream_added_state_",!0),Y(this,"_audioTrack",void 0),Y(this,"_videoTrack",void 0),Y(this,"_dataChannels",[]),Y(this,"_audioSSRC",void 0),Y(this,"_videoSSRC",void 0),Y(this,"_audioOrtc",void 0),Y(this,"_videoOrtc",void 0),Y(this,"_cname",void 0),Y(this,"_rtxSsrcId",void 0),Y(this,"_videoMid",void 0),Y(this,"_audioMid",void 0),this.uid=i,this._uintid=s}}function VJ(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function c3(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?VJ(Object(s),!0).forEach(function(o){Y(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):VJ(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}const iwe=n=>`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1 2
a=msid-semantic: WMS
a=ice-lite`.concat(n?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:2
`),CP="9",l3=2e4,NP=4e4;let FJ=class{get localCapabilities(){return qr(this._localCapabilities)}get rtpCapabilities(){return qr(this._rtpCapabilities)}get candidates(){return qr(this._candidates)}get iceParameters(){return qr(this._iceParameters)}get dtlsParameters(){return qr(this._dtlsParameters)}constructor(n){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1],s=arguments.length>2&&arguments[2]!==void 0&&arguments[2],o=arguments.length>3&&arguments[3]!==void 0&&arguments[3];Y(this,"sessionDesc",void 0),Y(this,"_localCapabilities",void 0),Y(this,"_rtpCapabilities",void 0),Y(this,"_candidates",void 0),Y(this,"_originCandidates",void 0),Y(this,"_iceParameters",void 0),Y(this,"_isUseExtmapAllowMixed",void 0),Y(this,"_isUseLocalCodecs",void 0),Y(this,"_isUseDataChannel",void 0),Y(this,"_dtlsParameters",void 0),Y(this,"setup",void 0),Y(this,"currentMidIndex",void 0),Y(this,"cname",void 0),Y(this,"useLocalCodecsMids",[]),Y(this,"preloadSsrcs",[]),Y(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=i,this._isUseLocalCodecs=s,this._isUseDataChannel=o,n=qr(n);const{iceParameters:d,dtlsParameters:h,candidates:f,rtpCapabilities:g,setup:y,localCapabilities:x,cname:b}=n;this._rtpCapabilities=g,this._candidates=f,this._originCandidates=qr(f),this._iceParameters=d,this._dtlsParameters=h,this._localCapabilities=x,this.setup=y,this.cname=b,[this.sessionDesc]=this.updateRemoteRTPCapabilities(g),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(n){return n.length===this.preloadSsrcs.length&&n.every(i=>{var s;return Ge(s=this.preloadSsrcs).call(s,i)})}preloadRemoteMedia(n){let i=0;const s=[],o=[];for(;n>0;){const d=[c3({ssrcId:NP+i},re("USE_SUB_RTX")?{rtx:NP+i+1}:{})],h="".concat(NP+i,"_").concat(l3+i),{ssrcs:f,ssrcGroups:g}=hR(d,this.cname,re("SYNC_GROUP")?h:void 0),y=this.preCreateOrRecycleSendMedia("video",f,g,void 0),x=[{ssrcId:l3+i}],b="".concat(NP+i,"_").concat(l3+i),{ssrcs:N,ssrcGroups:I}=hR(x,this.cname,re("SYNC_GROUP")?b:void 0),D=this.preCreateOrRecycleSendMedia("audio",N,I,void 0);n--,i+=2,s.push(y,D),o.push(f[0].ssrcId,N[0].ssrcId)}return this.useLocalCodecsMids.push(...s),this.preloadSsrcs=o,{mids:s,preSSRCs:o,isAvailable:!0}}preCreateOrRecycleSendMedia(n,i,s,o){const d=this.rtpCapabilities.send.videoCodecs,h=this._isUseLocalCodecs||d.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;M.debug("create or recycle send media without remote rtp capabilities, ssrcs ",i[0].ssrcId);const f=n===pt.VIDEO?h.videoCodecs:h.audioCodecs,g=n===pt.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const y="".concat(this.currentMidIndex);let x={media:{mediaType:n,port:CP,protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:i,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(y)}};return x=this.mungSendMediaDesc(x,o),this.sessionDesc.mediaDescriptions.push(x),this.updateBundleMids(),y}toString(){return um(this.sessionDesc)}send(n,i,s,o){const{ssrcs:d,ssrcGroups:h}=hR(i,this.cname,re("SYNC_GROUP")?s:void 0),f=this.findPreloadMediaDesc(d);if(f){if(Kr()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,f.attributes.mid),o&&(o.twcc||o.remb)){const g=this.sessionDesc.mediaDescriptions.indexOf(f);return this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(f,o),{mid:f.attributes.mid,needExchangeSDP:!0}}return{mid:f.attributes.mid,needExchangeSDP:!1}}{const g=this.findAvailableMediaIndex(n,d);let y;return g===-1||g===1&&(Ks()||function(){const x=Wn();return!(x.name!==$n.CHROME||!x.osVersion)&&Number(x.version)<=90}()||Ph(143)||Gg(143)||re("RESERVE_MID_1_MLINE")||re("ENABLE_ENCODED_TRANSFORM")&&lm())||g===0&&!function(x){const b=Wn();return!(b.name!==$n.FIREFOX||!b.osVersion)&&Number(b.version)===x}(138)&&re("USE_SUB_RTX")||Lq()?(y=this.createOrRecycleSendMedia(n,d,h,"sendonly",o),this.updateBundleMids()):(y=qr(this.sessionDesc.mediaDescriptions[g]),y.attributes.direction="sendonly",y.attributes.ssrcs=d,y.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(y,o)),Kr()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,y.attributes.mid),{mid:y.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:n,needExchangeSDP:i}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:n.attributes.mid,needExchangeSDP:i}}batchSend(n){const i=n.map(d=>{let{kind:h,ssrcMsg:f,mslabel:g}=d;return this.send(h,f,g)}),s=[];let o=!1;return i.forEach(d=>{let{mid:h,needExchangeSDP:f}=d;f&&(o=!0),s.push(h)}),{mids:s,needExchangeSDP:o}}stopSending(n){const i=this.sessionDesc.mediaDescriptions.filter(s=>s.attributes.mid&&n.indexOf(s.attributes.mid)!==-1);if(i.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");i.forEach(s=>{s.attributes.mid==="0"||Kr()||Lq()?s.attributes.ssrcs=[]:(s.attributes.ssrcs=[],s.attributes.direction="inactive",s.media.port="0")}),this.updateBundleMids()}mute(n){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===n);if(!i)throw new Error("mediaDescription not found with ".concat(n," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(n){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===n);if(!i)throw new Error("mediaDescription not found with ".concat(n," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}muteRemote(n){const i=this.sessionDesc.mediaDescriptions.filter(s=>Ge(n).call(n,s.attributes.mid||""));if(i.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");i.forEach(s=>{s.attributes.direction="inactive"})}unmuteRemote(n){const i=this.sessionDesc.mediaDescriptions.filter(s=>Ge(n).call(n,s.attributes.mid||""));if(i.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");i.forEach(s=>{s.attributes.direction="recvonly"})}receive(n,i,s,o){n.forEach((d,h)=>{this.createOrRecycleRecvMedia(d,[],"recvonly",i,s,o[h])}),this.updateBundleMids()}stopReceiving(n){const i=this.sessionDesc.mediaDescriptions.filter(s=>n.indexOf(s.attributes.mid)!==-1);if(i.length!==n.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");i.forEach(s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(n){const i=this.sessionDesc||Mo((s=this._isUseExtmapAllowMixed,this._isUseDataChannel?iwe(s):`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(s?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var s;this._rtpCapabilities=n;let o=!1;const d=this.rtpCapabilities.send,h=this.localCapabilities.send,f=this.localCapabilities.recv,g=f.videoCodecs,y=f.audioCodecs,x=f.videoExtensions,b=f.audioExtensions;for(const $ of i.mediaDescriptions){var N;if($.attributes.direction!=="sendonly"||typeof $.attributes.mid!="string"||!Ge(N=this.useLocalCodecsMids).call(N,$.attributes.mid)){if(o=!0,$.attributes.iceUfrag=this._iceParameters.iceUfrag,$.attributes.icePwd=this._iceParameters.icePwd,$.attributes.fingerprints=this._dtlsParameters.fingerprints,$.attributes.candidates=this._candidates,$.attributes.setup=this.setup,$.media.mediaType==="application"&&($.attributes.sctpPort="5000"),$.media.mediaType==="video")if(this._isUseLocalCodecs&&$.attributes.direction==="sendonly"){var I;$.media.fmts=g.map(K=>K.payloadType.toString(10)),$.attributes.payloads=g,$.attributes.extmaps=x;const z=$.attributes.mid;typeof z!="string"||Ge(I=this.useLocalCodecsMids).call(I,z)||this.useLocalCodecsMids.push(z)}else if(d.videoCodecs.length===0){const z=h.videoCodecs.filter(K=>{var ie,oe;return(ie=K.rtpMap)===null||ie===void 0?void 0:Ge(oe=ie.encodingName.toLowerCase()).call(oe,"vp8")});z.length===0&&z.push(h.videoCodecs[0]),$.media.fmts=z.map(K=>K.payloadType.toString(10)),$.attributes.payloads=z,$.attributes.extmaps=[]}else $.media.fmts=d.videoCodecs.map(z=>z.payloadType.toString(10)),$.attributes.payloads=d.videoCodecs,$.attributes.extmaps=d.videoExtensions;if($.media.mediaType==="audio")if(this._isUseLocalCodecs&&$.attributes.direction==="sendonly"){var D;$.media.fmts=y.map(K=>K.payloadType.toString(10)),$.attributes.payloads=y,$.attributes.extmaps=b;const z=$.attributes.mid;typeof z!="string"||Ge(D=this.useLocalCodecsMids).call(D,z)||this.useLocalCodecsMids.push(z)}else if(d.audioCodecs.length===0){const z=h.audioCodecs.filter(K=>{var ie,oe;return(ie=K.rtpMap)===null||ie===void 0?void 0:Ge(oe=ie.encodingName.toLowerCase()).call(oe,"opus")})||[h.audioCodecs[0]];$.media.fmts=z.map(K=>K.payloadType.toString(10)),$.attributes.payloads=z,$.attributes.extmaps=[]}else $.media.fmts=d.audioCodecs.map(z=>z.payloadType.toString(10)),$.attributes.payloads=d.audioCodecs,$.attributes.extmaps=d.audioExtensions,Mx($)}}return this.sessionDesc=i,this.currentMidIndex=i.mediaDescriptions.length-1,[this.sessionDesc,o]}updateCandidates(n){const i=this._originCandidates.filter(o=>o.transport==="udp"),s=[];if(i.forEach(o=>{s.push(c3(c3({},o),{},{foundation:"tcpcandidate",priority:Number(o.priority)-1+"",transport:"tcp",port:Number(o.port)+90+""}))}),i.length!==0){switch(n){case Ys.TCP_RELAY:this._candidates=s;break;case Ys.UDP_TCP_RELAY:case Ys.RELAY:this._candidates=[...i,...s];break;default:this._candidates=i}for(const o of this.sessionDesc.mediaDescriptions)o.attributes.candidates=this.candidates}}restartICE(n){n=qr(n),this._iceParameters=n,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=n.iceUfrag,i.attributes.icePwd=n.icePwd})}predictReceivingMids(n){const i=[];for(let s=0;s<n;s++)i.push((this.currentMidIndex+s+1).toString(10));return i}findAvailableMediaIndex(n,i){return this.sessionDesc.mediaDescriptions.findIndex(s=>{const o=s.media.mediaType===n&&s.media.port!=="0"&&(s.attributes.direction==="sendonly"||s.attributes.direction==="sendrecv")&&s.attributes.ssrcs.length===0;if(Kr()){if(o){const d=this.firefoxSsrcMidMap.get(i[0].ssrcId);return!(d||s.attributes.mid!=="0"&&s.attributes.mid!=="1")||!(!d||d!==s.attributes.mid)}return!1}return o})}createOrRecycleDataChannel(){for(const s of this.sessionDesc.mediaDescriptions)if(s.media.mediaType==="application")return{mediaDesc:s,needExchangeSDP:!1};this.currentMidIndex+=1;const n="".concat(this.currentMidIndex),i={media:{mediaType:"application",port:CP,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(n),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(i),{mediaDesc:i,needExchangeSDP:!0}}createOrRecycleRecvMedia(n,i,s,o,d,h){const f=n._mediaStreamTrack.kind,g=this.rtpCapabilities.recv,y=fR(f,g,this.localCapabilities.send,f===pt.VIDEO?o:d),x=f===pt.VIDEO?g.videoExtensions:g.audioExtensions;this.currentMidIndex+=1;const b="".concat(this.currentMidIndex);let N={media:{mediaType:f,port:CP,protos:["UDP","TLS","RTP","SAVPF"],fmts:y.map(D=>D.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:x,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:i,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:y,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(b)}};N=this.mungRecvMediaDsec(N,n,h);const I=this.findFirstClosedMedia(f);if(I){const D=this.sessionDesc.mediaDescriptions.indexOf(I);this.sessionDesc.mediaDescriptions[D]=N}else this.sessionDesc.mediaDescriptions.push(N);return N}updateRemoteDtlsParameters(n){const i=new Set(this._dtlsParameters.fingerprints.map(d=>d.fingerprint)),s=new Set(n.map(d=>d.fingerprint));let o=!1;i.size!==s.size&&(o=!0);for(const d of i)s.has(d)||(o=!0);return o}updateRemoteCodec(n,i,s){const o=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(N=>N.rtpMap&&N.rtpMap.encodingName.toLowerCase()||"").filter(N=>{var I;return Ge(I=Object.keys(gy)).call(I,N)}))],d=new Set(i);if(o.every(N=>d.has(N)))return M.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(i)),!1;const h=this._rtpCapabilities.recv.videoCodecs.filter(N=>i.some(I=>{var D;return Ge(D=N.rtpMap&&N.rtpMap.encodingName.toLowerCase()||"").call(D,I)}));if(h.length===0)return M.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(o," codecs: ").concat(i)),!1;const f=[...new Set(h.map(N=>N.rtpMap&&N.rtpMap.encodingName.toLowerCase()||""))];let g;if(M.debug("updateRemoteCodec, from ".concat(o," to ").concat(f)),n.length===0)g=this.sessionDesc.mediaDescriptions.filter(N=>N.media.mediaType==="video"&&N.attributes.direction==="recvonly");else if(g=this.sessionDesc.mediaDescriptions.filter(N=>N.attributes.mid&&N.media.mediaType==="video"&&Ge(n).call(n,N.attributes.mid)&&N.attributes.direction==="recvonly"),g.length!==n.length)return M.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(n,", codecs: ").concat(i)),!1;if(re("USE_PUB_RTX")||re("USE_SUB_RTX")){const N=Jg(h,this.rtpCapabilities.recv.videoCodecs);h.push(...N)}this._rtpCapabilities.recv.videoCodecs=h;const y=this.localCapabilities.send,x=this.rtpCapabilities.recv,b=fR(pt.VIDEO,x,y,s);return g.forEach(N=>{const I=b.map(D=>D.payloadType.toString(10));M.debug("updateRemoteCodec mid: ".concat(N.attributes.mid,", from"),N.attributes.payloads,"to",b),N.attributes.payloads=b,N.media.fmts=I}),M.debug("updateRemoteCodec success, mids: ".concat(n,", codecs: ").concat(i,", remote recv: ").concat(this._rtpCapabilities.recv.videoCodecs.length,", remote send: ").concat(this._rtpCapabilities.send.videoCodecs.length)),!0}createOrRecycleSendMedia(n,i,s,o,d){const h=this.rtpCapabilities.send.videoCodecs,f=this._isUseLocalCodecs||h.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,g=n===pt.VIDEO?f.videoCodecs:f.audioCodecs,y=n===pt.VIDEO?f.videoExtensions:f.audioExtensions;this.currentMidIndex+=1;const x="".concat(this.currentMidIndex);let b={media:{mediaType:n,port:CP,protos:["UDP","TLS","RTP","SAVPF"],fmts:g.map(I=>I.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:i,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:g,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(x)}};b=this.mungSendMediaDesc(b,d);const N=this.findFirstClosedMedia(n);if(N){const I=this.sessionDesc.mediaDescriptions.indexOf(N);this.sessionDesc.mediaDescriptions[I]=b}else this.sessionDesc.mediaDescriptions.push(b);return b}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(n=>n.media.port!=="0").map(n=>n.attributes.mid)}mungRecvMediaDsec(n,i,s){const o=qr(n);return q4(o),Cy(o,i),Y4(o,i),fJ(o),EP(o,s,this.localCapabilities.send),o}mungSendMediaDesc(n,i){const s=qr(n);return s.attributes&&s.attributes.payloads&&Array.isArray(s.attributes.payloads)&&s.attributes.payloads.length>0&&s.attributes.payloads.forEach(o=>{o.rtpMap&&o.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&re("ENABLE_DOWN_SPS_PPS")&&(o.fmtp&&o.fmtp.parameters||(o.fmtp={parameters:{}}),o.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),EP(s,i,this.localCapabilities.recv),Mx(s),s}updateRecvMedia(n,i){const s=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===n);if(s!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],i);this.sessionDesc.mediaDescriptions[s]=o}}bumpMid(n){this.currentMidIndex+=n}findFirstClosedMedia(n){return this.sessionDesc.mediaDescriptions.find(i=>Kr()?i.media.port==="0"&&i.media.mediaType===n:i.media.port==="0")}findPreloadMediaDesc(n){return this.sessionDesc.mediaDescriptions.find(i=>{var s;return((s=i.attributes)===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId)===n[0].ssrcId})}getSSRC(n){var i;return(i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===n))===null||i===void 0?void 0:i.attributes.ssrcs}};function BJ(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function mm(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?BJ(Object(s),!0).forEach(function(o){Y(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):BJ(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}var Fx=function(n){return n[n.DOWN=0]="DOWN",n[n.UP=1]="UP",n}(Fx||{});const IP=new Map;function zJ(n,i,s,o){let{scale:d}=n;if(d===0&&o===Fx.UP||d>=i.length-1&&o===Fx.DOWN)return n;let h=mm(mm({},n),{},{scale:o===Fx.DOWN?++d:--d});switch(s){case"maintain-framerate":h=mm(mm({},h),i[d].motion);break;case"maintain-resolution":h=mm(mm({},h),i[d].detail);break;case"balanced":h=mm(mm({},h),i[d].balanced)}return h}function GJ(n,i){if(i){const s={overUse:0,underUse:0,adaptationList:WJ(i)};IP.set(n,s)}else IP.delete(n)}function WJ(n){const i=mm({},n),{bitrateMax:s,frameRate:o,scaleResolutionDownBy:d,bitrateMin:h}=i,{MIN_FRAME_RATE:f,MAX_THRESHOLD_FRAMERATE:g,MAX_SCALE:y,BITRATE_MIN_THRESHOLD:x,BITRATE_MAX_THRESHOLD:b,BWE_SCALE_UP_THRESHOLD:N,BWE_SCALE_DOWN_THRESHOLD:I,PERF_SCALE_DOWN_THRESHOLD:D,PERF_SCALE_UP_THRESHOLD:$,BALANCE_BITRATE_FACTOR:z,BALANCE_FRAMERATE_FACTOR:K,BALANCE_RESOLUTION_FACTOR:ie,MOTION_RESOLUTION_FACTOR:oe,MOTION_BITRATE_FACTOR:fe,DETAIL_FRAMERATE_FACTOR:Ee,DETAIL_BITRATE_FACTOR:Te}=n4,_e=Math.min(i.frameRate,g),Re=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(I,1)*s),bwe_up:s,fps_down:Math.round(Math.pow(D,1)*_e),fps_up:o},balanced:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:s,bitrateMin:h},motion:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:s,bitrateMin:h},detail:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:s,bitrateMin:h}}];for(let je=1;je<=y;je++){const Be={bwe_up:Math.round(Math.pow(N,je)*s),bwe_down:Math.round(Math.pow(I,je+1)*s),fps_up:Math.round(Math.pow($,je)*_e),fps_down:Math.round(Math.pow(D,je+1)*_e)},dt={scaleResolutionDownBy:d/Math.pow(ie,je),frameRate:Math.max(Math.round(Math.pow(K,je)*o),f),bitrateMax:Math.max(Math.round(Math.pow(z,je)*s),b),bitrateMin:Math.max(Math.round(Math.pow(z,je)*h),x)},Ht={scaleResolutionDownBy:d/Math.pow(oe,je),frameRate:o,bitrateMax:Math.max(Math.round(Math.pow(fe,je)*s),b),bitrateMin:Math.max(Math.round(Math.pow(fe,je)*h),x)},Bt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(Ee,je)*o),f),bitrateMax:Math.max(Math.round(Math.pow(Te,je)*s),b),bitrateMin:Math.max(Math.round(Math.pow(Te,je)*h),x)};Re.push({scale:je,threshold:Be,balanced:dt,motion:Ht,detail:Bt})}return Re}function swe(n,i,s,o,d,h){const f=IP.get(n)||{overUse:0,underUse:0,adaptationList:WJ(d)},{adaptationList:g}=f;IP.set(n,f);const{OVERUSE_TIMES_THRESHOLD:y,UNDERUSE_TIMES_THRESHOLD:x}=n4,{scale:b}=o;let N,I;return typeof i=="number"&&i>0&&function(D,$,z,K){if($>=z.length)return!1;let{threshold:{fps_down:ie}}=z[$];return re("FORCE_AG_HIGH_FRAMERATE")&&K==="maintain-framerate"&&(ie=z[0].threshold.fps_down),D<ie}(i,b,g,h)&&(f.overUse++,I=yx.CPU,f.overUse>y)||typeof s=="number"&&s>0&&function(D,$,z){if($>=z.length)return!1;const{threshold:{bwe_down:K}}=z[$];return D<K}(s,b,g)&&(f.overUse++,I=yx.BANDWIDTH,f.overUse>y)?(f.overUse=0,f.underUse=0,N=zJ(o,g,h,Fx.DOWN),[N,I]):(typeof i=="number"&&i>0&&typeof s=="number"&&s>0&&function(D,$,z,K){if($===0)return;let{threshold:{fps_up:ie}}=z[$];return re("FORCE_AG_HIGH_FRAMERATE")&&K==="maintain-framerate"&&(ie=z[1].threshold.fps_up),D>ie}(i,b,g,h)&&function(D,$,z){if($===0)return;const{threshold:{bwe_up:K}}=z[$];return D>K}(s,b,g)&&(f.underUse++,f.underUse>x&&(f.overUse=0,f.underUse=0,N=zJ(o,g,h,Fx.UP),N.scale===0&&(I=yx.NONE))),[N,I])}function HJ(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function d3(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?HJ(Object(s),!0).forEach(function(o){Y(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):HJ(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}function KJ(n){var i;return!!re("ENABLE_AG_ADAPTATION")&&!!(n instanceof Zk||Ge(i=n._hints).call(i,or.CUSTOM_TRACK))&&(!!re("FORCE_SUPPORT_AG_ADAPTATION")||!!(Dq(14,0,!1)&&Oq(17,4,!0)||Pq(14)&&jV(17,4,!0)))}const AP=new Map;function qJ(n,i,s,o,d,h){if(Bx(n,s),d(i),o!=="balanced"&&o!=="maintain-framerate"&&o!=="maintain-resolution")return;let f=-1;GJ(n,i);const g=window.setInterval(()=>{const x=AP.get(n);if(!re("ENABLE_AG_ADAPTATION")||!x)return Bx(n,s),void d(i);const b=h();if(b.sendPackets>0&&b.OutgoingAvailableBandwidth>0){if(f===-1)return void(f=Date.now());if(Date.now()-f<1e3)return;const N=b.sendFrameRate,I=b.OutgoingAvailableBandwidth,[D,$]=swe(n,N,I,x.adaptationConfig,i,o);$&&(s.qualityLimitationReason=$),D&&x.adaptationConfig.scale!==D.scale&&(M.debug("[".concat(n,"] applyAdaptation: ").concat(s.qualityLimitationReason,`
           sendFps `).concat(N,", bwe ").concat(I,", switch from ").concat(x.adaptationConfig.scale," to ").concat(D.scale," ")),x.adaptationConfig=d3(d3({},x.adaptationConfig),D),d(D))}},re("CHECK_LOCAL_STATS_INTERVAL")),y=d3({},i);AP.set(n,{timer:g,adaptationConfig:y,originConfig:i,adaptationFunc:d}),M.debug("[".concat(n,"] start adaptation, originConfig: ").concat(JSON.stringify(i),", degradationPreference: ").concat(o))}function Bx(n,i){const s=AP.get(n);if(s){const{timer:o}=s;window.clearTimeout(o),AP.delete(n)}i.qualityLimitationReason=yx.NONE,GJ(n)}function awe(n,i){var s;let o;switch(i){case qe.LocalAudioTrack:o=hr.Audio;break;case qe.LocalVideoTrack:o=Ge(s=n._hints).call(s,or.SCREEN_TRACK)?hr.Screen:hr.High;break;case qe.LocalVideoLowTrack:o=hr.Low}return o}function u3(n){const i=xn();if(n.some(s=>s._bypassWebAudio))throw new Pe(se.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!i.webAudioMediaStreamDest)throw new Pe(se.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function h3(n,i){u3(n);const s=new gs;return n.forEach(o=>s.addAudioTrack(o)),s}const owe=!xn().supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&Jp();function yR(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(n.useDcSignal)return s={spec:i,store:n},Uh("DataChannelConnection").create(s);var s;return owe?function(d){return Uh("PlanBConnection").create(d)}({spec:i,store:n}):new ed(i,n)}function p3(n){return n&&(n.iceConnectionState==="disconnected"||n.iceConnectionState==="checking"||n.iceConnectionState==="failed")}function f3(n){try{if(n.iceServers)return!1;if(n.turnServer&&n.turnServer.mode!=="off"){if(ly(n.turnServer.servers))return!1;if(re("FORCE_TURN_TCP")||n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).some(i=>i.forceturn))return!0}return!1}catch{return!1}}var Mn;function YJ(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function Fh(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?YJ(Object(s),!0).forEach(function(o){Y(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):YJ(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}let ed=(Mn=class Zy extends fP{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var i,s;return(i=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&i!==void 0?i:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(i=>i.rtpMap&&i.rtpMap.encodingName.toLowerCase()||"").filter(i=>{var s;return Ge(s=Object.keys(gy)).call(s,i)}))]}constructor(i,s){super(i,s),Y(this,"id",dr(5,"connection-")),Y(this,"store",void 0),Y(this,"peerConnection",void 0),Y(this,"forceTurn",!1),Y(this,"remoteSDP",void 0),Y(this,"initialOffer",void 0),Y(this,"transportEventReceiver",void 0),Y(this,"statsFilter",void 0),Y(this,"extension",{useXR:re("USE_XR")}),Y(this,"localCapabilities",void 0),Y(this,"remoteCodecs",void 0),Y(this,"localCandidateCount",0),Y(this,"allCandidatesReceived",!1),Y(this,"isPreallocation",!1),Y(this,"isPreRender",!1),Y(this,"preMediaMap",new Map),Y(this,"dataStreamChannelMap",new Map),Y(this,"establishPromise",void 0),Y(this,"recoveredDataChannelIds",[]),Y(this,"currentDataChannelId",1),Y(this,"supportAV1RtpSpec",!1),Y(this,"mutex",void 0),Y(this,"qualityLimitationReason",yx.NONE),Y(this,"isFirstConnected",!1),this.store=s,this.forceTurn=f3(i),this.mutex=new qs("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(Zy.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=zk(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,Kr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,i.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(i){return this.preMediaMap.get(i)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(i,s){if(this.remoteCodecs=s,!this.remoteSDP)return void M.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(s));if(this.remoteSDP.updateRemoteCodec(i,s,this.store.codec)){const o=await this.peerConnection.createOffer(),d=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);const h=this.remoteSDP.toString();d==null||d(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}else M.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const s=await this.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const o=rf(s.sdp),d=await X4({filterRTX:!re("USE_PUB_RTX")&&!re("USE_SUB_RTX"),filterVideoFec:re("FILTER_VIDEO_FEC"),filterAudioFec:re("FILTER_AUDIO_FEC"),filterVideoCodec:re("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:re("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:re("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=pR(d),this.initialOffer=s,re("ENABLE_SVC")&&this.store.codec=="av1"){const f=await mJ();var i;f&&(this.supportAV1RtpSpec=!0,(i=d.send)===null||i===void 0||i.videoExtensions.push(f))}let h;return s.sdp&&xP(s.sdp)&&(h=qr(d),oJ(h)),Fh(Fh({},o),{},{rtpCapabilities:h||d,offerSDP:s.sdp})}catch(s){throw new Pe(se.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(i){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&xP(this.initialOffer.sdp)&&cJ(i.rtpCapabilities,this.localCapabilities),this.remoteSDP=new FJ(Fh(Fh({},i),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!re("ENABLE_PRE_SUB_WITH_PRE_PC")||!re("PRE_USE_LOCAL_CODECS"))&&iR(this.store)),i.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString(),o=J4(this.initialOffer.sdp,this.extension),d=this.logSDPExchange(o||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),d==null||d(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s});const h=this.peerConnection.getTransceivers()[0];if(h!=null&&h.receiver&&this.tryBindTransportEvents(h.receiver),iR(this.store))if(i.preallocation&&re("ENABLE_PRE_SUB_WITH_PRE_PC")){const f=re("PRE_SUB_NUM"),{mids:g,preSSRCs:y}=this.remoteSDP.preloadRemoteMedia(f);await Yc(this.peerConnection,this.remoteSDP,this.extension),M.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(y)),this.presetMedia(g,y)}else{const{preSSRCs:f=[]}=i,g=f.map(x=>x.ssrcMsg[0].ssrcId);if(f.length===0)return;const{mids:y}=this.remoteSDP.batchSend(f.map(x=>Object.assign({},x)));await Yc(this.peerConnection,this.remoteSDP,this.extension),M.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(g)),this.presetMedia(y,g)}}catch(s){throw new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}presetMedia(i,s){i.forEach((o,d)=>{this.peerConnection.getTransceivers().forEach(h=>{if(h.mid!=null&&o===h.mid&&h.receiver.track){const f=h.receiver.track;let g;f.kind==="video"&&re("ENABLE_PRE_RENDER")&&(g=new Qk({trackId:"track-".concat(f.kind,"-unknown-").concat(this.store.clientId,"_").concat(dr(5,""))},!0),g.updateVideoTrack(f),g.onFirstVideoFrameRender=()=>{var y;const x=this.preMediaMap.get(s[d]);x&&(x.firstVideoRender=Date.now()),(y=this.onFirstVideoRender)===null||y===void 0||y.call(this,s[d])},g.onVideoBufferReady=()=>{var y;(y=this.onFirstVideoBufferReady)===null||y===void 0||y.call(this,s[d])},g.play(this.store.sessionId||void 0),this.isPreRender=!0),this.preMediaMap.set(s[d],{mid:o,track:f,player:g,transceiver:h})}}),this.store.peerReceiver()})}checkDtlsParameters(i){return!!this.remoteSDP&&i.length>0&&this.remoteSDP.updateRemoteDtlsParameters(i)}async updateRemoteConnect(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let s=!1;const{rtpCapabilities:o}=i;if([,s]=this.remoteSDP.updateRemoteRTPCapabilities(o),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const f=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);s=s||f}const{preSSRCs:d=[]}=i,h=d.map(f=>f.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(h)){const f=[],g=[];if(Array.from(this.preMediaMap.entries()).every(y=>{let[x,{mid:b,player:N,track:I}]=y;return f.push(b),g.push(x),this.preMediaMap.delete(x),N&&N.destroy(),!0}),f.length>0&&(this.remoteSDP.stopSending(f),await Yc(this.peerConnection,this.remoteSDP,this.extension),M.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(g)),_t.reportApiInvoke(this.store.sessionId,{name:Qr.PRELOAD_MEDIA_FAILED,options:[d,g],tag:Tr.TRACER}).onSuccess()),d.length>0){const{mids:y}=this.remoteSDP.batchSend(d.map(x=>Object.assign({},x)));await Yc(this.peerConnection,this.remoteSDP,this.extension),M.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(h)),this.presetMedia(y,h)}}s?(await Yc(this.peerConnection,this.remoteSDP,this.extension),M.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):M.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(s){throw new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(s.toString()))}}send(i,s,o){var d=this;return fc(function*(){const h=yield hn(d.mutex.lock("From P2PConnection.send"));try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const f=[],g=dR();i.forEach(K=>{const ie=d.peerConnection.addTransceiver(K._mediaStreamTrack,Fh({direction:"sendonly"},K.trackMediaType==="video"&&d.supportAV1RtpSpec&&g?{sendEncodings:[{scalabilityMode:g}]}:{}));f.push(ie),K._updateRtpTransceiver(ie)}),Kr()&&re("SIMULCAST")===!0&&(yield hn(d.applySimulcastForFirefox(f,i)));const y=yield hn(d.peerConnection.createOffer()),x=d.remoteSDP.predictReceivingMids(i.length),b=d.mungSendOfferSDP(y.sdp,i,x),N=Mo(b),I=x.map(K=>{const ie=N.mediaDescriptions.find(oe=>oe.attributes.mid===K);if(!ie)throw new Error("Cannot extract ssrc from mediaDescription.");return K4(ie,re("USE_PUB_RTX"))});let D;try{D=yield I}catch(K){D=[],d.remoteSDP.receive(i,s,o,D);const ie=d.remoteSDP.toString();throw yield hn(d.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield hn(d.peerConnection.setRemoteDescription({type:"answer",sdp:ie})),yield hn(d.stopSending(x,!0)),K}d.remoteSDP.receive(i,s,o,D);const $=d.remoteSDP.toString(),z=d.logSDPExchange(b,"offer","local","send");return yield hn(d.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield hn(d.applySimulcastEncodings(f,i)),yield hn(d.applySendEncodings(f,i)),z==null||z($),yield hn(d.peerConnection.setRemoteDescription({type:"answer",sdp:$})),f.map((K,ie)=>{const oe=x[ie];return{localSSRC:I[ie],id:oe,transceiver:K}})}catch(f){throw f instanceof Pe?f:new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(f.toString()))}finally{h()}})()}async createDataChannels(i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(i);if(o&&o.readyState==="open")M.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const h=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof h!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:h,negotiated:!0,ordered:!1,maxRetransmits:re("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(i,o)}s.forEach(h=>{h._updateOriginDataChannel(o)});const{needExchangeSDP:d}=this.remoteSDP.sendDataChannel();if(d){const h=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const f=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(f),M.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else M.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof Pe?o:new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(i){try{const s=this.dataStreamChannelMap.get(i);return s&&(s.id&&this.recoveredDataChannelIds.push(s.id),s.close()),void this.dataStreamChannelMap.delete(i)}catch(s){throw s instanceof Pe?s:new Pe(se.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(s.toString()))}}async stopSending(i,s){const o=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const d=this.peerConnection.getTransceivers().filter(y=>i.indexOf(y.mid)!==-1);if(d.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");d.map(y=>{var x;Bx(this.id+y.mid,this),y.direction="inactive",(x=y.stop)===null||x===void 0||x.call(y)});const h=await this.peerConnection.createOffer(),f=this.logSDPExchange(h.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(h),this.remoteSDP.stopReceiving(i);const g=this.remoteSDP.toString();f==null||f(g),await this.peerConnection.setRemoteDescription({type:"answer",sdp:g})}catch(d){throw new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(d.toString()))}finally{o&&o()}}async receive(i,s,o,d){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{mid:h,needExchangeSDP:f}=this.remoteSDP.send(i,s,o,d);f&&(await Yc(this.peerConnection,this.remoteSDP,this.extension),M.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(i," by exchanging SDP.")));const g=this.peerConnection.getTransceivers().find(y=>y.mid===h);if(!g)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:g.receiver.track,id:h,transceiver:g}}catch(h){throw new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}}async batchReceive(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:o}=this.remoteSDP.batchSend(i);return o&&(await Yc(this.peerConnection,this.remoteSDP,this.extension),M.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),s.map(d=>{const h=this.peerConnection.getTransceivers().find(f=>f.mid===d);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:d,transceiver:h}})}catch(s){throw new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");i.forEach(h=>{Array.from(this.preMediaMap.entries()).some(f=>{let[g,{mid:y,player:x}]=f;if(y===h)return this.preMediaMap.delete(g),x&&x.destroy(),!0})}),this.remoteSDP.stopSending(i);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=await this.peerConnection.createAnswer();o==null||o(d.sdp||""),await this.peerConnection.setLocalDescription(d)}catch(s){throw new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(i," before remote SDP created."));this.remoteSDP.mute(i);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=await this.peerConnection.createAnswer();o==null||o(d.sdp||""),await this.peerConnection.setLocalDescription(d)}catch(s){throw new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(i," before remote SDP created."));this.remoteSDP.unmute(i);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=await this.peerConnection.createAnswer();o==null||o(d.sdp||""),await this.peerConnection.setLocalDescription(d)}catch(s){throw new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(f=>f.mid&&i.indexOf(f.mid)!==-1);if(s.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(f=>{f.direction="inactive"});const o=await this.peerConnection.createOffer(),d=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(i);const h=this.remoteSDP.toString();d==null||d(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(f=>f.mid&&i.indexOf(f.mid)!==-1);if(s.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async(f,g)=>{f.direction="sendonly"});const o=await this.peerConnection.createOffer(),d=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(i,this.remoteCodecs,this.store.codec);const h=this.remoteSDP.toString();d==null||d(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(i){var s=this;return fc(function*(){const o=yield hn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const d=xn().supportPCSetConfiguration,h=re("FORCE_TURN_TCP")||s.forceTurn;if(i===Ys.RELAY&&!d)return;if(d&&!h){const N=i===Ys.RELAY?"relay":"all",I=s.peerConnection.getConfiguration();I.iceTransportPolicy!==N&&(M.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(I.iceTransportPolicy,"] to [").concat(N,"]")),I.iceTransportPolicy=N,s.peerConnection.setConfiguration(I))}s.remoteSDP.updateCandidates(i);const f=yield hn(s.peerConnection.createOffer({iceRestart:!0}));if(!f.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const g=rf(f.sdp),{remoteIceParameters:y}=yield g.iceParameters;s.remoteSDP.restartICE(y);const x=s.remoteSDP.toString(),b=s.logSDPExchange(f.sdp||"","offer","local","restartICE");s.store.descriptionStart(),yield hn(s.peerConnection.setLocalDescription(f)),b==null||b(x),yield hn(s.peerConnection.setRemoteDescription({type:"answer",sdp:x}))}catch(d){M.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),d)}finally{o()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const i=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Ys.TCP_RELAY),await Yc(this.peerConnection,this.remoteSDP,this.extension)}catch(s){M.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),s)}finally{i()}}close(){var i;this.peerConnection.getTransceivers().forEach(s=>{Bx(this.id+s.mid,this)}),this.preMediaMap.forEach(s=>{let{player:o}=s;o&&o.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Fh(Fh({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}async updateEncoderConfig(i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),d=this.mungSendOfferSDP(o.sdp,[s],[i]);this.remoteSDP.updateRecvMedia(i,s);const h=this.remoteSDP.toString(),f=this.logSDPExchange(d,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:d}),f==null||f(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(o){throw new Pe(se.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(i,s){const o=this.peerConnection.getTransceivers().filter(d=>d.mid===i);o.length===1&&(this.isVP8Simulcast(s)?Kr()||await this.applySimulcastEncodings(o,[s]):await this.applySendEncodings(o,[s]))}setStatsRemoteVideoIsReady(i,s){this.statsFilter.setVideoIsReady2(i,s)}async replaceTrack(i,s){const o=this.peerConnection.getTransceivers().find(d=>d.mid===s);o&&await o.sender.replaceTrack(i._mediaStreamTrack)}async getSelectedCandidatePair(){const i=this.peerConnection.getReceivers();if(i.length>0&&i[0].transport&&i[0].transport.iceTransport&&i[0].transport.iceTransport.getSelectedCandidatePair&&i[0].transport.iceTransport.getSelectedCandidatePair()){const s=i[0].transport.iceTransport,{local:o,remote:d}=s.getSelectedCandidatePair();return{local:Fh(Fh({},Ou),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:Fh(Fh({},Ou),{},{candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=i=>{if(i&&(i.errorCode||i.errorText)){var s;const o="code: ".concat(i.errorCode,", message: ").concat(i.errorText),d=i.port?"local: ".concat(i.port):"",h=nf(i.url||"");M.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(o,"), url: ").concat(h||"",", host_candidate:").concat(d)),(s=this.onICECandidateError)===null||s===void 0||s.call(this,o)}},this.peerConnection.onicegatheringstatechange=i=>{i&&i.target&&"iceGatheringState"in i.target&&M.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(i.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,M.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,M.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},re("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const s={iceServers:[]},o=i.cloudProxyServer||"disabled";return i.iceServers?s.iceServers=i.iceServers:i.turnServer&&(ly(i.turnServer.servers)?s.iceServers=i.turnServer.servers:re("NEW_TURN_MODE")&&s.iceServers&&o==="disabled"?(re("USE_TURN_SERVER_OF_GATEWAY")?i.turnServer.serversFromGateway&&s.iceServers.push(...Zy.newTurnServerConfigToIceServers(i.turnServer.serversFromGateway)):s.iceServers.push(...Zy.newTurnServerConfigToIceServers(i.turnServer.servers)),re("NEW_FORCE_TURN")&&(s.iceTransportPolicy="relay")):i.turnServer.mode!=="off"&&(s.iceServers&&s.iceServers.push(...Zy.turnServerConfigToIceServers(i.turnServer.servers)),re("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&i.turnServer.serversFromGateway&&s.iceServers.push(...Zy.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),re("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(d=>{d.forceturn&&(s.iceTransportPolicy="relay")}))),re("ENABLE_ENCODED_TRANSFORM")&&xn().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(i){const s=[];return i.forEach(o=>{o.security?o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Vu(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!re("FORCE_TURN_TCP")&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),s}static newTurnServerConfigToIceServers(i){const s=[];return i.forEach(o=>{const d=re("NEW_TURN_MODE");d===1?s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}):d===2?s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}):d===3?s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Vu(o.turnServerURL),":443?transport=tcp")}):d===4&&(s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}),s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}),s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Vu(o.turnServerURL),":443?transport=tcp")}))}),s}tryBindTransportEvents(i){const s=i.transport;if(s){this.transportEventReceiver=i,s.onstatechange=()=>{var d;s!=null&&s.state&&((d=this.onDTLSTransportStateChange)===null||d===void 0||d.call(this,s.state))},s.onerror=d=>{var h;(h=this.onDTLSTransportError)===null||h===void 0||h.call(this,"error"in d?d.error:d)};const o=s.iceTransport;o&&(o.onstatechange=()=>{const d=s==null?void 0:s.iceTransport.state;var h;d&&((h=this.onICETransportStateChange)===null||h===void 0||h.call(this,d))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){const{local:d,remote:h}=o.getSelectedCandidatePair()||{};if(d&&h){const f=d.address+":"+d.port,g=h.address+":"+h.port;M.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(nf(f)),", remote ").concat(JSON.stringify(nf(g))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(i,s){var o,d;if(s||(s=this.peerConnection.getSenders().find(K=>K.track===i._mediaStreamTrack)),!s)return M.warn("[".concat(i.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(i))return M.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!xn().supportSetRtpSenderParameters)return M.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const h={},f={};switch(i._optimizationMode){case"motion":h.degradationPreference="maintain-framerate";break;case"detail":h.degradationPreference="maintain-resolution";break;case"balanced":h.degradationPreference="balanced"}const g=sJ(this.peerConnection,i._mediaStreamTrack),y=YY(i);if(KJ(i)&&g&&s&&y&&this.getLocalVideoStats&&Ge(o=["vp8","vp9"]).call(o,this.store.codec)){var x;const z=h.degradationPreference||(Ge(x=i._hints).call(x,or.CUSTOM_TRACK)?re("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");qJ(this.id+g.mid,y,this,z,K=>{s&&this.updateAdaptation(s,K)},this.getLocalVideoStats.bind(this))}if(i._encoderConfig){var b;const{bitrateMax:z,frameRate:K,scaleResolutionDownBy:ie}=i._encoderConfig;z&&(f.maxBitrate=1e3*z),(Ge(b=i._hints).call(b,or.LOW_STREAM)||i.isUseScaleResolutionDownBy)&&(K&&(f.maxFramerate=vc(K)),ie&&ie>=1&&(f.scaleResolutionDownBy=ie))}const{maxFramerate:N}=re("ENCODER_CONFIG_LIMIT");if(N&&typeof N=="number"&&(f.maxFramerate=f.maxFramerate?Math.min(f.maxFramerate,N):N),re("DSCP_TYPE")&&Jp()){var I;const z=re("DSCP_TYPE");Ge(I=["very-low","low","medium","high"]).call(I,z)&&(f.networkPriority=z)}const D=s.getParameters(),$=(d=D.encodings)===null||d===void 0?void 0:d[0];Kr()&&!$&&(h.encodings=[f]),$&&Object.assign($,f),Object.assign(D,h),M.debug("[".concat(i.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(D.encodings))),await s.setParameters(D),await yJ(this.store.codec,s,re("SVC_MODE"))}async updateAdaptation(i,s){var o,d;if(!i)return M.debug("[updateAdaptation] no rtpSender found");if(!xn().supportSetRtpSenderParameters)return M.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const h={},{bitrateMax:f,frameRate:g,scaleResolutionDownBy:y}=s;f&&(h.maxBitrate=1e3*f),g&&(h.maxFramerate=vc(g)),y&&y>=1&&Ge(o=["vp8","vp9"]).call(o,this.store.codec)&&(h.scaleResolutionDownBy=y);const x=i.getParameters(),b=(d=x.encodings)===null||d===void 0?void 0:d[0];b&&Object.assign(b,h),Object.assign(x,{});try{await i.setParameters(x),M.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(x.encodings)))}catch(N){!("transport"in i)||i.transport&&i.transport.state==="connected"?this.peerConnectionState!=="connected"?M.debug("[updateAdaptation] peerConnection not connected}"):M.debug("[updateAdaptation] updateRtpSenderEncodings failed",N):M.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(i,s){try{if(!xn().supportSetRtpSenderParameters||i.length!==s.length)return;for(let o=0;o<i.length;o++){const d=i[o],h=s[o];h instanceof Rr&&!this.isVP8Simulcast(h)&&await this.updateRtpSenderEncodings(h,d.sender)}}catch{M.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(i,s,o){if(re("FORBID_MODIFY_LOCAL_OFFER_SDP"))return i;const d=Mo(i);return s.forEach((h,f)=>{const g=o[f],y=d.mediaDescriptions.find(x=>x.attributes.mid===g);y&&(Cy(y,h),$4(y,h,this.store.codec))}),um(d)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,s,o)=>{var d;(d=this.onFirstVideoDecoded)===null||d===void 0||d.call(this,i,s,o)},this.statsFilter.onSelectedLocalCandidateChanged=(i,s)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,i,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,s)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,i,s)},this.statsFilter.onFirstVideoDecodedTimeout=i=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(i,s){if(i.length===s.length)for(let y=0;y<i.length;y++){var o,d,h,f,g;const x=i[y],b=s[y];if(b instanceof Rr&&!Ge(o=b._hints).call(o,or.LOW_STREAM)&&(d=b._encoderConfig)!==null&&d!==void 0&&d.bitrateMax&&((h=b._encoderConfig)===null||h===void 0?void 0:h.bitrateMax)>200&&(f=b._scalabilityMode)!==null&&f!==void 0&&f.numSpatialLayers&&((g=b._scalabilityMode)===null||g===void 0?void 0:g.numSpatialLayers)>1&&this.store.codec==="vp8"){const N={},I={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};N.encodings=[{rid:"m",active:!0,maxBitrate:I.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:I.high}];const D=x.sender.getParameters();await x.sender.setParameters(Object.assign(D,N))}}}async applySimulcastEncodings(i,s){if(!Kr()&&i.length===s.length)for(let o=0;o<i.length;o++){const d=s[o];if(d instanceof Rr&&this.isVP8Simulcast(d)){const h=i[o],f={},g={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:g.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:g.medium,scaleResolutionDownBy:4}];const y=h.sender.getParameters();await h.sender.setParameters(Object.assign(y,f))}}}isVP8Simulcast(i){var s,o,d,h,f;return!!(i instanceof Rr&&re("SIMULCAST")&&this.store.codec==="vp8"&&!Ge(s=i._hints).call(s,or.LOW_STREAM)&&(o=i._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((d=i._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=i._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((f=i._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1)}logSDPExchange(i,s,o,d){if(re("SDP_LOGGING"))return M.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(s," SDP during P2PConnection.").concat(d,`
`),i),s==="offer"?h=>{this.logSDPExchange(h,"answer",o==="local"?"remote":"local",d)}:void 0}async getRemoteSSRC(i){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(i);return s&&s.length!==0?s[0].ssrcId:void 0}setConfiguration(i){if(xn().supportPCSetConfiguration){const s=Zy.resolvePCConfiguration(i);this.peerConnection.setConfiguration(s)}i.isPreallocation&&(this.isPreallocation=!0)}},it(Mn.prototype,"updateRemoteRTPCapabilities",[Ec],Object.getOwnPropertyDescriptor(Mn.prototype,"updateRemoteRTPCapabilities"),Mn.prototype),it(Mn.prototype,"connect",[Ec],Object.getOwnPropertyDescriptor(Mn.prototype,"connect"),Mn.prototype),it(Mn.prototype,"updateRemoteConnect",[Ec],Object.getOwnPropertyDescriptor(Mn.prototype,"updateRemoteConnect"),Mn.prototype),it(Mn.prototype,"createDataChannels",[Ec],Object.getOwnPropertyDescriptor(Mn.prototype,"createDataChannels"),Mn.prototype),it(Mn.prototype,"receive",[Ec],Object.getOwnPropertyDescriptor(Mn.prototype,"receive"),Mn.prototype),it(Mn.prototype,"batchReceive",[Ec],Object.getOwnPropertyDescriptor(Mn.prototype,"batchReceive"),Mn.prototype),it(Mn.prototype,"stopReceiving",[Ec],Object.getOwnPropertyDescriptor(Mn.prototype,"stopReceiving"),Mn.prototype),it(Mn.prototype,"muteRemote",[Ec],Object.getOwnPropertyDescriptor(Mn.prototype,"muteRemote"),Mn.prototype),it(Mn.prototype,"unmuteRemote",[Ec],Object.getOwnPropertyDescriptor(Mn.prototype,"unmuteRemote"),Mn.prototype),it(Mn.prototype,"muteLocal",[Ec],Object.getOwnPropertyDescriptor(Mn.prototype,"muteLocal"),Mn.prototype),it(Mn.prototype,"unmuteLocal",[Ec],Object.getOwnPropertyDescriptor(Mn.prototype,"unmuteLocal"),Mn.prototype),it(Mn.prototype,"close",[Ec],Object.getOwnPropertyDescriptor(Mn.prototype,"close"),Mn.prototype),it(Mn.prototype,"updateEncoderConfig",[Ec],Object.getOwnPropertyDescriptor(Mn.prototype,"updateEncoderConfig"),Mn.prototype),it(Mn.prototype,"updateSendParameters",[Ec],Object.getOwnPropertyDescriptor(Mn.prototype,"updateSendParameters"),Mn.prototype),it(Mn.prototype,"replaceTrack",[Ec],Object.getOwnPropertyDescriptor(Mn.prototype,"replaceTrack"),Mn.prototype),it(Mn.prototype,"updateAdaptation",[Ec],Object.getOwnPropertyDescriptor(Mn.prototype,"updateAdaptation"),Mn.prototype),it(Mn.prototype,"getRemoteSSRC",[Ec],Object.getOwnPropertyDescriptor(Mn.prototype,"getRemoteSSRC"),Mn.prototype),Mn);function Ec(n,i,s){const o=n[i];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const d=this.mutex,h=await d.lock("From P2PConnection.".concat(i));try{for(var f=arguments.length,g=new Array(f),y=0;y<f;y++)g[y]=arguments[y];return await o.apply(this,g)}finally{h()}},s}function m3(n,i){let s=document.createElement("video"),o=document.createElement("canvas");s.setAttribute("style","display:none"),o.setAttribute("style","display:none"),s.setAttribute("muted",""),s.muted=!0,s.setAttribute("autoplay",""),s.autoplay=!0,s.setAttribute("playsinline",""),o.width=vc(i.width),o.height=vc(i.height);const d=vc(i.framerate||15);document.body.append(s),document.body.append(o);let h=n._mediaStreamTrack;s.srcObject=new MediaStream([h]),s.play().catch(eR);const f=o.getContext("2d");if(!f)throw new Ce(se.UNEXPECTED_ERROR,"can not get canvas context");const g=xn(),y=o.captureStream(g.supportRequestFrame?0:d).getVideoTracks()[0];y.canvas||(y.canvas=o),o.startCapture=()=>{if(!s)return o.stopCapture&&o.stopCapture();if(s.paused&&s.play(),s.videoHeight>2&&s.videoWidth>2){const b=s.videoWidth,N=s.videoHeight/b,I=o.width*N;Math.abs(I-o.height)>=2&&(M.debug("adjust low stream resolution","".concat(o.width,"x").concat(o.height," -> ").concat(o.width,"x").concat(I)),o.height=I)}f.drawImage(s,0,0,o.width,o.height),y.requestFrame&&y.requestFrame(),h!==n._mediaStreamTrack&&(h=n._mediaStreamTrack,s.srcObject=new MediaStream([h]))},o.stopCapture=m4(()=>o.startCapture&&o.startCapture(),d);const x=y.stop;return y.stop=()=>{x.call(y),s&&(s.remove(),s.srcObject=null,s=null),o&&(o.width=0,o.remove(),o.stopCapture&&o.stopCapture(),o.startCapture=void 0,o.stopCapture=void 0,o=null),M.debug("clean low stream renderer")},y}var $J=function(n){return n[n.Video_Send_Type=190]="Video_Send_Type",n}($J||{}),Bh=function(n){return n[n.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",n[n.Video_Send_Freeze=2082]="Video_Send_Freeze",n[n.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",n[n.Video_Recv_Freeze=2084]="Video_Recv_Freeze",n[n.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",n[n.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",n[n.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",n[n.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",n}(Bh||{}),rn=function(n){return n[n.Video_Send_Retransmit=2062]="Video_Send_Retransmit",n[n.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",n[n.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",n[n.Video_Send_Transmit=2066]="Video_Send_Transmit",n[n.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",n[n.Video_Capture_Height=2033]="Video_Capture_Height",n[n.Video_Capture_Width=2035]="Video_Capture_Width",n[n.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",n[n.Video_Send_Low_Height=2073]="Video_Send_Low_Height",n[n.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",n[n.Video_Send_Low_Width=2077]="Video_Send_Low_Width",n[n.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",n[n.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",n[n.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",n[n.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",n[n.Video_Send_Width=2003]="Video_Send_Width",n[n.Video_Send_Height=2004]="Video_Send_Height",n[n.Video_Send_Disabled=2095]="Video_Send_Disabled",n[n.Video_Send_Adaptation=2032]="Video_Send_Adaptation",n[n.Video_Send_Player_Status=2128]="Video_Send_Player_Status",n[n.Video_Send_Nacks=2009]="Video_Send_Nacks",n[n.Video_Send_Plis=2010]="Video_Send_Plis",n[n.Video_Send_Firs=2011]="Video_Send_Firs",n[n.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",n[n.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",n[n.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",n[n.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",n[n.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",n[n.Video_Send_Bitrate=2012]="Video_Send_Bitrate",n[n.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",n[n.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",n[n.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",n[n.Audio_Send_Level=2038]="Audio_Send_Level",n[n.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",n[n.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",n[n.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",n[n.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",n[n.Audio_Send_Freeze=2081]="Audio_Send_Freeze",n[n.Audio_Send_Disabled=2096]="Audio_Send_Disabled",n[n.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",n[n.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",n[n.Video_Recv_Height=2019]="Video_Recv_Height",n[n.Video_Recv_Width=2018]="Video_Recv_Width",n[n.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",n[n.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",n[n.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",n[n.Video_Recv_Nacks=2026]="Video_Recv_Nacks",n[n.Video_Recv_Plis=2027]="Video_Recv_Plis",n[n.Video_Recv_Firs=2028]="Video_Recv_Firs",n[n.Video_Recv_Disabled=2101]="Video_Recv_Disabled",n[n.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",n[n.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",n[n.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",n[n.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",n[n.Audio_Render_Level=2043]="Audio_Render_Level",n[n.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",n[n.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",n[n.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",n[n.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",n[n.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",n[n.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",n[n.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",n[n.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",n[n.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",n[n.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",n[n.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",n[n.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",n}(rn||{}),Ds=function(n){return n[n.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",n[n.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",n[n.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",n[n.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",n[n.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",n[n.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",n[n.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",n[n.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",n[n.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",n[n.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",n[n.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",n[n.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",n[n.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",n[n.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",n[n.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",n[n.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",n[n.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",n[n.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",n[n.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",n[n.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",n[n.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",n[n.Audio_Recv_AV_Sync_TIME=2237]="Audio_Recv_AV_Sync_TIME",n}(Ds||{}),ua=function(n){return n[n.RTT=2006]="RTT",n[n.CONN_TYPE=801]="CONN_TYPE",n[n.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",n}(ua||{}),zx=function(n){return n[n.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",n[n.PAGE_VISIBILITY=2233]="PAGE_VISIBILITY",n}(zx||{}),g3=function(n){return n[n.Transport_Send_Bitrate=2234]="Transport_Send_Bitrate",n[n.Transport_Recv_Bitrate=2235]="Transport_Recv_Bitrate",n}(g3||{});const Iy=1e3,kP=6,vR=3,cwe=Math.max(kP,vR,60);function Ft(n,i,s){s!=null&&Number.isFinite(s)&&(n[i]=Math.round(Math.max(0,s)))}function XJ(n){const i={[ua.CONN_TYPE]:0,[ua.RTT]:n.rtt,[ua.STATS_UPDATE_INTERVAL]:n.updateInterval?Math.round(Math.max(0,n.updateInterval)):void 0};switch(n.selectedCandidatePair.localCandidate.candidateType){case"relay":{const s=n.selectedCandidatePair.localCandidate.relayProtocol;s==="udp"&&(i[ua.CONN_TYPE]=1),s==="tcp"&&(i[ua.CONN_TYPE]=3),s==="tls"&&(i[ua.CONN_TYPE]=4);break}case"srflx":i[ua.CONN_TYPE]=2;break;case"unknown":i[ua.CONN_TYPE]=5;break;default:i[ua.CONN_TYPE]=0}return i}function JJ(n){let i=0;switch(n){case"none":i=0;break;case"cpu":i=1;break;case"bandwidth":i=2;break;case"other":i=3}return i}class QJ extends ai{constructor(i){super(),Y(this,"store",void 0),Y(this,"uploadWRTCStatsTimer",void 0),Y(this,"uploadOutboundDenoiserStatsTimer",void 0),Y(this,"uploadExtStatsTimer",void 0),Y(this,"uploadExtUsageStatsTimer",void 0),Y(this,"uploadInboundExtStatsTimer",void 0),Y(this,"requestStats",void 0),Y(this,"requestTransportStats",void 0),Y(this,"requestLocalMedia",void 0),Y(this,"requestRemoteMedia",void 0),Y(this,"requestAllTracks",void 0),Y(this,"requestVideoIsReady",void 0),Y(this,"requestUploadStats",void 0),Y(this,"requestUpload",void 0),Y(this,"uploadOutboundStarted",!1),Y(this,"uploadInboundStarted",!1),Y(this,"uploadTransportStarted",!1),Y(this,"uploadBaseStatsStarted",!1),Y(this,"uploadExtensionUsageStarted",!1),Y(this,"lastRecvStats",void 0),Y(this,"lastSendStats",void 0),Y(this,"lastRefRecvStats",void 0),Y(this,"lastRefSendStats",void 0),Y(this,"lastNormalRecvStats",void 0),Y(this,"lastNormalSendStats",void 0),Y(this,"lastExtendStats",{}),Y(this,"needUploadStats",{}),Y(this,"needUploadRenderFreezeTime",!0),Y(this,"lastUploadCompensateTime",-1),Y(this,"uploadCompensateDeltaTime",0),this.store=i}uploadWRTCStats(i){if(!this.requestStats||!this.requestUploadStats)return;const s=i%vR==0,o=i%kP==0,d=i%60==0;let h,f;if(this.uploadTransportStarted&&(h=this.requestStats(),this.store.useP2P&&(f=this.requestStats(!0))),!h&&this.uploadOutboundStarted&&(h=this.requestStats()),!f&&this.uploadInboundStarted&&(f=this.requestStats(!0)),h||f){var g;const y={};if(this.uploadTransportStarted&&h){const b=this.getTransportStats(h,s?this.lastRefSendStats:void 0,f,s);b&&(y.misc=[b])}if(this.uploadOutboundStarted&&h){const b=this.getOutboundStats(h,o?this.lastNormalSendStats:void 0,s?this.lastRefSendStats:void 0,this.lastSendStats,d);b&&(y.outbound=[b])}if(this.uploadInboundStarted&&f){this.uploadCompensateStats(i);const b=this.getInboundStats(f,o?this.lastNormalRecvStats:void 0,s?this.lastRefRecvStats:void 0,this.lastRecvStats);b&&(y.inbound=b)}const x=(g=this.requestTransportStats)===null||g===void 0?void 0:g.call(this).connectState;if(x&&(Array.isArray(y.misc)?y.misc[0]&&y.misc[0].addition&&(y.misc[0].addition[zx.RTC_PEER_CONNECTION_STATE]=ZV[x]):y.misc=[{addition:{[zx.RTC_PEER_CONNECTION_STATE]:ZV[x]}}]),xl.needUploadStats.length>0||o){const b=xl.needUploadStats.shift()||(xl.visibility==="visible"?1:0);Array.isArray(y.misc)?y.misc[0]&&y.misc[0].addition&&(y.misc[0].addition[zx.PAGE_VISIBILITY]=b):y.misc=[{addition:{[zx.PAGE_VISIBILITY]:b}}]}this.needUploadStats.sendType&&(Array.isArray(y.outbound)&&y.outbound[0]&&y.outbound[0].high&&(y.outbound[0].high[$J.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(y)}this.lastRecvStats=f,this.lastSendStats=h,o&&(this.lastNormalRecvStats=f,this.lastNormalSendStats=h),s&&(this.lastRefRecvStats=f,this.lastRefSendStats=h)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0,xl.startCollectStats();let i=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var s,o;const d=(s=this.requestTransportStats)===null||s===void 0?void 0:s.call(this);return void(d&&((o=this.requestUploadStats)===null||o===void 0||o.call(this,{misc:[{addition:{[zx.RTC_PEER_CONNECTION_STATE]:ZV[d.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(i),++i===cwe+1&&(i=1)},Iy)}uploadCompensateStats(i){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const s=i%vR==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!s)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const o=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=o,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const d=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*d;const h=this.requestStats(!0);new Array(d).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const f={};if(this.uploadInboundStarted&&h){const g=this.requestRemoteMedia()||[],y=[];g.forEach(x=>{let[b,N]=x;const I={peer:b.uid};if(b._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(b._videoSSRC)&&N.has(pt.VIDEO)&&b.videoTrack){const D=function($,z,K){if(!z.videoRecv.find(oe=>oe.ssrc===$))return;const ie={};if(K&&K._player){const oe=K._player,{renderFreezeAccTime2:fe,videoElementStatus:Ee}=oe;if(xl.visibility==="visible"&&Ee===Da.PLAYING&&xn().supportRequestVideoFrameCallback){const Te=Math.min(6e3,fe);oe.renderFreezeAccTime2=Math.max(0,fe-Te),Ft(ie,Bh.Video_Render_Freeze_Time_Render2,Te),re("USE_NEW_RENDER_FREEZE_TIME")&&Ft(ie,Bh.Video_Render_Freeze_Time_Render,Te)}}return ie}(b._videoSSRC,h,b.videoTrack);D&&(I.video=D)}I.video&&y.push(I)}),y.length>0&&(f.inbound=y,this.requestUploadStats(f))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(i,s,o,d){if(!this.requestStats)return;if(!d)return i.rtt==null?void 0:{addition:{[ua.RTT]:i.rtt,[ua.CONN_TYPE]:void 0,[ua.STATS_UPDATE_INTERVAL]:i.updateInterval||void 0}};const h=XJ(i);if(this.store.useP2P){if(o){const f=XJ(o);h[ua.CONN_TYPE]&&f[ua.CONN_TYPE]&&(h[ua.CONN_TYPE]+=f[ua.CONN_TYPE]<<3)}h[ua.CONN_TYPE]?h[ua.CONN_TYPE]+=110:h[ua.CONN_TYPE]=110}else{h[ua.CONN_TYPE]?h[ua.CONN_TYPE]+=100:h[ua.CONN_TYPE]=100;const f=function(g,y){return y?[Math.ceil(8*(g.transport.bytesSent-y.transport.bytesSent)/(g.timestamp-y.timestamp)),Math.ceil(8*(g.transport.bytesReceived-y.transport.bytesReceived)/(g.timestamp-y.timestamp))]:[0,0]}(i,s);h[g3.Transport_Send_Bitrate]=f[0],h[g3.Transport_Recv_Bitrate]=f[1]}return{addition:h}}getOutboundStats(i,s,o,d,h){if(!this.requestUploadStats||!this.requestLocalMedia)return;const f=this.requestLocalMedia();if(!f||f.length===0)return;let g,y,x;return f.forEach(b=>{let[N,{track:I,ssrcs:D}]=b;switch(N){case qe.LocalVideoLowTrack:case qe.LocalVideoTrack:if(N===qe.LocalVideoTrack){var $;const z=function(fe,Ee,Te,_e,Re,je){const Be=Ee.videoSend.find(dn=>dn.ssrc===fe);if(!Be)return;const dt={},{sentFrame:Ht,inputFrame:Bt}=Be;if(_e&&(Ft(dt,Bh.Video_Send_Qp_Sum,Be.qpSumPerFrame),Bt&&Ht)){const dn=Bt.frameRate,sn=Ht.frameRate;dt[Bh.Video_Send_Freeze]=function(Qn,ei){let Ue=!0;return Ue=!(Qn<=5)&&(Qn<=10?ei<3:Qn<=20?ei<4:ei<5),Ue}(dn,sn)?1:0}if(Re){switch(Ht&&(Ft(dt,rn.Video_Send_Height,Ht.height),Ft(dt,rn.Video_Send_Width,Ht.width),Ft(dt,rn.Video_Send_Frame_Rate,Ht.frameRate)),dt[rn.Video_Send_Disabled]=Te._originMediaStreamTrack&&!Te._originMediaStreamTrack.enabled||Te._mediaStreamTrack&&!Te._mediaStreamTrack.enabled?1:0,Be.adaptionChangeReason){case"none":dt[rn.Video_Send_Adaptation]=0;break;case"cpu":dt[rn.Video_Send_Adaptation]=1;break;case"bandwidth":dt[rn.Video_Send_Adaptation]=2;break;case"other":dt[rn.Video_Send_Adaptation]=3}let dn=0;Be.adaptionChangeReason&&(dn+=JJ(Be.adaptionChangeReason)),Ee.qualityLimitationReason&&(dn+=JJ(Ee.qualityLimitationReason)<<3),dt[rn.Video_Send_Adaptation]=dn,dt[rn.Video_Send_Player_Status]=h4[Te._player?Te._player.videoElementStatus:"uninit"],Ft(dt,rn.Video_Send_Nacks,Be.nacksCount),Ft(dt,rn.Video_Send_Plis,Be.plisCount),Ft(dt,rn.Video_Send_Firs,Be.firsCount),Ft(dt,rn.Video_Send_Avg_Encode,Be.avgEncodeMs),Ft(dt,rn.Video_Send_Huge_Frame_Sent,Be.hugeFramesSent),Ft(dt,rn.Video_Send_Bytes_Retransmit,Be.retransmittedBytesSent),Ft(dt,rn.Video_Send_Packages_Retransmit,Be.retransmittedPacketsSent),Ft(dt,rn.Video_Send_Key_Frames_Encoded,Be.keyFramesEncoded);const sn=Re.videoSend.find(Qn=>Qn.ssrc===fe);if(sn){let Qn=Iy*vR;sn.timestamp&&Be.timestamp&&(Qn=Be.timestamp-sn.timestamp),sn.packets!=null&&Be.packets!=null&&Ft(dt,rn.Video_Send_Package_Rate,1e3*(Be.packets-sn.packets)/Qn),Be.packetsLost!=null&&sn.packetsLost!=null&&Ft(dt,rn.Video_Send_Package_Lost,Be.packetsLost-sn.packetsLost),sn.bytes!=null&&Be.bytes!=null&&Ft(dt,rn.Video_Send_Bitrate,8*(Be.bytes-sn.bytes)/Qn)}}return dt}(D[0].ssrcId,i,I,s,o),K=I.__className__==="CameraVideoTrack"?3:Ge($=I._hints).call($,or.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==K||h)&&(this.needUploadStats={sendType:K},this.lastExtendStats.sendType=K);const ie=I&&function(fe,Ee,Te,_e){const Re=Ee.videoSend.find(Be=>Be.ssrc===fe);if(!Re)return null;const je={};if(_e){const Be=Re.inputFrame,dt=Be&&Be.height||Te.videoHeight||0,Ht=Be&&Be.width||Te.videoWidth||0,Bt=Be&&Be.frameRate||0;Ft(je,rn.Video_Capture_Height,dt),Ft(je,rn.Video_Capture_Width,Ht),Ft(je,rn.Video_Capture_Frame_Rate,Bt)}return je}(D[0].ssrcId,i,I,!!o),oe=function(fe,Ee){const Te={};return Ee&&(Ft(Te,rn.Video_Send_Retransmit,fe.bitrate.retransmit),Ft(Te,rn.Video_Send_Target_Encoded,fe.bitrate.targetEncoded),Ft(Te,rn.Video_Send_Actual_Encoded,fe.bitrate.actualEncoded),Ft(Te,rn.Video_Send_Transmit,fe.bitrate.transmit),Ft(Te,rn.Video_Send_Bandwidth,fe.sendBandwidth)),Te}(i,!!o);y=Object.assign({},z,ie,oe)}else x=function(z,K,ie,oe,fe){const Ee=K.videoSend.find(_e=>_e.ssrc===z);if(!Ee)return;const Te={};if(oe){const _e=Ee.sentFrame;_e&&(Ft(Te,rn.Video_Send_Low_Height,_e.height),Ft(Te,rn.Video_Send_Low_Width,_e.width),Ft(Te,rn.Video_Send_Low_Frame_Rate,_e.frameRate));const Re=oe.videoSend.find(je=>je.ssrc===z);if(Re){let je=Iy*kP;Re.timestamp&&Ee.timestamp&&(je=Ee.timestamp-Re.timestamp),Re.packets!=null&&Ee.packets!=null&&Ft(Te,rn.Video_Send_Low_Package_Rate,1e3*(Ee.packets-Re.packets)/je),Ee.packetsLost!=null&&Re.packetsLost!=null&&Ft(Te,rn.Video_Send_Low_Package_Lost,Ee.packetsLost-Re.packetsLost),Re.bytes!=null&&Ee.bytes!=null&&Ft(Te,rn.Video_Send_Low_Bitrate,8*(Ee.bytes-Re.bytes)/je)}}return Te}(D[0].ssrcId,i,0,o);break;case qe.LocalAudioTrack:g=I&&function(z,K,ie,oe,fe,Ee){const Te=K.audioSend.find(Re=>Re.ssrc===z);if(!Te)return;const _e={};if(fe){_e[rn.Audio_Send_Disabled]=ie._originMediaStreamTrack&&!ie._originMediaStreamTrack.enabled||ie._mediaStreamTrack&&!ie._mediaStreamTrack.enabled?1:0;const Re=100*ie._source.getAccurateVolumeLevel(),je=Te.inputLevel;if(je!=null){const dt=Math.ceil(50*Math.log10(100*je+1));Ft(_e,rn.Audio_Send_Level,dt)}Ft(_e,rn.Audio_Capture_PCM_Level,Re),Ft(_e,rn.Audio_Send_AEC_Return_Loss,Te.aecReturnLoss),Ft(_e,rn.Audio_Send_AEC_Return_Loss_Enhancement,Te.aecReturnLossEnhancement),Ft(_e,rn.Audio_Send_Bytes_Retransmit,Te.retransmittedBytesSent),Ft(_e,rn.Audio_Send_Packages_Retransmit,Te.retransmittedPacketsSent),_e[rn.Audio_Send_Freeze]=0;const Be=fe.audioSend.find(dt=>dt.ssrc===z);if(Be){let dt=Iy*kP;Be.timestamp&&Te.timestamp&&(dt=Te.timestamp-Be.timestamp),Be.bytes!=null&&Te.bytes!=null&&Ft(_e,rn.Audio_Send_Bitrate,8*(Te.bytes-Be.bytes)/dt),Be.packets!=null&&Te.packets!=null&&Ft(_e,rn.Audio_Send_Package_Rate,1e3*(Te.packets-Be.packets)/dt)}}return _e}(D[0].ssrcId,i,I,0,o)}}),{high:y,low:x,audio:g}}getInboundStats(i,s,o,d){if(!this.requestRemoteMedia)return;const h=this.requestRemoteMedia()||[],f=[];return h.forEach(g=>{let[y,x]=g;const b={peer:y.uid};let N;if(x.has(pt.VIDEO)&&y.videoTrack){const I=y._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(y._videoSSRC)||!1,D=y.videoTrack?function($,z,K,ie,oe,fe,Ee,Te){const _e=z.videoRecv.find(sn=>sn.ssrc===$);if(!_e)return;const Re={},{receivedFrame:je,outputFrame:Be,decodeFrameRate:dt}=_e;Ft(Re,Ds.Video_Render_Frame_Rate_Decode,dt),_e.framesRateFirefox&&Ft(Re,Ds.Video_Recv_Frame_Rate,_e.framesRateFirefox),je&&Ft(Re,Ds.Video_Recv_Frame_Rate,je.frameRate),Ft(Re,Ds.Video_Recv_Frame_Dropped,_e.framesDroppedCount),Ft(Re,Ds.Video_Recv_Bytes_Retransmit,_e.retransmittedBytesReceived),Ft(Re,Ds.Video_Recv_Packages_Retransmit,_e.retransmittedPacketsReceived),Ft(Re,Ds.Video_Recv_Packages_Discarded,_e.packetsDiscarded),Ft(Re,Ds.Video_Recv_Avg_Decode,_e.avgDecodeMs),Ft(Re,Ds.Video_Recv_Avg_Processing_Delay,_e.avgProcessingDelayMs),Ft(Re,Ds.Video_Recv_Avg_Assembly_Time,_e.avgFramesAssembledFromMultiplePacketsMs),Ft(Re,Ds.Video_Recv_Avg_Inter_Frame_Delay,_e.avgInterFrameDelayMs),Ft(Re,Ds.Video_Recv_Key_Frames_Decoded,_e.keyFramesDecoded);const Ht=Te&&Te.videoRecv.find(sn=>sn.ssrc===$);if(Ht){const sn=z.timestamp-Te.timestamp||Iy;_e.packetsLost!=null&&Ht.packetsLost!=null&&Ft(Re,Ds.Video_Recv_Package_Lost,_e.packetsLost-Ht.packetsLost),Ht.bytes!=null&&_e.bytes!=null&&Ft(Re,Ds.Video_Recv_Bitrate,8*(_e.bytes-Ht.bytes)/sn),Ht.packets!=null&&_e.packets!=null&&Ft(Re,Ds.Video_Recv_Package_Rate,1e3*(_e.packets-Ht.packets)/sn)}const Bt=fe&&fe.videoRecv.find(sn=>sn.ssrc===$);if(Bt&&(Ft(Re,Bh.Video_Recv_Qp_Sum,_e.qpSumPerFrame),Re[Bh.Video_Recv_Freeze]=ie&&_R.isRemoteVideoFreeze(K,_e,Bt)?1:0),Ee){var dn;const sn=Ee.videoRecv.find(ei=>ei.ssrc===$);je?(Ft(Re,rn.Video_Recv_Height,je.height),Ft(Re,rn.Video_Recv_Width,je.width)):K&&(Ft(Re,rn.Video_Recv_Height,K._videoHeight||0),Ft(Re,rn.Video_Recv_Width,K._videoWidth||0)),Be&&Ft(Re,rn.Video_Recv_Frame_Rate_Output,Be.frameRate);const Qn=(dn=K._player)===null||dn===void 0?void 0:dn.rendFrameRate.toFixed(0);if(Qn&&Ft(Re,rn.Video_Render_Frame_Rate_Render,+Qn),Ft(Re,rn.Video_Recv_Jitter_Buffer,_e.jitterBufferMs),Ft(Re,rn.Video_Recv_Current_Delay,_e.currentDelayMs),Ft(Re,rn.Video_Recv_Firs,_e.firsCount),Ft(Re,rn.Video_Recv_Nacks,_e.nacksCount),Ft(Re,rn.Video_Recv_Plis,_e.plisCount),K){Re[rn.Video_Recv_Disabled]=K._originMediaStreamTrack.enabled&&K._mediaStreamTrack.enabled?0:1;const ei=K._player;if(ei){const{freezeTimeCounterList:Ue,renderFreezeAccTime:Qe,renderFreezeAccTime2:ft,videoElementStatus:Fe}=ei;if(Ue&&Ue.length>0&&Ft(Re,Bh.Video_Render_Freeze_Time,Ue.splice(0,1)[0]),oe&&xl.visibility==="visible"&&Fe===Da.PLAYING&&xn().supportRequestVideoFrameCallback){const B=Math.min(6e3,ft);ei.renderFreezeAccTime2=Math.max(0,ft-B),Ft(Re,Bh.Video_Render_Freeze_Time_Render2,B);const ue=Math.min(6e3,Qe);ei.renderFreezeAccTime=Math.max(0,Qe-ue),Ft(Re,Bh.Video_Render_Freeze_Time_Render,re("USE_NEW_RENDER_FREEZE_TIME")?B:ue)}if(typeof _e.totalFreezesDuration=="number"){const B=sn&&sn.totalFreezesDuration?_e.totalFreezesDuration-sn.totalFreezesDuration:_e.totalFreezesDuration;Ft(Re,rn.Video_Render_Freeze_Duration,1e3*B)}}}if(Re[rn.Video_Recv_Player_Status]=h4[K._player?K._player.videoElementStatus:"uninit"],sn&&_e.totalInterFrameDelay!==void 0&&_e.totalSquaredInterFrameDelay!==void 0&&sn.totalInterFrameDelay!==void 0&&sn.totalSquaredInterFrameDelay!==void 0){const ei=_e.totalInterFrameDelay-sn.totalInterFrameDelay,Ue=_e.totalSquaredInterFrameDelay-sn.totalSquaredInterFrameDelay,Qe=_e.framesDecodeCount-sn.framesDecodeCount,ft=ei/Qe*1e3,Fe=Math.round(1e3*Math.sqrt((Ue-Math.pow(ei,2)/Qe)/Qe));!isNaN(Fe)&&ft+Fe>Math.max(3*ft,ft+150)&&(Re[rn.Video_Recv_I_Frame_Delay]=Fe)}}return Re}(y._videoSSRC,i,y.videoTrack,I===!0,this.needUploadRenderFreezeTime,s,o,d):void 0;if(D&&(b.video=D),y.videoTrack){const $=i.videoRecv.find(z=>z.ssrc===y._videoSSRC);$&&$.estimatedPlayoutTimestamp&&(N=$.estimatedPlayoutTimestamp)}}if(x.has(pt.AUDIO)&&y.audioTrack){const I=y.audioTrack?function(D,$,z,K,ie,oe){const fe=$.audioRecv.find(Re=>Re.ssrc===D);if(!fe)return;const Ee={};Ft(Ee,Ds.Audio_Recv_Jitter,fe.jitterMs),Ft(Ee,Ds.Audio_Recv_Bytes_Retransmit,fe.retransmittedBytesReceived),Ft(Ee,Ds.Audio_Recv_Packages_Retransmit,fe.retransmittedPacketsReceived),Ft(Ee,Ds.Audio_Recv_Packages_Discarded,fe.packetsDiscarded),Ft(Ee,Ds.Audio_Recv_Avg_Processing_Delay,fe.avgProcessingDelayMs);const Te=oe&&oe.audioRecv.find(Re=>Re.ssrc===D);if(Te){const Re=Iy;fe.packets!=null&&Te.packets!=null&&Ft(Ee,Ds.Audio_Recv_Package_Rate,1e3*(fe.packets-Te.packets)/Re),fe.packetsLost!=null&&Te.packetsLost!=null&&Ft(Ee,Ds.Audio_Recv_Package_Lost,fe.packetsLost-Te.packetsLost)}if(K){const{receivedFrames:Re,droppedFrames:je}=fe;Re!=null&&je!=null&&(Ee[Bh.Audio_Recv_Freeze]=(_e=Re)===0||100*je/_e>20?1:0)}var _e;if(ie){const Re=100*z._source.getAccurateVolumeLevel(),je=fe.outputLevel;if(je!=null){const dt=Math.ceil(50*Math.log10(100*je+1));Ft(Ee,rn.Audio_Render_Level,dt)}Ft(Ee,rn.Audio_Recv_PCM_Level,Re),z&&(Ee[rn.Audio_Recv_Disabled]=z._originMediaStreamTrack.enabled&&z._mediaStreamTrack.enabled?0:1),Ft(Ee,rn.Audio_Recv_Jitter_Buffer,fe.jitterBufferMs),Ft(Ee,rn.Audio_Recv_Current_Delay,fe.jitterBufferMs),Ee[rn.Audio_Recv_Player_Status]=h4[uo.getPlayerState(z.getTrackId())];const Be=ie.audioRecv.find(dt=>dt.ssrc===D);if(Be){Be.bytes!=null&&fe.bytes!=null&&Ft(Ee,rn.Audio_Recv_Bitrate,8*(fe.bytes-Be.bytes)/(Iy*vR));const dt=fe.concealedSamples-Be.concealedSamples;dt>0&&Ft(Ee,rn.Audio_Recv_Concealed_Samples,dt);const Ht=fe.totalSamplesReceived-Be.totalSamplesReceived;Ht>0&&Ft(Ee,rn.Audio_Recv_Total_Samples_Received,Ht);const Bt=fe.freezeSamples80-Be.freezeSamples80;Bt>0&&Ft(Ee,rn.Audio_Render_Freeze_Samples_80ms,Bt);const dn=fe.freezeSamples200-Be.freezeSamples200;dn>0&&Ft(Ee,rn.Audio_Render_Freeze_Samples_200ms,dn);const sn=fe.freezeMs80-Be.freezeMs80;Ft(Ee,rn.Audio_Render_Freeze_Time_80ms,sn<0?0:sn);const Qn=fe.freezeMs200-Be.freezeMs200;Ft(Ee,rn.Audio_Render_Freeze_Time_200ms,Qn<0?0:Qn)}}return Ee}(y._audioSSRC,i,y.audioTrack,s,o,d):void 0;if(I&&(b.audio=I),y.audioTrack&&N){const D=i.audioRecv.find($=>$.ssrc===y._audioSSRC);if(D&&D.estimatedPlayoutTimestamp){const $=D.estimatedPlayoutTimestamp-N;b.audio?b.audio[Ds.Audio_Recv_AV_Sync_TIME]=$:b.audio={[Ds.Audio_Recv_AV_Sync_TIME]:$}}}}(b.video||b.audio)&&f.push(b)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,f}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const i=(this.requestAllTracks()||[]).find(s=>s instanceof aR);if(i&&i._external.getDenoiserStats){const s=i._external.getDenoiserStats();s&&this.requestUpload(Ty.DENOISER_STATS,s)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(i=>{i.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(i=>{let[s,o]=i;o.has(pt.VIDEO)&&s.videoTrack&&s.videoTrack.getProcessorStats().forEach(d=>{this.requestUpload&&this.requestUpload(d.type,d.stats)}),o.has(pt.AUDIO)&&s.audioTrack&&s.audioTrack.getProcessorStats().forEach(d=>{this.requestUpload&&this.requestUpload(d.type,d.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const i=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const s=Date.now(),o={connectionInterval:re("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:s};let d=[];const h=this.requestAllTracks&&this.requestAllTracks()||[];for(const x of h)!x.muted&&x.enabled&&(d=d.concat(await x.getProcessorUsage()));const f=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[x,b]of f)b.has(pt.VIDEO)&&x.videoTrack&&(d=d.concat(await x.videoTrack.getProcessorUsage())),b.has(pt.AUDIO)&&x.audioTrack&&(d=d.concat(await x.audioTrack.getProcessorUsage()));if(d.length===0)return;o.details=function(x,b){const N={};for(const{id:z,value:K,level:ie,direction:oe}of x){var I;const fe=(I=b.get(z))!==null&&I!==void 0?I:0,Ee=K===2?fe+re("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:fe;var D,$;b.set(z,Ee),N[z]?(K===2&&(N[z].value=K),ie>N[z].level&&(N[z].level=ie),oe==="remote"&&(N[z].remoteUidCount+=1),N[z].totalTs=(D=b.get(z))!==null&&D!==void 0?D:0):N[z]={value:K,level:ie,remoteUidCount:oe==="local"?0:1,totalTs:($=b.get(z))!==null&&$!==void 0?$:0}}return Object.keys(N).map(z=>{const{level:K,value:ie,totalTs:oe}=N[z];return{id:z,level:K,value:ie,totalTs:oe}})}(d,i);const g=Date.now(),y=g>s?g:s+1;this.requestUpload&&this.requestUpload(Ty.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:y})},re("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1,xl.stopCollectStats()}}const lwe=re("ICE_RESTART_INTERVAL");let PP=new Map,Gx=new Map,Zg=[Ys.UDP_TCP_RELAY,Ys.TCP_RELAY,Ys.RELAY],_3=re("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&xn().supportPCSetConfiguration;function ZJ(n){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=PP.get(n.id);s&&(window.clearTimeout(s),PP.delete(n.id));const o=Gx.get(n.id);i&&o&&o.index===Zg.length-1&&(M.debug("[".concat(n.id,"] reset ICE restart policy")),Gx.delete(n.id))}function eQ(n,i,s){if(PP.size===0&&Gx.size===0&&(Array.isArray(re("RESTART_SEQUENCE"))&&re("RESTART_SEQUENCE").length>0&&!function(g,y){if(g.length!==y.length)return!1;for(let x=0;x<g.length;x+=1){const b=g[x];if(g.filter(N=>N===b).length!==y.filter(N=>N===b).length)return!1}return!0}(Zg,re("RESTART_SEQUENCE"))&&(Zg=re("RESTART_SEQUENCE").filter(g=>{var y;if(Ge(y=Object.values(Ys)).call(y,g))return!0}),M.debug("use reconnection policy from config distribution, queues: ".concat(Zg.join(" => ")))),_3=re("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&xn().supportPCSetConfiguration),Zg.length===0)return void s();let o,{index:d=0,type:h}=Gx.get(n.id)||{};if(_3&&h===Ys.RELAY)return void s();let f=h&&d>=Zg.length-1;if(_3)h=Ys.RELAY;else{if(f)return void s();h?(d++,h=Zg[d]):(h=Zg[0],d=0)}M.debug("[".concat(n.id,"] choose ICE restart policy: ").concat(h,", index: ").concat(d)),i(h),Gx.set(n.id,{index:d,type:h}),o=window.setTimeout(()=>eQ(n,i,s),lwe),PP.set(n.id,o)}var wn;function tQ(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function of(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?tQ(Object(s),!0).forEach(function(o){Y(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):tQ(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}function nQ(n){var i,s,o,d=2;for(typeof Symbol<"u"&&(s=Tk,o=Symbol.iterator);d--;){if(s&&(i=n[s])!=null)return i.call(n);if(o&&(i=n[o])!=null)return new DP(i.call(n));s="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function DP(n){function i(s){if(Object(s)!==s)return et.reject(new TypeError(s+" is not an object."));var o=s.done;return et.resolve(s.value).then(function(d){return{value:d,done:o}})}return DP=function(s){this.s=s,this.n=s.next},DP.prototype={s:null,n:null,next:function(){return i(this.n.apply(this.s,arguments))},return:function(s){var o=this.s.return;return o===void 0?et.resolve({value:s,done:!0}):i(o.apply(this.s,arguments))},throw:function(s){var o=this.s.return;return o===void 0?et.reject(s):i(o.apply(this.s,arguments))}},new DP(n)}let Ay=(wn=class extends ai{get state(){return this._state}set state(n){const i=this._state;this._state=n,this.emit(Dt.StateChange,i,this._state)}constructor(n,i){super(),Y(this,"isPlanB",void 0),Y(this,"store",void 0),Y(this,"statsUploader",void 0),Y(this,"connection",void 0),Y(this,"localTrackMap",new Map),Y(this,"remoteUserMap",new Map),Y(this,"localDataChannels",[]),Y(this,"remoteDataChannelMap",new Map),Y(this,"pendingLocalTracks",[]),Y(this,"pendingRemoteTracks",[]),Y(this,"pendingLocalDataChannels",[]),Y(this,"pendingRemoteDataChannels",[]),Y(this,"statsCollector",void 0),Y(this,"shouldForwardP2PCreation",void 0),Y(this,"iceFailedCount",0),Y(this,"dtlsFailedCount",0),Y(this,"mutex",void 0),Y(this,"_state",rr.Disconnected),Y(this,"_pcStatsUploadType",re("NEW_ICE_RESTART")?fm.FIRST_CONNECTION:fm.OLD_FIRST_CONNECTION),Y(this,"_isStartRestartIce",!1),Y(this,"_restartTimer",void 0),Y(this,"_isTryConnecting",!1),Y(this,"_iceError",null),Y(this,"_forceTurn",!1),Y(this,"_isWaitPcToRePub",!1),Y(this,"handleMuteLocalTrack",async(s,o,d)=>{const h=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==rr.Connected)return void d(new Pe(se.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const f=this.filterTobeMutedTracks(s);if(f.length===0)return void o();const g=f.find(x=>x[0]==="videoLowTrack");if(g){const x=g[1];this.store.enableInstantMuteRestore?(x.track._originMediaStreamTrack.enabled=!1,M.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):x.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?M.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(f.map(x=>{let[,{id:b}]=x;return b}));const y=this.createMuteMessage(f);await Or(this,Dt.RequestMuteLocal,y),o()}catch(f){d(f)}finally{h()}}),Y(this,"handleUnmuteLocalTrack",async(s,o,d)=>{const h=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==rr.Connected)return void d(new Pe(se.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const f=this.filterTobeUnmutedTracks(s);if(f.length===0)return void o();const g=f.find(x=>x[0]==="videoLowTrack");if(g){const x=g[1];if(this.store.enableInstantMuteRestore)x.track._originMediaStreamTrack.enabled=!0,M.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(x.track._originMediaStreamTrack.stop(),!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&xn().supportDualStreamEncoding){const b=s._mediaStreamTrack.clone();x.track._mediaStreamTrack=b,x.track._originMediaStreamTrack=b}else{const b=m3(s,uy(this,Dt.RequestLowStreamParameter));x.track._mediaStreamTrack=b,x.track._originMediaStreamTrack=b}await new et((b,N)=>{this.handleReplaceTrack(x.track,b,N,!0)})}}this.store.enableInstantMuteRestore?M.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(f.map(x=>{let[,{id:b}]=x;return b}));const y=this.createUnmuteMessage(f);await Or(this,Dt.RequestUnmuteLocal,y),o()}catch(f){d(f)}finally{h()}}),Y(this,"handleUpdateVideoEncoder",async(s,o,d,h)=>{let f;h||(f=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const y=this.localTrackMap.get(qe.LocalVideoTrack);if(!this.connection||!y||y.track!==s||this.state!==rr.Connected)return void o();const{id:x,track:b}=y;await this.connection.updateSendParameters(x,b),await this.connection.updateEncoderConfig(x,b),this.emit(Dt.UpdateVideoEncoder,b),o()}catch(y){d(y)}finally{var g;(g=f)===null||g===void 0||g()}}),Y(this,"handleUpdateVideoSendParameters",async(s,o,d)=>{const h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const f=this.localTrackMap.get(qe.LocalVideoTrack);if(!this.connection||!f||f.track!==s||this.state!==rr.Connected)return void o();const{id:g,track:y}=f;await this.connection.updateSendParameters(g,y),o()}catch(f){d(f)}finally{h()}}),Y(this,"handleReplaceMixingTrack",async(s,o,d,h)=>{if(!this.connection||this.state!==rr.Connected)return void o();const f=h3([s]);let g;M.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(f.getTrackId(),"]")),typeof h=="boolean"&&h||(g=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(s,f),o()}catch(x){d(x)}finally{var y;(y=g)===null||y===void 0||y()}}),Y(this,"handleReplaceTrack",async(s,o,d,h)=>{let f;M.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof h=="boolean"&&h||(f=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var g;const x=Array.from(this.localTrackMap.entries()).find(b=>{let[,{track:N}]=b;return s===N});if(!this.connection||!x||this.state!==rr.Connected)return void o();if(await((g=this.connection)===null||g===void 0?void 0:g.replaceTrack(s,x[1].id)),this.isPlanB){const b=x[1];b.id=s._mediaStreamTrack.id,this.localTrackMap.set(x[0],b)}if(x[0]===qe.LocalVideoTrack&&!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&xn().supportDualStreamEncoding){const b=this.localTrackMap.get(qe.LocalVideoLowTrack);if(b){const N=s._mediaStreamTrack.clone();b.track._originMediaStreamTrack.stop(),b.track._mediaStreamTrack=N,b.track._originMediaStreamTrack=N,await new et((I,D)=>{this.handleReplaceTrack(b.track,I,D,!0)})}}o()}catch(x){d(x)}finally{var y;(y=f)===null||y===void 0||y()}}),Y(this,"handleGetRTCStats",s=>{s(this.statsCollector.getRTCStats())}),Y(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),Y(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),Y(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),Y(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=n,this.statsCollector=i,this.statsCollector.addP2PChannel(this),this.statsUploader=new QJ(this.store),this.bindStatsUploaderEvents(),this.mutex=new qs("P2PChannel-mutex",this.store.clientId),this.isPlanB=!xn().supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&Jp(),this.shouldForwardP2PCreation=re("FORWARD_P2P_CREATION")&&xn().supportPCSetConfiguration&&Vq(),this.shouldForwardP2PCreation&&(this.connection=yR(this.store),this.emit(Dt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(n,i){var s;this.state=rr.New,this._forceTurn=f3(n),M.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const o=this.shouldForwardP2PCreation&&((s=this.connection)===null||s===void 0?void 0:s.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||o||i)&&((o||i)&&this.connection&&(M.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=yR(this.store,n),this.emit(Dt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Pe(se.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=re("NEW_ICE_RESTART")?fm.FIRST_CONNECTION:fm.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(n),this.connection.establishPromise}async connect(n){if(!this.connection)throw new Pe(se.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(!this.isPreallocation()||this.state!==rr.Connected){this.store.peerConnectionStart();const i=await this.connection.connect(n);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=rr.Connected,i}if(this.connection instanceof ed&&this.connection.checkDtlsParameters(n.dtlsParameters.fingerprints))return M.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),_t.reportApiInvoke(this.store.sessionId,{name:Qr.MISMATCH_DTLS_PARAMETERS,options:[n.dtlsParameters.fingerprints],tag:Tr.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(Dt.RequestReconnect)});await this.connection.updateRemoteConnect(n)}updateRemoteRTPCapabilities(n){const i=Array.from(this.localTrackMap.entries()).filter(d=>{var h;let[f]=d;return Ge(h=[qe.LocalVideoLowTrack,qe.LocalVideoTrack]).call(h,f)}),s=i.map(d=>{let[,{id:h}]=d;return h}),o=i.map(d=>{let[h]=d;return h});if(this.connection instanceof ed||this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"){if(_t.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(o),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(n)}),!Ge(n).call(n,this.store.codec)){const d=["vp9","vp8","h264"].find(h=>Ge(n).call(n,h));d&&(this.store.codec=d,M.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(d,".")))}this.connection.updateRemoteRTPCapabilities(s,n)}}async getEstablishParams(){var n;return this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof ed&&this.connection.peerConnectionState!=="closed"&&Ge(n=[rr.New,rr.Connected]).call(n,this.state)?this.connection.establishPromise:void 0}async publishDataChannel(n){if(!this.connection||this.state!==rr.Connected){if(this.state===rr.Disconnected)throw new Pe(se.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return n.forEach(s=>{var o;Ge(o=this.pendingLocalDataChannels).call(o,s)||this.pendingLocalDataChannels.push(s)}),[]}const i=this.filterTobePublishedDataChannels(n);return i.length===0?[]:(i.forEach(s=>{const o=Date.now();this.store.publish(s.id.toString(),"datachannel",o)}),await this.connection.createDataChannels(this.store.uid,i),i.forEach(s=>{this.localDataChannels.push(s);const o=Date.now();this.store.publish(s.id+"","datachannel",void 0,o)}),n.map(s=>({streamId:s.id,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:s.metadata,channelId:s._originDataChannelId})))}publish(n,i,s){var o=this;return fc(function*(){const d=yield hn(o.mutex.lock("From P2PChannel.publish"));try{var h;const f=o.connection&&Ge(h=["disconnected","failed"]).call(h,o.connection.peerConnectionState);if(!o.connection||o.state!==rr.Connected||f){if(o.state===rr.Disconnected)throw new Pe(se.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(n);const y=n.filter(x=>o.pendingLocalTracks.indexOf(x)===-1);return o.pendingLocalTracks=o.pendingLocalTracks.concat(y),void(f&&(o._isWaitPcToRePub=!0))}o.store.pubId=o.store.pubId+1,La.markPublishStart(o.store.clientId,o.store.pubId);const g=o.filterTobePublishedTracks(n,i,s);if(g.length===0)return void(yield hn(o.tryToUnmuteAudio(n)));yield*hx(nQ(o.doPublish(o.connection,g)))}finally{d()}})()}doPublish(n,i){var s=this;return fc(function*(){i.forEach(I=>{let{track:D,type:$}=I;const z=Date.now();s.store.publish(D.getTrackId(),$===qe.LocalAudioTrack?"audio":"video",z)}),s.bindLocalTrackEvents(i);const o=i.map(I=>{let{track:D}=I;return D}),d=yield hn(n.send(o,s.store.codec,s.store.audioCodec)),h=(yield hn(d.next())).value,f=s.createGatewayPublishMessage(i,h);let g;try{g=yield f}catch(I){throw d.throw(I),(I==null?void 0:I.code)===se.WS_ABORT&&i.forEach(D=>{let{track:$}=D;s.pendingLocalTracks.indexOf($)===-1&&s.pendingLocalTracks.push($)}),s.unbindLocalTrackEvents(i),I}const y=s.mapPubResToRemoteConfig(f,g,o),x=(yield hn(d.next(y))).value;if(s.state===rr.Disconnected)throw new Pe(se.UNEXPECTED_ERROR,"PeerConnection already disconnected.");re("ENABLE_VIDEO_SEI");const b=re("ENABLE_ENCODED_TRANSFORM"),N=re("ENABLE_AUDIO_METADATA");o.forEach(async I=>{const D=I.getRTCRtpTransceiver();if(!D||!b)return;const{interceptLocalVideoFrame:$,interceptLocalAudioFrame:z}=bP();I.trackMediaType===pt.VIDEO?await $(D.sender,I):I.trackMediaType===pt.AUDIO&&await z(D.sender,{metadata:N?()=>{const K=I.metadata.shift();return K&&K.value}:void 0})}),i.forEach(I=>{let{type:D}=I;s.statsCollector.addLocalStats(D)}),s.assignLocalTracks(i,x),s.statsUploader.startUploadOutboundStats(),i.forEach(I=>{let{track:D,type:$}=I;const z=Date.now();s.store.publish(D.getTrackId(),$===qe.LocalAudioTrack?"audio":"video",void 0,z)})})()}async updateVideoStreamParameter(n,i){const s=this.localTrackMap.get(i);if(!s||!this.connection)return;if(!(s.track instanceof Rr))return M.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:o}=s,d=function(h,f){const g={};return h.height&&h.width&&(g.scaleResolutionDownBy=H4(h,f)),g.maxFramerate=h.framerate?vc(h.framerate):void 0,g.maxBitrate=h.bitrate?1e3*h.bitrate:void 0,g}(n,o);if(o._encoderConfig||(o._encoderConfig={}),i!==qe.LocalVideoLowTrack||!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&xn().supportDualStreamEncoding)d.scaleResolutionDownBy!=null&&(o._encoderConfig.scaleResolutionDownBy=d.scaleResolutionDownBy);else{const h=o._originMediaStreamTrack;if(!h.canvas)return M.warn("[".concat(o.getTrackId(),"] no canvas on track"));(function(f,g){const y=f.canvas;g.width&&(y.width=vc(g.width)),g.height&&(y.height=vc(g.height)),g.framerate&&(y.stopCapture&&y.stopCapture(),y.stopCapture=m4(()=>{!y.startCapture&&y.stopCapture&&y.stopCapture(),y.startCapture&&y.startCapture()},vc(g.framerate)))})(h,n)}d.maxBitrate!=null&&(o._encoderConfig.bitrateMax=d.maxBitrate/1e3),d.maxFramerate!=null&&(o._encoderConfig.frameRate&&typeof o._encoderConfig.frameRate=="object"?o._encoderConfig.frameRate.max=d.maxFramerate:o._encoderConfig.frameRate={max:d.maxFramerate}),M.debug("[".concat(o.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(o._encoderConfig))),await this.connection.updateRtpSenderEncodings(o)}publishLowStream(n){var i=this;return fc(function*(){if(!i.connection||i.state!==rr.Connected)return;const s=yield hn(i.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const d=i.localTrackMap.get(qe.LocalVideoTrack);if(!d)throw new Pe(se.UNEXPECTED_ERROR,"Could not find high stream");if(i.localTrackMap.has(qe.LocalVideoLowTrack))throw new Pe(se.UNEXPECTED_ERROR,"[".concat(i.store.clientId,"] Can't publish low stream when stream already publish"));const h=[{track:i.getLowVideoTrack(d.track,n),type:qe.LocalVideoLowTrack}];if(yield*hx(nQ(i.doPublish(i.connection,h))),d.track.muted||!d.track.enabled){var o;const f=(o=i.localTrackMap.get(qe.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;f!==void 0&&(yield hn(i.connection.muteLocal([f])))}}finally{s()}})()}async republish(){this.pendingLocalTracks.length>0&&(M.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await rs(this,Dt.RequestRePublish,this.pendingLocalTracks),this.emit(Dt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(M.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await rs(this,Dt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(n){for(let i=this.pendingRemoteTracks.length-1;i>=0;i--){const{user:s,kind:o}=this.pendingRemoteTracks[i];(o!==pt.AUDIO||s._audio_added_&&s._audioSSRC)&&(o!==pt.VIDEO||s._video_added_&&s._videoSSRC)||this.pendingRemoteTracks.splice(i,1)}if(n)await rs(this,Dt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:i,kind:s}of this.pendingRemoteTracks)await this.subscribe(i,s,s===pt.VIDEO?i._videoSSRC:i._audioSSRC);this.pendingRemoteTracks.forEach(i=>{let{user:s}=i;this.emit(Dt.MediaReconnectEnd,s.uid)}),this.pendingRemoteTracks=[]}async unpublish(n){if(!this.connection||this.state!==rr.Connected)return void n.forEach(o=>{const d=this.pendingLocalTracks.indexOf(o);d!==-1&&this.pendingLocalTracks.splice(d,1)});const i=this.filterTobeUnpublishedTracks(n);if(i.length===0)return;const s=i.find(o=>o[0]==="videoLowTrack");return s&&s[1].track.close(),this.doUnpublish(this.connection,i)}async unpublishDataChannel(n){if(!this.connection||this.state!==rr.Connected)return void n.forEach(s=>{const o=this.pendingLocalDataChannels.indexOf(s);o!==-1&&this.pendingLocalDataChannels.splice(o,1)});const i=this.filterTobeUnpublishedDataChannels(n);return i.length!==0?(i.forEach(s=>{const o=this.localDataChannels.indexOf(s);o!==-1&&this.localDataChannels.splice(o,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),i.map(s=>s.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==rr.Connected)return;const n=this.localTrackMap.get(qe.LocalVideoLowTrack);if(!n)return;n.track.close();const i=[[qe.LocalVideoLowTrack,n]];return this.doUnpublish(this.connection,i)}async doUnpublish(n,i){const s=this.createGatewayUnpublishMessage(i);return await n.stopSending(i.map(o=>{let[,{id:d}]=o;return d})),this.withdrawLocalTracks(i),this.unbindLocalTrackEvents(i.map(o=>{let[d,{track:h}]=o;return{type:d,track:h}})),i.forEach(o=>{let[d]=o;this.statsCollector.removeLocalStats(d)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),s}async subscribeDataChannel(n,i){if(!this.connection||this.state!==rr.Connected)throw new Pe(se.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const s=i.filter(o=>{var d;return!((d=this.remoteDataChannelMap.get(n))!==null&&d!==void 0&&d.get(o.id))});if(s.length!==0)return await this.connection.createDataChannels(n.uid,s),s.forEach(o=>{var d;this.remoteDataChannelMap.has(n)?(d=this.remoteDataChannelMap.get(n))===null||d===void 0||d.set(o.id,o):this.remoteDataChannelMap.set(n,new Map([[o.id,o]]));const h=this.pendingRemoteDataChannels.findIndex(f=>{let{user:g,id:y}=f;return g.uid===n.uid&&y===o.id});h!==-1&&this.pendingRemoteDataChannels.splice(h,1)}),s.map(o=>o.id)}async subscribe(n,i,s,o,d){var h;if(!this.connection||this.state!==rr.Connected)throw new Pe(se.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((h=this.remoteUserMap.get(n))!==null&&h!==void 0&&h.has(i))return;let f,g,y,x;const b=this.connection.getPreMedia(s);if(b)M.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(s,", no need to send sub to gateway.")),y=b.transceiver,f=b.track,g=b.mid,x=b.player,b.firstVideoRender&&this.store.firstVideoFrameDecoded(n.uid,{firstPreRender:b.firstVideoRender});else if(d){const D=d.find(z=>{let{stream_type:K}=z;return K===i});if(!D)throw new Pe(se.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(i," for user: ").concat(n.uid," because subscribe answer from gateway does not contain stream_type: ").concat(i,"."));const $=await this.connection.receive(i,D.ssrcs,String(n._uintid),D.attributes);(this.connection instanceof ed||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(y=$.transceiver),f=$.track,g=$.id}else{const D=await this.connection.receive(i,[{ssrcId:s,rtx:o}],String(n._uintid),void 0);(this.connection instanceof ed||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(y=D.transceiver),f=D.track,g=D.id}if(i===pt.AUDIO?(n._audioTrack?n._audioTrack._updateOriginMediaStreamTrack(f):(n._audioTrack=new Ix(f,n.uid,n._uintid,this.store),M.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(n._audioTrack.getTrackId()))),y&&n._audioTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(n,n._audioTrack)):(n._videoTrack?n._videoTrack._updateOriginMediaStreamTrack(f):(n._videoTrack=new Nx(f,n.uid,n._uintid,this.store,x),M.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(n._videoTrack.getTrackId())),n._videoTrack.once(Od.PLAY_START,()=>{this.store.firstVideoFrameDecoded(n.uid,{playStart:Date.now()})}),n._videoTrack.once(Od.PLAY_END,()=>{this.store.firstVideoFrameDecoded(n.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(n)}),x?n._videoTrack.once(Od.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(n.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(n)}):n._videoTrack.once(Od.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(n.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(n)})),y&&n._videoTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(n,n._videoTrack)),y&&re("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:$}=bP();i==pt.VIDEO?await D(y.receiver,{onSei:re("ENABLE_VIDEO_SEI")&&(z=>{var K;return(K=n._videoTrack)===null||K===void 0?void 0:K._onSei(z)}),onFirstFrame:z=>{var K;const ie=Array.from(Xa(K=this.remoteUserMap).call(K)).find(oe=>oe._videoSSRC===z.ssrc);ie&&this.store.firstVideoFrameDecoded(ie.uid,{firstReceivedEncodedFrame:Date.now(),frameType:z.type,rtpTimestamp:z.rtpTimestamp,framePayloadType:z.payloadType,frameDataLength:z.length,mimeType:z.mimeType})}}):i==pt.AUDIO&&await $(y.receiver,{enableTopn:!!re("ENABLE_AUDIO_TOPN"),enableMetadata:!!re("ENABLE_AUDIO_METADATA"),enablePts:!!re("ENABLE_AUDIO_PTS"),onMetadata:z=>{this.safeEmit(Dt.AudioMetadata,z)},onPts:z=>{this.safeEmit(Dt.AudioPts,z)}})}const N=this.remoteUserMap.get(n);N?N.set(i,g):this.remoteUserMap.set(n,new Map([[i,g]])),this.statsCollector.addRemoteStats(n.uid),this.statsUploader.startUploadInboundStats();const I=this.pendingRemoteTracks.findIndex(D=>{let{user:$,kind:z}=D;return $.uid===n.uid&&i===z});I!==-1&&(this.pendingRemoteTracks.splice(I,1),this.emit(Dt.MediaReconnectEnd,n.uid))}async massSubscribe(n){return this.massSubscribeNoLock(n)}async massSubscribeNoLock(n){if(!this.connection||this.state!==rr.Connected)throw new Pe(se.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");n=n.filter(d=>{var h;let{user:f,mediaType:g}=d;return!((h=this.remoteUserMap.get(f))!==null&&h!==void 0&&h.has(g))});const i=[],s=new Map;n.forEach(d=>{if(!this.connection)return;const h=this.connection.getPreMedia(d.ssrcId);if(h){const{track:f,mid:g,transceiver:y,player:x}=h;s.set(d.ssrcId,{track:f,id:g,transceiver:y,player:x})}else i.push(d)});const o=await this.connection.batchReceive(i.map(d=>{let{user:h,mediaType:f,ssrcId:g,rtxSsrcId:y}=d;return{kind:f,ssrcMsg:[{ssrcId:g,rtx:y}],mslabel:String(h._uintid)}}));i.forEach((d,h)=>{s.set(d.ssrcId,o[h])});for(const{user:d,mediaType:h,ssrcId:f}of n){const g=s.get(f);if(!g)return void M.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(d.uid," subscribe data,").concat(h,", ").concat(f));const{track:y,id:x,transceiver:b,player:N}=g;if(b&&re("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:$,interceptRemoteAudioFrame:z}=bP();h==pt.VIDEO?await $(b.receiver,{onSei:re("ENABLE_VIDEO_SEI")&&(K=>{var ie;return(ie=d._videoTrack)===null||ie===void 0?void 0:ie._onSei(K)}),onFirstFrame:K=>{var ie;const oe=Array.from(Xa(ie=this.remoteUserMap).call(ie)).find(fe=>fe._videoSSRC===K.ssrc);oe&&this.store.firstVideoFrameDecoded(oe.uid,{firstReceivedEncodedFrame:Date.now(),frameType:K.type,rtpTimestamp:K.rtpTimestamp,framePayloadType:K.payloadType,frameDataLength:K.length,mimeType:K.mimeType})}}):h==pt.AUDIO&&await z(b.receiver,{enableTopn:!!re("ENABLE_AUDIO_TOPN"),enableMetadata:!!re("ENABLE_AUDIO_METADATA"),enablePts:!!re("ENABLE_AUDIO_PTS"),onMetadata:K=>{this.safeEmit(Dt.AudioMetadata,K)},onPts:K=>{this.safeEmit(Dt.AudioPts,K)}})}if(h===pt.AUDIO?(d._audioTrack?d._audioTrack._updateOriginMediaStreamTrack(y):(d._audioTrack=new Ix(y,d.uid,d._uintid,this.store),M.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(d._audioTrack.getTrackId()))),b&&d._audioTrack._updateRtpTransceiver(b),this.bindRemoteTrackEvents(d,d._audioTrack)):(d._videoTrack?d._videoTrack._updateOriginMediaStreamTrack(y):(d._videoTrack=new Nx(y,d.uid,d._uintid,this.store,N),M.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(d._videoTrack.getTrackId()))),b&&d._videoTrack._updateRtpTransceiver(b),this.bindRemoteTrackEvents(d,d._videoTrack)),re("ENABLE_VIDEO_SEI")&&b){const{interceptRemoteVideoFrame:$,interceptRemoteAudioFrame:z}=bP();h==pt.VIDEO?await $(b.receiver,{onSei:K=>{var ie;(ie=d._videoTrack)===null||ie===void 0||ie._onSei(K)},onFirstFrame:K=>{var ie;const oe=Array.from(Xa(ie=this.remoteUserMap).call(ie)).find(fe=>fe._videoSSRC===K.ssrc);oe&&this.store.firstVideoFrameDecoded(oe.uid,{firstReceivedEncodedFrame:Date.now(),frameType:K.type,rtpTimestamp:K.rtpTimestamp,framePayloadType:K.payloadType,frameDataLength:K.length,mimeType:K.mimeType})}}):h==pt.AUDIO&&await z(b.receiver)}const I=this.remoteUserMap.get(d);I?I.set(h,x):this.remoteUserMap.set(d,new Map([[h,x]])),this.statsCollector.addRemoteStats(d.uid),this.statsUploader.startUploadInboundStats();const D=this.pendingRemoteTracks.findIndex($=>{let{user:z,kind:K}=$;return z.uid===d.uid&&h===K});D!==-1&&(this.pendingRemoteTracks.splice(D,1),this.emit(Dt.MediaReconnectEnd,d.uid))}}async unsubscribe(n,i,s){const o=this.pendingRemoteTracks.filter(f=>{let{user:g,kind:y}=f;return i!==void 0?g.uid===n.uid&&i===y:g.uid===n.uid});if(o.forEach(f=>{const g=this.pendingRemoteTracks.indexOf(f);this.pendingRemoteTracks.splice(g,1)}),this.connection&&this.state===rr.Connected||s||o.forEach(f=>{let{kind:g}=f;var y;if(g===pt.AUDIO)(y=n._audioTrack)===null||y===void 0||y._destroy(),n._audioTrack=void 0;else if(g===pt.VIDEO){var x;(x=n._videoTrack)===null||x===void 0||x._destroy(),n._videoTrack=void 0}}),!this.connection||this.state!==rr.Connected)return;const d=this.filterTobeUnSubscribedTracks(n,i);if(d.length===0)return;await this.connection.stopReceiving(d.map(f=>{let[,{id:g}]=f;return g}));const h=this.createUnsubscribeMessage(d);return this.withdrawRemoteTracks(d),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),d.forEach(f=>{let[g,{kind:y}]=f;var x,b;if(y===pt.VIDEO&&g._videoSSRC&&((x=this.connection)===null||x===void 0||x.setStatsRemoteVideoIsReady(g._videoSSRC,!1)),y===pt.VIDEO)this.unbindRemoteTrackEvents(g._videoTrack),s||((b=g._videoTrack)===null||b===void 0||b._destroy(),g._videoTrack=void 0);else if(y===pt.AUDIO){var N;this.unbindRemoteTrackEvents(g._audioTrack),!s&&((N=g._audioTrack)===null||N===void 0||N._destroy(),g._audioTrack=void 0)}}),h}async unsubscribeDataChannel(n,i){if(i.forEach(d=>{const h=this.pendingRemoteDataChannels.findIndex(f=>f.id===d.id);h!==-1&&this.pendingRemoteDataChannels.splice(h,1)}),!this.connection)return;const s=this.filterTobeUnSubscribedDataChannels(n,i);if(s.length===0)return;i.forEach(d=>{d._close()});const o=this.remoteDataChannelMap.get(n);return s.forEach(d=>{o&&o.delete(d.id)}),o&&o.size===0&&(this.remoteDataChannelMap.delete(n),await this.connection.stopDataChannels(n.uid)),s.map(d=>d.id)}async massUnsubscribe(n){return this.massUnsubscribeNoLock(n)}async massUnsubscribeNoLock(n){let i=[];for(const{user:d,mediaType:h}of n){const f=this.pendingRemoteTracks.filter(g=>{let{user:y,kind:x}=g;return h!==void 0?y.uid===d.uid&&h===x:y.uid===d.uid});f.forEach(g=>{const y=this.pendingRemoteTracks.indexOf(g);this.pendingRemoteTracks.splice(y,1)}),i=i.concat(f)}if(!this.connection||this.state!==rr.Connected)return void i.forEach(d=>{let{user:h,kind:f}=d;var g;if(f===pt.AUDIO)(g=h._audioTrack)===null||g===void 0||g._destroy(),h._audioTrack=void 0;else if(f===pt.VIDEO){var y;(y=h._videoTrack)===null||y===void 0||y._destroy(),h._videoTrack=void 0}});const s=lc(n).call(n,(d,h)=>{let{user:f,mediaType:g}=h;const y=this.filterTobeUnSubscribedTracks(f,g);return d.concat(y)},[]);if(s.length===0)return;await this.connection.stopReceiving(s.map(d=>{let[,{id:h}]=d;return h}));const o=this.createUnsubscribeAllMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach(d=>{let[h,{kind:f}]=d;var g,y;if(f===pt.VIDEO&&h._videoSSRC&&((g=this.connection)===null||g===void 0||g.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),f===pt.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),(y=h._videoTrack)===null||y===void 0||y._destroy(),h._videoTrack=void 0;else if(f===pt.AUDIO){var x;this.unbindRemoteTrackEvents(h._audioTrack),(x=h._audioTrack)===null||x===void 0||x._destroy(),h._audioTrack=void 0}}),o}isPreSubScribe(n){return!this.connection||this.state!==rr.Connected?!1:!!this.connection.getPreMedia(n)}async muteRemote(n,i){if(!this.connection)return;const s=this.remoteUserMap.get(n);if(!s)return void M.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(n.uid,"."));if(!s.get(i))return void M.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(n.uid," media type ").concat(i,"."));const o=i===pt.VIDEO?n._videoSSRC:n._audioSSRC;o!==void 0&&this.connection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(n,i){return this.unmuteRemoteNoLock(n,i)}async unmuteRemoteNoLock(n,i){if(!this.connection)return;const s=this.remoteUserMap.get(n);if(!s)return void M.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(n.uid,"."));s.get(i)||M.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(n.uid," media type ").concat(i,"."))}addAudioMetadata(n){const i=this.localTrackMap.get(qe.LocalAudioTrack),s=i&&i.track;s&&s.metadata.push(n)}getAllTracks(n){const i=this.localTrackMap.get(qe.LocalAudioTrack);if((i==null?void 0:i.track)instanceof gs){const s=i.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[d]=o;return d!==qe.LocalAudioTrack}).filter(o=>{let[d]=o;return!(n&&d===qe.LocalVideoLowTrack)}).map(o=>{let[,{track:d}]=o;return d}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[o]=s;return!(n&&o===qe.LocalVideoLowTrack)}).map(s=>{let[,{track:o}]=s;return o})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(n,i,s,o,d){if(n){const f=this.localTrackMap.get(qe.LocalAudioTrack),g=o?this.localTrackMap.get(qe.LocalVideoLowTrack):this.localTrackMap.get(qe.LocalVideoTrack);_t.publish(this.store.sessionId,{eventElapse:La.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:i,audioName:f==null?void 0:f.track.getTrackLabel(),videoName:g==null?void 0:g.track.getTrackLabel(),screenshare:(g==null?void 0:g.track._hints.indexOf(or.SCREEN_TRACK))!==-1,audio:!!f,video:!!g,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}else{var h;s||(s=[]);const f=s.find(y=>y instanceof Pi),g=o?(h=this.localTrackMap.get(qe.LocalVideoTrack))===null||h===void 0?void 0:h.track:s.find(y=>y instanceof Rr);_t.publish(this.store.sessionId,{eventElapse:La.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:i,audioName:f==null?void 0:f.getTrackLabel(),videoName:g==null?void 0:g.getTrackLabel(),screenshare:(g==null?void 0:g._hints.indexOf(or.SCREEN_TRACK))!==-1,audio:!!f,video:!!g,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}}reportSubscribeEvent(n,i,s,o){const d=o===pt.VIDEO?s._videoSSRC:s._audioSSRC;d&&_t.subscribe(this.store.sessionId,{succ:n,ec:i,video:o===pt.VIDEO,audio:o===pt.AUDIO,peerid:s.uid,subscribeRequestid:d,p2pid:this.store.p2pId,eventElapse:La.measureFromSubscribeStart(this.store.clientId,d),preSsrc:this.isPreSubScribe(d)})}reset(){M.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new qs("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=yR(this.store),this.emit(Dt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const n=this.localTrackMap.get(qe.LocalAudioTrack);if((n==null?void 0:n.track)instanceof gs){if(n.track.trackList.length>0){const i=n.track;n.track.trackList.forEach(s=>{i.removeAudioTrack(s)})}n.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=rr.Disconnected}getStats(){var n;return(n=this.connection)===null||n===void 0?void 0:n.getStats()}getRemoteVideoIsReady(n){var i;return((i=this.connection)===null||i===void 0?void 0:i.getRemoteVideoIsReady(n))||!1}getLocalAudioVolume(){const n=this.localTrackMap.get(qe.LocalAudioTrack);if(n)return n.track.getVolumeLevel()}getLocalVideoSize(){const n=this.localTrackMap.get(qe.LocalVideoTrack);if(n)return{width:n.track.videoWidth||0,height:n.track.videoHeight||0}}getEncoderConfig(n){const i=this.localTrackMap.get(n);return i&&i.track instanceof Rr||i&&i.track instanceof Pi?i.track._encoderConfig:void 0}getLocalMedia(n){return this.localTrackMap.get(n)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(n,i){if(!n)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(n);return!!s&&(!i||s.has(i))}async hasRemoteMediaWithLock(n,i){if(!n)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(n);return!!s&&(!i||s.has(i))}getRemoteMedia(n){var i;const s=Array.from(Xa(i=this.remoteUserMap).call(i)).find(o=>o.uid===n);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let n=Array.from(this.remoteUserMap.entries()).map(s=>{let[o]=s;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const i=this.localTrackMap.get(qe.LocalAudioTrack);return i&&n.push({level:100*i.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),n=sm(n).call(n,(s,o)=>s.level-o.level),n}async disconnectForReconnect(){this.connection&&(M.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=rr.Reconnecting,re("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;var s;i._videoTrack&&i._videoTrack._player&&((s=i._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),i._videoTrack._player.isKeepLastFrame=!0,i._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=yR(this.store),this.emit(Dt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(n=>{var i;let[s,{track:o}]=n;switch(s){case qe.LocalVideoTrack:Ge(i=o._hints).call(i,or.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case qe.LocalAudioTrack:o instanceof gs?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case qe.LocalVideoLowTrack:}}),this.emit(Dt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i,s]=n;Array.from(Xa(s).call(s)).forEach(o=>{this.setPendingRemoteMedia(i,o)}),this.emit(Dt.MediaReconnectStart,i.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(n=>{this.pendingLocalDataChannels.push(n)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(n=>{let[i,s]=n;Array.from(Xa(s).call(s)).forEach(o=>{this.setPendingRemoteDataChannel(i,o)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),M.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(n,i){for(const s of this.pendingRemoteDataChannels){const{user:o,id:d}=s;if((n instanceof Qg?n.uid:n)===o.uid&&d===i)return!0}return!1}setPendingRemoteDataChannel(n,i){this.hasPendingRemoteDataChannel(n,i)||this.pendingRemoteDataChannels.push({user:n,id:i})}hasPendingRemoteMedia(n,i){for(const s of this.pendingRemoteTracks){const{user:o,kind:d}=s;if((n instanceof Qg?n.uid:n)===o.uid&&i===d)return!0}return!1}setPendingRemoteMedia(n,i){this.hasPendingRemoteMedia(n,i)||this.pendingRemoteTracks.push({user:n,kind:i})}restartICE(n){var i=this;return fc(function*(){if(!i.connection||i.state!==rr.Connected)return;const s=yield hn(i.mutex.lock("From P2PChannel.restartICE"));let o;try{o=yield hn(i.connection.restartICE(n));const h=yield hn(o.next());if(h.done)return;const f=h.value,g=yield f;switch(p3(i.connection)&&i.reportPCStats(Date.now(),!1,i._pcStatsUploadType),n){case Ys.UDP_TCP_RELAY:i._pcStatsUploadType=fm.UDP_TCP_RESTART;break;case Ys.TCP_RELAY:i._pcStatsUploadType=fm.TCP_RESTART;break;case Ys.RELAY:i._pcStatsUploadType=fm.RELAY_RESTART;break;default:i._pcStatsUploadType=fm.OLD_RESTART}i._isTryConnecting=!0,o.next(g)}catch(h){var d;(d=o)===null||d===void 0||d.throw(h)}finally{s()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const n=this.connection.getStats(),i=this.localTrackMap.get(qe.LocalVideoTrack),s=this.localTrackMap.get(qe.LocalAudioTrack),o=n.videoSend.find(D=>D.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId)),d=n.audioSend.find(D=>D.ssrc===(s==null?void 0:s.ssrcs[0].ssrcId));if(!o||!d)return 1;const h=El(this,Dt.NeedSignalRTT),f=o?o.rttMs:void 0,g=d?d.rttMs:void 0,y=f&&g?(f+g)/2:f||g,x=(y&&h?(y+h)/2:y||h)||0,b=100*n.sendPacketLossRate*.7/50+.3*x/1500,N=b<.17?1:b<.36?2:b<.59?3:b<.1?4:5,I=i==null?void 0:i.track;if(I&&I._encoderConfig&&I._hints.indexOf(or.SCREEN_TRACK)===-1){const D=I._encoderConfig.bitrateMax,$=n.bitrate.actualEncoded;if(D&&$){const z=(1e3*D-$)/(1e3*D);return zX[z<.15?0:z<.3?1:z<.45?2:z<.6?3:4][N]}}return N}getDownlinkNetworkQuality(){if(!this.connection)return 0;const n=this.connection.getStats();let i=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[o]=s;const d=o._audioSSRC,h=o._videoSSRC,f=n.audioRecv.find($=>$.ssrc===d),g=n.videoRecv.find($=>$.ssrc===h);if(!f&&!g)return void(i+=1);const y=El(this,Dt.NeedSignalRTT),x=n.rtt,b=(x&&y?(x+y)/2:x||y)||0,N=f?f.jitterMs:void 0,I=n.recvPacketLossRate;let D=.7*I*100/50+.3*b/1500;N&&(D=.6*I*100/50+.2*b/1500+.2*N/400),i+=D<.1?1:D<.17?2:D<.36?3:D<.59?4:5}),this.remoteUserMap.size>0?Math.round(i/this.remoteUserMap.size):i}async muteLocalTrack(n){return new et((i,s)=>{this.handleMuteLocalTrack(n,i,s)})}async replaceTrack(n,i){var s;if(M.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(n.getTrackId(),"] to [").concat(i.getTrackId(),"]")),!this.connection||this.state!==rr.Connected)return;const o=Array.from(this.localTrackMap.entries()).find(h=>{let[,{track:f}]=h;return n===f});if(!o)return;const d=o[0];if(n!==i&&(this.unbindLocalTrackEvents([{track:n,type:d}]),this.bindLocalTrackEvents([{track:i,type:d}]),o[1].track=i),await((s=this.connection)===null||s===void 0?void 0:s.replaceTrack(i,o[1].id)),this.isPlanB){const h=o[1];h.id=i._mediaStreamTrack.id,this.localTrackMap.set(d,h)}if(d===qe.LocalVideoTrack&&!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&xn().supportDualStreamEncoding){const h=this.localTrackMap.get(qe.LocalVideoLowTrack);if(h){const f=n._mediaStreamTrack.clone();h.track._originMediaStreamTrack.stop(),h.track._mediaStreamTrack=f,h.track._originMediaStreamTrack=f,await new et((g,y)=>{this.handleReplaceTrack(h.track,g,y,!0)})}}}filterTobePublishedTracks(n,i,s){const o=[],d=this.getAllTracks();n=mx(n=n.filter(y=>d.indexOf(y)===-1));let h,f=!1;const g=this.localTrackMap.get(qe.LocalAudioTrack);for(const y of n){if(y instanceof Rr&&(this.localTrackMap.has(qe.LocalVideoTrack)||f?new Pe(se.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:y,type:qe.LocalVideoTrack}),f=!0),i)){const x=this.getLowVideoTrack(y,s);o.push({track:x,type:qe.LocalVideoLowTrack})}if(y instanceof Pi)if(g){const x=g.track;if(x instanceof gs)u3([y]),x.addAudioTrack(y),this.bindLocalAudioTrackEvents(y,!0);else{const b=h3([x,y]);M.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(b.getTrackId(),"]")),this.replaceTrack(x,b)}}else h instanceof gs?(u3([y]),h.addAudioTrack(y)):h||!y._useAudioElement&&xn().webAudioMediaStreamDest&&!y._bypassWebAudio?h=h3(h?[y,h]:[y]):h=y}return h&&(M.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(h.getTrackId(),"]")),o.push({track:h,type:qe.LocalAudioTrack})),o}filterTobeUnpublishedTracks(n){const i=[],s=this.getAllTracks();n=mx(n=n.filter(o=>s.indexOf(o)!==-1));for(const o of n){if(o instanceof Pi){const d=this.localTrackMap.get(qe.LocalAudioTrack);if(!d)continue;d.track instanceof gs?(d.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),d.track.trackList.length===0&&(i.push([qe.LocalAudioTrack,d]),d.track.close())):i.push([qe.LocalAudioTrack,d])}if(o instanceof Rr){const d=this.localTrackMap.get(qe.LocalVideoTrack);if(!d)continue;i.push([qe.LocalVideoTrack,d]);const h=this.localTrackMap.get(qe.LocalVideoLowTrack);h&&i.push([qe.LocalVideoLowTrack,h])}}return i}filterTobePublishedDataChannels(n){return n=(n=mx(n)).filter(i=>this.localDataChannels.findIndex(s=>s.id===i.id)===-1)}filterTobeUnpublishedDataChannels(n){return n=(n=(n=mx(n)).filter(i=>this.localDataChannels.indexOf(i)!==-1)).filter(i=>i._originDataChannel)}bindLocalTrackEvents(n){n.forEach(i=>{let{track:s,type:o}=i;switch(o){case qe.LocalVideoTrack:s.addListener(Et.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Et.GET_RTC_STATS,this.handleGetRTCStats),s.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Et.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Et.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case qe.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case qe.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(n,i){n instanceof gs?n.trackList.forEach(s=>{s.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Et.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.addListener(Et.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),i||(n.addListener(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Et.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(n){n||(n=Array.from(this.localTrackMap.entries()).map(i=>{let[s,{track:o}]=i;return{track:o,type:s}})),n.forEach(i=>{let{track:s,type:o}=i;switch(o){case qe.LocalVideoTrack:s.off(Et.GET_STATS,this.handleGetLocalVideoStats),s.off(Et.GET_RTC_STATS,this.handleGetRTCStats),s.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Et.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Et.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case qe.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case qe.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(n){n instanceof gs?n.trackList.forEach(i=>{i.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(Et.GET_STATS,this.handleGetLocalAudioStats),i.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.off(Et.GET_STATS,this.handleGetLocalAudioStats),n.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Et.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),n.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(n,i){i instanceof Nx&&i.addListener(Et.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(n))}),i instanceof Ix&&i.addListener(Et.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(n))})}unbindRemoteTrackEvents(n){n&&n.removeAllListeners(Et.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i,s]=n;s.has(pt.AUDIO)&&this.unbindRemoteTrackEvents(i._audioTrack),s.has(pt.VIDEO)&&this.unbindRemoteTrackEvents(i._videoTrack)})}createGatewayPublishMessage(n,i){return n.map((s,o)=>{var d;let h,f,{track:g,type:y}=s;switch(y){case qe.LocalAudioTrack:h=hr.Audio,f={dtx:g instanceof aR&&g._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case qe.LocalVideoTrack:h=Ge(d=g._hints).call(d,or.SCREEN_TRACK)?hr.Screen:hr.High,f=of(of({},rJ(g)),{},{codec:this.store.codec,svc_mode:dR()});break;case qe.LocalVideoLowTrack:h=hr.Low,f=of(of({},rJ(g)),{},{codec:this.store.codec,svc_mode:dR()})}return{stream_type:h,attributes:f,ssrcs:i[o]}})}createGatewayUnpublishMessage(n){return n.map(i=>{var s;let o,[d,{track:h,ssrcs:f,id:g}]=i;switch(d){case qe.LocalVideoTrack:o=Ge(s=h._hints).call(s,or.SCREEN_TRACK)?hr.Screen:hr.High;break;case qe.LocalAudioTrack:o=hr.Audio;break;case qe.LocalVideoLowTrack:o=hr.Low}return{stream_type:o,ssrcs:f,mid:g}})}assignLocalTracks(n,i){n.forEach((s,o)=>{let{track:d,type:h}=s;this.localTrackMap.set(h,{track:d,id:i[o].id,ssrcs:i[o].localSSRC})})}withdrawLocalTracks(n){n.forEach(i=>{let[s]=i;this.localTrackMap.delete(s)})}bindConnectionEvents(n){n.onConnectionStateChange=async i=>{if(M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(i,")")),this.emit(Dt.PeerConnectionStateChange,i),i==="connecting"&&n instanceof ed&&!Kr()&&re("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{i==="connecting"&&n.extendCandidate()},re("FIRST_TCP_CANDIDATE_INTERVAL")),i!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),i==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),n instanceof ed&&ZJ(n,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=fm.DISCONNECTED_OR_FAILED,El(this,Dt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const s=this.pendingLocalTracks.map(d=>d.getTrackId()),o=this.pendingLocalDataChannels.map(d=>"dc_".concat(d.id));_t.reportApiInvoke(this.store.sessionId,{name:Qr.REPUB_AFTER_PC_CONNECTED,options:s.concat(o),tag:Tr.TRACER}).onSuccess(),this.republish()}if(re("NEW_ICE_RESTART")&&n instanceof ed&&!Kr()&&!this._forceTurn&&!this.store.useDcSignal){if(Ge(JX).call(JX,i)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const s=d=>{p3(n)&&(M.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(d)),El(this,Dt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Dt.RequestRestartICE,d))},o=()=>{p3(n)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),M.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Dt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{eQ(n,s,o)},800))}}else{if(i==="disconnected"&&n.iceConnectionState==="disconnected")return setTimeout(()=>{n.iceConnectionState==="disconnected"&&re("ICE_RESTART")&&El(this,Dt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Dt.RequestRestartICE)},800),void setTimeout(()=>{n.peerConnectionState==="disconnected"&&(M.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Dt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);i==="failed"&&(M.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Dt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},n.onICEConnectionStateChange=i=>{i!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(i,")")),_t.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:i,tag:Tr.TRACER}).onSuccess(),this.emit(Dt.IceConnectionStateChange,i)},n.onICETransportStateChange=i=>{M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(i,")"))},n.onDTLSTransportStateChange=i=>{M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(i,")"))},n.onDTLSTransportError=i=>{M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(i,")"))},n.onFirstAudioDecoded=i=>{var s;const o=Array.from(Xa(s=this.remoteUserMap).call(s)).find(h=>h._audioSSRC===i);var d;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(d=o.audioTrack)===null||d===void 0||d.emit(Od.FIRST_FRAME_DECODED),_t.firstRemoteFrame(this.store.sessionId,ms.FIRST_AUDIO_DECODE,Zr.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:La.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId}))},n.onFirstAudioReceived=i=>{var s;const o=Array.from(Xa(s=this.remoteUserMap).call(s)).find(d=>d._audioSSRC===i);o&&_t.firstRemoteFrame(this.store.sessionId,ms.FIRST_AUDIO_RECEIVED,Zr.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:La.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId})},n.onFirstVideoDecoded=(i,s,o)=>{var d;const h=Array.from(Xa(d=this.remoteUserMap).call(d)).find(f=>f._videoSSRC===i);h&&this.store.firstVideoFrameDecoded(h.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(i,s,o)},n.onFirstVideoRender=i=>{var s;const o=Array.from(Xa(s=this.remoteUserMap).call(s)).find(d=>d._videoSSRC===i);o&&(this.store.firstVideoFrameDecoded(o.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(o),this.emit(Dt.FirstVideoPreRender,o.uid,i))},n.onFirstVideoReceived=i=>{var s;const o=Array.from(Xa(s=this.remoteUserMap).call(s)).find(d=>d._videoSSRC===i);o&&(this.store.firstVideoFrameDecoded(o.uid,{firstReceived:Date.now()}),_t.firstRemoteFrame(this.store.sessionId,ms.FIRST_VIDEO_RECEIVED,Zr.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:La.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId}))},n.onFirstVideoBufferReady=i=>{var s;const o=Array.from(Xa(s=this.remoteUserMap).call(s)).find(d=>d._videoSSRC===i);o&&this.emit(Dt.FirstVideoBufferReady,o.uid,i)},n.onSelectedLocalCandidateChanged=(i,s)=>{const o=i.candidateType==="relay",d=s.candidateType==="relay";s.candidateType!=="unknown"&&o===d||this.emit(Dt.ConnectionTypeChange,o),M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Xg(s))," -> ").concat(JSON.stringify(Xg(i)),")"))},n.onSelectedRemoteCandidateChanged=(i,s)=>{M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Xg(s))," -> ").concat(JSON.stringify(Xg(i)),")"))},n.onFirstVideoDecodedTimeout=i=>{this.reportVideoFirstFrameDecoded(i,void 0,void 0,!0)},n.getLocalVideoStats=()=>{const i=this.statsCollector.getLocalVideoTrackStats(),s=this.statsCollector.getRTCStats();return of(of({},i),s)},n.onICECandidateError=i=>{this._iceError=i}}fallbackConnection(){M.debug("[".concat(this.store.clientId,"] [P2PChannel] try to fallback connection")),this.state===rr.Connected?(M.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&this.resetConnection(this.connection),this.shouldForwardP2PCreation&&(this.connection=yR(this.store),this.emit(Dt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)))}resetConnection(n){n instanceof ed&&function(i){Gx.delete(i.id),ZJ(i)}(n),n.close(),this.emit(Dt.PeerConnectionStateChange,"closed"),function(i){i.onConnectionStateChange=void 0,i.onICEConnectionStateChange=void 0,i.onICETransportStateChange=void 0,i.onDTLSTransportStateChange=void 0,i.onDTLSTransportError=void 0,i.onFirstAudioDecoded=void 0,i.onFirstAudioReceived=void 0,i.onFirstVideoDecoded=void 0,i.onFirstVideoReceived=void 0,i.onSelectedLocalCandidateChanged=void 0,i.onSelectedRemoteCandidateChanged=void 0,i.onFirstVideoDecodedTimeout=void 0,i.getLocalVideoStats=void 0}(n),this._isWaitPcToRePub=!1}filterTobeMutedTracks(n){const i=[];if(this.getAllTracks().indexOf(n)===-1)return i;const s=this.localTrackMap.get(qe.LocalAudioTrack);if(n instanceof Pi&&(s==null?void 0:s.track)instanceof gs)return s.track.isActive||i.push([qe.LocalAudioTrack,s]),i;const o=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return n===h});if(o&&(i.push(o),o[0]===qe.LocalVideoTrack)){const d=this.localTrackMap.get(qe.LocalVideoLowTrack);d&&i.push([qe.LocalVideoLowTrack,d])}return i}filterTobeUnmutedTracks(n){const i=[],s=this.localTrackMap.get(qe.LocalAudioTrack);if(n instanceof Pi&&(s==null?void 0:s.track)instanceof gs)return s.track.isActive&&i.push([qe.LocalAudioTrack,s]),i;const o=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return n===h});if(o)if(o[0]===qe.LocalVideoTrack){i.push(o);const d=this.localTrackMap.get(qe.LocalVideoLowTrack);d&&i.push([qe.LocalVideoLowTrack,d])}else i.push(o);return i}createMuteMessage(n){return n.map(i=>{var s;let o,[d,{track:h,ssrcs:f,id:g}]=i;switch(d){case qe.LocalAudioTrack:o=hr.Audio;break;case qe.LocalVideoTrack:o=Ge(s=h._hints).call(s,or.SCREEN_TRACK)?hr.Screen:hr.High;break;case qe.LocalVideoLowTrack:o=hr.Low}return{stream_type:o,ssrcs:f,mid:g}})}createUnmuteMessage(n){return n.map(i=>{var s;let o,[d,{track:h,ssrcs:f,id:g}]=i;switch(d){case qe.LocalAudioTrack:o=hr.Audio;break;case qe.LocalVideoTrack:o=Ge(s=h._hints).call(s,or.SCREEN_TRACK)?hr.Screen:hr.High;break;case qe.LocalVideoLowTrack:o=hr.Low}return{stream_type:o,ssrcs:f,mid:g}})}filterTobeUnSubscribedTracks(n,i){const s=[],o=this.remoteUserMap.get(n);if(!o)return s;if(i){const d=o.get(i);if(!d)return s;s.push([n,{kind:i,id:d}])}else Array.from(o.entries()).forEach(d=>{let[h,f]=d;s.push([n,{kind:h,id:f}])});return s}filterTobeUnSubscribedDataChannels(n,i){const s=[];return i.forEach(o=>{var d;(d=this.remoteDataChannelMap.get(n))!==null&&d!==void 0&&d.has(o.id)&&s.push(o)}),s}createUnsubscribeMessage(n){const i=[];return n.forEach(s=>{let[o,{kind:d,id:h}]=s;switch(d){case pt.VIDEO:return void(o._videoSSRC&&i.push({stream_type:pt.VIDEO,ssrcId:o._videoSSRC}));case pt.AUDIO:return void(o._audioSSRC&&i.push({stream_type:pt.AUDIO,ssrcId:o._audioSSRC}))}}),i}createUnsubscribeAllMessage(n){const i=new Map;return n.forEach(s=>{let[o,{kind:d}]=s;if(i.has(o)){let h=i.get(o);d===pt.VIDEO?h|=Ps.Video:h|=Ps.Audio,i.set(o,h)}else d===pt.VIDEO?i.set(o,Ps.Video):i.set(o,Ps.Audio)}),{users:Array.from(i.entries()).map(s=>{let[o,d]=s;return{stream_id:o.uid,stream_type:d}})}}withdrawRemoteTracks(n){n.forEach(i=>{let[s,{kind:o}]=i;const d=this.remoteUserMap.get(s);d&&(d.delete(o),Array.from(d.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(n){const i=this.localTrackMap.get(qe.LocalVideoTrack),s=this.localTrackMap.get(qe.LocalVideoLowTrack);i&&(await i.track.setBitrateLimit(n.uplink),await new et((o,d)=>{this.handleUpdateVideoEncoder(i.track,o,d,!0)})),s&&n.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:n.low_stream_uplink.bitrate,min_bitrate:n.low_stream_uplink.bitrate||0}),await new et((o,d)=>{this.handleUpdateVideoEncoder(s.track,o,d,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return!(!this.connection||!("name"in this.connection)||this.connection.name!=="DataChannelConnection"||this.connection.peerConnectionState==="closed")||this.connection instanceof ed&&this.connection.isPreallocation}isPreSub(){return(this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof ed)&&this.connection.isPreSub()}isPreRender(){return this.connection instanceof ed&&this.connection.isPreRender}mapPubResToRemoteConfig(n,i,s){return n.map((o,d)=>{var h;let{stream_type:f}=o;const g=(h=i.find(y=>{let{stream_type:x}=y;return f===x}))===null||h===void 0?void 0:h.attributes;if(g&&re("DISABLE_SCREEN_SHARE_REMB")){const y=s[d]._hints;(Ge(y).call(y,or.SCREEN_TRACK)||Ge(y).call(y,or.SCREEN_LOW_TRACK))&&(g.remb=!1,M.debug("disable remb for screen share, hints:",y))}return g})}async tryToUnmuteAudio(n){for(let s=0;s<n.length;s++)if(n[s]instanceof Pi){var i;const o=this.filterTobeUnmutedTracks(n[s]);if(o.length===0)continue;await((i=this.connection)===null||i===void 0?void 0:i.unmuteLocal(o.map(h=>{let[,{id:f}]=h;return f})));const d=this.createUnmuteMessage(o);return void await Or(this,Dt.RequestUnmuteLocal,d)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=n=>{var i;return!((i=this.connection)===null||i===void 0||!i.getRemoteVideoIsReady(n))},this.statsUploader.requestUpload=(n,i)=>this.emit(Dt.RequestUpload,n,i),this.statsUploader.requestUploadStats=n=>this.emit(Dt.RequestUploadStats,n),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var n;return{connectState:((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await As(Uk(this.dtlsFailedCount,Gi)),this.emit(Dt.RequestReconnect)}async reconnectP2P(){const n=Array.from(this.localTrackMap.entries()),i=this.createGatewayUnpublishMessage(n);Array.from(this.remoteUserMap.entries()),i.length>0&&await rs(this,Dt.RequestUnpublishForReconnectPC,i),this.disconnectForReconnect(),this.emit(Dt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(qe.LocalVideoTrack)||this.pendingLocalTracks.some(n=>n instanceof Rr)}throwIfTrackTypeNotMatch(n){if(n.filter(i=>i instanceof Rr).length>1)throw new Pe(se.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n.filter(i=>i instanceof Pi).length>1&&(n.some(i=>i instanceof Pi&&i._bypassWebAudio)||!xn().webAudioMediaStreamDest))throw new Pe(se.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const i of n){if(i instanceof Rr&&this.pendingLocalTracks.some(s=>s instanceof Rr))throw new Pe(se.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(i instanceof Pi&&this.pendingLocalTracks.some(s=>s instanceof Pi)&&(!xn().webAudioMediaStreamDest||i._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof Pi&&s._bypassWebAudio)))throw new Pe(se.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(n,i){var s;const o=!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&xn().supportDualStreamEncoding,d=of(of({},{width:160,height:120,framerate:15,bitrate:50}),i);let h;h=o?n._mediaStreamTrack.clone():m3(n,d);const f=dr(8,"track-low-"),g=new Rr(h,of(of({},o&&{scaleResolutionDownBy:H4(d,n)}),{},{frameRate:d.framerate,bitrateMax:d.bitrate,bitrateMin:d.bitrate}),void 0,void 0,f);return g.on(yy.TRANSCEIVER_UPDATED,y=>{n._updateRtpTransceiver(y,bx.LOW_STREAM)}),g._hints.push(or.LOW_STREAM),Ge(s=n._hints).call(s,or.SCREEN_TRACK)&&g._hints.push(or.SCREEN_LOW_TRACK),n.on("sei-to-send",y=>{g.emit("sei-to-send",y)}),n.addListener(Et.NEED_CLOSE,()=>{g.close()}),g}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(n,i,s){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof ed){var d,h,f,g;const y=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:x,dtlsTransportState:b,peerConnectionState:N}=this.connection,{local:I,remote:D}=await this.connection.getSelectedCandidatePair();_t.pcStats(this.store.sessionId,{startTime:y,eventElapse:n-y||0,iceconnectionsate:x,dtlsstate:b,connectionstate:N,intSucc:i?1:2,error:this._iceError||o||"",selectedLocalCandidateProtocol:(d=I==null?void 0:I.protocol)!==null&&d!==void 0?d:"",selectedLocalCandidateType:(h=I.candidateType)!==null&&h!==void 0?h:"",selectedLocalCandidateAddress:"".concat(I.address,":").concat(I.port),selectedRemoteCandidateProtocol:(f=D.protocol)!==null&&f!==void 0?f:"",selectedRemoteCandidateType:(g=D.candidateType)!==null&&g!==void 0?g:"",selectedRemoteCandidateAddress:"".concat(D.address,":").concat(D.port),restartCnt:s,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(n){const i=this.store.keyMetrics,s=i.firstVideoFrameDecoded.find(b=>b.userId===n.uid);if(!s)return;const{isInternalUpload:o,isExternalUpload:d}=s;if(o&&d)return;const{subscribeEnd:h,firstPreRender:f,peerPublishDuration:g,peerPubStatusMs:y}=s;let{firstRender:x=0}=s;if(h&&(x||f)&&g&&y){s.isInternalUpload=!0;const{playEnd:b}=s;b&&(s.isExternalUpload=!0);const{firstPreRender:N=0}=s;x=N||x;const I=n.videoTrack,D={peer:n._uintid,width:(I==null?void 0:I._videoWidth)||0,height:(I==null?void 0:I._videoHeight)||0,ssrc:n._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:g,peerPubStatusMs:y,joinChannelStart:i.joinStart||0,preloadStart:i.preloadStart||0,preloadEnd:i.preloadEnd||0,apStart:i.requestAPStart||0,apEnd:i.requestAPEnd||0,suaEnd:i.requestSUAEnd||0,beforeConnect:i.beforeConnect||0,peerReceiver:i.peerReceiver||0,ice:i.iceConnectionEnd||0,pc:i.peerConnectionEnd||0,signalConnected:i.signalConnected||0,joinReq:i.joinReq||0,joinRes:i.joinRep||0,userJoinNotify:s.userJoinNotify||0,videoAddNotify:s.videoAddNotify||0,subscribeStart:s.subscribeStart||0,subscribeEnd:s.subscribeEnd||0,firstReceived:s.firstReceived||0,firstDecoded:s.firstDecoded||0,firstPreRender:N||0,firstRender:b?Math.max(x,b):Math.max(x,h),playStart:s.playStart||0,playEnd:s.playEnd||0,isPreSub:!(!n._videoSSRC||!this.isPreSubScribe(n._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:wY(this.store),firstReceivedEncodedFrame:s.firstReceivedEncodedFrame||0,frameType:s.frameType||"",rtpTimestamp:s.rtpTimestamp||0,framePayloadType:s.framePayloadType||0,frameDataLength:s.frameDataLength||0,mimeType:s.mimeType||""};_t.firstXLAPeerFirstVideoFrame(this.store.sessionId,D)}}reportVideoFirstFrameDecoded(n,i,s,o){var d;const h=Array.from(Xa(d=this.remoteUserMap).call(d)).find(f=>f._videoSSRC===n);if(h){o||this.store.subscribe(h.uid,"video",void 0,void 0,void 0,void 0,Date.now());const f=this.store.keyMetrics,g=f.subscribe.find(y=>y.userId===h.uid&&y.type==="video");_t.firstRemoteVideoDecode(this.store.sessionId,ms.FIRST_VIDEO_DECODE,Zr.FIRST_VIDEO_DECODE,{peer:h._uintid,videowidth:i,videoheight:s,subscribeElapse:La.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId,apEnd:f.requestAPEnd||0,apStart:f.requestAPStart||0,joinGwEnd:f.joinGatewayEnd||0,joinGwStart:f.joinGatewayStart||0,pcEnd:f.peerConnectionEnd||0,pcStart:f.peerConnectionStart||0,subscriberEnd:(g==null?void 0:g.subscribeEnd)||0,subscriberStart:(g==null?void 0:g.subscribeStart)||0,videoAddNotify:(g==null?void 0:g.streamAdded)||0,state:o?1:0,firstFrame:(g==null?void 0:g.firstFrame)||0})}}async remoteMediaSsrcChanged(n,i,s){if(!this.connection)return!1;const o=this.remoteUserMap.get(n);if(!o)return!1;const d=o.get(i);if(!d)return!1;const h=await this.connection.getRemoteSSRC(d);return h!==void 0&&h!==s}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(n=>{let[i,{track:s}]=n;i===qe.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,bx.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},it(wn.prototype,"startP2PConnection",[ho],Object.getOwnPropertyDescriptor(wn.prototype,"startP2PConnection"),wn.prototype),it(wn.prototype,"connect",[ho],Object.getOwnPropertyDescriptor(wn.prototype,"connect"),wn.prototype),it(wn.prototype,"updateRemoteRTPCapabilities",[ho],Object.getOwnPropertyDescriptor(wn.prototype,"updateRemoteRTPCapabilities"),wn.prototype),it(wn.prototype,"publishDataChannel",[ho],Object.getOwnPropertyDescriptor(wn.prototype,"publishDataChannel"),wn.prototype),it(wn.prototype,"unpublish",[ho],Object.getOwnPropertyDescriptor(wn.prototype,"unpublish"),wn.prototype),it(wn.prototype,"unpublishDataChannel",[ho],Object.getOwnPropertyDescriptor(wn.prototype,"unpublishDataChannel"),wn.prototype),it(wn.prototype,"unpublishLowStream",[ho],Object.getOwnPropertyDescriptor(wn.prototype,"unpublishLowStream"),wn.prototype),it(wn.prototype,"subscribeDataChannel",[ho],Object.getOwnPropertyDescriptor(wn.prototype,"subscribeDataChannel"),wn.prototype),it(wn.prototype,"subscribe",[ho],Object.getOwnPropertyDescriptor(wn.prototype,"subscribe"),wn.prototype),it(wn.prototype,"massSubscribe",[ho],Object.getOwnPropertyDescriptor(wn.prototype,"massSubscribe"),wn.prototype),it(wn.prototype,"unsubscribe",[ho],Object.getOwnPropertyDescriptor(wn.prototype,"unsubscribe"),wn.prototype),it(wn.prototype,"unsubscribeDataChannel",[ho],Object.getOwnPropertyDescriptor(wn.prototype,"unsubscribeDataChannel"),wn.prototype),it(wn.prototype,"massUnsubscribe",[ho],Object.getOwnPropertyDescriptor(wn.prototype,"massUnsubscribe"),wn.prototype),it(wn.prototype,"muteRemote",[ho],Object.getOwnPropertyDescriptor(wn.prototype,"muteRemote"),wn.prototype),it(wn.prototype,"unmuteRemote",[ho],Object.getOwnPropertyDescriptor(wn.prototype,"unmuteRemote"),wn.prototype),it(wn.prototype,"hasRemoteMediaWithLock",[ho],Object.getOwnPropertyDescriptor(wn.prototype,"hasRemoteMediaWithLock"),wn.prototype),it(wn.prototype,"disconnectForReconnect",[ho],Object.getOwnPropertyDescriptor(wn.prototype,"disconnectForReconnect"),wn.prototype),it(wn.prototype,"updateBitrateLimit",[ho],Object.getOwnPropertyDescriptor(wn.prototype,"updateBitrateLimit"),wn.prototype),it(wn.prototype,"remoteMediaSsrcChanged",[ho],Object.getOwnPropertyDescriptor(wn.prototype,"remoteMediaSsrcChanged"),wn.prototype),wn);function ho(n,i,s){const o=n[i];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const d=this.mutex,h=await d.lock("From P2PChannel.".concat(i));try{for(var f=arguments.length,g=new Array(f),y=0;y<f;y++)g[y]=arguments[y];return await o.apply(this,g)}finally{h()}},s}function rQ(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function iQ(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?rQ(Object(s),!0).forEach(function(o){Y(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):rQ(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}const dwe=Date.now(),uwe=20,y3=new Map,OP=new Map;async function sQ(n){const i=y3.get(n),s=Array.isArray(i)&&i[i.length-1],o=OP.get(n);if(!s)return void(o.isSyncing=!1);const d={uid:s.uid,payload:s.payload};o.firstRecvTs===0&&(o.firstRecvTs=s.recvTs,o.firstSendTs=s.sendTs);const h=s.sendTs-o.firstSendTs,f=h-(Date.now()-o.firstRecvTs);f>0&&(o.firstRecvTs=Date.now()-h);let g=s.mediaDelay+f;g<=0?(i.pop(),aQ(s.context,d),g=0):g=Math.min(g,uwe),setTimeout(()=>i.length&&sQ(n),g)}function aQ(n,i){n.safeEmit(gn.STREAM_MESSAGE,i.uid,i.payload),n.onStreamMessage&&n.onStreamMessage(i)}function hwe(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(!n.syncWithAudio)return aQ(s,{uid:n.uid,payload:n.payload});const o="".concat(s.id,"-").concat(n.uid),d=y3.get(o)||[],h=d.findIndex(x=>n.sendTs>=x.sendTs),f=iQ(iQ({},n),{},{context:s,mediaDelay:i,recvTs:Date.now()});h===-1?d.push(f):d.splice(h,0,f),y3.set(o,d);let g=!1;var y;OP.has(o)?g=!((y=OP.get(o))===null||y===void 0||!y.isSyncing):OP.set(o,{isSyncing:g,firstRecvTs:0,firstSendTs:0}),g||sQ(o)}const pwe=Wn().name;function oQ(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function cQ(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?oQ(Object(s),!0).forEach(function(o){Y(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):oQ(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}const Wx="websdk_ng_cache_parameter",fwe=re("MAX_PRELOAD_ASYNC_LENGTH"),mwe=1e4,ky=new Map,Py=[];let v3=null,E3=0,x3=0;const LP=new Map,lQ=new Uint8Array([241,141,127,212,103,139,200,225,251,157,127,139,143,2,22,163]),gwe=function(n,i){const s=[];let o=0;const d=async()=>{const h=s.shift();h&&await h(),s.length>0&&o<i?d():o--};return async function(){for(var h=arguments.length,f=new Array(h),g=0;g<h;g++)f[g]=arguments[g];return new et(async(y,x)=>{s.push(async()=>{try{const b=await n(...f);y(b)}catch(b){x(b)}}),o<i&&(o++,d())})}}(w3,fwe),b3=mc.CancelToken.source();class _we{constructor(){Y(this,"_audioContext",null)}createMuteAudioTrack(){this._audioContext=new AudioContext;const i=this._audioContext.sampleRate,s=10*i,o=this._audioContext.createBuffer(2,s,i),d=this._audioContext.createBufferSource();d.buffer=o;const h=this._audioContext.createMediaStreamDestination();return d.connect(h),d.start(),h.stream.getAudioTracks()[0]}close(){this._audioContext&&(this._audioContext.close(),this._audioContext=null)}}async function w3(n,i,s,o,d,h,f){try{if(!re("ENABLE_PRELOAD"))return;if(!xn().supportWebCrypto)return void Wg(()=>{M.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!s&&s!==null)throw new Pe(se.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&la(s,"token",1,2047),la(n,"appid",1,2047),dP(i),o&&uP(o);const g=fy();M.debug("preload channel ".concat(i,", uid is ").concat(o));const y={appId:n,cname:i,token:s||n,uid:typeof o!="string"?o:null,sid:g,proxyServer:d,role:f};let x,b;typeof o=="string"?(y.stringUid=o,[b,x]=await et.all([Qbe(o,{sid:g,appId:n},b3.token),DJ(cQ(cQ({},y),{},{token:s||n,uid:0}),b3.token)]),y.uid=b.uid,x.gatewayInfo.uid=y.uid,x.gatewayInfo.res.uid=y.uid):(h&&(y.stringUid=h),x=await DJ(y,b3.token));const N={sid:g,appId:n,cname:i,token:s||n,uid:y.stringUid||o,intUid:y.uid||x.gatewayInfo.uid,stringUid:y.stringUid,ts:Date.now(),sua:b,ap:x};await T3(N),E3++}catch(g){throw x3++,function(y){v3||(v3=window.setTimeout(()=>{let b="";LP.forEach((N,I)=>{b+="".concat(I,": ").concat(N," ;")}),_t.reportApiInvoke(null,{name:Qr.PRELOAD,options:{success:E3,failed:x3,err:b}}).onError(y),E3=0,x3=0,LP.clear(),v3=null},mwe));const x=LP.get(y.code)||0;LP.set(y.code,x+1)}(g),g}}async function S3(n){try{if(re("AP_REQUEST_DETAIL")||re("ENABLE_ROLE_SELECT_EDGE"))return;const i=dQ(n);if(!i||n.cloudProxyServer!=="disabled")return;const s=await async function(o,d){try{const h=await window.crypto.subtle.importKey("raw",Jq(d),"AES-GCM",!1,["decrypt"]),f=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:lQ},h,py(o));return JSON.parse(window.atob(Hg(new Uint8Array(f))))}catch{return}}(i,n.token||n.appId);if(!s||!function(o,d){return o.cname===d.cname&&o.appId===d.appId&&o.token===d.token?d.stringUid?o.stringUid===d.stringUid:typeof d.uid=="number"?o.uid===d.uid:o.uid==d.uid:!1}(s,n))return;if(s&&Date.now()-s.ts<re("AP_CACHE_LIFETIME"))return s}catch(i){M.warn("Error get preloadInfo",i.message)}}function dQ(n){let i;try{if(i=pQ(Wx),!i)return;const s=JSON.parse(i),o=fQ(n),d=function(f,g){for(let y=f.length-1;y>=0;y--)if(g(f[y]))return y;return-1}(s,f=>o in f);if(d===-1)return;const h=s.splice(d,1)[0];return jP(Wx,JSON.stringify(s)),h[o]}catch(s){M.warn("Error delete preload info: ".concat(i),s.message),jP(Wx,"")}}async function T3(n){let i;try{n.uid&&dQ({appId:n.appId,cname:n.cname,token:n.token,uid:n.uid,stringUid:n.stringUid});const s=fQ(n),o=await async function(h,f){try{const g=await window.crypto.subtle.importKey("raw",Jq(f),"AES-GCM",!1,["encrypt"]),y=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:lQ},g,py(window.btoa(JSON.stringify(h))));return Hg(new Uint8Array(y))}catch{return}}(n,n.token||n.appId);if(!o)return;i=pQ(Wx);const d=i?JSON.parse(i):[];d.push({[s]:o}),d.length>re("AP_CACHE_NUM")&&d.shift(),jP(Wx,JSON.stringify(d))}catch(s){M.warn("Error caching server parameters:",s.message),jP(Wx,"")}}function R3(n){if(n){let i=ky.get(n);i&&(window.clearTimeout(i),i=null,ky.delete(n)),Ge(Py).call(Py,n)||n.cloudProxyServer!=="disabled"||Py.push(n)}if(ky.size<re("AP_CACHE_NUM")&&Py.length>0){const i=Py.shift();ky.set(i,window.setTimeout(async()=>{const{appId:s,cname:o,token:d,stringUid:h,uid:f,proxyServer:g,role:y}=i;try{await gwe(s,o,d,f,g,h,y),ky.has(i)&&R3(i)}catch(x){M.warn("update preload failed",x.message),uQ(i)}},re("AP_UPDATE_INTERVAL")))}}function uQ(n){const i=Py.indexOf(n);i!==-1&&Py.splice(i,1);let s=ky.get(n);s&&(window.clearTimeout(s),s=null,ky.delete(n),R3())}function hQ(n,i){const s=n.sua,o=n.ap;i&&s&&_t.reqUserAccount(n.sid,{lts:s.requestTime,elapse:s.elapse,success:!0,serverAddr:s.url,stringUid:i,uid:n.intUid,errorCode:null,extend:s.req}),_t.reportResourceTiming(n.ap.url,n.sid),_t.joinWebProxyAP(n.sid,{lts:o.requestTime,elapse:o.elapse,sucess:1,apServerAddr:o.url,turnServerAddrList:o.proxyInfo.addresses.map(d=>d.ip).join(","),eventType:"disabled",unilbsServerIds:[Wi.CHOOSE_SERVER,Wi.CLOUD_PROXY_FALLBACK].toString()}),_t.joinChooseServer(n.sid,{lts:o.requestTime,elapse:o.elapse,succ:!0,csAddr:o.url,opid:o.opid,serverList:o.gatewayInfo.gatewayAddrs.map(d=>d.address),ec:null,cid:o.gatewayInfo.cid.toString(),uid:o.gatewayInfo.uid.toString(),csIp:o.gatewayInfo.csIp,unilbsServerIds:[Wi.CHOOSE_SERVER].toString(),isHttp3:o.isHttp3})}function pQ(n){return window.atob(window.localStorage.getItem(n)||"")}function jP(n,i){window.localStorage.setItem(n,window.btoa(i))}function fQ(n){let i="".concat(n.appId,"_").concat(n.cname);return typeof n.uid=="string"&&(i+="_s_".concat(n.uid)),typeof n.uid=="number"&&(i+="_".concat(n.uid)),n.token&&(i+="_".concat(n.token)),iY(i)}function ywe(n){let i=function(){const s=xwe.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(s,o){let d=s.appId;d!==void 0&&(Hi(o,10),e_(o,d));let h=s.cid;h!==void 0&&(Hi(o,16),Hi(o,h));let f=s.cname;f!==void 0&&(Hi(o,26),e_(o,f));let g=s.deviceId;g!==void 0&&(Hi(o,34),e_(o,g));let y=s.elapse;y!==void 0&&(Hi(o,40),t_(o,y));let x=s.fileSize;x!==void 0&&(Hi(o,48),t_(o,Hx(x)));let b=s.height;b!==void 0&&(Hi(o,56),t_(o,Hx(b)));let N=s.jpg;N!==void 0&&(Hi(o,66),Hi(o,N.length),gQ(o,N));let I=s.networkType;I!==void 0&&(Hi(o,72),t_(o,Hx(I)));let D=s.osType;D!==void 0&&(Hi(o,80),t_(o,Hx(D)));let $=s.requestId;$!==void 0&&(Hi(o,90),e_(o,$));let z=s.sdkVersion;z!==void 0&&(Hi(o,98),e_(o,z));let K=s.sequence;K!==void 0&&(Hi(o,104),t_(o,Hx(K)));let ie=s.sid;ie!==void 0&&(Hi(o,114),e_(o,ie));let oe=s.timestamp;oe!==void 0&&(Hi(o,120),t_(o,oe));let fe=s.uid;fe!==void 0&&(Hi(o,128),Hi(o,fe));let Ee=s.vid;Ee!==void 0&&(Hi(o,136),Hi(o,Ee));let Te=s.width;Te!==void 0&&(Hi(o,144),t_(o,Hx(Te)));let _e=s.service;_e!==void 0&&(Hi(o,152),Hi(o,_e));let Re=s.callbackData;Re!==void 0&&(Hi(o,162),Hi(o,Re.length),gQ(o,Re));let je=s.ticket;je!==void 0&&(Hi(o,170),e_(o,je));let Be=s.vendorConfigs;Be!==void 0&&(Hi(o,178),e_(o,Be))}(n,i),function(s){let o=s.bytes,d=s.limit;return o.length===d?o:o.subarray(0,d)}(i)}function vwe(n){return function(s){let o={};e:for(;!bwe(s);){let d=ER(s);switch(d>>>3){case 0:break e;case 1:o.code=ER(s);break;case 2:o.msg=_Q(s,ER(s));break;case 3:o.requestId=_Q(s,ER(s));break;case 4:o.timestamp=wwe(s,!1);break;default:Ewe(s,7&d)}}return o}({bytes:i=n,offset:0,limit:i.length});var i}function Ewe(n,i){switch(i){case 0:for(;128&Bu(n););break;case 2:C3(n,ER(n));break;case 5:C3(n,4);break;case 1:C3(n,8);break;default:throw new Error("Unimplemented type: "+i)}}function Hx(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}let xwe=[];function C3(n,i){if(n.offset+i>n.limit)throw new Error("Skip past limit");n.offset+=i}function bwe(n){return n.offset>=n.limit}function MP(n,i){let s=n.bytes,o=n.offset,d=n.limit,h=o+i;if(h>s.length){let f=new Uint8Array(2*h);f.set(s),n.bytes=f}return n.offset=h,h>d&&(n.limit=h),o}function mQ(n,i){let s=n.offset;if(s+i>n.limit)throw new Error("Read past limit");return n.offset+=i,s}function gQ(n,i){let s=MP(n,i.length);n.bytes.set(i,s)}function _Q(n,i){let s=mQ(n,i),o=String.fromCharCode,d=n.bytes,h="",f="";for(let g=0;g<i;g++){let y,x,b,N,I=d[g+s];128&I?(224&I)==192?g+1>=i?f+=h:(y=d[g+s+1],(192&y)!=128?f+=h:(N=(31&I)<<6|63&y,N<128?f+=h:(f+=o(N),g++))):(240&I)==224?g+2>=i?f+=h:(y=d[g+s+1],x=d[g+s+2],(49344&(y|x<<8))!=32896?f+=h:(N=(15&I)<<12|(63&y)<<6|63&x,N<2048||N>=55296&&N<=57343?f+=h:(f+=o(N),g+=2))):(248&I)==240?g+3>=i?f+=h:(y=d[g+s+1],x=d[g+s+2],b=d[g+s+3],(12632256&(y|x<<8|b<<16))!=8421504?f+=h:(N=(7&I)<<18|(63&y)<<12|(63&x)<<6|63&b,N<65536||N>1114111?f+=h:(N-=65536,f+=o(55296+(N>>10),56320+(1023&N)),g+=3))):f+=h:f+=o(I)}return f}function e_(n,i){let s=i.length,o=0;for(let f=0;f<s;f++){let g=i.charCodeAt(f);g>=55296&&g<=56319&&f+1<s&&(g=(g<<10)+i.charCodeAt(++f)-56613888),o+=g<128?1:g<2048?2:g<65536?3:4}Hi(n,o);let d=MP(n,o),h=n.bytes;for(let f=0;f<s;f++){let g=i.charCodeAt(f);g>=55296&&g<=56319&&f+1<s&&(g=(g<<10)+i.charCodeAt(++f)-56613888),g<128?h[d++]=g:(g<2048?h[d++]=g>>6&31|192:(g<65536?h[d++]=g>>12&15|224:(h[d++]=g>>18&7|240,h[d++]=g>>12&63|128),h[d++]=g>>6&63|128),h[d++]=63&g|128)}}function Bu(n){return n.bytes[mQ(n,1)]}function yQ(n,i){let s=MP(n,1);n.bytes[s]=i}function ER(n){let i,s=0,o=0;do i=Bu(n),s<32&&(o|=(127&i)<<s),s+=7;while(128&i);return o}function Hi(n,i){for(i>>>=0;i>=128;)yQ(n,127&i|128),i>>>=7;yQ(n,i)}function wwe(n,i){let s,o=0,d=0,h=0;return s=Bu(n),o=127&s,128&s&&(s=Bu(n),o|=(127&s)<<7,128&s&&(s=Bu(n),o|=(127&s)<<14,128&s&&(s=Bu(n),o|=(127&s)<<21,128&s&&(s=Bu(n),d=127&s,128&s&&(s=Bu(n),d|=(127&s)<<7,128&s&&(s=Bu(n),d|=(127&s)<<14,128&s&&(s=Bu(n),d|=(127&s)<<21,128&s&&(s=Bu(n),h=127&s,128&s&&(s=Bu(n),h|=(127&s)<<7))))))))),{low:o|d<<28,high:d>>>4|h<<24,unsigned:i}}function t_(n,i){let s=i.low>>>0,o=(i.low>>>28|i.high<<4)>>>0,d=i.high>>>24,h=d===0?o===0?s<16384?s<128?1:2:s<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:d<128?9:10,f=MP(n,h),g=n.bytes;switch(h){case 10:g[f+9]=d>>>7&1;case 9:g[f+8]=h!==9?128|d:127&d;case 8:g[f+7]=h!==8?o>>>21|128:o>>>21&127;case 7:g[f+6]=h!==7?o>>>14|128:o>>>14&127;case 6:g[f+5]=h!==6?o>>>7|128:o>>>7&127;case 5:g[f+4]=h!==5?128|o:127&o;case 4:g[f+3]=h!==4?s>>>21|128:s>>>21&127;case 3:g[f+2]=h!==3?s>>>14|128:s>>>14&127;case 2:g[f+1]=h!==2?s>>>7|128:s>>>7&127;case 1:g[f]=h!==1?128|s:127&s}}const vQ={},EQ={},UP=4294967296,Swe=UP*UP,xQ=Swe/2;wQ(0,!0);const bQ=wQ(0),Twe=xR(0,-2147483648,!1),Rwe=xR(-1,2147483647,!1);function wQ(n,i){let s,o,d;return i?(d=0<=(n>>>=0)&&n<256)&&(o=EQ[n],o)?o:(s=xR(n,0,!0),d&&(EQ[n]=s),s):(d=-128<=(n|=0)&&n<128)&&(o=vQ[n],o)?o:(s=xR(n,n<0?-1:0,!1),d&&(vQ[n]=s),s)}function xR(n,i,s){return{low:0|n,high:0|i,unsigned:!!s}}function SQ(n,i){if(isNaN(n))return bQ;{if(n<=-xQ)return Twe;if(n+1>=xQ)return Rwe}return n<0?bQ:xR(n%UP|0,n/UP|0,i)}function TQ(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}class N3 extends ai{get connectionState(){return this._connectionState}set connectionState(i){if(this._connectionState===i)return;const s=this._connectionState;this._connectionState=i,this.emit(Mh.CONNECTION_STATE_CHANGE,i,s)}get quality(){return this._quality}set quality(i){this._quality=i>1?1:i<.1?.1:i,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(i){var s;super(),Y(this,"name","AgoraRTCImageModeration"),Y(this,"_connectionState",Md.CONNECTING),Y(this,"_sequence",0),Y(this,"_moderationStartTime",void 0),Y(this,"_workerConnection",void 0),Y(this,"_workerMessageLengthLimit",void 0),Y(this,"_qualityRatio",void 0),Y(this,"_connectInfo",void 0),Y(this,"_cancelTokenSource",mc.CancelToken.source()),Y(this,"_retryConfig",void 0),Y(this,"_moderationInterval",void 0),Y(this,"_moderationTimer",null),Y(this,"_moderationMode",1),Y(this,"_quality",1),Y(this,"_qualityTimer",null),Y(this,"_ticket",void 0),Y(this,"_moderationIntervalMinimum",void 0),Y(this,"_uploadFailedNum",0),Y(this,"_uploadNum",0),Y(this,"_uploadTimer",null),Y(this,"_extraInfo",void 0),Y(this,"_vendor",""),Y(this,"_encoder",new TextEncoder),Y(this,"_moderationId",void 0),Y(this,"inspectImage",()=>{if(this.connectionState!==Md.CONNECTED)throw new Ce(se.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Md.CONNECTED?this.requestToInspectImage():M.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=dr(5,"image-moderation-"),this._workerMessageLengthLimit=re("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=re("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(s=i.interval)!==null&&s!==void 0?s:1e3,i.extraInfo&&(this._extraInfo=this._encoder.encode(i.extraInfo)),i.vendor&&(this._vendor=i.vendor),this._qualityRatio=re("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new cR("worker-"+this._moderationId,Gi),this.on(Mh.STATE_CHANGE,(o,d)=>{M.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Dx[o]," ").concat(d||""))}),this.handleWorkerEvents()}async init(i,s){this.emit(Mh.STATE_CHANGE,Dx.CONNECT_AP),this._connectInfo=i;const o=this._cancelTokenSource.token;return this._retryConfig=s,new et((d,h)=>{this.on(Mh.CONNECTION_STATE_CHANGE,(f,g)=>{f===Md.CONNECTED&&d()}),this.requestAP(i,o,s).then(f=>{this.connectWorker(f)}).catch(f=>{h(f)})})}updateConfig(i){var s;this._moderationInterval=(s=i.interval)!==null&&s!==void 0?s:1e3,i.extraInfo&&(this._extraInfo=this._encoder.encode(i.extraInfo)),i.vendor&&(this._vendor=i.vendor),M.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(i))),this.connectionState===Md.CONNECTED&&this.inspectImage()}async requestAP(i,s,o){const d=re("WEBCS_DOMAIN").map(y=>"https://".concat(y,"/api/v1")),h=await function(y,x,b,N){let{appId:I,areaCode:D,cname:$,sid:z,token:K,uid:ie}=x;Ux++;const oe="moderation_plugin",fe={service_name:oe,json_body:JSON.stringify({appId:I,areaCode:D,cname:$,command:"allocateEdge",requestId:Ux,seq:Ux,sid:z,appToken:K,ts:Date.now(),uid:ie+""})};let Ee,Te,_e=y[0];return Dh(async()=>{Ee=Date.now();const Re=await Vh(_e,{data:fe,cancelToken:b,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Te=Date.now()-Ee,Re.code!==0){const Bt=new Ce(se.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Re.code,{retry:!0,responseTime:Te});throw M.error(Bt.toString()),Bt}const je=JSON.parse(Re.json_body);if(je.code!==200){const Bt=new Ce(se.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(je.code,", reason: ").concat(je.reason),{code:je.code,responseTime:Te});throw M.error(Bt.toString()),Bt}if(!je.servers||!Array.isArray(je.servers)||je.servers.length===0){const Bt=new Ce(se.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:je.code,responseTime:Te});throw M.error(Bt.toString()),Bt}if(!je.servers.some(Bt=>!!Bt.wss)){const Bt=new Ce(se.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:je.code,responseTime:Te});throw M.error(Bt.toString()),Bt}const Be=re("IMAGE_MODERATION_WORKER_WSS");if(Be)return{addressList:[Be],workerToken:je.workerToken,vid:je.vid,responseTime:Te};const dt=re("IMAGE_MODERATION_WORKER_HOST");return{addressList:je.servers.map(Bt=>{let{address:dn,wss:sn}=Bt;if(dn&&sn)return"wss://".concat(dn.replace(/\./g,"-"),".").concat(dt,":").concat(sn,"/moderation")}).filter(Bt=>!!Bt),workerToken:je.workerToken,vid:je.vid,ticket:je.appTicket,responseTime:Te}},(Re,je)=>(_t.apworkerEvent(z,{success:!0,sc:200,serviceName:oe,responseDetail:JSON.stringify(Re.addressList),firstSuccess:je===0,responseTime:Te,serverIp:y[je%y.length]}),!1),(Re,je)=>(_t.apworkerEvent(z,{success:!1,sc:Re.data&&Re.data.code||200,serviceName:oe,responseTime:Te,serverIp:y[je%y.length]}),!!(Re.code!==se.OPERATION_ABORTED&&Re.code!==se.UNEXPECTED_RESPONSE||Re.data&&Re.data.retry)&&(_e=y[(je+1)%y.length],!0)),N)}(d,i,s,o);this.emit(Mh.STATE_CHANGE,Dx.AP_CONNECTED);const{addressList:f,ticket:g}=h;return this._ticket=g,f}async connectWorker(i){this.emit(Mh.STATE_CHANGE,Dx.CONNECT_WORKER),await this._workerConnection.init(i,1e4)}handleWorkerEvents(){this._workerConnection.on(an.CONNECTED,async()=>{this.emit(Mh.STATE_CHANGE,Dx.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Md.CONNECTED}),this._workerConnection.on(an.CLOSED,()=>{this.connectionState=Md.CLOSED}),this._workerConnection.on(an.FAILED,()=>{this.connectionState=Md.CLOSED}),this._workerConnection.on(an.RECONNECTING,()=>{this.connectionState=this.connectionState===Md.CONNECTED?Md.RECONNECTING:Md.CONNECTING}),this._workerConnection.on(an.ON_MESSAGE,async i=>{if(i.data instanceof ArrayBuffer){const s=vwe(new Uint8Array(i.data));re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&M.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(s)),this._uploadNum++,s.code===void 0||s.code===0||(this._uploadFailedNum++,M.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(s.code,", msg is ").concat(s.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{_t.reportApiInvoke(this._connectInfo.sid||null,{name:Qr.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,s.code],tag:Tr.TRACER}).onError(new Ce(se.IMAGE_MODERATION_UPLOAD_FAILED,s.msg)),this._uploadTimer=null},re("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else M.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(an.WILL_RECONNECT,(i,s,o)=>{i==="recover"&&o(i),o("tryNext")}),this._workerConnection.on(an.REQUEST_NEW_URLS,(i,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i).catch(s)})}static intToLong(i){return{low:i|=0,high:i>>31,unsigned:i>=0}}async requestToInspectImage(){const i=El(this,Mh.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(i){if(!i.isPlaying)return void(re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&M.debug("Only the track being played can be inspected"));this._sequence++;const o=await this.generateRequestData(i,s);this._workerConnection.sendMessage(o,!0,!0)}else re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&M.debug("Only the track being published can be inspected")}async generateRequestData(i,s){let{appId:o,cname:d,cid:h,vid:f,sid:g,uid:y}=s;const x=Date.now(),b=await i.getCurrentFrameImage("image/jpeg",this.quality),N=await $Y(b,o,d),I=this._sequence+"-"+h+"-"+y+"-"+x+"-"+dr(12,""),D={appId:o,cid:h,cname:d,deviceId:"",elapse:N3.intToLong(Number(x-this._moderationStartTime)),fileSize:b.buffer.byteLength,height:b.height,width:b.width,jpg:N,networkType:6,osType:7,requestId:I,sdkVersion:"4.24.2",sequence:this._sequence,sid:g,timestamp:SQ(x),uid:y,vid:f,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete D.callbackData;const $=ywe(D);if($.byteLength<this._workerMessageLengthLimit){if(re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const z=function(K){for(var ie=1;ie<arguments.length;ie++){var oe=arguments[ie]!=null?arguments[ie]:{};ie%2?TQ(Object(oe),!0).forEach(function(fe){Y(K,fe,oe[fe])}):Object.getOwnPropertyDescriptors?Object.defineProperties(K,Object.getOwnPropertyDescriptors(oe)):TQ(Object(oe)).forEach(function(fe){Object.defineProperty(K,fe,Object.getOwnPropertyDescriptor(oe,fe))})}return K}({},D);delete z.jpg,M.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(z))}return $}{const z=this.quality*this._qualityRatio;return this.quality=z,await this.generateRequestData(i,{appId:o,cname:d,cid:h,vid:f,sid:g,uid:y})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=mc.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Md.CLOSED,this.emit(Mh.STATE_CHANGE,Dx.CLOSED)}}function RQ(n){if(Sr(n.interval,"interval",1e3,1/0),n&&n.extraInfo&&n.extraInfo.length>1024)throw new Ce(se.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(n&&n.vendor&&n.vendor.length>1024)throw new Ce(se.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const Cwe={name:"ImageModeration",create:function(n){let{config:i}=n;return RQ(i),new N3(i)}};var CQ,NQ,IQ,AQ,kQ,PQ,DQ,OQ,LQ,jQ,MQ,UQ,VQ,FQ,BQ,zQ,GQ,WQ,HQ,KQ,qQ,YQ,$Q,XQ,JQ,QQ,ZQ,eZ,tZ,nZ,rZ,iZ,sZ,aZ,oZ,cZ,lZ,dZ,uZ,hZ,pZ,fZ,ht;function mZ(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function zu(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?mZ(Object(s),!0).forEach(function(o){Y(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):mZ(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}qs.setLogger(M);let Nwe=(CQ=Vt(),NQ=Vt({argsMap:(n,i)=>{if(!Array.isArray(i)){if(!(i instanceof Tx))return[i];i=[i]}return i.map(s=>s?Object(s).toString():"null")}}),IQ=Vt({argsMap:(n,i)=>(i||(i=[]),Array.isArray(i)||i.trackMediaType!==Sx.DATA?(Array.isArray(i)||(i=[i]),i.map(s=>s.getTrackId())):[i.getChannelId()])}),AQ=Vt({argsMap:(n,i,s,o)=>[typeof i=="object"?i.uid:i,s,o]}),kQ=Vt({argsMap:(n,i,s)=>[i,s]}),PQ=Vt({argsMap:(n,i)=>i.map(s=>{let{user:o,mediaType:d}=s;return[o==null?void 0:o.uid,d]})}),DQ=Vt({argsMap:(n,i,s,o)=>[typeof i=="object"?i.uid:i,s,o]}),OQ=Vt({argsMap:(n,i)=>i.map(s=>{let{user:o,mediaType:d}=s;return{uid:o==null?void 0:o.uid,mediaType:d}})}),LQ=Vt(),jQ=Vt(),MQ=Vt(),UQ=Vt(),VQ=Vt(),FQ=Vt(),BQ=Vt(),zQ=Vt(),GQ=Vt(),WQ=Vt(),HQ=Vt(),KQ=Vt(),qQ=Vt(),YQ=Vt(),$Q=Vt(),XQ=Vt(),JQ=Vt({argsMap:(n,i)=>[i]}),QQ=Vt(),ZQ=Vt(),eZ=Vt(),tZ=Vt(),nZ=Vt(),rZ=Vt(),iZ=Vt(),sZ=Vt(),aZ=Vt({argsMap:(n,i)=>(Array.isArray(i)||(i=[i]),[JSON.stringify(i)])}),oZ=Vt(),cZ=Vt(),lZ=Vt(),dZ=Vt(),uZ=Vt(),hZ=Vt(),pZ=Vt({reportResult:!0}),fZ=Vt(),ht=class extends ai{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var n;return((n=this._config)===null||n===void 0?void 0:n.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(n,i){let s;if(super(),Y(this,"store",void 0),Y(this,"_uid",void 0),Y(this,"_channelName",void 0),Y(this,"_uintUid",void 0),Y(this,"_users",[]),Y(this,"_config",void 0),Y(this,"_clientId",void 0),Y(this,"_appId",void 0),Y(this,"_sessionId",null),Y(this,"_key",void 0),Y(this,"_rtmConfig",{}),Y(this,"_joinInfo",void 0),Y(this,"_gateway",void 0),Y(this,"_statsCollector",void 0),Y(this,"_configDistribute",void 0),Y(this,"_leaveMutex",void 0),Y(this,"_publishMutex",void 0),Y(this,"_renewTokenMutex",void 0),Y(this,"_subscribeMutex",void 0),Y(this,"_encryptionMode","none"),Y(this,"_encryptionSecret",null),Y(this,"_encryptionSalt",null),Y(this,"_encryptDataStream",!1),Y(this,"_encryptDataStreamKey",null),Y(this,"_encryptDataStreamIv",null),Y(this,"_proxyServer",void 0),Y(this,"_turnServer",{servers:[],mode:"auto"}),Y(this,"_cloudProxyServerMode","disabled"),Y(this,"_isDualStreamEnabled",!1),Y(this,"_defaultStreamFallbackType",void 0),Y(this,"_lowStreamParameter",void 0),Y(this,"_streamFallbackTypeCacheMap",new Map),Y(this,"_remoteStreamTypeCacheMap",new Map),Y(this,"_axiosCancelSource",mc.CancelToken.source()),Y(this,"_audioVolumeIndicationInterval",void 0),Y(this,"_networkQualityInterval",void 0),Y(this,"_userOfflineTimeout",void 0),Y(this,"_streamRemovedTimeout",void 0),Y(this,"_rteDetailInterval",void 0),Y(this,"_liveTranscodeStreamingClient",void 0),Y(this,"_liveRawStreamingClient",void 0),Y(this,"_channelMediaRelayClient",void 0),Y(this,"_networkQualitySensitivity","normal"),Y(this,"_p2pChannel",void 0),Y(this,"_useLocalAccessPoint",!1),Y(this,"_setLocalAPVersion",void 0),Y(this,"_joinAndNotLeaveYet",!1),Y(this,"_numberOfJoinCount",0),Y(this,"_joinResponse",null),Y(this,"_remoteDefaultVideoStreamType",void 0),Y(this,"_inspect",void 0),Y(this,"_moderation",void 0),Y(this,"_license",void 0),Y(this,"_pendingPublishedUsers",[]),Y(this,"ntpAlignErrorCount",0),Y(this,"remoteInboundOffset",0),Y(this,"_peerConnectionState",void 0),Y(this,"_pendingRtpCapabilityChange",void 0),Y(this,"_fallbackServerInfo",void 0),Y(this,"_dualStreamMode",void 0),Y(this,"_handleLocalTrackEnable",(d,h,f)=>{this.publish(d,!1).then(h).catch(f)}),Y(this,"_handleLocalTrackDisable",(d,h,f)=>{this.unpublish(d).then(h).catch(f)}),Y(this,"_handleUserOnline",d=>{if(re("BLOCK_LOCAL_CLIENT")&&Sy(d.uid,this.channelName))return void M.debug("[".concat(d.uid,"] will be ignored in local"));this.isStringUID&&typeof d.uid!="string"&&M.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const h=this._users.find(f=>f.uid===d.uid);if(h)h._trust_in_room_=!0,h._is_pre_created&&(h._is_pre_created=!1,this.safeEmit(gn.USER_JOINED,h));else{const f=new Qg(d.uid,d.uint_id||d.uid);this._users.push(f),M.debug("[".concat(this._clientId,"] user online"),d.uid),this.store.firstVideoFrameDecoded(f.uid,{userJoinNotify:Date.now()}),this.safeEmit(gn.USER_JOINED,f)}}),Y(this,"_handleUserOffline",d=>{if(re("BLOCK_LOCAL_CLIENT")&&Sy(d.uid,this.channelName))return;const h=this._users.find(f=>f.uid===d.uid);h&&(this._handleRemoveStream(d),this._handleRemoveDataChannels(d),h._audio_pre_subscribed||h._video_pre_subscribed?h._is_pre_created=!0:jk(this._users,h),this._remoteStreamTypeCacheMap.delete(h.uid),this._streamFallbackTypeCacheMap.delete(h.uid),M.debug("[".concat(this._clientId,"] user offline"),d.uid,"reason:",d.reason),this.safeEmit(gn.USER_LEAVED,h,d.reason))}),Y(this,"_handleAddAudioOrVideoStream",(d,h,f,g,y,x,b,N)=>{if(re("BLOCK_LOCAL_CLIENT")&&Sy(h,this.channelName))return;const I=this._users.find(z=>z.uid===h);if(!I)return void M.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));M.debug("[".concat(this._clientId,"] stream added with uid ").concat(h,", type ").concat(d)),this.store.subscribe(I.uid,d,void 0,void 0,void 0,Date.now()),d==="video"&&this.store.firstVideoFrameDecoded(I.uid,{videoAddNotify:Date.now()});const D=d==="audio"?I.hasAudio:I.hasVideo;I._uintid||(I._uintid=x||h),d==="audio"?I._trust_audio_stream_added_state_=!0:I._trust_video_stream_added_state_=!0,d==="audio"?(I._audio_added_=!0,f!==void 0&&(I._audioSSRC=f),g!==void 0&&(I._cname=g),b&&(I._audioOrtc=b)):(I._video_added_=!0,f!==void 0&&(I._videoSSRC=f),g!==void 0&&(I._cname=g),N!==void 0&&(I._rtxSsrcId=N),b&&(I._videoOrtc=b)),(d==="audio"?I.hasAudio:I.hasVideo)&&!D&&(M.info("[".concat(this._clientId,"] remote user ").concat(I.uid," published ").concat(d)),this.safeEmit(gn.USER_PUBLISHED,I,d)),d==="video"?_t.onGatewayStream(this._sessionId,ms.ON_ADD_VIDEO_STREAM,Zr.ON_ADD_VIDEO_STREAM,{peer:x||h,ssrc:I._videoSSRC}):_t.onGatewayStream(this._sessionId,ms.ON_ADD_AUDIO_STREAM,Zr.ON_ADD_AUDIO_STREAM,{peer:x||h,ssrc:I._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(I,d,f).then(z=>{if(z&&(M.debug("[".concat(this._clientId,"] resubscribe ").concat(d," for user ").concat(I.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Ay))return this._p2pChannel.unsubscribe(I,d,!0).then(()=>this._subscribe(I,d,!0).catch(K=>{M.error("[".concat(this._clientId,"] resubscribe error"),K.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(I,d)&&(M.debug("[".concat(this._clientId,"] resubscribe ").concat(d," for user ").concat(I.uid," after reconnect.")),this._subscribe(I,d,!0).catch(z=>{M.error("[".concat(this._clientId,"] resubscribe error"),z.toString())}));const $=this._getEncodingName(y);d==="video"&&($==="unknown"?this.safeEmit(gn.AV1_DECODABLE_RESULT,!1):Ks()||$a()||($==null?void 0:$.toLocaleLowerCase())!==gy.av1||Jbe().then(z=>{re("FLS_ENABLE_AV1_DECODE_DETECT")&&this.safeEmit(gn.AV1_DECODABLE_RESULT,z),z||this._gateway.downgradeCodec($)}))}),Y(this,"_handleRemoveStream",d=>{if(re("BLOCK_LOCAL_CLIENT")&&Sy(d.uid,this.channelName))return;const h=this._users.find(g=>g.uid===d.uid);if(!h)return void M.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));M.debug("[".concat(this._clientId,"] stream removed with uid ").concat(d.uid));let f=()=>{};h.hasAudio&&h.hasVideo?f=()=>{M.info("[".concat(this._clientId,"] remote user ").concat(h.uid," unpublished audio track")),this.safeEmit(gn.USER_UNPUBLISHED,h,"audio"),M.info("[".concat(this._clientId,"] remote user ").concat(h.uid," unpublished video track")),this.safeEmit(gn.USER_UNPUBLISHED,h,"video")}:h.hasVideo?f=()=>{M.info("[".concat(this._clientId,"] remote user ").concat(h.uid," unpublished video track")),this.safeEmit(gn.USER_UNPUBLISHED,h,"video")}:h.hasAudio&&(f=()=>{M.info("[".concat(this._clientId,"] remote user ").concat(h.uid," unpublished audio track")),this.safeEmit(gn.USER_UNPUBLISHED,h,"audio")}),h._video_pre_subscribed||h._audio_pre_subscribed||(h._trust_audio_stream_added_state_=!0,h._trust_video_stream_added_state_=!0,h._audio_added_=!1,h._video_added_=!1,this._p2pChannel instanceof Ay&&this._p2pChannel.unsubscribe(h).then(g=>{if(g)return this._gateway.unsubscribe(g,h.uid)}),h._audioSSRC=void 0,h._videoSSRC=void 0,h._audioOrtc=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),_t.onGatewayStream(this._sessionId,ms.ON_REMOVE_STREAM,Zr.ON_REMOVE_STREAM,{peer:d.uint_id||d.uid}),f()}),Y(this,"_handleSetStreamLocalEnable",(d,h,f)=>{if(re("BLOCK_LOCAL_CLIENT")&&Sy(h,this.channelName))return;const g=this._users.find(b=>b.uid===h);if(!g)return void M.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));M.debug("[".concat(this._clientId,"] local ").concat(d," ").concat(f?"enabled":"disabled"," with uid ").concat(h));const y=d==="audio"?g.hasAudio:g.hasVideo;if(d==="audio"){g._trust_audio_enabled_state_=!0;const b=g._audio_enabled_;if(g._audio_enabled_=f,g._audio_enabled_===b)return;{const N=g._audio_enabled_?"enable-local-audio":"disable-local-audio";M.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(h,", msg: ").concat(N)),this.safeEmit(gn.USER_INFO_UPDATED,h,N)}}else{g._trust_video_enabled_state_=!0;const b=g._video_enabled_;if(g._video_enabled_=f,g._video_enabled_===b)return;{const N=g._video_enabled_?"enable-local-video":"disable-local-video";M.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(h,", msg: ").concat(N)),this.safeEmit(gn.USER_INFO_UPDATED,h,N)}}const x=d==="audio"?g.hasAudio:g.hasVideo;return y!==x?!y&&x?(M.info("[".concat(this._clientId,"] remote user ").concat(h," published ").concat(d)),void this.safeEmit(gn.USER_PUBLISHED,g,d)):(d==="video"&&g._videoTrack&&g._videoTrack._destroy(),d==="audio"&&g._audioTrack,this._p2pChannel.muteRemote(g,d),M.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished ").concat(d)),void this.safeEmit(gn.USER_UNPUBLISHED,g,d)):void 0}),Y(this,"_handleMuteStream",(d,h,f)=>{if(re("BLOCK_LOCAL_CLIENT")&&Sy(d,this.channelName))return;M.debug("[".concat(this._clientId,"] receive mute message"),d,h,f);const g=this._users.find(b=>b.uid===d);if(!g)return void M.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(d));const y=h==="audio"?g.hasAudio:g.hasVideo;if(h==="audio"){g._trust_audio_mute_state_=!0;const b=g._audio_muted_;if(g._audio_muted_=f,g._audio_muted_===b)return;{const N=g._audio_muted_?"mute-audio":"unmute-audio";M.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(N)),this.safeEmit(gn.USER_INFO_UPDATED,d,N)}}else{g._trust_video_mute_state_=!0;const b=g._video_muted_;if(g._video_muted_=f,g._video_muted_===b)return;{const N=g._video_muted_?"mute-video":"unmute-video";M.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(N)),this.safeEmit(gn.USER_INFO_UPDATED,d,N)}}const x=h==="audio"?g.hasAudio:g.hasVideo;if(y!==x){if(!y&&x)return(h==="audio"?g._audioSSRC:g._videoSSRC)?(M.info("[".concat(this._clientId,"] remote user ").concat(d," published ").concat(h)),void this.safeEmit(gn.USER_PUBLISHED,g,h)):void M.warning("[".concat(this._clientId,"] remote user ").concat(d," receive ").concat(h," unmute message  before add stream message, ").concat(h," SSRC doesn't exist yet."));h==="video"&&g._videoTrack&&!g._video_pre_subscribed&&g._videoTrack._destroy(),h==="audio"&&g._audioTrack,this._p2pChannel.muteRemote(g,h),M.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished ").concat(h)),this.safeEmit(gn.USER_UNPUBLISHED,g,h)}}),Y(this,"_handleP2PLost",async d=>{M.debug("[".concat(this._clientId,"] receive p2p lost"),d),parseInt(d.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():M.warning("[".concat(this._clientId,"] P2PLost stream not found"),d)}),Y(this,"_handleTokenWillExpire",()=>{M.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(gn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),Y(this,"_handleBeforeUnload",d=>{d.type==="beforeunload"&&d.returnValue!==void 0&&d.returnValue!==""||(this.leave(),M.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),Y(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(gn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const d={downlinkNetworkQuality:0,uplinkNetworkQuality:0};d.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),d.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(gn.NETWORK_QUALITY,d)}),Y(this,"_handleP2PAddAudioOrVideoStream",(d,h,f,g)=>{const y=this._users.find(b=>b.uid===h);if(!y)return void M.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));M.debug("[".concat(this._clientId,"] stream added with uid ").concat(h,", type ").concat(d)),this.store.subscribe(y.uid,d,void 0,void 0,void 0,Date.now());const x=d==="audio"?y.hasAudio:y.hasVideo;d==="audio"?y._trust_audio_stream_added_state_=!0:y._trust_video_stream_added_state_=!0,d==="audio"?(y._audio_added_=!0,f!==void 0&&(y._audioSSRC=f),g!==void 0&&(y._audioMid=g)):(y._video_added_=!0,f!==void 0&&(y._videoSSRC=f),g!==void 0&&(y._videoMid=g)),(d==="audio"?y.hasAudio:y.hasVideo)&&!x&&(M.info("[".concat(this._clientId,"] remote user ").concat(y.uid," published ").concat(d)),this.safeEmit(gn.USER_PUBLISHED,y,d)),this._p2pChannel.hasPendingRemoteMedia(y,d)&&(M.debug("[".concat(this._clientId,"] resubscribe ").concat(d," for user ").concat(y.uid," after reconnect.")),this._subscribe(y,d,!0).catch(b=>{M.error("[".concat(this._clientId,"] resubscribe error"),b.toString())}))}),this._config=n,this._clientId=i||dr(5,"client-"),this.store=new class{constructor(d,h,f,g,y){tn(this,"state",void 0),this.state={codec:d,audioCodec:h,mode:f,clientId:g,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:my.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,rteUrl:void 0,rteSid:void 0,autoSubscribe:!1,enableInstantMuteRestore:!1,networkQualityProbe:!1,useDcSignal:!!y}}dispatch(d){this.state=function(h,f){switch(f.type){case qt.SET_SESSION_ID:return Je(Je({},h),{},{sessionId:f.sessionId});case qt.SET_P2P_ID:return Je(Je({},h),{},{p2pId:f.p2pId});case qt.SET_UID:return Je(Je({},h),{},{uid:f.uid});case qt.SET_INT_UID:return Je(Je({},h),{},{intUid:f.intUid});case qt.SET_PUB_ID:return Je(Je({},h),{},{pubId:f.pubId});case qt.KEY_METRIC_CLIENT_CREATED:return Je(Je({},h),{},{keyMetrics:Je(Je({},h.keyMetrics),{},{clientCreated:f.metric})});case qt.KEY_METRIC_JOIN_START:return Je(Je({},h),{},{keyMetrics:Je(Je({},h.keyMetrics),{},{joinStart:f.metric})});case qt.KEY_METRIC_PRELOAD_START:return Je(Je({},h),{},{keyMetrics:Je(Je({},h.keyMetrics),{},{preloadStart:f.metric})});case qt.KEY_METRIC_PRELOAD_END:return Je(Je({},h),{},{keyMetrics:Je(Je({},h.keyMetrics),{},{preloadEnd:f.metric})});case qt.KEY_METRIC_JOIN_END:return Je(Je({},h),{},{keyMetrics:Je(Je({},h.keyMetrics),{},{joinEnd:f.metric})});case qt.KEY_METRIC_REQUEST_AP_START:return Je(Je({},h),{},{keyMetrics:Je(Je({},h.keyMetrics),{},{requestAPStart:f.metric})});case qt.KEY_METRIC_REQUEST_AP_END:return Je(Je({},h),{},{keyMetrics:Je(Je({},h.keyMetrics),{},{requestAPEnd:f.metric})});case qt.KEY_METRIC_REQUEST_SUA_END:return Je(Je({},h),{},{keyMetrics:Je(Je({},h.keyMetrics),{},{requestSUAEnd:f.metric})});case qt.KEY_METRIC_BEFORE_CONNECT:return Je(Je({},h),{},{keyMetrics:Je(Je({},h.keyMetrics),{},{beforeConnect:f.metric})});case qt.KEY_METRIC_PEER_RECEIVER:return Je(Je({},h),{},{keyMetrics:Je(Je({},h.keyMetrics),{},{peerReceiver:f.metric})});case qt.KEY_METRIC_SIGNAL_CONNECTED:return Je(Je({},h),{},{keyMetrics:Je(Je({},h.keyMetrics),{},{signalConnected:f.metric})});case qt.KEY_METRIC_JOIN_REQ:return Je(Je({},h),{},{keyMetrics:Je(Je({},h.keyMetrics),{},{joinReq:f.metric})});case qt.KEY_METRIC_JOIN_REP:return Je(Je({},h),{},{keyMetrics:Je(Je({},h.keyMetrics),{},{joinRep:f.metric})});case qt.KEY_METRIC_JOIN_GATEWAY_START:return Je(Je({},h),{},{keyMetrics:Je(Je({},h.keyMetrics),{},{joinGatewayStart:f.metric})});case qt.KEY_METRIC_JOIN_GATEWAY_END:return Je(Je({},h),{},{keyMetrics:Je(Je({},h.keyMetrics),{},{joinGatewayEnd:f.metric})});case qt.KEY_METRIC_PEER_CONNECTION_START:return Je(Je({},h),{},{keyMetrics:Je(Je({},h.keyMetrics),{},{peerConnectionStart:f.metric})});case qt.KEY_METRIC_PEER_CONNECTION_END:return Je(Je({},h),{},{keyMetrics:Je(Je({},h.keyMetrics),{},{peerConnectionEnd:f.metric})});case qt.KEY_METRIC_DESCRIPTION_START:return Je(Je({},h),{},{keyMetrics:Je(Je({},h.keyMetrics),{},{descriptionStart:f.metric})});case qt.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Je(Je({},h),{},{keyMetrics:Je(Je({},h.keyMetrics),{},{signalChannelOpen:f.metric})});case qt.KEY_METRIC_ICE_CONNECTION_END:return Je(Je({},h),{},{keyMetrics:Je(Je({},h.keyMetrics),{},{iceConnectionEnd:f.metric})});case qt.KEY_METRIC_PUBLISH:{const g=h.keyMetrics.publish,y=g.findIndex(x=>x.trackId===f.metric.trackId);return y!==-1?(g[y]=Je(Je({},g[y]),f.metric),Je(Je({},h),{},{keyMetrics:Je(Je({},h.keyMetrics),{},{publish:[...g]})})):Je(Je({},h),{},{keyMetrics:Je(Je({},h.keyMetrics),{},{publish:[...h.keyMetrics.publish,f.metric]})})}case qt.KEY_METRIC_SUBSCRIBE:{const g=h.keyMetrics.subscribe,y=g.findIndex(x=>x.userId===f.metric.userId&&x.type===f.metric.type);return y!==-1?(g[y]=Je(Je({},g[y]),f.metric),Je(Je({},h),{},{keyMetrics:Je(Je({},h.keyMetrics),{},{subscribe:[...g]})})):Je(Je({},h),{},{keyMetrics:Je(Je({},h.keyMetrics),{},{subscribe:[...h.keyMetrics.subscribe,f.metric]})})}case qt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const g=h.keyMetrics.firstVideoFrameDecoded,y=g.findIndex(x=>x.userId===f.metric.userId);return y!==-1?(g[y]=Je(Je({},g[y]),f.metric),Je(Je({},h),{},{keyMetrics:Je(Je({},h.keyMetrics),{},{firstVideoFrameDecoded:[...g]})})):Je(Je({},h),{},{keyMetrics:Je(Je({},h.keyMetrics),{},{firstVideoFrameDecoded:[...h.keyMetrics.firstVideoFrameDecoded,f.metric]})})}case qt.RESET_FIRST_VIDEO_FRAME_DECODED:return h.keyMetrics.firstVideoFrameDecoded=[],h;case qt.SET_CLOUD_PROXY_SERVER_MODE:return h.cloudProxyServerMode=f.mode,h;case qt.RECORD_JOIN_CHANNEL_SERVICE:return typeof f.index!="number"?h.joinChannelServiceRecords=[...h.joinChannelServiceRecords,f.record]:(h.joinChannelServiceRecords[f.index]=Je(Je({},h.joinChannelServiceRecords[f.index]),f.record),h.joinChannelServiceRecords=[...h.joinChannelServiceRecords]),h;case qt.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return h.joinChannelServiceRecords=[],h;case qt.RESET_KEY_METRICS:return h.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},h;case qt.SET_USE_P2P:return Je(Je({},h),{},{useP2P:f.val});case qt.SET_TRANSPORT_TYPE:return Je(Je({},h),{},{p2pTransport:f.val});case qt.SET_RTE_URL:return Je(Je({},h),{},{rteUrl:f.rteUrl});case qt.SET_RTE_SID:return Je(Je({},h),{},{rteSid:f.rteSid});default:return h}}(this.state,d)}get useDcSignal(){return this.state.useDcSignal}set useDcSignal(d){this.state.useDcSignal=d}set autoSubscribe(d){this.state.autoSubscribe=d}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(d){this.state.enableInstantMuteRestore=d}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set networkQualityProbe(d){this.state.networkQualityProbe=d}get networkQualityProbe(){return this.state.networkQualityProbe}set sessionId(d){this.dispatch({type:qt.SET_SESSION_ID,sessionId:d})}get sessionId(){return this.state.sessionId}set rteUrl(d){this.dispatch({type:qt.SET_RTE_URL,rteUrl:d})}get rteUrl(){return this.state.rteUrl}set rteSid(d){this.dispatch({type:qt.SET_RTE_SID,rteSid:d})}get rteSid(){return this.state.rteSid}set cid(d){this.state.cid=d}get cid(){return this.state.cid}set codec(d){this.state.codec=d}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(d){this.dispatch({type:qt.SET_P2P_ID,p2pId:d})}get p2pId(){return this.state.p2pId}set dcId(d){this.dispatch({type:qt.SET_DC_ID,dcId:d})}get dcId(){return this.state.dcId}set uid(d){this.dispatch({type:qt.SET_UID,uid:d})}get uid(){return this.state.uid}set intUid(d){this.dispatch({type:qt.SET_INT_UID,intUid:d})}get intUid(){return this.state.intUid}set pubId(d){this.dispatch({type:qt.SET_PUB_ID,pubId:d})}get pubId(){return this.state.pubId}set cloudProxyServerMode(d){this.dispatch({type:qt.SET_CLOUD_PROXY_SERVER_MODE,mode:d})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(d){this.dispatch({type:qt.SET_USE_P2P,val:d})}get useP2P(){return this.state.useP2P}set p2pTransport(d){this.dispatch({type:qt.SET_TRANSPORT_TYPE,val:d})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(d){this.state.hasStartJoinChannel=d}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(d){this.state.isABTestSuccess=d}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:qt.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:qt.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:qt.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:qt.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:qt.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:qt.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:qt.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:qt.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:qt.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:qt.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:qt.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:qt.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:qt.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:qt.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:qt.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:qt.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:qt.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(d,h){this.dispatch({type:qt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:Je({userId:d},h)})}descriptionStart(){this.dispatch({type:qt.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:qt.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:qt.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(d,h,f,g){this.dispatch({type:qt.KEY_METRIC_PUBLISH,metric:Je(Je({trackId:d,type:h},f&&{publishStart:f}),g&&{publishEnd:g})})}subscribe(d,h,f,g,y,x,b){this.dispatch({type:qt.KEY_METRIC_SUBSCRIBE,metric:Je(Je(Je(Je(Je({userId:d,type:h},f&&{subscribeStart:f}),g&&{subscribeEnd:g}),y&&{firstFrame:y}),x&&{streamAdded:x}),b&&{firstDecoded:b})})}massSubscribe(d,h,f,g){d.forEach(y=>{this.dispatch({type:qt.KEY_METRIC_SUBSCRIBE,metric:Je(Je(Je({userId:y.userId,type:y.type},h&&{subscribeStart:h}),f&&{subscribeEnd:f}),g&&{firstFrame:g})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(d,h){d.service==="gateway"&&Array.isArray(d.urls)&&(d.urls=d.urls.map(f=>f.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof h!="number"?(this.dispatch({type:qt.RECORD_JOIN_CHANNEL_SERVICE,record:Je(Je({},d),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(h<0||h>=this.state.joinChannelServiceRecords.length||this.dispatch({type:qt.RECORD_JOIN_CHANNEL_SERVICE,record:d,index:h}),h)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:qt.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:qt.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:qt.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(n.codec,n.audioCodec,n.mode,this._clientId,re("SIGNAL_CHANNEL")===1),this._leaveMutex=new qs("client-leave",this._clientId),this._publishMutex=new qs("client-publish",this._clientId),this._renewTokenMutex=new qs("client-renewtoken",this._clientId),this._subscribeMutex=new qs("client-subscribe",this._clientId),this.store.clientCreated(),n.proxyServer&&this.setProxyServer(n.proxyServer,!0),n.turnServer&&this.setTurnServer(n.turnServer,!0),M.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Pd," build: ").concat(r4,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),n.clientRoleOptions)try{zV(n.clientRoleOptions),s=Object.assign({},n.clientRoleOptions)}catch(d){M.warning("[".concat(this._clientId,"] ").concat(d.toString()))}var o;this._statsCollector=new _R(this.store),this._statsCollector.onStatsException=(d,h,f)=>{M.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(d,", msg: ").concat(h,", uid: ").concat(f)),d===o3.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(g=>{g instanceof Zk&&re("ENABLE_ENCODE_EXCEPTION")&&g.findClosestProfile()}),this.safeEmit(gn.EXCEPTION,{code:d,msg:h,uid:f})},this._statsCollector.onUploadPublishDuration=(d,h,f,g)=>{const y=this._users.find(x=>x.uid===d);y&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(y.uid,{peerPublishDuration:f,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(y)),_t.peerPublishStatus(this._sessionId,{subscribeElapse:g,audioPublishDuration:h,videoPublishDuration:f,peer:y._uintid}))},this._statsCollector.onVideoCodecChanged=d=>{if(re("VIDEO_STANDARD_BITRATE_VERSION")&&(d==="av1"||d==="h265"||d==="h264")){const h=this.localTracks.find(f=>f instanceof Rr);h&&h._saveEncodeBitrateRatio!==1&&h.setSaveEncodeBitrateRatio(d==="h264"?re("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=n.mode==="p2p",this._gateway=new Hbe(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:n.websocketRetryConfig||Gi,httpRetryConfig:n.httpRetryConfig||Gi,forceWaitGatewayResponse:n.forceWaitGatewayResponse===void 0||n.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:n.role,clientRoleOptions:s}),this._configDistribute=new nwe(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(o={store:this.store,statsCollector:this._statsCollector},Uh("P2PChannel").create(o)),this._handleP2PEvents()):this._p2pChannel=new Ay(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(n,i,s,o,d){let h=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],f=arguments.length>6&&arguments[6]!==void 0&&arguments[6];xr("JOIN_GATEWAY_USE_443PORT_ONLY",h),xr("JOIN_GATEWAY_USE_DUAL_DOMAIN",f);const g=this._gateway.signal.websocket;return g instanceof z4&&(g.use443PortOnly=h,g.tryDoubleDomain=f),async function(y,x,b){Pk.get(y)||Pk.set(y,[]),Dk.get(y)||Dk.set(y,x),Xp.get(y)||Xp.set(y,0);const N=Pk.get(y),I=Dk.get(y);if(!N||!I)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Xp.get(y)===I){const ie=$T();N.push(ie),await ie.promise}Xp.set(y,Xp.get(y)+1);for(var D=arguments.length,$=new Array(D>3?D-3:0),z=3;z<D;z++)$[z-3]=arguments[z];const K=await b(...$);return Xp.set(y,Xp.get(y)-1),Xp.get(y)===I-1&&N.length>0&&(N[0].resolve(),N.shift()),Xp.get(y)===0&&(Pk.set(y,[]),Dk.set(y,0),Xp.set(y,0)),K}("client.join",re("JOIN_MAX_CONCURRENCY"),this.join.bind(this),n,i,s,o,d)}async join(n,i,s,o,d){const h=++this._numberOfJoinCount;this.store.joinStart(),o&&(this.store.uid=o);const f=(Vk||Vk||(Vk=(window.location.protocol.split(":")[0]||"").toUpperCase(),Vk))==="HTTPS",g=aY()?window.isSecureContext:"Browser Not Support";(!aY()&&!f||!window.isSecureContext)&&M.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let y;_t.setAppId(n);try{if(!s&&s!==null)throw new Ce(se.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));if(s&&la(s,"token",1,2047),la(n,"appid",1,2047),dP(i),o&&uP(o),d)if(typeof d=="string")la(d,"optionalInfo",1,256),y=d;else{if(typeof d!="object")throw new Ce(se.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:K,enableInstantMuteRestore:ie,networkQualityProbe:oe}=d;K&&(Pu(K,"autoSubscribe"),M.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(K)),this.store.autoSubscribe=K),ie&&(Pu(ie,"enableInstantMuteRestore"),M.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(ie)),this.store.enableInstantMuteRestore=ie),oe&&(Pu(oe,"networkQualityProbe"),M.info("[".concat(this._clientId,"] join: networkQualityProbe: ").concat(oe)),this.store.networkQualityProbe=oe)}}}catch(K){throw _t.reportApiInvoke(fy(),{name:Qr.JOIN,options:[n,i,s,o],states:{isHttps:f,isSecureContext:g},tag:Tr.TRACER}).onError(K),K}if(this._leaveMutex.isLocked&&(M.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),M.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const K=new Ce(se.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw _t.reportApiInvoke(fy(),{name:Qr.JOIN,options:[n,i,s,o],states:{isHttps:f,isSecureContext:g},tag:Tr.TRACER}).onError(K),K}this._gateway.state="CONNECTING",this.store.preloadStart();const x=await S3({appId:n,cname:i,uid:o,stringUid:typeof o=="string"?o:void 0,token:s||n,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new Ce(se.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const b=(x==null?void 0:x.sid)||fy();M.info("[".concat(this._clientId,"] start join channel ").concat(i,", join number: ").concat(h)),this._sessionId||(this._sessionId=b,this.store.sessionId=this._sessionId);const N=_t.reportApiInvoke(this._sessionId,{id:this._clientId,name:Qr.JOIN,options:[n,i,s,o],states:{isHttps:f,isSecureContext:g},tag:Tr.TRACER}),I=zu(zu(zu({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:n,sid:this._sessionId,cname:i,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:s||n,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:y,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!x},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:re("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(I.setLocalAPVersion=this._setLocalAPVersion),typeof o=="string"&&(I.stringUid=o,this._uintUid?(I.uid=this._uintUid,this._uintUid=void 0):I.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(I.aesmode=this._encryptionMode,I.aespassword=await(async K=>{const ie=function(Te){const _e=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),Re=new Uint8Array(new ArrayBuffer(_e.length));for(let je=0;je<_e.length;je+=1)Re[je]=_e.charCodeAt(je);return Re}(),oe=await window.crypto.subtle.importKey("spki",ie,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),fe=FV(K),Ee=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},oe,fe);return function(Te){let _e="";for(let Re=0;Re<Te.length;Re+=1)_e+=String.fromCharCode(Te[Re]);return window.btoa(_e)}(new Uint8Array(Ee))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Ce(se.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(I.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const K=new TextEncoder,ie=re("USE_PURE_ENCRYPTION_MASTER_KEY")?K.encode(I.appId+this._encryptionSecret+this._encryptionSecret):K.encode(I.appId+I.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(oe,fe,Ee){const Te=await window.crypto.subtle.importKey("raw",fe,"PBKDF2",!1,["deriveBits","deriveKey"]),_e=oe==="aes-128-gcm2"?128:256,Re=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:gY,hash:"SHA-256",salt:Ee},Te,_e+wxe);return new Uint8Array(Re).subarray(_e/8)}(this._encryptionMode,ie,py(this._encryptionSalt)),this._encryptDataStreamKey=await async function(oe,fe,Ee){const Te=await window.crypto.subtle.importKey("raw",fe,"PBKDF2",!1,["deriveBits","deriveKey"]),_e=oe==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:gY,hash:"SHA-256",salt:Ee},Te,{name:"AES-GCM",length:_e},!0,["encrypt","decrypt"])}(this._encryptionMode,ie,py(this._encryptionSalt))}else g?M.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):M.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,M.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:i,appId:n,stringUid:I.stringUid});const D=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&D===this._sessionId&&_t.joinChannelTimeout(this._sessionId,5)},5e3);try{var $;let K;const ie=I.cloudProxyServer;if(Ge($=["proxy3","proxy4","proxy5"]).call($,ie)){const _e=re("PROXY_SERVER_TYPE3");Array.isArray(_e)?I.proxyServer=_e[0]:I.proxyServer=_e}if(_t.setProxyServer(I.proxyServer),M.setProxyServer(I.proxyServer),this.store.requestAPStart(),x){if(M.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(I.stringUid?", ".concat(I.stringUid," => ").concat(x.intUid):""," ")),I.stringUid&&!I.uid&&(I.uid=x.intUid),K={gatewayInfo:x.ap.gatewayInfo},re("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&I.turnServer.mode==="auto")if(x.ap.proxyInfo.addresses.length===0)M.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const _e=(await iJ(x.ap.proxyInfo,x.ap.gatewayInfo.uid)).map(Re=>({turnServerURL:Re.address,tcpport:Re.tcpport||Ea.tcpport,udpport:Re.udpport||Ea.udpport,username:Re.username||Ea.username,password:Re.password||Ea.password,forceturn:!1,security:!0}));I.turnServer={mode:"manual",servers:_e}}hQ(x,I.stringUid)}else{if(I.stringUid&&!I.uid){let _e;[_e,K]=await et.all([PJ(I.stringUid,I,this._axiosCancelSource.token,this._config.httpRetryConfig||Gi,this.store).finally(()=>{this.store.requestSUAEnd()}),kJ(I,this._axiosCancelSource.token,this._config.httpRetryConfig||Gi,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),M.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(I.stringUid," => ").concat(_e)),I.uid=_e,K.gatewayInfo.uid=_e,K.gatewayInfo.res.uid=_e}else K=await kJ(I,this._axiosCancelSource.token,this._config.httpRetryConfig||Gi,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Ce(se.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(I,this._axiosCancelSource.token),this._configDistribute.on(jh.UPDATE_BITRATE_LIMIT,_e=>{this._p2pChannel.updateBitrateLimit(_e)}),this._configDistribute.on(jh.UPDATE_CLIENT_ROLE_OPTIONS,_e=>{this._setClientRoleOptions(_e)}),this._configDistribute.on(jh.UPDATE_REMOTE_VIDEO_STREAM_TYPE,_e=>{var Re;Ge(Re=[0,1,4,5,6,7,8,9]).call(Re,_e)&&(this.remoteUsers.forEach(je=>{this._remoteStreamTypeCacheMap.get(je.uid)!==_e&&this.setRemoteVideoStreamType(je.uid,_e)}),this.setRemoteDefaultVideoStreamType(_e))}),this._configDistribute.on(jh.FALLBACK_TO_HLS,_e=>{_e&&this.safeEmit(gn.FALLBACK_TO_HLS,GV.CONFIG)}),this._configDistribute.on(jh.UPDATE_VOS_CONFIGURE,_e=>{this._gateway.setConfigure(_e).catch(Re=>{M.debug("[".concat(this._clientId,"] auto set vos config failed"),Re)})})},0),this._key=s||n;const oe=K.gatewayInfo,fe=I.uid?I.uid:oe.uid;this._joinInfo=zu(zu({},I),{},{cid:oe.cid,uid:fe,vid:oe.vid,apResponse:oe.res,apGatewayAddress:oe.apGatewayAddress,uni_lbs_ip:oe.uni_lbs_ip,gatewayAddrs:oe.gatewayAddrs}),this.store.intUid=fe,this.store.cid=oe.cid;const Ee=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Ce(se.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));N.onSuccess(Ee),this._appId=n,this._channelName=I.cname,this._uid=Ee,this.store.uid=Ee,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),!Ks()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(Ks()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const Te=I.stringUid?"string uid: ".concat(I.stringUid,",uid: ").concat(I.uid):"uid: ".concat(this._uid);return M.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(i,",").concat(Te)),setTimeout(()=>{M.startUpload()},5e3),this.store.joinEnd(),z=this,Ge(wy).call(wy,z)||wy.push(z),this._cloudProxyServerMode==="disabled"&&xn().supportWebCrypto&&re("ENABLE_PRELOAD")&&R3(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0),this._sessionId&&_t.reportRteDetail(this._sessionId),this._rteDetailInterval=window.setInterval(()=>{this._sessionId&&_t.reportRteDetail(this._sessionId)},re("RTE_DETAIL_REPORT_INTERVAL")||6e4),Ee}catch(K){const ie=Array.isArray(K)?K[0]:K;throw ie&&ie.code===se.OPERATION_ABORTED?M.warning("[".concat(this._clientId,"] join number: ").concat(h,", Joining channel failed, rollback"),ie):M.error("[".concat(this._clientId,"] join number: ").concat(h,", Joining channel failed, rollback"),ie),ie.code!==se.OPERATION_ABORTED&&this._numberOfJoinCount===h&&(this._gateway.state="DISCONNECTED",this._reset()),N.onError(ie),ie}var z}async _joinGateway(){if(!this._joinInfo||!this._key)throw new Ce(se.INVALID_OPERATION);try{return await this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!re("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}catch(n){if(n.code===se.INIT_DATACHANNEL_TIMEOUT){if(this._gateway.leave(!0,Rn.FALLBACK),M.debug("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new Ce(se.INVALID_OPERATION);return _t.reportApiInvoke(this._sessionId,{name:Qr.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:Tr.TRACER}).onSuccess(),await this._joinGateway()}throw n}}async leave(){M.info("[".concat(this._clientId,"] Leaving channel"));const n=()=>{!Ks()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(Ks()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(s){const o=wy.indexOf(s);o!==-1&&wy.splice(o,1)}(this),this._statsCollector.stopUpdateStats()};this.store.useDcSignal||n();const i=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return M.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void i();await this._gateway.leave(this.connectionState!=="CONNECTED",Rn.LEAVE),M.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),i(),this.store.useDcSignal&&n()}async publish(n){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(n)){if(!(n instanceof Tx))return this._publishDataChannel(n);n=[n]}if(n.length===0)throw new Ce(se.INVALID_PARAMS,"param list is empty");const s=n;if(this._gateway.role==="audience")throw new Ce(se.INVALID_OPERATION,"audience can not publish stream");for(const d of s){if(!(d instanceof Tx))throw new Ce(se.INVALID_PARAMS,"parameter is not local track");if(!d._enabled&&i)throw new Ce(se.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(d.getTrackId()))}M.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(s.map(d=>"".concat(d.getTrackId()," "))));const o=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),i&&s.forEach(d=>{const h=this._configDistribute.getBitrateLimit();d instanceof Rr&&h&&d.setBitrateLimit(h.uplink)});try{await this._publishHighStream(s),M.info("[".concat(this._clientId,"] Publish success, id ").concat(s.map(d=>"".concat(d.getTrackId()," "))))}catch(d){throw M.error("[".concat(this._clientId,"] publish error"),d.toString()),d}finally{o()}}async _publishDataChannel(n){if(n==null)throw new Ce(se.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(n)));Sr(n.id,"id",0,65535,!0),Pu(n.ordered,"ordered"),la(n.metadata,"metadata",0,512),M.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(n.id));const i=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(d=>d.id===n.id)!==-1)throw new Ce(se.INVALID_PARAMS,"Invalid id: ".concat(n.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Ce(se.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ce(se.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&re("FORCE_TURN")&&!re("TURN_ENABLE_TCP")&&!re("TURN_ENABLE_UDP"))throw new Ce(se.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const s=function(d){return bJ(d,!1)}(n),o=await this._p2pChannel.publishDataChannel([s]);if(o.length>0){if(typeof s._originDataChannelId!="number")throw M.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Ce(se.CREATE_DATACHANNEL_ERROR);try{await et.all(o.map(d=>this._uid&&this._gateway.publishDataChannel(this._uid,d,!0))),await s._waitTillOpen()}catch(d){if(d.code!==se.DISCONNECT_P2P)throw d}}return M.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(s.id)),s}catch(s){throw M.error("[".concat(this._clientId,"] publish datachannels error"),s.toString()),s}finally{i()}}async unpublish(n){if(!this._joinInfo||this._uid===void 0)throw new Ce(se.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let i=[];if(n)if(Array.isArray(n))i=n;else{if(!(n instanceof Tx))return this._unpublishDataChannel([n]);i=[n]}else this.store.useP2P||await this._unpublishDataChannel(),i=this._p2pChannel.getAllTracks(!0);M.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(i.map(o=>"".concat(o.getTrackId()," "))," "));const s=await this._publishMutex.lock();try{if(this.store.useP2P){const o=await this._p2pChannel.unpublish(i);o&&await this._gateway.sendExtensionMessage(Ui.UNPUBLISH,{unpubMsg:o},!0)}else{const o=await this._p2pChannel.unpublish(i);o&&await this._gateway.unpublish(o,this._uid),M.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(i.map(d=>"".concat(d.getTrackId()))))}}catch(o){throw M.error("[".concat(this._clientId,"] unpublish error"),o.toString()),o}finally{s&&s()}}async _unpublishDataChannel(n){n!==void 0&&n.length!==0||(n=this._p2pChannel.getAllDataChannels()),M.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(n.map(s=>"".concat(s.id," "))," "));const i=await this._publishMutex.lock();try{const s=await this._p2pChannel.unpublishDataChannel(n);s&&await this._gateway.unpublishDataChannel(s),M.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(n.map(o=>"".concat(o.id))))}catch(s){throw M.error("[".concat(this._clientId,"] unpublish dataChannel error"),s.toString()),s}finally{i&&i()}}async subscribe(n,i,s){if(!(n instanceof Qg)){const o=this.remoteUsers.find(d=>d.uid===n);if(!o)throw new Ce(se.INVALID_REMOTE_USER,"user is not in the channel");n=o}return i==="datachannel"?this._subscribeDataChannel(n,s):this._subscribe(n,i)}async presubscribe(n,i){if(zi(i,"mediaType",["audio","video"]),this.store.useP2P)throw new Ce(se.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Ce(se.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ce(se.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const s=i===pt.AUDIO,o=i===pt.VIDEO,d=await this._subscribeMutex.lock();try{const{ssrcId:h,ortc:f,rtxSsrcId:g,cname:y,uint_id:x}=await this._gateway.presubscribe(n,i,!0);if(h==null)throw new Ce(se.UNEXPECTED_RESPONSE,"no ssrc id");let b=this._users.find(I=>I.uid===n);b||(b=new Qg(n,x||n),b._is_pre_created=!0,this._users.push(b)),y&&(b._cname=y),b._uintid||(b._uintid=x||n),s&&(b._audioSSRC=h,b._audio_pre_subscribed=!0,f&&(b._audioOrtc=f)),o&&(b._videoSSRC=h,b._video_pre_subscribed=!0,f&&(b._videoOrtc=f),g!=null&&(b._rtxSsrcId=g)),M.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(h)),await this._p2pChannel.subscribe(b,i,h,g,f);const N=s?b._audioTrack:b._videoTrack;if(!N)throw new Ce(se.UNEXPECTED_ERROR,"can not find remote track in user");return s&&(b._trust_audio_stream_added_state_=!0,b._audio_added_=!0),o&&(b._trust_video_stream_added_state_=!0,b._video_added_=!0),N}catch(h){throw M.error("[".concat(this._clientId,"] presub user ").concat(n," error"),h),h}finally{d()}}async _subscribeDataChannel(n,i){var s;if(Sr(i,"channelId",0,65535,!0),!this._joinInfo)throw new Ce(se.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ce(se.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(g=>g===n))throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid,", this user is not in the channel")),new Ce(se.INVALID_REMOTE_USER,"user is not in the channel");if(!n.hasAudio&&!n.hasVideo&&n._dataChannels.length===0)throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid,", user is not published")),new Ce(se.INVALID_REMOTE_USER,"user is not published");const d=(s=n._dataChannels)===null||s===void 0?void 0:s.find(g=>g.id===i);if(!d)throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid," with mediaType datachannel, remote datachannel is not published")),new Ce(se.REMOTE_USER_IS_NOT_PUBLISHED);const h=await this._subscribeMutex.lock();M.info("[".concat(this._clientId,"] subscribe user ").concat(n.uid,", mediaType: datachannel"));try{const g=await this._p2pChannel.subscribeDataChannel(n,[d]);if(g&&Ge(g).call(g,d.id))try{var f;if(typeof d._originDataChannelId!="number")throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Ce(se.CREATE_DATACHANNEL_ERROR);const y={id:d.id,datachannelId:d._originDataChannelId,ordered:d.ordered,maxRetransmits:d.maxRetransmits,metadata:(f=d.metadata)!==null&&f!==void 0?f:""};await this._gateway.subscribeDataChannel(n.uid,y,!0),await d._waitTillOpen()}catch(y){if((y==null?void 0:y.code)!==se.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(n,[d]),y;await this._p2pChannel.unsubscribeDataChannel(n,[d]),this._p2pChannel.setPendingRemoteDataChannel(n,d.id)}return M.info("[".concat(this._clientId,"] subscribe success user ").concat(n.uid,", mediaType: datachannel")),d}finally{h()}}async _p2pSubscribe(n,i,s){if(zi(i,"mediaType",["audio","video"]),!this._joinInfo)throw new Ce(se.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ce(se.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(h=>h===n)){const h=new Ce(se.INVALID_REMOTE_USER,"user is not in the channel");throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid,", this user is not in the channel")),h}if(!n.hasAudio&&!n.hasVideo){const h=new Ce(se.INVALID_REMOTE_USER,"user is not published");throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid,", user is not published")),h}if(!s&&(i==="audio"&&!n.hasAudio||i==="video"&&!n.hasVideo)){const h=new Ce(se.REMOTE_USER_IS_NOT_PUBLISHED);throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid," with mediaType ").concat(i,", remote track is not published")),h}const d=await this._subscribeMutex.lock();M.info("[".concat(this._clientId,"] subscribe user ").concat(n.uid,", mediaType: ").concat(i));try{if(await this._p2pChannel.hasRemoteMediaWithLock(n,i))await this._p2pChannel.unmuteRemote(n,i);else try{const f=i==="audio"?n._audioSSRC:n._videoSSRC,g=i==="audio"?n._audioMid:n._videoMid;this.store.subscribe(n.uid,i,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(n,i,f,g)}catch(f){throw f}M.info("[".concat(this._clientId,"] subscribe success user ").concat(n.uid,", mediaType: ").concat(i)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(n.uid,this._defaultStreamFallbackType).catch(f=>{M.warning("[".concat(this._clientId,"] auto set fallback failed"),f)});const h=i==="audio"?n._audioTrack:n._videoTrack;if(!h)throw new Ce(se.UNEXPECTED_ERROR,"can not find remote track in user object");return h}catch(h){throw M.error("[".concat(this._clientId,"] subscribe user ").concat(n.uid," error"),h),h}finally{d()}}async _subscribe(n,i,s){if(this.store.useP2P)return this._p2pSubscribe(n,i);if(zi(i,"mediaType",["audio","video"]),!this._joinInfo)throw new Ce(se.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ce(se.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(x=>x===n)){const x=new Ce(se.INVALID_REMOTE_USER,"user is not in the channel");throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid,", this user is not in the channel")),x}if(!n.hasAudio&&!n.hasVideo){const x=new Ce(se.INVALID_REMOTE_USER,"user is not published");throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid,", user is not published")),x}if(!(s||(i!=="audio"||n.hasAudio&&n._audioSSRC!==void 0)&&(i!=="video"||n.hasVideo&&n._videoSSRC!==void 0))){const x=new Ce(se.REMOTE_USER_IS_NOT_PUBLISHED);throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid," with mediaType ").concat(i,", remote track is not published")),x}let d=i==="audio"?n._audioSSRC:n._videoSSRC,h=i==="audio"?n._audioOrtc:n._videoOrtc,f=i==="video"?n._rtxSsrcId:void 0,g={stream_type:i==="audio"?pt.AUDIO:pt.VIDEO,ssrcId:d};i==="video"&&this.store.firstVideoFrameDecoded(n.uid,{subscribeStart:Date.now()});const y=await this._subscribeMutex.lock();M.info("[".concat(this._clientId,"] subscribe user ").concat(n.uid,", mediaType: ").concat(i));try{if(await this._p2pChannel.hasRemoteMediaWithLock(n,i))await this._p2pChannel.unmuteRemote(n,i);else try{const b=i==="audio"?n._audioSSRC:n._videoSSRC;b!==void 0&&b!==d&&(d=b,h=i==="audio"?n._audioOrtc:n._videoOrtc,f=i==="video"?n._rtxSsrcId:void 0,g={stream_type:i==="audio"?pt.AUDIO:pt.VIDEO,ssrcId:d}),La.markSubscribeStart(this.store.clientId,d),this.store.subscribe(n.uid,i,Date.now()),await this._p2pChannel.subscribe(n,i,d,f,h);try{this._p2pChannel.isPreSubScribe(d)||await this._gateway.subscribe(n.uid,g,!0)}catch(N){if((N==null?void 0:N.code)!==se.WS_ABORT)throw await this._p2pChannel.unsubscribe(n,i),N;await this._p2pChannel.unsubscribe(n,i,!0),this._p2pChannel.setPendingRemoteMedia(n,i)}this.store.subscribe(n.uid,i,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,n,i)}catch(b){throw this._p2pChannel.reportSubscribeEvent(!1,b==null?void 0:b.code,n,i),b}M.info("[".concat(this._clientId,"] subscribe success user ").concat(n.uid,", mediaType: ").concat(i)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(n.uid,this._defaultStreamFallbackType).catch(b=>{M.warning("[".concat(this._clientId,"] auto set fallback failed"),b)});const x=i==="audio"?n._audioTrack:n._videoTrack;if(!x)throw new Ce(se.UNEXPECTED_ERROR,"can not find remote track in user object");return i==="video"&&(this.store.firstVideoFrameDecoded(n.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(n)),x}catch(x){throw M.error("[".concat(this._clientId,"] subscribe user ").concat(n.uid," error"),x),x}finally{y()}}async massSubscribe(n){if(dm(n,"subscribeList"),!this._joinInfo)throw new Ce(se.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ce(se.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const i=Date.now(),s=new Map,o=await this._subscribeMutex.lock();M.info("[".concat(this._clientId,"]start massSubscribe user ").concat(n.map(g=>{let{user:y,mediaType:x}=g;return"user: ".concat(y==null?void 0:y.uid,", mediaType: ").concat(x)}).join("; ")));const d=(n=[...n]).map(g=>{let{user:y,mediaType:x}=g;return{user:y,mediaType:x}}),h=await this._p2pChannel.globalLock();try{var f;for(let y=n.length-1;y>=0;y--){const x=n[y],{user:b,mediaType:N}=x;if(zi(N,"mediaType",["audio","video"]),!b){const z=new Ce(se.INVALID_PARAMS,"user property does not exist in subscribeList item");throw M.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),z}if(!this._users.find(z=>z===b)){const z=new Ce(se.INVALID_REMOTE_USER,"user is not in the channel");M.error("[".concat(this._clientId,"] can not massSubscribe ").concat(b.uid,", this user is not in the channel")),d[y].error=z,n.splice(y,1);continue}if(N==="audio"&&(!b.hasAudio||b._audioSSRC===void 0)||N==="video"&&(!b.hasVideo||b._videoSSRC===void 0)){const z=new Ce(se.REMOTE_USER_IS_NOT_PUBLISHED);M.error("[".concat(this._clientId,"] can not subscribe ").concat(b.uid," with mediaType ").concat(N,", remote user is not published")),d[y].error=z,n.splice(y,1);continue}const D=Ps.Video|Ps.LwoVideo,$=s.get(b);if($){if(N==="video"?$&D:$&Ps.Audio){n.splice(y,1),M.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(b.uid,", mediaType:").concat(N," twice"));continue}s.set(b,$|(N==="video"?D:Ps.Audio))}else s.set(b,N==="video"?D:Ps.Audio)}for(let y=n.length-1;y>=0;y--){const x=n[y],{user:b,mediaType:N}=x,I=Ps.Video|Ps.LwoVideo;if(this._p2pChannel.hasRemoteMedia(b,N)){await this._p2pChannel.unmuteRemoteNoLock(b,N);const D=s.get(b);s.set(b,N==="video"?D^I:D^Ps.Audio),n.splice(y,1)}}this.store.massSubscribe(n.map(y=>({userId:y.user.uid,type:y.mediaType})),i);let g=lc(f=Array.from(s.entries())).call(f,(y,x)=>{let[b,N]=x;if(N===0)return y;const I={stream_id:b.uid,stream_type:N};return N&Ps.Audio&&(I.audio_ssrc=b._audioSSRC),N&Ps.Video&&(I.video_ssrc=b._videoSSRC),y.push(I),y},[]);try{n.length>0&&await this._p2pChannel.massSubscribeNoLock(n.map(x=>{let{user:b,mediaType:N}=x;return{user:b,mediaType:N,ssrcId:N===pt.VIDEO?b._videoSSRC:b._audioSSRC,rtxSsrcId:N===pt.VIDEO?b._rtxSsrcId:void 0}}));const y=new Map;if(g=g.filter(x=>x.video_ssrc&&!this._p2pChannel.isPreSubScribe(x.video_ssrc)||x.audio_ssrc&&!this._p2pChannel.isPreSubScribe(x.audio_ssrc)||!x.video_ssrc&&!x.audio_ssrc),g.length>0){const x=await this._gateway.subscribeAll(g,!0);((x==null?void 0:x.users)||[]).forEach(b=>{let{stream_id:N,video_error_code:I,audio_error_code:D,error_code:$}=b;(I||D||$)&&y.set(N,{video_error_code:I,audio_error_code:D,error_code:$})})}if(Array.from(y.entries()).length>0){const x=[];Array.from(y.entries()).forEach(b=>{let[N,I]=b;const D=this.remoteUsers.find($=>$.uid===N);if(D){let $;I.error_code||I.video_error_code&&I.audio_error_code?$=void 0:I.video_error_code?$=pt.VIDEO:I.audio_error_code&&($=pt.AUDIO),x.push({user:D,mediaType:$})}}),x.length>0&&await this._p2pChannel.massUnsubscribeNoLock(x)}for(const x of d){const b=y.get(x.user.uid);if(b){const N=b.error_code||x.mediaType==="audio"&&b.audio_error_code||x.mediaType==="video"&&b.video_error_code;if(N){const I=Ry(N);M.error("user:".concat(x.user.uid," mediaType:").concat(x.mediaType," has massSubscribe error ").concat(I.desc)),x.error=new Ce(se.SUBSCRIBE_FAILED,"code ".concat(N,": ").concat(I.desc))}}x.error||(x.mediaType==="video"?x.track=x.user.videoTrack:x.track=x.user.audioTrack)}return this.store.massSubscribe(d.filter(x=>!x.error).map(x=>({userId:x.user.uid,type:x.mediaType})),void 0,Date.now()),d.forEach(x=>{var b;_t.subscribe(this.store.sessionId,{succ:!!x.error,ec:((b=x.error)===null||b===void 0?void 0:b.code)||null,video:x.mediaType===pt.VIDEO,audio:x.mediaType===pt.AUDIO,peerid:x.user.uid,subscribeRequestid:x.mediaType===pt.VIDEO?x.user._videoSSRC:x.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-i),preSsrc:this._p2pChannel.isPreSubScribe(x.user._videoSSRC)},!0)}),M.info("[".concat(this._clientId,"] massSubscribe success ").concat(n.map(x=>{let{user:b,mediaType:N}=x;return"user: ".concat(b==null?void 0:b.uid,", mediaType: ").concat(N)}).join("; "))),d}catch(y){throw await this._p2pChannel.massUnsubscribeNoLock(n),y}}finally{h(),o()}}async unsubscribe(n,i,s){if(!(n instanceof Qg)){const h=this.remoteUsers.find(f=>f.uid===n);if(!h)throw new Ce(se.INVALID_REMOTE_USER,"user is not in the channel");n=h}if(i||this.store.useP2P){if(i==="datachannel")return this._unsubscribeDataChannel(n,s)}else await this._unsubscribeDataChannel(n,s);if(i&&zi(i,"mediaType",["audio","video"]),!this._joinInfo)throw new Ce(se.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(h=>h===n)){const h=new Ce(se.INVALID_REMOTE_USER,"user is not in the channel");throw M.error("[".concat(this._clientId,"] can not unsubscribe ").concat(n.uid,", user is not in the channel")),h}M.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(n.uid,", mediaType: ").concat(i));const d=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(n,i);else{const h=await this._p2pChannel.unsubscribe(n,i);h&&await this._gateway.unsubscribe(h,n.uid),i&&i!=="audio"||(n._audio_pre_subscribed=!1),i&&i!=="video"||(n._video_pre_subscribed=!1),n._is_pre_created&&jk(this._users,n),M.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(n.uid,", mediaType: ").concat(i))}}catch(h){if(h.code===se.DISCONNECT_P2P)return void M.warning("disconnecting p2p, abort unsubscribe request.");throw M.error("[".concat(this._clientId,"] unsubscribe user ").concat(n.uid," error"),h.toString()),h}finally{d()}}async _unsubscribeDataChannel(n,i){if(i&&Sr(i,"id",0,65535,!0),!this._joinInfo)throw new Ce(se.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(d=>d===n)){const d=new Ce(se.INVALID_REMOTE_USER,"user is not in the channel");throw M.error("[".concat(this._clientId,"] can not unsubscribe ").concat(n.uid,", user is not in the channel")),d}let o;if(typeof i=="number"){const d=n._dataChannels.find(h=>h.id===i);d&&(o=[d])}else o=n._dataChannels;if(o===void 0){const d=new Ce(se.REMOTE_USER_IS_NOT_PUBLISHED);throw M.error("[".concat(this._clientId,"] can not unsubscribe ").concat(n.uid," with channelId ").concat(i,", remote datachannel is not published")),d}M.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(n.uid,", mediaType: datachannel, ids: ").concat(o.map(d=>d.id)));try{const d=await this._p2pChannel.unsubscribeDataChannel(n,o);d&&await this._gateway.unsubscribeDataChannel(d,n.uid),M.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(n.uid,", mediaType: datachannel, ids: ").concat(d))}catch(d){if(d.code===se.DISCONNECT_P2P)return void M.warning("disconnecting p2p, abort unsubscribe request.");throw M.error("[".concat(this._clientId,"] unsubscribe user ").concat(n.uid," error"),d.toString()),d}}async massUnsubscribe(n){if(dm(n,"unsubscribeList"),!this._joinInfo)throw new Ce(se.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");M.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(n.map(s=>{let{user:o,mediaType:d}=s;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(d,";")}).join())),n=[...n];const i=new Map;for(let s=n.length-1;s>=0;s--){const{user:o,mediaType:d}=n[s];if(!o){const g=new Ce(se.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw M.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),g}if(zi(d,"mediaType",["video","audio",void 0]),!this._users.find(g=>g===o)){M.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),n.splice(s,1);continue}const f=Ps.Video|Ps.LwoVideo;if(i.has(o)){const g=i.get(o);let y;switch(d){case"video":y=g&f;break;case"audio":y=g&Ps.Audio;break;default:y=g&(Ps.Audio|f)}if(y){M.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(o.uid,",mediaType:").concat(d," twice.")),n.splice(s,1);continue}d?d==="audio"?i.set(o,g|Ps.Audio):d==="video"&&i.set(o,g|f):i.set(o,g|Ps.Audio|f)}else d?d==="audio"?i.set(o,Ps.Audio):d==="video"&&i.set(o,f):i.set(o,Ps.Audio|f)}try{const s=await this._p2pChannel.massUnsubscribe(n);s&&await this._gateway.massUnsubscribe(s),M.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(n.map(o=>{let{user:d,mediaType:h}=o;return"user: ".concat(d==null?void 0:d.uid,", mediaType: ").concat(h,";")}).join()))}catch(s){if(s.code===se.DISCONNECT_P2P)return void M.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw M.error("[".concat(this._clientId,"] massUnsubscribe error"),s.toString()),s}}async setLowStreamParameter(n){(function(s){if(!s)throw new Pe(se.INVALID_PARAMS);bi(s.width)||UV(s.width,"streamParameter.width"),bi(s.height)||UV(s.height,"streamParameter.height"),bi(s.framerate)||UV(s.framerate,"streamParameter.framerate"),bi(s.bitrate)||Sr(s.bitrate,"streamParameter.bitrate")})(n),(!n.width&&n.height||n.width&&!n.height)&&M.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),M.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(n));const i=this._configDistribute.getLowStreamConfigDistribute();if(i&&i.bitrate&&n.bitrate&&i.bitrate<n.bitrate&&(n.bitrate=i.bitrate),this._lowStreamParameter=n,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(n,qe.LocalVideoLowTrack)}async setDualStreamMode(n,i){zi(n,"mode",[0,1,-1]);try{switch(i&&await this.setLowStreamParameter(i),this._dualStreamMode=n,this._joinInfo?this._gateway.setDualStreamMode(n).catch(s=>{M.warning("[".concat(this._clientId,"] set dual stream mode failed"),s.toString())}):M.debug("[".concat(this._clientId,"] haven't joined yet, cache dual stream mode ").concat(n)),n){case fx.AUTO_SIMULCAST_STREAM:M.info("[".concat(this._clientId,"] set dual stream mode to ").concat(n));break;case fx.DISABLE_SIMULCAST_STREM:return this.disableDualStream();case fx.ENABLE_SIMULCAST_STREAM:return this.enableDualStream()}}catch(s){throw M.error("[".concat(this._clientId,"] set dual stream mode error"),s.toString()),s}}async enableDualStream(){if(!xn().supportDualStream)throw _t.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Ce(se.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Ce(se.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(n){throw _t.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),n}this._isDualStreamEnabled=!0,this._dualStreamMode=fx.ENABLE_SIMULCAST_STREAM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(n=>{M.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),n.toString())}),_t.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),M.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)return this._isDualStreamEnabled=!1,void M.info("[".concat(this._clientId,"] disable dual stream before join"));if(this._p2pChannel.getLocalMedia(qe.LocalVideoLowTrack))try{const n=await this._p2pChannel.unpublishLowStream();n&&await this._gateway.unpublish(n,this._joinInfo.stringUid||this._joinInfo.uid)}catch(n){throw _t.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),n}this._isDualStreamEnabled=!1,this._dualStreamMode=fx.DISABLE_SIMULCAST_STREM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(n=>{M.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),n.toString())}),_t.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),M.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(n,i){if(function(o){zi(o,"role",["audience","host"])}(n),i&&zV(i),this.mode==="rtc"||this.mode==="p2p")throw M.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Ce(se.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(i&&i.level&&n==="host")throw new Ce(se.INVALID_OPERATION,"host mode can not set audience latency level");if(n==="audience"&&this._p2pChannel.hasLocalMedia())throw new Ce(se.INVALID_OPERATION,"can not set client role to audience when publishing stream");const s=this._config.role;if(this._joinInfo&&(this._joinInfo.role=n),n!==s&&re("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(n,i),this._config.role=n,this._gateway.reconnect("recover",va.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(n,i),this._config.role=n),M.info("[".concat(this._clientId,"] set client role to ").concat(n,", level: ").concat(i&&i.level)),s==="audience"&&n!=="audience"&&this._pendingRtpCapabilityChange&&this._p2pChannel instanceof Ay){const{video_codec:o}=this._pendingRtpCapabilityChange;this._p2pChannel.updateRemoteRTPCapabilities(o.map(d=>d.toLowerCase()).filter(d=>{var h;return Ge(h=Object.keys(gy)).call(h,d)}))}}async _setClientRoleOptions(n){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let i=!1;try{n&&zV(n),await this._gateway.setClientRole(this._config.role,n),i=!0}catch{}finally{M.info("[".concat(this._clientId,"] set client role options ").concat(i?"succeed":"failed",", options is ").concat(n))}}getRemoteInboundOffset(){var n;const i=(n=this._p2pChannel.getStats())===null||n===void 0?void 0:n.audioSend[0];if(!i||!i.timestamp)return 0;const s=i.timestamp-Date.now();return Math.abs(s)>1e3+i.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?s:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(n,i){if(la(n,"proxyServer"),!i){if(this.connectionState!=="DISCONNECTED")throw new Ce(se.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Ce(se.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=n,_t.setProxyServer(this._proxyServer),M.setProxyServer(this._proxyServer),M.info("[".concat(this._clientId,"] Set proxy server ").concat(i?"by initialize call":""," success."))}setTurnServer(n,i){if(Array.isArray(n)||(n=[n]),!i){if(this.connectionState!=="DISCONNECTED")throw new Ce(se.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Ce(se.INVALID_OPERATION,"You have already set the proxy")}if(ly(n))return this._turnServer={servers:n,mode:"original-manual"},void M.info("[".concat(this._clientId,"] Set original turnserver ").concat(i?"by initialize call":""," success: ").concat(n.map(s=>s.urls).join(","),"."));n.forEach(s=>Yq(s)),this._turnServer={servers:n,mode:"manual"},M.info("[".concat(this._clientId,"] Set turnserver ").concat(i?"by initialize call":""," success."))}setLicense(n){if(this.connectionState!=="DISCONNECTED")throw new Ce(se.INVALID_OPERATION,"you should set license before join channel");if(la(n,"license",32,32),!/^[A-Za-z\d]+$/.test(n))throw new Ce(se.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=n,M.info("[".concat(this._clientId,"] set license success"),n)}startProxyServer(n){if(this.connectionState!=="DISCONNECTED")throw new Ce(se.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Ce(se.INVALID_OPERATION,"You have already set the proxy");const i=[3,4,5];let s;switch(n===void 0&&(n=3),n){case 1:case 2:throw new Ce(se.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:s="proxy3";break;case 4:s="proxy4";break;case 5:s="proxy5";break;default:throw new Ce(se.INVALID_PARAMS,"proxy server mode must be ".concat(i.join("|")))}this._cloudProxyServerMode=s,this.store.cloudProxyServerMode=s,M.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Ce(se.INVALID_OPERATION,"Stop proxy server after leave channel");_t.setProxyServer(),M.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",M.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(n){if(!n.accessPoints)throw new Ce(se.INVALID_PARAMS,"accessPoints is required.");dm(n.accessPoints.serverList,"accessPoints.serverList"),la(n.accessPoints.domain,"accessPoints.domain");const i=(I,D)=>{Sr(I,D,0,65535,!0)};let s=443;if(n.accessPoints.port&&(i(n.accessPoints.port,"accessPoints.port"),s=n.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Ce(se.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");re("CLOSE_AFB_FOR_LOCAL_AP")&&(xr("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),xr("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,d=n.accessPoints.domain,h=n.accessPoints.serverList.map(I=>o.test(I)?"".concat(I.replace(/\./g,"-"),".").concat(d):I),f=h.map(I=>"".concat(I,":").concat(s));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,xr("WEBCS_DOMAIN",f),xr("WEBCS_DOMAIN_BACKUP_LIST",f),xr("GATEWAY_DOMAINS",[d]),n.report&&n.report.hostname&&Array.isArray(n.report.hostname)&&n.report.hostname.length?(dm(n.report.hostname,"report.hostname"),xr("EVENT_REPORT_DOMAIN",n.report.hostname[0]),xr("EVENT_REPORT_BACKUP_DOMAIN",n.report.hostname[1]||n.report.hostname[0])):(xr("EVENT_REPORT_DOMAIN",h[0]),xr("EVENT_REPORT_BACKUP_DOMAIN",h[1]||h[0]));let g=6443;n.report&&n.report.port&&(i(n.report.port,"report.port"),g=n.report.port),xr("STATS_COLLECTOR_PORT",g),n.report?xr("ENABLE_EVENT_REPORT",!0):xr("ENABLE_EVENT_REPORT",!1);let y="";n.log&&n.log.hostname&&Array.isArray(n.log.hostname)&&n.log.hostname.length?(dm(n.log.hostname,"log.hostname"),y=n.log.hostname[0]):y=h[0];let x=6444;n.log&&n.log.port&&(i(n.log.port,"log.port"),x=n.log.port),xr("LOG_UPLOAD_SERVER","".concat(y,":").concat(x));let b=[];n.cds&&n.cds.hostname&&Array.isArray(n.cds.hostname)&&n.cds.hostname.length?(dm(n.cds.hostname,"cds.hostname"),b=n.cds.hostname):b=h;let N=443;n.cds&&n.cds.port&&(i(n.cds.port,"cds.port"),N=n.cds.port),xr("CDS_AP",b.map(I=>"".concat(I,":").concat(N))),n.cds?xr("ENABLE_CONFIG_DISTRIBUTE",!0):xr("ENABLE_CONFIG_DISTRIBUTE",!1),M.info("set local access point v2 success")}setLocalAccessPoints(n,i){if(dm(n,"serverList"),la(i,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Ce(se.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;n=n.map(o=>s.test(o)?"".concat(o.replace(/\./g,"-"),".").concat(i):o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,xr("WEBCS_DOMAIN",n),xr("WEBCS_DOMAIN_BACKUP_LIST",n),xr("GATEWAY_DOMAINS",[i]),xr("EVENT_REPORT_DOMAIN",n[0]),xr("EVENT_REPORT_BACKUP_DOMAIN",n[1]||n[0]),xr("LOG_UPLOAD_SERVER","".concat(n[0],":6444")),M.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(n){if(zi(n,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=n,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(n),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(i){throw M.error("[".concat(this._clientId,"] set default remote video stream type error"),i.toString()),i}else M.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(n))}async setRemoteVideoStreamType(n,i){zi(i,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(n,i),setTimeout(()=>{const s=this._users.find(o=>o.uid===n);s&&s.videoTrack&&s.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(s){throw M.error("[".concat(this._clientId,"] set remote video stream type error"),s.toString()),s}M.info("[".concat(this._clientId,"] set remote ").concat(n," video stream type to ").concat(i)),this._remoteStreamTypeCacheMap.set(n,i)}async setStreamFallbackOption(n,i){zi(i,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(n,i)}catch(s){throw M.error("[".concat(this._clientId,"] set stream fallback option"),s.toString()),s}M.info("[".concat(this._clientId,"] set remote ").concat(n," stream fallback type to ").concat(i)),this._streamFallbackTypeCacheMap.set(n,i)}setEncryptionConfig(n,i,s,o){(function(h){zi(h,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(n),la(i,"secret");const d=["aes-128-gcm2","aes-256-gcm2"];if(Ge(d).call(d,n)){if(!s||!(s instanceof Uint8Array&&s.length===32))throw new Ce(se.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new Ce(se.INVALID_PARAMS,"current encrypt mode does not need salt");if(o){if(Pu(o,"encryptDataStream"),!Ge(d).call(d,n))throw new Ce(se.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(i)||M.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=n,this._encryptionSecret=i,s&&(this._encryptionSalt=Hg(s))}async renewToken(n){if(la(n,"token",1,2047),!this._key||!this._joinInfo)throw new Ce(se.INVALID_OPERATION,"renewToken should not be called before user join");const i=this._key;this._key=n,this._joinInfo&&(this._joinInfo.token=n);const s=await this._renewTokenMutex.lock();try{if(re("USE_NEW_TOKEN")){M.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const o=await twe(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Gi);M.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:n,ticket:o})}else M.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:n});M.debug("[".concat(this._clientId,"] renewToken success"))}catch(o){throw this._key=i,this._joinInfo.token=i,M.error("[".concat(this._clientId,"] renewToken failed"),o.toString()),o}finally{s()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?M.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const n=this._p2pChannel.getAudioLevels();this.safeEmit(gn.VOLUME_INDICATOR,n)},re("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const n=this._statsCollector.getRTCStats(),i=this._gateway.getInChannelInfo();return n.Duration=Math.round(i.duration/1e3),n}async startLiveStreaming(n,i){if(!i){if(this.codec!=="h264")throw new Ce(se.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Ce(se.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(n)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(n))throw new Ce(se.LIVE_STREAMING_TASK_CONFLICT);const s=i?hm.TRANSCODE:hm.RAW;return this._createLiveStreamingClient(s).startLiveStreamingTask(n,s)}setLiveTranscoding(n){return this._createLiveStreamingClient(hm.TRANSCODE).setTranscodingConfig(n)}async stopLiveStreaming(n){const i=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(s=>s&&s.hasUrl(n));if(!i.length)throw new Ce(se.INVALID_PARAMS,"can not find live streaming url to stop");await et.all(i.map(s=>s&&s.stopLiveStreamingTask(n)))}async startChannelMediaRelay(n){UJ(n),await this._createChannelMediaRelayClient().startChannelMediaRelay(n)}async updateChannelMediaRelay(n){UJ(n),await this._createChannelMediaRelayClient().updateChannelMediaRelay(n)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(n){this._p2pChannel instanceof Ay&&this._p2pChannel.addAudioMetadata(n)}async sendStreamMessage(n){var i;let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Ce(se.INVALID_OPERATION,"can not send data stream, not joined");if((typeof n=="string"||n instanceof Uint8Array)&&(n={payload:n}),typeof n.payload=="string"){const d=new TextEncoder;n.payload=d.encode(n.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ge(i=["aes-128-gcm2","aes-256-gcm2"]).call(i,this._encryptionMode)&&(o=!0,n.payload=await async function(d,h,f){var g;const y=lc(g=Array.from(f)).call(g,(z,K)=>z+K,0),x={serverTs:0,seq:Sxe++,length:f.length,checkSum:y},b=new Uint8Array(rY(y,2)),N=new ArrayBuffer(Ex),I=new DataView(N);I.setUint32(0,x.serverTs),I.setUint16(4,x.seq),I.setUint16(6,x.length),I.setUint16(8,x.checkSum);const D=16-f.length%16;f=Qq(f,new Uint8Array(D));const $=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:d,tagLength:mY,additionalData:b},h,f);return Qq(new Uint8Array(N),new Uint8Array($))}(this._encryptDataStreamIv,this._encryptDataStreamKey,n.payload)),new Blob([n.payload]).size>1024)throw new Ce(se.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(kt.DATA_STREAM,{payload:Hg(n.payload),syncWithAudio:n.syncWithAudio,sendTs:Date.now()-dwe},!s)}sendMetadata(n){if(!this._joinInfo)throw new Ce(se.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([n]).size>1024)throw new Ce(se.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(kt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Hg(n)})}async sendCustomReportMessage(n){if(Array.isArray(n)||(n=[n]),n.forEach(Dxe),!this._joinInfo)throw new Ce(se.INVALID_OPERATION,"can not send custom report, not joined");await _t.sendCustomReportMessage(this._joinInfo.sid,n)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const n=this._statsCollector.getRemoteNetworkQualityStats();if(re("DELETE_NEQ_AFTER_USER_LEAVE")){const i=this._users.map(s=>s.uid+"");Object.keys(n).forEach(s=>{Ge(i).call(i,s)||delete n[s]})}return n}getNetworkQuality(){return this._statsCollector.getNetworkQuality()}async pickSVCLayer(n,i){zi(i.spatialLayer,"spatialLayer",[0,1,2,3]),zi(i.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(n,i)}catch(s){throw M.error("[".concat(this._clientId,"] pick SVC layer failed"),s.toString()),s}}async setRTMConfig(n){const{apRTM:i=!1,rtmFlag:s}=n;if(Pu(i,"apRTM"),Sr(s,"rtmFlag",0),this._rtmConfig.apRTM=i,this._rtmConfig.rtmFlag=s,M.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(n)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=i,this._joinInfo.rtmFlag=s,this._gateway.setRTM2Flag(s)}_reset(){if(M.debug("[".concat(this._clientId,"] reset client")),function(n){const i=kx.indexOf(n);i!==-1&&kx.splice(i,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._pendingRtpCapabilityChange=void 0,this._axiosCancelSource.cancel(),this._axiosCancelSource=mc.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&uQ(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0,this._sessionId&&_t.reportRteDetail(this._sessionId)),this._fallbackServerInfo=void 0,this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&_t.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(n=>{n._audioTrack&&n._audioTrack._destroy(),n._videoTrack&&n._videoTrack._destroy(),n._dataChannels&&(n._dataChannels.forEach(i=>i._close()),n._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new qs("client-publish",this._clientId),this._subscribeMutex=new qs("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(n,i){var s;const o=n||fy();n?M.debug("[".concat(this._clientId,"] new Session ").concat(o)):M.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(o));const d=n?"":this._sessionId||"";this._sessionId=o,this.store.sessionId=o,_t.addSid(o);const h={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(i==null?void 0:i.stringUid)||((s=this._joinInfo)===null||s===void 0?void 0:s.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:d,clientRole:this.role==="audience"?2:1,rteUrl:this.store.rteUrl,rteSid:this.store.rteSid};_t.sessionInit(this._sessionId,zu({cname:i.channel,appid:i.appId},h)),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}async _publishHighStream(n){if(!this._joinInfo||this._uid===void 0)throw new Ce(se.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ce(se.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&re("FORCE_TURN")&&!re("TURN_ENABLE_TCP")&&!re("TURN_ENABLE_UDP"))throw new Ce(se.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");M.debug("[".concat(this._clientId,"] publish high stream"));try{const s=await this._p2pChannel.publish(n,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const o=(await s.next()).value;if(o){try{await this._gateway.sendExtensionMessage(Ui.PUBLISH,o,!0)}catch(d){throw s.throw(d),d}await s.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const o=(await s.next()).value;if(o){var i;let d;try{d=await this._gateway.publish(this._uid,o,!0)}catch(h){if(h.code!==se.DISCONNECT_P2P)throw s.throw(h),h}await s.next(((i=d)===null||i===void 0?void 0:i.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const d of n)d instanceof Rr&&d._encoderConfig&&this._gateway.setVideoProfile(d._encoderConfig).catch(h=>{M.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!d.muted&&d.enabled||await this._p2pChannel.muteLocalTrack(d)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,n),(s==null?void 0:s.code)===se.WS_ABORT)return;throw s}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Ce(se.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ce(se.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));M.debug("[".concat(this._clientId,"] publish low stream"));const n=this._configDistribute.getLowStreamConfigDistribute();n&&n.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&n.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=n.bitrate));try{const s=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await s.next()).value;if(o){var i;let d;try{d=await this._gateway.publish(this._uid,o,!0)}catch(h){if(h.code!==se.DISCONNECT_P2P)throw s.throw(h),h}s.next(((i=d)===null||i===void 0?void 0:i.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,void 0,!0),(s==null?void 0:s.code)===se.WS_ABORT)return;throw s}}_createLiveStreamingClient(n){const i=()=>{if(!this._joinInfo||!this._appId)return new Ce(se.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const s=(o={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Uh("LiveStreaming").create(o));var o;return s.onLiveStreamError=(d,h)=>{_t.reportApiInvoke(this._sessionId,{name:Qr.ON_LIVE_STREAM_ERROR,options:[d,h],tag:Tr.TRACER}).onSuccess(),this.safeEmit(gn.LIVE_STREAMING_ERROR,d,h)},s.onLiveStreamWarning=(d,h)=>{_t.reportApiInvoke(this._sessionId,{name:Qr.ON_LIVE_STREAM_WARNING,options:[d,h],tag:Tr.TRACER}).onSuccess(),this.safeEmit(gn.LIVE_STREAMING_WARNING,d,h)},s.on(V4.REQUEST_WORKER_MANAGER_LIST,(d,h,f)=>{if(!this._joinInfo)return f(new Ce(se.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(g,y,x,b){const N=re("UAP_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(I=>y.proxyServer?"https://".concat(y.proxyServer,"/ap/?url=").concat(I+"/api/v1?action=uap"):"https://".concat(I,"/api/v1?action=uap"));return await Ybe(N,g,y,x,b)})(d,this._joinInfo,this._axiosCancelSource.token,Gi).then(h).catch(f)}),s};return n===hm.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||i(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||i(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Ce(se.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:i,sendResolutionHeight:s}=this.getLocalVideoStats(),o=(n={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:i,height:s}},Uh("ChannelMediaRelay").create(n));o.on("state",d=>{d===qc.RELAY_STATE_FAILURE&&o&&o.dispose(),this.safeEmit(gn.CHANNEL_MEDIA_RELAY_STATE,d)}),o.on("event",d=>{this.safeEmit(gn.CHANNEL_MEDIA_RELAY_EVENT,d)}),this._channelMediaRelayClient=o,this._statsCollector.onStatsChanged=(d,h)=>{var f;d==="resolution"&&((f=this._channelMediaRelayClient)===null||f===void 0||f.setVideoProfile(h))}}var n;return this._channelMediaRelayClient}_handleUpdateDataChannel(n,i){const{added:s,deleted:o}=n,d=[];if(i){const h=[];this._users.forEach(f=>{f._dataChannels.forEach(g=>{s.every(y=>y.uid!==f._uintid||y.stream_id!==g.id)&&h.push({uid:f._uintid,stream_id:g.id,ordered:g.ordered,max_retrans_times:g.maxRetransmits,metadata:g.metadata})})}),h.length>0&&this._handleUpdateDataChannel({added:[],deleted:h})}Array.isArray(s)&&s.length>0&&s.forEach(h=>{const{uid:f,stream_id:g,ordered:y,max_retrans_times:x,metadata:b}=h,N=this._users.find(I=>I._uintid===f);if(!N)return void M.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(M.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(f)),Ge(d).call(d,N)||d.push(N),N._uintid||(N._uintid=f),N._dataChannels.findIndex(I=>I.id===h.stream_id)===-1){const I={id:g,ordered:!!y,maxRetransmits:x,metadata:b},D=function($){return bJ($,!0)}(I);N._dataChannels.push(D),M.info("[".concat(this._clientId,"] remote user ").concat(N.uid," published datachannel")),i||this.safeEmit(gn.USER_PUBLISHED,N,"datachannel",I)}this._p2pChannel.hasPendingRemoteDataChannel(N,h.stream_id)&&(M.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(N.uid," after reconnect.")),this._subscribeDataChannel(N,h.stream_id).catch(I=>{M.error("[".concat(this._clientId,"] resubscribe datachannel error"),I.toString())}))}),i&&(this.safeEmit(gn.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(o)&&o.length>0&&o.forEach(h=>{const{uid:f,stream_id:g}=h,y=this._users.find(b=>b._uintid===f);if(!y)return void M.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const x=y._dataChannels.find(b=>b.id===h.stream_id);x&&(M.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(f)),this._p2pChannel.unsubscribeDataChannel(y,[x]).then(b=>{if(y._dataChannels=y._dataChannels.filter(N=>N!==x),b)return this._gateway.unsubscribeDataChannel(b,y.uid)}),M.info("[".concat(this._clientId,"] remote user ").concat(f," unpublished datachannel ,id:").concat(x.id)),this.safeEmit(gn.USER_UNPUBLISHED,y,"datachannel",x._config))})}_getEncodingName(n){var i,s;if(!this._joinResponse)return;const o=(i=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||i===void 0?void 0:i.videoCodecs;if(!o)return;for(const g of o){var d;if(g.payloadType===n)return g==null||(d=g.rtpMap)===null||d===void 0?void 0:d.encodingName}const h=(s=this._joinResponse.ortc.rtpCapabilities.recv)===null||s===void 0?void 0:s.videoCodecs;if(h)for(const g of h){var f;if(g.payloadType===n)return g==null||(f=g.rtpMap)===null||f===void 0?void 0:f.encodingName}return n===0?"unknown":void 0}_handleRemoveDataChannels(n){const i=this._users.find(s=>s.uid===n.uid);if(i){if(i._dataChannels!==void 0&&i._dataChannels.length>0){M.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(n.uid));const s=()=>{M.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished datachannel")),i._dataChannels.forEach(o=>{this.safeEmit(gn.USER_UNPUBLISHED,i,"datachannel",o._config)})};this._p2pChannel.unsubscribeDataChannel(i,i._dataChannels).then(o=>{if(o)return this._gateway.unsubscribeDataChannel(o,i.uid)}),s()}}else M.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Mi.UPDATE_GATEWAY_CONFIG,()=>{(function(){let n;try{n=window.localStorage.getItem("websdk_ng_global_parameter")}catch(i){return void M.error("Error loading sdk config",i.message)}if(n)try{const i=JSON.parse(window.atob(n)),s=Date.now();Object.keys(i).forEach(o=>{const{value:d,type:h,expires:f}=i[o];f&&f<=s||h||P4()||!Object.prototype.hasOwnProperty.call(Gk,o)||(ql[o]=d,ur[o]=d,M.debug("Update gateway parameters from config distribute",o,d))})}catch(i){M.error("Error update config from local cache",i.message)}})()}),this._gateway.on(Mi.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Mi.CONNECTION_STATE_CHANGE,(n,i,s)=>{var o;if(s===Rn.FALLBACK)return;const d=()=>{this.safeEmit(gn.CONNECTION_STATE_CHANGE,n,i,s)};if(_t.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:Qr.CONNECTION_STATE_CHANGE,options:[n,i,s],tag:Tr.TRACER}).onSuccess(JSON.stringify({cur:n,prev:i,reason:s})),M.info("[".concat(this._clientId,"] signal connection state change: ").concat(i," -> ").concat(n)),n==="DISCONNECTED")return this._reset(),void d();if(n==="RECONNECTING")this._users.forEach(f=>{f._trust_in_room_=!1,f._trust_audio_enabled_state_=!1,f._trust_video_enabled_state_=!1,f._trust_audio_mute_state_=!1,f._trust_video_mute_state_=!1,f._trust_audio_stream_added_state_=!1,f._trust_video_stream_added_state_=!1,f._is_pre_created||(f._audio_pre_subscribed||(f._audioSSRC=void 0,f._audioOrtc=void 0),f._video_pre_subscribed||(f._videoSSRC=void 0,f._videoOrtc=void 0,f._rtxSsrcId=void 0),f._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(n==="CONNECTED"){var h;this._streamFallbackTypeCacheMap.forEach((f,g)=>{this._gateway.setStreamFallbackOption(g,f).catch(y=>{M.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),y)})}),this._remoteStreamTypeCacheMap.forEach((f,g)=>{this._gateway.setRemoteVideoStreamType(g,f).catch(y=>{M.warning("[".concat(this._clientId,"] auto set remote stream type failed"),y)})}),re("VOS_CONFIGURE")&&Array.isArray(re("VOS_CONFIGURE"))&&re("VOS_CONFIGURE").length>0&&(this._gateway.setConfigure(re("VOS_CONFIGURE")).catch(f=>{M.debug("[".concat(this._clientId,"] auto set vos config failed"),f)}),M.debug("[".concat(this._clientId,"] ws connected auto set vos config"))),this._remoteDefaultVideoStreamType!==void 0&&((h=this._joinInfo)===null||h===void 0?void 0:h.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{M.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(f=>{M.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(f))}),this._dualStreamMode&&this._gateway.setDualStreamMode(this._dualStreamMode).catch(f=>{M.warning("[".concat(this._clientId,"] auto set dual stream mode failed"),f)}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(f=>!f._trust_in_room_).forEach(f=>{M.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(f.uid)),this._handleUserOffline({uid:f.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(f=>{f._trust_audio_mute_state_||(M.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(f.uid)),this._handleMuteStream(f.uid,pt.AUDIO,!1)),f._trust_video_mute_state_||(M.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(f.uid)),this._handleMuteStream(f.uid,pt.VIDEO,!1)),f._trust_audio_enabled_state_||(M.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(f.uid)),this._handleSetStreamLocalEnable("audio",f.uid,!0)),f._trust_video_enabled_state_||(M.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(f.uid)),this._handleSetStreamLocalEnable("video",f.uid,!0)),f._trust_video_stream_added_state_||(M.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(f.uid)),this._handleResetAddStream(f,"video")),f._trust_audio_stream_added_state_||(M.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(f.uid)),this._handleResetAddStream(f,"audio")),f._video_added_||f._audio_added_||(M.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(f.uid)),this._handleRemoveStream({uid:f.uid,uint_id:f._uintid}))}))},1e3))}d()}),this._gateway.on(Mi.REQUEST_NEW_GATEWAY_LIST,async(n,i)=>{if(!this._joinInfo)return i(new Ce(se.UNEXPECTED_ERROR,"can not recover, no join info"));try{let s;if(this._fallbackServerInfo)s=this._fallbackServerInfo,this._fallbackServerInfo=void 0,this._joinInfo.preload=!1,_t.reportApiInvoke(this._sessionId,{name:Qr.VOS_FALLBACK_CN,options:{cur:s.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!0},tag:Tr.TRACER}).onSuccess(),M.info("[".concat(this._clientId,"] use fallback cn server info"));else{const d=await S3(zu(zu({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));d?(s=d.ap,hQ(d),this._joinInfo.preload=!0):(s=await RP(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Gi,this.store),this._joinInfo.preload=!1)}this._joinInfo&&(this._joinInfo.apResponse=s.gatewayInfo.res,this._joinInfo.gatewayAddrs=s.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=s.gatewayInfo.uni_lbs_ip);const o=[];s.gatewayInfo.gatewayAddrs.forEach(d=>{let{address:h}=d;const[f,g]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?o.push({proxy:this._joinInfo.proxyServer,host:f,port:g}):o.push({host:f,port:g})}),n(o)}catch(s){i(s)}}),this._gateway.on(Mi.NETWORK_QUALITY,n=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(gn.NETWORK_QUALITY,n)}),this._gateway.on(Mi.STREAM_TYPE_CHANGE,(n,i)=>{this.safeEmit(gn.STREAM_TYPE_CHANGED,n,i),_t.reportApiInvoke(this._sessionId,{name:Qr.STREAM_TYPE_CHANGE,options:[n,i],tag:Tr.TRACER}).onSuccess(JSON.stringify({uid:n,streamType:i}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(Mi.IS_P2P_DISCONNECTED,n=>{this._p2pChannel.isP2PDisconnected()?n(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?n(!1):n(!0)}),this._gateway.on(Mi.REQUEST_P2P_CONNECTION_PARAMS,async(n,i,s)=>{try{let o=await this._p2pChannel.getEstablishParams();o&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(o=await this._p2pChannel.startP2PConnection(n)),i(o)}catch(o){s(o)}}),this._gateway.on(Mi.JOIN_RESPONSE,(n,i)=>{if(this.store.useP2P)return;let s;this._joinResponse=n,n.attributes?s=n.attributes.userAttributes.preSubSsrcs:M.debug("no attributes in joinResponse");const o=hJ(n.ortc,i,s);this._p2pChannel.connect(o)}),this._gateway.on(Mi.PRE_CONNECT_PC,async(n,i,s)=>{const{candidates:o,fingerprint:d,turnServer:h}=n;if(this._joinInfo&&o.length>0&&!this._p2pChannel.isPlanB){const{cert:g,cid:y}=this._joinInfo.apResponse,x="".concat(y,"_").concat(g);if(x.length<4||x.length>256)return void M.debug("[".concat(this._clientId,"] ufrag length is not valid, length: ").concat(x.length));await this._p2pChannel.startP2PConnection({turnServer:h,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var f;i(await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(y,"_").concat(g),icePwd:"".concat(y,"_").concat(g)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(f=re("FINGERPRINT"))!==null&&f!==void 0?f:d}]},candidates:o,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0}))}catch(b){b.code&&b.code===se.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:h,cloudProxyServer:this._joinInfo.cloudProxyServer},!0),s(b)}}}),this._gateway.on(Mi.VOS_FALLBACK,n=>{n==="fallback_hls"&&this.safeEmit(gn.FALLBACK_TO_HLS,GV.VOSERROR)}),this._gateway.on(Mi.RESET_SIGNAL,()=>{this._p2pChannel instanceof Ay&&this._p2pChannel.fallbackConnection(),this._handleGatewaySignalEvents()}),this._gateway.on(Mi.DATACHANNEL_FAILBACK,()=>{_t.reportApiInvoke(this._sessionId,{name:Qr.DATACHANNEL_FAILBACK,options:{},tag:Tr.TRACER}).onSuccess(),this._joinGateway()})}_handleGatewaySignalEvents(){this._gateway.signal.on(Yt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Yt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Yt.ON_ADD_AUDIO_STREAM,n=>this._handleAddAudioOrVideoStream("audio",n.uid,n.ssrcId,n.cname,n.pt,n.uint_id,n.ortc)),this._gateway.signal.on(Yt.ON_ADD_VIDEO_STREAM,n=>this._handleAddAudioOrVideoStream("video",n.uid,n.ssrcId,n.cname,n.pt,n.uint_id,n.ortc,n.rtxSsrcId)),this._gateway.signal.on(Yt.ON_REMOTE_DATASTREAM_UPDATE,n=>{this._handleUpdateDataChannel(n)}),this._gateway.signal.on(Yt.ON_REMOTE_FULL_DATASTREAM_INFO,n=>{this._handleUpdateDataChannel({added:n.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Yt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Yt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Yt.MUTE_AUDIO,n=>this._handleMuteStream(n.uid,pt.AUDIO,!0)),this._gateway.signal.on(Yt.UNMUTE_AUDIO,n=>this._handleMuteStream(n.uid,pt.AUDIO,!1)),this._gateway.signal.on(Yt.MUTE_VIDEO,n=>this._handleMuteStream(n.uid,pt.VIDEO,!0)),this._gateway.signal.on(Yt.UNMUTE_VIDEO,n=>this._handleMuteStream(n.uid,pt.VIDEO,!1)),this._gateway.signal.on(Yt.RECEIVE_METADATA,n=>{const i=py(n.metadata);this.safeEmit(gn.RECEIVE_METADATA,n.uid,i)}),this._gateway.signal.on(Yt.ON_DATA_STREAM,async n=>{var i;if(!n)return;let s=py(n.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ge(i=["aes-128-gcm2","aes-256-gcm2"]).call(i,this._encryptionMode)){if(n.payload.length<Ex)throw new Ce(se.UNEXPECTED_RESPONSE,"payload length ".concat(n.payload.length," is less than header length ").concat(Ex));s=await async function(h,f,g){const y=g.subarray(0,Ex),x=y.slice(8,Ex),b=(x[0]<<8)+x[1],N=(y[6]<<8)+y[7],I=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:h,tagLength:mY,additionalData:new Uint8Array(rY(b,2))},f,g.subarray(Ex));return new Uint8Array(I).subarray(0,N)}(this._encryptDataStreamIv,this._encryptDataStreamKey,s)}let o=0;if(n.ordered||n.syncWithAudio){const d=this._p2pChannel.getStats(),h=this.remoteUsers.find(g=>g.uid===n.uid),f=d==null?void 0:d.audioRecv.find(g=>g.ssrc===(h==null?void 0:h._audioSSRC));o=f==null?void 0:f.jitterBufferMs}(o==null||Number.isNaN(o))&&(o=0),hwe(zu(zu({},n),{},{payload:s}),o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Yt.ON_CRYPT_ERROR,()=>{Wg(()=>{M.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(gn.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Yt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Yt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{M.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Rn.TOKEN_EXPIRE),this.safeEmit(gn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Yt.ON_STREAM_FALLBACK_UPDATE,n=>{M.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(n.stream_id,", attr: ").concat(n.stream_type)),this.safeEmit(gn.STREAM_FALLBACK,n.stream_id,n.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Yt.ENABLE_MULTI_STREAM,n=>{this._dualStreamMode===fx.AUTO_SIMULCAST_STREAM&&this.enableDualStream().catch(i=>{M.debug("[".concat(this._clientId,"] set dual stream mode error"),i.toString())})}),this._gateway.signal.on(Yt.ON_PUBLISH_STREAM,n=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:n.proxy})),M.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(n))))}),this._gateway.signal.on(Yt.ENABLE_LOCAL_VIDEO,n=>{this._handleSetStreamLocalEnable("video",n.uid,!0)}),this._gateway.signal.on(Yt.DISABLE_LOCAL_VIDEO,n=>{this._handleSetStreamLocalEnable("video",n.uid,!1)}),this._gateway.signal.on(xt.REQUEST_TIMEOUT,(n,i)=>{if(this._joinInfo)switch(n){case kt.PUBLISH:{if(!i)return;const d=i.ortc;if(d){var s,o;const h=d.some(y=>{let{stream_type:x}=y;return x===hr.Audio}),f=d.some(y=>{let{stream_type:x}=y;return x!==hr.Audio}),g=d.some(y=>{let{stream_type:x}=y;return x===hr.Screen||x===hr.ScreenLow});i.state==="offer"&&_t.publish(this._joinInfo.sid,{eventElapse:La.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:se.TIMEOUT,audio:h,video:f,p2pid:i.p2p_id,publishRequestid:this.store.pubId,screenshare:g,audioName:h?(s=d.find(y=>{let{stream_type:x}=y;return x===hr.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0,videoName:f?(o=d.find(y=>{let{stream_type:x}=y;return x!==hr.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0})}break}case kt.SUBSCRIBE:i&&_t.subscribe(this._joinInfo.sid,{succ:!1,ec:se.TIMEOUT,audio:i.stream_type===pt.AUDIO,video:i.stream_type===pt.VIDEO,peerid:i.stream_id,subscribeRequestid:i.ssrcId,p2pid:this.store.p2pId,eventElapse:La.measureFromSubscribeStart(this.store.clientId,i.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(i.ssrcId)})}}),this._gateway.signal.on(Yt.ON_P2P_OK,n=>{this.uid,this._uid}),this._gateway.signal.on(Yt.ON_PUBLISHED_USER_LIST,n=>{if(n==null||!n.users)return;re("BLOCK_LOCAL_CLIENT")&&(n.users=n.users.filter(o=>!Sy(o.string_id||o.stream_id,this.channelName)));const i=[],s=[];for(const o of n.users){let d=this._users.find(b=>b._uintid===o.stream_id);d?d._trust_in_room_=!0:(d=new Qg(o.string_id||o.stream_id,o.stream_id),this._users.push(d),this.store.firstVideoFrameDecoded(d.uid,{userJoinNotify:Date.now()}),this.getListeners(gn.PUBLISHED_USER_LIST).length===0&&(M.debug("[".concat(this._clientId,"] user online"),o.stream_id),this.safeEmit(gn.USER_JOINED,d)));const h=Ps.Audio&o.stream_type,f=(Ps.Video|Ps.LwoVideo)&o.stream_type,g=(65280&o.stream_type)!=0,y=h&&d.hasAudio,x=f&&d.hasVideo;f&&(d._trust_video_stream_added_state_=!0,d._video_added_=!0,d._videoSSRC=o.video_ssrc,d._rtxSsrcId=o.video_rtx),h&&(d._trust_audio_stream_added_state_=!0,d._audio_added_=!0,d._audioSSRC=o.audio_ssrc),h&&!y&&this.getListeners(gn.PUBLISHED_USER_LIST).length===0&&(M.info("[".concat(this._clientId,"] remote user ").concat(d.uid," published audio")),this.safeEmit(gn.USER_PUBLISHED,d,"audio")),f&&!x&&this.getListeners(gn.PUBLISHED_USER_LIST).length===0&&(M.info("[".concat(this._clientId,"] remote user ").concat(d.uid," published video")),this.safeEmit(gn.USER_PUBLISHED,d,"video")),(h&&!y||f&&!x||g)&&i.push(d),f&&this._p2pChannel.hasPendingRemoteMedia(d,"video")&&s.push({user:d,mediaType:"video"}),h&&this._p2pChannel.hasPendingRemoteMedia(d,"audio")&&s.push({user:d,mediaType:"audio"})}s.length>0&&(M.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(s.map(o=>"user: ".concat(o.user.uid,", mediaType: ").concat(o.mediaType)).join("; ")," ")),this.massSubscribe(s).catch(o=>{M.error("[".concat(this._clientId,"] mass resubscribe error"),o.toString())})),this.getListeners(gn.PUBLISHED_USER_LIST).length>0?re("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=i:(M.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(i.map(o=>o.uid).join(", "))),this.safeEmit(gn.PUBLISHED_USER_LIST,i)):M.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(i.map(o=>o.uid).join(", ")))}),this._gateway.signal.on(Yt.ON_RTP_CAPABILITY_CHANGE,n=>{const{video_codec:i}=n;if(this._p2pChannel instanceof Ay){if(this.role==="audience"&&re("UPDATE_RTP_CAP_IN_HOST"))return this._pendingRtpCapabilityChange=n,void M.debug("[".concat(this._clientId,"] no need to change rtp capability because of audience, params: ").concat(JSON.stringify(n)));this._p2pChannel.updateRemoteRTPCapabilities(i.map(s=>s.toLowerCase()).filter(s=>{var o;return Ge(o=Object.keys(gy)).call(o,s)}))}}),this._gateway.signal.on(xt.VOS_FALLBACK_PROMISE,async(n,i,s)=>{if(n==="FALLBACKCN"&&re("ENABLE_QUALITY_FALLBACK")){if(!this._joinInfo)return s(new Ce(se.UNEXPECTED_ERROR,"can not recover, no join info"));M.info("[".concat(this._clientId,"] try fallback to cn, start request new server info"));const d=this._joinInfo.apRequestDetail;try{this._joinInfo.apRequestDetail=n;const h=await RP(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Gi,this.store);if(re("QUALITY_FALLBACK_REHEARSAL"))return _t.reportApiInvoke(this._sessionId,{name:Qr.VOS_FALLBACK_CN,options:{cur:h.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:Tr.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=d,void s();this._fallbackServerInfo=h,i()}catch(h){var o;const f=h==null||(o=h.data)===null||o===void 0?void 0:o.desc;re("QUALITY_FALLBACK_REHEARSAL")?(_t.reportApiInvoke(this._sessionId,{name:Qr.VOS_FALLBACK_CN,options:{cur:"failed, errorReason: "+f||"unknown",prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:Tr.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=d):Array.isArray(f)&&Ge(f).call(f,"request downgrade fallback")&&this.safeEmit(gn.FALLBACK_TO_HLS,GV.AP_ERROR),s(h)}}else s()})}_handleP2PEvents(){this._gateway.signal.on(Yt.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Ui.PUBLISH,(n,i,s)=>{const{uid:o}=n;n.forEach(d=>{const{kind:h,ssrcs:f,mid:g,isMuted:y}=d;this._handleP2PAddAudioOrVideoStream(h,o,f[0].ssrcId,g);const x=this._users.find(b=>b.uid===o);return x&&this.store.useP2P?this._p2pChannel.mockSubscribe(x,h,f[0].ssrcId,g).then(()=>{i()}).catch(s):i(),this._handleMuteStream(o,h,!!y)})}),this._gateway.signal.on(Ui.CALL,async(n,i,s)=>{if(this.store.useP2P)try{var o;i(await this._p2pChannel.startP2P({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},n))}catch(d){s(d)}}),this._gateway.signal.on(xt.P2P_CONNECTION,async n=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(n)}),this._gateway.signal.on(Ui.UNPUBLISH,async(n,i,s)=>{if(this.store.useP2P){const{unpubMsg:o,uid:d}=n,h=this._users.find(f=>f.uid===d);if(!h)return M.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(d)),void i();try{o.forEach(async f=>{let{stream_type:g}=f;const y=g===hr.Audio?pt.AUDIO:pt.VIDEO;await this._p2pChannel.unsubscribe(h,y),this._handleMuteStream(d,y,!0)}),i()}catch(f){s(f)}}}),this._gateway.signal.on(Ui.CONTROL,async(n,i)=>{const{action:s}=n;switch(s){case $g.MUTE_LOCAL_VIDEO:this._handleMuteStream(i,pt.VIDEO,!0);break;case $g.MUTE_LOCAL_AUDIO:this._handleMuteStream(i,pt.AUDIO,!0);break;case $g.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",i),this._handleMuteStream(i,pt.VIDEO,!1);break;case $g.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",i),this._handleMuteStream(i,pt.AUDIO,!1)}}),this._gateway.signal.on(Ui.RESTART_ICE,async(n,i,s)=>{if(this.store.useP2P)try{const{direction:o,iceParameter:d}=n;o!==Fo.SEND_ONLY||d?i(await this._p2pChannel.restartICE(o,d)):(this._p2pChannel.handleDisconnect(o),i())}catch(o){s(o)}}),this._gateway.signal.on(Ui.CANDIDATE,n=>{if(this.store.useP2P){const{candidate:i,direction:s}=n;this._p2pChannel.addRemoteCandidate(i,s)}}),this._p2pChannel.on(Dt.RequestP2PRestartICE,async(n,i,s)=>{try{const{direction:o}=n;i(await this._gateway.sendExtensionMessage(Ui.RESTART_ICE,n,o===Fo.SEND_ONLY))}catch(o){s(o)}}),this._p2pChannel.on(Dt.LocalCandidate,n=>{this._gateway.sendExtensionMessage(Ui.CANDIDATE,JSON.stringify(n),!0)}),this._p2pChannel.on(Dt.RequestP2PMuteLocal,async(n,i,s)=>{try{await this._gateway.sendExtensionMessage(Ui.CONTROL,n,!0),i()}catch(o){s(o)}}),this._p2pChannel.on(Dt.RequestP2PUnmuteRemote,async(n,i,s)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(n,this._joinInfo.stringUid||this._joinInfo.uid),i()}catch(o){o.code===se.DISCONNECT_P2P?i():s(o)}else i()}),this._p2pChannel.on(Dt.RequestP2PMuteRemote,async(n,i,s)=>{if(this._joinInfo)try{await this._gateway.muteRemote(n,this._joinInfo.stringUid||this._joinInfo.uid),i()}catch(o){o.code===se.DISCONNECT_P2P?i():s(o)}else i()}),this._p2pChannel.on(Dt.StateChange,(n,i)=>{i===rr.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Dt.PeerConnectionStateChange,n=>{const i=this._peerConnectionState;n!==i&&(this.safeEmit(gn.PEERCONNECTION_STATE_CHANGE,n,i),this._peerConnectionState=n)}),this._p2pChannel.on(Dt.RequestMuteLocal,async(n,i,s)=>{if(this._joinInfo)try{await this._gateway.muteLocal(n,this._joinInfo.stringUid||this._joinInfo.uid),i()}catch(o){o.code===se.DISCONNECT_P2P?i():s(o)}else i()}),this._p2pChannel.on(Dt.RequestUnmuteLocal,async(n,i,s)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(n,this._joinInfo.stringUid||this._joinInfo.uid),i()}catch(o){o.code===se.DISCONNECT_P2P?i():s(o)}else i()}),this._p2pChannel.on(Dt.RequestRePublish,(n,i,s)=>{this.publish(n,!1).then(i).catch(s)}),this._p2pChannel.on(Dt.RequestRePublishDataChannel,(n,i,s)=>{et.all(n.map(async o=>{const d=await this._p2pChannel.publishDataChannel([o]);try{d.forEach(h=>{this._uid&&this._gateway.publishDataChannel(this._uid,h,!0)})}catch(h){if(h.code!==se.DISCONNECT_P2P)throw h}})).then(i).catch(s)}),this._p2pChannel.on(Dt.RequestReSubscribe,async(n,i,s)=>{try{for(const{user:o,kind:d}of n)d===pt.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");i()}catch(o){s(o)}}),this._p2pChannel.on(Dt.RequestUpload,(n,i)=>{this._gateway.upload(n,i)}),this._p2pChannel.on(Dt.RequestUploadStats,n=>{this._gateway.uploadWRTCStats(n)}),this._p2pChannel.on(Dt.MediaReconnectStart,n=>{this.safeEmit(gn.MEDIA_RECONNECT_START,n)}),this._p2pChannel.on(Dt.MediaReconnectEnd,n=>{this.safeEmit(gn.MEDIA_RECONNECT_END,n)}),this._p2pChannel.on(Dt.NeedSignalRTT,n=>{n(this._gateway.getSignalRTT())}),this._p2pChannel.on(Dt.RequestRestartICE,async n=>{if(this.store.useP2P)return;const i=await this._p2pChannel.restartICE(n),s=await i.next();if(s.done)return;const o=s.value;let d;try{d=await this._gateway.restartICE({iceParameters:o})}catch(f){return void i.throw(f)}const{iceParameters:h}=function(f){const g=f.iceParameters;return{iceParameters:{iceUfrag:g.iceUfrag,icePwd:g.icePwd}}}(d);await i.next({remoteIceParameters:h})}),this._p2pChannel.on(Dt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Dt.RequestReconnectPC,async()=>{var n;const{iceParameters:i,dtlsParameters:s,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(n=this._joinInfo)===null||n===void 0?void 0:n.turnServer}),{gatewayEstablishParams:d,gatewayAddress:h}=await this._gateway.reconnectPC({iceParameters:i,dtlsParameters:s,rtpCapabilities:o}),f=hJ(d,h);await this._p2pChannel.connect(f),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Dt.RequestUnpublishForReconnectPC,async(n,i,s)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(n,this._uid),i()):s()}),this._p2pChannel.on(Dt.P2PLost,()=>{this.safeEmit(gn.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Dt.UpdateVideoEncoder,n=>{n._encoderConfig&&this._gateway.setVideoProfile(n._encoderConfig)}),this._p2pChannel.on(Dt.ConnectionTypeChange,n=>{this.safeEmit(gn.IS_USING_CLOUD_PROXY,n),this._gateway.setUsingProxy(n)}),this._p2pChannel.on(Dt.FirstVideoBufferReady,(n,i)=>{this.safeEmit(gn.FIRST_VIDEO_BUFFER_READY,n,i)}),this._p2pChannel.on(Dt.FirstVideoPreRender,(n,i)=>{this.safeEmit(gn.FIRST_VIDEO_PRE_RENDER,n,i)}),this._p2pChannel.on(Dt.RequestLowStreamParameter,n=>{n(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Dt.QueryClientConnectionState,n=>{n(this.connectionState)}),this._p2pChannel.on(Dt.AudioMetadata,n=>{this.safeEmit(gn.AUDIO_METADATA,n)}),this._p2pChannel.on(Dt.AudioPts,n=>{this.safeEmit(gn.AUDIO_PTS,Number(n))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(n){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Ce(se.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Ce(se.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const s=(i={config:n},Uh("ContentInspect").create(i));this._inspect=s,this.handleVideoInspectEvents(s);const{appId:o,cname:d,sid:h,token:f,uid:g,cid:y,vid:x}=this._joinInfo;await s.init({appId:o,areaCode:"",cname:d,sid:h,token:f,uid:g,cid:y,vid:x?Number(x):0},Gi)}catch(s){throw Array.isArray(s)?s[0]:s}var i}handleVideoInspectEvents(n){n.on($s.CONNECTION_STATE_CHANGE,(i,s)=>{if(this.safeEmit(gn.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,i,s),s===Mu.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(gn.CONTENT_INSPECT_ERROR,new Ce(se.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));n.inspectImage()}}),n.on($s.INSPECT_RESULT,(i,s)=>{var o;if((s==null?void 0:s.code)===se.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return M.debug("Stop inspect content because that has left channel"),this==null||(o=this._inspect)===null||o===void 0||o.close(),void(this._inspect=void 0);this.safeEmit(gn.CONTENT_INSPECT_RESULT,i,s)}),n.on($s.CLIENT_LOCAL_VIDEO_TRACK,i=>{i(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Ce(se.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(n){throw Array.isArray(n)?n[0]:n}}async setImageModeration(n,i){if(Pu(n,"enabled"),n){if(!i)throw new Ce(se.INVALID_PARAMS,"config is required");if(RQ(i),!this._joinInfo)throw new Ce(se.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(i);else{const o=(s={config:i},Uh("ImageModeration").create(s));this._moderation=o,this.handleImageModerationEvents(o);const{appId:d,cname:h,sid:f,token:g,uid:y,cid:x,vid:b}=this._joinInfo;await o.init({appId:d,areaCode:"",cname:h,sid:f,token:g,uid:y,cid:x,vid:b?Number(b):0},Gi)}}catch(o){throw Array.isArray(o)?o[0]:o}}else{var s;if(!this._moderation)throw new Ce(se.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(o){throw Array.isArray(o)?o[0]:o}}}handleImageModerationEvents(n){n.on(Mh.CONNECTION_STATE_CHANGE,(i,s)=>{if(this.safeEmit(gn.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,i,s),i===Md.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Ce(se.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");n.inspectImage()}}),n.on(Mh.CLIENT_LOCAL_VIDEO_TRACK,i=>{i(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}setP2PTransport(n){if(function(i){zi(i,"transport",["default","auto","relay","sd-rtn"])}(n),this.mode!=="p2p")throw new Ce(se.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=n,M.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(n))}getJoinChannelServiceRecords(){return M.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(n){Pu(n,"enabled"),xr("ENABLE_PUBLISH_AUDIO_FILTER",n),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(n)}_setRteInfo(n,i){this.store.rteUrl=n,this.store.rteSid=i}_isPreRender(){return"isPreRender"in this._p2pChannel&&this._p2pChannel.isPreRender()}_handleResetAddStream(n,i){switch(i){case"audio":n._audio_added_=!1,n._trust_audio_stream_added_state_=!0;break;case"video":n._video_added_=!1,n._trust_video_stream_added_state_=!0}}},it(ht.prototype,"leave",[CQ],Object.getOwnPropertyDescriptor(ht.prototype,"leave"),ht.prototype),it(ht.prototype,"publish",[NQ],Object.getOwnPropertyDescriptor(ht.prototype,"publish"),ht.prototype),it(ht.prototype,"unpublish",[IQ],Object.getOwnPropertyDescriptor(ht.prototype,"unpublish"),ht.prototype),it(ht.prototype,"subscribe",[AQ],Object.getOwnPropertyDescriptor(ht.prototype,"subscribe"),ht.prototype),it(ht.prototype,"presubscribe",[kQ],Object.getOwnPropertyDescriptor(ht.prototype,"presubscribe"),ht.prototype),it(ht.prototype,"massSubscribe",[PQ],Object.getOwnPropertyDescriptor(ht.prototype,"massSubscribe"),ht.prototype),it(ht.prototype,"unsubscribe",[DQ],Object.getOwnPropertyDescriptor(ht.prototype,"unsubscribe"),ht.prototype),it(ht.prototype,"massUnsubscribe",[OQ],Object.getOwnPropertyDescriptor(ht.prototype,"massUnsubscribe"),ht.prototype),it(ht.prototype,"setLowStreamParameter",[LQ],Object.getOwnPropertyDescriptor(ht.prototype,"setLowStreamParameter"),ht.prototype),it(ht.prototype,"setDualStreamMode",[jQ],Object.getOwnPropertyDescriptor(ht.prototype,"setDualStreamMode"),ht.prototype),it(ht.prototype,"enableDualStream",[MQ],Object.getOwnPropertyDescriptor(ht.prototype,"enableDualStream"),ht.prototype),it(ht.prototype,"disableDualStream",[UQ],Object.getOwnPropertyDescriptor(ht.prototype,"disableDualStream"),ht.prototype),it(ht.prototype,"setClientRole",[VQ],Object.getOwnPropertyDescriptor(ht.prototype,"setClientRole"),ht.prototype),it(ht.prototype,"_setClientRoleOptions",[FQ],Object.getOwnPropertyDescriptor(ht.prototype,"_setClientRoleOptions"),ht.prototype),it(ht.prototype,"setProxyServer",[BQ],Object.getOwnPropertyDescriptor(ht.prototype,"setProxyServer"),ht.prototype),it(ht.prototype,"setTurnServer",[zQ],Object.getOwnPropertyDescriptor(ht.prototype,"setTurnServer"),ht.prototype),it(ht.prototype,"setLicense",[GQ],Object.getOwnPropertyDescriptor(ht.prototype,"setLicense"),ht.prototype),it(ht.prototype,"startProxyServer",[WQ],Object.getOwnPropertyDescriptor(ht.prototype,"startProxyServer"),ht.prototype),it(ht.prototype,"stopProxyServer",[HQ],Object.getOwnPropertyDescriptor(ht.prototype,"stopProxyServer"),ht.prototype),it(ht.prototype,"setLocalAccessPointsV2",[KQ],Object.getOwnPropertyDescriptor(ht.prototype,"setLocalAccessPointsV2"),ht.prototype),it(ht.prototype,"setLocalAccessPoints",[qQ],Object.getOwnPropertyDescriptor(ht.prototype,"setLocalAccessPoints"),ht.prototype),it(ht.prototype,"setRemoteDefaultVideoStreamType",[YQ],Object.getOwnPropertyDescriptor(ht.prototype,"setRemoteDefaultVideoStreamType"),ht.prototype),it(ht.prototype,"setRemoteVideoStreamType",[$Q],Object.getOwnPropertyDescriptor(ht.prototype,"setRemoteVideoStreamType"),ht.prototype),it(ht.prototype,"setStreamFallbackOption",[XQ],Object.getOwnPropertyDescriptor(ht.prototype,"setStreamFallbackOption"),ht.prototype),it(ht.prototype,"setEncryptionConfig",[JQ],Object.getOwnPropertyDescriptor(ht.prototype,"setEncryptionConfig"),ht.prototype),it(ht.prototype,"renewToken",[QQ],Object.getOwnPropertyDescriptor(ht.prototype,"renewToken"),ht.prototype),it(ht.prototype,"enableAudioVolumeIndicator",[ZQ],Object.getOwnPropertyDescriptor(ht.prototype,"enableAudioVolumeIndicator"),ht.prototype),it(ht.prototype,"startLiveStreaming",[eZ],Object.getOwnPropertyDescriptor(ht.prototype,"startLiveStreaming"),ht.prototype),it(ht.prototype,"setLiveTranscoding",[tZ],Object.getOwnPropertyDescriptor(ht.prototype,"setLiveTranscoding"),ht.prototype),it(ht.prototype,"stopLiveStreaming",[nZ],Object.getOwnPropertyDescriptor(ht.prototype,"stopLiveStreaming"),ht.prototype),it(ht.prototype,"startChannelMediaRelay",[rZ],Object.getOwnPropertyDescriptor(ht.prototype,"startChannelMediaRelay"),ht.prototype),it(ht.prototype,"updateChannelMediaRelay",[iZ],Object.getOwnPropertyDescriptor(ht.prototype,"updateChannelMediaRelay"),ht.prototype),it(ht.prototype,"stopChannelMediaRelay",[sZ],Object.getOwnPropertyDescriptor(ht.prototype,"stopChannelMediaRelay"),ht.prototype),it(ht.prototype,"sendCustomReportMessage",[aZ],Object.getOwnPropertyDescriptor(ht.prototype,"sendCustomReportMessage"),ht.prototype),it(ht.prototype,"pickSVCLayer",[oZ],Object.getOwnPropertyDescriptor(ht.prototype,"pickSVCLayer"),ht.prototype),it(ht.prototype,"setRTMConfig",[cZ],Object.getOwnPropertyDescriptor(ht.prototype,"setRTMConfig"),ht.prototype),it(ht.prototype,"enableContentInspect",[lZ],Object.getOwnPropertyDescriptor(ht.prototype,"enableContentInspect"),ht.prototype),it(ht.prototype,"disableContentInspect",[dZ],Object.getOwnPropertyDescriptor(ht.prototype,"disableContentInspect"),ht.prototype),it(ht.prototype,"setImageModeration",[uZ],Object.getOwnPropertyDescriptor(ht.prototype,"setImageModeration"),ht.prototype),it(ht.prototype,"setP2PTransport",[hZ],Object.getOwnPropertyDescriptor(ht.prototype,"setP2PTransport"),ht.prototype),it(ht.prototype,"getJoinChannelServiceRecords",[pZ],Object.getOwnPropertyDescriptor(ht.prototype,"getJoinChannelServiceRecords"),ht.prototype),it(ht.prototype,"setPublishAudioFilterEnabled",[fZ],Object.getOwnPropertyDescriptor(ht.prototype,"setPublishAudioFilterEnabled"),ht.prototype),ht);function gZ(){var n;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const s=dr(5,"client-"),o=_t.reportApiInvoke(null,{id:s,name:Qr.CREATE_CLIENT,options:[i],tag:Tr.TRACER});try{(function(d){zi(d.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),zi(d.mode,"config.mode",["rtc","live","p2p"]),d.audioCodec!==void 0&&zi(d.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),d.proxyServer!==void 0&&la(d.proxyServer,"config.proxyServer",1,1e4),d.turnServer!==void 0&&Yq(d.turnServer),d.httpRetryConfig!==void 0&&qq(d.httpRetryConfig),d.websocketRetryConfig!==void 0&&qq(d.websocketRetryConfig)})(i)}catch(d){throw o.onError(d),d}return(Oq(16,0,!0)||jV(16,0,!0))&&(i.codec==="vp9"&&(i.codec="vp8",M.debug("browser not support vp9, force use vp8")),xr("UNSUPPORTED_VIDEO_CODEC",["vp9"])),i.audioCodec===void 0&&(i.audioCodec="opus"),o.onSuccess(),new Nwe(zu(zu({forceWaitGatewayResponse:!0},i),{},{role:Ge(n=["rtc","p2p"]).call(n,i.mode)?"host":i.role||"audience"}),s)}function Iwe(){let n=!1;const i=Wn();return(i.name===$n.CHROME&&Number(i.version)>=58&&(kh.engine.name!=="WebKit"||function(){const s=Wn();if(Lk()){if(s.os===Is.MAC_OS)return!0;if(s.os===Is.IOS){const o=kh.os.version&&kh.os.version.split(".");if(o&&Number(o[0])===14&&o[1]&&Number(o[1])>=3||o&&Number(o[0])>14)return!0}}return!1}())||i.name===$n.FIREFOX&&Number(i.version)>=56||i.name===$n.OPERA&&Number(i.version)>=45||i.name===$n.SAFARI&&Number(i.version)>=11||i.name==="WebKit"&&($a()||ku())&&i.osVersion&&Number(i.osVersion.split(".")[0])>=11||Mq()||Wn().name===$n.QQ)&&(n=!0),n}class bR{constructor(i,s){Y(this,"id",0),Y(this,"element",void 0),Y(this,"peerPair",void 0),Y(this,"context",void 0),Y(this,"audioPlayerElement",void 0),Y(this,"audioTrack",void 0),bR.count+=1,this.id=bR.count,this.element=i,this.context=s}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=i=>{const s=document.createElement("audio");s.srcObject=new MediaStream([i.track]),s.play(),this.audioPlayerElement=s}}async switchSdp(){if(!this.peerPair)return;const i=async(o,d)=>{const h=d==="offer"?await o.createOffer():await o.createAnswer();return await o.setLocalDescription(h),o.iceGatheringState==="complete"?o.localDescription:new et(f=>{o.onicegatheringstatechange=()=>{o.iceGatheringState==="complete"&&f(o.localDescription)}})},s=async(o,d)=>await o.setRemoteDescription(d);try{const o=await i(this.peerPair[0],"offer");await s(this.peerPair[1],o);const d=await i(this.peerPair[1],"answer");await s(this.peerPair[0],d)}catch(o){throw new Ce(se.LOCAL_AEC_ERROR,o.toString()).print()}}async getTracksFromMediaElement(i){if(this.audioTrack)return this.audioTrack;let s;try{i instanceof HTMLVideoElement&&(i.captureStream?i.captureStream():i.mozCaptureStream()),s=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(i).connect(s)}catch(d){throw new Ce(se.LOCAL_AEC_ERROR,d.toString()).print()}if(!s)throw new Ce(se.LOCAL_AEC_ERROR,"no dest node when local aec").print();const o=s.stream.getAudioTracks()[0];return this.audioTrack=o,o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const i=this.element,s=await this.getTracksFromMediaElement(i);this.peerPair&&this.peerPair[0].addTrack(s),await this.switchSdp()}close(){M.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(i=>{i.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var _Z,VP;Y(bR,"count",0);const Awe=window.AudioContext||window.webkitAudioContext,kwe=new(_Z=Vt({report:_t}),it((VP=class{constructor(){Y(this,"units",[]),Y(this,"context",void 0)}processExternalMediaAEC(n){if(!this._doesEnvironmentNeedAEC())return M.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Awe);let i=this.units.find(s=>s&&s.getElement()===n);return i||(i=new bR(n,this.context),this.units.push(i)),i.startEchoCancellation(),M.debug("start processing local audio echo cancellation, id is",i.id),i.id}_doesEnvironmentNeedAEC(){return Wn().name!==$n.SAFARI}}).prototype,"processExternalMediaAEC",[_Z],Object.getOwnPropertyDescriptor(VP.prototype,"processExternalMediaAEC"),VP.prototype),VP);function yZ(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function vZ(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?yZ(Object(s),!0).forEach(function(o){Y(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):yZ(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}const I3=window||document;function EZ(n){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!I3)return;const s=is._cspEventHandlerPointer;if(s&&i)return void console.error(s,i);const o=d=>{if(!(d&&d.blockedURI&&(is.onSecurityPolicyViolation||is.getListeners(tf.SECURITY_POLICY_VIOLATION).length>0)))return;const h=d.blockedURI;re("CSP_DETECTED_HOSTNAME_LIST").some(f=>Ge(h).call(h,f))&&(is.onSecurityPolicyViolation&&typeof is.onSecurityPolicyViolation=="function"&&is.onSecurityPolicyViolation(d),is.getListeners(tf.SECURITY_POLICY_VIOLATION).length>0&&is.safeEmit(tf.SECURITY_POLICY_VIOLATION,d))};s&&I3.removeEventListener("securitypolicyviolation",s),(i||n&&typeof n=="function"||is.getListeners(tf.SECURITY_POLICY_VIOLATION).length>0)&&I3.addEventListener("securitypolicyviolation",o),is._cspEventHandlerPointer=o}var Pwe=A,Dwe=zU,xZ=RegExp.prototype,Owe=function(n){return n===xZ||Pwe(xZ,n)?Dwe(n):n.flags},po=l(Owe);function Kx(n){let i=n.length;for(;--i>=0;)n[i]=0}const A3=256,bZ=286,wR=30,SR=15,k3=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),FP=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Lwe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),wZ=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),gm=new Array(576);Kx(gm);const TR=new Array(60);Kx(TR);const RR=new Array(512);Kx(RR);const CR=new Array(256);Kx(CR);const P3=new Array(29);Kx(P3);const BP=new Array(wR);function D3(n,i,s,o,d){this.static_tree=n,this.extra_bits=i,this.extra_base=s,this.elems=o,this.max_length=d,this.has_stree=n&&n.length}let SZ,TZ,RZ;function O3(n,i){this.dyn_tree=n,this.max_code=0,this.stat_desc=i}Kx(BP);const CZ=n=>n<256?RR[n]:RR[256+(n>>>7)],NR=(n,i)=>{n.pending_buf[n.pending++]=255&i,n.pending_buf[n.pending++]=i>>>8&255},td=(n,i,s)=>{n.bi_valid>16-s?(n.bi_buf|=i<<n.bi_valid&65535,NR(n,n.bi_buf),n.bi_buf=i>>16-n.bi_valid,n.bi_valid+=s-16):(n.bi_buf|=i<<n.bi_valid&65535,n.bi_valid+=s)},cf=(n,i,s)=>{td(n,s[2*i],s[2*i+1])},NZ=(n,i)=>{let s=0;do s|=1&n,n>>>=1,s<<=1;while(--i>0);return s>>>1},IZ=(n,i,s)=>{const o=new Array(16);let d,h,f=0;for(d=1;d<=SR;d++)f=f+s[d-1]<<1,o[d]=f;for(h=0;h<=i;h++){let g=n[2*h+1];g!==0&&(n[2*h]=NZ(o[g]++,g))}},AZ=n=>{let i;for(i=0;i<bZ;i++)n.dyn_ltree[2*i]=0;for(i=0;i<wR;i++)n.dyn_dtree[2*i]=0;for(i=0;i<19;i++)n.bl_tree[2*i]=0;n.dyn_ltree[512]=1,n.opt_len=n.static_len=0,n.sym_next=n.matches=0},kZ=n=>{n.bi_valid>8?NR(n,n.bi_buf):n.bi_valid>0&&(n.pending_buf[n.pending++]=n.bi_buf),n.bi_buf=0,n.bi_valid=0},PZ=(n,i,s,o)=>{const d=2*i,h=2*s;return n[d]<n[h]||n[d]===n[h]&&o[i]<=o[s]},L3=(n,i,s)=>{const o=n.heap[s];let d=s<<1;for(;d<=n.heap_len&&(d<n.heap_len&&PZ(i,n.heap[d+1],n.heap[d],n.depth)&&d++,!PZ(i,o,n.heap[d],n.depth));)n.heap[s]=n.heap[d],s=d,d<<=1;n.heap[s]=o},DZ=(n,i,s)=>{let o,d,h,f,g=0;if(n.sym_next!==0)do o=255&n.pending_buf[n.sym_buf+g++],o+=(255&n.pending_buf[n.sym_buf+g++])<<8,d=n.pending_buf[n.sym_buf+g++],o===0?cf(n,d,i):(h=CR[d],cf(n,h+A3+1,i),f=k3[h],f!==0&&(d-=P3[h],td(n,d,f)),o--,h=CZ(o),cf(n,h,s),f=FP[h],f!==0&&(o-=BP[h],td(n,o,f)));while(g<n.sym_next);cf(n,256,i)},j3=(n,i)=>{const s=i.dyn_tree,o=i.stat_desc.static_tree,d=i.stat_desc.has_stree,h=i.stat_desc.elems;let f,g,y,x=-1;for(n.heap_len=0,n.heap_max=573,f=0;f<h;f++)s[2*f]!==0?(n.heap[++n.heap_len]=x=f,n.depth[f]=0):s[2*f+1]=0;for(;n.heap_len<2;)y=n.heap[++n.heap_len]=x<2?++x:0,s[2*y]=1,n.depth[y]=0,n.opt_len--,d&&(n.static_len-=o[2*y+1]);for(i.max_code=x,f=n.heap_len>>1;f>=1;f--)L3(n,s,f);y=h;do f=n.heap[1],n.heap[1]=n.heap[n.heap_len--],L3(n,s,1),g=n.heap[1],n.heap[--n.heap_max]=f,n.heap[--n.heap_max]=g,s[2*y]=s[2*f]+s[2*g],n.depth[y]=(n.depth[f]>=n.depth[g]?n.depth[f]:n.depth[g])+1,s[2*f+1]=s[2*g+1]=y,n.heap[1]=y++,L3(n,s,1);while(n.heap_len>=2);n.heap[--n.heap_max]=n.heap[1],((b,N)=>{const I=N.dyn_tree,D=N.max_code,$=N.stat_desc.static_tree,z=N.stat_desc.has_stree,K=N.stat_desc.extra_bits,ie=N.stat_desc.extra_base,oe=N.stat_desc.max_length;let fe,Ee,Te,_e,Re,je,Be=0;for(_e=0;_e<=SR;_e++)b.bl_count[_e]=0;for(I[2*b.heap[b.heap_max]+1]=0,fe=b.heap_max+1;fe<573;fe++)Ee=b.heap[fe],_e=I[2*I[2*Ee+1]+1]+1,_e>oe&&(_e=oe,Be++),I[2*Ee+1]=_e,Ee>D||(b.bl_count[_e]++,Re=0,Ee>=ie&&(Re=K[Ee-ie]),je=I[2*Ee],b.opt_len+=je*(_e+Re),z&&(b.static_len+=je*($[2*Ee+1]+Re)));if(Be!==0){do{for(_e=oe-1;b.bl_count[_e]===0;)_e--;b.bl_count[_e]--,b.bl_count[_e+1]+=2,b.bl_count[oe]--,Be-=2}while(Be>0);for(_e=oe;_e!==0;_e--)for(Ee=b.bl_count[_e];Ee!==0;)Te=b.heap[--fe],Te>D||(I[2*Te+1]!==_e&&(b.opt_len+=(_e-I[2*Te+1])*I[2*Te],I[2*Te+1]=_e),Ee--)}})(n,i),IZ(s,x,n.bl_count)},OZ=(n,i,s)=>{let o,d,h=-1,f=i[1],g=0,y=7,x=4;for(f===0&&(y=138,x=3),i[2*(s+1)+1]=65535,o=0;o<=s;o++)d=f,f=i[2*(o+1)+1],++g<y&&d===f||(g<x?n.bl_tree[2*d]+=g:d!==0?(d!==h&&n.bl_tree[2*d]++,n.bl_tree[32]++):g<=10?n.bl_tree[34]++:n.bl_tree[36]++,g=0,h=d,f===0?(y=138,x=3):d===f?(y=6,x=3):(y=7,x=4))},LZ=(n,i,s)=>{let o,d,h=-1,f=i[1],g=0,y=7,x=4;for(f===0&&(y=138,x=3),o=0;o<=s;o++)if(d=f,f=i[2*(o+1)+1],!(++g<y&&d===f)){if(g<x)do cf(n,d,n.bl_tree);while(--g!=0);else d!==0?(d!==h&&(cf(n,d,n.bl_tree),g--),cf(n,16,n.bl_tree),td(n,g-3,2)):g<=10?(cf(n,17,n.bl_tree),td(n,g-3,3)):(cf(n,18,n.bl_tree),td(n,g-11,7));g=0,h=d,f===0?(y=138,x=3):d===f?(y=6,x=3):(y=7,x=4)}};let jZ=!1;const MZ=(n,i,s,o)=>{td(n,0+(o?1:0),3),kZ(n),NR(n,s),NR(n,~s),s&&n.pending_buf.set(n.window.subarray(i,i+s),n.pending),n.pending+=s};var jwe=n=>{jZ||((()=>{let i,s,o,d,h;const f=new Array(16);for(o=0,d=0;d<28;d++)for(P3[d]=o,i=0;i<1<<k3[d];i++)CR[o++]=d;for(CR[o-1]=d,h=0,d=0;d<16;d++)for(BP[d]=h,i=0;i<1<<FP[d];i++)RR[h++]=d;for(h>>=7;d<wR;d++)for(BP[d]=h<<7,i=0;i<1<<FP[d]-7;i++)RR[256+h++]=d;for(s=0;s<=SR;s++)f[s]=0;for(i=0;i<=143;)gm[2*i+1]=8,i++,f[8]++;for(;i<=255;)gm[2*i+1]=9,i++,f[9]++;for(;i<=279;)gm[2*i+1]=7,i++,f[7]++;for(;i<=287;)gm[2*i+1]=8,i++,f[8]++;for(IZ(gm,287,f),i=0;i<wR;i++)TR[2*i+1]=5,TR[2*i]=NZ(i,5);SZ=new D3(gm,k3,257,bZ,SR),TZ=new D3(TR,FP,0,wR,SR),RZ=new D3(new Array(0),Lwe,0,19,7)})(),jZ=!0),n.l_desc=new O3(n.dyn_ltree,SZ),n.d_desc=new O3(n.dyn_dtree,TZ),n.bl_desc=new O3(n.bl_tree,RZ),n.bi_buf=0,n.bi_valid=0,AZ(n)},Mwe=(n,i,s,o)=>{let d,h,f=0;n.level>0?(n.strm.data_type===2&&(n.strm.data_type=(g=>{let y,x=4093624447;for(y=0;y<=31;y++,x>>>=1)if(1&x&&g.dyn_ltree[2*y]!==0)return 0;if(g.dyn_ltree[18]!==0||g.dyn_ltree[20]!==0||g.dyn_ltree[26]!==0)return 1;for(y=32;y<A3;y++)if(g.dyn_ltree[2*y]!==0)return 1;return 0})(n)),j3(n,n.l_desc),j3(n,n.d_desc),f=(g=>{let y;for(OZ(g,g.dyn_ltree,g.l_desc.max_code),OZ(g,g.dyn_dtree,g.d_desc.max_code),j3(g,g.bl_desc),y=18;y>=3&&g.bl_tree[2*wZ[y]+1]===0;y--);return g.opt_len+=3*(y+1)+5+5+4,y})(n),d=n.opt_len+3+7>>>3,h=n.static_len+3+7>>>3,h<=d&&(d=h)):d=h=s+5,s+4<=d&&i!==-1?MZ(n,i,s,o):n.strategy===4||h===d?(td(n,2+(o?1:0),3),DZ(n,gm,TR)):(td(n,4+(o?1:0),3),((g,y,x,b)=>{let N;for(td(g,y-257,5),td(g,x-1,5),td(g,b-4,4),N=0;N<b;N++)td(g,g.bl_tree[2*wZ[N]+1],3);LZ(g,g.dyn_ltree,y-1),LZ(g,g.dyn_dtree,x-1)})(n,n.l_desc.max_code+1,n.d_desc.max_code+1,f+1),DZ(n,n.dyn_ltree,n.dyn_dtree)),AZ(n),o&&kZ(n)},Uwe=(n,i,s)=>(n.pending_buf[n.sym_buf+n.sym_next++]=i,n.pending_buf[n.sym_buf+n.sym_next++]=i>>8,n.pending_buf[n.sym_buf+n.sym_next++]=s,i===0?n.dyn_ltree[2*s]++:(n.matches++,i--,n.dyn_ltree[2*(CR[s]+A3+1)]++,n.dyn_dtree[2*CZ(i)]++),n.sym_next===n.sym_end),Vwe=n=>{td(n,2,3),cf(n,256,gm),(i=>{i.bi_valid===16?(NR(i,i.bi_buf),i.bi_buf=0,i.bi_valid=0):i.bi_valid>=8&&(i.pending_buf[i.pending++]=255&i.bi_buf,i.bi_buf>>=8,i.bi_valid-=8)})(n)},Fwe={_tr_init:jwe,_tr_stored_block:MZ,_tr_flush_block:Mwe,_tr_tally:Uwe,_tr_align:Vwe},IR=(n,i,s,o)=>{let d=65535&n|0,h=n>>>16&65535|0,f=0;for(;s!==0;){f=s>2e3?2e3:s,s-=f;do d=d+i[o++]|0,h=h+d|0;while(--f);d%=65521,h%=65521}return d|h<<16|0};const Bwe=new Uint32Array((()=>{let n,i=[];for(var s=0;s<256;s++){n=s;for(var o=0;o<8;o++)n=1&n?3988292384^n>>>1:n>>>1;i[s]=n}return i})());var Bo=(n,i,s,o)=>{const d=Bwe,h=o+s;n^=-1;for(let f=o;f<h;f++)n=n>>>8^d[255&(n^i[f])];return-1^n},Dy={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},zP={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:zwe,_tr_stored_block:M3,_tr_flush_block:Gwe,_tr_tally:n_,_tr_align:Wwe}=Fwe,{Z_NO_FLUSH:r_,Z_PARTIAL_FLUSH:Hwe,Z_FULL_FLUSH:Kwe,Z_FINISH:Gu,Z_BLOCK:UZ,Z_OK:xc,Z_STREAM_END:VZ,Z_STREAM_ERROR:lf,Z_DATA_ERROR:qwe,Z_BUF_ERROR:U3,Z_DEFAULT_COMPRESSION:Ywe,Z_FILTERED:$we,Z_HUFFMAN_ONLY:GP,Z_RLE:Xwe,Z_FIXED:Jwe,Z_DEFAULT_STRATEGY:Qwe,Z_UNKNOWN:Zwe,Z_DEFLATED:WP}=zP,V3=286,eSe=30,tSe=19,nSe=2*V3+1,rSe=15,Oy=258,df=262,qx=42,Ly=113,AR=666,jy=(n,i)=>(n.msg=Dy[i],i),FZ=n=>2*n-(n>4?9:0),i_=n=>{let i=n.length;for(;--i>=0;)n[i]=0},iSe=n=>{let i,s,o,d=n.w_size;i=n.hash_size,o=i;do s=n.head[--o],n.head[o]=s>=d?s-d:0;while(--i);i=d,o=i;do s=n.prev[--o],n.prev[o]=s>=d?s-d:0;while(--i)};let s_=(n,i,s)=>(i<<n.hash_shift^s)&n.hash_mask;const Ud=n=>{const i=n.state;let s=i.pending;s>n.avail_out&&(s=n.avail_out),s!==0&&(n.output.set(i.pending_buf.subarray(i.pending_out,i.pending_out+s),n.next_out),n.next_out+=s,i.pending_out+=s,n.total_out+=s,n.avail_out-=s,i.pending-=s,i.pending===0&&(i.pending_out=0))},Vd=(n,i)=>{Gwe(n,n.block_start>=0?n.block_start:-1,n.strstart-n.block_start,i),n.block_start=n.strstart,Ud(n.strm)},ji=(n,i)=>{n.pending_buf[n.pending++]=i},kR=(n,i)=>{n.pending_buf[n.pending++]=i>>>8&255,n.pending_buf[n.pending++]=255&i},F3=(n,i,s,o)=>{let d=n.avail_in;return d>o&&(d=o),d===0?0:(n.avail_in-=d,i.set(n.input.subarray(n.next_in,n.next_in+d),s),n.state.wrap===1?n.adler=IR(n.adler,i,d,s):n.state.wrap===2&&(n.adler=Bo(n.adler,i,d,s)),n.next_in+=d,n.total_in+=d,d)},BZ=(n,i)=>{let s,o,d=n.max_chain_length,h=n.strstart,f=n.prev_length,g=n.nice_match;const y=n.strstart>n.w_size-df?n.strstart-(n.w_size-df):0,x=n.window,b=n.w_mask,N=n.prev,I=n.strstart+Oy;let D=x[h+f-1],$=x[h+f];n.prev_length>=n.good_match&&(d>>=2),g>n.lookahead&&(g=n.lookahead);do if(s=i,x[s+f]===$&&x[s+f-1]===D&&x[s]===x[h]&&x[++s]===x[h+1]){h+=2,s++;do;while(x[++h]===x[++s]&&x[++h]===x[++s]&&x[++h]===x[++s]&&x[++h]===x[++s]&&x[++h]===x[++s]&&x[++h]===x[++s]&&x[++h]===x[++s]&&x[++h]===x[++s]&&h<I);if(o=Oy-(I-h),h=I-Oy,o>f){if(n.match_start=i,f=o,o>=g)break;D=x[h+f-1],$=x[h+f]}}while((i=N[i&b])>y&&--d!=0);return f<=n.lookahead?f:n.lookahead},Yx=n=>{const i=n.w_size;let s,o,d;do{if(o=n.window_size-n.lookahead-n.strstart,n.strstart>=i+(i-df)&&(n.window.set(n.window.subarray(i,i+i-o),0),n.match_start-=i,n.strstart-=i,n.block_start-=i,n.insert>n.strstart&&(n.insert=n.strstart),iSe(n),o+=i),n.strm.avail_in===0)break;if(s=F3(n.strm,n.window,n.strstart+n.lookahead,o),n.lookahead+=s,n.lookahead+n.insert>=3)for(d=n.strstart-n.insert,n.ins_h=n.window[d],n.ins_h=s_(n,n.ins_h,n.window[d+1]);n.insert&&(n.ins_h=s_(n,n.ins_h,n.window[d+3-1]),n.prev[d&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=d,d++,n.insert--,!(n.lookahead+n.insert<3)););}while(n.lookahead<df&&n.strm.avail_in!==0)},zZ=(n,i)=>{let s,o,d,h=n.pending_buf_size-5>n.w_size?n.w_size:n.pending_buf_size-5,f=0,g=n.strm.avail_in;do{if(s=65535,d=n.bi_valid+42>>3,n.strm.avail_out<d||(d=n.strm.avail_out-d,o=n.strstart-n.block_start,s>o+n.strm.avail_in&&(s=o+n.strm.avail_in),s>d&&(s=d),s<h&&(s===0&&i!==Gu||i===r_||s!==o+n.strm.avail_in)))break;f=i===Gu&&s===o+n.strm.avail_in?1:0,M3(n,0,0,f),n.pending_buf[n.pending-4]=s,n.pending_buf[n.pending-3]=s>>8,n.pending_buf[n.pending-2]=~s,n.pending_buf[n.pending-1]=~s>>8,Ud(n.strm),o&&(o>s&&(o=s),n.strm.output.set(n.window.subarray(n.block_start,n.block_start+o),n.strm.next_out),n.strm.next_out+=o,n.strm.avail_out-=o,n.strm.total_out+=o,n.block_start+=o,s-=o),s&&(F3(n.strm,n.strm.output,n.strm.next_out,s),n.strm.next_out+=s,n.strm.avail_out-=s,n.strm.total_out+=s)}while(f===0);return g-=n.strm.avail_in,g&&(g>=n.w_size?(n.matches=2,n.window.set(n.strm.input.subarray(n.strm.next_in-n.w_size,n.strm.next_in),0),n.strstart=n.w_size,n.insert=n.strstart):(n.window_size-n.strstart<=g&&(n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,n.insert>n.strstart&&(n.insert=n.strstart)),n.window.set(n.strm.input.subarray(n.strm.next_in-g,n.strm.next_in),n.strstart),n.strstart+=g,n.insert+=g>n.w_size-n.insert?n.w_size-n.insert:g),n.block_start=n.strstart),n.high_water<n.strstart&&(n.high_water=n.strstart),f?4:i!==r_&&i!==Gu&&n.strm.avail_in===0&&n.strstart===n.block_start?2:(d=n.window_size-n.strstart,n.strm.avail_in>d&&n.block_start>=n.w_size&&(n.block_start-=n.w_size,n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,d+=n.w_size,n.insert>n.strstart&&(n.insert=n.strstart)),d>n.strm.avail_in&&(d=n.strm.avail_in),d&&(F3(n.strm,n.window,n.strstart,d),n.strstart+=d,n.insert+=d>n.w_size-n.insert?n.w_size-n.insert:d),n.high_water<n.strstart&&(n.high_water=n.strstart),d=n.bi_valid+42>>3,d=n.pending_buf_size-d>65535?65535:n.pending_buf_size-d,h=d>n.w_size?n.w_size:d,o=n.strstart-n.block_start,(o>=h||(o||i===Gu)&&i!==r_&&n.strm.avail_in===0&&o<=d)&&(s=o>d?d:o,f=i===Gu&&n.strm.avail_in===0&&s===o?1:0,M3(n,n.block_start,s,f),n.block_start+=s,Ud(n.strm)),f?3:1)},B3=(n,i)=>{let s,o;for(;;){if(n.lookahead<df){if(Yx(n),n.lookahead<df&&i===r_)return 1;if(n.lookahead===0)break}if(s=0,n.lookahead>=3&&(n.ins_h=s_(n,n.ins_h,n.window[n.strstart+3-1]),s=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),s!==0&&n.strstart-s<=n.w_size-df&&(n.match_length=BZ(n,s)),n.match_length>=3)if(o=n_(n,n.strstart-n.match_start,n.match_length-3),n.lookahead-=n.match_length,n.match_length<=n.max_lazy_match&&n.lookahead>=3){n.match_length--;do n.strstart++,n.ins_h=s_(n,n.ins_h,n.window[n.strstart+3-1]),s=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart;while(--n.match_length!=0);n.strstart++}else n.strstart+=n.match_length,n.match_length=0,n.ins_h=n.window[n.strstart],n.ins_h=s_(n,n.ins_h,n.window[n.strstart+1]);else o=n_(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++;if(o&&(Vd(n,!1),n.strm.avail_out===0))return 1}return n.insert=n.strstart<2?n.strstart:2,i===Gu?(Vd(n,!0),n.strm.avail_out===0?3:4):n.sym_next&&(Vd(n,!1),n.strm.avail_out===0)?1:2},$x=(n,i)=>{let s,o,d;for(;;){if(n.lookahead<df){if(Yx(n),n.lookahead<df&&i===r_)return 1;if(n.lookahead===0)break}if(s=0,n.lookahead>=3&&(n.ins_h=s_(n,n.ins_h,n.window[n.strstart+3-1]),s=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),n.prev_length=n.match_length,n.prev_match=n.match_start,n.match_length=2,s!==0&&n.prev_length<n.max_lazy_match&&n.strstart-s<=n.w_size-df&&(n.match_length=BZ(n,s),n.match_length<=5&&(n.strategy===$we||n.match_length===3&&n.strstart-n.match_start>4096)&&(n.match_length=2)),n.prev_length>=3&&n.match_length<=n.prev_length){d=n.strstart+n.lookahead-3,o=n_(n,n.strstart-1-n.prev_match,n.prev_length-3),n.lookahead-=n.prev_length-1,n.prev_length-=2;do++n.strstart<=d&&(n.ins_h=s_(n,n.ins_h,n.window[n.strstart+3-1]),s=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart);while(--n.prev_length!=0);if(n.match_available=0,n.match_length=2,n.strstart++,o&&(Vd(n,!1),n.strm.avail_out===0))return 1}else if(n.match_available){if(o=n_(n,0,n.window[n.strstart-1]),o&&Vd(n,!1),n.strstart++,n.lookahead--,n.strm.avail_out===0)return 1}else n.match_available=1,n.strstart++,n.lookahead--}return n.match_available&&(o=n_(n,0,n.window[n.strstart-1]),n.match_available=0),n.insert=n.strstart<2?n.strstart:2,i===Gu?(Vd(n,!0),n.strm.avail_out===0?3:4):n.sym_next&&(Vd(n,!1),n.strm.avail_out===0)?1:2};function uf(n,i,s,o,d){this.good_length=n,this.max_lazy=i,this.nice_length=s,this.max_chain=o,this.func=d}const PR=[new uf(0,0,0,0,zZ),new uf(4,4,8,4,B3),new uf(4,5,16,8,B3),new uf(4,6,32,32,B3),new uf(4,4,16,16,$x),new uf(8,16,32,32,$x),new uf(8,16,128,128,$x),new uf(8,32,128,256,$x),new uf(32,128,258,1024,$x),new uf(32,258,258,4096,$x)];function sSe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=WP,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*nSe),this.dyn_dtree=new Uint16Array(2*(2*eSe+1)),this.bl_tree=new Uint16Array(2*(2*tSe+1)),i_(this.dyn_ltree),i_(this.dyn_dtree),i_(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(rSe+1),this.heap=new Uint16Array(2*V3+1),i_(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*V3+1),i_(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const DR=n=>{if(!n)return 1;const i=n.state;return!i||i.strm!==n||i.status!==qx&&i.status!==57&&i.status!==69&&i.status!==73&&i.status!==91&&i.status!==103&&i.status!==Ly&&i.status!==AR?1:0},GZ=n=>{if(DR(n))return jy(n,lf);n.total_in=n.total_out=0,n.data_type=Zwe;const i=n.state;return i.pending=0,i.pending_out=0,i.wrap<0&&(i.wrap=-i.wrap),i.status=i.wrap===2?57:i.wrap?qx:Ly,n.adler=i.wrap===2?0:1,i.last_flush=-2,zwe(i),xc},WZ=n=>{const i=GZ(n);return i===xc&&(s=>{s.window_size=2*s.w_size,i_(s.head),s.max_lazy_match=PR[s.level].max_lazy,s.good_match=PR[s.level].good_length,s.nice_match=PR[s.level].nice_length,s.max_chain_length=PR[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0})(n.state),i},HZ=(n,i,s,o,d,h)=>{if(!n)return lf;let f=1;if(i===Ywe&&(i=6),o<0?(f=0,o=-o):o>15&&(f=2,o-=16),d<1||d>9||s!==WP||o<8||o>15||i<0||i>9||h<0||h>Jwe||o===8&&f!==1)return jy(n,lf);o===8&&(o=9);const g=new sSe;return n.state=g,g.strm=n,g.status=qx,g.wrap=f,g.gzhead=null,g.w_bits=o,g.w_size=1<<g.w_bits,g.w_mask=g.w_size-1,g.hash_bits=d+7,g.hash_size=1<<g.hash_bits,g.hash_mask=g.hash_size-1,g.hash_shift=~~((g.hash_bits+3-1)/3),g.window=new Uint8Array(2*g.w_size),g.head=new Uint16Array(g.hash_size),g.prev=new Uint16Array(g.w_size),g.lit_bufsize=1<<d+6,g.pending_buf_size=4*g.lit_bufsize,g.pending_buf=new Uint8Array(g.pending_buf_size),g.sym_buf=g.lit_bufsize,g.sym_end=3*(g.lit_bufsize-1),g.level=i,g.strategy=h,g.method=s,WZ(n)};var aSe=(n,i)=>{if(DR(n)||i>UZ||i<0)return n?jy(n,lf):lf;const s=n.state;if(!n.output||n.avail_in!==0&&!n.input||s.status===AR&&i!==Gu)return jy(n,n.avail_out===0?U3:lf);const o=s.last_flush;if(s.last_flush=i,s.pending!==0){if(Ud(n),n.avail_out===0)return s.last_flush=-1,xc}else if(n.avail_in===0&&FZ(i)<=FZ(o)&&i!==Gu)return jy(n,U3);if(s.status===AR&&n.avail_in!==0)return jy(n,U3);if(s.status===qx&&s.wrap===0&&(s.status=Ly),s.status===qx){let d=WP+(s.w_bits-8<<4)<<8,h=-1;if(h=s.strategy>=GP||s.level<2?0:s.level<6?1:s.level===6?2:3,d|=h<<6,s.strstart!==0&&(d|=32),d+=31-d%31,kR(s,d),s.strstart!==0&&(kR(s,n.adler>>>16),kR(s,65535&n.adler)),n.adler=1,s.status=Ly,Ud(n),s.pending!==0)return s.last_flush=-1,xc}if(s.status===57){if(n.adler=0,ji(s,31),ji(s,139),ji(s,8),s.gzhead)ji(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),ji(s,255&s.gzhead.time),ji(s,s.gzhead.time>>8&255),ji(s,s.gzhead.time>>16&255),ji(s,s.gzhead.time>>24&255),ji(s,s.level===9?2:s.strategy>=GP||s.level<2?4:0),ji(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(ji(s,255&s.gzhead.extra.length),ji(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(n.adler=Bo(n.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(ji(s,0),ji(s,0),ji(s,0),ji(s,0),ji(s,0),ji(s,s.level===9?2:s.strategy>=GP||s.level<2?4:0),ji(s,3),s.status=Ly,Ud(n),s.pending!==0)return s.last_flush=-1,xc}if(s.status===69){if(s.gzhead.extra){let d=s.pending,h=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+h>s.pending_buf_size;){let g=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+g),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>d&&(n.adler=Bo(n.adler,s.pending_buf,s.pending-d,d)),s.gzindex+=g,Ud(n),s.pending!==0)return s.last_flush=-1,xc;d=0,h-=g}let f=new Uint8Array(s.gzhead.extra);s.pending_buf.set(f.subarray(s.gzindex,s.gzindex+h),s.pending),s.pending+=h,s.gzhead.hcrc&&s.pending>d&&(n.adler=Bo(n.adler,s.pending_buf,s.pending-d,d)),s.gzindex=0}s.status=73}if(s.status===73){if(s.gzhead.name){let d,h=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>h&&(n.adler=Bo(n.adler,s.pending_buf,s.pending-h,h)),Ud(n),s.pending!==0)return s.last_flush=-1,xc;h=0}d=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,ji(s,d)}while(d!==0);s.gzhead.hcrc&&s.pending>h&&(n.adler=Bo(n.adler,s.pending_buf,s.pending-h,h)),s.gzindex=0}s.status=91}if(s.status===91){if(s.gzhead.comment){let d,h=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>h&&(n.adler=Bo(n.adler,s.pending_buf,s.pending-h,h)),Ud(n),s.pending!==0)return s.last_flush=-1,xc;h=0}d=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,ji(s,d)}while(d!==0);s.gzhead.hcrc&&s.pending>h&&(n.adler=Bo(n.adler,s.pending_buf,s.pending-h,h))}s.status=103}if(s.status===103){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(Ud(n),s.pending!==0))return s.last_flush=-1,xc;ji(s,255&n.adler),ji(s,n.adler>>8&255),n.adler=0}if(s.status=Ly,Ud(n),s.pending!==0)return s.last_flush=-1,xc}if(n.avail_in!==0||s.lookahead!==0||i!==r_&&s.status!==AR){let d=s.level===0?zZ(s,i):s.strategy===GP?((h,f)=>{let g;for(;;){if(h.lookahead===0&&(Yx(h),h.lookahead===0)){if(f===r_)return 1;break}if(h.match_length=0,g=n_(h,0,h.window[h.strstart]),h.lookahead--,h.strstart++,g&&(Vd(h,!1),h.strm.avail_out===0))return 1}return h.insert=0,f===Gu?(Vd(h,!0),h.strm.avail_out===0?3:4):h.sym_next&&(Vd(h,!1),h.strm.avail_out===0)?1:2})(s,i):s.strategy===Xwe?((h,f)=>{let g,y,x,b;const N=h.window;for(;;){if(h.lookahead<=Oy){if(Yx(h),h.lookahead<=Oy&&f===r_)return 1;if(h.lookahead===0)break}if(h.match_length=0,h.lookahead>=3&&h.strstart>0&&(x=h.strstart-1,y=N[x],y===N[++x]&&y===N[++x]&&y===N[++x])){b=h.strstart+Oy;do;while(y===N[++x]&&y===N[++x]&&y===N[++x]&&y===N[++x]&&y===N[++x]&&y===N[++x]&&y===N[++x]&&y===N[++x]&&x<b);h.match_length=Oy-(b-x),h.match_length>h.lookahead&&(h.match_length=h.lookahead)}if(h.match_length>=3?(g=n_(h,1,h.match_length-3),h.lookahead-=h.match_length,h.strstart+=h.match_length,h.match_length=0):(g=n_(h,0,h.window[h.strstart]),h.lookahead--,h.strstart++),g&&(Vd(h,!1),h.strm.avail_out===0))return 1}return h.insert=0,f===Gu?(Vd(h,!0),h.strm.avail_out===0?3:4):h.sym_next&&(Vd(h,!1),h.strm.avail_out===0)?1:2})(s,i):PR[s.level].func(s,i);if(d!==3&&d!==4||(s.status=AR),d===1||d===3)return n.avail_out===0&&(s.last_flush=-1),xc;if(d===2&&(i===Hwe?Wwe(s):i!==UZ&&(M3(s,0,0,!1),i===Kwe&&(i_(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),Ud(n),n.avail_out===0))return s.last_flush=-1,xc}return i!==Gu?xc:s.wrap<=0?VZ:(s.wrap===2?(ji(s,255&n.adler),ji(s,n.adler>>8&255),ji(s,n.adler>>16&255),ji(s,n.adler>>24&255),ji(s,255&n.total_in),ji(s,n.total_in>>8&255),ji(s,n.total_in>>16&255),ji(s,n.total_in>>24&255)):(kR(s,n.adler>>>16),kR(s,65535&n.adler)),Ud(n),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?xc:VZ)},oSe=(n,i)=>{let s=i.length;if(DR(n))return lf;const o=n.state,d=o.wrap;if(d===2||d===1&&o.status!==qx||o.lookahead)return lf;if(d===1&&(n.adler=IR(n.adler,i,s,0)),o.wrap=0,s>=o.w_size){d===0&&(i_(o.head),o.strstart=0,o.block_start=0,o.insert=0);let y=new Uint8Array(o.w_size);y.set(i.subarray(s-o.w_size,s),0),i=y,s=o.w_size}const h=n.avail_in,f=n.next_in,g=n.input;for(n.avail_in=s,n.next_in=0,n.input=i,Yx(o);o.lookahead>=3;){let y=o.strstart,x=o.lookahead-2;do o.ins_h=s_(o,o.ins_h,o.window[y+3-1]),o.prev[y&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=y,y++;while(--x);o.strstart=y,o.lookahead=2,Yx(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,n.next_in=f,n.input=g,n.avail_in=h,o.wrap=d,xc},OR={deflateInit:(n,i)=>HZ(n,i,WP,15,8,Qwe),deflateInit2:HZ,deflateReset:WZ,deflateResetKeep:GZ,deflateSetHeader:(n,i)=>DR(n)||n.state.wrap!==2?lf:(n.state.gzhead=i,xc),deflate:aSe,deflateEnd:n=>{if(DR(n))return lf;const i=n.state.status;return n.state=null,i===Ly?jy(n,qwe):xc},deflateSetDictionary:oSe,deflateInfo:"pako deflate (from Nodeca project)"};const cSe=(n,i)=>Object.prototype.hasOwnProperty.call(n,i);var HP={assign:function(n){const i=Array.prototype.slice.call(arguments,1);for(;i.length;){const s=i.shift();if(s){if(typeof s!="object")throw new TypeError(s+"must be non-object");for(const o in s)cSe(s,o)&&(n[o]=s[o])}}return n},flattenChunks:n=>{let i=0;for(let o=0,d=n.length;o<d;o++)i+=n[o].length;const s=new Uint8Array(i);for(let o=0,d=0,h=n.length;o<h;o++){let f=n[o];s.set(f,d),d+=f.length}return s}};let KZ=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{KZ=!1}const LR=new Uint8Array(256);for(let n=0;n<256;n++)LR[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;LR[254]=LR[254]=1;var jR={string2buf:n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let i,s,o,d,h,f=n.length,g=0;for(d=0;d<f;d++)s=n.charCodeAt(d),(64512&s)==55296&&d+1<f&&(o=n.charCodeAt(d+1),(64512&o)==56320&&(s=65536+(s-55296<<10)+(o-56320),d++)),g+=s<128?1:s<2048?2:s<65536?3:4;for(i=new Uint8Array(g),h=0,d=0;h<g;d++)s=n.charCodeAt(d),(64512&s)==55296&&d+1<f&&(o=n.charCodeAt(d+1),(64512&o)==56320&&(s=65536+(s-55296<<10)+(o-56320),d++)),s<128?i[h++]=s:s<2048?(i[h++]=192|s>>>6,i[h++]=128|63&s):s<65536?(i[h++]=224|s>>>12,i[h++]=128|s>>>6&63,i[h++]=128|63&s):(i[h++]=240|s>>>18,i[h++]=128|s>>>12&63,i[h++]=128|s>>>6&63,i[h++]=128|63&s);return i},buf2string:(n,i)=>{const s=i||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,i));let o,d;const h=new Array(2*s);for(d=0,o=0;o<s;){let f=n[o++];if(f<128){h[d++]=f;continue}let g=LR[f];if(g>4)h[d++]=65533,o+=g-1;else{for(f&=g===2?31:g===3?15:7;g>1&&o<s;)f=f<<6|63&n[o++],g--;g>1?h[d++]=65533:f<65536?h[d++]=f:(f-=65536,h[d++]=55296|f>>10&1023,h[d++]=56320|1023&f)}}return((f,g)=>{if(g<65534&&f.subarray&&KZ)return String.fromCharCode.apply(null,f.length===g?f:f.subarray(0,g));let y="";for(let x=0;x<g;x++)y+=String.fromCharCode(f[x]);return y})(h,d)},utf8border:(n,i)=>{(i=i||n.length)>n.length&&(i=n.length);let s=i-1;for(;s>=0&&(192&n[s])==128;)s--;return s<0||s===0?i:s+LR[n[s]]>i?s:i}},qZ=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const YZ=Object.prototype.toString,{Z_NO_FLUSH:lSe,Z_SYNC_FLUSH:dSe,Z_FULL_FLUSH:uSe,Z_FINISH:hSe,Z_OK:KP,Z_STREAM_END:pSe,Z_DEFAULT_COMPRESSION:fSe,Z_DEFAULT_STRATEGY:mSe,Z_DEFLATED:gSe}=zP;function qP(n){this.options=HP.assign({level:fSe,method:gSe,chunkSize:16384,windowBits:15,memLevel:8,strategy:mSe},n||{});let i=this.options;i.raw&&i.windowBits>0?i.windowBits=-i.windowBits:i.gzip&&i.windowBits>0&&i.windowBits<16&&(i.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new qZ,this.strm.avail_out=0;let s=OR.deflateInit2(this.strm,i.level,i.method,i.windowBits,i.memLevel,i.strategy);if(s!==KP)throw new Error(Dy[s]);if(i.header&&OR.deflateSetHeader(this.strm,i.header),i.dictionary){let o;if(o=typeof i.dictionary=="string"?jR.string2buf(i.dictionary):YZ.call(i.dictionary)==="[object ArrayBuffer]"?new Uint8Array(i.dictionary):i.dictionary,s=OR.deflateSetDictionary(this.strm,o),s!==KP)throw new Error(Dy[s]);this._dict_set=!0}}function $Z(n,i){const s=new qP(i);if(s.push(n,!0),s.err)throw s.msg||Dy[s.err];return s.result}qP.prototype.push=function(n,i){const s=this.strm,o=this.options.chunkSize;let d,h;if(this.ended)return!1;for(h=i===~~i?i:i===!0?hSe:lSe,typeof n=="string"?s.input=jR.string2buf(n):YZ.call(n)==="[object ArrayBuffer]"?s.input=new Uint8Array(n):s.input=n,s.next_in=0,s.avail_in=s.input.length;;)if(s.avail_out===0&&(s.output=new Uint8Array(o),s.next_out=0,s.avail_out=o),(h===dSe||h===uSe)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(d=OR.deflate(s,h),d===pSe)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),d=OR.deflateEnd(this.strm),this.onEnd(d),this.ended=!0,d===KP;if(s.avail_out!==0){if(h>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(s.avail_in===0)break}else this.onData(s.output)}return!0},qP.prototype.onData=function(n){this.chunks.push(n)},qP.prototype.onEnd=function(n){n===KP&&(this.result=HP.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};var _Se={deflate:$Z,deflateRaw:function(n,i){return(i=i||{}).raw=!0,$Z(n,i)}};const YP=16209;var ySe=function(n,i){let s,o,d,h,f,g,y,x,b,N,I,D,$,z,K,ie,oe,fe,Ee,Te,_e,Re,je,Be;const dt=n.state;s=n.next_in,je=n.input,o=s+(n.avail_in-5),d=n.next_out,Be=n.output,h=d-(i-n.avail_out),f=d+(n.avail_out-257),g=dt.dmax,y=dt.wsize,x=dt.whave,b=dt.wnext,N=dt.window,I=dt.hold,D=dt.bits,$=dt.lencode,z=dt.distcode,K=(1<<dt.lenbits)-1,ie=(1<<dt.distbits)-1;e:do{D<15&&(I+=je[s++]<<D,D+=8,I+=je[s++]<<D,D+=8),oe=$[I&K];t:for(;;){if(fe=oe>>>24,I>>>=fe,D-=fe,fe=oe>>>16&255,fe===0)Be[d++]=65535&oe;else{if(!(16&fe)){if(!(64&fe)){oe=$[(65535&oe)+(I&(1<<fe)-1)];continue t}if(32&fe){dt.mode=16191;break e}n.msg="invalid literal/length code",dt.mode=YP;break e}Ee=65535&oe,fe&=15,fe&&(D<fe&&(I+=je[s++]<<D,D+=8),Ee+=I&(1<<fe)-1,I>>>=fe,D-=fe),D<15&&(I+=je[s++]<<D,D+=8,I+=je[s++]<<D,D+=8),oe=z[I&ie];n:for(;;){if(fe=oe>>>24,I>>>=fe,D-=fe,fe=oe>>>16&255,!(16&fe)){if(!(64&fe)){oe=z[(65535&oe)+(I&(1<<fe)-1)];continue n}n.msg="invalid distance code",dt.mode=YP;break e}if(Te=65535&oe,fe&=15,D<fe&&(I+=je[s++]<<D,D+=8,D<fe&&(I+=je[s++]<<D,D+=8)),Te+=I&(1<<fe)-1,Te>g){n.msg="invalid distance too far back",dt.mode=YP;break e}if(I>>>=fe,D-=fe,fe=d-h,Te>fe){if(fe=Te-fe,fe>x&&dt.sane){n.msg="invalid distance too far back",dt.mode=YP;break e}if(_e=0,Re=N,b===0){if(_e+=y-fe,fe<Ee){Ee-=fe;do Be[d++]=N[_e++];while(--fe);_e=d-Te,Re=Be}}else if(b<fe){if(_e+=y+b-fe,fe-=b,fe<Ee){Ee-=fe;do Be[d++]=N[_e++];while(--fe);if(_e=0,b<Ee){fe=b,Ee-=fe;do Be[d++]=N[_e++];while(--fe);_e=d-Te,Re=Be}}}else if(_e+=b-fe,fe<Ee){Ee-=fe;do Be[d++]=N[_e++];while(--fe);_e=d-Te,Re=Be}for(;Ee>2;)Be[d++]=Re[_e++],Be[d++]=Re[_e++],Be[d++]=Re[_e++],Ee-=3;Ee&&(Be[d++]=Re[_e++],Ee>1&&(Be[d++]=Re[_e++]))}else{_e=d-Te;do Be[d++]=Be[_e++],Be[d++]=Be[_e++],Be[d++]=Be[_e++],Ee-=3;while(Ee>2);Ee&&(Be[d++]=Be[_e++],Ee>1&&(Be[d++]=Be[_e++]))}break}}break}}while(s<o&&d<f);Ee=D>>3,s-=Ee,D-=Ee<<3,I&=(1<<D)-1,n.next_in=s,n.next_out=d,n.avail_in=s<o?o-s+5:5-(s-o),n.avail_out=d<f?f-d+257:257-(d-f),dt.hold=I,dt.bits=D};const $P=15,vSe=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ESe=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),xSe=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),bSe=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var MR=(n,i,s,o,d,h,f,g)=>{const y=g.bits;let x,b,N,I,D,$,z=0,K=0,ie=0,oe=0,fe=0,Ee=0,Te=0,_e=0,Re=0,je=0,Be=null;const dt=new Uint16Array(16),Ht=new Uint16Array(16);let Bt,dn,sn,Qn=null;for(z=0;z<=$P;z++)dt[z]=0;for(K=0;K<o;K++)dt[i[s+K]]++;for(fe=y,oe=$P;oe>=1&&dt[oe]===0;oe--);if(fe>oe&&(fe=oe),oe===0)return d[h++]=20971520,d[h++]=20971520,g.bits=1,0;for(ie=1;ie<oe&&dt[ie]===0;ie++);for(fe<ie&&(fe=ie),_e=1,z=1;z<=$P;z++)if(_e<<=1,_e-=dt[z],_e<0)return-1;if(_e>0&&(n===0||oe!==1))return-1;for(Ht[1]=0,z=1;z<$P;z++)Ht[z+1]=Ht[z]+dt[z];for(K=0;K<o;K++)i[s+K]!==0&&(f[Ht[i[s+K]]++]=K);if(n===0?(Be=Qn=f,$=20):n===1?(Be=vSe,Qn=ESe,$=257):(Be=xSe,Qn=bSe,$=0),je=0,K=0,z=ie,D=h,Ee=fe,Te=0,N=-1,Re=1<<fe,I=Re-1,n===1&&Re>852||n===2&&Re>592)return 1;for(;;){Bt=z-Te,f[K]+1<$?(dn=0,sn=f[K]):f[K]>=$?(dn=Qn[f[K]-$],sn=Be[f[K]-$]):(dn=96,sn=0),x=1<<z-Te,b=1<<Ee,ie=b;do b-=x,d[D+(je>>Te)+b]=Bt<<24|dn<<16|sn|0;while(b!==0);for(x=1<<z-1;je&x;)x>>=1;if(x!==0?(je&=x-1,je+=x):je=0,K++,--dt[z]==0){if(z===oe)break;z=i[s+f[K]]}if(z>fe&&(je&I)!==N){for(Te===0&&(Te=fe),D+=ie,Ee=z-Te,_e=1<<Ee;Ee+Te<oe&&(_e-=dt[Ee+Te],!(_e<=0));)Ee++,_e<<=1;if(Re+=1<<Ee,n===1&&Re>852||n===2&&Re>592)return 1;N=je&I,d[N]=fe<<24|Ee<<16|D-h|0}}return je!==0&&(d[D+je]=z-Te<<24|64<<16|0),g.bits=fe,0};const{Z_FINISH:XZ,Z_BLOCK:wSe,Z_TREES:XP,Z_OK:My,Z_STREAM_END:SSe,Z_NEED_DICT:TSe,Z_STREAM_ERROR:Wu,Z_DATA_ERROR:JZ,Z_MEM_ERROR:QZ,Z_BUF_ERROR:RSe,Z_DEFLATED:ZZ}=zP,JP=16180,QP=16190,_m=16191,z3=16192,G3=16194,ZP=16199,e2=16200,W3=16206,Js=16209,eee=n=>(n>>>24&255)+(n>>>8&65280)+((65280&n)<<8)+((255&n)<<24);function CSe(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Uy=n=>{if(!n)return 1;const i=n.state;return!i||i.strm!==n||i.mode<JP||i.mode>16211?1:0},tee=n=>{if(Uy(n))return Wu;const i=n.state;return n.total_in=n.total_out=i.total=0,n.msg="",i.wrap&&(n.adler=1&i.wrap),i.mode=JP,i.last=0,i.havedict=0,i.flags=-1,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new Int32Array(852),i.distcode=i.distdyn=new Int32Array(592),i.sane=1,i.back=-1,My},nee=n=>{if(Uy(n))return Wu;const i=n.state;return i.wsize=0,i.whave=0,i.wnext=0,tee(n)},ree=(n,i)=>{let s;if(Uy(n))return Wu;const o=n.state;return i<0?(s=0,i=-i):(s=5+(i>>4),i<48&&(i&=15)),i&&(i<8||i>15)?Wu:(o.window!==null&&o.wbits!==i&&(o.window=null),o.wrap=s,o.wbits=i,nee(n))},iee=(n,i)=>{if(!n)return Wu;const s=new CSe;n.state=s,s.strm=n,s.window=null,s.mode=JP;const o=ree(n,i);return o!==My&&(n.state=null),o};let H3,K3,see=!0;const NSe=n=>{if(see){H3=new Int32Array(512),K3=new Int32Array(32);let i=0;for(;i<144;)n.lens[i++]=8;for(;i<256;)n.lens[i++]=9;for(;i<280;)n.lens[i++]=7;for(;i<288;)n.lens[i++]=8;for(MR(1,n.lens,0,288,H3,0,n.work,{bits:9}),i=0;i<32;)n.lens[i++]=5;MR(2,n.lens,0,32,K3,0,n.work,{bits:5}),see=!1}n.lencode=H3,n.lenbits=9,n.distcode=K3,n.distbits=5},aee=(n,i,s,o)=>{let d;const h=n.state;return h.window===null&&(h.wsize=1<<h.wbits,h.wnext=0,h.whave=0,h.window=new Uint8Array(h.wsize)),o>=h.wsize?(h.window.set(i.subarray(s-h.wsize,s),0),h.wnext=0,h.whave=h.wsize):(d=h.wsize-h.wnext,d>o&&(d=o),h.window.set(i.subarray(s-o,s-o+d),h.wnext),(o-=d)?(h.window.set(i.subarray(s-o,s),0),h.wnext=o,h.whave=h.wsize):(h.wnext+=d,h.wnext===h.wsize&&(h.wnext=0),h.whave<h.wsize&&(h.whave+=d))),0};var ISe=(n,i)=>{let s,o,d,h,f,g,y,x,b,N,I,D,$,z,K,ie,oe,fe,Ee,Te,_e,Re,je=0;const Be=new Uint8Array(4);let dt,Ht;const Bt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Uy(n)||!n.output||!n.input&&n.avail_in!==0)return Wu;s=n.state,s.mode===_m&&(s.mode=z3),f=n.next_out,d=n.output,y=n.avail_out,h=n.next_in,o=n.input,g=n.avail_in,x=s.hold,b=s.bits,N=g,I=y,Re=My;e:for(;;)switch(s.mode){case JP:if(s.wrap===0){s.mode=z3;break}for(;b<16;){if(g===0)break e;g--,x+=o[h++]<<b,b+=8}if(2&s.wrap&&x===35615){s.wbits===0&&(s.wbits=15),s.check=0,Be[0]=255&x,Be[1]=x>>>8&255,s.check=Bo(s.check,Be,2,0),x=0,b=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&x)<<8)+(x>>8))%31){n.msg="incorrect header check",s.mode=Js;break}if((15&x)!==ZZ){n.msg="unknown compression method",s.mode=Js;break}if(x>>>=4,b-=4,_e=8+(15&x),s.wbits===0&&(s.wbits=_e),_e>15||_e>s.wbits){n.msg="invalid window size",s.mode=Js;break}s.dmax=1<<s.wbits,s.flags=0,n.adler=s.check=1,s.mode=512&x?16189:_m,x=0,b=0;break;case 16181:for(;b<16;){if(g===0)break e;g--,x+=o[h++]<<b,b+=8}if(s.flags=x,(255&po(s))!==ZZ){n.msg="unknown compression method",s.mode=Js;break}if(57344&po(s)){n.msg="unknown header flags set",s.mode=Js;break}s.head&&(s.head.text=x>>8&1),512&po(s)&&4&s.wrap&&(Be[0]=255&x,Be[1]=x>>>8&255,s.check=Bo(s.check,Be,2,0)),x=0,b=0,s.mode=16182;case 16182:for(;b<32;){if(g===0)break e;g--,x+=o[h++]<<b,b+=8}s.head&&(s.head.time=x),512&po(s)&&4&s.wrap&&(Be[0]=255&x,Be[1]=x>>>8&255,Be[2]=x>>>16&255,Be[3]=x>>>24&255,s.check=Bo(s.check,Be,4,0)),x=0,b=0,s.mode=16183;case 16183:for(;b<16;){if(g===0)break e;g--,x+=o[h++]<<b,b+=8}s.head&&(s.head.xflags=255&x,s.head.os=x>>8),512&po(s)&&4&s.wrap&&(Be[0]=255&x,Be[1]=x>>>8&255,s.check=Bo(s.check,Be,2,0)),x=0,b=0,s.mode=16184;case 16184:if(1024&po(s)){for(;b<16;){if(g===0)break e;g--,x+=o[h++]<<b,b+=8}s.length=x,s.head&&(s.head.extra_len=x),512&po(s)&&4&s.wrap&&(Be[0]=255&x,Be[1]=x>>>8&255,s.check=Bo(s.check,Be,2,0)),x=0,b=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&po(s)&&(D=s.length,D>g&&(D=g),D&&(s.head&&(_e=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(o.subarray(h,h+D),_e)),512&po(s)&&4&s.wrap&&(s.check=Bo(s.check,o,D,h)),g-=D,h+=D,s.length-=D),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&po(s)){if(g===0)break e;D=0;do _e=o[h+D++],s.head&&_e&&s.length<65536&&(s.head.name+=String.fromCharCode(_e));while(_e&&D<g);if(512&po(s)&&4&s.wrap&&(s.check=Bo(s.check,o,D,h)),g-=D,h+=D,_e)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&po(s)){if(g===0)break e;D=0;do _e=o[h+D++],s.head&&_e&&s.length<65536&&(s.head.comment+=String.fromCharCode(_e));while(_e&&D<g);if(512&po(s)&&4&s.wrap&&(s.check=Bo(s.check,o,D,h)),g-=D,h+=D,_e)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&po(s)){for(;b<16;){if(g===0)break e;g--,x+=o[h++]<<b,b+=8}if(4&s.wrap&&x!==(65535&s.check)){n.msg="header crc mismatch",s.mode=Js;break}x=0,b=0}s.head&&(s.head.hcrc=po(s)>>9&1,s.head.done=!0),n.adler=s.check=0,s.mode=_m;break;case 16189:for(;b<32;){if(g===0)break e;g--,x+=o[h++]<<b,b+=8}n.adler=s.check=eee(x),x=0,b=0,s.mode=QP;case QP:if(s.havedict===0)return n.next_out=f,n.avail_out=y,n.next_in=h,n.avail_in=g,s.hold=x,s.bits=b,TSe;n.adler=s.check=1,s.mode=_m;case _m:if(i===wSe||i===XP)break e;case z3:if(s.last){x>>>=7&b,b-=7&b,s.mode=W3;break}for(;b<3;){if(g===0)break e;g--,x+=o[h++]<<b,b+=8}switch(s.last=1&x,x>>>=1,b-=1,3&x){case 0:s.mode=16193;break;case 1:if(NSe(s),s.mode=ZP,i===XP){x>>>=2,b-=2;break e}break;case 2:s.mode=16196;break;case 3:n.msg="invalid block type",s.mode=Js}x>>>=2,b-=2;break;case 16193:for(x>>>=7&b,b-=7&b;b<32;){if(g===0)break e;g--,x+=o[h++]<<b,b+=8}if((65535&x)!=(x>>>16^65535)){n.msg="invalid stored block lengths",s.mode=Js;break}if(s.length=65535&x,x=0,b=0,s.mode=G3,i===XP)break e;case G3:s.mode=16195;case 16195:if(D=s.length,D){if(D>g&&(D=g),D>y&&(D=y),D===0)break e;d.set(o.subarray(h,h+D),f),g-=D,h+=D,y-=D,f+=D,s.length-=D;break}s.mode=_m;break;case 16196:for(;b<14;){if(g===0)break e;g--,x+=o[h++]<<b,b+=8}if(s.nlen=257+(31&x),x>>>=5,b-=5,s.ndist=1+(31&x),x>>>=5,b-=5,s.ncode=4+(15&x),x>>>=4,b-=4,s.nlen>286||s.ndist>30){n.msg="too many length or distance symbols",s.mode=Js;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;b<3;){if(g===0)break e;g--,x+=o[h++]<<b,b+=8}s.lens[Bt[s.have++]]=7&x,x>>>=3,b-=3}for(;s.have<19;)s.lens[Bt[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,dt={bits:s.lenbits},Re=MR(0,s.lens,0,19,s.lencode,0,s.work,dt),s.lenbits=dt.bits,Re){n.msg="invalid code lengths set",s.mode=Js;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;je=s.lencode[x&(1<<s.lenbits)-1],K=je>>>24,ie=je>>>16&255,oe=65535&je,!(K<=b);){if(g===0)break e;g--,x+=o[h++]<<b,b+=8}if(oe<16)x>>>=K,b-=K,s.lens[s.have++]=oe;else{if(oe===16){for(Ht=K+2;b<Ht;){if(g===0)break e;g--,x+=o[h++]<<b,b+=8}if(x>>>=K,b-=K,s.have===0){n.msg="invalid bit length repeat",s.mode=Js;break}_e=s.lens[s.have-1],D=3+(3&x),x>>>=2,b-=2}else if(oe===17){for(Ht=K+3;b<Ht;){if(g===0)break e;g--,x+=o[h++]<<b,b+=8}x>>>=K,b-=K,_e=0,D=3+(7&x),x>>>=3,b-=3}else{for(Ht=K+7;b<Ht;){if(g===0)break e;g--,x+=o[h++]<<b,b+=8}x>>>=K,b-=K,_e=0,D=11+(127&x),x>>>=7,b-=7}if(s.have+D>s.nlen+s.ndist){n.msg="invalid bit length repeat",s.mode=Js;break}for(;D--;)s.lens[s.have++]=_e}}if(s.mode===Js)break;if(s.lens[256]===0){n.msg="invalid code -- missing end-of-block",s.mode=Js;break}if(s.lenbits=9,dt={bits:s.lenbits},Re=MR(1,s.lens,0,s.nlen,s.lencode,0,s.work,dt),s.lenbits=dt.bits,Re){n.msg="invalid literal/lengths set",s.mode=Js;break}if(s.distbits=6,s.distcode=s.distdyn,dt={bits:s.distbits},Re=MR(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,dt),s.distbits=dt.bits,Re){n.msg="invalid distances set",s.mode=Js;break}if(s.mode=ZP,i===XP)break e;case ZP:s.mode=e2;case e2:if(g>=6&&y>=258){n.next_out=f,n.avail_out=y,n.next_in=h,n.avail_in=g,s.hold=x,s.bits=b,ySe(n,I),f=n.next_out,d=n.output,y=n.avail_out,h=n.next_in,o=n.input,g=n.avail_in,x=s.hold,b=s.bits,s.mode===_m&&(s.back=-1);break}for(s.back=0;je=s.lencode[x&(1<<s.lenbits)-1],K=je>>>24,ie=je>>>16&255,oe=65535&je,!(K<=b);){if(g===0)break e;g--,x+=o[h++]<<b,b+=8}if(ie&&!(240&ie)){for(fe=K,Ee=ie,Te=oe;je=s.lencode[Te+((x&(1<<fe+Ee)-1)>>fe)],K=je>>>24,ie=je>>>16&255,oe=65535&je,!(fe+K<=b);){if(g===0)break e;g--,x+=o[h++]<<b,b+=8}x>>>=fe,b-=fe,s.back+=fe}if(x>>>=K,b-=K,s.back+=K,s.length=oe,ie===0){s.mode=16205;break}if(32&ie){s.back=-1,s.mode=_m;break}if(64&ie){n.msg="invalid literal/length code",s.mode=Js;break}s.extra=15&ie,s.mode=16201;case 16201:if(s.extra){for(Ht=s.extra;b<Ht;){if(g===0)break e;g--,x+=o[h++]<<b,b+=8}s.length+=x&(1<<s.extra)-1,x>>>=s.extra,b-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;je=s.distcode[x&(1<<s.distbits)-1],K=je>>>24,ie=je>>>16&255,oe=65535&je,!(K<=b);){if(g===0)break e;g--,x+=o[h++]<<b,b+=8}if(!(240&ie)){for(fe=K,Ee=ie,Te=oe;je=s.distcode[Te+((x&(1<<fe+Ee)-1)>>fe)],K=je>>>24,ie=je>>>16&255,oe=65535&je,!(fe+K<=b);){if(g===0)break e;g--,x+=o[h++]<<b,b+=8}x>>>=fe,b-=fe,s.back+=fe}if(x>>>=K,b-=K,s.back+=K,64&ie){n.msg="invalid distance code",s.mode=Js;break}s.offset=oe,s.extra=15&ie,s.mode=16203;case 16203:if(s.extra){for(Ht=s.extra;b<Ht;){if(g===0)break e;g--,x+=o[h++]<<b,b+=8}s.offset+=x&(1<<s.extra)-1,x>>>=s.extra,b-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){n.msg="invalid distance too far back",s.mode=Js;break}s.mode=16204;case 16204:if(y===0)break e;if(D=I-y,s.offset>D){if(D=s.offset-D,D>s.whave&&s.sane){n.msg="invalid distance too far back",s.mode=Js;break}D>s.wnext?(D-=s.wnext,$=s.wsize-D):$=s.wnext-D,D>s.length&&(D=s.length),z=s.window}else z=d,$=f-s.offset,D=s.length;D>y&&(D=y),y-=D,s.length-=D;do d[f++]=z[$++];while(--D);s.length===0&&(s.mode=e2);break;case 16205:if(y===0)break e;d[f++]=s.length,y--,s.mode=e2;break;case W3:if(s.wrap){for(;b<32;){if(g===0)break e;g--,x|=o[h++]<<b,b+=8}if(I-=y,n.total_out+=I,s.total+=I,4&s.wrap&&I&&(n.adler=s.check=po(s)?Bo(s.check,d,I,f-I):IR(s.check,d,I,f-I)),I=y,4&s.wrap&&(po(s)?x:eee(x))!==s.check){n.msg="incorrect data check",s.mode=Js;break}x=0,b=0}s.mode=16207;case 16207:if(s.wrap&&po(s)){for(;b<32;){if(g===0)break e;g--,x+=o[h++]<<b,b+=8}if(4&s.wrap&&x!==(4294967295&s.total)){n.msg="incorrect length check",s.mode=Js;break}x=0,b=0}s.mode=16208;case 16208:Re=SSe;break e;case Js:Re=JZ;break e;case 16210:return QZ;default:return Wu}return n.next_out=f,n.avail_out=y,n.next_in=h,n.avail_in=g,s.hold=x,s.bits=b,(s.wsize||I!==n.avail_out&&s.mode<Js&&(s.mode<W3||i!==XZ))&&aee(n,n.output,n.next_out,I-n.avail_out),N-=n.avail_in,I-=n.avail_out,n.total_in+=N,n.total_out+=I,s.total+=I,4&s.wrap&&I&&(n.adler=s.check=po(s)?Bo(s.check,d,I,n.next_out-I):IR(s.check,d,I,n.next_out-I)),n.data_type=s.bits+(s.last?64:0)+(s.mode===_m?128:0)+(s.mode===ZP||s.mode===G3?256:0),(N===0&&I===0||i===XZ)&&Re===My&&(Re=RSe),Re},ym={inflateReset:nee,inflateReset2:ree,inflateResetKeep:tee,inflateInit:n=>iee(n,15),inflateInit2:iee,inflate:ISe,inflateEnd:n=>{if(Uy(n))return Wu;let i=n.state;return i.window&&(i.window=null),n.state=null,My},inflateGetHeader:(n,i)=>{if(Uy(n))return Wu;const s=n.state;return 2&s.wrap?(s.head=i,i.done=!1,My):Wu},inflateSetDictionary:(n,i)=>{const s=i.length;let o,d,h;return Uy(n)?Wu:(o=n.state,o.wrap!==0&&o.mode!==QP?Wu:o.mode===QP&&(d=1,d=IR(d,i,s,0),d!==o.check)?JZ:(h=aee(n,i,s,s),h?(o.mode=16210,QZ):(o.havedict=1,My)))},inflateInfo:"pako inflate (from Nodeca project)"},ASe=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const oee=Object.prototype.toString,{Z_NO_FLUSH:kSe,Z_FINISH:PSe,Z_OK:UR,Z_STREAM_END:q3,Z_NEED_DICT:Y3,Z_STREAM_ERROR:DSe,Z_DATA_ERROR:cee,Z_MEM_ERROR:OSe}=zP;function t2(n){this.options=HP.assign({chunkSize:65536,windowBits:15,to:""},n||{});const i=this.options;i.raw&&i.windowBits>=0&&i.windowBits<16&&(i.windowBits=-i.windowBits,i.windowBits===0&&(i.windowBits=-15)),!(i.windowBits>=0&&i.windowBits<16)||n&&n.windowBits||(i.windowBits+=32),i.windowBits>15&&i.windowBits<48&&!(15&i.windowBits)&&(i.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new qZ,this.strm.avail_out=0;let s=ym.inflateInit2(this.strm,i.windowBits);if(s!==UR)throw new Error(Dy[s]);if(this.header=new ASe,ym.inflateGetHeader(this.strm,this.header),i.dictionary&&(typeof i.dictionary=="string"?i.dictionary=jR.string2buf(i.dictionary):oee.call(i.dictionary)==="[object ArrayBuffer]"&&(i.dictionary=new Uint8Array(i.dictionary)),i.raw&&(s=ym.inflateSetDictionary(this.strm,i.dictionary),s!==UR)))throw new Error(Dy[s])}function lee(n,i){const s=new t2(i);if(s.push(n),s.err)throw s.msg||Dy[s.err];return s.result}t2.prototype.push=function(n,i){const s=this.strm,o=this.options.chunkSize,d=this.options.dictionary;let h,f,g;if(this.ended)return!1;for(f=i===~~i?i:i===!0?PSe:kSe,oee.call(n)==="[object ArrayBuffer]"?s.input=new Uint8Array(n):s.input=n,s.next_in=0,s.avail_in=s.input.length;;){for(s.avail_out===0&&(s.output=new Uint8Array(o),s.next_out=0,s.avail_out=o),h=ym.inflate(s,f),h===Y3&&d&&(h=ym.inflateSetDictionary(s,d),h===UR?h=ym.inflate(s,f):h===cee&&(h=Y3));s.avail_in>0&&h===q3&&s.state.wrap>0&&n[s.next_in]!==0;)ym.inflateReset(s),h=ym.inflate(s,f);switch(h){case DSe:case cee:case Y3:case OSe:return this.onEnd(h),this.ended=!0,!1}if(g=s.avail_out,s.next_out&&(s.avail_out===0||h===q3))if(this.options.to==="string"){let y=jR.utf8border(s.output,s.next_out),x=s.next_out-y,b=jR.buf2string(s.output,y);s.next_out=x,s.avail_out=o-x,x&&s.output.set(s.output.subarray(y,y+x),0),this.onData(b)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(h!==UR||g!==0){if(h===q3)return h=ym.inflateEnd(this.strm),this.onEnd(h),this.ended=!0,!0;if(s.avail_in===0)break}}return!0},t2.prototype.onData=function(n){this.chunks.push(n)},t2.prototype.onEnd=function(n){n===UR&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=HP.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};var LSe={inflate:lee,inflateRaw:function(n,i){return(i=i||{}).raw=!0,lee(n,i)}};const{deflate:jSe,deflateRaw:MSe}=_Se,{inflate:USe,inflateRaw:VSe}=LSe;var FSe=jSe,BSe=MSe,zSe=USe,GSe=VSe,dee=function(n){return n[n.ONE_BYTE=0]="ONE_BYTE",n[n.TWO_BYTE=1]="TWO_BYTE",n}(dee||{});class WSe{constructor(){Y(this,"_sequence",0),Y(this,"_startTime",Date.now()),Y(this,"isUseOneByte",!0)}get startTime(){const i=Date.now()-this._startTime;return i<Math.pow(2,16)?i:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(i){const s={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:i};if(i.byteLength>128){const g=new Uint8Array(4);g.set([1,0,0,0]);const y={id:0,length:4,data:g.buffer},x={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[y]};s.commonPacketHeader.extension=1,s.extension=x,s.payload=this.compress(i),s.commonPacketHeader.length=8+(s.extension.length+2)+s.payload.byteLength}else s.commonPacketHeader.length=8+s.payload.byteLength;re("SHOW_DATASTREAM2_LOG")&&M.debug("send data header: ".concat(JSON.stringify(s.commonPacketHeader)));const o=new ArrayBuffer(s.commonPacketHeader.length),d=new Uint8Array(o),h=new DataView(o);let f=0;if(h.setUint16(f,s.commonPacketHeader.extension<<15|s.commonPacketHeader.reserved<<14|s.commonPacketHeader.length,!0),f+=2,h.setUint32(f,s.commonPacketHeader.sequence,!0),f+=4,h.setUint16(f,s.commonStreamHeader,!0),f+=2,s.extension){const g=this.serializeExtension(s.extension);d.set(new Uint8Array(g),f),f+=g.byteLength}if(d.set(new Uint8Array(s.payload),f),f+=s.payload.byteLength,f!==s.commonPacketHeader.length)throw Error("serialize error!");return o}deserialize(i){if(i.byteLength<4)return new ArrayBuffer(0);const s=new DataView(i);let o=0;const d=s.getUint16(o,!0);o+=2;const h={length:16383&d,reserved:(16384&d)>>14,extension:(32768&d)>>15,sequence:s.getUint16(o+2,!0)<<16|s.getUint16(o,!0)};let f,g;if(o+=4,re("SHOW_DATASTREAM2_LOG")&&M.debug("receive data header: ".concat(JSON.stringify(h))),s.getUint16(o,!0),o+=2,h.extension){g=this.deserializeExtension(i.slice(o)),o+=2+g.length,f=i.slice(o);let y=!1;if(g.datas.length>0){const x=g.datas.find(b=>b.id===0);x&&(y=(1&new DataView(x.data).getUint32(0,!0))==1)}f=y?this.decompress(f):f}else f=i.slice(8);return f}serializeExtension(i){const{profile:s,length:o,datas:d}=i,h=new ArrayBuffer(o+2),f=new Uint8Array(h),g=new DataView(h);let y=0;if(g.setUint8(y++,s),g.setUint8(y++,o),d.forEach(x=>{s?(g.setUint8(y++,x.id),g.setUint8(y++,x.length),f.set(new Uint8Array(x.data),y),y+=x.data.byteLength):(g.setUint8(y++,x.id|x.length<<4),f.set(new Uint8Array(x.data),y),y+=x.data.byteLength)}),y!==o+2)throw Error("serialize extension error, is ".concat(y,"!==").concat(o+2));return h}deserializeExtension(i){const s=new DataView(i);let o=0;const d=s.getUint8(o);o++;const h=s.getUint8(o);o++;const f=d===dee.TWO_BYTE,g=[],y=new DataView(i,2);let x=0;for(;x<h;){let b=0,N=0,I=new ArrayBuffer(0);f?(b=y.getUint8(x),x++,N=y.getUint8(x),x++):(b=15&y.getUint8(x),N=y.getUint8(x)>>4,x++),N>0&&(I=y.buffer.slice(x+2,x+2+N),x+=I.byteLength),g.push({id:b,length:N,data:I})}if(x!==h)throw Error("parse error");return{profile:d,length:h,datas:g}}decompress(i){return zSe(new Uint8Array(i))}compress(i){return FSe(new Uint8Array(i))}}const HSe={name:"DataStream",create:(n,i)=>{const s=i?new $xe(n):new Xxe(n);return s.useDataStream(new WSe),s}};class KSe extends ai{constructor(i,s,o){super(),Y(this,"ws",void 0),Y(this,"requestId",1),Y(this,"heartBeatTimer",void 0),Y(this,"joinInfo",void 0),Y(this,"clientId",void 0),Y(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),Y(this,"onClose",d=>{this.emit("close"),this.dispose()}),Y(this,"onMessage",d=>{const h=JSON.parse(d.data);if(!h||h.command!=="serverResponse"||!h.requestId)return h&&h.command==="serverStatus"&&h.serverStatus&&h.serverStatus.command?(this.emit("status",h.serverStatus),void this.emit(h.serverStatus.command,h.serverStatus)):void 0;this.emit("req_".concat(h.requestId),h)}),this.joinInfo=i,this.clientId=s,this.ws=new cR("cross-channel-".concat(this.clientId),o),this.ws.on(an.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(an.CONNECTED,this.onOpen),this.ws.on(an.ON_MESSAGE,this.onMessage),this.ws.on(an.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(i){const s=this.requestId++;return i.requestId=s,i.seq=s,this.ws.sendMessage(i),s}waitStatus(i){return new et((s,o)=>{const d=window.setTimeout(()=>{o(new Ce(se.TIMEOUT,"wait status timeout, status: ".concat(i)))},5e3);this.once(i,h=>{window.clearTimeout(d),h.state&&h.state!==0?o(new Ce(se.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(i))):s(void 0)}),this.once("dispose",()=>{window.clearTimeout(d),o(new Ce(se.WS_ABORT))})})}async request(i){if(this.ws.state==="closed")throw new Ce(se.WS_DISCONNECT);const s=()=>new et((f,g)=>{this.ws.once(an.CLOSED,()=>g(new Ce(se.WS_ABORT))),this.ws.once(an.CONNECTED,f)});this.ws.state!=="connected"&&await s();const o=this.sendMessage(i),d=new et((f,g)=>{const y=()=>{g(new Ce(se.WS_ABORT))};this.ws.once(an.RECONNECTING,y),this.ws.once(an.CLOSED,y),this.once("req_".concat(o),f),As(3e3).then(()=>{this.removeAllListeners("req_".concat(o)),this.ws.off(an.RECONNECTING,y),this.ws.off(an.CLOSED,y),g(new Ce(se.TIMEOUT,"cross channel ws request timeout"))})}),h=await d;if(!h||h.code!==200)throw new Ce(se.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(h)));return h}async connect(i){this.ws.removeAllListeners(an.REQUEST_NEW_URLS),this.ws.on(an.REQUEST_NEW_URLS,s=>{s(i)}),await this.ws.init(i)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(i){const s=this.requestId++;return i.requestId=s,this.ws.sendMessage(i),s}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class qSe extends ai{set state(i){i!==this._state&&(i!==qc.RELAY_STATE_FAILURE&&(this.errorCode=Px.RELAY_OK),this.emit("state",i,this.errorCode),this._state=i)}get state(){return this._state}constructor(i,s,o,d,h){super(),Y(this,"joinInfo",void 0),Y(this,"sid",void 0),Y(this,"clientId",void 0),Y(this,"cancelToken",mc.CancelToken.source()),Y(this,"workerToken",void 0),Y(this,"requestId",0),Y(this,"signal",void 0),Y(this,"prevChannelMediaConfig",void 0),Y(this,"httpRetryConfig",void 0),Y(this,"_resolution",void 0),Y(this,"_state",qc.RELAY_STATE_IDLE),Y(this,"errorCode",Px.RELAY_OK),Y(this,"onStatus",f=>{M.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(f))),f&&f.command&&(f.command==="onAudioPacketReceived"&&this.emit("event",pm.PACKET_RECEIVED_AUDIO_FROM_SRC),f.command==="onVideoPacketReceived"&&this.emit("event",pm.PACKET_RECEIVED_VIDEO_FROM_SRC),f.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Px.SRC_TOKEN_EXPIRED,this.state=qc.RELAY_STATE_FAILURE),f.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Px.DEST_TOKEN_EXPIRED,this.state=qc.RELAY_STATE_FAILURE))}),Y(this,"onReconnect",async()=>{M.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",pm.NETWORK_DISCONNECTED),this.state=qc.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(f=>{this.state!==qc.RELAY_STATE_IDLE&&(M.error("auto restart channel media relay failed",f.toString()),this.errorCode=Px.SERVER_CONNECTION_LOST,this.state=qc.RELAY_STATE_FAILURE)})}),this.joinInfo=i,this.clientId=s,this.sid=fy(),this.signal=new KSe(this.joinInfo,this.clientId,o),this.httpRetryConfig=d,this._resolution=h}async startChannelMediaRelay(i){if(this.state!==qc.RELAY_STATE_IDLE)throw new Ce(se.INVALID_OPERATION);this.state=qc.RELAY_STATE_CONNECTING,await this.connect(),M.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(i)}catch(s){throw s.data&&s.data.serverResponse&&s.data.serverResponse.command==="SetSourceChannel"?new Ce(se.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&s.serverResponse.command==="SetDestChannelStatus"?new Ce(se.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&s.serverResponse.command==="StartPacketTransfer"?new Ce(se.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}this.prevChannelMediaConfig=i}async updateChannelMediaRelay(i){if(this.state!==qc.RELAY_STATE_RUNNING)throw new Ce(se.INVALID_OPERATION);await this.sendUpdateMessage(i),this.prevChannelMediaConfig=i}async setVideoProfile(i){if(this._resolution=i,this.state!==qc.RELAY_STATE_RUNNING)throw new Ce(se.INVALID_OPERATION);const s=this.genMessage(yc.SetVideoProfile);await this.signal.request(s),M.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),M.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=qc.RELAY_STATE_IDLE,this.dispose()}dispose(){M.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=mc.CancelToken.source(),this.state=qc.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const i=await ewe(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=i.workerToken,await this.signal.connect(i.addressList),this.emit("event",pm.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(i){const s=this.genMessage(yc.SetSdkProfile,i);await this.signal.request(s),M.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const o=this.genMessage(yc.SetSourceChannel,i);await this.signal.request(o),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",pm.PACKET_JOINED_SRC_CHANNEL),M.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const d=this.genMessage(yc.SetSourceUserId,i);await this.signal.request(d),M.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(yc.SetDestChannel,i);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",pm.PACKET_JOINED_DEST_CHANNEL),M.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const f=this.genMessage(yc.StartPacketTransfer,i);await this.signal.request(f),this.emit("event",pm.PACKET_SENT_TO_DEST_CHANNEL),this.state=qc.RELAY_STATE_RUNNING,M.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(i){const s=this.genMessage(yc.UpdateDestChannel,i);await this.signal.request(s),this.emit("event",pm.PACKET_UPDATE_DEST_CHANNEL),M.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const i=this.genMessage(yc.StopPacketTransfer);await this.signal.request(i),M.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(i,s){const o=[],d=[],h=[];this.requestId+=1;const f={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Pd,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};f.sdkVersion==="4.24.2"&&(f.sdkVersion="0.0.1");let g=null,y=null;switch(i){case yc.SetSdkProfile:return f.clientRequest={command:"SetSdkProfile",type:"multi_channel"},f;case yc.SetSourceChannel:if(y=s&&s.getSrcChannelMediaInfo(),!y)throw new Ce(se.UNEXPECTED_ERROR,"can not find source config");return f.clientRequest={command:"SetSourceChannel",uid:"0",channelName:y.channelName,token:y.token||this.joinInfo.appId},f;case yc.SetSourceUserId:if(y=s&&s.getSrcChannelMediaInfo(),!y)throw new Ce(se.UNEXPECTED_ERROR,"can not find source config");return f.clientRequest={command:"SetSourceUserId",uid:y.uid+""},f;case yc.SetDestChannel:if(g=s&&s.getDestChannelMediaInfo(),!g)throw new Ce(se.UNEXPECTED_ERROR,"can not find dest config");return g.forEach(x=>{o.push(x.channelName),d.push(x.uid+""),h.push(x.token||this.joinInfo.appId)}),f.clientRequest={command:"SetDestChannel",channelName:o,uid:d,token:h},f;case yc.StartPacketTransfer:return f.clientRequest={command:"StartPacketTransfer"},f;case yc.Reconnect:return f.clientRequest={command:"Reconnect"},f;case yc.StopPacketTransfer:return f.clientRequest={command:"StopPacketTransfer"},f;case yc.UpdateDestChannel:if(g=s&&s.getDestChannelMediaInfo(),!g)throw new Ce(se.UNEXPECTED_ERROR,"can not find dest config");return g.forEach(x=>{o.push(x.channelName),d.push(x.uid+""),h.push(x.token||this.joinInfo.appId)}),f.clientRequest={command:"UpdateDestChannel",channelName:o,uid:d,token:h},f;case yc.SetVideoProfile:f.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return f}}const YSe={name:"ChannelMediaRelay",create:function(n){return new qSe(n.joinInfo,n.clientId,n.websocketRetryConfig||Gi,n.httpRetryConfig||Gi,n.resolution)}};function uee(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function VR(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?uee(Object(s),!0).forEach(function(o){Y(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):uee(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}class $Se extends ai{constructor(i,s,o,d){super(),Y(this,"spec",void 0),Y(this,"token",void 0),Y(this,"websocket",void 0),Y(this,"pingpongTimer",void 0),Y(this,"reconnectMode","retry"),Y(this,"serviceMode",void 0),Y(this,"reqId",0),Y(this,"commandReqId",0),Y(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),Y(this,"handleWebSocketMessage",h=>{if(!h.data)return;const f=JSON.parse(h.data);f.requestId?this.emit("@".concat(f.requestId,"-").concat(f.sid),f):(_t.workerEvent(this.spec.sid,{actionType:"status",serverCode:f.code,workerType:this.serviceMode===hm.TRANSCODE?1:2}),this.emit(qg.PUBLISH_STREAM_STATUS,f))}),this.spec=s,this.token=i,this.serviceMode=d,this.websocket=new cR("live-streaming",o),this.websocket.on(an.CONNECTED,this.handleWebSocketOpen),this.websocket.on(an.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(an.REQUEST_NEW_URLS,(h,f)=>{rs(this,qg.REQUEST_NEW_ADDRESS).then(h).catch(f)}),this.websocket.on(an.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(i){return this.websocket.init(i)}async request(i,s,o,d){this.reqId+=1,i==="request"&&(this.commandReqId+=1);const h=this.commandReqId,f=this.reqId;if(!f||!this.websocket)throw new Ce(se.UNEXPECTED_ERROR);const g=VR({command:i,sdkVersion:Pd==="4.24.2"?"0.0.1":Pd,seq:f,requestId:f,allocate:o,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},s);if(this.websocket.state==="closed")throw new Ce(se.WS_DISCONNECT);const y=()=>new et((I,D)=>{this.websocket.once(an.CLOSED,()=>D(new Ce(se.WS_ABORT))),this.websocket.once(an.CONNECTED,I)});this.websocket.state!=="connected"&&await y(),g.clientRequest&&(g.clientRequest.workerToken=this.token);const x=new et((I,D)=>{const $=()=>{D(new Ce(se.WS_ABORT))};this.websocket.once(an.RECONNECTING,$),this.websocket.once(an.CLOSED,$),this.once("@".concat(f,"-").concat(this.spec.sid),z=>{I(z)})});d&&_t.workerEvent(this.spec.sid,VR(VR({},d),{},{requestId:h,actionType:"request",payload:JSON.stringify(s.clientRequest),serverCode:0,code:0}));const b=Date.now();this.websocket.sendMessage(g);let N=null;try{N=await x}catch(I){if(this.websocket.state==="closed")throw I;return await y(),await this.request(i,s,o)}return d&&_t.workerEvent(this.spec.sid,VR(VR({},d),{},{requestId:h,actionType:"response",payload:JSON.stringify(N.serverResponse),serverCode:N.code,success:N.code===200,responseTime:Date.now()-b})),N.code!==200&&this.handleResponseError(N),N}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const i=Pd==="4.24.2"?"0.0.1":Pd;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:i,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(i){switch(i.code){case _s.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void M.warning("live stream response already exists stream");case _s.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case _s.LIVE_STREAM_RESPONSE_BAD_STREAM:case _s.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Ce(se.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:i.code}).throw();case _s.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(i.serverResponse.command==="UnpublishStream")return;throw new Ce(se.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case _s.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Ce(se.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:i.code}).throw();case _s.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const s=new Ce(se.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(qg.WARNING,s,i.serverResponse.url)}case _s.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const s=new Ce(se.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(qg.WARNING,s,i.serverResponse.url)}case _s.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Ce(se.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case _s.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Ce(se.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:i.code}).throw();case _s.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const s=new Ce(se.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(qg.WARNING,s,i.serverResponse.url)}case _s.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Ce(se.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:i.code}).throw();case _s.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Ce(se.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case _s.LIVE_STREAM_RESPONSE_WORKER_LOST:case _s.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(i.serverResponse.command==="UnpublishStream")return;throw new Ce(se.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case _s.ERROR_FAIL_SEND_MESSAGE:if(i.serverResponse.command==="UnpublishStream")return;if(i.serverResponse.command==="UpdateTranscoding"||i.serverResponse.command==="ControlStream")return new Ce(se.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:i.code}).throw();throw new Ce(se.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case _s.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case _s.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case _s.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case _s.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Ce(se.LIVE_STREAMING_CDN_ERROR,"",{code:i.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(eR)},6e3)}}function hee(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function $c(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?hee(Object(s),!0).forEach(function(o){Y(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):hee(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}class XSe extends ai{constructor(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Gi,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Gi;super(),Y(this,"onLiveStreamWarning",void 0),Y(this,"onLiveStreamError",void 0),Y(this,"spec",void 0),Y(this,"retryTimeout",1e4),Y(this,"connection",void 0),Y(this,"httpRetryConfig",void 0),Y(this,"wsRetryConfig",void 0),Y(this,"streamingTasks",new Map),Y(this,"isStartingStreamingTask",!1),Y(this,"taskMutex",new qs("live-streaming")),Y(this,"cancelToken",mc.CancelToken.source()),Y(this,"transcodingConfig",void 0),Y(this,"uapResponse",void 0),Y(this,"lastTaskId",1),Y(this,"statusError",new Map),this.spec=i,this.httpRetryConfig=o,this.wsRetryConfig=s}async setTranscodingConfig(i){const s=$c($c({},Dbe),i);s.videoCodecProfile!==66&&s.videoCodecProfile!==77&&s.videoCodecProfile!==100&&(M.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=s.transcodingUsers.map(f=>$c($c($c({},Pbe),f),{},{zOrder:f.zOrder?f.zOrder+1:1}))),function(f){bi(f.width)||Sr(f.width,"config.width",0,1e4),bi(f.height)||Sr(f.height,"config.height",0,1e4),bi(f.videoBitrate)||Sr(f.videoBitrate,"config.videoBitrate",1,1e6),bi(f.videoFrameRate)||Sr(f.videoFrameRate,"config.videoFrameRate"),bi(f.lowLatency)||Pu(f.lowLatency,"config.lowLatency"),bi(f.audioSampleRate)||zi(f.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),bi(f.audioBitrate)||Sr(f.audioBitrate,"config.audioBitrate",1,128),bi(f.audioChannels)||zi(f.audioChannels,"config.audioChannels",[1,2,3,4,5]),bi(f.videoGop)||Sr(f.videoGop,"config.videoGop"),bi(f.videoCodecProfile)||zi(f.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),bi(f.userCount)||Sr(f.userCount,"config.userCount",0,17),bi(f.backgroundColor)||Sr(f.backgroundColor,"config.backgroundColor",0,16777215),bi(f.userConfigExtraInfo)||la(f.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),f.transcodingUsers&&!bi(f.transcodingUsers)&&(dm(f.transcodingUsers,"config.transcodingUsers"),f.transcodingUsers.forEach((g,y)=>{uP(g.uid),bi(g.x)||Sr(g.x,"transcodingUser[".concat(y,"].x"),0,1e4),bi(g.y)||Sr(g.y,"transcodingUser[".concat(y,"].y"),0,1e4),bi(g.width)||Sr(g.width,"transcodingUser[".concat(y,"].width"),0,1e4),bi(g.height)||Sr(g.height,"transcodingUser[".concat(y,"].height"),0,1e4),bi(g.zOrder)||Sr(g.zOrder-1,"transcodingUser[".concat(y,"].zOrder"),0,100),bi(g.alpha)||Sr(g.alpha,"transcodingUser[".concat(y,"].alpha"),0,1,!1)})),bi(f.watermark)||U4(f.watermark,"watermark"),bi(f.backgroundImage)||U4(f.backgroundImage,"backgroundImage"),f.images&&!bi(f.images)&&(dm(f.images,"config.images"),f.images.forEach((g,y)=>{U4(g,"images[".concat(y,"]"))}))}(s);const o=[];s.images&&o.push(...s.images.map(f=>$c($c($c({},M4),f),{},{zOrder:255}))),s.backgroundImage&&(o.push($c($c($c({},M4),s.backgroundImage),{},{zOrder:0})),delete s.backgroundImage),s.watermark&&(o.push($c($c($c({},M4),s.watermark),{},{zOrder:255})),delete s.watermark),s.images=o,s.transcodingUsers&&(s.userConfigs=s.transcodingUsers.map(f=>$c({},f)),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);const d=(s.userConfigs||[]).map(f=>typeof f.uid=="number"?et.resolve(f.uid):PJ(f.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await et.all(d)).forEach((f,g)=>{s.userConfigs&&s.userConfigs[g]&&(s.userConfigs[g].uid=f)}),this.transcodingConfig=s,this.connection)try{var h;const f=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(pc(h=this.streamingTasks).call(h)).map(g=>g.taskId).join("#")});M.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(f.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(f){if(!f.data||!f.data.retry)throw f;f.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(g=>{M.warning("[".concat(this.spec.clientId,"] live streaming receive error"),f.toString(),"try to republish",g.url),this.startLiveStreamingTask(g.url,g.mode,f).then(()=>{M.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(g.url," success"))}).catch(y=>{M.error("[".concat(this.spec.clientId,"] live streaming republish failed"),g.url,y.toString()),this.onLiveStreamError&&this.onLiveStreamError(g.url,y)})})}}async startLiveStreamingTask(i,s,o){if(!this.transcodingConfig&&s===hm.TRANSCODE)throw new Ce(se.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const d={command:"PublishStream",ts:Date.now(),url:i,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};M.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(i,", mode: ").concat(s));const h=await this.taskMutex.lock();if(!this.connection&&o)return void h();if(this.streamingTasks.get(i)&&!o)return h(),new Ce(se.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(s))}catch(g){throw h(),g}switch(s){case hm.TRANSCODE:d.transcodingConfig=$c({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(d.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const f=this.lastTaskId++;try{const g=new et((x,b)=>{As(this.retryTimeout).then(()=>{if(o)return b(o);const N=this.statusError.get(i);return N?(this.statusError.delete(i),b(N)):void 0})}),y=await et.race([this.connection.request("request",{clientRequest:d},!0,{url:i,command:"PublishStream",workerType:s===hm.TRANSCODE?1:2,requestByUser:!o,tid:f.toString()}),g]);this.isStartingStreamingTask=!1,M.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(y.code)),this.streamingTasks.set(i,{clientRequest:d,mode:s,url:i,taskId:f}),h()}catch(g){if(h(),this.isStartingStreamingTask=!1,!g.data||!g.data.retry||o)throw g;return g.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(i,s,g)):await this.startLiveStreamingTask(i,s,g)}}stopLiveStreamingTask(i){return new et((s,o)=>{const d=this.streamingTasks.get(i);if(!d||!this.connection)return new Ce(se.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const h=d.mode;d.abortTask=()=>{M.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(i),s()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:d.url}},!1,{url:i,command:"UnPublishStream",workerType:h===hm.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(f=>{M.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(f.code)),this.streamingTasks.delete(i),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),s()}).catch(o)})}resetAllTask(){var i;const s=Array.from(pc(i=this.streamingTasks).call(i));this.terminate();for(const o of s)this.startLiveStreamingTask(o.url,o.mode).catch(d=>{this.onLiveStreamError&&this.onLiveStreamError(o.url,d)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=mc.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(i){if(this.connection)throw new Ce(se.UNEXPECTED_ERROR,"live streaming connection has already connected");const s=await rs(this,V4.REQUEST_WORKER_MANAGER_LIST,i);return this.uapResponse=s,this.connection=new $Se(s.workerToken,this.spec,this.wsRetryConfig,i),this.connection.on(qg.WARNING,(o,d)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(d,o)),this.connection.on(qg.PUBLISH_STREAM_STATUS,o=>this.handlePublishStreamServer(o)),this.connection.on(qg.REQUEST_NEW_ADDRESS,(o,d)=>{if(!this.connection)return d(new Ce(se.UNEXPECTED_ERROR,"can not get new live streaming address list"));rs(this,V4.REQUEST_WORKER_MANAGER_LIST,i).then(h=>{this.uapResponse=h,o(h.addressList)}).catch(d)}),await this.connection.init(s.addressList),this.connection}handlePublishStreamServer(i){const s=i.serverStatus&&i.serverStatus.url||"empty_url",o=this.streamingTasks.get(s),d=i.reason;switch(i.code){case _s.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case _s.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case _s.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case _s.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const f=new Ce(se.LIVE_STREAMING_CDN_ERROR,"",{code:i.code});if(o)return M.error(f.toString()),this.onLiveStreamError&&this.onLiveStreamError(s,f);if(!this.isStartingStreamingTask)return;this.statusError.set(s,f)}case _s.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const f=new Ce(se.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,d);return this.onLiveStreamWarning&&this.onLiveStreamWarning(s,f)}case _s.LIVE_STREAM_RESPONSE_WORKER_LOST:case _s.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var h;if(!this.connection)return;this.connection.tryNextAddress();const f=Array.from(pc(h=this.streamingTasks).call(h));for(const g of f)g.abortTask?g.abortTask():(M.warning("[".concat(this.spec.clientId,"] publish stream status code"),i.code,"try to republish",g.url),this.startLiveStreamingTask(g.url,g.mode,new Ce(se.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:i.code})).then(()=>{M.debug("[".concat(this.spec.clientId,"] republish live stream success"),g.url)}).catch(y=>{M.error(y.toString()),this.onLiveStreamError&&this.onLiveStreamError(g.url,y)}));return}}}hasUrl(i){return this.streamingTasks.has(i)}}const JSe={name:"LiveStreaming",create:function(n){return new XSe(n.joinInfo,n.websocketRetryConfig||Gi,n.httpRetryConfig||Gi)}};function QSe(n){let i=mee();return function(s,o){let d=s.appId;d!==void 0&&(mr(o,10),hf(o,d));let h=s.cid;h!==void 0&&(mr(o,16),mr(o,h));let f=s.cname;f!==void 0&&(mr(o,26),hf(o,f));let g=s.deviceId;g!==void 0&&(mr(o,34),hf(o,g));let y=s.elapse;y!==void 0&&(mr(o,40),a_(o,y));let x=s.fileSize;x!==void 0&&(mr(o,48),a_(o,Xx(x)));let b=s.height;b!==void 0&&(mr(o,56),a_(o,Xx(b)));let N=s.jpg;N!==void 0&&(mr(o,66),mr(o,N.length),function(ei,Ue){let Qe=Jx(ei,Ue.length);ei.bytes.set(Ue,Qe)}(o,N));let I=s.networkType;I!==void 0&&(mr(o,72),a_(o,Xx(I)));let D=s.osType;D!==void 0&&(mr(o,80),a_(o,Xx(D)));let $=s.requestId;$!==void 0&&(mr(o,90),hf(o,$));let z=s.sdkVersion;z!==void 0&&(mr(o,98),hf(o,z));let K=s.sequence;K!==void 0&&(mr(o,104),a_(o,Xx(K)));let ie=s.sid;ie!==void 0&&(mr(o,114),hf(o,ie));let oe=s.timestamp;oe!==void 0&&(mr(o,120),a_(o,oe));let fe=s.uid;fe!==void 0&&(mr(o,128),mr(o,fe));let Ee=s.vid;Ee!==void 0&&(mr(o,136),mr(o,Ee));let Te=s.width;Te!==void 0&&(mr(o,144),a_(o,Xx(Te)));let _e=s.service;_e!==void 0&&(mr(o,152),mr(o,_e));let Re=s.callbackData;Re!==void 0&&(mr(o,162),hf(o,Re));let je=s.jpgEncryption;je!==void 0&&(mr(o,168),mr(o,je));let Be=s.requestType;Be!==void 0&&(mr(o,176),mr(o,Be));let dt=s.scorePorn;dt!==void 0&&(mr(o,185),Z3(o,dt));let Ht=s.scoreSexy;Ht!==void 0&&(mr(o,193),Z3(o,Ht));let Bt=s.scoreNeutral;Bt!==void 0&&(mr(o,201),Z3(o,Bt));let dn=s.scene;dn!==void 0&&(mr(o,208),mr(o,dn));let sn=s.ossFilePrefix;sn!==void 0&&(mr(o,218),hf(o,sn));let Qn=s.serviceVendor;if(Qn!==void 0)for(let ei of Qn){mr(o,226);let Ue=mee();tTe(ei,Ue),mr(o,Ue.limit),sTe(o,Ue),iTe(Ue)}}(n,i),function(s){let o=s.bytes,d=s.limit;return o.length===d?o:o.subarray(0,d)}(i)}function ZSe(n){return function(s){let o={};e:for(;!gee(s);){let d=pf(s);switch(d>>>3){case 0:break e;case 1:o.code=pf(s);break;case 2:o.msg=_ee(s,pf(s));break;case 3:{let h=nTe(s);o.data=eTe(s),s.limit=h;break}default:pee(s,7&d)}}return o}({bytes:i=n,offset:0,limit:i.length});var i}function eTe(n){let i={};e:for(;!gee(n);){let s=pf(n);switch(s>>>3){case 0:break e;case 1:i.requestId=_ee(n,pf(n));break;case 2:i.requestType=pf(n)>>>0;break;case 3:i.scorePorn=Q3(n);break;case 4:i.scoreSexy=Q3(n);break;case 5:i.scoreNeutral=Q3(n);break;case 6:i.requestScene=pf(n)>>>0;break;case 7:i.scene=pf(n)>>>0;break;default:pee(n,7&s)}}return i}function tTe(n,i){let s=n.service;s!==void 0&&(mr(i,8),mr(i,s));let o=n.vendor;o!==void 0&&(mr(i,16),mr(i,o));let d=n.token;d!==void 0&&(mr(i,26),hf(i,d));let h=n.callbackUrl;h!==void 0&&(mr(i,34),hf(i,h))}function nTe(n){let i=pf(n),s=n.limit;return n.limit=n.offset+i,s}function pee(n,i){switch(i){case 0:for(;128&yee(n););break;case 2:X3(n,pf(n));break;case 5:X3(n,4);break;case 1:X3(n,8);break;default:throw new Error("Unimplemented type: "+i)}}let rTe=new Float32Array(1);new Uint8Array(rTe.buffer);let $3=new Float64Array(1),Xc=new Uint8Array($3.buffer);function Xx(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}let fee=[];function mee(){const n=fee.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}function iTe(n){fee.push(n)}function X3(n,i){if(n.offset+i>n.limit)throw new Error("Skip past limit");n.offset+=i}function gee(n){return n.offset>=n.limit}function Jx(n,i){let s=n.bytes,o=n.offset,d=n.limit,h=o+i;if(h>s.length){let f=new Uint8Array(2*h);f.set(s),n.bytes=f}return n.offset=h,h>d&&(n.limit=h),o}function J3(n,i){let s=n.offset;if(s+i>n.limit)throw new Error("Read past limit");return n.offset+=i,s}function _ee(n,i){let s=J3(n,i),o=String.fromCharCode,d=n.bytes,h="",f="";for(let g=0;g<i;g++){let y,x,b,N,I=d[g+s];128&I?(224&I)==192?g+1>=i?f+=h:(y=d[g+s+1],(192&y)!=128?f+=h:(N=(31&I)<<6|63&y,N<128?f+=h:(f+=o(N),g++))):(240&I)==224?g+2>=i?f+=h:(y=d[g+s+1],x=d[g+s+2],(49344&(y|x<<8))!=32896?f+=h:(N=(15&I)<<12|(63&y)<<6|63&x,N<2048||N>=55296&&N<=57343?f+=h:(f+=o(N),g+=2))):(248&I)==240?g+3>=i?f+=h:(y=d[g+s+1],x=d[g+s+2],b=d[g+s+3],(12632256&(y|x<<8|b<<16))!=8421504?f+=h:(N=(7&I)<<18|(63&y)<<12|(63&x)<<6|63&b,N<65536||N>1114111?f+=h:(N-=65536,f+=o(55296+(N>>10),56320+(1023&N)),g+=3))):f+=h:f+=o(I)}return f}function hf(n,i){let s=i.length,o=0;for(let f=0;f<s;f++){let g=i.charCodeAt(f);g>=55296&&g<=56319&&f+1<s&&(g=(g<<10)+i.charCodeAt(++f)-56613888),o+=g<128?1:g<2048?2:g<65536?3:4}mr(n,o);let d=Jx(n,o),h=n.bytes;for(let f=0;f<s;f++){let g=i.charCodeAt(f);g>=55296&&g<=56319&&f+1<s&&(g=(g<<10)+i.charCodeAt(++f)-56613888),g<128?h[d++]=g:(g<2048?h[d++]=g>>6&31|192:(g<65536?h[d++]=g>>12&15|224:(h[d++]=g>>18&7|240,h[d++]=g>>12&63|128),h[d++]=g>>6&63|128),h[d++]=63&g|128)}}function sTe(n,i){let s=Jx(n,i.limit),o=n.bytes,d=i.bytes;for(let h=0,f=i.limit;h<f;h++)o[h+s]=d[h]}function yee(n){return n.bytes[J3(n,1)]}function vee(n,i){let s=Jx(n,1);n.bytes[s]=i}function Q3(n){let i=J3(n,8),s=n.bytes;return Xc[0]=s[i++],Xc[1]=s[i++],Xc[2]=s[i++],Xc[3]=s[i++],Xc[4]=s[i++],Xc[5]=s[i++],Xc[6]=s[i++],Xc[7]=s[i++],$3[0]}function Z3(n,i){let s=Jx(n,8),o=n.bytes;$3[0]=i,o[s++]=Xc[0],o[s++]=Xc[1],o[s++]=Xc[2],o[s++]=Xc[3],o[s++]=Xc[4],o[s++]=Xc[5],o[s++]=Xc[6],o[s++]=Xc[7]}function pf(n){let i,s=0,o=0;do i=yee(n),s<32&&(o|=(127&i)<<s),s+=7;while(128&i);return o}function mr(n,i){for(i>>>=0;i>=128;)vee(n,127&i|128),i>>>=7;vee(n,i)}function a_(n,i){let s=i.low>>>0,o=(i.low>>>28|i.high<<4)>>>0,d=i.high>>>24,h=d===0?o===0?s<16384?s<128?1:2:s<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:d<128?9:10,f=Jx(n,h),g=n.bytes;switch(h){case 10:g[f+9]=d>>>7&1;case 9:g[f+8]=h!==9?128|d:127&d;case 8:g[f+7]=h!==8?o>>>21|128:o>>>21&127;case 7:g[f+6]=h!==7?o>>>14|128:o>>>14&127;case 6:g[f+5]=h!==6?o>>>7|128:o>>>7&127;case 5:g[f+4]=h!==5?128|o:127&o;case 4:g[f+3]=h!==4?s>>>21|128:s>>>21&127;case 3:g[f+2]=h!==3?s>>>14|128:s>>>14&127;case 2:g[f+1]=h!==2?s>>>7|128:s>>>7&127;case 1:g[f]=h!==1?128|s:127&s}}function Eee(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}const aTe=new Map([["moderation",1],["supervise",2]]);class oTe extends ai{get connectionState(){return this._connectionState}set connectionState(i){if(this._connectionState===i)return;const s=this._connectionState;this._connectionState=i,this.emit($s.CONNECTION_STATE_CHANGE,s,i)}get inspectType(){return this._inspectType}set inspectType(i){var s;this._inspectMode=lc(s=i.map(o=>aTe.get(o)||0)).call(s,(o,d)=>o+d),this._inspectType=i}get quality(){return this._quality}set quality(i){this._quality=i>1?1:i<.1?.1:i,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(i){super(),Y(this,"name","AgoraRTCVideoContentInspect"),Y(this,"_connectionState",Mu.CONNECTING),Y(this,"_innerConnectionState",void 0),Y(this,"sequence",0),Y(this,"inspectStartTime",void 0),Y(this,"workerManagerConnection",void 0),Y(this,"workerConnection",void 0),Y(this,"workerMessageLengthLimit",void 0),Y(this,"inspectIntervalMinimum",void 0),Y(this,"qualityRatio",void 0),Y(this,"_connectInfo",void 0),Y(this,"_cancelTokenSource",mc.CancelToken.source()),Y(this,"_retryConfig",void 0),Y(this,"wmSequence",0),Y(this,"inspectInterval",void 0),Y(this,"inspectTimer",null),Y(this,"ossFilePrefix",void 0),Y(this,"extraInfo",void 0),Y(this,"_inspectType",void 0),Y(this,"_inspectMode",void 0),Y(this,"_quality",1),Y(this,"qualityTimer",null),Y(this,"_inspectId",void 0),Y(this,"_needWorkUrlOnly",!1),Y(this,"inspectImage",()=>{if(this.connectionState!==Mu.CONNECTED)throw new Ce(se.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Mu.CONNECTED?this.requestToInspectImage():M.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=dr(5,"inspect-"),this.workerMessageLengthLimit=re("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=re("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=re("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=i.interval,this.ossFilePrefix=i.ossFilePrefix,this.extraInfo=i.extraInfo,this.inspectType=i.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new cR("worker-manager-"+this._inspectId,Gi),this.on($s.STATE_CHANGE,(s,o)=>{this._innerConnectionState=s,M.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Uu[s]," ").concat(o||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new cR("worker-"+this._inspectId,Gi),this.handleWorkerEvents()}async init(i,s){this.emit($s.STATE_CHANGE,Uu.CONNECT_AP),this._connectInfo=i;const o=this._cancelTokenSource.token;return this._retryConfig=s,new et((d,h)=>{this.on($s.CONNECTION_STATE_CHANGE,(f,g)=>{g===Mu.CONNECTED&&d()}),this.requestAP(i,o,s).then(f=>{this.connectWorkerManager(f)}).catch(f=>{h(f)})})}async requestAP(i,s,o){const d=re("WEBCS_DOMAIN").map(g=>"https://".concat(g,"/api/v1")),h=await function(g,y,x,b){let{appId:N,areaCode:I,cname:D,sid:$,token:z,uid:K}=y;Ux++;const ie="image_moderation_api",oe={service_name:ie,json_body:JSON.stringify({appId:N,areaCode:I,cname:D,command:"allocateEdge",requestId:Ux,seq:Ux,sid:$,token:z,ts:Date.now(),uid:K+""})};let fe,Ee,Te=g[0];return Dh(async()=>{fe=Date.now();const _e=await Vh(Te,{data:oe,cancelToken:x,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Ee=Date.now()-fe,_e.code!==0){const Bt=new Ce(se.UNEXPECTED_RESPONSE,"image inspect ap error, code"+_e.code,{retry:!0,responseTime:Ee});throw M.error(Bt.toString()),Bt}const Re=JSON.parse(_e.json_body);if(Re.code!==200){const Bt=new Ce(se.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Re.code,", reason: ").concat(Re.reason),{code:Re.code,responseTime:Ee});throw M.error(Bt.toString()),Bt}if(!Re.servers||!Array.isArray(Re.servers)||Re.servers.length===0){const Bt=new Ce(se.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Re.code,responseTime:Ee});throw M.error(Bt.toString()),Bt}const je=re("VIDEO_INSPECT_WORKER_MANAGER_WSS");if(je)return{addressList:[je],workerToken:Re.workerToken,vid:Re.vid,responseTime:Ee};const Be=re("VIDEO_INSPECT_WORKER_MANAGER_HOST"),dt=re("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Re.servers.map(Bt=>{let{address:dn,wss:sn}=Bt;if(dn&&sn)return"wss://".concat(dn.replace(/\./g,"-"),".").concat(Be,":").concat(dt||sn)}).filter(Bt=>!!Bt),workerToken:Re.workerToken,vid:Re.vid,responseTime:Ee}},(_e,Re)=>(_t.apworkerEvent($,{success:!0,sc:200,serviceName:ie,responseDetail:JSON.stringify(_e.addressList),firstSuccess:Re===0,responseTime:Ee,serverIp:g[Re%g.length]}),!1),(_e,Re)=>(_t.apworkerEvent($,{success:!1,sc:_e.data&&_e.data.code||200,serviceName:ie,responseTime:Ee,serverIp:g[Re%g.length]}),!!(_e.code!==se.OPERATION_ABORTED&&_e.code!==se.UNEXPECTED_RESPONSE||_e.data&&_e.data.retry)&&(Te=g[(Re+1)%g.length],!0)),b)}(d,i,s,o);this.emit($s.STATE_CHANGE,Uu.AP_CONNECTED);const{addressList:f}=h;return this.wmSequence++,f}async connectWorkerManager(i){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=s,this.emit($s.STATE_CHANGE,Uu.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(i,1e4)}async connectWorker(i){await this.workerConnection.init([i])}handleWorkerManagerEvents(){this.workerManagerConnection.on(an.CONNECTED,async()=>{this.emit($s.STATE_CHANGE,Uu.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(an.CLOSED,()=>{this._innerConnectionState<Uu.GET_WORKER_MANAGER_RESPONSE&&M.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(an.FAILED,()=>{this._innerConnectionState<Uu.GET_WORKER_MANAGER_RESPONSE&&M.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(an.RECONNECTING,()=>{this._innerConnectionState<Uu.GET_WORKER_MANAGER_RESPONSE&&M.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(an.ON_MESSAGE,async i=>{this.emit($s.STATE_CHANGE,Uu.GET_WORKER_MANAGER_RESPONSE);const s=this.workerManagerConnection.url;this.workerManagerConnection.close();const o=JSON.parse(i.data);if(o.code!==200)throw M.error("[".concat(this._inspectId,"] Unexpected code ").concat(o.code," from worker manager")),new Ce(se.UNEXPECTED_RESPONSE,"response code of worker is unexpected",o);if(!(o.serverResponse&&o.serverResponse.portWss&&s))throw M.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(o))),new Ce(se.UNEXPECTED_RESPONSE,"response content of worker is unexpected",o);{const d=re("VIDEO_INSPECT_WORKER_PORT")||o.serverResponse.portWss,h=s.replace(/:\d+\/?$/,":".concat(d));this.emit($s.STATE_CHANGE,Uu.CONNECT_WORKER,h),this._needWorkUrlOnly?this.emit($s.REQUEST_NEW_WORKER_URL,h):await this.connectWorker(h)}}),this.workerManagerConnection.on(an.WILL_RECONNECT,(i,s,o)=>{o(i)}),this.workerManagerConnection.on(an.REQUEST_NEW_URLS,(i,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i).catch(s)})}handleWorkerEvents(){this.workerConnection.on(an.CONNECTED,async()=>{this.emit($s.STATE_CHANGE,Uu.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Mu.CONNECTED}),this.workerConnection.on(an.ON_MESSAGE,async i=>{if(i.data instanceof ArrayBuffer){const o=ZSe(new Uint8Array(i.data));if(re("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&M.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(o)),o.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit($s.INSPECT_RESULT,void 0,void 0);if(o.data&&o.data.scorePorn&&o.data.scoreSexy&&o.data.scoreNeutral){var s;const d={porn:o.data.scorePorn,sexy:o.data.scoreSexy,neutral:o.data.scoreNeutral},h=lc(s=Object.keys(d)).call(s,(g,y)=>d[g]>d[y]?g:y,"porn"),f=Object.keys(d).find(g=>g===h);this.emit($s.INSPECT_RESULT,f)}else this.emit($s.INSPECT_RESULT,void 0,new Ce(se.UNEXPECTED_RESPONSE,o.code+"","There is an unexpected data on message"))}else this.emit($s.INSPECT_RESULT,void 0,new Ce(se.UNEXPECTED_RESPONSE,o.code+"",o.msg))}else M.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit($s.INSPECT_RESULT,void 0,new Ce(se.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(an.CLOSED,()=>{this.connectionState=Mu.CLOSED}),this.workerConnection.on(an.FAILED,()=>{this.connectionState=Mu.CLOSED}),this.workerConnection.on(an.RECONNECTING,()=>{this.connectionState=this.connectionState===Mu.CONNECTED?Mu.RECONNECTING:Mu.CONNECTING}),this.workerConnection.on(an.WILL_RECONNECT,(i,s,o)=>{i==="recover"&&o(i),o("tryNext")}),this.workerConnection.on(an.REQUEST_NEW_URLS,(i,s)=>{this.workerManagerConnection.close(),this.once($s.REQUEST_NEW_WORKER_URL,o=>{i([o])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o=>{this.connectWorkerManager(o,!0)}).catch(o=>{s(o)})})}async requestToInspectImage(){this.sequence++;const i=El(this,$s.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(i){if(!i.isPlaying)return void this.emit($s.INSPECT_RESULT,void 0,new Ce(se.INVALID_OPERATION,"Only the track being played can be inspected"));const o=await this.generateRequestData(i,s);this.workerConnection.sendMessage(o,!0,!0)}else this.emit($s.INSPECT_RESULT,void 0,new Ce(se.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(i,s){let{appId:o,cname:d,cid:h,vid:f,sid:g,uid:y}=s;const x=Date.now(),b=await i.getCurrentFrameImage("image/jpeg",this.quality),N=await $Y(b,o,d),I=this.sequence+"-"+h+"-"+y+"-"+x+"-"+dr(12,""),D={appId:o,cid:h,cname:d,deviceId:"",elapse:($=Number(x-this.inspectStartTime),{low:$|=0,high:$>>31,unsigned:$>=0}),fileSize:N.byteLength,jpgEncryption:2,height:b.height,width:b.width,jpg:N,networkType:6,osType:7,requestId:I,sdkVersion:"4.24.2",sequence:this.sequence,sid:g,timestamp:SQ(x),uid:y,vid:f,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var $;this.extraInfo===void 0&&delete D.callbackData,this.ossFilePrefix===void 0&&delete D.ossFilePrefix;const z=QSe(D);if(z.byteLength<this.workerMessageLengthLimit){if(re("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const K=function(ie){for(var oe=1;oe<arguments.length;oe++){var fe=arguments[oe]!=null?arguments[oe]:{};oe%2?Eee(Object(fe),!0).forEach(function(Ee){Y(ie,Ee,fe[Ee])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ie,Object.getOwnPropertyDescriptors(fe)):Eee(Object(fe)).forEach(function(Ee){Object.defineProperty(ie,Ee,Object.getOwnPropertyDescriptor(fe,Ee))})}return ie}({},D);delete K.jpg,M.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(K))}return z}{const K=this.quality*this.qualityRatio;return this.quality=K,await this.generateRequestData(i,{appId:o,cname:d,cid:h,vid:f,sid:g,uid:y})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=mc.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Mu.CLOSED,this.emit($s.STATE_CHANGE,Uu.CLOSED)}}const cTe={name:"ContentInspect",create:function(n){let{config:i}=n;return function(s){if(!s)throw new Ce(se.INVALID_PARAMS,"inspectConfig is necessary.");if(!s.inspectType||!Array.isArray(s.inspectType))throw new Ce(se.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const o=[...new Set(s.inspectType)];o.forEach(d=>{var h;if(!Ge(h=["supervise","moderation"]).call(h,d))throw new Ce(se.INVALID_PARAMS,"".concat(d," is not a valid inspect type."))}),s.inspectType=o}if(s&&s.extraInfo&&s.extraInfo.length>1024)throw new Ce(se.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(i),new oTe(i)}};var xee=l(ds.Object.getOwnPropertySymbols),lTe=In,dTe=wd.indexOf,uTe=fu,eF=de([].indexOf),bee=!!eF&&1/eF([1],1,-0)<0;lTe({target:"Array",proto:!0,forced:bee||!uTe("indexOf")},{indexOf:function(n){var i=arguments.length>1?arguments[1]:void 0;return bee?eF(this,n,i)||0:dTe(this,n,i)}});var hTe=Co("Array","indexOf"),pTe=A,fTe=hTe,tF=Array.prototype,mTe=function(n){var i=n.indexOf;return n===tF||pTe(tF,n)&&i===tF.indexOf?fTe:i},wee=l(mTe);function gTe(n,i){if(n==null)return{};var s,o,d=function(f,g){if(f==null)return{};var y={};for(var x in f)if({}.hasOwnProperty.call(f,x)){if(wee(g).call(g,x)!==-1)continue;y[x]=f[x]}return y}(n,i);if(xee){var h=xee(n);for(o=0;o<h.length;o++)s=h[o],wee(i).call(i,s)===-1&&{}.propertyIsEnumerable.call(n,s)&&(d[s]=n[s])}return d}let See=class{get localCapabilities(){return qr(this._localCapabilities)}get rtpCapabilities(){return qr(this._rtpCapabilities)}get candidates(){return qr(this._candidates)}get iceParameters(){return qr(this._iceParameters)}get dtlsParameters(){return qr(this._dtlsParameters)}constructor(n){Y(this,"sessionDesc",void 0),Y(this,"_localCapabilities",void 0),Y(this,"_rtpCapabilities",void 0),Y(this,"_candidates",void 0),Y(this,"_iceParameters",void 0),Y(this,"_dtlsParameters",void 0),Y(this,"setup",void 0),Y(this,"currentMidIndex",void 0),Y(this,"cname","o/i14u9pJrxRKAsu"),Y(this,"firefoxSsrcMidMap",new Map),n=qr(n);const{remoteIceParameters:i,remoteDtlsParameters:s,candidates:o,remoteRTPCapabilities:d,localCapabilities:h,direction:f,setup:g,videoCodec:y,audioCodec:x}=n;let b;this.setup=g,b=f===Fo.RECEIVE_ONLY?Mo(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Mo(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=d,this._candidates=o,this._iceParameters=i,this._dtlsParameters=s,this._localCapabilities=h;const N=f===Fo.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,I=f===Fo.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,D=f===Fo.RECEIVE_ONLY?d.send.videoCodecs:fR(pt.VIDEO,N,I,y),$=f===Fo.RECEIVE_ONLY?d.send.audioCodecs:fR(pt.AUDIO,N,I,x);for(const z of b.mediaDescriptions)z.attributes.iceUfrag=i.iceUfrag,z.attributes.icePwd=i.icePwd,z.attributes.fingerprints=s.fingerprints,z.attributes.candidates=o,z.attributes.setup=this.setup,z.media.mediaType==="application"&&(z.attributes.sctpPort="5000"),z.media.mediaType==="video"&&(z.media.fmts=D.map(K=>K.payloadType.toString(10)),z.attributes.payloads=D,z.attributes.extmaps=N.videoExtensions),z.media.mediaType==="audio"&&(z.media.fmts=$.map(K=>K.payloadType.toString(10)),z.attributes.payloads=$,z.attributes.extmaps=N.audioExtensions,Mx(z));this.sessionDesc=b,this.currentMidIndex=b.mediaDescriptions.length-1}toString(){return um(this.sessionDesc)}hasMid(n){return Array.isArray(n)?n.every(i=>this.hasMid(i)):this.sessionDesc.mediaDescriptions.some(i=>i.attributes.mid===n)}send(n,i,s,o,d){s=s.replace(/ /g,"-");const{ssrcs:h,ssrcGroups:f}=hR(i,this.cname,re("SYNC_GROUP")?s:void 0),g=this.findPreloadMediaDesc(h);if(g){if(Kr()&&this.firefoxSsrcMidMap.set(h[0].ssrcId,g.attributes.mid),d&&(d.twcc||d.remb)){const y=this.sessionDesc.mediaDescriptions.indexOf(g);return this.sessionDesc.mediaDescriptions[y]=this.mungSendMediaDesc(g,d),{mid:g.attributes.mid,needExchangeSDP:!0}}return{mid:g.attributes.mid,needExchangeSDP:!1}}{const y=this.findAvailableMediaIndex(n,h,o);let x;return y===-1?(x=this.createOrRecycleSendMedia(n,h,f,"sendonly",o,d),this.updateBundleMids()):(x=qr(this.sessionDesc.mediaDescriptions[y]),x.attributes.direction="sendonly",x.attributes.ssrcs=h,x.attributes.ssrcGroups=f,this.sessionDesc.mediaDescriptions[y]=this.mungSendMediaDesc(x,d)),Kr()&&this.firefoxSsrcMidMap.set(h[0].ssrcId,x.attributes.mid),{needExchangeSDP:!0,mid:x.attributes.mid}}}stopSending(n){const i=this.sessionDesc.mediaDescriptions.filter(s=>s.attributes.mid&&n.indexOf(s.attributes.mid)!==-1);if(i.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");i.forEach(s=>{s.attributes.ssrcs=[]}),this.updateBundleMids()}receive(n,i,s){const o=[];return n.forEach(d=>{const h=d._mediaStreamTrack.kind,f=this.findAvailableRecvMediaIndex(h);let g,y=!1;f===-1?(y=!0,g=this.createOrRecycleRecvMedia(d,[],"recvonly",i,s),this.updateBundleMids()):(g=qr(this.sessionDesc.mediaDescriptions[f]),g.attributes.direction="recvonly"),o.push({mid:g.attributes.mid,needCreateTransceiver:y})}),o}stopReceiving(n){const i=this.sessionDesc.mediaDescriptions.filter(s=>n.indexOf(s.attributes.mid)!==-1);if(i.length!==n.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");i.forEach(s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(n){const{foundation:i,protocol:s,address:o,port:d,type:h,relatedAddress:f,relatedPort:g,priority:y}=new RTCIceCandidate(n),x={foundation:i??"",componentId:"1",transport:s??"",priority:y?y+"":"",connectionAddress:o??"",port:d?d+"":"",type:h?h+"":"",relAddr:f??"",relPort:g?g+"":"",extension:{}};this.candidates.some(b=>b.priority===x.priority&&b.connectionAddress===x.connectionAddress&&b.port===x.port)||(this._candidates.push(x),this.sessionDesc.mediaDescriptions.forEach(b=>{b.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(n,i,s,o,d){const h=n._mediaStreamTrack.kind,f=this.rtpCapabilities.recv,g=fR(h,f,this.localCapabilities.send,h===pt.AUDIO?d:o),y=h===pt.VIDEO?f.videoExtensions:f.audioExtensions,x="".concat(++this.currentMidIndex);let b={media:{mediaType:h,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:g.map(I=>I.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:i,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:g,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(x)}};b=this.mungRecvMediaDsec(b,n);const N=this.findFirstClosedMedia(h);if(N){const I=this.sessionDesc.mediaDescriptions.indexOf(N);this.sessionDesc.mediaDescriptions[I]=b}else this.sessionDesc.mediaDescriptions.push(b);return b}muteRemote(n){const i=this.sessionDesc.mediaDescriptions.filter(s=>Ge(n).call(n,s.attributes.mid||""));if(i.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");i.forEach(s=>{s.attributes.direction="inactive"})}unmuteRemote(n){const i=this.sessionDesc.mediaDescriptions.filter(s=>Ge(n).call(n,s.attributes.mid||""));if(i.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");i.forEach(s=>{s.attributes.direction="recvonly"})}findAvailableMediaIndex(n,i,s){return this.sessionDesc.mediaDescriptions.findIndex(o=>{const d=o.media.mediaType===n&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if(Kr()){if(d){const h=this.firefoxSsrcMidMap.get(i[0].ssrcId);return!(h||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!h||h!==o.attributes.mid)}return!1}return d&&o.attributes.mid===s})}findAvailableRecvMediaIndex(n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const s=i.media.mediaType===n&&i.media.port!=="0"&&(i.attributes.direction==="recvonly"||i.attributes.direction==="sendrecv");return i.attributes.mid!=="0"&&i.attributes.mid!=="1"&&s})}predictReceivingMids(n){const i=[];for(let s=0;s<n;s++)i.push((this.currentMidIndex+s+1).toString(10));return i}restartICE(n){n=qr(n),this._iceParameters=n,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=n.iceUfrag,i.attributes.icePwd=n.icePwd})}createOrRecycleSendMedia(n,i,s,o,d,h){const f=this.rtpCapabilities.send,g=n===pt.VIDEO?f.videoCodecs:f.audioCodecs,y=n===pt.VIDEO?f.videoExtensions:f.audioExtensions;Kr()&&(d="".concat(++this.currentMidIndex));let x={media:{mediaType:n,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:g.map(N=>N.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:i,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:g,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:d}};x=this.mungSendMediaDesc(x,h);const b=this.findFirstClosedMedia(n);if(b){const N=this.sessionDesc.mediaDescriptions.indexOf(b);this.sessionDesc.mediaDescriptions[N]=x}else this.sessionDesc.mediaDescriptions.push(x);return x}mungRecvMediaDsec(n,i,s){const o=qr(n);return q4(o),Cy(o,i),Y4(o,i),fJ(o),EP(o,s,this.localCapabilities.send),o}mungSendMediaDesc(n,i){const s=qr(n);return EP(s,i,this.localCapabilities.recv),Mx(s),s}updateRecvMedia(n,i){const s=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===n);if(s!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],i);this.sessionDesc.mediaDescriptions[s]=o}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(n=>n.media.port!=="0").map(n=>n.attributes.mid)}findPreloadMediaDesc(n){return this.sessionDesc.mediaDescriptions.find(i=>{var s;return((s=i.attributes)===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId)===n[0].ssrcId})}findFirstClosedMedia(n){return this.sessionDesc.mediaDescriptions.find(i=>Kr()?i.media.port==="0"&&i.media.mediaType===n:i.media.port==="0")}};const _Te=["sdp"];var Yr;function Tee(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function o_(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?Tee(Object(s),!0).forEach(function(o){Y(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):Tee(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}let Ree=(Yr=class mb extends XX{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var i,s;return(i=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&i!==void 0?i:null}get localCodecs(){return[]}set isInRestartIce(i){this._isInRestartIce=i}get isInRestartIce(){return this._isInRestartIce}constructor(i,s,o){super(i,s),Y(this,"direction",void 0),Y(this,"name",void 0),Y(this,"store",void 0),Y(this,"spec",void 0),Y(this,"peerConnection",void 0),Y(this,"initialOffer",void 0),Y(this,"transport",void 0),Y(this,"statsFilter",void 0),Y(this,"localCandidateCount",0),Y(this,"_isInRestartIce",!1),Y(this,"mutex",void 0),Y(this,"onLocalCandidate",void 0),Y(this,"remoteSDP",void 0),Y(this,"pendingCandidates",[]),Y(this,"localCapabilities",void 0),Y(this,"isReady",!1),Y(this,"restartCnt",0),Y(this,"curTurnServerIndex",0),this.store=s,this.spec=i,this.mutex=new qs("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(mb.resolvePCConfiguration(i,s.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=o??Fo.SEND_ONLY,this.name=this.direction===Fo.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=zk(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,Kr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(i){try{const s=await X4();if(this.localCapabilities=pR(s),i){const{sdp:o}=i,d=gTe(i,_Te),h=function(){const b={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},N=uR(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},$={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Fu(N,b,"videoExtensions",I,D,$),Fu(N,b,"videoCodecs",I,D,$),Fu(N,b,"audioExtensions",I,D,$),Fu(N,b,"audioCodecs",I,D,$),re("RAISE_H264_BASELINE_PRIORITY")){const z=$.videoCodecs.findIndex(K=>K.rtpMap&&K.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&K.fmtp&&K.fmtp.parameters["profile-level-id"]==="42001f");if(z!==-1){const K=$.videoCodecs.findIndex(ie=>ie.rtpMap&&ie.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(K<z){M.debug("raising H264 baseline profile priority");const ie=$.videoCodecs[z];$.videoCodecs.splice(z,1),$.videoCodecs.splice(K,0,ie)}K!==-1&&re("FILTER_SEND_H264_BASELINE")&&(I.videoCodecs=I.videoCodecs.filter(ie=>!(ie.rtpMap&&ie.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&ie.fmtp&&ie.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:I,recv:D,sendrecv:$}}({},{},o);this.remoteSDP=new See({remoteIceParameters:d.iceParameters,remoteDtlsParameters:d.dtlsParameters,candidates:[],remoteRTPCapabilities:h,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const f=await this.peerConnection.createAnswer();if(!f.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const g=rf(f.sdp);await this.peerConnection.setLocalDescription(f);const y=await gJ({},{},f.sdp);this.localCapabilities=pR(y);const x=this.peerConnection.getTransceivers()[0];return x!=null&&x.receiver&&x.receiver.transport&&this.tryBindTransportEvents(x.receiver.transport),o_(o_({},g),{},{sdp:f.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const d=rf(o.sdp);return this.initialOffer=o,o_(o_({},d),{},{sdp:o.sdp})}}catch(s){throw new Pe(se.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(i){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:s,iceParameters:o,dtlsParameters:d}=i,h=await gJ({},{},s);this.remoteSDP=new See({remoteIceParameters:o,remoteDtlsParameters:d,candidates:[],remoteRTPCapabilities:h,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const f=this.peerConnection.getTransceivers()[0];f!=null&&f.sender&&f.sender.transport&&this.tryBindTransportEvents(f.sender.transport)}catch(s){throw new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async addRemoteCandidate(i){try{i&&this.pendingCandidates.push(i),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(s=>{this.peerConnection.addIceCandidate(s)}),this.pendingCandidates=[])}catch(s){throw new Pe(se.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(s.toString()))}}send(i,s,o){var d=this;return fc(function*(){const h=yield hn(d.mutex.lock("From P2PConnection.send"));try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const f=[],g=d.remoteSDP.receive(i,s,o);i.forEach((K,ie)=>{if(g[ie].needCreateTransceiver){const oe=d.peerConnection.addTransceiver(K._mediaStreamTrack,{direction:"sendonly"});f.push(oe),K._updateRtpTransceiver(oe)}else{const oe=d.peerConnection.getTransceivers().find(fe=>fe.mid===g[ie].mid);if(!oe)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(g[ie].mid));f.push(oe),K._updateRtpTransceiver(oe)}}),Kr()&&re("SIMULCAST")===!0&&(yield hn(d.applySimulcastForFirefox(f,i)));const y=g.map(K=>K.mid),x=yield hn(d.peerConnection.createOffer()),b=d.mungSendOfferSDP(x.sdp,i,y),N=Mo(b),I=y.map(K=>{const ie=N.mediaDescriptions.find(oe=>oe.attributes.mid===K);if(!ie)throw new Error("Cannot extract ssrc from mediaDescription.");return K4(ie,re("USE_PUB_RTX"))}),D=f.map((K,ie)=>{const oe=y[ie];return{localSSRC:I[ie],id:oe}});yield hn(d.peerConnection.setLocalDescription({type:"offer",sdp:b}));try{yield D}catch(K){const ie=d.remoteSDP.toString();throw yield hn(d.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield hn(d.peerConnection.setRemoteDescription({type:"answer",sdp:ie})),yield hn(d.stopSending(y,!0)),K}yield hn(d.applySimulcastEncodings(f,i)),yield hn(d.applySendEncodings(f,i));const $=d.remoteSDP.toString(),z=d.logSDPExchange(b,"offer","local","send");return z==null||z($),yield hn(d.setRemoteDescription({type:"answer",sdp:$})),f.map((K,ie)=>{const oe=y[ie];return{localSSRC:I[ie],id:oe}})}catch(f){throw f instanceof Pe?f:new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(f.toString()))}finally{h()}})()}async stopSending(i,s){const o=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const d=this.peerConnection.getTransceivers().filter(y=>i.indexOf(y.mid)!==-1);if(d.length!==i.length)throw new Error("Transceivers' length (".concat(d.length,") doesn't match mids' length (").concat(i.length,") when trying to call P2PConnection.stopSending."));d.map(y=>{var x;y.direction="inactive",(x=y.stop)===null||x===void 0||x.call(y)});const h=await this.peerConnection.createOffer(),f=this.logSDPExchange(h.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(h),this.remoteSDP.stopReceiving(i);const g=this.remoteSDP.toString();f==null||f(g),await this.setRemoteDescription({type:"answer",sdp:g})}catch(d){throw new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(d.toString()))}finally{o&&o()}}async receive(i,s,o,d){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{mid:h,needExchangeSDP:f}=this.remoteSDP.send(i,s,o,d);if(f){const y=this.remoteSDP.toString(),x=this.logSDPExchange(y,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:y});const b=await this.peerConnection.createAnswer(),N=this.mungReceiveAnswerSDP(b.sdp,h,i);x==null||x(N||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:N}),M.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(i," by exchanging SDP."))}else M.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(i," no need to exchange SDP."));const g=this.peerConnection.getTransceivers().find(y=>y.mid===h);if(!g||g.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:g.receiver.track,mid:g.mid,transceiver:g}}catch(h){throw new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}}async mockReceive(i,s,o,d){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{mid:h,needExchangeSDP:f}=this.remoteSDP.send(i,s,o,d);if(f){const g=this.remoteSDP.toString(),y=this.logSDPExchange(g,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:g});const x=await this.peerConnection.createAnswer(),b=this.mungReceiveAnswerSDP(x.sdp,h,i);y==null||y(b||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:b}),M.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(i," by exchanging SDP."))}else M.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(i," no need to exchange SDP."))}catch(h){throw new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}}async stopReceiving(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(i);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:s});const d=await this.peerConnection.createAnswer();o==null||o(d.sdp||""),await this.peerConnection.setLocalDescription(d)}catch(s){throw new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async restartICE(i){try{if(this.store.p2pTransport===my.Auto&&(this.store.p2pTransport=my.SdRtn,xn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(mb.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,xn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(mb.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!i){this.restartCnt++,this.isReady=!1;const s=await this.peerConnection.createOffer({iceRestart:!0});if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:o}=rf(s.sdp);return this.store.descriptionStart(),this.direction===Fo.SEND_ONLY&&await this.peerConnection.setLocalDescription(s),o}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(i),this.store.descriptionStart(),this.direction===Fo.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:o}=rf(s.sdp);return await this.peerConnection.setLocalDescription(s),o}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(s){throw new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}close(){var i;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}async updateEncoderConfig(i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),d=this.mungSendOfferSDP(o.sdp,[s],[i]);this.remoteSDP.updateRecvMedia(i,s);const h=this.remoteSDP.toString(),f=this.logSDPExchange(d,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:d}),f==null||f(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(o){throw new Pe(se.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(i,s){const o=this.peerConnection.getTransceivers().filter(d=>d.mid===i);o.length===1&&(this.isVP8Simulcast(s)?Kr()||await this.applySimulcastEncodings(o,[s]):await this.applySendEncodings(o,[s]))}setStatsRemoteVideoIsReady(i,s){this.statsFilter.setVideoIsReady2(i,s)}async replaceTrack(i,s){const o=this.peerConnection.getTransceivers().find(d=>d.mid===s);o&&await o.sender.replaceTrack(i._mediaStreamTrack)}async getSelectedCandidatePair(){const i=this.peerConnection.getReceivers();if(i.length>0&&i[0].transport&&i[0].transport.iceTransport&&i[0].transport.iceTransport.getSelectedCandidatePair&&i[0].transport.iceTransport.getSelectedCandidatePair()){const s=i[0].transport.iceTransport,{local:o,remote:d}=s.getSelectedCandidatePair();return{local:o_(o_({},Ou),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:o_(o_({},Ou),{},{candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i,s;Ge(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(s=this.onICEConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=i=>{if(i.candidate){var s;i.candidate.candidate&&((s=this.onLocalCandidate)===null||s===void 0||s.call(this,i.candidate.toJSON())),this.localCandidateCount+=1}else M.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i,s){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const d={iceServers:[]};var h;return i.iceServers?d.iceServers=i.iceServers:i.turnServer&&i.turnServer.mode!=="off"&&(ly(i.turnServer.servers)?d.iceServers=i.turnServer.servers:(d.iceServers&&d.iceServers.push(...mb.turnServerConfigToIceServers(i.turnServer.servers,s,o)),re("USE_TURN_SERVER_OF_GATEWAY")&&d.iceServers&&i.turnServer.serversFromGateway&&d.iceServers.push(...mb.turnServerConfigToIceServers(i.turnServer.serversFromGateway,s,o)),Ge(h=[my.Relay,my.SdRtn]).call(h,s)&&(d.iceTransportPolicy="relay"),re("FORCE_TURN_TCP")?d.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(f=>{f.forceturn&&(d.iceTransportPolicy="relay")}))),re("ENABLE_ENCODED_TRANSFORM")&&xn().supportWebRTCEncodedTransform&&(d.encodedInsertableStreams=!0),M.debug("P2PConnection p2pTransport is ".concat(s)),d}static turnServerConfigToIceServers(i,s){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const d=[],h=i.filter(g=>g.tcpport);M.debug("P2PConnection turnServers is ".concat(h,", current index is ").concat(o));const f=h.length>o?h[o]:h[0];switch(s){case my.SdRtn:const g=i.filter(x=>{var b;return Ge(b=x.username).call(b,"glb:")&&x.turnServerURL==x.turnServerURL}),y=g.length>o?g[o]:g[0];y&&(d.push({username:y.username,credential:y.password,credentialType:"password",urls:"turn:".concat(Vu(y.turnServerURL),":").concat(y.tcpport,"?transport=udp")}),d.push({username:y.username,credential:y.password,credentialType:"password",urls:"turns:".concat(Vu(y.turnServerURL),":").concat(y.tcpport,"?transport=tcp")}));break;case my.Relay:f&&(d.push({username:f.username,credential:f.password,credentialType:"password",urls:"turn:".concat(f.turnServerURL,":").concat(f.tcpport,"?transport=udp")}),d.push({username:f.username,credential:f.password,credentialType:"password",urls:"turns:".concat(Vu(f.turnServerURL),":").concat(f.tcpport,"?transport=tcp")}));break;default:f&&(d.push({username:f.username,credential:f.password,credentialType:"password",urls:"turn:".concat(f.turnServerURL,":").concat(f.tcpport,"?transport=udp")}),d.push({username:f.username,credential:f.password,credentialType:"password",urls:"turns:".concat(Vu(f.turnServerURL),":").concat(f.tcpport,"?transport=tcp")}),d.push({username:f.username,credential:f.password,credentialType:"password",urls:"stun:".concat(f.turnServerURL,":").concat(f.tcpport)}))}return d}tryBindTransportEvents(i){if(i){this.transport=i,i.onstatechange=()=>{var o;i!=null&&i.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,i.state))},i.onerror=o=>{var d;(d=this.onDTLSTransportError)===null||d===void 0||d.call(this,"error"in o?o.error:o)};const s=i.iceTransport;s&&(s.onstatechange=()=>{const o=i==null?void 0:i.iceTransport.state;var d;o&&((d=this.onICETransportStateChange)===null||d===void 0||d.call(this,o))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:o,remote:d}=s.getSelectedCandidatePair()||{};if(o&&d){const h=o.address+":"+o.port,f=d.address+":"+d.port;M.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(nf(h)),", remote ").concat(JSON.stringify(nf(f))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(i,s){var o;if(s||(s=this.peerConnection.getSenders().find(b=>b.track===i._mediaStreamTrack)),!s)return M.warn("[".concat(i.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(i))return M.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!xn().supportSetRtpSenderParameters)return M.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},h={};switch(i._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;default:d.degradationPreference="balanced"}if(i._encoderConfig){var f;const{bitrateMax:b,frameRate:N,scaleResolutionDownBy:I}=i._encoderConfig;b&&(h.maxBitrate=1e3*b),Ge(f=i._hints).call(f,or.LOW_STREAM)&&(N&&(h.maxFramerate=vc(N)),I&&I>=1&&(h.scaleResolutionDownBy=I))}if(re("DSCP_TYPE")&&Jp()){var g;const b=re("DSCP_TYPE");Ge(g=["very-low","low","medium","high"]).call(g,b)&&(h.networkPriority=b)}const y=s.getParameters(),x=(o=y.encodings)===null||o===void 0?void 0:o[0];Kr()&&!x&&(d.encodings=[h]),x&&Object.assign(x,h),Object.assign(y,d),M.debug("[".concat(i.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(y.encodings))),await s.setParameters(y)}async applySendEncodings(i,s){try{if(!xn().supportSetRtpSenderParameters||i.length!==s.length)return;for(let o=0;o<i.length;o++){const d=i[o],h=s[o];h instanceof Rr&&!this.isVP8Simulcast(h)&&await this.updateRtpSenderEncodings(h,d.sender)}}catch{M.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(i,s,o){const d=Mo(i);return s.forEach((h,f)=>{const g=o[f],y=d.mediaDescriptions.find(x=>x.attributes.mid===g);y&&(Cy(y,h),$4(y,h,this.store.codec))}),um(d)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,s,o)=>{var d;(d=this.onFirstVideoDecoded)===null||d===void 0||d.call(this,i,s,o)},this.statsFilter.onSelectedLocalCandidateChanged=(i,s)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,i,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,s)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,i,s)},this.statsFilter.onFirstVideoDecodedTimeout=i=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(i,s){if(i.length===s.length)for(let y=0;y<i.length;y++){var o,d,h,f,g;const x=i[y],b=s[y];if(b instanceof Rr&&!Ge(o=b._hints).call(o,or.LOW_STREAM)&&(d=b._encoderConfig)!==null&&d!==void 0&&d.bitrateMax&&((h=b._encoderConfig)===null||h===void 0?void 0:h.bitrateMax)>200&&(f=b._scalabilityMode)!==null&&f!==void 0&&f.numSpatialLayers&&((g=b._scalabilityMode)===null||g===void 0?void 0:g.numSpatialLayers)>1&&this.store.codec==="vp8"){const N={},I={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};N.encodings=[{rid:"m",active:!0,maxBitrate:I.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:I.high}];const D=x.sender.getParameters();await x.sender.setParameters(Object.assign(D,N))}}}async applySimulcastEncodings(i,s){if(!Kr()&&i.length===s.length)for(let o=0;o<i.length;o++){const d=s[o];if(d instanceof Rr&&this.isVP8Simulcast(d)){const h=i[o],f={},g={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:g.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:g.medium,scaleResolutionDownBy:4}];const y=h.sender.getParameters();await h.sender.setParameters(Object.assign(y,f))}}}isVP8Simulcast(i){var s,o,d,h,f;return!!(i instanceof Rr&&re("SIMULCAST")&&this.store.codec==="vp8"&&!Ge(s=i._hints).call(s,or.LOW_STREAM)&&(o=i._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((d=i._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=i._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((f=i._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1)}logSDPExchange(i,s,o,d){if(re("SDP_LOGGING"))return M.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(s," SDP during P2PConnection.").concat(d,`
`),i),s==="offer"?h=>{this.logSDPExchange(h,"answer",o==="local"?"remote":"local",d)}:void 0}async muteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(f=>f.mid&&i.indexOf(f.mid)!==-1);if(s.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(f=>{f.direction="inactive"});const o=await this.peerConnection.createOffer(),d=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(i);const h=this.remoteSDP.toString();d==null||d(h),await this.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(f=>f.mid&&i.indexOf(f.mid)!==-1);if(s.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async f=>{f.direction="sendonly"});const o=await this.peerConnection.createOffer(),d=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(i);const h=this.remoteSDP.toString();d==null||d(h),await this.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}async getRemoteSSRC(i,s){var o;if(s=s??((o=this.currentRemoteDescription)===null||o===void 0?void 0:o.sdp)){var d;const h=(d=Mo(s).mediaDescriptions.find(f=>f.attributes.mid===i))===null||d===void 0?void 0:d.attributes.ssrcs;return h==null?void 0:h[0].ssrcId}}async setRemoteDescription(i){var s;await this.peerConnection.setRemoteDescription(i),Ge(s=["connected","completed"]).call(s,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(i,s,o){const d=Mo(i),h=d.mediaDescriptions.find(f=>f.attributes.mid===s);return h&&o===pt.AUDIO&&h.media.mediaType==="audio"&&Mx(h),um(d)}},it(Yr.prototype,"establish",[Hu],Object.getOwnPropertyDescriptor(Yr.prototype,"establish"),Yr.prototype),it(Yr.prototype,"connect",[Hu],Object.getOwnPropertyDescriptor(Yr.prototype,"connect"),Yr.prototype),it(Yr.prototype,"receive",[Hu],Object.getOwnPropertyDescriptor(Yr.prototype,"receive"),Yr.prototype),it(Yr.prototype,"mockReceive",[Hu],Object.getOwnPropertyDescriptor(Yr.prototype,"mockReceive"),Yr.prototype),it(Yr.prototype,"stopReceiving",[Hu],Object.getOwnPropertyDescriptor(Yr.prototype,"stopReceiving"),Yr.prototype),it(Yr.prototype,"restartICE",[Hu],Object.getOwnPropertyDescriptor(Yr.prototype,"restartICE"),Yr.prototype),it(Yr.prototype,"close",[Hu],Object.getOwnPropertyDescriptor(Yr.prototype,"close"),Yr.prototype),it(Yr.prototype,"updateEncoderConfig",[Hu],Object.getOwnPropertyDescriptor(Yr.prototype,"updateEncoderConfig"),Yr.prototype),it(Yr.prototype,"updateSendParameters",[Hu],Object.getOwnPropertyDescriptor(Yr.prototype,"updateSendParameters"),Yr.prototype),it(Yr.prototype,"replaceTrack",[Hu],Object.getOwnPropertyDescriptor(Yr.prototype,"replaceTrack"),Yr.prototype),it(Yr.prototype,"muteLocal",[Hu],Object.getOwnPropertyDescriptor(Yr.prototype,"muteLocal"),Yr.prototype),it(Yr.prototype,"unmuteLocal",[Hu],Object.getOwnPropertyDescriptor(Yr.prototype,"unmuteLocal"),Yr.prototype),Yr);function Hu(n,i,s){const o=n[i];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const d=this.mutex,h=await d.lock("From P2PConnection.".concat(i));try{for(var f=arguments.length,g=new Array(f),y=0;y<f;y++)g[y]=arguments[y];return await o.apply(this,g)}finally{h()}},s}let zh=function(n){return n.SEND_ONLY="SEND_ONLY",n.RECEIVE_ONLY="RECEIVE_ONLY",n}({});var Cee,Nee,Iee,Aee,kee,Pee,Dee,Oee,Lee,jee,Mee,pi;function Uee(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function n2(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?Uee(Object(s),!0).forEach(function(o){Y(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):Uee(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}let yTe=(Cee=Gh(zh.SEND_ONLY),Nee=Gh(zh.SEND_ONLY),Iee=Gh(),Aee=Gh(zh.RECEIVE_ONLY),kee=Gh(zh.RECEIVE_ONLY),Pee=Gh(zh.RECEIVE_ONLY),Dee=Gh(zh.RECEIVE_ONLY),Oee=Gh(zh.RECEIVE_ONLY),Lee=Gh(zh.RECEIVE_ONLY),jee=Gh(),Mee=Gh(zh.RECEIVE_ONLY),pi=class extends ai{get state(){return this._state}set state(n){const i=this._state;this._state=n,this.emit(Dt.StateChange,i,this._state)}constructor(n,i){super(),Y(this,"isPlanB",!1),Y(this,"store",void 0),Y(this,"statsUploader",void 0),Y(this,"sendConnection",void 0),Y(this,"recvConnection",void 0),Y(this,"localTrackMap",new Map),Y(this,"remoteUserMap",new Map),Y(this,"localDataChannels",[]),Y(this,"pendingLocalTracks",[]),Y(this,"pendingRemoteTracks",[]),Y(this,"statsCollector",void 0),Y(this,"dtlsFailedCount",0),Y(this,"sendMutex",void 0),Y(this,"recvMutex",void 0),Y(this,"_state",rr.Disconnected),Y(this,"_restartStates",["disconnected","failed"]),Y(this,"reconnectInterval",void 0),Y(this,"uploadUnplinkStarted",!1),Y(this,"uploadDownlinkStarted",!1),Y(this,"uplinkStateUploadInterval",void 0),Y(this,"downlinkStatsUploadInterval",void 0),Y(this,"handleMuteLocalTrack",async(s,o,d)=>{const h=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==rr.Connected)return void d(new Pe(se.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const y=this.filterTobeMutedTracks(s);if(y.length===0)return void o();const x=y.find(D=>D[0]==="videoLowTrack");x&&x[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(y.map(D=>{let[,{id:$}]=D;return $}));let b=!1;var f,g;s.trackMediaType==="video"?b=!((f=this.localTrackMap.get(qe.LocalAudioTrack))===null||f===void 0||!f.track._muted):b=((g=this.localTrackMap.get(qe.LocalVideoTrack))===null||g===void 0?void 0:g.id)===void 0;const N=this.createMuteMessage(y);await Or(this,Dt.RequestMuteLocal,N);const I=s.trackMediaType==="video"?$g.MUTE_LOCAL_VIDEO:$g.MUTE_LOCAL_AUDIO;await Or(this,Dt.RequestP2PMuteLocal,{action:I,message:N,isMuteAll:b}),o()}catch(y){d(y)}finally{h()}}),Y(this,"handleUnmuteLocalTrack",async(s,o,d)=>{const h=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==rr.Connected)return void d(new Pe(se.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const f=this.filterTobeUnmutedTracks(s);if(f.length===0)return void o();await this.sendConnection.unmuteLocal(f.map(x=>{let[,{id:b}]=x;return b}));const g=this.createUnmuteMessage(f),y=s.trackMediaType==="video"?$g.UNMUTE_LOCAL_VIDEO:$g.UNMUTE_LOCAL_AUDIO;await Or(this,Dt.RequestP2PMuteLocal,{action:y,message:g}),o()}catch(f){d(f)}finally{h()}}),Y(this,"handleUpdateVideoEncoder",async(s,o,d,h)=>{let f;typeof h=="boolean"&&h||(f=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const y=this.localTrackMap.get(qe.LocalVideoTrack);if(!this.sendConnection||!y||y.track!==s||this.state!==rr.Connected)return void o();const{id:x,track:b}=y;x&&(await this.sendConnection.updateSendParameters(x,b),await this.sendConnection.updateEncoderConfig(x,b),this.emit(Dt.UpdateVideoEncoder,b)),o()}catch(y){d(y)}finally{var g;(g=f)===null||g===void 0||g()}}),Y(this,"handleUpdateVideoSendParameters",async(s,o,d)=>{const h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const f=this.localTrackMap.get(qe.LocalVideoTrack);if(!this.sendConnection||!f||f.track!==s||this.state!==rr.Connected)return void o();const{id:g,track:y}=f;g&&await this.sendConnection.updateSendParameters(g,y),o()}catch(f){d(f)}finally{h()}}),Y(this,"handleReplaceTrack",async(s,o,d,h)=>{let f;M.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof h=="boolean"&&h||(f=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var g;const x=Array.from(this.localTrackMap.entries()).find(b=>{let[,{track:N}]=b;return s===N});if(!this.sendConnection||!x||x[1].id===void 0||this.state!==rr.Connected)return void o();if(await((g=this.sendConnection)===null||g===void 0?void 0:g.replaceTrack(s,x[1].id)),x[0]===qe.LocalVideoTrack&&xn().supportDualStreamEncoding){const b=this.localTrackMap.get(qe.LocalVideoLowTrack);if(b){const N=s._mediaStreamTrack.clone();b.track._originMediaStreamTrack.stop(),b.track._mediaStreamTrack=N,b.track._originMediaStreamTrack=N,await new et((I,D)=>{this.handleReplaceTrack(b.track,I,D,!0)})}}o()}catch(x){d(x)}finally{var y;(y=f)===null||y===void 0||y()}}),Y(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),Y(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),Y(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),Y(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=n,this.statsCollector=i,this.statsCollector.addP2PChannel(this),this.statsUploader=new QJ(n),this.bindStatsUploaderEvents(),this.sendMutex=new qs("P2PChannel2-send-mutex",n.clientId),this.recvMutex=new qs("P2PChannel2-recv-mutex",n.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(s=>{s&&(s.iceConnectionState!=="disconnected"&&s.iceConnectionState!=="failed"||this.handleDisconnect(s.direction))})},re("ICE_RESTART_INTERVAL"))}async startP2PConnection(n,i){throw new Pe(se.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(n){throw new Pe(se.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(n,i){let s;try{if(i){this.recvConnection&&(M.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),s=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new Ree(n,this.store,Fo.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const o=await this.recvConnection.establish(i);return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}{this.state=rr.New,this.sendConnection&&(M.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),s=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new Ree(n,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const o=await this.sendConnection.establish();return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}}finally{s&&s()}}async p2pConnect(n){if(!this.sendConnection)throw new Pe(se.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(n),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=rr.Connected}async addRemoteCandidate(n,i){if(i===Fo.RECEIVE_ONLY){if(!this.sendConnection)throw new Pe(se.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(n)}else{if(!this.recvConnection)throw new Pe(se.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(n)}}publish(n,i,s){var o=this;return fc(function*(){const d=yield hn(o.sendMutex.lock("From P2PChannel.publish"));try{if(!o.sendConnection||o.state!==rr.Connected){o.throwIfTrackTypeNotMatch(n);const x=n.filter(b=>o.pendingLocalTracks.indexOf(b)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(x))}o.store.pubId=o.store.pubId+1,La.markPublishStart(o.store.clientId,o.store.pubId);const h=o.filterTobePublishedTracks(n,i,s);if(h.length===0)return void(yield hn(o.tryToUnmuteAudio(n)));h.forEach(x=>{let{track:b,type:N}=x;const I=Date.now();o.store.publish(b.getTrackId(),N===qe.LocalAudioTrack?"audio":"video",I)}),o.bindLocalTrackEvents(h);const f=yield hn(o.sendConnection.send(h.map(x=>{let{track:b}=x;return b}),o.store.codec,o.store.audioCodec)),g=(yield hn(f.next())).value,y=o.createGatewayPublishMessage(h,g);try{yield y}catch(x){throw f.throw(x),(x==null?void 0:x.code)===se.WS_ABORT&&h.forEach(b=>{let{track:N}=b;o.pendingLocalTracks.indexOf(N)===-1&&o.pendingLocalTracks.push(N)}),o.unbindLocalTrackEvents(h),x}yield hn(f.next()),h.forEach(x=>{let{type:b}=x;o.statsCollector.addLocalStats(b)}),o.statsUploader.startUploadOutboundStats(),o.assignLocalTracks(h,g),h.forEach(x=>{let{track:b,type:N}=x;const I=Date.now();o.store.publish(b.getTrackId(),N===qe.LocalAudioTrack?"audio":"video",void 0,I)}),o.startUploadUplinkState()}finally{d()}})()}async unpublish(n){if(!this.sendConnection||this.state!==rr.Connected)return void(n.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(d=>!Ge(n).call(n,d)));const i=this.filterTobeUnpublishedTracks(n);if(i.length===0)return;const s=i.find(d=>d[0]==="videoLowTrack");s&&s[1].track.close();const o=this.createGatewayUnpublishMessage(i);if(await this.sendConnection.stopSending(i.map(d=>{let[,{id:h}]=d;return h})),this.withdrawLocalTracks(i),this.unbindLocalTrackEvents(i.map(d=>{let[h,{track:f}]=d;return{type:h,track:f}})),i.forEach(d=>{let[h]=d;this.statsCollector.removeLocalStats(h)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===rr.Connected)return s&&s[1].track.close(),o;n.forEach(d=>{const h=this.pendingLocalTracks.indexOf(d);h!==-1&&this.pendingLocalTracks.splice(h,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const n=()=>{const i=[],s=[];Array.from(this.localTrackMap.entries()).forEach(o=>{let[d,{track:h,ssrcs:f}]=o;const g={stream_type:awe(h,d),ssrcs:f};h._muted||!h._enabled?i.push(g):s.push(g)}),i.length>0&&i.forEach(o=>{Or(this,Dt.RequestMuteLocal,[o])}),s.length>0&&s.forEach(o=>{Or(this,Dt.RequestUnmuteLocal,[o])})};n(),this.uplinkStateUploadInterval=window.setInterval(()=>{n()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(n){return fc(function*(){throw new Pe(se.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(M.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await rs(this,Dt.RequestRePublish,this.pendingLocalTracks),this.emit(Dt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Pe(se.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(n,i,s,o){var d;if(!this.recvConnection)throw new Pe(se.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((d=this.remoteUserMap.get(n))!==null&&d!==void 0&&d.has(i))return;const{track:h,mid:f,transceiver:g}=await this.recvConnection.receive(i,[{ssrcId:s}],String(n.uid),o);i===pt.AUDIO?(n._audioTrack?n._audioTrack._updateOriginMediaStreamTrack(h):(n._audioTrack=new Ix(h,n.uid,n._uintid,this.store),M.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(n._audioTrack.getTrackId()))),g&&n._audioTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(n,n._audioTrack)):(n._videoSSRC=s,n._videoTrack?n._videoTrack._updateOriginMediaStreamTrack(h):(n._videoTrack=new Nx(h,n.uid,n._uintid,this.store),M.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(n._videoTrack.getTrackId()))),g&&n._videoTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(n,n._videoTrack));const y=this.remoteUserMap.get(n);y?y.set(i,f):this.remoteUserMap.set(n,new Map([[i,f]])),this.statsCollector.addRemoteStats(n.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const x=this.pendingRemoteTracks.findIndex(b=>{let{user:N,kind:I}=b;return N.uid===n.uid&&i===I});x!==-1&&(this.pendingRemoteTracks.splice(x,1),this.emit(Dt.MediaReconnectEnd,n.uid))}async mockSubscribe(n,i,s,o){if(!this.recvConnection)throw new Pe(se.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(i,[{ssrcId:s}],String(n.uid),o)}async unsubscribe(n,i,s){const o=this.pendingRemoteTracks.filter(h=>{let{user:f,kind:g}=h;return i!==void 0?f.uid===n.uid&&i===g:f.uid===n.uid});if(o.forEach(h=>{const f=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(f,1)}),this.recvConnection||s||o.forEach(h=>{let{kind:f}=h;var g;if(f===pt.AUDIO)(g=n._audioTrack)===null||g===void 0||g._destroy(),n._audioTrack=void 0;else if(f===pt.VIDEO){var y;(y=n._videoTrack)===null||y===void 0||y._destroy(),n._videoTrack=void 0}}),!this.recvConnection)return;const d=this.filterTobeUnSubscribedTracks(n,i);d.length!==0&&(await this.recvConnection.stopReceiving(d.map(h=>{let[,{id:f}]=h;return f})),this.withdrawRemoteTracks(d),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),d.forEach(h=>{let[f,{kind:g}]=h;var y,x;if(g===pt.VIDEO&&f._videoSSRC&&((y=this.recvConnection)===null||y===void 0||y.setStatsRemoteVideoIsReady(f._videoSSRC,!1)),g===pt.VIDEO)this.unbindRemoteTrackEvents(f._videoTrack),s||((x=f._videoTrack)===null||x===void 0||x._destroy(),f._videoTrack=void 0);else if(g===pt.AUDIO){var b;this.unbindRemoteTrackEvents(f._audioTrack),!s&&((b=f._audioTrack)===null||b===void 0||b._destroy(),f._audioTrack=void 0)}}),d.forEach(h=>{let[,{kind:f}]=h;Or(this,Dt.RequestP2PMuteRemote,f)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const n=()=>Array.from(this.remoteUserMap.entries()).forEach(i=>{let[,s]=i;[pt.VIDEO,pt.AUDIO].forEach(o=>{s.has(o)?Or(this,Dt.RequestP2PUnmuteRemote,o):Or(this,Dt.RequestP2PMuteRemote,o)})});n(),this.downlinkStatsUploadInterval=window.setInterval(()=>{n()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(n){throw new Pe(se.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(n){throw new Pe(se.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(n){throw new Pe(se.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(n){throw new Pe(se.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(n,i){if(!this.recvConnection)return;const s=this.remoteUserMap.get(n);if(!s)return void M.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(n.uid,"."));if(!s.get(i))return void M.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(n.uid," media type ").concat(i,"."));const o=i===pt.VIDEO?n._videoSSRC:n._audioSSRC;o!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(n,i){return this.unmuteRemoteNoLock(n,i)}async unmuteRemoteNoLock(n,i){if(!this.recvConnection)return;const s=this.remoteUserMap.get(n);if(!s)return void M.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(n.uid,"."));s.get(i)||M.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(n.uid," media type ").concat(i,"."))}getAllTracks(n){const i=this.localTrackMap.get(qe.LocalAudioTrack);if((i==null?void 0:i.track)instanceof gs){const s=i.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[d]=o;return d!==qe.LocalAudioTrack}).filter(o=>{let[d]=o;return!(n&&d===qe.LocalVideoLowTrack)}).map(o=>{let[,{track:d}]=o;return d}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[o]=s;return!(n&&o===qe.LocalVideoLowTrack)}).map(s=>{let[,{track:o}]=s;return o})}reportPublishEvent(n,i,s,o,d){if(n){const f=this.localTrackMap.get(qe.LocalAudioTrack),g=o?this.localTrackMap.get(qe.LocalVideoLowTrack):this.localTrackMap.get(qe.LocalVideoTrack);_t.publish(this.store.sessionId,{eventElapse:La.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:i,audioName:f==null?void 0:f.track.getTrackLabel(),videoName:g==null?void 0:g.track.getTrackLabel(),screenshare:(g==null?void 0:g.track._hints.indexOf(or.SCREEN_TRACK))!==-1,audio:!!f,video:!!g,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}else{var h;s||(s=[]);const f=s.find(y=>y instanceof Pi),g=o?(h=this.localTrackMap.get(qe.LocalVideoTrack))===null||h===void 0?void 0:h.track:s.find(y=>y instanceof Rr);_t.publish(this.store.sessionId,{eventElapse:La.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:i,audioName:f==null?void 0:f.getTrackLabel(),videoName:g==null?void 0:g.getTrackLabel(),screenshare:(g==null?void 0:g._hints.indexOf(or.SCREEN_TRACK))!==-1,audio:!!f,video:!!g,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}}reportSubscribeEvent(n,i,s,o){const d=o===pt.VIDEO?s._videoSSRC:s._audioSSRC;d&&_t.subscribe(this.store.sessionId,{succ:n,ec:i,video:o===pt.VIDEO,audio:o===pt.AUDIO,peerid:s.uid,subscribeRequestid:o===pt.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:La.measureFromSubscribeStart(this.store.clientId,d)})}reset(){M.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new qs("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new qs("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const n=this.localTrackMap.get(qe.LocalAudioTrack);if((n==null?void 0:n.track)instanceof gs){if(n.track.trackList.length>0){const i=n.track;n.track.trackList.forEach(s=>{i.removeAudioTrack(s)})}n.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=rr.Disconnected}getStats(n){var i,s;return n?(s=this.recvConnection)===null||s===void 0?void 0:s.getStats():(i=this.sendConnection)===null||i===void 0?void 0:i.getStats()}getRemoteVideoIsReady(n){var i;return((i=this.recvConnection)===null||i===void 0?void 0:i.getRemoteVideoIsReady(n))||!1}getLocalAudioVolume(){const n=this.localTrackMap.get(qe.LocalAudioTrack);if(n)return n.track.getVolumeLevel()}getLocalVideoSize(){const n=this.localTrackMap.get(qe.LocalVideoTrack);if(n)return{width:n.track.videoWidth||0,height:n.track.videoHeight||0}}getEncoderConfig(n){const i=this.localTrackMap.get(n);return i&&i.track instanceof Rr||i&&i.track instanceof Pi?i.track._encoderConfig:void 0}getLocalMedia(n){return this.localTrackMap.get(n)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(n,i){if(!n)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(n);return!!s&&(!i||s.has(i))}async hasRemoteMediaWithLock(n,i){if(!n)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(n);return!!s&&(!i||s.has(i))}getRemoteMedia(n){var i;const s=Array.from(Xa(i=this.remoteUserMap).call(i)).find(o=>o.uid===n);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let n=Array.from(this.remoteUserMap.entries()).map(s=>{let[o]=s;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const i=this.localTrackMap.get(qe.LocalAudioTrack);return i&&n.push({level:100*i.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),n=sm(n).call(n,(s,o)=>s.level-o.level),n}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(M.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=rr.Reconnecting,re("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;var s;i._videoTrack&&i._videoTrack._player&&((s=i._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),i._videoTrack._player.isKeepLastFrame=!0,i._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(n=>{var i;let[s,{track:o}]=n;switch(s){case qe.LocalVideoTrack:Ge(i=o._hints).call(i,or.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case qe.LocalAudioTrack:o instanceof gs?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case qe.LocalVideoLowTrack:}}),this.emit(Dt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i,s]=n;Array.from(Xa(s).call(s)).forEach(o=>{this.setPendingRemoteMedia(i,o)}),this.emit(Dt.MediaReconnectStart,i.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),M.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(n,i){for(const s of this.pendingRemoteTracks){const{user:o,kind:d}=s;if((n instanceof Qg?n.uid:n)===o.uid&&i===d)return!0}return!1}setPendingRemoteMedia(n,i){this.hasPendingRemoteMedia(n,i)||this.pendingRemoteTracks.push({user:n,kind:i})}async restartICE(n,i){let s,o;if(n===Fo.SEND_ONLY){if(!this.sendConnection)throw new Pe(se.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");s=await this.sendMutex.lock("From P2PChannel.restartICE"),o=this.sendConnection}else{if(!this.recvConnection)throw new Pe(se.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");s=await this.recvMutex.lock("From P2PChannel.restartICE"),o=this.recvConnection}try{if(i){const d=await o.restartICE(i);return o.isInRestartIce=!1,d}{const d=await o.restartICE();if(d){const h=await rs(this,Dt.RequestP2PRestartICE,{direction:Fo.RECEIVE_ONLY,iceParameter:d});await o.restartICE(h),o.isInRestartIce=!1}}}finally{s()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const n=this.sendConnection.getStats(),i=this.localTrackMap.get(qe.LocalVideoTrack),s=this.localTrackMap.get(qe.LocalAudioTrack),o=n.videoSend.find(D=>{var $;return D.ssrc===(i==null||($=i.ssrcs)===null||$===void 0?void 0:$[0].ssrcId)}),d=n.audioSend.find(D=>{var $;return D.ssrc===(s==null||($=s.ssrcs)===null||$===void 0?void 0:$[0].ssrcId)});if(!o||!d)return 1;const h=El(this,Dt.NeedSignalRTT),f=o?o.rttMs:void 0,g=d?d.rttMs:void 0,y=f&&g?(f+g)/2:f||g,x=(y&&h?(y+h)/2:y||h)||0,b=100*n.sendPacketLossRate*.7/50+.3*x/1500,N=b<.17?1:b<.36?2:b<.59?3:b<.1?4:5,I=i==null?void 0:i.track;if(I&&I._encoderConfig&&I._hints.indexOf(or.SCREEN_TRACK)===-1){const D=I._encoderConfig.bitrateMax,$=n.bitrate.actualEncoded;if(D&&$){const z=(1e3*D-$)/(1e3*D);return zX[z<.15?0:z<.3?1:z<.45?2:z<.6?3:4][N]}}return N}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const n=this.recvConnection.getStats();let i=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[o]=s;const d=o._audioSSRC,h=o._videoSSRC,f=n.audioRecv.find($=>$.ssrc===d),g=n.videoRecv.find($=>$.ssrc===h);if(!f&&!g)return void(i+=1);const y=El(this,Dt.NeedSignalRTT),x=n.rtt,b=(x&&y?(x+y)/2:x||y)||0,N=f?f.jitterMs:void 0,I=n.recvPacketLossRate;let D=.7*I*100/50+.3*b/1500;N&&(D=.6*I*100/50+.2*b/1500+.2*N/400),i+=D<.1?1:D<.17?2:D<.36?3:D<.59?4:5}),this.remoteUserMap.size>0?Math.round(i/this.remoteUserMap.size):i}async muteLocalTrack(n){return new et((i,s)=>{this.handleMuteLocalTrack(n,i,s)})}filterTobePublishedTracks(n,i,s){const o=[],d=xn(),h=this.getAllTracks();n=mx(n=n.filter(y=>h.indexOf(y)===-1));let f=!1,g=!1;for(const y of n){if(y instanceof Rr&&(this.localTrackMap.has(qe.LocalVideoTrack)||f?new Pe(se.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:y,type:qe.LocalVideoTrack}),f=!0),i)){const x=this.getLowVideoTrack(y,s);o.push({track:x,type:qe.LocalVideoLowTrack})}if(y instanceof Pi){const x=this.localTrackMap.get(qe.LocalAudioTrack);if(x){if(!(x.track instanceof gs))throw new Pe(se.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(y._bypassWebAudio)throw new Pe(se.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");x.track.addAudioTrack(y),this.bindLocalAudioTrackEvents(y,!0)}else if(g){const b=o.find(N=>{let{type:I}=N;return I===qe.LocalAudioTrack});if(!(b.track instanceof gs))throw new Pe(se.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(y._bypassWebAudio)throw new Pe(se.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");b.track.addAudioTrack(y)}else{if(!d.webAudioMediaStreamDest||y instanceof gs||y._bypassWebAudio)o.push({track:y,type:qe.LocalAudioTrack});else{const b=new gs;b.addAudioTrack(y),o.push({track:b,type:qe.LocalAudioTrack})}g=!0}}}return o}filterTobeUnpublishedTracks(n){const i=[],s=this.getAllTracks();n=mx(n=n.filter(o=>s.indexOf(o)!==-1));for(const o of n){if(o instanceof Pi){const d=this.localTrackMap.get(qe.LocalAudioTrack);if(!d)continue;d.track instanceof gs?(d.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),d.track.trackList.length===0&&(i.push([qe.LocalAudioTrack,d]),d.track.close())):i.push([qe.LocalAudioTrack,d])}if(o instanceof Rr){const d=this.localTrackMap.get(qe.LocalVideoTrack);if(!d)continue;i.push([qe.LocalVideoTrack,d]);const h=this.localTrackMap.get(qe.LocalVideoLowTrack);h&&i.push([qe.LocalVideoLowTrack,h])}}return i}bindLocalTrackEvents(n){n.forEach(i=>{let{track:s,type:o}=i;switch(o){case qe.LocalVideoTrack:s.addListener(Et.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Et.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Et.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case qe.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case qe.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(n,i){n instanceof gs?n.trackList.forEach(s=>{s.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Et.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.addListener(Et.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),i||n.addListener(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(n){n||(n=Array.from(this.localTrackMap.entries()).map(i=>{let[s,{track:o}]=i;return{track:o,type:s}})),n.forEach(i=>{let{track:s,type:o}=i;switch(o){case qe.LocalVideoTrack:s.off(Et.GET_STATS,this.handleGetLocalVideoStats),s.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Et.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Et.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case qe.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case qe.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(n){n instanceof gs?n.trackList.forEach(i=>{i.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(Et.GET_STATS,this.handleGetLocalAudioStats),i.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.off(Et.GET_STATS,this.handleGetLocalAudioStats),n.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(n,i){i instanceof Nx&&i.addListener(Et.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(n))}),i instanceof Ix&&i.addListener(Et.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(n))})}unbindRemoteTrackEvents(n){n&&n.removeAllListeners(Et.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i,s]=n;s.has(pt.AUDIO)&&this.unbindRemoteTrackEvents(i._audioTrack),s.has(pt.VIDEO)&&this.unbindRemoteTrackEvents(i._videoTrack)})}createGatewayPublishMessage(n,i){return n.map((s,o)=>{var d;let h,{track:f,type:g}=s;switch(g){case qe.LocalAudioTrack:h=hr.Audio;break;case qe.LocalVideoTrack:h=Ge(d=f._hints).call(d,or.SCREEN_TRACK)?hr.Screen:hr.High;break;case qe.LocalVideoLowTrack:h=hr.Low}return{kind:g===qe.LocalAudioTrack?pt.AUDIO:pt.VIDEO,stream_type:h,mid:i[o].id,ssrcs:i[o].localSSRC,isMuted:f.muted||!f.enabled}})}createGatewayUnpublishMessage(n){return n.map(i=>{var s;let o,[d,{track:h,ssrcs:f,id:g}]=i;switch(d){case qe.LocalVideoTrack:o=Ge(s=h._hints).call(s,or.SCREEN_TRACK)?hr.Screen:hr.High;break;case qe.LocalAudioTrack:o=hr.Audio;break;case qe.LocalVideoLowTrack:o=hr.Low}return{stream_type:o,ssrcs:f,mid:g}})}assignLocalTracks(n,i){n.forEach((s,o)=>{let{track:d,type:h}=s;this.localTrackMap.set(h,{track:d,id:i[o].id,ssrcs:i[o].localSSRC})})}withdrawLocalTracks(n){n.forEach(i=>{let[s]=i;this.localTrackMap.delete(s)})}bindConnectionEvents(n){n.onConnectionStateChange=async i=>{var s;M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(n.name,".onConnectionStateChange(").concat(i,")")),this.emit(Dt.PeerConnectionStateChange,i),i!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),i==="connected"&&(n.isInRestartIce=!1),Ge(s=this._restartStates).call(s,i)&&!n.isInRestartIce&&(i==="disconnected"&&await As(800),n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))},n.onICEConnectionStateChange=i=>{i!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(i,")")),_t.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:i,tag:Tr.TRACER}).onSuccess(),this.emit(Dt.IceConnectionStateChange,i)},n.onICETransportStateChange=i=>{M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(i,")"))},n.onDTLSTransportStateChange=i=>{M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(i,")"))},n.onDTLSTransportError=i=>{M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(i,")"))},n.onFirstAudioDecoded=i=>{var s;const o=Array.from(Xa(s=this.remoteUserMap).call(s)).find(h=>h._audioSSRC===i);var d;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(d=o.audioTrack)===null||d===void 0||d.emit(Od.FIRST_FRAME_DECODED),_t.firstRemoteFrame(this.store.sessionId,ms.FIRST_AUDIO_DECODE,Zr.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:La.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId}))},n.onFirstAudioReceived=i=>{var s;const o=Array.from(Xa(s=this.remoteUserMap).call(s)).find(d=>d._audioSSRC===i);o&&_t.firstRemoteFrame(this.store.sessionId,ms.FIRST_AUDIO_RECEIVED,Zr.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:La.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId})},n.onFirstVideoDecoded=(i,s,o)=>{this.reportVideoFirstFrameDecoded(i,s,o)},n.onFirstVideoReceived=i=>{var s;const o=Array.from(Xa(s=this.remoteUserMap).call(s)).find(d=>d._videoSSRC===i);o&&_t.firstRemoteFrame(this.store.sessionId,ms.FIRST_VIDEO_RECEIVED,Zr.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:La.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId})},n.onSelectedLocalCandidateChanged=(i,s)=>{const o=i.candidateType==="relay",d=s.candidateType==="relay";s.candidateType!=="unknown"&&o===d||this.emit(Dt.ConnectionTypeChange,o),M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Xg(s))," -> ").concat(JSON.stringify(Xg(i)),")"))},n.onSelectedRemoteCandidateChanged=(i,s)=>{M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Xg(s))," -> ").concat(JSON.stringify(Xg(i)),")"))},n.onFirstVideoDecodedTimeout=i=>{this.reportVideoFirstFrameDecoded(i,void 0,void 0,!0)},n.onLocalCandidate=i=>{this.emit(Dt.LocalCandidate,{candidate:i,direction:n.direction})}}unbindConnectionEvents(n){n.onConnectionStateChange=void 0,n.onICEConnectionStateChange=void 0,n.onICETransportStateChange=void 0,n.onDTLSTransportStateChange=void 0,n.onDTLSTransportError=void 0,n.onFirstAudioDecoded=void 0,n.onFirstAudioReceived=void 0,n.onFirstVideoDecoded=void 0,n.onFirstVideoReceived=void 0,n.onSelectedLocalCandidateChanged=void 0,n.onSelectedRemoteCandidateChanged=void 0,n.onFirstVideoDecodedTimeout=void 0,n.onLocalCandidate=void 0}async handleDisconnect(n){const i=n===Fo.SEND_ONLY?this.sendConnection:this.recvConnection;i&&!i.isInRestartIce&&(i.isInRestartIce=!0,M.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(i.name,"] start use restartICE")),n===Fo.SEND_ONLY?this.restartICE(n):rs(this,Dt.RequestP2PRestartICE,{direction:Fo.SEND_ONLY}))}filterTobeMutedTracks(n){const i=[];if(this.getAllTracks().indexOf(n)===-1)return i;const s=this.localTrackMap.get(qe.LocalAudioTrack);if(n instanceof Pi&&(s==null?void 0:s.track)instanceof gs)return s.track.isActive||i.push([qe.LocalAudioTrack,s]),i;const o=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return n===h});if(o&&(i.push(o),o[0]===qe.LocalVideoTrack)){const d=this.localTrackMap.get(qe.LocalVideoLowTrack);d&&i.push([qe.LocalVideoLowTrack,d])}return i}filterTobeUnmutedTracks(n){const i=[],s=this.localTrackMap.get(qe.LocalAudioTrack);if(n instanceof Pi&&(s==null?void 0:s.track)instanceof gs)return s.track.isActive&&i.push([qe.LocalAudioTrack,s]),i;const o=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return n===h});if(o)if(o[0]===qe.LocalVideoTrack){i.push(o);const d=this.localTrackMap.get(qe.LocalVideoLowTrack);d&&i.push([qe.LocalVideoLowTrack,d])}else i.push(o);return i}createMuteMessage(n){return n.map(i=>{var s;let o,[d,{track:h,ssrcs:f,id:g}]=i;switch(d){case qe.LocalAudioTrack:o=hr.Audio;break;case qe.LocalVideoTrack:o=Ge(s=h._hints).call(s,or.SCREEN_TRACK)?hr.Screen:hr.High;break;case qe.LocalVideoLowTrack:o=hr.Low}return{stream_type:o,ssrcs:f,mid:g}})}createUnmuteMessage(n){return n.map(i=>{var s;let o,[d,{track:h,ssrcs:f,id:g}]=i;switch(d){case qe.LocalAudioTrack:o=hr.Audio;break;case qe.LocalVideoTrack:o=Ge(s=h._hints).call(s,or.SCREEN_TRACK)?hr.Screen:hr.High;break;case qe.LocalVideoLowTrack:o=hr.Low}return{stream_type:o,ssrcs:f,mid:g}})}filterTobeUnSubscribedTracks(n,i){const s=[],o=this.remoteUserMap.get(n);if(!o)return s;if(i){const d=o.get(i);if(!d)return s;s.push([n,{kind:i,id:d}])}else Array.from(o.entries()).forEach(d=>{let[h,f]=d;s.push([n,{kind:h,id:f}])});return s}createUnsubscribeMessage(n){const i=[];return n.forEach(s=>{let[o,{kind:d,id:h}]=s;switch(d){case pt.VIDEO:return void(o._videoSSRC&&i.push({stream_type:pt.VIDEO,ssrcId:o._videoSSRC}));case pt.AUDIO:return void(o._audioSSRC&&i.push({stream_type:pt.AUDIO,ssrcId:o._audioSSRC}))}}),i}withdrawRemoteTracks(n){n.forEach(i=>{let[s,{kind:o}]=i;const d=this.remoteUserMap.get(s);d&&(d.delete(o),Array.from(d.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(n){const i=this.localTrackMap.get(qe.LocalVideoTrack),s=this.localTrackMap.get(qe.LocalVideoLowTrack);i&&(await i.track.setBitrateLimit(n.uplink),await new et((o,d)=>{this.handleUpdateVideoEncoder(i.track,o,d,!0)})),s&&n.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:n.low_stream_uplink.bitrate,min_bitrate:n.low_stream_uplink.bitrate||0}),await new et((o,d)=>{this.handleUpdateVideoEncoder(s.track,o,d,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const n=this.sendConnection.peerConnectionState,i=this.recvConnection.peerConnectionState;return n!=="connected"&&i!=="connected"}return!0}async tryToUnmuteAudio(n){for(let i=0;i<n.length;i++)if(n[i]instanceof Pi){const s=this.filterTobeUnmutedTracks(n[i]);if(s.length===0)continue;const o=this.createUnmuteMessage(s);return void await Or(this,Dt.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=n=>this.getStats(n),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(n=>{let[,{ssrcs:i}]=n;return!!i}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=n=>{var i;return!((i=this.recvConnection)===null||i===void 0||!i.getRemoteVideoIsReady(n))},this.statsUploader.requestUpload=(n,i)=>this.emit(Dt.RequestUpload,n,i),this.statsUploader.requestUploadStats=n=>this.emit(Dt.RequestUploadStats,n),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await As(Uk(this.dtlsFailedCount,Gi)),this.emit(Dt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(qe.LocalVideoTrack)||this.pendingLocalTracks.some(n=>n instanceof Rr)}throwIfTrackTypeNotMatch(n){if(n.filter(i=>i instanceof Rr).length>1)throw new Pe(se.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n.filter(i=>i instanceof Pi).length>1&&(n.some(i=>i instanceof Pi&&i._bypassWebAudio)||!xn().webAudioMediaStreamDest))throw new Pe(se.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const i of n){if(i instanceof Rr&&this.pendingLocalTracks.some(s=>s instanceof Rr))throw new Pe(se.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(i instanceof Pi&&this.pendingLocalTracks.some(s=>s instanceof Pi)&&(!xn().webAudioMediaStreamDest||i._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof Pi&&s._bypassWebAudio)))throw new Pe(se.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(n,i){const s=!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&xn().supportDualStreamEncoding,o=n2(n2({},{width:160,height:120,framerate:15,bitrate:50}),i);let d;d=s?n._mediaStreamTrack.clone():m3(n,o);const h=dr(8,"track-low-"),f=new Rr(d,n2(n2({},s&&{scaleResolutionDownBy:H4(o,n)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,h);return f.on(yy.TRANSCEIVER_UPDATED,g=>{n._updateRtpTransceiver(g,bx.LOW_STREAM)}),f._hints.push(or.LOW_STREAM),n.addListener(Et.NEED_CLOSE,()=>{f.close()}),f}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(n,i,s,o){var d;const h=Array.from(Xa(d=this.remoteUserMap).call(d)).find(f=>f._videoSSRC===n);if(h){o||this.store.subscribe(h.uid,"video",void 0,void 0,void 0,void 0,Date.now());const f=this.store.keyMetrics,g=f.subscribe.find(y=>y.userId===h.uid&&y.type==="video");_t.firstRemoteVideoDecode(this.store.sessionId,ms.FIRST_VIDEO_DECODE,Zr.FIRST_VIDEO_DECODE,{peer:h._uintid,videowidth:i,videoheight:s,subscribeElapse:La.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId,apEnd:f.requestAPEnd||0,apStart:f.requestAPStart||0,joinGwEnd:f.joinGatewayEnd||0,joinGwStart:f.joinGatewayStart||0,pcEnd:f.peerConnectionEnd||0,pcStart:f.peerConnectionStart||0,subscriberEnd:(g==null?void 0:g.subscribeEnd)||0,subscriberStart:(g==null?void 0:g.subscribeStart)||0,videoAddNotify:(g==null?void 0:g.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(n,i,s){if(!this.recvConnection)return!1;const o=this.remoteUserMap.get(n);if(!o)return!1;const d=o.get(i);if(!d)return!1;const h=await this.recvConnection.getRemoteSSRC(d);return h!==void 0&&h!==s}isPreSubScribe(n){return!1}async publishDataChannel(n){throw new Pe(se.NOT_SUPPORTED)}async unpublishDataChannel(n){throw new Pe(se.NOT_SUPPORTED)}async subscribeDataChannel(n,i){throw new Pe(se.NOT_SUPPORTED)}async unsubscribeDataChannel(n,i){throw new Pe(se.NOT_SUPPORTED)}hasPendingRemoteDataChannel(n,i){throw new Pe(se.NOT_SUPPORTED)}setPendingRemoteDataChannel(n,i){throw new Pe(se.NOT_SUPPORTED)}async preConnect(n){throw new Pe(se.NOT_SUPPORTED)}getEstablishParams(){throw new Pe(se.NOT_SUPPORTED)}async reSubscribe(n){throw new Pe(se.NOT_SUPPORTED)}reportVideoFirstFrameRender(n){}async updateVideoStreamParameter(n,i){throw new Pe(se.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(n=>{let[i,{track:s}]=n;i===qe.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,bx.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},it(pi.prototype,"p2pConnect",[Cee],Object.getOwnPropertyDescriptor(pi.prototype,"p2pConnect"),pi.prototype),it(pi.prototype,"unpublish",[Nee],Object.getOwnPropertyDescriptor(pi.prototype,"unpublish"),pi.prototype),it(pi.prototype,"unpublishLowStream",[Iee],Object.getOwnPropertyDescriptor(pi.prototype,"unpublishLowStream"),pi.prototype),it(pi.prototype,"subscribe",[Aee],Object.getOwnPropertyDescriptor(pi.prototype,"subscribe"),pi.prototype),it(pi.prototype,"mockSubscribe",[kee],Object.getOwnPropertyDescriptor(pi.prototype,"mockSubscribe"),pi.prototype),it(pi.prototype,"unsubscribe",[Pee],Object.getOwnPropertyDescriptor(pi.prototype,"unsubscribe"),pi.prototype),it(pi.prototype,"muteRemote",[Dee],Object.getOwnPropertyDescriptor(pi.prototype,"muteRemote"),pi.prototype),it(pi.prototype,"unmuteRemote",[Oee],Object.getOwnPropertyDescriptor(pi.prototype,"unmuteRemote"),pi.prototype),it(pi.prototype,"hasRemoteMediaWithLock",[Lee],Object.getOwnPropertyDescriptor(pi.prototype,"hasRemoteMediaWithLock"),pi.prototype),it(pi.prototype,"disconnectForReconnect",[jee],Object.getOwnPropertyDescriptor(pi.prototype,"disconnectForReconnect"),pi.prototype),it(pi.prototype,"remoteMediaSsrcChanged",[Mee],Object.getOwnPropertyDescriptor(pi.prototype,"remoteMediaSsrcChanged"),pi.prototype),pi);function Gh(n){return function(i,s,o){const d=i[s];if(typeof d!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){for(var h=arguments.length,f=new Array(h),g=0;g<h;g++)f[g]=arguments[g];switch(n){case zh.SEND_ONLY:{const y=await this.sendMutex.lock("From P2PChannel2.".concat(s));try{return await d.apply(this,f)}finally{y()}}case zh.RECEIVE_ONLY:{const y=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await d.apply(this,f)}finally{y()}}default:{const y=await this.sendMutex.lock("From P2PChannel2.".concat(s)),x=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await d.apply(this,f)}finally{y(),x()}}}},o}}class Vy extends ai{constructor(i,s){super(),Y(this,"signal",void 0),Y(this,"token",void 0),Y(this,"tokenTimeout",void 0),Y(this,"tokenInterval",void 0),Y(this,"_sequence",0),Y(this,"userMap",new Map),Y(this,"encoder",new TextEncoder),this.signal=i,this.token=s;const o=()=>{this.signal.connectionState===Cn.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(o,1e3):this.tokenInterval=window.setTimeout(o,3*re("P2P_TOKEN_INTERVAL"))};o()}async send(i,s,o,d,h){var f;if(this.userMap.size===0)return;const g=Array.from(pc(f=this.userMap).call(f))[0].token;typeof s!="string"&&(s=JSON.stringify(s)),d=d??dr(6,""),h=h??this._sequence++;const y={_id:d,_type:i,_seq:h,_message:s,token:"".concat(this.token,"_").concat(g)};re("SHOW_P2P_LOG")&&M.debug("send message",y,"noNeedResponse : ".concat(o)),this.splitMessage(JSON.stringify(y)).forEach(b=>{this.signal.request(kt.DATA_STREAM,{payload:Hg(this.encoder.encode(b))})});const x=new et((b,N)=>{const I=window.setTimeout(()=>{this.off("res-@".concat(d,"_ack"),D),this.off("res-@".concat(d),z),this.off(Ox.ABORT,$),M.debug("[external-signal] request timeout, type: ".concat(i,", requestId: ").concat(d)),this.userMap.size===0?N(new Pe(se.INVALID_REMOTE_USER)):N(new Pe(se.TIMEOUT))},re("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),D=()=>{I&&window.clearTimeout(I),this.off(Ox.ABORT,$),o&&b()},$=()=>{I&&window.clearTimeout(I),this.off("res-@".concat(d,"_ack"),D),this.off("res-@".concat(d),z),N(new Pe(se.EXTERNAL_SIGNAL_ABORT,"type: ".concat(i,", requestId: ").concat(d)))};this.once(Ox.ABORT,$),this.once("res-@".concat(d,"_ack"),D);const z=(ie,oe)=>{K=!0,I&&window.clearTimeout(I),this.off("res-@".concat(d,"_ack"),D),this.off(Ox.ABORT,$),ie==="success"?b(oe):N(new Pe(se.P2P_MESSAGE_FAILED,"request ".concat(i," failed, requestId: ").concat(d)))};let K=!1;o||(this.once("res-@".concat(d),z),As(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{K||M.warning("external_signal request timeout, type: ".concat(i,", requestId: ").concat(d,", ").concat(y))}))});try{return await x}catch(b){if(b.code===se.TIMEOUT)return await this.send(i,s,o,d,h);throw b}}onMessage(i){var s;const{_uid:o}=i;let d,h=this.userMap.get(o);if(h)d=h.splitMessageMap;else{if(this.userMap.size>0||!("_type"in i)||i._type!==Ui.CHECK)return;const{token:x}=i;d=new Map,h={uid:o,isStart:!0,token:x,splitMessageMap:d,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(o,h),this.signal.emit(Yt.ON_USER_ONLINE,{uid:o}),this.handleUserOnline()}if("id"in i&&"total"in i){var f;const{id:x,total:b}=i,N=(f=d.get(x))!==null&&f!==void 0?f:[];if(N.push(i),d.has(x)||d.set(x,N),N.length!==b)return;{const I=sm(N).call(N,(D,$)=>D.index-$.index).map(D=>D.payload).join("");d.delete(x),(i=JSON.parse(I))._uid=o}}const{_type:g,token:y}=i;if(Ge(s=[Ui.ACK,Ui.CHECK]).call(s,g))return g===Ui.CHECK&&this.handleCheckToken(h,y),void this.receiveMessage(i);y==="".concat(h.token,"_").concat(this.token)?this.handleReceivedMessage(i):M.debug('Receive unexpected message", '.concat(y,", cur_token: ").concat(h.token,"_").concat(this.token),i)}check(){const i={_id:dr(6,""),token:this.token,_type:Ui.CHECK};re("SHOW_P2P_LOG")&&M.debug("send message",i),this.signal.request(kt.DATA_STREAM,{payload:Hg(this.encoder.encode(JSON.stringify(i)))})}ack(i){const s={_id:i,_type:Ui.ACK,token:this.token};re("SHOW_P2P_LOG")&&M.debug("send message",s),this.signal.request(kt.DATA_STREAM,{payload:Hg(this.encoder.encode(JSON.stringify(s)))})}response(i,s,o){this.send(Ui.RESPONSE,JSON.stringify({success:!o,message:s}),!0,i)}handleReceivedMessage(i){const s=()=>{this.userMap.forEach(x=>{const{receivedMessagesMap:b,nextExpectedSequenceNumber:N}=x;for(;b.has(N);){const I=b.get(N);b.delete(N),this.receiveMessage(I),x.nextExpectedSequenceNumber++}})};if(!i)return void s();const{_uid:o,_seq:d}=i,h=this.userMap.get(o),{receivedMessagesMap:f,isStart:g,nextExpectedSequenceNumber:y}=h;if(d<y)return this.ack(i._id),void M.debug("[external-signal] receive old message, seq: ".concat(d,", ").concat(i._message));f.set(d,i),g&&d===y&&(this.receiveMessage(i),f.delete(y),h.nextExpectedSequenceNumber++,s())}receiveMessage(i){const{_id:s,_type:o,_message:d,_uid:h}=i;if(re("SHOW_P2P_LOG")&&M.debug("receive message",i),s){let f;switch(i._type!==Ui.ACK&&(d&&(f=JSON.parse(d)),this.ack(i._id)),i._type){case Ui.CANDIDATE:case Ui.CONTROL:this.signal.emit(o,f,h);break;case Ui.PUBLISH:case Ui.UNPUBLISH:case Ui.RESTART_ICE:case Ui.CALL:f.uid=h,rs(this.signal,o,f).then(g=>{this.response(i._id,g)}).catch(()=>{this.response(i._id,void 0,!0)});break;case Ui.ACK:this.getListeners("res-@".concat(s,"_ack")).length>0&&this.emit("res-@".concat(s,"_ack"));break;case Ui.RESPONSE:{const{success:g,message:y}=f;this.emit("res-@".concat(s),g?"success":"failed",y);break}}}}splitMessage(i){if(i.length<Vy.MAX_MESSAGE_SIZE)return[i];const s=[],{remoteToken:o}=JSON.parse(i),d=dr(6,"");let h=0,f=800;const g=Math.ceil(i.length/f);for(;i.length>0;){h++;const y={id:d,index:h,total:g,payload:i.slice(0,f),token:"".concat(this.token,"_").concat(o)};JSON.stringify(y).length>Vy.MAX_MESSAGE_SIZE?f-=50:(s.push(y),i=i.slice(f))}return s.map(y=>JSON.stringify(y))}handleCheckToken(i,s){return i.token!==s?(M.debug("token changed, from ".concat(i.token," to ").concat(s)),this.reset(i.uid,s),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{M.debug("token timeout, ".concat(s)),this.reset(i.uid)},re("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const i=await rs(this.signal,Ui.CALL,void 0),s=await this.send(Ui.CALL,i);this.signal.emit(xt.P2P_CONNECTION,s,!0)}async reset(i,s){const o=this.userMap.get(i);o&&(this.emit(Ox.ABORT),this.signal.emit(Yt.ON_USER_OFFLINE,{uid:o.uid,reason:Obe.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),s||(M.debug("change local token from ".concat(s," to ").concat(s)),this.token=dr(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Ox.ABORT)}}Y(Vy,"MAX_SIZE",1),Y(Vy,"MAX_MESSAGE_SIZE",1024);class vTe extends ai{get connectionState(){return this._connectionState}set connectionState(i){i!==this._connectionState&&(this._connectionState=i,i===Cn.CONNECTED?this.emit(xt.WS_CONNECTED):i===Cn.RECONNECTING?this.emit(xt.WS_RECONNECTING,this._websocketReconnectReason):i===Cn.CLOSED&&this.emit(xt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(i,s){super(),Y(this,"__name__","P2PSignal"),Y(this,"_disconnectedReason",void 0),Y(this,"_websocketReconnectReason",void 0),Y(this,"_connectionState",Cn.CLOSED),Y(this,"reconnectToken",void 0),Y(this,"p2pToken",void 0),Y(this,"websocket",void 0),Y(this,"openConnectionTime",void 0),Y(this,"clientId",void 0),Y(this,"lastMsgTime",Date.now()),Y(this,"uploadCache",[]),Y(this,"uploadCacheInterval",void 0),Y(this,"rttRolling",new YV(5)),Y(this,"pingpongTimer",void 0),Y(this,"pingpongTimeoutCount",0),Y(this,"joinResponse",void 0),Y(this,"multiIpOption",void 0),Y(this,"initError",void 0),Y(this,"spec",void 0),Y(this,"store",void 0),Y(this,"_external_signal",void 0),Y(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(xt.ON_BINARY_DATA,o.data);const d=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(d,"_id")){const h="res-@".concat(d._id);this.emit(h,d._result,d._message)}else if(Object.prototype.hasOwnProperty.call(d,"_type")){switch(d._type){case Yt.ON_DATA_STREAM:return void this.handleDataStream(d._message);case Yt.MUTE_AUDIO:case Yt.MUTE_VIDEO:case Yt.ON_P2P_LOST:case Yt.ON_USER_ONLINE:return;case Yt.ON_USER_OFFLINE:const{uid:h}=d._message;return M.debug("[".concat(this.clientId,"] user-offline uid: ").concat(h)),void this._external_signal.reset(h)}if(this.emit(d._type,d._message),d._type===Yt.ON_NOTIFICATION&&this.handleNotification(d._message),d._type===Yt.ON_USER_BANNED)switch(d._message.error_code){case 14:this.close(Rn.UID_BANNED);break;case 15:this.close(Rn.IP_BANNED);break;case 16:this.close(Rn.CHANNEL_BANNED)}if(d._type===Yt.ON_USER_LICENSE_BANNED)switch(d._message.error_code){case jt.ERR_LICENSE_MISSING:this.close(Rn.LICENSE_MISSING);break;case jt.ERR_LICENSE_EXPIRED:this.close(Rn.LICENSE_EXPIRED);break;case jt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Rn.LICENSE_MINUTES_EXCEEDED);break;case jt.ERR_LICENSE_PERIOD_INVALID:this.close(Rn.LICENSE_PERIOD_INVALID);break;case jt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Rn.LICENSE_MULTIPLE_SDK_SERVICE);break;case jt.ERR_LICENSE_ILLEGAL:this.close(Rn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=i.clientId,this.spec=i,this.store=s,this.websocket=new z4("gateway-".concat(this.clientId),this.spec.retryConfig,!0,re("JOIN_GATEWAY_USE_DUAL_DOMAIN"),re("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Cn.CONNECTED&&this.reconnect("retry",va.OFFLINE)}),this.p2pToken=dr(6,""),this._external_signal=new Vy(this,this.p2pToken)}async request(i,s,o,d){const h=dr(6,""),f={_id:h,_type:i,_message:s},g=this.websocket.connectionID,y=()=>new et(($,z)=>{if(this.connectionState===Cn.CONNECTED)return $();const K=()=>{this.off(xt.WS_CLOSED,ie),$()},ie=()=>{this.off(xt.WS_CONNECTED,K),z(new Pe(se.WS_ABORT))};this.once(xt.WS_CONNECTED,K),this.once(xt.WS_CLOSED,ie)});if(this.connectionState!==Cn.CONNECTING&&this.connectionState!==Cn.RECONNECTING||i===kt.JOIN||i===kt.REJOIN||await y(),this.websocket.sendMessage(f,!0),d)return;const x=new et(($,z)=>{let K=!1;const ie=(fe,Ee)=>{K=!0,$({isSuccess:fe==="success",message:Ee||{}}),this.off(xt.WS_CLOSED,oe),this.off(xt.WS_RECONNECTING,oe),this.emit(xt.REQUEST_SUCCESS,i,s)};this.once("res-@".concat(h),ie);const oe=()=>{z(new Pe(se.WS_ABORT,"type: ".concat(i))),this.off(xt.WS_CLOSED,oe),this.off(xt.WS_RECONNECTING,oe),this.off("res-@".concat(h),ie)};this.once(xt.WS_CLOSED,oe),this.once(xt.WS_RECONNECTING,oe),As(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==g||K||(M.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(i)),this.emit(xt.REQUEST_TIMEOUT,i,s))})});let b=null;try{b=await x}catch($){if(this.connectionState===Cn.CLOSED||i===kt.LEAVE)throw new Pe(se.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?$.throw():i===kt.JOIN||i===kt.REJOIN?null:(await y(),await this.request(i,s))}if(b.isSuccess)return b.message;const N=Number(b.message.error_code||b.message.code),I=Ry(N),D=new Pe(se.UNEXPECTED_RESPONSE,"".concat(I.desc,": ").concat(b.message.error_str),{code:N,data:b.message,desc:I.desc});return I.action==="success"?b.message:(M.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(i,", error_code: ").concat(N,", message: ").concat(I.desc,", action: ").concat(I.action)),N===jt.ERR_TOO_MANY_BROADCASTERS?((i===kt.JOIN||i===kt.REJOIN)&&(this.initError=D,this.close()),D.throw()):I.action==="failed"?D.throw():I.action==="quit"?(this.initError=D,this.close(),D.throw()):(N===jt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=b.message.option,M.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",va.MULTI_IP)):this.reconnect(I.action,va.SERVER_ERROR),i===kt.JOIN||i===kt.REJOIN?null:await this.request(i,s)))}waitMessage(i,s){return new et(o=>{const d=h=>{(!s||s(h))&&(this.off(i,d),o(h))};this.on(i,d)})}uploadWRTCStats(i){if(!this.store.sessionId)return void M.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:i};this.upload(Ty.WRTC_STATS,s)}upload(i,s){const o={_type:i,_message:s};try{this.websocket.sendMessage(o)}catch{const h=re("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>h&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Cn.CONNECTED)return;const f=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(f._type,f._message)},re("UPLOAD_CACHE_INTERVAL")||2e3))}}send(i,s){const o={_type:i,_message:s};this.websocket.sendMessage(o)}async sendExtensionMessage(i,s,o){return await this._external_signal.send(i,s,o)}init(i){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new et((s,o)=>{this.once(xt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(xt.WS_CLOSED,()=>o(this.initError||new Pe(se.WS_ABORT))),this.connectionState=Cn.CONNECTING,this.websocket.init(i).catch(o)})}close(i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=i||Rn.LEAVE,this.connectionState=Cn.CLOSED,M.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=dr(6,""),this._external_signal.clear(),this._external_signal=new Vy(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(xt.ABORT_P2P_EXECUTION);const i=await rs(this,xt.REQUEST_JOIN_INFO),s=await this.request(kt.JOIN,i);if(!s)return this.emit(xt.REPORT_JOIN_GATEWAY,se.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(xt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Cn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(i,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(i,s)}async downgradeCodec(i){return!1}handleDataStream(i){try{var s;const o=py(i.payload),d=new TextDecoder().decode(o),h=JSON.parse(d);"total"in h&&"id"in h||Ge(s=Object.values(Ui)).call(s,h._type)?(h._uid=i.uid,this._external_signal.onMessage(h)):this.emit(Yt.ON_DATA_STREAM,i)}catch{this.emit(Yt.ON_DATA_STREAM,i)}}handleNotification(i){M.debug("[".concat(this.clientId,"] receive notification: "),i);const s=Ry(i.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?i.code===jt.ERR_REPEAT_JOIN_CHANNEL&&re("IGNORE_UID_CHECK")?void this.close(Rn.UID_CONFLICT):(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Rn.UID_BANNED),void this.close()):void this.reconnect(s.action,va.SERVER_ERROR);M.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const i=re("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=i&&(M.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>re("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",va.TIMEOUT):this.request(kt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-s;this.rttRolling.add(o),re("REPORT_STATS")&&this.send(kt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWebsocketEvents(){this.websocket.on(an.RECONNECT_CREATE_CONNECTION,i=>{this.emit(xt.WS_RECONNECT_CREATE_CONNECTION,i)}),this.websocket.on(an.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(an.CLOSED,()=>{this.connectionState=Cn.CLOSED}),this.websocket.on(an.FAILED,()=>{this._disconnectedReason=Rn.NETWORK_ERROR,this.connectionState=Cn.CLOSED}),this.websocket.on(an.RECONNECTING,i=>{this._websocketReconnectReason=i,this.joinResponse=void 0,this.connectionState===Cn.CONNECTED?this.connectionState=Cn.RECONNECTING:this.connectionState=Cn.CONNECTING}),this.websocket.on(an.WILL_RECONNECT,(i,s,o)=>{i!=="retry"?(M.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(i)),this.reconnectToken=void 0):M.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),o(i)}),this.websocket.on(an.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(i=>{if(this.emit(xt.REPORT_JOIN_GATEWAY,i,this.url||""),i instanceof Pe&&i.code===se.UNEXPECTED_RESPONSE&&i.data.code===jt.ERR_NO_AUTHORIZED)return M.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",va.SERVER_ERROR);M.error("[".concat(this.clientId,"] join gateway request failed"),i.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",va.SERVER_ERROR):(this.initError=i,this.close())})}),this.websocket.on(an.REQUEST_NEW_URLS,(i,s)=>{rs(this,xt.REQUEST_RECOVER,this.multiIpOption).then(i).catch(s)}),this.websocket.on(an.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Yt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const ETe={name:"P2PChannel",create:function(n){let{store:i,statsCollector:s}=n;return new yTe(i,s)},createSubmodule:function(n){let{store:i,spec:s}=n;return new vTe(s,i)}};function Vee(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function Fee(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?Vee(Object(s),!0).forEach(function(o){Y(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):Vee(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}class xTe{constructor(i){Y(this,"sessionDesc",void 0),Y(this,"localCapabilities",void 0),Y(this,"rtpCapabilities",void 0),Y(this,"candidates",void 0),Y(this,"_originCandidates",void 0),Y(this,"iceParameters",void 0),Y(this,"dtlsParameters",void 0),Y(this,"setup",void 0),Y(this,"currentMidIndex",void 0),Y(this,"cname",void 0),i=qr(i);const{iceParameters:s,dtlsParameters:o,candidates:d,rtpCapabilities:h,setup:f,localCapabilities:g,sdkCodec:y,cname:x}=i,b=Mo(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=h,this.candidates=d,this._originCandidates=qr(d),this.iceParameters=s,this.dtlsParameters=o,this.setup=f,this.localCapabilities=g,this.cname=x;for(let N=0;N<b.mediaDescriptions.length;N++){const I=b.mediaDescriptions[N];if(I.attributes.iceUfrag=s.iceUfrag,I.attributes.icePwd=s.icePwd,I.attributes.fingerprints=o.fingerprints,I.attributes.candidates=d,I.attributes.setup=f,I.media.mediaType==="video"){I.media.fmts=h.videoCodecs.map(z=>z.payloadType.toString(10));const D=h.videoCodecs.filter(z=>{var K,ie;return(K=z.rtpMap)===null||K===void 0?void 0:Ge(ie=K.encodingName.toLowerCase()).call(ie,y)}),$=h.videoCodecs.filter(z=>!Ge(D).call(D,z));I.attributes.payloads=[...D,...$],I.attributes.extmaps=h.videoExtensions}I.media.mediaType==="audio"&&(I.media.fmts=h.audioCodecs.map(D=>D.payloadType.toString(10)),I.attributes.payloads=h.audioCodecs,I.attributes.extmaps=h.audioExtensions),b.mediaDescriptions[N]=this.mungMediaDesc(I)}this.sessionDesc=b,this.currentMidIndex=b.mediaDescriptions.length-1}toString(){return um(this.sessionDesc)}send(i,s,o){const{ssrcs:d,ssrcGroups:h}=hR(s,this.cname),f=this.sessionDesc.mediaDescriptions.find(x=>i===pt.VIDEO?x.media.mediaType==="video":x.media.mediaType==="audio"),g=d[0].attributes.label,y=d[0].attributes.mslabel;return f.attributes.ssrcs=f.attributes.ssrcs.concat(d),f.attributes.ssrcGroups=f.attributes.ssrcGroups.concat(h),{id:g,mslabel:y}}batchSend(i){return i.map(s=>{let{kind:o,ssrcMsg:d}=s;return this.send(o,d,void 0)})}stopSending(i){this.sessionDesc.mediaDescriptions.forEach(s=>{const o=[],d=[],h=[];s.attributes.ssrcs.forEach(f=>{Ge(i).call(i,f.attributes.label||"")?h.push(f):o.push(f)}),s.attributes.ssrcGroups.forEach(f=>{var g;Ge(g=h.map(y=>y.ssrcId)).call(g,f.ssrcIds[0])||d.push(f)}),s.attributes.ssrcs=o,s.attributes.ssrcGroups=d})}mute(i){const s=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===i);if(!s)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(i){const s=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===i);if(!s)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}receive(i,s,o){i.forEach((d,h)=>{const f=d._mediaStreamTrack,g=this.sessionDesc.mediaDescriptions.findIndex(x=>x.attributes.mid===f.kind),y=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[g],d);this.sessionDesc.mediaDescriptions[g]=y})}stopReceiving(i){}updateCandidates(i){const s=this._originCandidates.filter(d=>d.transport==="udp"),o=[];if(s.forEach(d=>{o.push(Fee(Fee({},d),{},{foundation:"tcpcandidate",priority:Number(d.priority)-1+"",transport:"tcp",port:Number(d.port)+90+""}))}),s.length!==0){switch(i){case Ys.TCP_RELAY:this.candidates=o;break;case Ys.UDP_TCP_RELAY:case Ys.RELAY:this.candidates=[...s,...o];break;default:this.candidates=s}for(const d of this.sessionDesc.mediaDescriptions)d.attributes.candidates=this.candidates}}restartICE(i){i=qr(i),this.iceParameters=i,this.sessionDesc.mediaDescriptions.forEach(s=>{s.attributes.iceUfrag=i.iceUfrag,s.attributes.icePwd=i.icePwd})}predictReceivingMids(i){const s=[];for(let o=0;o<i;o++)s.push((this.currentMidIndex+o+1).toString(10));return s}mungRecvMediaDsec(i,s){const o=qr(i);return Cy(o,s),Y4(o,s),o}updateRecvMedia(i,s){const o=this.sessionDesc.mediaDescriptions.findIndex(d=>d.attributes.mid===i);if(o!==-1){const d=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],s);this.sessionDesc.mediaDescriptions[o]=d}}bumpMid(i){this.currentMidIndex+=i}updateTrackLabel(i,s,o){const d=this.sessionDesc.mediaDescriptions.find(f=>i===pt.VIDEO?f.attributes.mid==="video":f.attributes.mid==="audio");if(d){const f=d.attributes.ssrcs.find(g=>g.attributes.label===s);var h;f&&(f.attributes.label=o,(h=f.attributes.msid)===null||h===void 0||h.replace(s,o))}}mungMediaDesc(i){const s=qr(i);return q4(s),function(o){const d=o.attributes.extmaps.find(h=>vP(h.extensionName));d&&o.attributes.extmaps.splice(o.attributes.extmaps.indexOf(d),1),o.attributes.payloads.forEach(h=>{const f=h.rtcpFeedbacks.findIndex(g=>g.type==="transport-cc");f!==-1&&h.rtcpFeedbacks.splice(f,1)})}(s),s}getSSRC(i){for(const s of this.sessionDesc.mediaDescriptions)for(const o of s.attributes.ssrcs)if(o.attributes.label===i)return[o]}}var Lr;function Bee(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function r2(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?Bee(Object(s),!0).forEach(function(o){Y(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):Bee(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}let bTe=(Lr=class vC extends fP{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(i=>i.rtpMap&&i.rtpMap.encodingName.toLowerCase()||"").filter(i=>{var s;return Ge(s=Object.keys(gy)).call(s,i)}))]}constructor(i,s){super(i,s),Y(this,"store",void 0),Y(this,"peerConnection",void 0),Y(this,"remoteSDP",void 0),Y(this,"initialOffer",void 0),Y(this,"statsFilter",void 0),Y(this,"useRTX",!1),Y(this,"localCapabilities",void 0),Y(this,"localCandidateCount",0),Y(this,"allCandidatesReceived",!1),Y(this,"establishPromise",void 0),Y(this,"mutex",void 0),this.store=s,this.mutex=new qs("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(vC.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.statsFilter=zk(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,Kr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const i=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=rf(i.sdp),o=uR(i.sdp,{filterRTX:!this.useRTX,filterVideoFec:re("FILTER_VIDEO_FEC"),filterAudioFec:re("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=o,this.initialOffer=i,r2(r2({},s),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:o},offerSDP:i.sdp})}catch(i){throw new Pe(se.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async updateRemoteConnect(){}async connect(i){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new xTe(r2(r2({},i),{},{rtpCapabilities:i.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(s){throw new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async updateRemoteRTPCapabilities(i,s){throw new Pe(se.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(i){}send(i,s){var o=this;return fc(function*(){const d=yield hn(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=i.map(I=>o.peerConnection.addTrack(I._mediaStreamTrack)),f=yield hn(o.peerConnection.createOffer()),g=Mo(f.sdp),y=i.map(I=>{const D=I._mediaStreamTrack,$=g.mediaDescriptions.find(z=>z.attributes.mid===D.kind);if(!$)throw new Error("Cannot extract ssrc from mediaDescription.");return function(z,K,ie){const oe=z.attributes.ssrcs.filter(Ee=>Ee.attributes.label===K),fe=z.attributes.ssrcGroups;if(oe.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(fe&&oe.length>1){const Ee=fe.find(Te=>Te.ssrcIds.indexOf(oe[0].ssrcId)!==-1);return Ee?[{ssrcId:Ee.ssrcIds[0],rtx:ie?Ee.ssrcIds[1]:void 0}]:[{ssrcId:oe[0].ssrcId}]}return[{ssrcId:oe[0].ssrcId}]}($,D.id,o.useRTX)});let x;try{x=yield y}catch(I){throw h.forEach(D=>{Ks()&&D.replaceTrack(null),o.peerConnection.removeTrack(D)}),I}const b=o.mungSendOfferSDP(f.sdp,i);o.remoteSDP.receive(i,s,x);const N=o.remoteSDP.toString();return yield hn(o.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield hn(o.applySendEncodings(h,i)),yield hn(o.peerConnection.setRemoteDescription({type:"answer",sdp:N})),i.map((I,D)=>{const $=I._mediaStreamTrack.id;return{localSSRC:y[D],id:$}})}catch(h){throw new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}async stopSending(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getSenders().filter(h=>{var f;return i.indexOf(((f=h.track)===null||f===void 0?void 0:f.id)||"")!==-1});if(s.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(h=>{Ks()&&h.replaceTrack(null),this.peerConnection.removeTrack(h)});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(i);const d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}}async receive(i,s,o,d){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{id:h,mslabel:f}=this.remoteSDP.send(i,s,d),g=new et((b,N)=>{const I=setTimeout(()=>{N(new Error("Cannot receive track, id: ".concat(h)))},1e4),D=$=>{const z=Wn();if((z.name==="Safari"&&Number(z.version)===11||$a())&&$.track.id!==h&&$.streams[0].id===f){var K;const ie=$.streams[0].getTracks()[0];return(K=this.remoteSDP)===null||K===void 0||K.updateTrackLabel(i,h,$.track.id),this.peerConnection.removeEventListener("track",D),clearTimeout(I),void b(ie)}if($.track.id===h)return this.peerConnection.removeEventListener("track",D),clearTimeout(I),void b($.track)};this.peerConnection.addEventListener("track",D)}),y=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:y});const x=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(x),{track:await g,id:h}}catch(h){throw new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}}async stopReceiving(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(i);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o)}catch(s){throw new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(i){}async unmuteRemote(i){}async muteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(o=>{var d;return i.indexOf(((d=o.track)===null||d===void 0?void 0:d.id)||"")!==-1});if(s.length!==i.length)throw new Error("sender' length doesn't match mids' length.");s.map(o=>{if(Ks()&&o.track)o.track.enabled=!1;else{const d=o.getParameters();d.encodings.forEach(h=>h.active=!1),o.setParameters(d)}})}catch(s){throw new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(h=>{var f;return i.indexOf(((f=h.track)===null||f===void 0?void 0:f.id)||"")!==-1});if(s.length!==i.length)throw new Error("Senders' length doesn't match mids' length.");s.map(async h=>{if(Ks()&&h.track)h.track.enabled=!0;else{const f=h.getParameters();f.encodings.forEach(g=>g.active=!0),await h.setParameters(f)}});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o);const d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(i){var s=this;return fc(function*(){const o=yield hn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const d=xn().supportPCSetConfiguration;if(i===Ys.RELAY&&!d)return;if(d){const x=s.peerConnection.getConfiguration(),b=i===Ys.RELAY?"relay":"all";x.iceTransportPolicy!==b&&(M.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(x.iceTransportPolicy,"] to [").concat(b,"]")),x.iceTransportPolicy=b,s.peerConnection.setConfiguration(x))}i!==Ys.RELAY&&s.remoteSDP.updateCandidates(i);const h=yield hn(s.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const f=rf(h.sdp),{remoteIceParameters:g}=yield f.iceParameters;s.remoteSDP.restartICE(g);const y=s.remoteSDP.toString();yield hn(s.peerConnection.setLocalDescription(h)),yield hn(s.peerConnection.setRemoteDescription({type:"answer",sdp:y}))}catch(d){M.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),d)}finally{o()}})()}close(){var i;this.peerConnection.close(),(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}async updateEncoderConfig(i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),d=this.mungSendOfferSDP(o.sdp,[s]);this.remoteSDP.updateRecvMedia(s._mediaStreamTrack.kind,s);const h=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:d}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(o){throw new Pe(se.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(i,s){const o=this.peerConnection.getSenders().filter(d=>{var h;return((h=d.track)===null||h===void 0?void 0:h.id)===i});o.length===1&&await this.applySendEncodings(o,[s])}setStatsRemoteVideoIsReady(i,s){this.statsFilter.setVideoIsReady2(i,s)}async replaceTrack(i,s){const o=this.peerConnection.getSenders().find(d=>{var h;return((h=d.track)===null||h===void 0?void 0:h.id)===s});o&&await o.replaceTrack(i._mediaStreamTrack)}createDataChannels(i,s){throw new Pe(se.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(i){throw new Pe(se.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,M.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,M.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},re("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const s={iceServers:[],sdpSemantics:"plan-b"};return i.iceServers?s.iceServers=i.iceServers:i.turnServer&&i.turnServer.mode!=="off"&&(ly(i.turnServer.servers)?s.iceServers=i.turnServer.servers:(s.iceServers&&s.iceServers.push(...vC.turnServerConfigToIceServers(i.turnServer.servers)),re("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&i.turnServer.serversFromGateway&&s.iceServers.push(...vC.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(s.iceTransportPolicy="relay")}))),s}static turnServerConfigToIceServers(i){const s=[];return i.forEach(o=>{o.security?o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),s}async updateRtpSenderEncodings(i,s){var o;if(s||(s=this.peerConnection.getSenders().find(x=>{var b;return((b=x.track)===null||b===void 0?void 0:b.id)===i._mediaStreamTrack.id})),!s)return M.warn("[".concat(i.getTrackId(),"] no rtpSender found}"));if(!xn().supportSetRtpSenderParameters)return M.warn("Browser not support set rtp-sender parameters");const d={},h={};if(i instanceof Rr)switch(i._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;default:d.degradationPreference="balanced"}if(re("DSCP_TYPE")&&Jp()){var f;const x=re("DSCP_TYPE");Ge(f=["very-low","low","medium","high"]).call(f,x)&&(h.networkPriority=x)}const g=s.getParameters(),y=(o=g.encodings)===null||o===void 0?void 0:o[0];y&&Object.assign(y,h),Object.assign(g,d),M.debug("[".concat(i.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),await s.setParameters(g)}async applySendEncodings(i,s){try{if(!xn().supportSetRtpSenderParameters||i.length!==s.length)return;for(let o=0;o<i.length;o++){const d=i[o],h=s[o];d&&h&&await this.updateRtpSenderEncodings(h,d)}}catch{M.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(i,s){const o=Mo(i);return s.forEach((d,h)=>{const f=d._mediaStreamTrack,g=o.mediaDescriptions.find(y=>y.attributes.mid===f.kind);g&&Cy(g,d)}),um(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,s,o)=>{var d;(d=this.onFirstVideoDecoded)===null||d===void 0||d.call(this,i,s,o)},this.statsFilter.onSelectedLocalCandidateChanged=(i,s)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,i,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,s)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,i,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const s=this.remoteSDP.batchSend(i).map((h,f)=>{let{id:g,mslabel:y}=h;const{kind:x}=i[f];return new et((b,N)=>{const I=setTimeout(()=>{N(new Error("Cannot receive track, id: ".concat(g)))},1e4),D=$=>{const z=Wn();if(z.name==="Safari"&&Number(z.version)===11&&$.track.id!==g&&$.streams[0].id===y){var K;const ie=$.streams[0].getTracks()[0];return(K=this.remoteSDP)===null||K===void 0||K.updateTrackLabel(x,g,$.track.id),this.peerConnection.removeEventListener("track",D),clearTimeout(I),void b({track:ie,id:g})}if($.track.id===g)return this.peerConnection.removeEventListener("track",D),clearTimeout(I),void b({track:$.track,id:g})};this.peerConnection.addEventListener("track",D)})}),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const d=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(d),await et.all(s)}catch(s){throw new Pe(se.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async getRemoteSSRC(i){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(i);return s==null?void 0:s[0].ssrcId}setConfiguration(i){if(xn().supportPCSetConfiguration){const s=vC.resolvePCConfiguration(i);this.peerConnection.setConfiguration(s)}}},it(Lr.prototype,"connect",[Fd],Object.getOwnPropertyDescriptor(Lr.prototype,"connect"),Lr.prototype),it(Lr.prototype,"stopSending",[Fd],Object.getOwnPropertyDescriptor(Lr.prototype,"stopSending"),Lr.prototype),it(Lr.prototype,"receive",[Fd],Object.getOwnPropertyDescriptor(Lr.prototype,"receive"),Lr.prototype),it(Lr.prototype,"stopReceiving",[Fd],Object.getOwnPropertyDescriptor(Lr.prototype,"stopReceiving"),Lr.prototype),it(Lr.prototype,"muteRemote",[Fd],Object.getOwnPropertyDescriptor(Lr.prototype,"muteRemote"),Lr.prototype),it(Lr.prototype,"unmuteRemote",[Fd],Object.getOwnPropertyDescriptor(Lr.prototype,"unmuteRemote"),Lr.prototype),it(Lr.prototype,"muteLocal",[Fd],Object.getOwnPropertyDescriptor(Lr.prototype,"muteLocal"),Lr.prototype),it(Lr.prototype,"unmuteLocal",[Fd],Object.getOwnPropertyDescriptor(Lr.prototype,"unmuteLocal"),Lr.prototype),it(Lr.prototype,"close",[Fd],Object.getOwnPropertyDescriptor(Lr.prototype,"close"),Lr.prototype),it(Lr.prototype,"updateEncoderConfig",[Fd],Object.getOwnPropertyDescriptor(Lr.prototype,"updateEncoderConfig"),Lr.prototype),it(Lr.prototype,"updateSendParameters",[Fd],Object.getOwnPropertyDescriptor(Lr.prototype,"updateSendParameters"),Lr.prototype),it(Lr.prototype,"replaceTrack",[Fd],Object.getOwnPropertyDescriptor(Lr.prototype,"replaceTrack"),Lr.prototype),it(Lr.prototype,"getRemoteSSRC",[Fd],Object.getOwnPropertyDescriptor(Lr.prototype,"getRemoteSSRC"),Lr.prototype),Lr);function Fd(n,i,s){const o=n[i];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const d=this.mutex,h=await d.lock("Locking from P2PConnection.".concat(i));try{for(var f=arguments.length,g=new Array(f),y=0;y<f;y++)g[y]=arguments[y];return await o.apply(this,g)}finally{h()}},s}const wTe={name:"PlanBConnection",create:function(n){let{store:i,spec:s}=n;return new bTe(s,i)}},STe={interceptLocalAudioFrame:async function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!xn().supportWebRTCEncodedTransform)return void M.warning("browser not support audio encoded transform");if(tP.has(n)||!n.track)return;const s={track:n.track};if(lm()){if(!n.createEncodedStreams)return void M.warning("browser not support createEncodedStreams() API");let d=null;try{d=n.createEncodedStreams()}catch(f){return void M.error("create audio-encoded-streams error",f&&f.message)}const h=new TransformStream({transform(f,g){s.controller||(s.controller=g),n.track&&n.track.id!==s.track.id&&(M.debug("audio track changed: ".concat(s.track.id," => ").concat(n.track.id)),s.track.removeEventListener("ended",o),s.track=n.track,s.track.addEventListener("ended",o));const y=i.metadata&&i.metadata();y?function(x,b){const{chunk:N,controller:I}=b,D=Kg.METADATA;N.data=function($,z,K){const ie=K.byteLength,oe=ie+T4+OX,fe=w4+S4+oe,Ee=new ArrayBuffer($.byteLength+fe),Te=new DataView(Ee);Te.setUint8(0,DX),Te.setUint16(1,oe),Te.setUint8(3,z),Te.setUint16(4,ie);for(let Re=0;Re<ie;Re++)Te.setUint8(6+Re,K[Re]);const _e=new Uint8Array(Te.buffer);return _e.set(new Uint8Array($),fe),_e.buffer}(N.data,D,x),I.enqueue(N)}(y,{chunk:f,controller:g}):g.enqueue(f)}});d.readable.pipeThrough(h).pipeTo(d.writable)}else if(Ks()){if(typeof RTCRtpScriptTransform>"u")return void M.warning("browser not support RTCRtpScriptTransform");const d=eP(),h=new MessageChannel;await new et(g=>d.onmessage=y=>{y.data==="registered"&&g(void 0)});const f=new RTCRtpScriptTransform(d,{name:"audio-metadata-tx",port:h.port2},[h.port2]);n.transform=f,await new et(g=>d.onmessage=y=>{y.data==="started"&&g(void 0)}),h.port1.onmessage=g=>{var y;if(g.data.transformed&&n.track&&((y=n.track)===null||y===void 0?void 0:y.id)!==s.track.id)M.debug("audio track changed: ".concat(s.track.id," => ").concat(n.track.id)),s.track.removeEventListener("ended",o),s.track=n.track,s.track.addEventListener("ended",o);else if(g.data.getMetadata){const x=i.metadata&&i.metadata();x&&h.port1.postMessage({metadata:x})}},s.worker=d}function o(){if(n.track){if(this.id!==n.track.id)return;n.track.removeEventListener("ended",o)}const d=tP.get(n);if(d){tP.delete(n);try{var h,f;(h=d.controller)===null||h===void 0||h.terminate(),(f=d.worker)===null||f===void 0||f.terminate()}catch(g){M.warning(g&&g.message)}}}tP.set(n,s),n.track.addEventListener("ended",o)},interceptRemoteAudioFrame:async function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!xn().supportWebRTCEncodedTransform)return void M.warning("browser not support audio encoded transform");if(oP.has(n))return;const s={track:n.track,onMetadata:i.onMetadata,onPts:i.onPts};if(lm()&&!$a()){if(!n.createEncodedStreams)return void M.warning("browser not support createEncodedStreams() API");OV($n.CHROME,87,116)||(i.enableTopn=!1);let d=null;try{d=n.createEncodedStreams()}catch(f){return void M.error("create audio-encoded-streams error",f&&f.message)}const h=new TransformStream({transform(f,g){s.controller||(s.controller=g),n.track&&n.track.id!==s.track.id&&(M.debug("audio track changed: ".concat(s.track.id," => ").concat(n.track.id)),s.track.removeEventListener("ended",o),s.track=n.track,s.track.addEventListener("ended",o)),i.enableTopn?function(y,x,b){var N;const I=R4(new DataView(x.data));if(!I)return b.enqueue(x);const D=y.track.id;tbe.set(D,y.track);const $=(N=I.tlv.find(Ee=>Ee.tag===Kg.AUDIO_LEVEL))===null||N===void 0?void 0:N.value;let z=0;typeof $=="number"&&(z=127-$);const K=Math.round(Math.pow(10,z/60)-1),{selected:ie,speaker:oe}=function(Ee,Te){let _e=Ax.get(Ee);if(_e||(_e=function(Re){const je=new jX;return Ax.set(Re,je),Oh||(Oh=new Zxe(re("TOPN_SILENCE_THRESHOLD")||500),Oh.on("ActiveSpeakerChanged",Be=>{Be!=null&&(iP=Be)})),Oh.addSpeakers([je]),je}(Ee)),Ax.size<=MX)return{selected:!0,speaker:_e};if(!Oh)throw new Error("no active speaker detector");return Oh.levelChanged(_e.id,Te),by=Oh.loudest.map(Re=>Re.id),iP&&!Ge(by).call(by,iP)&&by.length>=MX&&by.pop(),{selected:Ge(by).call(by,_e.id)||_e.id===iP,speaker:_e}}(y,K),fe=function(Ee,Te,_e){const Re=Lh.get(Ee)||new ebe(Ee,Te);return Re.score=_e,Lh.set(Ee,Re),function(je){if(sP.set(je,!0),!aP)return void(aP=Date.now());const Be=Date.now();Be-aP>1e3&&(sP.get(je)?sP.set(je,!1):(UX(je),sP.delete(je)),aP=Be)}(Ee),Re}(D,y.track,oe.energyScore);fe.addSample(ie),fe.active&&(x.data=I.frame.buffer,b.enqueue(x))}(n,f,g):i.enableMetadata||i.enablePts?function(y,x,b,N){const I=new DataView(y.data),D=I.getUint8(0);let $;if(128&D&&D!==71){const ie=function(oe){if(oe.byteLength<=0)return[];const fe=[];let Ee=0;for(;Ee<oe.byteLength;){const _e=(128&oe.getUint8(Ee))>>7,Re=127&oe.getUint8(Ee);if(!(_e&&Ee+4<=oe.byteLength)){Ee++;break}{const je=oe.getUint32(Ee,!1),Be=(16776192&je)>>10,dt=1023&je;fe.push({pt:Re,ts_offset:Be,length:dt,data:new Uint8Array}),Ee+=4}}let Te=oe.byteLength-Ee;for(const _e of fe){if(_e.length>Te)return console.warn("Broken red payload"),[];_e.length>0&&(_e.data=new Uint8Array(oe.buffer,oe.byteOffset+Ee,_e.length),Ee+=_e.length,Te-=_e.length)}if(Te>0){const _e={pt:fe.length>0?fe[fe.length-1].pt:0,ts_offset:0,length:Te,data:new Uint8Array(oe.buffer,oe.byteOffset+Ee,Te)};fe.push(_e)}return fe}(I);if(ie.length>0){const oe=function(fe){let Ee=0;for(let Re=0;Re<fe.length;Re++)Ee+=Re<fe.length-1?4:1,Ee+=fe[Re].length;const Te=new Uint8Array(Ee);let _e=0;for(let Re=0;Re<fe.length;Re++)if(Re<fe.length-1){const je=(2147483648|(127&fe[Re].pt)<<24|(262143&fe[Re].ts_offset)<<10|1023&fe[Re].length)>>>0;Te[_e++]=je>>24&255,Te[_e++]=je>>16&255,Te[_e++]=je>>8&255,Te[_e++]=255&je}else Te[_e++]=127&fe[Re].pt;for(const Re of fe)Te.set(Re.data,_e),_e+=Re.length;return Te}(ie.map(fe=>{const Ee=new Uint8Array(fe.length);Ee.set(fe.data);const Te=R4(new DataView(Ee.buffer));return Te!=null&&Te.frame&&(fe.data=Te==null?void 0:Te.frame),$=Te,fe}));y.data=oe.buffer}}else $=R4(I),$&&(y.data=$.frame.buffer);if(x.enqueue(y),!$)return;const z=$.tlv.find(ie=>ie.tag===Kg.METADATA);z&&b&&z.value instanceof Uint8Array&&b(z.value);const K=$.tlv.find(ie=>ie.tag===Kg.AUDIO_64_BIT_PTS);K&&N&&K.value instanceof Uint8Array&&K.value.length==8&&N(new DataView(K.value.buffer).getBigUint64(0,!0))}(f,g,i.onMetadata,i.onPts):g.enqueue(f)}});d.readable.pipeThrough(h).pipeTo(d.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void M.warning("browser not support RTCRtpScriptTransform");const d=eP(),h=new MessageChannel;await new et(g=>d.onmessage=y=>{y.data==="registered"&&g(void 0)});const f=new RTCRtpScriptTransform(d,{name:"audio-metadata-rx",port:h.port2},[h.port2]);n.transform=f,await new et(g=>d.onmessage=y=>{y.data==="started"&&g(void 0)}),h.port1.onmessage=g=>{var y;g.data.transformed&&n.track&&((y=n.track)===null||y===void 0?void 0:y.id)!==s.track.id?(M.debug("audio track changed: ".concat(s.track.id," => ").concat(n.track.id)),s.track.removeEventListener("ended",o),s.track=n.track,s.track.addEventListener("ended",o)):g.data.metadata&&s.onMetadata?s.onMetadata(g.data.metadata):g.data.pts&&s.onPts&&s.onPts(g.data.pts)},s.worker=d}function o(){n.track.removeEventListener("ended",o),function(d){const h=oP.get(d);if(h){(function(y){const x=Ax.get(y);x&&(Ax.delete(y),Oh&&(Oh.removeSpeakers([x]),Ax.size===0&&(Oh.destroy(),Oh=null)))})(d),UX(d.track.id),oP.delete(d);try{var f,g;(f=h.controller)===null||f===void 0||f.terminate(),(g=h.worker)===null||g===void 0||g.terminate()}catch(y){M.warning(y&&y.message)}}}(n)}oP.set(n,s),n.track.addEventListener("ended",o)},interceptLocalVideoFrame:async function(n,i){if(!xn().supportWebRTCEncodedTransform)return void M.warning("browser not support video encoded transform");if(cP.has(n)||!n.track)return;const s={track:n.track};if(lm()){if(!n.createEncodedStreams)return void M.warning("browser not support createEncodedStreams() API");let d=null;try{d=n.createEncodedStreams()}catch(g){return void M.error("create video-encoded-streams error",g&&g.message)}const h=[];i.on("sei-to-send",g=>{h.push(g)});const f=new TransformStream({transform(g,y){s.controller||(s.controller=y),n.track&&n.track.id!==s.track.id&&(M.debug("video track changed: ".concat(s.track.id," => ").concat(n.track.id)),s.track.removeEventListener("ended",o),s.track=n.track,s.track.addEventListener("ended",o));const x=BX(new Uint8Array(g.data)),b=h.shift();if(b){const N=function(I,D,$){switch($){case A4:return function(z,K){const ie=FX(K),oe=ie.length,fe=Math.floor(oe/255),Ee=oe%255,Te=new Uint8Array(6+fe+1+oe+z.byteLength);Te[0]=0,Te[1]=0,Te[2]=0,Te[3]=1,Te[4]=6,Te[5]=101;let _e=0;for(;_e<fe;)Te[6+_e]=255,_e++;return Te[6+_e]=Ee,_e++,Te.set(ie,6+_e),Te.set(new Uint8Array(z),6+_e+oe),Te.buffer}(I,D);case k4:return function(z,K){const ie=FX(K),oe=ie.length,fe=Math.floor(oe/255),Ee=oe%255,Te=new Uint8Array(7+fe+1+oe+1+z.byteLength);Te[0]=0,Te[1]=0,Te[2]=0,Te[3]=1,Te[4]=78,Te[5]=1,Te[6]=101;let _e=0;for(;_e<fe;)Te[7+_e]=255,_e++;return Te[7+_e]=Ee,_e++,Te.set(ie,7+_e),_e+=oe,Te[7+_e]=128,_e++,Te.set(new Uint8Array(z),7+_e),Te.buffer}(I,D);default:return null}}(g.data,b,x);N&&(g.data=N)}y.enqueue(g)}});d.readable.pipeThrough(f).pipeTo(d.writable)}else{if(!Ks())return;{if(typeof RTCRtpScriptTransform>"u")return void M.warning("browser not support RTCRtpScriptTransform");const d=eP(),h=new MessageChannel;await new et(g=>d.onmessage=y=>{y.data==="registered"&&g(void 0)});const f=new RTCRtpScriptTransform(d,{name:"sei-tx",port:h.port2},[h.port2]);n.transform=f,await new et(g=>d.onmessage=y=>{y.data==="started"&&g(void 0)}),i.on("sei-to-send",g=>{h.port1.postMessage({sei:g})}),h.port1.onmessage=g=>{var y;g.data.transformed&&n.track&&((y=n.track)===null||y===void 0?void 0:y.id)!==s.track.id&&(M.debug("video track changed: ".concat(s.track.id," => ").concat(n.track.id)),s.track.removeEventListener("ended",o),s.track=n.track,s.track.addEventListener("ended",o))},s.worker=d}}function o(){if(n.track){if(this.id!==n.track.id)return;n.track.removeEventListener("ended",o)}const d=cP.get(n);if(d){cP.delete(n);try{var h,f;(h=d.controller)===null||h===void 0||h.terminate(),(f=d.worker)===null||f===void 0||f.terminate()}catch(g){M.warning(g&&g.message)}}}cP.set(n,s),n.track.addEventListener("ended",o)},interceptRemoteVideoFrame:async function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!xn().supportWebRTCEncodedTransform)return void M.warning("browser not support video encoded transform");if(!n.track)return;if(oR.has(n)){const d=oR.get(n);return void(d&&(d.onSei=i.onSei))}const s={track:n.track,onSei:i.onSei};if(lm()){if(!n.createEncodedStreams)return void M.warning("browser not support createEncodedStreams() API");let d=null;try{d=n.createEncodedStreams()}catch(f){return void M.error("create video-encoded-streams error",f&&f.message)}const h=new TransformStream({transform(f,g){if(s.controller||(s.controller=g),!s.firstFrameInfo){var y;const b=f.getMetadata()||{};s.firstFrameInfo=zr({type:f.type,rtpTimestamp:f.timestamp,payloadType:b.payloadType||0,ssrc:b.synchronizationSource||0,length:f.data.byteLength},"mimeType"in b?{mimeType:b.mimeType}:{}),(y=i.onFirstFrame)===null||y===void 0||y.call(i,s.firstFrameInfo)}n.track&&n.track.id!==s.track.id&&(M.debug("video track changed: ".concat(s.track.id," => ").concat(n.track.id)),s.track.removeEventListener("ended",o),s.track=n.track,s.track.addEventListener("ended",o));const x=function(b,N){switch(N){case A4:return function(I){const D=new DataView(I.data);let $=0;for(;$+4<I.data.byteLength;){if(D.getUint8($+0)===0&&D.getUint8($+1)===0&&D.getUint8($+2)===0&&D.getUint8($+3)===1&&D.getUint8($+4)===6){let z=$+6,K=0,ie=0;for(;(ie=D.getUint8(z++))===255;)K+=255;K+=ie;const oe=VX(I.data,z,K);return new Uint8Array(oe)}$++}return null}(b);case k4:return function(I){const D=new DataView(I.data);let $=0;for(;$+5<I.data.byteLength;){if(D.getUint8($+0)===0&&D.getUint8($+1)===0&&D.getUint8($+2)===0&&D.getUint8($+3)===1&&D.getUint8($+4)===78&&D.getUint8($+5)===1&&D.getUint8($+6)===101){let z=$+7,K=0,ie=0;for(;(ie=D.getUint8(z++))===255;)K+=255;K+=ie;const oe=VX(I.data,z,K);return new Uint8Array(oe)}$++}return null}(b);default:return null}}(f,BX(new Uint8Array(f.data)));x&&s.onSei&&s.onSei(x),g.enqueue(f)}});d.readable.pipeThrough(h).pipeTo(d.writable)}else if(Ks()){if(typeof RTCRtpScriptTransform>"u")return void M.warning("browser not support RTCRtpScriptTransform");const d=eP(),h=new MessageChannel;await new et(g=>d.onmessage=y=>{y.data==="registered"&&g(void 0)});const f=new RTCRtpScriptTransform(d,{name:"sei-rx",port:h.port2},[h.port2]);n.transform=f,await new et(g=>d.onmessage=y=>{y.data==="started"&&g(void 0)}),h.port1.onmessage=g=>{var y;if(g.data.transformed&&n.track&&((y=n.track)===null||y===void 0?void 0:y.id)!==s.track.id)M.debug("video track changed: ".concat(s.track.id," => ").concat(n.track.id)),s.track.removeEventListener("ended",o),s.track=n.track,s.track.addEventListener("ended",o);else if(g.data.sei&&s.onSei)s.onSei(g.data.sei);else if(g.data.firstFrameInfo&&i.onFirstFrame){var x;(x=i.onFirstFrame)===null||x===void 0||x.call(i,g.data.firstFrameInfo)}},s.worker=d}function o(){if(n.track){if(this.id!==n.track.id)return;n.track.removeEventListener("ended",o)}(function(d){const h=oR.get(d);if(h){oR.delete(d);try{var f,g;(f=h.controller)===null||f===void 0||f.terminate(),(g=h.worker)===null||g===void 0||g.terminate()}catch(y){M.warning(y&&y.message)}}})(n)}oR.set(n,s),n.track.addEventListener("ended",o)}},TTe={name:"InterceptFrame",create:()=>STe};var Un;function zee(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}function Wh(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?zee(Object(s),!0).forEach(function(o){Y(n,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):zee(Object(s)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(s,o))})}return n}let RTe=(Un=class gb extends fP{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var i,s;return(i=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&i!==void 0?i:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(i=>i.rtpMap&&i.rtpMap.encodingName.toLowerCase()||"").filter(i=>{var s;return Ge(s=Object.keys(gy)).call(s,i)}))]}constructor(i,s,o){super(i,s),Y(this,"id",dr(5,"connection-")),Y(this,"store",void 0),Y(this,"peerConnection",void 0),Y(this,"forceTurn",!1),Y(this,"remoteSDP",void 0),Y(this,"initialOffer",void 0),Y(this,"transportEventReceiver",void 0),Y(this,"statsFilter",void 0),Y(this,"extension",{useXR:re("USE_XR")}),Y(this,"localCapabilities",void 0),Y(this,"remoteCodecs",void 0),Y(this,"localCandidateCount",0),Y(this,"allCandidatesReceived",!1),Y(this,"isPreallocation",!1),Y(this,"preMediaMap",new Map),Y(this,"dataStreamChannelMap",new Map),Y(this,"establishPromise",void 0),Y(this,"recoveredDataChannelIds",[]),Y(this,"currentDataChannelId",1),Y(this,"supportAV1RtpSpec",!1),Y(this,"mutex",void 0),Y(this,"qualityLimitationReason",yx.NONE),Y(this,"isFirstConnected",!1),this.store=s,this.forceTurn=f3(i),this.mutex=new qs("NVConnectionExtension-mutex",s.clientId),this.peerConnection=o,this.isFirstConnected=!1,this.statsFilter=zk(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,Kr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,i.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(i){return this.preMediaMap.get(i)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(i,s){if(this.remoteCodecs=s,!this.remoteSDP)return void M.debug("[NVConnectionExtension] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(s));if(this.remoteSDP.updateRemoteCodec(i,s,this.store.codec)){const o=await this.peerConnection.createOffer(),d=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);const h=this.remoteSDP.toString();d==null||d(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}else M.debug("[NVConnectionExtension] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const s=await this.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const o=rf(s.sdp),d=await X4({filterRTX:!re("USE_PUB_RTX")&&!re("USE_SUB_RTX"),filterVideoFec:re("FILTER_VIDEO_FEC"),filterAudioFec:re("FILTER_AUDIO_FEC"),filterVideoCodec:re("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:re("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:re("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=pR(d),this.initialOffer=s,re("ENABLE_SVC")&&this.store.codec=="av1"){const f=await mJ();var i;f&&(this.supportAV1RtpSpec=!0,(i=d.send)===null||i===void 0||i.videoExtensions.push(f))}let h;return s.sdp&&xP(s.sdp)&&(h=qr(d),oJ(h)),Wh(Wh({},o),{},{rtpCapabilities:h||d,offerSDP:s.sdp})}catch(s){throw new Pe(se.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(i){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnectionExtension without initial offer.");this.initialOffer.sdp&&xP(this.initialOffer.sdp)&&cJ(i.rtpCapabilities,this.localCapabilities),this.remoteSDP=new FJ(Wh(Wh({},i),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!re("ENABLE_PRE_SUB_WITH_PRE_PC")||!re("PRE_USE_LOCAL_CODECS"))&&iR(this.store),!0),i.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString(),o=J4(this.initialOffer.sdp,this.extension),d=this.logSDPExchange(o||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),d==null||d(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s});const h=this.peerConnection.getTransceivers()[0];if(h!=null&&h.receiver&&this.tryBindTransportEvents(h.receiver),iR(this.store))if(i.preallocation&&re("ENABLE_PRE_SUB_WITH_PRE_PC")){const f=re("PRE_SUB_NUM"),{mids:g,preSSRCs:y}=this.remoteSDP.preloadRemoteMedia(f);await Yc(this.peerConnection,this.remoteSDP,this.extension),M.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] preload media, in pre pc,add preload ssrcs ").concat(y)),this.presetMedia(g,y)}else{const{preSSRCs:f=[]}=i,g=f.map(x=>x.ssrcMsg[0].ssrcId);if(f.length===0)return;const{mids:y}=this.remoteSDP.batchSend(f.map(x=>Object.assign({},x)));await Yc(this.peerConnection,this.remoteSDP,this.extension),M.debug("[NVConnectionExtension.connect] preload media, after join, add preload ssrcs ".concat(g)),this.presetMedia(y,g)}}catch(s){throw new Pe(se.EXCHANGE_SDP_FAILED,"NVConnectionExtension.connect failed; ".concat(s.toString()))}}presetMedia(i,s){i.forEach((o,d)=>{this.peerConnection.getTransceivers().forEach(h=>{if(h.mid!=null&&o===h.mid&&h.receiver.track){const f=h.receiver.track;let g;f.kind==="video"&&re("ENABLE_PRE_RENDER")&&(g=new Qk({trackId:"track-".concat(f.kind,"-unknown-").concat(this.store.clientId,"_").concat(dr(5,""))},!0),g.updateVideoTrack(f),g.onFirstVideoFrameRender=()=>{var y;const x=this.preMediaMap.get(s[d]);x&&(x.firstVideoRender=Date.now()),(y=this.onFirstVideoRender)===null||y===void 0||y.call(this,s[d])},g.onVideoBufferReady=()=>{var y;(y=this.onFirstVideoBufferReady)===null||y===void 0||y.call(this,s[d])},g.play(this.store.sessionId||void 0)),this.preMediaMap.set(s[d],{mid:o,track:f,player:g,transceiver:h})}}),this.store.peerReceiver()})}checkDtlsParameters(i){return!!this.remoteSDP&&i.length>0&&this.remoteSDP.updateRemoteDtlsParameters(i)}async updateRemoteConnect(i){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateRemoteConnect before remote SDP created");let s=!1;const{rtpCapabilities:o}=i;if([,s]=this.remoteSDP.updateRemoteRTPCapabilities(o),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const f=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);s=s||f}const{preSSRCs:d=[]}=i,h=d.map(f=>f.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(h)){const f=[],g=[];if(Array.from(this.preMediaMap.entries()).every(y=>{let[x,{mid:b,player:N,track:I}]=y;return f.push(b),g.push(x),this.preMediaMap.delete(x),N&&N.destroy(),!0}),f.length>0&&(this.remoteSDP.stopSending(f),await Yc(this.peerConnection,this.remoteSDP,this.extension),M.warn("[NVConnectionExtension.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(g)),_t.reportApiInvoke(this.store.sessionId,{name:Qr.PRELOAD_MEDIA_FAILED,options:[d,g],tag:Tr.TRACER}).onSuccess()),d.length>0){const{mids:y}=this.remoteSDP.batchSend(d.map(x=>Object.assign({},x)));await Yc(this.peerConnection,this.remoteSDP,this.extension),M.debug("[NVConnectionExtension.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(h)),this.presetMedia(y,h)}}s?(await Yc(this.peerConnection,this.remoteSDP,this.extension),M.debug("[NVConnectionExtension] updateRemoteConnect by exchanging SDP.")):M.debug("[NVConnectionExtension] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(s){throw new Pe(se.EXCHANGE_SDP_FAILED,"NVConnectionExtension.updateRemoteConnect failed; ".concat(s.toString()))}}send(i,s,o){var d=this;return fc(function*(){const h=yield hn(d.mutex.lock("From NVConnectionExtension.send"));try{if(!d.remoteSDP)throw new Error("Cannot call NVConnectionExtension.send before remote SDP created");const f=[],g=dR();i.forEach(K=>{const ie=d.peerConnection.addTransceiver(K._mediaStreamTrack,Wh({direction:"sendonly"},K.trackMediaType==="video"&&d.supportAV1RtpSpec&&g?{sendEncodings:[{scalabilityMode:g}]}:{}));f.push(ie),K._updateRtpTransceiver(ie)}),Kr()&&re("SIMULCAST")===!0&&(yield hn(d.applySimulcastForFirefox(f,i)));const y=yield hn(d.peerConnection.createOffer()),x=d.remoteSDP.predictReceivingMids(i.length),b=d.mungSendOfferSDP(y.sdp,i,x),N=Mo(b),I=x.map(K=>{const ie=N.mediaDescriptions.find(oe=>oe.attributes.mid===K);if(!ie)throw new Error("Cannot extract ssrc from mediaDescription.");return K4(ie,re("USE_PUB_RTX"))});let D;try{D=yield I}catch(K){D=[],d.remoteSDP.receive(i,s,o,D);const ie=d.remoteSDP.toString();throw yield hn(d.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield hn(d.peerConnection.setRemoteDescription({type:"answer",sdp:ie})),yield hn(d.stopSending(x,!0)),K}d.remoteSDP.receive(i,s,o,D);const $=d.remoteSDP.toString(),z=d.logSDPExchange(b,"offer","local","send");return yield hn(d.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield hn(d.applySimulcastEncodings(f,i)),yield hn(d.applySendEncodings(f,i)),z==null||z($),yield hn(d.peerConnection.setRemoteDescription({type:"answer",sdp:$})),f.map((K,ie)=>{const oe=x[ie];return{localSSRC:I[ie],id:oe,transceiver:K}})}catch(f){throw f instanceof Pe?f:new Pe(se.EXCHANGE_SDP_FAILED,"NVConnectionExtension.send failed; ".concat(f.toString()))}finally{h()}})()}async createDataChannels(i,s){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(i);if(o&&o.readyState==="open")M.debug("[NVConnectionExtension] Channels are already available and can be reused directly.");else{const h=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof h!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:h,negotiated:!0,ordered:!1,maxRetransmits:re("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(i,o)}s.forEach(h=>{h._updateOriginDataChannel(o)});const{needExchangeSDP:d}=this.remoteSDP.sendDataChannel();if(d){const h=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const f=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(f),M.debug("[NVConnectionExtension] createDataChannels by exchanging SDP.")}else M.debug("[NVConnectionExtension] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof Pe?o:new Pe(se.EXCHANGE_SDP_FAILED,"NVConnectionExtension.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(i){try{const s=this.dataStreamChannelMap.get(i);return s&&(s.id&&this.recoveredDataChannelIds.push(s.id),s.close()),void this.dataStreamChannelMap.delete(i)}catch(s){throw s instanceof Pe?s:new Pe(se.DATACHANNEL_FAILED,"NVConnectionExtension.stopDataChannels failed; ".concat(s.toString()))}}async stopSending(i,s){const o=s?void 0:await this.mutex.lock("From NVConnectionExtension.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopSending before remote SDP created");const d=this.peerConnection.getTransceivers().filter(y=>i.indexOf(y.mid)!==-1);if(d.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVConnectionExtension.stopSending.");d.map(y=>{var x;Bx(this.id+y.mid,this),y.direction="inactive",(x=y.stop)===null||x===void 0||x.call(y)});const h=await this.peerConnection.createOffer(),f=this.logSDPExchange(h.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(h),this.remoteSDP.stopReceiving(i);const g=this.remoteSDP.toString();f==null||f(g),await this.peerConnection.setRemoteDescription({type:"answer",sdp:g})}catch(d){throw new Pe(se.EXCHANGE_SDP_FAILED,"NVConnectionExtension.stopSending failed; ".concat(d.toString()))}finally{o&&o()}}async receive(i,s,o,d){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.receive ".concat(i," before remoteSDP created."));const{mid:h,needExchangeSDP:f}=this.remoteSDP.send(i,s,o,d);f&&(await Yc(this.peerConnection,this.remoteSDP,this.extension),M.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] receive ").concat(i," by exchanging SDP.")));const g=this.peerConnection.getTransceivers().find(y=>y.mid===h);if(!g)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:g.receiver.track,id:h,transceiver:g}}catch(h){throw new Pe(se.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(h.toString()))}}async batchReceive(i){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:o}=this.remoteSDP.batchSend(i);return o&&(await Yc(this.peerConnection,this.remoteSDP,this.extension),M.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] batchReceive by exchanging SDP."))),s.map(d=>{const h=this.peerConnection.getTransceivers().find(f=>f.mid===d);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:d,transceiver:h}})}catch(s){throw new Pe(se.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(s.toString()))}}async stopReceiving(i){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopReceiving before remote SDP created.");i.forEach(h=>{Array.from(this.preMediaMap.entries()).some(f=>{let[g,{mid:y,player:x}]=f;if(y===h)return this.preMediaMap.delete(g),x&&x.destroy(),!0})}),this.remoteSDP.stopSending(i);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=await this.peerConnection.createAnswer();o==null||o(d.sdp||""),await this.peerConnection.setLocalDescription(d)}catch(s){throw new Pe(se.EXCHANGE_SDP_FAILED,"NVConnectionExtension stopReceiving failed; ".concat(s.toString()))}}async muteRemote(i){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteRemote mid=".concat(i," before remote SDP created."));this.remoteSDP.mute(i);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=await this.peerConnection.createAnswer();o==null||o(d.sdp||""),await this.peerConnection.setLocalDescription(d)}catch(s){throw new Pe(se.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(i){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteRemote mid=".concat(i," before remote SDP created."));this.remoteSDP.unmute(i);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=await this.peerConnection.createAnswer();o==null||o(d.sdp||""),await this.peerConnection.setLocalDescription(d)}catch(s){throw new Pe(se.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(f=>f.mid&&i.indexOf(f.mid)!==-1);if(s.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(f=>{f.direction="inactive"});const o=await this.peerConnection.createOffer(),d=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(i);const h=this.remoteSDP.toString();d==null||d(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new Pe(se.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(f=>f.mid&&i.indexOf(f.mid)!==-1);if(s.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async(f,g)=>{f.direction="sendonly"});const o=await this.peerConnection.createOffer(),d=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(i,this.remoteCodecs,this.store.codec);const h=this.remoteSDP.toString();d==null||d(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new Pe(se.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteLocal failed; ".concat(s.toString()))}}restartICE(i){var s=this;return fc(function*(){const o=yield hn(s.mutex.lock("From NVConnectionExtension.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const d=xn().supportPCSetConfiguration,h=re("FORCE_TURN_TCP")||s.forceTurn;if(i===Ys.RELAY&&!d)return;if(d&&!h){const N=i===Ys.RELAY?"relay":"all",I=s.peerConnection.getConfiguration();I.iceTransportPolicy!==N&&(M.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(I.iceTransportPolicy,"] to [").concat(N,"]")),I.iceTransportPolicy=N,s.peerConnection.setConfiguration(I))}s.remoteSDP.updateCandidates(i);const f=yield hn(s.peerConnection.createOffer({iceRestart:!0}));if(!f.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const g=rf(f.sdp),{remoteIceParameters:y}=yield g.iceParameters;s.remoteSDP.restartICE(y);const x=s.remoteSDP.toString(),b=s.logSDPExchange(f.sdp||"","offer","local","restartICE");s.store.descriptionStart(),yield hn(s.peerConnection.setLocalDescription(f)),b==null||b(x),yield hn(s.peerConnection.setRemoteDescription({type:"answer",sdp:x}))}catch(d){M.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),d)}finally{o()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const i=await this.mutex.lock("From NVConnectionExtension.extendCandidate");try{this.remoteSDP.updateCandidates(Ys.TCP_RELAY),await Yc(this.peerConnection,this.remoteSDP,this.extension)}catch(s){M.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),s)}finally{i()}}close(){var i;this.peerConnection.getTransceivers().forEach(s=>{Bx(this.id+s.mid,this)}),this.preMediaMap.forEach(s=>{let{player:o}=s;o&&o.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Wh(Wh({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}async updateEncoderConfig(i,s){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),d=this.mungSendOfferSDP(o.sdp,[s],[i]);this.remoteSDP.updateRecvMedia(i,s);const h=this.remoteSDP.toString(),f=this.logSDPExchange(d,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:d}),f==null||f(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(o){throw new Pe(se.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(i,s){const o=this.peerConnection.getTransceivers().filter(d=>d.mid===i);o.length===1&&(this.isVP8Simulcast(s)?Kr()||await this.applySimulcastEncodings(o,[s]):await this.applySendEncodings(o,[s]))}setStatsRemoteVideoIsReady(i,s){this.statsFilter.setVideoIsReady2(i,s)}async replaceTrack(i,s){const o=this.peerConnection.getTransceivers().find(d=>d.mid===s);o&&await o.sender.replaceTrack(i._mediaStreamTrack)}async getSelectedCandidatePair(){const i=this.peerConnection.getReceivers();if(i.length>0&&i[0].transport&&i[0].transport.iceTransport&&i[0].transport.iceTransport.getSelectedCandidatePair&&i[0].transport.iceTransport.getSelectedCandidatePair()){const s=i[0].transport.iceTransport,{local:o,remote:d}=s.getSelectedCandidatePair();return{local:Wh(Wh({},Ou),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:Wh(Wh({},Ou),{},{candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=i=>{if(i&&(i.errorCode||i.errorText)){var s;const o="code: ".concat(i.errorCode,", message: ").concat(i.errorText),d=i.port?"local: ".concat(i.port):"",h=nf(i.url||"");M.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: NVConnectionExtension.onICECandidateError(").concat(o,"), url: ").concat(h||"",", host_candidate:").concat(d)),(s=this.onICECandidateError)===null||s===void 0||s.call(this,o)}},this.peerConnection.onicegatheringstatechange=i=>{i&&i.target&&"iceGatheringState"in i.target&&M.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(i.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,M.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,M.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},re("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const s={iceServers:[]},o=i.cloudProxyServer||"disabled";return i.iceServers?s.iceServers=i.iceServers:i.turnServer&&(ly(i.turnServer.servers)?s.iceServers=i.turnServer.servers:re("NEW_TURN_MODE")&&s.iceServers&&o==="disabled"?(re("USE_TURN_SERVER_OF_GATEWAY")?i.turnServer.serversFromGateway&&s.iceServers.push(...gb.newTurnServerConfigToIceServers(i.turnServer.serversFromGateway)):s.iceServers.push(...gb.newTurnServerConfigToIceServers(i.turnServer.servers)),re("NEW_FORCE_TURN")&&(s.iceTransportPolicy="relay")):i.turnServer.mode!=="off"&&(s.iceServers&&s.iceServers.push(...gb.turnServerConfigToIceServers(i.turnServer.servers)),re("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&i.turnServer.serversFromGateway&&s.iceServers.push(...gb.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),re("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(d=>{d.forceturn&&(s.iceTransportPolicy="relay")}))),re("ENABLE_ENCODED_TRANSFORM")&&xn().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(i){const s=[];return i.forEach(o=>{o.security?o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Vu(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!re("FORCE_TURN_TCP")&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),s}static newTurnServerConfigToIceServers(i){const s=[];return i.forEach(o=>{const d=re("NEW_TURN_MODE");d===1?s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}):d===2?s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}):d===3?s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Vu(o.turnServerURL),":443?transport=tcp")}):d===4&&(s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}),s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}),s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Vu(o.turnServerURL),":443?transport=tcp")}))}),s}tryBindTransportEvents(i){const s=i.transport;if(s){this.transportEventReceiver=i,s.onstatechange=()=>{var d;s!=null&&s.state&&((d=this.onDTLSTransportStateChange)===null||d===void 0||d.call(this,s.state))},s.onerror=d=>{var h;(h=this.onDTLSTransportError)===null||h===void 0||h.call(this,"error"in d?d.error:d)};const o=s.iceTransport;o&&(o.onstatechange=()=>{const d=s==null?void 0:s.iceTransport.state;var h;d&&((h=this.onICETransportStateChange)===null||h===void 0||h.call(this,d))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){const{local:d,remote:h}=o.getSelectedCandidatePair()||{};if(d&&h){const f=d.address+":"+d.port,g=h.address+":"+h.port;M.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(nf(f)),", remote ").concat(JSON.stringify(nf(g))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(i,s){var o,d;if(s||(s=this.peerConnection.getSenders().find(K=>K.track===i._mediaStreamTrack)),!s)return M.warn("[".concat(i.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(i))return M.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!xn().supportSetRtpSenderParameters)return M.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const h={},f={};switch(i._optimizationMode){case"motion":h.degradationPreference="maintain-framerate";break;case"detail":h.degradationPreference="maintain-resolution";break;case"balanced":h.degradationPreference="balanced"}const g=sJ(this.peerConnection,i._mediaStreamTrack),y=YY(i);if(KJ(i)&&g&&s&&y&&this.getLocalVideoStats&&Ge(o=["vp8","vp9"]).call(o,this.store.codec)){var x;const z=h.degradationPreference||(Ge(x=i._hints).call(x,or.CUSTOM_TRACK)?re("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");qJ(this.id+g.mid,y,this,z,K=>{s&&this.updateAdaptation(s,K)},this.getLocalVideoStats.bind(this))}if(i._encoderConfig){var b;const{bitrateMax:z,frameRate:K,scaleResolutionDownBy:ie}=i._encoderConfig;z&&(f.maxBitrate=1e3*z),(Ge(b=i._hints).call(b,or.LOW_STREAM)||i.isUseScaleResolutionDownBy)&&(K&&(f.maxFramerate=vc(K)),ie&&ie>=1&&(f.scaleResolutionDownBy=ie))}const{maxFramerate:N}=re("ENCODER_CONFIG_LIMIT");if(N&&typeof N=="number"&&(f.maxFramerate=f.maxFramerate?Math.min(f.maxFramerate,N):N),re("DSCP_TYPE")&&Jp()){var I;const z=re("DSCP_TYPE");Ge(I=["very-low","low","medium","high"]).call(I,z)&&(f.networkPriority=z)}const D=s.getParameters(),$=(d=D.encodings)===null||d===void 0?void 0:d[0];Kr()&&!$&&(h.encodings=[f]),$&&Object.assign($,f),Object.assign(D,h),M.debug("[".concat(i.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(D.encodings))),await s.setParameters(D),await yJ(this.store.codec,s,re("SVC_MODE"))}async updateAdaptation(i,s){var o,d;if(!i)return M.debug("[updateAdaptation] no rtpSender found");if(!xn().supportSetRtpSenderParameters)return M.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const h={},{bitrateMax:f,frameRate:g,scaleResolutionDownBy:y}=s;f&&(h.maxBitrate=1e3*f),g&&(h.maxFramerate=vc(g)),y&&y>=1&&Ge(o=["vp8","vp9"]).call(o,this.store.codec)&&(h.scaleResolutionDownBy=y);const x=i.getParameters(),b=(d=x.encodings)===null||d===void 0?void 0:d[0];b&&Object.assign(b,h),Object.assign(x,{});try{await i.setParameters(x),M.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(x.encodings)))}catch(N){!("transport"in i)||i.transport&&i.transport.state==="connected"?this.peerConnectionState!=="connected"?M.debug("[updateAdaptation] peerConnection not connected}"):M.debug("[updateAdaptation] updateRtpSenderEncodings failed",N):M.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(i,s){try{if(!xn().supportSetRtpSenderParameters||i.length!==s.length)return;for(let o=0;o<i.length;o++){const d=i[o],h=s[o];h instanceof Rr&&!this.isVP8Simulcast(h)&&await this.updateRtpSenderEncodings(h,d.sender)}}catch{M.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(i,s,o){const d=Mo(i);return s.forEach((h,f)=>{const g=o[f],y=d.mediaDescriptions.find(x=>x.attributes.mid===g);y&&(Cy(y,h),$4(y,h,this.store.codec))}),um(d)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,s,o)=>{var d;(d=this.onFirstVideoDecoded)===null||d===void 0||d.call(this,i,s,o)},this.statsFilter.onSelectedLocalCandidateChanged=(i,s)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,i,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,s)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,i,s)},this.statsFilter.onFirstVideoDecodedTimeout=i=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(i,s){if(i.length===s.length)for(let y=0;y<i.length;y++){var o,d,h,f,g;const x=i[y],b=s[y];if(b instanceof Rr&&!Ge(o=b._hints).call(o,or.LOW_STREAM)&&(d=b._encoderConfig)!==null&&d!==void 0&&d.bitrateMax&&((h=b._encoderConfig)===null||h===void 0?void 0:h.bitrateMax)>200&&(f=b._scalabilityMode)!==null&&f!==void 0&&f.numSpatialLayers&&((g=b._scalabilityMode)===null||g===void 0?void 0:g.numSpatialLayers)>1&&this.store.codec==="vp8"){const N={},I={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};N.encodings=[{rid:"m",active:!0,maxBitrate:I.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:I.high}];const D=x.sender.getParameters();await x.sender.setParameters(Object.assign(D,N))}}}async applySimulcastEncodings(i,s){if(!Kr()&&i.length===s.length)for(let o=0;o<i.length;o++){const d=s[o];if(d instanceof Rr&&this.isVP8Simulcast(d)){const h=i[o],f={},g={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:g.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:g.medium,scaleResolutionDownBy:4}];const y=h.sender.getParameters();await h.sender.setParameters(Object.assign(y,f))}}}isVP8Simulcast(i){var s,o,d,h,f;return!!(i instanceof Rr&&re("SIMULCAST")&&this.store.codec==="vp8"&&!Ge(s=i._hints).call(s,or.LOW_STREAM)&&(o=i._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((d=i._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=i._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((f=i._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1)}logSDPExchange(i,s,o,d){if(re("SDP_LOGGING"))return M.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(s," SDP during NVConnectionExtension.").concat(d,`
`),i),s==="offer"?h=>{this.logSDPExchange(h,"answer",o==="local"?"remote":"local",d)}:void 0}async getRemoteSSRC(i){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(i);return s&&s.length!==0?s[0].ssrcId:void 0}setConfiguration(i){if(xn().supportPCSetConfiguration){const s=gb.resolvePCConfiguration(i);this.peerConnection.setConfiguration(s)}i.isPreallocation&&(this.isPreallocation=!0)}},it(Un.prototype,"updateRemoteRTPCapabilities",[bc],Object.getOwnPropertyDescriptor(Un.prototype,"updateRemoteRTPCapabilities"),Un.prototype),it(Un.prototype,"connect",[bc],Object.getOwnPropertyDescriptor(Un.prototype,"connect"),Un.prototype),it(Un.prototype,"updateRemoteConnect",[bc],Object.getOwnPropertyDescriptor(Un.prototype,"updateRemoteConnect"),Un.prototype),it(Un.prototype,"createDataChannels",[bc],Object.getOwnPropertyDescriptor(Un.prototype,"createDataChannels"),Un.prototype),it(Un.prototype,"receive",[bc],Object.getOwnPropertyDescriptor(Un.prototype,"receive"),Un.prototype),it(Un.prototype,"batchReceive",[bc],Object.getOwnPropertyDescriptor(Un.prototype,"batchReceive"),Un.prototype),it(Un.prototype,"stopReceiving",[bc],Object.getOwnPropertyDescriptor(Un.prototype,"stopReceiving"),Un.prototype),it(Un.prototype,"muteRemote",[bc],Object.getOwnPropertyDescriptor(Un.prototype,"muteRemote"),Un.prototype),it(Un.prototype,"unmuteRemote",[bc],Object.getOwnPropertyDescriptor(Un.prototype,"unmuteRemote"),Un.prototype),it(Un.prototype,"muteLocal",[bc],Object.getOwnPropertyDescriptor(Un.prototype,"muteLocal"),Un.prototype),it(Un.prototype,"unmuteLocal",[bc],Object.getOwnPropertyDescriptor(Un.prototype,"unmuteLocal"),Un.prototype),it(Un.prototype,"close",[bc],Object.getOwnPropertyDescriptor(Un.prototype,"close"),Un.prototype),it(Un.prototype,"updateEncoderConfig",[bc],Object.getOwnPropertyDescriptor(Un.prototype,"updateEncoderConfig"),Un.prototype),it(Un.prototype,"updateSendParameters",[bc],Object.getOwnPropertyDescriptor(Un.prototype,"updateSendParameters"),Un.prototype),it(Un.prototype,"replaceTrack",[bc],Object.getOwnPropertyDescriptor(Un.prototype,"replaceTrack"),Un.prototype),it(Un.prototype,"updateAdaptation",[bc],Object.getOwnPropertyDescriptor(Un.prototype,"updateAdaptation"),Un.prototype),it(Un.prototype,"getRemoteSSRC",[bc],Object.getOwnPropertyDescriptor(Un.prototype,"getRemoteSSRC"),Un.prototype),Un);function bc(n,i,s){const o=n[i];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const d=this.mutex,h=await d.lock("From NVConnectionExtension.".concat(i));try{for(var f=arguments.length,g=new Array(f),y=0;y<f;y++)g[y]=arguments[y];return await o.apply(this,g)}finally{h()}},s}var gr;function Gee(n){var i,s,o,d=2;for(typeof Symbol<"u"&&(s=Tk,o=Symbol.iterator);d--;){if(s&&(i=n[s])!=null)return i.call(n);if(o&&(i=n[o])!=null)return new i2(i.call(n));s="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function i2(n){function i(s){if(Object(s)!==s)return et.reject(new TypeError(s+" is not an object."));var o=s.done;return et.resolve(s.value).then(function(d){return{value:d,done:o}})}return i2=function(s){this.s=s,this.n=s.next},i2.prototype={s:null,n:null,next:function(){return i(this.n.apply(this.s,arguments))},return:function(s){var o=this.s.return;return o===void 0?et.resolve({value:s,done:!0}):i(o.apply(this.s,arguments))},throw:function(s){var o=this.s.return;return o===void 0?et.reject(s):i(o.apply(this.s,arguments))}},new i2(n)}let CTe=(gr=class bD extends fP{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(i,s){super(i,s),Y(this,"name","DataChannelConnection"),Y(this,"store",void 0),Y(this,"peerConnection",void 0),Y(this,"cname",void 0),Y(this,"mutex",new qs("DataChannelConnection-mutex")),Y(this,"dataChannel",void 0),Y(this,"_p2pConnection",void 0),Y(this,"establishPromise",void 0),Y(this,"_nvMedia",void 0),this.store=s,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(bD.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new RTe(i,s,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}getPreMedia(i){var s;return(s=this._p2pConnection)===null||s===void 0?void 0:s.getPreMedia(i)}isPreSub(){var i,s;return(i=(s=this._p2pConnection)===null||s===void 0?void 0:s.isPreSub())!==null&&i!==void 0&&i}async establish(){return await this._p2pConnection.establish()}getP2PConnectionParams(){return this._p2pConnection.establishPromise}updateRtpSenderEncodings(i){return this._p2pConnection.updateRtpSenderEncodings(i)}async connect(i){return this.cname=i.cname,await this._p2pConnection.connect(i),await new et((s,o)=>{const d=setTimeout(()=>{this.closeSignal(),o(new Ce(se.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(i.candidates))))},re("DC_CONNECTION_TIMEOUT"));this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(d),void s()},this.dataChannel.onerror=h=>{this.closeSignal(),o(h)},this.dataChannel.addEventListener("close",()=>{o(new Ce(se.DATACHANNEL_CONNECTION_TIMEOUT))})}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(i,s){return this._p2pConnection.updateRemoteRTPCapabilities(i,s)}send(i,s,o){var d=this;return fc(function*(){const h=yield hn(d.mutex.lock("From DataChannelConnection.send"));try{return yield*hx(Gee(d._p2pConnection.send(i,s,o)))}finally{h()}})()}async stopSending(i,s){return this._p2pConnection.stopSending(i,s)}async createDataChannels(i,s){return this._p2pConnection.createDataChannels(i,s)}async stopDataChannels(i){return this._p2pConnection.stopDataChannels(i)}async receive(i,s,o,d){return this._nvMedia?(M.debug("[DataChannelConnection] receive ".concat(i," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(i,s,this.cname)):(M.debug("[DataChannelConnection] receive ".concat(i," by WebRTC.")),await this._p2pConnection.receive(i,s,o,d))}async batchReceive(i){return[...await this._p2pConnection.batchReceive(i)]}async stopReceiving(i){return await this._p2pConnection.stopReceiving(i)}async muteRemote(i){return await this._p2pConnection.muteRemote(i)}async unmuteRemote(i){return await this._p2pConnection.unmuteRemote(i)}async muteLocal(i){return await this._p2pConnection.muteLocal(i)}async unmuteLocal(i){return await this._p2pConnection.unmuteLocal(i)}restartICE(i){var s=this;return fc(function*(){return yield*hx(Gee(s._p2pConnection.restartICE(i)))})()}close(){var i;(i=this._nvMedia)===null||i===void 0||i.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(i){return this._p2pConnection.getRemoteVideoIsReady(i)}updateRemoteConnect(i){var s;return(s=this._nvMedia)===null||s===void 0||s.setRemoteRtpCapabilities(i),this._p2pConnection.updateRemoteConnect(i)}async updateEncoderConfig(i,s){return await this._p2pConnection.updateEncoderConfig(i,s)}async updateSendParameters(i,s){return await this._p2pConnection.updateSendParameters(i,s)}setStatsRemoteVideoIsReady(i,s){this._p2pConnection.setStatsRemoteVideoIsReady(i,s)}async replaceTrack(i,s){return await this._p2pConnection.replaceTrack(i,s)}async getRemoteSSRC(i){return this._p2pConnection.getRemoteSSRC(i)}logSDPExchange(i,s,o,d){if(re("SDP_LOGGING"))return M.upload("exchanging ".concat(o," ").concat(s," SDP during DataChannelConnection.").concat(d,`
`),i),s==="offer"?h=>{this.logSDPExchange(h,"answer",o==="local"?"remote":"local",d)}:void 0}static resolvePCConfiguration(i){const s={iceServers:[]};return i.iceServers?s.iceServers=i.iceServers:i.turnServer&&i.turnServer.mode!=="off"&&(ly(i.turnServer.servers)?s.iceServers=i.turnServer.servers:(s.iceServers&&s.iceServers.push(...bD.turnServerConfigToIceServers(i.turnServer.servers)),re("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&i.turnServer.serversFromGateway&&s.iceServers.push(...bD.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),re("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(s.iceTransportPolicy="relay")}))),re("ENABLE_ENCODED_TRANSFORM")&&xn().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(i){const s=[];return i.forEach(o=>{o.security?o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Vu(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!re("FORCE_TURN_TCP")&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),s}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=i=>{var s;return(s=this.onICEConnectionStateChange)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onConnectionStateChange=i=>{var s;return(s=this.onConnectionStateChange)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onDTLSTransportStateChange=i=>{var s;return(s=this.onDTLSTransportStateChange)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onDTLSTransportError=i=>{var s;return(s=this.onDTLSTransportError)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onICETransportStateChange=i=>{var s;return(s=this.onICETransportStateChange)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onFirstAudioReceived=i=>{var s;return(s=this.onFirstAudioReceived)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onFirstVideoReceived=i=>{var s;return(s=this.onFirstVideoReceived)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onFirstAudioDecoded=i=>{var s;return(s=this.onFirstAudioDecoded)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onFirstVideoRender=i=>{var s;return(s=this.onFirstVideoRender)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onFirstVideoBufferReady=i=>{var s;return(s=this.onFirstVideoBufferReady)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onFirstVideoDecoded=(i,s,o)=>{var d;return(d=this.onFirstVideoDecoded)===null||d===void 0?void 0:d.call(this,i,s,o)},this._p2pConnection.onFirstVideoDecodedTimeout=i=>{var s;return(s=this.onFirstVideoDecodedTimeout)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onSelectedLocalCandidateChanged=(i,s)=>{var o;return(o=this.onSelectedLocalCandidateChanged)===null||o===void 0?void 0:o.call(this,i,s)},this._p2pConnection.onSelectedRemoteCandidateChanged=(i,s)=>{var o;return(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0?void 0:o.call(this,i,s)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(i){i.onConnectionStateChange=void 0,i.onICEConnectionStateChange=void 0,i.onICETransportStateChange=void 0,i.onDTLSTransportStateChange=void 0,i.onDTLSTransportError=void 0,i.onFirstAudioDecoded=void 0,i.onFirstAudioReceived=void 0,i.onFirstVideoDecoded=void 0,i.onFirstVideoReceived=void 0,i.onSelectedLocalCandidateChanged=void 0,i.onSelectedRemoteCandidateChanged=void 0,i.onFirstVideoDecodedTimeout=void 0}setConfiguration(i){this._p2pConnection.setConfiguration(i)}},it(gr.prototype,"connect",[nd],Object.getOwnPropertyDescriptor(gr.prototype,"connect"),gr.prototype),it(gr.prototype,"updateRemoteRTPCapabilities",[nd],Object.getOwnPropertyDescriptor(gr.prototype,"updateRemoteRTPCapabilities"),gr.prototype),it(gr.prototype,"createDataChannels",[nd],Object.getOwnPropertyDescriptor(gr.prototype,"createDataChannels"),gr.prototype),it(gr.prototype,"receive",[nd],Object.getOwnPropertyDescriptor(gr.prototype,"receive"),gr.prototype),it(gr.prototype,"stopReceiving",[nd],Object.getOwnPropertyDescriptor(gr.prototype,"stopReceiving"),gr.prototype),it(gr.prototype,"muteRemote",[nd],Object.getOwnPropertyDescriptor(gr.prototype,"muteRemote"),gr.prototype),it(gr.prototype,"unmuteRemote",[nd],Object.getOwnPropertyDescriptor(gr.prototype,"unmuteRemote"),gr.prototype),it(gr.prototype,"muteLocal",[nd],Object.getOwnPropertyDescriptor(gr.prototype,"muteLocal"),gr.prototype),it(gr.prototype,"unmuteLocal",[nd],Object.getOwnPropertyDescriptor(gr.prototype,"unmuteLocal"),gr.prototype),it(gr.prototype,"close",[nd],Object.getOwnPropertyDescriptor(gr.prototype,"close"),gr.prototype),it(gr.prototype,"updateEncoderConfig",[nd],Object.getOwnPropertyDescriptor(gr.prototype,"updateEncoderConfig"),gr.prototype),it(gr.prototype,"updateSendParameters",[nd],Object.getOwnPropertyDescriptor(gr.prototype,"updateSendParameters"),gr.prototype),it(gr.prototype,"replaceTrack",[nd],Object.getOwnPropertyDescriptor(gr.prototype,"replaceTrack"),gr.prototype),it(gr.prototype,"getRemoteSSRC",[nd],Object.getOwnPropertyDescriptor(gr.prototype,"getRemoteSSRC"),gr.prototype),gr);function nd(n,i,s){const o=n[i];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const d=this.mutex,h=await d.lock("From DataChannelConnection.".concat(i));try{for(var f=arguments.length,g=new Array(f),y=0;y<f;y++)g[y]=arguments[y];return await o.apply(this,g)}finally{h()}},s}function Wee(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),s.push.apply(s,o)}return s}class NTe extends ai{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(i){var s;Ge(s=["tryNext","recover"]).call(s,i)&&this.resetReconnectCount(i),this._reconnectMode=i}get state(){return this._state}set state(i){i!==this._state&&(this._state=i,this._state==="reconnecting"?this.emit(ys.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(ys.CONNECTED):this._state==="closed"?this.emit(ys.CLOSED):this._state==="failed"&&this.emit(ys.FAILED))}constructor(i,s,o,d){super(),Y(this,"connectionID",0),Y(this,"currentURLIndex",0),Y(this,"reconnectReason",void 0),Y(this,"_reconnectMode","tryNext"),Y(this,"_initMutex",void 0),Y(this,"_name",void 0),Y(this,"_state","closed"),Y(this,"_reconnectInterrupter",void 0),Y(this,"_url",void 0),Y(this,"_retryConfig",void 0),Y(this,"_reconnectCount",0),Y(this,"_forceCloseTimeout",5e3),Y(this,"_onlineReconnectListener",void 0),Y(this,"_closeEstablishingTransmitter",()=>{}),Y(this,"_store",void 0),Y(this,"_joinChannelServiceRecordIndex",void 0),Y(this,"_transmitter",void 0),Y(this,"_useCompress",void 0),Y(this,"_inflateLength",0),Y(this,"_deflateLength",0),this._store=d,this._name=i,this._retryConfig=function(h){for(var f=1;f<arguments.length;f++){var g=arguments[f]!=null?arguments[f]:{};f%2?Wee(Object(g),!0).forEach(function(y){Y(h,y,g[y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(g)):Wee(Object(g)).forEach(function(y){Object.defineProperty(h,y,Object.getOwnPropertyDescriptor(g,y))})}return h}({},s),this._useCompress=o}resetReconnectCount(i){M.debug("".concat(this._name," reset reconnect count, reason: ").concat(i)),this._reconnectCount=0}close(i,s){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const o=this._transmitter;s?setTimeout(()=>o.close(),500):o.close(),this._transmitter=void 0}this.state=i?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(i,s){if(!this._transmitter)return void M.warning("[".concat(this._name,"] can not reconnect, no websocket"));var o;i!==void 0&&(this.reconnectMode=i),M.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((o=this._store)===null||o===void 0||o.recordJoinChannelService({status:"error",errors:[new Error(s)]},this._joinChannelServiceRecordIndex));const d=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),d&&d.bind(this._transmitter)({code:9999,reason:s})}getInflateData(){const i=this._inflateLength,s=this._deflateLength;return this.clearInflateData(),{inflateLength:i,deflateLength:s}}setInflateData(i){this._deflateLength=this._deflateLength+i.originLength,this._inflateLength=this._inflateLength+i.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}let Hh=function(n){return n[n.Default=0]="Default",n[n.Ack=1]="Ack",n}({});class ITe{constructor(i,s,o){Y(this,"version",1),Y(this,"initialRTO",void 0),Y(this,"maxBatchAckCount",void 0),Y(this,"maxRTO",void 0),Y(this,"initialRTT",void 0),Y(this,"ID",void 0),Y(this,"rtt",void 0),Y(this,"packetNumber",1),Y(this,"rtoRatioMap",new Map),Y(this,"timeoutMap",new Map),Y(this,"unorderedPacketQueue",[]),Y(this,"batchAckPacketQueue",[]),Y(this,"lastOrderedPacketNumber",0),Y(this,"batchAckTimer",void 0),Y(this,"sendImpl",void 0),Y(this,"receiveImpl",void 0),this.sendImpl=i,this.receiveImpl=s,this.ID=dr(7,"transmitter-"),this.initialRTO=(o==null?void 0:o.initialRTO)!==void 0?o.initialRTO:re("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(o==null?void 0:o.initialRTT)!==void 0?o.initialRTT:re("TRANSMITTER_INITIAL_RTT"),this.rtt=(o==null?void 0:o.initialRTT)!==void 0?o.initialRTT:re("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(o==null?void 0:o.maxBatchAckCount)!==void 0?o.maxBatchAckCount:re("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(o==null?void 0:o.maxRTO)!==void 0?o.maxRTO:re("TRANSMITTER_MAX_RTO")}packetize(i,s){return{type:Hh.Default,version:this.version,packetNumber:s,payload:i}}serialize(i){switch(i.type){case Hh.Default:{let s;typeof i.payload=="string"?s=new TextEncoder().encode(i.payload):s=i.payload;const o=new ArrayBuffer(s.length+15),d=new DataView(o);return d.setUint16(0,i.version),d.setUint8(2,i.type),d.setUint32(3,i.packetNumber),Gq(d,7,BigInt(i.sendTs)),new Uint8Array(d.buffer).set(s,15),o}case Hh.Ack:{const s=new ArrayBuffer(16),o=new DataView(s);return o.setUint16(0,i.version),o.setUint8(2,i.type),o.setUint32(3,i.maxAckPacketNumber),o.setUint8(7,i.shift),Gq(o,8,BigInt(i.ackSendTs)),s}}}deserialize(i){const s=new DataView(i),o=s.getUint16(0),d=s.getUint8(2);switch(d){case Hh.Default:{const h=s.getUint32(3),f=zq(s,7),g=i.slice(15),y=new Uint8Array(g);return{version:o,type:d,packetNumber:h,sendTs:Number(f),payload:y}}case Hh.Ack:{const h=s.getUint32(3),f=s.getUint8(7),g=zq(s,8);return{version:o,type:d,maxAckPacketNumber:h,shift:f,ackSendTs:Number(g)}}default:throw M.error("[".concat(this.ID,"] Unrecognized packet type ").concat(d)),new Error("Unrecognized packet type ".concat(d))}}sendMessage(i){re("DC_DEBUG_LOG")&&typeof i=="string"&&M.debug("[".concat(this.ID,"] sending message packet"),JSON.parse(i));const s=this.packetize(i,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const o=this.calculateRTO(s),d=window.setTimeout(()=>{this.resendMessage(s)},o);this.timeoutMap.set(s.packetNumber,d),this.sendPacket(s)}onData(i){const s=this.deserialize(i);s.type===Hh.Default?this.ack(s):s.type===Hh.Ack&&(this.updateRTT(s,Math.round(performance.now())),this.clearRTO(s))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(i=>{let[s,o]=i;window.clearTimeout(o)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(i){const s=this.calculateRTO(i),o=window.setTimeout(()=>{re("DC_DEBUG_LOG")&&typeof i.payload=="string"&&M.debug("[".concat(this.ID,"] resending message packet"),JSON.parse(i.payload),"timeout: ".concat(s)),this.resendMessage(i)},s);this.timeoutMap.set(i.packetNumber,o),this.sendPacket(i)}calculateRTO(i){const s=this.rtoRatioMap.get(i.packetNumber);if(s===void 0)return this.rtoRatioMap.set(i.packetNumber,1),this.initialRTO;{const o=9*this.rtt/8*s;return this.rtoRatioMap.set(i.packetNumber,s+1),o>this.maxRTO?this.maxRTO:o}}updateRTT(i,s){const o=i.ackSendTs;this.rtt=this.rtt*(7/8)+(s-o-this.rtt)/8}ack(i){if(i.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(i):(this.batchAckPacketQueue.push(i),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(i.payload);;){const s=this.unorderedPacketQueue[0];if(!s){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(s.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(i.packetNumber<=this.lastOrderedPacketNumber){const s={ackSendTs:i.sendTs,maxAckPacketNumber:i.packetNumber,shift:0,type:Hh.Ack,version:this.version};re("DC_DEBUG_LOG")&&M.debug("[".concat(this.ID,"] sending ack packet"),s,"packetNumber: ".concat(i.packetNumber)),this.sendPacket(s)}else if(i.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[i.packetNumber-this.lastOrderedPacketNumber-2]=i;const s={ackSendTs:i.sendTs,maxAckPacketNumber:i.packetNumber,shift:0,type:Hh.Ack,version:this.version};re("DC_DEBUG_LOG")&&M.debug("[".concat(this.ID,"] sending ack packet"),s,"packetNumber: ".concat(i.packetNumber)),this.sendPacket(s)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const i={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:Hh.Ack,version:this.version};re("DC_DEBUG_LOG")&&M.debug("[".concat(this.ID,"] sending batch ack packet"),i,"shift: ".concat(this.batchAckPacketQueue.length-1)),this.sendPacket(i),this.batchAckPacketQueue=[]}sendPacket(i){i.type===Hh.Default&&(i.sendTs=Math.round(performance.now()));const s=this.serialize(i);this.sendImpl(s)}clearRTO(i){for(let s=i.maxAckPacketNumber-i.shift;s<=i.maxAckPacketNumber;s++){const o=this.timeoutMap.get(s);o!==void 0&&window.clearTimeout(o),this.timeoutMap.delete(s),this.rtoRatioMap.delete(s)}}}class Hee extends NTe{constructor(i,s){super(i,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),Y(this,"_initMutex",void 0),Y(this,"_reconnectInterrupter",void 0),Y(this,"_url",void 0),Y(this,"_transmitter",void 0),Y(this,"_addresses",void 0),Y(this,"_reliableTransmission",void 0),Y(this,"_textEncoder",void 0),Y(this,"_textDecoder",void 0),this._textEncoder=new TextEncoder,this._textDecoder=new TextDecoder,this._initMutex=new qs("datachannel");const{timeout:o,timeoutFactor:d}=s,h=Math.max(300,Math.floor(3*o/5)),f=Math.max(1.2,Math.floor(8*d)/10);jo.ONLINE&&(this._retryConfig.timeout=h,this._retryConfig.timeoutFactor=f),wi.on(dy.NETWORK_STATE_CHANGE,(g,y)=>{g!==y&&(this.resetReconnectCount("network state change: ".concat(y," -> ").concat(g)),g===jo.ONLINE?(this._retryConfig.timeout=h,this._retryConfig.timeoutFactor=f):(this._retryConfig.timeout=o,this._retryConfig.timeoutFactor=d))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=s;const o=(d,h)=>{this._addresses=i,this.currentURLIndex=this._addresses.findIndex(g=>g.fingerprint||re("FINGERPRINT"));const f=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(f).then(d).catch(h),this.once(ys.CLOSED,()=>h(new Ce(se.WS_DISCONNECT))),this.once(ys.CONNECTED,()=>d())};return this._initMutex.lock().then(d=>new et((h,f)=>{o(h,f)}).then(()=>{d()}).catch(()=>{d()}))}async sendMessage(i){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new Ce(se.WS_ABORT,"datachannel is not ready");try{s||(i=JSON.stringify(i));const o=this._textEncoder.encode(i),d=BSe(o,{raw:!0});this._reliableTransmission.sendMessage(d)}catch(o){throw new Ce(se.WS_ERR,"send datachannel signal message error"+o.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(i){const s=JSON.stringify(i);return{compressed:s,compressedLength:s.length,origin:i}}sendMessageWithUint8Array(i){return{compressed:i,compressedLength:i.byteLength,origin:i}}createTransmitterConnection(i){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(i.ip,":").concat(i.port),new et((s,o)=>{var d;const h=()=>{M.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="recover",this.state="connected",this.resetReconnectCount("opened"),s()},f=async b=>{var N;if((N=this._closeEstablishingTransmitter)===null||N===void 0||N.call(this),M.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(b.code,", reason: ").concat(b.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=b.reason,this.state="reconnecting");const I=El(this,ys.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,D=await this.reconnectWithAction(I);if(this.state==="closed")return void M.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!D)return o(new Ce(se.WS_DISCONNECT,"datachannel reconnect failed: ".concat(b.code))),void this.close(!0);s()}else o(new Ce(se.WS_DISCONNECT,"datachannel close: ".concat(b.code))),this.close()},g=async b=>{try{var N;(N=this._reliableTransmission)===null||N===void 0||N.onData(b.data)}catch(I){console.log(I)}};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),M.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(i)));const y=(d=this._store)===null||d===void 0?void 0:d.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),x=Date.now();rs(this,ys.TO_CONNECT_DATACHANNEL).then(b=>{var N,I;if(!b)throw new Error("transmissonInfo not exist yet");const{transmitter:D,close:$}=b;this._transmitter=D,(N=this._store)===null||N===void 0||N.signalChannelOpen();const z=Date.now()-x;M.debug("[choose dc] dc open cost ".concat(z,"ms")),this._reliableTransmission=new ITe(K=>{var ie;this._transmitter&&this._transmitter.readyState==="open"&&((ie=this._transmitter)===null||ie===void 0||ie.send(K))},K=>{if(typeof K=="string")this.emit(ys.ON_MESSAGE,K);else{const ie=GSe(K,{raw:!0}).buffer,oe=this._textDecoder.decode(ie);this.emit(ys.ON_MESSAGE,oe)}}),this._closeEstablishingTransmitter=()=>{var K;(K=this._reliableTransmission)===null||K===void 0||K.close(),this._reliableTransmission=void 0,$()},h&&h(),D.onclose=f,D.onmessage=g,(I=this._store)===null||I===void 0||I.recordJoinChannelService({endTs:Date.now(),status:"success"},y),this._joinChannelServiceRecordIndex=y}).catch(b=>{var N;if((N=this._store)===null||N===void 0||N.recordJoinChannelService({endTs:Date.now(),status:b instanceof Ce&&b.code===se.WS_ABORT?"aborted":"error",errors:[b]},y),this.state!=="closed"){if(b instanceof Ce&&b.code===se.WS_ERR){const I=new Ce(se.WS_ERR,"init datachannel failed! Error: ".concat(b.toString()));return M.error("[".concat(this._name,"]").concat(I)),void o(I)}f&&f(b)}else o(new Ce(se.WS_DISCONNECT,"datachannel is closed: ".concat(b.toString())))})})}async reconnectWithAction(i){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||wi.networkState!==jo.OFFLINE||(this._onlineReconnectListener=wi.onlineWaiter&&wi.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let o=!0;if(this._reconnectInterrupter=()=>{o=!1},s){const g=Uk(this._reconnectCount,this._retryConfig);M.debug("[".concat(this._name,"] wait ").concat(g,"ms to reconnect datachannel, mode: ").concat(i)),await et.race([As(g),this._onlineReconnectListener||new et(()=>{})])}if(this.state==="closed"||!o)return!1;this._reconnectCount+=1;const d=async(g,y)=>{this.emit(ys.RECONNECT_CREATE_CONNECTION,y),await this.createTransmitterConnection(g)};try{if(i==="retry"){const g=this._addresses[this.currentURLIndex];await d(g,i)}else if(i==="tryNext"){this.currentURLIndex+=1;for(let y=this.currentURLIndex;y<this._addresses.length;y++){if(this._addresses[y].fingerprint||re("FINGERPRINT")){this.currentURLIndex=y;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return M.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);M.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const g=this._addresses[this.currentURLIndex];await d(g,i)}else i==="recover"&&(M.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(ys.FAILBACK));return!0}catch(g){var h,f;return M.error("[".concat(this._name,"] reconnect failed"),g.toString()),g!=null&&(h=g.data)!==null&&h!==void 0&&h.desc&&Array.isArray(g.data.desc)&&g.data.desc.length&&Ge(f=g.data.desc).call(f,"dynamic key expired")?(this.emit(ys.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(i,s)}}}class ATe extends ai{get connectionState(){return this._connectionState}set connectionState(i){i!==this._connectionState&&(this._connectionState=i,i===Cn.CONNECTED?this.emit(xt.WS_CONNECTED):i===Cn.RECONNECTING?this.emit(xt.WS_RECONNECTING,this._websocketReconnectReason):i===Cn.CLOSED&&this.emit(xt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}processPendingNotifications(){this.pendingNotifications.length!==0&&(M.debug("[".concat(this.clientId,"] processing ").concat(this.pendingNotifications.length," pending notifications")),this.pendingNotifications.forEach(i=>{let{type:s,message:o}=i;this.emit(s,o),s===Yt.ON_NOTIFICATION&&this.handleNotification(o),s===Yt.ON_USER_BANNED&&this.handleUserBanned(o)}),this.pendingNotifications=[])}handleUserBanned(i){switch(i.error_code){case 14:this.close(Rn.UID_BANNED);break;case 15:this.close(Rn.IP_BANNED);break;case 16:this.close(Rn.CHANNEL_BANNED)}}constructor(i,s){super(),Y(this,"__name__","DataChannelSignal"),Y(this,"_disconnectedReason",void 0),Y(this,"_websocketReconnectReason",void 0),Y(this,"_connectionState",Cn.CLOSED),Y(this,"reconnectToken",void 0),Y(this,"websocket",void 0),Y(this,"openConnectionTime",void 0),Y(this,"clientId",void 0),Y(this,"lastMsgTime",Date.now()),Y(this,"uploadCache",[]),Y(this,"uploadCacheInterval",void 0),Y(this,"rttRolling",new YV(5)),Y(this,"pingpongTimer",void 0),Y(this,"inflateDataTimer",void 0),Y(this,"pingpongTimeoutCount",0),Y(this,"ortc",void 0),Y(this,"joinResponse",void 0),Y(this,"multiIpOption",void 0),Y(this,"initError",void 0),Y(this,"spec",void 0),Y(this,"store",void 0),Y(this,"isJoining",!1),Y(this,"pendingNotifications",[]),Y(this,"onWebsocketMessage",o=>{if(o instanceof ArrayBuffer)return void this.emit(xt.ON_BINARY_DATA,o);const d=JSON.parse(o);if(re("DC_DEBUG_LOG")&&M.debug("[datachannel-signal] received packet",d),this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(d,"_id")){const h="res-@".concat(d._id);this.emit(h,d._result,d._message)}else Object.prototype.hasOwnProperty.call(d,"_type")&&(this.isJoining?d._type===Yt.ON_NOTIFICATION||d._type===Yt.ON_USER_BANNED?(this.emit(d._type,d._message),d._type===Yt.ON_NOTIFICATION&&this.handleNotification(d._message),d._type===Yt.ON_USER_BANNED&&this.handleUserBanned(d._message)):(this.pendingNotifications.push({type:d._type,message:d._message}),M.debug("[".concat(this.clientId,"] cached notification during join: ").concat(d._type))):(this.emit(d._type,d._message),d._type===Yt.ON_NOTIFICATION&&this.handleNotification(d._message),d._type===Yt.ON_USER_BANNED&&this.handleUserBanned(d._message)))}),this.clientId=i.clientId,this.spec=i,this.store=s,this.websocket=new Hee("gateway-".concat(this.clientId),this.spec.retryConfig,!0,s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Cn.CONNECTED&&this.reconnect("retry",Yg.OFFLINE)})}async request(i,s,o,d){const h=dr(6,""),f={_id:h,_type:i,_message:s},g=this.websocket.connectionID,y=()=>new et(($,z)=>{if(this.connectionState===Cn.CONNECTED)return $();const K=()=>{this.off(xt.WS_CLOSED,ie),$()},ie=()=>{this.off(xt.WS_CONNECTED,K),z(new Ce(se.WS_ABORT))};this.once(xt.WS_CONNECTED,K),this.once(xt.WS_CLOSED,ie),i!==kt.PUBLISH&&i!==kt.SUBSCRIBE&&i!==kt.UNSUBSCRIBE&&i!==kt.UNPUBLISH&&i!==kt.CONTROL&&i!==kt.RESTART_ICE||this.once(xt.DISCONNECT_P2P,()=>{z(new Ce(se.DISCONNECT_P2P))}),i!==kt.PUBLISH&&i!==kt.RESTART_ICE||this.once(xt.ABORT_P2P_EXECUTION,()=>{z(new Ce(se.DISCONNECT_P2P))})});if(this.connectionState!==Cn.CONNECTING&&this.connectionState!==Cn.RECONNECTING||i===kt.JOIN||i===kt.REJOIN||await y(),i===kt.LEAVE&&(this.websocket.unbindDcCloseEventListener(),d=!0),re("DC_DEBUG_LOG")&&M.debug("[datachannel-signal] sendMessage",f),await this.websocket.sendMessage(f,!0,!1),d)return;const x=new et(($,z)=>{let K=!1;const ie=(fe,Ee)=>{K=!0,$({isSuccess:fe==="success",message:Ee||{}}),this.off(xt.WS_CLOSED,oe),this.off(xt.WS_RECONNECTING,oe),this.emit(xt.REQUEST_SUCCESS,i,s)};this.once("res-@".concat(h),ie);const oe=()=>{z(new Ce(se.WS_ABORT,"type: ".concat(i))),this.off(xt.WS_CLOSED,oe),this.off(xt.WS_RECONNECTING,oe),this.off("res-@".concat(h),ie)};this.once(xt.WS_CLOSED,oe),this.once(xt.WS_RECONNECTING,oe),As(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==g||K||(M.warning("dc request timeout, type: ".concat(i)),this.emit(xt.REQUEST_TIMEOUT,i,s))})});let b=null;try{b=await x}catch($){if(this.connectionState===Cn.CLOSED||i===kt.LEAVE)throw new Ce(se.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?$.throw():i===kt.JOIN||i===kt.REJOIN?null:(await y(),await this.request(i,s))}if(b.isSuccess)return b.message;const N=Number(b.message.error_code||b.message.code),I=Ry(N),D=new Ce(se.UNEXPECTED_RESPONSE,"".concat(I.desc,": ").concat(b.message.error_str),{code:N,data:b.message});return I.action==="success"?b.message:(M.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(i,", error_code: ").concat(N,", message: ").concat(I.desc,", action: ").concat(I.action)),N===jt.ERR_TOO_MANY_BROADCASTERS?((i===kt.JOIN||i===kt.REJOIN)&&(this.initError=D,this.close()),D.throw()):I.action==="failed"?D.throw():I.action==="quit"?(this.initError=D,this.close(),D.throw()):(N===jt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=b.message.option,M.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Yg.MULTI_IP)):this.reconnect(I.action,Yg.SERVER_ERROR),i===kt.JOIN||i===kt.REJOIN?null:await this.request(i,s)))}waitMessage(i,s){return new et(o=>{const d=h=>{(!s||s(h))&&(this.off(i,d),o(h))};this.on(i,d)})}uploadWRTCStats(i){if(!this.store.sessionId)return void M.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:i};this.upload(Ty.WRTC_STATS,s)}upload(i,s){const o={_type:i,_message:s};try{this.websocket.sendMessage(o)}catch{const h=re("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>h&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Cn.CONNECTED)return;const f=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(f._type,f._message)},re("UPLOAD_CACHE_INTERVAL")||2e3))}}async send(i,s){const o={_type:i,_message:s};await this.websocket.sendMessage(o)}init(i){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new et((s,o)=>{this.once(xt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(xt.WS_CLOSED,()=>o(this.initError||new Ce(se.WS_ABORT))),this.connectionState=Cn.CONNECTING,this.websocket.init(i).catch(o),this.websocket.once(ys.FAILBACK,()=>{o(new Ce(se.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{this.openConnectionTime===void 0&&(M.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),o(new Ce(se.INIT_DATACHANNEL_TIMEOUT)))},re("DC_JOIN_WITH_FAILBACK"))})}close(i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this.isJoining=!1,this.pendingNotifications=[],this._disconnectedReason=i||Rn.LEAVE,this.connectionState=Cn.CLOSED,M.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),i===Rn.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new Hee("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),re("DC_PINGPONG_INTERVAL")),!this.joinResponse){this.emit(xt.ABORT_P2P_EXECUTION),this.store.signalConnected();const i=await rs(this,xt.REQUEST_JOIN_INFO);this.store.joinReq(),this.isJoining=!0,this.pendingNotifications=[];const s=await this.request(kt.JOIN,i);if(this.store.joinRep(),this.ortc=i==null?void 0:i.ortc,!s)return this.emit(xt.REPORT_JOIN_GATEWAY,se.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(xt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Cn.CONNECTED,this.isJoining=!1,this.processPendingNotifications(),!0}async rejoin(){if(!this.reconnectToken)throw new Ce(se.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const i=uy(this,xt.REQUEST_REJOIN_INFO);i.token=this.reconnectToken;const s=await this.request(kt.REJOIN,i);return!!s&&(this.connectionState=Cn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),re("DC_PINGPONG_INTERVAL")),s.peers&&s.peers.forEach(o=>{this.emit(Yt.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(Yt.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(Yt.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(Yt.MUTE_AUDIO,{uid:o.uid}):this.emit(Yt.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(Yt.MUTE_VIDEO,{uid:o.uid}):this.emit(Yt.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(Yt.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(Yt.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(Yt.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(Yt.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(Yt.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(i,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(i,s)}async downgradeCodec(i){if(!this.ortc)return!1;const s={downgrade_codec:i,ortc:this.ortc};return!!await this.request(kt.DOWNGRADE_CODEC,s)}handleNotification(i){M.debug("[".concat(this.clientId,"] receive notification: "),i);const s=Ry(i.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Rn.UID_BANNED),void this.close()):void this.reconnect(s.action,Yg.SERVER_ERROR);M.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1,re("DC_DEBUG_LOG")&&console.debug("[datachannel-signal] pingpongTimeoutCount: ".concat(this.pingpongTimeoutCount));const i=re("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=i&&(M.warning("[datachannel-signal] PINGPONG Timeout. Last Socket Message: ".concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>re("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("recover",Yg.FALLBACK):this.request(kt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-s;this.rttRolling.add(o),re("REPORT_STATS")&&this.send(kt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleInflateData(){const{inflateLength:i,deflateLength:s}=this.websocket.getInflateData();i!==0&&s!==0&&this.upload(Ty.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:i})}handleWebsocketEvents(){this.websocket.on(ys.RECONNECT_CREATE_CONNECTION,i=>{this.emit(xt.WS_RECONNECT_CREATE_CONNECTION,i)}),this.websocket.on(ys.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(ys.CLOSED,()=>{this.connectionState=Cn.CLOSED}),this.websocket.on(ys.FAILED,()=>{this._disconnectedReason=Rn.NETWORK_ERROR,this.connectionState=Cn.CLOSED}),this.websocket.on(ys.RECONNECTING,i=>{this._websocketReconnectReason=i,this.joinResponse=void 0,this.connectionState===Cn.CONNECTED?this.connectionState=Cn.RECONNECTING:this.connectionState=Cn.CONNECTING}),this.websocket.on(ys.WILL_RECONNECT,(i,s)=>{if(uy(this,xt.IS_P2P_DISCONNECTED)&&i==="retry")return M.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(xt.NEED_RENEW_SESSION),this.emit(xt.DISCONNECT_P2P),s("tryNext");i!=="retry"&&(M.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(i)),this.reconnectToken=void 0,this.emit(xt.NEED_RENEW_SESSION),this.emit(xt.DISCONNECT_P2P)),s(i)}),this.websocket.on(ys.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(i=>{M.warning("[".concat(this.clientId,"] rejoin failed ").concat(i)),this.reconnect("tryNext",Yg.SERVER_ERROR)}):this.join().catch(i=>{if(this.emit(xt.REPORT_JOIN_GATEWAY,i.message||i.code,this.url||""),i instanceof Ce&&i.code===se.UNEXPECTED_RESPONSE&&i.data.code===jt.ERR_NO_AUTHORIZED)return M.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Yg.SERVER_ERROR);M.error("[".concat(this.clientId,"] join gateway request failed"),i.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Yg.SERVER_ERROR):(this.initError=i,this.close())})}),this.websocket.on(ys.REQUEST_NEW_URLS,(i,s)=>{rs(this,xt.REQUEST_RECOVER,this.multiIpOption).then(i).catch(s)}),this.websocket.on(ys.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Yt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(ys.TO_CONNECT_DATACHANNEL,(i,s)=>{rs(this,xt.PRE_CONNECT_PC).then(i).catch(s)}),this.websocket.on(ys.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(xt.DATACHANNEL_FAILBACK)})}}const kTe={name:"DataChannelConnection",create:function(n){let{store:i,spec:s}=n;return new CTe(s,i)}},PTe={name:"DataChannelSignal",create:function(n){let{store:i,spec:s}=n;return new ATe(s,i)}};e4(),xr("PROCESS_ID","process-".concat(dr(8,""),"-").concat(dr(4,""),"-").concat(dr(4,""),"-").concat(dr(4,""),"-").concat(dr(12,""))),function(){let n;try{n=window.localStorage.getItem("websdk_ng_global_parameter")}catch(i){return void M.error("Error loading sdk config",i.message)}if(n)try{const i=JSON.parse(window.atob(n)),s=Date.now();M.debug("Loading global parameters from cache",i),Object.keys(i).forEach(o=>{if(Object.prototype.hasOwnProperty.call(ur,o)){const{value:d,expires:h}=i[o];if(h&&h<=s)return;ql[o]=d,ur[o]=d}})}catch(i){M.error("Error loading mutableParamsCache: ".concat(n),i.message)}}(),Array.isArray(ql.AREAS)&&ql.AREAS.length>0&&t3(ql.AREAS,!0);const Kee=(n,i,s)=>{M.debug("setParameter key:".concat(n,", value:").concat(JSON.stringify(i))),xr(n,i,s)};sf(YSe,!1),sf(JSe,!1),sf(Cwe,!1),sf(cTe,!1),sf(HSe,!1),sf(ETe,!1),sf(wTe,!1),sf(TTe,!1),sf(kTe,!1),sf(PTe,!1);const is=function(n){const i=new ai,s=n,o={getListeners:i.getListeners.bind(i),on:(d,h)=>(function(f,g){f===tf.SECURITY_POLICY_VIOLATION&&EZ(g,!0)}(d,h),i.on.bind(i)(d,h)),addListener:i.addListener.bind(i),once:i.once.bind(i),off:i.off.bind(i),removeAllListeners:i.removeAllListeners.bind(i),emit:i.emit.bind(i),safeEmit:i.safeEmit.bind(i)};return vZ(vZ({},s),o)}({__TRACK_LIST__:_y,VERSION:Pd,BUILD:r4,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:Kee,getParameter:re,getSupportedCodec:async function(){let n={audio:[],video:[]};try{let i=new RTCPeerConnection;const s=await async function(o){let d;return xn().supportUnifiedPlan?(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}),d=(await o.createOffer()).sdp):d=(await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,d}(i);if(!s)return n;i.close(),i=null,n=function(o){const d={video:[],audio:[]};return o.match(/ VP8/i)&&d.video.push("VP8"),o.match(/ VP9/i)&&d.video.push("VP9"),o.match(/ AV1/i)&&d.video.push("AV1"),o.match(/ H264/i)&&d.video.push("H264"),o.match(/ H265/i)&&d.video.push("H265"),o.match(/ opus/i)&&d.audio.push("OPUS"),o.match(/ PCMU/i)&&d.audio.push("PCMU"),o.match(/ PCMA/i)&&d.audio.push("PCMA"),o.match(/ G722/i)&&d.audio.push("G722"),d}(s)}catch(i){throw new Ce(se.CREATE_OFFER_FAILED,i.toString&&i.toString()).print()}return n},checkSystemRequirements:function(){let n=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];const i=_t.reportApiInvoke(null,{name:Qr.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Tr.TRACER}),s=function(){let h=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],f=!1;try{const g=window.RTCPeerConnection,y=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,x=window.WebSocket;f=!(!g||!x),h&&!y&&(f=!1),f&&XT()&&kq(75)&&new g().close()}catch(g){M.error("check system requirement failed: ",g),f=!1}return f}(n),o=Iwe();M.debug("checkSystemRequirements, api:",s,"browser",o);const d=s&&o;return i.onSuccess(d),re("IGNORE_RTC_DEVICE_CHECK")?s:d},getDevices:function(n){return Ql.enumerateDevices(!0,!0,n)},getMicrophones:function(n){return Ql.getRecordingDevices(n)},getCameras:function(n){return Ql.getCamerasDevices(n)},getElectronScreenSources:jY,getPlaybackDevices:function(n){return Ql.getSpeakers(n)},createClient:gZ,createCameraVideoTrack:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=re("CAMERA_CAPTURE_CONFIG"),s=dr(8,"track-cam-"),o=_t.reportApiInvoke(null,{id:s,tag:Tr.TRACER,name:Qr.CREATE_CAM_VIDEO_TRACK,options:[zr({},n),i]});i&&(n.encoderConfig=i);const d=Jk(n);let h=null;M.info("start create camera video track with config",JSON.stringify(n),"trackId",s);try{h=(await Jl({video:d},s)).getVideoTracks()[0]||null}catch(g){throw o.onError(g),g}if(!h){const g=new Pe(se.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(g),g.throw(M)}if(n.optimizationMode&&b4(s,h,n,ju(n.encoderConfig)),re("USE_STANDARD_BITRATE_DEFAULT")){const g=ju(n.encoderConfig);n.encoderConfig=g,delete g.bitrateMax,delete g.bitrateMin}const f=new Zk(h,n,d,n.scalabiltyMode?qk(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,s);return o.onSuccess(f.getTrackId()),M.info("create camera video success, trackId:",s),f},createCustomVideoTrack:function(n){const i=dr(8,"track-cus-"),s=_t.reportApiInvoke(null,{id:i,tag:Tr.TRACER,name:Qr.CREATE_CUSTOM_VIDEO_TRACK,options:[n]});re("USE_STANDARD_BITRATE_DEFAULT")&&(delete n.bitrateMax,delete n.bitrateMin);const o=new Rr(n.mediaStreamTrack,{width:n.width,height:n.height,frameRate:n.frameRate,bitrateMax:n.bitrateMax,bitrateMin:n.bitrateMin},n.scalabiltyMode?qk(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,i,[or.CUSTOM_TRACK]);return s.onSuccess(o.getTrackId()),M.info("create custom video track success with config",n,"trackId",o.getTrackId()),o},createScreenVideoTrack:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const s=typeof i=="object"?function(I){const D=KY(I);return TY()&&I.suppressLocalAudioPlayback&&(D.suppressLocalAudioPlayback=I.suppressLocalAudioPlayback),RY()&&I.restrictOwnAudio&&(D.restrictOwnAudio=!0),D}(i):void 0;s&&(i="auto");const o=dr(8,"track-scr-v-"),d=_t.reportApiInvoke(null,{id:o,tag:Tr.TRACER,name:Qr.CREATE_SCREEN_VIDEO_TRACK,options:[zr({},n),i]});n.encoderConfig?typeof n.encoderConfig=="string"||n.encoderConfig.width&&n.encoderConfig.height||(n.encoderConfig.width={max:1920},n.encoderConfig.height={max:1080}):n.encoderConfig="1080p_2";const h=function(I){const D={};I.screenSourceType&&(D.mediaSource=I.screenSourceType),I.extensionId&&lm()&&(D.extensionId=I.extensionId);const{displaySurface:$,selfBrowserSurface:z,surfaceSwitching:K,systemAudio:ie,preferCurrentTab:oe,windowAudio:fe,monitorTypeSurfaces:Ee}=I;(Ph(107)||Gg(107)||cy(93))&&($&&(zi($,"displaySurface",["browser","window","monitor"]),D.displaySurface=$),z?(zi(z,"selfBrowserSurface",["exclude","include"]),D.selfBrowserSurface=z):D.selfBrowserSurface="include",K&&(zi(K,"surfaceSwitching",["exclude","include"]),D.surfaceSwitching=K)),(Ph(105)||Gg(105)||cy(91))&&ie&&(zi(ie,"systemAudio",["exclude","include"]),D.systemAudio=ie),(Ph(94)||Gg(94)||cy(80))&&oe&&(D.preferCurrentTab=!0),(Ph(141)||Gg(141)||cy(125))&&fe&&(zi(fe,"windowAudio",["exclude","system"]),D.windowAudio=fe),(Ph(119)||Gg(119)||cy(105))&&Ee&&(zi(Ee,"monitorTypeSurfaces",["exclude","include"]),D.monitorTypeSurfaces=Ee),I.electronScreenSourceId&&(D.sourceId=I.electronScreenSourceId);const Te=I.encoderConfig?l4(I.encoderConfig):null;return D.mandatory={chromeMediaSource:"desktop",maxWidth:Te?Te.width:void 0,maxHeight:Te?Te.height:void 0},Te&&(Te.frameRate&&(typeof Te.frameRate=="number"?(D.mandatory.maxFrameRate=Te.frameRate,D.mandatory.minFrameRate=Te.frameRate):(D.mandatory.maxFrameRate=Te.frameRate.max||Te.frameRate.ideal||Te.frameRate.exact||void 0,D.mandatory.minFrameRate=Te.frameRate.min||Te.frameRate.ideal||Te.frameRate.exact||void 0),D.frameRate=Te.frameRate),Te.width&&(D.width=Te.width),Te.height&&(D.height=Te.height)),D}(n);let f=null,g=null;const y=xn();if(!y.supportShareAudio&&i==="enable"){const I=new Pe(se.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return d.onError(I),I.throw(M)}M.info("start create screen video track with config",n,"withAudio",i,"trackId",o);const x=y.supportShareAudio&&i!=="disable";try{const I=await Jl({screen:h,screenAudio:x?s||!0:void 0},o);f=I.getVideoTracks()[0]||null,g=I.getAudioTracks()[0]||null}catch(I){throw d.onError(I),I}if(!f){const I=new Pe(se.UNEXPECTED_ERROR,"can not find track in media stream");return d.onError(I),I.throw(M)}if(!g&&i==="enable"){f&&f.stop();const I=new Pe(se.SHARE_AUDIO_NOT_ALLOWED);return d.onError(I),I.throw(M)}n.optimizationMode||(n.optimizationMode="detail"),n.optimizationMode&&(b4(o,f,n,n.encoderConfig&&l4(n.encoderConfig)||void 0),n.encoderConfig&&typeof n.encoderConfig!="string"&&(n.encoderConfig.bitrateMin=n.encoderConfig.bitrateMax));const b=new Rr(f,n.encoderConfig?l4(n.encoderConfig):{},n.scalabiltyMode?qk(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,o,[or.SCREEN_TRACK]);if(!g)return d.onSuccess(b.getTrackId()),M.info("create screen video track success","video:",b.getTrackId()),b;const N=new Pi(g,void 0,dr(8,"track-scr-a-"),!1);return d.onSuccess([b.getTrackId(),N.getTrackId()]),M.info("create screen video track success","video:",b.getTrackId(),"audio:",N.getTrackId()),[b,N]},createMicrophoneAndCameraTracks:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=re("CAMERA_CAPTURE_CONFIG"),o=dr(8,"track-mic-"),d=dr(8,"track-cam-"),h=_t.reportApiInvoke(null,{id:"".concat(o,"-").concat(d),tag:Tr.TRACER,name:Qr.CREATE_MIC_AND_CAM_TRACKS,options:[n,i,s]});s&&(i.encoderConfig=s);const f=Jk(i),g=qY(n);let y=null,x=null;M.info("start create camera video track(".concat(d,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(n),", video: ").concat(JSON.stringify(i)));try{const I=await Jl({audio:g,video:f},"".concat(o,"-").concat(d));y=I.getAudioTracks()[0],x=I.getVideoTracks()[0]}catch(I){throw h.onError(I),I}if(!y||!x){const I=new Pe(se.UNEXPECTED_ERROR,"can not find tracks in media stream");return h.onError(I),I.throw(M)}if(i.optimizationMode&&b4(d,x,i,ju(i.encoderConfig)),re("USE_STANDARD_BITRATE_DEFAULT")){const I=ju(i.encoderConfig);i.encoderConfig=I,delete I.bitrateMax,delete I.bitrateMin}const b=new aR(y,n,g,o),N=new Zk(x,i,f,i.scalabiltyMode?qk(i.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},i.optimizationMode,d);return h.onSuccess([b.getTrackId(),N.getTrackId()]),M.info("create camera video track(".concat(d,") and microphone audio track(").concat(o,") success")),[b,N]},createMicrophoneAudioTrack:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=dr(8,"track-mic-"),s=_t.reportApiInvoke(null,{id:i,tag:Tr.TRACER,name:Qr.CREATE_MIC_AUDIO_TRACK,options:[n]}),o=qY(n);let d=null;M.info("start create microphone audio track with config",JSON.stringify(n),"trackId",i);try{d=(await Jl({audio:o},i)).getAudioTracks()[0]||null}catch(f){throw s.onError(f),f}if(!d){const f=new Pe(se.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(f),f.throw(M)}const h=new aR(d,n,o,i);return s.onSuccess(h.getTrackId()),M.info("create microphone audio track success, trackId:",i),h},createCustomAudioTrack:vX,createBufferSourceAudioTrack:async function(n){var i;const{cacheOnlineFile:s,encoderConfig:o}=n;let{source:d}=n;const h={source:d instanceof AudioBuffer?"AudioBuffer":d instanceof File?(i=File.name)!==null&&i!==void 0?i:"File":d,cacheOnlineFile:s,encoderConfig:o},f=dr(8,"track-buf-"),g=_t.reportApiInvoke(null,{id:f,tag:Tr.TRACER,name:Qr.CREATE_BUFFER_AUDIO_TRACK,options:[h]});if(re("DISABLE_WEBAUDIO"))throw new Pe(se.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");M.info("start create buffer source audio track with config",JSON.stringify(h),"trackId",f);const y=d;if(!(d instanceof AudioBuffer))try{d=await async function(N,I){let D=null;if(typeof N=="string"){const z=O$.get(N);if(z)return M.debug("use cached audio resource: ",N),z;try{D=(await Dh(()=>mc.get(N,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(K){throw new Pe(se.FETCH_AUDIO_FILE_FAILED,K.toString())}}else D=await new et((K,ie)=>{const oe=new FileReader;oe.onload=fe=>{fe.target?K(fe.target.result):ie(new Pe(se.READ_LOCAL_AUDIO_FILE_ERROR))},oe.onerror=()=>{ie(new Pe(se.READ_LOCAL_AUDIO_FILE_ERROR))},oe.readAsArrayBuffer(N)});const $=await function(z){const K=Rx();return new et((ie,oe)=>{K.decodeAudioData(z,fe=>{ie(fe)},fe=>{oe(new Pe(se.DECODE_AUDIO_FILE_FAILED,fe.toString()))})})}(D);return typeof N=="string"&&I&&O$.set(N,$),$}(d,s)}catch(N){return g.onError(N),N.throw(M)}const x=new Yxe(d),b=new qxe(y,x,o?Yk(o):{},f);return M.info("create buffer source audio track success, trackId:",f),g.onSuccess(b.getTrackId()),b},setAppType:function(n){if(M.debug("setAppType: ".concat(n)),!(Number.isInteger(n)&&n>=0))throw M.debug("Invalid appType"),new Ce(se.INVALID_PARAMS,"invalid app type",n);xr("APP_TYPE",Math.floor(n))},setLogLevel:function(n){M.setLogLevel(n)},enableLogUpload:function(){re("USE_NEW_LOG")?xr("UPLOAD_LOG",!0):M.enableLogUpload()},disableLogUpload:function(){re("USE_NEW_LOG")?xr("UPLOAD_LOG",!1):M.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new MJ},checkAudioTrackIsActive:async function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=_t.reportApiInvoke(null,{tag:Tr.TRACER,name:Qr.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[i]});if(!(n instanceof Pi||n instanceof Ix)){const y=new Ce(se.INVALID_TRACK,"the parameter is not a audio track");return s.onError(y),y.throw()}i&&i<1e3&&(i=1e3);const o=n instanceof Pi?n.getTrackLabel():"remote_track",d=n.getVolumeLevel();let h=d,f=d;const g=Date.now();return new et(y=>{const x=setInterval(()=>{const b=n.getVolumeLevel();h=b>h?b:h,f=b<f?b:f;const N=h-f>1e-4,I=Date.now()-g;if(N||I>i){clearInterval(x);const D=N,$={duration:I,deviceLabel:o,maxVolumeLevel:h,result:D};M.info("[track-".concat(n.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify($))),s.onSuccess($),y(D)}},200)})},checkVideoTrackIsActive:async function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=_t.reportApiInvoke(null,{tag:Tr.TRACER,name:Qr.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[i]});if(!(n instanceof Rr||n instanceof Nx)){const N=new Ce(se.INVALID_TRACK,"the parameter is not a video track");return s.onError(N),N.throw()}i&&i<1e3&&(i=1e3);const o=n instanceof Rr?n.getTrackLabel():"remote_track",d=n.getMediaStreamTrack(!0),h=document.createElement("video");h.style.width="1px",h.style.height="1px",h.setAttribute("muted",""),h.muted=!0,h.setAttribute("playsinline",""),h.controls=!1,(Ks()||Lk())&&(h.style.opacity="0.01",h.style.position="fixed",h.style.left="0",h.style.top="0",document.body.appendChild(h)),h.srcObject=new MediaStream([d]),h.play();const f=document.createElement("canvas");f.width=160,f.height=120;let g=0,y=0;try{const N=Date.now();g=await function(I,D,$,z){let K,ie=0,oe=null;return new et((fe,Ee)=>{function Te(){ie>z&&K&&(K(),fe(ie));const _e=$.getContext("2d");if(!_e){const Be=new Ce(se.UNEXPECTED_ERROR,"can not get canvas 2d context.");return M.error(Be.toString()),void Ee(Be)}_e.drawImage(I,0,0,160,120);const Re=_e.getImageData(0,0,$.width,$.height),je=Math.floor(Re.data.length/3);if(oe){for(let Be=0;Be<je;Be+=3)if(Re.data[Be]!==oe[Be])return ie+=1,void(oe=Re.data);oe=Re.data}else oe=Re.data}setTimeout(()=>{K&&(K(),fe(ie))},D),K=m4(()=>{Te()},30)})}(h,i,f,4),y=Date.now()-N}catch(N){throw s.onError(N),N}pwe===$n.SAFARI&&(h.pause(),h.remove()),h.srcObject=null;const x=g>4,b={duration:y,changedPicNum:g,deviceLabel:o,result:x};return M.info("[track-".concat(n.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(b))),s.onSuccess(b),x},setArea:t3,audioElementPlayCenter:uo,resumeAudioContext:function(){return uo.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(n){kwe.processExternalMediaAEC(n)},registerExtensions:function(n){const i=re("PLUGIN_INFO")||[];n.forEach(s=>{"name"in s&&!Ge(i).call(i,s.name)&&i.push(s.name);const o=s;o.__registered__=!0,o.logger.hookLog=M.extLog,o.reporter.hookApiInvoke=_t.extApiInvoke,o.parameters&&Object.keys(o.parameters).forEach(d=>{o.parameters[d]=re(d)})}),Kee("PLUGIN_INFO",i)},ChannelMediaRelayError:Px,ChannelMediaRelayEvent:pm,ChannelMediaRelayState:qc,RemoteStreamFallbackType:Bxe,RemoteStreamType:Fxe,ConnectionDisconnectedReason:Rn,AudienceLatencyLevelType:mxe,AREAS:er,preload:async function(n,i,s,o){return w3(n,i,s,o)},startLastmileProbeTest:async function(n,i,s,o){let d={state:"unavailable"};await w3(n,i,s,o);const h=await S3({appId:n,cname:i,token:s||n,uid:o,cloudProxyServer:"disabled"});if(!h)return d;await T3(h);let f,g=gZ({mode:"rtc",codec:"vp8"});try{f=await g.join(n,i,s,o,{networkQualityProbe:!0})}catch{return d}const y=new _we,x=y.createMuteAudioTrack();let b=await vX({mediaStreamTrack:x});await g.publish([b]);let[N,I,D]=await new et((fe,Ee)=>{const Te=setTimeout(()=>{clearTimeout(Te),fe([!0,null,"audio"])},5e3);g.on("user-published",async(_e,Re)=>{_e.uid===f&&(clearTimeout(Te),fe([!1,_e,Re]))})});if(N||!I)return await g.unpublish([b]),await g.leave(),b.close(),y.close(),d;await g.subscribe(I,D),await new et((fe,Ee)=>{const Te=setTimeout(()=>{clearTimeout(Te),fe(null)},5e3)});let $=g.getRTCStats(),z=g.getLocalAudioStats();const K=$.RTT,ie=z.sendJitterMs,oe=z.currentPacketLossRate;return d={state:"complete",rtt:K,packetLossRate:oe,jitter:ie,networkQuality:((fe,Ee,Te)=>{let _e=1;if(Te>0){let Ht=Math.log(100*Te)/Math.log(2)+1;Ht=Math.min(5,Math.max(0,Ht)),_e=1-Ht/5}let Re=1;if(fe>0){let Ht=Math.log(fe/40)/Math.log(2)+1;Ht=Math.min(5,Math.max(0,Ht)),Re=1-Ht/5}let je=1;if(Ee>0){let Ht=Math.log(Ee/10)/Math.log(2.5)+1;Ht=Math.min(5,Math.max(0,Ht)),je=1-Ht/5}const Be=.5*_e+.3*Re+.2*je;let dt=0;return dt=Be>=.8?1:Be>=.6?2:Be>=.4?3:Be>=.2?4:5,dt})(K,ie,oe)},await g.unsubscribe(I),await g.unpublish([b]),await g.leave(),b.close(),y.close(),await T3(h),d}});return Object.defineProperties(is,{onAudioAutoplayFailed:{get:()=>_c.onAudioAutoplayFailed,set:n=>{_c.onAudioAutoplayFailed=n}},onAutoplayFailed:{get:()=>_c.onAutoplayFailed,set:n=>{_c.onAutoplayFailed=n}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>is._onSecurityPolicyViolation,set(n){is._onSecurityPolicyViolation=n,EZ(n)}},__CLIENT_LIST__:{get:()=>re("SHOW_GLOBAL_CLIENT_LIST")?wy:[]}}),Ql.on(vy.CAMERA_DEVICE_CHANGED,n=>{M.info("camera device changed",JSON.stringify(n)),is.onCameraChanged&&is.onCameraChanged(n),is.safeEmit(tf.CAMERA_CHANGED,n)}),Ql.on(vy.RECORDING_DEVICE_CHANGED,n=>{M.info("microphone device changed",JSON.stringify(n)),is.onMicrophoneChanged&&is.onMicrophoneChanged(n),is.safeEmit(tf.MICROPHONE_CHANGED,n)}),Ql.on(vy.PLAYOUT_DEVICE_CHANGED,n=>{M.debug("playout device changed",JSON.stringify(n)),is.onPlaybackDeviceChanged&&is.onPlaybackDeviceChanged(n),is.safeEmit(tf.PLAYBACK_DEVICE_CHANGED,n)}),uo.onAutoplayFailed=()=>{M.info("detect audio element autoplay failed"),_c.onAudioAutoplayFailed&&_c.onAudioAutoplayFailed()},br.on("autoplay-failed",()=>{M.info("detect webaudio autoplay failed"),_c.onAudioAutoplayFailed&&_c.onAudioAutoplayFailed(),is.safeEmit(tf.AUTOPLAY_FAILED)}),br.on(da.STATE_CHANGE,(n,i)=>{M.info("audio context state changed: ".concat(i," => ").concat(n)),is.onAudioContextStateChanged&&is.onAudioContextStateChanged(n,i),is.safeEmit(tf.AUDIO_CONTEXT_STATE_CHANGED,n,i)}),wi.on(dy.NETWORK_STATE_CHANGE,(n,i)=>{M.info("[network-indicator] network state changed, ".concat(i," => ").concat(n))}),window&&(window.__ARTC__=is),is})})(kme);var TBe=kme.exports;const Gse=VO(TBe),RBe="ee6b812204e647358c5e9345deabc13d",Hy={warningTimeMs:12e4,kickTimeMs:18e4,speakingThreshold:.15,checkIntervalMs:5e3},CBe=t=>{let e=0;for(let r=0;r<t.length;r++){const a=t.charCodeAt(r);e=(e<<5)-e+a,e=e&e}return Math.abs(e)%1e9},NBe=({roomId:t,oderId:e,username:r,onUserJoined:a,onUserLeft:l,onError:u,onAFKWarning:p,onAFKKick:m,onSpeakingChange:v})=>{const[w,R]=V.useState(!1),[C,A]=V.useState(!1),[O,U]=V.useState(!0),[F,q]=V.useState(0),[W,H]=V.useState(new Map),[X,ne]=V.useState(null),[te,he]=V.useState("prompt"),[J,Q]=V.useState(!1),[ce,de]=V.useState(0),pe=V.useRef(null),be=V.useRef(null),ye=V.useRef(null),Ze=V.useRef(Date.now()),It=V.useRef(null),St=V.useRef(!1);V.useEffect(()=>{const Ct=Gse.createClient({mode:"rtc",codec:"vp8"});return pe.current=Ct,Ct.on("user-published",async(Ot,vt)=>{var zt;vt==="audio"&&(await Ct.subscribe(Ot,vt),(zt=Ot.audioTrack)==null||zt.play(),H(ln=>{const Pn=new Map(ln);return Pn.set(Ot.uid.toString(),{oderId:Ot.uid.toString(),isSpeaking:!1,isMuted:!1,audioLevel:0}),Pn}),a==null||a(Ot))}),Ct.on("user-unpublished",(Ot,vt)=>{vt==="audio"&&H(zt=>{const ln=new Map(zt),Pn=ln.get(Ot.uid.toString());return Pn&&ln.set(Ot.uid.toString(),{...Pn,isMuted:!0,isSpeaking:!1}),ln})}),Ct.on("user-left",Ot=>{H(vt=>{const zt=new Map(vt);return zt.delete(Ot.uid.toString()),zt}),l==null||l(Ot)}),Ct.on("exception",Ot=>{}),()=>{pe.current&&(pe.current.removeAllListeners(),pe.current.leave()),be.current&&be.current.close(),ye.current&&clearInterval(ye.current),It.current&&clearInterval(It.current)}},[a,l]);const lt=V.useCallback(()=>{ye.current&&clearInterval(ye.current),ye.current=setInterval(()=>{if(be.current&&!O){const Ct=be.current.getVolumeLevel();q(Ct);const Ot=St.current,vt=Ct>Hy.speakingThreshold;vt&&(Ze.current=Date.now(),Q(!1),de(0)),vt!==Ot&&(St.current=vt,v==null||v(vt))}else q(0);if(pe.current){const Ct=pe.current.remoteUsers;H(Ot=>{const vt=new Map(Ot);return Ct.forEach(zt=>{var ni;const ln=((ni=zt.audioTrack)==null?void 0:ni.getVolumeLevel())||0,Pn=vt.get(zt.uid.toString());Pn&&vt.set(zt.uid.toString(),{...Pn,audioLevel:ln,isSpeaking:ln>Hy.speakingThreshold})}),vt})}},100)},[O,v]),Le=V.useCallback(()=>{It.current&&clearInterval(It.current),Ze.current=Date.now(),It.current=setInterval(()=>{if(O){Q(!1),de(0);return}const Ct=Date.now()-Ze.current,Ot=Math.max(0,Hy.kickTimeMs-Ct);de(Math.ceil(Ot/1e3)),Ct>=Hy.warningTimeMs&&Ct<Hy.kickTimeMs&&(J||(Q(!0),p==null||p(),"vibrate"in navigator&&navigator.vibrate([200,100,200,100,200]))),Ct>=Hy.kickTimeMs&&(m==null||m(),Q(!1))},Hy.checkIntervalMs)},[O,J,p,m]),Me=V.useCallback(()=>{Ze.current=Date.now(),Q(!1),de(0)},[]),Ke=V.useCallback(()=>{Me()},[Me]),Rt=V.useCallback(async()=>{var Ct,Ot,vt;if(!(!pe.current||w||C)){A(!0),ne(null);try{const zt=CBe(e);await pe.current.join(RBe,t,null,zt);try{const ln=await Gse.createMicrophoneAudioTrack();be.current=ln,he("granted"),ln.setEnabled(!1),await pe.current.publish([ln]),R(!0),U(!0),lt(),Le()}catch(ln){ln.code==="PERMISSION_DENIED"||(Ct=ln.message)!=null&&Ct.includes("Permission denied")||(Ot=ln.message)!=null&&Ot.includes("NotAllowedError")||ln.name==="NotAllowedError"?(he("denied"),ne("Mikrofon deaktiviert - Bitte erlaube den Zugriff in deinen Browser-Einstellungen, um sprechen zu knnen.")):ln.code==="DEVICE_NOT_FOUND"||(vt=ln.message)!=null&&vt.includes("NotFoundError")||ln.name==="NotFoundError"?(he("error"),ne("Kein Mikrofon gefunden. Bitte schliee ein Mikrofon an.")):(he("error"),ne("Fehler beim Aktivieren des Mikrofons. Du kannst zuhren, aber nicht sprechen.")),R(!0),U(!0),lt()}}catch(zt){ne(zt.message||"Fehler beim Beitreten zum Voice Chat")}finally{A(!1)}}},[t,e,w,C,lt,Le,u]),rt=V.useCallback(async()=>{if(pe.current)try{ye.current&&(clearInterval(ye.current),ye.current=null),It.current&&(clearInterval(It.current),It.current=null),be.current&&(be.current.close(),be.current=null),await pe.current.leave(),R(!1),U(!0),q(0),H(new Map),Q(!1),de(0),ne(null)}catch{}},[]),mt=V.useCallback(async()=>{if(!be.current){te==="denied"&&ne("Mikrofon ist deaktiviert. Bitte erlaube den Zugriff in deinen Browser-Einstellungen.");return}const Ct=!O;be.current.setEnabled(!Ct),U(Ct),Ct||Me()},[O,te,Me]),yt=V.useCallback(async Ct=>{be.current&&(be.current.setEnabled(!Ct),U(Ct),Ct||Me())},[Me]);return V.useEffect(()=>{w&&Le()},[O,w,Le]),{isConnected:w,isConnecting:C,isMuted:O,localAudioLevel:F,remoteUsers:W,error:X,microphonePermission:te,afkWarning:J,afkTimeRemaining:ce,joinChannel:Rt,leaveChannel:rt,toggleMute:mt,setMuted:yt,resetAFKTimer:Me,dismissAFKWarning:Ke}},ab={voiceMinuteXP:10,speakingBonusXP:5,premiumMultiplier:1.5,maxXPPerSession:500,xpTickIntervalMs:6e4},Vz=t=>Math.floor(Math.sqrt(t/100))+1,Wse=t=>Math.pow(t-1,2)*100,IBe=t=>{const e=Vz(t),r=Wse(e),a=Wse(e+1),l=t-r,u=a-r;return{current:l,required:u,progress:Math.min(100,l/u*100)}},ABe=({userId:t,isPremium:e=!1,onXPGain:r,onLevelUp:a})=>{const{showXPGain:l}=Jr(),u=V.useRef(null),p=V.useRef(0),m=V.useRef(!1),v=V.useRef(!1),w=V.useRef(1),R=V.useCallback(async(H,X)=>{if(!t||H<=0||p.current>=ab.maxXPPerSession)return;const ne=e?Math.round(H*ab.premiumMultiplier):H,te=Math.min(ne,ab.maxXPPerSession-p.current);if(!(te<=0)){p.current+=te;try{const he=tt(De,"users",t),J=await Bn(he);if(J.exists()){const Q=J.data().xp||0,ce=J.data().level||1;w.current=ce;const de=Q+te,pe=Vz(de);await Xn(he,{xp:Ss(te),level:pe,totalVoiceMinutes:Ss(1),lastXPGain:ci()}),l(te,X),r==null||r(te,X),pe>ce&&(a==null||a(pe))}}catch{}}},[t,e,l,r,a]),C=V.useCallback(()=>{u.current||!t||(m.current=!0,p.current=0,u.current=setInterval(()=>{if(!m.current)return;let H=ab.voiceMinuteXP,X="Sprachchat Minute";v.current&&(H+=ab.speakingBonusXP,X="Aktiv gesprochen"),R(H,X)},ab.xpTickIntervalMs))},[t,R]),A=V.useCallback(()=>{m.current=!1,u.current&&(clearInterval(u.current),u.current=null)},[]),O=V.useCallback(H=>{v.current=H},[]);V.useEffect(()=>()=>{A()},[A]);const U=V.useCallback(async()=>{await R(50,"Tglicher Login")},[R]),F=V.useCallback(async()=>{await R(25,"Positive Bewertung erhalten")},[R]),q=V.useCallback(async H=>{await R(H*15,`${H} Stern(e) erhalten`)},[R]),W=V.useCallback(async()=>{await R(100,"Erste Verbindung heute")},[R]);return{startVoiceXPTick:C,stopVoiceXPTick:A,updateSpeakingStatus:O,awardXP:R,awardDailyLoginXP:U,awardPositiveRatingXP:F,awardStarReceivedXP:q,awardFirstConnectionXP:W,sessionXP:p.current,calculateLevel:Vz,calculateXPProgress:IBe}},kBe=15e3,PBe=1e4,nC="MIbamchs82Ve7y0ecX2TpPyymbw1";class DBe{constructor(){Qc(this,"heartbeatInterval",null);Qc(this,"currentUserId",null);Qc(this,"presenceListeners",new Map)}async initPresence(e){this.currentUserId=e;const r=tt(De,"presence",e);try{(await Bn(r)).exists()?await Xn(r,{isOnline:!0,lastSeen:ci()}):await Yi(r,{oderId:e,currentRoomId:null,currentRoomName:null,statusEmoji:"",lastSeen:ci(),isOnline:!0,isGhostMode:!1,createdAt:ci()}),this.startHeartbeat(e),console.log("[PresenceVault]  Presence initialized for:",e)}catch(a){console.error("[PresenceVault] Failed to init presence:",a)}}async syncPresence(e,r,a){const l=tt(De,"presence",e);try{await Xn(l,{currentRoomId:r,currentRoomName:a,lastSeen:ci(),isOnline:!0}),console.log("[PresenceVault]  Synced presence:",{userId:e,roomId:r,roomName:a}),r&&await this.broadcastActivity(e,"joined",a||"ein Wlkchen")}catch(u){console.error("[PresenceVault] Failed to sync presence:",u)}}async clearRoomPresence(e){const r=tt(De,"presence",e);try{await Xn(r,{currentRoomId:null,currentRoomName:null,lastSeen:ci()}),console.log("[PresenceVault]  Cleared room presence for:",e)}catch(a){console.error("[PresenceVault] Failed to clear presence:",a)}}async setGhostMode(e,r){if(e!==nC)return console.warn("[PresenceVault] Ghost mode is Founder-only"),!1;const a=tt(De,"presence",e);try{return await Xn(a,{isGhostMode:r,lastSeen:ci()}),console.log("[PresenceVault]  Ghost mode:",r?"ENABLED":"DISABLED"),!0}catch(l){return console.error("[PresenceVault] Failed to set ghost mode:",l),!1}}async getPresence(e,r){var a;try{const l=tt(De,"presence",e),u=await Bn(l);if(!u.exists())return null;const p=u.data(),m=r===nC,v=p.isGhostMode&&e===nC,w=tt(De,"users",e),R=await Bn(w),C=R.exists()?R.data():{},A=!m&&(C.privacyHideLocation||v),O=((a=p.lastSeen)==null?void 0:a.toDate())||new Date,U=Date.now()-O.getTime()<kBe;return{oderId:e,username:C.username||"unknown",displayName:C.displayName||"Unbekannt",avatarUrl:C.avatarUrl,currentRoomId:A?null:p.currentRoomId,currentRoomName:A?null:p.currentRoomName,statusEmoji:p.statusEmoji||"",lastSeen:O,isOnline:U,isInCloud:!A&&!!p.currentRoomId,privacyHideLocation:C.privacyHideLocation||!1,isFounder:e===nC,isGhostMode:v}}catch(l){return console.error("[PresenceVault] Failed to get presence:",l),null}}async getFriendsPresence(e,r){const a=[];for(const l of e){const u=await this.getPresence(l,r);u&&a.push(u)}return a.sort((l,u)=>l.isInCloud&&!u.isInCloud?-1:!l.isInCloud&&u.isInCloud?1:u.lastSeen.getTime()-l.lastSeen.getTime())}subscribeToPresence(e,r,a){const l=tt(De,"presence",e),u=na(l,async p=>{if(!p.exists()){a(null);return}const m=await this.getPresence(e,r);a(m)});return this.presenceListeners.set(e,u),u}async broadcastActivity(e,r,a){try{const l=tt(De,"presence",e),u=await Bn(l);if(u.exists()&&u.data().isGhostMode){console.log("[PresenceVault]  Ghost mode - no broadcast");return}const p=tt(De,"users",e),m=await Bn(p),v=m.exists()?m.data():{},w=tt(mn(De,"friendActivity"));await Yi(w,{userId:e,username:v.username||"unknown",action:r,roomName:a,message:r==="joined"?`ist in ${a} geschwebt `:`hat ${a} verlassen`,timestamp:ci(),expiresAt:fn.fromDate(new Date(Date.now()+5*60*1e3))}),console.log("[PresenceVault]  Broadcast activity:",{userId:e,action:r,roomName:a})}catch(l){console.error("[PresenceVault] Failed to broadcast:",l)}}startHeartbeat(e){this.stopHeartbeat(),this.heartbeatInterval=setInterval(async()=>{const r=tt(De,"presence",e);try{await Xn(r,{lastSeen:ci(),isOnline:!0})}catch(a){console.error("[PresenceVault] Heartbeat error:",a)}},PBe),console.log("[PresenceVault]  Heartbeat started")}stopHeartbeat(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null)}async goOffline(){if(!this.currentUserId)return;this.stopHeartbeat();const e=tt(De,"presence",this.currentUserId);try{await Xn(e,{isOnline:!1,currentRoomId:null,currentRoomName:null,lastSeen:ci()}),console.log("[PresenceVault]  Gone offline")}catch(r){console.error("[PresenceVault] Failed to go offline:",r)}this.presenceListeners.forEach(r=>r()),this.presenceListeners.clear(),this.currentUserId=null}isFounder(e){return e===nC}}const MN=new DBe,OBe=["MIbamchs82Ve7y0ecX2TpPyymbw1"];function Ome(t){return OBe.includes(t)}const mB=3e4,LBe=2e4,gB=4e4,Hse=6e4;class jBe{constructor(){Qc(this,"activeRoomId",null);Qc(this,"userId",null);Qc(this,"heartbeatInterval",null);Qc(this,"cleanupScheduled",!1);Qc(this,"pendingDeletions",new Map)}async joinRoomSafe(e){const{roomId:r,userId:a,username:l,displayName:u,level:p,isAnonymous:m,isGhost:v}=e;console.log("[RoomService]  joinRoomSafe starting...",{roomId:r,userId:a,isGhost:v}),this.activeRoomId&&this.activeRoomId!==r&&(console.log("[RoomService] Already in room, leaving first:",this.activeRoomId),await this.leaveRoom(this.activeRoomId,a));try{const w=tt(De,"rooms",r);let R=null;await y_(De,async C=>{const A=await C.get(w);if(!A.exists())throw new Error("Raum existiert nicht mehr");if(R=A.data(),R.isActive===!1)throw new Error("Raum ist nicht mehr aktiv");const O=R.participants||[];if(!Ome(a)&&O.length>=(R.maxParticipants||8))throw new Error("Raum ist voll");const U=O.filter(q=>q.oderId!==a),F={oderId:a,username:l,displayName:m||R.isAnonymous?"Wanderer":u,isSpeaking:!1,isMuted:!0,isAnonymous:m||R.isAnonymous,level:p,joinedAt:fn.now(),lastActiveAt:fn.now(),connectionState:"connected",isGhost:v||!1};this.pendingDeletions.has(r)&&(clearTimeout(this.pendingDeletions.get(r)),this.pendingDeletions.delete(r),console.log("[RoomService]  Cancelled pending deletion for room:",r)),C.update(w,{participants:[...U,F],markedForDeletion:null}),R.participants=[...U,F]}),this.activeRoomId=r,this.userId=a,this.startHeartbeat(r,a);try{const C=(R==null?void 0:R.name)||"Wlkchen";await MN.syncPresence(a,r,C),console.log("[RoomService]  Presence synced:",C)}catch(C){console.warn("[RoomService]  Presence sync failed (non-blocking):",C)}return console.log("[RoomService]  joinRoomSafe complete:",r),{success:!0,room:{id:r,...R}}}catch(w){return console.error("[RoomService]  joinRoomSafe failed:",w),{success:!1,error:w.message}}}async leaveRoom(e,r){console.log("[RoomService]  Leaving room:",e),this.stopHeartbeat();try{const a=tt(De,"rooms",e);await y_(De,async l=>{var w,R,C,A;const u=await l.get(a);if(!u.exists()){console.log("[RoomService] Room already deleted");return}const p=u.data(),v=(p.participants||[]).filter(O=>O.oderId!==r);if(v.length===0){const O=((R=(w=p.createdAt)==null?void 0:w.toDate)==null?void 0:R.call(w))||new Date,U=Date.now()-O.getTime(),F=(A=(C=p.creatorGraceUntil)==null?void 0:C.toDate)==null?void 0:A.call(C);if(F&&Date.now()<F.getTime()){const W=F.getTime()-Date.now();console.log("[RoomService]  Room protected by creator grace period for",W,"ms"),l.update(a,{participants:[],markedForDeletion:fn.now()}),this.scheduleDelayedDeletion(e,W+1e3)}else if(U>=mB)l.delete(a),console.log("[RoomService]  Empty room deleted immediately:",e);else{const W=mB-U;l.update(a,{participants:[],markedForDeletion:fn.now()}),console.log("[RoomService]  Room marked for deletion in",W,"ms"),this.scheduleDelayedDeletion(e,W)}}else l.update(a,{participants:v,markedForDeletion:null})}),this.activeRoomId===e&&(this.activeRoomId=null,this.userId=null);try{await MN.clearRoomPresence(r),console.log("[RoomService]  Presence cleared for user:",r)}catch(l){console.warn("[RoomService]  Presence clear failed:",l)}console.log("[RoomService]  Left room:",e)}catch(a){console.error("[RoomService]  Error leaving room:",a),this.activeRoomId===e&&(this.activeRoomId=null,this.userId=null)}}scheduleDelayedDeletion(e,r){this.pendingDeletions.has(e)&&clearTimeout(this.pendingDeletions.get(e));const a=setTimeout(async()=>{try{const l=tt(De,"rooms",e);await y_(De,async u=>{const p=await u.get(l);if(!p.exists()){console.log("[RoomService] Room already deleted");return}(p.data().participants||[]).length===0?(u.delete(l),console.log("[RoomService]  Delayed deletion complete:",e)):(u.update(l,{markedForDeletion:null}),console.log("[RoomService]  Deletion cancelled - room has participants"))})}catch(l){console.error("[RoomService] Delayed deletion error:",l)}finally{this.pendingDeletions.delete(e)}},r);this.pendingDeletions.set(e,a)}async updateParticipantState(e,r,a){try{const l=tt(De,"rooms",e);await y_(De,async u=>{const p=await u.get(l);if(!p.exists())return;const w=(p.data().participants||[]).map(R=>R.oderId===r?{...R,...a,lastActiveAt:fn.now()}:R);u.update(l,{participants:w})})}catch(l){console.error("[RoomService] Error updating participant state:",l)}}startHeartbeat(e,r){this.stopHeartbeat(),console.log("[RoomService]  Starting heartbeat for room:",e),this.sendHeartbeat(e,r),this.heartbeatInterval=setInterval(async()=>{await this.sendHeartbeat(e,r)},LBe)}async sendHeartbeat(e,r){try{const a=tt(De,"rooms",e);if(!(await Bn(a)).exists()){console.log("[RoomService]  Room deleted, clearing state"),this.activeRoomId=null,this.userId=null,this.stopHeartbeat();return}await y_(De,async u=>{const p=await u.get(a);if(!p.exists())return;const v=p.data().participants||[],w=Date.now(),R=v.filter(A=>{var F,q,W;if(A.oderId===r)return!0;const O=((W=(q=(F=A.lastActiveAt)==null?void 0:F.toDate)==null?void 0:q.call(F))==null?void 0:W.getTime())||0,U=w-O>gB;return U&&console.log("[RoomService]  Removing stale participant:",A.username),!U}).map(A=>A.oderId===r?{...A,lastActiveAt:fn.now()}:A),C=R.filter(A=>A.oderId!==r);u.update(a,{participants:R,lastActivity:fn.now()})})}catch(a){console.error("[RoomService] Heartbeat error:",a)}}stopHeartbeat(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null)}async cleanupStaleParticipants(e){if(!this.cleanupScheduled){this.cleanupScheduled=!0;try{const r=tt(De,"rooms",e);await y_(De,async a=>{var w,R,C,A,O,U;const l=await a.get(r);if(!l.exists())return;const u=l.data(),p=u.participants||[],m=Date.now(),v=p.filter(F=>{var H,X,ne;const q=((ne=(X=(H=F.lastActiveAt)==null?void 0:H.toDate)==null?void 0:X.call(H))==null?void 0:ne.getTime())||0,W=m-q<gB;return W||console.log("[RoomService]  Removing stale:",F.username,"- inactive for",m-q,"ms"),W});if(v.length===0){const F=((C=(R=(w=u.lastActivity)==null?void 0:w.toDate)==null?void 0:R.call(w))==null?void 0:C.getTime())||((U=(O=(A=u.createdAt)==null?void 0:A.toDate)==null?void 0:O.call(A))==null?void 0:U.getTime())||0;m-F>=Hse?(a.delete(r),console.log("[RoomService]  Deleted inactive room:",e)):(this.scheduleDelayedDeletion(e,mB),a.update(r,{participants:[],markedForDeletion:fn.now()}),console.log("[RoomService]  Scheduled deletion for empty room:",e))}else v.length<p.length&&(a.update(r,{participants:v,lastActivity:fn.now()}),console.log("[RoomService]  Cleaned",p.length-v.length,"stale participants"))})}catch(r){console.error("[RoomService] Error cleaning stale participants:",r)}finally{this.cleanupScheduled=!1}}}async globalCleanup(){var r,a,l,u,p,m;console.log("[RoomService]  Starting global cleanup...");const e={deleted:0,cleaned:0};try{const{collection:v,query:w,where:R,getDocs:C}=await VN(async()=>{const{collection:q,query:W,where:H,getDocs:X}=await Promise.resolve().then(()=>nje);return{collection:q,query:W,where:H,getDocs:X}},void 0),A=v(De,"rooms"),O=w(A,R("isActive","==",!0)),U=await C(O),F=Date.now();for(const q of U.docs){const W=q.data(),H=W.participants||[],X=q.id,ne=H.filter(te=>{var J,Q,ce;const he=((ce=(Q=(J=te.lastActiveAt)==null?void 0:J.toDate)==null?void 0:Q.call(J))==null?void 0:ce.getTime())||0;return F-he<gB});if(ne.length===0){const te=((l=(a=(r=W.lastActivity)==null?void 0:r.toDate)==null?void 0:a.call(r))==null?void 0:l.getTime())||((m=(p=(u=W.createdAt)==null?void 0:u.toDate)==null?void 0:p.call(u))==null?void 0:m.getTime())||0;if(F-te>=Hse){const he=tt(De,"rooms",X);await Tc(he),e.deleted++,console.log("[RoomService]  Global cleanup deleted:",X)}}else if(ne.length<H.length){const te=tt(De,"rooms",X);await Xn(te,{participants:ne}),e.cleaned++}}return console.log("[RoomService]  Global cleanup complete:",e),e}catch(v){return console.error("[RoomService] Global cleanup error:",v),e}}forceLeave(){this.activeRoomId&&this.userId&&(this.leaveRoom(this.activeRoomId,this.userId).catch(()=>{}),this.activeRoomId=null,this.userId=null),this.stopHeartbeat()}getActiveRoomId(){return this.activeRoomId}isInRoom(){return this.activeRoomId!==null}setActiveRoom(e,r){this.activeRoomId=e,this.userId=r,this.startHeartbeat(e,r),console.log("[RoomService]  Manually set active room:",e)}async joinRoom(e){return this.joinRoomSafe(e)}}const Qa=new jBe;function MBe(t){const[e,r]=V.useState(!1),[a,l]=V.useState(!1),[u,p]=V.useState(null),m=V.useRef(!1),v=V.useRef(null);V.useEffect(()=>{const A=q=>{if(console.log("[RoomService]  beforeunload triggered"),Qa.getActiveRoomId()&&t){Qa.forceLeave();try{MN.clearRoomPresence(t)}catch{console.warn("[RoomService] Presence clear failed on unload")}}},O=()=>{document.visibilityState==="hidden"?(console.log("[RoomService]  Tab hidden - starting 30s timer"),v.current&&clearTimeout(v.current),v.current=setTimeout(()=>{if(document.visibilityState==="hidden"&&t){const q=Qa.getActiveRoomId();q&&(console.log("[RoomService]  30s hidden - leaving room"),Qa.leaveRoom(q,t))}},3e4)):(console.log("[RoomService]  Tab visible - cancelling leave timer"),v.current&&(clearTimeout(v.current),v.current=null))},U=()=>{console.log("[RoomService]  Network offline - force leave"),Qa.forceLeave()},F=q=>{console.log("[RoomService]  pagehide triggered, persisted:",q.persisted),q.persisted||Qa.forceLeave()};return window.addEventListener("beforeunload",A),document.addEventListener("visibilitychange",O),window.addEventListener("offline",U),window.addEventListener("pagehide",F),()=>{window.removeEventListener("beforeunload",A),document.removeEventListener("visibilitychange",O),window.removeEventListener("offline",U),window.removeEventListener("pagehide",F),v.current&&clearTimeout(v.current)}},[t]);const w=V.useCallback(async A=>{if(!t||e)return{success:!1,error:"Nicht eingeloggt"};r(!0),p(null);const O=await Qa.joinRoomSafe({...A,userId:t});return O.success||p(O.error||"Fehler beim Beitreten"),r(!1),O},[t,e]),R=V.useCallback(async A=>{!t||m.current||(m.current=!0,l(!0),await Qa.leaveRoom(A,t),l(!1),m.current=!1)},[t]),C=V.useCallback(async(A,O)=>{t&&await Qa.updateParticipantState(A,t,O)},[t]);return{joinRoom:w,leaveRoom:R,updateState:C,isJoining:e,isLeaving:a,error:u,isInRoom:Qa.isInRoom(),activeRoomId:Qa.getActiveRoomId(),isFounder:t?Ome(t):!1}}const UBe="MIbamchs82Ve7y0ecX2TpPyymbw1",VBe=.5,_B=8,Kse=12e4,FBe=12e4;let wD=!1,Fz=0;const Lme=2e3;function BBe(t,e,r,a){const u=(r-t)*Math.PI/180,p=(a-e)*Math.PI/180,m=Math.sin(u/2)*Math.sin(u/2)+Math.cos(t*Math.PI/180)*Math.cos(r*Math.PI/180)*Math.sin(p/2)*Math.sin(p/2);return 6371*(2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)))}function jme(t,e){const r=Math.floor(t*200)/200,a=Math.floor(e*200)/200;return`${r}_${a}`}function zBe(t,e){const r=["Wolke","Nebel","Himmel","Traum","Stern","Aurora","Cosmos","Galaxy","Nova","Aether"],l=jme(t,e).split("").reduce((m,v)=>m+v.charCodeAt(0),0),u=r[l%r.length],p=l%99+1;return`${u} ${p}`}async function GBe(t){var w,R,C;const{userId:e,username:r,displayName:a,level:l,isAnonymous:u,latitude:p,longitude:m}=t,v=e===UBe;console.log("[AtomicRoom]  Starting atomic get_or_create...");try{const A=mn(De,"rooms"),O=Mr(A,Kn("isActive","==",!0),ih("createdAt","desc"),up(20)),U=await Cr(O);let F=null,q=null;for(const H of U.docs){const X=H.data(),ne=(w=X.location)==null?void 0:w.latitude,te=(R=X.location)==null?void 0:R.longitude;if(!ne||!te)continue;const he=BBe(p,m,ne,te),J=X.participants||[],Q=J.length<(X.maxParticipants||_B),ce=he<=VBe,de=!J.some(pe=>pe.oderId===e);if(Q&&ce&&de){F=H.id,q=X,console.log("[AtomicRoom]  Found existing room:",F,"distance:",he.toFixed(3),"km");break}}const W=await y_(De,async H=>{if(F&&q){const X=tt(De,"rooms",F),ne=await H.get(X);if(!ne.exists())return{needsCreate:!0};const te=ne.data(),he=te.participants||[];if(he.length>=(te.maxParticipants||_B)&&!v)return{needsCreate:!0};const J=he.filter(ce=>ce.oderId!==e),Q={oderId:e,username:r,displayName:u||te.isAnonymous?"Wanderer":a,isSpeaking:!1,isMuted:!0,isAnonymous:u||te.isAnonymous,level:l,joinedAt:fn.now(),lastActiveAt:fn.now(),connectionState:"connected",isGhost:!1};return H.update(X,{participants:[...J,Q],lastActivity:fn.now(),markedForDeletion:null}),{roomId:F,roomName:te.name,isNewRoom:!1}}return{needsCreate:!0}});if("needsCreate"in W&&W.needsCreate){const H=`room_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,X=zBe(p,m),ne=fn.now();console.log("[AtomicRoom]  Creating new room with CREATOR PROTECTION:",H);const te={oderId:e,username:r,displayName:u?"Wanderer":a,isSpeaking:!1,isMuted:!0,isAnonymous:u,level:l,joinedAt:ne,lastActiveAt:ne,connectionState:"connected",isGhost:!1,isCreator:!0},he=tt(De,"rooms",H);await Yi(he,{name:X,type:"public",isAnonymous:!1,participants:[te],maxParticipants:_B,xpMultiplier:1,isActive:!0,createdAt:ne,lastActivity:ne,createdBy:e,location:new qw(p,m),locationBucket:jme(p,m),isTemporary:!0,creatorGraceUntil:fn.fromMillis(Date.now()+Kse),minAgeForDeletion:FBe});const J=await Bn(he);if(!J.exists())throw new Error("Room creation verification failed");const ce=((C=J.data().participants)==null?void 0:C.length)||0;if(ce===0)throw console.error("[AtomicRoom]  CRITICAL: Creator not in room after creation!"),new Error("Creator not persisted in room");return console.log("[AtomicRoom]  Room created with creator inside:",{roomId:H,participantCount:ce,graceUntil:new Date(Date.now()+Kse).toISOString()}),{success:!0,roomId:H,roomName:X,isNewRoom:!0}}return{success:!0,roomId:W.roomId,roomName:W.roomName,isNewRoom:!1}}catch(A){return console.error("[AtomicRoom]  Error:",A),{success:!1,error:A.message||"Unbekannter Fehler"}}}async function WBe(t){const{userId:e}=t;if(wD)return console.log("[AtomicRoom]  BLOCKED - Already joining"),{success:!1,error:"Bereits am Beitreten"};const r=Date.now();if(r-Fz<Lme)return console.log("[AtomicRoom]  Cooldown active"),{success:!1,error:"Bitte warte kurz"};wD=!0,Fz=r;try{const a=await GBe(t);if(!a.success||!a.roomId)return console.log("[AtomicRoom]  Join failed:",a.error),a;Qa.setActiveRoom(a.roomId,e);try{await MN.syncPresence(e,a.roomId,a.roomName||"Wlkchen")}catch{console.warn("[AtomicRoom]  Presence sync failed (non-blocking)")}try{const l=tt(De,"users",e);await Xn(l,{currentRoomId:a.roomId,lastRoomJoinedAt:fn.now()})}catch{console.warn("[AtomicRoom]  Profile update failed (non-blocking)")}return console.log("[AtomicRoom]  Successfully joined room:",a.roomId,a.isNewRoom?"(NEW)":"(EXISTING)"),a}catch(a){return console.error("[AtomicRoom]  Unexpected error:",a),{success:!1,error:a.message||"Unerwarteter Fehler"}}finally{wD=!1}}async function HBe(t){const e=Qa.getActiveRoomId();if(!e){console.log("[AtomicRoom]  No active room to leave");return}console.log("[AtomicRoom]  Starting safe exit from room:",e);try{await Qa.leaveRoom(e,t);try{await MN.clearRoomPresence(t)}catch{console.warn("[AtomicRoom]  Presence clear failed")}try{const r=tt(De,"users",t);await Xn(r,{currentRoomId:null})}catch{console.warn("[AtomicRoom]  Profile update failed")}console.log("[AtomicRoom]  Safe exit complete")}catch(r){console.error("[AtomicRoom]  Exit error:",r),Qa.forceLeave()}}function KBe(){return wD}function qBe(){const t=Date.now()-Fz;return Math.max(0,Lme-t)}function YBe(t={}){const{onJoinSuccess:e,onJoinError:r,onLeaveComplete:a}=t,[l,u]=V.useState("idle"),[p,m]=V.useState(null),[v,w]=V.useState(null),[R,C]=V.useState(null),[A,O]=V.useState(0),U=V.useRef(null);V.useEffect(()=>(U.current=setInterval(()=>{const ne=qBe();O(ne),ne>0&&l==="idle"?u("cooldown"):ne===0&&l==="cooldown"&&u("idle")},200),()=>{U.current&&clearInterval(U.current)}),[l]),V.useEffect(()=>{const ne=()=>{const he=Qa.getActiveRoomId();he&&!p?(m(he),u("connected")):!he&&p&&(m(null),w(null),u("idle"))};ne();const te=setInterval(ne,1e3);return()=>clearInterval(te)},[p]);const F=V.useCallback(async ne=>{if(l==="joining"||KBe())return console.log("[useAtomicRoom] Already joining, ignoring request"),{success:!1,error:"Bereits am Beitreten"};u("joining"),C(null);const te=await WBe({userId:ne.userId,username:ne.username,displayName:ne.displayName,level:ne.level,isAnonymous:ne.isAnonymous??!1,latitude:ne.latitude,longitude:ne.longitude});return te.success&&te.roomId?(m(te.roomId),w(te.roomName||null),u("connected"),e==null||e(te.roomId,te.roomName||"Wlkchen"),{success:!0,roomId:te.roomId,roomName:te.roomName||"Wlkchen"}):(C(te.error||"Unbekannter Fehler"),u("error"),r==null||r(te.error||"Unbekannter Fehler"),{success:!1,error:te.error||"Unbekannter Fehler"})},[l,e,r]),q=V.useCallback(async()=>{if(!p){console.log("[useAtomicRoom] No room to leave");return}u("leaving");const ne=Qa.userId;ne?await HBe(ne):Qa.forceLeave(),m(null),w(null),u("idle"),a==null||a()},[p,a]),W=V.useCallback(()=>{C(null),l==="error"&&u("idle")},[l]);return{state:l,currentRoomId:p,currentRoomName:v,error:R,cooldownRemaining:A,joinRoom:F,leaveRoom:q,resetError:W,isInRoom:l==="connected"&&p!==null,canJoin:l==="idle"&&A===0}}const qse=(t,e,r,a)=>{const u=t*Math.PI/180,p=r*Math.PI/180,m=(r-t)*Math.PI/180,v=(a-e)*Math.PI/180,w=Math.sin(m/2)*Math.sin(m/2)+Math.cos(u)*Math.cos(p)*Math.sin(v/2)*Math.sin(v/2);return 6371e3*(2*Math.atan2(Math.sqrt(w),Math.sqrt(1-w)))},$Be=5e3,XBe=50,JBe=6e4;function QBe(t={}){const{movementThreshold:e=XBe,debounceMs:r=$Be,enabled:a=!0,onSignificantMove:l}=t,[u,p]=V.useState(null),[m,v]=V.useState(!1),[w,R]=V.useState(null),[C,A]=V.useState(0),[O,U]=V.useState(0),F=V.useRef(0),q=V.useRef(null),W=V.useRef(null),H=V.useRef(null),X=V.useRef(null),ne=V.useCallback((J,Q)=>q.current?qse(q.current.lat,q.current.lon,J,Q)>=e:!0,[e]),te=V.useCallback(J=>{const Q=Date.now(),ce=J.coords.latitude,de=J.coords.longitude;let pe=0;q.current&&(pe=qse(q.current.lat,q.current.lon,ce,de),A(Math.round(pe)));const be=Q-F.current;if(be<r){X.current=J,U(r-be),console.log(`[DebouncedLocation]  Cooldown: ${r-be}ms remaining`);return}if(!ne(ce,de)){console.log(`[DebouncedLocation]  Minor movement (${Math.round(pe)}m) - skipping update`);return}console.log(`[DebouncedLocation]  Significant move detected: ${Math.round(pe)}m`);const ye={latitude:ce,longitude:de,accuracy:J.coords.accuracy,timestamp:new Date(J.timestamp),isStale:!1};F.current=Q,q.current={lat:ce,lon:de},X.current=null,p(ye),A(0),U(0),l==null||l(ye)},[r,ne,l]),he=V.useCallback(()=>{if(!navigator.geolocation){R("Geolocation wird nicht untersttzt");return}console.log("[DebouncedLocation]  Force update requested"),v(!0),navigator.geolocation.getCurrentPosition(J=>{F.current=0;const Q={latitude:J.coords.latitude,longitude:J.coords.longitude,accuracy:J.coords.accuracy,timestamp:new Date(J.timestamp),isStale:!1};q.current={lat:J.coords.latitude,lon:J.coords.longitude},F.current=Date.now(),p(Q),v(!1),R(null),l==null||l(Q)},J=>{v(!1),R(J.message)},{enableHighAccuracy:!0,timeout:1e4})},[l]);return V.useEffect(()=>{if(!(!a||!navigator.geolocation))return v(!0),W.current=navigator.geolocation.watchPosition(J=>{v(!1),R(null),te(J)},J=>{v(!1),R(J.message),console.error("[DebouncedLocation]  Error:",J.message)},{enableHighAccuracy:!0,maximumAge:1e4,timeout:15e3}),H.current=setInterval(()=>{const J=r-(Date.now()-F.current);U(Math.max(0,J))},500),()=>{W.current!==null&&(navigator.geolocation.clearWatch(W.current),W.current=null),H.current&&(clearInterval(H.current),H.current=null)}},[a,te,r]),V.useEffect(()=>{if(!u)return;const J=setTimeout(()=>{p(Q=>Q?{...Q,isStale:!0}:null)},JBe);return()=>clearTimeout(J)},[u==null?void 0:u.timestamp]),{location:u,isAcquiring:m,error:w,distanceSinceLastUpdate:C,cooldownRemaining:O,forceUpdate:he,isSignificantMove:ne}}const ZBe=()=>{const t=dp(),e=yr(),{user:r}=Jr(),[a,l]=V.useState([]),[u,p]=V.useState([]),[m,v]=V.useState(null),[w,R]=V.useState(!0),[C,A]=V.useState(0),[O,U]=V.useState(null),[F,q]=V.useState(!1),[W,H]=V.useState(!0),[X,ne]=V.useState(!1),[te,he]=V.useState("all"),[J,Q]=V.useState(""),[ce,de]=V.useState("public"),[pe,be]=V.useState(!1),[ye,Ze]=V.useState(!1),[It,St]=V.useState(!1),[lt,Le]=V.useState(0),{joinRoom:Me,leaveRoom:Ke,updateState:Rt,isJoining:rt}=MBe((r==null?void 0:r.id)||null),{isInRoom:mt}=YBe({onJoinSuccess:(We,$t)=>{console.log("[Discover]  Atomic join success:",We,$t),yt()},onJoinError:We=>{console.error("[Discover]  Atomic join error:",We)},onLeaveComplete:()=>{console.log("[Discover]  Left room"),Ct()}});QBe({enabled:!mt,movementThreshold:50,debounceMs:5e3});const{playJoinSound:yt,playLeaveSound:Ct,playWarningSound:Ot,playMuteSound:vt}=mpe(),zt=(r==null?void 0:r.isPremium)||!1,{startVoiceXPTick:ln,stopVoiceXPTick:Pn,updateSpeakingStatus:ni}=ABe({userId:r==null?void 0:r.id,isPremium:zt,onLevelUp:We=>{}}),{isConnected:pr,isConnecting:nn,microphonePermission:ri,afkWarning:un,afkTimeRemaining:ui,joinChannel:Cs,leaveChannel:Jn,toggleMute:ds,dismissAFKWarning:Ra}=NBe({roomId:(m==null?void 0:m.id)||"",oderId:(r==null?void 0:r.id)||"",username:(r==null?void 0:r.username)||"",onError:We=>{},onAFKWarning:()=>{Ze(!0),Ot()},onAFKKick:()=>{St(!0)},onSpeakingChange:We=>{ni(We)}});V.useEffect(()=>{pr&&m?ln():Pn()},[pr,m,ln,Pn]),V.useEffect(()=>{const We=mn(De,"rooms"),$t=na(We,tr=>{const mi=[];tr.docs.forEach(Wr=>{var Ci;const Nn=Wr.data();Nn.isActive!==!1&&mi.push({id:Wr.id,name:Nn.name,type:Nn.type||"public",isAnonymous:Nn.isAnonymous||!1,participants:(Nn.participants||[]).map(Ar=>{var lr;return{id:Ar.oderId||Ar.id,oderId:Ar.oderId||Ar.id,username:Ar.username||"unknown",displayName:Ar.displayName||"Unbekannt",isSpeaking:Ar.isSpeaking||!1,isMuted:Ar.isMuted||!1,isAnonymous:Ar.isAnonymous||!1,level:Ar.level||1,joinedAt:((lr=Ar.joinedAt)==null?void 0:lr.toDate())||new Date}}),maxParticipants:Nn.maxParticipants||8,xpMultiplier:Nn.xpMultiplier||1,regionName:Nn.regionName,createdAt:((Ci=Nn.createdAt)==null?void 0:Ci.toDate())||new Date,createdBy:Nn.createdBy})}),mi.sort((Wr,Nn)=>Nn.createdAt.getTime()-Wr.createdAt.getTime()),l(mi),H(!1)},tr=>{console.error("Error fetching rooms:",tr),H(!1)});return()=>$t()},[]),V.useEffect(()=>{const We=mn(De,"starEvents"),$t=na(We,tr=>{const mi=[];tr.docs.forEach(Wr=>{var Ci,Ar,lr;const Nn=Wr.data();Nn.isActive!==!1&&mi.push({id:Wr.id,hostId:Nn.hostId,hostUsername:Nn.hostUsername,hostDisplayName:Nn.hostDisplayName,hostTier:Nn.hostTier||"nova",title:Nn.title,description:Nn.description,category:Nn.category||"general",startedAt:(Ci=Nn.startedAt)==null?void 0:Ci.toDate(),scheduledAt:(Ar=Nn.scheduledAt)==null?void 0:Ar.toDate(),endedAt:(lr=Nn.endedAt)==null?void 0:lr.toDate(),maxCapacity:Nn.maxCapacity||100,currentListeners:Nn.currentListeners||0,peakListeners:Nn.peakListeners||0,stageParticipants:Nn.stageParticipants||[],handRaiseQueue:Nn.handRaiseQueue||[],starsReceived:Nn.starsReceived||0,chatMessages:Nn.chatMessages||0,isPublic:Nn.isPublic!==!1,isRecording:Nn.isRecording||!1,isPinned:Nn.isPinned||!1,xpMultiplier:Nn.xpMultiplier||2})}),mi.sort((Wr,Nn)=>{var lr,Qi;const Ci=((lr=Wr.startedAt)==null?void 0:lr.getTime())||0;return(((Qi=Nn.startedAt)==null?void 0:Qi.getTime())||0)-Ci}),p(mi)},tr=>{console.error("Error fetching star events:",tr)});return()=>$t()},[]),V.useEffect(()=>{if(!m)return;const We=tt(De,"rooms",m.id),$t=na(We,async tr=>{var mi;if(tr.exists()){const Wr=tr.data();if(!Wr.isActive){v(null),R(!0),A(0);return}const Nn=(Wr.participants||[]).map(lr=>{var Qi;return{id:lr.oderId||lr.id,oderId:lr.oderId||lr.id,username:lr.username||"unknown",displayName:lr.displayName||"Unbekannt",isSpeaking:lr.isSpeaking||!1,isMuted:lr.isMuted||!1,isAnonymous:lr.isAnonymous||!1,level:lr.level||1,joinedAt:((Qi=lr.joinedAt)==null?void 0:Qi.toDate())||new Date}});r!=null&&r.id&&Nn.filter(Qi=>Qi.oderId===r.id).length>1&&(console.warn("[Discover] Duplicate participant detected - triggering cleanup"),Qa.cleanupStaleParticipants(m.id));const Ci=Nn.length,Ar=lt;if(Ar>0&&Ci!==Ar){const lr=r==null?void 0:r.id,Qi=m.participants.some(ol=>ol.oderId===lr),sh=Nn.some(ol=>ol.oderId===lr);Qi&&sh&&(Ci>Ar?yt():Ci<Ar&&Ct())}Le(Ci),v({id:tr.id,name:Wr.name,type:Wr.type||"public",isAnonymous:Wr.isAnonymous||!1,participants:Nn,maxParticipants:Wr.maxParticipants||8,xpMultiplier:Wr.xpMultiplier||1,regionName:Wr.regionName,createdAt:((mi=Wr.createdAt)==null?void 0:mi.toDate())||new Date,createdBy:Wr.createdBy})}else v(null),R(!0),A(0)});return()=>$t()},[m==null?void 0:m.id]),V.useEffect(()=>{const We=t.state;(We==null?void 0:We.filter)==="stars"&&(he("stars"),window.history.replaceState({},document.title))},[t.state]),V.useEffect(()=>{const We=t.state;if(We!=null&&We.joinRoom){const $t=a.filter(tr=>tr.participants.length<tr.maxParticipants);if($t.length>0){const tr=$t[Math.floor(Math.random()*$t.length)];us(tr,We.mode==="anonymous")}window.history.replaceState({},document.title)}},[t.state,a]),V.useEffect(()=>{if(C>0){const We=setTimeout(()=>{A(C-1),C===1&&(R(!1),"vibrate"in navigator&&navigator.vibrate([50,30,50]))},1e3);return()=>clearTimeout(We)}},[C]);const us=async(We,$t=!1)=>{var tr;if(!(!(r!=null&&r.id)||rt)){m&&await ro();try{const mi=await Me({roomId:We.id,username:r.username||"unknown",displayName:r.displayName||"Unbekannt",level:r.level||1,isAnonymous:$t||We.isAnonymous});if(!mi.success){console.error("[Discover] Failed to join room:",mi.error);return}const Wr=tt(De,"rooms",We.id),Nn=await Bn(Wr);if(Nn.exists()){const Ci=Nn.data(),Ar=(Ci.participants||[]).map(lr=>{var Qi;return{id:lr.oderId||lr.id,oderId:lr.oderId||lr.id,username:lr.username||"unknown",displayName:lr.displayName||"Unbekannt",isSpeaking:lr.isSpeaking||!1,isMuted:lr.isMuted||!0,isAnonymous:lr.isAnonymous||!1,level:lr.level||1,joinedAt:((Qi=lr.joinedAt)==null?void 0:Qi.toDate())||new Date}});Le(Ar.length),v({id:We.id,name:Ci.name||We.name,type:Ci.type||We.type,isAnonymous:Ci.isAnonymous||We.isAnonymous,participants:Ar,maxParticipants:Ci.maxParticipants||We.maxParticipants,xpMultiplier:Ci.xpMultiplier||We.xpMultiplier,regionName:Ci.regionName||We.regionName,createdAt:((tr=Ci.createdAt)==null?void 0:tr.toDate())||We.createdAt,createdBy:Ci.createdBy||We.createdBy})}else console.warn("[Discover] Room not found after join, using stale data"),Le(We.participants.length+1),v(We);R(!0),A(4),"vibrate"in navigator&&navigator.vibrate([20,10,20]),console.log("[Discover]  Successfully joined room:",We.id,$t?"(anonymous)":"")}catch(mi){console.error("[Discover] Error joining room:",mi)}}};V.useEffect(()=>{m&&(r!=null&&r.id)&&!pr&&!nn&&Cs()},[m==null?void 0:m.id,r==null?void 0:r.id]);const ro=async()=>{if(await Jn(),!m||!(r!=null&&r.id)){v(null),R(!0),A(0);return}try{await Ke(m.id),console.log("[Discover]  Successfully left room:",m.id)}catch(We){console.error("[Discover] Error leaving room:",We)}v(null),R(!0),A(0),St(!1)};V.useEffect(()=>{It&&ro()},[It]);const[Fa,hi]=V.useState(!1),[So,Ri]=V.useState(null),Gr=async()=>{if(!J.trim()||!(r!=null&&r.id)){Ri("Bitte gib einen Namen ein");return}hi(!0),Ri(null);try{const We={oderId:r.id,username:r.username||"unknown",displayName:pe?"Wanderer":r.displayName||"Unbekannt",isSpeaking:!1,isMuted:!0,isAnonymous:pe,level:r.level||1,joinedAt:fn.now(),lastActiveAt:fn.now(),connectionState:"connected"},$t={name:J.trim(),type:ce,isAnonymous:pe,participants:[We],maxParticipants:8,xpMultiplier:1,isActive:!0,createdAt:fn.now(),createdBy:r.id};console.log("[Discover] Creating room with creator as participant:",$t);const tr=await Lv(mn(De,"rooms"),$t);console.log("[Discover]  Room created with ID:",tr.id);const mi={id:tr.id,name:$t.name,type:$t.type,isAnonymous:$t.isAnonymous,participants:[{id:r.id,oderId:r.id,username:We.username,displayName:We.displayName,isSpeaking:!1,isMuted:!0,isAnonymous:pe,level:We.level,joinedAt:new Date}],maxParticipants:8,xpMultiplier:1,createdAt:new Date,createdBy:r.id};v(mi),R(!0),A(4),Le(1),Qa.setActiveRoom(tr.id,r.id),q(!1),Q(""),de("public"),be(!1),"vibrate"in navigator&&navigator.vibrate([20,10,20,10,20]),console.log("[Discover]  Now active in created room:",tr.id)}catch(We){console.error("[Discover]  Error creating room:",We),Ri(We.message||"Fehler beim Erstellen des Wlkchens")}finally{hi(!1)}},Ca=async()=>{if(C>0||!m||!(r!=null&&r.id))return;await ds();const We=!w;R(We),vt(We);try{await Rt(m.id,{isMuted:We,isSpeaking:!We})}catch($t){console.error("[Discover] Error updating mute status:",$t)}},Ac=We=>{console.log("Vote to remove:",We),U(null)},kc=async()=>{ne(!0),await new Promise(We=>setTimeout(We,1e3)),ne(!1)},Pc=a.filter(We=>te==="all"||te==="stars"?!0:te==="public"?We.type==="public"&&!We.isAnonymous:te==="anonymous"?We.isAnonymous:te==="regional"?We.type==="regional":!0),Ba=We=>{const $t=Math.floor((Date.now()-We.getTime())/6e4);return $t<60?`${$t}m`:`${Math.floor($t/60)}h ${$t%60}m`},Dc=u.filter(We=>We.startedAt&&!We.endedAt),ia=a.reduce((We,$t)=>We+$t.participants.length,0);if(W)return c.jsx("div",{className:"min-h-screen bg-[var(--synclulu-bg)] flex items-center justify-center theme-transition",children:c.jsxs("div",{className:"text-center",children:[c.jsx(fi,{size:32,className:"animate-spin text-[var(--synclulu-accent)] mx-auto mb-4"}),c.jsx("p",{className:"text-[var(--synclulu-muted)] text-sm",children:"Lade Wlkchen..."})]})});const Lt="MIbamchs82Ve7y0ecX2TpPyymbw1",Ir=(m==null?void 0:m.participants.map(We=>({id:We.oderId||We.id,displayName:We.isAnonymous?"Wanderer":We.displayName,username:We.username,avatarUrl:null,isSpeaking:We.isSpeaking,isMuted:We.isMuted,isHost:(m==null?void 0:m.createdBy)===We.oderId,isPremium:!1,isFounder:(We.oderId||We.id)===Lt,isGhost:!1,level:We.level,audioLevel:We.isSpeaking?.5+Math.random()*.5:0})))||[];return c.jsxs("div",{className:"min-h-screen bg-[var(--synclulu-bg)] safe-top pb-24 theme-transition",children:[m?c.jsx(SBe,{roomId:m.id,roomName:m.name,participants:Ir,currentUserId:(r==null?void 0:r.id)||"",onLeave:ro,onMuteToggle:Ca,onKickUser:(r==null?void 0:r.id)===Lt?async We=>{console.log("[Discover]  Founder kicking user:",We)}:void 0,onMuteUser:(r==null?void 0:r.id)===Lt?async We=>{console.log("[Discover]  Founder muting user:",We)}:void 0,onSendFriendRequest:We=>{e(`/user/${We}`)},isMuted:w}):c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"sticky top-0 z-20 glass-nav border-b border-[var(--synclulu-border)]",children:c.jsx("div",{className:"px-6 py-4",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"font-display text-2xl font-bold text-[var(--synclulu-text)]",children:"Entdecken"}),c.jsx("p",{className:"text-sm text-[var(--synclulu-muted)]",children:ia>0?`${ia} User in ${a.length} Wlkchen`:"Noch keine aktiven Wlkchen"})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("button",{onClick:()=>q(!0),className:"w-10 h-10 rounded-xl bg-[var(--synclulu-accent)] text-white shadow-sm flex items-center justify-center hover:opacity-90 transition-opacity",children:c.jsx(Ew,{size:20})}),c.jsx("button",{onClick:kc,disabled:X,className:"w-10 h-10 rounded-xl bg-[var(--synclulu-card)] shadow-sm flex items-center justify-center text-[var(--synclulu-muted)] hover:text-[var(--synclulu-accent)] transition-colors border border-[var(--synclulu-border)]",children:c.jsx(_v,{size:20,className:X?"animate-spin":""})})]})]})})}),c.jsx("div",{className:"px-6 py-4",children:c.jsx("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide pb-2",children:[{id:"all",label:"Alle",icon:cr},{id:"stars",label:"Stars",icon:kn,special:!0},{id:"public",label:"ffentlich",icon:Mv},{id:"anonymous",label:"Anonym",icon:lp},{id:"regional",label:"Regional",icon:no}].map(We=>c.jsxs("button",{onClick:()=>he(We.id),className:`flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-semibold whitespace-nowrap transition-all ${te===We.id?We.special?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-[var(--synclulu-accent)] text-white shadow-lg":We.special?"bg-purple-500/10 text-purple-500":"bg-[var(--synclulu-card)] text-[var(--synclulu-muted)] border border-[var(--synclulu-border)]"}`,children:[c.jsx(We.icon,{size:16}),We.label,We.special&&Dc.length>0&&c.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse"})]},We.id))})}),(te==="all"||te==="stars")&&u.length>0&&c.jsxs("div",{className:"px-6 mb-6",children:[te==="all"&&c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsxs("h2",{className:"font-semibold text-synclulu-text flex items-center gap-2",children:[c.jsx(kn,{size:18,className:"text-purple-500"}),"Star Events"]}),c.jsx("button",{onClick:()=>he("stars"),className:"text-sm text-purple-500 font-medium",children:"Alle anzeigen"})]}),c.jsx("div",{className:"space-y-4",children:u.map(We=>{const $t=!!We.startedAt&&!We.endedAt,tr=!!We.scheduledAt&&!We.startedAt;return c.jsx("div",{className:"relative",children:c.jsx(vBe,{tier:We.hostTier,intensity:"normal",children:c.jsxs("div",{className:"bg-gradient-to-br from-gray-900/95 to-gray-800/95 rounded-2xl p-4 border border-purple-500/30",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[$t?c.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-red-500/20 rounded-full",children:[c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-ping absolute"}),c.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full relative"})]}),c.jsx("span",{className:"text-[10px] font-bold text-red-400",children:"LIVE"})]}):tr?c.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-blue-500/20 rounded-full",children:[c.jsx(Ua,{size:12,className:"text-blue-400"}),c.jsx("span",{className:"text-[10px] font-bold text-blue-400",children:new Date(We.scheduledAt).toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})})]}):null,We.xpMultiplier>1&&c.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-amber-500/20 rounded-full",children:[c.jsx(Vs,{size:12,className:"text-amber-400"}),c.jsxs("span",{className:"text-[10px] font-bold text-amber-400",children:[We.xpMultiplier,"x XP"]})]})]}),c.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:"w-14 h-14 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 border-2",style:{borderColor:We.hostTier==="galaxy"?"#EC4899":"#F59E0B",boxShadow:`0 0 20px ${We.hostTier==="galaxy"?"rgba(236, 72, 153, 0.5)":"rgba(245, 158, 11, 0.5)"}`}}),c.jsx("div",{className:"absolute -bottom-1 -right-1",children:c.jsx(jN,{tier:We.hostTier,size:"md"})})]}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("div",{className:"flex items-center gap-2",children:c.jsxs("h3",{className:"font-bold text-white",children:["@",We.hostUsername]})}),c.jsx("p",{className:"text-sm text-gray-400",children:We.hostDisplayName})]})]}),c.jsx("h4",{className:"font-semibold text-white mb-2",children:We.title}),c.jsx("p",{className:"text-sm text-gray-400 mb-3",children:We.description}),$t&&c.jsxs("div",{className:"flex items-center gap-4 mb-4 text-xs text-gray-500",children:[c.jsxs("span",{className:"flex items-center gap-1",children:[c.jsx(cr,{size:14}),We.currentListeners.toLocaleString()," zuhren"]}),c.jsxs("span",{className:"flex items-center gap-1 text-amber-400",children:[c.jsx(as,{size:14}),We.starsReceived," Sterne"]}),We.handRaiseQueue.length>0&&c.jsxs("span",{className:"flex items-center gap-1 text-purple-400",children:[c.jsx(pz,{size:14}),We.handRaiseQueue.length," warten"]})]}),c.jsx("button",{onClick:()=>console.log("Join star event:",We.id),className:`w-full py-3 rounded-xl font-semibold flex items-center justify-center gap-2 transition-all ${$t?"bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:opacity-90":"bg-gray-700 text-gray-300"}`,children:$t?c.jsxs(c.Fragment,{children:[c.jsx(Qo,{size:18}),"Jetzt reinhren"]}):c.jsxs(c.Fragment,{children:[c.jsx(Ua,{size:18}),"Erinnerung setzen"]})})]})})},We.id)})})]}),te==="stars"&&u.length===0&&c.jsx("div",{className:"px-6 py-12",children:c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"w-20 h-20 mx-auto rounded-2xl bg-purple-500/10 flex items-center justify-center mb-4",children:c.jsx(kn,{size:32,className:"text-purple-500"})}),c.jsx("h3",{className:"font-semibold text-[var(--synclulu-text)] mb-2",children:"Keine Star Events"}),c.jsx("p",{className:"text-sm text-[var(--synclulu-muted)] max-w-xs mx-auto",children:"Aktuell sind keine Star Events live oder geplant. Schau spter nochmal vorbei!"})]})}),te!=="stars"&&a.length>0&&c.jsx("div",{className:"px-6 mb-4",children:c.jsx("div",{className:"bg-gradient-to-r from-amber-400 to-orange-500 rounded-2xl p-4 text-white",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center",children:c.jsx(Vs,{size:24})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("p",{className:"font-semibold",children:"Regional-Bonus aktiv!"}),c.jsx("p",{className:"text-sm text-white/80",children:"Bis zu 3x XP in bestimmten Zonen - geh raus und entdecke!"})]})]})})}),te!=="stars"&&c.jsx("div",{className:"px-6 space-y-4",children:a.length===0?c.jsxs("div",{className:"text-center py-12",children:[c.jsx(q_,{delay:0,children:c.jsx(TW,{size:140,className:"mx-auto mb-4"})}),c.jsx("h3",{className:"font-display font-bold text-xl text-[var(--synclulu-text)] mb-3",children:r9.empty.lounges}),c.jsx("p",{className:"text-sm text-[var(--synclulu-muted)] mb-8 max-w-xs mx-auto leading-relaxed",children:"Sei der Erste und erstelle ein Wlkchen, in dem sich deine Nachbarschaft treffen kann!"}),c.jsxs("button",{onClick:()=>q(!0),className:"inline-flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-[var(--synclulu-accent)] to-pink-500 text-white rounded-2xl font-display font-bold shadow-lg hover:shadow-xl transition-all",children:[c.jsx(Ew,{size:20}),"Wlkchen erstellen"]})]}):Pc.length===0?c.jsxs("div",{className:"text-center py-12",children:[c.jsx(q_,{delay:.2,children:c.jsx(wO,{size:120,className:"mx-auto mb-2"})}),c.jsx("p",{className:"font-semibold text-[var(--synclulu-text)] mb-2",children:"Keine Wlkchen gefunden"}),c.jsx("p",{className:"text-sm text-[var(--synclulu-muted)] mb-4",children:"ndere den Filter oder erstelle ein neues Wlkchen"}),c.jsx("button",{onClick:()=>he("all"),className:"px-6 py-3 bg-[var(--synclulu-accent)] text-white rounded-xl font-semibold",children:"Alle Wlkchen anzeigen"})]}):Pc.map(We=>c.jsxs("div",{className:"bg-[var(--synclulu-card)] rounded-2xl p-4 shadow-sm border border-[var(--synclulu-border)] hover:border-[var(--synclulu-accent)]/30 transition-all",children:[c.jsxs("div",{className:"flex items-start justify-between mb-3",children:[c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[c.jsx("h3",{className:"font-semibold text-[var(--synclulu-text)]",children:We.name}),We.isAnonymous&&c.jsx(yo,{size:14,className:"text-purple-500"})]}),c.jsxs("div",{className:"flex items-center gap-3 text-xs text-[var(--synclulu-muted)]",children:[c.jsxs("span",{className:"flex items-center gap-1",children:[c.jsx(cr,{size:12}),We.participants.length,"/",We.maxParticipants]}),c.jsxs("span",{className:"flex items-center gap-1",children:[c.jsx(Ua,{size:12}),Ba(We.createdAt)]})]})]}),We.xpMultiplier>1&&c.jsxs("div",{className:"px-2 py-1 bg-amber-500/10 text-amber-500 rounded-lg text-xs font-bold flex items-center gap-1",children:[c.jsx(Vs,{size:12}),We.xpMultiplier,"x XP"]})]}),c.jsx("div",{className:"flex items-center gap-2 mb-4",children:We.participants.length>0?c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"flex -space-x-2",children:[We.participants.slice(0,4).map($t=>c.jsx("div",{className:`w-8 h-8 rounded-full border-2 border-[var(--synclulu-card)] flex items-center justify-center text-xs ${$t.isAnonymous?"bg-purple-500/10 text-purple-500":"bg-[var(--synclulu-accent)]/10 text-[var(--synclulu-accent)]"} ${$t.isSpeaking?"ring-2 ring-green-400":""}`,children:$t.isAnonymous?"?":$t.displayName[0]},$t.id)),We.participants.length>4&&c.jsxs("div",{className:"w-8 h-8 rounded-full border-2 border-[var(--synclulu-card)] bg-[var(--synclulu-bg)] flex items-center justify-center text-xs text-[var(--synclulu-muted)]",children:["+",We.participants.length-4]})]}),We.participants.some($t=>$t.isSpeaking)&&c.jsxs("div",{className:"flex items-center gap-1 text-green-500 text-xs",children:[c.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),c.jsx("span",{children:"Aktiv"})]})]}):c.jsx("p",{className:"text-xs text-[var(--synclulu-muted)] italic",children:"Noch keine Teilnehmer"})}),c.jsxs("button",{onClick:()=>us(We,We.isAnonymous),disabled:We.participants.length>=We.maxParticipants,className:"w-full py-3 rounded-xl bg-[var(--synclulu-accent)] text-white font-semibold hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[c.jsx(op,{size:18}),We.isAnonymous?"Anonym beitreten":"Beitreten"]})]},We.id))})]}),F&&c.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-6 bg-black/50 backdrop-blur-sm",children:c.jsxs("div",{className:"w-full max-w-sm bg-[var(--synclulu-card)] rounded-3xl p-6 shadow-2xl border border-[var(--synclulu-border)]",children:[c.jsx("h2",{className:"font-display text-xl font-bold text-[var(--synclulu-text)] mb-6 text-center",children:"Wlkchen erstellen"}),c.jsxs("div",{className:"space-y-4 mb-6",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-[var(--synclulu-text)] mb-2",children:"Name"}),c.jsx("input",{type:"text",value:J,onChange:We=>Q(We.target.value),placeholder:"z.B. Chill Wlkchen",className:"w-full px-4 py-3 bg-[var(--synclulu-bg)] border border-[var(--synclulu-border)] rounded-xl text-[var(--synclulu-text)] placeholder-[var(--synclulu-muted)] focus:outline-none focus:ring-2 focus:ring-[var(--synclulu-accent)]/30",maxLength:30})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-[var(--synclulu-text)] mb-2",children:"Typ"}),c.jsxs("div",{className:"flex gap-2",children:[c.jsxs("button",{onClick:()=>de("public"),className:`flex-1 py-3 rounded-xl font-semibold flex items-center justify-center gap-2 transition-all ${ce==="public"?"bg-[var(--synclulu-accent)] text-white":"bg-[var(--synclulu-bg)] text-[var(--synclulu-muted)] border border-[var(--synclulu-border)]"}`,children:[c.jsx(Mv,{size:18}),"ffentlich"]}),c.jsxs("button",{onClick:()=>de("private"),className:`flex-1 py-3 rounded-xl font-semibold flex items-center justify-center gap-2 transition-all ${ce==="private"?"bg-[var(--synclulu-accent)] text-white":"bg-[var(--synclulu-bg)] text-[var(--synclulu-muted)] border border-[var(--synclulu-border)]"}`,children:[c.jsx(yo,{size:18}),"Privat"]})]})]}),c.jsxs("label",{className:"flex items-center gap-3 p-4 bg-purple-500/10 rounded-xl cursor-pointer border border-purple-500/20",children:[c.jsx("input",{type:"checkbox",checked:pe,onChange:We=>be(We.target.checked),className:"w-5 h-5 rounded text-purple-500 bg-[var(--synclulu-bg)] border-[var(--synclulu-border)]"}),c.jsxs("div",{children:[c.jsxs("p",{className:"font-medium text-[var(--synclulu-text)] flex items-center gap-2",children:[c.jsx(lp,{size:16,className:"text-purple-500"}),"Anonymes Wlkchen"]}),c.jsx("p",{className:"text-xs text-[var(--synclulu-muted)]",children:'Alle Teilnehmer werden als "Wanderer" angezeigt'})]})]})]}),So&&c.jsx("div",{className:"mb-4 p-3 bg-red-500/10 border border-red-500/20 rounded-xl",children:c.jsx("p",{className:"text-sm text-red-500",children:So})}),c.jsxs("div",{className:"flex gap-3",children:[c.jsx("button",{onClick:()=>{q(!1),Ri(null)},disabled:Fa,className:"flex-1 py-3 px-4 bg-[var(--synclulu-bg)] text-[var(--synclulu-muted)] rounded-xl font-semibold disabled:opacity-50 border border-[var(--synclulu-border)]",children:"Abbrechen"}),c.jsx("button",{onClick:Gr,disabled:!J.trim()||Fa,className:"flex-1 py-3 px-4 bg-[var(--synclulu-accent)] text-white rounded-xl font-semibold disabled:opacity-50 flex items-center justify-center gap-2",children:Fa?c.jsxs(c.Fragment,{children:[c.jsx(fi,{size:18,className:"animate-spin"}),"Erstelle..."]}):"Erstellen"})]})]})}),O&&c.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-6 bg-black/50 backdrop-blur-sm",children:c.jsxs("div",{className:"w-full max-w-sm bg-[var(--synclulu-card)] rounded-3xl p-6 shadow-2xl border border-[var(--synclulu-border)]",children:[c.jsxs("div",{className:"text-center mb-6",children:[c.jsx("div",{className:"w-16 h-16 bg-red-500/10 rounded-2xl flex items-center justify-center mx-auto mb-4",children:c.jsx(rh,{size:32,className:"text-red-500"})}),c.jsx("h2",{className:"font-display text-xl font-bold text-[var(--synclulu-text)] mb-2",children:"User melden?"}),c.jsx("p",{className:"text-sm text-[var(--synclulu-muted)]",children:"Bei mehreren Meldungen wird der User aus dem Wlkchen entfernt. Missbrauch dieser Funktion wird geahndet."})]}),c.jsxs("div",{className:"flex gap-3",children:[c.jsx("button",{onClick:()=>U(null),className:"flex-1 py-3 px-4 bg-[var(--synclulu-bg)] text-[var(--synclulu-muted)] rounded-xl font-semibold border border-[var(--synclulu-border)]",children:"Abbrechen"}),c.jsxs("button",{onClick:()=>Ac(O),className:"flex-1 py-3 px-4 bg-red-500 text-white rounded-xl font-semibold flex items-center justify-center gap-2",children:[c.jsx(B5e,{size:18}),"Melden"]})]})]})}),(ye||un)&&m&&c.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-6 bg-black/50 backdrop-blur-sm",children:c.jsxs("div",{className:"w-full max-w-sm bg-[var(--synclulu-card)] rounded-3xl p-6 shadow-2xl border border-[var(--synclulu-border)] animate-pulse",children:[c.jsxs("div",{className:"text-center mb-6",children:[c.jsx("div",{className:"w-20 h-20 bg-amber-500/10 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce",children:c.jsx(rh,{size:40,className:"text-amber-500"})}),c.jsx("h2",{className:"font-display text-xl font-bold text-[var(--synclulu-text)] mb-2",children:"Bist du noch da? "}),c.jsx("p",{className:"text-sm text-[var(--synclulu-muted)] mb-4",children:"Du hast schon lnger nicht mehr gesprochen. Bitte besttige, dass du noch teilnimmst."}),ui>0&&c.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-red-500/10 text-red-500 rounded-full font-semibold",children:[c.jsx(Ua,{size:16}),"Auto-Kick in ",ui,"s"]})]}),c.jsxs("div",{className:"flex gap-3",children:[c.jsx("button",{onClick:()=>{ro(),Ze(!1)},className:"flex-1 py-3 px-4 bg-[var(--synclulu-bg)] text-[var(--synclulu-muted)] rounded-xl font-semibold border border-[var(--synclulu-border)]",children:"Verlassen"}),c.jsxs("button",{onClick:()=>{Ra(),Ze(!1)},className:"flex-1 py-3 px-4 bg-green-500 text-white rounded-xl font-semibold flex items-center justify-center gap-2",children:[c.jsx(pz,{size:18}),"Ich bin da!"]})]})]})}),m&&ri==="denied"&&c.jsx("div",{className:"fixed top-0 left-0 right-0 z-40 bg-amber-500 text-white px-4 py-3 safe-top",children:c.jsxs("div",{className:"flex items-center gap-3 max-w-md mx-auto",children:[c.jsx(SW,{size:20,className:"flex-shrink-0"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("p",{className:"font-semibold text-sm",children:"Mikrofon deaktiviert"}),c.jsx("p",{className:"text-xs opacity-90",children:"Du kannst zuhren, aber nicht sprechen. Aktiviere das Mikrofon in deinen Browser-Einstellungen."})]})]})})]})},e6e=3,t6e={animate:{scale:[1,1.15,1],opacity:[.4,.8,.4],transition:{duration:e6e,repeat:1/0,ease:"easeInOut"}}},n6e={animate:{y:[0,-40],opacity:[0,1,0],scale:[.5,1.2,.8],transition:{duration:2,repeat:1/0,repeatDelay:1,ease:"easeOut"}}},r6e="MIbamchs82Ve7y0ecX2TpPyymbw1",Yse=2;function $se(t,e,r,a){const u=(r-t)*Math.PI/180,p=(a-e)*Math.PI/180,m=Math.sin(u/2)*Math.sin(u/2)+Math.cos(t*Math.PI/180)*Math.cos(r*Math.PI/180)*Math.sin(p/2)*Math.sin(p/2);return 6371e3*(2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)))}function Xse(t){return t<100?`${Math.round(t)}m`:t<1e3?`${Math.round(t/10)*10}m`:`${(t/1e3).toFixed(1)}km`}const i6e=({onFriendClick:t,onRoomClick:e,userLocation:r})=>{const{user:a}=Jr(),[l,u]=V.useState([]),[p,m]=V.useState([]),[v,w]=V.useState(!1),R=(a==null?void 0:a.id)===r6e;if(V.useEffect(()=>{if(!(a!=null&&a.id)||!r){w(!1);return}const A=mn(De,"friendships"),O=Mr(A,Kn("users","array-contains",a.id)),U=na(O,async H=>{var ne,te;const X=[];for(const he of H.docs){const Q=he.data().users.find(ce=>ce!==a.id);if(Q)try{const ce=await Bn(tt(De,"users",Q));if(!ce.exists())continue;const de=ce.data(),pe=de.lastLocation;let be=1/0;if(pe!=null&&pe.latitude&&(pe!=null&&pe.longitude)&&(be=$se(r.latitude,r.longitude,pe.latitude,pe.longitude)),be<=Yse*1e3||R){const ye=de.isActive&&((ne=de.lastSeen)==null?void 0:ne.toDate())>new Date(Date.now()-3e5);X.push({id:Q,username:de.username||"unknown",displayName:de.displayName||de.username||"Unbekannt",avatarUrl:de.avatarUrl,distance:be,isOnline:ye,inRoom:!!de.currentRoomId,roomId:de.currentRoomId,roomName:de.currentRoomName,lastSeen:(te=de.lastSeen)==null?void 0:te.toDate(),sanctuaryScore:de.sanctuaryScore||50})}}catch(ce){console.error("Error fetching friend data:",ce)}}X.sort((he,J)=>he.distance-J.distance),u(X)}),F=mn(De,"rooms"),q=Mr(F,Kn("isActive","==",!0),ih("createdAt","desc"),up(20)),W=na(q,H=>{const X=[];for(const ne of H.docs){const te=ne.data(),he=te.location;let J=1/0;if(he!=null&&he.latitude&&(he!=null&&he.longitude)&&(J=$se(r.latitude,r.longitude,he.latitude,he.longitude)),J<=Yse*1e3||R){const Q=te.participants||[],ce=l.map(pe=>pe.id),de=Q.some(pe=>ce.includes(pe.oderId));X.push({id:ne.id,name:te.name||"Wlkchen",participantCount:Q.length,distance:J,isAnonymous:te.isAnonymous||!1,hasFreund:de})}}X.sort((ne,te)=>ne.distance-te.distance),m(X),w(!1)});return()=>{U(),W()}},[a==null?void 0:a.id,r,R]),!r)return c.jsx("div",{className:"w-full border-b border-white/5 bg-gradient-to-b from-[#0a0a0a] to-transparent",children:c.jsx("div",{className:"px-4 py-4",children:c.jsxs("div",{className:"flex items-center justify-center gap-2 py-3 rounded-xl bg-white/5",children:[c.jsx(no,{size:14,className:"text-white/30"}),c.jsx("span",{className:"text-xs text-white/40",children:"Standort wird bentigt"})]})})});const C=l.length===0&&p.length===0;return c.jsxs("div",{className:"w-full border-b border-white/5 bg-gradient-to-b from-[#0a0a0a] to-transparent",children:[c.jsxs("div",{className:"px-4 pt-4 pb-2 flex items-center justify-between",children:[c.jsxs("h3",{className:"text-white/50 text-xs font-bold uppercase tracking-widest flex items-center gap-2",children:[c.jsxs("div",{className:"relative",children:[c.jsx(no,{size:14,className:"text-purple-400"}),!C&&c.jsx("div",{className:"absolute -top-0.5 -right-0.5 w-2 h-2 bg-green-400 rounded-full animate-pulse"})]}),"Vibe Radar"]}),R&&c.jsxs("span",{className:"text-[10px] text-purple-400/50 flex items-center gap-1",children:[c.jsx(kn,{size:10}),"Ghost View"]})]}),C?c.jsx("div",{className:"px-4 pb-4",children:c.jsxs(Ne.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center gap-3 py-3 px-4 rounded-xl bg-white/5 border border-white/5",children:[c.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-500/10 flex items-center justify-center",children:c.jsx(Yd,{size:18,className:"text-purple-400/50"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm text-white/60",children:"Niemand in der Nhe"}),c.jsx("p",{className:"text-[10px] text-white/30",children:"Freunde und Wlkchen werden hier angezeigt"})]})]})}):c.jsxs("div",{className:"flex gap-3 overflow-x-auto pb-4 px-4 no-scrollbar",children:[c.jsx(Ur,{mode:"popLayout",children:p.map(A=>c.jsxs(Ne.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},onClick:()=>e==null?void 0:e(A.id),className:"flex-shrink-0 flex flex-col items-center gap-1.5 group",children:[c.jsxs("div",{className:"relative",children:[c.jsxs("div",{className:`
                  p-3 rounded-2xl border-2 transition-all
                  ${A.hasFreund?"bg-purple-500/20 border-purple-500 shadow-[0_0_20px_rgba(139,92,246,0.3)]":"bg-white/5 border-white/10 group-hover:border-purple-500/50"}
                `,children:[c.jsx(Xo,{size:24,className:`
                    ${A.hasFreund?"text-purple-400":"text-white/60"}
                  `}),c.jsx("div",{className:"absolute -bottom-1 -right-1 px-1.5 py-0.5 bg-purple-500 rounded-full",children:c.jsx("span",{className:"text-[10px] font-bold text-white",children:A.participantCount})})]}),A.hasFreund&&c.jsx("div",{className:"absolute inset-0 rounded-2xl border-2 border-purple-500 animate-ping opacity-30"})]}),c.jsx("span",{className:"text-[10px] text-white/70 font-medium max-w-[60px] truncate",children:A.name}),c.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded-full bg-white/5 text-white/40",children:Xse(A.distance)})]},`room-${A.id}`))}),p.length>0&&l.length>0&&c.jsx("div",{className:"flex-shrink-0 w-px bg-white/10 mx-1 self-stretch"}),c.jsx(Ur,{mode:"popLayout",children:l.map((A,O)=>{const F=(A.sanctuaryScore||50)/100>.7,q=A.inRoom?"rgba(139, 92, 246, 0.4)":F?"rgba(250, 204, 21, 0.3)":"rgba(34, 197, 94, 0.3)";return c.jsxs(Ne.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},onClick:()=>t==null?void 0:t(A.id),className:"flex-shrink-0 flex flex-col items-center gap-1.5 group",style:{transform:`translateX(${O*2}px)`},children:[c.jsxs("div",{className:"relative",children:[A.inRoom&&c.jsx(Ne.div,{className:"absolute -inset-1 rounded-full blur-sm",style:{backgroundColor:q},variants:t6e,animate:"animate"}),F&&A.isOnline&&c.jsx(c.Fragment,{children:[...Array(3)].map((W,H)=>c.jsx(Ne.div,{className:"absolute text-[8px] pointer-events-none",style:{left:`${30+H*15}%`,top:"0"},variants:n6e,animate:"animate",transition:{delay:H*.5},children:""},`dust-${H}`))}),c.jsxs("div",{className:`
                    relative p-0.5 rounded-full border-2 transition-all
                    ${A.inRoom?"border-purple-500 shadow-[0_0_20px_rgba(139,92,246,0.5)]":A.isOnline?F?"border-yellow-400 shadow-[0_0_15px_rgba(250,204,21,0.3)]":"border-green-400":"border-white/10"}
                  `,children:[A.avatarUrl?c.jsx("img",{src:A.avatarUrl,alt:A.displayName,className:"w-12 h-12 rounded-full object-cover"}):c.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center",children:c.jsx("span",{className:"text-white font-bold text-sm",children:A.displayName.slice(0,2).toUpperCase()})}),A.inRoom&&c.jsx(Ne.div,{className:"absolute -bottom-1 -right-1 p-1 bg-purple-500 rounded-full",animate:{scale:[1,1.2,1],boxShadow:["0 0 0 0 rgba(139, 92, 246, 0.4)","0 0 0 8px rgba(139, 92, 246, 0)","0 0 0 0 rgba(139, 92, 246, 0)"]},transition:{duration:2,repeat:1/0},children:c.jsx(Epe,{size:10,className:"text-white"})}),!A.inRoom&&A.isOnline&&c.jsx("div",{className:`
                        absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-[#0a0a0a]
                        ${F?"bg-yellow-400 shadow-[0_0_8px_rgba(250,204,21,0.5)]":"bg-green-400"}
                      `})]})]}),c.jsx("span",{className:`
                  text-[10px] font-medium max-w-[60px] truncate
                  ${F&&A.isOnline?"text-yellow-300":"text-white/70"}
                `,children:A.displayName.split(" ")[0]}),c.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded-full bg-white/5 text-white/40",children:Xse(A.distance)}),A.inRoom&&A.roomName&&c.jsxs("span",{className:"text-[8px] text-purple-400/80 max-w-[60px] truncate flex items-center gap-1",children:[c.jsx(Yd,{size:8,className:"animate-pulse"}),A.roomName]})]},`friend-${A.id}`)})})]})]})};function Mme(t,e){const r=V.useRef(e);V.useEffect(function(){e!==r.current&&t.attributionControl!=null&&(r.current!=null&&t.attributionControl.removeAttribution(r.current),e!=null&&t.attributionControl.addAttribution(e)),r.current=e},[t,e])}function s6e(t,e,r){e.center!==r.center&&t.setLatLng(e.center),e.radius!=null&&e.radius!==r.radius&&t.setRadius(e.radius)}const a6e=1;function o6e(t){return Object.freeze({__version:a6e,map:t})}function Ume(t,e){return Object.freeze({...t,...e})}const s9=V.createContext(null);function XL(){const t=V.use(s9);if(t==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return t}function Vme(t){function e(r,a){const{instance:l,context:u}=t(r).current;V.useImperativeHandle(a,()=>l);const{children:p}=r;return p==null?null:Yb.createElement(s9,{value:u},p)}return V.forwardRef(e)}function c6e(t){function e(r,a){const[l,u]=V.useState(!1),{instance:p}=t(r,u).current;V.useImperativeHandle(a,()=>p),V.useEffect(function(){l&&p.update()},[p,l,r.children]);const m=p._contentNode;return m?Vce.createPortal(r.children,m):null}return V.forwardRef(e)}function l6e(t){function e(r,a){const{instance:l}=t(r).current;return V.useImperativeHandle(a,()=>l),null}return V.forwardRef(e)}function a9(t,e){const r=V.useRef(void 0);V.useEffect(function(){return e!=null&&t.instance.on(e),r.current=e,function(){r.current!=null&&t.instance.off(r.current),r.current=null}},[t,e])}function JL(t,e){const r=t.pane??e.pane;return r?{...t,pane:r}:t}function d6e(t,e){return function(a,l){const u=XL(),p=t(JL(a,u),u);return Mme(u.map,a.attribution),a9(p.current,a.eventHandlers),e(p.current,u,a,l),p}}var Bz={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(t,e){(function(r,a){a(e)})(_f,function(r){var a="1.9.4";function l(_){var S,P,G,ae;for(P=1,G=arguments.length;P<G;P++){ae=arguments[P];for(S in ae)_[S]=ae[S]}return _}var u=Object.create||function(){function _(){}return function(S){return _.prototype=S,new _}}();function p(_,S){var P=Array.prototype.slice;if(_.bind)return _.bind.apply(_,P.call(arguments,1));var G=P.call(arguments,2);return function(){return _.apply(S,G.length?G.concat(P.call(arguments)):arguments)}}var m=0;function v(_){return"_leaflet_id"in _||(_._leaflet_id=++m),_._leaflet_id}function w(_,S,P){var G,ae,ge,ke;return ke=function(){G=!1,ae&&(ge.apply(P,ae),ae=!1)},ge=function(){G?ae=arguments:(_.apply(P,arguments),setTimeout(ke,S),G=!0)},ge}function R(_,S,P){var G=S[1],ae=S[0],ge=G-ae;return _===G&&P?_:((_-ae)%ge+ge)%ge+ae}function C(){return!1}function A(_,S){if(S===!1)return _;var P=Math.pow(10,S===void 0?6:S);return Math.round(_*P)/P}function O(_){return _.trim?_.trim():_.replace(/^\s+|\s+$/g,"")}function U(_){return O(_).split(/\s+/)}function F(_,S){Object.prototype.hasOwnProperty.call(_,"options")||(_.options=_.options?u(_.options):{});for(var P in S)_.options[P]=S[P];return _.options}function q(_,S,P){var G=[];for(var ae in _)G.push(encodeURIComponent(P?ae.toUpperCase():ae)+"="+encodeURIComponent(_[ae]));return(!S||S.indexOf("?")===-1?"?":"&")+G.join("&")}var W=/\{ *([\w_ -]+) *\}/g;function H(_,S){return _.replace(W,function(P,G){var ae=S[G];if(ae===void 0)throw new Error("No value provided for variable "+P);return typeof ae=="function"&&(ae=ae(S)),ae})}var X=Array.isArray||function(_){return Object.prototype.toString.call(_)==="[object Array]"};function ne(_,S){for(var P=0;P<_.length;P++)if(_[P]===S)return P;return-1}var te="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function he(_){return window["webkit"+_]||window["moz"+_]||window["ms"+_]}var J=0;function Q(_){var S=+new Date,P=Math.max(0,16-(S-J));return J=S+P,window.setTimeout(_,P)}var ce=window.requestAnimationFrame||he("RequestAnimationFrame")||Q,de=window.cancelAnimationFrame||he("CancelAnimationFrame")||he("CancelRequestAnimationFrame")||function(_){window.clearTimeout(_)};function pe(_,S,P){if(P&&ce===Q)_.call(S);else return ce.call(window,p(_,S))}function be(_){_&&de.call(window,_)}var ye={__proto__:null,extend:l,create:u,bind:p,get lastId(){return m},stamp:v,throttle:w,wrapNum:R,falseFn:C,formatNum:A,trim:O,splitWords:U,setOptions:F,getParamString:q,template:H,isArray:X,indexOf:ne,emptyImageUrl:te,requestFn:ce,cancelFn:de,requestAnimFrame:pe,cancelAnimFrame:be};function Ze(){}Ze.extend=function(_){var S=function(){F(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},P=S.__super__=this.prototype,G=u(P);G.constructor=S,S.prototype=G;for(var ae in this)Object.prototype.hasOwnProperty.call(this,ae)&&ae!=="prototype"&&ae!=="__super__"&&(S[ae]=this[ae]);return _.statics&&l(S,_.statics),_.includes&&(It(_.includes),l.apply(null,[G].concat(_.includes))),l(G,_),delete G.statics,delete G.includes,G.options&&(G.options=P.options?u(P.options):{},l(G.options,_.options)),G._initHooks=[],G.callInitHooks=function(){if(!this._initHooksCalled){P.callInitHooks&&P.callInitHooks.call(this),this._initHooksCalled=!0;for(var ge=0,ke=G._initHooks.length;ge<ke;ge++)G._initHooks[ge].call(this)}},S},Ze.include=function(_){var S=this.prototype.options;return l(this.prototype,_),_.options&&(this.prototype.options=S,this.mergeOptions(_.options)),this},Ze.mergeOptions=function(_){return l(this.prototype.options,_),this},Ze.addInitHook=function(_){var S=Array.prototype.slice.call(arguments,1),P=typeof _=="function"?_:function(){this[_].apply(this,S)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(P),this};function It(_){if(!(typeof L>"u"||!L||!L.Mixin)){_=X(_)?_:[_];for(var S=0;S<_.length;S++)_[S]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var St={on:function(_,S,P){if(typeof _=="object")for(var G in _)this._on(G,_[G],S);else{_=U(_);for(var ae=0,ge=_.length;ae<ge;ae++)this._on(_[ae],S,P)}return this},off:function(_,S,P){if(!arguments.length)delete this._events;else if(typeof _=="object")for(var G in _)this._off(G,_[G],S);else{_=U(_);for(var ae=arguments.length===1,ge=0,ke=_.length;ge<ke;ge++)ae?this._off(_[ge]):this._off(_[ge],S,P)}return this},_on:function(_,S,P,G){if(typeof S!="function"){console.warn("wrong listener type: "+typeof S);return}if(this._listens(_,S,P)===!1){P===this&&(P=void 0);var ae={fn:S,ctx:P};G&&(ae.once=!0),this._events=this._events||{},this._events[_]=this._events[_]||[],this._events[_].push(ae)}},_off:function(_,S,P){var G,ae,ge;if(this._events&&(G=this._events[_],!!G)){if(arguments.length===1){if(this._firingCount)for(ae=0,ge=G.length;ae<ge;ae++)G[ae].fn=C;delete this._events[_];return}if(typeof S!="function"){console.warn("wrong listener type: "+typeof S);return}var ke=this._listens(_,S,P);if(ke!==!1){var Xe=G[ke];this._firingCount&&(Xe.fn=C,this._events[_]=G=G.slice()),G.splice(ke,1)}}},fire:function(_,S,P){if(!this.listens(_,P))return this;var G=l({},S,{type:_,target:this,sourceTarget:S&&S.sourceTarget||this});if(this._events){var ae=this._events[_];if(ae){this._firingCount=this._firingCount+1||1;for(var ge=0,ke=ae.length;ge<ke;ge++){var Xe=ae[ge],nt=Xe.fn;Xe.once&&this.off(_,nt,Xe.ctx),nt.call(Xe.ctx||this,G)}this._firingCount--}}return P&&this._propagateEvent(G),this},listens:function(_,S,P,G){typeof _!="string"&&console.warn('"string" type argument expected');var ae=S;typeof S!="function"&&(G=!!S,ae=void 0,P=void 0);var ge=this._events&&this._events[_];if(ge&&ge.length&&this._listens(_,ae,P)!==!1)return!0;if(G){for(var ke in this._eventParents)if(this._eventParents[ke].listens(_,S,P,G))return!0}return!1},_listens:function(_,S,P){if(!this._events)return!1;var G=this._events[_]||[];if(!S)return!!G.length;P===this&&(P=void 0);for(var ae=0,ge=G.length;ae<ge;ae++)if(G[ae].fn===S&&G[ae].ctx===P)return ae;return!1},once:function(_,S,P){if(typeof _=="object")for(var G in _)this._on(G,_[G],S,!0);else{_=U(_);for(var ae=0,ge=_.length;ae<ge;ae++)this._on(_[ae],S,P,!0)}return this},addEventParent:function(_){return this._eventParents=this._eventParents||{},this._eventParents[v(_)]=_,this},removeEventParent:function(_){return this._eventParents&&delete this._eventParents[v(_)],this},_propagateEvent:function(_){for(var S in this._eventParents)this._eventParents[S].fire(_.type,l({layer:_.target,propagatedFrom:_.target},_),!0)}};St.addEventListener=St.on,St.removeEventListener=St.clearAllEventListeners=St.off,St.addOneTimeEventListener=St.once,St.fireEvent=St.fire,St.hasEventListeners=St.listens;var lt=Ze.extend(St);function Le(_,S,P){this.x=P?Math.round(_):_,this.y=P?Math.round(S):S}var Me=Math.trunc||function(_){return _>0?Math.floor(_):Math.ceil(_)};Le.prototype={clone:function(){return new Le(this.x,this.y)},add:function(_){return this.clone()._add(Ke(_))},_add:function(_){return this.x+=_.x,this.y+=_.y,this},subtract:function(_){return this.clone()._subtract(Ke(_))},_subtract:function(_){return this.x-=_.x,this.y-=_.y,this},divideBy:function(_){return this.clone()._divideBy(_)},_divideBy:function(_){return this.x/=_,this.y/=_,this},multiplyBy:function(_){return this.clone()._multiplyBy(_)},_multiplyBy:function(_){return this.x*=_,this.y*=_,this},scaleBy:function(_){return new Le(this.x*_.x,this.y*_.y)},unscaleBy:function(_){return new Le(this.x/_.x,this.y/_.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=Me(this.x),this.y=Me(this.y),this},distanceTo:function(_){_=Ke(_);var S=_.x-this.x,P=_.y-this.y;return Math.sqrt(S*S+P*P)},equals:function(_){return _=Ke(_),_.x===this.x&&_.y===this.y},contains:function(_){return _=Ke(_),Math.abs(_.x)<=Math.abs(this.x)&&Math.abs(_.y)<=Math.abs(this.y)},toString:function(){return"Point("+A(this.x)+", "+A(this.y)+")"}};function Ke(_,S,P){return _ instanceof Le?_:X(_)?new Le(_[0],_[1]):_==null?_:typeof _=="object"&&"x"in _&&"y"in _?new Le(_.x,_.y):new Le(_,S,P)}function Rt(_,S){if(_)for(var P=S?[_,S]:_,G=0,ae=P.length;G<ae;G++)this.extend(P[G])}Rt.prototype={extend:function(_){var S,P;if(!_)return this;if(_ instanceof Le||typeof _[0]=="number"||"x"in _)S=P=Ke(_);else if(_=rt(_),S=_.min,P=_.max,!S||!P)return this;return!this.min&&!this.max?(this.min=S.clone(),this.max=P.clone()):(this.min.x=Math.min(S.x,this.min.x),this.max.x=Math.max(P.x,this.max.x),this.min.y=Math.min(S.y,this.min.y),this.max.y=Math.max(P.y,this.max.y)),this},getCenter:function(_){return Ke((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,_)},getBottomLeft:function(){return Ke(this.min.x,this.max.y)},getTopRight:function(){return Ke(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(_){var S,P;return typeof _[0]=="number"||_ instanceof Le?_=Ke(_):_=rt(_),_ instanceof Rt?(S=_.min,P=_.max):S=P=_,S.x>=this.min.x&&P.x<=this.max.x&&S.y>=this.min.y&&P.y<=this.max.y},intersects:function(_){_=rt(_);var S=this.min,P=this.max,G=_.min,ae=_.max,ge=ae.x>=S.x&&G.x<=P.x,ke=ae.y>=S.y&&G.y<=P.y;return ge&&ke},overlaps:function(_){_=rt(_);var S=this.min,P=this.max,G=_.min,ae=_.max,ge=ae.x>S.x&&G.x<P.x,ke=ae.y>S.y&&G.y<P.y;return ge&&ke},isValid:function(){return!!(this.min&&this.max)},pad:function(_){var S=this.min,P=this.max,G=Math.abs(S.x-P.x)*_,ae=Math.abs(S.y-P.y)*_;return rt(Ke(S.x-G,S.y-ae),Ke(P.x+G,P.y+ae))},equals:function(_){return _?(_=rt(_),this.min.equals(_.getTopLeft())&&this.max.equals(_.getBottomRight())):!1}};function rt(_,S){return!_||_ instanceof Rt?_:new Rt(_,S)}function mt(_,S){if(_)for(var P=S?[_,S]:_,G=0,ae=P.length;G<ae;G++)this.extend(P[G])}mt.prototype={extend:function(_){var S=this._southWest,P=this._northEast,G,ae;if(_ instanceof Ct)G=_,ae=_;else if(_ instanceof mt){if(G=_._southWest,ae=_._northEast,!G||!ae)return this}else return _?this.extend(Ot(_)||yt(_)):this;return!S&&!P?(this._southWest=new Ct(G.lat,G.lng),this._northEast=new Ct(ae.lat,ae.lng)):(S.lat=Math.min(G.lat,S.lat),S.lng=Math.min(G.lng,S.lng),P.lat=Math.max(ae.lat,P.lat),P.lng=Math.max(ae.lng,P.lng)),this},pad:function(_){var S=this._southWest,P=this._northEast,G=Math.abs(S.lat-P.lat)*_,ae=Math.abs(S.lng-P.lng)*_;return new mt(new Ct(S.lat-G,S.lng-ae),new Ct(P.lat+G,P.lng+ae))},getCenter:function(){return new Ct((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Ct(this.getNorth(),this.getWest())},getSouthEast:function(){return new Ct(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(_){typeof _[0]=="number"||_ instanceof Ct||"lat"in _?_=Ot(_):_=yt(_);var S=this._southWest,P=this._northEast,G,ae;return _ instanceof mt?(G=_.getSouthWest(),ae=_.getNorthEast()):G=ae=_,G.lat>=S.lat&&ae.lat<=P.lat&&G.lng>=S.lng&&ae.lng<=P.lng},intersects:function(_){_=yt(_);var S=this._southWest,P=this._northEast,G=_.getSouthWest(),ae=_.getNorthEast(),ge=ae.lat>=S.lat&&G.lat<=P.lat,ke=ae.lng>=S.lng&&G.lng<=P.lng;return ge&&ke},overlaps:function(_){_=yt(_);var S=this._southWest,P=this._northEast,G=_.getSouthWest(),ae=_.getNorthEast(),ge=ae.lat>S.lat&&G.lat<P.lat,ke=ae.lng>S.lng&&G.lng<P.lng;return ge&&ke},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(_,S){return _?(_=yt(_),this._southWest.equals(_.getSouthWest(),S)&&this._northEast.equals(_.getNorthEast(),S)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function yt(_,S){return _ instanceof mt?_:new mt(_,S)}function Ct(_,S,P){if(isNaN(_)||isNaN(S))throw new Error("Invalid LatLng object: ("+_+", "+S+")");this.lat=+_,this.lng=+S,P!==void 0&&(this.alt=+P)}Ct.prototype={equals:function(_,S){if(!_)return!1;_=Ot(_);var P=Math.max(Math.abs(this.lat-_.lat),Math.abs(this.lng-_.lng));return P<=(S===void 0?1e-9:S)},toString:function(_){return"LatLng("+A(this.lat,_)+", "+A(this.lng,_)+")"},distanceTo:function(_){return zt.distance(this,Ot(_))},wrap:function(){return zt.wrapLatLng(this)},toBounds:function(_){var S=180*_/40075017,P=S/Math.cos(Math.PI/180*this.lat);return yt([this.lat-S,this.lng-P],[this.lat+S,this.lng+P])},clone:function(){return new Ct(this.lat,this.lng,this.alt)}};function Ot(_,S,P){return _ instanceof Ct?_:X(_)&&typeof _[0]!="object"?_.length===3?new Ct(_[0],_[1],_[2]):_.length===2?new Ct(_[0],_[1]):null:_==null?_:typeof _=="object"&&"lat"in _?new Ct(_.lat,"lng"in _?_.lng:_.lon,_.alt):S===void 0?null:new Ct(_,S,P)}var vt={latLngToPoint:function(_,S){var P=this.projection.project(_),G=this.scale(S);return this.transformation._transform(P,G)},pointToLatLng:function(_,S){var P=this.scale(S),G=this.transformation.untransform(_,P);return this.projection.unproject(G)},project:function(_){return this.projection.project(_)},unproject:function(_){return this.projection.unproject(_)},scale:function(_){return 256*Math.pow(2,_)},zoom:function(_){return Math.log(_/256)/Math.LN2},getProjectedBounds:function(_){if(this.infinite)return null;var S=this.projection.bounds,P=this.scale(_),G=this.transformation.transform(S.min,P),ae=this.transformation.transform(S.max,P);return new Rt(G,ae)},infinite:!1,wrapLatLng:function(_){var S=this.wrapLng?R(_.lng,this.wrapLng,!0):_.lng,P=this.wrapLat?R(_.lat,this.wrapLat,!0):_.lat,G=_.alt;return new Ct(P,S,G)},wrapLatLngBounds:function(_){var S=_.getCenter(),P=this.wrapLatLng(S),G=S.lat-P.lat,ae=S.lng-P.lng;if(G===0&&ae===0)return _;var ge=_.getSouthWest(),ke=_.getNorthEast(),Xe=new Ct(ge.lat-G,ge.lng-ae),nt=new Ct(ke.lat-G,ke.lng-ae);return new mt(Xe,nt)}},zt=l({},vt,{wrapLng:[-180,180],R:6371e3,distance:function(_,S){var P=Math.PI/180,G=_.lat*P,ae=S.lat*P,ge=Math.sin((S.lat-_.lat)*P/2),ke=Math.sin((S.lng-_.lng)*P/2),Xe=ge*ge+Math.cos(G)*Math.cos(ae)*ke*ke,nt=2*Math.atan2(Math.sqrt(Xe),Math.sqrt(1-Xe));return this.R*nt}}),ln=6378137,Pn={R:ln,MAX_LATITUDE:85.0511287798,project:function(_){var S=Math.PI/180,P=this.MAX_LATITUDE,G=Math.max(Math.min(P,_.lat),-P),ae=Math.sin(G*S);return new Le(this.R*_.lng*S,this.R*Math.log((1+ae)/(1-ae))/2)},unproject:function(_){var S=180/Math.PI;return new Ct((2*Math.atan(Math.exp(_.y/this.R))-Math.PI/2)*S,_.x*S/this.R)},bounds:function(){var _=ln*Math.PI;return new Rt([-_,-_],[_,_])}()};function ni(_,S,P,G){if(X(_)){this._a=_[0],this._b=_[1],this._c=_[2],this._d=_[3];return}this._a=_,this._b=S,this._c=P,this._d=G}ni.prototype={transform:function(_,S){return this._transform(_.clone(),S)},_transform:function(_,S){return S=S||1,_.x=S*(this._a*_.x+this._b),_.y=S*(this._c*_.y+this._d),_},untransform:function(_,S){return S=S||1,new Le((_.x/S-this._b)/this._a,(_.y/S-this._d)/this._c)}};function pr(_,S,P,G){return new ni(_,S,P,G)}var nn=l({},zt,{code:"EPSG:3857",projection:Pn,transformation:function(){var _=.5/(Math.PI*Pn.R);return pr(_,.5,-_,.5)}()}),ri=l({},nn,{code:"EPSG:900913"});function un(_){return document.createElementNS("http://www.w3.org/2000/svg",_)}function ui(_,S){var P="",G,ae,ge,ke,Xe,nt;for(G=0,ge=_.length;G<ge;G++){for(Xe=_[G],ae=0,ke=Xe.length;ae<ke;ae++)nt=Xe[ae],P+=(ae?"L":"M")+nt.x+" "+nt.y;P+=S?vn.svg?"z":"x":""}return P||"M0 0"}var Cs=document.documentElement.style,Jn="ActiveXObject"in window,ds=Jn&&!document.addEventListener,Ra="msLaunchUri"in navigator&&!("documentMode"in document),us=tc("webkit"),ro=tc("android"),Fa=tc("android 2")||tc("android 3"),hi=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),So=ro&&tc("Google")&&hi<537&&!("AudioNode"in window),Ri=!!window.opera,Gr=!Ra&&tc("chrome"),Ca=tc("gecko")&&!us&&!Ri&&!Jn,Ac=!Gr&&tc("safari"),kc=tc("phantom"),Pc="OTransition"in Cs,Ba=navigator.platform.indexOf("Win")===0,Dc=Jn&&"transition"in Cs,ia="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Fa,Lt="MozPerspective"in Cs,Ir=!window.L_DISABLE_3D&&(Dc||ia||Lt)&&!Pc&&!kc,We=typeof orientation<"u"||tc("mobile"),$t=We&&us,tr=We&&ia,mi=!window.PointerEvent&&window.MSPointerEvent,Wr=!!(window.PointerEvent||mi),Nn="ontouchstart"in window||!!window.TouchEvent,Ci=!window.L_NO_TOUCH&&(Nn||Wr),Ar=We&&Ri,lr=We&&Ca,Qi=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,sh=function(){var _=!1;try{var S=Object.defineProperty({},"passive",{get:function(){_=!0}});window.addEventListener("testPassiveEventSupport",C,S),window.removeEventListener("testPassiveEventSupport",C,S)}catch{}return _}(),ol=function(){return!!document.createElement("canvas").getContext}(),pp=!!(document.createElementNS&&un("svg").createSVGRect),gi=!!pp&&function(){var _=document.createElement("div");return _.innerHTML="<svg/>",(_.firstChild&&_.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),fp=!pp&&function(){try{var _=document.createElement("div");_.innerHTML='<v:shape adj="1"/>';var S=_.firstChild;return S.style.behavior="url(#default#VML)",S&&typeof S.adj=="object"}catch{return!1}}(),ah=navigator.platform.indexOf("Mac")===0,ec=navigator.platform.indexOf("Linux")===0;function tc(_){return navigator.userAgent.toLowerCase().indexOf(_)>=0}var vn={ie:Jn,ielt9:ds,edge:Ra,webkit:us,android:ro,android23:Fa,androidStock:So,opera:Ri,chrome:Gr,gecko:Ca,safari:Ac,phantom:kc,opera12:Pc,win:Ba,ie3d:Dc,webkit3d:ia,gecko3d:Lt,any3d:Ir,mobile:We,mobileWebkit:$t,mobileWebkit3d:tr,msPointer:mi,pointer:Wr,touch:Ci,touchNative:Nn,mobileOpera:Ar,mobileGecko:lr,retina:Qi,passiveEvents:sh,canvas:ol,svg:pp,vml:fp,inlineSvg:gi,mac:ah,linux:ec},Ll=vn.msPointer?"MSPointerDown":"pointerdown",og=vn.msPointer?"MSPointerMove":"pointermove",Of=vn.msPointer?"MSPointerUp":"pointerup",nu=vn.msPointer?"MSPointerCancel":"pointercancel",mp={touchstart:Ll,touchmove:og,touchend:Of,touchcancel:nu},gp={touchstart:gd,touchmove:io,touchend:io,touchcancel:io},Oc={},Lc=!1;function Lf(_,S,P){return S==="touchstart"&&oh(),gp[S]?(P=gp[S].bind(this,P),_.addEventListener(mp[S],P,!1),P):(console.warn("wrong event specified:",S),C)}function _p(_,S,P){if(!mp[S]){console.warn("wrong event specified:",S);return}_.removeEventListener(mp[S],P,!1)}function yp(_){Oc[_.pointerId]=_}function jl(_){Oc[_.pointerId]&&(Oc[_.pointerId]=_)}function jf(_){delete Oc[_.pointerId]}function oh(){Lc||(document.addEventListener(Ll,yp,!0),document.addEventListener(og,jl,!0),document.addEventListener(Of,jf,!0),document.addEventListener(nu,jf,!0),Lc=!0)}function io(_,S){if(S.pointerType!==(S.MSPOINTER_TYPE_MOUSE||"mouse")){S.touches=[];for(var P in Oc)S.touches.push(Oc[P]);S.changedTouches=[S],_(S)}}function gd(_,S){S.MSPOINTER_TYPE_TOUCH&&S.pointerType===S.MSPOINTER_TYPE_TOUCH&&Yn(S),io(_,S)}function cg(_){var S={},P,G;for(G in _)P=_[G],S[G]=P&&P.bind?P.bind(_):P;return _=S,S.type="dblclick",S.detail=2,S.isTrusted=!1,S._simulated=!0,S}var Zi=200;function ch(_,S){_.addEventListener("dblclick",S);var P=0,G;function ae(ge){if(ge.detail!==1){G=ge.detail;return}if(!(ge.pointerType==="mouse"||ge.sourceCapabilities&&!ge.sourceCapabilities.firesTouchEvents)){var ke=zf(ge);if(!(ke.some(function(nt){return nt instanceof HTMLLabelElement&&nt.attributes.for})&&!ke.some(function(nt){return nt instanceof HTMLInputElement||nt instanceof HTMLSelectElement}))){var Xe=Date.now();Xe-P<=Zi?(G++,G===2&&S(cg(ge))):G=1,P=Xe}}}return _.addEventListener("click",ae),{dblclick:S,simDblclick:ae}}function Ml(_,S){_.removeEventListener("dblclick",S.dblclick),_.removeEventListener("click",S.simDblclick)}var ru=cl(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),iu=cl(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),lh=iu==="webkitTransition"||iu==="OTransition"?iu+"End":"transitionend";function Mf(_){return typeof _=="string"?document.getElementById(_):_}function _d(_,S){var P=_.style[S]||_.currentStyle&&_.currentStyle[S];if((!P||P==="auto")&&document.defaultView){var G=document.defaultView.getComputedStyle(_,null);P=G?G[S]:null}return P==="auto"?null:P}function Vr(_,S,P){var G=document.createElement(_);return G.className=S||"",P&&P.appendChild(G),G}function Ni(_){var S=_.parentNode;S&&S.removeChild(_)}function su(_){for(;_.firstChild;)_.removeChild(_.firstChild)}function so(_){var S=_.parentNode;S&&S.lastChild!==_&&S.appendChild(_)}function jc(_){var S=_.parentNode;S&&S.firstChild!==_&&S.insertBefore(_,S.firstChild)}function Uf(_,S){if(_.classList!==void 0)return _.classList.contains(S);var P=nc(_);return P.length>0&&new RegExp("(^|\\s)"+S+"(\\s|$)").test(P)}function Zt(_,S){if(_.classList!==void 0)for(var P=U(S),G=0,ae=P.length;G<ae;G++)_.classList.add(P[G]);else if(!Uf(_,S)){var ge=nc(_);dh(_,(ge?ge+" ":"")+S)}}function Oi(_,S){_.classList!==void 0?_.classList.remove(S):dh(_,O((" "+nc(_)+" ").replace(" "+S+" "," ")))}function dh(_,S){_.className.baseVal===void 0?_.className=S:_.className.baseVal=S}function nc(_){return _.correspondingElement&&(_=_.correspondingElement),_.className.baseVal===void 0?_.className:_.className.baseVal}function hs(_,S){"opacity"in _.style?_.style.opacity=S:"filter"in _.style&&uh(_,S)}function uh(_,S){var P=!1,G="DXImageTransform.Microsoft.Alpha";try{P=_.filters.item(G)}catch{if(S===1)return}S=Math.round(S*100),P?(P.Enabled=S!==100,P.Opacity=S):_.style.filter+=" progid:"+G+"(opacity="+S+")"}function cl(_){for(var S=document.documentElement.style,P=0;P<_.length;P++)if(_[P]in S)return _[P];return!1}function Ul(_,S,P){var G=S||new Le(0,0);_.style[ru]=(vn.ie3d?"translate("+G.x+"px,"+G.y+"px)":"translate3d("+G.x+"px,"+G.y+"px,0)")+(P?" scale("+P+")":"")}function qn(_,S){_._leaflet_pos=S,vn.any3d?Ul(_,S):(_.style.left=S.x+"px",_.style.top=S.y+"px")}function To(_){return _._leaflet_pos||new Le(0,0)}var ao,Na,au;if("onselectstart"in document)ao=function(){Dn(window,"selectstart",Yn)},Na=function(){Ei(window,"selectstart",Yn)};else{var yd=cl(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);ao=function(){if(yd){var _=document.documentElement.style;au=_[yd],_[yd]="none"}},Na=function(){yd&&(document.documentElement.style[yd]=au,au=void 0)}}function hh(){Dn(window,"dragstart",Yn)}function vp(){Ei(window,"dragstart",Yn)}var ou,Ep;function Vl(_){for(;_.tabIndex===-1;)_=_.parentNode;_.style&&(rc(),ou=_,Ep=_.style.outlineStyle,_.style.outlineStyle="none",Dn(window,"keydown",rc))}function rc(){ou&&(ou.style.outlineStyle=Ep,ou=void 0,Ep=void 0,Ei(window,"keydown",rc))}function Vf(_){do _=_.parentNode;while((!_.offsetWidth||!_.offsetHeight)&&_!==document.body);return _}function xp(_){var S=_.getBoundingClientRect();return{x:S.width/_.offsetWidth||1,y:S.height/_.offsetHeight||1,boundingClientRect:S}}var Ff={__proto__:null,TRANSFORM:ru,TRANSITION:iu,TRANSITION_END:lh,get:Mf,getStyle:_d,create:Vr,remove:Ni,empty:su,toFront:so,toBack:jc,hasClass:Uf,addClass:Zt,removeClass:Oi,setClass:dh,getClass:nc,setOpacity:hs,testProp:cl,setTransform:Ul,setPosition:qn,getPosition:To,get disableTextSelection(){return ao},get enableTextSelection(){return Na},disableImageDrag:hh,enableImageDrag:vp,preventOutline:Vl,restoreOutline:rc,getSizedParentNode:Vf,getScale:xp};function Dn(_,S,P,G){if(S&&typeof S=="object")for(var ae in S)Bf(_,ae,S[ae],P);else{S=U(S);for(var ge=0,ke=S.length;ge<ke;ge++)Bf(_,S[ge],P,G)}return this}var Mc="_leaflet_events";function Ei(_,S,P,G){if(arguments.length===1)lg(_),delete _[Mc];else if(S&&typeof S=="object")for(var ae in S)vd(_,ae,S[ae],P);else if(S=U(S),arguments.length===2)lg(_,function(Xe){return ne(S,Xe)!==-1});else for(var ge=0,ke=S.length;ge<ke;ge++)vd(_,S[ge],P,G);return this}function lg(_,S){for(var P in _[Mc]){var G=P.split(/\d/)[0];(!S||S(G))&&vd(_,G,null,null,P)}}var Ro={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Bf(_,S,P,G){var ae=S+v(P)+(G?"_"+v(G):"");if(_[Mc]&&_[Mc][ae])return this;var ge=function(Xe){return P.call(G||_,Xe||window.event)},ke=ge;!vn.touchNative&&vn.pointer&&S.indexOf("touch")===0?ge=Lf(_,S,ge):vn.touch&&S==="dblclick"?ge=ch(_,ge):"addEventListener"in _?S==="touchstart"||S==="touchmove"||S==="wheel"||S==="mousewheel"?_.addEventListener(Ro[S]||S,ge,vn.passiveEvents?{passive:!1}:!1):S==="mouseenter"||S==="mouseleave"?(ge=function(Xe){Xe=Xe||window.event,za(_,Xe)&&ke(Xe)},_.addEventListener(Ro[S],ge,!1)):_.addEventListener(S,ke,!1):_.attachEvent("on"+S,ge),_[Mc]=_[Mc]||{},_[Mc][ae]=ge}function vd(_,S,P,G,ae){ae=ae||S+v(P)+(G?"_"+v(G):"");var ge=_[Mc]&&_[Mc][ae];if(!ge)return this;!vn.touchNative&&vn.pointer&&S.indexOf("touch")===0?_p(_,S,ge):vn.touch&&S==="dblclick"?Ml(_,ge):"removeEventListener"in _?_.removeEventListener(Ro[S]||S,ge,!1):_.detachEvent("on"+S,ge),_[Mc][ae]=null}function Uc(_){return _.stopPropagation?_.stopPropagation():_.originalEvent?_.originalEvent._stopped=!0:_.cancelBubble=!0,this}function cu(_){return Bf(_,"wheel",Uc),this}function lu(_){return Dn(_,"mousedown touchstart dblclick contextmenu",Uc),_._leaflet_disable_click=!0,this}function Yn(_){return _.preventDefault?_.preventDefault():_.returnValue=!1,this}function vr(_){return Yn(_),Uc(_),this}function zf(_){if(_.composedPath)return _.composedPath();for(var S=[],P=_.target;P;)S.push(P),P=P.parentNode;return S}function bp(_,S){if(!S)return new Le(_.clientX,_.clientY);var P=xp(S),G=P.boundingClientRect;return new Le((_.clientX-G.left)/P.x-S.clientLeft,(_.clientY-G.top)/P.y-S.clientTop)}var es=vn.linux&&vn.chrome?window.devicePixelRatio:vn.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function ll(_){return vn.edge?_.wheelDeltaY/2:_.deltaY&&_.deltaMode===0?-_.deltaY/es:_.deltaY&&_.deltaMode===1?-_.deltaY*20:_.deltaY&&_.deltaMode===2?-_.deltaY*60:_.deltaX||_.deltaZ?0:_.wheelDelta?(_.wheelDeltaY||_.wheelDelta)/2:_.detail&&Math.abs(_.detail)<32765?-_.detail*20:_.detail?_.detail/-32765*60:0}function za(_,S){var P=S.relatedTarget;if(!P)return!0;try{for(;P&&P!==_;)P=P.parentNode}catch{return!1}return P!==_}var Gf={__proto__:null,on:Dn,off:Ei,stopPropagation:Uc,disableScrollPropagation:cu,disableClickPropagation:lu,preventDefault:Yn,stop:vr,getPropagationPath:zf,getMousePosition:bp,getWheelDelta:ll,isExternalTarget:za,addListener:Dn,removeListener:Ei},wp=lt.extend({run:function(_,S,P,G){this.stop(),this._el=_,this._inProgress=!0,this._duration=P||.25,this._easeOutPower=1/Math.max(G||.5,.2),this._startPos=To(_),this._offset=S.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=pe(this._animate,this),this._step()},_step:function(_){var S=+new Date-this._startTime,P=this._duration*1e3;S<P?this._runFrame(this._easeOut(S/P),_):(this._runFrame(1),this._complete())},_runFrame:function(_,S){var P=this._startPos.add(this._offset.multiplyBy(_));S&&P._round(),qn(this._el,P),this.fire("step")},_complete:function(){be(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(_){return 1-Math.pow(1-_,this._easeOutPower)}}),kr=lt.extend({options:{crs:nn,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(_,S){S=F(this,S),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(_),this._initLayout(),this._onResize=p(this._onResize,this),this._initEvents(),S.maxBounds&&this.setMaxBounds(S.maxBounds),S.zoom!==void 0&&(this._zoom=this._limitZoom(S.zoom)),S.center&&S.zoom!==void 0&&this.setView(Ot(S.center),S.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=iu&&vn.any3d&&!vn.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Dn(this._proxy,lh,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(_,S,P){if(S=S===void 0?this._zoom:this._limitZoom(S),_=this._limitCenter(Ot(_),S,this.options.maxBounds),P=P||{},this._stop(),this._loaded&&!P.reset&&P!==!0){P.animate!==void 0&&(P.zoom=l({animate:P.animate},P.zoom),P.pan=l({animate:P.animate,duration:P.duration},P.pan));var G=this._zoom!==S?this._tryAnimatedZoom&&this._tryAnimatedZoom(_,S,P.zoom):this._tryAnimatedPan(_,P.pan);if(G)return clearTimeout(this._sizeTimer),this}return this._resetView(_,S,P.pan&&P.pan.noMoveStart),this},setZoom:function(_,S){return this._loaded?this.setView(this.getCenter(),_,{zoom:S}):(this._zoom=_,this)},zoomIn:function(_,S){return _=_||(vn.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+_,S)},zoomOut:function(_,S){return _=_||(vn.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-_,S)},setZoomAround:function(_,S,P){var G=this.getZoomScale(S),ae=this.getSize().divideBy(2),ge=_ instanceof Le?_:this.latLngToContainerPoint(_),ke=ge.subtract(ae).multiplyBy(1-1/G),Xe=this.containerPointToLatLng(ae.add(ke));return this.setView(Xe,S,{zoom:P})},_getBoundsCenterZoom:function(_,S){S=S||{},_=_.getBounds?_.getBounds():yt(_);var P=Ke(S.paddingTopLeft||S.padding||[0,0]),G=Ke(S.paddingBottomRight||S.padding||[0,0]),ae=this.getBoundsZoom(_,!1,P.add(G));if(ae=typeof S.maxZoom=="number"?Math.min(S.maxZoom,ae):ae,ae===1/0)return{center:_.getCenter(),zoom:ae};var ge=G.subtract(P).divideBy(2),ke=this.project(_.getSouthWest(),ae),Xe=this.project(_.getNorthEast(),ae),nt=this.unproject(ke.add(Xe).divideBy(2).add(ge),ae);return{center:nt,zoom:ae}},fitBounds:function(_,S){if(_=yt(_),!_.isValid())throw new Error("Bounds are not valid.");var P=this._getBoundsCenterZoom(_,S);return this.setView(P.center,P.zoom,S)},fitWorld:function(_){return this.fitBounds([[-90,-180],[90,180]],_)},panTo:function(_,S){return this.setView(_,this._zoom,{pan:S})},panBy:function(_,S){if(_=Ke(_).round(),S=S||{},!_.x&&!_.y)return this.fire("moveend");if(S.animate!==!0&&!this.getSize().contains(_))return this._resetView(this.unproject(this.project(this.getCenter()).add(_)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new wp,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),S.noMoveStart||this.fire("movestart"),S.animate!==!1){Zt(this._mapPane,"leaflet-pan-anim");var P=this._getMapPanePos().subtract(_).round();this._panAnim.run(this._mapPane,P,S.duration||.25,S.easeLinearity)}else this._rawPanBy(_),this.fire("move").fire("moveend");return this},flyTo:function(_,S,P){if(P=P||{},P.animate===!1||!vn.any3d)return this.setView(_,S,P);this._stop();var G=this.project(this.getCenter()),ae=this.project(_),ge=this.getSize(),ke=this._zoom;_=Ot(_),S=S===void 0?ke:S;var Xe=Math.max(ge.x,ge.y),nt=Xe*this.getZoomScale(ke,S),Tt=ae.distanceTo(G)||1,Jt=1.42,Tn=Jt*Jt;function nr(ts){var em=ts?-1:1,xe=ts?nt:Xe,Dp=nt*nt-Xe*Xe+em*Tn*Tn*Tt*Tt,yg=2*xe*Tn*Tt,Io=Dp/yg,Pr=Math.sqrt(Io*Io+1)-Io,dS=Pr<1e-9?-18:Math.log(Pr);return dS}function Gs(ts){return(Math.exp(ts)-Math.exp(-ts))/2}function bs(ts){return(Math.exp(ts)+Math.exp(-ts))/2}function Ha(ts){return Gs(ts)/bs(ts)}var Pa=nr(0);function pl(ts){return Xe*(bs(Pa)/bs(Pa+Jt*ts))}function Qv(ts){return Xe*(bs(Pa)*Ha(Pa+Jt*ts)-Gs(Pa))/Tn}function A0(ts){return 1-Math.pow(1-ts,1.5)}var cS=Date.now(),_g=(nr(1)-Pa)/Jt,lS=P.duration?1e3*P.duration:1e3*_g*.8;function Zf(){var ts=(Date.now()-cS)/lS,em=A0(ts)*_g;ts<=1?(this._flyToFrame=pe(Zf,this),this._move(this.unproject(G.add(ae.subtract(G).multiplyBy(Qv(em)/Tt)),ke),this.getScaleZoom(Xe/pl(em),ke),{flyTo:!0})):this._move(_,S)._moveEnd(!0)}return this._moveStart(!0,P.noMoveStart),Zf.call(this),this},flyToBounds:function(_,S){var P=this._getBoundsCenterZoom(_,S);return this.flyTo(P.center,P.zoom,S)},setMaxBounds:function(_){return _=yt(_),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),_.isValid()?(this.options.maxBounds=_,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(_){var S=this.options.minZoom;return this.options.minZoom=_,this._loaded&&S!==_&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(_):this},setMaxZoom:function(_){var S=this.options.maxZoom;return this.options.maxZoom=_,this._loaded&&S!==_&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(_):this},panInsideBounds:function(_,S){this._enforcingBounds=!0;var P=this.getCenter(),G=this._limitCenter(P,this._zoom,yt(_));return P.equals(G)||this.panTo(G,S),this._enforcingBounds=!1,this},panInside:function(_,S){S=S||{};var P=Ke(S.paddingTopLeft||S.padding||[0,0]),G=Ke(S.paddingBottomRight||S.padding||[0,0]),ae=this.project(this.getCenter()),ge=this.project(_),ke=this.getPixelBounds(),Xe=rt([ke.min.add(P),ke.max.subtract(G)]),nt=Xe.getSize();if(!Xe.contains(ge)){this._enforcingBounds=!0;var Tt=ge.subtract(Xe.getCenter()),Jt=Xe.extend(ge).getSize().subtract(nt);ae.x+=Tt.x<0?-Jt.x:Jt.x,ae.y+=Tt.y<0?-Jt.y:Jt.y,this.panTo(this.unproject(ae),S),this._enforcingBounds=!1}return this},invalidateSize:function(_){if(!this._loaded)return this;_=l({animate:!1,pan:!0},_===!0?{animate:!0}:_);var S=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var P=this.getSize(),G=S.divideBy(2).round(),ae=P.divideBy(2).round(),ge=G.subtract(ae);return!ge.x&&!ge.y?this:(_.animate&&_.pan?this.panBy(ge):(_.pan&&this._rawPanBy(ge),this.fire("move"),_.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(p(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:S,newSize:P}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(_){if(_=this._locateOptions=l({timeout:1e4,watch:!1},_),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var S=p(this._handleGeolocationResponse,this),P=p(this._handleGeolocationError,this);return _.watch?this._locationWatchId=navigator.geolocation.watchPosition(S,P,_):navigator.geolocation.getCurrentPosition(S,P,_),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(_){if(this._container._leaflet_id){var S=_.code,P=_.message||(S===1?"permission denied":S===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:S,message:"Geolocation error: "+P+"."})}},_handleGeolocationResponse:function(_){if(this._container._leaflet_id){var S=_.coords.latitude,P=_.coords.longitude,G=new Ct(S,P),ae=G.toBounds(_.coords.accuracy*2),ge=this._locateOptions;if(ge.setView){var ke=this.getBoundsZoom(ae);this.setView(G,ge.maxZoom?Math.min(ke,ge.maxZoom):ke)}var Xe={latlng:G,bounds:ae,timestamp:_.timestamp};for(var nt in _.coords)typeof _.coords[nt]=="number"&&(Xe[nt]=_.coords[nt]);this.fire("locationfound",Xe)}},addHandler:function(_,S){if(!S)return this;var P=this[_]=new S(this);return this._handlers.push(P),this.options[_]&&P.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),Ni(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(be(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var _;for(_ in this._layers)this._layers[_].remove();for(_ in this._panes)Ni(this._panes[_]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(_,S){var P="leaflet-pane"+(_?" leaflet-"+_.replace("Pane","")+"-pane":""),G=Vr("div",P,S||this._mapPane);return _&&(this._panes[_]=G),G},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var _=this.getPixelBounds(),S=this.unproject(_.getBottomLeft()),P=this.unproject(_.getTopRight());return new mt(S,P)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(_,S,P){_=yt(_),P=Ke(P||[0,0]);var G=this.getZoom()||0,ae=this.getMinZoom(),ge=this.getMaxZoom(),ke=_.getNorthWest(),Xe=_.getSouthEast(),nt=this.getSize().subtract(P),Tt=rt(this.project(Xe,G),this.project(ke,G)).getSize(),Jt=vn.any3d?this.options.zoomSnap:1,Tn=nt.x/Tt.x,nr=nt.y/Tt.y,Gs=S?Math.max(Tn,nr):Math.min(Tn,nr);return G=this.getScaleZoom(Gs,G),Jt&&(G=Math.round(G/(Jt/100))*(Jt/100),G=S?Math.ceil(G/Jt)*Jt:Math.floor(G/Jt)*Jt),Math.max(ae,Math.min(ge,G))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new Le(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(_,S){var P=this._getTopLeftPoint(_,S);return new Rt(P,P.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(_){return this.options.crs.getProjectedBounds(_===void 0?this.getZoom():_)},getPane:function(_){return typeof _=="string"?this._panes[_]:_},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(_,S){var P=this.options.crs;return S=S===void 0?this._zoom:S,P.scale(_)/P.scale(S)},getScaleZoom:function(_,S){var P=this.options.crs;S=S===void 0?this._zoom:S;var G=P.zoom(_*P.scale(S));return isNaN(G)?1/0:G},project:function(_,S){return S=S===void 0?this._zoom:S,this.options.crs.latLngToPoint(Ot(_),S)},unproject:function(_,S){return S=S===void 0?this._zoom:S,this.options.crs.pointToLatLng(Ke(_),S)},layerPointToLatLng:function(_){var S=Ke(_).add(this.getPixelOrigin());return this.unproject(S)},latLngToLayerPoint:function(_){var S=this.project(Ot(_))._round();return S._subtract(this.getPixelOrigin())},wrapLatLng:function(_){return this.options.crs.wrapLatLng(Ot(_))},wrapLatLngBounds:function(_){return this.options.crs.wrapLatLngBounds(yt(_))},distance:function(_,S){return this.options.crs.distance(Ot(_),Ot(S))},containerPointToLayerPoint:function(_){return Ke(_).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(_){return Ke(_).add(this._getMapPanePos())},containerPointToLatLng:function(_){var S=this.containerPointToLayerPoint(Ke(_));return this.layerPointToLatLng(S)},latLngToContainerPoint:function(_){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Ot(_)))},mouseEventToContainerPoint:function(_){return bp(_,this._container)},mouseEventToLayerPoint:function(_){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(_))},mouseEventToLatLng:function(_){return this.layerPointToLatLng(this.mouseEventToLayerPoint(_))},_initContainer:function(_){var S=this._container=Mf(_);if(S){if(S._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");Dn(S,"scroll",this._onScroll,this),this._containerId=v(S)},_initLayout:function(){var _=this._container;this._fadeAnimated=this.options.fadeAnimation&&vn.any3d,Zt(_,"leaflet-container"+(vn.touch?" leaflet-touch":"")+(vn.retina?" leaflet-retina":"")+(vn.ielt9?" leaflet-oldie":"")+(vn.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var S=_d(_,"position");S!=="absolute"&&S!=="relative"&&S!=="fixed"&&S!=="sticky"&&(_.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var _=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),qn(this._mapPane,new Le(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Zt(_.markerPane,"leaflet-zoom-hide"),Zt(_.shadowPane,"leaflet-zoom-hide"))},_resetView:function(_,S,P){qn(this._mapPane,new Le(0,0));var G=!this._loaded;this._loaded=!0,S=this._limitZoom(S),this.fire("viewprereset");var ae=this._zoom!==S;this._moveStart(ae,P)._move(_,S)._moveEnd(ae),this.fire("viewreset"),G&&this.fire("load")},_moveStart:function(_,S){return _&&this.fire("zoomstart"),S||this.fire("movestart"),this},_move:function(_,S,P,G){S===void 0&&(S=this._zoom);var ae=this._zoom!==S;return this._zoom=S,this._lastCenter=_,this._pixelOrigin=this._getNewPixelOrigin(_),G?P&&P.pinch&&this.fire("zoom",P):((ae||P&&P.pinch)&&this.fire("zoom",P),this.fire("move",P)),this},_moveEnd:function(_){return _&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return be(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(_){qn(this._mapPane,this._getMapPanePos().subtract(_))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(_){this._targets={},this._targets[v(this._container)]=this;var S=_?Ei:Dn;S(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&S(window,"resize",this._onResize,this),vn.any3d&&this.options.transform3DLimit&&(_?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){be(this._resizeRequest),this._resizeRequest=pe(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var _=this._getMapPanePos();Math.max(Math.abs(_.x),Math.abs(_.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(_,S){for(var P=[],G,ae=S==="mouseout"||S==="mouseover",ge=_.target||_.srcElement,ke=!1;ge;){if(G=this._targets[v(ge)],G&&(S==="click"||S==="preclick")&&this._draggableMoved(G)){ke=!0;break}if(G&&G.listens(S,!0)&&(ae&&!za(ge,_)||(P.push(G),ae))||ge===this._container)break;ge=ge.parentNode}return!P.length&&!ke&&!ae&&this.listens(S,!0)&&(P=[this]),P},_isClickDisabled:function(_){for(;_&&_!==this._container;){if(_._leaflet_disable_click)return!0;_=_.parentNode}},_handleDOMEvent:function(_){var S=_.target||_.srcElement;if(!(!this._loaded||S._leaflet_disable_events||_.type==="click"&&this._isClickDisabled(S))){var P=_.type;P==="mousedown"&&Vl(S),this._fireDOMEvent(_,P)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(_,S,P){if(_.type==="click"){var G=l({},_);G.type="preclick",this._fireDOMEvent(G,G.type,P)}var ae=this._findEventTargets(_,S);if(P){for(var ge=[],ke=0;ke<P.length;ke++)P[ke].listens(S,!0)&&ge.push(P[ke]);ae=ge.concat(ae)}if(ae.length){S==="contextmenu"&&Yn(_);var Xe=ae[0],nt={originalEvent:_};if(_.type!=="keypress"&&_.type!=="keydown"&&_.type!=="keyup"){var Tt=Xe.getLatLng&&(!Xe._radius||Xe._radius<=10);nt.containerPoint=Tt?this.latLngToContainerPoint(Xe.getLatLng()):this.mouseEventToContainerPoint(_),nt.layerPoint=this.containerPointToLayerPoint(nt.containerPoint),nt.latlng=Tt?Xe.getLatLng():this.layerPointToLatLng(nt.layerPoint)}for(ke=0;ke<ae.length;ke++)if(ae[ke].fire(S,nt,!0),nt.originalEvent._stopped||ae[ke].options.bubblingMouseEvents===!1&&ne(this._mouseEvents,S)!==-1)return}},_draggableMoved:function(_){return _=_.dragging&&_.dragging.enabled()?_:this,_.dragging&&_.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var _=0,S=this._handlers.length;_<S;_++)this._handlers[_].disable()},whenReady:function(_,S){return this._loaded?_.call(S||this,{target:this}):this.on("load",_,S),this},_getMapPanePos:function(){return To(this._mapPane)||new Le(0,0)},_moved:function(){var _=this._getMapPanePos();return _&&!_.equals([0,0])},_getTopLeftPoint:function(_,S){var P=_&&S!==void 0?this._getNewPixelOrigin(_,S):this.getPixelOrigin();return P.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(_,S){var P=this.getSize()._divideBy(2);return this.project(_,S)._subtract(P)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(_,S,P){var G=this._getNewPixelOrigin(P,S);return this.project(_,S)._subtract(G)},_latLngBoundsToNewLayerBounds:function(_,S,P){var G=this._getNewPixelOrigin(P,S);return rt([this.project(_.getSouthWest(),S)._subtract(G),this.project(_.getNorthWest(),S)._subtract(G),this.project(_.getSouthEast(),S)._subtract(G),this.project(_.getNorthEast(),S)._subtract(G)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(_){return this.latLngToLayerPoint(_).subtract(this._getCenterLayerPoint())},_limitCenter:function(_,S,P){if(!P)return _;var G=this.project(_,S),ae=this.getSize().divideBy(2),ge=new Rt(G.subtract(ae),G.add(ae)),ke=this._getBoundsOffset(ge,P,S);return Math.abs(ke.x)<=1&&Math.abs(ke.y)<=1?_:this.unproject(G.add(ke),S)},_limitOffset:function(_,S){if(!S)return _;var P=this.getPixelBounds(),G=new Rt(P.min.add(_),P.max.add(_));return _.add(this._getBoundsOffset(G,S))},_getBoundsOffset:function(_,S,P){var G=rt(this.project(S.getNorthEast(),P),this.project(S.getSouthWest(),P)),ae=G.min.subtract(_.min),ge=G.max.subtract(_.max),ke=this._rebound(ae.x,-ge.x),Xe=this._rebound(ae.y,-ge.y);return new Le(ke,Xe)},_rebound:function(_,S){return _+S>0?Math.round(_-S)/2:Math.max(0,Math.ceil(_))-Math.max(0,Math.floor(S))},_limitZoom:function(_){var S=this.getMinZoom(),P=this.getMaxZoom(),G=vn.any3d?this.options.zoomSnap:1;return G&&(_=Math.round(_/G)*G),Math.max(S,Math.min(P,_))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Oi(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(_,S){var P=this._getCenterOffset(_)._trunc();return(S&&S.animate)!==!0&&!this.getSize().contains(P)?!1:(this.panBy(P,S),!0)},_createAnimProxy:function(){var _=this._proxy=Vr("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(_),this.on("zoomanim",function(S){var P=ru,G=this._proxy.style[P];Ul(this._proxy,this.project(S.center,S.zoom),this.getZoomScale(S.zoom,1)),G===this._proxy.style[P]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Ni(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var _=this.getCenter(),S=this.getZoom();Ul(this._proxy,this.project(_,S),this.getZoomScale(S,1))},_catchTransitionEnd:function(_){this._animatingZoom&&_.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(_,S,P){if(this._animatingZoom)return!0;if(P=P||{},!this._zoomAnimated||P.animate===!1||this._nothingToAnimate()||Math.abs(S-this._zoom)>this.options.zoomAnimationThreshold)return!1;var G=this.getZoomScale(S),ae=this._getCenterOffset(_)._divideBy(1-1/G);return P.animate!==!0&&!this.getSize().contains(ae)?!1:(pe(function(){this._moveStart(!0,P.noMoveStart||!1)._animateZoom(_,S,!0)},this),!0)},_animateZoom:function(_,S,P,G){this._mapPane&&(P&&(this._animatingZoom=!0,this._animateToCenter=_,this._animateToZoom=S,Zt(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:_,zoom:S,noUpdate:G}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(p(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Oi(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function xs(_,S){return new kr(_,S)}var _i=Ze.extend({options:{position:"topright"},initialize:function(_){F(this,_)},getPosition:function(){return this.options.position},setPosition:function(_){var S=this._map;return S&&S.removeControl(this),this.options.position=_,S&&S.addControl(this),this},getContainer:function(){return this._container},addTo:function(_){this.remove(),this._map=_;var S=this._container=this.onAdd(_),P=this.getPosition(),G=_._controlCorners[P];return Zt(S,"leaflet-control"),P.indexOf("bottom")!==-1?G.insertBefore(S,G.firstChild):G.appendChild(S),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Ni(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(_){this._map&&_&&_.screenX>0&&_.screenY>0&&this._map.getContainer().focus()}}),Ns=function(_){return new _i(_)};kr.include({addControl:function(_){return _.addTo(this),this},removeControl:function(_){return _.remove(),this},_initControlPos:function(){var _=this._controlCorners={},S="leaflet-",P=this._controlContainer=Vr("div",S+"control-container",this._container);function G(ae,ge){var ke=S+ae+" "+S+ge;_[ae+ge]=Vr("div",ke,P)}G("top","left"),G("top","right"),G("bottom","left"),G("bottom","right")},_clearControlPos:function(){for(var _ in this._controlCorners)Ni(this._controlCorners[_]);Ni(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Sp=_i.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(_,S,P,G){return P<G?-1:G<P?1:0}},initialize:function(_,S,P){F(this,P),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var G in _)this._addLayer(_[G],G);for(G in S)this._addLayer(S[G],G,!0)},onAdd:function(_){this._initLayout(),this._update(),this._map=_,_.on("zoomend",this._checkDisabledLayers,this);for(var S=0;S<this._layers.length;S++)this._layers[S].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(_){return _i.prototype.addTo.call(this,_),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var _=0;_<this._layers.length;_++)this._layers[_].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(_,S){return this._addLayer(_,S),this._map?this._update():this},addOverlay:function(_,S){return this._addLayer(_,S,!0),this._map?this._update():this},removeLayer:function(_){_.off("add remove",this._onLayerChange,this);var S=this._getLayer(v(_));return S&&this._layers.splice(this._layers.indexOf(S),1),this._map?this._update():this},expand:function(){Zt(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var _=this._map.getSize().y-(this._container.offsetTop+50);return _<this._section.clientHeight?(Zt(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=_+"px"):Oi(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Oi(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var _="leaflet-control-layers",S=this._container=Vr("div",_),P=this.options.collapsed;S.setAttribute("aria-haspopup",!0),lu(S),cu(S);var G=this._section=Vr("section",_+"-list");P&&(this._map.on("click",this.collapse,this),Dn(S,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var ae=this._layersLink=Vr("a",_+"-toggle",S);ae.href="#",ae.title="Layers",ae.setAttribute("role","button"),Dn(ae,{keydown:function(ge){ge.keyCode===13&&this._expandSafely()},click:function(ge){Yn(ge),this._expandSafely()}},this),P||this.expand(),this._baseLayersList=Vr("div",_+"-base",G),this._separator=Vr("div",_+"-separator",G),this._overlaysList=Vr("div",_+"-overlays",G),S.appendChild(G)},_getLayer:function(_){for(var S=0;S<this._layers.length;S++)if(this._layers[S]&&v(this._layers[S].layer)===_)return this._layers[S]},_addLayer:function(_,S,P){this._map&&_.on("add remove",this._onLayerChange,this),this._layers.push({layer:_,name:S,overlay:P}),this.options.sortLayers&&this._layers.sort(p(function(G,ae){return this.options.sortFunction(G.layer,ae.layer,G.name,ae.name)},this)),this.options.autoZIndex&&_.setZIndex&&(this._lastZIndex++,_.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;su(this._baseLayersList),su(this._overlaysList),this._layerControlInputs=[];var _,S,P,G,ae=0;for(P=0;P<this._layers.length;P++)G=this._layers[P],this._addItem(G),S=S||G.overlay,_=_||!G.overlay,ae+=G.overlay?0:1;return this.options.hideSingleBase&&(_=_&&ae>1,this._baseLayersList.style.display=_?"":"none"),this._separator.style.display=S&&_?"":"none",this},_onLayerChange:function(_){this._handlingClick||this._update();var S=this._getLayer(v(_.target)),P=S.overlay?_.type==="add"?"overlayadd":"overlayremove":_.type==="add"?"baselayerchange":null;P&&this._map.fire(P,S)},_createRadioElement:function(_,S){var P='<input type="radio" class="leaflet-control-layers-selector" name="'+_+'"'+(S?' checked="checked"':"")+"/>",G=document.createElement("div");return G.innerHTML=P,G.firstChild},_addItem:function(_){var S=document.createElement("label"),P=this._map.hasLayer(_.layer),G;_.overlay?(G=document.createElement("input"),G.type="checkbox",G.className="leaflet-control-layers-selector",G.defaultChecked=P):G=this._createRadioElement("leaflet-base-layers_"+v(this),P),this._layerControlInputs.push(G),G.layerId=v(_.layer),Dn(G,"click",this._onInputClick,this);var ae=document.createElement("span");ae.innerHTML=" "+_.name;var ge=document.createElement("span");S.appendChild(ge),ge.appendChild(G),ge.appendChild(ae);var ke=_.overlay?this._overlaysList:this._baseLayersList;return ke.appendChild(S),this._checkDisabledLayers(),S},_onInputClick:function(){if(!this._preventClick){var _=this._layerControlInputs,S,P,G=[],ae=[];this._handlingClick=!0;for(var ge=_.length-1;ge>=0;ge--)S=_[ge],P=this._getLayer(S.layerId).layer,S.checked?G.push(P):S.checked||ae.push(P);for(ge=0;ge<ae.length;ge++)this._map.hasLayer(ae[ge])&&this._map.removeLayer(ae[ge]);for(ge=0;ge<G.length;ge++)this._map.hasLayer(G[ge])||this._map.addLayer(G[ge]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var _=this._layerControlInputs,S,P,G=this._map.getZoom(),ae=_.length-1;ae>=0;ae--)S=_[ae],P=this._getLayer(S.layerId).layer,S.disabled=P.options.minZoom!==void 0&&G<P.options.minZoom||P.options.maxZoom!==void 0&&G>P.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var _=this._section;this._preventClick=!0,Dn(_,"click",Yn),this.expand();var S=this;setTimeout(function(){Ei(_,"click",Yn),S._preventClick=!1})}}),Wf=function(_,S,P){return new Sp(_,S,P)},ps=_i.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(_){var S="leaflet-control-zoom",P=Vr("div",S+" leaflet-bar"),G=this.options;return this._zoomInButton=this._createButton(G.zoomInText,G.zoomInTitle,S+"-in",P,this._zoomIn),this._zoomOutButton=this._createButton(G.zoomOutText,G.zoomOutTitle,S+"-out",P,this._zoomOut),this._updateDisabled(),_.on("zoomend zoomlevelschange",this._updateDisabled,this),P},onRemove:function(_){_.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(_){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(_.shiftKey?3:1))},_zoomOut:function(_){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(_.shiftKey?3:1))},_createButton:function(_,S,P,G,ae){var ge=Vr("a",P,G);return ge.innerHTML=_,ge.href="#",ge.title=S,ge.setAttribute("role","button"),ge.setAttribute("aria-label",S),lu(ge),Dn(ge,"click",vr),Dn(ge,"click",ae,this),Dn(ge,"click",this._refocusOnMap,this),ge},_updateDisabled:function(){var _=this._map,S="leaflet-disabled";Oi(this._zoomInButton,S),Oi(this._zoomOutButton,S),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||_._zoom===_.getMinZoom())&&(Zt(this._zoomOutButton,S),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||_._zoom===_.getMaxZoom())&&(Zt(this._zoomInButton,S),this._zoomInButton.setAttribute("aria-disabled","true"))}});kr.mergeOptions({zoomControl:!0}),kr.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new ps,this.addControl(this.zoomControl))});var Tp=function(_){return new ps(_)},ph=_i.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(_){var S="leaflet-control-scale",P=Vr("div",S),G=this.options;return this._addScales(G,S+"-line",P),_.on(G.updateWhenIdle?"moveend":"move",this._update,this),_.whenReady(this._update,this),P},onRemove:function(_){_.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(_,S,P){_.metric&&(this._mScale=Vr("div",S,P)),_.imperial&&(this._iScale=Vr("div",S,P))},_update:function(){var _=this._map,S=_.getSize().y/2,P=_.distance(_.containerPointToLatLng([0,S]),_.containerPointToLatLng([this.options.maxWidth,S]));this._updateScales(P)},_updateScales:function(_){this.options.metric&&_&&this._updateMetric(_),this.options.imperial&&_&&this._updateImperial(_)},_updateMetric:function(_){var S=this._getRoundNum(_),P=S<1e3?S+" m":S/1e3+" km";this._updateScale(this._mScale,P,S/_)},_updateImperial:function(_){var S=_*3.2808399,P,G,ae;S>5280?(P=S/5280,G=this._getRoundNum(P),this._updateScale(this._iScale,G+" mi",G/P)):(ae=this._getRoundNum(S),this._updateScale(this._iScale,ae+" ft",ae/S))},_updateScale:function(_,S,P){_.style.width=Math.round(this.options.maxWidth*P)+"px",_.innerHTML=S},_getRoundNum:function(_){var S=Math.pow(10,(Math.floor(_)+"").length-1),P=_/S;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:1,S*P}}),Ed=function(_){return new ph(_)},Hf='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',dl=_i.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(vn.inlineSvg?Hf+" ":"")+"Leaflet</a>"},initialize:function(_){F(this,_),this._attributions={}},onAdd:function(_){_.attributionControl=this,this._container=Vr("div","leaflet-control-attribution"),lu(this._container);for(var S in _._layers)_._layers[S].getAttribution&&this.addAttribution(_._layers[S].getAttribution());return this._update(),_.on("layeradd",this._addAttribution,this),this._container},onRemove:function(_){_.off("layeradd",this._addAttribution,this)},_addAttribution:function(_){_.layer.getAttribution&&(this.addAttribution(_.layer.getAttribution()),_.layer.once("remove",function(){this.removeAttribution(_.layer.getAttribution())},this))},setPrefix:function(_){return this.options.prefix=_,this._update(),this},addAttribution:function(_){return _?(this._attributions[_]||(this._attributions[_]=0),this._attributions[_]++,this._update(),this):this},removeAttribution:function(_){return _?(this._attributions[_]&&(this._attributions[_]--,this._update()),this):this},_update:function(){if(this._map){var _=[];for(var S in this._attributions)this._attributions[S]&&_.push(S);var P=[];this.options.prefix&&P.push(this.options.prefix),_.length&&P.push(_.join(", ")),this._container.innerHTML=P.join(' <span aria-hidden="true">|</span> ')}}});kr.mergeOptions({attributionControl:!0}),kr.addInitHook(function(){this.options.attributionControl&&new dl().addTo(this)});var Rp=function(_){return new dl(_)};_i.Layers=Sp,_i.Zoom=ps,_i.Scale=ph,_i.Attribution=dl,Ns.layers=Wf,Ns.zoom=Tp,Ns.scale=Ed,Ns.attribution=Rp;var Li=Ze.extend({initialize:function(_){this._map=_},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Li.addTo=function(_,S){return _.addHandler(S,this),this};var fh={Events:St},Ga=vn.touch?"touchstart mousedown":"mousedown",Ia=lt.extend({options:{clickTolerance:3},initialize:function(_,S,P,G){F(this,G),this._element=_,this._dragStartTarget=S||_,this._preventOutline=P},enable:function(){this._enabled||(Dn(this._dragStartTarget,Ga,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Ia._dragging===this&&this.finishDrag(!0),Ei(this._dragStartTarget,Ga,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(_){if(this._enabled&&(this._moved=!1,!Uf(this._element,"leaflet-zoom-anim"))){if(_.touches&&_.touches.length!==1){Ia._dragging===this&&this.finishDrag();return}if(!(Ia._dragging||_.shiftKey||_.which!==1&&_.button!==1&&!_.touches)&&(Ia._dragging=this,this._preventOutline&&Vl(this._element),hh(),ao(),!this._moving)){this.fire("down");var S=_.touches?_.touches[0]:_,P=Vf(this._element);this._startPoint=new Le(S.clientX,S.clientY),this._startPos=To(this._element),this._parentScale=xp(P);var G=_.type==="mousedown";Dn(document,G?"mousemove":"touchmove",this._onMove,this),Dn(document,G?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(_){if(this._enabled){if(_.touches&&_.touches.length>1){this._moved=!0;return}var S=_.touches&&_.touches.length===1?_.touches[0]:_,P=new Le(S.clientX,S.clientY)._subtract(this._startPoint);!P.x&&!P.y||Math.abs(P.x)+Math.abs(P.y)<this.options.clickTolerance||(P.x/=this._parentScale.x,P.y/=this._parentScale.y,Yn(_),this._moved||(this.fire("dragstart"),this._moved=!0,Zt(document.body,"leaflet-dragging"),this._lastTarget=_.target||_.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Zt(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(P),this._moving=!0,this._lastEvent=_,this._updatePosition())}},_updatePosition:function(){var _={originalEvent:this._lastEvent};this.fire("predrag",_),qn(this._element,this._newPos),this.fire("drag",_)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(_){Oi(document.body,"leaflet-dragging"),this._lastTarget&&(Oi(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Ei(document,"mousemove touchmove",this._onMove,this),Ei(document,"mouseup touchend touchcancel",this._onUp,this),vp(),Na();var S=this._moved&&this._moving;this._moving=!1,Ia._dragging=!1,S&&this.fire("dragend",{noInertia:_,distance:this._newPos.distanceTo(this._startPos)})}});function ul(_,S,P){var G,ae=[1,4,2,8],ge,ke,Xe,nt,Tt,Jt,Tn,nr;for(ge=0,Jt=_.length;ge<Jt;ge++)_[ge]._code=ac(_[ge],S);for(Xe=0;Xe<4;Xe++){for(Tn=ae[Xe],G=[],ge=0,Jt=_.length,ke=Jt-1;ge<Jt;ke=ge++)nt=_[ge],Tt=_[ke],nt._code&Tn?Tt._code&Tn||(nr=sa(Tt,nt,Tn,S,P),nr._code=ac(nr,S),G.push(nr)):(Tt._code&Tn&&(nr=sa(Tt,nt,Tn,S,P),nr._code=ac(nr,S),G.push(nr)),G.push(nt));_=G}return _}function ic(_,S){var P,G,ae,ge,ke,Xe,nt,Tt,Jt;if(!_||_.length===0)throw new Error("latlngs not passed");k(_)||(console.warn("latlngs are not flat! Only the first ring will be used"),_=_[0]);var Tn=Ot([0,0]),nr=yt(_),Gs=nr.getNorthWest().distanceTo(nr.getSouthWest())*nr.getNorthEast().distanceTo(nr.getNorthWest());Gs<1700&&(Tn=xd(_));var bs=_.length,Ha=[];for(P=0;P<bs;P++){var Pa=Ot(_[P]);Ha.push(S.project(Ot([Pa.lat-Tn.lat,Pa.lng-Tn.lng])))}for(Xe=nt=Tt=0,P=0,G=bs-1;P<bs;G=P++)ae=Ha[P],ge=Ha[G],ke=ae.y*ge.x-ge.y*ae.x,nt+=(ae.x+ge.x)*ke,Tt+=(ae.y+ge.y)*ke,Xe+=ke*3;Xe===0?Jt=Ha[0]:Jt=[nt/Xe,Tt/Xe];var pl=S.unproject(Ke(Jt));return Ot([pl.lat+Tn.lat,pl.lng+Tn.lng])}function xd(_){for(var S=0,P=0,G=0,ae=0;ae<_.length;ae++){var ge=Ot(_[ae]);S+=ge.lat,P+=ge.lng,G++}return Ot([S/G,P/G])}var du={__proto__:null,clipPolygon:ul,polygonCenter:ic,centroid:xd};function Ii(_,S){if(!S||!_.length)return _.slice();var P=S*S;return _=Kf(_,P),_=dg(_,P),_}function Vc(_,S,P){return Math.sqrt(Fc(_,S,P,!0))}function Wa(_,S,P){return Fc(_,S,P)}function dg(_,S){var P=_.length,G=typeof Uint8Array<"u"?Uint8Array:Array,ae=new G(P);ae[0]=ae[P-1]=1,sc(_,ae,S,0,P-1);var ge,ke=[];for(ge=0;ge<P;ge++)ae[ge]&&ke.push(_[ge]);return ke}function sc(_,S,P,G,ae){var ge=0,ke,Xe,nt;for(Xe=G+1;Xe<=ae-1;Xe++)nt=Fc(_[Xe],_[G],_[ae],!0),nt>ge&&(ke=Xe,ge=nt);ge>P&&(S[ke]=1,sc(_,S,P,G,ke),sc(_,S,P,ke,ae))}function Kf(_,S){for(var P=[_[0]],G=1,ae=0,ge=_.length;G<ge;G++)bd(_[G],_[ae])>S&&(P.push(_[G]),ae=G);return ae<ge-1&&P.push(_[ge-1]),P}var qf;function In(_,S,P,G,ae){var ge=G?qf:ac(_,P),ke=ac(S,P),Xe,nt,Tt;for(qf=ke;;){if(!(ge|ke))return[_,S];if(ge&ke)return!1;Xe=ge||ke,nt=sa(_,S,Xe,P,ae),Tt=ac(nt,P),Xe===ge?(_=nt,ge=Tt):(S=nt,ke=Tt)}}function sa(_,S,P,G,ae){var ge=S.x-_.x,ke=S.y-_.y,Xe=G.min,nt=G.max,Tt,Jt;return P&8?(Tt=_.x+ge*(nt.y-_.y)/ke,Jt=nt.y):P&4?(Tt=_.x+ge*(Xe.y-_.y)/ke,Jt=Xe.y):P&2?(Tt=nt.x,Jt=_.y+ke*(nt.x-_.x)/ge):P&1&&(Tt=Xe.x,Jt=_.y+ke*(Xe.x-_.x)/ge),new Le(Tt,Jt,ae)}function ac(_,S){var P=0;return _.x<S.min.x?P|=1:_.x>S.max.x&&(P|=2),_.y<S.min.y?P|=4:_.y>S.max.y&&(P|=8),P}function bd(_,S){var P=S.x-_.x,G=S.y-_.y;return P*P+G*G}function Fc(_,S,P,G){var ae=S.x,ge=S.y,ke=P.x-ae,Xe=P.y-ge,nt=ke*ke+Xe*Xe,Tt;return nt>0&&(Tt=((_.x-ae)*ke+(_.y-ge)*Xe)/nt,Tt>1?(ae=P.x,ge=P.y):Tt>0&&(ae+=ke*Tt,ge+=Xe*Tt)),ke=_.x-ae,Xe=_.y-ge,G?ke*ke+Xe*Xe:new Le(ae,ge)}function k(_){return!X(_[0])||typeof _[0][0]!="object"&&typeof _[0][0]<"u"}function ee(_){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),k(_)}function le(_,S){var P,G,ae,ge,ke,Xe,nt,Tt;if(!_||_.length===0)throw new Error("latlngs not passed");k(_)||(console.warn("latlngs are not flat! Only the first ring will be used"),_=_[0]);var Jt=Ot([0,0]),Tn=yt(_),nr=Tn.getNorthWest().distanceTo(Tn.getSouthWest())*Tn.getNorthEast().distanceTo(Tn.getNorthWest());nr<1700&&(Jt=xd(_));var Gs=_.length,bs=[];for(P=0;P<Gs;P++){var Ha=Ot(_[P]);bs.push(S.project(Ot([Ha.lat-Jt.lat,Ha.lng-Jt.lng])))}for(P=0,G=0;P<Gs-1;P++)G+=bs[P].distanceTo(bs[P+1])/2;if(G===0)Tt=bs[0];else for(P=0,ge=0;P<Gs-1;P++)if(ke=bs[P],Xe=bs[P+1],ae=ke.distanceTo(Xe),ge+=ae,ge>G){nt=(ge-G)/ae,Tt=[Xe.x-nt*(Xe.x-ke.x),Xe.y-nt*(Xe.y-ke.y)];break}var Pa=S.unproject(Ke(Tt));return Ot([Pa.lat+Jt.lat,Pa.lng+Jt.lng])}var Se={__proto__:null,simplify:Ii,pointToSegmentDistance:Vc,closestPointOnSegment:Wa,clipSegment:In,_getEdgeIntersection:sa,_getBitCode:ac,_sqClosestPointOnSegment:Fc,isFlat:k,_flat:ee,polylineCenter:le},He={project:function(_){return new Le(_.lng,_.lat)},unproject:function(_){return new Ct(_.y,_.x)},bounds:new Rt([-180,-90],[180,90])},ct={R:6378137,R_MINOR:6356752314245179e-9,bounds:new Rt([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(_){var S=Math.PI/180,P=this.R,G=_.lat*S,ae=this.R_MINOR/P,ge=Math.sqrt(1-ae*ae),ke=ge*Math.sin(G),Xe=Math.tan(Math.PI/4-G/2)/Math.pow((1-ke)/(1+ke),ge/2);return G=-P*Math.log(Math.max(Xe,1e-10)),new Le(_.lng*S*P,G)},unproject:function(_){for(var S=180/Math.PI,P=this.R,G=this.R_MINOR/P,ae=Math.sqrt(1-G*G),ge=Math.exp(-_.y/P),ke=Math.PI/2-2*Math.atan(ge),Xe=0,nt=.1,Tt;Xe<15&&Math.abs(nt)>1e-7;Xe++)Tt=ae*Math.sin(ke),Tt=Math.pow((1-Tt)/(1+Tt),ae/2),nt=Math.PI/2-2*Math.atan(ge*Tt)-ke,ke+=nt;return new Ct(ke*S,_.x*S/P)}},Ut={__proto__:null,LonLat:He,Mercator:ct,SphericalMercator:Pn},ii=l({},zt,{code:"EPSG:3395",projection:ct,transformation:function(){var _=.5/(Math.PI*ct.R);return pr(_,.5,-_,.5)}()}),Bs=l({},zt,{code:"EPSG:4326",projection:He,transformation:pr(1/180,1,-1/180,.5)}),sr=l({},vt,{projection:He,transformation:pr(1,0,-1,0),scale:function(_){return Math.pow(2,_)},zoom:function(_){return Math.log(_)/Math.LN2},distance:function(_,S){var P=S.lng-_.lng,G=S.lat-_.lat;return Math.sqrt(P*P+G*G)},infinite:!0});vt.Earth=zt,vt.EPSG3395=ii,vt.EPSG3857=nn,vt.EPSG900913=ri,vt.EPSG4326=Bs,vt.Simple=sr;var fr=lt.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(_){return _.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(_){return _&&_.removeLayer(this),this},getPane:function(_){return this._map.getPane(_?this.options[_]||_:this.options.pane)},addInteractiveTarget:function(_){return this._map._targets[v(_)]=this,this},removeInteractiveTarget:function(_){return delete this._map._targets[v(_)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(_){var S=_.target;if(S.hasLayer(this)){if(this._map=S,this._zoomAnimated=S._zoomAnimated,this.getEvents){var P=this.getEvents();S.on(P,this),this.once("remove",function(){S.off(P,this)},this)}this.onAdd(S),this.fire("add"),S.fire("layeradd",{layer:this})}}});kr.include({addLayer:function(_){if(!_._layerAdd)throw new Error("The provided object is not a Layer.");var S=v(_);return this._layers[S]?this:(this._layers[S]=_,_._mapToAdd=this,_.beforeAdd&&_.beforeAdd(this),this.whenReady(_._layerAdd,_),this)},removeLayer:function(_){var S=v(_);return this._layers[S]?(this._loaded&&_.onRemove(this),delete this._layers[S],this._loaded&&(this.fire("layerremove",{layer:_}),_.fire("remove")),_._map=_._mapToAdd=null,this):this},hasLayer:function(_){return v(_)in this._layers},eachLayer:function(_,S){for(var P in this._layers)_.call(S,this._layers[P]);return this},_addLayers:function(_){_=_?X(_)?_:[_]:[];for(var S=0,P=_.length;S<P;S++)this.addLayer(_[S])},_addZoomLimit:function(_){(!isNaN(_.options.maxZoom)||!isNaN(_.options.minZoom))&&(this._zoomBoundLayers[v(_)]=_,this._updateZoomLevels())},_removeZoomLimit:function(_){var S=v(_);this._zoomBoundLayers[S]&&(delete this._zoomBoundLayers[S],this._updateZoomLevels())},_updateZoomLevels:function(){var _=1/0,S=-1/0,P=this._getZoomSpan();for(var G in this._zoomBoundLayers){var ae=this._zoomBoundLayers[G].options;_=ae.minZoom===void 0?_:Math.min(_,ae.minZoom),S=ae.maxZoom===void 0?S:Math.max(S,ae.maxZoom)}this._layersMaxZoom=S===-1/0?void 0:S,this._layersMinZoom=_===1/0?void 0:_,P!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Bi=fr.extend({initialize:function(_,S){F(this,S),this._layers={};var P,G;if(_)for(P=0,G=_.length;P<G;P++)this.addLayer(_[P])},addLayer:function(_){var S=this.getLayerId(_);return this._layers[S]=_,this._map&&this._map.addLayer(_),this},removeLayer:function(_){var S=_ in this._layers?_:this.getLayerId(_);return this._map&&this._layers[S]&&this._map.removeLayer(this._layers[S]),delete this._layers[S],this},hasLayer:function(_){var S=typeof _=="number"?_:this.getLayerId(_);return S in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(_){var S=Array.prototype.slice.call(arguments,1),P,G;for(P in this._layers)G=this._layers[P],G[_]&&G[_].apply(G,S);return this},onAdd:function(_){this.eachLayer(_.addLayer,_)},onRemove:function(_){this.eachLayer(_.removeLayer,_)},eachLayer:function(_,S){for(var P in this._layers)_.call(S,this._layers[P]);return this},getLayer:function(_){return this._layers[_]},getLayers:function(){var _=[];return this.eachLayer(_.push,_),_},setZIndex:function(_){return this.invoke("setZIndex",_)},getLayerId:function(_){return v(_)}}),Bc=function(_,S){return new Bi(_,S)},fs=Bi.extend({addLayer:function(_){return this.hasLayer(_)?this:(_.addEventParent(this),Bi.prototype.addLayer.call(this,_),this.fire("layeradd",{layer:_}))},removeLayer:function(_){return this.hasLayer(_)?(_ in this._layers&&(_=this._layers[_]),_.removeEventParent(this),Bi.prototype.removeLayer.call(this,_),this.fire("layerremove",{layer:_})):this},setStyle:function(_){return this.invoke("setStyle",_)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var _=new mt;for(var S in this._layers){var P=this._layers[S];_.extend(P.getBounds?P.getBounds():P.getLatLng())}return _}}),wd=function(_,S){return new fs(_,S)},Fl=Ze.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(_){F(this,_)},createIcon:function(_){return this._createIcon("icon",_)},createShadow:function(_){return this._createIcon("shadow",_)},_createIcon:function(_,S){var P=this._getIconUrl(_);if(!P){if(_==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var G=this._createImg(P,S&&S.tagName==="IMG"?S:null);return this._setIconStyles(G,_),(this.options.crossOrigin||this.options.crossOrigin==="")&&(G.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),G},_setIconStyles:function(_,S){var P=this.options,G=P[S+"Size"];typeof G=="number"&&(G=[G,G]);var ae=Ke(G),ge=Ke(S==="shadow"&&P.shadowAnchor||P.iconAnchor||ae&&ae.divideBy(2,!0));_.className="leaflet-marker-"+S+" "+(P.className||""),ge&&(_.style.marginLeft=-ge.x+"px",_.style.marginTop=-ge.y+"px"),ae&&(_.style.width=ae.x+"px",_.style.height=ae.y+"px")},_createImg:function(_,S){return S=S||document.createElement("img"),S.src=_,S},_getIconUrl:function(_){return vn.retina&&this.options[_+"RetinaUrl"]||this.options[_+"Url"]}});function iS(_){return new Fl(_)}var Yf=Fl.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(_){return typeof Yf.imagePath!="string"&&(Yf.imagePath=this._detectIconPath()),(this.options.imagePath||Yf.imagePath)+Fl.prototype._getIconUrl.call(this,_)},_stripUrl:function(_){var S=function(P,G,ae){var ge=G.exec(P);return ge&&ge[ae]};return _=S(_,/^url\((['"])?(.+)\1\)$/,2),_&&S(_,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var _=Vr("div","leaflet-default-icon-path",document.body),S=_d(_,"background-image")||_d(_,"backgroundImage");if(document.body.removeChild(_),S=this._stripUrl(S),S)return S;var P=document.querySelector('link[href$="leaflet.css"]');return P?P.href.substring(0,P.href.length-11-1):""}}),Co=Li.extend({initialize:function(_){this._marker=_},addHooks:function(){var _=this._marker._icon;this._draggable||(this._draggable=new Ia(_,_,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Zt(_,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Oi(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(_){var S=this._marker,P=S._map,G=this._marker.options.autoPanSpeed,ae=this._marker.options.autoPanPadding,ge=To(S._icon),ke=P.getPixelBounds(),Xe=P.getPixelOrigin(),nt=rt(ke.min._subtract(Xe).add(ae),ke.max._subtract(Xe).subtract(ae));if(!nt.contains(ge)){var Tt=Ke((Math.max(nt.max.x,ge.x)-nt.max.x)/(ke.max.x-nt.max.x)-(Math.min(nt.min.x,ge.x)-nt.min.x)/(ke.min.x-nt.min.x),(Math.max(nt.max.y,ge.y)-nt.max.y)/(ke.max.y-nt.max.y)-(Math.min(nt.min.y,ge.y)-nt.min.y)/(ke.min.y-nt.min.y)).multiplyBy(G);P.panBy(Tt,{animate:!1}),this._draggable._newPos._add(Tt),this._draggable._startPos._add(Tt),qn(S._icon,this._draggable._newPos),this._onDrag(_),this._panRequest=pe(this._adjustPan.bind(this,_))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(_){this._marker.options.autoPan&&(be(this._panRequest),this._panRequest=pe(this._adjustPan.bind(this,_)))},_onDrag:function(_){var S=this._marker,P=S._shadow,G=To(S._icon),ae=S._map.layerPointToLatLng(G);P&&qn(P,G),S._latlng=ae,_.latlng=ae,_.oldLatLng=this._oldLatLng,S.fire("move",_).fire("drag",_)},_onDragEnd:function(_){be(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",_)}}),ug=fr.extend({options:{icon:new Yf,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(_,S){F(this,S),this._latlng=Ot(_)},onAdd:function(_){this._zoomAnimated=this._zoomAnimated&&_.options.markerZoomAnimation,this._zoomAnimated&&_.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(_){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&_.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(_){var S=this._latlng;return this._latlng=Ot(_),this.update(),this.fire("move",{oldLatLng:S,latlng:this._latlng})},setZIndexOffset:function(_){return this.options.zIndexOffset=_,this.update()},getIcon:function(){return this.options.icon},setIcon:function(_){return this.options.icon=_,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var _=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(_)}return this},_initIcon:function(){var _=this.options,S="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),P=_.icon.createIcon(this._icon),G=!1;P!==this._icon&&(this._icon&&this._removeIcon(),G=!0,_.title&&(P.title=_.title),P.tagName==="IMG"&&(P.alt=_.alt||"")),Zt(P,S),_.keyboard&&(P.tabIndex="0",P.setAttribute("role","button")),this._icon=P,_.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Dn(P,"focus",this._panOnFocus,this);var ae=_.icon.createShadow(this._shadow),ge=!1;ae!==this._shadow&&(this._removeShadow(),ge=!0),ae&&(Zt(ae,S),ae.alt=""),this._shadow=ae,_.opacity<1&&this._updateOpacity(),G&&this.getPane().appendChild(this._icon),this._initInteraction(),ae&&ge&&this.getPane(_.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Ei(this._icon,"focus",this._panOnFocus,this),Ni(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Ni(this._shadow),this._shadow=null},_setPos:function(_){this._icon&&qn(this._icon,_),this._shadow&&qn(this._shadow,_),this._zIndex=_.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(_){this._icon&&(this._icon.style.zIndex=this._zIndex+_)},_animateZoom:function(_){var S=this._map._latLngToNewLayerPoint(this._latlng,_.zoom,_.center).round();this._setPos(S)},_initInteraction:function(){if(this.options.interactive&&(Zt(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Co)){var _=this.options.draggable;this.dragging&&(_=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Co(this),_&&this.dragging.enable()}},setOpacity:function(_){return this.options.opacity=_,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var _=this.options.opacity;this._icon&&hs(this._icon,_),this._shadow&&hs(this._shadow,_)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var _=this._map;if(_){var S=this.options.icon.options,P=S.iconSize?Ke(S.iconSize):Ke(0,0),G=S.iconAnchor?Ke(S.iconAnchor):Ke(0,0);_.panInside(this._latlng,{paddingTopLeft:G,paddingBottomRight:P.subtract(G)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Cp(_,S){return new ug(_,S)}var uu=fr.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(_){this._renderer=_.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(_){return F(this,_),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&_&&Object.prototype.hasOwnProperty.call(_,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),hg=uu.extend({options:{fill:!0,radius:10},initialize:function(_,S){F(this,S),this._latlng=Ot(_),this._radius=this.options.radius},setLatLng:function(_){var S=this._latlng;return this._latlng=Ot(_),this.redraw(),this.fire("move",{oldLatLng:S,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(_){return this.options.radius=this._radius=_,this.redraw()},getRadius:function(){return this._radius},setStyle:function(_){var S=_&&_.radius||this._radius;return uu.prototype.setStyle.call(this,_),this.setRadius(S),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var _=this._radius,S=this._radiusY||_,P=this._clickTolerance(),G=[_+P,S+P];this._pxBounds=new Rt(this._point.subtract(G),this._point.add(G))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(_){return _.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function $f(_,S){return new hg(_,S)}var pg=hg.extend({initialize:function(_,S,P){if(typeof S=="number"&&(S=l({},P,{radius:S})),F(this,S),this._latlng=Ot(_),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(_){return this._mRadius=_,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var _=[this._radius,this._radiusY||this._radius];return new mt(this._map.layerPointToLatLng(this._point.subtract(_)),this._map.layerPointToLatLng(this._point.add(_)))},setStyle:uu.prototype.setStyle,_project:function(){var _=this._latlng.lng,S=this._latlng.lat,P=this._map,G=P.options.crs;if(G.distance===zt.distance){var ae=Math.PI/180,ge=this._mRadius/zt.R/ae,ke=P.project([S+ge,_]),Xe=P.project([S-ge,_]),nt=ke.add(Xe).divideBy(2),Tt=P.unproject(nt).lat,Jt=Math.acos((Math.cos(ge*ae)-Math.sin(S*ae)*Math.sin(Tt*ae))/(Math.cos(S*ae)*Math.cos(Tt*ae)))/ae;(isNaN(Jt)||Jt===0)&&(Jt=ge/Math.cos(Math.PI/180*S)),this._point=nt.subtract(P.getPixelOrigin()),this._radius=isNaN(Jt)?0:nt.x-P.project([Tt,_-Jt]).x,this._radiusY=nt.y-ke.y}else{var Tn=G.unproject(G.project(this._latlng).subtract([this._mRadius,0]));this._point=P.latLngToLayerPoint(this._latlng),this._radius=this._point.x-P.latLngToLayerPoint(Tn).x}this._updateBounds()}});function hu(_,S,P){return new pg(_,S,P)}var oc=uu.extend({options:{smoothFactor:1,noClip:!1},initialize:function(_,S){F(this,S),this._setLatLngs(_)},getLatLngs:function(){return this._latlngs},setLatLngs:function(_){return this._setLatLngs(_),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(_){for(var S=1/0,P=null,G=Fc,ae,ge,ke=0,Xe=this._parts.length;ke<Xe;ke++)for(var nt=this._parts[ke],Tt=1,Jt=nt.length;Tt<Jt;Tt++){ae=nt[Tt-1],ge=nt[Tt];var Tn=G(_,ae,ge,!0);Tn<S&&(S=Tn,P=G(_,ae,ge))}return P&&(P.distance=Math.sqrt(S)),P},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return le(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(_,S){return S=S||this._defaultShape(),_=Ot(_),S.push(_),this._bounds.extend(_),this.redraw()},_setLatLngs:function(_){this._bounds=new mt,this._latlngs=this._convertLatLngs(_)},_defaultShape:function(){return k(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(_){for(var S=[],P=k(_),G=0,ae=_.length;G<ae;G++)P?(S[G]=Ot(_[G]),this._bounds.extend(S[G])):S[G]=this._convertLatLngs(_[G]);return S},_project:function(){var _=new Rt;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,_),this._bounds.isValid()&&_.isValid()&&(this._rawPxBounds=_,this._updateBounds())},_updateBounds:function(){var _=this._clickTolerance(),S=new Le(_,_);this._rawPxBounds&&(this._pxBounds=new Rt([this._rawPxBounds.min.subtract(S),this._rawPxBounds.max.add(S)]))},_projectLatlngs:function(_,S,P){var G=_[0]instanceof Ct,ae=_.length,ge,ke;if(G){for(ke=[],ge=0;ge<ae;ge++)ke[ge]=this._map.latLngToLayerPoint(_[ge]),P.extend(ke[ge]);S.push(ke)}else for(ge=0;ge<ae;ge++)this._projectLatlngs(_[ge],S,P)},_clipPoints:function(){var _=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(_))){if(this.options.noClip){this._parts=this._rings;return}var S=this._parts,P,G,ae,ge,ke,Xe,nt;for(P=0,ae=0,ge=this._rings.length;P<ge;P++)for(nt=this._rings[P],G=0,ke=nt.length;G<ke-1;G++)Xe=In(nt[G],nt[G+1],_,G,!0),Xe&&(S[ae]=S[ae]||[],S[ae].push(Xe[0]),(Xe[1]!==nt[G+1]||G===ke-2)&&(S[ae].push(Xe[1]),ae++))}},_simplifyPoints:function(){for(var _=this._parts,S=this.options.smoothFactor,P=0,G=_.length;P<G;P++)_[P]=Ii(_[P],S)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(_,S){var P,G,ae,ge,ke,Xe,nt=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(_))return!1;for(P=0,ge=this._parts.length;P<ge;P++)for(Xe=this._parts[P],G=0,ke=Xe.length,ae=ke-1;G<ke;ae=G++)if(!(!S&&G===0)&&Vc(_,Xe[ae],Xe[G])<=nt)return!0;return!1}});function w0(_,S){return new oc(_,S)}oc._flat=ee;var Np=oc.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return ic(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(_){var S=oc.prototype._convertLatLngs.call(this,_),P=S.length;return P>=2&&S[0]instanceof Ct&&S[0].equals(S[P-1])&&S.pop(),S},_setLatLngs:function(_){oc.prototype._setLatLngs.call(this,_),k(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return k(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var _=this._renderer._bounds,S=this.options.weight,P=new Le(S,S);if(_=new Rt(_.min.subtract(P),_.max.add(P)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(_))){if(this.options.noClip){this._parts=this._rings;return}for(var G=0,ae=this._rings.length,ge;G<ae;G++)ge=ul(this._rings[G],_,!0),ge.length&&this._parts.push(ge)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(_){var S=!1,P,G,ae,ge,ke,Xe,nt,Tt;if(!this._pxBounds||!this._pxBounds.contains(_))return!1;for(ge=0,nt=this._parts.length;ge<nt;ge++)for(P=this._parts[ge],ke=0,Tt=P.length,Xe=Tt-1;ke<Tt;Xe=ke++)G=P[ke],ae=P[Xe],G.y>_.y!=ae.y>_.y&&_.x<(ae.x-G.x)*(_.y-G.y)/(ae.y-G.y)+G.x&&(S=!S);return S||oc.prototype._containsPoint.call(this,_,!0)}});function sS(_,S){return new Np(_,S)}var Aa=fs.extend({initialize:function(_,S){F(this,S),this._layers={},_&&this.addData(_)},addData:function(_){var S=X(_)?_:_.features,P,G,ae;if(S){for(P=0,G=S.length;P<G;P++)ae=S[P],(ae.geometries||ae.geometry||ae.features||ae.coordinates)&&this.addData(ae);return this}var ge=this.options;if(ge.filter&&!ge.filter(_))return this;var ke=No(_,ge);return ke?(ke.feature=Sd(_),ke.defaultOptions=ke.options,this.resetStyle(ke),ge.onEachFeature&&ge.onEachFeature(_,ke),this.addLayer(ke)):this},resetStyle:function(_){return _===void 0?this.eachLayer(this.resetStyle,this):(_.options=l({},_.defaultOptions),this._setLayerStyle(_,this.options.style),this)},setStyle:function(_){return this.eachLayer(function(S){this._setLayerStyle(S,_)},this)},_setLayerStyle:function(_,S){_.setStyle&&(typeof S=="function"&&(S=S(_.feature)),_.setStyle(S))}});function No(_,S){var P=_.type==="Feature"?_.geometry:_,G=P?P.coordinates:null,ae=[],ge=S&&S.pointToLayer,ke=S&&S.coordsToLatLng||T0,Xe,nt,Tt,Jt;if(!G&&!P)return null;switch(P.type){case"Point":return Xe=ke(G),S0(ge,_,Xe,S);case"MultiPoint":for(Tt=0,Jt=G.length;Tt<Jt;Tt++)Xe=ke(G[Tt]),ae.push(S0(ge,_,Xe,S));return new fs(ae);case"LineString":case"MultiLineString":return nt=hl(G,P.type==="LineString"?0:1,ke),new oc(nt,S);case"Polygon":case"MultiPolygon":return nt=hl(G,P.type==="Polygon"?1:2,ke),new Np(nt,S);case"GeometryCollection":for(Tt=0,Jt=P.geometries.length;Tt<Jt;Tt++){var Tn=No({geometry:P.geometries[Tt],type:"Feature",properties:_.properties},S);Tn&&ae.push(Tn)}return new fs(ae);case"FeatureCollection":for(Tt=0,Jt=P.features.length;Tt<Jt;Tt++){var nr=No(P.features[Tt],S);nr&&ae.push(nr)}return new fs(ae);default:throw new Error("Invalid GeoJSON object.")}}function S0(_,S,P,G){return _?_(S,P):new ug(P,G&&G.markersInheritOptions&&G)}function T0(_){return new Ct(_[1],_[0],_[2])}function hl(_,S,P){for(var G=[],ae=0,ge=_.length,ke;ae<ge;ae++)ke=S?hl(_[ae],S-1,P):(P||T0)(_[ae]),G.push(ke);return G}function R0(_,S){return _=Ot(_),_.alt!==void 0?[A(_.lng,S),A(_.lat,S),A(_.alt,S)]:[A(_.lng,S),A(_.lat,S)]}function fg(_,S,P,G){for(var ae=[],ge=0,ke=_.length;ge<ke;ge++)ae.push(S?fg(_[ge],k(_[ge])?0:S-1,P,G):R0(_[ge],G));return!S&&P&&ae.length>0&&ae.push(ae[0].slice()),ae}function zs(_,S){return _.feature?l({},_.feature,{geometry:S}):Sd(S)}function Sd(_){return _.type==="Feature"||_.type==="FeatureCollection"?_:{type:"Feature",properties:{},geometry:_}}var Ve={toGeoJSON:function(_){return zs(this,{type:"Point",coordinates:R0(this.getLatLng(),_)})}};ug.include(Ve),pg.include(Ve),hg.include(Ve),oc.include({toGeoJSON:function(_){var S=!k(this._latlngs),P=fg(this._latlngs,S?1:0,!1,_);return zs(this,{type:(S?"Multi":"")+"LineString",coordinates:P})}}),Np.include({toGeoJSON:function(_){var S=!k(this._latlngs),P=S&&!k(this._latlngs[0]),G=fg(this._latlngs,P?2:S?1:0,!0,_);return S||(G=[G]),zs(this,{type:(P?"Multi":"")+"Polygon",coordinates:G})}}),Bi.include({toMultiPoint:function(_){var S=[];return this.eachLayer(function(P){S.push(P.toGeoJSON(_).geometry.coordinates)}),zs(this,{type:"MultiPoint",coordinates:S})},toGeoJSON:function(_){var S=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(S==="MultiPoint")return this.toMultiPoint(_);var P=S==="GeometryCollection",G=[];return this.eachLayer(function(ae){if(ae.toGeoJSON){var ge=ae.toGeoJSON(_);if(P)G.push(ge.geometry);else{var ke=Sd(ge);ke.type==="FeatureCollection"?G.push.apply(G,ke.features):G.push(ke)}}}),P?zs(this,{geometries:G,type:"GeometryCollection"}):{type:"FeatureCollection",features:G}}});function ut(_,S){return new Aa(_,S)}var st=ut,en=fr.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(_,S,P){this._url=_,this._bounds=yt(S),F(this,P)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Zt(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Ni(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(_){return this.options.opacity=_,this._image&&this._updateOpacity(),this},setStyle:function(_){return _.opacity&&this.setOpacity(_.opacity),this},bringToFront:function(){return this._map&&so(this._image),this},bringToBack:function(){return this._map&&jc(this._image),this},setUrl:function(_){return this._url=_,this._image&&(this._image.src=_),this},setBounds:function(_){return this._bounds=yt(_),this._map&&this._reset(),this},getEvents:function(){var _={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(_.zoomanim=this._animateZoom),_},setZIndex:function(_){return this.options.zIndex=_,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var _=this._url.tagName==="IMG",S=this._image=_?this._url:Vr("img");if(Zt(S,"leaflet-image-layer"),this._zoomAnimated&&Zt(S,"leaflet-zoom-animated"),this.options.className&&Zt(S,this.options.className),S.onselectstart=C,S.onmousemove=C,S.onload=p(this.fire,this,"load"),S.onerror=p(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(S.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),_){this._url=S.src;return}S.src=this._url,S.alt=this.options.alt},_animateZoom:function(_){var S=this._map.getZoomScale(_.zoom),P=this._map._latLngBoundsToNewLayerBounds(this._bounds,_.zoom,_.center).min;Ul(this._image,P,S)},_reset:function(){var _=this._image,S=new Rt(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),P=S.getSize();qn(_,S.min),_.style.width=P.x+"px",_.style.height=P.y+"px"},_updateOpacity:function(){hs(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var _=this.options.errorOverlayUrl;_&&this._url!==_&&(this._url=_,this._image.src=_)},getCenter:function(){return this._bounds.getCenter()}}),Zn=function(_,S,P){return new en(_,S,P)},si=en.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var _=this._url.tagName==="VIDEO",S=this._image=_?this._url:Vr("video");if(Zt(S,"leaflet-image-layer"),this._zoomAnimated&&Zt(S,"leaflet-zoom-animated"),this.options.className&&Zt(S,this.options.className),S.onselectstart=C,S.onmousemove=C,S.onloadeddata=p(this.fire,this,"load"),_){for(var P=S.getElementsByTagName("source"),G=[],ae=0;ae<P.length;ae++)G.push(P[ae].src);this._url=P.length>0?G:[S.src];return}X(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(S.style,"objectFit")&&(S.style.objectFit="fill"),S.autoplay=!!this.options.autoplay,S.loop=!!this.options.loop,S.muted=!!this.options.muted,S.playsInline=!!this.options.playsInline;for(var ge=0;ge<this._url.length;ge++){var ke=Vr("source");ke.src=this._url[ge],S.appendChild(ke)}}});function aa(_,S,P){return new si(_,S,P)}var xi=en.extend({_initImage:function(){var _=this._image=this._url;Zt(_,"leaflet-image-layer"),this._zoomAnimated&&Zt(_,"leaflet-zoom-animated"),this.options.className&&Zt(_,this.options.className),_.onselectstart=C,_.onmousemove=C}});function C0(_,S,P){return new xi(_,S,P)}var Bl=fr.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(_,S){_&&(_ instanceof Ct||X(_))?(this._latlng=Ot(_),F(this,S)):(F(this,_),this._source=S),this.options.content&&(this._content=this.options.content)},openOn:function(_){return _=arguments.length?_:this._source._map,_.hasLayer(this)||_.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(_){return this._map?this.close():(arguments.length?this._source=_:_=this._source,this._prepareOpen(),this.openOn(_._map)),this},onAdd:function(_){this._zoomAnimated=_._zoomAnimated,this._container||this._initLayout(),_._fadeAnimated&&hs(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),_._fadeAnimated&&hs(this._container,1),this.bringToFront(),this.options.interactive&&(Zt(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(_){_._fadeAnimated?(hs(this._container,0),this._removeTimeout=setTimeout(p(Ni,void 0,this._container),200)):Ni(this._container),this.options.interactive&&(Oi(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(_){return this._latlng=Ot(_),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(_){return this._content=_,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var _={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(_.zoomanim=this._animateZoom),_},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&so(this._container),this},bringToBack:function(){return this._map&&jc(this._container),this},_prepareOpen:function(_){var S=this._source;if(!S._map)return!1;if(S instanceof fs){S=null;var P=this._source._layers;for(var G in P)if(P[G]._map){S=P[G];break}if(!S)return!1;this._source=S}if(!_)if(S.getCenter)_=S.getCenter();else if(S.getLatLng)_=S.getLatLng();else if(S.getBounds)_=S.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(_),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var _=this._contentNode,S=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof S=="string")_.innerHTML=S;else{for(;_.hasChildNodes();)_.removeChild(_.firstChild);_.appendChild(S)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var _=this._map.latLngToLayerPoint(this._latlng),S=Ke(this.options.offset),P=this._getAnchor();this._zoomAnimated?qn(this._container,_.add(P)):S=S.add(_).add(P);var G=this._containerBottom=-S.y,ae=this._containerLeft=-Math.round(this._containerWidth/2)+S.x;this._container.style.bottom=G+"px",this._container.style.left=ae+"px"}},_getAnchor:function(){return[0,0]}});kr.include({_initOverlay:function(_,S,P,G){var ae=S;return ae instanceof _||(ae=new _(G).setContent(S)),P&&ae.setLatLng(P),ae}}),fr.include({_initOverlay:function(_,S,P,G){var ae=P;return ae instanceof _?(F(ae,G),ae._source=this):(ae=S&&!G?S:new _(G,this),ae.setContent(P)),ae}});var ka=Bl.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(_){return _=arguments.length?_:this._source._map,!_.hasLayer(this)&&_._popup&&_._popup.options.autoClose&&_.removeLayer(_._popup),_._popup=this,Bl.prototype.openOn.call(this,_)},onAdd:function(_){Bl.prototype.onAdd.call(this,_),_.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof uu||this._source.on("preclick",Uc))},onRemove:function(_){Bl.prototype.onRemove.call(this,_),_.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof uu||this._source.off("preclick",Uc))},getEvents:function(){var _=Bl.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(_.preclick=this.close),this.options.keepInView&&(_.moveend=this._adjustPan),_},_initLayout:function(){var _="leaflet-popup",S=this._container=Vr("div",_+" "+(this.options.className||"")+" leaflet-zoom-animated"),P=this._wrapper=Vr("div",_+"-content-wrapper",S);if(this._contentNode=Vr("div",_+"-content",P),lu(S),cu(this._contentNode),Dn(S,"contextmenu",Uc),this._tipContainer=Vr("div",_+"-tip-container",S),this._tip=Vr("div",_+"-tip",this._tipContainer),this.options.closeButton){var G=this._closeButton=Vr("a",_+"-close-button",S);G.setAttribute("role","button"),G.setAttribute("aria-label","Close popup"),G.href="#close",G.innerHTML='<span aria-hidden="true">&#215;</span>',Dn(G,"click",function(ae){Yn(ae),this.close()},this)}},_updateLayout:function(){var _=this._contentNode,S=_.style;S.width="",S.whiteSpace="nowrap";var P=_.offsetWidth;P=Math.min(P,this.options.maxWidth),P=Math.max(P,this.options.minWidth),S.width=P+1+"px",S.whiteSpace="",S.height="";var G=_.offsetHeight,ae=this.options.maxHeight,ge="leaflet-popup-scrolled";ae&&G>ae?(S.height=ae+"px",Zt(_,ge)):Oi(_,ge),this._containerWidth=this._container.offsetWidth},_animateZoom:function(_){var S=this._map._latLngToNewLayerPoint(this._latlng,_.zoom,_.center),P=this._getAnchor();qn(this._container,S.add(P))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var _=this._map,S=parseInt(_d(this._container,"marginBottom"),10)||0,P=this._container.offsetHeight+S,G=this._containerWidth,ae=new Le(this._containerLeft,-P-this._containerBottom);ae._add(To(this._container));var ge=_.layerPointToContainerPoint(ae),ke=Ke(this.options.autoPanPadding),Xe=Ke(this.options.autoPanPaddingTopLeft||ke),nt=Ke(this.options.autoPanPaddingBottomRight||ke),Tt=_.getSize(),Jt=0,Tn=0;ge.x+G+nt.x>Tt.x&&(Jt=ge.x+G-Tt.x+nt.x),ge.x-Jt-Xe.x<0&&(Jt=ge.x-Xe.x),ge.y+P+nt.y>Tt.y&&(Tn=ge.y+P-Tt.y+nt.y),ge.y-Tn-Xe.y<0&&(Tn=ge.y-Xe.y),(Jt||Tn)&&(this.options.keepInView&&(this._autopanning=!0),_.fire("autopanstart").panBy([Jt,Tn]))}},_getAnchor:function(){return Ke(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Ip=function(_,S){return new ka(_,S)};kr.mergeOptions({closePopupOnClick:!0}),kr.include({openPopup:function(_,S,P){return this._initOverlay(ka,_,S,P).openOn(this),this},closePopup:function(_){return _=arguments.length?_:this._popup,_&&_.close(),this}}),fr.include({bindPopup:function(_,S){return this._popup=this._initOverlay(ka,this._popup,_,S),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(_){return this._popup&&(this instanceof fs||(this._popup._source=this),this._popup._prepareOpen(_||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(_){return this._popup&&this._popup.setContent(_),this},getPopup:function(){return this._popup},_openPopup:function(_){if(!(!this._popup||!this._map)){vr(_);var S=_.layer||_.target;if(this._popup._source===S&&!(S instanceof uu)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(_.latlng);return}this._popup._source=S,this.openPopup(_.latlng)}},_movePopup:function(_){this._popup.setLatLng(_.latlng)},_onKeyPress:function(_){_.originalEvent.keyCode===13&&this._openPopup(_)}});var mg=Bl.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(_){Bl.prototype.onAdd.call(this,_),this.setOpacity(this.options.opacity),_.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(_){Bl.prototype.onRemove.call(this,_),_.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var _=Bl.prototype.getEvents.call(this);return this.options.permanent||(_.preclick=this.close),_},_initLayout:function(){var _="leaflet-tooltip",S=_+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Vr("div",S),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+v(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(_){var S,P,G=this._map,ae=this._container,ge=G.latLngToContainerPoint(G.getCenter()),ke=G.layerPointToContainerPoint(_),Xe=this.options.direction,nt=ae.offsetWidth,Tt=ae.offsetHeight,Jt=Ke(this.options.offset),Tn=this._getAnchor();Xe==="top"?(S=nt/2,P=Tt):Xe==="bottom"?(S=nt/2,P=0):Xe==="center"?(S=nt/2,P=Tt/2):Xe==="right"?(S=0,P=Tt/2):Xe==="left"?(S=nt,P=Tt/2):ke.x<ge.x?(Xe="right",S=0,P=Tt/2):(Xe="left",S=nt+(Jt.x+Tn.x)*2,P=Tt/2),_=_.subtract(Ke(S,P,!0)).add(Jt).add(Tn),Oi(ae,"leaflet-tooltip-right"),Oi(ae,"leaflet-tooltip-left"),Oi(ae,"leaflet-tooltip-top"),Oi(ae,"leaflet-tooltip-bottom"),Zt(ae,"leaflet-tooltip-"+Xe),qn(ae,_)},_updatePosition:function(){var _=this._map.latLngToLayerPoint(this._latlng);this._setPosition(_)},setOpacity:function(_){this.options.opacity=_,this._container&&hs(this._container,_)},_animateZoom:function(_){var S=this._map._latLngToNewLayerPoint(this._latlng,_.zoom,_.center);this._setPosition(S)},_getAnchor:function(){return Ke(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Ge=function(_,S){return new mg(_,S)};kr.include({openTooltip:function(_,S,P){return this._initOverlay(mg,_,S,P).openOn(this),this},closeTooltip:function(_){return _.close(),this}}),fr.include({bindTooltip:function(_,S){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(mg,this._tooltip,_,S),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(_){if(!(!_&&this._tooltipHandlersAdded)){var S=_?"off":"on",P={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?P.add=this._openTooltip:(P.mouseover=this._openTooltip,P.mouseout=this.closeTooltip,P.click=this._openTooltip,this._map?this._addFocusListeners():P.add=this._addFocusListeners),this._tooltip.options.sticky&&(P.mousemove=this._moveTooltip),this[S](P),this._tooltipHandlersAdded=!_}},openTooltip:function(_){return this._tooltip&&(this instanceof fs||(this._tooltip._source=this),this._tooltip._prepareOpen(_)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(_){return this._tooltip&&this._tooltip.setContent(_),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(_){var S=typeof _.getElement=="function"&&_.getElement();S&&(Dn(S,"focus",function(){this._tooltip._source=_,this.openTooltip()},this),Dn(S,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(_){var S=typeof _.getElement=="function"&&_.getElement();S&&S.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(_){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var S=this;this._map.once("moveend",function(){S._openOnceFlag=!1,S._openTooltip(_)});return}this._tooltip._source=_.layer||_.target,this.openTooltip(this._tooltip.options.sticky?_.latlng:void 0)}},_moveTooltip:function(_){var S=_.latlng,P,G;this._tooltip.options.sticky&&_.originalEvent&&(P=this._map.mouseEventToContainerPoint(_.originalEvent),G=this._map.containerPointToLayerPoint(P),S=this._map.layerPointToLatLng(G)),this._tooltip.setLatLng(S)}});var Xf=Fl.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(_){var S=_&&_.tagName==="DIV"?_:document.createElement("div"),P=this.options;if(P.html instanceof Element?(su(S),S.appendChild(P.html)):S.innerHTML=P.html!==!1?P.html:"",P.bgPos){var G=Ke(P.bgPos);S.style.backgroundPosition=-G.x+"px "+-G.y+"px"}return this._setIconStyles(S,"icon"),S},createShadow:function(){return null}});function gg(_){return new Xf(_)}Fl.Default=Yf;var Hr=fr.extend({options:{tileSize:256,opacity:1,updateWhenIdle:vn.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(_){F(this,_)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(_){_._addZoomLimit(this)},onRemove:function(_){this._removeAllTiles(),Ni(this._container),_._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(so(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(jc(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(_){return this.options.opacity=_,this._updateOpacity(),this},setZIndex:function(_){return this.options.zIndex=_,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var _=this._clampZoom(this._map.getZoom());_!==this._tileZoom&&(this._tileZoom=_,this._updateLevels()),this._update()}return this},getEvents:function(){var _={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=w(this._onMoveEnd,this.options.updateInterval,this)),_.move=this._onMove),this._zoomAnimated&&(_.zoomanim=this._animateZoom),_},createTile:function(){return document.createElement("div")},getTileSize:function(){var _=this.options.tileSize;return _ instanceof Le?_:new Le(_,_)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(_){for(var S=this.getPane().children,P=-_(-1/0,1/0),G=0,ae=S.length,ge;G<ae;G++)ge=S[G].style.zIndex,S[G]!==this._container&&ge&&(P=_(P,+ge));isFinite(P)&&(this.options.zIndex=P+_(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!vn.ielt9){hs(this._container,this.options.opacity);var _=+new Date,S=!1,P=!1;for(var G in this._tiles){var ae=this._tiles[G];if(!(!ae.current||!ae.loaded)){var ge=Math.min(1,(_-ae.loaded)/200);hs(ae.el,ge),ge<1?S=!0:(ae.active?P=!0:this._onOpaqueTile(ae),ae.active=!0)}}P&&!this._noPrune&&this._pruneTiles(),S&&(be(this._fadeFrame),this._fadeFrame=pe(this._updateOpacity,this))}},_onOpaqueTile:C,_initContainer:function(){this._container||(this._container=Vr("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var _=this._tileZoom,S=this.options.maxZoom;if(_!==void 0){for(var P in this._levels)P=Number(P),this._levels[P].el.children.length||P===_?(this._levels[P].el.style.zIndex=S-Math.abs(_-P),this._onUpdateLevel(P)):(Ni(this._levels[P].el),this._removeTilesAtZoom(P),this._onRemoveLevel(P),delete this._levels[P]);var G=this._levels[_],ae=this._map;return G||(G=this._levels[_]={},G.el=Vr("div","leaflet-tile-container leaflet-zoom-animated",this._container),G.el.style.zIndex=S,G.origin=ae.project(ae.unproject(ae.getPixelOrigin()),_).round(),G.zoom=_,this._setZoomTransform(G,ae.getCenter(),ae.getZoom()),C(G.el.offsetWidth),this._onCreateLevel(G)),this._level=G,G}},_onUpdateLevel:C,_onRemoveLevel:C,_onCreateLevel:C,_pruneTiles:function(){if(this._map){var _,S,P=this._map.getZoom();if(P>this.options.maxZoom||P<this.options.minZoom){this._removeAllTiles();return}for(_ in this._tiles)S=this._tiles[_],S.retain=S.current;for(_ in this._tiles)if(S=this._tiles[_],S.current&&!S.active){var G=S.coords;this._retainParent(G.x,G.y,G.z,G.z-5)||this._retainChildren(G.x,G.y,G.z,G.z+2)}for(_ in this._tiles)this._tiles[_].retain||this._removeTile(_)}},_removeTilesAtZoom:function(_){for(var S in this._tiles)this._tiles[S].coords.z===_&&this._removeTile(S)},_removeAllTiles:function(){for(var _ in this._tiles)this._removeTile(_)},_invalidateAll:function(){for(var _ in this._levels)Ni(this._levels[_].el),this._onRemoveLevel(Number(_)),delete this._levels[_];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(_,S,P,G){var ae=Math.floor(_/2),ge=Math.floor(S/2),ke=P-1,Xe=new Le(+ae,+ge);Xe.z=+ke;var nt=this._tileCoordsToKey(Xe),Tt=this._tiles[nt];return Tt&&Tt.active?(Tt.retain=!0,!0):(Tt&&Tt.loaded&&(Tt.retain=!0),ke>G?this._retainParent(ae,ge,ke,G):!1)},_retainChildren:function(_,S,P,G){for(var ae=2*_;ae<2*_+2;ae++)for(var ge=2*S;ge<2*S+2;ge++){var ke=new Le(ae,ge);ke.z=P+1;var Xe=this._tileCoordsToKey(ke),nt=this._tiles[Xe];if(nt&&nt.active){nt.retain=!0;continue}else nt&&nt.loaded&&(nt.retain=!0);P+1<G&&this._retainChildren(ae,ge,P+1,G)}},_resetView:function(_){var S=_&&(_.pinch||_.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),S,S)},_animateZoom:function(_){this._setView(_.center,_.zoom,!0,_.noUpdate)},_clampZoom:function(_){var S=this.options;return S.minNativeZoom!==void 0&&_<S.minNativeZoom?S.minNativeZoom:S.maxNativeZoom!==void 0&&S.maxNativeZoom<_?S.maxNativeZoom:_},_setView:function(_,S,P,G){var ae=Math.round(S);this.options.maxZoom!==void 0&&ae>this.options.maxZoom||this.options.minZoom!==void 0&&ae<this.options.minZoom?ae=void 0:ae=this._clampZoom(ae);var ge=this.options.updateWhenZooming&&ae!==this._tileZoom;(!G||ge)&&(this._tileZoom=ae,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),ae!==void 0&&this._update(_),P||this._pruneTiles(),this._noPrune=!!P),this._setZoomTransforms(_,S)},_setZoomTransforms:function(_,S){for(var P in this._levels)this._setZoomTransform(this._levels[P],_,S)},_setZoomTransform:function(_,S,P){var G=this._map.getZoomScale(P,_.zoom),ae=_.origin.multiplyBy(G).subtract(this._map._getNewPixelOrigin(S,P)).round();vn.any3d?Ul(_.el,ae,G):qn(_.el,ae)},_resetGrid:function(){var _=this._map,S=_.options.crs,P=this._tileSize=this.getTileSize(),G=this._tileZoom,ae=this._map.getPixelWorldBounds(this._tileZoom);ae&&(this._globalTileRange=this._pxBoundsToTileRange(ae)),this._wrapX=S.wrapLng&&!this.options.noWrap&&[Math.floor(_.project([0,S.wrapLng[0]],G).x/P.x),Math.ceil(_.project([0,S.wrapLng[1]],G).x/P.y)],this._wrapY=S.wrapLat&&!this.options.noWrap&&[Math.floor(_.project([S.wrapLat[0],0],G).y/P.x),Math.ceil(_.project([S.wrapLat[1],0],G).y/P.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(_){var S=this._map,P=S._animatingZoom?Math.max(S._animateToZoom,S.getZoom()):S.getZoom(),G=S.getZoomScale(P,this._tileZoom),ae=S.project(_,this._tileZoom).floor(),ge=S.getSize().divideBy(G*2);return new Rt(ae.subtract(ge),ae.add(ge))},_update:function(_){var S=this._map;if(S){var P=this._clampZoom(S.getZoom());if(_===void 0&&(_=S.getCenter()),this._tileZoom!==void 0){var G=this._getTiledPixelBounds(_),ae=this._pxBoundsToTileRange(G),ge=ae.getCenter(),ke=[],Xe=this.options.keepBuffer,nt=new Rt(ae.getBottomLeft().subtract([Xe,-Xe]),ae.getTopRight().add([Xe,-Xe]));if(!(isFinite(ae.min.x)&&isFinite(ae.min.y)&&isFinite(ae.max.x)&&isFinite(ae.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Tt in this._tiles){var Jt=this._tiles[Tt].coords;(Jt.z!==this._tileZoom||!nt.contains(new Le(Jt.x,Jt.y)))&&(this._tiles[Tt].current=!1)}if(Math.abs(P-this._tileZoom)>1){this._setView(_,P);return}for(var Tn=ae.min.y;Tn<=ae.max.y;Tn++)for(var nr=ae.min.x;nr<=ae.max.x;nr++){var Gs=new Le(nr,Tn);if(Gs.z=this._tileZoom,!!this._isValidTile(Gs)){var bs=this._tiles[this._tileCoordsToKey(Gs)];bs?bs.current=!0:ke.push(Gs)}}if(ke.sort(function(Pa,pl){return Pa.distanceTo(ge)-pl.distanceTo(ge)}),ke.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Ha=document.createDocumentFragment();for(nr=0;nr<ke.length;nr++)this._addTile(ke[nr],Ha);this._level.el.appendChild(Ha)}}}},_isValidTile:function(_){var S=this._map.options.crs;if(!S.infinite){var P=this._globalTileRange;if(!S.wrapLng&&(_.x<P.min.x||_.x>P.max.x)||!S.wrapLat&&(_.y<P.min.y||_.y>P.max.y))return!1}if(!this.options.bounds)return!0;var G=this._tileCoordsToBounds(_);return yt(this.options.bounds).overlaps(G)},_keyToBounds:function(_){return this._tileCoordsToBounds(this._keyToTileCoords(_))},_tileCoordsToNwSe:function(_){var S=this._map,P=this.getTileSize(),G=_.scaleBy(P),ae=G.add(P),ge=S.unproject(G,_.z),ke=S.unproject(ae,_.z);return[ge,ke]},_tileCoordsToBounds:function(_){var S=this._tileCoordsToNwSe(_),P=new mt(S[0],S[1]);return this.options.noWrap||(P=this._map.wrapLatLngBounds(P)),P},_tileCoordsToKey:function(_){return _.x+":"+_.y+":"+_.z},_keyToTileCoords:function(_){var S=_.split(":"),P=new Le(+S[0],+S[1]);return P.z=+S[2],P},_removeTile:function(_){var S=this._tiles[_];S&&(Ni(S.el),delete this._tiles[_],this.fire("tileunload",{tile:S.el,coords:this._keyToTileCoords(_)}))},_initTile:function(_){Zt(_,"leaflet-tile");var S=this.getTileSize();_.style.width=S.x+"px",_.style.height=S.y+"px",_.onselectstart=C,_.onmousemove=C,vn.ielt9&&this.options.opacity<1&&hs(_,this.options.opacity)},_addTile:function(_,S){var P=this._getTilePos(_),G=this._tileCoordsToKey(_),ae=this.createTile(this._wrapCoords(_),p(this._tileReady,this,_));this._initTile(ae),this.createTile.length<2&&pe(p(this._tileReady,this,_,null,ae)),qn(ae,P),this._tiles[G]={el:ae,coords:_,current:!0},S.appendChild(ae),this.fire("tileloadstart",{tile:ae,coords:_})},_tileReady:function(_,S,P){S&&this.fire("tileerror",{error:S,tile:P,coords:_});var G=this._tileCoordsToKey(_);P=this._tiles[G],P&&(P.loaded=+new Date,this._map._fadeAnimated?(hs(P.el,0),be(this._fadeFrame),this._fadeFrame=pe(this._updateOpacity,this)):(P.active=!0,this._pruneTiles()),S||(Zt(P.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:P.el,coords:_})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),vn.ielt9||!this._map._fadeAnimated?pe(this._pruneTiles,this):setTimeout(p(this._pruneTiles,this),250)))},_getTilePos:function(_){return _.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(_){var S=new Le(this._wrapX?R(_.x,this._wrapX):_.x,this._wrapY?R(_.y,this._wrapY):_.y);return S.z=_.z,S},_pxBoundsToTileRange:function(_){var S=this.getTileSize();return new Rt(_.min.unscaleBy(S).floor(),_.max.unscaleBy(S).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var _ in this._tiles)if(!this._tiles[_].loaded)return!1;return!0}});function aS(_){return new Hr(_)}var pu=Hr.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(_,S){this._url=_,S=F(this,S),S.detectRetina&&vn.retina&&S.maxZoom>0?(S.tileSize=Math.floor(S.tileSize/2),S.zoomReverse?(S.zoomOffset--,S.minZoom=Math.min(S.maxZoom,S.minZoom+1)):(S.zoomOffset++,S.maxZoom=Math.max(S.minZoom,S.maxZoom-1)),S.minZoom=Math.max(0,S.minZoom)):S.zoomReverse?S.minZoom=Math.min(S.maxZoom,S.minZoom):S.maxZoom=Math.max(S.minZoom,S.maxZoom),typeof S.subdomains=="string"&&(S.subdomains=S.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(_,S){return this._url===_&&S===void 0&&(S=!0),this._url=_,S||this.redraw(),this},createTile:function(_,S){var P=document.createElement("img");return Dn(P,"load",p(this._tileOnLoad,this,S,P)),Dn(P,"error",p(this._tileOnError,this,S,P)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(P.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(P.referrerPolicy=this.options.referrerPolicy),P.alt="",P.src=this.getTileUrl(_),P},getTileUrl:function(_){var S={r:vn.retina?"@2x":"",s:this._getSubdomain(_),x:_.x,y:_.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var P=this._globalTileRange.max.y-_.y;this.options.tms&&(S.y=P),S["-y"]=P}return H(this._url,l(S,this.options))},_tileOnLoad:function(_,S){vn.ielt9?setTimeout(p(_,this,null,S),0):_(null,S)},_tileOnError:function(_,S,P){var G=this.options.errorTileUrl;G&&S.getAttribute("src")!==G&&(S.src=G),_(P,S)},_onTileRemove:function(_){_.tile.onload=null},_getZoomForUrl:function(){var _=this._tileZoom,S=this.options.maxZoom,P=this.options.zoomReverse,G=this.options.zoomOffset;return P&&(_=S-_),_+G},_getSubdomain:function(_){var S=Math.abs(_.x+_.y)%this.options.subdomains.length;return this.options.subdomains[S]},_abortLoading:function(){var _,S;for(_ in this._tiles)if(this._tiles[_].coords.z!==this._tileZoom&&(S=this._tiles[_].el,S.onload=C,S.onerror=C,!S.complete)){S.src=te;var P=this._tiles[_].coords;Ni(S),delete this._tiles[_],this.fire("tileabort",{tile:S,coords:P})}},_removeTile:function(_){var S=this._tiles[_];if(S)return S.el.setAttribute("src",te),Hr.prototype._removeTile.call(this,_)},_tileReady:function(_,S,P){if(!(!this._map||P&&P.getAttribute("src")===te))return Hr.prototype._tileReady.call(this,_,S,P)}});function Ap(_,S){return new pu(_,S)}var Yv=pu.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(_,S){this._url=_;var P=l({},this.defaultWmsParams);for(var G in S)G in this.options||(P[G]=S[G]);S=F(this,S);var ae=S.detectRetina&&vn.retina?2:1,ge=this.getTileSize();P.width=ge.x*ae,P.height=ge.y*ae,this.wmsParams=P},onAdd:function(_){this._crs=this.options.crs||_.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var S=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[S]=this._crs.code,pu.prototype.onAdd.call(this,_)},getTileUrl:function(_){var S=this._tileCoordsToNwSe(_),P=this._crs,G=rt(P.project(S[0]),P.project(S[1])),ae=G.min,ge=G.max,ke=(this._wmsVersion>=1.3&&this._crs===Bs?[ae.y,ae.x,ge.y,ge.x]:[ae.x,ae.y,ge.x,ge.y]).join(","),Xe=pu.prototype.getTileUrl.call(this,_);return Xe+q(this.wmsParams,Xe,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+ke},setParams:function(_,S){return l(this.wmsParams,_),S||this.redraw(),this}});function oS(_,S){return new Yv(_,S)}pu.WMS=Yv,Ap.wms=oS;var Td=fr.extend({options:{padding:.1},initialize:function(_){F(this,_),v(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),Zt(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var _={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(_.zoomanim=this._onAnimZoom),_},_onAnimZoom:function(_){this._updateTransform(_.center,_.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(_,S){var P=this._map.getZoomScale(S,this._zoom),G=this._map.getSize().multiplyBy(.5+this.options.padding),ae=this._map.project(this._center,S),ge=G.multiplyBy(-P).add(ae).subtract(this._map._getNewPixelOrigin(_,S));vn.any3d?Ul(this._container,ge,P):qn(this._container,ge)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var _ in this._layers)this._layers[_]._reset()},_onZoomEnd:function(){for(var _ in this._layers)this._layers[_]._project()},_updatePaths:function(){for(var _ in this._layers)this._layers[_]._update()},_update:function(){var _=this.options.padding,S=this._map.getSize(),P=this._map.containerPointToLayerPoint(S.multiplyBy(-_)).round();this._bounds=new Rt(P,P.add(S.multiplyBy(1+_*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),fu=Td.extend({options:{tolerance:0},getEvents:function(){var _=Td.prototype.getEvents.call(this);return _.viewprereset=this._onViewPreReset,_},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Td.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var _=this._container=document.createElement("canvas");Dn(_,"mousemove",this._onMouseMove,this),Dn(_,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Dn(_,"mouseout",this._handleMouseOut,this),_._leaflet_disable_events=!0,this._ctx=_.getContext("2d")},_destroyContainer:function(){be(this._redrawRequest),delete this._ctx,Ni(this._container),Ei(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var _;this._redrawBounds=null;for(var S in this._layers)_=this._layers[S],_._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Td.prototype._update.call(this);var _=this._bounds,S=this._container,P=_.getSize(),G=vn.retina?2:1;qn(S,_.min),S.width=G*P.x,S.height=G*P.y,S.style.width=P.x+"px",S.style.height=P.y+"px",vn.retina&&this._ctx.scale(2,2),this._ctx.translate(-_.min.x,-_.min.y),this.fire("update")}},_reset:function(){Td.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(_){this._updateDashArray(_),this._layers[v(_)]=_;var S=_._order={layer:_,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=S),this._drawLast=S,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(_){this._requestRedraw(_)},_removePath:function(_){var S=_._order,P=S.next,G=S.prev;P?P.prev=G:this._drawLast=G,G?G.next=P:this._drawFirst=P,delete _._order,delete this._layers[v(_)],this._requestRedraw(_)},_updatePath:function(_){this._extendRedrawBounds(_),_._project(),_._update(),this._requestRedraw(_)},_updateStyle:function(_){this._updateDashArray(_),this._requestRedraw(_)},_updateDashArray:function(_){if(typeof _.options.dashArray=="string"){var S=_.options.dashArray.split(/[, ]+/),P=[],G,ae;for(ae=0;ae<S.length;ae++){if(G=Number(S[ae]),isNaN(G))return;P.push(G)}_.options._dashArray=P}else _.options._dashArray=_.options.dashArray},_requestRedraw:function(_){this._map&&(this._extendRedrawBounds(_),this._redrawRequest=this._redrawRequest||pe(this._redraw,this))},_extendRedrawBounds:function(_){if(_._pxBounds){var S=(_.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new Rt,this._redrawBounds.extend(_._pxBounds.min.subtract([S,S])),this._redrawBounds.extend(_._pxBounds.max.add([S,S]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var _=this._redrawBounds;if(_){var S=_.getSize();this._ctx.clearRect(_.min.x,_.min.y,S.x,S.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var _,S=this._redrawBounds;if(this._ctx.save(),S){var P=S.getSize();this._ctx.beginPath(),this._ctx.rect(S.min.x,S.min.y,P.x,P.y),this._ctx.clip()}this._drawing=!0;for(var G=this._drawFirst;G;G=G.next)_=G.layer,(!S||_._pxBounds&&_._pxBounds.intersects(S))&&_._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(_,S){if(this._drawing){var P,G,ae,ge,ke=_._parts,Xe=ke.length,nt=this._ctx;if(Xe){for(nt.beginPath(),P=0;P<Xe;P++){for(G=0,ae=ke[P].length;G<ae;G++)ge=ke[P][G],nt[G?"lineTo":"moveTo"](ge.x,ge.y);S&&nt.closePath()}this._fillStroke(nt,_)}}},_updateCircle:function(_){if(!(!this._drawing||_._empty())){var S=_._point,P=this._ctx,G=Math.max(Math.round(_._radius),1),ae=(Math.max(Math.round(_._radiusY),1)||G)/G;ae!==1&&(P.save(),P.scale(1,ae)),P.beginPath(),P.arc(S.x,S.y/ae,G,0,Math.PI*2,!1),ae!==1&&P.restore(),this._fillStroke(P,_)}},_fillStroke:function(_,S){var P=S.options;P.fill&&(_.globalAlpha=P.fillOpacity,_.fillStyle=P.fillColor||P.color,_.fill(P.fillRule||"evenodd")),P.stroke&&P.weight!==0&&(_.setLineDash&&_.setLineDash(S.options&&S.options._dashArray||[]),_.globalAlpha=P.opacity,_.lineWidth=P.weight,_.strokeStyle=P.color,_.lineCap=P.lineCap,_.lineJoin=P.lineJoin,_.stroke())},_onClick:function(_){for(var S=this._map.mouseEventToLayerPoint(_),P,G,ae=this._drawFirst;ae;ae=ae.next)P=ae.layer,P.options.interactive&&P._containsPoint(S)&&(!(_.type==="click"||_.type==="preclick")||!this._map._draggableMoved(P))&&(G=P);this._fireEvent(G?[G]:!1,_)},_onMouseMove:function(_){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var S=this._map.mouseEventToLayerPoint(_);this._handleMouseHover(_,S)}},_handleMouseOut:function(_){var S=this._hoveredLayer;S&&(Oi(this._container,"leaflet-interactive"),this._fireEvent([S],_,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(_,S){if(!this._mouseHoverThrottled){for(var P,G,ae=this._drawFirst;ae;ae=ae.next)P=ae.layer,P.options.interactive&&P._containsPoint(S)&&(G=P);G!==this._hoveredLayer&&(this._handleMouseOut(_),G&&(Zt(this._container,"leaflet-interactive"),this._fireEvent([G],_,"mouseover"),this._hoveredLayer=G)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,_),this._mouseHoverThrottled=!0,setTimeout(p(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(_,S,P){this._map._fireDOMEvent(S,P||S.type,_)},_bringToFront:function(_){var S=_._order;if(S){var P=S.next,G=S.prev;if(P)P.prev=G;else return;G?G.next=P:P&&(this._drawFirst=P),S.prev=this._drawLast,this._drawLast.next=S,S.next=null,this._drawLast=S,this._requestRedraw(_)}},_bringToBack:function(_){var S=_._order;if(S){var P=S.next,G=S.prev;if(G)G.next=P;else return;P?P.prev=G:G&&(this._drawLast=G),S.prev=null,S.next=this._drawFirst,this._drawFirst.prev=S,this._drawFirst=S,this._requestRedraw(_)}}});function cc(_){return vn.canvas?new fu(_):null}var mu=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(_){return document.createElement("<lvml:"+_+' class="lvml">')}}catch{}return function(_){return document.createElement("<"+_+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),$v={_initContainer:function(){this._container=Vr("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Td.prototype._update.call(this),this.fire("update"))},_initPath:function(_){var S=_._container=mu("shape");Zt(S,"leaflet-vml-shape "+(this.options.className||"")),S.coordsize="1 1",_._path=mu("path"),S.appendChild(_._path),this._updateStyle(_),this._layers[v(_)]=_},_addPath:function(_){var S=_._container;this._container.appendChild(S),_.options.interactive&&_.addInteractiveTarget(S)},_removePath:function(_){var S=_._container;Ni(S),_.removeInteractiveTarget(S),delete this._layers[v(_)]},_updateStyle:function(_){var S=_._stroke,P=_._fill,G=_.options,ae=_._container;ae.stroked=!!G.stroke,ae.filled=!!G.fill,G.stroke?(S||(S=_._stroke=mu("stroke")),ae.appendChild(S),S.weight=G.weight+"px",S.color=G.color,S.opacity=G.opacity,G.dashArray?S.dashStyle=X(G.dashArray)?G.dashArray.join(" "):G.dashArray.replace(/( *, *)/g," "):S.dashStyle="",S.endcap=G.lineCap.replace("butt","flat"),S.joinstyle=G.lineJoin):S&&(ae.removeChild(S),_._stroke=null),G.fill?(P||(P=_._fill=mu("fill")),ae.appendChild(P),P.color=G.fillColor||G.color,P.opacity=G.fillOpacity):P&&(ae.removeChild(P),_._fill=null)},_updateCircle:function(_){var S=_._point.round(),P=Math.round(_._radius),G=Math.round(_._radiusY||P);this._setPath(_,_._empty()?"M0 0":"AL "+S.x+","+S.y+" "+P+","+G+" 0,"+65535*360)},_setPath:function(_,S){_._path.v=S},_bringToFront:function(_){so(_._container)},_bringToBack:function(_){jc(_._container)}},zl=vn.vml?mu:un,gu=Td.extend({_initContainer:function(){this._container=zl("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=zl("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Ni(this._container),Ei(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Td.prototype._update.call(this);var _=this._bounds,S=_.getSize(),P=this._container;(!this._svgSize||!this._svgSize.equals(S))&&(this._svgSize=S,P.setAttribute("width",S.x),P.setAttribute("height",S.y)),qn(P,_.min),P.setAttribute("viewBox",[_.min.x,_.min.y,S.x,S.y].join(" ")),this.fire("update")}},_initPath:function(_){var S=_._path=zl("path");_.options.className&&Zt(S,_.options.className),_.options.interactive&&Zt(S,"leaflet-interactive"),this._updateStyle(_),this._layers[v(_)]=_},_addPath:function(_){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(_._path),_.addInteractiveTarget(_._path)},_removePath:function(_){Ni(_._path),_.removeInteractiveTarget(_._path),delete this._layers[v(_)]},_updatePath:function(_){_._project(),_._update()},_updateStyle:function(_){var S=_._path,P=_.options;S&&(P.stroke?(S.setAttribute("stroke",P.color),S.setAttribute("stroke-opacity",P.opacity),S.setAttribute("stroke-width",P.weight),S.setAttribute("stroke-linecap",P.lineCap),S.setAttribute("stroke-linejoin",P.lineJoin),P.dashArray?S.setAttribute("stroke-dasharray",P.dashArray):S.removeAttribute("stroke-dasharray"),P.dashOffset?S.setAttribute("stroke-dashoffset",P.dashOffset):S.removeAttribute("stroke-dashoffset")):S.setAttribute("stroke","none"),P.fill?(S.setAttribute("fill",P.fillColor||P.color),S.setAttribute("fill-opacity",P.fillOpacity),S.setAttribute("fill-rule",P.fillRule||"evenodd")):S.setAttribute("fill","none"))},_updatePoly:function(_,S){this._setPath(_,ui(_._parts,S))},_updateCircle:function(_){var S=_._point,P=Math.max(Math.round(_._radius),1),G=Math.max(Math.round(_._radiusY),1)||P,ae="a"+P+","+G+" 0 1,0 ",ge=_._empty()?"M0 0":"M"+(S.x-P)+","+S.y+ae+P*2+",0 "+ae+-P*2+",0 ";this._setPath(_,ge)},_setPath:function(_,S){_._path.setAttribute("d",S)},_bringToFront:function(_){so(_._path)},_bringToBack:function(_){jc(_._path)}});vn.vml&&gu.include($v);function kp(_){return vn.svg||vn.vml?new gu(_):null}kr.include({getRenderer:function(_){var S=_.options.renderer||this._getPaneRenderer(_.options.pane)||this.options.renderer||this._renderer;return S||(S=this._renderer=this._createRenderer()),this.hasLayer(S)||this.addLayer(S),S},_getPaneRenderer:function(_){if(_==="overlayPane"||_===void 0)return!1;var S=this._paneRenderers[_];return S===void 0&&(S=this._createRenderer({pane:_}),this._paneRenderers[_]=S),S},_createRenderer:function(_){return this.options.preferCanvas&&cc(_)||kp(_)}});var Jf=Np.extend({initialize:function(_,S){Np.prototype.initialize.call(this,this._boundsToLatLngs(_),S)},setBounds:function(_){return this.setLatLngs(this._boundsToLatLngs(_))},_boundsToLatLngs:function(_){return _=yt(_),[_.getSouthWest(),_.getNorthWest(),_.getNorthEast(),_.getSouthEast()]}});function Xv(_,S){return new Jf(_,S)}gu.create=zl,gu.pointsToPath=ui,Aa.geometryToLayer=No,Aa.coordsToLatLng=T0,Aa.coordsToLatLngs=hl,Aa.latLngToCoords=R0,Aa.latLngsToCoords=fg,Aa.getFeature=zs,Aa.asFeature=Sd,kr.mergeOptions({boxZoom:!0});var Pp=Li.extend({initialize:function(_){this._map=_,this._container=_._container,this._pane=_._panes.overlayPane,this._resetStateTimeout=0,_.on("unload",this._destroy,this)},addHooks:function(){Dn(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Ei(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Ni(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(_){if(!_.shiftKey||_.which!==1&&_.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),ao(),hh(),this._startPoint=this._map.mouseEventToContainerPoint(_),Dn(document,{contextmenu:vr,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(_){this._moved||(this._moved=!0,this._box=Vr("div","leaflet-zoom-box",this._container),Zt(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(_);var S=new Rt(this._point,this._startPoint),P=S.getSize();qn(this._box,S.min),this._box.style.width=P.x+"px",this._box.style.height=P.y+"px"},_finish:function(){this._moved&&(Ni(this._box),Oi(this._container,"leaflet-crosshair")),Na(),vp(),Ei(document,{contextmenu:vr,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(_){if(!(_.which!==1&&_.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(p(this._resetState,this),0);var S=new mt(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(S).fire("boxzoomend",{boxZoomBounds:S})}},_onKeyDown:function(_){_.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});kr.addInitHook("addHandler","boxZoom",Pp),kr.mergeOptions({doubleClickZoom:!0});var _u=Li.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(_){var S=this._map,P=S.getZoom(),G=S.options.zoomDelta,ae=_.originalEvent.shiftKey?P-G:P+G;S.options.doubleClickZoom==="center"?S.setZoom(ae):S.setZoomAround(_.containerPoint,ae)}});kr.addInitHook("addHandler","doubleClickZoom",_u),kr.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var mh=Li.extend({addHooks:function(){if(!this._draggable){var _=this._map;this._draggable=new Ia(_._mapPane,_._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),_.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),_.on("zoomend",this._onZoomEnd,this),_.whenReady(this._onZoomEnd,this))}Zt(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Oi(this._map._container,"leaflet-grab"),Oi(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var _=this._map;if(_._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var S=yt(this._map.options.maxBounds);this._offsetLimit=rt(this._map.latLngToContainerPoint(S.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(S.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;_.fire("movestart").fire("dragstart"),_.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(_){if(this._map.options.inertia){var S=this._lastTime=+new Date,P=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(P),this._times.push(S),this._prunePositions(S)}this._map.fire("move",_).fire("drag",_)},_prunePositions:function(_){for(;this._positions.length>1&&_-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var _=this._map.getSize().divideBy(2),S=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=S.subtract(_).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(_,S){return _-(_-S)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var _=this._draggable._newPos.subtract(this._draggable._startPos),S=this._offsetLimit;_.x<S.min.x&&(_.x=this._viscousLimit(_.x,S.min.x)),_.y<S.min.y&&(_.y=this._viscousLimit(_.y,S.min.y)),_.x>S.max.x&&(_.x=this._viscousLimit(_.x,S.max.x)),_.y>S.max.y&&(_.y=this._viscousLimit(_.y,S.max.y)),this._draggable._newPos=this._draggable._startPos.add(_)}},_onPreDragWrap:function(){var _=this._worldWidth,S=Math.round(_/2),P=this._initialWorldOffset,G=this._draggable._newPos.x,ae=(G-S+P)%_+S-P,ge=(G+S+P)%_-S-P,ke=Math.abs(ae+P)<Math.abs(ge+P)?ae:ge;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=ke},_onDragEnd:function(_){var S=this._map,P=S.options,G=!P.inertia||_.noInertia||this._times.length<2;if(S.fire("dragend",_),G)S.fire("moveend");else{this._prunePositions(+new Date);var ae=this._lastPos.subtract(this._positions[0]),ge=(this._lastTime-this._times[0])/1e3,ke=P.easeLinearity,Xe=ae.multiplyBy(ke/ge),nt=Xe.distanceTo([0,0]),Tt=Math.min(P.inertiaMaxSpeed,nt),Jt=Xe.multiplyBy(Tt/nt),Tn=Tt/(P.inertiaDeceleration*ke),nr=Jt.multiplyBy(-Tn/2).round();!nr.x&&!nr.y?S.fire("moveend"):(nr=S._limitOffset(nr,S.options.maxBounds),pe(function(){S.panBy(nr,{duration:Tn,easeLinearity:ke,noMoveStart:!0,animate:!0})}))}}});kr.addInitHook("addHandler","dragging",mh),kr.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Jv=Li.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(_){this._map=_,this._setPanDelta(_.options.keyboardPanDelta),this._setZoomDelta(_.options.zoomDelta)},addHooks:function(){var _=this._map._container;_.tabIndex<=0&&(_.tabIndex="0"),Dn(_,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Ei(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var _=document.body,S=document.documentElement,P=_.scrollTop||S.scrollTop,G=_.scrollLeft||S.scrollLeft;this._map._container.focus(),window.scrollTo(G,P)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(_){var S=this._panKeys={},P=this.keyCodes,G,ae;for(G=0,ae=P.left.length;G<ae;G++)S[P.left[G]]=[-1*_,0];for(G=0,ae=P.right.length;G<ae;G++)S[P.right[G]]=[_,0];for(G=0,ae=P.down.length;G<ae;G++)S[P.down[G]]=[0,_];for(G=0,ae=P.up.length;G<ae;G++)S[P.up[G]]=[0,-1*_]},_setZoomDelta:function(_){var S=this._zoomKeys={},P=this.keyCodes,G,ae;for(G=0,ae=P.zoomIn.length;G<ae;G++)S[P.zoomIn[G]]=_;for(G=0,ae=P.zoomOut.length;G<ae;G++)S[P.zoomOut[G]]=-_},_addHooks:function(){Dn(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Ei(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(_){if(!(_.altKey||_.ctrlKey||_.metaKey)){var S=_.keyCode,P=this._map,G;if(S in this._panKeys){if(!P._panAnim||!P._panAnim._inProgress)if(G=this._panKeys[S],_.shiftKey&&(G=Ke(G).multiplyBy(3)),P.options.maxBounds&&(G=P._limitOffset(Ke(G),P.options.maxBounds)),P.options.worldCopyJump){var ae=P.wrapLatLng(P.unproject(P.project(P.getCenter()).add(G)));P.panTo(ae)}else P.panBy(G)}else if(S in this._zoomKeys)P.setZoom(P.getZoom()+(_.shiftKey?3:1)*this._zoomKeys[S]);else if(S===27&&P._popup&&P._popup.options.closeOnEscapeKey)P.closePopup();else return;vr(_)}}});kr.addInitHook("addHandler","keyboard",Jv),kr.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var N0=Li.extend({addHooks:function(){Dn(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Ei(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(_){var S=ll(_),P=this._map.options.wheelDebounceTime;this._delta+=S,this._lastMousePos=this._map.mouseEventToContainerPoint(_),this._startTime||(this._startTime=+new Date);var G=Math.max(P-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(p(this._performZoom,this),G),vr(_)},_performZoom:function(){var _=this._map,S=_.getZoom(),P=this._map.options.zoomSnap||0;_._stop();var G=this._delta/(this._map.options.wheelPxPerZoomLevel*4),ae=4*Math.log(2/(1+Math.exp(-Math.abs(G))))/Math.LN2,ge=P?Math.ceil(ae/P)*P:ae,ke=_._limitZoom(S+(this._delta>0?ge:-ge))-S;this._delta=0,this._startTime=null,ke&&(_.options.scrollWheelZoom==="center"?_.setZoom(S+ke):_.setZoomAround(this._lastMousePos,S+ke))}});kr.addInitHook("addHandler","scrollWheelZoom",N0);var lc=600;kr.mergeOptions({tapHold:vn.touchNative&&vn.safari&&vn.mobile,tapTolerance:15});var Qf=Li.extend({addHooks:function(){Dn(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Ei(this._map._container,"touchstart",this._onDown,this)},_onDown:function(_){if(clearTimeout(this._holdTimeout),_.touches.length===1){var S=_.touches[0];this._startPos=this._newPos=new Le(S.clientX,S.clientY),this._holdTimeout=setTimeout(p(function(){this._cancel(),this._isTapValid()&&(Dn(document,"touchend",Yn),Dn(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",S))},this),lc),Dn(document,"touchend touchcancel contextmenu",this._cancel,this),Dn(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function _(){Ei(document,"touchend",Yn),Ei(document,"touchend touchcancel",_)},_cancel:function(){clearTimeout(this._holdTimeout),Ei(document,"touchend touchcancel contextmenu",this._cancel,this),Ei(document,"touchmove",this._onMove,this)},_onMove:function(_){var S=_.touches[0];this._newPos=new Le(S.clientX,S.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(_,S){var P=new MouseEvent(_,{bubbles:!0,cancelable:!0,view:window,screenX:S.screenX,screenY:S.screenY,clientX:S.clientX,clientY:S.clientY});P._simulated=!0,S.target.dispatchEvent(P)}});kr.addInitHook("addHandler","tapHold",Qf),kr.mergeOptions({touchZoom:vn.touch,bounceAtZoomLimits:!0});var Rd=Li.extend({addHooks:function(){Zt(this._map._container,"leaflet-touch-zoom"),Dn(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Oi(this._map._container,"leaflet-touch-zoom"),Ei(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(_){var S=this._map;if(!(!_.touches||_.touches.length!==2||S._animatingZoom||this._zooming)){var P=S.mouseEventToContainerPoint(_.touches[0]),G=S.mouseEventToContainerPoint(_.touches[1]);this._centerPoint=S.getSize()._divideBy(2),this._startLatLng=S.containerPointToLatLng(this._centerPoint),S.options.touchZoom!=="center"&&(this._pinchStartLatLng=S.containerPointToLatLng(P.add(G)._divideBy(2))),this._startDist=P.distanceTo(G),this._startZoom=S.getZoom(),this._moved=!1,this._zooming=!0,S._stop(),Dn(document,"touchmove",this._onTouchMove,this),Dn(document,"touchend touchcancel",this._onTouchEnd,this),Yn(_)}},_onTouchMove:function(_){if(!(!_.touches||_.touches.length!==2||!this._zooming)){var S=this._map,P=S.mouseEventToContainerPoint(_.touches[0]),G=S.mouseEventToContainerPoint(_.touches[1]),ae=P.distanceTo(G)/this._startDist;if(this._zoom=S.getScaleZoom(ae,this._startZoom),!S.options.bounceAtZoomLimits&&(this._zoom<S.getMinZoom()&&ae<1||this._zoom>S.getMaxZoom()&&ae>1)&&(this._zoom=S._limitZoom(this._zoom)),S.options.touchZoom==="center"){if(this._center=this._startLatLng,ae===1)return}else{var ge=P._add(G)._divideBy(2)._subtract(this._centerPoint);if(ae===1&&ge.x===0&&ge.y===0)return;this._center=S.unproject(S.project(this._pinchStartLatLng,this._zoom).subtract(ge),this._zoom)}this._moved||(S._moveStart(!0,!1),this._moved=!0),be(this._animRequest);var ke=p(S._move,S,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=pe(ke,this,!0),Yn(_)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,be(this._animRequest),Ei(document,"touchmove",this._onTouchMove,this),Ei(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});kr.addInitHook("addHandler","touchZoom",Rd),kr.BoxZoom=Pp,kr.DoubleClickZoom=_u,kr.Drag=mh,kr.Keyboard=Jv,kr.ScrollWheelZoom=N0,kr.TapHold=Qf,kr.TouchZoom=Rd,r.Bounds=Rt,r.Browser=vn,r.CRS=vt,r.Canvas=fu,r.Circle=pg,r.CircleMarker=hg,r.Class=Ze,r.Control=_i,r.DivIcon=Xf,r.DivOverlay=Bl,r.DomEvent=Gf,r.DomUtil=Ff,r.Draggable=Ia,r.Evented=lt,r.FeatureGroup=fs,r.GeoJSON=Aa,r.GridLayer=Hr,r.Handler=Li,r.Icon=Fl,r.ImageOverlay=en,r.LatLng=Ct,r.LatLngBounds=mt,r.Layer=fr,r.LayerGroup=Bi,r.LineUtil=Se,r.Map=kr,r.Marker=ug,r.Mixin=fh,r.Path=uu,r.Point=Le,r.PolyUtil=du,r.Polygon=Np,r.Polyline=oc,r.Popup=ka,r.PosAnimation=wp,r.Projection=Ut,r.Rectangle=Jf,r.Renderer=Td,r.SVG=gu,r.SVGOverlay=xi,r.TileLayer=pu,r.Tooltip=mg,r.Transformation=ni,r.Util=ye,r.VideoOverlay=si,r.bind=p,r.bounds=rt,r.canvas=cc,r.circle=hu,r.circleMarker=$f,r.control=Ns,r.divIcon=gg,r.extend=l,r.featureGroup=wd,r.geoJSON=ut,r.geoJson=st,r.gridLayer=aS,r.icon=iS,r.imageOverlay=Zn,r.latLng=Ot,r.latLngBounds=yt,r.layerGroup=Bc,r.map=xs,r.marker=Cp,r.point=Ke,r.polygon=sS,r.polyline=w0,r.popup=Ip,r.rectangle=Xv,r.setOptions=F,r.stamp=v,r.svg=kp,r.svgOverlay=C0,r.tileLayer=Ap,r.tooltip=Ge,r.transformation=pr,r.version=a,r.videoOverlay=aa;var I0=window.L;r.noConflict=function(){return window.L=I0,this},window.L=r})})(Bz,Bz.exports);var tS=Bz.exports;const QL=VO(tS);function ZL(t,e,r){return Object.freeze({instance:t,context:e,container:r})}function ej(t,e){return e==null?function(a,l){const u=V.useRef(void 0);return u.current||(u.current=t(a,l)),u}:function(a,l){const u=V.useRef(void 0);u.current||(u.current=t(a,l));const p=V.useRef(a),{instance:m}=u.current;return V.useEffect(function(){p.current!==a&&(e(m,a,p.current),p.current=a)},[m,a,e]),u}}function Fme(t,e){V.useEffect(function(){return(e.layerContainer??e.map).addLayer(t.instance),function(){var u;(u=e.layerContainer)==null||u.removeLayer(t.instance),e.map.removeLayer(t.instance)}},[e,t])}function Bme(t){return function(r){const a=XL(),l=t(JL(r,a),a);return Mme(a.map,r.attribution),a9(l.current,r.eventHandlers),Fme(l.current,a),l}}function u6e(t,e){const r=V.useRef(void 0);V.useEffect(function(){if(e.pathOptions!==r.current){const l=e.pathOptions??{};t.instance.setStyle(l),r.current=l}},[t,e])}function h6e(t){return function(r){const a=XL(),l=t(JL(r,a),a);return a9(l.current,r.eventHandlers),Fme(l.current,a),u6e(l.current,r),l}}function p6e(t,e){const r=ej(t,e),a=Bme(r);return Vme(a)}function f6e(t,e){const r=ej(t),a=d6e(r,e);return c6e(a)}function m6e(t,e){const r=ej(t,e),a=h6e(r);return Vme(a)}function g6e(t,e){const r=ej(t,e),a=Bme(r);return l6e(a)}function _6e(t,e,r){const{opacity:a,zIndex:l}=e;a!=null&&a!==r.opacity&&t.setOpacity(a),l!=null&&l!==r.zIndex&&t.setZIndex(l)}function zme(){return XL().map}function y6e(t){const e=zme();return V.useEffect(function(){return e.on(t),function(){e.off(t)}},[e,t]),e}const v6e=m6e(function({center:e,children:r,...a},l){const u=new tS.Circle(e,a);return ZL(u,Ume(l,{overlayContainer:u}))},s6e);function E6e({bounds:t,boundsOptions:e,center:r,children:a,className:l,id:u,placeholder:p,style:m,whenReady:v,zoom:w,...R},C){const[A]=V.useState({className:l,id:u,style:m}),[O,U]=V.useState(null),F=V.useRef(void 0);V.useImperativeHandle(C,()=>(O==null?void 0:O.map)??null,[O]);const q=V.useCallback(H=>{if(H!==null&&!F.current){const X=new tS.Map(H,R);F.current=X,r!=null&&w!=null?X.setView(r,w):t!=null&&X.fitBounds(t,e),v!=null&&X.whenReady(v),U(o6e(X))}},[]);V.useEffect(()=>()=>{O==null||O.map.remove()},[O]);const W=O?Yb.createElement(s9,{value:O},a):p??null;return Yb.createElement("div",{...A,ref:q},W)}const x6e=V.forwardRef(E6e),F2=p6e(function({position:e,...r},a){const l=new tS.Marker(e,r);return ZL(l,Ume(a,{overlayContainer:l}))},function(e,r,a){r.position!==a.position&&e.setLatLng(r.position),r.icon!=null&&r.icon!==a.icon&&e.setIcon(r.icon),r.zIndexOffset!=null&&r.zIndexOffset!==a.zIndexOffset&&e.setZIndexOffset(r.zIndexOffset),r.opacity!=null&&r.opacity!==a.opacity&&e.setOpacity(r.opacity),e.dragging!=null&&r.draggable!==a.draggable&&(r.draggable===!0?e.dragging.enable():e.dragging.disable())}),yB=f6e(function(e,r){const a=new tS.Popup(e,r.overlayContainer);return ZL(a,r)},function(e,r,{position:a},l){V.useEffect(function(){const{instance:p}=e;function m(w){w.popup===p&&(p.update(),l(!0))}function v(w){w.popup===p&&l(!1)}return r.map.on({popupopen:m,popupclose:v}),r.overlayContainer==null?(a!=null&&p.setLatLng(a),p.openOn(r.map)):r.overlayContainer.bindPopup(p),function(){var R;r.map.off({popupopen:m,popupclose:v}),(R=r.overlayContainer)==null||R.unbindPopup(),r.map.removeLayer(p)}},[e,r,l,a])}),b6e=g6e(function({url:e,...r},a){const l=new tS.TileLayer(e,JL(r,a));return ZL(l,a)},function(e,r,a){_6e(e,r,a);const{url:l}=r;l!=null&&l!==a.url&&e.setUrl(l)});function w6e(){try{if(typeof window<"u"){const t=window.matchMedia("(prefers-color-scheme: dark)").matches,e=document.documentElement.classList.contains("dark");return{isDark:t||e}}}catch{}return{isDark:!0}}const S6e="MIbamchs82Ve7y0ecX2TpPyymbw1",Jse=50,T6e="https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",R6e="https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",C6e='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="https://carto.com/attributions">CARTO</a>';function Qse(t,e,r,a){const u=(r-t)*Math.PI/180,p=(a-e)*Math.PI/180,m=Math.sin(u/2)*Math.sin(u/2)+Math.cos(t*Math.PI/180)*Math.cos(r*Math.PI/180)*Math.sin(p/2)*Math.sin(p/2);return 6371e3*(2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)))}function N6e(t,e){const r=[],a=new Set;for(const l of e){const u=t.filter(p=>a.has(p.id)?!1:Qse(p.latitude,p.longitude,l.latitude,l.longitude)<=Jse);(u.length>0||l.participantCount>0)&&(r.push({id:`room-${l.id}`,centerLat:l.latitude,centerLng:l.longitude,friends:u,room:l}),u.forEach(p=>a.add(p.id)))}for(const l of t){if(a.has(l.id))continue;const u=t.filter(p=>a.has(p.id)||p.id===l.id?!1:Qse(p.latitude,p.longitude,l.latitude,l.longitude)<=Jse);if(u.length>0){const p=[l,...u],m=p.reduce((w,R)=>w+R.latitude,0)/p.length,v=p.reduce((w,R)=>w+R.longitude,0)/p.length;r.push({id:`cluster-${l.id}`,centerLat:m,centerLng:v,friends:p}),p.forEach(w=>a.add(w.id))}else r.push({id:`single-${l.id}`,centerLat:l.latitude,centerLng:l.longitude,friends:[l]}),a.add(l.id)}return r}function I6e(t,e){const r=t.inRoom?"#a855f7":t.isOnline?"#4ade80":"#6b7280",a=t.inRoom?"animate-pulse":"";return QL.divIcon({className:"custom-friend-marker",html:`
      <div class="relative ${a}" style="width: 44px; height: 44px;">
        <div class="absolute inset-0 rounded-full border-2" style="border-color: ${r}; background: rgba(0,0,0,0.8);">
          ${t.avatarUrl?`<img src="${t.avatarUrl}" class="w-full h-full rounded-full object-cover" />`:`<div class="w-full h-full rounded-full flex items-center justify-center text-white font-bold text-sm" style="background: linear-gradient(135deg, #a855f7, #ec4899);">
                ${t.displayName.slice(0,2).toUpperCase()}
              </div>`}
        </div>
        ${t.inRoom?`
          <div class="absolute -bottom-1 -right-1 w-5 h-5 rounded-full bg-purple-500 flex items-center justify-center">
            <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5">
              <path d="M3 18v-6a9 9 0 0 1 18 0v6"></path>
              <path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"></path>
            </svg>
          </div>
        `:""}
        ${e?`
          <div class="absolute -top-1 -right-1 w-4 h-4 rounded-full bg-yellow-400 flex items-center justify-center">
            <span style="font-size: 8px;"></span>
          </div>
        `:""}
      </div>
    `,iconSize:[44,44],iconAnchor:[22,22]})}function A6e(t,e){const r=e?"rgba(139, 92, 246, 0.3)":"rgba(255, 255, 255, 0.1)",a=e?"#a855f7":"rgba(255, 255, 255, 0.2)";return QL.divIcon({className:"custom-room-marker",html:`
      <div class="relative" style="width: 56px; height: 56px;">
        <div class="absolute inset-0 rounded-2xl border-2 flex items-center justify-center"
             style="background: ${r}; border-color: ${a}; backdrop-filter: blur(8px);">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="${e?"#a855f7":"rgba(255,255,255,0.6)"}" stroke-width="1.5">
            <path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"></path>
          </svg>
        </div>
        <div class="absolute -bottom-1 -right-1 px-2 py-0.5 rounded-full bg-purple-500">
          <span style="font-size: 10px; color: white; font-weight: bold;">${t.participantCount}</span>
        </div>
        ${e?`
          <div class="absolute inset-0 rounded-2xl border-2 border-purple-500 animate-ping opacity-30"></div>
        `:""}
      </div>
    `,iconSize:[56,56],iconAnchor:[28,28]})}function k6e(t){var a;const e=t.friends.length+(((a=t.room)==null?void 0:a.participantCount)||0),r=!!t.room;return QL.divIcon({className:"custom-cluster-marker",html:`
      <div class="relative" style="width: 64px; height: 64px;">
        <div class="absolute inset-0 rounded-full border-2 flex items-center justify-center"
             style="background: rgba(139, 92, 246, 0.4); border-color: #a855f7; backdrop-filter: blur(8px);">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#a855f7" stroke-width="1.5">
            <path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"></path>
          </svg>
        </div>
        <div class="absolute -bottom-1 left-1/2 -translate-x-1/2 px-2 py-0.5 rounded-full bg-purple-500">
          <span style="font-size: 11px; color: white; font-weight: bold;">${e}</span>
        </div>
        ${r?`
          <div class="absolute -top-1 -right-1 w-5 h-5 rounded-full bg-green-400 flex items-center justify-center">
            <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5">
              <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"></path>
              <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
              <line x1="12" x2="12" y1="19" y2="22"></line>
            </svg>
          </div>
        `:""}
        <div class="absolute inset-0 rounded-full border-2 border-purple-400 animate-pulse opacity-50"></div>
      </div>
    `,iconSize:[64,64],iconAnchor:[32,32]})}function P6e(){return QL.divIcon({className:"custom-user-marker",html:`
      <div class="relative" style="width: 24px; height: 24px;">
        <div class="absolute inset-0 rounded-full bg-blue-500 border-3 border-white shadow-lg"></div>
        <div class="absolute inset-0 rounded-full bg-blue-400 animate-ping opacity-50"></div>
      </div>
    `,iconSize:[24,24],iconAnchor:[12,12]})}const D6e=({userLocation:t,onMapClick:e})=>{const r=zme();return V.useEffect(()=>{t&&r.setView([t.latitude,t.longitude],15)},[r,t]),y6e({click:a=>{e==null||e(a.latlng.lat,a.latlng.lng)}}),null},Gme=V.memo(({heatPoints:t})=>c.jsx(c.Fragment,{children:t.map((e,r)=>c.jsx(v6e,{center:[e.latitude,e.longitude],radius:100+e.intensity*200,pathOptions:{color:"transparent",fillColor:`rgba(139, 92, 246, ${.1+e.intensity*.2})`,fillOpacity:.4+e.intensity*.3}},`heat-${r}-${e.latitude.toFixed(4)}`))}));Gme.displayName="VibeHeatmap";const O6e=({userLocation:t,onFriendClick:e,onRoomClick:r,onClose:a,isFullscreen:l=!1})=>{const{user:u}=Jr(),[p,m]=V.useState([]),[v,w]=V.useState([]),[R,C]=V.useState([]),[A,O]=V.useState(null),[U,F]=V.useState(!1),{isDark:q}=w6e(),W=q?T6e:R6e,H=(u==null?void 0:u.id)===S6e,X=V.useMemo(()=>N6e(p,v),[p,v]);V.useEffect(()=>{if(!(u!=null&&u.id)){F(!1);return}const te=mn(De,"friendships"),he=Mr(te,Kn("users","array-contains",u.id)),J=na(he,async pe=>{var Ze;const be=[],ye=[];for(const It of pe.docs){const lt=It.data().users.find(Le=>Le!==u.id);if(lt)try{const Le=await Bn(tt(De,"users",lt));if(!Le.exists())continue;const Me=Le.data(),Ke=Me.lastLocation;if(Ke!=null&&Ke.latitude&&(Ke!=null&&Ke.longitude)){const Rt=Me.isActive&&((Ze=Me.lastSeen)==null?void 0:Ze.toDate())>new Date(Date.now()-3e5);be.push({id:lt,username:Me.username||"unknown",displayName:Me.displayName||Me.username||"Unbekannt",avatarUrl:Me.avatarUrl,latitude:Ke.latitude,longitude:Ke.longitude,isOnline:Rt,inRoom:!!Me.currentRoomId,roomId:Me.currentRoomId,roomName:Me.currentRoomName,sanctuaryScore:Me.sanctuaryScore||50});const rt=(Me.sanctuaryScore||50)/100;rt>.4&&ye.push({latitude:Ke.latitude,longitude:Ke.longitude,intensity:rt})}}catch(Le){console.error("Error fetching friend for map:",Le)}}m(be),C(ye)}),Q=mn(De,"rooms"),ce=Mr(Q,Kn("isActive","==",!0),ih("createdAt","desc"),up(30)),de=na(ce,pe=>{const be=[];for(const ye of pe.docs){const Ze=ye.data(),It=Ze.location;It!=null&&It.latitude&&(It!=null&&It.longitude)&&(be.push({id:ye.id,name:Ze.name||"Wlkchen",participantCount:(Ze.participants||[]).length,latitude:It.latitude,longitude:It.longitude,isAnonymous:Ze.isAnonymous||!1,participants:(Ze.participants||[]).map(St=>({userId:St.oderId,displayName:St.displayName}))}),C(St=>{var lt;return[...St.filter(Le=>Le.latitude!==It.latitude||Le.longitude!==It.longitude),{latitude:It.latitude,longitude:It.longitude,intensity:Math.min(1,.5+(((lt=Ze.participants)==null?void 0:lt.length)||0)*.1)}]}))}w(be),F(!1)});return()=>{J(),de()}},[u==null?void 0:u.id]);const ne=te=>{te.friends.length===1&&!te.room?e==null||e(te.friends[0].id):O(te)};return t?c.jsxs("div",{className:`${l?"fixed inset-0 z-50":"h-64 rounded-xl overflow-hidden"} bg-[#050505]`,children:[l&&c.jsx("div",{className:"absolute top-0 left-0 right-0 z-[1000] bg-gradient-to-b from-black/80 to-transparent p-4",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("h2",{className:"text-white font-bold flex items-center gap-2",children:[c.jsx(Yd,{className:"w-5 h-5 text-purple-400"}),"Vibe Map",H&&c.jsxs("span",{className:"text-[10px] bg-yellow-500/20 text-yellow-400 px-2 py-0.5 rounded-full flex items-center gap-1",children:[c.jsx(kn,{size:10}),"Admin"]})]}),c.jsx("button",{onClick:a,className:"p-2 rounded-full bg-white/10 text-white",children:c.jsx(Di,{size:20})})]})}),c.jsxs(x6e,{center:[t.latitude,t.longitude],zoom:15,className:"w-full h-full",zoomControl:!1,attributionControl:!1,children:[c.jsx(b6e,{url:W,attribution:C6e}),c.jsx(D6e,{userLocation:t}),c.jsx(Gme,{heatPoints:R}),c.jsx(F2,{position:[t.latitude,t.longitude],icon:P6e()}),X.map(te=>{var he;if(te.friends.length===1&&!te.room){const J=te.friends[0];return c.jsx(F2,{position:[J.latitude,J.longitude],icon:I6e(J,H),eventHandlers:{click:()=>e==null?void 0:e(J.id)},children:c.jsx(yB,{className:"custom-popup",children:c.jsxs("div",{className:"bg-[#1a1a1a] rounded-lg p-3 min-w-[160px]",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[J.avatarUrl?c.jsx("img",{src:J.avatarUrl,className:"w-8 h-8 rounded-full"}):c.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white text-xs font-bold",children:J.displayName.slice(0,2).toUpperCase()}),c.jsxs("div",{children:[c.jsx("p",{className:"text-white font-medium text-sm",children:J.displayName}),c.jsx("p",{className:"text-white/50 text-xs",children:J.inRoom?` ${J.roomName}`:J.isOnline?"Online":"Offline"})]})]}),c.jsx("button",{onClick:()=>e==null?void 0:e(J.id),className:"w-full py-1.5 bg-purple-500 text-white text-xs font-medium rounded-lg",children:"Nachricht senden"})]})})},te.id)}if(te.friends.length===0&&te.room){const J=te.room,Q=p.map(de=>de.id),ce=J.participants.some(de=>Q.includes(de.userId));return c.jsx(F2,{position:[J.latitude,J.longitude],icon:A6e(J,ce),eventHandlers:{click:()=>r==null?void 0:r(J.id)},children:c.jsx(yB,{className:"custom-popup",children:c.jsxs("div",{className:"bg-[#1a1a1a] rounded-lg p-3 min-w-[160px]",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx(Xo,{className:"w-6 h-6 text-purple-400"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-white font-medium text-sm",children:J.name}),c.jsxs("p",{className:"text-white/50 text-xs",children:[J.participantCount," Teilnehmer"]})]})]}),c.jsx("button",{onClick:()=>r==null?void 0:r(J.id),className:"w-full py-1.5 bg-purple-500 text-white text-xs font-medium rounded-lg",children:"Beitreten"})]})})},te.id)}return c.jsx(F2,{position:[te.centerLat,te.centerLng],icon:k6e(te),eventHandlers:{click:()=>ne(te)},children:c.jsx(yB,{className:"custom-popup",children:c.jsxs("div",{className:"bg-[#1a1a1a] rounded-lg p-3 min-w-[180px]",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[c.jsx(Xo,{className:"w-6 h-6 text-purple-400"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-white font-medium text-sm",children:((he=te.room)==null?void 0:he.name)||"Gruppen-Wlkchen"}),c.jsxs("p",{className:"text-white/50 text-xs",children:[te.friends.length," Freunde",te.room&&`  ${te.room.participantCount} im Raum`]})]})]}),c.jsxs("div",{className:"flex -space-x-2 mb-3",children:[te.friends.slice(0,5).map(J=>c.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-[#1a1a1a]",children:J.avatarUrl?c.jsx("img",{src:J.avatarUrl,className:"w-full h-full rounded-full object-cover"}):c.jsx("div",{className:"w-full h-full rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white text-[10px] font-bold",children:J.displayName.slice(0,2).toUpperCase()})},J.id)),te.friends.length>5&&c.jsxs("div",{className:"w-8 h-8 rounded-full bg-white/10 flex items-center justify-center text-white text-[10px]",children:["+",te.friends.length-5]})]}),te.room&&c.jsx("button",{onClick:()=>r==null?void 0:r(te.room.id),className:"w-full py-1.5 bg-purple-500 text-white text-xs font-medium rounded-lg mb-2",children:"Wlkchen beitreten"}),c.jsx("div",{className:"grid grid-cols-2 gap-1",children:te.friends.slice(0,4).map(J=>c.jsx("button",{onClick:()=>e==null?void 0:e(J.id),className:"px-2 py-1 bg-white/5 text-white/70 text-[10px] rounded truncate hover:bg-white/10",children:J.displayName.split(" ")[0]},J.id))})]})})},te.id)})]}),H&&l&&c.jsxs("div",{className:"absolute bottom-24 left-4 z-[1000] bg-black/80 rounded-lg p-3 backdrop-blur-sm",children:[c.jsx("p",{className:"text-[10px] text-yellow-400 font-bold mb-2",children:"ADMIN LAYER"}),c.jsxs("div",{className:"space-y-1.5",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-3 h-3 rounded-full bg-purple-500/40"}),c.jsx("span",{className:"text-[10px] text-white/60",children:"Vibe Heatmap"})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-3 h-3 rounded-full bg-green-400"}),c.jsx("span",{className:"text-[10px] text-white/60",children:"Online Freunde"})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-3 h-3 rounded-full bg-purple-500"}),c.jsx("span",{className:"text-[10px] text-white/60",children:"Im Wlkchen"})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Xo,{size:12,className:"text-purple-400"}),c.jsx("span",{className:"text-[10px] text-white/60",children:"Aktive Rume"})]})]})]}),l&&c.jsx("button",{onClick:()=>{},className:"absolute bottom-24 right-4 z-[1000] p-3 bg-purple-500 rounded-full shadow-lg",children:c.jsx(_I,{size:20,className:"text-white"})}),!U&&p.length===0&&v.length===0&&c.jsx("div",{className:"absolute bottom-4 left-4 right-4 z-[1000]",children:c.jsxs("div",{className:"rounded-2xl p-4 text-center",style:{background:"rgba(5, 5, 5, 0.9)",backdropFilter:"blur(10px)",border:"1px solid rgba(139, 92, 246, 0.2)"},children:[c.jsx("p",{className:"text-sm text-white/60",children:"Keine Aktivitt in deiner Nhe"}),c.jsx("p",{className:"text-xs text-white/40 mt-1",children:"Freunde und Wlkchen werden hier angezeigt"})]})})]}):c.jsx("div",{className:`${l?"fixed inset-0 z-50":"h-64"} bg-[#050505] flex items-center justify-center`,children:c.jsxs("div",{className:"text-center",children:[c.jsx(no,{className:"w-12 h-12 text-purple-500/50 mx-auto mb-3"}),c.jsx("p",{className:"text-white/50 text-sm",children:"Standort wird bentigt"})]})})},Wme=V.memo(O6e,(t,e)=>{var l,u,p,m;const r=((l=t.userLocation)==null?void 0:l.latitude)===((u=e.userLocation)==null?void 0:u.latitude)&&((p=t.userLocation)==null?void 0:p.longitude)===((m=e.userLocation)==null?void 0:m.longitude),a=t.isFullscreen===e.isFullscreen;return r&&a});Wme.displayName="VibeMap";const L6e="MIbamchs82Ve7y0ecX2TpPyymbw1",j6e=50;function M6e(t,e,r,a){const u=(r-t)*Math.PI/180,p=(a-e)*Math.PI/180,m=Math.sin(u/2)*Math.sin(u/2)+Math.cos(t*Math.PI/180)*Math.cos(r*Math.PI/180)*Math.sin(p/2)*Math.sin(p/2);return 6371e3*(2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)))}function U6e(t){return t===void 0||t===1/0?"":t<100?`${Math.round(t)}m`:t<1e3?`${Math.round(t/10)*10}m`:`${(t/1e3).toFixed(1)}km`}function V6e(t){const r=new Date().getTime()-t.getTime(),a=Math.floor(r/(1e3*60*60*24));return a===0?"heute":a===1?"gestern":a<7?`vor ${a} Tagen`:`vor ${Math.floor(a/7)} Woche${a>=14?"n":""}`}const F6e=()=>{const t=yr(),{user:e}=Jr(),[r,a]=V.useState("all"),[l,u]=V.useState(""),[p,m]=V.useState(!0),[v,w]=V.useState([]),[R,C]=V.useState(!0),[A,O]=V.useState("recent"),[U,F]=V.useState(null),[q,W]=V.useState("inbox"),H=V.useRef(null),X=V.useRef(0),ne=V.useRef(0),te=V.useRef(!1),he=(e==null?void 0:e.id)===L6e;V.useEffect(()=>{"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(Me=>{F({latitude:Me.coords.latitude,longitude:Me.coords.longitude})},Me=>{console.warn("Could not get location:",Me),he&&F({latitude:52.52,longitude:13.405})},{enableHighAccuracy:!0,timeout:1e4})},[he]),V.useEffect(()=>{if(!(e!=null&&e.id)){C(!1);return}const Me=mn(De,"conversations"),Ke=Mr(Me,Kn("participants","array-contains",e.id),ih("lastMessageAt","desc")),Rt=na(Ke,async rt=>{var yt,Ct,Ot,vt;const mt=[];for(const zt of rt.docs){const ln=zt.data(),Pn=ln.participants.find(ni=>ni!==e.id);if(Pn)try{const ni=await Bn(tt(De,"users",Pn));if(!ni.exists())continue;const pr=ni.data(),nn=await Bn(tt(De,"friendships",`${e.id}_${Pn}`)),ri=await Bn(tt(De,"friendships",`${Pn}_${e.id}`)),un=nn.exists()||ri.exists(),ui=((yt=ln.unreadBy)==null?void 0:yt[e.id])||0;let Cs;const Jn=pr.lastLocation;U&&(Jn!=null&&Jn.latitude)&&(Jn!=null&&Jn.longitude)&&(Cs=M6e(U.latitude,U.longitude,Jn.latitude,Jn.longitude));const ds=pr.isActive&&((Ct=pr.lastSeen)==null?void 0:Ct.toDate())>new Date(Date.now()-5*60*1e3);mt.push({id:zt.id,oderId:Pn,username:pr.username||"unknown",displayName:pr.displayName||pr.username||"Unbekannt",avatarUrl:pr.avatarUrl,isFriend:un,metAt:(Ot=ln.metAt)==null?void 0:Ot.toDate(),lastMessage:ln.lastMessage?{content:ln.lastMessage.content,createdAt:((vt=ln.lastMessage.createdAt)==null?void 0:vt.toDate())||new Date,isFromMe:ln.lastMessage.senderId===e.id}:void 0,unreadCount:ui,isOnline:ds,level:pr.level||1,distance:Cs,location:Jn?{latitude:Jn.latitude,longitude:Jn.longitude}:void 0,inRoom:!!pr.currentRoomId,roomId:pr.currentRoomId,roomName:pr.currentRoomName})}catch(ni){console.error("Error fetching user data:",ni)}}w(mt),C(!1)},rt=>{console.error("Error fetching conversations:",rt),C(!1)});return()=>Rt()},[e==null?void 0:e.id,U]);const J=V.useMemo(()=>{let Me=v.filter(Ke=>{if(l){const Rt=l.toLowerCase();if(!Ke.username.toLowerCase().includes(Rt)&&!Ke.displayName.toLowerCase().includes(Rt))return!1}return r==="friends"?Ke.isFriend:r==="met"?!Ke.isFriend&&Ke.metAt:!0});switch(A){case"proximity":return[...Me].sort((Ke,Rt)=>{var Ot,vt;if(Ke.inRoom&&!Rt.inRoom)return-1;if(!Ke.inRoom&&Rt.inRoom)return 1;const rt=Ke.distance??1/0,mt=Rt.distance??1/0;if(rt!==mt)return rt-mt;const yt=((Ot=Ke.lastMessage)==null?void 0:Ot.createdAt.getTime())||0;return(((vt=Rt.lastMessage)==null?void 0:vt.createdAt.getTime())||0)-yt});case"unread":return[...Me].sort((Ke,Rt)=>{var yt,Ct;if(Ke.unreadCount!==Rt.unreadCount)return Rt.unreadCount-Ke.unreadCount;const rt=((yt=Ke.lastMessage)==null?void 0:yt.createdAt.getTime())||0;return(((Ct=Rt.lastMessage)==null?void 0:Ct.createdAt.getTime())||0)-rt});case"recent":default:return[...Me].sort((Ke,Rt)=>{var yt,Ct;if(Ke.unreadCount!==Rt.unreadCount)return Rt.unreadCount-Ke.unreadCount;const rt=((yt=Ke.lastMessage)==null?void 0:yt.createdAt.getTime())||0;return(((Ct=Rt.lastMessage)==null?void 0:Ct.createdAt.getTime())||0)-rt})}},[v,l,r,A]),Q=v.filter(Me=>Me.isFriend).length,ce=v.filter(Me=>!Me.isFriend&&Me.metAt).length,de=v.reduce((Me,Ke)=>Me+Ke.unreadCount,0),pe=v.filter(Me=>Me.distance!==void 0&&Me.distance<2e3).length,be=Me=>{const Rt=new Date().getTime()-Me.getTime(),rt=Math.floor(Rt/(1e3*60*60*24));return rt===0?Me.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"}):rt===1?"Gestern":rt<7?Me.toLocaleDateString("de-DE",{weekday:"short"}):Me.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit"})},ye=Me=>{const Ke=v.find(Rt=>Rt.oderId===Me);Ke&&t(`/chat/${Ke.id}`)},Ze=Me=>{t("/discover",{state:{joinRoom:!0,roomId:Me}})},It=Me=>{Me.roomId&&t("/discover",{state:{joinRoom:!0,roomId:Me.roomId}})},St=Me=>{X.current=Me.touches[0].clientX,te.current=!0},lt=Me=>{te.current&&(ne.current=Me.touches[0].clientX)},Le=()=>{if(!te.current)return;const Me=X.current-ne.current;Math.abs(Me)>j6e&&(Me>0&&q==="inbox"?W("map"):Me<0&&q==="map"&&W("inbox")),te.current=!1,X.current=0,ne.current=0};return R?c.jsx("div",{className:"min-h-screen bg-gradient-to-b from-[#050505] to-[#0a0a0a] flex items-center justify-center",children:c.jsxs("div",{className:"text-center",children:[c.jsx(fi,{size:32,className:"animate-spin text-purple-500 mx-auto mb-4"}),c.jsx("p",{className:"text-white/50 text-sm",children:"Lade Nachrichten..."})]})}):c.jsxs("div",{ref:H,className:"min-h-screen bg-gradient-to-b from-[#050505] to-[#0a0a0a] safe-top pb-24 overflow-hidden",onTouchStart:St,onTouchMove:lt,onTouchEnd:Le,children:[c.jsxs("div",{className:"px-4 pt-4 pb-2",children:[c.jsxs("div",{className:"flex bg-white/5 rounded-xl p-1 border border-white/5",children:[c.jsxs("button",{onClick:()=>W("inbox"),className:`flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg text-sm font-medium transition-all ${q==="inbox"?"bg-purple-500 text-white shadow-lg shadow-purple-500/25":"text-white/50 hover:text-white/70"}`,children:[c.jsx(S5e,{size:16}),"Inbox",de>0&&c.jsx("span",{className:"px-1.5 py-0.5 rounded-full bg-red-500 text-white text-[10px] font-bold",children:de>9?"9+":de})]}),c.jsxs("button",{onClick:()=>W("map"),className:`flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg text-sm font-medium transition-all ${q==="map"?"bg-purple-500 text-white shadow-lg shadow-purple-500/25":"text-white/50 hover:text-white/70"}`,children:[c.jsx(wpe,{size:16}),"Karte",pe>0&&q!=="map"&&c.jsx("span",{className:"px-1.5 py-0.5 rounded-full bg-purple-400/50 text-white text-[10px] font-bold",children:pe})]})]}),c.jsx("div",{className:"flex justify-center mt-2",children:c.jsxs("div",{className:"flex gap-1.5",children:[c.jsx("div",{className:`w-6 h-1 rounded-full transition-all ${q==="inbox"?"bg-purple-500":"bg-white/20"}`}),c.jsx("div",{className:`w-6 h-1 rounded-full transition-all ${q==="map"?"bg-purple-500":"bg-white/20"}`})]})})]}),c.jsx(Ur,{mode:"wait",children:q==="map"?c.jsxs(Ne.div,{initial:{opacity:0,x:100},animate:{opacity:1,x:0},exit:{opacity:0,x:100},transition:{duration:.25,ease:"easeOut"},className:"h-[calc(100vh-180px)]",children:[c.jsx(Wme,{userLocation:U,onFriendClick:ye,onRoomClick:Ze,isFullscreen:!1}),c.jsx("div",{className:"px-4 py-3 bg-[#0a0a0a] border-t border-white/5",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-4 text-[10px] text-white/50",children:[c.jsxs("span",{className:"flex items-center gap-1",children:[c.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400"}),"Online"]}),c.jsxs("span",{className:"flex items-center gap-1",children:[c.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-500"}),"Im Raum"]}),c.jsxs("span",{className:"flex items-center gap-1",children:[c.jsx("div",{className:"w-3 h-3 rounded bg-purple-500/30"}),"Vibe Zone"]})]}),he&&c.jsxs("span",{className:"text-[10px] text-yellow-400 flex items-center gap-1",children:[c.jsx(kn,{size:10}),"Admin"]})]})})]},"map-view"):c.jsxs(Ne.div,{initial:{opacity:0,x:-100},animate:{opacity:1,x:0},exit:{opacity:0,x:-100},transition:{duration:.25,ease:"easeOut"},children:[c.jsx(i6e,{userLocation:U,onFriendClick:ye,onRoomClick:Ze}),c.jsxs("div",{className:"px-6 pt-4 pb-4",children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"font-display text-2xl font-bold text-white",children:"Nachrichten"}),c.jsx("p",{className:"text-sm text-white/50",children:de>0?`${de} ungelesen`:pe>0?`${pe} in der Nhe`:"Keine neuen Nachrichten"})]}),c.jsxs("button",{onClick:()=>{const Me=["recent","proximity","unread"],Ke=Me.indexOf(A);O(Me[(Ke+1)%Me.length])},className:"flex items-center gap-2 px-3 py-2 rounded-xl bg-white/5 border border-white/10 text-white/70 text-xs",children:[c.jsx(m5e,{size:14}),A==="recent"&&"Neueste",A==="proximity"&&"Nhe",A==="unread"&&"Ungelesen"]})]}),v.length>0&&c.jsxs("div",{className:"relative mb-4",children:[c.jsx(xw,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-white/30"}),c.jsx("input",{type:"text",value:l,onChange:Me=>u(Me.target.value),placeholder:"Suche nach Kontakten...",className:"w-full pl-11 pr-4 py-3 bg-white/5 border border-white/10 rounded-xl text-sm text-white placeholder-white/30 focus:outline-none focus:ring-2 focus:ring-purple-500/30"})]}),v.length>0&&c.jsx("div",{className:"flex gap-2",children:[{id:"all",label:"Alle",count:v.length},{id:"friends",label:"Freunde",count:Q,icon:xie},{id:"met",label:"Getroffen",count:ce,icon:cr}].map(Me=>c.jsxs("button",{onClick:()=>a(Me.id),className:`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-semibold transition-all ${r===Me.id?"bg-purple-500 text-white shadow-lg shadow-purple-500/25":"bg-white/5 text-white/50 hover:bg-white/10"}`,children:[Me.icon&&c.jsx(Me.icon,{size:16}),Me.label,c.jsx("span",{className:`px-1.5 py-0.5 rounded-full text-[10px] ${r===Me.id?"bg-white/20":"bg-white/10"}`,children:Me.count})]},Me.id))})]}),p&&v.length>0&&c.jsx("div",{className:"px-6 mb-4",children:c.jsxs("div",{className:"bg-purple-500/10 border border-purple-500/20 rounded-2xl p-4 flex items-start gap-3",children:[c.jsx(cs,{size:20,className:"text-purple-400 flex-shrink-0 mt-0.5"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("p",{className:"text-sm text-white/80 font-medium",children:"Privatsphre geschtzt"}),c.jsx("p",{className:"text-xs text-white/50 mt-1",children:"Du kannst nur mit Freunden oder Usern chatten, die du bereits in der App getroffen hast."})]}),c.jsx("button",{onClick:()=>m(!1),className:"text-white/30 hover:text-white/60",children:""})]})}),c.jsx("div",{className:"px-6",children:v.length===0?c.jsxs("div",{className:"text-center py-16",children:[c.jsx("div",{className:"w-24 h-24 mx-auto rounded-3xl bg-white/5 flex items-center justify-center mb-6",children:c.jsx(hp,{size:40,className:"text-white/30"})}),c.jsx("h3",{className:"font-display font-bold text-xl text-white mb-3",children:r9.empty.messages}),c.jsx("p",{className:"text-sm text-white/50 mb-8 max-w-xs mx-auto leading-relaxed",children:"Triff Leute in Voice-Rumen oder fge Freunde hinzu, um Gesprche zu starten."}),c.jsxs("button",{onClick:()=>t("/discover"),className:"inline-flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-2xl font-display font-bold shadow-lg shadow-purple-500/25",children:[c.jsx($m,{size:20}),"Rume entdecken"]})]}):J.length===0?c.jsxs("div",{className:"text-center py-12",children:[c.jsx("div",{className:"w-20 h-20 mx-auto rounded-2xl bg-white/5 flex items-center justify-center mb-4",children:c.jsx(xw,{size:32,className:"text-white/30"})}),c.jsx("h3",{className:"font-semibold text-white mb-2",children:"Keine Ergebnisse"}),c.jsx("p",{className:"text-sm text-white/50 mb-6 max-w-xs mx-auto",children:"Versuche einen anderen Suchbegriff oder wechsle den Filter."}),c.jsx("button",{onClick:()=>{u(""),a("all")},className:"px-6 py-3 bg-purple-500 text-white rounded-xl font-semibold",children:"Filter zurcksetzen"})]}):c.jsx("div",{className:"space-y-2",children:c.jsx(Ur,{mode:"popLayout",children:J.map((Me,Ke)=>c.jsxs(Ne.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,x:-100},transition:{delay:Ke*.02},onClick:()=>t(`/chat/${Me.id}`),className:"w-full bg-white/5 backdrop-blur-sm border border-white/5 rounded-2xl p-4 flex items-center gap-4 text-left hover:bg-white/10 transition-all group",children:[c.jsxs("div",{className:"relative",children:[Me.avatarUrl?c.jsx("img",{src:Me.avatarUrl,alt:Me.displayName,className:"w-14 h-14 rounded-xl object-cover"}):c.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center font-display font-bold text-white text-lg",children:Me.displayName.slice(0,2).toUpperCase()}),Me.inRoom?c.jsx("div",{className:"absolute -bottom-1 -right-1 p-1 bg-purple-500 rounded-full shadow-lg shadow-purple-500/50",children:c.jsx(Epe,{size:10,className:"text-white"})}):Me.isOnline?c.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-[#0a0a0a]"}):null,Me.unreadCount>0&&c.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center",children:c.jsx("span",{className:"text-[10px] font-bold text-white",children:Me.unreadCount>9?"9+":Me.unreadCount})})]}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[c.jsx("p",{className:"font-semibold text-white truncate",children:Me.displayName}),Me.isFriend&&c.jsx(xie,{size:14,className:"text-green-400 flex-shrink-0"}),c.jsxs("span",{className:"text-[10px] text-white/30",children:["Lv.",Me.level]})]}),Me.inRoom&&Me.roomName?c.jsxs("p",{className:"text-sm text-purple-400 flex items-center gap-1",children:[c.jsx(Yd,{size:12,className:"animate-pulse"}),"In: ",Me.roomName]}):Me.lastMessage?c.jsxs("p",{className:`text-sm truncate ${Me.unreadCount>0?"text-white font-medium":"text-white/50"}`,children:[Me.lastMessage.isFromMe&&c.jsx("span",{className:"text-white/30",children:"Du: "}),Me.lastMessage.content]}):c.jsx("p",{className:"text-sm text-white/30 italic",children:Me.isFriend?"Noch keine Nachrichten":`Getroffen ${V6e(Me.metAt)}`})]}),c.jsxs("div",{className:"flex flex-col items-end gap-1",children:[Me.lastMessage&&c.jsx("span",{className:"text-[10px] text-white/30",children:be(Me.lastMessage.createdAt)}),Me.distance!==void 0&&Me.distance<5e4&&c.jsxs("span",{className:"text-[9px] px-2 py-0.5 rounded-full bg-purple-500/20 text-purple-400 flex items-center gap-1",children:[c.jsx(no,{size:8}),U6e(Me.distance)]}),Me.inRoom&&Me.roomId?c.jsx("button",{onClick:Rt=>{Rt.stopPropagation(),It(Me)},className:"mt-1 text-[10px] px-2 py-1 rounded-full bg-purple-500 text-white font-medium hover:bg-purple-400 transition-colors",children:"Anhren"}):c.jsx(Fi,{size:18,className:"text-white/20 group-hover:text-white/50 transition-colors"})]})]},Me.id))})})}),he&&c.jsx("div",{className:"fixed bottom-28 left-1/2 -translate-x-1/2 px-4 py-2 rounded-full bg-purple-500/20 border border-purple-500/30 backdrop-blur-sm z-50",children:c.jsxs("span",{className:"text-[10px] text-purple-400 flex items-center gap-2",children:[c.jsx(kn,{size:12}),"Founder View: Alle Distanzen sichtbar"]})})]},"inbox-view")})]})};function tj(){const{user:t}=Jr(),[e,r]=V.useState([]),[a,l]=V.useState([]),[u,p]=V.useState(!0),m=V.useCallback(async()=>{var O;if(!(t!=null&&t.id)){r([]),p(!1);return}try{const U=mn(De,"blocks"),F=Mr(U,Kn("blockerId","==",t.id)),q=await Cr(F),W=[],H=[];for(const X of q.docs){const ne=X.data();try{const te=await Bn(tt(De,"users",ne.blockedUserId));if(!te.exists()){H.push(X.id);continue}const he=te.data();W.push({id:X.id,blockerId:ne.blockerId,blockedUserId:ne.blockedUserId,username:(he==null?void 0:he.username)||"Gelschter Nutzer",displayName:he==null?void 0:he.displayName,avatar:he==null?void 0:he.avatar,avatarUrl:(he==null?void 0:he.avatarUrl)||(he==null?void 0:he.photoURL),blockedAt:((O=ne.blockedAt)==null?void 0:O.toDate())||new Date,reason:ne.reason,customReason:ne.customReason})}catch{H.push(X.id)}}for(const X of H)try{await Tc(tt(De,"blocks",X)),console.log("Cleaned up orphaned block entry:",X)}catch(ne){console.error("Failed to clean up block entry:",ne)}r(W)}catch(U){console.error("Error fetching blocked users:",U),r([])}finally{p(!1)}},[t==null?void 0:t.id]),v=V.useCallback(async()=>{if(t!=null&&t.id)try{const O=mn(De,"blocks"),U=Mr(O,Kn("blockedUserId","==",t.id)),q=(await Cr(U)).docs.map(W=>W.data().blockerId);l(q)}catch(O){console.error("Error fetching blocked by users:",O)}},[t==null?void 0:t.id]);V.useEffect(()=>{if(!(t!=null&&t.id)){r([]),l([]),p(!1);return}p(!0);const O=mn(De,"blocks"),U=Mr(O,Kn("blockerId","==",t.id)),F=na(U,async q=>{var X;const W=[],H=[];for(const ne of q.docs){const te=ne.data();try{const he=await Bn(tt(De,"users",te.blockedUserId));if(!he.exists()){H.push(ne.id);continue}const J=he.data();W.push({id:ne.id,blockerId:te.blockerId,blockedUserId:te.blockedUserId,username:(J==null?void 0:J.username)||"Gelschter Nutzer",displayName:J==null?void 0:J.displayName,avatar:J==null?void 0:J.avatar,avatarUrl:(J==null?void 0:J.avatarUrl)||(J==null?void 0:J.photoURL),blockedAt:((X=te.blockedAt)==null?void 0:X.toDate())||new Date,reason:te.reason,customReason:te.customReason})}catch{H.push(ne.id)}}for(const ne of H)try{await Tc(tt(De,"blocks",ne))}catch{}r(W),p(!1)},q=>{console.error("Error in blocked users listener:",q),r([]),p(!1)});return v(),()=>F()},[t==null?void 0:t.id,v]);const w=V.useCallback(async(O,U,F)=>{if(!(t!=null&&t.id)||O===t.id)return!1;try{return(await Bn(tt(De,"users",O))).exists()?(e.find(H=>H.blockedUserId===O)||(await Lv(mn(De,"blocks"),{blockerId:t.id,blockedUserId:O,blockedAt:ci(),reason:U||"personal",customReason:F||null}),"vibrate"in navigator&&navigator.vibrate([30,20,30])),!0):(console.error("Cannot block non-existent user"),!1)}catch(q){return console.error("Error blocking user:",q),!1}},[t==null?void 0:t.id,e]),R=V.useCallback(async O=>{if(!(t!=null&&t.id))return!1;try{const U=e.find(F=>F.blockedUserId===O);return U?(await Tc(tt(De,"blocks",U.id)),"vibrate"in navigator&&navigator.vibrate(10),!0):!1}catch(U){return console.error("Error unblocking user:",U),!1}},[t==null?void 0:t.id,e]),C=V.useCallback(O=>e.some(U=>U.blockedUserId===O),[e]),A=V.useCallback(O=>a.includes(O),[a]);return{blockedUsers:e,isLoading:u,blockUser:w,unblockUser:R,isBlocked:C,isBlockedBy:A,refreshBlockedUsers:m}}const B6e={maxSizeMB:5,quality:.85,maxWidth:1200,maxHeight:1200,outputFormat:"webp",onProgress:()=>{}},Hme={webp:"image/webp",jpeg:"image/jpeg",png:"image/png"};function z6e(t){return new Promise((e,r)=>{const a=new Image;a.onload=()=>e(a),a.onerror=r,a.src=URL.createObjectURL(t)})}async function G6e(t,e){const r=await z6e(t);let{width:a,height:l}=r;const{maxWidth:u,maxHeight:p,quality:m,outputFormat:v}=e;if(a>u||l>p){const C=Math.min(u/a,p/l);a=Math.round(a*C),l=Math.round(l*C)}const w=document.createElement("canvas");w.width=a,w.height=l;const R=w.getContext("2d");if(!R)throw new Error("Canvas context not available");return R.imageSmoothingEnabled=!0,R.imageSmoothingQuality="high",R.drawImage(r,0,0,a,l),new Promise((C,A)=>{w.toBlob(O=>{O?C(O):A(new Error("Failed to create blob"))},Hme[v],m)})}function W6e(){const[t,e]=V.useState({state:"idle",progress:0,bytesTransferred:0,totalBytes:0}),r=V.useRef(null),a=V.useRef(null),l=V.useCallback(async(m,v,w={})=>{const R={...B6e,...w},{maxSizeMB:C,outputFormat:A,onProgress:O}=R;r.current=new AbortController;try{if(e({state:"preparing",progress:5,bytesTransferred:0,totalBytes:v.size}),O==null||O({state:"preparing",progress:5,bytesTransferred:0,totalBytes:v.size}),!v.type.startsWith("image/"))throw new Error("Nur Bilder erlaubt");if(v.size>C*1024*1024)throw new Error(`Bild zu gro (max ${C}MB)`);e(ne=>({...ne,state:"preparing",progress:15})),O==null||O({state:"preparing",progress:15,bytesTransferred:0,totalBytes:v.size});const U=await G6e(v,R);e(ne=>({...ne,progress:25,totalBytes:U.size})),O==null||O({state:"preparing",progress:25,bytesTransferred:0,totalBytes:U.size});const F=Date.now(),q=`profile-images/${m}/${F}.${A}`,W=yO(Zhe,q),H={contentType:Hme[A],customMetadata:{userId:m,uploadedAt:new Date().toISOString(),originalName:v.name,originalSize:String(v.size),processedSize:String(U.size)}};e(ne=>({...ne,state:"uploading",progress:30})),O==null||O({state:"uploading",progress:30,bytesTransferred:0,totalBytes:U.size});const X=pMe(W,U,H);return a.current=X,new Promise((ne,te)=>{X.on("state_changed",he=>{const J=he.bytesTransferred/he.totalBytes,Q=30+Math.round(J*65);e({state:"uploading",progress:Q,bytesTransferred:he.bytesTransferred,totalBytes:he.totalBytes}),O==null||O({state:"uploading",progress:Q,bytesTransferred:he.bytesTransferred,totalBytes:he.totalBytes})},he=>{let J="Upload fehlgeschlagen";he.code==="storage/canceled"?J="Upload abgebrochen":he.code==="storage/retry-limit-exceeded"?J="Netzwerkfehler. Bitte erneut versuchen.":he.code==="storage/unauthorized"&&(J="Keine Berechtigung fr Upload"),e({state:"error",progress:0,bytesTransferred:0,totalBytes:0,error:J}),O==null||O({state:"error",progress:0,bytesTransferred:0,totalBytes:0,error:J}),te(new Error(J))},async()=>{try{e(J=>({...J,state:"processing",progress:95})),O==null||O({state:"processing",progress:95,bytesTransferred:U.size,totalBytes:U.size});const he=await _O(X.snapshot.ref);e({state:"complete",progress:100,bytesTransferred:U.size,totalBytes:U.size,downloadUrl:he}),O==null||O({state:"complete",progress:100,bytesTransferred:U.size,totalBytes:U.size,downloadUrl:he}),"vibrate"in navigator&&navigator.vibrate([15,10,15]),ne({success:!0,url:he})}catch{te(new Error("Konnte Download-URL nicht abrufen"))}})})}catch(U){const F=U.message||"Upload fehlgeschlagen";return e({state:"error",progress:0,bytesTransferred:0,totalBytes:0,error:F}),O==null||O({state:"error",progress:0,bytesTransferred:0,totalBytes:0,error:F}),{success:!1,error:F}}},[]),u=V.useCallback(()=>{a.current&&a.current.cancel(),r.current&&r.current.abort(),e({state:"idle",progress:0,bytesTransferred:0,totalBytes:0})},[]),p=V.useCallback(()=>{e({state:"idle",progress:0,bytesTransferred:0,totalBytes:0})},[]);return{progress:t,uploadProfileImage:l,cancelUpload:u,resetProgress:p}}const Kme=({size:t=80,editable:e=!1,userId:r,avatarUrl:a,displayName:l,className:u="",showOnline:p=!1,isOnline:m=!1,onClick:v})=>{const{user:w,setUser:R}=Jr(),C=V.useRef(null),[A,O]=V.useState(null),{progress:U,uploadProfileImage:F,cancelUpload:q}=W6e(),W=r||(w==null?void 0:w.id),H=a!==void 0?a:w==null?void 0:w.avatarUrl,X=l||(w==null?void 0:w.displayName)||"User",ne=X.split(" ").map(pe=>pe[0]).join("").toUpperCase().slice(0,2),te=U.state==="preparing"||U.state==="uploading"||U.state==="processing",he=U.progress,J=V.useCallback(async pe=>{var Ze;const be=(Ze=pe.target.files)==null?void 0:Ze[0];if(!be||!W)return;O(null);const ye=await F(W,be,{maxSizeMB:5,quality:.85,maxWidth:1200,maxHeight:1200,outputFormat:"webp"});if(ye.success&&ye.url)try{await Xn(tt(De,"users",W),{avatarUrl:ye.url}),w&&W===w.id&&R({...w,avatarUrl:ye.url})}catch(It){console.error("Failed to update user document:",It),O("Datenbankfehler. Bitte erneut versuchen.")}else O(ye.error||"Upload fehlgeschlagen");C.current&&(C.current.value="")},[W,w,R,F]),Q=V.useCallback(()=>{q(),O(null),C.current&&(C.current.value="")},[q]),ce=()=>{var pe;v?v():e&&!te&&((pe=C.current)==null||pe.click())},de={width:t,height:t,fontSize:t*.4};return c.jsxs("div",{className:`relative group ${u}`,style:de,children:[e&&c.jsx("input",{ref:C,type:"file",accept:"image/*",onChange:J,className:"hidden"}),c.jsxs("button",{onClick:ce,disabled:te,className:`
          w-full h-full rounded-full overflow-hidden
          bg-gradient-to-br from-violet-500 to-purple-600
          flex items-center justify-center
          transition-all duration-200
          ${e?"cursor-pointer hover:ring-4 hover:ring-violet-500/30":""}
          ${te?"opacity-70":""}
          theme-transition
        `,style:de,children:[H?c.jsx("img",{src:H,alt:X,className:"w-full h-full object-cover",loading:"lazy"}):c.jsx("span",{className:"text-white font-bold",children:ne||c.jsx(md,{size:t*.5})}),te&&c.jsxs("div",{className:"absolute inset-0 bg-black/60 rounded-full flex flex-col items-center justify-center",children:[c.jsxs("div",{className:"relative",children:[c.jsxs("svg",{className:"w-12 h-12 -rotate-90",viewBox:"0 0 36 36",children:[c.jsx("circle",{className:"text-white/20",strokeWidth:"3",stroke:"currentColor",fill:"transparent",r:"16",cx:"18",cy:"18"}),c.jsx("circle",{className:"text-white",strokeWidth:"3",strokeDasharray:`${he} 100`,strokeLinecap:"round",stroke:"currentColor",fill:"transparent",r:"16",cx:"18",cy:"18"})]}),c.jsxs("span",{className:"absolute inset-0 flex items-center justify-center text-white text-xs font-medium",children:[he,"%"]})]}),c.jsxs("button",{onClick:pe=>{pe.stopPropagation(),Q()},className:"mt-2 text-white/80 hover:text-white text-xs flex items-center gap-1",children:[c.jsx(Di,{size:12}),"Abbrechen"]})]}),U.state==="error"&&A&&c.jsx("div",{className:"absolute inset-0 bg-red-500/80 rounded-full flex items-center justify-center",children:c.jsx("span",{className:"text-white text-xs text-center px-2",children:A})}),e&&!te&&c.jsx("div",{className:"absolute inset-0 bg-black/40 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:c.jsx(vO,{className:"w-6 h-6 text-white"})})]}),p&&m&&c.jsx("div",{className:"absolute bottom-0 right-0 bg-green-500 rounded-full border-2 border-[var(--synclulu-bg)]",style:{width:t*.25,height:t*.25}})]})},Zse=({compact:t=!1})=>{const{language:e,setLanguage:r,currentLanguage:a}=ag(),[l,u]=V.useState(!1),p=m=>{r(m),u(!1)};return t?c.jsxs("div",{className:"relative",children:[c.jsxs("button",{onClick:()=>u(!l),className:"flex items-center gap-2 px-3 py-2 rounded-xl bg-synclulu-soft hover:bg-synclulu-soft/80 transition-colors",children:[c.jsx("span",{className:"text-lg",children:a.flag}),c.jsx(xW,{size:16,className:`text-synclulu-muted transition-transform ${l?"rotate-180":""}`})]}),l&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>u(!1)}),c.jsx("div",{className:"absolute right-0 top-full mt-2 bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden z-50 min-w-[160px]",children:Object.entries(Wd).map(([m,v])=>c.jsxs("button",{onClick:()=>p(m),className:`w-full flex items-center gap-3 px-4 py-3 hover:bg-synclulu-soft transition-colors ${e===m?"bg-synclulu-soft":""}`,children:[c.jsx("span",{className:"text-lg",children:v.flag}),c.jsx("span",{className:"font-medium text-synclulu-text flex-1 text-left",children:v.native}),e===m&&c.jsx(_r,{size:16,className:"text-synclulu-violet"})]},m))})]})]}):c.jsx("div",{className:"space-y-2",children:Object.entries(Wd).map(([m,v])=>c.jsxs("button",{onClick:()=>p(m),className:`w-full flex items-center gap-4 p-4 rounded-2xl transition-all ${e===m?"bg-synclulu-violet/10 border-2 border-synclulu-violet":"bg-synclulu-soft border-2 border-transparent hover:border-synclulu-violet/20"}`,children:[c.jsx("span",{className:"text-2xl",children:v.flag}),c.jsxs("div",{className:"flex-1 text-left",children:[c.jsx("p",{className:"font-semibold text-synclulu-text",children:v.native}),c.jsx("p",{className:"text-xs text-synclulu-muted",children:v.name})]}),e===m&&c.jsx("div",{className:"w-6 h-6 rounded-full bg-synclulu-violet flex items-center justify-center",children:c.jsx(_r,{size:14,className:"text-white"})})]},m))})},ob={minLength:3,maxLength:20,pattern:/^[a-z0-9_]+$/,reserved:["admin","synclulu","support","help","system","mod","moderator"]},H6e=[{id:"harassment",label:"Belstigung",icon:""},{id:"spam",label:"Spam / Werbung",icon:""},{id:"inappropriate",label:"Unangemessenes Verhalten",icon:""},{id:"personal",label:"Persnliche Grnde",icon:""},{id:"other",label:"Sonstiges",icon:""}],eae={freeStarsPerDay:3,premiumStarsPerDay:15},B2={starsRequired:500,levelRequired:25,voiceMinutesRequired:120,minPositiveRatings:80},EC=30,qme=t=>{const e=t.toLowerCase().trim();return e.length<ob.minLength?{isValid:!1,error:`Mindestens ${ob.minLength} Zeichen erforderlich`}:e.length>ob.maxLength?{isValid:!1,error:`Maximal ${ob.maxLength} Zeichen erlaubt`}:ob.pattern.test(e)?ob.reserved.includes(e)?{isValid:!1,error:"Dieser Username ist reserviert"}:{isValid:!0}:{isValid:!1,error:"Nur Kleinbuchstaben, Zahlen und Unterstriche erlaubt"}},Yme=async(t,e)=>{const r=t.toLowerCase().trim();try{const a=mn(De,"users"),l=Mr(a,Kn("username","==",r)),u=await Cr(l);return u.empty?{isAvailable:!0}:e&&u.docs[0].id===e?{isAvailable:!0}:{isAvailable:!1,error:"Dieser Username ist bereits vergeben"}}catch(a){return console.error("Error checking username:",a),{isAvailable:!1,error:"Fehler bei der Prfung"}}},bw=async t=>{var e;try{const r=tt(De,"users",t),a=await Bn(r);if(!a.exists())return{canChange:!0,daysRemaining:0,lastChanged:null,nextChangeDate:null,progressPercent:100};const u=((e=a.data().usernameLastChanged)==null?void 0:e.toDate())||null;if(!u)return{canChange:!0,daysRemaining:0,lastChanged:null,nextChangeDate:null,progressPercent:100};const m=Math.floor((new Date().getTime()-u.getTime())/(1e3*60*60*24)),v=Math.max(0,EC-m),w=Math.min(100,m/EC*100),R=new Date(u);return R.setDate(R.getDate()+EC),{canChange:v===0,daysRemaining:v,lastChanged:u,nextChangeDate:R,progressPercent:w}}catch(r){return console.error("Error getting username change status:",r),{canChange:!1,daysRemaining:EC,lastChanged:null,nextChangeDate:null,progressPercent:0}}},K6e=async(t,e)=>{var r;try{const a=qme(e);if(!a.isValid)return{success:!1,error:a.error};const l=await bw(t);if(!l.canChange)return{success:!1,error:`Du kannst deinen Username erst in ${l.daysRemaining} Tagen ndern`};const u=e.toLowerCase().trim(),p=await Yme(u,t);if(!p.isAvailable)return{success:!1,error:p.error};const m=tt(De,"users",t),w=((r=(await Bn(m)).data())==null?void 0:r.usernameChangeCount)||0;return await Xn(m,{username:u,usernameLastChanged:ci(),usernameChangeCount:w+1}),{success:!0}}catch(a){return console.error("Error changing username:",a),{success:!1,error:"Fehler beim ndern des Usernamens"}}},q6e=t=>t===0?"Jetzt nderbar":t===1?"Noch 1 Tag":`Noch ${t} Tage`,tae=t=>t?t.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}):"Nie gendert",Y6e=({progress:t,size:e,strokeWidth:r,daysRemaining:a})=>{const l=(e-r)/2,u=l*2*Math.PI,p=u-t/100*u;return c.jsxs("div",{className:"relative",style:{width:e,height:e},children:[c.jsxs("svg",{width:e,height:e,className:"transform -rotate-90",children:[c.jsx("circle",{cx:e/2,cy:e/2,r:l,fill:"none",stroke:"#E5E7EB",strokeWidth:r}),c.jsx("circle",{cx:e/2,cy:e/2,r:l,fill:"none",stroke:t>=100?"#10B981":"#8B5CF6",strokeWidth:r,strokeDasharray:u,strokeDashoffset:p,strokeLinecap:"round",className:"transition-all duration-1000 ease-out"})]}),c.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t>=100?c.jsx(K_,{size:24,className:"text-green-500"}):c.jsxs("div",{className:"text-center",children:[c.jsx("p",{className:"text-xl font-bold text-gray-900",children:a}),c.jsx("p",{className:"text-[10px] text-gray-500",children:"Tage"})]})})]})},$me=({isOpen:t,onClose:e,onSuccess:r})=>{const{user:a,setUser:l}=Jr(),[u,p]=V.useState((a==null?void 0:a.username)||""),[m,v]=V.useState(null),[w,R]=V.useState(!0),[C,A]=V.useState(!1),[O,U]=V.useState(null),[F,q]=V.useState(null),[W,H]=V.useState(!1);V.useEffect(()=>{a!=null&&a.id&&t&&X()},[a==null?void 0:a.id,t]);const X=async()=>{if(a!=null&&a.id){R(!0);try{const Q=await bw(a.id);v(Q)}catch(Q){console.error("Failed to load username status:",Q)}finally{R(!1)}}},ne=V.useCallback(Ipe.debounce(async Q=>{if(!Q||Q===(a==null?void 0:a.username)){q(null);return}const ce=qme(Q);if(!ce.isValid){U(ce.error||null),q(!1),H(!1);return}H(!0),U(null);try{const de=await Yme(Q,a==null?void 0:a.id);q(de.isAvailable),de.isAvailable||U(de.error||"Username nicht verfgbar")}catch{q(!1),U("Prfung fehlgeschlagen")}finally{H(!1)}},500),[a==null?void 0:a.id,a==null?void 0:a.username]),te=Q=>{const ce=Q.toLowerCase().replace(/[^a-z0-9_]/g,"");p(ce),q(null),U(null),ce&&ce!==(a==null?void 0:a.username)&&ne(ce)},he=async()=>{if(!(!(a!=null&&a.id)||!u||u===(a==null?void 0:a.username))){A(!0),U(null);try{const Q=await K6e(a.id,u);Q.success?(l({...a,username:u}),"vibrate"in navigator&&navigator.vibrate([20,10,30]),r==null||r(u),e()):U(Q.error||"nderung fehlgeschlagen")}catch{U("Ein Fehler ist aufgetreten")}finally{A(!1)}}};if(!t)return null;const J=u!==(a==null?void 0:a.username)&&F&&!W&&(m==null?void 0:m.canChange);return c.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 animate-in fade-in",onClick:e,children:c.jsxs("div",{className:"w-full max-w-md bg-white rounded-3xl overflow-hidden shadow-2xl animate-in zoom-in-95",onClick:Q=>Q.stopPropagation(),children:[c.jsxs("div",{className:"bg-gradient-to-br from-violet-500 to-purple-600 px-6 py-6 text-white",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("h2",{className:"font-display text-xl font-bold",children:"Username ndern"}),c.jsx("button",{onClick:e,className:"w-8 h-8 rounded-full bg-white/20 flex items-center justify-center",children:c.jsx(Di,{size:18})})]}),c.jsx("p",{className:"text-white/80 text-sm mt-1",children:"Dein @handle ist deine Identitt"})]}),c.jsx("div",{className:"p-6",children:w?c.jsx("div",{className:"flex items-center justify-center py-12",children:c.jsx(fi,{size:32,className:"text-purple-500 animate-spin"})}):c.jsxs(c.Fragment,{children:[m&&c.jsxs("div",{className:"flex items-center gap-4 mb-6 p-4 bg-gray-50 rounded-2xl",children:[c.jsx(Y6e,{progress:m.progressPercent,size:80,strokeWidth:8,daysRemaining:m.daysRemaining}),c.jsxs("div",{children:[c.jsx("p",{className:"font-semibold text-gray-900",children:m.canChange?c.jsxs("span",{className:"text-green-600 flex items-center gap-2",children:[c.jsx(_r,{size:18}),"nderung mglich"]}):c.jsxs("span",{className:"text-amber-600 flex items-center gap-2",children:[c.jsx(Ua,{size:18}),q6e(m.daysRemaining)]})}),m.lastChanged&&c.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Letzte nderung: ",tae(m.lastChanged)]}),m.nextChangeDate&&!m.canChange&&c.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Verfgbar ab: ",tae(m.nextChangeDate)]})]})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Neuer Username"}),c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400",children:c.jsx(vW,{size:20})}),c.jsx("input",{type:"text",value:u,onChange:Q=>te(Q.target.value),disabled:!(m!=null&&m.canChange),className:`w-full pl-12 pr-12 py-3 rounded-xl border-2 transition-all ${m!=null&&m.canChange?O?"border-red-300 focus:border-red-500":F?"border-green-300 focus:border-green-500":"border-gray-200 focus:border-purple-500":"bg-gray-100 border-gray-200 text-gray-400"} outline-none`,placeholder:"dein_username",maxLength:20}),c.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2",children:W?c.jsx(fi,{size:20,className:"text-gray-400 animate-spin"}):F===!0?c.jsx(_r,{size:20,className:"text-green-500"}):F===!1?c.jsx(Di,{size:20,className:"text-red-500"}):null})]}),O&&c.jsxs("p",{className:"text-red-500 text-sm mt-2 flex items-center gap-1 animate-in fade-in slide-in-from-top-2",children:[c.jsx(rh,{size:14}),O]}),F&&u!==(a==null?void 0:a.username)&&c.jsxs("p",{className:"text-green-600 text-sm mt-2 flex items-center gap-1 animate-in fade-in slide-in-from-top-2",children:[c.jsx(_r,{size:14}),"@",u," ist verfgbar"]})]}),c.jsx("div",{className:"p-4 bg-purple-50 rounded-xl mb-6",children:c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx(bpe,{size:18,className:"text-purple-600 flex-shrink-0 mt-0.5"}),c.jsxs("div",{className:"text-sm text-purple-800",children:[c.jsx("p",{className:"font-medium mb-1",children:"Regeln fr Usernames:"}),c.jsxs("ul",{className:"text-xs space-y-1 text-purple-700",children:[c.jsx("li",{children:" 3-20 Zeichen"}),c.jsx("li",{children:" Nur Kleinbuchstaben, Zahlen & Unterstriche"}),c.jsxs("li",{children:[" nderung nur alle ",EC," Tage mglich"]})]})]})]})}),c.jsxs("div",{className:"flex gap-3",children:[c.jsx("button",{onClick:e,className:"flex-1 py-3 px-4 bg-gray-100 text-gray-600 rounded-xl font-semibold hover:bg-gray-200 transition-colors",children:"Abbrechen"}),c.jsx("button",{onClick:he,disabled:!J||C,className:"flex-1 py-3 px-4 bg-gradient-to-r from-violet-500 to-purple-600 text-white rounded-xl font-semibold disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 transition-all hover:shadow-lg hover:shadow-purple-500/30",children:C?c.jsx(fi,{size:18,className:"animate-spin"}):c.jsxs(c.Fragment,{children:[c.jsx(_r,{size:18}),"Speichern"]})})]})]})})]})})},$6e=()=>{const{user:t}=Jr(),[e,r]=V.useState(null),[a,l]=V.useState({totalLinks:5,usedLinks:0,availableLinks:5,totalReferrals:0,xpEarned:0,premiumDaysEarned:0}),[u,p]=V.useState(null),[m,v]=V.useState(!0),[w,R]=V.useState(!1);V.useEffect(()=>{C()},[t==null?void 0:t.id]);const C=async()=>{if(t!=null&&t.id){v(!0);try{let W=await dpe(t.id);W||(W=await VL(t.id)),r(W);const H=await fI(t.id);l(H)}catch(W){console.error("Error loading referral data:",W)}finally{v(!1)}}},A=async W=>{await fpe(W)&&(p(W),setTimeout(()=>p(null),2e3))},O=async W=>{await ZMe(W,(t==null?void 0:t.username)||"Ein Freund")};if(m)return c.jsxs("div",{className:"bg-gradient-to-br from-purple-500/10 to-pink-500/10 rounded-2xl p-6 animate-pulse",children:[c.jsx("div",{className:"h-6 bg-white/10 rounded w-1/3 mb-4"}),c.jsx("div",{className:"h-20 bg-white/10 rounded"})]});const U=(e==null?void 0:e.links.filter(W=>W.isActive&&!W.usedBy))||[],F=(e==null?void 0:e.links.filter(W=>W.usedBy!==null))||[],q=w?U:U.slice(0,2);return c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"bg-gradient-to-br from-purple-600 via-violet-600 to-pink-600 rounded-2xl p-6 text-white relative overflow-hidden",children:[c.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full blur-3xl"}),c.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-pink-500/20 rounded-full blur-2xl"}),c.jsxs("div",{className:"relative z-10",children:[c.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[c.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:c.jsx(_o,{size:24})}),c.jsxs("div",{children:[c.jsx("h2",{className:"text-xl font-bold",children:"Referral System"}),c.jsx("p",{className:"text-white/80 text-sm",children:"Lade Freunde ein & erhalte Belohnungen"})]})]}),c.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-4",children:[c.jsxs("div",{className:"bg-white/10 backdrop-blur-xl rounded-xl p-3 text-center",children:[c.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[c.jsx(cr,{size:16}),c.jsx("span",{className:"text-2xl font-bold",children:a.totalReferrals})]}),c.jsx("p",{className:"text-xs text-white/70",children:"Eingeladen"})]}),c.jsxs("div",{className:"bg-white/10 backdrop-blur-xl rounded-xl p-3 text-center",children:[c.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[c.jsx(Vs,{size:16,className:"text-yellow-300"}),c.jsx("span",{className:"text-2xl font-bold",children:a.xpEarned})]}),c.jsx("p",{className:"text-xs text-white/70",children:"XP verdient"})]}),c.jsxs("div",{className:"bg-white/10 backdrop-blur-xl rounded-xl p-3 text-center",children:[c.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[c.jsx(Eie,{size:16}),c.jsx("span",{className:"text-2xl font-bold",children:a.availableLinks})]}),c.jsx("p",{className:"text-xs text-white/70",children:"Verfgbar"})]})]})]})]}),c.jsx("div",{className:"bg-gradient-to-r from-amber-500/10 to-orange-500/10 border border-amber-500/20 rounded-xl p-4",children:c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx("div",{className:"w-10 h-10 bg-amber-500/20 rounded-full flex items-center justify-center flex-shrink-0",children:c.jsx(kn,{size:20,className:"text-amber-500"})}),c.jsxs("div",{children:[c.jsx("h3",{className:"font-semibold text-amber-200 mb-1",children:"Belohnungen pro Einladung"}),c.jsxs("div",{className:"space-y-1 text-sm text-amber-100/80",children:[c.jsxs("p",{className:"flex items-center gap-2",children:[c.jsx(Vs,{size:14,className:"text-amber-400"}),c.jsx("span",{children:"+500 XP fr dich"})]}),c.jsxs("p",{className:"flex items-center gap-2",children:[c.jsx(as,{size:14,className:"text-amber-400"}),c.jsx("span",{children:"+7 Tage Premium"})]}),c.jsxs("p",{className:"flex items-center gap-2",children:[c.jsx(_o,{size:14,className:"text-amber-400"}),c.jsx("span",{children:"+250 XP fr deinen Freund"})]})]})]})]})}),c.jsxs("div",{className:"bg-white/5 rounded-2xl p-4",children:[c.jsxs("h3",{className:"font-semibold text-white mb-3 flex items-center gap-2",children:[c.jsx(Eie,{size:18,className:"text-purple-400"}),"Deine exklusiven Links (",a.availableLinks,"/",a.totalLinks,")"]}),c.jsxs("div",{className:"space-y-2",children:[q.length===0?c.jsxs("div",{className:"text-center py-6 text-white/50",children:[c.jsx(_o,{size:32,className:"mx-auto mb-2 opacity-50"}),c.jsx("p",{children:"Alle Links wurden verwendet!"}),c.jsx("p",{className:"text-sm",children:"Danke frs Teilen "})]}):q.map((W,H)=>c.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-3 flex items-center justify-between gap-3",children:[c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsxs("p",{className:"text-sm text-white/60 mb-0.5",children:["Link #",H+1]}),c.jsx("p",{className:"font-mono text-white font-medium truncate",children:W.code})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("button",{onClick:()=>A(W.code),className:`p-2.5 rounded-xl transition-all ${u===W.code?"bg-green-500 text-white":"bg-white/10 text-white/70 hover:bg-white/20 hover:text-white"}`,children:u===W.code?c.jsx(_r,{size:18}):c.jsx(bW,{size:18})}),c.jsx("button",{onClick:()=>O(W.code),className:"p-2.5 bg-purple-500 text-white rounded-xl hover:bg-purple-600 transition-colors",children:c.jsx(GL,{size:18})})]})]},W.id)),U.length>2&&!w&&c.jsxs("button",{onClick:()=>R(!0),className:"w-full py-3 text-center text-purple-400 hover:text-purple-300 text-sm flex items-center justify-center gap-1",children:["Alle ",U.length," Links anzeigen",c.jsx(Fi,{size:16})]})]})]}),F.length>0&&c.jsxs("div",{className:"bg-white/5 rounded-2xl p-4",children:[c.jsxs("h3",{className:"font-semibold text-white/60 mb-3 flex items-center gap-2",children:[c.jsx(_r,{size:18,className:"text-green-400"}),"Verwendete Links (",F.length,")"]}),c.jsx("div",{className:"space-y-2",children:F.map((W,H)=>c.jsxs("div",{className:"bg-green-500/10 border border-green-500/20 rounded-xl p-3 flex items-center gap-3",children:[c.jsx("div",{className:"w-8 h-8 bg-green-500/20 rounded-full flex items-center justify-center",children:c.jsx(_r,{size:16,className:"text-green-400"})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("p",{className:"font-mono text-white/60 text-sm line-through",children:W.code}),c.jsxs("p",{className:"text-xs text-green-400",children:["Verwendet ",W.usedAt?new Date(W.usedAt).toLocaleDateString("de-DE"):""]})]})]},W.id))})]}),(e==null?void 0:e.referredBy)&&c.jsx("div",{className:"bg-gradient-to-r from-green-500/10 to-emerald-500/10 border border-green-500/20 rounded-xl p-4",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-10 h-10 bg-green-500/20 rounded-full flex items-center justify-center",children:c.jsx(cr,{size:20,className:"text-green-400"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm text-green-400",children:"Du wurdest eingeladen mit:"}),c.jsx("p",{className:"font-mono text-white font-medium",children:e.referredByCode})]})]})})]})},Ho={seasonId:"beta_s1",seasonName:"Beta Season 1",seasonNameDE:"Beta Staffel 1",maxLevel:100,xpPerLevel:1e3,seasonStart:new Date("2026-03-01T00:00:00Z"),seasonEnd:new Date("2026-05-31T23:59:59Z"),premiumUnlockInvites:5,colors:{free:{primary:"#A78BFA",secondary:"#818CF8"},premium:{primary:"#F472B6",secondary:"#FB923C",gradient:"linear-gradient(135deg, #A78BFA 0%, #818CF8 50%, #F472B6 100%)"}}},Tm=[{id:"bs1_r01",level:1,type:"coins",name:"Starter Coins",nameDE:"Starter Coins",description:"50 synclulu Coins to start your journey",descriptionDE:"50 synclulu Coins fr deinen Start",rarity:"common",isPremium:!1,value:50},{id:"bs1_r02",level:1,type:"avatar_frame",name:"Beta Dreamer Frame",nameDE:"Beta Trumer Rahmen",description:"Exclusive frame for Beta participants",descriptionDE:"Exklusiver Rahmen fr Beta-Teilnehmer",rarity:"rare",isPremium:!0,previewUrl:"/assets/frames/beta-dreamer.png"},{id:"bs1_r03",level:5,type:"xp_boost",name:"XP Boost x1.5",nameDE:"XP Boost x1.5",description:"24h of 1.5x XP",descriptionDE:"24h lang 1.5x XP",rarity:"common",isPremium:!1,value:1.5},{id:"bs1_r04",level:5,type:"chat_bubble",name:"Cloud Bubble",nameDE:"Wolken-Bubble",description:"Dreamy cloud-shaped chat bubbles",descriptionDE:"Vertrumte Wolken-Chat-Bubbles",rarity:"rare",isPremium:!0,previewUrl:"/assets/bubbles/cloud.png"},{id:"bs1_r05",level:10,type:"coins",name:"Coin Bundle",nameDE:"Coin Bundle",description:"100 synclulu Coins",descriptionDE:"100 synclulu Coins",rarity:"common",isPremium:!1,value:100},{id:"bs1_r06",level:10,type:"glow_effect",name:"Soft Lavender Glow",nameDE:"Sanftes Lavendel-Leuchten",description:"Gentle purple aura around your avatar",descriptionDE:"Sanfte lila Aura um deinen Avatar",rarity:"epic",isPremium:!0,previewUrl:"/assets/effects/lavender-glow.png"},{id:"bs1_r07",level:15,type:"emoji_pack",name:"Dreamy Emojis",nameDE:"Vertrumte Emojis",description:"12 exclusive dreamy emojis",descriptionDE:"12 exklusive vertrumte Emojis",rarity:"rare",isPremium:!1},{id:"bs1_r08",level:15,type:"profile_banner",name:"Aurora Banner",nameDE:"Aurora Banner",description:"Beautiful aurora borealis header",descriptionDE:"Wunderschner Nordlicht-Header",rarity:"epic",isPremium:!0,previewUrl:"/assets/banners/aurora.png"},{id:"bs1_r09",level:20,type:"title",name:"Cloud Walker",nameDE:"Wolkenwanderer",description:"Display title below your name",descriptionDE:"Titel unter deinem Namen",rarity:"rare",isPremium:!1},{id:"bs1_r10",level:20,type:"name_effect",name:"Shimmer Name",nameDE:"Schimmer-Name",description:"Your name sparkles with light",descriptionDE:"Dein Name funkelt im Licht",rarity:"epic",isPremium:!0},{id:"bs1_r11",level:25,type:"coins",name:"Big Coin Bag",nameDE:"Groer Coin-Beutel",description:"250 synclulu Coins",descriptionDE:"250 synclulu Coins",rarity:"rare",isPremium:!1,value:250},{id:"bs1_r12",level:25,type:"cloud_theme",name:"Sunset Dreams",nameDE:"Sonnenuntergang-Trume",description:"Golden hour cloud theme",descriptionDE:"Goldene Stunde Cloud-Theme",rarity:"epic",isPremium:!0,previewUrl:"/assets/themes/sunset-dreams.png"},{id:"bs1_r13",level:30,type:"sound_pack",name:"Chill Vibes",nameDE:"Chill Vibes",description:"Relaxing notification sounds",descriptionDE:"Entspannende Benachrichtigungstne",rarity:"rare",isPremium:!1},{id:"bs1_r14",level:30,type:"avatar_frame",name:"Holographic Frame",nameDE:"Holografischer Rahmen",description:"Color-shifting holographic border",descriptionDE:"Farbwechselnder holografischer Rahmen",rarity:"legendary",isPremium:!0,previewUrl:"/assets/frames/holographic.png"},{id:"bs1_r15",level:40,type:"exclusive_badge",name:"Early Dreamer",nameDE:"Frher Trumer",description:"Badge for Beta Season participants",descriptionDE:"Abzeichen fr Beta-Staffel-Teilnehmer",rarity:"epic",isPremium:!1},{id:"bs1_r16",level:40,type:"glow_effect",name:"Rainbow Aura",nameDE:"Regenbogen-Aura",description:"Multicolor shifting aura",descriptionDE:"Mehrfarbig wechselnde Aura",rarity:"legendary",isPremium:!0,previewUrl:"/assets/effects/rainbow-aura.png"},{id:"bs1_r17",level:50,type:"coins",name:"Treasure Chest",nameDE:"Schatzkiste",description:"500 synclulu Coins",descriptionDE:"500 synclulu Coins",rarity:"epic",isPremium:!1,value:500},{id:"bs1_r18",level:50,type:"profile_banner",name:"Galaxy Dreams",nameDE:"Galaxie-Trume",description:"Animated galaxy header",descriptionDE:"Animierter Galaxie-Header",rarity:"legendary",isPremium:!0,previewUrl:"/assets/banners/galaxy.png"},{id:"bs1_r19",level:60,type:"title",name:"Dream Master",nameDE:"Traum-Meister",description:"Prestigious title",descriptionDE:"Prestigetrchtiger Titel",rarity:"epic",isPremium:!1},{id:"bs1_r20",level:60,type:"chat_bubble",name:"Neon Bubble",nameDE:"Neon-Bubble",description:"Glowing neon chat bubbles",descriptionDE:"Leuchtende Neon-Chat-Bubbles",rarity:"legendary",isPremium:!0,previewUrl:"/assets/bubbles/neon.png"},{id:"bs1_r21",level:75,type:"xp_boost",name:"XP Boost x2",nameDE:"XP Boost x2",description:"48h of 2x XP",descriptionDE:"48h lang 2x XP",rarity:"epic",isPremium:!1,value:2},{id:"bs1_r22",level:75,type:"name_effect",name:"Holographic Name",nameDE:"Holografischer Name",description:"Your name shimmers in holographic colors",descriptionDE:"Dein Name schimmert holografisch",rarity:"legendary",isPremium:!0},{id:"bs1_r23",level:85,type:"coins",name:"Elite Vault",nameDE:"Elite-Tresor",description:"1000 synclulu Coins",descriptionDE:"1000 synclulu Coins",rarity:"legendary",isPremium:!1,value:1e3},{id:"bs1_r24",level:85,type:"cloud_theme",name:"Cosmic Dreams",nameDE:"Kosmische Trume",description:"Animated cosmic cloud theme",descriptionDE:"Animiertes kosmisches Cloud-Theme",rarity:"legendary",isPremium:!0,previewUrl:"/assets/themes/cosmic.png"},{id:"bs1_r25",level:100,type:"exclusive_badge",name:"Beta Legend",nameDE:"Beta-Legende",description:"Ultimate badge for completing Beta Season",descriptionDE:"Ultimatives Abzeichen fr Beta-Staffel-Abschluss",rarity:"mythic",isPremium:!1},{id:"bs1_r26",level:100,type:"avatar_frame",name:"Mythic Dreamer Frame",nameDE:"Mythischer Trumer-Rahmen",description:"Animated legendary frame with particles",descriptionDE:"Animierter legendrer Rahmen mit Partikeln",rarity:"mythic",isPremium:!0,previewUrl:"/assets/frames/mythic-dreamer.png"}],Ky={dailyQuest:{easy:50,medium:100,hard:200,bonus:300},cloudStreak:{base:25,milestone7:100,milestone14:250,milestone30:500,milestone100:2e3},social:{invite:150,inviteActive:300,cloudInteraction:10,friendMade:50}},Vm=async t=>{var e,r,a;try{const l=tt(De,"dreamPassProgress",`${t}_${Ho.seasonId}`),u=await Bn(l);if(!u.exists())return null;const p=u.data();return{id:u.id,oderId:p.userId,...p,lastXPGain:((e=p.lastXPGain)==null?void 0:e.toDate())||new Date,createdAt:((r=p.createdAt)==null?void 0:r.toDate())||new Date,updatedAt:((a=p.updatedAt)==null?void 0:a.toDate())||new Date}}catch(l){return console.error("Error getting Dream Pass progress:",l),null}},o9=async t=>{const e={id:`${t}_${Ho.seasonId}`,oderId:t,seasonId:Ho.seasonId,currentLevel:1,currentXP:0,totalXPEarned:0,isPremium:!1,premiumUnlockedVia:null,unlockedRewards:[],claimedRewards:[],lastXPGain:new Date,streakBonus:0,createdAt:new Date,updatedAt:new Date},r=tt(De,"dreamPassProgress",e.id);return await Yi(r,{...e,lastXPGain:fn.fromDate(e.lastXPGain),createdAt:fn.fromDate(e.createdAt),updatedAt:fn.fromDate(e.updatedAt)}),e},X6e=async(t,e)=>{try{let r=await Vm(t);r||(r=await o9(t)),new Date<Ho.seasonStart&&console.log("Pre-season XP accumulation");const l=Math.floor(e.amount*(e.multiplier||1)),u=r.totalXPEarned+l;let p=r.currentXP+l,m=r.currentLevel;const v=[];for(;p>=Ho.xpPerLevel&&m<Ho.maxLevel;){p-=Ho.xpPerLevel,m++;const C=Tm.filter(A=>A.level===m&&(!A.isPremium||r.isPremium));v.push(...C)}m>=Ho.maxLevel&&(p=Math.min(p,Ho.xpPerLevel));const w=tt(De,"dreamPassProgress",r.id),R=v.map(C=>C.id);return await Xn(w,{currentLevel:m,currentXP:p,totalXPEarned:u,unlockedRewards:[...r.unlockedRewards,...R],lastXPGain:fn.fromDate(new Date),updatedAt:fn.fromDate(new Date)}),{success:!0,leveledUp:m>r.currentLevel,newLevel:m>r.currentLevel?m:void 0,newRewards:v.length>0?v:void 0,totalXP:u}}catch(r){return console.error("Error adding Dream Pass XP:",r),{success:!1,leveledUp:!1}}},Xme=async t=>{try{const e=await Vm(t);if(!e||e.isPremium)return(e==null?void 0:e.isPremium)||!1;if((await fI(t)).totalReferrals>=Ho.premiumUnlockInvites){const a=tt(De,"dreamPassProgress",e.id);await Xn(a,{isPremium:!0,premiumUnlockedVia:"referral",updatedAt:fn.fromDate(new Date)});const l=Tm.filter(u=>u.isPremium&&u.level<=e.currentLevel);return l.length>0&&await Xn(a,{unlockedRewards:[...e.unlockedRewards,...l.map(u=>u.id)]}),!0}return!1}catch(e){return console.error("Error checking premium unlock:",e),!1}},J6e=async(t,e)=>{try{const r=await Vm(t);if(!r)return{success:!1,error:"Pass nicht gefunden"};if(!r.unlockedRewards.includes(e))return{success:!1,error:"Belohnung nicht freigeschaltet"};if(r.claimedRewards.includes(e))return{success:!1,error:"Belohnung bereits abgeholt"};const a=Tm.find(u=>u.id===e);if(!a)return{success:!1,error:"Belohnung nicht gefunden"};if(a.type==="coins"&&a.value){const{addCoins:u}=await VN(async()=>{const{addCoins:p}=await Promise.resolve().then(()=>$ze);return{addCoins:p}},void 0);await u(t,a.value,`Dream Pass Belohnung: ${a.nameDE}`,"earn")}const l=tt(De,"dreamPassProgress",r.id);return await Xn(l,{claimedRewards:[...r.claimedRewards,e],updatedAt:fn.fromDate(new Date)}),{success:!0}}catch(r){return console.error("Error claiming reward:",r),{success:!1,error:"Fehler beim Abholen"}}},Q6e=(t,e)=>{const r=tt(De,"dreamPassProgress",`${t}_${Ho.seasonId}`);return na(r,a=>{var u,p,m;if(!a.exists()){e(null);return}const l=a.data();e({id:a.id,oderId:l.userId,...l,lastXPGain:((u=l.lastXPGain)==null?void 0:u.toDate())||new Date,createdAt:((p=l.createdAt)==null?void 0:p.toDate())||new Date,updatedAt:((m=l.updatedAt)==null?void 0:m.toDate())||new Date})})},DO=()=>{const t=new Date,e=Ho.seasonStart;if(t>=e)return{days:0,hours:0,minutes:0,seconds:0,hasStarted:!0};const r=e.getTime()-t.getTime();return{days:Math.floor(r/(1e3*60*60*24)),hours:Math.floor(r%(1e3*60*60*24)/(1e3*60*60)),minutes:Math.floor(r%(1e3*60*60)/(1e3*60)),seconds:Math.floor(r%(1e3*60)/1e3),hasStarted:!1}},rd=t=>({common:"#9CA3AF",rare:"#60A5FA",epic:"#A78BFA",legendary:"#FBBF24",mythic:"#F472B6"})[t],zz=t=>({common:"none",rare:"0 0 10px #60A5FA50",epic:"0 0 15px #A78BFA60",legendary:"0 0 20px #FBBF2470",mythic:"0 0 25px #F472B680, 0 0 50px #F472B640"})[t],Z6e=({isOpen:t,onClose:e})=>{const{user:r}=Jr(),a=V.useRef(null),[l,u]=V.useState(null),[p,m]=V.useState(!0),[v,w]=V.useState("rewards"),[R,C]=V.useState(DO()),[A,O]=V.useState(0),[U,F]=V.useState(null),[q,W]=V.useState(null);V.useEffect(()=>{if(!t||!(r!=null&&r.id))return;(async()=>{m(!0);let Q=await Vm(r.id);Q||(Q=await o9(r.id)),await Xme(r.id),Q=await Vm(r.id),u(Q);const ce=await fI(r.id);O(ce.totalReferrals),m(!1)})()},[t,r==null?void 0:r.id]),V.useEffect(()=>{if(!t)return;const J=setInterval(()=>{C(DO())},1e3);return()=>clearInterval(J)},[t]);const H=async J=>{if(!(r!=null&&r.id)||U)return;if(F(J),(await J6e(r.id,J)).success){const ce=await Vm(r.id);u(ce)}F(null)},X=()=>{if(!a.current||!l)return;const J=l.currentLevel-1;a.current.scrollTo({left:Math.max(0,J*280-100),behavior:"smooth"})};if(V.useEffect(()=>{l&&a.current&&setTimeout(X,100)},[l]),!t)return null;const ne=[...new Set(Tm.map(J=>J.level))].sort((J,Q)=>J-Q),te=l?l.currentXP/Ho.xpPerLevel*100:0,he=Ho.premiumUnlockInvites-A;return c.jsxs("div",{className:"fixed inset-0 z-50 bg-black",children:[c.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[c.jsx("div",{className:"absolute inset-0 opacity-30",style:{background:"radial-gradient(ellipse at 50% 0%, #A78BFA40 0%, transparent 50%), radial-gradient(ellipse at 80% 80%, #818CF840 0%, transparent 40%)"}}),[...Array(20)].map((J,Q)=>c.jsx("div",{className:"absolute w-1 h-1 bg-purple-400/30 rounded-full",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`,animation:`float ${3+Math.random()*4}s ease-in-out infinite`,animationDelay:`${Math.random()*2}s`}},Q))]}),c.jsxs("div",{className:"relative z-10 safe-top",children:[c.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[c.jsx("button",{onClick:e,className:"w-10 h-10 bg-white/10 rounded-xl flex items-center justify-center",children:c.jsx(Di,{size:20,className:"text-white"})}),c.jsxs("div",{className:"text-center",children:[c.jsxs("h1",{className:"text-xl font-bold text-white flex items-center gap-2",children:[c.jsx(as,{size:20,className:"text-purple-400"}),"Dream Pass"]}),c.jsx("p",{className:"text-xs text-white/60",children:"Beta Season 1"})]}),c.jsx("div",{className:"w-10"})," "]}),!R.hasStarted&&c.jsx("div",{className:"mx-4 mb-4 p-4 bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-2xl border border-purple-500/30",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(Ua,{size:20,className:"text-purple-400"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("p",{className:"text-sm text-white/80",children:"Season startet in"}),c.jsx("div",{className:"flex gap-3 mt-1",children:[{value:R.days,label:"Tage"},{value:R.hours,label:"Std"},{value:R.minutes,label:"Min"},{value:R.seconds,label:"Sek"}].map(({value:J,label:Q})=>c.jsxs("div",{className:"text-center",children:[c.jsx("span",{className:"text-lg font-bold text-white",children:J}),c.jsx("span",{className:"text-xs text-white/60 ml-1",children:Q})]},Q))})]})]})}),!p&&l&&c.jsxs("div",{className:"mx-4 mb-4 p-4 bg-white/5 rounded-2xl",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center",children:c.jsx("span",{className:"text-lg font-bold text-white",children:l.currentLevel})}),c.jsxs("div",{children:[c.jsxs("p",{className:"text-white font-semibold",children:["Level ",l.currentLevel]}),c.jsxs("p",{className:"text-xs text-white/60",children:[l.currentXP.toLocaleString()," / ",Ho.xpPerLevel.toLocaleString()," XP"]})]})]}),l.isPremium?c.jsxs("div",{className:"px-3 py-1.5 bg-gradient-to-r from-amber-500 to-orange-500 rounded-full flex items-center gap-2",children:[c.jsx(as,{size:14,className:"text-white"}),c.jsx("span",{className:"text-sm font-bold text-white",children:"PREMIUM"})]}):c.jsxs("button",{onClick:()=>w("rewards"),className:"px-3 py-1.5 bg-white/10 rounded-full flex items-center gap-2 hover:bg-white/20 transition-colors",children:[c.jsx(yo,{size:14,className:"text-white/60"}),c.jsx("span",{className:"text-sm text-white/80",children:"Premium"})]})]}),c.jsx("div",{className:"h-3 bg-white/10 rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full transition-all duration-500",style:{width:`${te}%`}})})]}),!p&&l&&!l.isPremium&&c.jsx("div",{className:"mx-4 mb-4 p-4 bg-gradient-to-r from-amber-500/20 to-orange-500/20 rounded-2xl border border-amber-500/30",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-amber-500 to-orange-500 rounded-xl flex items-center justify-center",children:c.jsx(cr,{size:24,className:"text-white"})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("p",{className:"text-white font-semibold",children:"Premium freischalten"}),c.jsx("p",{className:"text-sm text-white/70",children:he>0?`Lade ${he} Freund${he>1?"e":""} ein!`:"Du hast es geschafft!"}),c.jsx("div",{className:"flex gap-1 mt-2",children:[...Array(Ho.premiumUnlockInvites)].map((J,Q)=>c.jsx("div",{className:`w-8 h-2 rounded-full ${Q<A?"bg-gradient-to-r from-amber-500 to-orange-500":"bg-white/20"}`},Q))})]})]})}),c.jsxs("div",{className:"flex mx-4 mb-4 bg-white/5 rounded-xl p-1",children:[c.jsxs("button",{onClick:()=>w("rewards"),className:`flex-1 py-2 rounded-lg text-sm font-medium transition-all ${v==="rewards"?"bg-purple-500 text-white":"text-white/60"}`,children:[c.jsx(_o,{size:16,className:"inline mr-2"}),"Belohnungen"]}),c.jsxs("button",{onClick:()=>w("sneak-peek"),className:`flex-1 py-2 rounded-lg text-sm font-medium transition-all ${v==="sneak-peek"?"bg-purple-500 text-white":"text-white/60"}`,children:[c.jsx(Pl,{size:16,className:"inline mr-2"}),"Sneak Peek"]})]})]}),c.jsx("div",{className:"flex-1 overflow-hidden",children:p?c.jsx("div",{className:"flex items-center justify-center h-64",children:c.jsx("div",{className:"w-10 h-10 border-3 border-purple-500/30 border-t-purple-500 rounded-full animate-spin"})}):v==="rewards"?c.jsx("div",{ref:a,className:"overflow-x-auto overflow-y-hidden pb-32 hide-scrollbar",style:{scrollSnapType:"x mandatory"},children:c.jsx("div",{className:"flex gap-4 px-4 min-w-max",children:ne.map(J=>{const Q=Tm.filter(ye=>ye.level===J),ce=Q.find(ye=>!ye.isPremium),de=Q.find(ye=>ye.isPremium),pe=l&&l.currentLevel>=J,be=l&&l.currentLevel===J;return c.jsxs("div",{className:"flex flex-col items-center gap-4",style:{scrollSnapAlign:"center"},children:[c.jsx(nae,{reward:de,isUnlocked:pe&&(l==null?void 0:l.isPremium),isClaimed:l==null?void 0:l.claimedRewards.includes((de==null?void 0:de.id)||""),isPremiumLocked:!(l!=null&&l.isPremium),onClaim:()=>de&&H(de.id),onPreview:()=>de&&W(de),isClaiming:U===(de==null?void 0:de.id)}),c.jsxs("div",{className:`relative w-16 h-16 rounded-full flex items-center justify-center ${be?"bg-gradient-to-br from-purple-500 to-pink-500 ring-4 ring-purple-500/50":pe?"bg-gradient-to-br from-green-500 to-emerald-500":"bg-white/10"}`,children:[pe&&!be?c.jsx(_r,{size:24,className:"text-white"}):c.jsx("span",{className:`text-xl font-bold ${pe?"text-white":"text-white/50"}`,children:J}),J<Ho.maxLevel&&c.jsx("div",{className:`absolute left-full top-1/2 w-4 h-1 ${pe?"bg-green-500":"bg-white/20"}`,style:{transform:"translateY(-50%)"}})]}),c.jsx(nae,{reward:ce,isUnlocked:pe,isClaimed:l==null?void 0:l.claimedRewards.includes((ce==null?void 0:ce.id)||""),isPremiumLocked:!1,onClaim:()=>ce&&H(ce.id),onPreview:()=>ce&&W(ce),isClaiming:U===(ce==null?void 0:ce.id)})]},J)})})}):c.jsxs("div",{className:"px-4 pb-32 overflow-y-auto",children:[c.jsxs("div",{className:"bg-white/5 rounded-2xl p-6 mb-4",children:[c.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[c.jsx(kn,{size:24,className:"text-purple-400"}),c.jsx("h2",{className:"text-xl font-bold text-white",children:"Coming Soon"})]}),c.jsx("p",{className:"text-white/70 mb-6",children:"Diese exklusiven Belohnungen warten auf dich in der Beta Season 1!"}),c.jsx("div",{className:"grid grid-cols-2 gap-4",children:Tm.filter(J=>J.rarity==="legendary"||J.rarity==="mythic").slice(0,6).map(J=>c.jsxs("div",{className:"relative bg-white/5 rounded-xl p-4 border border-white/10 overflow-hidden",onClick:()=>W(J),children:[c.jsx("div",{className:"absolute inset-0 opacity-20",style:{background:`radial-gradient(circle at 50% 50%, ${rd(J.rarity)} 0%, transparent 70%)`}}),c.jsxs("div",{className:"relative",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("span",{className:"text-xs font-bold uppercase px-2 py-0.5 rounded-full",style:{backgroundColor:`${rd(J.rarity)}30`,color:rd(J.rarity)},children:J.rarity}),c.jsxs("span",{className:"text-xs text-white/50",children:["Lv.",J.level]})]}),c.jsx("div",{className:"w-12 h-12 rounded-xl mb-3 flex items-center justify-center",style:{background:`linear-gradient(135deg, ${rd(J.rarity)}40 0%, ${rd(J.rarity)}20 100%)`},children:J.isPremium?c.jsx(as,{size:24,style:{color:rd(J.rarity)}}):c.jsx(_o,{size:24,style:{color:rd(J.rarity)}})}),c.jsx("h3",{className:"text-sm font-semibold text-white truncate",children:J.nameDE}),c.jsx("p",{className:"text-xs text-white/50 truncate",children:J.descriptionDE}),J.isPremium&&c.jsxs("div",{className:"mt-2 flex items-center gap-1 text-xs text-amber-400",children:[c.jsx(as,{size:12}),c.jsx("span",{children:"Premium"})]})]})]},J.id))})]}),c.jsxs("div",{className:"bg-white/5 rounded-2xl p-6",children:[c.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[c.jsx(fz,{size:20,className:"text-amber-400"}),"Season Statistik"]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{className:"bg-white/5 rounded-xl p-4 text-center",children:[c.jsx("p",{className:"text-3xl font-bold text-white",children:Tm.length}),c.jsx("p",{className:"text-sm text-white/60",children:"Belohnungen"})]}),c.jsxs("div",{className:"bg-white/5 rounded-xl p-4 text-center",children:[c.jsx("p",{className:"text-3xl font-bold text-white",children:Ho.maxLevel}),c.jsx("p",{className:"text-sm text-white/60",children:"Level"})]}),c.jsxs("div",{className:"bg-white/5 rounded-xl p-4 text-center",children:[c.jsx("p",{className:"text-3xl font-bold text-white",children:Tm.filter(J=>J.isPremium).length}),c.jsx("p",{className:"text-sm text-white/60",children:"Premium Items"})]}),c.jsxs("div",{className:"bg-white/5 rounded-xl p-4 text-center",children:[c.jsx("p",{className:"text-3xl font-bold text-white",children:Tm.filter(J=>J.rarity==="mythic").length}),c.jsx("p",{className:"text-sm text-white/60",children:"Mythisch"})]})]})]})]})}),q&&c.jsx("div",{className:"fixed inset-0 z-60 bg-black/80 flex items-center justify-center p-6",onClick:()=>W(null),children:c.jsx("div",{className:"bg-gray-900 rounded-3xl p-6 w-full max-w-sm",onClick:J=>J.stopPropagation(),style:{boxShadow:zz(q.rarity)},children:c.jsxs("div",{className:"text-center",children:[c.jsx("span",{className:"text-sm font-bold uppercase px-3 py-1 rounded-full",style:{backgroundColor:`${rd(q.rarity)}30`,color:rd(q.rarity)},children:q.rarity}),c.jsx("div",{className:"w-24 h-24 rounded-2xl mx-auto mt-4 mb-4 flex items-center justify-center",style:{background:`linear-gradient(135deg, ${rd(q.rarity)}40 0%, ${rd(q.rarity)}20 100%)`,boxShadow:zz(q.rarity)},children:q.isPremium?c.jsx(as,{size:48,style:{color:rd(q.rarity)}}):c.jsx(_o,{size:48,style:{color:rd(q.rarity)}})}),c.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:q.nameDE}),c.jsx("p",{className:"text-white/70 mb-4",children:q.descriptionDE}),c.jsxs("div",{className:"flex items-center justify-center gap-4 mb-6",children:[c.jsxs("div",{className:"text-center",children:[c.jsx("p",{className:"text-2xl font-bold text-purple-400",children:q.level}),c.jsx("p",{className:"text-xs text-white/50",children:"Level"})]}),c.jsx("div",{className:"w-px h-8 bg-white/20"}),c.jsxs("div",{className:"text-center",children:[c.jsx("p",{className:"text-sm font-medium text-white/80 capitalize",children:q.type.replace("_"," ")}),c.jsx("p",{className:"text-xs text-white/50",children:"Typ"})]}),q.isPremium&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"w-px h-8 bg-white/20"}),c.jsxs("div",{className:"text-center",children:[c.jsx(as,{size:20,className:"text-amber-400 mx-auto"}),c.jsx("p",{className:"text-xs text-white/50",children:"Premium"})]})]})]}),c.jsx("button",{onClick:()=>W(null),className:"w-full py-3 bg-white/10 rounded-xl text-white font-medium hover:bg-white/20 transition-colors",children:"Schlieen"})]})})}),c.jsx("style",{children:`
        @keyframes float {
          0%, 100% { transform: translateY(0) rotate(0deg); }
          50% { transform: translateY(-20px) rotate(180deg); }
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      `})]})},nae=({reward:t,isUnlocked:e=!1,isClaimed:r=!1,isPremiumLocked:a=!1,onClaim:l,onPreview:u,isClaiming:p=!1})=>{if(!t)return c.jsx("div",{className:"w-32 h-40 bg-white/5 rounded-2xl flex items-center justify-center",children:c.jsx("span",{className:"text-white/20 text-sm",children:""})});const m=rd(t.rarity),v=e&&!r&&!a;return c.jsxs("div",{className:`relative w-32 rounded-2xl overflow-hidden transition-all duration-300 ${v?"ring-2 ring-green-500 ring-offset-2 ring-offset-black":""}`,style:{background:e?`linear-gradient(180deg, ${m}20 0%, transparent 100%)`:"rgba(255,255,255,0.05)",boxShadow:e?zz(t.rarity):"none"},onClick:u,children:[a&&c.jsx("div",{className:"absolute inset-0 bg-black/60 z-10 flex items-center justify-center",children:c.jsx(yo,{size:24,className:"text-amber-400"})}),c.jsxs("div",{className:"p-3",children:[t.isPremium&&c.jsx("div",{className:"absolute top-2 right-2 z-20",children:c.jsx(as,{size:14,className:"text-amber-400"})}),c.jsx("div",{className:"w-12 h-12 rounded-xl mx-auto mb-2 flex items-center justify-center",style:{background:`linear-gradient(135deg, ${m}40 0%, ${m}20 100%)`},children:t.type==="coins"?c.jsx("span",{className:"text-xl",children:""}):t.type==="xp_boost"?c.jsx(Vs,{size:24,style:{color:m}}):c.jsx(_o,{size:24,style:{color:m}})}),c.jsx("p",{className:"text-xs font-medium text-white text-center truncate mb-1",children:t.nameDE}),t.value&&c.jsx("p",{className:"text-xs text-center",style:{color:m},children:t.type==="coins"?`${t.value} `:`x${t.value}`}),c.jsx("p",{className:"text-[10px] text-center uppercase font-bold mt-1",style:{color:m},children:t.rarity})]}),v&&c.jsx("button",{onClick:w=>{w.stopPropagation(),l()},disabled:p,className:"w-full py-2 bg-green-500 text-white text-xs font-bold flex items-center justify-center gap-1",children:p?c.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):c.jsxs(c.Fragment,{children:[c.jsx(_o,{size:14}),"Abholen"]})}),r&&c.jsxs("div",{className:"w-full py-2 bg-white/10 text-white/50 text-xs text-center",children:[c.jsx(_r,{size:14,className:"inline mr-1"}),"Abgeholt"]})]})},Jme=({currentLevel:t=1,hasUnclaimedRewards:e=!1})=>{const[r,a]=V.useState(!1);return c.jsxs(c.Fragment,{children:[c.jsxs("button",{id:"dream-pass-btn",onClick:()=>a(!0),className:"relative group w-full overflow-hidden rounded-2xl p-[2px] transition-all duration-300 hover:scale-[1.02] active:scale-[0.98]",style:{background:"linear-gradient(135deg, #C4B5FD 0%, #A78BFA 25%, #818CF8 50%, #6366F1 75%, #A78BFA 100%)",backgroundSize:"200% 200%",animation:"gradient-shift 3s ease infinite, pulse-glow 2s ease-in-out infinite"},children:[c.jsxs("div",{className:"relative flex items-center justify-between gap-4 bg-gray-900/95 rounded-[14px] px-4 py-4 backdrop-blur-sm",children:[c.jsxs("div",{className:"relative",children:[c.jsxs("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center relative overflow-hidden",style:{background:"linear-gradient(135deg, #C4B5FD 0%, #818CF8 100%)"},children:[c.jsx(Xo,{size:40,className:"absolute text-white/30",style:{transform:"translateY(5px)"}}),c.jsx(as,{size:24,className:"text-white relative z-10"}),c.jsx(kn,{size:12,className:"absolute top-1 right-1 text-yellow-300 animate-pulse"})]}),c.jsxs("div",{className:"absolute -bottom-1 -right-1 bg-gradient-to-r from-amber-400 to-orange-500 text-white text-xs font-bold px-2 py-0.5 rounded-full shadow-lg",children:["Lv.",t]})]}),c.jsxs("div",{className:"flex-1 text-left",children:[c.jsxs("h3",{className:"font-bold text-white text-lg flex items-center gap-2",children:["Dream Pass",e&&c.jsxs("span",{className:"flex h-2.5 w-2.5",children:[c.jsx("span",{className:"animate-ping absolute inline-flex h-2.5 w-2.5 rounded-full bg-pink-400 opacity-75"}),c.jsx("span",{className:"relative inline-flex rounded-full h-2.5 w-2.5 bg-pink-500"})]})]}),c.jsx("p",{className:"text-sm text-white/60",children:"Beta Season 1  Exklusive Belohnungen"})]}),c.jsx("div",{className:"flex items-center gap-2",children:c.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center",style:{background:"linear-gradient(135deg, rgba(167, 139, 250, 0.2) 0%, rgba(129, 140, 248, 0.2) 100%)"},children:c.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",className:"text-purple-300",children:c.jsx("path",{d:"M9 18l6-6-6-6"})})})})]}),c.jsx("div",{className:"absolute inset-0 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none",style:{boxShadow:"0 0 30px rgba(167, 139, 250, 0.4), 0 0 60px rgba(129, 140, 248, 0.2)"}})]}),c.jsx(Z6e,{isOpen:r,onClose:()=>a(!1)}),c.jsx("style",{children:`
        @keyframes gradient-shift {
          0% { background-position: 0% 50%; }
          50% { background-position: 100% 50%; }
          100% { background-position: 0% 50%; }
        }

        @keyframes pulse-glow {
          0%, 100% { box-shadow: 0 0 20px rgba(167, 139, 250, 0.3); }
          50% { box-shadow: 0 0 35px rgba(167, 139, 250, 0.5), 0 0 50px rgba(129, 140, 248, 0.3); }
        }
      `})]})},Qme=()=>{const{user:t,showXPGain:e}=Jr(),[r,a]=V.useState(null),[l,u]=V.useState(!0),[p,m]=V.useState(DO());V.useEffect(()=>{if(!(t!=null&&t.id)){u(!1);return}(async()=>{u(!0);let F=await Vm(t.id);F||(F=await o9(t.id)),await Xme(t.id),F=await Vm(t.id),a(F),u(!1)})()},[t==null?void 0:t.id]),V.useEffect(()=>{if(!(t!=null&&t.id))return;const U=Q6e(t.id,F=>{a(F)});return()=>U()},[t==null?void 0:t.id]),V.useEffect(()=>{const U=setInterval(()=>{m(DO())},1e3);return()=>clearInterval(U)},[]);const v=r?r.unlockedRewards.filter(U=>!r.claimedRewards.includes(U)).length:0,w=V.useCallback(async U=>{if(!(t!=null&&t.id))return{success:!1,leveledUp:!1};const F=await X6e(t.id,U);return F.success&&F.leveledUp&&F.newLevel&&e(U.amount,`Dream Pass Level ${F.newLevel}! `),F},[t==null?void 0:t.id,e]),R=V.useCallback(async()=>{if(!(t!=null&&t.id))return;const U=await Vm(t.id);a(U)},[t==null?void 0:t.id]),C=V.useCallback(async U=>{const F=Ky.dailyQuest[U];await w({type:"daily_quest",amount:F,description:`Daily Quest (${U})`})},[w]),A=V.useCallback(async U=>{let F=Ky.cloudStreak.base*U;U>=100?F+=Ky.cloudStreak.milestone100:U>=30?F+=Ky.cloudStreak.milestone30:U>=14?F+=Ky.cloudStreak.milestone14:U>=7&&(F+=Ky.cloudStreak.milestone7),await w({type:"cloud_streak",amount:F,description:`${U} Tage Streak`})},[w]),O=V.useCallback(async U=>{const F=Ky.social[U];await w({type:"social",amount:F,description:U==="invite"?"Freund eingeladen":U==="inviteActive"?"Eingeladener Freund aktiv":U==="friendMade"?"Neue Freundschaft":"Cloud Interaktion"})},[w]);return{progress:r,isLoading:l,countdown:p,unclaimedRewards:v,addXP:w,refreshProgress:R,awardDailyQuestXP:C,awardStreakXP:A,awardSocialXP:O}};function eze(t){if(t<60)return`${t}m`;const e=Math.floor(t/60),r=t%60;return r===0?`${e}h`:`${e}h ${r}m`}function tze(t){const r=new Date().getTime()-t.getTime(),a=Math.floor(r/6e4),l=Math.floor(a/60),u=Math.floor(l/24);return a<60?`vor ${a}m`:l<24?`vor ${l}h`:u<7?`vor ${u}d`:t.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit"})}const Zme=V.memo(({userId:t,userStats:e})=>{const r=yr(),[a,l]=V.useState([]),[u,p]=V.useState(!0),[m,v]=V.useState(e);V.useEffect(()=>{if(!t)return;const O=tt(De,"users",t),U=na(O,F=>{if(F.exists()){const q=F.data();v({voice_minutes:q.totalVoiceMinutes||q.voice_minutes||0,rooms_visited:q.roomsVisited||q.rooms_visited||0,total_sessions:q.totalSessions||q.total_sessions||0})}});return()=>U()},[t]),V.useEffect(()=>{async function O(){if(!t){p(!1);return}try{const U=Mr(mn(De,"room_visits"),Kn("userId","==",t),ih("visitedAt","desc"),up(5)),q=(await Cr(U)).docs.map(W=>{var X;const H=W.data();return{id:W.id,name:H.roomName||"Unbenanntes Wlkchen",visitedAt:((X=H.visitedAt)==null?void 0:X.toDate())||new Date,duration:H.duration||0}});l(q)}catch(U){console.error("Error fetching recent rooms:",U)}finally{p(!1)}}O()},[t]);const w=m.voice_minutes||e.voice_minutes||0,R=m.rooms_visited||e.rooms_visited||0,C=m.total_sessions||e.total_sessions||0,A=()=>{console.log("AuraLegacy clicked - navigating to /voice-stats"),r("/voice-stats")};return c.jsxs("div",{className:"w-full mb-4",children:[c.jsxs(Ne.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},whileTap:{scale:.98},onClick:A,role:"button",tabIndex:0,onKeyDown:O=>O.key==="Enter"&&A(),className:"w-full glass-card rounded-2xl p-5 bg-gradient-to-br from-violet-50 to-purple-50 border border-violet-200 text-left relative overflow-hidden group cursor-pointer active:scale-[0.98] transition-transform",style:{position:"relative",zIndex:10},children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(kn,{size:16,className:"text-violet-500"}),c.jsx("h3",{className:"text-sm font-bold text-gray-800",children:"Voice-Aktivitt"})]}),c.jsxs("div",{className:"flex items-center gap-1 text-xs text-violet-500 font-medium",children:[c.jsx("span",{children:"Details"}),c.jsx(Fi,{size:14,className:"group-hover:translate-x-1 transition-transform"})]})]}),c.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[c.jsxs("div",{className:"bg-white/60 rounded-xl p-3 text-center",children:[c.jsx("div",{className:"flex items-center justify-center gap-1 mb-1",children:c.jsx(Qo,{size:14,className:"text-violet-500"})}),c.jsx("p",{className:"text-lg font-bold text-violet-600",children:eze(w)}),c.jsx("p",{className:"text-[9px] text-gray-500 uppercase font-medium",children:"Voice Zeit"})]}),c.jsxs("div",{className:"bg-white/60 rounded-xl p-3 text-center",children:[c.jsx("div",{className:"flex items-center justify-center gap-1 mb-1",children:c.jsx(Xo,{size:14,className:"text-purple-500"})}),c.jsx("p",{className:"text-lg font-bold text-purple-600",children:R}),c.jsx("p",{className:"text-[9px] text-gray-500 uppercase font-medium",children:"Wlkchen"})]}),c.jsxs("div",{className:"bg-white/60 rounded-xl p-3 text-center",children:[c.jsx("div",{className:"flex items-center justify-center gap-1 mb-1",children:c.jsx(fd,{size:14,className:"text-emerald-500"})}),c.jsx("p",{className:"text-lg font-bold text-emerald-600",children:C}),c.jsx("p",{className:"text-[9px] text-gray-500 uppercase font-medium",children:"Sessions"})]})]}),c.jsx("div",{className:"absolute inset-0 bg-violet-500/0 group-hover:bg-violet-500/5 transition-colors rounded-2xl pointer-events-none"})]}),a.length>0&&c.jsxs("div",{className:"mt-3 space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2 px-1",children:[c.jsx(Ua,{size:12,className:"text-gray-400"}),c.jsx("span",{className:"text-[10px] text-gray-400 uppercase font-medium tracking-wide",children:"Letzte Rume"})]}),a.map((O,U)=>c.jsx(Ne.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:U*.1},className:"glass-card rounded-xl p-3 flex items-center justify-between",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-9 h-9 rounded-lg bg-violet-100 flex items-center justify-center",children:c.jsx(Xo,{size:16,className:"text-violet-500"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium text-gray-800",children:O.name}),c.jsxs("p",{className:"text-[10px] text-gray-400",children:[tze(O.visitedAt),"  ",O.duration,"m"]})]})]})},O.id))]}),!u&&a.length===0&&w===0&&c.jsxs(Ne.div,{initial:{opacity:0},animate:{opacity:1},className:"glass-card rounded-2xl p-6 text-center mt-3",children:[c.jsx(Qo,{size:28,className:"text-gray-300 mx-auto mb-2"}),c.jsx("p",{className:"text-sm text-gray-500",children:"Noch keine Voice-Aktivitt"}),c.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"Tritt einem Wlkchen bei, um deine Aura aufzubauen"})]})]})});Zme.displayName="AuraLegacy";const nze=t=>t>=60?`${(t/60).toFixed(1)}h`:`${t}m`,rze=t=>t>0?`+${t}%`:t<0?`${t}%`:"0%",vB=V.memo(function({label:e,value:r,icon:a,color:l="text-white",glowColor:u="rgba(139, 92, 246, 0.3)",delay:p=0}){return c.jsxs(Ne.div,{initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{delay:p,duration:.5,ease:"easeOut"},className:"relative flex flex-col items-center p-4 rounded-2xl overflow-hidden",style:{background:"linear-gradient(135deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 100%)",border:"1px solid rgba(255,255,255,0.05)",backdropFilter:"blur(40px)"},children:[c.jsx("div",{className:"absolute inset-0 opacity-20 pointer-events-none",style:{background:`radial-gradient(circle at 50% 0%, ${u} 0%, transparent 70%)`}}),c.jsx("div",{className:"relative mb-2",children:c.jsx(a,{size:16,className:`${l} opacity-60`})}),c.jsx("span",{className:`relative text-xl font-black ${l}`,children:r}),c.jsx("span",{className:"relative text-[8px] text-white/40 uppercase font-bold mt-1 tracking-wider",children:e})]})}),ize=V.memo(function({data:e}){const r=Math.max(...e,1),a=e.map(p=>p/r*15+2),l=()=>{if(a.length<2)return"M0 20 L100 20";const p=a.map((v,w)=>({x:w/(a.length-1)*100,y:20-v}));let m=`M${p[0].x} ${p[0].y}`;for(let v=1;v<p.length;v++){const w=p[v-1],R=p[v],C=(w.x+R.x)/2;m+=` Q ${C} ${w.y}, ${C} ${(w.y+R.y)/2}`,m+=` Q ${C} ${R.y}, ${R.x} ${R.y}`}return m+=" L 100 20 L 0 20 Z",m},u=()=>{if(a.length<2)return"M0 10 L100 10";const p=a.map((v,w)=>({x:w/(a.length-1)*100,y:20-v}));let m=`M${p[0].x} ${p[0].y}`;for(let v=1;v<p.length;v++){const w=p[v-1],R=p[v],C=(w.x+R.x)/2;m+=` Q ${C} ${w.y}, ${C} ${(w.y+R.y)/2}`,m+=` Q ${C} ${R.y}, ${R.x} ${R.y}`}return m};return c.jsxs(Ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.5,duration:.8},className:"relative rounded-2xl p-5 overflow-hidden",style:{background:"linear-gradient(135deg, rgba(124, 58, 237, 0.08) 0%, rgba(5, 5, 5, 0.95) 100%)",border:"1px solid rgba(124, 58, 237, 0.15)",backdropFilter:"blur(40px)"},children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(kn,{size:12,className:"text-purple-400"}),c.jsx("p",{className:"text-[9px] font-bold text-white/50 uppercase tracking-widest",children:"7-Tage Aura-Frequenz"})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-purple-500 animate-pulse"}),c.jsx("span",{className:"text-[8px] text-purple-400 font-medium",children:"Live"})]})]}),c.jsxs("div",{className:"relative h-24",children:[c.jsxs("svg",{viewBox:"0 0 100 20",className:"w-full h-full",preserveAspectRatio:"none",children:[c.jsxs("defs",{children:[c.jsxs("linearGradient",{id:"auraWaveGradient",x1:"0",x2:"0",y1:"0",y2:"1",children:[c.jsx("stop",{offset:"0%",stopColor:"#7c3aed",stopOpacity:"0.4"}),c.jsx("stop",{offset:"100%",stopColor:"#7c3aed",stopOpacity:"0"})]}),c.jsxs("linearGradient",{id:"auraLineGradient",x1:"0",x2:"1",y1:"0",y2:"0",children:[c.jsx("stop",{offset:"0%",stopColor:"#7c3aed"}),c.jsx("stop",{offset:"50%",stopColor:"#a855f7"}),c.jsx("stop",{offset:"100%",stopColor:"#d946ef"})]})]}),c.jsx(Ne.path,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.8,duration:1},d:l(),fill:"url(#auraWaveGradient)"}),c.jsx(Ne.path,{initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:1},transition:{delay:.6,duration:1.5,ease:"easeInOut"},d:u(),fill:"none",stroke:"url(#auraLineGradient)",strokeWidth:"0.5",strokeLinecap:"round"}),c.jsx(Ne.path,{initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.5},transition:{delay:.6,duration:1.5,ease:"easeInOut"},d:u(),fill:"none",stroke:"#a855f7",strokeWidth:"2",strokeLinecap:"round",filter:"blur(4px)"})]}),c.jsx("div",{className:"absolute bottom-0 left-0 right-0 flex justify-between px-1",children:["Mo","Di","Mi","Do","Fr","Sa","So"].map((p,m)=>c.jsx("span",{className:"text-[7px] text-white/20 font-medium",children:p},p))})]})]})}),sze=V.memo(function({percentile:e}){return e>20?null:c.jsxs(Ne.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:1,duration:.5},className:"flex items-center justify-center gap-2 py-3 px-4 rounded-xl mt-4",style:{background:"linear-gradient(135deg, rgba(168, 85, 247, 0.1) 0%, rgba(124, 58, 237, 0.05) 100%)",border:"1px solid rgba(168, 85, 247, 0.2)"},children:[c.jsx(gv,{size:14,className:"text-purple-400"}),c.jsxs("p",{className:"text-[10px] text-white/60 font-medium",children:["Du gehrst zu den"," ",c.jsxs("span",{className:"text-purple-400 font-bold",children:["Top ",e,"%"]})," ","der resonantesten Seelen in deiner Gegend."]})]})}),ege=V.memo(({userId:t,stats:e})=>{const[r,a]=V.useState({voice_minutes:(e==null?void 0:e.voice_minutes)||0,rooms_visited:(e==null?void 0:e.rooms_visited)||0,rooms_created:(e==null?void 0:e.rooms_created)||0,weekly_change:(e==null?void 0:e.weekly_change)||0,daily_activity:(e==null?void 0:e.daily_activity)||[0,0,0,0,0,0,0],friends_count:(e==null?void 0:e.friends_count)||0,stars_received:(e==null?void 0:e.stars_received)||0}),l=V.useMemo(()=>{const u=r.voice_minutes+r.rooms_visited*10+r.stars_received*5;return u>500?5:u>200?10:u>100?15:u>50?20:25},[r]);return V.useEffect(()=>{if(!t)return;const u=tt(De,"users",t),p=na(u,m=>{if(m.exists()){const v=m.data(),w=v.thisWeekVoiceMinutes||v.totalVoiceMinutes||0,R=v.lastWeekVoiceMinutes||0,C=R>0?Math.round((w-R)/R*100):w>0?100:0,A=v.dailyActivity||v.weeklyActivity||Array(7).fill(0).map(()=>Math.floor(Math.random()*(v.totalVoiceMinutes||10)));a({voice_minutes:v.totalVoiceMinutes||v.voiceMinutes||0,rooms_visited:v.roomsVisited||v.rooms_visited||0,rooms_created:v.roomsCreated||v.rooms_created||0,weekly_change:C,daily_activity:A,friends_count:v.friendCount||v.friends_count||0,stars_received:v.starsReceived||v.stars_received||0})}});return()=>p()},[t]),c.jsxs("div",{className:"w-full space-y-4",children:[c.jsxs(Ne.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"flex items-center gap-2 px-1",children:[c.jsx("div",{className:"w-1 h-4 rounded-full bg-gradient-to-b from-purple-500 to-violet-600"}),c.jsx("h3",{className:"text-[10px] font-black uppercase text-purple-400 tracking-[0.3em]",children:"Aura-Legacy Analytics"})]}),c.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[c.jsx(vB,{label:"Prsenz",value:nze(r.voice_minutes),icon:Ua,color:"text-white",glowColor:"rgba(139, 92, 246, 0.3)",delay:0}),c.jsx(vB,{label:"Resonanz",value:rze(r.weekly_change),icon:fd,color:r.weekly_change>=0?"text-emerald-400":"text-red-400",glowColor:r.weekly_change>=0?"rgba(16, 185, 129, 0.3)":"rgba(239, 68, 68, 0.3)",delay:.1}),c.jsx(vB,{label:"Clouds",value:r.rooms_visited+r.rooms_created,icon:Xo,color:"text-violet-400",glowColor:"rgba(167, 139, 250, 0.3)",delay:.2})]}),c.jsx(ize,{data:r.daily_activity}),c.jsx(sze,{percentile:l})]})});ege.displayName="AuraAnalytics";const aze=()=>{const{t}=ag(),e=yr(),{user:r,setUser:a,searchRadius:l,setSearchRadius:u,isVerifiedStar:p,starProfile:m}=Jr(),{logout:v}=qv(),{blockedUsers:w}=tj(),{progress:R,unclaimedRewards:C}=Qme(),[A,O]=V.useState(!1),[U,F]=V.useState(!1),[q,W]=V.useState(!1),[H,X]=V.useState((r==null?void 0:r.displayName)||""),[ne,te]=V.useState((r==null?void 0:r.bio)||""),[he,J]=V.useState(!1),[Q,ce]=V.useState(null);V.useEffect(()=>{r!=null&&r.id&&bw(r.id).then(ce)},[r==null?void 0:r.id]);const de=(r==null?void 0:r.xp)||0,pe=(r==null?void 0:r.level)||1,be=(r==null?void 0:r.currentStreak)||0,ye=(r==null?void 0:r.trustScore)||3,Ze=(r==null?void 0:r.totalVoiceMinutes)||0,It=(r==null?void 0:r.friendCount)||0,St=(r==null?void 0:r.friendRadarEnabled)??!0,lt=(r==null?void 0:r.isPremium)||!1,Le=(r==null?void 0:r.visibilityMode)||"public",Me=(r==null?void 0:r.starsGivenToday)||0,Ke=lt?eae.premiumStarsPerDay:eae.freeStarsPerDay,Rt=Math.max(0,Ke-Me),rt=i9(pe),mt=Ame(be),yt=PO(pe),Ct=PO(pe+1),Ot=(de-yt)/(Ct-yt)*100,vt=async un=>{if(r)try{await Xn(tt(De,"users",r.id),{visibilityMode:un}),a({...r,visibilityMode:un})}catch(ui){console.error("Failed to update visibility:",ui)}},zt=async()=>{if(r)try{await Xn(tt(De,"users",r.id),{friendRadarEnabled:!St}),a({...r,friendRadarEnabled:!St})}catch(un){console.error("Failed to update friend radar:",un)}},ln=async un=>{if(u(un),!!r)try{await Xn(tt(De,"users",r.id),{searchRadius:un})}catch(ui){console.error("Failed to update radius:",ui)}},Pn=async()=>{if(r)try{await Xn(tt(De,"users",r.id),{displayName:H,bio:ne}),a({...r,displayName:H,bio:ne}),W(!1)}catch(un){console.error("Failed to update profile:",un)}},ni=async()=>{J(!0),await v()},nn=[100,200,300,500,750,1e3,2e3,3e3,5e3].reduce((un,ui)=>Math.abs(ui-l)<Math.abs(un-l)?ui:un),ri=un=>un>=1e3?`${un/1e3}km`:`${un}m`;return c.jsxs("div",{className:"px-4 py-6 pb-24 safe-top min-h-screen bg-gradient-to-b from-synclulu-soft/50 to-white",children:[c.jsxs("div",{className:"flex items-center justify-between mb-6",children:[c.jsx("h1",{className:"font-display text-2xl font-bold text-synclulu-text",children:t("profile.title")}),c.jsx(Zse,{compact:!0})]}),c.jsx("div",{className:"glass-card rounded-3xl p-6 mb-4",children:c.jsxs("div",{className:"flex flex-col items-center mb-4",children:[c.jsx("div",{className:"mb-4",children:c.jsx(Kme,{size:96,editable:!0,avatarUrl:r==null?void 0:r.avatarUrl,displayName:r==null?void 0:r.displayName,className:"shadow-lg"})}),c.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-violet-500 to-purple-600 rounded-full text-white text-sm font-semibold mb-3 shadow-lg",children:[c.jsx("span",{children:rt.emoji}),c.jsxs("span",{children:[t("level.level")," ",pe]}),c.jsx("span",{className:"opacity-60",children:""}),c.jsx("span",{children:rt.name})]}),c.jsxs("div",{className:"w-full max-w-[200px] mb-4",children:[c.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full bg-gradient-to-r from-violet-500 to-purple-500 rounded-full transition-all duration-500",style:{width:`${Math.min(100,Math.max(0,Ot))}%`}})}),c.jsxs("p",{className:"text-xs text-synclulu-muted mt-1 text-center",children:[de," / ",Ct," XP"]})]}),q?c.jsxs("div",{className:"w-full space-y-3",children:[c.jsx("input",{type:"text",value:H,onChange:un=>X(un.target.value),className:"w-full text-center font-display text-xl font-bold bg-synclulu-soft rounded-xl px-4 py-2",placeholder:t("profile.editProfile")}),c.jsx("textarea",{value:ne,onChange:un=>te(un.target.value),placeholder:t("profile.bioPlaceholder"),maxLength:150,rows:2,className:"w-full bg-synclulu-soft rounded-xl px-4 py-3 text-sm resize-none text-center"}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("button",{onClick:()=>W(!1),className:"flex-1 py-2 rounded-xl border-2 border-synclulu-soft font-semibold text-synclulu-muted text-sm",children:t("common.cancel")}),c.jsx("button",{onClick:Pn,className:"flex-1 py-2 rounded-xl btn-primary text-white font-semibold text-sm",children:t("common.save")})]})]}):c.jsxs(c.Fragment,{children:[c.jsx("h2",{className:"font-display text-xl font-bold text-synclulu-text",children:(r==null?void 0:r.displayName)||"Anonymous"}),c.jsxs("button",{onClick:()=>F(!0),className:"flex items-center gap-2 text-sm text-synclulu-muted mb-2 hover:text-synclulu-violet transition-colors",children:[c.jsx(vW,{size:14}),c.jsx("span",{children:r==null?void 0:r.username}),Q!=null&&Q.canChange?c.jsx(EO,{size:12,className:"text-synclulu-violet"}):c.jsxs("span",{className:"text-[10px] text-amber-500 flex items-center gap-1",children:[c.jsx(Ua,{size:10}),(Q==null?void 0:Q.daysRemaining)||0,"d"]})]}),(r==null?void 0:r.birthDay)&&(r==null?void 0:r.birthMonth)&&c.jsxs("div",{className:"flex items-center gap-2 text-sm text-synclulu-muted mb-2",children:[c.jsx(EW,{size:14}),c.jsxs("span",{children:[r.birthDay,". ",oze(r.birthMonth)]}),(r==null?void 0:r.city)&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"text-gray-300",children:""}),c.jsx(no,{size:12}),c.jsx("span",{children:r.city})]})]}),c.jsx("p",{className:"text-sm text-synclulu-text/70 italic text-center px-4",children:(r==null?void 0:r.bio)||t("profile.noBio")}),c.jsxs("button",{onClick:()=>W(!0),className:"mt-3 flex items-center gap-2 text-sm text-synclulu-violet font-medium",children:[c.jsx(EO,{size:14}),t("profile.editProfile")]})]})]})}),c.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[c.jsxs("div",{className:"glass-card rounded-2xl p-3 text-center",children:[c.jsx("p",{className:"text-xl font-bold gradient-text",children:It}),c.jsx("p",{className:"text-[10px] text-synclulu-muted uppercase tracking-wide",children:t("profile.stats.friends")})]}),c.jsxs("div",{className:"glass-card rounded-2xl p-3 text-center",children:[c.jsxs("div",{className:"flex items-center justify-center gap-1",children:[c.jsx("span",{className:"text-yellow-500 text-sm",children:""}),c.jsx("p",{className:"text-xl font-bold gradient-text",children:ye.toFixed(1)})]}),c.jsx("p",{className:"text-[10px] text-synclulu-muted uppercase tracking-wide",children:t("profile.stats.trust")})]}),c.jsxs("div",{className:"glass-card rounded-2xl p-3 text-center",children:[c.jsx("p",{className:"text-xl font-bold gradient-text",children:Ze}),c.jsx("p",{className:"text-[10px] text-synclulu-muted uppercase tracking-wide",children:t("profile.stats.voiceMin")})]})]}),(r==null?void 0:r.id)&&c.jsx("div",{className:"mb-4 p-4 rounded-2xl",style:{background:"linear-gradient(135deg, #050505 0%, #0a0a0a 100%)",border:"1px solid rgba(139, 92, 246, 0.15)"},children:c.jsx(ege,{userId:r.id,stats:{voice_minutes:Ze,rooms_visited:(r==null?void 0:r.roomsVisited)||0,rooms_created:(r==null?void 0:r.roomsCreated)||0,weekly_change:0,daily_activity:[],friends_count:It,stars_received:(r==null?void 0:r.starsReceived)||0}})}),(r==null?void 0:r.id)&&c.jsx(Zme,{userId:r.id,userStats:{voice_minutes:Ze,rooms_visited:(r==null?void 0:r.roomsVisited)||0,total_sessions:(r==null?void 0:r.totalSessions)||0}}),c.jsx("div",{className:"mb-4",children:c.jsx(Jme,{currentLevel:(R==null?void 0:R.currentLevel)||1,hasUnclaimedRewards:C>0})}),p&&m&&c.jsxs("div",{className:"glass-card rounded-2xl p-4 mb-4 bg-gradient-to-br from-purple-50 to-pink-50 border border-purple-200",children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(jN,{tier:m.nebulaTier,size:"lg",animated:!0}),c.jsxs("div",{children:[c.jsx("h3",{className:"font-bold text-synclulu-text",children:"Creator Hub"}),c.jsx(wme,{category:m.category,size:"sm"})]})]}),c.jsx("button",{onClick:()=>e("/stars/dashboard"),className:"px-3 py-1.5 bg-purple-100 text-purple-600 rounded-lg text-xs font-semibold",children:"Dashboard "})]}),c.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[c.jsxs("div",{className:"bg-white/60 rounded-xl p-2 text-center",children:[c.jsx("p",{className:"text-lg font-bold text-purple-600",children:m.totalListeners.toLocaleString()}),c.jsx("p",{className:"text-[9px] text-gray-500",children:"Zuhrer"})]}),c.jsxs("div",{className:"bg-white/60 rounded-xl p-2 text-center",children:[c.jsx("p",{className:"text-lg font-bold text-amber-500",children:m.totalStarsReceived.toLocaleString()}),c.jsx("p",{className:"text-[9px] text-gray-500",children:"Sterne"})]}),c.jsxs("div",{className:"bg-white/60 rounded-xl p-2 text-center",children:[c.jsx("p",{className:"text-lg font-bold text-green-600",children:m.totalEventsHosted}),c.jsx("p",{className:"text-[9px] text-gray-500",children:"Events"})]})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsxs("button",{onClick:()=>e("/stars/event/new"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl text-sm font-semibold",children:[c.jsx(Spe,{size:16}),"Live gehen"]}),c.jsxs("button",{onClick:()=>e("/stars/schedule"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 bg-white border border-purple-200 text-purple-600 rounded-xl text-sm font-semibold",children:[c.jsx(ap,{size:16}),"Event planen"]})]})]}),c.jsxs("div",{className:"glass-card rounded-2xl p-4 mb-4",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ji,{size:18,className:"text-amber-500"}),c.jsx("span",{className:"font-semibold text-synclulu-text text-sm",children:"Deine Sterne heute"})]}),c.jsxs("span",{className:"text-xs text-synclulu-muted",children:[Rt," / ",Ke," brig"]})]}),c.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden mb-2",children:c.jsx("div",{className:"h-full bg-gradient-to-r from-amber-400 to-orange-500 rounded-full transition-all",style:{width:`${Rt/Ke*100}%`}})}),c.jsxs("div",{className:"flex items-center justify-between text-xs",children:[c.jsxs("span",{className:"text-synclulu-muted",children:[Me," Sterne heute vergeben"]}),!lt&&c.jsxs("button",{onClick:()=>e("/premium"),className:"text-purple-500 font-medium flex items-center gap-1",children:[c.jsx(kn,{size:12}),"Mehr mit Premium"]})]})]}),be>=2&&c.jsx("div",{className:"glass-card rounded-2xl p-4 mb-4 bg-gradient-to-r from-orange-400/10 to-red-400/10 border border-orange-200",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("span",{className:"text-2xl animate-pulse",children:""}),c.jsxs("div",{className:"flex-1",children:[c.jsxs("p",{className:"font-semibold text-synclulu-text",children:[be," ",t("streak.days")," ",t("streak.title"),"!"]}),c.jsxs("p",{className:"text-xs text-synclulu-muted",children:[mt,"x ",t("streak.xpBoost")]})]})]})}),c.jsxs("div",{className:"glass-card rounded-2xl p-4 mb-4",children:[c.jsx("p",{className:"text-xs font-semibold text-synclulu-muted uppercase tracking-wide mb-3",children:t("visibility.title")}),c.jsx("div",{className:"space-y-2",children:["public","friends","ghost"].map(un=>c.jsxs("button",{onClick:()=>vt(un),className:`w-full flex items-center gap-3 p-3 rounded-xl transition-all ${Le===un?"bg-synclulu-violet/10 border-2 border-synclulu-violet":"bg-synclulu-soft/50 border-2 border-transparent"}`,children:[c.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center ${Le===un?"bg-synclulu-violet":"border-2 border-gray-300"}`,children:Le===un&&c.jsx("span",{className:"text-white text-xs",children:""})}),c.jsxs("div",{className:"flex-1 text-left",children:[c.jsx("p",{className:"font-medium text-synclulu-text text-sm",children:t(`visibility.${un}.title`)}),c.jsx("p",{className:"text-xs text-synclulu-muted",children:t(`visibility.${un}.description`)})]})]},un))})]}),c.jsx("div",{className:"glass-card rounded-2xl p-4 mb-4",children:c.jsxs("button",{onClick:zt,className:"w-full flex items-center gap-4",children:[c.jsx("div",{className:"w-12 h-12 rounded-xl bg-synclulu-violet/10 flex items-center justify-center",children:c.jsx(no,{size:20,className:"text-synclulu-violet"})}),c.jsxs("div",{className:"flex-1 text-left",children:[c.jsx("p",{className:"font-semibold text-synclulu-text",children:t("friendRadar.title")}),c.jsx("p",{className:"text-xs text-synclulu-muted",children:t("friendRadar.description")})]}),c.jsx("div",{className:`w-14 h-8 rounded-full p-1 transition-colors ${St?"bg-synclulu-violet":"bg-gray-300"}`,children:c.jsx("div",{className:`w-6 h-6 bg-white rounded-full shadow transition-transform ${St?"translate-x-6":""}`})})]})}),c.jsxs("div",{className:"glass-card rounded-2xl p-4 mb-4",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-12 h-12 rounded-xl bg-synclulu-violet/10 flex items-center justify-center",children:c.jsx("span",{className:"text-xl",children:""})}),c.jsxs("div",{children:[c.jsx("p",{className:"font-semibold text-synclulu-text",children:t("radius.title")}),c.jsx("p",{className:"text-xs text-synclulu-muted",children:t("radius.description")})]})]}),c.jsx("span",{className:"text-xl font-bold gradient-text",children:ri(nn)})]}),c.jsxs("div",{className:"px-2",children:[c.jsx("input",{type:"range",min:"100",max:"5000",step:"100",value:l,onChange:un=>ln(Number(un.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-synclulu-violet"}),c.jsxs("div",{className:"flex justify-between text-xs text-synclulu-muted mt-1",children:[c.jsx("span",{children:"100m"}),c.jsx("span",{children:"5km"})]})]})]}),!p&&c.jsxs("div",{className:"glass-card rounded-2xl p-5 mb-4 bg-gradient-to-br from-pink-50 to-purple-50 border border-pink-200",children:[c.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[c.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-pink-500 to-purple-500 flex items-center justify-center",children:c.jsx(Ji,{size:24,className:"text-white"})}),c.jsxs("div",{children:[c.jsx("h3",{className:"font-bold text-lg text-synclulu-text",children:"Creator werden"}),c.jsx("p",{className:"text-xs text-synclulu-muted",children:"Teile deine Stimme mit der Community"})]})]}),c.jsx("p",{className:"text-sm text-synclulu-text/80 mb-4",children:"Werde ein verifizierter Star und hoste eigene Live-Events, verdiene Sterne und baue deine Community auf."}),c.jsxs("button",{onClick:()=>e("/stars/apply"),className:"w-full py-3 rounded-xl bg-gradient-to-r from-pink-500 to-purple-500 text-white font-semibold shadow-lg hover:shadow-xl transition-shadow flex items-center justify-center gap-2",children:[c.jsx(kn,{size:18}),"Jetzt bewerben"]})]}),!lt&&c.jsxs("div",{className:"glass-card rounded-2xl p-5 mb-4 bg-gradient-to-br from-violet-50 to-purple-50 border border-violet-200 relative overflow-hidden",children:[c.jsx("div",{className:"absolute top-3 right-3 px-3 py-1 bg-amber-100 text-amber-700 text-xs font-bold rounded-full",children:"Bald verfgbar"}),c.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[c.jsx(kn,{size:20,className:"text-violet-500"}),c.jsx("h3",{className:"font-bold text-lg gradient-text",children:t("premium.title")})]}),c.jsx("p",{className:"text-sm text-synclulu-text/80 mb-4",children:t("premium.upsell")}),c.jsx("button",{disabled:!0,className:"w-full py-3 rounded-xl bg-gray-300 text-gray-500 font-semibold cursor-not-allowed",children:"Demnchst verfgbar"})]}),c.jsx("div",{className:"mb-4",children:c.jsx($6e,{})}),c.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden mb-4",children:[c.jsxs("button",{onClick:()=>O(!0),className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 transition-colors border-b border-gray-100",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(Mv,{size:18,className:"text-synclulu-muted"}),c.jsx("span",{className:"font-medium text-synclulu-text",children:t("settings.language")})]}),c.jsx(Fi,{size:18,className:"text-synclulu-muted"})]}),c.jsxs("button",{onClick:()=>e("/blocked-users"),className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 transition-colors border-b border-gray-100",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(cs,{size:18,className:"text-synclulu-muted"}),c.jsx("span",{className:"font-medium text-synclulu-text",children:t("settings.blockedUsers")})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-sm text-synclulu-muted",children:w.length}),c.jsx(Fi,{size:18,className:"text-synclulu-muted"})]})]}),c.jsxs("button",{onClick:()=>e("/statistics"),className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 transition-colors border-b border-gray-100",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(FC,{size:18,className:"text-synclulu-muted"}),c.jsx("span",{className:"font-medium text-synclulu-text",children:t("settings.myStats")})]}),c.jsx(Fi,{size:18,className:"text-synclulu-muted"})]}),c.jsxs("button",{onClick:()=>e("/notifications"),className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 transition-colors border-b border-gray-100",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(kl,{size:18,className:"text-synclulu-muted"}),c.jsx("span",{className:"font-medium text-synclulu-text",children:t("settings.notifications")})]}),c.jsx(Fi,{size:18,className:"text-synclulu-muted"})]}),c.jsxs("button",{onClick:()=>e("/help"),className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(gI,{size:18,className:"text-synclulu-muted"}),c.jsx("span",{className:"font-medium text-synclulu-text",children:t("settings.help")})]}),c.jsx(Fi,{size:18,className:"text-synclulu-muted"})]})]}),c.jsxs("button",{onClick:ni,disabled:he,className:"w-full p-4 flex items-center justify-center gap-3 text-red-500 font-medium rounded-2xl border-2 border-red-100 hover:bg-red-50 transition-colors disabled:opacity-50",children:[c.jsx(zL,{size:18}),t(he?"profile.loggingOut":"profile.logout")]}),c.jsx("p",{className:"text-center text-xs text-synclulu-muted mt-6",children:"synclulu v2.0  butterbread "}),A&&c.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-end justify-center z-50 p-4",children:c.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-md p-6 animate-slide-up",children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsx("h2",{className:"font-display text-xl font-bold text-synclulu-text",children:t("settings.language")}),c.jsx("button",{onClick:()=>O(!1),className:"w-10 h-10 rounded-xl bg-synclulu-soft flex items-center justify-center",children:c.jsx(Di,{size:20,className:"text-synclulu-muted"})})]}),c.jsx(Zse,{})]})}),c.jsx($me,{isOpen:U,onClose:()=>F(!1),onSuccess:un=>{bw((r==null?void 0:r.id)||"").then(ce)}})]})},oze=t=>["Januar","Februar","Mrz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"][t-1]||"",cze="MIbamchs82Ve7y0ecX2TpPyymbw1",lze=t=>t>=800?{bg:"bg-emerald-500/10",text:"text-emerald-500",border:"border-emerald-500/30"}:t>=600?{bg:"bg-amber-500/10",text:"text-amber-500",border:"border-amber-500/30"}:t>=400?{bg:"bg-purple-500/10",text:"text-purple-500",border:"border-purple-500/30"}:t>=200?{bg:"bg-blue-500/10",text:"text-blue-500",border:"border-blue-500/30"}:{bg:"bg-gray-500/10",text:"text-gray-400",border:"border-gray-500/30"},dze=t=>t>=800?"Legendary":t>=600?"Respected":t>=400?"Trusted":t>=200?"Rising":"Newcomer",uze=t=>["Januar","Februar","Mrz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"][t-1]||"";function rae(t="light"){if(typeof navigator<"u"&&navigator.vibrate){const e={light:10,medium:25,heavy:50};navigator.vibrate(e[t])}}const hze=()=>{ag();const t=yr(),{user:e,setUser:r}=Jr(),{progress:a,unclaimedRewards:l}=Qme(),[u,p]=V.useState(!1),[m,v]=V.useState(!1),[w,R]=V.useState((e==null?void 0:e.displayName)||""),[C,A]=V.useState((e==null?void 0:e.bio)||""),[O,U]=V.useState(null),F=(e==null?void 0:e.xp)||0,q=(e==null?void 0:e.level)||1,W=(e==null?void 0:e.friendCount)||0,H=(e==null?void 0:e.trustScore)||500,X=(e==null?void 0:e.totalVoiceMinutes)||0,ne=(e==null?void 0:e.id)===cze,te=(e==null?void 0:e.isVerified)||!1,he=lze(H),J=dze(H),Q=i9(q),ce=PO(q),de=PO(q+1),pe=(F-ce)/(de-ce)*100;V.useEffect(()=>{e!=null&&e.id&&bw(e.id).then(U)},[e==null?void 0:e.id]);const be=async()=>{if(e)try{await Xn(tt(De,"users",e.id),{displayName:w,bio:C}),r({...e,displayName:w,bio:C}),v(!1)}catch(It){console.error("Failed to update profile:",It)}},ye=()=>{rae("light"),t("/friends")},Ze=()=>{rae("light"),t("/profile/trust-stats")};return c.jsxs("div",{className:"min-h-screen page-gradient theme-transition",children:[c.jsxs("div",{className:"px-4 pt-6 pb-2 flex items-center justify-between",children:[c.jsx("h1",{className:"font-display text-2xl font-bold text-[var(--synclulu-text)]",children:"Profil"}),c.jsx("button",{onClick:()=>t("/settings"),className:"w-10 h-10 rounded-xl bg-[var(--glass-bg)] backdrop-blur-sm shadow-sm border border-[var(--synclulu-border)] flex items-center justify-center hover:bg-[var(--synclulu-soft)] transition-colors theme-transition",children:c.jsx(xO,{size:20,className:"text-[var(--synclulu-muted)]"})})]}),c.jsx("div",{className:"px-4 py-8",children:c.jsxs("div",{className:"flex flex-col items-center",children:[c.jsxs("div",{className:"mb-6 relative",children:[c.jsx(Kme,{size:112,editable:!0,avatarUrl:e==null?void 0:e.avatarUrl,displayName:e==null?void 0:e.displayName,className:"ring-4 ring-[var(--synclulu-bg)] shadow-2xl shadow-purple-500/20"}),ne&&c.jsx("div",{className:"absolute -top-2 -right-2 text-2xl",children:""}),te&&!ne&&c.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 bg-emerald-500 rounded-full flex items-center justify-center border-2 border-[var(--synclulu-bg)]",children:c.jsx("span",{className:"text-white text-xs",children:""})})]}),c.jsxs("div",{className:"inline-flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-violet-500 to-purple-600 rounded-full text-white text-sm font-semibold shadow-lg shadow-purple-500/30 mb-4",children:[c.jsx("span",{className:"text-base",children:Q.emoji}),c.jsxs("span",{children:["Level ",q]}),c.jsx("span",{className:"opacity-50",children:""}),c.jsx("span",{children:Q.name})]}),c.jsxs("div",{className:"w-full max-w-[220px] mb-5",children:[c.jsx("div",{className:"h-2 bg-[var(--synclulu-surface)] rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full bg-gradient-to-r from-violet-500 to-purple-500 rounded-full transition-all duration-700",style:{width:`${Math.min(100,Math.max(0,pe))}%`}})}),c.jsxs("div",{className:"flex justify-between items-center mt-1.5",children:[c.jsxs("span",{className:"text-xs text-[var(--synclulu-muted)]",children:[F," XP"]}),c.jsxs("span",{className:"text-xs text-[var(--synclulu-muted)]",children:[de," XP"]})]})]}),m?c.jsxs("div",{className:"w-full max-w-sm space-y-3",children:[c.jsx("input",{type:"text",value:w,onChange:It=>R(It.target.value),className:"w-full text-center font-display text-xl font-bold bg-[var(--synclulu-surface)] text-[var(--synclulu-text)] rounded-xl px-4 py-3 border border-[var(--synclulu-border)] focus:border-[var(--synclulu-accent)] focus:ring-2 focus:ring-[var(--synclulu-accent)]/20 outline-none transition-all theme-transition",placeholder:"Dein Name"}),c.jsx("textarea",{value:C,onChange:It=>A(It.target.value),placeholder:"ber dich...",maxLength:150,rows:2,className:"w-full bg-[var(--synclulu-surface)] text-[var(--synclulu-text)] rounded-xl px-4 py-3 text-sm resize-none text-center border border-[var(--synclulu-border)] focus:border-[var(--synclulu-accent)] focus:ring-2 focus:ring-[var(--synclulu-accent)]/20 outline-none transition-all theme-transition"}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("button",{onClick:()=>v(!1),className:"flex-1 py-2.5 rounded-xl border-2 border-[var(--synclulu-border)] font-semibold text-[var(--synclulu-muted)] text-sm hover:bg-[var(--synclulu-soft)] transition-colors theme-transition",children:"Abbrechen"}),c.jsx("button",{onClick:be,className:"flex-1 py-2.5 rounded-xl bg-gradient-to-r from-violet-500 to-purple-600 text-white font-semibold text-sm shadow-lg shadow-purple-500/30 hover:shadow-purple-500/50 transition-shadow",children:"Speichern"})]})]}):c.jsxs(c.Fragment,{children:[c.jsx("h2",{className:"font-display text-2xl font-bold text-[var(--synclulu-text)] mb-1",children:(e==null?void 0:e.displayName)||"Anonymous"}),c.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-2 text-sm text-[var(--synclulu-text-secondary)] mb-3 hover:text-[var(--synclulu-accent)] transition-colors group",children:[c.jsx(vW,{size:14}),c.jsx("span",{children:e==null?void 0:e.username}),O!=null&&O.canChange?c.jsx(EO,{size:12,className:"text-purple-500 opacity-0 group-hover:opacity-100 transition-opacity"}):c.jsxs("span",{className:"text-[10px] text-amber-500 flex items-center gap-1 bg-amber-50 dark:bg-amber-500/10 px-1.5 py-0.5 rounded-full",children:[c.jsx(Ua,{size:10}),(O==null?void 0:O.daysRemaining)||0,"d"]})]}),((e==null?void 0:e.birthDay)||(e==null?void 0:e.city))&&c.jsxs("div",{className:"flex items-center gap-3 text-sm text-[var(--synclulu-muted)] mb-4",children:[(e==null?void 0:e.birthDay)&&(e==null?void 0:e.birthMonth)&&c.jsxs("span",{className:"flex items-center gap-1.5",children:[c.jsx(EW,{size:14}),e.birthDay,". ",uze(e.birthMonth)]}),(e==null?void 0:e.city)&&c.jsxs("span",{className:"flex items-center gap-1.5",children:[c.jsx(no,{size:14}),e.city]})]}),c.jsx("p",{className:"text-sm text-[var(--synclulu-text-secondary)] text-center max-w-xs mb-4",children:(e==null?void 0:e.bio)||"Noch keine Bio hinzugefgt"}),c.jsxs("button",{onClick:()=>v(!0),className:"flex items-center gap-2 text-sm text-[var(--synclulu-accent)] font-medium hover:opacity-80 transition-opacity",children:[c.jsx(EO,{size:14}),"Profil bearbeiten"]})]})]})}),c.jsx("div",{className:"px-4 mb-6",children:c.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[c.jsxs("button",{onClick:ye,className:"bg-[var(--synclulu-card)] rounded-2xl p-5 text-left shadow-sm border border-[var(--synclulu-border)] hover:border-purple-500/30 hover:shadow-lg hover:shadow-purple-500/10 transition-all theme-transition group",children:[c.jsx("div",{className:"w-12 h-12 mb-3 rounded-xl bg-purple-500/10 flex items-center justify-center group-hover:scale-110 transition-transform",children:c.jsx(cr,{size:24,className:"text-purple-500"})}),c.jsx("p",{className:"text-2xl font-bold text-[var(--synclulu-text)]",children:W}),c.jsx("p",{className:"text-xs text-[var(--synclulu-muted)] uppercase tracking-wider",children:"Freunde"}),c.jsxs("div",{className:"mt-2 flex items-center gap-1 text-purple-500 text-xs font-medium opacity-0 group-hover:opacity-100 transition-opacity",children:[c.jsx("span",{children:"Verwalten"}),c.jsx(Fi,{size:12})]})]}),c.jsxs("button",{onClick:Ze,className:`bg-[var(--synclulu-card)] rounded-2xl p-5 text-left shadow-sm border ${he.border} hover:shadow-lg transition-all theme-transition group`,children:[c.jsx("div",{className:`w-12 h-12 mb-3 rounded-xl ${he.bg} flex items-center justify-center group-hover:scale-110 transition-transform`,children:c.jsx(cs,{size:24,className:he.text})}),c.jsx("p",{className:"text-2xl font-bold text-[var(--synclulu-text)]",children:H}),c.jsx("p",{className:"text-xs text-[var(--synclulu-muted)] uppercase tracking-wider",children:J}),c.jsxs("div",{className:`mt-2 flex items-center gap-1 ${he.text} text-xs font-medium opacity-0 group-hover:opacity-100 transition-opacity`,children:[c.jsx("span",{children:"Details"}),c.jsx(Fi,{size:12})]})]})]})}),c.jsx("div",{className:"px-4 mb-6",children:c.jsxs("div",{className:"bg-[var(--synclulu-card)] rounded-2xl p-4 shadow-sm border border-[var(--synclulu-border)] theme-transition flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-10 h-10 rounded-xl bg-pink-500/10 flex items-center justify-center",children:c.jsx(C5e,{size:20,className:"text-pink-500"})}),c.jsxs("div",{children:[c.jsxs("p",{className:"text-lg font-bold text-[var(--synclulu-text)]",children:[X," Minuten"]}),c.jsx("p",{className:"text-xs text-[var(--synclulu-muted)]",children:"Voice-Zeit gesamt"})]})]}),c.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-500/10 flex items-center justify-center",children:c.jsx(Ji,{size:20,className:"text-amber-500"})})]})}),c.jsx("div",{className:"px-4 mb-6",children:c.jsx(Jme,{currentLevel:(a==null?void 0:a.currentLevel)||1,hasUnclaimedRewards:l>0})}),c.jsx("div",{className:"px-4 pb-32",children:c.jsxs("div",{className:"bg-[var(--synclulu-card)] rounded-2xl shadow-sm border border-[var(--synclulu-border)] overflow-hidden theme-transition",children:[c.jsxs("button",{onClick:()=>t("/statistics"),className:"w-full p-4 flex items-center justify-between hover:bg-[var(--synclulu-soft)] transition-colors",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-10 h-10 rounded-xl bg-violet-500/10 flex items-center justify-center",children:c.jsx(Vs,{size:20,className:"text-violet-500"})}),c.jsx("span",{className:"font-medium text-[var(--synclulu-text)]",children:"Meine Statistiken"})]}),c.jsx(Fi,{size:20,className:"text-[var(--synclulu-muted)]"})]}),c.jsx("div",{className:"h-px bg-[var(--synclulu-border)]"}),c.jsxs("button",{onClick:()=>t("/invites"),className:"w-full p-4 flex items-center justify-between hover:bg-[var(--synclulu-soft)] transition-colors",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-10 h-10 rounded-xl bg-emerald-500/10 flex items-center justify-center",children:c.jsx(op,{size:20,className:"text-emerald-500"})}),c.jsx("span",{className:"font-medium text-[var(--synclulu-text)]",children:"Freunde einladen"})]}),c.jsx(Fi,{size:20,className:"text-[var(--synclulu-muted)]"})]}),c.jsx("div",{className:"h-px bg-[var(--synclulu-border)]"}),c.jsxs("button",{onClick:()=>t("/settings"),className:"w-full p-4 flex items-center justify-between hover:bg-[var(--synclulu-soft)] transition-colors",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-10 h-10 rounded-xl bg-[var(--synclulu-surface)] flex items-center justify-center",children:c.jsx(xO,{size:20,className:"text-[var(--synclulu-muted)]"})}),c.jsx("span",{className:"font-medium text-[var(--synclulu-text)]",children:"Alle Einstellungen"})]}),c.jsx(Fi,{size:20,className:"text-[var(--synclulu-muted)]"})]})]})}),c.jsx($me,{isOpen:u,onClose:()=>p(!1),onSuccess:()=>{bw((e==null?void 0:e.id)||"").then(U)}})]})},pze=()=>{const t=yr(),{user:e}=Jr(),[r,a]=V.useState("overview"),[l,u]=V.useState(!0),[p,m]=V.useState({totalTalkTime:0,starsReceived:0,starsGiven:0,loungesVisited:0,friendsMade:0,voiceChatsJoined:0,weeklyActivity:[0,0,0,0,0,0,0],xpCurrent:0,xpRequired:1e3,trustScore:5,followers:0,following:0});V.useEffect(()=>{(async()=>{if(!(e!=null&&e.id)){u(!1);return}try{const F=await Bn(tt(De,"users",e.id)),q=F.exists()?F.data():{},W=Mr(mn(De,"stars"),Kn("toUserId","==",e.id)),H=await Cr(W),X=Mr(mn(De,"stars"),Kn("fromUserId","==",e.id)),ne=await Cr(X),te=Mr(mn(De,"friendships"),Kn("userId","==",e.id)),he=await Cr(te),J=Mr(mn(De,"voiceChatHistory"),Kn("userId","==",e.id)),Q=await Cr(J),ce=Mr(mn(De,"follows"),Kn("followingId","==",e.id)),de=await Cr(ce),pe=Mr(mn(De,"follows"),Kn("followerId","==",e.id)),be=await Cr(pe);let ye=0;Q.docs.forEach(St=>{const lt=St.data();lt.duration&&(ye+=Math.floor(lt.duration/60))});const It=(q.level||1)*500+500;m({totalTalkTime:ye,starsReceived:H.size,starsGiven:ne.size,loungesVisited:q.loungesVisited||0,friendsMade:he.size,voiceChatsJoined:Q.size,weeklyActivity:q.weeklyActivity||[0,0,0,0,0,0,0],xpCurrent:q.xp||0,xpRequired:It,trustScore:q.trustScore||5,followers:de.size,following:be.size})}catch(F){console.error("Error fetching stats:",F)}finally{u(!1)}})()},[e==null?void 0:e.id]);const v=(e==null?void 0:e.level)||1,w=i9(v),R=Ame((e==null?void 0:e.currentStreak)||0),C=p.xpRequired>0?p.xpCurrent/p.xpRequired*100:0,O=[{label:"Gesprochene Zeit",value:(U=>{const F=Math.floor(U/60),q=U%60;return F>0?`${F}h ${q}m`:q>0?`${q}m`:"0m"})(p.totalTalkTime),subtext:p.totalTalkTime===0?"Noch keine Gesprche":void 0,icon:c.jsx(Qo,{size:20}),color:"from-violet-500 to-purple-600"},{label:"Sterne erhalten",value:p.starsReceived,subtext:`${p.starsGiven} verschenkt`,icon:c.jsx(Ji,{size:20}),color:"from-amber-400 to-orange-500"},{label:"Voice Chats",value:p.voiceChatsJoined,subtext:p.voiceChatsJoined===0?"Noch keinem beigetreten":void 0,icon:c.jsx(Xo,{size:20}),color:"from-blue-400 to-cyan-500"},{label:"Freundschaften",value:p.friendsMade,subtext:p.friendsMade===0?"Finde neue Freunde!":void 0,icon:c.jsx(cr,{size:20}),color:"from-green-400 to-emerald-500"}];return l?c.jsx("div",{className:"min-h-screen bg-gradient-to-b from-synclulu-soft/50 to-white flex items-center justify-center",children:c.jsxs("div",{className:"text-center",children:[c.jsx(fi,{size:32,className:"animate-spin text-synclulu-violet mx-auto mb-4"}),c.jsx("p",{className:"text-synclulu-muted text-sm",children:"Lade Statistiken..."})]})}):c.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-synclulu-soft/50 to-white safe-top safe-bottom pb-24",children:[c.jsxs("div",{className:"sticky top-0 z-20 bg-white/90 backdrop-blur-lg border-b border-gray-100",children:[c.jsxs("div",{className:"px-6 py-4 flex items-center gap-4",children:[c.jsx("button",{onClick:()=>t(-1),className:"w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-synclulu-muted hover:bg-gray-200 transition-colors",children:c.jsx(Eo,{size:20})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h1",{className:"font-display text-xl font-bold text-synclulu-text",children:"Meine Statistiken"}),c.jsx("p",{className:"text-xs text-synclulu-muted",children:"Deine Aktivitt im berblick"})]})]}),c.jsx("div",{className:"px-6 pb-3 flex gap-2",children:[{id:"overview",label:"bersicht",icon:FC},{id:"activity",label:"Aktivitt",icon:ap},{id:"social",label:"Sozial",icon:cr}].map(U=>c.jsxs("button",{onClick:()=>a(U.id),className:`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-semibold transition-all ${r===U.id?"bg-synclulu-violet text-white shadow-lg":"bg-gray-100 text-synclulu-muted hover:bg-gray-200"}`,children:[c.jsx(U.icon,{size:16}),U.label]},U.id))})]}),c.jsx("div",{className:"px-6 py-4",children:c.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-br from-synclulu-violet to-purple-600 rounded-3xl p-6 text-white shadow-xl",children:[c.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2"}),c.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/5 rounded-full translate-y-1/2 -translate-x-1/2"}),c.jsxs("div",{className:"relative",children:[c.jsxs("div",{className:"flex items-start justify-between mb-4",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-16 h-16 rounded-2xl bg-white/20 flex items-center justify-center text-3xl",children:w.emoji}),c.jsxs("div",{children:[c.jsx("p",{className:"text-white/70 text-sm",children:"Dein Level"}),c.jsxs("h2",{className:"font-display text-3xl font-bold",children:["Level ",v]}),c.jsx("p",{className:"text-white/80 text-sm",children:w.name})]})]}),R>1&&c.jsxs("div",{className:"flex items-center gap-1 px-3 py-1.5 bg-amber-400 text-amber-900 rounded-full",children:[c.jsx(BL,{size:14}),c.jsxs("span",{className:"text-sm font-bold",children:[R,"x XP"]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center justify-between text-sm",children:[c.jsxs("span",{className:"text-white/70",children:["Fortschritt zu Level ",v+1]}),c.jsxs("span",{className:"font-semibold",children:[p.xpCurrent," / ",p.xpRequired," XP"]})]}),c.jsx("div",{className:"h-3 bg-white/20 rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full bg-gradient-to-r from-amber-400 to-yellow-300 rounded-full transition-all duration-500",style:{width:`${Math.min(C,100)}%`}})}),c.jsx("p",{className:"text-xs text-white/60",children:p.xpRequired-p.xpCurrent>0?`Noch ${p.xpRequired-p.xpCurrent} XP bis zum nchsten Level`:"Level Up bereit!"})]})]})]})}),r==="overview"&&c.jsx("div",{className:"px-6 space-y-4",children:p.totalTalkTime===0&&p.starsReceived===0&&p.voiceChatsJoined===0&&p.friendsMade===0?c.jsxs("div",{className:"text-center py-12",children:[c.jsx("div",{className:"w-24 h-24 mx-auto rounded-3xl bg-gradient-to-br from-synclulu-soft to-white flex items-center justify-center mb-6 shadow-inner",children:c.jsx(FC,{size:40,className:"text-synclulu-muted"})}),c.jsx("h3",{className:"font-display font-bold text-xl text-synclulu-text mb-3",children:r9.empty.stats}),c.jsx("p",{className:"text-sm text-synclulu-muted mb-8 max-w-xs mx-auto leading-relaxed",children:"Hier werden deine Statistiken angezeigt, sobald du anfngst die App zu nutzen. Tritt einem Voice Chat bei oder finde neue Freunde!"}),c.jsxs("button",{onClick:()=>t("/discover"),className:"inline-flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-synclulu-violet to-purple-600 text-white rounded-2xl font-display font-bold shadow-lg",children:[c.jsx(Xo,{size:20}),"Wlkchen entdecken"]})]}):c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"grid grid-cols-2 gap-3",children:O.map((U,F)=>c.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm hover:shadow-md transition-shadow",children:[c.jsx("div",{className:`w-10 h-10 rounded-xl bg-gradient-to-br ${U.color} flex items-center justify-center text-white mb-3`,children:U.icon}),c.jsx("p",{className:"text-2xl font-display font-bold text-synclulu-text",children:U.value}),c.jsx("p",{className:"text-xs text-synclulu-muted mt-1",children:U.label}),U.subtext&&c.jsx("p",{className:"text-[10px] text-synclulu-muted mt-1",children:U.subtext})]},F))}),c.jsx("div",{className:"bg-gradient-to-r from-synclulu-violet/10 to-purple-100 rounded-2xl p-4",children:c.jsxs("p",{className:"text-sm text-synclulu-text",children:[c.jsx("span",{className:"font-semibold",children:"Tipp:"})," Je mehr du mit anderen interagierst, desto mehr XP und Sterne verdienst du!"]})})]})}),r==="activity"&&c.jsxs("div",{className:"px-6 space-y-4",children:[c.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-sm",children:[c.jsxs("h3",{className:"font-display font-bold text-synclulu-text mb-4 flex items-center gap-2",children:[c.jsx(FC,{size:18,className:"text-synclulu-violet"}),"Wochenbersicht"]}),p.weeklyActivity.every(U=>U===0)?c.jsxs("div",{className:"text-center py-8",children:[c.jsx(ap,{size:32,className:"mx-auto text-gray-300 mb-3"}),c.jsx("p",{className:"text-sm text-synclulu-muted",children:"Noch keine Aktivittsdaten vorhanden."}),c.jsx("p",{className:"text-xs text-synclulu-muted mt-1",children:"Nutze die App regelmig, um deine Aktivitt zu tracken."})]}):c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"flex items-end justify-between h-32 gap-2",children:["Mo","Di","Mi","Do","Fr","Sa","So"].map((U,F)=>{const q=Math.max(...p.weeklyActivity,1),W=p.weeklyActivity[F]/q*100,H=F===(new Date().getDay()+6)%7;return c.jsxs("div",{className:"flex-1 flex flex-col items-center gap-2",children:[c.jsx("div",{className:"w-full bg-gray-100 rounded-lg overflow-hidden h-full flex flex-col justify-end",children:c.jsx("div",{className:`w-full rounded-t-lg transition-all duration-500 ${H?"bg-synclulu-violet":"bg-synclulu-violet/40"}`,style:{height:`${W}%`}})}),c.jsx("span",{className:`text-xs ${H?"font-bold text-synclulu-violet":"text-synclulu-muted"}`,children:U})]},U)})}),c.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-gray-100",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-synclulu-muted",children:"Gesamt diese Woche"}),c.jsxs("p",{className:"font-bold text-synclulu-text",children:[p.weeklyActivity.reduce((U,F)=>U+F,0)," Minuten"]})]}),c.jsxs("div",{className:"text-right",children:[c.jsx("p",{className:"text-xs text-synclulu-muted",children:"Durchschnitt"}),c.jsxs("p",{className:"font-bold text-synclulu-violet",children:[(p.weeklyActivity.reduce((U,F)=>U+F,0)/7).toFixed(0),"min/Tag"]})]})]})]})]}),c.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-sm",children:[c.jsxs("h3",{className:"font-display font-bold text-synclulu-text mb-4 flex items-center gap-2",children:[c.jsx(F5e,{size:18,className:"text-green-500"}),"Wochenziele"]}),c.jsx("div",{className:"space-y-4",children:[{label:"5 Voice Chats",current:Math.min(p.voiceChatsJoined,5),target:5,color:"bg-violet-500"},{label:"10 Sterne verschenken",current:Math.min(p.starsGiven,10),target:10,color:"bg-amber-500"},{label:"3 neue Freunde",current:Math.min(p.friendsMade,3),target:3,color:"bg-green-500"}].map((U,F)=>c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("span",{className:"text-sm text-synclulu-text",children:U.label}),c.jsxs("span",{className:`text-sm font-bold ${U.current>=U.target?"text-green-600":"text-synclulu-muted"}`,children:[U.current,"/",U.target,U.current>=U.target&&" "]})]}),c.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:c.jsx("div",{className:`h-full ${U.color} rounded-full transition-all`,style:{width:`${Math.min(U.current/U.target*100,100)}%`}})})]},F))})]})]}),r==="social"&&c.jsxs("div",{className:"px-6 space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[c.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-4",children:[c.jsx(Ji,{size:24,className:"text-amber-500 mb-2"}),c.jsx("p",{className:"text-2xl font-display font-bold text-amber-600",children:p.starsReceived}),c.jsx("p",{className:"text-xs text-amber-700/70",children:"Sterne erhalten"}),c.jsxs("p",{className:"text-[10px] text-amber-600 mt-1",children:["= ",p.starsReceived*15," XP verdient"]})]}),c.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-violet-50 rounded-2xl p-4",children:[c.jsx(gv,{size:24,className:"text-violet-500 mb-2"}),c.jsx("p",{className:"text-2xl font-display font-bold text-violet-600",children:p.starsGiven}),c.jsx("p",{className:"text-xs text-violet-700/70",children:"Sterne verschenkt"}),c.jsxs("p",{className:"text-[10px] text-violet-600 mt-1",children:["= ",p.starsGiven*5," XP ausgegeben"]})]})]}),c.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-sm",children:[c.jsxs("h3",{className:"font-display font-bold text-synclulu-text mb-4 flex items-center gap-2",children:[c.jsx(Vs,{size:18,className:"text-green-500"}),"Trust Score"]}),c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("div",{className:"relative w-24 h-24",children:[c.jsxs("svg",{className:"w-full h-full -rotate-90",viewBox:"0 0 100 100",children:[c.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"#E5E7EB",strokeWidth:"12"}),c.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"#10B981",strokeWidth:"12",strokeLinecap:"round",strokeDasharray:`${p.trustScore/5*251.2} 251.2`})]}),c.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:c.jsx("span",{className:"text-2xl font-bold text-green-600",children:p.trustScore.toFixed(1)})})]}),c.jsxs("div",{className:"flex-1",children:[c.jsx("p",{className:"text-sm text-synclulu-muted mb-2",children:"Dein Trust Score basiert auf:"}),c.jsxs("ul",{className:"space-y-1 text-xs text-synclulu-text",children:[c.jsxs("li",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),"Positive Bewertungen"]}),c.jsxs("li",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),"Regelmige Aktivitt"]}),c.jsxs("li",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),"Keine Verste"]})]})]})]})]}),c.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-sm",children:[c.jsx("div",{className:"flex items-center justify-between mb-4",children:c.jsxs("h3",{className:"font-display font-bold text-synclulu-text flex items-center gap-2",children:[c.jsx(cr,{size:18,className:"text-blue-500"}),"Freundesnetzwerk"]})}),c.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold text-synclulu-text",children:p.friendsMade}),c.jsx("p",{className:"text-[10px] text-synclulu-muted",children:"Freunde"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold text-blue-500",children:p.followers}),c.jsx("p",{className:"text-[10px] text-synclulu-muted",children:"Follower"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold text-purple-500",children:p.following}),c.jsx("p",{className:"text-[10px] text-synclulu-muted",children:"Folgst du"})]})]}),p.friendsMade===0&&p.followers===0&&p.following===0&&c.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100 text-center",children:c.jsx("p",{className:"text-xs text-synclulu-muted",children:"Noch keine Verbindungen. Tritt Voice Chats bei, um Leute kennenzulernen!"})})]})]})]})},fze=()=>{const t=yr(),{user:e}=Jr(),[r,a]=V.useState("all"),[l,u]=V.useState([]),[p,m]=V.useState([]),[v,w]=V.useState(!0),[R,C]=V.useState(null);V.useEffect(()=>{if(!(e!=null&&e.id))return;const te=mn(De,"notifications"),he=na(te,J=>{const Q=[];J.docs.forEach(ce=>{var pe;const de=ce.data();de.toUserId===e.id&&Q.push({id:ce.id,type:de.type||"system",title:de.title||"",message:de.message||"",timestamp:((pe=de.timestamp)==null?void 0:pe.toDate())||new Date,isRead:de.isRead||!1,fromUserId:de.fromUserId,fromUsername:de.fromUsername,fromDisplayName:de.fromDisplayName})}),Q.sort((ce,de)=>de.timestamp.getTime()-ce.timestamp.getTime()),m(Q),w(!1)},J=>{console.error("Error fetching notifications:",J),w(!1)});return()=>he()},[e==null?void 0:e.id]),V.useEffect(()=>{if(!(e!=null&&e.id))return;const te=mn(De,"friendRequests"),he=na(te,J=>{const Q=[];J.docs.forEach(ce=>{var pe;const de=ce.data();de.toUserId===e.id&&de.status==="pending"&&Q.push({id:ce.id,fromUserId:de.fromUserId,fromUsername:de.fromUsername||"unknown",fromDisplayName:de.fromDisplayName||"Unbekannt",fromLevel:de.fromLevel||1,message:de.message,createdAt:((pe=de.createdAt)==null?void 0:pe.toDate())||new Date})}),Q.sort((ce,de)=>de.createdAt.getTime()-ce.createdAt.getTime()),u(Q)},J=>{console.error("Error fetching friend requests:",J)});return()=>he()},[e==null?void 0:e.id]);const A=p.filter(te=>!te.isRead).length,O=l.length,U=async te=>{if(e!=null&&e.id){C(te.id);try{await Xn(tt(De,"friendRequests",te.id),{status:"accepted",acceptedAt:fn.now()}),await Lv(mn(De,"friendships"),{users:[e.id,te.fromUserId],createdAt:fn.now()}),await Lv(mn(De,"notifications"),{toUserId:te.fromUserId,type:"follow",title:"Freundschaft akzeptiert!",message:`${e.displayName||e.username} hat deine Anfrage angenommen`,timestamp:fn.now(),isRead:!1,fromUserId:e.id,fromUsername:e.username,fromDisplayName:e.displayName})}catch(he){console.error("Error accepting request:",he)}finally{C(null)}}},F=async te=>{C(te);try{await Xn(tt(De,"friendRequests",te),{status:"declined",declinedAt:fn.now()})}catch(he){console.error("Error declining request:",he)}finally{C(null)}},q=async te=>{try{await Xn(tt(De,"notifications",te),{isRead:!0})}catch(he){console.error("Error marking as read:",he)}},W=async()=>{const te=p.filter(he=>!he.isRead);try{await Promise.all(te.map(he=>Xn(tt(De,"notifications",he.id),{isRead:!0})))}catch(he){console.error("Error marking all as read:",he)}},H=te=>{switch(te){case"star":return c.jsx(Ji,{size:16,className:"text-amber-500"});case"follow":return c.jsx(op,{size:16,className:"text-blue-500"});case"mention":return c.jsx(hp,{size:16,className:"text-green-500"});case"lounge":return c.jsx(cr,{size:16,className:"text-purple-500"});case"system":return c.jsx(kl,{size:16,className:"text-gray-500"})}},X=te=>{const he=Date.now()-te.getTime(),J=Math.floor(he/6e4),Q=Math.floor(he/36e5),ce=Math.floor(he/864e5);return J<60?`${J}m`:Q<24?`${Q}h`:`${ce}d`},ne=p.filter(te=>r==="all"?!0:r==="stars"?te.type==="star":r==="social"?["follow","lounge","mention"].includes(te.type):!1);return v?c.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{background:"linear-gradient(180deg, #050505 0%, #0a0a0a 100%)"},children:c.jsxs("div",{className:"text-center",children:[c.jsx(fi,{size:32,className:"animate-spin text-violet-400 mx-auto mb-4"}),c.jsx("p",{className:"text-white/40 text-sm",children:"Lade Benachrichtigungen..."})]})}):c.jsxs("div",{className:"min-h-screen safe-top safe-bottom pb-24",style:{background:"linear-gradient(180deg, #050505 0%, #0a0a0a 100%)"},children:[c.jsxs("div",{className:"sticky top-0 z-20",style:{background:"rgba(5, 5, 5, 0.92)",backdropFilter:"blur(40px) saturate(180%)",WebkitBackdropFilter:"blur(40px) saturate(180%)",borderBottom:"1px solid rgba(255, 255, 255, 0.06)"},children:[c.jsxs("div",{className:"px-6 py-4 flex items-center gap-4",children:[c.jsx("button",{onClick:()=>t(-1),className:"w-10 h-10 rounded-xl flex items-center justify-center text-white/60 hover:text-white transition-colors",style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.08)"},children:c.jsx(Eo,{size:20})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h1",{className:"text-xl font-bold text-white",children:"Benachrichtigungen"}),c.jsx("p",{className:"text-xs text-white/40",children:A>0?`${A} ungelesen`:"Alles gelesen"})]}),A>0&&c.jsx("button",{onClick:W,className:"text-xs text-violet-400 font-semibold",children:"Alle lesen"})]}),c.jsx("div",{className:"px-6 pb-3 flex gap-2 overflow-x-auto scrollbar-hide",children:[{id:"all",label:"Alle",count:p.length},{id:"requests",label:"Anfragen",count:O},{id:"stars",label:"Sterne",count:p.filter(te=>te.type==="star").length},{id:"social",label:"Sozial",count:p.filter(te=>["follow","lounge"].includes(te.type)).length}].map(te=>c.jsxs("button",{onClick:()=>a(te.id),className:"flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-semibold whitespace-nowrap transition-all",style:{background:r===te.id?"linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%)":"rgba(255, 255, 255, 0.05)",color:r===te.id?"white":"rgba(255, 255, 255, 0.5)",border:r===te.id?"none":"1px solid rgba(255, 255, 255, 0.08)",boxShadow:r===te.id?"0 4px 20px rgba(139, 92, 246, 0.4)":"none"},children:[te.label,te.count>0&&c.jsx("span",{className:"px-1.5 py-0.5 rounded-full text-[10px]",style:{background:r===te.id?"rgba(255, 255, 255, 0.2)":"rgba(139, 92, 246, 0.2)",color:r===te.id?"white":"#a855f7"},children:te.count})]},te.id))})]}),(r==="all"||r==="requests")&&l.length>0&&c.jsxs("div",{className:"px-6 py-4",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[c.jsx(op,{size:18,className:"text-violet-400"}),c.jsx("h2",{className:"font-bold text-white",children:"Freundschaftsanfragen"}),c.jsx("span",{className:"px-2 py-0.5 text-xs font-bold rounded-full",style:{background:"rgba(239, 68, 68, 0.2)",color:"#f87171"},children:O})]}),c.jsx("div",{className:"space-y-3",children:l.map(te=>{var he;return c.jsxs("div",{className:"rounded-[24px] p-4",style:{background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 255, 255, 0.06)"},children:[c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-lg text-white/60",style:{background:"rgba(139, 92, 246, 0.2)"},children:((he=te.fromDisplayName[0])==null?void 0:he.toUpperCase())||"?"}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("p",{className:"font-semibold text-white truncate",children:te.fromDisplayName}),c.jsxs("p",{className:"text-xs text-white/40",children:["@",te.fromUsername,"  Level ",te.fromLevel]}),te.message&&c.jsxs("p",{className:"text-sm text-white/50 mt-1 italic",children:['"',te.message,'"']})]}),c.jsx("span",{className:"text-[10px] text-white/30",children:X(te.createdAt)})]}),c.jsxs("div",{className:"flex gap-2 mt-3",children:[c.jsxs("button",{onClick:()=>F(te.id),disabled:R===te.id,className:"flex-1 py-2 rounded-xl font-semibold text-sm flex items-center justify-center gap-2 disabled:opacity-50",style:{background:"rgba(255, 255, 255, 0.05)",color:"rgba(255, 255, 255, 0.6)",border:"1px solid rgba(255, 255, 255, 0.08)"},children:[c.jsx(Di,{size:16}),"Ablehnen"]}),c.jsxs("button",{onClick:()=>U(te),disabled:R===te.id,className:"flex-1 py-2 rounded-xl text-white font-semibold text-sm flex items-center justify-center gap-2 disabled:opacity-50",style:{background:"linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%)"},children:[R===te.id?c.jsx(fi,{size:16,className:"animate-spin"}):c.jsx(_r,{size:16}),"Annehmen"]})]})]},te.id)})})]}),r!=="requests"&&c.jsxs("div",{className:"px-6 py-4",children:[r==="all"&&l.length>0&&c.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[c.jsx(kl,{size:18,className:"text-violet-400"}),c.jsx("h2",{className:"font-bold text-white",children:"Aktivitten"})]}),ne.length===0?c.jsxs("div",{className:"text-center py-12",children:[c.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4",style:{background:"rgba(255, 255, 255, 0.03)"},children:c.jsx(kl,{size:24,className:"text-white/20"})}),c.jsx("p",{className:"font-semibold text-white mb-2",children:"Keine Benachrichtigungen"}),c.jsx("p",{className:"text-sm text-white/40",children:"Neue Aktivitten erscheinen hier"})]}):c.jsx("div",{className:"space-y-2",children:ne.map(te=>c.jsxs("div",{onClick:()=>!te.isRead&&q(te.id),className:"flex items-start gap-3 p-4 rounded-2xl transition-colors cursor-pointer",style:{background:te.isRead?"rgba(255, 255, 255, 0.02)":"rgba(139, 92, 246, 0.08)",border:te.isRead?"1px solid rgba(255, 255, 255, 0.04)":"1px solid rgba(139, 92, 246, 0.2)"},children:[c.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center",style:{background:te.isRead?"rgba(255, 255, 255, 0.05)":"rgba(139, 92, 246, 0.15)"},children:H(te.type)}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsxs("div",{className:"flex items-start justify-between gap-2",children:[c.jsx("h3",{className:"text-sm",style:{color:te.isRead?"rgba(255, 255, 255, 0.7)":"white",fontWeight:te.isRead?400:600},children:te.title}),c.jsx("span",{className:"text-[10px] text-white/30 whitespace-nowrap",children:X(te.timestamp)})]}),c.jsx("p",{className:"text-xs text-white/40 mt-0.5 truncate",children:te.message})]}),!te.isRead&&c.jsx("div",{className:"w-2 h-2 rounded-full mt-2",style:{background:"#a855f7"}})]},te.id))})]}),r==="requests"&&l.length===0&&c.jsxs("div",{className:"text-center py-12 px-6",children:[c.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4",style:{background:"rgba(255, 255, 255, 0.03)"},children:c.jsx(op,{size:24,className:"text-white/20"})}),c.jsx("h3",{className:"font-semibold text-white mb-2",children:"Keine Anfragen"}),c.jsx("p",{className:"text-sm text-white/40",children:"Neue Freundschaftsanfragen erscheinen hier"})]})]})},mze=()=>{const t=yr(),{language:e}=ag(),[r,a]=V.useState(!1),l=e==="de",u=[{icon:c.jsx(Vs,{size:20}),title:"1.5x XP Boost",titleEn:"1.5x XP Boost",description:"Verdiene 50% mehr XP bei jeder Aktivitt",descriptionEn:"Earn 50% more XP with every activity",isPremium:!0},{icon:c.jsx(Ji,{size:20}),title:"Unbegrenzte Sterne",titleEn:"Unlimited Stars",description:"Verschenke so viele Sterne wie du mchtest",descriptionEn:"Gift as many stars as you want",isPremium:!0},{icon:c.jsx(Pl,{size:20}),title:"Profilbesucher",titleEn:"Profile Visitors",description:"Sieh wer dein Profil besucht hat",descriptionEn:"See who visited your profile",isPremium:!0},{icon:c.jsx(cs,{size:20}),title:"Erweiterte Privatsphre",titleEn:"Extended Privacy",description:"Unsichtbarer Modus & Lesebesttigungen kontrollieren",descriptionEn:"Invisible mode & control read receipts",isPremium:!0},{icon:c.jsx(cr,{size:20}),title:"Exklusive Lounges",titleEn:"Exclusive Lounges",description:"Zugang zu Premium-Only Voice Lounges",descriptionEn:"Access to Premium-Only Voice Lounges",isPremium:!0},{icon:c.jsx(as,{size:20}),title:"Premium Badge",titleEn:"Premium Badge",description:"Zeige deinen Status mit einem goldenen Badge",descriptionEn:"Show your status with a golden badge",isPremium:!0},{icon:c.jsx(no,{size:20}),title:"Erweiterter Suchradius",titleEn:"Extended Search Radius",description:"Finde Nutzer in bis zu 2km Entfernung",descriptionEn:"Find users up to 2km away",isPremium:!0},{icon:c.jsx(Qo,{size:20}),title:"HD Sprachqualitt",titleEn:"HD Voice Quality",description:"Kristallklare Audioqualitt in Voice Chats",descriptionEn:"Crystal clear audio quality in voice chats",isPremium:!0}],p=()=>{a(!0),"vibrate"in navigator&&navigator.vibrate([30,20,50]),setTimeout(()=>{a(!1)},3e3)};return c.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-amber-50 via-orange-50 to-white safe-top safe-bottom pb-24",children:[c.jsxs("div",{className:"relative overflow-hidden",children:[c.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-amber-400 via-orange-500 to-amber-500"}),c.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent"}),c.jsx("div",{className:"relative px-6 pt-4 pb-2 flex items-center justify-between",children:c.jsx("button",{onClick:()=>t(-1),className:"w-10 h-10 rounded-xl bg-white/20 flex items-center justify-center text-white hover:bg-white/30 transition-colors",children:c.jsx(Eo,{size:20})})}),c.jsxs("div",{className:"relative px-6 pt-4 pb-12 text-white text-center",children:[c.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-3xl bg-white/20 backdrop-blur flex items-center justify-center",children:c.jsx(as,{size:40,className:"text-white"})}),c.jsx("h1",{className:"font-display text-3xl font-bold mb-2",children:"Catalyst Premium"}),c.jsx("p",{className:"text-white/80 text-sm max-w-xs mx-auto",children:l?"Entfessle dein volles Potenzial mit exklusiven Features":"Unleash your full potential with exclusive features"}),c.jsx("div",{className:"absolute top-8 left-8 w-3 h-3 bg-white/30 rounded-full animate-ping"}),c.jsx("div",{className:"absolute top-16 right-12 w-2 h-2 bg-white/20 rounded-full animate-bounce"})]})]}),c.jsx("div",{className:"px-6 -mt-6 mb-6",children:c.jsxs("div",{className:"bg-white rounded-3xl shadow-xl p-6 text-center",children:[c.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-orange-100 to-amber-100 flex items-center justify-center",children:c.jsx($5e,{size:36,className:"text-amber-600"})}),c.jsx("h2",{className:"font-display font-bold text-xl text-gray-900 mb-2",children:l?"Wartungsarbeiten":"Under Maintenance"}),c.jsx("p",{className:"text-gray-500 text-sm mb-6 max-w-xs mx-auto",children:l?"Wir arbeiten an etwas Groartigem! Premium kommt bald zurck mit noch besseren Features.":"We're working on something great! Premium is coming back soon with even better features."}),c.jsx("div",{className:"mb-6",children:c.jsx(q_,{delay:0,children:c.jsx(TW,{size:120,className:"mx-auto"})})}),r?c.jsxs("div",{className:"py-4 bg-green-100 text-green-700 font-semibold rounded-2xl flex items-center justify-center gap-2",children:[c.jsx(_r,{size:20}),l?"Du wirst benachrichtigt!":"You'll be notified!"]}):c.jsxs("button",{onClick:p,className:"w-full py-4 bg-gradient-to-r from-amber-400 to-orange-500 text-white font-bold rounded-2xl shadow-lg flex items-center justify-center gap-2 hover:shadow-xl transition-all",children:[c.jsx(kl,{size:20}),l?"Benachrichtigen wenn verfgbar":"Notify me when available"]}),c.jsx("p",{className:"text-xs text-gray-400 mt-4",children:l?"Vielen Dank fr deine Geduld ":"Thank you for your patience "})]})}),c.jsxs("div",{className:"px-6 mb-6",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[c.jsx(kn,{size:20,className:"text-amber-500"}),c.jsx("h2",{className:"font-display font-bold text-lg text-gray-900",children:l?"Geplante Features":"Upcoming Features"})]}),c.jsx("div",{className:"space-y-3",children:u.map((m,v)=>c.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm flex items-center gap-4",children:[c.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-amber-100 to-orange-100 flex items-center justify-center text-amber-600 flex-shrink-0",children:m.icon}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"font-semibold text-gray-900 text-sm",children:l?m.title:m.titleEn}),c.jsx("p",{className:"text-xs text-gray-500",children:l?m.description:m.descriptionEn})]}),c.jsx("div",{className:"w-6 h-6 rounded-full bg-amber-100 flex items-center justify-center flex-shrink-0",children:c.jsx(as,{size:12,className:"text-amber-600"})})]},v))})]}),c.jsx("div",{className:"px-6 pb-8",children:c.jsxs("div",{className:"bg-gradient-to-br from-violet-100 to-purple-100 rounded-2xl p-5 text-center",children:[c.jsx("p",{className:"font-semibold text-violet-700 mb-1",children:l?" Bald verfgbar":" Coming Soon"}),c.jsx("p",{className:"text-sm text-violet-600/80",children:l?"Apple Pay  Google Pay  Kreditkarte":"Apple Pay  Google Pay  Credit Card"})]})})]})},gze=async(t,e)=>{try{const r=tt(De,"presence",t);await Xn(r,{isIncognito:e});const a=tt(De,"users",t);await Xn(a,{isIncognito:e})}catch(r){console.error("Error setting incognito mode:",r)}},_ze=()=>{const{user:t}=Jr(),[e,r]=V.useState({isIncognito:!1,showOnlineStatus:!0,showProfileVisitors:!0,allowProfileVisits:!0,showLastSeen:!0,notifyOnVisit:!0}),[a,l]=V.useState(!0),[u,p]=V.useState(null);V.useEffect(()=>{if(!(t!=null&&t.id))return;(async()=>{try{const R=await Bn(tt(De,"users",t.id));if(R.exists()){const C=R.data();r({isIncognito:C.isIncognito||!1,showOnlineStatus:C.showOnlineStatus!==!1,showProfileVisitors:C.showProfileVisitors!==!1,allowProfileVisits:C.allowProfileVisits!==!1,showLastSeen:C.showLastSeen!==!1,notifyOnVisit:C.notifyOnVisit!==!1})}}catch(R){console.error("Error loading privacy settings:",R)}finally{l(!1)}})()},[t==null?void 0:t.id]);const m=async w=>{if(!(t!=null&&t.id))return;const R=!e[w];p(w);try{w==="isIncognito"&&await gze(t.id,R),await Xn(tt(De,"users",t.id),{[w]:R}),r(C=>({...C,[w]:R}))}catch(C){console.error("Error updating setting:",C)}finally{p(null)}},v=[{id:"isIncognito",title:"Inkognito-Modus",description:"Besuche Profile unsichtbar. Andere sehen dich nicht.",icon:c.jsx(yie,{size:20,className:"text-purple-500"})},{id:"showOnlineStatus",title:"Online-Status anzeigen",description:"Andere knnen sehen, wenn du online bist.",icon:c.jsx(Pl,{size:20,className:"text-green-500"})},{id:"showProfileVisitors",title:"Profilbesucher anzeigen",description:"Sieh, wer dein Profil besucht hat.",icon:c.jsx(cr,{size:20,className:"text-blue-500"})},{id:"allowProfileVisits",title:"Besuche erlauben",description:"Erlaube anderen, dass sie in deinen Besuchern erscheinen.",icon:c.jsx(cs,{size:20,className:"text-violet-500"})},{id:"showLastSeen",title:'"Zuletzt gesehen" anzeigen',description:"Zeige an, wann du zuletzt aktiv warst.",icon:c.jsx(lp,{size:20,className:"text-gray-500"})},{id:"notifyOnVisit",title:"Bei Besuch benachrichtigen",description:"Erhalte eine Benachrichtigung bei Profilbesuchern.",icon:c.jsx(kl,{size:20,className:"text-amber-500"})}];return a?c.jsx("div",{className:"p-6 flex items-center justify-center",children:c.jsx("div",{className:"w-8 h-8 border-2 border-purple-200 border-t-purple-500 rounded-full animate-spin"})}):c.jsxs("div",{className:"space-y-4",children:[e.isIncognito&&c.jsxs("div",{className:"bg-gradient-to-r from-purple-500/10 to-violet-500/10 rounded-2xl p-4 flex items-center gap-3 border border-purple-200",children:[c.jsx("div",{className:"w-10 h-10 bg-purple-500 rounded-xl flex items-center justify-center",children:c.jsx(yie,{size:20,className:"text-white"})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h4",{className:"font-semibold text-purple-900",children:"Inkognito aktiv"}),c.jsx("p",{className:"text-sm text-purple-600",children:"Du bist unsichtbar unterwegs"})]}),c.jsx(kn,{size:20,className:"text-purple-400"})]}),c.jsx("div",{className:"bg-white rounded-2xl overflow-hidden divide-y divide-gray-100",children:v.map(w=>c.jsxs("div",{className:"p-4 flex items-center gap-4",children:[c.jsx("div",{className:"w-10 h-10 bg-gray-50 rounded-xl flex items-center justify-center",children:w.icon}),c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("h4",{className:"font-medium text-gray-900",children:w.title}),w.isPremium&&c.jsx("span",{className:"px-2 py-0.5 bg-amber-100 text-amber-600 text-xs font-medium rounded-full",children:"Premium"})]}),c.jsx("p",{className:"text-sm text-gray-500",children:w.description})]}),c.jsx("button",{onClick:()=>m(w.id),disabled:u===w.id,className:`relative w-14 h-8 rounded-full transition-all duration-300 ${e[w.id]?"bg-purple-500":"bg-gray-200"}`,children:c.jsx("div",{className:`absolute top-1 w-6 h-6 bg-white rounded-full shadow-sm transition-all duration-300 flex items-center justify-center ${e[w.id]?"left-7":"left-1"}`,children:u===w.id?c.jsx("div",{className:"w-3 h-3 border-2 border-purple-300 border-t-purple-600 rounded-full animate-spin"}):e[w.id]?c.jsx(_r,{size:12,className:"text-purple-500"}):null})})]},w.id))}),c.jsx("p",{className:"text-xs text-gray-400 text-center px-4",children:"Deine Privatsphre ist uns wichtig. Diese Einstellungen gelten sofort."})]})},EB=[{version:"v1.4",date:"31. Januar 2026",title:"The Awakening Update",titleDE:"Das Erwachen",emoji:"",color:"#A78BFA",features:[{icon:Pl,title:"Besucher-Tracking",description:"Sieh, wer einen Blick in deine Wolke geworfen hat",isNew:!0},{icon:Ji,title:"Sterne-Rating",description:"Bewerte andere nach Voice-Chats mit 1-5 Sternen",isNew:!0},{icon:cr,title:"200 Beta-Pltze",description:"Exklusiver Zugang  der Countdown luft!",isNew:!0},{icon:cs,title:"Inkognito-Modus",description:"Besuche Profile unsichtbar",isPremium:!0},{icon:Vs,title:"Online-Status",description:"Sanft leuchtender Indikator am Profilbild",isNew:!0}]},{version:"v1.3",date:"20. Januar 2026",title:"Dream Pass Beta",titleDE:"Traum-Pass Beta",emoji:"",color:"#F472B6",features:[{icon:as,title:"Dream Pass System",description:"100 Level mit exklusiven Belohnungen"},{icon:_o,title:"Creator Dashboard",description:"Verwalte deine Secret Bubbles"},{icon:cr,title:"5-Freunde-System",description:"Premium gratis durch Einladungen"}]},{version:"v1.2",date:"10. Januar 2026",title:"Social Vibes",titleDE:"Soziale Vibes",emoji:"",color:"#60A5FA",features:[{icon:kl,title:"Benachrichtigungen",description:"Push-Notifications fr wichtige Events"},{icon:Ua,title:"Streak-System",description:"Tgliche Aktivitt wird belohnt"}]}],yze=({isOpen:t,onClose:e})=>{const[r,a]=V.useState(0),[l,u]=V.useState(!1);if(V.useEffect(()=>{if(t){const m=localStorage.getItem("synclulu_seen_updates")||"",v=EB[0].version;m.includes(v)||localStorage.setItem("synclulu_seen_updates",m+v),u(!0)}},[t]),!t)return null;const p=EB[r];return c.jsxs("div",{className:"fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4",children:[c.jsxs("div",{className:"bg-gray-900 rounded-3xl w-full max-w-md max-h-[85vh] overflow-hidden flex flex-col animate-scale-in",style:{boxShadow:`0 0 60px ${p.color}30`},children:[c.jsxs("div",{className:"relative p-6 pb-8",style:{background:`linear-gradient(135deg, ${p.color}20 0%, transparent 100%)`},children:[c.jsx("button",{onClick:e,className:"absolute top-4 right-4 w-10 h-10 bg-white/10 rounded-full flex items-center justify-center",children:c.jsx(Di,{size:20,className:"text-white"})}),c.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[c.jsx("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center text-2xl",style:{background:`${p.color}30`},children:p.emoji}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm text-white/60",children:"Was gibt's Neues?"}),c.jsx("h2",{className:"text-2xl font-bold text-white",children:p.titleDE})]})]}),c.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 hide-scrollbar",children:EB.map((m,v)=>c.jsxs("button",{onClick:()=>a(v),className:`px-4 py-2 rounded-full text-sm font-semibold whitespace-nowrap transition-all ${r===v?"text-white":"bg-white/10 text-white/60"}`,style:{background:r===v?m.color:void 0},children:[m.version,v===0&&c.jsx("span",{className:"ml-2 text-xs",children:"NEU"})]},m.version))})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-6 pt-0",children:[c.jsx("p",{className:"text-sm text-white/50 mb-4",children:p.date}),c.jsx("div",{className:"space-y-4",children:p.features.map((m,v)=>c.jsxs("div",{className:"flex items-start gap-4 p-4 bg-white/5 rounded-2xl hover:bg-white/10 transition-colors",children:[c.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0",style:{background:`${p.color}20`},children:c.jsx(m.icon,{size:24,style:{color:p.color}})}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[c.jsx("h3",{className:"font-semibold text-white",children:m.title}),m.isNew&&c.jsx("span",{className:"px-2 py-0.5 bg-green-500/20 text-green-400 text-xs font-bold rounded-full",children:"NEU"}),m.isPremium&&c.jsxs("span",{className:"px-2 py-0.5 bg-amber-500/20 text-amber-400 text-xs font-bold rounded-full flex items-center gap-1",children:[c.jsx(as,{size:10}),"PREMIUM"]})]}),c.jsx("p",{className:"text-sm text-white/60",children:m.description})]})]},v))})]}),c.jsxs("div",{className:"p-6 pt-0",children:[c.jsx("div",{className:"p-4 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-2xl border border-purple-500/20 mb-4",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(L5e,{size:24,className:"text-purple-400"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-semibold text-white",children:"Dream Pass Beta"}),c.jsx("p",{className:"text-xs text-white/60",children:"Startet im Mrz 2026  Sammle jetzt schon XP!"})]})]})}),c.jsxs("button",{onClick:e,className:"w-full py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold rounded-xl flex items-center justify-center gap-2",children:[c.jsx(kn,{size:20}),"Los geht's!"]})]})]}),c.jsx("style",{children:`
        @keyframes scale-in {
          from { transform: scale(0.9); opacity: 0; }
          to { transform: scale(1); opacity: 1; }
        }
        .animate-scale-in { animation: scale-in 0.3s ease-out; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      `})]})},tge=V.memo(()=>{const[t,e]=V.useState(!1),r=()=>{"vibrate"in navigator&&navigator.vibrate([15,10,15]),e(!0)};return c.jsxs(c.Fragment,{children:[c.jsxs(Ne.button,{onClick:r,whileTap:{scale:.98},className:"w-full relative overflow-hidden rounded-2xl",style:{background:"linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(245, 158, 11, 0.08) 100%)",border:"1px solid rgba(251, 191, 36, 0.3)"},children:[c.jsx(Ne.div,{className:"absolute inset-0 bg-gradient-to-r from-transparent via-amber-400/20 to-transparent",animate:{x:["-100%","200%"]},transition:{duration:3,repeat:1/0,repeatDelay:2,ease:"easeInOut"}}),c.jsxs("div",{className:"relative flex items-center gap-4 p-4",children:[c.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center",style:{background:"linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%)",boxShadow:"0 0 20px rgba(251, 191, 36, 0.4), 0 0 40px rgba(251, 191, 36, 0.2)"},children:c.jsx(Vs,{size:24,className:"text-white"})}),c.jsxs("div",{className:"flex-1 text-left",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("h3",{className:"font-bold text-transparent bg-clip-text",style:{backgroundImage:"linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #fbbf24 100%)"},children:"Catalyst-Modus"}),c.jsx("span",{className:"px-2 py-0.5 rounded-full text-[9px] font-bold uppercase tracking-wide",style:{background:"rgba(251, 191, 36, 0.2)",color:"#fbbf24"},children:"Beta"})]}),c.jsx("p",{className:"text-xs text-white/40 mt-0.5",children:"Aktiviere deine volle Aura-Kraft"})]}),c.jsx(Ne.div,{animate:{x:[0,4,0]},transition:{duration:1.5,repeat:1/0},children:c.jsx(kn,{size:18,className:"text-amber-400"})})]})]}),c.jsx(Ur,{children:t&&c.jsxs(c.Fragment,{children:[c.jsx(Ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>e(!1),className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-[200]",style:{WebkitBackdropFilter:"blur(8px)"}}),c.jsx(Ne.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"fixed inset-x-4 top-1/2 -translate-y-1/2 z-[210] max-w-sm mx-auto",children:c.jsxs("div",{className:"rounded-[32px] p-8 text-center overflow-hidden",style:{background:"rgba(10, 10, 10, 0.95)",backdropFilter:"blur(40px) saturate(180%)",WebkitBackdropFilter:"blur(40px) saturate(180%)",border:"1px solid rgba(251, 191, 36, 0.3)",boxShadow:"0 0 60px rgba(251, 191, 36, 0.15), inset 0 0 60px rgba(251, 191, 36, 0.05)"},children:[c.jsx("button",{onClick:()=>e(!1),className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-white/5 flex items-center justify-center",children:c.jsx(Di,{size:16,className:"text-white/40"})}),c.jsx(Ne.div,{className:"w-20 h-20 rounded-3xl mx-auto mb-6 flex items-center justify-center",style:{background:"linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%)",boxShadow:"0 0 40px rgba(251, 191, 36, 0.5)"},animate:{boxShadow:["0 0 40px rgba(251, 191, 36, 0.5)","0 0 60px rgba(251, 191, 36, 0.7)","0 0 40px rgba(251, 191, 36, 0.5)"]},transition:{duration:2,repeat:1/0},children:c.jsx(Vs,{size:40,className:"text-white"})}),c.jsx("h2",{className:"text-2xl font-black mb-3 text-transparent bg-clip-text",style:{backgroundImage:"linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #fbbf24 100%)"},children:"Catalyst-Modus"}),c.jsx("p",{className:"text-white/60 text-sm leading-relaxed mb-6",children:"Der Catalyst-Effekt wird gerade in der Tiefe der Nebula geschmiedet."}),c.jsxs("div",{className:"space-y-3 mb-8",children:[c.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl bg-white/5",children:[c.jsx(as,{size:18,className:"text-amber-400"}),c.jsx("span",{className:"text-sm text-white/70",children:"2x Aura-Multiplikator"})]}),c.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl bg-white/5",children:[c.jsx(Ji,{size:18,className:"text-amber-400"}),c.jsx("span",{className:"text-sm text-white/70",children:"Exklusive Catalyst-Badge"})]}),c.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl bg-white/5",children:[c.jsx(kn,{size:18,className:"text-amber-400"}),c.jsx("span",{className:"text-sm text-white/70",children:"Priority Room Matching"})]})]}),c.jsxs("div",{className:"inline-flex items-center gap-2 px-6 py-3 rounded-full",style:{background:"rgba(251, 191, 36, 0.1)",border:"1px solid rgba(251, 191, 36, 0.2)"},children:[c.jsx(Ne.div,{animate:{rotate:360},transition:{duration:8,repeat:1/0,ease:"linear"},children:c.jsx(kn,{size:16,className:"text-amber-400"})}),c.jsx("span",{className:"text-sm font-semibold text-amber-400",children:"Bald verfgbar fr verifizierte Seelen"})]})]})})]})})]})});tge.displayName="CatalystTeaser";const xB=[{id:"harassment",label:"Belstigung",icon:c.jsx(rh,{size:16})},{id:"spam",label:"Spam / Werbung",icon:c.jsx(hp,{size:16})},{id:"inappropriate",label:"Unangemessenes Verhalten",icon:c.jsx(vpe,{size:16})},{id:"personal",label:"Persnliche Grnde",icon:c.jsx(md,{size:16})},{id:"other",label:"Sonstiges",icon:c.jsx(ype,{size:16})}],vze=[{id:"b1",username:"toxic_user",displayName:"Toxic Person",blockedAt:new Date(Date.now()-7*24*60*60*1e3),reason:"harassment"},{id:"b2",username:"spammer99",displayName:"Spam Bot",blockedAt:new Date(Date.now()-30*24*60*60*1e3),reason:"spam"}],iae=()=>{const t=yr(),{user:e,isVerifiedStar:r}=Jr(),{language:a,setLanguage:l}=ag(),{logout:u}=qv(),[p,m]=V.useState(null),[v,w]=V.useState((e==null?void 0:e.isGlobalAnonymous)||!1),[R,C]=V.useState(!0),[A,O]=V.useState(!0),[U,F]=V.useState(!0),[q,W]=V.useState(!0),[H,X]=V.useState(!0),[ne,te]=V.useState(!0),[he,J]=V.useState(!0),[Q,ce]=V.useState(vze),[de,pe]=V.useState(null),[be,ye]=V.useState(!1),[Ze,It]=V.useState(!1),[St,lt]=V.useState(""),[Le,Me]=V.useState(!1),[Ke,Rt]=V.useState(!1),[rt,mt]=V.useState(""),[yt,Ct]=V.useState(""),[Ot,vt]=V.useState(!1);e!=null&&e.totalStarsReceived,e!=null&&e.level,e!=null&&e.totalVoiceMinutes,e!=null&&e.positiveRatings,e!=null&&e.totalRatings;const zt=nn=>Wd[nn].native,ln=nn=>{ce(ri=>ri.filter(un=>un.id!==nn)),pe(null),"vibrate"in navigator&&navigator.vibrate(10)},Pn=async()=>{if(e!=null&&e.id){Rt(!0),mt("");try{const nn=tt(De,"users",e.id);await Xn(nn,{isPaused:!0,pausedAt:ci(),isActive:!1}),await u(),ye(!1),t("/welcome")}catch(nn){console.error("Error pausing account:",nn),mt("Fehler beim Pausieren. Bitte versuche es erneut.")}finally{Rt(!1)}}},ni=async()=>{if(St.toLowerCase()==="lschen"&&!(!(e!=null&&e.id)||!ws.currentUser)){Me(!0),Ct("");try{const nn=ws.currentUser,ri=tt(De,"users",e.id);await Tc(ri);try{await Lne(nn)}catch(un){if(un.code==="auth/requires-recent-login")if(nn.providerData.some(Jn=>Jn.providerId==="google.com"))try{const Jn=new Gd;await Bke(nn,Jn),await Lne(nn)}catch{throw new Error("Bitte melde dich erneut an und versuche es dann nochmal.")}else throw new Error("Bitte melde dich erneut an und versuche es dann nochmal.");else throw un}await u(),It(!1),t("/welcome")}catch(nn){console.error("Error deleting account:",nn),Ct(nn.message||"Fehler beim Lschen. Bitte versuche es erneut.")}finally{Me(!1)}}},pr=nn=>nn.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"});return c.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-synclulu-soft/50 to-white safe-top safe-bottom pb-24",children:[c.jsx("div",{className:"sticky top-0 z-20 bg-white/90 backdrop-blur-lg border-b border-gray-100",children:c.jsxs("div",{className:"px-6 py-4 flex items-center gap-4",children:[c.jsx("button",{onClick:()=>p?m(null):t(-1),className:"w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-synclulu-muted hover:bg-gray-200 transition-colors",children:c.jsx(Eo,{size:20})}),c.jsx("div",{className:"flex-1",children:c.jsxs("h1",{className:"font-display text-xl font-bold text-synclulu-text",children:[p==="account"&&"Account",p==="privacy"&&"Privatsphre",p==="notifications"&&"Benachrichtigungen",p==="blocked"&&"Blockierte User",p==="danger"&&"Account-Einstellungen",p==="language"&&"Sprache",p==="creator"&&"Creator werden",p==="legal"&&"Rechtliches",!p&&"Einstellungen"]})})]})}),!p&&c.jsxs("div",{className:"px-6 py-4 space-y-4",children:[c.jsx("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:c.jsxs("button",{onClick:()=>t("/profile"),className:"w-full flex items-center gap-4 p-4 hover:bg-gray-50 transition-colors",children:[c.jsx("div",{className:"w-14 h-14 rounded-2xl bg-synclulu-violet/10 flex items-center justify-center",children:e!=null&&e.avatarUrl?c.jsx("img",{src:e.avatarUrl,alt:"",className:"w-full h-full rounded-2xl object-cover"}):c.jsx(md,{size:24,className:"text-synclulu-violet"})}),c.jsxs("div",{className:"flex-1 text-left",children:[c.jsx("h3",{className:"font-semibold text-synclulu-text",children:(e==null?void 0:e.displayName)||"Dein Profil"}),c.jsxs("p",{className:"text-sm text-synclulu-muted",children:["@",(e==null?void 0:e.username)||"username"]})]}),c.jsx(Fi,{size:20,className:"text-synclulu-muted"})]})}),c.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden divide-y divide-gray-100",children:[c.jsx(Qh,{icon:c.jsx(yo,{size:20}),label:"Account & Sicherheit",sublabel:"Passwort, E-Mail",onClick:()=>m("account")}),c.jsx(Qh,{icon:c.jsx(cs,{size:20}),label:"Privatsphre",sublabel:"Anonymitt, Sichtbarkeit",onClick:()=>m("privacy")}),c.jsx(Qh,{icon:c.jsx(kl,{size:20}),label:"Benachrichtigungen",sublabel:"Push, Sound, Filter",onClick:()=>m("notifications")}),c.jsx(Qh,{icon:c.jsx(bO,{size:20}),label:"Blockierte User",sublabel:`${Q.length} blockiert`,onClick:()=>m("blocked")})]}),!(e!=null&&e.isPremium)&&c.jsx("button",{onClick:()=>t("/premium"),className:"w-full bg-gradient-to-r from-amber-400 to-orange-500 rounded-2xl p-4 text-white text-left",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(as,{size:24}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"font-semibold",children:"Catalyst Premium"}),c.jsx("p",{className:"text-sm text-white/80",children:"1.5x XP,  Sterne & mehr"})]}),c.jsx(Fi,{size:20})]})}),!r&&c.jsxs("button",{onClick:()=>m("creator"),className:"w-full bg-gradient-to-r from-purple-500/10 to-pink-500/10 border border-purple-500/30 rounded-2xl p-4 text-left relative overflow-hidden",children:[c.jsx("div",{className:"absolute top-2 right-2 px-2 py-0.5 bg-amber-100 text-amber-700 text-[9px] font-bold rounded-full",children:"Coming Soon"}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center",children:c.jsx(kn,{size:24,className:"text-white"})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"font-semibold text-synclulu-text",children:"Creator werden"}),c.jsx("p",{className:"text-xs text-synclulu-muted",children:"Bald verfgbar"})]}),c.jsx(Fi,{size:20,className:"text-synclulu-muted"})]})]}),r&&c.jsx("button",{onClick:()=>t("/stars/dashboard"),className:"w-full bg-gradient-to-r from-amber-500/20 to-orange-500/20 border border-amber-500/30 rounded-2xl p-4 text-left",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center",children:c.jsx(Yd,{size:24,className:"text-white"})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"font-semibold text-synclulu-text",children:"Star Dashboard"}),c.jsx("p",{className:"text-xs text-synclulu-muted",children:"Analytics, Events & mehr"})]}),c.jsx(Fi,{size:20,className:"text-synclulu-muted"})]})}),c.jsx(tge,{}),c.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden divide-y divide-gray-100",children:[c.jsx(Qh,{icon:c.jsx(gI,{size:20}),label:"Hilfe & FAQ",onClick:()=>t("/help")}),c.jsx(Qh,{icon:c.jsx(kn,{size:20}),label:"Was gibt's Neues?",sublabel:"v1.4 - synclulu OS Update",onClick:()=>vt(!0)}),c.jsx(Qh,{icon:c.jsx(Mv,{size:20}),label:"Sprache",sublabel:zt(a),onClick:()=>m("language")}),c.jsx(Qh,{icon:c.jsx(AN,{size:20}),label:"Rechtliches",sublabel:"Impressum & Datenschutz",onClick:()=>m("legal")})]}),c.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden divide-y divide-gray-100",children:[c.jsx(Qh,{icon:c.jsx(XF,{size:20,className:"text-amber-500"}),label:"Account pausieren",sublabel:"Temporr deaktivieren",onClick:()=>ye(!0),dangerous:!0}),c.jsx(Qh,{icon:c.jsx(Lm,{size:20,className:"text-red-500"}),label:"Account lschen",sublabel:"Unwiderruflich",onClick:()=>It(!0),dangerous:!0})]}),c.jsxs("button",{onClick:async()=>{await u(),t("/welcome")},className:"w-full flex items-center justify-center gap-2 py-4 text-red-500 font-semibold",children:[c.jsx(zL,{size:20}),"Abmelden"]})]}),p==="account"&&c.jsxs("div",{className:"px-6 py-4 space-y-4",children:[c.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden divide-y divide-gray-100",children:[c.jsx(Qh,{icon:c.jsx(yo,{size:20}),label:"Passwort ndern",onClick:()=>t("/login",{state:{showForgotPassword:!0}})}),c.jsxs("div",{className:"p-4",children:[c.jsx("label",{className:"text-sm text-synclulu-muted",children:"E-Mail Adresse"}),c.jsx("p",{className:"font-medium text-synclulu-text mt-1",children:(e==null?void 0:e.email)||"user@example.com"})]})]}),c.jsx("div",{className:"p-4 bg-blue-50 rounded-2xl",children:c.jsxs("p",{className:"text-sm text-blue-700",children:[c.jsx("strong",{children:"Tipp:"})," Verwende ein starkes Passwort mit mindestens 12 Zeichen, Gro- und Kleinbuchstaben, Zahlen und Sonderzeichen."]})})]}),p==="privacy"&&c.jsx("div",{className:"px-6 py-4",children:c.jsx(_ze,{})}),p==="notifications"&&c.jsxs("div",{className:"px-6 py-4 space-y-4",children:[c.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden divide-y divide-gray-100",children:[c.jsx(rC,{icon:c.jsx(kl,{size:20}),label:"Push-Benachrichtigungen",sublabel:"Erhalte Benachrichtigungen auf dein Gert",value:U,onChange:F}),c.jsx(rC,{icon:c.jsx(WL,{size:20}),label:"Sounds",sublabel:"Tne bei Benachrichtigungen",value:q,onChange:W})]}),c.jsx("h3",{className:"font-semibold text-synclulu-text px-1",children:"Benachrichtige mich bei:"}),c.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden divide-y divide-gray-100",children:[c.jsx(rC,{icon:c.jsx(Ji,{size:20,className:"text-amber-500"}),label:"Sterne erhalten",value:H,onChange:X}),c.jsx(rC,{icon:c.jsx(md,{size:20,className:"text-blue-500"}),label:"Neue Follower & Anfragen",value:ne,onChange:te}),c.jsx(rC,{icon:c.jsx(Yd,{size:20,className:"text-purple-500"}),label:"Star geht live",sublabel:"Benachrichtigung wenn Stars Events starten",value:he,onChange:J})]})]}),p==="blocked"&&c.jsxs("div",{className:"px-6 py-4",children:[Q.length===0?c.jsxs("div",{className:"text-center py-12",children:[c.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:c.jsx(bO,{size:24,className:"text-gray-400"})}),c.jsx("h3",{className:"font-semibold text-synclulu-text mb-2",children:"Keine blockierten User"}),c.jsx("p",{className:"text-sm text-synclulu-muted",children:"User, die du blockierst, erscheinen hier"})]}):c.jsx("div",{className:"space-y-3",children:Q.map(nn=>{var ri,un;return c.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:[c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx("div",{className:"w-12 h-12 rounded-xl bg-gray-200 flex items-center justify-center",children:c.jsx(md,{size:20,className:"text-gray-500"})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"font-semibold text-synclulu-text",children:nn.displayName}),c.jsxs("p",{className:"text-sm text-synclulu-muted",children:["@",nn.username]}),c.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[c.jsxs("span",{className:"text-xs px-2 py-0.5 bg-red-100 text-red-600 rounded-full flex items-center gap-1",children:[(ri=xB.find(ui=>ui.id===nn.reason))==null?void 0:ri.icon,(un=xB.find(ui=>ui.id===nn.reason))==null?void 0:un.label]}),c.jsx("span",{className:"text-xs text-synclulu-muted",children:pr(nn.blockedAt)})]})]})]}),de===nn.id?c.jsxs("div",{className:"mt-4 flex gap-2",children:[c.jsx("button",{onClick:()=>ln(nn.id),className:"flex-1 py-2 px-4 bg-green-500 text-white rounded-xl font-semibold text-sm",children:"Ja, entblocken"}),c.jsx("button",{onClick:()=>pe(null),className:"flex-1 py-2 px-4 bg-gray-100 text-gray-600 rounded-xl font-semibold text-sm",children:"Abbrechen"})]}):c.jsx("button",{onClick:()=>pe(nn.id),className:"mt-4 w-full py-2 px-4 bg-gray-100 text-gray-600 rounded-xl font-semibold text-sm hover:bg-gray-200 transition-colors",children:"Entblocken"})]},nn.id)})}),c.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-2xl",children:[c.jsxs("h4",{className:"font-semibold text-synclulu-text mb-3 flex items-center gap-2",children:[c.jsx(ype,{size:16}),"Block-Grnde"]}),c.jsx("div",{className:"space-y-2",children:xB.map(nn=>c.jsxs("div",{className:"flex items-center gap-2 text-sm text-synclulu-muted",children:[nn.icon,c.jsx("span",{children:nn.label})]},nn.id))})]})]}),p==="language"&&c.jsxs("div",{className:"px-6 py-4 space-y-4",children:[c.jsx("p",{className:"text-sm text-synclulu-muted",children:"Whle deine bevorzugte Sprache. Die App wird sofort in der gewhlten Sprache angezeigt."}),c.jsx("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden divide-y divide-gray-100",children:Object.keys(Wd).map(nn=>c.jsxs("button",{onClick:()=>l(nn),className:"w-full flex items-center gap-4 p-4 hover:bg-gray-50 transition-colors text-left",children:[c.jsx("div",{className:"w-10 h-10 rounded-xl bg-synclulu-violet/10 flex items-center justify-center text-lg",children:Wd[nn].flag}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"font-semibold text-synclulu-text",children:Wd[nn].native}),c.jsx("p",{className:"text-xs text-synclulu-muted",children:Wd[nn].name})]}),a===nn&&c.jsx(_r,{size:20,className:"text-green-500"})]},nn))})]}),p==="creator"&&c.jsxs("div",{className:"px-6 py-4 space-y-4",children:[c.jsxs("div",{className:"relative overflow-hidden rounded-3xl bg-gradient-to-br from-purple-100 via-pink-50 to-amber-50 p-6",children:[c.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-purple-300/30 to-pink-300/30 rounded-full blur-3xl"}),c.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-br from-amber-300/30 to-orange-300/30 rounded-full blur-3xl"}),c.jsxs("div",{className:"inline-flex items-center gap-1.5 px-3 py-1 bg-amber-100 text-amber-700 text-xs font-bold rounded-full mb-4",children:[c.jsx(Ua,{size:12}),"Bald verfgbar"]}),c.jsxs("div",{className:"relative",children:[c.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[c.jsx("div",{className:"w-14 h-14 rounded-2xl bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center shadow-lg",children:c.jsx(kn,{size:28,className:"text-white"})}),c.jsxs("div",{children:[c.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Creator Programm"}),c.jsx("p",{className:"text-sm text-gray-500",children:"Coming Soon"})]})]}),c.jsx("p",{className:"text-gray-600 mb-6 leading-relaxed",children:"Wir arbeiten gerade an einem aufregenden Creator-Programm fr dich! Bald kannst du verifizierter Star werden, Live-Events hosten und deine eigene Community aufbauen."}),c.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[c.jsxs("div",{className:"bg-white/60 rounded-xl p-3",children:[c.jsx("div",{className:"w-8 h-8 rounded-lg bg-purple-100 flex items-center justify-center mb-2",children:c.jsx(Yd,{size:16,className:"text-purple-600"})}),c.jsx("p",{className:"text-xs font-semibold text-gray-700",children:"Live Events"}),c.jsx("p",{className:"text-[10px] text-gray-500",children:"Hoste eigene Sessions"})]}),c.jsxs("div",{className:"bg-white/60 rounded-xl p-3",children:[c.jsx("div",{className:"w-8 h-8 rounded-lg bg-amber-100 flex items-center justify-center mb-2",children:c.jsx(Ji,{size:16,className:"text-amber-600"})}),c.jsx("p",{className:"text-xs font-semibold text-gray-700",children:"Verifizierung"}),c.jsx("p",{className:"text-[10px] text-gray-500",children:"Offizieller Star-Status"})]}),c.jsxs("div",{className:"bg-white/60 rounded-xl p-3",children:[c.jsx("div",{className:"w-8 h-8 rounded-lg bg-emerald-100 flex items-center justify-center mb-2",children:c.jsx(cr,{size:16,className:"text-emerald-600"})}),c.jsx("p",{className:"text-xs font-semibold text-gray-700",children:"Community"}),c.jsx("p",{className:"text-[10px] text-gray-500",children:"Baue deine Fanbase"})]}),c.jsxs("div",{className:"bg-white/60 rounded-xl p-3",children:[c.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-100 flex items-center justify-center mb-2",children:c.jsx(fd,{size:16,className:"text-blue-600"})}),c.jsx("p",{className:"text-xs font-semibold text-gray-700",children:"Analytics"}),c.jsx("p",{className:"text-[10px] text-gray-500",children:"Verfolge dein Wachstum"})]})]}),c.jsxs("button",{disabled:!0,className:"w-full py-4 rounded-xl bg-gray-200 text-gray-400 font-semibold cursor-not-allowed flex items-center justify-center gap-2",children:[c.jsx(Ua,{size:18}),"Demnchst verfgbar"]})]})]}),c.jsxs("div",{className:"p-4 bg-blue-50 rounded-2xl flex items-start gap-3",children:[c.jsx(bpe,{size:20,className:"text-blue-500 flex-shrink-0 mt-0.5"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm text-blue-800 font-medium",children:"Bleib dran!"}),c.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Wir benachrichtigen dich, sobald das Creator-Programm verfgbar ist. In der Zwischenzeit: Sammle XP und baue deinen Trust-Score auf!"})]})]})]}),p==="legal"&&c.jsxs("div",{className:"px-6 py-4 space-y-4",children:[c.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden divide-y divide-gray-100",children:[c.jsxs("button",{onClick:()=>t("/impressum"),className:"w-full flex items-center gap-4 p-4 hover:bg-gray-50 transition-colors text-left",children:[c.jsx("div",{className:"w-10 h-10 rounded-xl bg-synclulu-violet/10 flex items-center justify-center",children:c.jsx(AN,{size:20,className:"text-synclulu-violet"})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"font-semibold text-synclulu-text",children:"Impressum"}),c.jsx("p",{className:"text-sm text-synclulu-muted",children:"Anbieterinformationen"})]}),c.jsx(Fi,{size:20,className:"text-synclulu-muted"})]}),c.jsxs("button",{onClick:()=>t("/datenschutz"),className:"w-full flex items-center gap-4 p-4 hover:bg-gray-50 transition-colors text-left",children:[c.jsx("div",{className:"w-10 h-10 rounded-xl bg-synclulu-violet/10 flex items-center justify-center",children:c.jsx(cs,{size:20,className:"text-synclulu-violet"})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"font-semibold text-synclulu-text",children:"Datenschutz"}),c.jsx("p",{className:"text-sm text-synclulu-muted",children:"Datenschutzerklrung"})]}),c.jsx(Fi,{size:20,className:"text-synclulu-muted"})]})]}),c.jsx("div",{className:"p-4 bg-gray-50 rounded-2xl text-center",children:c.jsxs("p",{className:"text-sm text-synclulu-muted",children:["synclulu App v1.0.0",c.jsx("br",{})," 2025 Butterbread UG"]})})]}),be&&c.jsx(sae,{onClose:()=>!Ke&&ye(!1),children:c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"w-16 h-16 bg-amber-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:c.jsx(XF,{size:32,className:"text-amber-600"})}),c.jsx("h2",{className:"font-display text-xl font-bold text-synclulu-text mb-2",children:"Account pausieren?"}),c.jsx("p",{className:"text-sm text-synclulu-muted mb-6",children:"Dein Profil wird fr andere unsichtbar. Du kannst jederzeit zurckkehren und all deine Daten bleiben erhalten."}),rt&&c.jsx("p",{className:"text-red-500 text-sm mb-4",children:rt}),c.jsxs("div",{className:"flex gap-3",children:[c.jsx("button",{onClick:()=>ye(!1),disabled:Ke,className:"flex-1 py-3 px-4 bg-gray-100 text-gray-600 rounded-xl font-semibold disabled:opacity-50",children:"Abbrechen"}),c.jsx("button",{onClick:Pn,disabled:Ke,className:"flex-1 py-3 px-4 bg-amber-500 text-white rounded-xl font-semibold disabled:opacity-50 flex items-center justify-center gap-2",children:Ke?c.jsx(fi,{size:18,className:"animate-spin"}):c.jsxs(c.Fragment,{children:[c.jsx(XF,{size:18}),"Pausieren"]})})]})]})}),Ze&&c.jsx(sae,{onClose:()=>It(!1),children:c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:c.jsx(Lm,{size:32,className:"text-red-600"})}),c.jsx("h2",{className:"font-display text-xl font-bold text-synclulu-text mb-2",children:"Account unwiderruflich lschen?"}),c.jsx("p",{className:"text-sm text-synclulu-muted mb-6",children:"Alle deine Daten, Freundschaften, Sterne und XP werden permanent gelscht. Diese Aktion kann nicht rckgngig gemacht werden."}),c.jsxs("div",{className:"mb-6",children:[c.jsx("label",{className:"text-sm text-synclulu-muted block mb-2",children:'Tippe "LSCHEN" zur Besttigung:'}),c.jsx("input",{type:"text",value:St,onChange:nn=>lt(nn.target.value),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-red-500 focus:outline-none text-center font-mono",placeholder:"LSCHEN"})]}),yt&&c.jsx("p",{className:"text-red-500 text-sm mb-4",children:yt}),c.jsxs("div",{className:"flex gap-3",children:[c.jsx("button",{onClick:()=>It(!1),className:"flex-1 py-3 px-4 bg-gray-100 text-gray-600 rounded-xl font-semibold",children:"Abbrechen"}),c.jsx("button",{onClick:ni,disabled:St.toLowerCase()!=="lschen"||Le,className:"flex-1 py-3 px-4 bg-red-500 text-white rounded-xl font-semibold disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:Le?c.jsx(fi,{size:18,className:"animate-spin"}):c.jsxs(c.Fragment,{children:[c.jsx(Lm,{size:18}),"Lschen"]})})]})]})}),c.jsx(yze,{isOpen:Ot,onClose:()=>vt(!1)})]})},Qh=({icon:t,label:e,sublabel:r,onClick:a,dangerous:l})=>c.jsxs("button",{onClick:a,className:"w-full flex items-center gap-4 p-4 hover:bg-gray-50 transition-colors text-left",children:[c.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${l?"bg-red-50 text-red-500":"bg-synclulu-violet/10 text-synclulu-violet"}`,children:t}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:`font-semibold ${l?"text-red-600":"text-synclulu-text"}`,children:e}),r&&c.jsx("p",{className:"text-sm text-synclulu-muted",children:r})]}),c.jsx(Fi,{size:20,className:"text-synclulu-muted"})]}),rC=({icon:t,label:e,sublabel:r,value:a,onChange:l})=>c.jsxs("div",{className:"flex items-center gap-4 p-4",children:[c.jsx("div",{className:"w-10 h-10 rounded-xl bg-synclulu-violet/10 flex items-center justify-center text-synclulu-violet",children:t}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"font-semibold text-synclulu-text",children:e}),r&&c.jsx("p",{className:"text-sm text-synclulu-muted",children:r})]}),c.jsx("button",{onClick:()=>l(!a),className:`relative w-12 h-7 rounded-full transition-colors ${a?"bg-synclulu-violet":"bg-gray-200"}`,children:c.jsx("div",{className:`absolute top-1 w-5 h-5 rounded-full bg-white shadow-sm transition-transform ${a?"left-6":"left-1"}`})})]}),sae=({children:t,onClose:e})=>c.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-6 bg-black/60 backdrop-blur-sm",children:c.jsxs("div",{className:"relative w-full max-w-sm bg-white rounded-3xl p-6 shadow-2xl animate-in zoom-in-95",children:[c.jsx("button",{onClick:e,className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center",children:c.jsx(Di,{size:18})}),t]})}),qi={MAX_RADIUS:5e3,MIN_RADIUS:100,DEFAULT_RADIUS:1e3,STEP_SIZE:50,HIGH_ACCURACY_THRESHOLD:500,UPDATE_INTERVAL_ACTIVE:3e4,UPDATE_INTERVAL_BACKGROUND:3e5,LOCATION_MAX_AGE:6e4,LOCATION_TIMEOUT:15e3,NEARBY_CACHE_TTL:3e4,LOCATION_EXPIRY:9e5,EARTH_RADIUS_METERS:6371e3},Eze=(t,e,r,a)=>{const l=qi.EARTH_RADIUS_METERS,u=t*Math.PI/180,p=r*Math.PI/180,m=(r-t)*Math.PI/180,v=(a-e)*Math.PI/180,w=Math.sin(m/2)*Math.sin(m/2)+Math.cos(u)*Math.cos(p)*Math.sin(v/2)*Math.sin(v/2),R=2*Math.atan2(Math.sqrt(w),Math.sqrt(1-w));return l*R},xze=(t,e,r,a)=>{const l=t*Math.PI/180,u=r*Math.PI/180,p=(a-e)*Math.PI/180,m=Math.sin(p)*Math.cos(u),v=Math.cos(l)*Math.sin(u)-Math.sin(l)*Math.cos(u)*Math.cos(p);return(Math.atan2(m,v)*180/Math.PI+360)%360},bze=(t,e=!1)=>{const r=t<=qi.HIGH_ACCURACY_THRESHOLD;return e?{enableHighAccuracy:!1,maximumAge:qi.LOCATION_MAX_AGE*5,timeout:qi.LOCATION_TIMEOUT*2}:r?{enableHighAccuracy:!0,maximumAge:1e4,timeout:qi.LOCATION_TIMEOUT}:{enableHighAccuracy:!1,maximumAge:qi.LOCATION_MAX_AGE,timeout:qi.LOCATION_TIMEOUT}},wze=async t=>{const e=ws.currentUser;if(!e)return!1;try{return await Yi(tt(De,"user_locations",e.uid),{userId:e.uid,geopoint:new qw(t.latitude,t.longitude),latitude:t.latitude,longitude:t.longitude,accuracy:t.accuracy,updatedAt:ci(),expiresAt:new Date(Date.now()+qi.LOCATION_EXPIRY),isActive:!0},{merge:!0}),!0}catch(r){return console.error("[PrecisionRadar] Failed to update location:",r),!1}},Sze=async(t,e=qi.DEFAULT_RADIUS)=>{var l,u;const r=ws.currentUser;if(!r)return[];const a=Math.min(e,qi.MAX_RADIUS);try{const p=a/qi.EARTH_RADIUS_METERS*(180/Math.PI),m=p/Math.cos(t.latitude*Math.PI/180),v=t.latitude-p,w=t.latitude+p,R=t.longitude-m,C=t.longitude+m,A=mn(De,"user_locations"),O=Mr(A,Kn("latitude",">=",v),Kn("latitude","<=",w),Kn("expiresAt",">",new Date)),U=await Cr(O),F=[];for(const q of U.docs){const W=q.data();if(W.userId===r.uid||W.longitude<R||W.longitude>C)continue;const H=Eze(t.latitude,t.longitude,W.latitude,W.longitude);if(!(H<=a))continue;const ne=await Bn(tt(De,"users",W.userId));if(!ne.exists())continue;const te=ne.data(),he=xze(t.latitude,t.longitude,W.latitude,W.longitude),J=((u=(l=W.updatedAt)==null?void 0:l.toDate)==null?void 0:u.call(l))||new Date(0),Q=Date.now()-J.getTime()<3e5;F.push({id:W.userId,username:te.username||"",displayName:te.displayName||te.username||"Anonym",avatarUrl:te.avatarUrl,avatar:te.avatar,distance:Math.round(H),bearing:Math.round(he),level:te.level||1,trustScore:te.trustScore||50,isPremium:te.isPremium||!1,isActive:Q,lastSeen:J,isWithinRadius:!0})}return F.sort((q,W)=>q.distance-W.distance)}catch(p){return console.error("[PrecisionRadar] Failed to fetch nearby users:",p),[]}},Tze=async()=>{const t=ws.currentUser;if(!t)return{radius:qi.DEFAULT_RADIUS,isEnabled:!0};try{const e=await Bn(tt(De,"users",t.uid));if(!e.exists())return{radius:qi.DEFAULT_RADIUS,isEnabled:!0};const r=e.data();return{radius:Math.min(r.searchRadius||qi.DEFAULT_RADIUS,qi.MAX_RADIUS),isEnabled:r.friendRadarEnabled!==!1}}catch{return{radius:qi.DEFAULT_RADIUS,isEnabled:!0}}},aae=async(t,e)=>{const r=ws.currentUser;if(!r)return!1;const a=Math.min(Math.max(t,qi.MIN_RADIUS),qi.MAX_RADIUS);try{return await Yi(tt(De,"users",r.uid),{searchRadius:a,friendRadarEnabled:e},{merge:!0}),!0}catch{return!1}},Rze=()=>{const{user:t}=Jr(),[e,r]=V.useState(!0),[a,l]=V.useState(!0),[u,p]=V.useState(null),[m,v]=V.useState(null),[w,R]=V.useState(null),[C,A]=V.useState(qi.DEFAULT_RADIUS),[O,U]=V.useState([]),F=V.useRef(null),q=V.useRef(null),W=V.useRef(!1);V.useEffect(()=>{(async()=>{if(t!=null&&t.id){l(!0);try{const Q=await Tze();if(A(Q.radius),r(Q.isEnabled),navigator.permissions){const ce=await navigator.permissions.query({name:"geolocation"});v(ce.state),ce.addEventListener("change",()=>{v(ce.state)})}}catch(Q){console.error("[PrecisionRadar] Init failed:",Q)}finally{l(!1)}}})()},[t==null?void 0:t.id]);const H=V.useCallback(()=>{if(!navigator.geolocation||!e)return;F.current!==null&&navigator.geolocation.clearWatch(F.current);const J=bze(C,W.current);F.current=navigator.geolocation.watchPosition(async Q=>{const ce={latitude:Q.coords.latitude,longitude:Q.coords.longitude,accuracy:Q.coords.accuracy,timestamp:new Date(Q.timestamp)};R(ce),p(null),v("granted"),await wze(ce)},Q=>{switch(Q.code){case Q.PERMISSION_DENIED:p("Standortzugriff verweigert"),v("denied");break;case Q.POSITION_UNAVAILABLE:p("Standort nicht verfgbar");break;case Q.TIMEOUT:p("Standortanfrage Timeout");break;default:p("Standortfehler")}},J)},[e,C]);V.useEffect(()=>(e&&m!=="denied"&&H(),()=>{F.current!==null&&(navigator.geolocation.clearWatch(F.current),F.current=null)}),[e,m,H]);const X=V.useCallback(async()=>{if(!w||!e){U([]);return}try{const J=await Sze(w,C);U(J)}catch(J){console.error("[PrecisionRadar] Failed to fetch nearby:",J)}},[w,C,e]);V.useEffect(()=>{if(!w||!e)return;X();const J=W.current?qi.UPDATE_INTERVAL_BACKGROUND:qi.UPDATE_INTERVAL_ACTIVE;return q.current=setInterval(X,J),()=>{q.current&&(clearInterval(q.current),q.current=null)}},[w,e,X]),V.useEffect(()=>{const J=()=>{W.current=document.hidden,!document.hidden&&e&&H()};return document.addEventListener("visibilitychange",J),()=>{document.removeEventListener("visibilitychange",J)}},[e,H]);const ne=V.useCallback(async J=>{const Q=Math.min(Math.max(J,qi.MIN_RADIUS),qi.MAX_RADIUS);A(Q),await aae(Q,e),"vibrate"in navigator&&navigator.vibrate(10)},[e]),te=V.useCallback(async()=>{const J=!e;r(J),await aae(C,J),J||U([]),"vibrate"in navigator&&navigator.vibrate([10,50,20])},[e,C]),he=V.useCallback(async()=>navigator.geolocation?new Promise(J=>{navigator.geolocation.getCurrentPosition(()=>{v("granted"),p(null),J(!0)},Q=>{Q.code===Q.PERMISSION_DENIED&&(v("denied"),p("Standortzugriff verweigert")),J(!1)},{enableHighAccuracy:!1,timeout:1e4})}):(p("Geolocation wird nicht untersttzt"),!1),[]);return{isEnabled:e,isLoading:a,error:u,permission:m,location:w,radius:C,nearbyUsers:O,nearbyCount:O.length,setRadius:ne,toggleRadar:te,refreshNearby:X,requestPermission:he}},qy=({children:t,className:e="",onClick:r,gradient:a})=>c.jsxs("div",{onClick:r,className:`
      relative overflow-hidden rounded-3xl
      bg-white/70 dark:bg-gray-900/70
      backdrop-blur-xl backdrop-saturate-150
      border border-white/20 dark:border-gray-700/30
      shadow-xl shadow-purple-500/5
      transition-all duration-300
      ${r?"cursor-pointer hover:scale-[1.01] hover:shadow-2xl hover:shadow-purple-500/10 active:scale-[0.99]":""}
      ${e}
    `,children:[a&&c.jsx("div",{className:`absolute inset-0 opacity-10 bg-gradient-to-br ${a}`}),c.jsx("div",{className:"relative",children:t})]}),Ku=({icon:t,iconBg:e,label:r,description:a,value:l,onClick:u,toggle:p,isOn:m,onToggle:v,danger:w,badge:R})=>c.jsxs("button",{onClick:()=>{p&&v?v(!m):u&&u(),"vibrate"in navigator&&navigator.vibrate(10)},className:`w-full p-4 flex items-center gap-4 transition-colors ${w?"hover:bg-red-50 dark:hover:bg-red-900/20":"hover:bg-gray-50/50 dark:hover:bg-gray-800/50"}`,children:[c.jsx("div",{className:`w-11 h-11 rounded-2xl flex items-center justify-center ${e}`,children:t}),c.jsxs("div",{className:"flex-1 text-left",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:`font-medium ${w?"text-red-600":"text-gray-900 dark:text-white"}`,children:r}),R&&c.jsx("span",{className:"px-2 py-0.5 text-[10px] font-bold uppercase bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-full",children:R})]}),a&&c.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:a})]}),p?c.jsx("div",{className:`w-14 h-8 rounded-full p-1 transition-colors ${m?"bg-gradient-to-r from-purple-500 to-pink-500":"bg-gray-200 dark:bg-gray-700"}`,children:c.jsx("div",{className:`w-6 h-6 rounded-full bg-white shadow-md transition-transform ${m?"translate-x-6":"translate-x-0"}`})}):l?c.jsx("span",{className:"text-sm text-gray-500",children:l}):c.jsx(Fi,{size:20,className:"text-gray-400"})]}),Cze=({value:t,onChange:e,disabled:r})=>{const a=(t-qi.MIN_RADIUS)/(qi.MAX_RADIUS-qi.MIN_RADIUS)*100;return c.jsxs("div",{className:`px-4 py-3 ${r?"opacity-50":""}`,children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Suchradius"}),c.jsx("span",{className:"text-sm font-semibold text-purple-600",children:t>=1e3?`${(t/1e3).toFixed(1)}km`:`${t}m`})]}),c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full transition-all",style:{width:`${a}%`}})}),c.jsx("input",{type:"range",min:qi.MIN_RADIUS,max:qi.MAX_RADIUS,step:qi.STEP_SIZE,value:t,onChange:l=>e(Number(l.target.value)),disabled:r,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"})]}),c.jsxs("div",{className:"flex justify-between mt-1",children:[c.jsx("span",{className:"text-[10px] text-gray-400",children:"100m"}),c.jsx("span",{className:"text-[10px] text-gray-400",children:"5km MAX"})]})]})},Nze=()=>{ag();const t=yr(),{user:e,setUser:r}=Jr(),a=(e==null?void 0:e.avatarUrl)||null,{isEnabled:l,radius:u,setRadius:p,toggleRadar:m}=Rze(),[v,w]=V.useState("everyone"),[R,C]=V.useState(!0),[A,O]=V.useState(!0),[U,F]=V.useState(!1),[q,W]=V.useState(""),[H,X]=V.useState(!1),[ne,te]=V.useState(!1);V.useEffect(()=>{(async()=>{if(e!=null&&e.id)try{const de=await Bn(tt(De,"users",e.id));if(de.exists()){const pe=de.data();w(pe.visibility||"everyone"),C(pe.notifications!==!1),O(pe.soundEnabled!==!1),F(pe.darkMode===!0),W(pe.referralCode||`synclulu-${e.id.slice(0,6).toUpperCase()}`),te(pe.isCreator===!0)}}catch(de){console.error("[SettingsHub] Load failed:",de)}})()},[e==null?void 0:e.id]);const he=async(ce,de)=>{if(e!=null&&e.id)try{await Xn(tt(De,"users",e.id),{[ce]:de})}catch(pe){console.error("[SettingsHub] Save failed:",pe)}},J=async()=>{try{await navigator.clipboard.writeText(`Hey! Komm zu synclulu  Nutze meinen Code: ${q}
https://synclulu.app/join/${q}`),X(!0),"vibrate"in navigator&&navigator.vibrate([10,50,10]),setTimeout(()=>X(!1),2e3)}catch(ce){console.error("Copy failed:",ce)}},Q=async()=>{"vibrate"in navigator&&navigator.vibrate([50,30,50]);try{await Fle(ws),t("/login")}catch(ce){console.error("Logout failed:",ce)}};return c.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-purple-50/80 via-white to-gray-50 dark:from-gray-900 dark:via-gray-900 dark:to-black",children:[c.jsx("div",{className:"sticky top-0 z-50 px-4 pt-6 pb-4 bg-gradient-to-b from-purple-50/95 via-white/95 to-transparent dark:from-gray-900/95 dark:via-gray-900/95 backdrop-blur-lg",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("button",{onClick:()=>t(-1),className:"w-10 h-10 rounded-xl bg-white/80 dark:bg-gray-800/80 shadow-sm border border-gray-100 dark:border-gray-700 flex items-center justify-center hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:c.jsx(dd,{size:20,className:"text-gray-600 dark:text-gray-300"})}),c.jsx("h1",{className:"font-display text-2xl font-bold text-gray-900 dark:text-white",children:"Einstellungen"})]})}),c.jsxs("div",{className:"px-4 pb-32 space-y-6",children:[c.jsx(qy,{onClick:()=>t("/profile"),gradient:"from-purple-500 to-pink-500",children:c.jsxs("div",{className:"p-5 flex items-center gap-4",children:[c.jsx("div",{className:"w-16 h-16 rounded-2xl overflow-hidden ring-2 ring-purple-500/30 shadow-lg",children:c.jsx("img",{src:a,alt:"Avatar",className:"w-full h-full object-cover"})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h2",{className:"font-display text-lg font-bold text-gray-900 dark:text-white",children:(e==null?void 0:e.displayName)||"Anonym"}),c.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["@",(e==null?void 0:e.username)||"username"]})]}),c.jsx(Fi,{size:20,className:"text-gray-400"})]})}),c.jsx(qy,{gradient:"from-amber-400 to-orange-500",children:c.jsxs("div",{className:"divide-y divide-gray-100/50 dark:divide-gray-800/50",children:[c.jsx(Ku,{icon:c.jsx(as,{size:20,className:"text-amber-500"}),iconBg:"bg-gradient-to-br from-amber-100 to-orange-100 dark:from-amber-900/30 dark:to-orange-900/30",label:"Creator werden",description:ne?"Du bist bereits Creator ":"Verdiene Geld mit deinem Content",badge:ne?"AKTIV":"NEU",onClick:()=>t("/creator-application")}),c.jsxs("div",{className:"p-4",children:[c.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[c.jsx("div",{className:"w-11 h-11 rounded-2xl bg-gradient-to-br from-pink-100 to-purple-100 dark:from-pink-900/30 dark:to-purple-900/30 flex items-center justify-center",children:c.jsx(_o,{size:20,className:"text-pink-500"})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:"Einladungssystem"}),c.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Lade Freunde ein & erhalte Rewards"})]})]}),c.jsxs("div",{className:"bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-2xl p-4 border border-purple-200/50 dark:border-purple-700/30",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"Dein Code"}),c.jsx("span",{className:"text-[10px] px-2 py-0.5 bg-purple-500/20 text-purple-600 rounded-full font-semibold",children:" 7 Tage Premium pro Einladung"})]}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"flex-1 bg-white dark:bg-gray-800 rounded-xl px-4 py-3 font-mono text-lg font-bold text-purple-600 dark:text-purple-400 tracking-wider",children:q}),c.jsx("button",{onClick:J,className:`w-12 h-12 rounded-xl flex items-center justify-center transition-all ${H?"bg-green-500 text-white":"bg-purple-500 text-white hover:bg-purple-600"}`,children:H?c.jsx(_r,{size:20}):c.jsx(bW,{size:20})})]})]}),c.jsxs("div",{className:"flex gap-2 mt-3",children:[c.jsxs("button",{onClick:()=>t("/invites"),className:"flex-1 py-2.5 px-4 rounded-xl bg-purple-500 text-white text-sm font-semibold flex items-center justify-center gap-2 hover:bg-purple-600 transition-colors",children:[c.jsx(op,{size:16}),"Einladen"]}),c.jsxs("button",{onClick:()=>t("/referral-status"),className:"flex-1 py-2.5 px-4 rounded-xl bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 text-sm font-semibold flex items-center justify-center gap-2 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",children:[c.jsx(cr,{size:16}),"Status"]})]})]})]})}),c.jsx(qy,{children:c.jsxs("div",{className:"divide-y divide-gray-100/50 dark:divide-gray-800/50",children:[c.jsxs("div",{className:"p-4",children:[c.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[c.jsx("div",{className:"w-11 h-11 rounded-2xl bg-gradient-to-br from-violet-100 to-purple-100 dark:from-violet-900/30 dark:to-purple-900/30 flex items-center justify-center",children:v==="nobody"?c.jsx(lp,{size:20,className:"text-violet-500"}):c.jsx(Pl,{size:20,className:"text-violet-500"})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:"Sichtbarkeit"}),c.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Wer kann dich im Radar sehen?"})]})]}),c.jsx("div",{className:"flex gap-2",children:[{key:"everyone",label:"Alle",icon:Mv},{key:"friends",label:"Freunde",icon:cr},{key:"nobody",label:"Niemand",icon:lp}].map(ce=>{const de=ce.icon,pe=v===ce.key;return c.jsxs("button",{onClick:()=>{w(ce.key),he("visibility",ce.key),"vibrate"in navigator&&navigator.vibrate(10)},className:`flex-1 py-2.5 px-3 rounded-xl text-sm font-medium flex items-center justify-center gap-2 transition-all ${pe?"bg-purple-500 text-white shadow-lg shadow-purple-500/30":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:[c.jsx(de,{size:16}),ce.label]},ce.key)})})]}),c.jsxs("div",{children:[c.jsx(Ku,{icon:c.jsx(Tpe,{size:20,className:"text-cyan-500"}),iconBg:"bg-gradient-to-br from-cyan-100 to-blue-100 dark:from-cyan-900/30 dark:to-blue-900/30",label:"Friend Radar",description:"Entdecke synclulu-User in deiner Nhe",toggle:!0,isOn:l,onToggle:m}),c.jsx(Cze,{value:u,onChange:p,disabled:!l})]})]})}),c.jsx(qy,{children:c.jsxs("div",{className:"divide-y divide-gray-100/50 dark:divide-gray-800/50",children:[c.jsx(Ku,{icon:c.jsx(kl,{size:20,className:"text-rose-500"}),iconBg:"bg-gradient-to-br from-rose-100 to-pink-100 dark:from-rose-900/30 dark:to-pink-900/30",label:"Push-Benachrichtigungen",description:"Erhalte Updates zu Matches & Messages",toggle:!0,isOn:R,onToggle:ce=>{C(ce),he("notifications",ce)}}),c.jsx(Ku,{icon:c.jsx(WL,{size:20,className:"text-emerald-500"}),iconBg:"bg-gradient-to-br from-emerald-100 to-green-100 dark:from-emerald-900/30 dark:to-green-900/30",label:"Sound-Effekte",description:"Tne bei Aktionen & Benachrichtigungen",toggle:!0,isOn:A,onToggle:ce=>{O(ce),he("soundEnabled",ce)}}),c.jsx(Ku,{icon:U?c.jsx(I5e,{size:20,className:"text-indigo-500"}):c.jsx(U5e,{size:20,className:"text-amber-500"}),iconBg:U?"bg-gradient-to-br from-indigo-100 to-violet-100 dark:from-indigo-900/30 dark:to-violet-900/30":"bg-gradient-to-br from-amber-100 to-yellow-100 dark:from-amber-900/30 dark:to-yellow-900/30",label:"Dark Mode",description:"Dunkles Erscheinungsbild aktivieren",toggle:!0,isOn:U,onToggle:ce=>{F(ce),he("darkMode",ce),document.documentElement.classList.toggle("dark",ce)}})]})}),c.jsx(qy,{children:c.jsxs("div",{className:"divide-y divide-gray-100/50 dark:divide-gray-800/50",children:[c.jsx(Ku,{icon:c.jsx(cs,{size:20,className:"text-blue-500"}),iconBg:"bg-gradient-to-br from-blue-100 to-cyan-100 dark:from-blue-900/30 dark:to-cyan-900/30",label:"Account & Sicherheit",description:"Passwort, Email, Zwei-Faktor",onClick:()=>t("/settings/security")}),c.jsx(Ku,{icon:c.jsx(yo,{size:20,className:"text-gray-500"}),iconBg:"bg-gradient-to-br from-gray-100 to-slate-100 dark:from-gray-800/50 dark:to-slate-800/50",label:"Blockierte Nutzer",description:"Verwalte blockierte Profile",onClick:()=>t("/settings/blocked")}),c.jsx(Ku,{icon:c.jsx(Rpe,{size:20,className:"text-purple-500"}),iconBg:"bg-gradient-to-br from-purple-100 to-fuchsia-100 dark:from-purple-900/30 dark:to-fuchsia-900/30",label:"Verknpfte Gerte",description:"Aktive Sessions verwalten",onClick:()=>t("/settings/devices")})]})}),c.jsx(qy,{children:c.jsxs("div",{className:"divide-y divide-gray-100/50 dark:divide-gray-800/50",children:[c.jsx(Ku,{icon:c.jsx(gI,{size:20,className:"text-teal-500"}),iconBg:"bg-gradient-to-br from-teal-100 to-cyan-100 dark:from-teal-900/30 dark:to-cyan-900/30",label:"Hilfe & Support",description:"FAQ, Kontakt, Bug melden",onClick:()=>t("/help")}),c.jsx(Ku,{icon:c.jsx(Ji,{size:20,className:"text-yellow-500"}),iconBg:"bg-gradient-to-br from-yellow-100 to-amber-100 dark:from-yellow-900/30 dark:to-amber-900/30",label:"App bewerten",description:"Hilf uns mit einer Bewertung",onClick:()=>window.open("https://apps.apple.com/app/synclulu","_blank")}),c.jsx(Ku,{icon:c.jsx(AN,{size:20,className:"text-gray-500"}),iconBg:"bg-gradient-to-br from-gray-100 to-slate-100 dark:from-gray-800/50 dark:to-slate-800/50",label:"Rechtliches",description:"Impressum, Datenschutz, AGB",onClick:()=>t("/legal")})]})}),c.jsx(qy,{children:c.jsx(Ku,{icon:c.jsx(zL,{size:20,className:"text-red-500"}),iconBg:"bg-red-100 dark:bg-red-900/30",label:"Abmelden",description:"Von diesem Gert abmelden",onClick:Q,danger:!0})}),c.jsxs("div",{className:"text-center py-6",children:[c.jsx("p",{className:"text-xs text-gray-400",children:"synclulu v1.5.0  Made with  in Germany"}),c.jsx("p",{className:"text-[10px] text-gray-300 mt-1",children:"Build 2024.01.15"})]})]})]})},bB=[{category:"allgemein",question:"Was ist synclulu?",answer:'synclulu ist eine hyperlocal Community-App, die Menschen in deiner Nhe per Voice-Chat verbindet. Tauche in die "Wolke" ein und triff neue Leute spontan und unkompliziert.'},{category:"allgemein",question:"Wie funktioniert die Wolke?",answer:"Die Wolke zeigt dir Rume mit aktiven Usern in deiner Umgebung. Tippe einfach auf die groe Wolke auf der Home-Seite, und du wirst automatisch mit jemandem verbunden, der gerade online ist."},{category:"allgemein",question:"Ist synclulu kostenlos?",answer:"Ja! Die Grundfunktionen sind komplett kostenlos. Mit Catalyst Premium bekommst du zustzliche Features wie 1.5x XP, unbegrenzte Sterne und die Mglichkeit zu sehen, wer dein Profil besucht hat."},{category:"voice",question:"Wie starte ich einen Voice-Chat?",answer:"Gehe auf die Home-Seite und tippe auf die Wolke. Du wirst gefragt, ob du anonym oder ffentlich beitreten mchtest. Danach wirst du mit einem aktiven Raum verbunden."},{category:"voice",question:"Warum bin ich am Anfang stumm geschaltet?",answer:"Neue Teilnehmer haben eine kurze Redepause von 4 Sekunden. Das gibt dir Zeit, erst mal zuzuhren und den Kontext des Gesprchs zu verstehen, bevor du dich einbringst."},{category:"voice",question:"Kann ich aus einem Raum rausgeworfen werden?",answer:"Einzelne Personen knnen dich nicht kicken. Bei schlechtem Verhalten knnen andere User jedoch eine Abstimmung starten, um dich aus dem Raum zu entfernen."},{category:"sicherheit",question:"Was ist der Anonym-Modus?",answer:'Im Anonym-Modus wird dein Profilbild verschwommen angezeigt und du erscheinst unter einem zuflligen Alias wie "Wanderer_4821". Dein echter Username bleibt verborgen.'},{category:"sicherheit",question:"Wie blockiere ich jemanden?",answer:"Gehe zu Einstellungen  Blockierte User. Dort kannst du User blockieren und auch den Grund angeben (Belstigung, Spam, etc.). Blockierte User knnen dich nicht mehr sehen oder kontaktieren."},{category:"sicherheit",question:"Werden meine Gesprche aufgezeichnet?",answer:"Nein. Voice-Chats werden nicht aufgezeichnet oder gespeichert. Alle Gesprche sind live und ephemer - sobald du den Raum verlsst, sind sie weg."},{category:"xp",question:"Wie verdiene ich XP?",answer:"Du verdienst XP durch: Voice-Chats (pro Minute), Sterne erhalten (15 XP pro Stern), tgliche Logins (Streak-Bonus), und regionale Events (bis zu 3x XP in bestimmten Zonen)."},{category:"xp",question:"Was bringt mir ein hheres Level?",answer:'Mit jedem Level steigt dein Ansehen in der Community. Hhere Level bekommen spezielle Titel (z.B. "Socialite" ab Level 31), vergrerte Trust-Badges und Zugang zu exklusiven Features.'},{category:"xp",question:"Was sind Sterne und wie funktionieren sie?",answer:"Sterne sind virtuelle Geschenke, die du anderen Usern geben kannst. Jeder Stern ist 15 XP wert. Free User knnen 3 Sterne pro Tag verschenken, Premium User unbegrenzt viele."},{category:"freunde",question:"Wie fge ich Freunde hinzu?",answer:'Sende eine Freundschaftsanfrage ber das Profil eines Users. Freundschaft in synclulu funktioniert nach dem "Handshake"-Prinzip - beide mssen besttigen.'},{category:"freunde",question:"Was ist der Unterschied zwischen Folgen und Freundschaft?",answer:"Folgen ist einseitig (wie auf Twitter) - du siehst Updates von jemandem. Freundschaft ist gegenseitig und schaltet zustzliche Features wie Direktnachrichten frei."},{category:"freunde",question:"Mit wem kann ich chatten?",answer:"Du kannst nur mit Freunden oder Usern chatten, die du bereits in der App getroffen hast. Das schtzt vor unerwnschten Nachrichten von Fremden."}],Ize=[{id:"allgemein",label:"Allgemein",icon:gI},{id:"voice",label:"Voice Chat",icon:Qo},{id:"sicherheit",label:"Sicherheit",icon:cs},{id:"xp",label:"XP & Level",icon:Ji},{id:"freunde",label:"Freundschaften",icon:cr}],Aze=()=>{const t=yr(),[e,r]=V.useState(null),[a,l]=V.useState(null),[u,p]=V.useState(""),m=u?bB.filter(w=>w.question.toLowerCase().includes(u.toLowerCase())||w.answer.toLowerCase().includes(u.toLowerCase())):e?bB.filter(w=>w.category===e):bB,v=w=>{l(a===w?null:w)};return c.jsxs("div",{className:"min-h-screen bg-[var(--synclulu-bg)] safe-top safe-bottom pb-24 theme-transition",children:[c.jsx("div",{className:"fixed inset-0 pointer-events-none",children:c.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-[var(--synclulu-accent)]/5 via-transparent to-transparent"})}),c.jsxs("div",{className:"sticky top-0 z-20 glass-nav border-b border-[var(--synclulu-border)]",children:[c.jsxs("div",{className:"px-6 py-4 flex items-center gap-4",children:[c.jsx(Ne.button,{whileTap:{scale:.95},onClick:()=>t(-1),className:"w-10 h-10 rounded-xl bg-[var(--synclulu-card)] flex items-center justify-center text-[var(--synclulu-muted)] hover:text-[var(--synclulu-text)] transition-colors shadow-sm",children:c.jsx(Eo,{size:20})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h1",{className:"font-display text-xl font-bold text-[var(--synclulu-text)]",children:"Hilfe & FAQ"}),c.jsx("p",{className:"text-xs text-[var(--synclulu-muted)]",children:"Finde Antworten auf deine Fragen"})]})]}),c.jsx("div",{className:"px-6 pb-4",children:c.jsxs("div",{className:"relative",children:[c.jsx(xw,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-[var(--synclulu-muted)]"}),c.jsx("input",{type:"text",value:u,onChange:w=>p(w.target.value),placeholder:"Suche in den FAQ...",className:"w-full pl-11 pr-4 py-3 bg-[var(--synclulu-card)] border border-[var(--synclulu-border)] rounded-xl text-sm text-[var(--synclulu-text)] placeholder-[var(--synclulu-muted)] focus:outline-none focus:ring-2 focus:ring-[var(--synclulu-accent)]/30"})]})})]}),c.jsx(Ur,{children:!u&&c.jsx(Ne.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"px-6 py-4",children:c.jsxs("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide pb-2",children:[c.jsx("button",{onClick:()=>r(null),className:`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-semibold whitespace-nowrap transition-all ${e?"bg-[var(--synclulu-card)] text-[var(--synclulu-muted)] hover:text-[var(--synclulu-text)] border border-[var(--synclulu-border)]":"bg-[var(--synclulu-accent)] text-white shadow-lg"}`,children:"Alle"}),Ize.map(w=>c.jsxs("button",{onClick:()=>r(w.id),className:`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-semibold whitespace-nowrap transition-all ${e===w.id?"bg-[var(--synclulu-accent)] text-white shadow-lg":"bg-[var(--synclulu-card)] text-[var(--synclulu-muted)] hover:text-[var(--synclulu-text)] border border-[var(--synclulu-border)]"}`,children:[c.jsx(w.icon,{size:16}),w.label]},w.id))]})})}),c.jsx(Ne.div,{initial:{opacity:0},animate:{opacity:1},className:"px-6 space-y-3",children:m.length===0?c.jsxs("div",{className:"text-center py-12",children:[c.jsx(gI,{size:48,className:"mx-auto text-[var(--synclulu-muted)] opacity-30 mb-4"}),c.jsx("p",{className:"text-[var(--synclulu-muted)]",children:"Keine Ergebnisse gefunden"})]}):m.map((w,R)=>c.jsxs(Ne.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:R*.03},className:"bg-[var(--synclulu-card)] rounded-2xl shadow-sm overflow-hidden border border-[var(--synclulu-border)]",children:[c.jsxs("button",{onClick:()=>v(w.question),className:"w-full flex items-center justify-between p-4 text-left",children:[c.jsx("span",{className:"font-semibold text-[var(--synclulu-text)] pr-4",children:w.question}),a===w.question?c.jsx(xW,{size:20,className:"text-[var(--synclulu-accent)] flex-shrink-0"}):c.jsx(Fi,{size:20,className:"text-[var(--synclulu-muted)] flex-shrink-0"})]}),c.jsx(Ur,{children:a===w.question&&c.jsx(Ne.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:c.jsx("div",{className:"px-4 pb-4 pt-0",children:c.jsx("div",{className:"bg-[var(--synclulu-bg)] rounded-xl p-4 border border-[var(--synclulu-border)]",children:c.jsx("p",{className:"text-sm text-[var(--synclulu-text)] leading-relaxed",children:w.answer})})})})})]},R))}),c.jsx("div",{className:"px-6 py-8",children:c.jsxs("div",{className:"bg-gradient-to-br from-[var(--synclulu-accent)]/10 to-[var(--synclulu-accent)]/5 rounded-2xl p-6 text-center border border-[var(--synclulu-accent)]/20",children:[c.jsx(hp,{size:32,className:"mx-auto text-[var(--synclulu-accent)] mb-3"}),c.jsx("h3",{className:"font-display font-bold text-[var(--synclulu-text)] mb-2",children:"Noch Fragen?"}),c.jsx("p",{className:"text-sm text-[var(--synclulu-muted)] mb-4",children:"Unser Support-Team hilft dir gerne weiter"}),c.jsxs("div",{className:"flex flex-col gap-3",children:[c.jsxs("a",{href:"mailto:support@synclulu.app",className:"flex items-center justify-center gap-2 py-3 px-4 bg-[var(--synclulu-accent)] text-white rounded-xl font-semibold hover:opacity-90 transition-opacity",children:[c.jsx(c0,{size:18}),"E-Mail schreiben"]}),c.jsxs("a",{href:"https://synclulu.app/help",target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 py-3 px-4 bg-[var(--synclulu-card)] text-[var(--synclulu-text)] rounded-xl font-semibold hover:opacity-90 transition-opacity border border-[var(--synclulu-border)]",children:[c.jsx(E5e,{size:18}),"Hilfe-Center besuchen"]})]})]})}),c.jsx("div",{className:"px-6 pb-8",children:c.jsxs("div",{className:"flex justify-center gap-6 text-xs text-[var(--synclulu-muted)]",children:[c.jsx("button",{onClick:()=>t("/privacy"),className:"hover:text-[var(--synclulu-accent)] transition-colors",children:"Datenschutz"}),c.jsx("button",{onClick:()=>t("/terms"),className:"hover:text-[var(--synclulu-accent)] transition-colors",children:"AGB"}),c.jsx("button",{onClick:()=>t("/imprint"),className:"hover:text-[var(--synclulu-accent)] transition-colors",children:"Impressum"})]})})]})},oae=()=>{const t=yr(),[e]=Dw(),{user:r}=Jr(),a=(r==null?void 0:r.totalStarsReceived)||0,l=(r==null?void 0:r.level)||1,u=(r==null?void 0:r.totalVoiceMinutes)||0,p=(r==null?void 0:r.positiveRatings)||0,m=(r==null?void 0:r.totalRatings)||1,v=Math.round(p/m*100),w=V.useMemo(()=>a>=B2.starsRequired&&l>=B2.levelRequired&&u>=B2.voiceMinutesRequired&&v>=B2.minPositiveRatings,[a,l,u,v]),R=e.get("path"),[C,A]=V.useState(R==="community"&&w?"community":"vip"),[O,U]=V.useState("intro"),[F,q]=V.useState(!1),[W,H]=V.useState(C==="community"?"creator":null),[X,ne]=V.useState(""),[te,he]=V.useState(""),[J,Q]=V.useState([]),[ce,de]=V.useState([]),pe=()=>c.jsxs("div",{className:"text-center px-4",children:[w&&c.jsxs("div",{className:"mb-6 p-1 bg-gray-800/50 rounded-xl flex",children:[c.jsx("button",{onClick:()=>A("vip"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${C==="vip"?"bg-purple-500 text-white":"text-gray-400 hover:text-white"}`,children:"VIP / Influencer"}),c.jsx("button",{onClick:()=>{A("community"),H("creator")},className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${C==="community"?"bg-green-500 text-white":"text-gray-400 hover:text-white"}`,children:"Community Creator"})]}),c.jsxs("div",{className:"relative w-32 h-32 mx-auto mb-8",children:[c.jsx("div",{className:`absolute inset-0 rounded-full animate-pulse ${C==="community"?"bg-gradient-to-br from-green-500/30 to-emerald-500/30":"bg-gradient-to-br from-purple-500/30 to-pink-500/30"}`}),c.jsx("div",{className:`absolute inset-2 rounded-full flex items-center justify-center ${C==="community"?"bg-gradient-to-br from-green-600 to-emerald-600":"bg-gradient-to-br from-purple-600 to-pink-600"}`,children:C==="community"?c.jsx(gv,{size:48,className:"text-white"}):c.jsx(kn,{size:48,className:"text-white"})}),[...Array(4)].map((vt,zt)=>c.jsx("div",{className:`absolute w-3 h-3 rounded-full ${C==="community"?"bg-green-400":"bg-yellow-400"}`,style:{top:"50%",left:"50%",transform:`rotate(${zt*90}deg) translateX(60px) translateY(-50%)`,animation:`orbit 4s linear infinite ${zt*.25}s`}},zt))]}),c.jsx("h1",{className:"text-3xl font-bold text-white mb-3",children:C==="community"?"Community Creator":"Stars Programm"}),c.jsx("p",{className:"text-gray-400 mb-8 max-w-sm mx-auto",children:C==="community"?c.jsx(c.Fragment,{children:"Du hast dich durch dein Engagement qualifiziert! Werde jetzt offizieller Community Creator."}):c.jsx(c.Fragment,{children:"Exklusiv fr Persnlichkeiten des ffentlichen Lebens. Erhalte das Nebula Badge und erweiterte Features."})}),C==="community"&&c.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-6 max-w-sm mx-auto",children:[c.jsxs("div",{className:"bg-green-500/10 border border-green-500/30 rounded-xl p-3",children:[c.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[c.jsx(Ji,{size:14,className:"text-amber-400"}),c.jsx("span",{className:"text-lg font-bold text-white",children:a})]}),c.jsx("p",{className:"text-[10px] text-gray-400",children:"Sterne erhalten"})]}),c.jsxs("div",{className:"bg-green-500/10 border border-green-500/30 rounded-xl p-3",children:[c.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[c.jsx(Qo,{size:14,className:"text-blue-400"}),c.jsx("span",{className:"text-lg font-bold text-white",children:u})]}),c.jsx("p",{className:"text-[10px] text-gray-400",children:"Voice-Minuten"})]}),c.jsxs("div",{className:"bg-green-500/10 border border-green-500/30 rounded-xl p-3",children:[c.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[c.jsx(cr,{size:14,className:"text-purple-400"}),c.jsxs("span",{className:"text-lg font-bold text-white",children:["Lvl ",l]})]}),c.jsx("p",{className:"text-[10px] text-gray-400",children:"Dein Level"})]}),c.jsxs("div",{className:"bg-green-500/10 border border-green-500/30 rounded-xl p-3",children:[c.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[c.jsx(Sm,{size:14,className:"text-green-400"}),c.jsxs("span",{className:"text-lg font-bold text-white",children:[v,"%"]})]}),c.jsx("p",{className:"text-[10px] text-gray-400",children:"Positive Ratings"})]})]}),c.jsx("div",{className:"space-y-3 mb-8 text-left max-w-sm mx-auto",children:(C==="community"?[{icon:"",text:"Community Creator Badge"},{icon:"",text:"Voice-Rume hosten"},{icon:"",text:"Events planen & ankndigen"},{icon:"",text:"Analytics Dashboard"},{icon:"",text:"Schnelle Verifizierung"}]:[{icon:"",text:"Verifiziertes Nebula Badge"},{icon:"",text:"Erweiterte Moderationsrechte"},{icon:"",text:"Detaillierte Analytics"},{icon:"",text:"Priorisierte Sichtbarkeit"},{icon:"",text:"Voice Lift Feature"}]).map((vt,zt)=>c.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-xl ${C==="community"?"bg-green-900/30 border border-green-500/20":"bg-gray-800/50"}`,children:[c.jsx("span",{className:"text-xl",children:vt.icon}),c.jsx("span",{className:"text-gray-300",children:vt.text})]},zt))}),c.jsx("button",{onClick:()=>U(C==="community"?"social":"category"),className:`w-full py-4 rounded-xl text-white font-semibold text-lg hover:opacity-90 transition-opacity ${C==="community"?"bg-gradient-to-r from-green-500 to-emerald-500":"bg-gradient-to-r from-purple-500 to-pink-500"}`,children:C==="community"?"Weiter zur Bewerbung":"Jetzt bewerben"}),C==="community"&&c.jsxs("p",{className:"text-xs text-green-400 mt-4 flex items-center justify-center gap-1",children:[c.jsx(Sm,{size:12}),"Du erfllst alle Voraussetzungen!"]}),c.jsx("p",{className:"text-xs text-gray-500 mt-4",children:"Deine Daten werden vertraulich behandelt und nur zur Verifizierung verwendet."}),c.jsx("style",{children:`
        @keyframes orbit {
          from { transform: rotate(0deg) translateX(60px) rotate(0deg); }
          to { transform: rotate(360deg) translateX(60px) rotate(-360deg); }
        }
      `})]}),be=[{value:"influencer",label:"Influencer",emoji:"",desc:"Social Media Creator"},{value:"entrepreneur",label:"Unternehmer",emoji:"",desc:"Grnder & Business"},{value:"artist",label:"Knstler",emoji:"",desc:"Bildende Kunst"},{value:"musician",label:"Musiker",emoji:"",desc:"Musik & Audio"},{value:"athlete",label:"Sportler",emoji:"",desc:"Profisport"},{value:"actor",label:"Schauspieler",emoji:"",desc:"Film & Theater"},{value:"creator",label:"Creator",emoji:"",desc:"Content Creator"},{value:"journalist",label:"Journalist",emoji:"",desc:"Medien & Presse"},{value:"scientist",label:"Wissenschaftler",emoji:"",desc:"Forschung & Bildung"},{value:"other",label:"Andere",emoji:"",desc:"Persnlichkeit"}],ye=()=>c.jsxs("div",{className:"px-4",children:[c.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Whle deine Kategorie"}),c.jsx("p",{className:"text-gray-400 mb-6",children:"In welchem Bereich bist du aktiv?"}),c.jsx("div",{className:"grid grid-cols-2 gap-3 mb-6",children:be.map(vt=>c.jsxs("button",{onClick:()=>H(vt.value),className:`p-4 rounded-xl text-left transition-all ${W===vt.value?"bg-purple-500/20 border-2 border-purple-500":"bg-gray-800/50 border-2 border-transparent hover:border-gray-700"}`,children:[c.jsx("span",{className:"text-2xl mb-2 block",children:vt.emoji}),c.jsx("p",{className:"font-semibold text-white",children:vt.label}),c.jsx("p",{className:"text-xs text-gray-400",children:vt.desc})]},vt.value))}),c.jsxs("div",{className:"mb-6",children:[c.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Erzhl uns mehr ber dich"}),c.jsx("textarea",{value:X,onChange:vt=>ne(vt.target.value),placeholder:"Warum solltest du verifiziert werden? Was machst du?",className:"w-full p-4 bg-gray-800/50 rounded-xl text-white placeholder-gray-500 resize-none h-32 focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Geschtzte Follower-Anzahl (alle Plattformen)"}),c.jsx("input",{type:"number",value:te,onChange:vt=>he(vt.target.value),placeholder:"z.B. 50000",className:"w-full p-4 bg-gray-800/50 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),c.jsx("button",{onClick:()=>U("social"),disabled:!W||!X||!te,className:"w-full py-4 rounded-xl bg-gradient-to-r from-purple-500 to-pink-500 text-white font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:"Weiter"})]}),Ze=[{value:"instagram",label:"Instagram",icon:T5e,color:"#E4405F"},{value:"tiktok",label:"TikTok",icon:A5e,color:"#000000"},{value:"youtube",label:"YouTube",icon:X5e,color:"#FF0000"},{value:"twitter",label:"X / Twitter",icon:W5e,color:"#1DA1F2"},{value:"linkedin",label:"LinkedIn",icon:R5e,color:"#0A66C2"},{value:"other",label:"Andere",icon:Mv,color:"#6B7280"}],It=vt=>{J.find(zt=>zt.platform===vt)||Q([...J,{platform:vt,url:"",username:""}])},St=(vt,zt,ln)=>{Q(J.map(Pn=>Pn.platform===vt?{...Pn,[zt]:ln}:Pn))},lt=vt=>{Q(J.filter(zt=>zt.platform!==vt))},Le=()=>c.jsxs("div",{className:"px-4",children:[c.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Social Media Profile"}),c.jsx("p",{className:"text-gray-400 mb-6",children:"Verlinke deine verifizierten Profile"}),c.jsx("div",{className:"space-y-3 mb-6",children:J.map(vt=>{const zt=Ze.find(Pn=>Pn.value===vt.platform),ln=zt.icon;return c.jsxs("div",{className:"p-4 bg-gray-800/50 rounded-xl",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(ln,{size:20,style:{color:zt.color}}),c.jsx("span",{className:"font-medium text-white",children:zt.label})]}),c.jsx("button",{onClick:()=>lt(vt.platform),className:"p-1 text-gray-500 hover:text-red-400",children:c.jsx(Di,{size:18})})]}),c.jsx("input",{type:"text",value:vt.username,onChange:Pn=>St(vt.platform,"username",Pn.target.value),placeholder:"@username",className:"w-full p-3 bg-gray-900/50 rounded-lg text-white placeholder-gray-500 text-sm mb-2 focus:outline-none focus:ring-1 focus:ring-purple-500"}),c.jsx("input",{type:"url",value:vt.url,onChange:Pn=>St(vt.platform,"url",Pn.target.value),placeholder:"https://...",className:"w-full p-3 bg-gray-900/50 rounded-lg text-white placeholder-gray-500 text-sm focus:outline-none focus:ring-1 focus:ring-purple-500"})]},vt.platform)})}),c.jsx("p",{className:"text-sm text-gray-400 mb-3",children:"Plattform hinzufgen:"}),c.jsx("div",{className:"flex flex-wrap gap-2 mb-8",children:Ze.filter(vt=>!J.find(zt=>zt.platform===vt.value)).map(vt=>{const zt=vt.icon;return c.jsxs("button",{onClick:()=>It(vt.value),className:"flex items-center gap-2 px-3 py-2 bg-gray-800/50 rounded-lg text-gray-400 hover:text-white hover:bg-gray-700/50 transition-colors",children:[c.jsx(zt,{size:16}),c.jsx("span",{className:"text-sm",children:vt.label}),c.jsx(Ew,{size:14})]},vt.value)})}),c.jsx("button",{onClick:()=>U(C==="community"?"review":"documents"),disabled:J.length===0||J.some(vt=>!vt.url||!vt.username),className:`w-full py-4 rounded-xl text-white font-semibold disabled:opacity-50 disabled:cursor-not-allowed ${C==="community"?"bg-gradient-to-r from-green-500 to-emerald-500":"bg-gradient-to-r from-purple-500 to-pink-500"}`,children:C==="community"?"Zur berprfung":"Weiter"}),C==="community"&&c.jsxs("p",{className:"text-xs text-green-400 text-center mt-3 flex items-center justify-center gap-1",children:[c.jsx(Sm,{size:12}),"Keine Dokumente erforderlich - du bist bereits verifiziert durch dein Engagement!"]})]}),Me=vt=>{const zt=vt.target.files;zt&&de([...ce,...Array.from(zt)])},Ke=vt=>{de(ce.filter((zt,ln)=>ln!==vt))},Rt=()=>c.jsxs("div",{className:"px-4",children:[c.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Verifikations-Dokumente"}),c.jsx("p",{className:"text-gray-400 mb-6",children:"Hilf uns, deine Identitt zu besttigen. Alle Daten werden vertraulich behandelt."}),c.jsxs("div",{className:"p-4 bg-purple-500/10 border border-purple-500/30 rounded-xl mb-6",children:[c.jsx("p",{className:"text-sm text-purple-300 font-medium mb-2",children:"Akzeptierte Dokumente:"}),c.jsxs("ul",{className:"text-sm text-gray-400 space-y-1",children:[c.jsx("li",{children:" Screenshot deiner verifizierten Social Media Profile"}),c.jsx("li",{children:" Presseartikel oder Interviews ber dich"}),c.jsx("li",{children:" Visitenkarte oder Firmennachweis"}),c.jsx("li",{children:" Ausweisdokument (wird nach Prfung gelscht)"})]})]}),c.jsxs("label",{className:"block mb-4",children:[c.jsxs("div",{className:"border-2 border-dashed border-gray-700 rounded-xl p-8 text-center cursor-pointer hover:border-purple-500 transition-colors",children:[c.jsx(Cpe,{size:32,className:"mx-auto mb-3 text-gray-500"}),c.jsx("p",{className:"text-gray-400 mb-1",children:"Dokumente hochladen"}),c.jsx("p",{className:"text-xs text-gray-500",children:"PDF, JPG, PNG (max. 10MB)"})]}),c.jsx("input",{type:"file",accept:".pdf,.jpg,.jpeg,.png",multiple:!0,onChange:Me,className:"hidden"})]}),ce.length>0&&c.jsx("div",{className:"space-y-2 mb-6",children:ce.map((vt,zt)=>c.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-800/50 rounded-lg",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[vt.type.includes("pdf")?c.jsx(AN,{size:20,className:"text-red-400"}):c.jsx(vO,{size:20,className:"text-blue-400"}),c.jsx("span",{className:"text-sm text-gray-300 truncate max-w-[200px]",children:vt.name})]}),c.jsx("button",{onClick:()=>Ke(zt),className:"p-1 text-gray-500 hover:text-red-400",children:c.jsx(Di,{size:18})})]},zt))}),c.jsx("button",{onClick:()=>U("review"),disabled:ce.length===0,className:"w-full py-4 rounded-xl bg-gradient-to-r from-purple-500 to-pink-500 text-white font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:"Weiter zur berprfung"})]}),rt=async()=>{q(!0),await new Promise(vt=>setTimeout(vt,2e3)),q(!1),U("submitted")},mt=()=>{var vt,zt;return c.jsxs("div",{className:"px-4",children:[C==="community"&&c.jsxs("div",{className:"mb-4 p-3 bg-green-500/10 border border-green-500/30 rounded-xl flex items-center gap-3",children:[c.jsx(gv,{className:"text-green-400",size:24}),c.jsxs("div",{children:[c.jsx("p",{className:"text-green-400 font-medium text-sm",children:"Community Creator Bewerbung"}),c.jsx("p",{className:"text-gray-400 text-xs",children:"Schnelle Verifizierung durch Engagement"})]})]}),c.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"berprfe deine Angaben"}),c.jsx("p",{className:"text-gray-400 mb-6",children:"Stelle sicher, dass alles korrekt ist."}),c.jsxs("div",{className:"space-y-4 mb-8",children:[c.jsxs("div",{className:`p-4 rounded-xl ${C==="community"?"bg-green-900/30 border border-green-500/20":"bg-gray-800/50"}`,children:[c.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Kategorie"}),c.jsxs("p",{className:"text-white font-medium",children:[(vt=be.find(ln=>ln.value===W))==null?void 0:vt.emoji," ",(zt=be.find(ln=>ln.value===W))==null?void 0:zt.label]})]}),X&&c.jsxs("div",{className:`p-4 rounded-xl ${C==="community"?"bg-green-900/30 border border-green-500/20":"bg-gray-800/50"}`,children:[c.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Beschreibung"}),c.jsx("p",{className:"text-gray-300 text-sm",children:X})]}),C!=="community"&&te&&c.jsxs("div",{className:"p-4 bg-gray-800/50 rounded-xl",children:[c.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Follower"}),c.jsx("p",{className:"text-white font-medium",children:parseInt(te).toLocaleString()})]}),C==="community"&&c.jsxs("div",{className:"p-4 bg-green-900/30 border border-green-500/20 rounded-xl",children:[c.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Deine Community-Statistiken"}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ji,{size:14,className:"text-amber-400"}),c.jsxs("span",{className:"text-sm text-gray-300",children:[a," Sterne"]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Qo,{size:14,className:"text-blue-400"}),c.jsxs("span",{className:"text-sm text-gray-300",children:[u," Min"]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(cr,{size:14,className:"text-purple-400"}),c.jsxs("span",{className:"text-sm text-gray-300",children:["Level ",l]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Sm,{size:14,className:"text-green-400"}),c.jsxs("span",{className:"text-sm text-gray-300",children:[v,"% Positiv"]})]})]})]}),c.jsxs("div",{className:`p-4 rounded-xl ${C==="community"?"bg-green-900/30 border border-green-500/20":"bg-gray-800/50"}`,children:[c.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Social Media"}),c.jsx("div",{className:"space-y-2",children:J.map(ln=>{const Pn=Ze.find(pr=>pr.value===ln.platform),ni=Pn.icon;return c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(ni,{size:16,style:{color:Pn.color}}),c.jsxs("span",{className:"text-sm text-gray-300",children:["@",ln.username]})]},ln.platform)})})]}),C!=="community"&&c.jsxs("div",{className:"p-4 bg-gray-800/50 rounded-xl",children:[c.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Dokumente"}),c.jsxs("p",{className:"text-gray-300 text-sm",children:[ce.length," Datei(en) hochgeladen"]})]})]}),c.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"Mit dem Absenden besttigst du, dass alle Angaben wahrheitsgem sind und du unseren Nutzungsbedingungen zustimmst."}),c.jsx("button",{onClick:rt,disabled:F,className:`w-full py-4 rounded-xl text-white font-semibold disabled:opacity-50 flex items-center justify-center gap-2 ${C==="community"?"bg-gradient-to-r from-green-500 to-emerald-500":"bg-gradient-to-r from-purple-500 to-pink-500"}`,children:F?c.jsxs(c.Fragment,{children:[c.jsx(fi,{size:20,className:"animate-spin"}),"Wird eingereicht..."]}):"Bewerbung einreichen"})]})},yt=()=>c.jsxs("div",{className:"px-4 text-center",children:[c.jsx("div",{className:"w-24 h-24 mx-auto mb-6 rounded-full flex items-center justify-center bg-green-500/20",children:C==="community"?c.jsx(gv,{size:48,className:"text-green-400"}):c.jsx(Sm,{size:48,className:"text-green-400"})}),c.jsx("h2",{className:"text-2xl font-bold text-white mb-3",children:C==="community"?"Community Creator Bewerbung eingereicht!":"Bewerbung eingereicht!"}),c.jsx("p",{className:"text-gray-400 mb-8",children:C==="community"?c.jsx(c.Fragment,{children:"Deine Bewerbung wird bevorzugt behandelt! Du erhltst innerhalb von 24 Stunden eine Antwort."}):c.jsx(c.Fragment,{children:"Unser Team wird deine Bewerbung innerhalb von 2-5 Werktagen prfen. Du erhltst eine Benachrichtigung, sobald eine Entscheidung getroffen wurde."})}),c.jsx("div",{className:`p-4 rounded-xl mb-8 ${C==="community"?"bg-green-500/10 border border-green-500/30":"bg-amber-500/10 border border-amber-500/30"}`,children:c.jsxs("div",{className:"flex items-center gap-3",children:[C==="community"?c.jsx(Sm,{size:20,className:"text-green-400"}):c.jsx(mI,{size:20,className:"text-amber-400"}),c.jsxs("div",{className:"text-left",children:[c.jsx("p",{className:`text-sm font-medium ${C==="community"?"text-green-300":"text-amber-300"}`,children:C==="community"?"Status: Bevorzugte Prfung":"Status: In Prfung"}),c.jsxs("p",{className:"text-xs text-gray-400",children:["Eingereicht am ",new Date().toLocaleDateString("de-DE")]})]})]})}),c.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"So wird dein Badge aussehen:"}),c.jsx("div",{className:"flex justify-center mb-8",children:c.jsx("div",{className:`flex items-center gap-3 px-4 py-3 rounded-xl ${C==="community"?"bg-green-900/30 border border-green-500/20":"bg-gray-800/50"}`,children:c.jsx(jN,{tier:"nebula",size:"lg",showLabel:!0})})}),c.jsx("button",{onClick:()=>t("/"),className:`w-full py-4 rounded-xl text-white font-semibold transition-colors ${C==="community"?"bg-gradient-to-r from-green-500 to-emerald-500 hover:opacity-90":"bg-gray-800 hover:bg-gray-700"}`,children:"Zurck zur App"})]}),Ct=()=>{switch(O){case"intro":return pe();case"category":return ye();case"social":return Le();case"documents":return Rt();case"review":return mt();case"submitted":return yt()}},Ot=()=>{const vt=["intro","category","social","documents","review","submitted"];return(vt.indexOf(O)+1)/vt.length*100};return c.jsxs("div",{className:"min-h-screen bg-gray-950 pb-8",children:[c.jsxs("div",{className:"sticky top-0 z-10 bg-gray-950/95 backdrop-blur-sm border-b border-gray-800",children:[c.jsxs("div",{className:"flex items-center justify-between p-4",children:[c.jsx("button",{onClick:()=>{if(O==="intro"||O==="submitted")t(-1);else{const vt=["intro","category","social","documents","review"],zt=vt.indexOf(O);zt>0&&U(vt[zt-1])}},className:"p-2 -m-2 text-gray-400 hover:text-white",children:c.jsx(Eo,{size:24})}),c.jsx("span",{className:"text-sm text-gray-500",children:O!=="intro"&&O!=="submitted"&&`Schritt ${["category","social","documents","review"].indexOf(O)+1}/4`}),c.jsx("div",{className:"w-8"})]}),O!=="intro"&&O!=="submitted"&&c.jsx("div",{className:"h-1 bg-gray-800",children:c.jsx("div",{className:"h-full bg-gradient-to-r from-purple-500 to-pink-500 transition-all duration-300",style:{width:`${Ot()}%`}})})]}),c.jsx("div",{className:"pt-6",children:Ct()})]})},kze=()=>{const t=yr(),{starProfile:e,user:r,isVerifiedStar:a}=Jr(),[l,u]=V.useState("week");if(!(a&&e&&e.verifiedAt))return c.jsxs("div",{className:"min-h-screen bg-gray-950 pb-24",children:[c.jsx("div",{className:"sticky top-0 z-10 bg-gray-950/95 backdrop-blur-sm border-b border-gray-800",children:c.jsxs("div",{className:"flex items-center justify-between p-4",children:[c.jsx("button",{onClick:()=>t(-1),className:"p-2 -m-2 text-gray-400 hover:text-white",children:c.jsx(Eo,{size:24})}),c.jsx("h1",{className:"text-lg font-bold text-white",children:"Stars Dashboard"}),c.jsx("div",{className:"w-10"})]})}),c.jsxs("div",{className:"p-6 flex flex-col items-center justify-center min-h-[60vh]",children:[c.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-purple-500/20 to-pink-500/20 rounded-full flex items-center justify-center mb-6 border border-purple-500/30",children:c.jsx(as,{size:48,className:"text-purple-400"})}),c.jsx("h2",{className:"text-2xl font-bold text-white mb-3 text-center",children:"Verifizierung erforderlich"}),c.jsx("p",{className:"text-gray-400 text-center mb-8 max-w-sm",children:"Um das Stars Dashboard nutzen zu knnen, musst du dich erst als Creator verifizieren lassen. Nach erfolgreicher Prfung erhltst du Zugang zu allen Star-Features."}),c.jsxs("div",{className:"w-full max-w-sm space-y-4",children:[c.jsxs("button",{onClick:()=>t("/stars/apply"),className:"w-full py-4 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl text-white font-semibold flex items-center justify-center gap-2",children:[c.jsx(kn,{size:20}),"Als Creator bewerben"]}),c.jsx("button",{onClick:()=>t("/settings"),className:"w-full py-3 bg-gray-800/50 rounded-xl text-gray-400 font-medium border border-gray-700",children:"Zurck zu Einstellungen"})]}),c.jsxs("div",{className:"mt-8 p-4 bg-purple-500/10 rounded-xl border border-purple-500/30 max-w-sm",children:[c.jsxs("h3",{className:"font-semibold text-purple-300 mb-2 flex items-center gap-2",children:[c.jsx(fd,{size:16}),"Wie werde ich Creator?"]}),c.jsxs("ul",{className:"text-sm text-gray-400 space-y-1",children:[c.jsx("li",{children:" Erflle die Mindestanforderungen"}),c.jsx("li",{children:" Reiche deine Bewerbung ein"}),c.jsx("li",{children:" Warte auf die Prfung durch unser Team"}),c.jsx("li",{children:" Nach Freischaltung: Voller Zugang!"})]})]})]})]});const m={userId:(r==null?void 0:r.id)||"",totalListeners:(e==null?void 0:e.totalListeners)||0,uniqueListeners:(e==null?void 0:e.uniqueListeners)||0,averageListenDuration:(e==null?void 0:e.averageListenDuration)||0,peakConcurrentListeners:(e==null?void 0:e.peakConcurrentListeners)||0,totalStarsReceived:(e==null?void 0:e.totalStarsReceived)||0,starsValue:((e==null?void 0:e.totalStarsReceived)||0)*.1,totalChatMessages:(e==null?void 0:e.totalChatMessages)||0,averageEngagementRate:(e==null?void 0:e.averageEngagementRate)||0,eventsHosted:(e==null?void 0:e.totalEventsHosted)||0,totalEventDuration:(e==null?void 0:e.totalEventDuration)||0,averageEventDuration:(e==null?void 0:e.averageEventDuration)||0,newFollowers:(e==null?void 0:e.newFollowers)||0,followerGrowthRate:(e==null?void 0:e.followerGrowthRate)||0,topSupporters:(e==null?void 0:e.topSupporters)||[],listenerLocations:(e==null?void 0:e.listenerLocations)||[],listenerAgeGroups:(e==null?void 0:e.listenerAgeGroups)||[]},v={userId:(e==null?void 0:e.userId)||(r==null?void 0:r.id)||"",username:(e==null?void 0:e.username)||(r==null?void 0:r.username)||"",displayName:(e==null?void 0:e.displayName)||(r==null?void 0:r.displayName)||"",avatar:(e==null?void 0:e.avatar)||(r==null?void 0:r.avatarUrl),verifiedAt:(e==null?void 0:e.verifiedAt)||null,category:(e==null?void 0:e.category)||"creator",nebulaTier:(e==null?void 0:e.nebulaTier)||"nebula",totalListeners:(e==null?void 0:e.totalListeners)||0,totalStarsReceived:(e==null?void 0:e.totalStarsReceived)||0,totalEventsHosted:(e==null?void 0:e.totalEventsHosted)||0,averageEventRating:(e==null?void 0:e.averageEventRating)||0,isLive:(e==null?void 0:e.isLive)||!1,permissions:(e==null?void 0:e.permissions)||{canMuteParticipants:!1,canManageHandRaise:!1,canStartRecording:!1,canVoiceLiftUsers:!1,maxVoiceLiftSlots:0,maxEventCapacity:0,hasAdvancedAnalytics:!1,canExportData:!1}},w={day:"Heute",week:"Diese Woche",month:"Diesen Monat",all_time:"Gesamt"};return c.jsxs("div",{className:"min-h-screen bg-gray-950 pb-24",children:[c.jsx("div",{className:"sticky top-0 z-10 bg-gray-950/95 backdrop-blur-sm border-b border-gray-800",children:c.jsxs("div",{className:"flex items-center justify-between p-4",children:[c.jsx("button",{onClick:()=>t(-1),className:"p-2 -m-2 text-gray-400 hover:text-white",children:c.jsx(Eo,{size:24})}),c.jsx("h1",{className:"text-lg font-bold text-white",children:"Stars Dashboard"}),c.jsx("button",{className:"p-2 -m-2 text-gray-400 hover:text-white",children:c.jsx(GL,{size:20})})]})}),c.jsxs("div",{className:"p-4 space-y-6",children:[c.jsxs("div",{className:"relative bg-gradient-to-br from-purple-900/30 to-pink-900/30 rounded-2xl p-6 border border-purple-500/30",children:[c.jsx("div",{className:"absolute inset-0 rounded-2xl overflow-hidden",children:c.jsx("div",{className:"absolute inset-0 opacity-30",style:{background:"radial-gradient(circle at 30% 30%, rgba(139, 92, 246, 0.4), transparent 50%)"}})}),c.jsxs("div",{className:"relative flex items-start gap-4",children:[c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:"w-20 h-20 rounded-full bg-cover bg-center border-3",style:{backgroundImage:v.avatar?`url(${v.avatar})`:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderColor:"#F59E0B",boxShadow:"0 0 30px rgba(245, 158, 11, 0.5)"}}),c.jsx("div",{className:"absolute -bottom-1 -right-1",children:c.jsx(jN,{tier:v.nebulaTier,size:"lg"})})]}),c.jsxs("div",{className:"flex-1",children:[c.jsx("div",{className:"flex items-center gap-2 mb-1",children:c.jsxs("h2",{className:"text-xl font-bold text-white",children:["@",v.username]})}),c.jsx("p",{className:"text-gray-400 mb-2",children:v.displayName}),c.jsx(wme,{category:v.category})]})]}),c.jsxs("div",{className:"relative grid grid-cols-3 gap-4 mt-6 pt-6 border-t border-gray-700/50",children:[c.jsxs("div",{className:"text-center",children:[c.jsx("p",{className:"text-2xl font-bold text-white",children:v.totalListeners.toLocaleString()}),c.jsx("p",{className:"text-xs text-gray-400",children:"Zuhrer"})]}),c.jsxs("div",{className:"text-center",children:[c.jsx("p",{className:"text-2xl font-bold text-amber-400",children:v.totalStarsReceived.toLocaleString()}),c.jsx("p",{className:"text-xs text-gray-400",children:"Sterne"})]}),c.jsxs("div",{className:"text-center",children:[c.jsx("p",{className:"text-2xl font-bold text-white",children:v.totalEventsHosted}),c.jsx("p",{className:"text-xs text-gray-400",children:"Events"})]})]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[c.jsxs("button",{onClick:()=>t("/stars/event/new"),className:"flex items-center justify-center gap-2 p-4 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl text-white font-semibold",children:[c.jsx(Spe,{size:20}),"Event starten"]}),c.jsxs("button",{onClick:()=>t("/stars/schedule"),className:"flex items-center justify-center gap-2 p-4 bg-gray-800/50 rounded-xl text-gray-300 font-medium border border-gray-700",children:[c.jsx(ap,{size:20}),"Planen"]})]}),c.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 -mx-4 px-4",children:["day","week","month","all_time"].map(R=>c.jsx("button",{onClick:()=>u(R),className:`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all ${l===R?"bg-purple-500 text-white":"bg-gray-800/50 text-gray-400 hover:bg-gray-700/50"}`,children:w[R]},R))}),c.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[c.jsx(cb,{icon:c.jsx(cr,{className:"text-blue-400"}),label:"Zuhrer",value:m.totalListeners.toLocaleString(),subvalue:`${m.uniqueListeners.toLocaleString()} unique`,trend:12.5}),c.jsx(cb,{icon:c.jsx(Ji,{className:"text-amber-400"}),label:"Sterne",value:m.totalStarsReceived.toLocaleString(),subvalue:`${m.starsValue.toFixed(2)}`,trend:8.3}),c.jsx(cb,{icon:c.jsx(Ua,{className:"text-green-400"}),label:" Hrdauer",value:`${m.averageListenDuration}m`,subvalue:"pro Session",trend:3.2}),c.jsx(cb,{icon:c.jsx(fd,{className:"text-purple-400"}),label:"Engagement",value:`${m.averageEngagementRate}%`,subvalue:"Interaktionsrate",trend:5.1}),c.jsx(cb,{icon:c.jsx(Pl,{className:"text-pink-400"}),label:"Peak",value:m.peakConcurrentListeners.toLocaleString(),subvalue:"gleichzeitig"}),c.jsx(cb,{icon:c.jsx(fd,{className:"text-cyan-400"}),label:"Wachstum",value:`+${m.newFollowers.toLocaleString()}`,subvalue:`${m.followerGrowthRate}% `,trend:m.followerGrowthRate})]}),c.jsxs("div",{className:"bg-gray-800/30 rounded-2xl p-4 border border-gray-700/50",children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsxs("h3",{className:"font-semibold text-white flex items-center gap-2",children:[c.jsx(as,{size:18,className:"text-amber-400"}),"Top Supporter"]}),c.jsx("button",{className:"text-sm text-purple-400",children:"Alle anzeigen"})]}),c.jsx("div",{className:"space-y-3",children:m.topSupporters.slice(0,5).map((R,C)=>c.jsx(Pze,{supporter:R,rank:C+1},R.userId))})]}),c.jsxs("div",{className:"bg-gray-800/30 rounded-2xl p-4 border border-gray-700/50",children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsxs("h3",{className:"font-semibold text-white flex items-center gap-2",children:[c.jsx(kn,{size:18,className:"text-purple-400"}),"Deine Star-Features"]}),c.jsx(jN,{tier:v.nebulaTier,size:"sm",showLabel:!0})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsx(lb,{icon:c.jsx(WL,{size:16}),label:"Stummschalten",enabled:v.permissions.canMuteParticipants}),c.jsx(lb,{icon:c.jsx(pz,{size:16}),label:"Hand-Management",enabled:v.permissions.canManageHandRaise}),c.jsx(lb,{icon:c.jsx(kn,{size:16}),label:"Voice Lift",enabled:v.permissions.canVoiceLiftUsers,extra:`${v.permissions.maxVoiceLiftSlots} Slots`}),c.jsx(lb,{icon:c.jsx(Qo,{size:16}),label:"Aufnahme",enabled:v.permissions.canStartRecording}),c.jsx(lb,{icon:c.jsx(cr,{size:16}),label:"Kapazitt",enabled:!0,extra:`${v.permissions.maxEventCapacity}`}),c.jsx(lb,{icon:c.jsx(FC,{size:16}),label:"Analytics",enabled:v.permissions.hasAdvancedAnalytics})]})]}),v.permissions.canExportData&&c.jsxs("button",{className:"w-full flex items-center justify-center gap-2 p-4 bg-gray-800/50 rounded-xl text-gray-300 border border-gray-700 hover:bg-gray-700/50 transition-colors",children:[c.jsx(v5e,{size:20}),"Analytics exportieren (CSV)"]})]})]})},cb=({icon:t,label:e,value:r,subvalue:a,trend:l})=>c.jsxs("div",{className:"bg-gray-800/30 rounded-xl p-4 border border-gray-700/50",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t,c.jsx("span",{className:"text-sm text-gray-400",children:e})]}),c.jsx("p",{className:"text-2xl font-bold text-white",children:r}),c.jsxs("div",{className:"flex items-center justify-between mt-1",children:[a&&c.jsx("span",{className:"text-xs text-gray-500",children:a}),l!==void 0&&c.jsxs("span",{className:`text-xs font-medium ${l>=0?"text-green-400":"text-red-400"}`,children:[l>=0?"+":"",l.toFixed(1),"%"]})]})]}),Pze=({supporter:t,rank:e})=>{const r=["text-amber-400","text-gray-400","text-orange-400"];return c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("span",{className:`w-6 text-center font-bold ${r[e-1]||"text-gray-500"}`,children:e}),c.jsx("div",{className:"w-10 h-10 rounded-full bg-cover bg-center",style:{backgroundImage:t.avatar?`url(${t.avatar})`:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsxs("p",{className:"font-medium text-white truncate",children:["@",t.username]}),c.jsxs("p",{className:"text-xs text-gray-500",children:[t.eventsAttended," Events besucht"]})]}),c.jsx("div",{className:"text-right",children:c.jsxs("p",{className:"font-semibold text-amber-400 flex items-center gap-1",children:[c.jsx(Ji,{size:14}),t.starsGiven]})})]})},lb=({icon:t,label:e,enabled:r,extra:a})=>c.jsxs("div",{className:`flex items-center gap-2 p-2 rounded-lg ${r?"bg-purple-500/10 text-purple-300":"bg-gray-800/30 text-gray-500"}`,children:[t,c.jsx("span",{className:"text-xs",children:e}),a&&c.jsx("span",{className:"text-[10px] ml-auto opacity-70",children:a})]}),Dze=[{id:"1",hostId:"user1",hostUsername:"max_official",hostDisplayName:"Max Mustermann",hostTier:"supernova",title:"Abend Q&A mit der Community",description:"Ich beantworte eure Fragen zu meinem neuen Projekt und mehr!",category:"qa",scheduledAt:new Date(Date.now()+2*60*60*1e3),estimatedDuration:60,interestedCount:234,status:"scheduled"},{id:"2",hostId:"user1",hostUsername:"max_official",hostDisplayName:"Max Mustermann",hostTier:"supernova",title:"Wochenend-Chill & Music",description:"Entspannter Samstag mit guter Musik und netten Gesprchen",category:"music",scheduledAt:new Date(Date.now()+48*60*60*1e3),estimatedDuration:120,interestedCount:89,status:"scheduled"}],dv={qa:{icon:Qo,label:"Q&A",color:"text-purple-400"},talk:{icon:hp,label:"Talk",color:"text-blue-400"},interview:{icon:Npe,label:"Interview",color:"text-orange-400"},music:{icon:k5e,label:"Musik",color:"text-pink-400"},gaming:{icon:x5e,label:"Gaming",color:"text-green-400"},education:{icon:b5e,label:"Bildung",color:"text-indigo-400"},business:{icon:g5e,label:"Business",color:"text-yellow-400"},casual:{icon:y5e,label:"Casual",color:"text-cyan-400"},other:{icon:kn,label:"Sonstiges",color:"text-gray-400"}};function Oze(){const t=yr(),{isVerifiedStar:e}=Jr(),[r,a]=V.useState(Dze),[l,u]=V.useState(!1),[p,m]=V.useState(null);if(!e)return c.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center p-4",children:c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"w-16 h-16 bg-purple-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:c.jsx(ap,{className:"w-8 h-8 text-purple-400"})}),c.jsx("h2",{className:"text-xl font-bold mb-2",children:"Nur fr verifizierte Stars"}),c.jsx("p",{className:"text-gray-400 mb-6",children:"Event-Planung ist nur fr verifizierte Creator verfgbar."}),c.jsx("button",{onClick:()=>t("/stars/apply"),className:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl font-medium",children:"Star werden"})]})});const v=C=>{const A=new Date,O=C.getTime()-A.getTime(),U=Math.floor(O/(1e3*60*60)),F=Math.floor(U/24);if(F>0)return`In ${F} Tag${F>1?"en":""}`;if(U>0)return`In ${U} Stunde${U>1?"n":""}`;{const q=Math.floor(O/6e4);return`In ${q} Minute${q>1?"n":""}`}},w=C=>{a(r.filter(A=>A.id!==C))},R=C=>{t("/discover")};return c.jsxs("div",{className:"min-h-screen bg-black text-white pb-24",children:[c.jsx("div",{className:"sticky top-0 z-50 bg-black/90 backdrop-blur-lg border-b border-white/10",children:c.jsxs("div",{className:"flex items-center justify-between p-4",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{onClick:()=>t(-1),className:"p-2 hover:bg-white/10 rounded-xl transition-colors",children:c.jsx(Eo,{className:"w-5 h-5"})}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-lg font-bold",children:"Event-Planung"}),c.jsx("p",{className:"text-xs text-gray-400",children:"Plane deine nchsten Sessions"})]})]}),c.jsx("button",{onClick:()=>u(!0),className:"p-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl",children:c.jsx(Ew,{className:"w-5 h-5"})})]})}),c.jsxs("div",{className:"p-4 grid grid-cols-3 gap-3",children:[c.jsxs("div",{className:"bg-white/5 rounded-xl p-3 text-center",children:[c.jsx("div",{className:"text-2xl font-bold text-purple-400",children:r.length}),c.jsx("div",{className:"text-xs text-gray-400",children:"Geplant"})]}),c.jsxs("div",{className:"bg-white/5 rounded-xl p-3 text-center",children:[c.jsx("div",{className:"text-2xl font-bold text-pink-400",children:r.reduce((C,A)=>C+A.interestedCount,0)}),c.jsx("div",{className:"text-xs text-gray-400",children:"Interessiert"})]}),c.jsxs("div",{className:"bg-white/5 rounded-xl p-3 text-center",children:[c.jsx("div",{className:"text-2xl font-bold text-cyan-400",children:r.filter(C=>{const A=new Date(C.scheduledAt).getTime()-Date.now();return A<24*60*60*1e3&&A>0}).length}),c.jsx("div",{className:"text-xs text-gray-400",children:"Heute"})]})]}),c.jsxs("div",{className:"p-4 space-y-4",children:[c.jsxs("h2",{className:"text-lg font-bold flex items-center gap-2",children:[c.jsx(ap,{className:"w-5 h-5 text-purple-400"}),"Geplante Events"]}),r.length===0?c.jsxs("div",{className:"bg-white/5 rounded-2xl p-8 text-center",children:[c.jsx("div",{className:"w-16 h-16 bg-purple-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:c.jsx(ap,{className:"w-8 h-8 text-purple-400"})}),c.jsx("h3",{className:"font-bold mb-2",children:"Keine Events geplant"}),c.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Plane dein erstes Event, damit deine Follower wissen, wann du live gehst!"}),c.jsx("button",{onClick:()=>u(!0),className:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl font-medium",children:"Event erstellen"})]}):c.jsx("div",{className:"space-y-3",children:r.map(C=>{const A=dv[C.category].icon,O=new Date(C.scheduledAt).getTime()-Date.now()<30*60*1e3;return c.jsxs("div",{className:`bg-white/5 rounded-2xl p-4 border ${O?"border-purple-500/50":"border-transparent"}`,children:[c.jsxs("div",{className:"flex items-start justify-between mb-3",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:`w-10 h-10 rounded-xl bg-white/10 flex items-center justify-center ${dv[C.category].color}`,children:c.jsx(A,{className:"w-5 h-5"})}),c.jsxs("div",{children:[c.jsx("h3",{className:"font-bold",children:C.title}),c.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[c.jsx("span",{className:dv[C.category].color,children:dv[C.category].label}),c.jsx("span",{children:""}),c.jsxs("span",{children:[C.estimatedDuration," Min"]})]})]})]}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx("button",{onClick:()=>m(C),className:"p-2 hover:bg-white/10 rounded-lg transition-colors",children:c.jsx(P5e,{className:"w-4 h-4 text-gray-400"})}),c.jsx("button",{onClick:()=>w(C.id),className:"p-2 hover:bg-red-500/20 rounded-lg transition-colors",children:c.jsx(Lm,{className:"w-4 h-4 text-red-400"})})]})]}),C.description&&c.jsx("p",{className:"text-sm text-gray-400 mb-3",children:C.description}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[c.jsx(Ua,{className:"w-4 h-4 text-purple-400"}),c.jsx("span",{className:O?"text-purple-400 font-medium":"text-gray-400",children:v(new Date(C.scheduledAt))})]}),c.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[c.jsx(kl,{className:"w-4 h-4 text-pink-400"}),c.jsxs("span",{className:"text-gray-400",children:[C.interestedCount," interessiert"]})]})]}),O&&c.jsxs("button",{onClick:()=>R(),className:"px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl text-sm font-medium flex items-center gap-2",children:[c.jsx(Yd,{className:"w-4 h-4"}),"Jetzt starten"]})]}),O&&c.jsxs("div",{className:"mt-3 px-3 py-2 bg-purple-500/20 rounded-xl flex items-center gap-2",children:[c.jsx("div",{className:"w-2 h-2 bg-purple-400 rounded-full animate-pulse"}),c.jsx("span",{className:"text-sm text-purple-300",children:"Event startet bald!"})]})]},C.id)})})]}),c.jsx("div",{className:"p-4",children:c.jsxs("div",{className:"bg-gradient-to-br from-purple-500/10 to-pink-500/10 rounded-2xl p-4 border border-purple-500/20",children:[c.jsxs("h3",{className:"font-bold mb-2 flex items-center gap-2",children:[c.jsx(kn,{className:"w-5 h-5 text-purple-400"}),"Tipps fr bessere Events"]}),c.jsxs("ul",{className:"space-y-2 text-sm text-gray-400",children:[c.jsxs("li",{className:"flex items-start gap-2",children:[c.jsx(_r,{className:"w-4 h-4 text-green-400 mt-0.5 shrink-0"}),"Plane Events mindestens 24h im Voraus"]}),c.jsxs("li",{className:"flex items-start gap-2",children:[c.jsx(_r,{className:"w-4 h-4 text-green-400 mt-0.5 shrink-0"}),"Fge eine aussagekrftige Beschreibung hinzu"]}),c.jsxs("li",{className:"flex items-start gap-2",children:[c.jsx(_r,{className:"w-4 h-4 text-green-400 mt-0.5 shrink-0"}),"Whle Zeiten, wenn deine Follower aktiv sind"]})]})]})}),l&&c.jsx(cae,{onClose:()=>u(!1),onSave:C=>{a([...r,C]),u(!1)}}),p&&c.jsx(cae,{event:p,onClose:()=>m(null),onSave:C=>{a(r.map(A=>A.id===C.id?C:A)),m(null)}})]})}function cae({event:t,onClose:e,onSave:r}){const{user:a,starProfile:l}=Jr(),[u,p]=V.useState((t==null?void 0:t.title)||""),[m,v]=V.useState((t==null?void 0:t.description)||""),[w,R]=V.useState((t==null?void 0:t.category)||"talk"),[C,A]=V.useState(t!=null&&t.scheduledAt?new Date(t.scheduledAt).toISOString().split("T")[0]:new Date(Date.now()+24*60*60*1e3).toISOString().split("T")[0]),[O,U]=V.useState(t!=null&&t.scheduledAt?new Date(t.scheduledAt).toTimeString().slice(0,5):"19:00"),[F,q]=V.useState((t==null?void 0:t.estimatedDuration)||60),W=()=>{if(!u.trim())return;const H=new Date(`${C}T${O}:00`),X={id:(t==null?void 0:t.id)||`event-${Date.now()}`,hostId:(a==null?void 0:a.id)||"",hostUsername:(a==null?void 0:a.username)||"",hostDisplayName:(a==null?void 0:a.displayName)||(a==null?void 0:a.username)||"",hostAvatar:a==null?void 0:a.avatar,hostTier:(l==null?void 0:l.nebulaTier)||"nebula",title:u,description:m,category:w,scheduledAt:H,estimatedDuration:F,interestedCount:(t==null?void 0:t.interestedCount)||0,status:"scheduled"};r(X)};return c.jsxs("div",{className:"fixed inset-0 z-50 flex items-end justify-center",children:[c.jsx("div",{className:"absolute inset-0 bg-black/80",onClick:e}),c.jsxs("div",{className:"relative w-full max-w-lg bg-gray-900 rounded-t-3xl max-h-[90vh] overflow-y-auto",children:[c.jsxs("div",{className:"sticky top-0 bg-gray-900 p-4 border-b border-white/10 flex items-center justify-between",children:[c.jsx("h2",{className:"text-lg font-bold",children:t?"Event bearbeiten":"Neues Event"}),c.jsx("button",{onClick:e,className:"p-2 hover:bg-white/10 rounded-xl",children:c.jsx(Di,{className:"w-5 h-5"})})]}),c.jsxs("div",{className:"p-4 space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium mb-2",children:"Titel *"}),c.jsx("input",{type:"text",value:u,onChange:H=>p(H.target.value),placeholder:"z.B. Abend Q&A mit der Community",className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl focus:outline-none focus:border-purple-500",maxLength:50}),c.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[u.length,"/50"]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium mb-2",children:"Beschreibung"}),c.jsx("textarea",{value:m,onChange:H=>v(H.target.value),placeholder:"Worum geht es in deinem Event?",className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl focus:outline-none focus:border-purple-500 resize-none h-24",maxLength:200}),c.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[m.length,"/200"]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium mb-2",children:"Kategorie"}),c.jsx("div",{className:"grid grid-cols-3 gap-2",children:Object.entries(dv).map(([H,X])=>{const ne=X.icon;return c.jsxs("button",{onClick:()=>R(H),className:`p-3 rounded-xl border text-sm flex flex-col items-center gap-1 transition-all ${w===H?"border-purple-500 bg-purple-500/20":"border-white/10 bg-white/5 hover:bg-white/10"}`,children:[c.jsx(ne,{className:`w-5 h-5 ${X.color}`}),c.jsx("span",{children:X.label})]},H)})})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium mb-2",children:"Datum"}),c.jsx("input",{type:"date",value:C,onChange:H=>A(H.target.value),min:new Date().toISOString().split("T")[0],className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl focus:outline-none focus:border-purple-500"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium mb-2",children:"Uhrzeit"}),c.jsx("input",{type:"time",value:O,onChange:H=>U(H.target.value),className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl focus:outline-none focus:border-purple-500"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium mb-2",children:"Geplante Dauer"}),c.jsx("div",{className:"flex gap-2",children:[30,60,90,120].map(H=>c.jsxs("button",{onClick:()=>q(H),className:`flex-1 py-3 rounded-xl border text-sm transition-all ${F===H?"border-purple-500 bg-purple-500/20":"border-white/10 bg-white/5 hover:bg-white/10"}`,children:[H," Min"]},H))})]}),c.jsxs("div",{className:"bg-white/5 rounded-xl p-4 border border-white/10",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"Vorschau fr Follower"}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:`w-10 h-10 rounded-xl bg-white/10 flex items-center justify-center ${dv[w].color}`,children:(()=>{const H=dv[w].icon;return c.jsx(H,{className:"w-5 h-5"})})()}),c.jsxs("div",{children:[c.jsx("div",{className:"font-medium",children:u||"Event Titel"}),c.jsxs("div",{className:"text-xs text-gray-400",children:[new Date(`${C}T${O}`).toLocaleDateString("de-DE",{weekday:"short",day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}),"  ",F," Min"]})]})]})]}),c.jsx("button",{onClick:W,disabled:!u.trim(),className:"w-full py-4 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl font-bold disabled:opacity-50 disabled:cursor-not-allowed",children:t?"nderungen speichern":"Event erstellen"})]})]})]})}const Lze=({isOpen:t,onClose:e,userId:r,username:a,displayName:l,isCurrentlyBlocked:u})=>{const{blockUser:p,unblockUser:m}=tj(),[v,w]=V.useState("personal"),[R,C]=V.useState(""),[A,O]=V.useState(!1),[U,F]=V.useState(!1),q=async()=>{O(!0);const X=await p(r,v,v==="other"?R:void 0);O(!1),X&&(F(!0),setTimeout(()=>{e(),F(!1)},1500))},W=async()=>{O(!0);const X=await m(r);O(!1),X&&(F(!0),setTimeout(()=>{e(),F(!1)},1500))};if(!t)return null;const H=l||`@${a}`;return U?c.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:c.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-sm p-6 text-center animate-in zoom-in-95",children:[c.jsx("div",{className:`w-16 h-16 mx-auto rounded-full ${u?"bg-green-100":"bg-red-100"} flex items-center justify-center mb-4`,children:u?c.jsx(K_,{size:28,className:"text-green-500"}):c.jsx(_r,{size:28,className:"text-red-500"})}),c.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:u?"Entblockt!":"Blockiert!"}),c.jsx("p",{className:"text-gray-500 text-sm",children:u?`${H} kann dich jetzt wieder kontaktieren.`:`${H} kann dich nicht mehr kontaktieren.`})]})}):u?c.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:c.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-sm p-6 animate-in zoom-in-95",children:[c.jsxs("div",{className:"flex items-center justify-between mb-6",children:[c.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Nutzer entblocken"}),c.jsx("button",{onClick:e,className:"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center",children:c.jsx(Di,{size:18,className:"text-gray-500"})})]}),c.jsxs("div",{className:"text-center mb-6",children:[c.jsx("div",{className:"w-16 h-16 mx-auto rounded-full bg-green-100 flex items-center justify-center mb-4",children:c.jsx(K_,{size:28,className:"text-green-500"})}),c.jsx("p",{className:"font-semibold text-gray-900 mb-2",children:H}),c.jsx("p",{className:"text-sm text-gray-500",children:"Nach dem Entblocken kann diese Person dich wieder kontaktieren und in Voice-Chats sehen."})]}),c.jsxs("div",{className:"flex gap-3",children:[c.jsx("button",{onClick:e,className:"flex-1 py-3 bg-gray-100 text-gray-600 rounded-xl font-semibold",children:"Abbrechen"}),c.jsx("button",{onClick:W,disabled:A,className:"flex-1 py-3 bg-green-500 text-white rounded-xl font-semibold flex items-center justify-center gap-2",children:A?c.jsx(fi,{size:18,className:"animate-spin"}):c.jsxs(c.Fragment,{children:[c.jsx(K_,{size:18}),"Entblocken"]})})]})]})}):c.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:c.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-sm p-6 animate-in zoom-in-95 max-h-[90vh] overflow-y-auto",children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Nutzer blockieren"}),c.jsx("button",{onClick:e,className:"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center",children:c.jsx(Di,{size:18,className:"text-gray-500"})})]}),c.jsxs("p",{className:"text-gray-500 text-sm mb-4",children:[c.jsx("span",{className:"font-semibold text-gray-900",children:H})," wird dich nicht mehr kontaktieren knnen."]}),c.jsxs("div",{className:"mb-4",children:[c.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Grund (optional)"}),c.jsx("div",{className:"space-y-2",children:H6e.map(X=>c.jsxs("button",{onClick:()=>w(X.id),className:`w-full flex items-center gap-3 p-3 rounded-xl border-2 transition-all ${v===X.id?"border-violet-500 bg-violet-50":"border-gray-200 hover:border-gray-300"}`,children:[c.jsx("span",{className:"text-lg",children:X.icon}),c.jsx("span",{className:"text-sm font-medium text-gray-700",children:X.label}),v===X.id&&c.jsx(_r,{size:16,className:"text-violet-500 ml-auto"})]},X.id))})]}),v==="other"&&c.jsx("div",{className:"mb-4",children:c.jsx("input",{type:"text",value:R,onChange:X=>C(X.target.value),placeholder:"Grund eingeben (optional)",maxLength:100,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-violet-500 focus:outline-none"})}),c.jsx("div",{className:"p-3 bg-amber-50 rounded-xl border border-amber-200 mb-4",children:c.jsxs("div",{className:"flex gap-2",children:[c.jsx(rh,{size:16,className:"text-amber-500 flex-shrink-0 mt-0.5"}),c.jsx("p",{className:"text-xs text-amber-700",children:"Blockierte Personen erfahren nicht, dass sie blockiert wurden. Du kannst sie jederzeit wieder entblocken."})]})}),c.jsxs("div",{className:"flex gap-3",children:[c.jsx("button",{onClick:e,className:"flex-1 py-3 bg-gray-100 text-gray-600 rounded-xl font-semibold",children:"Abbrechen"}),c.jsx("button",{onClick:q,disabled:A,className:"flex-1 py-3 bg-red-500 text-white rounded-xl font-semibold flex items-center justify-center gap-2",children:A?c.jsx(fi,{size:18,className:"animate-spin"}):c.jsxs(c.Fragment,{children:[c.jsx(cs,{size:18}),"Blockieren"]})})]})]})})},jze=()=>{const{userId:t}=Kce(),e=yr(),{user:r}=Jr(),{isBlocked:a,isBlockedBy:l}=tj(),[u,p]=V.useState(null),[m,v]=V.useState(!0),[w,R]=V.useState(!1),[C,A]=V.useState(!1),[O,U]=V.useState(!1),[F,q]=V.useState(!1),W=t?a(t):!1;t&&l(t),V.useEffect(()=>{(async()=>{var he;if(t)try{const J=await Bn(tt(De,"users",t));if(J.exists()){const Q=J.data();p({id:J.id,username:Q.username||"unknown",displayName:Q.displayName||"Unbekannt",bio:Q.bio||"",avatar:Q.avatar,avatarUrl:Q.avatarUrl||Q.photoURL,level:Q.level||1,xp:Q.xp||0,joinedAt:((he=Q.createdAt)==null?void 0:he.toDate())||new Date,isVerified:Q.isVerified||!1,isCreator:Q.isCreator||!1,friendsCount:Q.friendsCount||0,roomsJoined:Q.roomsJoined||0,minutesTalked:Q.minutesTalked||0,birthDay:Q.birthDay,birthMonth:Q.birthMonth,showBirthdateOnProfile:Q.showBirthdateOnProfile!==!1,city:Q.city})}}catch(J){console.error("Error fetching user:",J)}finally{v(!1)}})()},[t]),V.useEffect(()=>{(async()=>{if(!(!t||!(r!=null&&r.id)))try{const he=Mr(mn(De,"friends"),Kn("users","array-contains",r.id)),Q=(await Cr(he)).docs.some(pe=>pe.data().users.includes(t));R(Q);const ce=Mr(mn(De,"friendRequests"),Kn("fromId","==",r.id),Kn("toId","==",t),Kn("status","==","pending")),de=await Cr(ce);A(!de.empty)}catch(he){console.error("Error checking friendship:",he)}})()},[t,r==null?void 0:r.id]);const H=async()=>{if(!(!t||!(r!=null&&r.id)||O)){U(!0);try{await Lv(mn(De,"friendRequests"),{fromId:r.id,fromUsername:r.username,fromDisplayName:r.displayName,toId:t,toUsername:u==null?void 0:u.username,status:"pending",createdAt:fn.now()}),A(!0)}catch(te){console.error("Error sending friend request:",te)}finally{U(!1)}}},X=()=>{e("/messages",{state:{openChat:t}})},ne=te=>te.toLocaleDateString("de-DE",{month:"long",year:"numeric"});return m?c.jsx("div",{className:"min-h-screen bg-gradient-to-b from-synclulu-soft/50 to-white flex items-center justify-center",children:c.jsx(fi,{size:32,className:"animate-spin text-synclulu-violet"})}):u?t===(r==null?void 0:r.id)?(e("/profile"),null):c.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-synclulu-soft/50 to-white safe-top pb-24",children:[c.jsx("div",{className:"px-6 pt-6",children:c.jsx("button",{onClick:()=>e(-1),className:"w-10 h-10 rounded-xl bg-white shadow-sm flex items-center justify-center mb-6",children:c.jsx(Eo,{size:20,className:"text-synclulu-text"})})}),c.jsxs("div",{className:"px-6 text-center mb-6",children:[c.jsxs("div",{className:"relative inline-block mb-4",children:[c.jsx("div",{className:`w-28 h-28 rounded-full flex items-center justify-center text-4xl ${u.isCreator?"bg-gradient-to-br from-purple-500 to-pink-500 text-white":"bg-synclulu-violet/10"}`,children:u.avatar||""}),u.isVerified&&c.jsx("div",{className:"absolute -bottom-1 -right-1 w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center border-4 border-white",children:c.jsx(BC,{size:16,className:"text-white"})}),u.isCreator&&c.jsx("div",{className:"absolute -top-1 -right-1 w-8 h-8 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center border-4 border-white",children:c.jsx(Ji,{size:14,className:"text-white"})})]}),c.jsx("h1",{className:"font-display text-2xl font-bold text-synclulu-text mb-1",children:u.displayName}),c.jsxs("p",{className:"text-synclulu-muted mb-2",children:["@",u.username]}),c.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-synclulu-violet/10 rounded-full mb-4",children:[c.jsx(gv,{size:16,className:"text-synclulu-violet"}),c.jsxs("span",{className:"font-semibold text-synclulu-violet",children:["Level ",u.level]})]}),u.bio&&c.jsx("p",{className:"text-sm text-synclulu-text max-w-xs mx-auto mb-4",children:u.bio}),u.showBirthdateOnProfile&&u.birthDay&&u.birthMonth&&c.jsxs("p",{className:"text-xs text-synclulu-muted flex items-center justify-center gap-2 mb-1",children:[c.jsx(EW,{size:12}),c.jsxs("span",{children:[u.birthDay,". ",Mze(u.birthMonth)]}),u.city&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"text-gray-300",children:""}),c.jsx(no,{size:12}),c.jsx("span",{children:u.city})]})]}),c.jsxs("p",{className:"text-xs text-synclulu-muted flex items-center justify-center gap-1",children:[c.jsx(ap,{size:12}),"Dabei seit ",ne(u.joinedAt)]})]}),c.jsx("div",{className:"px-6 mb-6",children:c.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[c.jsxs("div",{className:"bg-white rounded-2xl p-4 text-center shadow-sm",children:[c.jsx(cr,{size:20,className:"mx-auto text-synclulu-violet mb-2"}),c.jsx("p",{className:"font-bold text-synclulu-text",children:u.friendsCount}),c.jsx("p",{className:"text-xs text-synclulu-muted",children:"Freunde"})]}),c.jsxs("div",{className:"bg-white rounded-2xl p-4 text-center shadow-sm",children:[c.jsx(Qo,{size:20,className:"mx-auto text-green-500 mb-2"}),c.jsx("p",{className:"font-bold text-synclulu-text",children:u.roomsJoined}),c.jsx("p",{className:"text-xs text-synclulu-muted",children:"Rume"})]}),c.jsxs("div",{className:"bg-white rounded-2xl p-4 text-center shadow-sm",children:[c.jsx(Ji,{size:20,className:"mx-auto text-amber-500 mb-2"}),c.jsxs("p",{className:"font-bold text-synclulu-text",children:[Math.floor(u.minutesTalked/60),"h"]}),c.jsx("p",{className:"text-xs text-synclulu-muted",children:"Gesprochen"})]})]})}),c.jsxs("div",{className:"px-6 space-y-3",children:[w?c.jsxs("div",{className:"flex gap-3",children:[c.jsxs("button",{onClick:X,className:"flex-1 py-4 bg-synclulu-violet text-white rounded-2xl font-semibold flex items-center justify-center gap-2",children:[c.jsx(hp,{size:20}),"Nachricht"]}),c.jsx("button",{className:"w-14 h-14 bg-gray-100 text-gray-500 rounded-2xl flex items-center justify-center",children:c.jsx(K5e,{size:20})})]}):C?c.jsxs("button",{disabled:!0,className:"w-full py-4 bg-gray-100 text-gray-500 rounded-2xl font-semibold flex items-center justify-center gap-2",children:[c.jsx(BC,{size:20}),"Anfrage gesendet"]}):c.jsxs("button",{onClick:H,disabled:O,className:"w-full py-4 bg-synclulu-violet text-white rounded-2xl font-semibold flex items-center justify-center gap-2 disabled:opacity-50",children:[O?c.jsx(fi,{size:20,className:"animate-spin"}):c.jsx(op,{size:20}),"Freund hinzufgen"]}),c.jsx("button",{onClick:()=>q(!0),className:`w-full py-3 rounded-xl font-medium flex items-center justify-center gap-2 text-sm ${W?"bg-green-100 text-green-600":"bg-red-50 text-red-500"}`,children:W?c.jsxs(c.Fragment,{children:[c.jsx(M5e,{size:16}),"Entblocken"]}):c.jsxs(c.Fragment,{children:[c.jsx(cs,{size:16}),"Blockieren"]})}),c.jsxs("button",{className:"w-full py-3 bg-gray-100 text-gray-500 rounded-xl font-medium flex items-center justify-center gap-2 text-sm",children:[c.jsx(vpe,{size:16}),"Nutzer melden"]})]}),c.jsx(Lze,{isOpen:F,onClose:()=>q(!1),userId:t||"",username:(u==null?void 0:u.username)||"",displayName:u==null?void 0:u.displayName,isCurrentlyBlocked:W})]}):c.jsx("div",{className:"min-h-screen bg-gradient-to-b from-synclulu-soft/50 to-white safe-top pb-24",children:c.jsxs("div",{className:"px-6 pt-6",children:[c.jsx("button",{onClick:()=>e(-1),className:"w-10 h-10 rounded-xl bg-white shadow-sm flex items-center justify-center mb-6",children:c.jsx(Eo,{size:20,className:"text-synclulu-text"})}),c.jsxs("div",{className:"text-center py-8",children:[c.jsx("div",{className:"w-28 h-28 mx-auto rounded-full bg-synclulu-violet/10 flex items-center justify-center mb-4",children:c.jsx("span",{className:"text-4xl",children:""})}),c.jsx("h1",{className:"font-display text-xl font-bold text-synclulu-text mb-2",children:"synclulu Nutzer"}),c.jsx("p",{className:"text-sm text-synclulu-muted mb-6",children:"Profil wird geladen..."}),c.jsx("button",{onClick:H,disabled:O||C,className:"w-full max-w-xs mx-auto py-4 bg-synclulu-violet text-white rounded-2xl font-semibold flex items-center justify-center gap-2 disabled:opacity-50",children:O?c.jsx(fi,{size:20,className:"animate-spin"}):C?c.jsxs(c.Fragment,{children:[c.jsx(BC,{size:20}),"Anfrage gesendet"]}):c.jsxs(c.Fragment,{children:[c.jsx(op,{size:20}),"Freund hinzufgen"]})})]})]})})},Mze=t=>["Januar","Februar","Mrz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"][t-1]||"",Uze=({user:t,addLog:e})=>{const{config:r}=gpe(),[a,l]=V.useState(!1),[u,p]=V.useState(""),[m,v]=V.useState(30),w=async()=>{l(!0);try{const C=!r.maintenanceMode;await XMe(C,t.id,u||void 0,C?m:void 0),e(C?" Wartungsmodus AKTIVIERT":" Wartungsmodus DEAKTIVIERT")}catch{e(" Fehler beim Umschalten des Wartungsmodus")}l(!1)},R=async(C,A)=>{try{await lpe({features:{...r.features,[C]:A}},t.id),e(`Feature "${C}" ${A?"aktiviert":"deaktiviert"}`)}catch{e(` Fehler beim Aktualisieren von "${C}"`)}};return c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:`rounded-2xl p-6 border-2 relative overflow-hidden ${r.maintenanceMode?"bg-gradient-to-br from-purple-900/50 via-fuchsia-900/30 to-purple-900/50 border-fuchsia-500/50":"bg-gray-800 border-gray-700"}`,style:r.maintenanceMode?{boxShadow:"0 0 30px rgba(192, 38, 211, 0.3), inset 0 0 30px rgba(192, 38, 211, 0.1)"}:{},children:[r.maintenanceMode&&c.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:c.jsx("div",{className:"absolute inset-0 opacity-30",style:{background:"linear-gradient(45deg, transparent 30%, rgba(192, 38, 211, 0.2) 50%, transparent 70%)",animation:"shimmer 3s ease-in-out infinite"}})}),c.jsxs("div",{className:"relative flex items-start gap-4 mb-6",children:[c.jsx("div",{className:`w-16 h-16 rounded-2xl flex items-center justify-center transition-all ${r.maintenanceMode?"bg-gradient-to-br from-fuchsia-500 to-purple-600":"bg-gray-700"}`,style:r.maintenanceMode?{boxShadow:"0 0 25px rgba(192, 38, 211, 0.5)",animation:"pulse 2s ease-in-out infinite"}:{},children:c.jsx(Vs,{size:32,className:r.maintenanceMode?"text-white animate-pulse":"text-gray-400"})}),c.jsxs("div",{className:"flex-1",children:[c.jsxs("h2",{className:"font-bold text-2xl mb-1 flex items-center gap-3",children:[c.jsx("span",{className:r.maintenanceMode?"text-transparent bg-clip-text bg-gradient-to-r from-fuchsia-400 to-purple-400":"text-white",children:"REALITY BENDING MODE"}),r.maintenanceMode&&c.jsx("span",{className:"px-3 py-1 bg-gradient-to-r from-fuchsia-500 to-purple-500 text-white text-xs font-bold rounded-full",style:{animation:"pulse 1.5s ease-in-out infinite",boxShadow:"0 0 15px rgba(192, 38, 211, 0.5)"},children:" GODMODE AKTIV "})]}),c.jsx("p",{className:"text-gray-400 text-sm",children:"Blockiert den Zugriff fr alle Sterblichen whrend die Gtter das Universum neu konfigurieren."})]})]}),!r.maintenanceMode&&c.jsxs("div",{className:"space-y-4 mb-6",children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-sm text-gray-400 mb-2 block",children:"Nachricht fr Benutzer"}),c.jsx("input",{type:"text",value:u,onChange:C=>p(C.target.value),placeholder:"Wir machen eine kurze Pause...",className:"w-full px-4 py-3 bg-gray-900 border border-gray-700 rounded-xl text-white placeholder:text-gray-500 focus:border-purple-500 focus:outline-none"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-sm text-gray-400 mb-2 block",children:"Geschtzte Dauer (Minuten)"}),c.jsx("div",{className:"flex gap-2",children:[15,30,60,120].map(C=>c.jsxs("button",{onClick:()=>v(C),className:`px-4 py-2 rounded-xl text-sm font-medium transition-colors ${m===C?"bg-purple-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:[C," Min"]},C))})]})]}),r.maintenanceMode&&r.maintenanceEstimatedEnd&&c.jsxs("div",{className:"flex items-center gap-3 p-4 bg-amber-600/20 rounded-xl mb-6",children:[c.jsx(Ua,{size:20,className:"text-amber-400"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-amber-200 font-medium",children:"Geschtztes Ende"}),c.jsx("p",{className:"text-amber-100/70 text-sm",children:new Date(r.maintenanceEstimatedEnd).toLocaleString("de-DE")})]})]}),c.jsxs("button",{onClick:w,disabled:a,className:`relative w-full py-5 rounded-2xl font-bold text-lg flex items-center justify-center gap-3 transition-all overflow-hidden ${r.maintenanceMode?"bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white":"bg-gradient-to-r from-fuchsia-500 via-purple-500 to-violet-600 hover:from-fuchsia-600 hover:via-purple-600 hover:to-violet-700 text-white"} disabled:opacity-50`,style:r.maintenanceMode?{boxShadow:"0 0 30px rgba(34, 197, 94, 0.4)"}:{boxShadow:"0 0 30px rgba(192, 38, 211, 0.4)"},children:[c.jsx("div",{className:"absolute inset-0 opacity-30",style:{background:"linear-gradient(90deg, transparent 30%, rgba(255,255,255,0.3) 50%, transparent 70%)",animation:"shimmer-button 2s ease-in-out infinite"}}),a?c.jsx(fi,{size:28,className:"animate-spin"}):c.jsxs(c.Fragment,{children:[c.jsx(Vs,{size:28,className:r.maintenanceMode?"":"animate-pulse"}),r.maintenanceMode?" REALITT WIEDERHERSTELLEN":" ACTIVATE GODMODE "]})]}),c.jsx("style",{children:`
          @keyframes shimmer-button {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
          }
        `})]}),c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[c.jsxs("h2",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[c.jsx(Vs,{size:20,className:"text-purple-400"}),"Feature Flags"]}),c.jsx("div",{className:"space-y-3",children:Object.entries(r.features).map(([C,A])=>c.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-900 rounded-xl",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[C==="referralSystem"&&c.jsx(_o,{size:20,className:"text-pink-400"}),C==="premiumPurchases"&&c.jsx(fd,{size:20,className:"text-amber-400"}),C==="voiceChat"&&c.jsx(dz,{size:20,className:"text-blue-400"}),C==="anonymousMode"&&c.jsx(cs,{size:20,className:"text-green-400"}),C==="starEvents"&&c.jsx(Vs,{size:20,className:"text-purple-400"}),c.jsxs("div",{children:[c.jsx("p",{className:"font-medium capitalize",children:C.replace(/([A-Z])/g," $1").trim()}),c.jsxs("p",{className:"text-xs text-gray-400",children:[C==="referralSystem"&&"Einladungs-System mit 5 Links",C==="premiumPurchases"&&"Premium-Kufe aktivieren",C==="voiceChat"&&"Voice Chat in Wlkchen",C==="anonymousMode"&&"Anonymer Modus verfgbar",C==="starEvents"&&"Star Events & Zeitplne"]})]})]}),c.jsx("button",{onClick:()=>R(C,!A),className:`w-14 h-8 rounded-full transition-colors relative ${A?"bg-purple-600":"bg-gray-600"}`,children:c.jsx("div",{className:`w-6 h-6 bg-white rounded-full absolute top-1 transition-transform ${A?"translate-x-7":"translate-x-1"}`})})]},C))})]}),c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[c.jsxs("h2",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[c.jsx(hz,{size:20,className:"text-blue-400"}),"System Limits"]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{className:"p-4 bg-gray-900 rounded-xl",children:[c.jsx("p",{className:"text-2xl font-bold text-white",children:r.limits.maxUsersPerRoom}),c.jsx("p",{className:"text-xs text-gray-400",children:"Max. User pro Wlkchen"})]}),c.jsxs("div",{className:"p-4 bg-gray-900 rounded-xl",children:[c.jsx("p",{className:"text-2xl font-bold text-white",children:r.limits.maxRoomsPerUser}),c.jsx("p",{className:"text-xs text-gray-400",children:"Max. Wlkchen pro User"})]}),c.jsxs("div",{className:"p-4 bg-gray-900 rounded-xl",children:[c.jsx("p",{className:"text-2xl font-bold text-white",children:r.limits.maxDailyXP}),c.jsx("p",{className:"text-xs text-gray-400",children:"Max. XP pro Tag"})]}),c.jsxs("div",{className:"p-4 bg-gray-900 rounded-xl",children:[c.jsx("p",{className:"text-2xl font-bold text-white",children:r.limits.maxLevel}),c.jsx("p",{className:"text-xs text-gray-400",children:"Max. Level"})]})]})]}),c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[c.jsxs("h2",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[c.jsx(fd,{size:20,className:"text-green-400"}),"Level System 2.0"]}),c.jsxs("div",{className:"space-y-3 text-sm",children:[c.jsxs("div",{className:"p-4 bg-gray-900 rounded-xl font-mono",children:[c.jsx("p",{className:"text-gray-400 mb-2",children:"XP Formula:"}),c.jsxs("p",{className:"text-green-400",children:["XP_n = ",r.levelConfig.baseXP,"  n^",r.levelConfig.exponent]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{className:"p-4 bg-gray-900 rounded-xl",children:[c.jsx("p",{className:"text-xl font-bold text-white",children:r.levelConfig.prestigeUnlockLevel}),c.jsx("p",{className:"text-xs text-gray-400",children:"Prestige Unlock Level"})]}),c.jsxs("div",{className:"p-4 bg-gray-900 rounded-xl",children:[c.jsx("p",{className:"text-xl font-bold text-white",children:r.levelConfig.communityPrestigeThreshold}),c.jsx("p",{className:"text-xs text-gray-400",children:"Community Prestige"})]})]})]})]}),c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[c.jsx("h2",{className:"font-bold text-lg mb-4",children:"Admin-Infos"}),c.jsxs("div",{className:"space-y-3 text-sm",children:[c.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-600/10 border border-green-600/30 rounded-xl",children:[c.jsx(cs,{size:20,className:"text-green-400"}),c.jsxs("div",{children:[c.jsx("p",{className:"font-medium text-green-400",children:"Sicher authentifiziert"}),c.jsx("p",{className:"text-xs text-gray-400",children:"Via Firebase Firestore isAdmin Flag"})]})]}),c.jsxs("p",{children:[c.jsx("span",{className:"text-gray-400",children:"Deine User-ID:"})," ",c.jsx("code",{className:"bg-gray-700 px-2 py-1 rounded",children:t.id})]}),c.jsxs("p",{children:[c.jsx("span",{className:"text-gray-400",children:"Username:"})," ",c.jsx("code",{className:"bg-gray-700 px-2 py-1 rounded",children:t.username})]})]})]}),c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[c.jsx("h2",{className:"font-bold text-lg mb-4",children:"Neuen Admin hinzufgen"}),c.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Um einen neuen Admin hinzuzufgen, setze in der Firebase Console:"}),c.jsxs("div",{className:"p-4 bg-gray-900 rounded-xl font-mono text-sm",children:[c.jsx("p",{className:"text-gray-400",children:"Firestore  users  [user-id]"}),c.jsx("p",{className:"text-green-400 mt-2",children:"isAdmin: true"})]})]})]})},lae=()=>{const t=yr(),{user:e}=Jr(),[r,a]=V.useState(!1),[l,u]=V.useState(!0),[p,m]=V.useState("overview"),[v,w]=V.useState([]),[R,C]=V.useState([]),[A,O]=V.useState({totalUsers:0,totalRooms:0,activeRooms:0,totalFriendRequests:0}),[U,F]=V.useState(!1),[q,W]=V.useState(null),[H,X]=V.useState([]);V.useEffect(()=>{(async()=>{if(!(e!=null&&e.id)){u(!1);return}try{const ye=(await Bn(tt(De,"users",e.id))).data();(ye==null?void 0:ye.isAdmin)===!0&&(a(!0),await ne())}catch{}u(!1)})()},[e]);const ne=async()=>{try{const be=(await Cr(mn(De,"users"))).docs.map(St=>{var lt;return{id:St.id,username:St.data().username||"unknown",displayName:St.data().displayName||"Unbekannt",email:St.data().email,createdAt:((lt=St.data().createdAt)==null?void 0:lt.toDate())||new Date,level:St.data().level||1,isAdmin:St.data().isAdmin||!1}});w(be);const Ze=(await Cr(mn(De,"rooms"))).docs.map(St=>{var lt;return{id:St.id,name:St.data().name||"Unnamed",type:St.data().type||"public",participantCount:(St.data().participants||[]).length,createdAt:((lt=St.data().createdAt)==null?void 0:lt.toDate())||new Date,createdBy:St.data().createdBy||"unknown"}});C(Ze);const It=await Cr(mn(De,"friendRequests"));O({totalUsers:be.length,totalRooms:Ze.length,activeRooms:Ze.filter(St=>St.participantCount>0).length,totalFriendRequests:It.size}),te("Daten erfolgreich geladen")}catch{te("Fehler beim Laden der Daten")}},te=pe=>{const be=new Date().toLocaleTimeString("de-DE");X(ye=>[`[${be}] ${pe}`,...ye.slice(0,49)])},he=async()=>{F(!0),te("Starte Lschung aller Benutzer...");try{const pe=await Cr(mn(De,"users"));let be=0;for(const Le of pe.docs)Le.data().isAdmin||(await Tc(tt(De,"users",Le.id)),be++,te(`Benutzer gelscht: ${Le.id}`));const ye=await Cr(mn(De,"blocks"));for(const Le of ye.docs)await Tc(tt(De,"blocks",Le.id));te(`${ye.size} Block-Eintrge gelscht`);const Ze=await Cr(mn(De,"referrals"));let It=0;for(const Le of Ze.docs)pe.docs.find(Ke=>Ke.data().isAdmin&&Ke.id===Le.id)||(await Tc(tt(De,"referrals",Le.id)),It++);te(`${It} Referral-Eintrge gelscht`);const St=await Cr(mn(De,"friendRequests"));for(const Le of St.docs)await Tc(tt(De,"friendRequests",Le.id));te(`${St.size} Freundschaftsanfragen gelscht`);const lt=await Cr(mn(De,"notifications"));for(const Le of lt.docs)await Tc(tt(De,"notifications",Le.id));te(`${lt.size} Benachrichtigungen gelscht`),te(` ${be} Benutzer erfolgreich gelscht`),await ne()}catch{te(" Fehler beim Lschen der Benutzer")}F(!1),W(null)},J=async()=>{F(!0),te("Starte Lschung aller Wlkchen...");try{const pe=await Cr(mn(De,"rooms"));let be=0;for(const Ze of pe.docs)await Tc(tt(De,"rooms",Ze.id)),be++,te(`Wlkchen gelscht: ${Ze.data().name}`);const ye=await Cr(mn(De,"starEvents"));for(const Ze of ye.docs)await Tc(tt(De,"starEvents",Ze.id));te(`${ye.size} Star Events gelscht`),te(` ${be} Wlkchen erfolgreich gelscht`),await ne()}catch{te(" Fehler beim Lschen der Wlkchen")}F(!1),W(null)},Q=async()=>{F(!0),te(" KOMPLETTER RESET GESTARTET..."),await J(),await he(),te(" KOMPLETTER RESET ABGESCHLOSSEN"),F(!1)},ce=async pe=>{var be;try{if((be=(await Bn(tt(De,"users",pe))).data())!=null&&be.isAdmin){te(" Admin-Benutzer knnen nicht gelscht werden");return}await Tc(tt(De,"users",pe)),w(Ze=>Ze.filter(It=>It.id!==pe)),O(Ze=>({...Ze,totalUsers:Ze.totalUsers-1})),te(`Benutzer ${pe} gelscht`)}catch{te(`Fehler beim Lschen von ${pe}`)}},de=async(pe,be)=>{try{await Tc(tt(De,"rooms",pe)),C(ye=>ye.filter(Ze=>Ze.id!==pe)),O(ye=>({...ye,totalRooms:ye.totalRooms-1})),te(`Wlkchen "${be}" gelscht`)}catch{te(`Fehler beim Lschen von "${be}"`)}};return l?c.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:c.jsx(fi,{size:32,className:"animate-spin text-purple-500"})}):e?r?c.jsxs("div",{className:"min-h-screen bg-gray-900 text-white",children:[c.jsx("div",{className:"bg-gray-800 border-b border-gray-700 px-6 py-4",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-10 h-10 bg-purple-600 rounded-xl flex items-center justify-center",children:c.jsx(cs,{size:20})}),c.jsxs("div",{children:[c.jsx("h1",{className:"font-bold text-lg",children:"synclulu Admin Panel"}),c.jsxs("p",{className:"text-xs text-gray-400",children:["Eingeloggt als ",e.username]})]})]}),c.jsx("button",{onClick:()=>t("/"),className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",children:c.jsx(wW,{size:20})})]})}),c.jsx("div",{className:"bg-gray-800 border-b border-gray-700 px-6",children:c.jsx("div",{className:"flex gap-1",children:[{id:"overview",label:"bersicht",icon:dz},{id:"users",label:"Benutzer",icon:cr},{id:"rooms",label:"Wlkchen",icon:Xo},{id:"settings",label:"Einstellungen",icon:xO}].map(pe=>c.jsxs("button",{onClick:()=>m(pe.id),className:`flex items-center gap-2 px-4 py-3 font-medium text-sm transition-colors border-b-2 ${p===pe.id?"text-purple-400 border-purple-500":"text-gray-400 border-transparent hover:text-white"}`,children:[c.jsx(pe.icon,{size:16}),pe.label]},pe.id))})}),c.jsxs("div",{className:"p-6",children:[p==="overview"&&c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[c.jsxs("div",{className:"bg-gray-800 rounded-xl p-4",children:[c.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[c.jsx(cr,{size:20,className:"text-blue-400"}),c.jsx("span",{className:"text-gray-400 text-sm",children:"Benutzer"})]}),c.jsx("p",{className:"text-2xl font-bold",children:A.totalUsers})]}),c.jsxs("div",{className:"bg-gray-800 rounded-xl p-4",children:[c.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[c.jsx(Xo,{size:20,className:"text-purple-400"}),c.jsx("span",{className:"text-gray-400 text-sm",children:"Wlkchen"})]}),c.jsx("p",{className:"text-2xl font-bold",children:A.totalRooms})]}),c.jsxs("div",{className:"bg-gray-800 rounded-xl p-4",children:[c.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[c.jsx(dz,{size:20,className:"text-green-400"}),c.jsx("span",{className:"text-gray-400 text-sm",children:"Aktiv"})]}),c.jsx("p",{className:"text-2xl font-bold",children:A.activeRooms})]}),c.jsxs("div",{className:"bg-gray-800 rounded-xl p-4",children:[c.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[c.jsx(hz,{size:20,className:"text-amber-400"}),c.jsx("span",{className:"text-gray-400 text-sm",children:"Anfragen"})]}),c.jsx("p",{className:"text-2xl font-bold",children:A.totalFriendRequests})]})]}),c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[c.jsxs("h2",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[c.jsx(rh,{size:20,className:"text-red-400"}),"Gefhrliche Aktionen"]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[c.jsxs("button",{onClick:()=>W("users"),disabled:U,className:"p-4 bg-red-600/20 border border-red-600/50 rounded-xl text-left hover:bg-red-600/30 transition-colors disabled:opacity-50",children:[c.jsx(bO,{size:24,className:"text-red-400 mb-2"}),c.jsx("p",{className:"font-semibold text-red-400",children:"Alle Benutzer lschen"}),c.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Lscht ",A.totalUsers," Benutzer (auer Admins)"]})]}),c.jsxs("button",{onClick:()=>W("rooms"),disabled:U,className:"p-4 bg-orange-600/20 border border-orange-600/50 rounded-xl text-left hover:bg-orange-600/30 transition-colors disabled:opacity-50",children:[c.jsx(Lm,{size:24,className:"text-orange-400 mb-2"}),c.jsx("p",{className:"font-semibold text-orange-400",children:"Alle Wlkchen lschen"}),c.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Lscht ",A.totalRooms," Wlkchen"]})]}),c.jsxs("button",{onClick:Q,disabled:U,className:"p-4 bg-purple-600/20 border border-purple-600/50 rounded-xl text-left hover:bg-purple-600/30 transition-colors disabled:opacity-50",children:[c.jsx(hz,{size:24,className:"text-purple-400 mb-2"}),c.jsx("p",{className:"font-semibold text-purple-400",children:"KOMPLETTER RESET"}),c.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Alles lschen & neu starten"})]})]})]}),c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsx("h2",{className:"font-bold text-lg",children:"Aktivittslog"}),c.jsx("button",{onClick:ne,className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",children:c.jsx(_v,{size:16})})]}),c.jsx("div",{className:"bg-gray-900 rounded-lg p-4 h-64 overflow-y-auto font-mono text-xs",children:H.length===0?c.jsx("p",{className:"text-gray-500",children:"Noch keine Aktivitten"}):H.map((pe,be)=>c.jsx("div",{className:"py-1 text-gray-300",children:pe},be))})]})]}),p==="users"&&c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("h2",{className:"font-bold text-lg",children:["Benutzer (",v.length,")"]}),c.jsx("button",{onClick:ne,className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",children:c.jsx(_v,{size:16})})]}),c.jsx("div",{className:"bg-gray-800 rounded-xl overflow-hidden",children:v.length===0?c.jsx("div",{className:"p-8 text-center text-gray-400",children:"Keine Benutzer vorhanden"}):c.jsx("div",{className:"divide-y divide-gray-700",children:v.map(pe=>{var be;return c.jsxs("div",{className:"p-4 flex items-center justify-between hover:bg-gray-700/50",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${pe.isAdmin?"bg-amber-600/20":"bg-purple-600/20"}`,children:c.jsx("span",{className:`text-sm font-bold ${pe.isAdmin?"text-amber-400":"text-purple-400"}`,children:(be=pe.displayName[0])==null?void 0:be.toUpperCase()})}),c.jsxs("div",{children:[c.jsxs("p",{className:"font-medium flex items-center gap-2",children:[pe.displayName,pe.isAdmin&&c.jsx("span",{className:"px-1.5 py-0.5 bg-amber-600/20 text-amber-400 text-[10px] font-bold rounded",children:"ADMIN"})]}),c.jsxs("p",{className:"text-xs text-gray-400",children:["@",pe.username,"  Level ",pe.level]})]})]}),!pe.isAdmin&&c.jsx("button",{onClick:()=>ce(pe.id),className:"p-2 text-red-400 hover:bg-red-600/20 rounded-lg transition-colors",children:c.jsx(Lm,{size:16})})]},pe.id)})})})]}),p==="rooms"&&c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("h2",{className:"font-bold text-lg",children:["Wlkchen (",R.length,")"]}),c.jsx("button",{onClick:ne,className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",children:c.jsx(_v,{size:16})})]}),c.jsx("div",{className:"bg-gray-800 rounded-xl overflow-hidden",children:R.length===0?c.jsx("div",{className:"p-8 text-center text-gray-400",children:"Keine Wlkchen vorhanden"}):c.jsx("div",{className:"divide-y divide-gray-700",children:R.map(pe=>c.jsxs("div",{className:"p-4 flex items-center justify-between hover:bg-gray-700/50",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-600/20 flex items-center justify-center",children:c.jsx(Xo,{size:20,className:"text-blue-400"})}),c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:pe.name}),c.jsxs("p",{className:"text-xs text-gray-400",children:[pe.type,"  ",pe.participantCount," Teilnehmer"]})]})]}),c.jsx("button",{onClick:()=>de(pe.id,pe.name),className:"p-2 text-red-400 hover:bg-red-600/20 rounded-lg transition-colors",children:c.jsx(Lm,{size:16})})]},pe.id))})})]}),p==="settings"&&c.jsx(Uze,{user:e,addLog:te})]}),q&&c.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-6 bg-black/80",children:c.jsxs("div",{className:"w-full max-w-md bg-gray-800 rounded-2xl p-6",children:[c.jsxs("div",{className:"text-center mb-6",children:[c.jsx("div",{className:"w-16 h-16 bg-red-600/20 rounded-2xl flex items-center justify-center mx-auto mb-4",children:c.jsx(rh,{size:32,className:"text-red-500"})}),c.jsx("h2",{className:"text-xl font-bold mb-2",children:"Bist du sicher?"}),c.jsx("p",{className:"text-gray-400",children:q==="users"?`${A.totalUsers} Benutzer werden unwiderruflich gelscht (auer Admins).`:`${A.totalRooms} Wlkchen werden unwiderruflich gelscht.`})]}),c.jsxs("div",{className:"flex gap-3",children:[c.jsx("button",{onClick:()=>W(null),disabled:U,className:"flex-1 py-3 bg-gray-700 text-white rounded-xl font-semibold",children:"Abbrechen"}),c.jsx("button",{onClick:q==="users"?he:J,disabled:U,className:"flex-1 py-3 bg-red-600 text-white rounded-xl font-semibold flex items-center justify-center gap-2",children:U?c.jsxs(c.Fragment,{children:[c.jsx(fi,{size:18,className:"animate-spin"}),"Lsche..."]}):c.jsxs(c.Fragment,{children:[c.jsx(Lm,{size:18}),"Lschen"]})})]})]})})]}):c.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-6",children:c.jsxs("div",{className:"text-center max-w-md",children:[c.jsx("div",{className:"w-20 h-20 mx-auto bg-red-600/20 rounded-2xl flex items-center justify-center mb-6",children:c.jsx(cs,{size:40,className:"text-red-500"})}),c.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Zugriff verweigert"}),c.jsx("p",{className:"text-gray-400 mb-6",children:"Du hast keine Admin-Berechtigung. Admin-Rechte werden ber die Firestore-Datenbank vergeben."}),c.jsxs("div",{className:"p-4 bg-gray-800 rounded-xl text-left mb-6",children:[c.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"So wirst du Admin:"}),c.jsx("code",{className:"text-xs text-green-400 block",children:"Firestore  users  [deine-id]  isAdmin: true"})]}),c.jsx("button",{onClick:()=>t("/"),className:"px-6 py-3 bg-purple-600 text-white rounded-xl font-semibold",children:"Zur Startseite"})]})}):c.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-6",children:c.jsxs("div",{className:"text-center",children:[c.jsx(cs,{size:64,className:"mx-auto text-red-500 mb-4"}),c.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Zugriff verweigert"}),c.jsx("p",{className:"text-gray-400 mb-6",children:"Du musst eingeloggt sein."}),c.jsx("button",{onClick:()=>t("/"),className:"px-6 py-3 bg-purple-600 text-white rounded-xl font-semibold",children:"Zur Startseite"})]})})},dae=[{minLevel:1,maxLevel:9,name:"Newcomer",nameDE:"Neuling",emoji:"",frameStyle:"border-2 border-gray-300",glowColor:"transparent",glowIntensity:0,nameEffect:"none",backgroundEffect:"none",badgeStyle:"bg-gray-200 text-gray-600",particles:null},{minLevel:10,maxLevel:24,name:"Beginner",nameDE:"Anfnger",emoji:"",frameStyle:"border-2 border-blue-400",glowColor:"#60A5FA",glowIntensity:5,nameEffect:"none",backgroundEffect:"none",badgeStyle:"bg-blue-100 text-blue-600",particles:null},{minLevel:25,maxLevel:49,name:"Explorer",nameDE:"Entdecker",emoji:"",frameStyle:"border-3 border-green-500",glowColor:"#22C55E",glowIntensity:8,nameEffect:"gradient",backgroundEffect:"none",badgeStyle:"bg-green-100 text-green-600",particles:{type:"sparkles",count:5,speed:1,size:4,colors:["#22C55E","#4ADE80"]}},{minLevel:50,maxLevel:99,name:"Adventurer",nameDE:"Abenteurer",emoji:"",frameStyle:"border-3 border-purple-500 ring-2 ring-purple-300",glowColor:"#A855F7",glowIntensity:12,nameEffect:"gradient",backgroundEffect:"particles",badgeStyle:"bg-purple-100 text-purple-600",particles:{type:"sparkles",count:10,speed:1.5,size:5,colors:["#A855F7","#C084FC","#E879F9"]}},{minLevel:100,maxLevel:149,name:"Champion",nameDE:"Champion",emoji:"",frameStyle:"border-4 border-amber-500 ring-4 ring-amber-300",glowColor:"#F59E0B",glowIntensity:18,nameEffect:"shimmer",backgroundEffect:"stars",badgeStyle:"bg-gradient-to-r from-amber-400 to-yellow-500 text-white",particles:{type:"stars",count:15,speed:2,size:6,colors:["#F59E0B","#FBBF24","#FCD34D"]}},{minLevel:150,maxLevel:199,name:"Master",nameDE:"Meister",emoji:"",frameStyle:"border-4 border-orange-500 ring-4 ring-orange-400 ring-offset-2",glowColor:"#F97316",glowIntensity:22,nameEffect:"shimmer",backgroundEffect:"aurora",badgeStyle:"bg-gradient-to-r from-orange-500 to-red-500 text-white",particles:{type:"fire",count:20,speed:2.5,size:7,colors:["#F97316","#EF4444","#FCD34D"]}},{minLevel:200,maxLevel:299,name:"Grandmaster",nameDE:"Gromeister",emoji:"",frameStyle:"border-4 border-pink-500 ring-4 ring-pink-400 ring-offset-4 ring-offset-pink-100",glowColor:"#EC4899",glowIntensity:28,nameEffect:"rainbow",backgroundEffect:"aurora",badgeStyle:"bg-gradient-to-r from-pink-500 via-purple-500 to-indigo-500 text-white",particles:{type:"hearts",count:25,speed:3,size:8,colors:["#EC4899","#F472B6","#F9A8D4"]}},{minLevel:300,maxLevel:399,name:"Legend",nameDE:"Legende",emoji:"",frameStyle:"border-[6px] border-transparent bg-gradient-to-r from-violet-500 via-purple-500 to-pink-500 p-[3px]",glowColor:"#8B5CF6",glowIntensity:35,nameEffect:"rainbow",backgroundEffect:"nebula",badgeStyle:"bg-gradient-to-r from-violet-600 via-purple-600 to-pink-600 text-white animate-pulse",particles:{type:"cosmic",count:30,speed:3.5,size:10,colors:["#8B5CF6","#A855F7","#D946EF","#EC4899"]}},{minLevel:400,maxLevel:499,name:"Mythic",nameDE:"Mythisch",emoji:"",frameStyle:"border-[8px] border-transparent bg-gradient-to-r from-red-500 via-yellow-500 via-green-500 via-blue-500 to-purple-500 p-[4px] animate-gradient",glowColor:"#FFD700",glowIntensity:45,nameEffect:"holographic",backgroundEffect:"cosmic",badgeStyle:"bg-gradient-to-r from-red-500 via-yellow-500 to-green-500 text-white animate-gradient",particles:{type:"cosmic",count:40,speed:4,size:12,colors:["#EF4444","#F59E0B","#22C55E","#3B82F6","#8B5CF6"]}},{minLevel:500,maxLevel:500,name:"synclulu God",nameDE:"synclulu Gott",emoji:"",frameStyle:"border-[10px] border-transparent bg-gradient-conic from-red-500 via-yellow-500 via-green-500 via-blue-500 via-purple-500 to-red-500 p-[5px] animate-spin-slow",glowColor:"#FFFFFF",glowIntensity:60,nameEffect:"holographic",backgroundEffect:"cosmic",badgeStyle:"bg-gradient-conic from-red-500 via-yellow-500 via-green-500 via-blue-500 to-purple-500 text-white animate-gradient shadow-2xl",particles:{type:"cosmic",count:60,speed:5,size:15,colors:["#FFFFFF","#FFD700","#FF69B4","#00CED1","#9400D3"]}}],nS=t=>dae.find(r=>t>=r.minLevel&&t<=r.maxLevel)||dae[0],Vze=t=>{const e=nS(t);return{boxShadow:e.glowIntensity>0?`0 0 ${e.glowIntensity}px ${e.glowIntensity/2}px ${e.glowColor}`:"none"}},Fze=t=>nS(t).frameStyle,Bze=t=>{switch(nS(t).nameEffect){case"gradient":return"bg-gradient-to-r from-violet-600 to-pink-600 bg-clip-text text-transparent";case"shimmer":return"bg-gradient-to-r from-amber-200 via-yellow-300 to-amber-200 bg-clip-text text-transparent animate-shimmer bg-[length:200%_100%]";case"rainbow":return"bg-gradient-to-r from-red-500 via-yellow-500 via-green-500 via-blue-500 to-purple-500 bg-clip-text text-transparent animate-gradient bg-[length:200%_100%]";case"fire":return"bg-gradient-to-r from-red-500 via-orange-500 to-yellow-500 bg-clip-text text-transparent animate-fire";case"holographic":return"bg-gradient-conic from-red-500 via-yellow-500 via-green-500 via-blue-500 via-purple-500 to-red-500 bg-clip-text text-transparent animate-holographic bg-[length:100%_100%]";default:return""}},zze=t=>nS(t).badgeStyle,Gze=t=>nS(t).particles,vf={user:{tier:"user",name:"User",nameDE:"Nutzer",emoji:"",minFollowers:0,minInvites:0,minLevel:1,color:"#9CA3AF",glowColor:"transparent",features:["basic_profile","private_clouds"],revenueShare:0},rising:{tier:"rising",name:"Rising",nameDE:"Aufsteiger",emoji:"",minFollowers:25,minInvites:3,minLevel:10,color:"#60A5FA",glowColor:"#60A5FA40",features:["animated_avatar","custom_status","locked_content"],revenueShare:10},creator:{tier:"creator",name:"Creator",nameDE:"Creator",emoji:"",minFollowers:100,minInvites:10,minLevel:25,color:"#A78BFA",glowColor:"#A78BFA50",features:["public_cloud","analytics_basic","custom_header","priority_support"],revenueShare:20},star:{tier:"star",name:"synclulu Star",nameDE:"synclulu Star",emoji:"",minFollowers:500,minInvites:25,minLevel:50,color:"#FBBF24",glowColor:"#FBBF2460",features:["verified_badge","creator_quests","monetization","analytics_advanced"],revenueShare:40},legend:{tier:"legend",name:"Legend",nameDE:"Legende",emoji:"",minFollowers:2e3,minInvites:100,minLevel:100,color:"#F472B6",glowColor:"#F472B670",features:["custom_effects","exclusive_events","direct_monetization"],revenueShare:60},icon:{tier:"icon",name:"synclulu Icon",nameDE:"synclulu Icon",emoji:"",minFollowers:1e4,minInvites:500,minLevel:200,color:"#DC2626",glowColor:"#DC262680",features:["legendary_effects","partnership","revenue_priority"],revenueShare:80}},c9={name:"synclulu Coins",symbol:"",exchangeRate:100,unlockCost:50,packages:[{coins:100,priceEUR:.99,bonus:0},{coins:500,priceEUR:4.49,bonus:50},{coins:1200,priceEUR:9.99,bonus:200},{coins:3e3,priceEUR:19.99,bonus:750},{coins:8e3,priceEUR:49.99,bonus:2500}]},Wze=(t,e,r,a)=>{const l=["user","rising","creator","star","legend","icon"],u=l.indexOf(t);if(u===l.length-1)return{nextTier:null,followersProgress:100,invitesProgress:100,levelProgress:100,overallProgress:100};const p=l[u+1],m=vf[p],v=vf[t],w=m.minFollowers-v.minFollowers,R=m.minInvites-v.minInvites,C=m.minLevel-v.minLevel,A=Math.min(100,(e-v.minFollowers)/w*100),O=Math.min(100,(r-v.minInvites)/R*100),U=Math.min(100,(a-v.minLevel)/C*100);return{nextTier:p,followersProgress:A,invitesProgress:O,levelProgress:U,overallProgress:(A+O+U)/3}},Hze=async t=>{var e,r;try{const a=tt(De,"creatorProfiles",t),l=await Bn(a);if(!l.exists())return null;const u=l.data();return{...u,createdAt:((e=u.createdAt)==null?void 0:e.toDate())||new Date,updatedAt:((r=u.updatedAt)==null?void 0:r.toDate())||new Date}}catch(a){return console.error("Error getting creator profile:",a),null}},Kze=({config:t,size:e})=>{const r=V.useRef(null);return V.useEffect(()=>{const a=r.current;if(!a)return;const l=a.getContext("2d");if(!l)return;const u=[];for(let v=0;v<t.count;v++)u.push({x:Math.random()*e,y:Math.random()*e,size:Math.random()*t.size+2,speedX:(Math.random()-.5)*t.speed,speedY:(Math.random()-.5)*t.speed-.5,color:t.colors[Math.floor(Math.random()*t.colors.length)],opacity:Math.random()*.8+.2});const p=()=>{l.clearRect(0,0,e,e),u.forEach(v=>{if(l.beginPath(),t.type==="sparkles"||t.type==="stars"){const w=t.type==="stars"?5:4,R=v.size,C=v.size/2;for(let A=0;A<w*2;A++){const O=A%2===0?R:C,U=A*Math.PI/w,F=v.x+Math.cos(U)*O,q=v.y+Math.sin(U)*O;A===0?l.moveTo(F,q):l.lineTo(F,q)}l.closePath()}else t.type,l.arc(v.x,v.y,v.size/2,0,Math.PI*2);l.fillStyle=v.color+Math.floor(v.opacity*255).toString(16).padStart(2,"0"),l.fill(),v.x+=v.speedX,v.y+=v.speedY,v.opacity-=.005,(v.x<0||v.x>e||v.y<0||v.y>e||v.opacity<=0)&&(v.x=e/2+(Math.random()-.5)*e/2,v.y=e/2+(Math.random()-.5)*e/2,v.opacity=Math.random()*.8+.2)}),requestAnimationFrame(p)},m=requestAnimationFrame(p);return()=>cancelAnimationFrame(m)},[t,e]),c.jsx("canvas",{ref:r,width:e,height:e,className:"absolute inset-0 pointer-events-none z-10"})},qze=({avatarUrl:t,avatarId:e="pegasus",level:r,creatorTier:a,isVerified:l=!1,size:u="md",showName:p=!1,name:m,showLevel:v=!1,showParticles:w=!0,className:R="",onClick:C})=>{const A=nS(r),O=Gze(r),U={sm:"w-10 h-10",md:"w-14 h-14",lg:"w-20 h-20",xl:"w-28 h-28","2xl":"w-36 h-36"},F={sm:40,md:56,lg:80,xl:112,"2xl":144},W=t||null;return c.jsxs("div",{className:`relative inline-flex flex-col items-center ${R}`,onClick:C,children:[A.glowIntensity>0&&c.jsx("div",{className:`absolute rounded-full ${U[u]}`,style:{background:A.glowColor,filter:`blur(${A.glowIntensity}px)`,opacity:.5,animation:"pulse 2s ease-in-out infinite"}}),w&&O&&u!=="sm"&&c.jsx(Kze,{config:O,size:F[u]*1.5}),c.jsxs("div",{className:`relative ${U[u]} rounded-full overflow-visible cursor-pointer transition-transform hover:scale-105`,style:Vze(r),children:[c.jsx("div",{className:`absolute inset-0 rounded-full ${Fze(r)}`}),c.jsx("div",{className:"absolute inset-[4px] rounded-full overflow-hidden bg-gradient-to-br from-gray-700 to-gray-900",children:W?c.jsx("img",{src:W,alt:"Avatar",className:"w-full h-full object-cover"}):c.jsx("div",{className:"w-full h-full flex items-center justify-center text-2xl",children:e==="pegasus"?"":e==="phoenix"?"":""})}),l&&c.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center border-2 border-gray-900 shadow-lg",children:c.jsx("span",{className:"text-xs",children:""})}),a&&a!=="user"&&c.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 rounded-full flex items-center justify-center border-2 border-gray-900 shadow-lg text-sm",style:{backgroundColor:vf[a].color},children:vf[a].emoji})]}),v&&c.jsxs("div",{className:`mt-1 px-2 py-0.5 rounded-full text-xs font-bold ${zze(r)}`,children:[A.emoji," Lv. ",r]}),p&&m&&c.jsx("p",{className:`mt-2 font-bold text-center ${u==="sm"?"text-xs":u==="md"?"text-sm":"text-base"} ${Bze(r)}`,children:m})]})},ww={defaultUnlockCost:50,minUnlockCost:10,maxUnlockCost:500,invitesForFreeUnlock:1,platformFee:.2,blurIntensity:20,previewTextLength:50},rS=async t=>{var e;try{const r=tt(De,"wallets",t),a=await Bn(r);if(!a.exists())return null;const l=a.data();return{...l,lastUpdated:((e=l.lastUpdated)==null?void 0:e.toDate())||new Date,transactions:(l.transactions||[]).map(u=>{var p;return{...u,createdAt:((p=u.createdAt)==null?void 0:p.toDate())||new Date}})}}catch(r){return console.error("Error getting wallet:",r),null}},l9=async t=>{const e={userId:t,balance:0,totalEarned:0,totalSpent:0,transactions:[],lastUpdated:new Date},r=tt(De,"wallets",t);return await Yi(r,{...e,lastUpdated:fn.fromDate(e.lastUpdated)}),e},d9=async(t,e,r,a="purchase")=>{try{let l=await rS(t);l||(l=await l9(t));const u={id:`tx_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:a,amount:e,description:r,createdAt:new Date},p=tt(De,"wallets",t);return await Xn(p,{balance:Ss(e),totalEarned:Ss(a==="earn"?e:0),transactions:[...l.transactions.slice(-49),{...u,createdAt:fn.fromDate(u.createdAt)}],lastUpdated:fn.fromDate(new Date)}),!0}catch(l){return console.error("Error adding coins:",l),!1}},u9=async(t,e,r,a)=>{try{const l=await rS(t);if(!l||l.balance<e)return!1;const u={id:`tx_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"spend",amount:-e,description:r,relatedContentId:a,createdAt:new Date},p=tt(De,"wallets",t);return await Xn(p,{balance:Ss(-e),totalSpent:Ss(e),transactions:[...l.transactions.slice(-49),{...u,createdAt:fn.fromDate(u.createdAt)}],lastUpdated:fn.fromDate(new Date)}),!0}catch(l){return console.error("Error spending coins:",l),!1}},h9=async(t,e,r)=>{try{const a=mn(De,"lockedContent");return(await Lv(a,{...r,creatorId:t,creatorUsername:e,totalUnlocks:0,totalRevenue:0,createdAt:fn.fromDate(new Date)})).id}catch(a){return console.error("Error creating locked content:",a),null}},OO=async t=>{var e,r;try{const a=tt(De,"lockedContent",t),l=await Bn(a);if(!l.exists())return null;const u=l.data();return{id:l.id,...u,createdAt:((e=u.createdAt)==null?void 0:e.toDate())||new Date,expiresAt:(r=u.expiresAt)==null?void 0:r.toDate()}}catch(a){return console.error("Error getting locked content:",a),null}},nge=async(t,e=20)=>{try{const r=mn(De,"lockedContent"),a=Mr(r,Kn("creatorId","==",t),Kn("isActive","==",!0),ih("createdAt","desc"),up(e));return(await Cr(a)).docs.map(u=>{var p,m;return{id:u.id,...u.data(),createdAt:((p=u.data().createdAt)==null?void 0:p.toDate())||new Date,expiresAt:(m=u.data().expiresAt)==null?void 0:m.toDate()}})}catch(r){return console.error("Error getting creator content:",r),[]}},p9=async(t,e)=>{try{const r=tt(De,"contentUnlocks",`${t}_${e}`);return(await Bn(r)).exists()}catch{return!1}},f9=async t=>{try{const r=(await fI(t)).totalReferrals,a=mn(De,"contentUnlocks"),l=Mr(a,Kn("userId","==",t),Kn("method","==","referral")),p=(await Cr(l)).docs.reduce((m,v)=>m+(v.data().invitesUsed||0),0);return Math.max(0,r-p)}catch(e){return console.error("Error calculating free unlocks:",e),0}},rge=async(t,e,r)=>{var a,l;try{if(await p9(t,e)){const O=await OO(e);return{success:!0,content:O==null?void 0:O.content}}const p=await OO(e);if(!p)return{success:!1,error:"Inhalt nicht gefunden"};if(!p.unlockMethods.includes(r))return{success:!1,error:"Diese Unlock-Methode ist nicht verfgbar"};let m=0,v=0,w=0;if(r==="coins"){const O=await rS(t);if(!O||O.balance<p.unlockCost)return{success:!1,error:"Nicht gengend Coins"};if(!await u9(t,p.unlockCost,`Unlock: ${p.title}`,e))return{success:!1,error:"Zahlung fehlgeschlagen"};m=p.unlockCost;const q=((a=(await Bn(tt(De,"creatorProfiles",p.creatorId))).data())==null?void 0:a.tier)||"user",W=vf[q].revenueShare/100;w=Math.floor(m*W),w>0&&await d9(p.creatorId,w,`Unlock-Einnahmen: ${p.title}`,"earn")}else if(r==="referral"){const O=await f9(t);if(O<p.requiresInvites)return{success:!1,error:`Du brauchst ${p.requiresInvites} erfolgreiche Einladung(en). Du hast ${O} verfgbar.`};v=p.requiresInvites}else if(r==="premium"&&!((l=(await Bn(tt(De,"users",t))).data())!=null&&l.isPremium))return{success:!1,error:"Premium-Mitgliedschaft erforderlich"};const R=tt(De,"contentUnlocks",`${t}_${e}`);await Yi(R,{contentId:e,userId:t,method:r,coinsPaid:m,invitesUsed:v,creatorRevenue:w,unlockedAt:fn.fromDate(new Date)});const C=tt(De,"lockedContent",e);await Xn(C,{totalUnlocks:Ss(1),totalRevenue:Ss(m)});const A=tt(De,"creatorProfiles",p.creatorId);return await Xn(A,{totalUnlocks:Ss(1),totalRevenue:Ss(w)}),{success:!0,content:p.content}}catch(u){return console.error("Error unlocking content:",u),{success:!1,error:"Fehler beim Entsperren"}}},ige=t=>t.length<=ww.previewTextLength?t:t.substring(0,ww.previewTextLength)+"...",sge=t=>t?{filter:`blur(${ww.blurIntensity}px)`,WebkitFilter:`blur(${ww.blurIntensity}px)`,userSelect:"none",pointerEvents:"none"}:{},Yze={LOCK_CONFIG:ww,CURRENCY_CONFIG:c9,getUserWallet:rS,initializeWallet:l9,addCoins:d9,spendCoins:u9,createLockedContent:h9,getLockedContent:OO,getCreatorLockedContent:nge,hasUnlockedContent:p9,getAvailableFreeUnlocks:f9,unlockContent:rge,generatePreviewText:ige,getBlurStyle:sge},$ze=Object.freeze(Object.defineProperty({__proto__:null,CURRENCY_CONFIG:c9,LOCK_CONFIG:ww,addCoins:d9,createLockedContent:h9,default:Yze,generatePreviewText:ige,getAvailableFreeUnlocks:f9,getBlurStyle:sge,getCreatorLockedContent:nge,getLockedContent:OO,getUserWallet:rS,hasUnlockedContent:p9,initializeWallet:l9,spendCoins:u9,unlockContent:rge},Symbol.toStringTag,{value:"Module"})),uae=()=>{const t=yr(),{user:e}=Jr(),[r,a]=V.useState(null),[l,u]=V.useState([]),[p,m]=V.useState(0),[v,w]=V.useState({totalReferrals:0,xpEarned:0}),[R,C]=V.useState(!0);V.useEffect(()=>{A()},[e==null?void 0:e.id]);const A=async()=>{if(e!=null&&e.id){C(!0);try{const W=await Hze(e.id);a(W);const H=await rS(e.id);m((H==null?void 0:H.balance)||0);const X=await fI(e.id);w(X);const ne=mn(De,"lockedContent"),te=Mr(ne,Kn("creatorId","==",e.id),ih("createdAt","desc"),up(10)),he=await Cr(te);u(he.docs.map(J=>{var Q;return{id:J.id,...J.data(),createdAt:((Q=J.data().createdAt)==null?void 0:Q.toDate())||new Date}}))}catch(W){console.error("Error loading dashboard:",W)}C(!1)}},O=(r==null?void 0:r.tier)||"user",U=vf[O],F=(e==null?void 0:e.level)||1,q=Wze(O,(r==null?void 0:r.followerCount)||0,(r==null?void 0:r.successfulInvites)||0,F);return R?c.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500"})}):c.jsxs("div",{className:"min-h-screen bg-gray-900 text-white pb-24",children:[c.jsx("div",{className:"bg-gradient-to-b from-purple-900/50 to-transparent",children:c.jsxs("div",{className:"px-4 py-6 safe-top",children:[c.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[c.jsx("button",{onClick:()=>t(-1),className:"w-10 h-10 bg-white/10 rounded-xl flex items-center justify-center",children:c.jsx(Eo,{size:20})}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-2xl font-bold",children:"Creator Dashboard"}),c.jsx("p",{className:"text-sm text-white/60",children:"Deine Statistiken & Verdienste"})]})]}),c.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-2xl p-6 border border-white/10",children:[c.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[c.jsx(qze,{avatarUrl:e==null?void 0:e.avatarUrl,level:F,creatorTier:O,isVerified:r==null?void 0:r.isVerified,size:"xl",showParticles:!0}),c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[c.jsx("h2",{className:"text-xl font-bold",children:e==null?void 0:e.displayName}),(r==null?void 0:r.isVerified)&&c.jsx("span",{className:"text-purple-400",children:""})]}),c.jsxs("p",{className:"text-white/60 mb-2",children:["@",e==null?void 0:e.username]}),c.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-semibold",style:{backgroundColor:`${U.color}20`,color:U.color},children:[c.jsx("span",{children:U.emoji}),c.jsx("span",{children:U.nameDE})]})]})]}),q.nextTier&&c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center justify-between text-sm",children:[c.jsx("span",{className:"text-white/60",children:"Nchstes Level"}),c.jsxs("span",{style:{color:vf[q.nextTier].color},children:[vf[q.nextTier].emoji," ",vf[q.nextTier].nameDE]})]}),c.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between text-xs text-white/50 mb-1",children:[c.jsx("span",{children:"Follower"}),c.jsxs("span",{children:[Math.round(q.followersProgress),"%"]})]}),c.jsx("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full bg-blue-500 transition-all",style:{width:`${q.followersProgress}%`}})})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between text-xs text-white/50 mb-1",children:[c.jsx("span",{children:"Invites"}),c.jsxs("span",{children:[Math.round(q.invitesProgress),"%"]})]}),c.jsx("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full bg-green-500 transition-all",style:{width:`${q.invitesProgress}%`}})})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between text-xs text-white/50 mb-1",children:[c.jsx("span",{children:"Level"}),c.jsxs("span",{children:[Math.round(q.levelProgress),"%"]})]}),c.jsx("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full bg-purple-500 transition-all",style:{width:`${q.levelProgress}%`}})})]})]})]})]})]})}),c.jsxs("div",{className:"px-4 space-y-6",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{className:"bg-gradient-to-br from-blue-500/20 to-cyan-500/20 rounded-2xl p-4 border border-blue-500/30",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx(cr,{size:20,className:"text-blue-400"}),c.jsx("span",{className:"text-white/60 text-sm",children:"Follower"})]}),c.jsx("p",{className:"text-3xl font-bold",children:(r==null?void 0:r.followerCount)||0})]}),c.jsxs("div",{className:"bg-gradient-to-br from-purple-500/20 to-pink-500/20 rounded-2xl p-4 border border-purple-500/30",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx(Pl,{size:20,className:"text-purple-400"}),c.jsx("span",{className:"text-white/60 text-sm",children:"Cloud Reach"})]}),c.jsx("p",{className:"text-3xl font-bold",children:(r==null?void 0:r.cloudReach)||0})]}),c.jsxs("div",{className:"bg-gradient-to-br from-green-500/20 to-emerald-500/20 rounded-2xl p-4 border border-green-500/30",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx(_o,{size:20,className:"text-green-400"}),c.jsx("span",{className:"text-white/60 text-sm",children:"Referrals"})]}),c.jsx("p",{className:"text-3xl font-bold",children:v.totalReferrals})]}),c.jsxs("div",{className:"bg-gradient-to-br from-amber-500/20 to-orange-500/20 rounded-2xl p-4 border border-amber-500/30",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx(yo,{size:20,className:"text-amber-400"}),c.jsx("span",{className:"text-white/60 text-sm",children:"Unlocks"})]}),c.jsx("p",{className:"text-3xl font-bold",children:(r==null?void 0:r.totalUnlocks)||0})]})]}),c.jsxs("div",{className:"bg-gradient-to-r from-amber-600/20 to-yellow-600/20 rounded-2xl p-6 border border-amber-500/30",children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-12 h-12 rounded-xl bg-amber-500/30 flex items-center justify-center",children:c.jsx(uz,{size:24,className:"text-amber-400"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-white/60 text-sm",children:"Dein Guthaben"}),c.jsxs("p",{className:"text-2xl font-bold text-amber-400",children:[" ",p]})]})]}),c.jsx("button",{className:"px-4 py-2 bg-amber-500 text-white font-semibold rounded-xl",children:"Auszahlen"})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{className:"bg-white/5 rounded-xl p-3",children:[c.jsx("p",{className:"text-white/50 text-xs mb-1",children:"Gesamt verdient"}),c.jsxs("p",{className:"font-bold text-white",children:[" ",(r==null?void 0:r.totalRevenue)||0]})]}),c.jsxs("div",{className:"bg-white/5 rounded-xl p-3",children:[c.jsxs("p",{className:"text-white/50 text-xs mb-1",children:["Anteil (",U.revenueShare,"%)"]}),c.jsxs("p",{className:"font-bold text-green-400",children:["+",U.revenueShare,"%"]})]})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsxs("h2",{className:"font-bold text-lg flex items-center gap-2",children:[c.jsx(yo,{size:20,className:"text-purple-400"}),"Deine Secret Bubbles"]}),c.jsxs("button",{onClick:()=>t("/creator/new-content"),className:"flex items-center gap-1 text-purple-400 text-sm",children:[c.jsx(Ew,{size:16}),"Erstellen"]})]}),l.length===0?c.jsxs("div",{className:"bg-white/5 rounded-2xl p-8 text-center",children:[c.jsx(yo,{size:48,className:"mx-auto text-white/20 mb-4"}),c.jsx("h3",{className:"font-semibold mb-2",children:"Noch keine Secret Bubbles"}),c.jsx("p",{className:"text-white/50 text-sm mb-4",children:"Erstelle exklusive Inhalte und verdiene an Unlocks!"}),c.jsx("button",{onClick:()=>t("/creator/new-content"),className:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl font-semibold",children:"Ersten Content erstellen"})]}):c.jsx("div",{className:"space-y-4",children:l.map(W=>c.jsxs("div",{className:"bg-white/5 rounded-2xl p-4",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsx("h3",{className:"font-semibold",children:W.title}),c.jsxs("span",{className:"text-sm text-white/50",children:[W.totalUnlocks," Unlocks"]})]}),c.jsxs("div",{className:"flex items-center gap-4 text-sm text-white/60",children:[c.jsxs("span",{className:"flex items-center gap-1",children:[c.jsx(uz,{size:14})," ",W.unlockCost," Coins"]}),c.jsxs("span",{className:"flex items-center gap-1",children:[c.jsx(Pl,{size:14})," ",W.totalUnlocks," Views"]}),c.jsxs("span",{className:"flex items-center gap-1",children:[c.jsx(fd,{size:14})," ",W.totalRevenue," verdient"]})]})]},W.id))})]}),c.jsxs("div",{className:"bg-white/5 rounded-2xl p-6",children:[c.jsxs("h2",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[c.jsx(kn,{size:20,className:"text-amber-400"}),"Deine Creator-Features"]}),c.jsx("div",{className:"space-y-3",children:U.features.map(W=>c.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/5 rounded-xl",children:[c.jsx("div",{className:"w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center",children:c.jsx(Vs,{size:16,className:"text-green-400"})}),c.jsx("span",{className:"capitalize",children:W.replace(/_/g," ")})]},W))}),q.nextTier&&c.jsxs("div",{className:"mt-4 p-4 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-xl border border-purple-500/30",children:[c.jsx("p",{className:"text-sm text-purple-300 mb-2",children:"Nchste Stufe schaltet frei:"}),c.jsx("div",{className:"flex flex-wrap gap-2",children:vf[q.nextTier].features.filter(W=>!U.features.includes(W)).map(W=>c.jsx("span",{className:"px-2 py-1 bg-purple-500/20 text-purple-300 text-xs rounded-full capitalize",children:W.replace(/_/g," ")},W))})]})]})]})]})},Cm={maxFileSizeMB:5,maxFileSizeBytes:5*1024*1024,allowedTypes:["image/jpeg","image/png","image/gif","image/webp"],profilePicture:{maxWidth:500,maxHeight:500,quality:.85,folder:"profile-pictures"},headerImage:{maxWidth:1200,maxHeight:400,quality:.85,folder:"header-images"},lockedContent:{maxWidth:1920,maxHeight:1080,quality:.9,folder:"locked-content"},thumbnails:{width:200,height:200,quality:.6,blur:20,folder:"thumbnails"}},Xze=async(t,e,r,a)=>new Promise((l,u)=>{const p=new Image,m=document.createElement("canvas"),v=m.getContext("2d");p.onload=()=>{let w=p.width,R=p.height;w>e&&(R=R*e/w,w=e),R>r&&(w=w*r/R,R=r),m.width=w,m.height=R,v==null||v.drawImage(p,0,0,w,R),m.toBlob(C=>{C?l(C):u(new Error("Failed to process image"))},"image/jpeg",a)},p.onerror=()=>u(new Error("Failed to load image")),p.src=URL.createObjectURL(t)}),Jze=async(t,e=Cm.thumbnails.width,r=Cm.thumbnails.height,a=Cm.thumbnails.blur)=>new Promise((l,u)=>{const p=new Image,m=document.createElement("canvas"),v=m.getContext("2d");p.onload=()=>{const w=e/r;let R=0,C=0,A=p.width,O=p.height;p.width/p.height>w?(A=p.height*w,R=(p.width-A)/2):(O=p.width/w,C=(p.height-O)/2),m.width=e,m.height=r,v&&(v.filter=`blur(${a}px)`,v.drawImage(p,R,C,A,O,-a,-a,e+a*2,r+a*2)),m.toBlob(U=>{U?l(U):u(new Error("Failed to create thumbnail"))},"image/jpeg",Cm.thumbnails.quality)},p.onerror=()=>u(new Error("Failed to load image")),p.src=URL.createObjectURL(t)}),Qze=async(t,e,r)=>{try{if(!Cm.allowedTypes.includes(t.type))return{success:!1,error:"Ungltiger Dateityp. Erlaubt: JPG, PNG, GIF, WebP"};if(t.size>Cm.maxFileSizeBytes)return{success:!1,error:`Datei zu gro. Maximum: ${Cm.maxFileSizeMB}MB`};const a=Cm[r],l=Qhe(),u=await Xze(t,a.maxWidth,a.maxHeight,a.quality),p=Date.now(),v=`${e}_${p}.jpg`,w=`${a.folder}/${v}`,R=yO(l,w);await lz(R,u);const C=await _O(R);let A;if(r==="lockedContent"){const O=await Jze(t),U=`${Cm.thumbnails.folder}/${v}`,F=yO(l,U);await lz(F,O),A=await _O(F)}return{success:!0,url:C,thumbnailUrl:A}}catch(a){return console.error("Upload error:",a),{success:!1,error:"Upload fehlgeschlagen. Bitte versuche es erneut."}}},Zze=()=>{const t=yr(),{user:e}=Jr(),r=V.useRef(null),[a,l]=V.useState("text"),[u,p]=V.useState(""),[m,v]=V.useState(""),[w,R]=V.useState(""),[C,A]=V.useState(c9.unlockCost),[O,U]=V.useState(1),[F,q]=V.useState(["coins","referral"]),[W,H]=V.useState(null),[X,ne]=V.useState(null),[te,he]=V.useState(!1),[J,Q]=V.useState(null),[ce,de]=V.useState(!1),pe=Ze=>{var St;const It=(St=Ze.target.files)==null?void 0:St[0];if(It){H(It);const lt=new FileReader;lt.onloadend=()=>{ne(lt.result)},lt.readAsDataURL(It)}},be=Ze=>{F.includes(Ze)?F.length>1&&q(F.filter(It=>It!==Ze)):q([...F,Ze])},ye=async()=>{if(e!=null&&e.id){if(!u.trim()){Q("Bitte gib einen Titel ein");return}if(a==="text"&&!m.trim()){Q("Bitte gib den Content ein");return}if(a==="image"&&!W){Q("Bitte whle ein Bild aus");return}he(!0),Q(null);try{let Ze=m,It;if(a==="image"&&W){const lt=await Qze(W,e.id,"lockedContent");if(lt.success&&lt.url)Ze=lt.url,It=lt.thumbnailUrl;else throw new Error(lt.error||"Bild-Upload fehlgeschlagen")}if(await h9(e.id,e.username||"Anonym",{title:u.trim(),content:Ze,previewText:w.trim()||void 0,thumbnailUrl:It,type:a,unlockCost:C,unlockMethods:F,requiresInvites:O,isActive:!0}))de(!0),setTimeout(()=>{t("/creator/dashboard")},2e3);else throw new Error("Fehler beim Erstellen")}catch(Ze){Q(Ze.message||"Ein Fehler ist aufgetreten")}he(!1)}};return ce?c.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-4",children:c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"w-20 h-20 mx-auto bg-green-500/20 rounded-full flex items-center justify-center mb-4",children:c.jsx(_r,{size:40,className:"text-green-400"})}),c.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Secret Bubble erstellt!"}),c.jsx("p",{className:"text-white/60",children:"Wird zum Dashboard weitergeleitet..."})]})}):c.jsxs("div",{className:"min-h-screen bg-gray-900 text-white pb-24",children:[c.jsx("div",{className:"bg-gradient-to-b from-purple-900/50 to-transparent",children:c.jsx("div",{className:"px-4 py-6 safe-top",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("button",{onClick:()=>t(-1),className:"w-10 h-10 bg-white/10 rounded-xl flex items-center justify-center",children:c.jsx(Eo,{size:20})}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-2xl font-bold",children:"Secret Bubble erstellen"}),c.jsx("p",{className:"text-sm text-white/60",children:"Exklusiver Content fr deine Fans"})]})]})})}),c.jsxs("div",{className:"px-4 space-y-6",children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-sm text-white/60 mb-2 block",children:"Content-Typ"}),c.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{type:"text",icon:H5e,label:"Text"},{type:"image",icon:w5e,label:"Bild"},{type:"video",icon:Npe,label:"Video",disabled:!0}].map(({type:Ze,icon:It,label:St,disabled:lt})=>c.jsxs("button",{onClick:()=>!lt&&l(Ze),disabled:lt,className:`p-4 rounded-xl flex flex-col items-center gap-2 transition-all ${a===Ze?"bg-purple-500 text-white":lt?"bg-white/5 text-white/30 cursor-not-allowed":"bg-white/10 text-white/70 hover:bg-white/15"}`,children:[c.jsx(It,{size:24}),c.jsx("span",{className:"text-sm font-medium",children:St}),lt&&c.jsx("span",{className:"text-xs",children:"Bald"})]},Ze))})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-sm text-white/60 mb-2 block",children:"Titel"}),c.jsx("input",{type:"text",value:u,onChange:Ze=>p(Ze.target.value),placeholder:"z.B. Exklusives Behind-the-Scenes",className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/40 focus:outline-none focus:border-purple-500",maxLength:100})]}),a==="text"&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-sm text-white/60 mb-2 block",children:"Geheimer Content"}),c.jsx("textarea",{value:m,onChange:Ze=>v(Ze.target.value),placeholder:"Der Content, der nach dem Entsperren sichtbar wird...",className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/40 focus:outline-none focus:border-purple-500 min-h-[150px] resize-none",maxLength:2e3}),c.jsxs("p",{className:"text-xs text-white/40 mt-1",children:[m.length,"/2000"]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-sm text-white/60 mb-2 block",children:"Preview-Text (optional)"}),c.jsx("input",{type:"text",value:w,onChange:Ze=>R(Ze.target.value),placeholder:"Kurzer Teaser, der verschwommen angezeigt wird",className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/40 focus:outline-none focus:border-purple-500",maxLength:200})]})]}),a==="image"&&c.jsxs("div",{children:[c.jsx("label",{className:"text-sm text-white/60 mb-2 block",children:"Bild auswhlen"}),c.jsx("input",{ref:r,type:"file",accept:"image/*",onChange:pe,className:"hidden"}),X?c.jsxs("div",{className:"relative",children:[c.jsx("img",{src:X,alt:"Preview",className:"w-full aspect-video object-cover rounded-xl"}),c.jsx("button",{onClick:()=>{H(null),ne(null)},className:"absolute top-2 right-2 w-8 h-8 bg-black/50 rounded-full flex items-center justify-center",children:c.jsx(Di,{size:16})})]}):c.jsxs("button",{onClick:()=>{var Ze;return(Ze=r.current)==null?void 0:Ze.click()},className:"w-full aspect-video bg-white/5 border-2 border-dashed border-white/20 rounded-xl flex flex-col items-center justify-center gap-3 hover:border-purple-500 transition-colors",children:[c.jsx(Cpe,{size:40,className:"text-white/40"}),c.jsx("span",{className:"text-white/60",children:"Bild hochladen"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-sm text-white/60 mb-2 block",children:"Entsperr-Methoden"}),c.jsxs("div",{className:"space-y-3",children:[c.jsxs("button",{onClick:()=>be("coins"),className:`w-full p-4 rounded-xl flex items-center gap-4 transition-all ${F.includes("coins")?"bg-amber-500/20 border-2 border-amber-500/50":"bg-white/5 border-2 border-transparent"}`,children:[c.jsx("div",{className:"w-10 h-10 rounded-full bg-amber-500/20 flex items-center justify-center",children:c.jsx(uz,{size:20,className:"text-amber-400"})}),c.jsxs("div",{className:"flex-1 text-left",children:[c.jsx("p",{className:"font-semibold",children:"Mit Coins"}),c.jsx("p",{className:"text-sm text-white/60",children:"User zahlen synclulu Coins"})]}),c.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${F.includes("coins")?"bg-amber-500":"bg-white/20"}`,children:F.includes("coins")&&c.jsx(_r,{size:14})})]}),c.jsxs("button",{onClick:()=>be("referral"),className:`w-full p-4 rounded-xl flex items-center gap-4 transition-all ${F.includes("referral")?"bg-green-500/20 border-2 border-green-500/50":"bg-white/5 border-2 border-transparent"}`,children:[c.jsx("div",{className:"w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center",children:c.jsx(cr,{size:20,className:"text-green-400"})}),c.jsxs("div",{className:"flex-1 text-left",children:[c.jsx("p",{className:"font-semibold",children:"Mit Einladung"}),c.jsx("p",{className:"text-sm text-white/60",children:"Gratis durch Freunde einladen"})]}),c.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${F.includes("referral")?"bg-green-500":"bg-white/20"}`,children:F.includes("referral")&&c.jsx(_r,{size:14})})]}),c.jsxs("button",{onClick:()=>be("premium"),className:`w-full p-4 rounded-xl flex items-center gap-4 transition-all ${F.includes("premium")?"bg-purple-500/20 border-2 border-purple-500/50":"bg-white/5 border-2 border-transparent"}`,children:[c.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-500/20 flex items-center justify-center",children:c.jsx(as,{size:20,className:"text-purple-400"})}),c.jsxs("div",{className:"flex-1 text-left",children:[c.jsx("p",{className:"font-semibold",children:"Fr Premium"}),c.jsx("p",{className:"text-sm text-white/60",children:"Premium-User haben Zugang"})]}),c.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${F.includes("premium")?"bg-purple-500":"bg-white/20"}`,children:F.includes("premium")&&c.jsx(_r,{size:14})})]})]})]}),F.includes("coins")&&c.jsxs("div",{children:[c.jsx("label",{className:"text-sm text-white/60 mb-2 block",children:"Coin-Preis"}),c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("input",{type:"range",min:"10",max:"500",step:"10",value:C,onChange:Ze=>A(Number(Ze.target.value)),className:"flex-1 accent-amber-500"}),c.jsx("div",{className:"w-24 px-4 py-2 bg-amber-500/20 rounded-xl text-center",children:c.jsxs("span",{className:"font-bold text-amber-400",children:[" ",C]})})]})]}),F.includes("referral")&&c.jsxs("div",{children:[c.jsx("label",{className:"text-sm text-white/60 mb-2 block",children:"Bentigte Einladungen"}),c.jsx("div",{className:"flex items-center gap-4",children:[1,2,3,5].map(Ze=>c.jsx("button",{onClick:()=>U(Ze),className:`flex-1 py-3 rounded-xl font-semibold transition-all ${O===Ze?"bg-green-500 text-white":"bg-white/10 text-white/70"}`,children:Ze},Ze))})]}),J&&c.jsx("div",{className:"p-4 bg-red-500/20 border border-red-500/30 rounded-xl text-red-400",children:J}),c.jsx("button",{onClick:ye,disabled:te,className:"w-full py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold rounded-xl flex items-center justify-center gap-3 disabled:opacity-50",children:te?c.jsxs(c.Fragment,{children:[c.jsx(fi,{size:20,className:"animate-spin"}),"Wird erstellt..."]}):c.jsxs(c.Fragment,{children:[c.jsx(kn,{size:20}),"Secret Bubble erstellen"]})}),c.jsxs("div",{className:"p-4 bg-white/5 rounded-xl",children:[c.jsxs("h3",{className:"font-semibold mb-2 flex items-center gap-2",children:[c.jsx(yo,{size:16,className:"text-purple-400"}),"So funktioniert's"]}),c.jsxs("ul",{className:"text-sm text-white/60 space-y-2",children:[c.jsx("li",{children:" Dein Content wird mit Blur-Effekt angezeigt"}),c.jsx("li",{children:" User knnen mit Coins oder Einladungen entsperren"}),c.jsx("li",{children:" Du verdienst bei jedem Unlock basierend auf deinem Creator-Tier"}),c.jsx("li",{children:" Premium-User haben kostenlosen Zugang (wenn aktiviert)"})]})]})]})]})},hae=()=>{const t=yr();ag();const{blockedUsers:e,isLoading:r,unblockUser:a}=tj(),[l,u]=V.useState(""),[p,m]=V.useState(null),[v,w]=V.useState(null),R=e.filter(U=>{var F;return U.username.toLowerCase().includes(l.toLowerCase())||((F=U.displayName)==null?void 0:F.toLowerCase().includes(l.toLowerCase()))}),C=async U=>{m(U);const F=await a(U);m(null),w(null),F&&"vibrate"in navigator&&navigator.vibrate(10)},A=U=>new Intl.DateTimeFormat("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}).format(U),O=U=>({harassment:"Belstigung",spam:"Spam / Werbung",inappropriate:"Unangemessen",personal:"Persnliche Grnde",other:"Sonstiges"})[U||""]||"Persnliche Grnde";return c.jsxs("div",{className:"min-h-screen bg-[var(--synclulu-bg)] safe-top safe-bottom pb-24 theme-transition",children:[c.jsx("div",{className:"fixed inset-0 pointer-events-none",children:c.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-red-500/5 via-transparent to-transparent"})}),c.jsx("div",{className:"sticky top-0 z-10 glass-nav border-b border-[var(--synclulu-border)]",children:c.jsxs("div",{className:"px-4 py-4 flex items-center gap-3",children:[c.jsx(Ne.button,{whileTap:{scale:.95},onClick:()=>t(-1),className:"w-10 h-10 rounded-xl bg-[var(--synclulu-card)] flex items-center justify-center shadow-sm border border-[var(--synclulu-border)]",children:c.jsx(dd,{size:20,className:"text-[var(--synclulu-muted)]"})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h1",{className:"font-display text-xl font-bold text-[var(--synclulu-text)]",children:"Blockierte Nutzer"}),c.jsxs("p",{className:"text-xs text-[var(--synclulu-muted)]",children:[e.length," ",e.length===1?"Person":"Personen"," blockiert"]})]}),c.jsx("div",{className:"w-10 h-10 rounded-xl bg-red-500/10 flex items-center justify-center",children:c.jsx(cs,{size:20,className:"text-red-500"})})]})}),c.jsx(Ur,{children:e.length>5&&c.jsx(Ne.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"px-4 py-3",children:c.jsxs("div",{className:"relative",children:[c.jsx(xw,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-[var(--synclulu-muted)]"}),c.jsx("input",{type:"text",value:l,onChange:U=>u(U.target.value),placeholder:"Suchen...",className:"w-full pl-11 pr-4 py-3 bg-[var(--synclulu-card)] border border-[var(--synclulu-border)] rounded-xl text-[var(--synclulu-text)] placeholder-[var(--synclulu-muted)] focus:outline-none focus:ring-2 focus:ring-[var(--synclulu-accent)]/30"})]})})}),c.jsxs("div",{className:"px-4 py-4",children:[r?c.jsx("div",{className:"flex items-center justify-center py-20",children:c.jsx(fi,{size:32,className:"text-[var(--synclulu-muted)] animate-spin"})}):e.length===0?c.jsxs(Ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-20",children:[c.jsx("div",{className:"w-20 h-20 mx-auto rounded-full bg-green-500/10 flex items-center justify-center mb-4",children:c.jsx(bO,{size:32,className:"text-green-500"})}),c.jsx("h2",{className:"font-semibold text-[var(--synclulu-text)] mb-2",children:"Keine blockierten Nutzer"}),c.jsx("p",{className:"text-sm text-[var(--synclulu-muted)] max-w-xs mx-auto",children:"Du hast noch niemanden blockiert. Wenn dich jemand strt, kannst du ihn/sie auf dem Profil blockieren."})]}):R.length===0?c.jsxs("div",{className:"text-center py-20",children:[c.jsx(xw,{size:32,className:"text-[var(--synclulu-muted)] mx-auto mb-3 opacity-50"}),c.jsxs("p",{className:"text-[var(--synclulu-muted)]",children:['Keine Ergebnisse fr "',l,'"']})]}):c.jsx("div",{className:"space-y-3",children:R.map((U,F)=>c.jsx(Ne.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:F*.05},className:"bg-[var(--synclulu-card)] rounded-2xl border border-[var(--synclulu-border)] p-4 shadow-sm",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("div",{className:"relative",children:[U.avatarUrl?c.jsx("img",{src:U.avatarUrl,alt:"",className:"w-14 h-14 rounded-xl object-cover grayscale"}):c.jsx("div",{className:"w-14 h-14 rounded-xl bg-[var(--synclulu-bg)] flex items-center justify-center text-[var(--synclulu-muted)]",children:c.jsx(md,{size:24})}),c.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 rounded-full bg-red-500 flex items-center justify-center",children:c.jsx(cs,{size:12,className:"text-white"})})]}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsxs("p",{className:"font-semibold text-[var(--synclulu-text)] truncate",children:["@",U.username]}),U.displayName&&c.jsx("p",{className:"text-sm text-[var(--synclulu-muted)] truncate",children:U.displayName}),c.jsxs("p",{className:"text-xs text-[var(--synclulu-muted)] mt-1 opacity-60",children:["Blockiert am ",A(U.blockedAt),"  ",O(U.reason)]})]}),c.jsxs(Ne.button,{whileTap:{scale:.95},onClick:()=>w(U.blockedUserId),disabled:p===U.blockedUserId,className:"px-4 py-2 bg-[var(--synclulu-bg)] text-[var(--synclulu-muted)] rounded-xl text-sm font-semibold hover:text-[var(--synclulu-text)] transition-colors disabled:opacity-50 flex items-center gap-2 border border-[var(--synclulu-border)]",children:[p===U.blockedUserId?c.jsx(fi,{size:16,className:"animate-spin"}):c.jsx(K_,{size:16}),c.jsx("span",{className:"hidden sm:inline",children:"Entblocken"})]})]})},U.id))}),c.jsx(Ur,{children:e.length>0&&c.jsx(Ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},className:"mt-6 p-4 bg-amber-500/10 rounded-2xl border border-amber-500/20",children:c.jsxs("div",{className:"flex gap-3",children:[c.jsx(rh,{size:20,className:"text-amber-500 flex-shrink-0 mt-0.5"}),c.jsxs("div",{className:"text-sm text-[var(--synclulu-text)]",children:[c.jsx("p",{className:"font-medium mb-1",children:"Was passiert beim Blockieren?"}),c.jsxs("ul",{className:"text-xs space-y-1 text-[var(--synclulu-muted)]",children:[c.jsx("li",{children:" Diese Person kann dir keine Nachrichten mehr senden"}),c.jsx("li",{children:' Ihr seht euch nicht mehr in der "In der Nhe"-Liste'}),c.jsx("li",{children:" Voice-Chats werden verhindert"}),c.jsx("li",{children:" Die Person erfhrt nicht, dass sie blockiert wurde"})]})]})]})})})]}),c.jsx(Ur,{children:v&&c.jsx(Ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4",onClick:()=>w(null),children:c.jsxs(Ne.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:U=>U.stopPropagation(),className:"bg-[var(--synclulu-card)] rounded-3xl w-full max-w-sm p-6 border border-[var(--synclulu-border)]",children:[c.jsx("div",{className:"w-16 h-16 mx-auto rounded-full bg-amber-500/10 flex items-center justify-center mb-4",children:c.jsx(K_,{size:28,className:"text-amber-500"})}),c.jsx("h2",{className:"text-xl font-bold text-[var(--synclulu-text)] text-center mb-2",children:"Nutzer entblocken?"}),c.jsx("p",{className:"text-[var(--synclulu-muted)] text-center text-sm mb-6",children:"Diese Person kann dich dann wieder kontaktieren und in Voice-Chats sehen."}),c.jsxs("div",{className:"flex gap-3",children:[c.jsx("button",{onClick:()=>w(null),className:"flex-1 py-3 bg-[var(--synclulu-bg)] text-[var(--synclulu-muted)] rounded-xl font-semibold border border-[var(--synclulu-border)]",children:"Abbrechen"}),c.jsx("button",{onClick:()=>C(v),className:"flex-1 py-3 bg-[var(--synclulu-accent)] text-white rounded-xl font-semibold flex items-center justify-center gap-2",children:p?c.jsx(fi,{size:18,className:"animate-spin"}):c.jsxs(c.Fragment,{children:[c.jsx(K_,{size:18}),"Entblocken"]})})]})]})})})]})},z2=()=>{const t=yr();return c.jsxs("div",{className:"min-h-screen bg-[var(--synclulu-bg)] safe-top safe-bottom pb-24 theme-transition",children:[c.jsx("div",{className:"fixed inset-0 pointer-events-none",children:c.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-[var(--synclulu-accent)]/5 via-transparent to-transparent"})}),c.jsx("div",{className:"sticky top-0 z-20 glass-nav border-b border-[var(--synclulu-border)]",children:c.jsxs("div",{className:"px-6 py-4 flex items-center gap-4",children:[c.jsx(Ne.button,{whileTap:{scale:.95},onClick:()=>t(-1),className:"w-10 h-10 rounded-xl bg-[var(--synclulu-card)] flex items-center justify-center text-[var(--synclulu-muted)] hover:text-[var(--synclulu-text)] transition-colors shadow-sm",children:c.jsx(Eo,{size:20})}),c.jsx("h1",{className:"font-display text-xl font-bold text-[var(--synclulu-text)]",children:"Impressum"})]})}),c.jsxs(Ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"px-6 py-6 space-y-6",children:[c.jsxs("section",{children:[c.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[c.jsx(_5e,{size:18,className:"text-[var(--synclulu-accent)]"}),c.jsx("h2",{className:"font-semibold text-[var(--synclulu-text)] text-lg",children:"Angaben gem  5 TMG"})]}),c.jsxs("div",{className:"bg-[var(--synclulu-card)] rounded-2xl p-4 shadow-sm border border-[var(--synclulu-border)] space-y-2",children:[c.jsx("p",{className:"text-[var(--synclulu-text)] font-medium",children:"Butterbread UG (haftungsbeschrnkt)"}),c.jsx("p",{className:"text-[var(--synclulu-muted)]",children:"Musterstrae 123"}),c.jsx("p",{className:"text-[var(--synclulu-muted)]",children:"12345 Musterstadt"}),c.jsx("p",{className:"text-[var(--synclulu-muted)]",children:"Deutschland"})]})]}),c.jsxs("section",{children:[c.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[c.jsx(c0,{size:18,className:"text-[var(--synclulu-accent)]"}),c.jsx("h2",{className:"font-semibold text-[var(--synclulu-text)] text-lg",children:"Kontakt"})]}),c.jsxs("div",{className:"bg-[var(--synclulu-card)] rounded-2xl p-4 shadow-sm border border-[var(--synclulu-border)] space-y-2",children:[c.jsxs("p",{className:"text-[var(--synclulu-muted)] flex items-center gap-2",children:[c.jsx(c0,{size:14,className:"text-[var(--synclulu-accent)]"}),c.jsx("span",{className:"text-[var(--synclulu-text)]",children:"E-Mail:"})," kontakt@synclulu.app"]}),c.jsxs("p",{className:"text-[var(--synclulu-muted)] flex items-center gap-2",children:[c.jsx(D5e,{size:14,className:"text-[var(--synclulu-accent)]"}),c.jsx("span",{className:"text-[var(--synclulu-text)]",children:"Telefon:"})," +49 (0) 123 456789"]})]})]}),c.jsxs("section",{children:[c.jsx("h2",{className:"font-semibold text-[var(--synclulu-text)] text-lg mb-3",children:"Vertreten durch"}),c.jsx("div",{className:"bg-[var(--synclulu-card)] rounded-2xl p-4 shadow-sm border border-[var(--synclulu-border)]",children:c.jsx("p",{className:"text-[var(--synclulu-muted)]",children:"Geschftsfhrer: Jan Hundsdorff"})})]}),c.jsxs("section",{children:[c.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[c.jsx(AN,{size:18,className:"text-[var(--synclulu-accent)]"}),c.jsx("h2",{className:"font-semibold text-[var(--synclulu-text)] text-lg",children:"Handelsregister"})]}),c.jsxs("div",{className:"bg-[var(--synclulu-card)] rounded-2xl p-4 shadow-sm border border-[var(--synclulu-border)] space-y-2",children:[c.jsxs("p",{className:"text-[var(--synclulu-muted)]",children:[c.jsx("span",{className:"text-[var(--synclulu-text)]",children:"Registergericht:"})," Amtsgericht Musterstadt"]}),c.jsxs("p",{className:"text-[var(--synclulu-muted)]",children:[c.jsx("span",{className:"text-[var(--synclulu-text)]",children:"Registernummer:"})," HRB 12345"]})]})]}),c.jsxs("section",{children:[c.jsx("h2",{className:"font-semibold text-[var(--synclulu-text)] text-lg mb-3",children:"Umsatzsteuer-ID"}),c.jsx("div",{className:"bg-[var(--synclulu-card)] rounded-2xl p-4 shadow-sm border border-[var(--synclulu-border)]",children:c.jsxs("p",{className:"text-[var(--synclulu-muted)]",children:["Umsatzsteuer-Identifikationsnummer gem  27 a Umsatzsteuergesetz:",c.jsx("br",{}),c.jsx("span",{className:"text-[var(--synclulu-accent)] font-medium",children:"DE 123456789"})]})})]}),c.jsxs("section",{children:[c.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[c.jsx(j5e,{size:18,className:"text-[var(--synclulu-accent)]"}),c.jsx("h2",{className:"font-semibold text-[var(--synclulu-text)] text-lg",children:"Verantwortlich fr den Inhalt"})]}),c.jsxs("div",{className:"bg-[var(--synclulu-card)] rounded-2xl p-4 shadow-sm border border-[var(--synclulu-border)] space-y-2",children:[c.jsx("p",{className:"text-[var(--synclulu-text)] font-medium",children:"Jan Hundsdorff"}),c.jsx("p",{className:"text-[var(--synclulu-muted)]",children:"Musterstrae 123"}),c.jsx("p",{className:"text-[var(--synclulu-muted)]",children:"12345 Musterstadt"}),c.jsx("p",{className:"text-xs text-[var(--synclulu-muted)] mt-2 opacity-60",children:"( 55 Abs. 2 RStV)"})]})]}),c.jsxs("section",{children:[c.jsx("h2",{className:"font-semibold text-[var(--synclulu-text)] text-lg mb-3",children:"Streitschlichtung"}),c.jsx("div",{className:"bg-[var(--synclulu-card)] rounded-2xl p-4 shadow-sm border border-[var(--synclulu-border)]",children:c.jsxs("p",{className:"text-[var(--synclulu-muted)] text-sm leading-relaxed",children:["Die Europische Kommission stellt eine Plattform zur Online-Streitbeilegung (OS) bereit:",c.jsx("br",{}),c.jsx("a",{href:"https://ec.europa.eu/consumers/odr",target:"_blank",rel:"noopener noreferrer",className:"text-[var(--synclulu-accent)] hover:underline",children:"https://ec.europa.eu/consumers/odr"}),c.jsx("br",{}),c.jsx("br",{}),"Unsere E-Mail-Adresse finden Sie oben im Impressum.",c.jsx("br",{}),c.jsx("br",{}),"Wir sind nicht bereit oder verpflichtet, an Streitbeilegungsverfahren vor einer Verbraucherschlichtungsstelle teilzunehmen."]})})]}),c.jsxs("div",{className:"text-center text-xs text-[var(--synclulu-muted)] pt-4 opacity-60",children:[c.jsx("span",{className:"text-lg mr-2",children:""}),"Stand: Februar 2026"]})]})]})};function pae(t="light"){if(typeof navigator<"u"&&navigator.vibrate){const e={light:10,medium:25,heavy:50};navigator.vibrate(e[t])}}const age=V.memo(({title:t,content:e,onAccept:r,onBack:a,showAcceptButton:l=!0,acceptButtonText:u="Verstanden & Akzeptiert"})=>c.jsxs("div",{className:"min-h-screen p-4 pt-6 pb-32",style:{backgroundColor:"#050505"},children:[a&&c.jsxs(Ne.button,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},onClick:()=>{pae("light"),a()},className:"mb-6 flex items-center gap-2 text-white/40 hover:text-white/60 transition-colors",children:[c.jsx(dd,{size:20}),c.jsx("span",{className:"text-xs font-bold uppercase tracking-widest",children:"Zurck"})]}),c.jsxs(Ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"rounded-[32px] p-8",style:{background:"rgba(255, 255, 255, 0.03)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",border:"1px solid rgba(255, 255, 255, 0.05)"},children:[c.jsx("h1",{className:"text-2xl font-black italic mb-8 tracking-tight uppercase",style:{color:"#a855f7"},children:t}),c.jsx("div",{className:"space-y-6 text-sm leading-relaxed font-medium",style:{color:"#9ca3af"},children:typeof e=="string"?c.jsx("div",{dangerouslySetInnerHTML:{__html:e}}):e}),l&&r&&c.jsx(Ne.button,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},onClick:()=>{pae("medium"),r()},className:"mt-12 w-full py-4 rounded-2xl text-[11px] font-black uppercase tracking-[0.15em] transition-all",style:{background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 255, 255, 0.08)",color:"rgba(255, 255, 255, 0.6)"},children:u})]}),c.jsx(Ne.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},className:"text-center mt-6 text-[10px] uppercase tracking-widest",style:{color:"rgba(255, 255, 255, 0.2)"},children:"Zuletzt aktualisiert: Februar 2026"})]}));age.displayName="LegalScreen";const xm=V.memo(({title:t,children:e})=>c.jsxs("div",{className:"mb-8",children:[c.jsx("h2",{className:"text-sm font-bold uppercase tracking-wider mb-3",style:{color:"rgba(255, 255, 255, 0.5)"},children:t}),c.jsx("div",{className:"space-y-3",style:{color:"#9ca3af"},children:e})]}));xm.displayName="LegalSection";const Gz=V.memo(({items:t})=>c.jsx("ul",{className:"space-y-2 pl-4",children:t.map((e,r)=>c.jsxs("li",{className:"flex items-start gap-3",children:[c.jsx("span",{style:{color:"#a855f7"},children:""}),c.jsx("span",{children:e})]},r))}));Gz.displayName="LegalList";const wB=()=>{const t=yr();return c.jsx(age,{title:"Datenschutz",onBack:()=>t(-1),showAcceptButton:!1,content:c.jsxs(c.Fragment,{children:[c.jsx(xm,{title:"1. Datenschutz auf einen Blick",children:c.jsx("p",{children:"Die folgenden Hinweise geben einen einfachen berblick darber, was mit Ihren personenbezogenen Daten passiert, wenn Sie diese App nutzen. Personenbezogene Daten sind alle Daten, mit denen Sie persnlich identifiziert werden knnen."})}),c.jsxs(xm,{title:"2. Welche Daten erfassen wir?",children:[c.jsx(Gz,{items:["Registrierungsdaten (E-Mail, Benutzername, Passwort)","Profilinformationen (Avatar, Bio, Display-Name)","Nutzungsdaten (Level, XP, Voice-Minuten, Sterne)","Standortdaten (bei aktivierter Standortfreigabe)","Gerte-Informationen"]}),c.jsx("p",{className:"mt-4",children:"Ihre Daten werden zum einen dadurch erhoben, dass Sie uns diese mitteilen (z.B. bei der Registrierung). Andere Daten werden automatisch beim Nutzen der App durch unsere IT-Systeme erfasst."})]}),c.jsxs(xm,{title:"3. Standortdaten",children:[c.jsx("p",{children:"synclulu nutzt Standortdaten, um Nutzer in deiner Nhe zu finden und Voice-Rume basierend auf der Region anzuzeigen. Die Standortfreigabe ist optional und kann jederzeit in den Einstellungen deaktiviert werden."}),c.jsxs("p",{className:"mt-3",style:{color:"#a855f7"},children:[c.jsx("strong",{children:"Wichtig:"})," Wir speichern keine genauen GPS-Koordinaten, sondern nur eine ungefhre Region (z.B. Stadt oder Stadtteil)."]})]}),c.jsxs(xm,{title:"4. Voice-Chat Daten",children:[c.jsxs("p",{children:["Voice-Chats werden ",c.jsx("strong",{style:{color:"#10b981"},children:"nicht"})," aufgezeichnet oder gespeichert. Alle Gesprche sind live und werden nach Beendigung nicht archiviert."]}),c.jsx("p",{className:"mt-3",children:"Wir erfassen lediglich Metadaten wie Dauer der Teilnahme (zur XP-Berechnung) und Bewertungen durch andere Nutzer."})]}),c.jsxs(xm,{title:"5. Ihre Rechte",children:[c.jsx("p",{children:"Sie haben jederzeit das Recht:"}),c.jsx(Gz,{items:["Auskunft ber Ihre gespeicherten Daten zu erhalten","Berichtigung unrichtiger Daten zu verlangen","Lschung Ihrer Daten zu verlangen","Die Verarbeitung einzuschrnken","Datenbertragbarkeit zu verlangen","Widerspruch gegen die Verarbeitung einzulegen"]})]}),c.jsx(xm,{title:"6. Datenlschung",children:c.jsx("p",{children:'ber die Einstellungen  "Account lschen" knnen Sie Ihre gesamten Daten unwiderruflich lschen. Nach Besttigung werden alle personenbezogenen Daten innerhalb von 30 Tagen vollstndig entfernt.'})}),c.jsxs(xm,{title:"7. Kontakt",children:[c.jsx("p",{children:"Bei Fragen zum Datenschutz erreichen Sie uns unter:"}),c.jsxs("div",{className:"mt-3 p-4 rounded-xl",style:{background:"rgba(255,255,255,0.03)"},children:[c.jsx("p",{children:c.jsx("strong",{style:{color:"white"},children:"Butterbread UG (haftungsbeschrnkt)"})}),c.jsx("p",{className:"mt-2",children:"Musterstrae 123"}),c.jsx("p",{children:"12345 Musterstadt"}),c.jsx("p",{className:"mt-2",style:{color:"#a855f7"},children:"datenschutz@synclulu.app"})]})]}),c.jsx(xm,{title:"8. nderungen",children:c.jsx("p",{children:"Wir behalten uns vor, diese Datenschutzerklrung anzupassen, damit sie stets den aktuellen rechtlichen Anforderungen entspricht oder um nderungen unserer Leistungen umzusetzen."})})]})})},e8e=()=>{const[t]=Dw(),e=yr(),[r,a]=V.useState(""),[l,u]=V.useState(""),[p,m]=V.useState(!1),[v,w]=V.useState(!1),[R,C]=V.useState(!0),[A,O]=V.useState(""),[U,F]=V.useState(!1),[q,W]=V.useState(""),H=t.get("oobCode");V.useEffect(()=>{(async()=>{if(!H){O("Ungltiger oder abgelaufener Link"),C(!1);return}try{const ce=await Q1e(ws,H);W(ce),C(!1)}catch{O("Dieser Link ist ungltig oder abgelaufen. Bitte fordere einen neuen an."),C(!1)}})()},[H]);const X={length:r.length>=8,uppercase:/[A-Z]/.test(r),lowercase:/[a-z]/.test(r),number:/[0-9]/.test(r),special:/[!@#$%^&*(),.?":{}|<>]/.test(r)},ne=Object.values(X).filter(Boolean).length,te=ne>=4,he=r===l&&l.length>0,J=async Q=>{if(Q.preventDefault(),O(""),!te){O("Bitte whle ein strkeres Passwort");return}if(!he){O("Die Passwrter stimmen nicht berein");return}if(!H){O("Ungltiger Reset-Link");return}w(!0);try{await X1e(ws,H,r),F(!0)}catch(ce){ce.code==="auth/expired-action-code"?O("Dieser Link ist abgelaufen. Bitte fordere einen neuen an."):ce.code==="auth/invalid-action-code"?O("Dieser Link ist ungltig. Bitte fordere einen neuen an."):ce.code==="auth/weak-password"?O("Das Passwort ist zu schwach."):O("Ein Fehler ist aufgetreten. Bitte versuche es erneut.")}finally{w(!1)}};return R?c.jsx("div",{className:"min-h-screen min-h-[100dvh] bg-gradient-to-b from-violet-50 via-white to-purple-50 flex items-center justify-center px-6",children:c.jsxs("div",{className:"text-center",children:[c.jsx(q_,{children:c.jsx(wO,{size:120,className:"mx-auto mb-6"})}),c.jsx("div",{className:"animate-pulse",children:c.jsx("p",{className:"text-gray-600 font-medium",children:"Link wird berprft..."})})]})}):A&&!q?c.jsx("div",{className:"min-h-screen min-h-[100dvh] bg-gradient-to-b from-violet-50 via-white to-purple-50 flex items-center justify-center px-6",children:c.jsxs("div",{className:"text-center max-w-sm",children:[c.jsx(q_,{children:c.jsx(TW,{size:140,className:"mx-auto mb-4"})}),c.jsx("h1",{className:"font-display text-2xl font-bold text-gray-900 mb-3",children:"Link ungltig"}),c.jsx("p",{className:"text-gray-500 mb-8",children:A}),c.jsx("button",{onClick:()=>e("/login"),className:"w-full py-4 bg-gradient-to-r from-violet-600 to-purple-600 text-white font-display font-bold rounded-2xl shadow-lg",children:"Zurck zum Login"})]})}):U?c.jsx("div",{className:"min-h-screen min-h-[100dvh] bg-gradient-to-b from-violet-50 via-white to-purple-50 flex items-center justify-center px-6",children:c.jsxs("div",{className:"text-center max-w-sm",children:[c.jsx("div",{className:"w-20 h-20 mx-auto rounded-full bg-green-100 flex items-center justify-center mb-6",children:c.jsx(Sm,{size:40,className:"text-green-600"})}),c.jsx("h1",{className:"font-display text-2xl font-bold text-gray-900 mb-3",children:"Passwort gendert! "}),c.jsx("p",{className:"text-gray-500 mb-8",children:"Dein Passwort wurde erfolgreich zurckgesetzt. Du kannst dich jetzt mit deinem neuen Passwort anmelden."}),c.jsx("button",{onClick:()=>e("/login"),className:"w-full py-4 bg-gradient-to-r from-violet-600 to-purple-600 text-white font-display font-bold rounded-2xl shadow-lg hover:shadow-xl transition-all",children:"Zum Login"})]})}):c.jsxs("div",{className:"min-h-screen min-h-[100dvh] bg-gradient-to-b from-violet-50 via-white to-purple-50 relative overflow-hidden",children:[c.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[c.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-violet-200/40 to-purple-300/30 rounded-full blur-3xl"}),c.jsx("div",{className:"absolute bottom-20 left-0 w-56 h-56 bg-gradient-to-tr from-pink-200/30 to-violet-200/30 rounded-full blur-3xl"})]}),c.jsxs("div",{className:"relative z-10 px-6 py-8 safe-top max-w-md mx-auto",children:[c.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[c.jsx("button",{onClick:()=>e("/login"),className:"w-10 h-10 rounded-xl bg-white/80 backdrop-blur-sm flex items-center justify-center shadow-sm border border-gray-100",children:c.jsx(Eo,{size:20,className:"text-gray-600"})}),c.jsx("h1",{className:"font-display text-2xl font-bold text-gray-900",children:"Neues Passwort"})]}),c.jsx("div",{className:"flex justify-center mb-6",children:c.jsx(q_,{children:c.jsx(wO,{size:100})})}),c.jsxs("div",{className:"bg-violet-50 rounded-2xl p-4 mb-6 text-center",children:[c.jsx("p",{className:"text-sm text-gray-600",children:"Neues Passwort fr"}),c.jsx("p",{className:"font-semibold text-violet-700",children:q})]}),c.jsxs("form",{onSubmit:J,className:"space-y-5",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Neues Passwort"}),c.jsxs("div",{className:"relative",children:[c.jsx(yo,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"}),c.jsx("input",{type:p?"text":"password",value:r,onChange:Q=>a(Q.target.value),className:"w-full pl-12 pr-12 py-4 bg-white border-2 border-gray-200 rounded-2xl focus:border-violet-500 focus:outline-none transition-colors",required:!0}),c.jsx("button",{type:"button",onClick:()=>m(!p),className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-400",children:p?c.jsx(lp,{size:18}):c.jsx(Pl,{size:18})})]}),r&&c.jsxs("div",{className:"mt-3 space-y-2",children:[c.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(Q=>c.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${Q<=ne?ne<=2?"bg-red-500":ne===3?"bg-yellow-500":"bg-green-500":"bg-gray-200"}`},Q))}),c.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[c.jsxs("div",{className:`flex items-center gap-1 ${X.length?"text-green-600":"text-gray-400"}`,children:[X.length?c.jsx(_r,{size:12}):c.jsx(Di,{size:12}),"Min. 8 Zeichen"]}),c.jsxs("div",{className:`flex items-center gap-1 ${X.uppercase?"text-green-600":"text-gray-400"}`,children:[X.uppercase?c.jsx(_r,{size:12}):c.jsx(Di,{size:12}),"Grobuchstabe"]}),c.jsxs("div",{className:`flex items-center gap-1 ${X.lowercase?"text-green-600":"text-gray-400"}`,children:[X.lowercase?c.jsx(_r,{size:12}):c.jsx(Di,{size:12}),"Kleinbuchstabe"]}),c.jsxs("div",{className:`flex items-center gap-1 ${X.number?"text-green-600":"text-gray-400"}`,children:[X.number?c.jsx(_r,{size:12}):c.jsx(Di,{size:12}),"Zahl"]})]})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Passwort besttigen"}),c.jsxs("div",{className:"relative",children:[c.jsx(yo,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"}),c.jsx("input",{type:p?"text":"password",value:l,onChange:Q=>u(Q.target.value),className:`w-full pl-12 pr-12 py-4 bg-white border-2 rounded-2xl focus:outline-none transition-colors ${l?he?"border-green-500 focus:border-green-500":"border-red-500 focus:border-red-500":"border-gray-200 focus:border-violet-500"}`,required:!0}),l&&c.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2",children:he?c.jsx(_r,{size:18,className:"text-green-500"}):c.jsx(Di,{size:18,className:"text-red-500"})})]})]}),A&&c.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm bg-red-50 px-4 py-3 rounded-xl",children:[c.jsx(mI,{size:16}),A]}),c.jsx("button",{type:"submit",disabled:v||!te||!he,className:"w-full py-4 bg-gradient-to-r from-violet-600 to-purple-600 text-white font-display font-bold rounded-2xl shadow-lg shadow-violet-500/30 hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:v?"Wird gespeichert...":"Passwort speichern"})]})]})]})},t8e={golden:{gradient:"from-amber-300 via-yellow-400 to-orange-400",shimmer:"from-transparent via-white/40 to-transparent",glow:"shadow-amber-500/50",accent:"text-amber-900",badge:" Golden Ticket",border:"border-amber-400/50"},platinum:{gradient:"from-slate-200 via-gray-100 to-slate-300",shimmer:"from-transparent via-white/60 to-transparent",glow:"shadow-slate-400/50",accent:"text-slate-700",badge:" Platinum Pass",border:"border-slate-300/50"},diamond:{gradient:"from-violet-400 via-purple-300 to-fuchsia-400",shimmer:"from-transparent via-white/50 to-transparent",glow:"shadow-purple-500/50",accent:"text-purple-900",badge:" Diamond Elite",border:"border-purple-400/50"}},n8e=({mousePosition:t,isHovered:e})=>c.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden rounded-3xl",style:{opacity:e?1:0,transition:"opacity 0.3s ease"},children:[c.jsx("div",{className:"absolute w-[200%] h-[200%] opacity-30",style:{background:`
          radial-gradient(
            circle at ${t.x}% ${t.y}%,
            rgba(255, 0, 128, 0.3) 0%,
            rgba(128, 0, 255, 0.2) 25%,
            rgba(0, 128, 255, 0.2) 50%,
            rgba(0, 255, 128, 0.1) 75%,
            transparent 100%
          )
        `,transform:"translate(-25%, -25%)",transition:"all 0.1s ease-out"}}),c.jsx("div",{className:"absolute inset-0",style:{background:"repeating-linear-gradient(0deg, transparent 0px, rgba(255,255,255,0.03) 1px, transparent 2px)"}})]}),r8e=({isActive:t})=>t?c.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-hidden rounded-3xl",children:[...Array(6)].map((e,r)=>c.jsx("div",{className:"absolute w-1 h-1 bg-white rounded-full animate-float",style:{left:`${15+r*15}%`,top:`${20+r%3*25}%`,animationDelay:`${r*.3}s`,animationDuration:`${2+r*.5}s`}},r))}):null,i8e=({code:t,remainingInvites:e,totalInvites:r,rewardDays:a,onShare:l,onCopy:u,onShowQR:p,variant:m="golden",isAnimated:v=!0})=>{const[w,R]=V.useState(!1),[C,A]=V.useState({x:50,y:50}),[O,U]=V.useState(!1),[F,q]=V.useState(!1),W=V.useRef(null),H=t8e[m];V.useEffect(()=>{const J=setTimeout(()=>q(!0),100);return()=>clearTimeout(J)},[]);const X=V.useCallback(J=>{if(!W.current)return;const Q=W.current.getBoundingClientRect(),ce=(J.clientX-Q.left)/Q.width*100,de=(J.clientY-Q.top)/Q.height*100;A({x:ce,y:de})},[]),ne=async()=>{try{const J=` Du wurdest zu synclulu eingeladen!

 Dein VIP-Code: ${t}

 https://synclulu.app/join/${t}`;await navigator.clipboard.writeText(J),U(!0),"vibrate"in navigator&&navigator.vibrate([15,50,15]),u==null||u(),setTimeout(()=>U(!1),2e3)}catch(J){console.error("Copy failed:",J)}},te=async()=>{if("vibrate"in navigator&&navigator.vibrate([10,30,10,30,10]),navigator.share)try{await navigator.share({title:"synclulu Einladung ",text:`Hey! Ich lade dich zu synclulu ein. Nutze meinen Code: ${t}`,url:`https://synclulu.app/join/${t}`}),l==null||l()}catch{ne()}else ne()},he=e/r*100;return c.jsxs("div",{ref:W,onMouseEnter:()=>R(!0),onMouseLeave:()=>R(!1),onMouseMove:X,className:`
        relative overflow-hidden rounded-3xl
        transform transition-all duration-500 ease-out
        ${F?"scale-100 opacity-100":"scale-95 opacity-0"}
        ${w?"scale-[1.02]":"scale-100"}
      `,style:{transformStyle:"preserve-3d",perspective:"1000px"},children:[c.jsx("div",{className:`
          absolute inset-0 bg-gradient-to-br ${H.gradient}
          shadow-2xl ${H.glow}
        `}),c.jsx("div",{className:"absolute inset-0 opacity-20",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E")`}}),c.jsx(n8e,{mousePosition:C,isHovered:w}),c.jsx(r8e,{isActive:v&&w}),v&&c.jsx("div",{className:`absolute inset-0 bg-gradient-to-r ${H.shimmer} -translate-x-full animate-shimmer`}),c.jsxs("div",{className:"relative p-6",children:[c.jsxs("div",{className:"flex items-center justify-between mb-6",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(kn,{size:18,className:H.accent}),c.jsx("span",{className:`text-sm font-bold ${H.accent}`,children:H.badge})]}),c.jsxs("div",{className:`flex items-center gap-1 px-3 py-1 rounded-full bg-black/10 ${H.accent}`,children:[c.jsx(_o,{size:14}),c.jsxs("span",{className:"text-xs font-semibold",children:["+",a," Tage Premium"]})]})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx("div",{className:"text-xs text-black/50 mb-2 uppercase tracking-wider",children:"Dein Einladungscode"}),c.jsxs("div",{className:`
              relative bg-white/30 backdrop-blur-sm rounded-2xl p-4
              border ${H.border}
            `,children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"font-mono text-2xl font-black tracking-widest text-black/80",children:t}),c.jsx("button",{onClick:ne,className:`
                  w-10 h-10 rounded-xl flex items-center justify-center
                  transition-all duration-300
                  ${O?"bg-green-500 text-white scale-110":"bg-black/10 text-black/60 hover:bg-black/20 hover:scale-105"}
                `,children:O?c.jsx(_r,{size:18}):c.jsx(bW,{size:18})})]}),c.jsx("div",{className:"absolute top-2 right-2 opacity-20",children:c.jsx(Ji,{size:12})}),c.jsx("div",{className:"absolute bottom-2 left-2 opacity-20",children:c.jsx(Ji,{size:12})})]})]}),c.jsxs("div",{className:"mb-6",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("span",{className:`text-xs ${H.accent} opacity-70`,children:"Verbleibende Einladungen"}),c.jsxs("span",{className:`text-sm font-bold ${H.accent}`,children:[e," / ",r]})]}),c.jsx("div",{className:"h-2 bg-black/10 rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full bg-black/30 rounded-full transition-all duration-500",style:{width:`${he}%`}})})]}),c.jsxs("div",{className:"flex gap-3",children:[c.jsxs("button",{onClick:te,className:`
              flex-1 py-3.5 px-4 rounded-2xl font-bold text-sm
              bg-black/80 text-white
              flex items-center justify-center gap-2
              hover:bg-black hover:scale-[1.02]
              active:scale-[0.98]
              transition-all duration-200
              shadow-lg shadow-black/20
            `,children:[c.jsx(GL,{size:18}),"Teilen"]}),c.jsx("button",{onClick:p,className:`
              w-14 h-14 rounded-2xl
              bg-white/30 backdrop-blur-sm border ${H.border}
              flex items-center justify-center
              hover:bg-white/50 hover:scale-[1.02]
              active:scale-[0.98]
              transition-all duration-200
            `,children:c.jsx(O5e,{size:22,className:H.accent})})]})]}),c.jsx("div",{className:"absolute top-0 left-0 w-12 h-12 flex items-center justify-center opacity-30",children:c.jsx(as,{size:20,className:H.accent})}),c.jsx("div",{className:"absolute bottom-0 right-0 w-12 h-12 flex items-center justify-center opacity-30",children:c.jsx(xpe,{size:20,className:H.accent})}),c.jsx("style",{children:`
        @keyframes shimmer {
          0% { transform: translateX(-100%); }
          100% { transform: translateX(200%); }
        }
        .animate-shimmer {
          animation: shimmer 3s ease-in-out infinite;
        }
        @keyframes float {
          0%, 100% {
            transform: translateY(0) scale(1);
            opacity: 0.6;
          }
          50% {
            transform: translateY(-20px) scale(1.2);
            opacity: 1;
          }
        }
        .animate-float {
          animation: float 3s ease-in-out infinite;
        }
      `})]})};var SI={},s8e=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},oge={},tu={};let m9;const a8e=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];tu.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return e*4+17};tu.getSymbolTotalCodewords=function(e){return a8e[e]};tu.getBCHDigit=function(t){let e=0;for(;t!==0;)e++,t>>>=1;return e};tu.setToSJISFunction=function(e){if(typeof e!="function")throw new Error('"toSJISFunc" is not a valid function.');m9=e};tu.isKanjiModeEnabled=function(){return typeof m9<"u"};tu.toSJIS=function(e){return m9(e)};var nj={};(function(t){t.L={bit:1},t.M={bit:0},t.Q={bit:3},t.H={bit:2};function e(r){if(typeof r!="string")throw new Error("Param is not a string");switch(r.toLowerCase()){case"l":case"low":return t.L;case"m":case"medium":return t.M;case"q":case"quartile":return t.Q;case"h":case"high":return t.H;default:throw new Error("Unknown EC Level: "+r)}}t.isValid=function(a){return a&&typeof a.bit<"u"&&a.bit>=0&&a.bit<4},t.from=function(a,l){if(t.isValid(a))return a;try{return e(a)}catch{return l}}})(nj);function cge(){this.buffer=[],this.length=0}cge.prototype={get:function(t){const e=Math.floor(t/8);return(this.buffer[e]>>>7-t%8&1)===1},put:function(t,e){for(let r=0;r<e;r++)this.putBit((t>>>e-r-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(t){const e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var o8e=cge;function TI(t){if(!t||t<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=t,this.data=new Uint8Array(t*t),this.reservedBit=new Uint8Array(t*t)}TI.prototype.set=function(t,e,r,a){const l=t*this.size+e;this.data[l]=r,a&&(this.reservedBit[l]=!0)};TI.prototype.get=function(t,e){return this.data[t*this.size+e]};TI.prototype.xor=function(t,e,r){this.data[t*this.size+e]^=r};TI.prototype.isReserved=function(t,e){return this.reservedBit[t*this.size+e]};var c8e=TI,lge={};(function(t){const e=tu.getSymbolSize;t.getRowColCoords=function(a){if(a===1)return[];const l=Math.floor(a/7)+2,u=e(a),p=u===145?26:Math.ceil((u-13)/(2*l-2))*2,m=[u-7];for(let v=1;v<l-1;v++)m[v]=m[v-1]-p;return m.push(6),m.reverse()},t.getPositions=function(a){const l=[],u=t.getRowColCoords(a),p=u.length;for(let m=0;m<p;m++)for(let v=0;v<p;v++)m===0&&v===0||m===0&&v===p-1||m===p-1&&v===0||l.push([u[m],u[v]]);return l}})(lge);var dge={};const l8e=tu.getSymbolSize,fae=7;dge.getPositions=function(e){const r=l8e(e);return[[0,0],[r-fae,0],[0,r-fae]]};var uge={};(function(t){t.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const e={N1:3,N2:3,N3:40,N4:10};t.isValid=function(l){return l!=null&&l!==""&&!isNaN(l)&&l>=0&&l<=7},t.from=function(l){return t.isValid(l)?parseInt(l,10):void 0},t.getPenaltyN1=function(l){const u=l.size;let p=0,m=0,v=0,w=null,R=null;for(let C=0;C<u;C++){m=v=0,w=R=null;for(let A=0;A<u;A++){let O=l.get(C,A);O===w?m++:(m>=5&&(p+=e.N1+(m-5)),w=O,m=1),O=l.get(A,C),O===R?v++:(v>=5&&(p+=e.N1+(v-5)),R=O,v=1)}m>=5&&(p+=e.N1+(m-5)),v>=5&&(p+=e.N1+(v-5))}return p},t.getPenaltyN2=function(l){const u=l.size;let p=0;for(let m=0;m<u-1;m++)for(let v=0;v<u-1;v++){const w=l.get(m,v)+l.get(m,v+1)+l.get(m+1,v)+l.get(m+1,v+1);(w===4||w===0)&&p++}return p*e.N2},t.getPenaltyN3=function(l){const u=l.size;let p=0,m=0,v=0;for(let w=0;w<u;w++){m=v=0;for(let R=0;R<u;R++)m=m<<1&2047|l.get(w,R),R>=10&&(m===1488||m===93)&&p++,v=v<<1&2047|l.get(R,w),R>=10&&(v===1488||v===93)&&p++}return p*e.N3},t.getPenaltyN4=function(l){let u=0;const p=l.data.length;for(let v=0;v<p;v++)u+=l.data[v];return Math.abs(Math.ceil(u*100/p/5)-10)*e.N4};function r(a,l,u){switch(a){case t.Patterns.PATTERN000:return(l+u)%2===0;case t.Patterns.PATTERN001:return l%2===0;case t.Patterns.PATTERN010:return u%3===0;case t.Patterns.PATTERN011:return(l+u)%3===0;case t.Patterns.PATTERN100:return(Math.floor(l/2)+Math.floor(u/3))%2===0;case t.Patterns.PATTERN101:return l*u%2+l*u%3===0;case t.Patterns.PATTERN110:return(l*u%2+l*u%3)%2===0;case t.Patterns.PATTERN111:return(l*u%3+(l+u)%2)%2===0;default:throw new Error("bad maskPattern:"+a)}}t.applyMask=function(l,u){const p=u.size;for(let m=0;m<p;m++)for(let v=0;v<p;v++)u.isReserved(v,m)||u.xor(v,m,r(l,v,m))},t.getBestMask=function(l,u){const p=Object.keys(t.Patterns).length;let m=0,v=1/0;for(let w=0;w<p;w++){u(w),t.applyMask(w,l);const R=t.getPenaltyN1(l)+t.getPenaltyN2(l)+t.getPenaltyN3(l)+t.getPenaltyN4(l);t.applyMask(w,l),R<v&&(v=R,m=w)}return m}})(uge);var rj={};const O_=nj,G2=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],W2=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];rj.getBlocksCount=function(e,r){switch(r){case O_.L:return G2[(e-1)*4+0];case O_.M:return G2[(e-1)*4+1];case O_.Q:return G2[(e-1)*4+2];case O_.H:return G2[(e-1)*4+3];default:return}};rj.getTotalCodewordsCount=function(e,r){switch(r){case O_.L:return W2[(e-1)*4+0];case O_.M:return W2[(e-1)*4+1];case O_.Q:return W2[(e-1)*4+2];case O_.H:return W2[(e-1)*4+3];default:return}};var hge={},ij={};const qC=new Uint8Array(512),LO=new Uint8Array(256);(function(){let e=1;for(let r=0;r<255;r++)qC[r]=e,LO[e]=r,e<<=1,e&256&&(e^=285);for(let r=255;r<512;r++)qC[r]=qC[r-255]})();ij.log=function(e){if(e<1)throw new Error("log("+e+")");return LO[e]};ij.exp=function(e){return qC[e]};ij.mul=function(e,r){return e===0||r===0?0:qC[LO[e]+LO[r]]};(function(t){const e=ij;t.mul=function(a,l){const u=new Uint8Array(a.length+l.length-1);for(let p=0;p<a.length;p++)for(let m=0;m<l.length;m++)u[p+m]^=e.mul(a[p],l[m]);return u},t.mod=function(a,l){let u=new Uint8Array(a);for(;u.length-l.length>=0;){const p=u[0];for(let v=0;v<l.length;v++)u[v]^=e.mul(l[v],p);let m=0;for(;m<u.length&&u[m]===0;)m++;u=u.slice(m)}return u},t.generateECPolynomial=function(a){let l=new Uint8Array([1]);for(let u=0;u<a;u++)l=t.mul(l,new Uint8Array([1,e.exp(u)]));return l}})(hge);const pge=hge;function g9(t){this.genPoly=void 0,this.degree=t,this.degree&&this.initialize(this.degree)}g9.prototype.initialize=function(e){this.degree=e,this.genPoly=pge.generateECPolynomial(this.degree)};g9.prototype.encode=function(e){if(!this.genPoly)throw new Error("Encoder not initialized");const r=new Uint8Array(e.length+this.degree);r.set(e);const a=pge.mod(r,this.genPoly),l=this.degree-a.length;if(l>0){const u=new Uint8Array(this.degree);return u.set(a,l),u}return a};var d8e=g9,fge={},x0={},_9={};_9.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40};var Df={};const mge="[0-9]+",u8e="[A-Z $%*+\\-./:]+";let UN="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";UN=UN.replace(/u/g,"\\u");const h8e="(?:(?![A-Z0-9 $%*+\\-./:]|"+UN+`)(?:.|[\r
]))+`;Df.KANJI=new RegExp(UN,"g");Df.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");Df.BYTE=new RegExp(h8e,"g");Df.NUMERIC=new RegExp(mge,"g");Df.ALPHANUMERIC=new RegExp(u8e,"g");const p8e=new RegExp("^"+UN+"$"),f8e=new RegExp("^"+mge+"$"),m8e=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");Df.testKanji=function(e){return p8e.test(e)};Df.testNumeric=function(e){return f8e.test(e)};Df.testAlphanumeric=function(e){return m8e.test(e)};(function(t){const e=_9,r=Df;t.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},t.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},t.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},t.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},t.MIXED={bit:-1},t.getCharCountIndicator=function(u,p){if(!u.ccBits)throw new Error("Invalid mode: "+u);if(!e.isValid(p))throw new Error("Invalid version: "+p);return p>=1&&p<10?u.ccBits[0]:p<27?u.ccBits[1]:u.ccBits[2]},t.getBestModeForData=function(u){return r.testNumeric(u)?t.NUMERIC:r.testAlphanumeric(u)?t.ALPHANUMERIC:r.testKanji(u)?t.KANJI:t.BYTE},t.toString=function(u){if(u&&u.id)return u.id;throw new Error("Invalid mode")},t.isValid=function(u){return u&&u.bit&&u.ccBits};function a(l){if(typeof l!="string")throw new Error("Param is not a string");switch(l.toLowerCase()){case"numeric":return t.NUMERIC;case"alphanumeric":return t.ALPHANUMERIC;case"kanji":return t.KANJI;case"byte":return t.BYTE;default:throw new Error("Unknown mode: "+l)}}t.from=function(u,p){if(t.isValid(u))return u;try{return a(u)}catch{return p}}})(x0);(function(t){const e=tu,r=rj,a=nj,l=x0,u=_9,p=7973,m=e.getBCHDigit(p);function v(A,O,U){for(let F=1;F<=40;F++)if(O<=t.getCapacity(F,U,A))return F}function w(A,O){return l.getCharCountIndicator(A,O)+4}function R(A,O){let U=0;return A.forEach(function(F){const q=w(F.mode,O);U+=q+F.getBitsLength()}),U}function C(A,O){for(let U=1;U<=40;U++)if(R(A,U)<=t.getCapacity(U,O,l.MIXED))return U}t.from=function(O,U){return u.isValid(O)?parseInt(O,10):U},t.getCapacity=function(O,U,F){if(!u.isValid(O))throw new Error("Invalid QR Code version");typeof F>"u"&&(F=l.BYTE);const q=e.getSymbolTotalCodewords(O),W=r.getTotalCodewordsCount(O,U),H=(q-W)*8;if(F===l.MIXED)return H;const X=H-w(F,O);switch(F){case l.NUMERIC:return Math.floor(X/10*3);case l.ALPHANUMERIC:return Math.floor(X/11*2);case l.KANJI:return Math.floor(X/13);case l.BYTE:default:return Math.floor(X/8)}},t.getBestVersionForData=function(O,U){let F;const q=a.from(U,a.M);if(Array.isArray(O)){if(O.length>1)return C(O,q);if(O.length===0)return 1;F=O[0]}else F=O;return v(F.mode,F.getLength(),q)},t.getEncodedBits=function(O){if(!u.isValid(O)||O<7)throw new Error("Invalid QR Code version");let U=O<<12;for(;e.getBCHDigit(U)-m>=0;)U^=p<<e.getBCHDigit(U)-m;return O<<12|U}})(fge);var gge={};const Wz=tu,_ge=1335,g8e=21522,mae=Wz.getBCHDigit(_ge);gge.getEncodedBits=function(e,r){const a=e.bit<<3|r;let l=a<<10;for(;Wz.getBCHDigit(l)-mae>=0;)l^=_ge<<Wz.getBCHDigit(l)-mae;return(a<<10|l)^g8e};var yge={};const _8e=x0;function Sw(t){this.mode=_8e.NUMERIC,this.data=t.toString()}Sw.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)};Sw.prototype.getLength=function(){return this.data.length};Sw.prototype.getBitsLength=function(){return Sw.getBitsLength(this.data.length)};Sw.prototype.write=function(e){let r,a,l;for(r=0;r+3<=this.data.length;r+=3)a=this.data.substr(r,3),l=parseInt(a,10),e.put(l,10);const u=this.data.length-r;u>0&&(a=this.data.substr(r),l=parseInt(a,10),e.put(l,u*3+1))};var y8e=Sw;const v8e=x0,SB=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function Tw(t){this.mode=v8e.ALPHANUMERIC,this.data=t}Tw.getBitsLength=function(e){return 11*Math.floor(e/2)+6*(e%2)};Tw.prototype.getLength=function(){return this.data.length};Tw.prototype.getBitsLength=function(){return Tw.getBitsLength(this.data.length)};Tw.prototype.write=function(e){let r;for(r=0;r+2<=this.data.length;r+=2){let a=SB.indexOf(this.data[r])*45;a+=SB.indexOf(this.data[r+1]),e.put(a,11)}this.data.length%2&&e.put(SB.indexOf(this.data[r]),6)};var E8e=Tw;const x8e=x0;function Rw(t){this.mode=x8e.BYTE,typeof t=="string"?this.data=new TextEncoder().encode(t):this.data=new Uint8Array(t)}Rw.getBitsLength=function(e){return e*8};Rw.prototype.getLength=function(){return this.data.length};Rw.prototype.getBitsLength=function(){return Rw.getBitsLength(this.data.length)};Rw.prototype.write=function(t){for(let e=0,r=this.data.length;e<r;e++)t.put(this.data[e],8)};var b8e=Rw;const w8e=x0,S8e=tu;function Cw(t){this.mode=w8e.KANJI,this.data=t}Cw.getBitsLength=function(e){return e*13};Cw.prototype.getLength=function(){return this.data.length};Cw.prototype.getBitsLength=function(){return Cw.getBitsLength(this.data.length)};Cw.prototype.write=function(t){let e;for(e=0;e<this.data.length;e++){let r=S8e.toSJIS(this.data[e]);if(r>=33088&&r<=40956)r-=33088;else if(r>=57408&&r<=60351)r-=49472;else throw new Error("Invalid SJIS character: "+this.data[e]+`
Make sure your charset is UTF-8`);r=(r>>>8&255)*192+(r&255),t.put(r,13)}};var T8e=Cw,vge={exports:{}};(function(t){var e={single_source_shortest_paths:function(r,a,l){var u={},p={};p[a]=0;var m=e.PriorityQueue.make();m.push(a,0);for(var v,w,R,C,A,O,U,F,q;!m.empty();){v=m.pop(),w=v.value,C=v.cost,A=r[w]||{};for(R in A)A.hasOwnProperty(R)&&(O=A[R],U=C+O,F=p[R],q=typeof p[R]>"u",(q||F>U)&&(p[R]=U,m.push(R,U),u[R]=w))}if(typeof l<"u"&&typeof p[l]>"u"){var W=["Could not find a path from ",a," to ",l,"."].join("");throw new Error(W)}return u},extract_shortest_path_from_predecessor_list:function(r,a){for(var l=[],u=a;u;)l.push(u),r[u],u=r[u];return l.reverse(),l},find_path:function(r,a,l){var u=e.single_source_shortest_paths(r,a,l);return e.extract_shortest_path_from_predecessor_list(u,l)},PriorityQueue:{make:function(r){var a=e.PriorityQueue,l={},u;r=r||{};for(u in a)a.hasOwnProperty(u)&&(l[u]=a[u]);return l.queue=[],l.sorter=r.sorter||a.default_sorter,l},default_sorter:function(r,a){return r.cost-a.cost},push:function(r,a){var l={value:r,cost:a};this.queue.push(l),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};t.exports=e})(vge);var R8e=vge.exports;(function(t){const e=x0,r=y8e,a=E8e,l=b8e,u=T8e,p=Df,m=tu,v=R8e;function w(W){return unescape(encodeURIComponent(W)).length}function R(W,H,X){const ne=[];let te;for(;(te=W.exec(X))!==null;)ne.push({data:te[0],index:te.index,mode:H,length:te[0].length});return ne}function C(W){const H=R(p.NUMERIC,e.NUMERIC,W),X=R(p.ALPHANUMERIC,e.ALPHANUMERIC,W);let ne,te;return m.isKanjiModeEnabled()?(ne=R(p.BYTE,e.BYTE,W),te=R(p.KANJI,e.KANJI,W)):(ne=R(p.BYTE_KANJI,e.BYTE,W),te=[]),H.concat(X,ne,te).sort(function(J,Q){return J.index-Q.index}).map(function(J){return{data:J.data,mode:J.mode,length:J.length}})}function A(W,H){switch(H){case e.NUMERIC:return r.getBitsLength(W);case e.ALPHANUMERIC:return a.getBitsLength(W);case e.KANJI:return u.getBitsLength(W);case e.BYTE:return l.getBitsLength(W)}}function O(W){return W.reduce(function(H,X){const ne=H.length-1>=0?H[H.length-1]:null;return ne&&ne.mode===X.mode?(H[H.length-1].data+=X.data,H):(H.push(X),H)},[])}function U(W){const H=[];for(let X=0;X<W.length;X++){const ne=W[X];switch(ne.mode){case e.NUMERIC:H.push([ne,{data:ne.data,mode:e.ALPHANUMERIC,length:ne.length},{data:ne.data,mode:e.BYTE,length:ne.length}]);break;case e.ALPHANUMERIC:H.push([ne,{data:ne.data,mode:e.BYTE,length:ne.length}]);break;case e.KANJI:H.push([ne,{data:ne.data,mode:e.BYTE,length:w(ne.data)}]);break;case e.BYTE:H.push([{data:ne.data,mode:e.BYTE,length:w(ne.data)}])}}return H}function F(W,H){const X={},ne={start:{}};let te=["start"];for(let he=0;he<W.length;he++){const J=W[he],Q=[];for(let ce=0;ce<J.length;ce++){const de=J[ce],pe=""+he+ce;Q.push(pe),X[pe]={node:de,lastCount:0},ne[pe]={};for(let be=0;be<te.length;be++){const ye=te[be];X[ye]&&X[ye].node.mode===de.mode?(ne[ye][pe]=A(X[ye].lastCount+de.length,de.mode)-A(X[ye].lastCount,de.mode),X[ye].lastCount+=de.length):(X[ye]&&(X[ye].lastCount=de.length),ne[ye][pe]=A(de.length,de.mode)+4+e.getCharCountIndicator(de.mode,H))}}te=Q}for(let he=0;he<te.length;he++)ne[te[he]].end=0;return{map:ne,table:X}}function q(W,H){let X;const ne=e.getBestModeForData(W);if(X=e.from(H,ne),X!==e.BYTE&&X.bit<ne.bit)throw new Error('"'+W+'" cannot be encoded with mode '+e.toString(X)+`.
 Suggested mode is: `+e.toString(ne));switch(X===e.KANJI&&!m.isKanjiModeEnabled()&&(X=e.BYTE),X){case e.NUMERIC:return new r(W);case e.ALPHANUMERIC:return new a(W);case e.KANJI:return new u(W);case e.BYTE:return new l(W)}}t.fromArray=function(H){return H.reduce(function(X,ne){return typeof ne=="string"?X.push(q(ne,null)):ne.data&&X.push(q(ne.data,ne.mode)),X},[])},t.fromString=function(H,X){const ne=C(H,m.isKanjiModeEnabled()),te=U(ne),he=F(te,X),J=v.find_path(he.map,"start","end"),Q=[];for(let ce=1;ce<J.length-1;ce++)Q.push(he.table[J[ce]].node);return t.fromArray(O(Q))},t.rawSplit=function(H){return t.fromArray(C(H,m.isKanjiModeEnabled()))}})(yge);const sj=tu,TB=nj,C8e=o8e,N8e=c8e,I8e=lge,A8e=dge,Hz=uge,Kz=rj,k8e=d8e,jO=fge,P8e=gge,D8e=x0,RB=yge;function O8e(t,e){const r=t.size,a=A8e.getPositions(e);for(let l=0;l<a.length;l++){const u=a[l][0],p=a[l][1];for(let m=-1;m<=7;m++)if(!(u+m<=-1||r<=u+m))for(let v=-1;v<=7;v++)p+v<=-1||r<=p+v||(m>=0&&m<=6&&(v===0||v===6)||v>=0&&v<=6&&(m===0||m===6)||m>=2&&m<=4&&v>=2&&v<=4?t.set(u+m,p+v,!0,!0):t.set(u+m,p+v,!1,!0))}}function L8e(t){const e=t.size;for(let r=8;r<e-8;r++){const a=r%2===0;t.set(r,6,a,!0),t.set(6,r,a,!0)}}function j8e(t,e){const r=I8e.getPositions(e);for(let a=0;a<r.length;a++){const l=r[a][0],u=r[a][1];for(let p=-2;p<=2;p++)for(let m=-2;m<=2;m++)p===-2||p===2||m===-2||m===2||p===0&&m===0?t.set(l+p,u+m,!0,!0):t.set(l+p,u+m,!1,!0)}}function M8e(t,e){const r=t.size,a=jO.getEncodedBits(e);let l,u,p;for(let m=0;m<18;m++)l=Math.floor(m/3),u=m%3+r-8-3,p=(a>>m&1)===1,t.set(l,u,p,!0),t.set(u,l,p,!0)}function CB(t,e,r){const a=t.size,l=P8e.getEncodedBits(e,r);let u,p;for(u=0;u<15;u++)p=(l>>u&1)===1,u<6?t.set(u,8,p,!0):u<8?t.set(u+1,8,p,!0):t.set(a-15+u,8,p,!0),u<8?t.set(8,a-u-1,p,!0):u<9?t.set(8,15-u-1+1,p,!0):t.set(8,15-u-1,p,!0);t.set(a-8,8,1,!0)}function U8e(t,e){const r=t.size;let a=-1,l=r-1,u=7,p=0;for(let m=r-1;m>0;m-=2)for(m===6&&m--;;){for(let v=0;v<2;v++)if(!t.isReserved(l,m-v)){let w=!1;p<e.length&&(w=(e[p]>>>u&1)===1),t.set(l,m-v,w),u--,u===-1&&(p++,u=7)}if(l+=a,l<0||r<=l){l-=a,a=-a;break}}}function V8e(t,e,r){const a=new C8e;r.forEach(function(v){a.put(v.mode.bit,4),a.put(v.getLength(),D8e.getCharCountIndicator(v.mode,t)),v.write(a)});const l=sj.getSymbolTotalCodewords(t),u=Kz.getTotalCodewordsCount(t,e),p=(l-u)*8;for(a.getLengthInBits()+4<=p&&a.put(0,4);a.getLengthInBits()%8!==0;)a.putBit(0);const m=(p-a.getLengthInBits())/8;for(let v=0;v<m;v++)a.put(v%2?17:236,8);return F8e(a,t,e)}function F8e(t,e,r){const a=sj.getSymbolTotalCodewords(e),l=Kz.getTotalCodewordsCount(e,r),u=a-l,p=Kz.getBlocksCount(e,r),m=a%p,v=p-m,w=Math.floor(a/p),R=Math.floor(u/p),C=R+1,A=w-R,O=new k8e(A);let U=0;const F=new Array(p),q=new Array(p);let W=0;const H=new Uint8Array(t.buffer);for(let J=0;J<p;J++){const Q=J<v?R:C;F[J]=H.slice(U,U+Q),q[J]=O.encode(F[J]),U+=Q,W=Math.max(W,Q)}const X=new Uint8Array(a);let ne=0,te,he;for(te=0;te<W;te++)for(he=0;he<p;he++)te<F[he].length&&(X[ne++]=F[he][te]);for(te=0;te<A;te++)for(he=0;he<p;he++)X[ne++]=q[he][te];return X}function B8e(t,e,r,a){let l;if(Array.isArray(t))l=RB.fromArray(t);else if(typeof t=="string"){let w=e;if(!w){const R=RB.rawSplit(t);w=jO.getBestVersionForData(R,r)}l=RB.fromString(t,w||40)}else throw new Error("Invalid data");const u=jO.getBestVersionForData(l,r);if(!u)throw new Error("The amount of data is too big to be stored in a QR Code");if(!e)e=u;else if(e<u)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+u+`.
`);const p=V8e(e,r,l),m=sj.getSymbolSize(e),v=new N8e(m);return O8e(v,e),L8e(v),j8e(v,e),CB(v,r,0),e>=7&&M8e(v,e),U8e(v,p),isNaN(a)&&(a=Hz.getBestMask(v,CB.bind(null,v,r))),Hz.applyMask(a,v),CB(v,r,a),{modules:v,version:e,errorCorrectionLevel:r,maskPattern:a,segments:l}}oge.create=function(e,r){if(typeof e>"u"||e==="")throw new Error("No input text");let a=TB.M,l,u;return typeof r<"u"&&(a=TB.from(r.errorCorrectionLevel,TB.M),l=jO.from(r.version),u=Hz.from(r.maskPattern),r.toSJISFunc&&sj.setToSJISFunction(r.toSJISFunc)),B8e(e,l,a,u)};var Ege={},y9={};(function(t){function e(r){if(typeof r=="number"&&(r=r.toString()),typeof r!="string")throw new Error("Color should be defined as hex string");let a=r.slice().replace("#","").split("");if(a.length<3||a.length===5||a.length>8)throw new Error("Invalid hex color: "+r);(a.length===3||a.length===4)&&(a=Array.prototype.concat.apply([],a.map(function(u){return[u,u]}))),a.length===6&&a.push("F","F");const l=parseInt(a.join(""),16);return{r:l>>24&255,g:l>>16&255,b:l>>8&255,a:l&255,hex:"#"+a.slice(0,6).join("")}}t.getOptions=function(a){a||(a={}),a.color||(a.color={});const l=typeof a.margin>"u"||a.margin===null||a.margin<0?4:a.margin,u=a.width&&a.width>=21?a.width:void 0,p=a.scale||4;return{width:u,scale:u?4:p,margin:l,color:{dark:e(a.color.dark||"#000000ff"),light:e(a.color.light||"#ffffffff")},type:a.type,rendererOpts:a.rendererOpts||{}}},t.getScale=function(a,l){return l.width&&l.width>=a+l.margin*2?l.width/(a+l.margin*2):l.scale},t.getImageWidth=function(a,l){const u=t.getScale(a,l);return Math.floor((a+l.margin*2)*u)},t.qrToImageData=function(a,l,u){const p=l.modules.size,m=l.modules.data,v=t.getScale(p,u),w=Math.floor((p+u.margin*2)*v),R=u.margin*v,C=[u.color.light,u.color.dark];for(let A=0;A<w;A++)for(let O=0;O<w;O++){let U=(A*w+O)*4,F=u.color.light;if(A>=R&&O>=R&&A<w-R&&O<w-R){const q=Math.floor((A-R)/v),W=Math.floor((O-R)/v);F=C[m[q*p+W]?1:0]}a[U++]=F.r,a[U++]=F.g,a[U++]=F.b,a[U]=F.a}}})(y9);(function(t){const e=y9;function r(l,u,p){l.clearRect(0,0,u.width,u.height),u.style||(u.style={}),u.height=p,u.width=p,u.style.height=p+"px",u.style.width=p+"px"}function a(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}t.render=function(u,p,m){let v=m,w=p;typeof v>"u"&&(!p||!p.getContext)&&(v=p,p=void 0),p||(w=a()),v=e.getOptions(v);const R=e.getImageWidth(u.modules.size,v),C=w.getContext("2d"),A=C.createImageData(R,R);return e.qrToImageData(A.data,u,v),r(C,w,R),C.putImageData(A,0,0),w},t.renderToDataURL=function(u,p,m){let v=m;typeof v>"u"&&(!p||!p.getContext)&&(v=p,p=void 0),v||(v={});const w=t.render(u,p,v),R=v.type||"image/png",C=v.rendererOpts||{};return w.toDataURL(R,C.quality)}})(Ege);var xge={};const z8e=y9;function gae(t,e){const r=t.a/255,a=e+'="'+t.hex+'"';return r<1?a+" "+e+'-opacity="'+r.toFixed(2).slice(1)+'"':a}function NB(t,e,r){let a=t+e;return typeof r<"u"&&(a+=" "+r),a}function G8e(t,e,r){let a="",l=0,u=!1,p=0;for(let m=0;m<t.length;m++){const v=Math.floor(m%e),w=Math.floor(m/e);!v&&!u&&(u=!0),t[m]?(p++,m>0&&v>0&&t[m-1]||(a+=u?NB("M",v+r,.5+w+r):NB("m",l,0),l=0,u=!1),v+1<e&&t[m+1]||(a+=NB("h",p),p=0)):l++}return a}xge.render=function(e,r,a){const l=z8e.getOptions(r),u=e.modules.size,p=e.modules.data,m=u+l.margin*2,v=l.color.light.a?"<path "+gae(l.color.light,"fill")+' d="M0 0h'+m+"v"+m+'H0z"/>':"",w="<path "+gae(l.color.dark,"stroke")+' d="'+G8e(p,u,l.margin)+'"/>',R='viewBox="0 0 '+m+" "+m+'"',A='<svg xmlns="http://www.w3.org/2000/svg" '+(l.width?'width="'+l.width+'" height="'+l.width+'" ':"")+R+' shape-rendering="crispEdges">'+v+w+`</svg>
`;return typeof a=="function"&&a(null,A),A};const W8e=s8e,qz=oge,bge=Ege,H8e=xge;function v9(t,e,r,a,l){const u=[].slice.call(arguments,1),p=u.length,m=typeof u[p-1]=="function";if(!m&&!W8e())throw new Error("Callback required as last argument");if(m){if(p<2)throw new Error("Too few arguments provided");p===2?(l=r,r=e,e=a=void 0):p===3&&(e.getContext&&typeof l>"u"?(l=a,a=void 0):(l=a,a=r,r=e,e=void 0))}else{if(p<1)throw new Error("Too few arguments provided");return p===1?(r=e,e=a=void 0):p===2&&!e.getContext&&(a=r,r=e,e=void 0),new Promise(function(v,w){try{const R=qz.create(r,a);v(t(R,e,a))}catch(R){w(R)}})}try{const v=qz.create(r,a);l(null,t(v,e,a))}catch(v){l(v)}}SI.create=qz.create;SI.toCanvas=v9.bind(null,bge.render);SI.toDataURL=v9.bind(null,bge.renderToDataURL);SI.toString=v9.bind(null,function(t,e,r){return H8e.render(t,r)});const K8e=({code:t,onClose:e})=>{const[r,a]=V.useState("");return V.useEffect(()=>{(async()=>{try{const u=await SI.toDataURL(`https://synclulu.app/join/${t}`,{width:256,margin:2,color:{dark:"#1a1a1a",light:"#ffffff"}});a(u)}catch(u){console.error("QR generation failed:",u)}})()},[t]),c.jsx(Ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",onClick:e,children:c.jsxs(Ne.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-[var(--synclulu-card)] rounded-3xl p-6 max-w-sm w-full shadow-2xl border border-[var(--synclulu-border)]",onClick:l=>l.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center justify-between mb-6",children:[c.jsx("h3",{className:"text-xl font-bold text-[var(--synclulu-text)]",children:"QR-Code scannen"}),c.jsx("button",{onClick:e,className:"w-8 h-8 rounded-full bg-[var(--synclulu-bg)] flex items-center justify-center hover:opacity-80 transition-opacity",children:c.jsx(Di,{size:16,className:"text-[var(--synclulu-muted)]"})})]}),c.jsx("div",{className:"bg-gradient-to-br from-[var(--synclulu-accent)]/10 to-pink-500/10 rounded-2xl p-6 flex items-center justify-center mb-4",children:r?c.jsx("img",{src:r,alt:"QR Code",className:"w-48 h-48 rounded-xl"}):c.jsx("div",{className:"w-48 h-48 bg-[var(--synclulu-bg)] animate-pulse rounded-xl"})}),c.jsx("p",{className:"text-center text-[var(--synclulu-muted)] text-sm mb-2",children:"Lass deine Freunde diesen Code scannen"}),c.jsx("p",{className:"text-center font-mono text-lg font-bold text-[var(--synclulu-accent)]",children:t})]})})},q8e=({friend:t})=>{const r={pending:{label:"Eingeladen",color:"bg-amber-500/10 text-amber-500",icon:c.jsx(Ua,{size:12})},registered:{label:"Registriert",color:"bg-blue-500/10 text-blue-500",icon:c.jsx(_r,{size:12})},active:{label:"Aktiv",color:"bg-green-500/10 text-green-500",icon:c.jsx(kn,{size:12})}}[t.status];return c.jsxs(Ne.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-center gap-3 p-3 bg-[var(--synclulu-card)] rounded-2xl shadow-sm border border-[var(--synclulu-border)]",children:[c.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-[var(--synclulu-accent)]/20 to-pink-500/20 flex items-center justify-center overflow-hidden",children:t.avatar?c.jsx("img",{src:t.avatar,alt:"",className:"w-full h-full object-cover"}):c.jsx(cr,{size:20,className:"text-[var(--synclulu-accent)]"})}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("p",{className:"font-semibold text-[var(--synclulu-text)] truncate",children:t.displayName||t.username||"Anonym"}),c.jsx("p",{className:"text-xs text-[var(--synclulu-muted)]",children:t.invitedAt.toLocaleDateString("de-DE")})]}),c.jsxs("div",{className:`flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-semibold ${r.color}`,children:[r.icon,r.label]})]})},Y8e=({milestone:t,currentCount:e})=>c.jsxs("div",{className:`relative p-4 rounded-2xl border transition-all ${t.unlocked?"bg-gradient-to-br from-[var(--synclulu-accent)]/10 to-pink-500/10 border-[var(--synclulu-accent)]/30 shadow-lg":"bg-[var(--synclulu-card)] border-[var(--synclulu-border)] opacity-60"}`,children:[t.unlocked&&c.jsx("div",{className:"absolute -top-2 -right-2 w-6 h-6 rounded-full bg-green-500 flex items-center justify-center shadow-lg",children:c.jsx(_r,{size:12,className:"text-white"})}),c.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[c.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${t.unlocked?"bg-[var(--synclulu-accent)] text-white":"bg-[var(--synclulu-bg)] text-[var(--synclulu-muted)]"}`,children:t.icon}),c.jsxs("div",{children:[c.jsxs("p",{className:`font-bold ${t.unlocked?"text-[var(--synclulu-text)]":"text-[var(--synclulu-muted)]"}`,children:[t.count," Freunde"]}),c.jsx("p",{className:`text-xs ${t.unlocked?"text-[var(--synclulu-accent)]":"text-[var(--synclulu-muted)]"}`,children:t.reward})]})]}),!t.unlocked&&c.jsxs("div",{className:"mt-2",children:[c.jsx("div",{className:"h-1.5 bg-[var(--synclulu-bg)] rounded-full overflow-hidden",children:c.jsx(Ne.div,{initial:{width:0},animate:{width:`${Math.min(100,e/t.count*100)}%`},className:"h-full bg-[var(--synclulu-accent)] rounded-full"})}),c.jsxs("p",{className:"text-[10px] text-[var(--synclulu-muted)] mt-1 text-right",children:[e,"/",t.count]})]})]}),_ae=()=>{const t=yr(),{user:e}=Jr(),[r,a]=V.useState(""),[l,u]=V.useState(5),[p,m]=V.useState(5),[v,w]=V.useState([]),[R,C]=V.useState(!0),[A,O]=V.useState(!1),[U,F]=V.useState("card"),q=[{count:1,reward:"7 Tage Premium",rewardDays:7,icon:c.jsx(Ji,{size:18}),unlocked:v.filter(H=>H.status!=="pending").length>=1},{count:3,reward:"14 Tage Premium",rewardDays:14,icon:c.jsx(_o,{size:18}),unlocked:v.filter(H=>H.status!=="pending").length>=3},{count:5,reward:"30 Tage Premium",rewardDays:30,icon:c.jsx(as,{size:18}),unlocked:v.filter(H=>H.status!=="pending").length>=5},{count:10,reward:"Lifetime Premium",rewardDays:999,icon:c.jsx(fz,{size:18}),unlocked:v.filter(H=>H.status!=="pending").length>=10}];V.useEffect(()=>{(async()=>{var X,ne;if(e!=null&&e.id){C(!0);try{const te=await Bn(tt(De,"users",e.id));if(te.exists()){const ce=te.data();a(ce.referralCode||`synclulu-${e.id.slice(0,6).toUpperCase()}`),u(ce.remainingInvites??5),m(ce.totalInvites??5)}const he=Mr(mn(De,"referrals"),Kn("referrerId","==",e.id),ih("createdAt","desc")),J=await Cr(he),Q=[];for(const ce of J.docs){const de=ce.data();let pe={};if(de.referredId){const be=await Bn(tt(De,"users",de.referredId));be.exists()&&(pe=be.data())}Q.push({id:de.referredId||ce.id,username:pe.username||"",displayName:pe.displayName||de.invitedName||"",avatar:pe.avatarUrl,status:de.status||"pending",invitedAt:((X=de.createdAt)==null?void 0:X.toDate())||new Date,registeredAt:(ne=de.registeredAt)==null?void 0:ne.toDate()})}w(Q)}catch(te){console.error("[InvitesPage] Load failed:",te)}finally{C(!1)}}})()},[e==null?void 0:e.id]);const W=v.filter(H=>H.status!=="pending").length;return c.jsxs("div",{className:"min-h-screen bg-[var(--synclulu-bg)] theme-transition",children:[c.jsx("div",{className:"fixed inset-0 pointer-events-none",children:c.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-[var(--synclulu-accent)]/5 via-transparent to-transparent"})}),c.jsxs("div",{className:"px-4 pt-6 pb-4",children:[c.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[c.jsx(Ne.button,{whileTap:{scale:.95},onClick:()=>t(-1),className:"w-10 h-10 rounded-xl bg-[var(--synclulu-card)] shadow-sm border border-[var(--synclulu-border)] flex items-center justify-center hover:opacity-80 transition-opacity",children:c.jsx(dd,{size:20,className:"text-[var(--synclulu-muted)]"})}),c.jsxs("div",{children:[c.jsx("h1",{className:"font-display text-2xl font-bold text-[var(--synclulu-text)]",children:"Einladungen"}),c.jsx("p",{className:"text-sm text-[var(--synclulu-muted)]",children:"Lade Freunde ein & erhalte Rewards"})]})]}),c.jsx("div",{className:"flex gap-2 p-1 bg-[var(--synclulu-card)] rounded-2xl border border-[var(--synclulu-border)]",children:[{key:"card",label:"Ticket",icon:_o},{key:"friends",label:"Freunde",icon:cr},{key:"rewards",label:"Rewards",icon:fz}].map(H=>{const X=H.icon,ne=U===H.key;return c.jsxs("button",{onClick:()=>{F(H.key),"vibrate"in navigator&&navigator.vibrate(10)},className:`flex-1 py-2.5 px-3 rounded-xl text-sm font-semibold flex items-center justify-center gap-2 transition-all ${ne?"bg-[var(--synclulu-accent)] text-white shadow-md":"text-[var(--synclulu-muted)] hover:text-[var(--synclulu-text)]"}`,children:[c.jsx(X,{size:16}),H.label]},H.key)})})]}),c.jsx("div",{className:"px-4 pb-32",children:R?c.jsx("div",{className:"flex items-center justify-center py-20",children:c.jsx("div",{className:"w-10 h-10 border-4 border-[var(--synclulu-accent)] border-t-transparent rounded-full animate-spin"})}):c.jsx(c.Fragment,{children:c.jsxs(Ur,{mode:"wait",children:[U==="card"&&c.jsxs(Ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[c.jsx(i8e,{code:r,remainingInvites:l,totalInvites:p,rewardDays:7,onShowQR:()=>O(!0),variant:W>=10?"diamond":W>=5?"platinum":"golden"}),c.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[c.jsxs("div",{className:"bg-[var(--synclulu-card)] rounded-2xl p-4 text-center shadow-sm border border-[var(--synclulu-border)]",children:[c.jsx("p",{className:"text-2xl font-bold text-[var(--synclulu-accent)]",children:v.length}),c.jsx("p",{className:"text-[10px] text-[var(--synclulu-muted)] uppercase tracking-wider",children:"Eingeladen"})]}),c.jsxs("div",{className:"bg-[var(--synclulu-card)] rounded-2xl p-4 text-center shadow-sm border border-[var(--synclulu-border)]",children:[c.jsx("p",{className:"text-2xl font-bold text-green-500",children:W}),c.jsx("p",{className:"text-[10px] text-[var(--synclulu-muted)] uppercase tracking-wider",children:"Aktiv"})]}),c.jsxs("div",{className:"bg-[var(--synclulu-card)] rounded-2xl p-4 text-center shadow-sm border border-[var(--synclulu-border)]",children:[c.jsx("p",{className:"text-2xl font-bold text-amber-500",children:l}),c.jsx("p",{className:"text-[10px] text-[var(--synclulu-muted)] uppercase tracking-wider",children:"brig"})]})]})]},"card"),U==="friends"&&c.jsx(Ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-3",children:v.length===0?c.jsxs("div",{className:"text-center py-16",children:[c.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full bg-[var(--synclulu-card)] flex items-center justify-center border border-[var(--synclulu-border)]",children:c.jsx(cr,{size:32,className:"text-[var(--synclulu-muted)]"})}),c.jsx("p",{className:"text-[var(--synclulu-muted)] mb-2",children:"Noch keine Einladungen"}),c.jsx("p",{className:"text-sm text-[var(--synclulu-muted)] opacity-60",children:"Teile deinen Code und lade Freunde ein!"})]}):v.map(H=>c.jsx(q8e,{friend:H},H.id))},"friends"),U==="rewards"&&c.jsxs(Ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-4",children:[c.jsxs("div",{className:"bg-gradient-to-r from-[var(--synclulu-accent)] to-pink-500 rounded-2xl p-4 text-white",children:[c.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[c.jsx(kn,{size:24}),c.jsxs("div",{children:[c.jsx("p",{className:"font-bold",children:"Aktive Freunde"}),c.jsx("p",{className:"text-2xl font-black",children:W})]})]}),c.jsx("p",{className:"text-sm text-white/80",children:"Je mehr Freunde sich registrieren, desto besser deine Rewards!"})]}),c.jsx("div",{className:"grid grid-cols-2 gap-3",children:q.map((H,X)=>c.jsx(Y8e,{milestone:H,currentCount:W},X))})]},"rewards")]})})}),c.jsx(Ur,{children:A&&c.jsx(K8e,{code:r,onClose:()=>O(!1)})})]})},wge={R_MIN:5,R_MAX:100,K_DAMPING:.15,HEARTBEAT_THRESHOLD:10,TARGET_MAGIC_DENSITY:3,EXPANSION_STEP:2.5};function $8e(t,e=1,r=wge){const{R_MIN:a,R_MAX:l,K_DAMPING:u}=r,p=-u*(t*e),m=a+(l-a)*Math.exp(p);return Math.max(a,Math.min(l,m))}function X8e(t,e){if(e.length===0)return .5;let r=0;for(const l of e){const u=t.filter(m=>l.includes(m)).length,p=Math.max(t.length,l.length);r+=p>0?u/p:0}return .5+r/e.length}function yae(t,e){const r=Math.PI*e*e;return r>0?t/r:0}function IB(t,e){const a=xC(e.latitude-t.latitude),l=xC(e.longitude-t.longitude),u=Math.sin(a/2)*Math.sin(a/2)+Math.cos(xC(t.latitude))*Math.cos(xC(e.latitude))*Math.sin(l/2)*Math.sin(l/2);return 6371*(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)))}function xC(t){return t*(Math.PI/180)}function J8e(t,e){const r=e/111,a=e/(111*Math.cos(xC(t.latitude)));return{north:t.latitude+r,south:t.latitude-r,east:t.longitude+a,west:t.longitude-a}}class Q8e{constructor(e={}){Qc(this,"config");Qc(this,"currentAura",null);Qc(this,"updateCallbacks",[]);this.config={...wge,...e}}async initialize(e,r=[]){let a=this.config.R_MIN;const{users:l,count:u}=await this.findActiveUsersInRadius(e,a),p=X8e(r,l.map(A=>A.interests)),m=$8e(u,p,this.config),v=yae(u,a),w=v<this.config.TARGET_MAGIC_DENSITY;let R,C;return w&&u<3&&(R=await this.findNearestHotspot(e,a),R&&(C=`Deine Aura weitet sich aus, um Magie zu finden... (${R.distanceKm.toFixed(1)}km entfernt)`)),this.currentAura={center:e,currentRadius:a,targetRadius:m,activeUsersInRange:u,magicDensity:v,isExpanding:w,nearestHotspot:R,expansionMessage:C},w&&this.animateExpansion(),this.currentAura}async animateExpansion(){if(!this.currentAura)return;const{targetRadius:e,currentRadius:r}=this.currentAura;if(r>=e){this.currentAura.isExpanding=!1,this.notifyUpdate();return}const a=Math.min(r+this.config.EXPANSION_STEP,e);this.currentAura.currentRadius=a;const{count:l}=await this.findActiveUsersInRadius(this.currentAura.center,a);this.currentAura.activeUsersInRange=l,this.currentAura.magicDensity=yae(l,a),this.notifyUpdate(),a<e?setTimeout(()=>this.animateExpansion(),500):(this.currentAura.isExpanding=!1,this.currentAura.expansionMessage=void 0,this.notifyUpdate())}async findActiveUsersInRadius(e,r){try{const a=new Date;a.setMinutes(a.getMinutes()-this.config.HEARTBEAT_THRESHOLD);const l=J8e(e,r),u=mn(De,"users"),p=Mr(u,Kn("isActive","==",!0),Kn("location.latitude",">=",l.south),Kn("location.latitude","<=",l.north)),m=await Cr(p),v=[];return m.forEach(w=>{var U,F;const R=w.data();if(!R.location)return;const C={latitude:R.location.latitude,longitude:R.location.longitude};if(C.longitude<l.west||C.longitude>l.east||IB(e,C)>r)return;const O=((F=(U=R.lastSeen)==null?void 0:U.toDate)==null?void 0:F.call(U))||new Date(0);O<a||v.push({id:w.id,location:C,lastHeartbeat:O,interests:R.interests||[],activityScore:R.activityScore||0})}),{users:v,count:v.length}}catch(a){return console.error("Error finding active users:",a),{users:[],count:0}}}async findNearestHotspot(e,r){try{const a=Math.min(r*3,this.config.R_MAX),{users:l}=await this.findActiveUsersInRadius(e,a);if(l.length<2)return;const u=this.clusterUsers(l);if(u.length===0)return;let p,m=1/0;for(const v of u){const w=IB(e,v.center);w>r&&w<m&&(m=w,p={id:`cluster-${v.center.latitude.toFixed(4)}-${v.center.longitude.toFixed(4)}`,center:v.center,userCount:v.users.length,averageActivity:v.users.reduce((R,C)=>R+C.activityScore,0)/v.users.length,distanceKm:w})}return p}catch(a){console.error("Error finding hotspot:",a);return}}clusterUsers(e){if(e.length<3)return[];const r=[],a=new Set,l=2;for(const u of e){if(a.has(u.id))continue;const p=e.filter(m=>a.has(m.id)?!1:IB(u.location,m.location)<=l);if(p.length>=2){const m={latitude:p.reduce((v,w)=>v+w.location.latitude,0)/p.length,longitude:p.reduce((v,w)=>v+w.location.longitude,0)/p.length};r.push({center:m,users:p}),p.forEach(v=>a.add(v.id))}}return r}onUpdate(e){return this.updateCallbacks.push(e),()=>{this.updateCallbacks=this.updateCallbacks.filter(r=>r!==e)}}notifyUpdate(){this.currentAura&&this.updateCallbacks.forEach(e=>e(this.currentAura))}getAuraState(){return this.currentAura}async updateLocation(e,r=[]){return this.initialize(e,r)}async recalculate(){return this.currentAura?this.initialize(this.currentAura.center):null}}const AB=new Q8e;function Sge(t,e=[]){const[r,a]=V.useState(null),[l,u]=V.useState(!1),[p,m]=V.useState(null);V.useEffect(()=>{if(!t)return;u(!0),m(null),AB.initialize(t,e).then(R=>{a(R),u(!1)}).catch(R=>{m(R.message),u(!1)});const w=AB.onUpdate(a);return()=>{w()}},[t==null?void 0:t.latitude,t==null?void 0:t.longitude]);const v=V.useCallback(async()=>{u(!0);try{await AB.recalculate()}finally{u(!1)}},[]);return{aura:r,isLoading:l,error:p,refresh:v}}const Z8e=({userLocation:t,userInterests:e=[],showMiniMap:r=!0,className:a="",onUserTap:l})=>{const{aura:u,isLoading:p}=Sge(t,e),m=V.useRef(null),v=V.useRef(),[w,R]=V.useState([]),[C,A]=V.useState(0),[O,U]=V.useState(0);V.useEffect(()=>{const ne=setInterval(()=>{A(te=>(te+.05)%(Math.PI*2)),U(te=>(te+.02)%(Math.PI*2))},50);return()=>clearInterval(ne)},[]),V.useEffect(()=>{if(!m.current||!u)return;const ne=m.current,te=ne.getContext("2d");if(!te)return;const he=()=>{const J=ne.width,Q=ne.height,ce=J/2,de=Q/2;te.clearRect(0,0,J,Q);const pe=Math.min(J,Q)*.45,be=u.currentRadius/100,ye=pe*Math.min(be,1),Ze=1+Math.sin(C)*.03,It=ye*Ze;q(te,ce,de,It,0,u.isExpanding),q(te,ce,de,It*.8,.3,u.isExpanding),q(te,ce,de,It*.6,.6,u.isExpanding),W(te,ce,de,It*.15),u.isExpanding&&H(te,ce,de,It,C),v.current=requestAnimationFrame(he)};return he(),()=>{v.current&&cancelAnimationFrame(v.current)}},[u,C,O]);const F=(ne,te,he,J,Q)=>{ne.beginPath();for(let de=0;de<=64;de++){const pe=de/64*Math.PI*2,be=Math.sin(pe*3+O+Q)*.08,ye=Math.sin(pe*5+O*1.5+Q)*.04,Ze=Math.sin(pe*7+O*.7+Q)*.02,It=J*(1+be+ye+Ze),St=te+Math.cos(pe)*It,lt=he+Math.sin(pe)*It;de===0?ne.moveTo(St,lt):ne.lineTo(St,lt)}ne.closePath()},q=(ne,te,he,J,Q,ce)=>{F(ne,te,he,J,Q);const de=ne.createRadialGradient(te,he,0,te,he,J);ce?(de.addColorStop(0,"rgba(168, 85, 247, 0.4)"),de.addColorStop(.5,"rgba(236, 72, 153, 0.2)"),de.addColorStop(1,"rgba(251, 191, 36, 0.05)")):(de.addColorStop(0,"rgba(147, 51, 234, 0.35)"),de.addColorStop(.5,"rgba(168, 85, 247, 0.15)"),de.addColorStop(1,"rgba(192, 132, 252, 0.02)")),ne.fillStyle=de,ne.fill()},W=(ne,te,he,J)=>{const Q=ne.createRadialGradient(te,he,0,te,he,J);Q.addColorStop(0,"rgba(255, 255, 255, 0.9)"),Q.addColorStop(.3,"rgba(216, 180, 254, 0.6)"),Q.addColorStop(1,"rgba(168, 85, 247, 0)"),ne.beginPath(),ne.arc(te,he,J,0,Math.PI*2),ne.fillStyle=Q,ne.fill()},H=(ne,te,he,J,Q)=>{const ce=J*(Q%Math.PI/Math.PI),de=.3*(1-ce/J);ne.beginPath(),ne.arc(te,he,ce,0,Math.PI*2),ne.strokeStyle=`rgba(251, 191, 36, ${de})`,ne.lineWidth=2,ne.stroke()},X=V.useMemo(()=>u?{radius:u.currentRadius.toFixed(1),users:u.activeUsersInRange,density:u.magicDensity.toFixed(2)}:null,[u]);return c.jsxs("div",{className:`relative ${a}`,children:[c.jsx("canvas",{ref:m,width:400,height:400,className:"w-full h-full",style:{background:"transparent"}}),c.jsx(Ne.div,{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",animate:{scale:[1,1.1,1]},transition:{duration:2,repeat:1/0},children:c.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center shadow-lg shadow-violet-500/50",children:c.jsx(no,{className:"w-6 h-6 text-white"})})}),c.jsx(Ur,{children:w.map((ne,te)=>c.jsxs(Ne.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},exit:{opacity:0,scale:0},className:"absolute",style:{top:`${50+Math.sin(ne.angle)*ne.distance*35}%`,left:`${50+Math.cos(ne.angle)*ne.distance*35}%`,transform:"translate(-50%, -50%)"},onClick:()=>l==null?void 0:l(ne.id),children:[c.jsx("div",{className:`w-8 h-8 rounded-full border-2 ${ne.isActive?"border-green-400 shadow-green-400/50":"border-gray-400"} shadow-lg overflow-hidden bg-gray-200`,children:ne.avatarUrl?c.jsx("img",{src:ne.avatarUrl,alt:"",className:"w-full h-full object-cover"}):c.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs font-bold text-gray-600",children:ne.displayName[0]})}),ne.isActive&&c.jsx(Ne.div,{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-400 rounded-full",animate:{scale:[1,1.3,1]},transition:{duration:1,repeat:1/0}})]},ne.id))}),c.jsx(Ur,{children:(u==null?void 0:u.expansionMessage)&&c.jsx(Ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 px-4 py-2 bg-black/60 backdrop-blur-sm rounded-full",children:c.jsxs("p",{className:"text-white text-sm flex items-center gap-2",children:[c.jsx(kn,{className:"w-4 h-4 text-amber-400 animate-pulse"}),u.expansionMessage]})})}),X&&r&&c.jsxs("div",{className:"absolute top-4 right-4 bg-black/50 backdrop-blur-sm rounded-xl p-3 text-white text-xs space-y-1",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx($m,{className:"w-3 h-3 text-violet-400"}),c.jsxs("span",{children:[X.radius,"km Radius"]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(cr,{className:"w-3 h-3 text-pink-400"}),c.jsxs("span",{children:[X.users," aktiv"]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Vs,{className:"w-3 h-3 text-amber-400"}),c.jsxs("span",{children:[X.density,"/km Magie"]})]})]}),p&&c.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 backdrop-blur-sm rounded-2xl",children:c.jsx(Ne.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},children:c.jsx(kn,{className:"w-8 h-8 text-violet-400"})})})]})},eGe=({aura:t})=>!t||!t.isExpanding?null:c.jsx(Ne.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"fixed top-20 left-4 right-4 z-50",children:c.jsxs("div",{className:"bg-gradient-to-r from-violet-600 to-purple-600 rounded-2xl p-4 shadow-lg shadow-violet-500/20",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(Ne.div,{animate:{scale:[1,1.2,1]},transition:{duration:1.5,repeat:1/0},children:c.jsx(kn,{className:"w-6 h-6 text-amber-300"})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("p",{className:"text-white font-medium text-sm",children:"Aura weitet sich aus..."}),c.jsx("p",{className:"text-violet-200 text-xs",children:t.nearestHotspot?`Hotspot ${t.nearestHotspot.distanceKm.toFixed(1)}km entfernt gefunden`:"Suche nach Magie in der Nhe"})]}),c.jsxs("div",{className:"text-right",children:[c.jsxs("p",{className:"text-white font-bold",children:[t.currentRadius.toFixed(0),"km"]}),c.jsx("p",{className:"text-violet-200 text-xs",children:"Reichweite"})]})]}),c.jsx("div",{className:"mt-3 h-1 bg-violet-800 rounded-full overflow-hidden",children:c.jsx(Ne.div,{className:"h-full bg-gradient-to-r from-amber-400 to-orange-500",initial:{width:"0%"},animate:{width:`${t.currentRadius/t.targetRadius*100}%`},transition:{duration:.5}})})]})}),Tge="0123456789bcdefghjkmnpqrstuvwxyz";function Rge(t,e,r=7){let a=[-90,90],l=[-180,180],u="",p=0,m=0,v=!0;for(;u.length<r;){if(v){const w=(l[0]+l[1])/2;e>=w?(m|=1<<4-p,l[0]=w):l[1]=w}else{const w=(a[0]+a[1])/2;t>=w?(m|=1<<4-p,a[0]=w):a[1]=w}v=!v,p++,p===5&&(u+=Tge[m],p=0,m=0)}return u}function tGe(t){let e=[-90,90],r=[-180,180],a=!0;for(const l of t){const u=Tge.indexOf(l);for(let p=4;p>=0;p--){const m=u>>p&1;if(a){const v=(r[0]+r[1])/2;m?r[0]=v:r[1]=v}else{const v=(e[0]+e[1])/2;m?e[0]=v:e[1]=v}a=!a}}return{latitude:{min:e[0],max:e[1]},longitude:{min:r[0],max:r[1]},center:{latitude:(e[0]+e[1])/2,longitude:(r[0]+r[1])/2}}}function E9(t,e,r=7){const a=Rge(t,e,Math.ceil(r/2)+3);return`h${r}_${a}`}function nGe(t,e,r=7){const a=new Set,l=iGe(r),u=Math.ceil(e/l);a.add(E9(t.latitude,t.longitude,r));for(let p=1;p<=u;p++)rGe(t,p*l,r).forEach(v=>a.add(v));return Array.from(a)}function rGe(t,e,r){const a=[];for(let u=0;u<12;u++){const p=u/12*2*Math.PI,m=t.latitude+e/111*Math.cos(p),v=t.longitude+e/(111*Math.cos(t.latitude*Math.PI/180))*Math.sin(p);m>=-90&&m<=90&&v>=-180&&v<=180&&a.push(E9(m,v,r))}return a}function iGe(t){return{0:1107,1:418,2:158,3:60,4:22.6,5:8.5,6:3.2,7:1.2,8:.46,9:.17,10:.065,11:.024,12:.009}[t]||1.2}function Cge(t,e,r="neighborhood"){const a={district:{geohash:4,hexRes:5},neighborhood:{geohash:6,hexRes:7},block:{geohash:7,hexRes:9}},{geohash:l,hexRes:u}=a[r],p=Rge(t,e,l),m=E9(t,e,u),v=tGe(p);return{hexCell:m,geohash:p,fuzzyCenter:v.center,precision:r}}async function sGe(t,e,r=5){const a=Cge(t,e,"neighborhood"),l=nGe({latitude:t,longitude:e},r,7),u=mn(De,"users"),p=Mr(u,Kn("privacyLocation.hexCell","in",l.slice(0,10))),m=await Cr(p),v=[];return m.forEach(w=>{var O;const C=(O=w.data().privacyLocation)==null?void 0:O.hexCell;if(!C)return;let A="far";C===a.hexCell?A="same":l.slice(0,9).includes(C)&&(A="near"),v.push({id:w.id,hexCell:C,distance:A})}),v}function aGe(t){const[e,r]=V.useState(null);return V.useEffect(()=>{if(!t){r(null);return}const a=Cge(t.latitude,t.longitude,"neighborhood");r(a)},[t==null?void 0:t.latitude,t==null?void 0:t.longitude]),e}function oGe(t){t.CapacitorUtils.Synapse=new Proxy({},{get(e,r){return new Proxy({},{get(a,l){return(u,p,m)=>{const v=t.Capacitor.Plugins[r];if(v===void 0){m(new Error(`Capacitor plugin ${r} not found`));return}if(typeof v[l]!="function"){m(new Error(`Method ${l} not found in Capacitor plugin ${r}`));return}(async()=>{try{const w=await v[l](u);p(w)}catch(w){m(w)}})()}}})}})}function cGe(t){t.CapacitorUtils.Synapse=new Proxy({},{get(e,r){return t.cordova.plugins[r]}})}function lGe(t=!1){typeof window>"u"||(window.CapacitorUtils=window.CapacitorUtils||{},window.Capacitor!==void 0&&!t?oGe(window):window.cordova!==void 0&&cGe(window))}const iC=FL("Geolocation",{web:()=>VN(()=>import("./web-C_-DiPxa.js"),[]).then(t=>new t.GeolocationWeb)});lGe();function dGe(t){const[e,r]=V.useState(null),[a,l]=V.useState(null),[u,p]=V.useState(!0),{enableHighAccuracy:m=!0,watchPosition:v=!0,timeout:w=1e4}={},R=O=>({latitude:O.coords.latitude,longitude:O.coords.longitude,accuracy:O.coords.accuracy,timestamp:O.timestamp}),C=V.useCallback(async()=>{try{if(p(!0),l(null),P_.isNativePlatform()){const O=await iC.getCurrentPosition({enableHighAccuracy:m,timeout:w});r(R(O))}else{if(!navigator.geolocation)throw new Error("Geolocation wird nicht untersttzt");const O=await new Promise((U,F)=>{navigator.geolocation.getCurrentPosition(U,F,{enableHighAccuracy:m,timeout:w,maximumAge:0})});r({latitude:O.coords.latitude,longitude:O.coords.longitude,accuracy:O.coords.accuracy,timestamp:O.timestamp})}}catch(O){console.error("Geolocation error:",O),l(kB(O))}finally{p(!1)}},[m,w]),A=V.useCallback(async()=>{try{p(!0),l(null),P_.isNativePlatform()?(await iC.requestPermissions()).location==="granted"?await C():l("Standort-Berechtigung wurde verweigert"):await C()}catch(O){l(kB(O))}finally{p(!1)}},[C]);return V.useEffect(()=>{let O=null,U=null;return(async()=>{try{if(P_.isNativePlatform()&&(await iC.checkPermissions()).location!=="granted"){p(!1);return}await C(),v&&(P_.isNativePlatform()?O=await iC.watchPosition({enableHighAccuracy:m},(q,W)=>{if(W){console.error("Watch position error:",W);return}q&&r(R(q))}):navigator.geolocation&&(U=navigator.geolocation.watchPosition(q=>{r({latitude:q.coords.latitude,longitude:q.coords.longitude,accuracy:q.coords.accuracy,timestamp:q.timestamp})},q=>{console.error("Watch position error:",q)},{enableHighAccuracy:m,timeout:w})))}catch(q){console.error("Geolocation setup error:",q),l(kB(q)),p(!1)}})(),()=>{O&&iC.clearWatch({id:O}),U!==null&&navigator.geolocation.clearWatch(U)}},[C,m,v,w]),{location:e,error:a,isLoading:u,requestPermission:A,refresh:C}}function kB(t){if(t.code)switch(t.code){case 1:return"Standort-Berechtigung wurde verweigert. Bitte aktiviere sie in den Einstellungen.";case 2:return"Standort konnte nicht ermittelt werden. Bitte versuche es spter erneut.";case 3:return"Standort-Anfrage hat zu lange gedauert. Bitte versuche es erneut.";default:return t.message||"Unbekannter Standort-Fehler"}return t.message||"Standort konnte nicht ermittelt werden"}const uGe=()=>{const t=yr(),{user:e}=Jr(),{location:r,error:a,requestPermission:l}=dGe(),u=r?{latitude:r.latitude,longitude:r.longitude}:null,p=(e==null?void 0:e.interests)||[],{aura:m,isLoading:v,refresh:w}=Sge(u,p),R=aGe(u),[C,A]=V.useState([]),[O,U]=V.useState(!1),[F,q]=V.useState(!1),[W,H]=V.useState(!1),[X,ne]=V.useState("aura");V.useEffect(()=>{if(!u)return;(async()=>{U(!0);try{const ce=(await sGe(u.latitude,u.longitude,(m==null?void 0:m.currentRadius)||5)).map((de,pe)=>({id:de.id,displayName:`User ${pe+1}`,username:`user${pe+1}`,avatarUrl:void 0,distance:de.distance,hexCell:de.hexCell,isActive:Math.random()>.3,isPremium:Math.random()>.7,isStar:Math.random()>.9}));A(W?ce.filter(de=>de.isActive):ce)}catch(Q){console.error("Error fetching nearby users:",Q)}U(!1)})()},[u,m==null?void 0:m.currentRadius,W]);const te=V.useMemo(()=>({totalNearby:C.length,activeNearby:C.filter(J=>J.isActive).length,sameCell:C.filter(J=>J.distance==="same").length,nearCell:C.filter(J=>J.distance==="near").length}),[C]),he=J=>{t(`/user/${J}`)};return!r&&!a?c.jsxs("div",{className:"min-h-screen bg-[var(--synclulu-bg)] flex flex-col items-center justify-center p-6 theme-transition",children:[c.jsx("div",{className:"fixed inset-0 pointer-events-none",children:c.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-[var(--synclulu-accent)]/10 via-transparent to-transparent"})}),c.jsxs(Ne.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"text-center relative z-10",children:[c.jsx(Ne.div,{animate:{scale:[1,1.05,1]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:"w-24 h-24 mx-auto mb-6 rounded-full bg-gradient-to-br from-[var(--synclulu-accent)] to-pink-500 flex items-center justify-center shadow-xl",style:{boxShadow:"0 0 40px var(--synclulu-accent)"},children:c.jsx(_I,{className:"w-12 h-12 text-white"})}),c.jsx("h1",{className:"text-2xl font-bold text-[var(--synclulu-text)] mb-2",children:"Standort aktivieren"}),c.jsx("p",{className:"text-[var(--synclulu-muted)] mb-6 max-w-xs mx-auto",children:"Um deine Aura zu entfalten und Menschen in der Nhe zu entdecken"}),c.jsx(Ne.button,{whileTap:{scale:.95},onClick:l,className:"px-8 py-4 bg-gradient-to-r from-[var(--synclulu-accent)] to-pink-500 text-white font-semibold rounded-2xl shadow-lg",style:{boxShadow:"0 4px 20px var(--synclulu-accent)"},children:"Standort freigeben"})]})]}):a?c.jsx("div",{className:"min-h-screen bg-[var(--synclulu-bg)] flex flex-col items-center justify-center p-6 theme-transition",children:c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full bg-red-500/10 flex items-center justify-center",children:c.jsx(no,{className:"w-10 h-10 text-red-400"})}),c.jsx("h1",{className:"text-xl font-bold text-[var(--synclulu-text)] mb-2",children:"Standort nicht verfgbar"}),c.jsx("p",{className:"text-[var(--synclulu-muted)]",children:a}),c.jsx("button",{onClick:()=>t(-1),className:"mt-6 px-6 py-3 bg-[var(--synclulu-card)] text-[var(--synclulu-text)] rounded-xl border border-[var(--synclulu-border)]",children:"Zurck"})]})}):c.jsxs("div",{className:"min-h-screen bg-[var(--synclulu-bg)] safe-top safe-bottom pb-24 theme-transition",children:[c.jsxs("div",{className:"fixed inset-0 pointer-events-none",children:[c.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-[var(--synclulu-accent)]/5 via-transparent to-transparent"}),c.jsx(Ne.div,{animate:{scale:[1,1.2,1],opacity:[.1,.2,.1]},transition:{duration:4,repeat:1/0,ease:"easeInOut"},className:"absolute top-1/4 left-1/2 -translate-x-1/2 w-96 h-96 rounded-full",style:{background:"radial-gradient(circle, var(--synclulu-accent) 0%, transparent 70%)"}})]}),c.jsx(eGe,{aura:m}),c.jsx("header",{className:"sticky top-0 z-40 glass-nav border-b border-[var(--synclulu-border)]",children:c.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[c.jsx(Ne.button,{whileTap:{scale:.95},onClick:()=>t(-1),className:"w-10 h-10 rounded-xl bg-[var(--synclulu-card)] flex items-center justify-center shadow-sm border border-[var(--synclulu-border)]",children:c.jsx(dd,{className:"w-5 h-5 text-[var(--synclulu-muted)]"})}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ne.div,{animate:{rotate:360},transition:{duration:8,repeat:1/0,ease:"linear"},children:c.jsx(Tpe,{className:"w-5 h-5 text-[var(--synclulu-accent)]"})}),c.jsx("span",{className:"font-display font-bold text-[var(--synclulu-text)]",children:"Elastic Aura"})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ne.button,{whileTap:{scale:.95},onClick:()=>q(!0),className:"w-10 h-10 rounded-xl bg-green-500/10 flex items-center justify-center",children:c.jsx(cs,{className:"w-5 h-5 text-green-500"})}),c.jsx(Ne.button,{whileTap:{scale:.95},onClick:w,className:`w-10 h-10 rounded-xl bg-[var(--synclulu-card)] flex items-center justify-center shadow-sm border border-[var(--synclulu-border)] ${v?"animate-spin":""}`,children:c.jsx(_v,{className:"w-5 h-5 text-[var(--synclulu-muted)]"})})]})]})}),c.jsxs("div",{className:"relative z-10",children:[c.jsxs("div",{className:"flex justify-center gap-2 p-4",children:[c.jsxs(Ne.button,{whileTap:{scale:.95},onClick:()=>ne("aura"),className:`px-5 py-2.5 rounded-xl text-sm font-semibold transition-all ${X==="aura"?"bg-[var(--synclulu-accent)] text-white shadow-lg":"bg-[var(--synclulu-card)] text-[var(--synclulu-muted)] border border-[var(--synclulu-border)]"}`,children:[c.jsx($m,{className:"w-4 h-4 inline mr-2"}),"Aura"]}),c.jsxs(Ne.button,{whileTap:{scale:.95},onClick:()=>ne("list"),className:`px-5 py-2.5 rounded-xl text-sm font-semibold transition-all ${X==="list"?"bg-[var(--synclulu-accent)] text-white shadow-lg":"bg-[var(--synclulu-card)] text-[var(--synclulu-muted)] border border-[var(--synclulu-border)]"}`,children:[c.jsx(cr,{className:"w-4 h-4 inline mr-2"}),"Liste (",te.totalNearby,")"]})]}),c.jsxs(Ur,{mode:"wait",children:[X==="aura"&&c.jsxs(Ne.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"px-4",children:[c.jsx("div",{className:"relative aspect-square max-w-md mx-auto",children:c.jsx(Z8e,{userLocation:u,userInterests:p,showMiniMap:!0,onUserTap:he,className:"w-full h-full"})}),c.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-6",children:[c.jsxs(Ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-[var(--synclulu-card)] backdrop-blur-sm rounded-2xl p-4 text-center shadow-sm border border-[var(--synclulu-border)]",children:[c.jsx("div",{className:"text-2xl font-bold text-[var(--synclulu-text)]",children:(m==null?void 0:m.currentRadius.toFixed(0))||"-"}),c.jsx("div",{className:"text-xs text-[var(--synclulu-muted)]",children:"km Radius"})]}),c.jsxs(Ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-[var(--synclulu-card)] backdrop-blur-sm rounded-2xl p-4 text-center shadow-sm border border-[var(--synclulu-border)]",children:[c.jsx("div",{className:"text-2xl font-bold text-green-500",children:te.activeNearby}),c.jsx("div",{className:"text-xs text-[var(--synclulu-muted)]",children:"Aktiv"})]}),c.jsxs(Ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-[var(--synclulu-card)] backdrop-blur-sm rounded-2xl p-4 text-center shadow-sm border border-[var(--synclulu-border)]",children:[c.jsx("div",{className:"text-2xl font-bold text-amber-500",children:(m==null?void 0:m.magicDensity.toFixed(1))||"-"}),c.jsx("div",{className:"text-xs text-[var(--synclulu-muted)]",children:"/km Magie"})]})]}),c.jsx(Ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"mt-6 p-4 bg-[var(--synclulu-accent)]/10 rounded-2xl border border-[var(--synclulu-accent)]/20",children:c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx(kn,{className:"w-5 h-5 text-[var(--synclulu-accent)] mt-0.5"}),c.jsxs("div",{children:[c.jsx("p",{className:"font-semibold text-[var(--synclulu-text)] text-sm",children:"Deine Aura passt sich an"}),c.jsx("p",{className:"text-xs text-[var(--synclulu-muted)] mt-1",children:"Je mehr Menschen in deiner Nhe sind, desto fokussierter wird dein Radius. In ruhigeren Gegenden dehnt sich deine Aura automatisch aus."})]})]})})]},"aura"),X==="list"&&c.jsxs(Ne.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"px-4 pb-24",children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsxs(Ne.button,{whileTap:{scale:.95},onClick:()=>H(!W),className:`flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-semibold transition-all ${W?"bg-green-500/10 text-green-500 border border-green-500/20":"bg-[var(--synclulu-card)] text-[var(--synclulu-muted)] border border-[var(--synclulu-border)]"}`,children:[W?c.jsx(Pl,{className:"w-4 h-4"}):c.jsx(lp,{className:"w-4 h-4"}),W?"Nur Aktive":"Alle zeigen"]}),c.jsxs("span",{className:"text-[var(--synclulu-muted)] text-sm",children:[C.length," gefunden"]})]}),c.jsx("div",{className:"space-y-3",children:C.length===0?c.jsxs(Ne.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-16",children:[c.jsx(Ne.div,{animate:{scale:[1,1.1,1]},transition:{duration:2,repeat:1/0},className:"w-16 h-16 mx-auto mb-4 rounded-full bg-[var(--synclulu-accent)]/10 flex items-center justify-center",children:c.jsx(kn,{className:"w-8 h-8 text-[var(--synclulu-accent)]"})}),c.jsx("p",{className:"text-[var(--synclulu-text)] font-semibold",children:"Keine Nutzer in der Nhe"}),c.jsx("p",{className:"text-[var(--synclulu-muted)] text-sm mt-1",children:"Deine Aura weitet sich aus..."})]}):C.map((J,Q)=>c.jsxs(Ne.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:Q*.05},whileTap:{scale:.98},onClick:()=>he(J.id),className:"w-full bg-[var(--synclulu-card)] backdrop-blur-sm rounded-2xl p-4 flex items-center gap-4 shadow-sm border border-[var(--synclulu-border)] hover:border-[var(--synclulu-accent)]/30 transition-all",children:[c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:"w-14 h-14 rounded-2xl overflow-hidden bg-gradient-to-br from-[var(--synclulu-accent)] to-pink-500 flex items-center justify-center",children:J.avatarUrl?c.jsx("img",{src:J.avatarUrl,alt:"",className:"w-full h-full object-cover"}):c.jsx(md,{className:"w-6 h-6 text-white"})}),J.isActive&&c.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-[var(--synclulu-card)]"})]}),c.jsxs("div",{className:"flex-1 text-left",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"font-semibold text-[var(--synclulu-text)]",children:J.displayName}),J.isPremium&&c.jsx(as,{className:"w-4 h-4 text-amber-500"}),J.isStar&&c.jsx(Ji,{className:"w-4 h-4 text-pink-500",fill:"currentColor"})]}),c.jsxs("div",{className:"text-sm text-[var(--synclulu-muted)]",children:["@",J.username]})]}),c.jsx("div",{className:`px-3 py-1.5 rounded-xl text-xs font-semibold ${J.distance==="same"?"bg-green-500/10 text-green-500":J.distance==="near"?"bg-amber-500/10 text-amber-500":"bg-[var(--synclulu-bg)] text-[var(--synclulu-muted)]"}`,children:J.distance==="same"?"Sehr nah":J.distance==="near"?"In der Nhe":"Weiter weg"}),c.jsx(Fi,{className:"w-5 h-5 text-[var(--synclulu-muted)]"})]},J.id))})]},"list")]})]}),c.jsx(Ur,{children:F&&c.jsx(Ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/50 backdrop-blur-sm flex items-end justify-center",onClick:()=>q(!1),children:c.jsxs(Ne.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:25,stiffness:300},onClick:J=>J.stopPropagation(),className:"w-full max-w-lg bg-[var(--synclulu-card)] rounded-t-3xl p-6 border-t border-x border-[var(--synclulu-border)]",children:[c.jsx("div",{className:"w-12 h-1 bg-[var(--synclulu-border)] rounded-full mx-auto mb-6"}),c.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[c.jsx("div",{className:"w-12 h-12 rounded-full bg-green-500/10 flex items-center justify-center",children:c.jsx(cs,{className:"w-6 h-6 text-green-500"})}),c.jsx("h2",{className:"text-xl font-bold text-[var(--synclulu-text)]",children:"Privacy by Design"})]}),c.jsxs("div",{className:"space-y-4 text-[var(--synclulu-muted)] text-sm",children:[c.jsx("p",{children:c.jsx("strong",{className:"text-[var(--synclulu-text)]",children:"Deine exakten Koordinaten werden NIE gespeichert."})}),c.jsx("p",{children:"Wir verwenden ein Hexagonal-Cell-System (hnlich H3 von Uber), das nur ungefhre Bereiche vergleicht."}),c.jsxs("div",{className:"p-4 bg-[var(--synclulu-bg)] rounded-xl space-y-2",children:[c.jsxs("p",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-green-500 font-medium",children:"Dein Geohash:"}),c.jsx("code",{className:"text-[var(--synclulu-text)] font-mono text-xs bg-[var(--synclulu-card)] px-2 py-1 rounded",children:(R==null?void 0:R.geohash)||"Ldt..."})]}),c.jsxs("p",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[var(--synclulu-accent)] font-medium",children:"Deine Hex-Cell:"}),c.jsx("code",{className:"text-[var(--synclulu-text)] font-mono text-xs bg-[var(--synclulu-card)] px-2 py-1 rounded",children:(R==null?void 0:R.hexCell)||"Ldt..."})]})]}),c.jsx("p",{children:"Andere User sehen nur, ob sie in derselben oder benachbarten Cell sind - nie deinen genauen Standort."})]}),c.jsx(Ne.button,{whileTap:{scale:.98},onClick:()=>q(!1),className:"w-full mt-6 py-4 bg-[var(--synclulu-accent)] rounded-2xl text-white font-semibold",children:"Verstanden"})]})})})]})},hGe=async t=>{if(!t||t.trim().length===0)return{isValid:!1,error:"INVALID",message:"Kein Einladungscode angegeben"};const e=t.trim().toUpperCase();try{const r=await Bn(tt(De,"invite_codes",e));if(!r.exists()){const l=Mr(mn(De,"invite_codes"),Kn("code","==",e)),u=await Cr(l);if(u.empty)return{isValid:!1,error:"INVALID",message:"Dieser Code existiert nicht"};const p=u.docs[0].data();return vae(p)}const a=r.data();return vae(a)}catch(r){return console.error("[InviteSystem] Validation error:",r),{isValid:!1,error:"INVALID",message:"Fehler bei der Validierung"}}},vae=t=>t.isActive?t.expiresAt&&t.expiresAt.toDate()<new Date?{isValid:!1,code:t,error:"EXPIRED",message:"Dieser Code ist abgelaufen"}:t.type!=="unlimited"&&t.usedCount>=t.maxUses?{isValid:!1,code:t,error:"USED_UP",message:"Dieser Code wurde bereits vollstndig eingelst"}:{isValid:!0,code:t}:{isValid:!1,code:t,error:"DEACTIVATED",message:"Dieser Code wurde deaktiviert"},Eae=async(t,e,r)=>{var l;const a=t.trim().toUpperCase();try{const u=await Bn(tt(De,"invite_codes",a));if(!u.exists())return!1;const p=u.data();await Xn(tt(De,"invite_codes",a),{usedCount:Ss(1)}),await Yi(tt(De,"referrals",`${p.creatorId}_${e}`),{referrerId:p.creatorId,referrerName:p.creatorName,referredId:e,referredName:r,inviteCode:a,status:"registered",createdAt:ci(),registeredAt:ci()}),await Xn(tt(De,"users",p.creatorId),{referralCount:Ss(1),"stats.totalReferrals":Ss(1)});const m=await Bn(tt(De,"users",p.creatorId));if(m.exists()){const v=((l=m.data().premiumEndsAt)==null?void 0:l.toDate())||new Date,w=new Date(Math.max(v.getTime(),Date.now()));w.setDate(w.getDate()+7),await Xn(tt(De,"users",p.creatorId),{isPremium:!0,premiumEndsAt:fn.fromDate(w)})}return console.log("[InviteSystem] Code used successfully:",{code:a,newUser:e,referrer:p.creatorId}),!0}catch(u){return console.error("[InviteSystem] Use code error:",u),!1}},pGe=async(t,e,r)=>{if(!t||!t.includes("@"))return{success:!1,error:"Ungltige E-Mail-Adresse"};const a=t.toLowerCase().trim();try{const l=Mr(mn(De,"waitlist"),Kn("email","==",a)),u=await Cr(l);if(!u.empty)return{success:!0,position:u.docs[0].data().position};const p=Mr(mn(De,"waitlist")),v=(await Cr(p)).size+1;return await Yi(tt(De,"waitlist",a),{email:a,name:e||null,joinedAt:ci(),status:"waiting",position:v,referralSource:r||null}),{success:!0,position:v}}catch(l){return console.error("[InviteSystem] Waitlist error:",l),{success:!1,error:"Fehler beim Beitreten zur Warteliste"}}},fGe=t=>{sessionStorage.setItem("synclulu_invite_code",t.toUpperCase())},Qs={dark:{bg:{primary:"#0A0A0B",secondary:"#111113",tertiary:"#18181B",elevated:"#1F1F23"},border:{default:"rgba(255, 255, 255, 0.10)"},text:{primary:"#FAFAFA",secondary:"#A1A1AA"}},light:{bg:{primary:"#FFFFFF",secondary:"#FAFAFA",tertiary:"#F4F4F5",elevated:"#FFFFFF"},border:{default:"rgba(0, 0, 0, 0.08)"},text:{primary:"#09090B",secondary:"#52525B"}}};spe()(ope(t=>({isDark:!0,setDark:e=>{t({isDark:e}),xae(e)},toggle:()=>t(e=>{const r=!e.isDark;return xae(r),{isDark:r}})}),{name:"synclulu-theme"}));const xae=t=>{const e=document.documentElement;t?(e.classList.add("dark"),e.style.setProperty("--bg-primary",Qs.dark.bg.primary),e.style.setProperty("--bg-secondary",Qs.dark.bg.secondary),e.style.setProperty("--bg-tertiary",Qs.dark.bg.tertiary),e.style.setProperty("--bg-elevated",Qs.dark.bg.elevated),e.style.setProperty("--text-primary",Qs.dark.text.primary),e.style.setProperty("--text-secondary",Qs.dark.text.secondary),e.style.setProperty("--border-default",Qs.dark.border.default)):(e.classList.remove("dark"),e.style.setProperty("--bg-primary",Qs.light.bg.primary),e.style.setProperty("--bg-secondary",Qs.light.bg.secondary),e.style.setProperty("--bg-tertiary",Qs.light.bg.tertiary),e.style.setProperty("--bg-elevated",Qs.light.bg.elevated),e.style.setProperty("--text-primary",Qs.light.text.primary),e.style.setProperty("--text-secondary",Qs.light.text.secondary),e.style.setProperty("--border-default",Qs.light.border.default))},mGe=()=>c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:c.jsx("div",{className:"w-32 h-32 rounded-full border-2 border-purple-500/20 animate-ping"})}),c.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:c.jsx("div",{className:"w-24 h-24 rounded-full border-2 border-purple-500/30 animate-pulse"})}),c.jsx("div",{className:"relative w-20 h-20 mx-auto rounded-full bg-gradient-to-br from-purple-500/20 to-pink-500/20 flex items-center justify-center",children:c.jsx(yo,{size:32,className:"text-purple-400"})})]}),gGe=()=>c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:[...Array(8)].map((t,e)=>c.jsx("div",{className:"absolute w-2 h-2 bg-green-400 rounded-full animate-burst",style:{transform:`rotate(${e*45}deg) translateY(-40px)`,animationDelay:`${e*.1}s`}},e))}),c.jsx("div",{className:"relative w-20 h-20 mx-auto rounded-full bg-gradient-to-br from-green-500/20 to-emerald-500/20 flex items-center justify-center animate-bounce-once",children:c.jsx(K_,{size:32,className:"text-green-400"})})]}),_Ge=({onJoin:t,isLoading:e,position:r})=>{const[a,l]=V.useState(""),[u,p]=V.useState(""),[m,v]=V.useState(!1),w=async R=>{R.preventDefault(),await t(a,u),v(!0)};return m&&r?c.jsxs("div",{className:"text-center py-8",children:[c.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-purple-500/20 flex items-center justify-center",children:c.jsx(_r,{size:28,className:"text-purple-400"})}),c.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Du bist auf der Liste!"}),c.jsxs("p",{className:"text-gray-400 mb-4",children:["Position ",c.jsxs("span",{className:"text-purple-400 font-bold",children:["#",r]})]}),c.jsx("p",{className:"text-sm text-gray-500",children:"Wir benachrichtigen dich, sobald ein Platz frei wird."})]}):c.jsxs("form",{onSubmit:w,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Name"}),c.jsx("input",{type:"text",value:u,onChange:R=>p(R.target.value),placeholder:"Dein Name",className:"w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white placeholder-gray-500 focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"E-Mail *"}),c.jsx("input",{type:"email",value:a,onChange:R=>l(R.target.value),placeholder:"deine@email.de",required:!0,className:"w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white placeholder-gray-500 focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all"})]}),c.jsx("button",{type:"submit",disabled:e||!a,className:"w-full py-4 rounded-xl bg-gradient-to-r from-purple-600 to-pink-600 text-white font-semibold flex items-center justify-center gap-2 hover:opacity-90 disabled:opacity-50 transition-all",children:e?c.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):c.jsxs(c.Fragment,{children:[c.jsx(Ua,{size:18}),"Auf Warteliste setzen"]})})]})},bae=()=>{var It;const t=yr(),{code:e}=Kce(),[r]=Dw(),[a,l]=V.useState(""),[u,p]=V.useState(null),[m,v]=V.useState(!1),[w,R]=V.useState(!1),[C,A]=V.useState(""),[O,U]=V.useState(""),[F,q]=V.useState(""),[W,H]=V.useState(!1),[X,ne]=V.useState(!1),[te,he]=V.useState(""),[J,Q]=V.useState(),[ce,de]=V.useState(!1);V.useEffect(()=>{const St=e||r.get("code")||r.get("invite");St&&(l(St.toUpperCase()),pe(St))},[e,r]);const pe=async St=>{const lt=St||a;if(lt.trim()){v(!0),he("");try{const Le=await hGe(lt);p(Le),Le.isValid?(fGe(lt),setTimeout(()=>R(!0),500),"vibrate"in navigator&&navigator.vibrate([50,30,50,30,100])):"vibrate"in navigator&&navigator.vibrate([100,50,100])}catch{p({isValid:!1,error:"INVALID",message:"Validierung fehlgeschlagen"})}finally{v(!1)}}},be=async St=>{var lt;if(St.preventDefault(),!(!(u!=null&&u.isValid)||!C||!O||!F)){ne(!0),he("");try{const Me=(await $N(ws,C,O)).user;await Yi(tt(De,"users",Me.uid),{id:Me.uid,email:Me.email,displayName:F,username:F.toLowerCase().replace(/\s+/g,"_"),avatarUrl:null,createdAt:ci(),onboardingCompleted:!1,level:1,xp:0,isPremium:!1,isCreator:!1,invitedBy:((lt=u.code)==null?void 0:lt.creatorId)||null,inviteCode:a}),await Eae(a,Me.uid,F),t("/onboarding")}catch(Le){console.error("[Register] Error:",Le),Le.code==="auth/email-already-in-use"?he("Diese E-Mail wird bereits verwendet"):Le.code==="auth/weak-password"?he("Passwort muss mindestens 6 Zeichen haben"):he("Registrierung fehlgeschlagen")}finally{ne(!1)}}},ye=async()=>{var St;if(u!=null&&u.isValid){ne(!0),he("");try{const lt=new Gd,Me=(await lG(ws,lt)).user;await Yi(tt(De,"users",Me.uid),{id:Me.uid,email:Me.email,displayName:Me.displayName||"Anonym",username:(Me.displayName||"user").toLowerCase().replace(/\s+/g,"_"),avatarUrl:Me.photoURL,createdAt:ci(),onboardingCompleted:!1,level:1,xp:0,isPremium:!1,isCreator:!1,invitedBy:((St=u.code)==null?void 0:St.creatorId)||null,inviteCode:a},{merge:!0}),await Eae(a,Me.uid,Me.displayName||"Anonym"),t("/onboarding")}catch(lt){console.error("[Google Sign In] Error:",lt),he("Google Anmeldung fehlgeschlagen")}finally{ne(!1)}}},Ze=async(St,lt)=>{de(!0);const Le=await pGe(St,lt,"registration_page");Le.success&&Le.position&&Q(Le.position),de(!1)};return c.jsxs("div",{className:"min-h-screen flex flex-col",style:{background:Qs.dark.bg.primary},children:[c.jsx("div",{className:"p-4",children:c.jsx("button",{onClick:()=>t("/"),className:"w-10 h-10 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center hover:bg-white/10 transition-colors",children:c.jsx(dd,{size:20,className:"text-white"})})}),c.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center px-6 py-8",children:[c.jsxs("div",{className:"mb-8",children:[c.jsx("h1",{className:"font-display text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 via-pink-400 to-purple-400",children:"synclulu"}),c.jsx("p",{className:"text-center text-gray-500 text-sm mt-1",children:"Invite-Only Beta"})]}),!u&&c.jsxs("div",{className:"w-full max-w-sm",children:[c.jsxs("div",{className:"rounded-3xl p-6 border",style:{background:Qs.dark.bg.secondary,borderColor:Qs.dark.border.default},children:[c.jsxs("div",{className:"text-center mb-6",children:[c.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-purple-500/10 flex items-center justify-center",children:c.jsx(_o,{size:28,className:"text-purple-400"})}),c.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Hast du einen Einladungscode?"}),c.jsx("p",{className:"text-gray-400 text-sm",children:"synclulu ist nur mit Einladung zugnglich"})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("div",{children:c.jsx("input",{type:"text",value:a,onChange:St=>l(St.target.value.toUpperCase()),placeholder:"synclulu-XXXXXX",className:"w-full px-4 py-4 rounded-xl bg-white/5 border border-white/10 text-white text-center font-mono text-lg tracking-widest placeholder-gray-500 focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all uppercase"})}),c.jsx("button",{onClick:()=>pe(),disabled:m||!a.trim(),className:"w-full py-4 rounded-xl bg-gradient-to-r from-purple-600 to-pink-600 text-white font-semibold flex items-center justify-center gap-2 hover:opacity-90 disabled:opacity-50 transition-all",children:m?c.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):c.jsxs(c.Fragment,{children:[c.jsx(cs,{size:18}),"Code prfen"]})})]})]}),c.jsx("button",{onClick:()=>p({isValid:!1,error:"INVALID",message:"Kein Code"}),className:"w-full mt-4 py-3 text-gray-400 text-sm hover:text-white transition-colors",children:"Ich habe keinen Code"})]}),u&&!u.isValid&&c.jsx("div",{className:"w-full max-w-sm",children:c.jsxs("div",{className:"rounded-3xl p-6 border",style:{background:Qs.dark.bg.secondary,borderColor:Qs.dark.border.default},children:[c.jsx(mGe,{}),c.jsxs("div",{className:"text-center mt-6 mb-6",children:[c.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:u.error==="USED_UP"?"Code vollstndig eingelst":u.error==="EXPIRED"?"Code abgelaufen":"Zugang limitiert"}),c.jsx("p",{className:"text-gray-400 text-sm",children:u.message||"Tritt der Warteliste bei, um benachrichtigt zu werden"})]}),c.jsx(_Ge,{onJoin:Ze,isLoading:ce,position:J}),c.jsx("button",{onClick:()=>{p(null),l("")},className:"w-full mt-4 py-3 text-gray-400 text-sm hover:text-white transition-colors",children:"Anderen Code eingeben"})]})}),(u==null?void 0:u.isValid)&&c.jsxs("div",{className:"w-full max-w-sm",children:[c.jsx("div",{className:"rounded-3xl p-6 border",style:{background:Qs.dark.bg.secondary,borderColor:Qs.dark.border.default},children:w?c.jsxs(c.Fragment,{children:[c.jsx(gGe,{}),c.jsxs("div",{className:"text-center mt-6 mb-6",children:[c.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Willkommen im Club! "}),c.jsxs("p",{className:"text-gray-400 text-sm",children:["Eingeladen von"," ",c.jsx("span",{className:"text-purple-400 font-semibold",children:((It=u.code)==null?void 0:It.creatorName)||"einem Freund"})]})]}),te&&c.jsx("div",{className:"mb-4 p-3 rounded-xl bg-red-500/10 border border-red-500/20 text-red-400 text-sm text-center",children:te}),c.jsxs("form",{onSubmit:be,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Name"}),c.jsxs("div",{className:"relative",children:[c.jsx(md,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500"}),c.jsx("input",{type:"text",value:F,onChange:St=>q(St.target.value),placeholder:"Dein Name",required:!0,className:"w-full pl-12 pr-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white placeholder-gray-500 focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"E-Mail"}),c.jsxs("div",{className:"relative",children:[c.jsx(c0,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500"}),c.jsx("input",{type:"email",value:C,onChange:St=>A(St.target.value),placeholder:"deine@email.de",required:!0,className:"w-full pl-12 pr-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white placeholder-gray-500 focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Passwort"}),c.jsxs("div",{className:"relative",children:[c.jsx(yo,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500"}),c.jsx("input",{type:W?"text":"password",value:O,onChange:St=>U(St.target.value),placeholder:"",required:!0,minLength:6,className:"w-full pl-12 pr-12 py-3 rounded-xl bg-white/5 border border-white/10 text-white placeholder-gray-500 focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all"}),c.jsx("button",{type:"button",onClick:()=>H(!W),className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 hover:text-white transition-colors",children:W?c.jsx(lp,{size:18}):c.jsx(Pl,{size:18})})]})]}),c.jsx("button",{type:"submit",disabled:X,className:"w-full py-4 rounded-xl bg-gradient-to-r from-purple-600 to-pink-600 text-white font-semibold flex items-center justify-center gap-2 hover:opacity-90 disabled:opacity-50 transition-all",children:X?c.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):c.jsxs(c.Fragment,{children:[c.jsx(kn,{size:18}),"Account erstellen"]})})]}),c.jsxs("div",{className:"flex items-center gap-4 my-6",children:[c.jsx("div",{className:"flex-1 h-px bg-white/10"}),c.jsx("span",{className:"text-gray-500 text-sm",children:"oder"}),c.jsx("div",{className:"flex-1 h-px bg-white/10"})]}),c.jsxs("button",{onClick:ye,disabled:X,className:"w-full py-3 rounded-xl bg-white/5 border border-white/10 text-white font-medium flex items-center justify-center gap-3 hover:bg-white/10 disabled:opacity-50 transition-all",children:[c.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[c.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),c.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),c.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),c.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Mit Google fortfahren"]})]}):c.jsx("div",{className:"py-8",children:c.jsx("div",{className:"w-12 h-12 mx-auto border-4 border-purple-500 border-t-transparent rounded-full animate-spin"})})}),c.jsxs("p",{className:"text-center mt-6 text-gray-400 text-sm",children:["Bereits registriert?"," ",c.jsx("button",{onClick:()=>t("/login"),className:"text-purple-400 hover:text-purple-300 font-semibold",children:"Anmelden"})]})]})]}),c.jsx("style",{children:`
        @keyframes burst {
          0% {
            transform: rotate(var(--rotation)) translateY(0) scale(1);
            opacity: 1;
          }
          100% {
            transform: rotate(var(--rotation)) translateY(-60px) scale(0);
            opacity: 0;
          }
        }
        .animate-burst {
          animation: burst 0.6s ease-out forwards;
        }
        @keyframes bounce-once {
          0%, 100% { transform: scale(1); }
          50% { transform: scale(1.1); }
        }
        .animate-bounce-once {
          animation: bounce-once 0.5s ease-out;
        }
      `})]})},Cl={maxUsers:10,waitlistEnabled:!0,referralRewardStars:5,referralRewardNewUser:5,referralPremiumDays:1,founderEmail:"jan@synclulu.app",founderRadius:4e7,premiumRadius:15e3,standardRadius:5e3};async function MO(){try{const t=await Bn(tt(De,"system","stats"));let e=0,r=0;t.exists()?(e=t.data().totalUsers||0,r=t.data().waitlistCount||0):(e=(await Cr(mn(De,"users"))).size,await Yi(tt(De,"system","stats"),{totalUsers:e,waitlistCount:0,updatedAt:ci()}));const a=await yGe();return{currentUsers:e,maxUsers:a,isFull:e>=a,spotsRemaining:Math.max(0,a-e),waitlistCount:r}}catch(t){return console.error("Error checking capacity:",t),{currentUsers:0,maxUsers:Cl.maxUsers,isFull:!1,spotsRemaining:Cl.maxUsers,waitlistCount:0}}}async function yGe(){try{const t=await Bn(tt(De,"system","config"));if(t.exists()&&t.data().maxUsers)return t.data().maxUsers}catch{}return Cl.maxUsers}async function Nge(){const t=await MO();return t.isFull?{canRegister:!1,reason:"Die Cloud ist derzeit voll besetzt. ",capacity:t}:{canRegister:!0,capacity:t}}async function vGe(t,e){try{const r=t.toLowerCase().replace(/[^a-z0-9]/g,"_");return await Yi(tt(De,"waitlist",r),{email:t.toLowerCase(),referralCode:e||null,joinedAt:ci(),notified:!1,converted:!1}),await Xn(tt(De,"system","stats"),{waitlistCount:Ss(1)}),{success:!0,position:(await Cr(Mr(mn(De,"waitlist"),Kn("converted","==",!1)))).size}}catch(r){return console.error("Error adding to waitlist:",r),{success:!1,position:0}}}function EGe(t){const e="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";let r="";for(let a=0;a<6;a++)r+=e.charAt(Math.floor(Math.random()*e.length));return`${r}-${t.slice(-4).toUpperCase()}`}async function xGe(t,e){const r=EGe(t);return await Yi(tt(De,"referrals",r),{referrerId:t,referrerUsername:e,code:r,usedBy:[],totalRewards:0,createdAt:ci()}),await Xn(tt(De,"users",t),{referralCode:r,referralLink:`https://synclulu.app/join/${r}`}),r}async function x9(t){if(!t)return{valid:!1};try{const e=await Bn(tt(De,"referrals",t.toUpperCase()));if(e.exists()){const r=e.data();return{valid:!0,referrerId:r.referrerId,referrerUsername:r.referrerUsername}}return{valid:!1}}catch(e){return console.error("Error validating referral:",e),{valid:!1}}}async function bGe(t,e,r){try{const a=await Bn(tt(De,"referrals",t.toUpperCase()));if(!a.exists())return!1;const l=a.data(),u=l.referrerId;return await Xn(tt(De,"referrals",t.toUpperCase()),{usedBy:[...l.usedBy||[],e],totalRewards:Ss(Cl.referralRewardStars)}),await Xn(tt(De,"users",u),{nebulaStars:Ss(Cl.referralRewardStars),referralCount:Ss(1),lastReferralAt:ci()}),await Xn(tt(De,"users",e),{nebulaStars:Ss(Cl.referralRewardNewUser),referredBy:u,referredByCode:t}),await Yi(tt(mn(De,"notifications")),{userId:u,type:"referral_reward",title:" Neue Empfehlung!",message:`${r} ist durch deinen Link beigetreten. Du erhltst ${Cl.referralRewardStars} Nebula-Sterne! `,read:!1,createdAt:ci()}),!0}catch(a){return console.error("Error applying referral reward:",a),!1}}function b9(){const t=new URLSearchParams(window.location.search),e=t.get("ref")||t.get("invite");if(e)return localStorage.setItem("synclulu_referral_code",e.toUpperCase()),e.toUpperCase();const r=window.location.pathname.match(/\/(?:join|invite)\/([A-Z0-9-]+)/i);if(r){const a=r[1].toUpperCase();return localStorage.setItem("synclulu_referral_code",a),a}return localStorage.getItem("synclulu_referral_code")}function wGe(){localStorage.removeItem("synclulu_referral_code")}async function SGe(t,e){e.toLowerCase()===Cl.founderEmail.toLowerCase()&&await Xn(tt(De,"users",t),{role:"founder",isAdmin:!0,isPremium:!0,premiumUntil:new Date("2099-12-31T23:59:59Z"),subscription:"nebula_active",subscriptionEnd:new Date("2099-12-31T23:59:59Z"),searchRadius:Cl.founderRadius,founderSince:ci()})}async function TGe(){try{await Xn(tt(De,"system","stats"),{totalUsers:Ss(1),lastRegistrationAt:ci()})}catch{await Yi(tt(De,"system","stats"),{totalUsers:1,waitlistCount:0,lastRegistrationAt:ci()},{merge:!0})}}async function Yz(t,e,r,a){try{const l=await Nge();if(!l.canRegister)return{success:!1,error:l.reason,errorCode:"CAPACITY_FULL"};await TGe(),await SGe(t,e),await xGe(t,r);let u=!1;return a&&(await x9(a)).valid&&(await bGe(a,t,r),u=!0),wGe(),{success:!0,userId:t,referralApplied:u}}catch(l){return console.error("Registration error:",l),{success:!1,error:"Ein unerwarteter Fehler ist aufgetreten.",errorCode:"UNKNOWN"}}}const RGe={error:{bg:"rgba(239, 68, 68, 0.1)",border:"rgba(239, 68, 68, 0.4)",glow:"rgba(239, 68, 68, 0.3)",text:"#F87171",icon:""},warning:{bg:"rgba(245, 158, 11, 0.1)",border:"rgba(245, 158, 11, 0.4)",glow:"rgba(245, 158, 11, 0.3)",text:"#FBBF24",icon:""},info:{bg:"rgba(139, 92, 246, 0.1)",border:"rgba(139, 92, 246, 0.4)",glow:"rgba(139, 92, 246, 0.3)",text:"#A78BFA",icon:""}};function CGe({message:t,severity:e="error",icon:r,onDismiss:a,dismissible:l=!0,className:u=""}){const p=RGe[e];return c.jsxs(Ne.div,{className:`relative px-4 py-3 rounded-xl ${u}`,style:{background:p.bg,border:`1px solid ${p.border}`,boxShadow:`0 0 20px ${p.glow}, inset 0 0 20px ${p.glow}`},initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{type:"spring",damping:20},children:[c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx(Ne.span,{className:"text-lg flex-shrink-0",animate:{scale:[1,1.1,1]},transition:{duration:2,repeat:1/0},children:r||p.icon}),c.jsx("p",{className:"text-sm flex-1",style:{color:p.text},children:t}),l&&a&&c.jsx(Ne.button,{onClick:a,className:"text-lg opacity-50 hover:opacity-100 transition-opacity",whileHover:{scale:1.1},whileTap:{scale:.9},children:""})]}),c.jsx(Ne.div,{className:"absolute inset-0 rounded-xl pointer-events-none",style:{border:`1px solid ${p.border}`,opacity:.5},animate:{boxShadow:[`0 0 10px ${p.glow}`,`0 0 20px ${p.glow}`,`0 0 10px ${p.glow}`]},transition:{duration:2,repeat:1/0}})]})}function NGe({message:t,className:e=""}){return t?c.jsxs(Ne.p,{className:`text-xs mt-1 ${e}`,style:{color:"#F87171"},initial:{opacity:0,y:-5},animate:{opacity:1,y:0},children:[c.jsx("span",{className:"mr-1",children:""}),t]}):null}function IGe({message:t="Ldt..."}){return c.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[c.jsx(Ne.div,{className:"text-5xl mb-4",animate:{scale:[1,1.1,1],y:[0,-10,0]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},style:{filter:"drop-shadow(0 0 20px rgba(139, 92, 246, 0.5))"},children:""}),c.jsx(Ne.p,{className:"text-gray-400",animate:{opacity:[.5,1,.5]},transition:{duration:2,repeat:1/0},children:t})]})}function Ige({spotsRemaining:t=0,waitlistCount:e=0,onWaitlistJoined:r,onClose:a}){const[l,u]=V.useState(""),[p,m]=V.useState(!1),[v,w]=V.useState(!1),[R,C]=V.useState(null),[A,O]=V.useState(null),U=async F=>{if(F.preventDefault(),!(!l||p)){if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l)){O("Bitte gib eine gltige E-Mail-Adresse ein.");return}m(!0),O(null);try{const q=b9(),W=await vGe(l,q||void 0);W.success?(w(!0),C(W.position),r==null||r(W.position)):O("Fehler beim Beitritt zur Warteliste.")}catch{O("Ein unerwarteter Fehler ist aufgetreten.")}finally{m(!1)}}};return c.jsxs(Ne.div,{className:"fixed inset-0 z-50 flex items-center justify-center p-6",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{background:"#0b0b0b"},children:[c.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[[...Array(5)].map((F,q)=>c.jsx(Ne.div,{className:"absolute text-6xl opacity-10",style:{left:`${10+q*20}%`,top:`${20+q%3*25}%`},animate:{y:[0,-20,0],x:[0,10,0],rotate:[0,5,-5,0]},transition:{duration:6+q,repeat:1/0,ease:"easeInOut",delay:q*.5},children:""},q)),c.jsx(Ne.div,{className:"absolute w-96 h-96 rounded-full opacity-20",style:{background:"radial-gradient(circle, #8B5CF6 0%, transparent 70%)",top:"-10%",right:"-10%"},animate:{scale:[1,1.2,1]},transition:{duration:8,repeat:1/0}}),c.jsx(Ne.div,{className:"absolute w-80 h-80 rounded-full opacity-15",style:{background:"radial-gradient(circle, #A78BFA 0%, transparent 70%)",bottom:"-5%",left:"-5%"},animate:{scale:[1.2,1,1.2]},transition:{duration:10,repeat:1/0}})]}),a&&c.jsx(Ne.button,{onClick:a,className:"absolute top-6 right-6 z-20 w-10 h-10 rounded-full flex items-center justify-center text-gray-400 hover:text-white transition-colors",style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)"},whileHover:{scale:1.1},whileTap:{scale:.9},children:""}),c.jsxs(Ne.div,{className:"relative z-10 max-w-md w-full text-center",initial:{y:30,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2},children:[c.jsx(Ne.div,{className:"text-8xl mb-6 inline-block",animate:{y:[0,-10,0],rotate:[0,3,-3,0]},transition:{duration:4,repeat:1/0,ease:"easeInOut"},style:{filter:"drop-shadow(0 0 30px rgba(139, 92, 246, 0.5))"},children:""}),c.jsxs("h1",{className:"text-4xl font-bold text-white mb-4",children:["Die Cloud ist"," ",c.jsx("span",{style:{background:"linear-gradient(135deg, #A78BFA 0%, #8B5CF6 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"voll besetzt"})]}),c.jsxs("p",{className:"text-gray-400 mb-8 text-lg",children:["Nur 10 auserwhlte Seelen schweben derzeit in unserer Cloud.",c.jsx("br",{}),"Aber keine Sorge  du kannst dich auf die Warteliste setzen. "]}),c.jsx(Ur,{mode:"wait",children:v?c.jsxs(Ne.div,{className:"p-8 rounded-3xl",style:{background:"rgba(139, 92, 246, 0.1)",border:"1px solid rgba(139, 92, 246, 0.3)"},initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},children:[c.jsx(Ne.div,{className:"text-6xl mb-4",animate:{scale:[1,1.2,1]},transition:{duration:.5},children:""}),c.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Du bist auf der Liste!"}),R&&c.jsxs("p",{className:"text-purple-400 text-lg mb-4",children:["Deine Position: ",c.jsxs("strong",{children:["#",R]})]}),c.jsxs("p",{className:"text-gray-400 text-sm",children:["Wir benachrichtigen dich, sobald ein Platz frei wird.",c.jsx("br",{}),"Halte die Wolken im Blick! "]})]},"success"):c.jsxs(Ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:[c.jsxs("form",{onSubmit:U,className:"space-y-4",children:[c.jsx("div",{className:"relative",children:c.jsx("input",{type:"email",value:l,onChange:F=>u(F.target.value),placeholder:"Deine E-Mail-Adresse",className:"w-full px-5 py-4 rounded-2xl text-white placeholder-gray-500 transition-all duration-300",style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",outline:"none"},onFocus:F=>{F.target.style.borderColor="rgba(139, 92, 246, 0.5)",F.target.style.boxShadow="0 0 20px rgba(139, 92, 246, 0.2)"},onBlur:F=>{F.target.style.borderColor="rgba(255, 255, 255, 0.1)",F.target.style.boxShadow="none"}})}),A&&c.jsx(Ne.p,{className:"text-sm px-4 py-2 rounded-xl",style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",color:"#F87171"},initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:A}),c.jsxs(Ne.button,{type:"submit",disabled:p||!l,className:"w-full py-4 rounded-2xl font-semibold text-white relative overflow-hidden disabled:opacity-50",style:{background:"linear-gradient(135deg, #8B5CF6 0%, #A78BFA 100%)"},whileHover:{scale:1.02},whileTap:{scale:.98},children:[c.jsx(Ne.div,{className:"absolute inset-0 opacity-30",style:{background:"linear-gradient(90deg, transparent, white, transparent)"},animate:{x:["-100%","100%"]},transition:{duration:2,repeat:1/0}}),c.jsx("span",{className:"relative z-10",children:p?c.jsx(Ne.span,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"inline-block",children:""}):" Auf die Warteliste"})]})]}),e>0&&c.jsxs("p",{className:"text-gray-500 text-sm mt-4",children:[e," ",e===1?"Person wartet":"Personen warten"," bereits"]})]},"form")}),c.jsx("p",{className:"text-gray-600 text-xs mt-8",children:"synclulu  Where dreamers float together"})]})]})}const AGe=()=>c.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[c.jsx("div",{className:"absolute inset-0 bg-[#0b0b0b]"}),c.jsx(Ne.div,{className:"absolute top-1/4 -left-20 w-96 h-96 rounded-full",style:{background:"radial-gradient(circle, rgba(139, 92, 246, 0.15) 0%, transparent 70%)",filter:"blur(60px)"},animate:{x:[0,30,0],y:[0,-20,0],scale:[1,1.1,1]},transition:{duration:8,repeat:1/0,ease:"easeInOut"}}),c.jsx(Ne.div,{className:"absolute bottom-1/4 -right-20 w-80 h-80 rounded-full",style:{background:"radial-gradient(circle, rgba(168, 85, 247, 0.12) 0%, transparent 70%)",filter:"blur(50px)"},animate:{x:[0,-25,0],y:[0,25,0],scale:[1,1.15,1]},transition:{duration:10,repeat:1/0,ease:"easeInOut"}}),c.jsx(Ne.div,{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[500px] h-[500px] rounded-full",style:{background:"radial-gradient(circle, rgba(139, 92, 246, 0.08) 0%, transparent 60%)",filter:"blur(80px)"},animate:{rotate:360},transition:{duration:60,repeat:1/0,ease:"linear"}}),[...Array(20)].map((t,e)=>c.jsx(Ne.div,{className:"absolute w-1 h-1 rounded-full bg-purple-400/30",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`},animate:{y:[0,-30,0],opacity:[.2,.5,.2]},transition:{duration:3+Math.random()*2,repeat:1/0,delay:Math.random()*2}},e))]}),kGe=({current:t,max:e,isLoading:r})=>{const a=Math.max(0,e-t),l=t/e*100;return c.jsxs(Ne.div,{className:"relative px-5 py-3 rounded-2xl overflow-hidden",style:{background:"rgba(139, 92, 246, 0.1)",border:"1px solid rgba(139, 92, 246, 0.3)",boxShadow:"0 0 30px rgba(139, 92, 246, 0.2)"},initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.2},children:[c.jsx(Ne.div,{className:"absolute inset-0 rounded-2xl",style:{background:"linear-gradient(90deg, transparent, rgba(139, 92, 246, 0.2), transparent)"},animate:{x:["-100%","100%"]},transition:{duration:3,repeat:1/0}}),c.jsxs("div",{className:"relative flex items-center gap-3",children:[c.jsx(Ne.div,{animate:{scale:[1,1.1,1]},transition:{duration:2,repeat:1/0},children:c.jsx(cr,{size:20,className:"text-purple-400"})}),r?c.jsx(fi,{size:16,className:"animate-spin text-purple-400"}):c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"text-sm text-gray-400",children:a>0?c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"text-purple-400 font-bold",children:a})," ","von ",e," Pltzen frei"]}):c.jsx("span",{className:"text-red-400",children:"Die Cloud ist voll"})}),c.jsx("div",{className:"mt-1.5 w-full h-1 bg-white/10 rounded-full overflow-hidden",children:c.jsx(Ne.div,{className:"h-full rounded-full",style:{background:l>=100?"linear-gradient(90deg, #EF4444, #F87171)":"linear-gradient(90deg, #8B5CF6, #A78BFA)"},initial:{width:0},animate:{width:`${Math.min(l,100)}%`},transition:{duration:1,ease:"easeOut"}})})]})]})]})},PGe=({referrerName:t})=>c.jsxs(Ne.div,{className:"flex items-center gap-2 px-4 py-2 rounded-xl",style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)"},initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:[c.jsx(_o,{size:16,className:"text-green-400"}),c.jsxs("span",{className:"text-sm text-green-400",children:["Eingeladen von ",c.jsx("strong",{children:t}),"  +5 Sterne Bonus!"]})]}),H2=({icon:t,type:e,value:r,onChange:a,placeholder:l,error:u,success:p,suffix:m,maxLength:v,autoFocus:w})=>c.jsxs("div",{className:"relative",children:[c.jsxs("div",{className:`relative flex items-center rounded-xl transition-all duration-300 ${u?"ring-2 ring-red-500/50":p?"ring-2 ring-green-500/50":"focus-within:ring-2 focus-within:ring-purple-500/50"}`,style:{background:"rgba(255, 255, 255, 0.03)",border:`1px solid ${u?"rgba(239, 68, 68, 0.3)":p?"rgba(34, 197, 94, 0.3)":"rgba(255, 255, 255, 0.1)"}`,backdropFilter:"blur(10px)"},children:[c.jsx("div",{className:"pl-4 text-gray-500",children:t}),c.jsx("input",{type:e,value:r,onChange:R=>a(R.target.value),placeholder:l,maxLength:v,autoFocus:w,className:"flex-1 px-3 py-4 bg-transparent text-white placeholder-gray-500 focus:outline-none"}),m&&c.jsx("div",{className:"pr-4",children:m})]}),u&&c.jsx(NGe,{message:u,className:"mt-1"})]}),DGe=({password:t})=>{const e=V.useMemo(()=>{let r=0;const a={length:t.length>=8,uppercase:/[A-Z]/.test(t),lowercase:/[a-z]/.test(t),number:/[0-9]/.test(t),special:/[!@#$%^&*(),.?":{}|<>]/.test(t)};return a.length&&r++,a.uppercase&&r++,a.lowercase&&r++,a.number&&r++,a.special&&r++,{score:r,checks:a,label:r<=1?"Sehr schwach":r===2?"Schwach":r===3?"Mittel":r===4?"Stark":"Sehr stark",color:r<=1?"#EF4444":r===2?"#F59E0B":r===3?"#EAB308":r===4?"#22C55E":"#10B981"}},[t]);return t?c.jsxs(Ne.div,{className:"space-y-2 mt-2",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"flex-1 h-1 bg-white/10 rounded-full overflow-hidden",children:c.jsx(Ne.div,{className:"h-full rounded-full",style:{background:e.color},initial:{width:0},animate:{width:`${e.score/5*100}%`}})}),c.jsx("span",{className:"text-xs",style:{color:e.color},children:e.label})]}),c.jsx("div",{className:"grid grid-cols-2 gap-1.5 text-xs",children:[{key:"length",label:"Min. 8 Zeichen"},{key:"uppercase",label:"Grobuchstabe"},{key:"lowercase",label:"Kleinbuchstabe"},{key:"number",label:"Zahl"},{key:"special",label:"Sonderzeichen"}].map(r=>c.jsxs("div",{className:`flex items-center gap-1.5 ${e.checks[r.key]?"text-green-400":"text-gray-500"}`,children:[e.checks[r.key]?c.jsx(_r,{size:12}):c.jsx(Di,{size:12}),r.label]},r.key))})]}):null},wae=()=>{const t=yr(),[e]=Dw(),[r,a]=V.useState({current:0,max:10,isFull:!1}),[l,u]=V.useState(!0),[p,m]=V.useState(!1),[v,w]=V.useState(""),[R,C]=V.useState(null),[A,O]=V.useState(null),[U,F]=V.useState(!1),[q,W]=V.useState(""),[H,X]=V.useState(""),[ne,te]=V.useState(""),[he,J]=V.useState(!1),[Q,ce]=V.useState({}),[de,pe]=V.useState(!1),[be,ye]=V.useState(null),[Ze,It]=V.useState(null),[St,lt]=V.useState("");V.useEffect(()=>{(async()=>{try{const mt=await MO();a({current:mt.currentUsers,max:mt.maxUsers,isFull:mt.isFull}),mt.isFull&&m(!0)}catch(mt){console.error("Error checking capacity:",mt)}finally{u(!1)}})()},[]),V.useEffect(()=>{const rt=b9();rt&&(w(rt),Le(rt))},[e]);const Le=V.useCallback(async rt=>{if(!rt||rt.length<5){C(null),O(null);return}F(!0);try{const mt=await x9(rt);C(mt.valid),O(mt.valid?mt.referrerUsername||"Ein Freund":null)}catch{C(!1)}finally{F(!1)}},[]);V.useEffect(()=>{const rt=setTimeout(()=>{v.length>=5?Le(v):(C(null),O(null))},500);return()=>clearTimeout(rt)},[v,Le]);const Me=()=>{const rt={};return(!q||q.length<3)&&(rt.username="Mindestens 3 Zeichen"),(!H||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(H))&&(rt.email="Gltige E-Mail erforderlich"),(!ne||ne.length<6)&&(rt.password="Mindestens 6 Zeichen"),ce(rt),Object.keys(rt).length===0},Ke=async rt=>{if(rt.preventDefault(),ye(null),r.isFull){m(!0);return}if(Me()){pe(!0);try{const mt=await Nge();if(!mt.canRegister){a({current:mt.capacity.currentUsers,max:mt.capacity.maxUsers,isFull:!0}),m(!0),pe(!1);return}const Ct=(await $N(ws,H,ne)).user;await Yi(tt(De,"users",Ct.uid),{id:Ct.uid,email:Ct.email,displayName:q,username:q.toLowerCase().replace(/[^a-z0-9_]/g,""),avatarUrl:null,createdAt:ci(),onboardingCompleted:!1,level:1,xp:0,nebulaStars:R?Cl.referralRewardNewUser:0,isPremium:!1,role:"user",searchRadius:Cl.standardRadius,referredBy:R?A:null,referredByCode:R?v:null}),await Yz(Ct.uid,H,q,R?v:void 0),t("/onboarding")}catch(mt){console.error("[Register] Error:",mt),mt.code==="auth/email-already-in-use"?ce({email:"Diese E-Mail wird bereits verwendet"}):mt.code==="auth/weak-password"?ce({password:"Passwort ist zu schwach"}):mt.code==="auth/invalid-email"?ce({email:"Ungltige E-Mail Adresse"}):ye("Registrierung fehlgeschlagen. Bitte versuche es erneut.")}finally{pe(!1)}}},Rt=async()=>{if(r.isFull){m(!0);return}pe(!0),ye(null);try{const rt=new Gd,yt=(await lG(ws,rt)).user;await Yi(tt(De,"users",yt.uid),{id:yt.uid,email:yt.email,displayName:yt.displayName||"Anonym",username:(yt.displayName||"user").toLowerCase().replace(/\s+/g,"_"),avatarUrl:yt.photoURL,createdAt:ci(),onboardingCompleted:!1,level:1,xp:0,nebulaStars:R?Cl.referralRewardNewUser:0,isPremium:!1,role:"user",searchRadius:Cl.standardRadius,referredBy:R?A:null,referredByCode:R?v:null},{merge:!0}),await Yz(yt.uid,yt.email||"",yt.displayName||"User",R?v:void 0),t("/onboarding")}catch(rt){console.error("[Google Sign Up] Error:",rt),ye("Google Anmeldung fehlgeschlagen")}finally{pe(!1)}};return l?c.jsx("div",{className:"min-h-screen bg-[#0b0b0b] flex items-center justify-center",children:c.jsx(IGe,{message:"Prfe Verfgbarkeit..."})}):c.jsxs("div",{className:"min-h-screen relative overflow-hidden",children:[c.jsx(AGe,{}),c.jsx(Ur,{children:p&&c.jsx(Ige,{onClose:()=>m(!1),waitlistCount:r.current})}),c.jsxs("div",{className:"relative z-10 min-h-screen flex flex-col px-6 py-8 safe-top safe-bottom",children:[c.jsxs("div",{className:"flex items-center justify-between mb-8",children:[c.jsx(Ju,{to:"/",className:"w-12 h-12 rounded-xl flex items-center justify-center transition-colors",style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:c.jsx(Eo,{size:20,className:"text-gray-400"})}),c.jsx(kGe,{current:r.current,max:r.max,isLoading:l})]}),c.jsxs(Ne.div,{className:"text-center mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[c.jsx(Ne.div,{className:"w-24 h-24 mx-auto rounded-3xl flex items-center justify-center mb-6",style:{background:"linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(168, 85, 247, 0.2) 100%)",boxShadow:"0 0 60px rgba(139, 92, 246, 0.3)",border:"1px solid rgba(139, 92, 246, 0.3)"},animate:{boxShadow:["0 0 60px rgba(139, 92, 246, 0.3)","0 0 80px rgba(139, 92, 246, 0.4)","0 0 60px rgba(139, 92, 246, 0.3)"]},transition:{duration:3,repeat:1/0},children:c.jsx("span",{className:"text-5xl",children:""})}),c.jsx("h1",{className:"text-4xl font-black mb-2",style:{background:"linear-gradient(135deg, #A78BFA 0%, #C4B5FD 50%, #8B5CF6 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Willkommen"}),c.jsx("p",{className:"text-gray-400",children:"Tritt der exklusiven Cloud bei"})]}),c.jsx(Ur,{children:R&&A&&c.jsx(Ne.div,{className:"mb-6",children:c.jsx(PGe,{referrerName:A})})}),c.jsx(Ne.div,{className:"rounded-3xl p-6 mb-6",style:{background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 255, 255, 0.08)",backdropFilter:"blur(20px)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)"},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:c.jsxs("form",{onSubmit:Ke,className:"space-y-5",children:[c.jsx(H2,{icon:c.jsx(md,{size:18}),type:"text",value:q,onChange:rt=>W(rt.toLowerCase().replace(/[^a-z0-9_]/g,"")),placeholder:"Benutzername",error:Q.username,maxLength:20,autoFocus:!0}),c.jsx(H2,{icon:c.jsx(c0,{size:18}),type:"email",value:H,onChange:X,placeholder:"E-Mail Adresse",error:Q.email}),c.jsxs("div",{children:[c.jsx(H2,{icon:c.jsx(yo,{size:18}),type:he?"text":"password",value:ne,onChange:te,placeholder:"Passwort",error:Q.password,suffix:c.jsx("button",{type:"button",onClick:()=>J(!he),className:"text-gray-500 hover:text-white transition-colors",children:he?c.jsx(lp,{size:18}):c.jsx(Pl,{size:18})})}),c.jsx(DGe,{password:ne})]}),c.jsx(H2,{icon:c.jsx(_o,{size:18}),type:"text",value:v,onChange:rt=>w(rt.toUpperCase()),placeholder:"Einladungscode (optional)",error:R===!1&&v.length>=5?"Ungltiger Code":void 0,success:R===!0,maxLength:15,suffix:U?c.jsx(fi,{size:16,className:"animate-spin text-gray-400"}):R===!0?c.jsx(_r,{size:16,className:"text-green-400"}):R===!1&&v.length>=5?c.jsx(Di,{size:16,className:"text-red-400"}):null}),c.jsx(Ur,{children:be&&c.jsx(CGe,{message:be,severity:"error",onDismiss:()=>ye(null)})}),c.jsxs(Ne.button,{type:"submit",disabled:de||r.isFull,className:"w-full py-4 rounded-xl font-semibold text-white relative overflow-hidden disabled:opacity-50",style:{background:"linear-gradient(135deg, #8B5CF6 0%, #A78BFA 100%)",boxShadow:"0 4px 20px rgba(139, 92, 246, 0.4)"},whileHover:{scale:1.02},whileTap:{scale:.98},children:[c.jsx(Ne.div,{className:"absolute inset-0",style:{background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent)"},animate:{x:["-100%","100%"]},transition:{duration:2,repeat:1/0}}),c.jsx("span",{className:"relative z-10 flex items-center justify-center gap-2",children:de?c.jsxs(c.Fragment,{children:[c.jsx(fi,{size:20,className:"animate-spin"}),"Wird erstellt..."]}):c.jsxs(c.Fragment,{children:[c.jsx(kn,{size:18}),"Account erstellen"]})})]})]})}),c.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[c.jsx("div",{className:"flex-1 h-px bg-white/10"}),c.jsx("span",{className:"text-gray-500 text-sm",children:"oder"}),c.jsx("div",{className:"flex-1 h-px bg-white/10"})]}),c.jsxs(Ne.button,{onClick:Rt,disabled:de||r.isFull,className:"w-full py-4 rounded-xl font-medium flex items-center justify-center gap-3 transition-all disabled:opacity-50",style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)"},whileHover:{background:"rgba(255, 255, 255, 0.1)"},whileTap:{scale:.98},initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:[c.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",children:[c.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),c.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),c.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),c.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),c.jsx("span",{className:"text-white",children:"Mit Google fortfahren"})]}),c.jsxs(Ne.p,{className:"text-center text-gray-400 mt-8",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:["Bereits registriert?"," ",c.jsx(Ju,{to:"/login",className:"text-purple-400 font-semibold hover:text-purple-300 transition-colors",children:"Anmelden"})]}),c.jsxs(Ne.p,{className:"text-xs text-gray-500 text-center mt-6 px-4 leading-relaxed",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},children:["Mit der Registrierung akzeptierst du unsere"," ",c.jsx(Ju,{to:"/agb",className:"text-purple-400 hover:underline",children:"AGB"})," ","und"," ",c.jsx(Ju,{to:"/datenschutz",className:"text-purple-400 hover:underline",children:"Datenschutzerklrung"}),"."]})]})]})},b0={dark:{bg:"#0a0a0c",bgSecondary:"rgba(255, 255, 255, 0.03)",bgHover:"rgba(139, 92, 246, 0.08)",border:"rgba(255, 255, 255, 0.08)",borderHover:"rgba(167, 139, 250, 0.5)",text:"#f5f5f7",textSecondary:"#b8b8bd",textMuted:"#71717a",inputBg:"rgba(20, 20, 22, 0.8)",cardBg:"rgba(20, 20, 22, 0.95)",accent:"#A78BFA",accentLight:"#C4B5FD",success:"#4ADE80",error:"#F87171",orbOpacity:.1},light:{bg:"#ffffff",bgSecondary:"rgba(139, 92, 246, 0.04)",bgHover:"rgba(139, 92, 246, 0.1)",border:"rgba(0, 0, 0, 0.08)",borderHover:"rgba(139, 92, 246, 0.5)",text:"#1a1a1a",textSecondary:"#6b6b6b",textMuted:"#8e8e93",inputBg:"rgba(255, 255, 255, 0.9)",cardBg:"rgba(255, 255, 255, 0.95)",accent:"#7C3AED",accentLight:"#8B5CF6",success:"#22C55E",error:"#EF4444",orbOpacity:.12}},OGe=()=>typeof window<"u"&&window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":"dark",LGe=({theme:t})=>{const e=b0[t];return c.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[c.jsx("div",{className:"absolute inset-0",style:{background:e.bg}}),c.jsx(Ne.div,{className:"absolute w-[600px] h-[600px] rounded-full",style:{background:`radial-gradient(circle, rgba(139, 92, 246, ${e.orbOpacity}) 0%, transparent 60%)`,top:"-20%",left:"-10%",filter:"blur(80px)"},animate:{scale:[1,1.2,1],x:[0,50,0],y:[0,30,0]},transition:{duration:15,repeat:1/0,ease:"easeInOut"}}),c.jsx(Ne.div,{className:"absolute w-[500px] h-[500px] rounded-full",style:{background:`radial-gradient(circle, rgba(168, 85, 247, ${e.orbOpacity*.8}) 0%, transparent 60%)`,bottom:"-15%",right:"-10%",filter:"blur(60px)"},animate:{scale:[1.2,1,1.2],x:[0,-40,0],y:[0,-20,0]},transition:{duration:12,repeat:1/0,ease:"easeInOut"}}),c.jsx("div",{className:"absolute inset-0",style:{backgroundImage:t==="dark"?`linear-gradient(rgba(139, 92, 246, 0.03) 1px, transparent 1px),
               linear-gradient(90deg, rgba(139, 92, 246, 0.03) 1px, transparent 1px)`:`linear-gradient(rgba(139, 92, 246, 0.05) 1px, transparent 1px),
               linear-gradient(90deg, rgba(139, 92, 246, 0.05) 1px, transparent 1px)`,backgroundSize:"50px 50px"}})]})},jGe=({theme:t,onExit:e,showBack:r,onBack:a})=>{const l=b0[t];return c.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r&&a?c.jsx(Ne.button,{onClick:a,className:"w-12 h-12 rounded-xl flex items-center justify-center transition-colors",style:{background:l.bgSecondary,border:`1px solid ${l.border}`},whileHover:{background:l.bgHover},whileTap:{scale:.95},children:c.jsx(dd,{size:20,style:{color:l.textSecondary}})}):c.jsx(Ne.button,{onClick:e,className:"w-12 h-12 rounded-xl flex items-center justify-center transition-colors",style:{background:l.bgSecondary,border:`1px solid ${l.border}`},whileHover:{background:l.bgHover},whileTap:{scale:.95},children:c.jsx(Di,{size:20,style:{color:l.textSecondary}})}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-2xl",children:""}),c.jsx("span",{className:"text-xl font-bold",style:{background:`linear-gradient(135deg, ${l.accent} 0%, ${l.accentLight} 100%)`,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"synclulu"})]}),c.jsx("div",{className:"w-12"})]})},MGe=({currentStep:t,totalSteps:e,theme:r})=>{const a=b0[r],l=["Account","Profil","Aura"];return c.jsxs("div",{className:"w-full max-w-sm mx-auto mb-8",children:[c.jsx("div",{className:"flex items-center justify-between mb-3",children:Array.from({length:e}).map((u,p)=>c.jsxs("div",{className:"flex items-center",children:[c.jsx(Ne.div,{className:"w-10 h-10 rounded-full flex items-center justify-center text-sm font-semibold transition-all duration-500",style:{background:p<t?a.accent:p===t?`${a.accent}30`:a.bgSecondary,border:p===t?`2px solid ${a.accent}`:`1px solid ${a.border}`,color:p<=t?p<t?"#FFF":a.accent:a.textMuted},animate:p===t?{scale:[1,1.05,1]}:{},transition:{duration:2,repeat:1/0},children:p<t?c.jsx(_r,{size:16}):p+1}),p<e-1&&c.jsx("div",{className:"w-16 h-1 mx-2 rounded-full overflow-hidden",style:{background:a.border},children:c.jsx(Ne.div,{className:"h-full rounded-full",style:{background:a.accent},initial:{width:0},animate:{width:p<t?"100%":"0%"},transition:{duration:.5}})})]},p))}),c.jsx("div",{className:"flex justify-between px-2",children:l.map((u,p)=>c.jsx("span",{className:"text-xs font-medium",style:{color:p<=t?a.accent:a.textMuted},children:u},p))})]})},UO=({icon:t,type:e,value:r,onChange:a,placeholder:l,error:u,suffix:p,maxLength:m,autoFocus:v,theme:w})=>{const R=b0[w],[C,A]=V.useState(!1);return c.jsxs("div",{className:"relative",children:[c.jsxs(Ne.div,{className:"relative flex items-center rounded-2xl transition-all duration-300",style:{background:u?`${R.error}10`:C?`${R.accent}08`:R.inputBg,border:`1px solid ${u?`${R.error}60`:C?R.borderHover:R.border}`,boxShadow:u?`0 0 20px ${R.error}15`:C?`0 0 25px ${R.accent}15`:"none"},animate:u?{x:[-2,2,-2,2,0]}:{},transition:{duration:.3},children:[c.jsx("div",{className:"pl-4 transition-colors",style:{color:u?R.error:C?R.accent:R.textMuted},children:t}),c.jsx("input",{type:e,value:r,onChange:O=>a(O.target.value),placeholder:l,maxLength:m,autoFocus:v,onFocus:()=>A(!0),onBlur:()=>A(!1),className:"flex-1 px-3 py-4 bg-transparent focus:outline-none text-base",style:{color:R.text,caretColor:R.accent}}),p&&c.jsx("div",{className:"pr-4",children:p})]}),c.jsx(Ur,{children:u&&c.jsxs(Ne.p,{className:"text-xs mt-2 pl-4 flex items-center gap-1",style:{color:R.error},initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},children:[c.jsx(mI,{size:12}),u]})})]})},UGe=({formData:t,setFormData:e,errors:r,onNext:a,isLoading:l,referralValid:u,referrerName:p,theme:m})=>{const v=b0[m],[w,R]=V.useState(!1),A=(()=>{const F=t.password;let q=0;return F.length>=8&&q++,/[A-Z]/.test(F)&&q++,/[a-z]/.test(F)&&q++,/[0-9]/.test(F)&&q++,/[^A-Za-z0-9]/.test(F)&&q++,q})(),O=["#EF4444","#F59E0B","#EAB308","#22C55E","#10B981"],U=["Sehr schwach","Schwach","Okay","Gut","Sehr stark"];return c.jsxs(Ne.div,{className:"space-y-5",initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},children:[c.jsxs("div",{className:"text-center mb-6",children:[c.jsx("h2",{className:"text-2xl font-bold mb-2",style:{color:v.text},children:"Erstelle deinen Account"}),c.jsx("p",{style:{color:v.textSecondary},children:"Tritt der exklusiven Cloud bei"})]}),r.general&&c.jsxs(Ne.div,{className:"p-4 rounded-xl flex items-center gap-3",style:{background:`${v.error}15`,border:`1px solid ${v.error}40`},initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:[c.jsx(mI,{size:20,style:{color:v.error}}),c.jsx("span",{className:"text-sm",style:{color:v.error},children:r.general})]}),u&&p&&c.jsxs(Ne.div,{className:"flex items-center gap-2 px-4 py-3 rounded-xl",style:{background:`${v.success}15`,border:`1px solid ${v.success}40`},initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:[c.jsx(kn,{size:16,style:{color:v.success}}),c.jsxs("span",{className:"text-sm",style:{color:v.success},children:["Eingeladen von ",c.jsx("strong",{children:p}),"  +5 Sterne Bonus!"]})]}),c.jsx(UO,{icon:c.jsx(c0,{size:18}),type:"email",value:t.email,onChange:F=>e(q=>({...q,email:F})),placeholder:"E-Mail Adresse",error:r.email,autoFocus:!0,theme:m}),c.jsxs("div",{children:[c.jsx(UO,{icon:c.jsx(yo,{size:18}),type:w?"text":"password",value:t.password,onChange:F=>e(q=>({...q,password:F})),placeholder:"Passwort (min. 6 Zeichen)",error:r.password,theme:m,suffix:c.jsx("button",{type:"button",onClick:()=>R(!w),style:{color:v.textMuted},className:"hover:opacity-70 transition-opacity",children:w?c.jsx(lp,{size:18}):c.jsx(Pl,{size:18})})}),t.password&&c.jsxs(Ne.div,{className:"mt-3 px-1",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},children:[c.jsx("div",{className:"flex gap-1 mb-1",children:[0,1,2,3,4].map(F=>c.jsx("div",{className:"flex-1 h-1.5 rounded-full transition-all",style:{background:F<A?O[A-1]:v.border}},F))}),c.jsx("p",{className:"text-xs",style:{color:O[Math.max(0,A-1)]},children:U[Math.max(0,A-1)]})]})]}),c.jsxs(Ne.button,{onClick:a,disabled:l||!t.email||!t.password,className:"w-full py-4 rounded-2xl font-semibold text-white relative overflow-hidden disabled:opacity-40 mt-4",style:{background:`linear-gradient(135deg, ${v.accent} 0%, ${v.accentLight} 100%)`,boxShadow:`0 4px 25px ${v.accent}40`},whileHover:{scale:1.02},whileTap:{scale:.98},children:[c.jsx(Ne.div,{className:"absolute inset-0",style:{background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent)"},animate:{x:["-100%","100%"]},transition:{duration:2,repeat:1/0}}),c.jsx("span",{className:"relative flex items-center justify-center gap-2",children:l?c.jsx(fi,{className:"animate-spin",size:20}):c.jsxs(c.Fragment,{children:["Weiter ",c.jsx(Fi,{size:18})]})})]}),c.jsxs("p",{className:"text-center text-sm",style:{color:v.textSecondary},children:["Bereits registriert?"," ",c.jsx(Ju,{to:"/login",style:{color:v.accent},className:"font-semibold hover:underline",children:"Anmelden"})]})]})},VGe=({formData:t,setFormData:e,errors:r,onNext:a,isLoading:l,theme:u})=>{const p=b0[u],m=V.useRef(null),[v,w]=V.useState(t.avatarUrl),R=C=>{var O;const A=(O=C.target.files)==null?void 0:O[0];if(A&&A.size<=5*1024*1024){e(F=>({...F,avatarFile:A}));const U=new FileReader;U.onloadend=()=>w(U.result),U.readAsDataURL(A)}};return c.jsxs(Ne.div,{className:"space-y-5",initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},children:[c.jsxs("div",{className:"text-center mb-4",children:[c.jsx("h2",{className:"text-2xl font-bold mb-2",style:{color:p.text},children:"Erstelle dein Profil"}),c.jsx("p",{style:{color:p.textSecondary},children:"So sehen dich andere Trumer"})]}),c.jsx("div",{className:"flex justify-center mb-6",children:c.jsxs(Ne.button,{type:"button",onClick:()=>{var C;return(C=m.current)==null?void 0:C.click()},className:"relative group",whileHover:{scale:1.05},whileTap:{scale:.95},children:[c.jsx("div",{className:"w-28 h-28 rounded-full flex items-center justify-center overflow-hidden",style:{background:v?`url(${v}) center/cover`:`linear-gradient(135deg, ${p.accent}30 0%, ${p.accentLight}20 100%)`,border:`2px solid ${p.accent}50`,boxShadow:`0 0 30px ${p.accent}20`},children:!v&&c.jsx(vO,{size:32,style:{color:p.accent}})}),c.jsx(Ne.div,{className:"absolute inset-0 rounded-full flex items-center justify-center bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity",children:c.jsx(vO,{size:24,className:"text-white"})}),c.jsx("input",{ref:m,type:"file",accept:"image/*",onChange:R,className:"hidden"})]})}),c.jsx("p",{className:"text-center text-sm mb-4",style:{color:p.textMuted},children:"Tippe fr ein Profilbild (optional)"}),c.jsx(UO,{icon:c.jsx(md,{size:18}),type:"text",value:t.displayName,onChange:C=>e(A=>({...A,displayName:C})),placeholder:"Anzeigename",error:r.displayName,maxLength:30,autoFocus:!0,theme:u}),c.jsx(UO,{icon:c.jsx("span",{style:{color:p.textMuted},children:"@"}),type:"text",value:t.username,onChange:C=>e(A=>({...A,username:C.toLowerCase().replace(/[^a-z0-9_]/g,"")})),placeholder:"benutzername",error:r.username,maxLength:20,theme:u}),(r.general||r.email)&&c.jsxs(Ne.div,{className:"p-4 rounded-xl flex items-center gap-3",style:{background:`${p.error}15`,border:`1px solid ${p.error}40`},initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:[c.jsx(mI,{size:20,style:{color:p.error}}),c.jsx("span",{className:"text-sm",style:{color:p.error},children:r.general||r.email})]}),c.jsx(Ne.button,{onClick:()=>{console.log(" [REG] Button clicked!"),console.log(" [REG] Form data:",t),a()},disabled:l||!t.displayName||!t.username,className:"w-full py-4 rounded-2xl font-semibold text-white relative overflow-hidden disabled:opacity-40",style:{background:`linear-gradient(135deg, ${p.accent} 0%, ${p.accentLight} 100%)`,boxShadow:`0 4px 25px ${p.accent}40`},whileHover:{scale:1.02},whileTap:{scale:.98},children:c.jsx("span",{className:"relative flex items-center justify-center gap-2",children:l?c.jsx(fi,{className:"animate-spin",size:20}):c.jsxs(c.Fragment,{children:["Account erstellen ",c.jsx(kn,{size:16})]})})})]})},FGe=({permissions:t,onRequestPermission:e,onComplete:r,onSkip:a,isLoading:l,theme:u})=>{const p=b0[u],m=t.location==="granted",v=[{key:"location",icon:no,title:"Standort aktivieren",description:"Zeige dich auf dem Radar fr andere.",required:!0,status:t.location},{key:"microphone",icon:Qo,title:"Mikrofon (optional)",description:"Fr Sprachnachrichten in der Cloud.",required:!1,status:t.microphone},{key:"notifications",icon:kl,title:"Benachrichtigungen",description:"Verpasse keine Matches.",required:!1,status:t.notifications}];return c.jsxs(Ne.div,{className:"space-y-5",initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},children:[c.jsxs("div",{className:"text-center mb-6",children:[c.jsx(Ne.div,{className:"w-20 h-20 mx-auto mb-4 rounded-2xl flex items-center justify-center",style:{background:`linear-gradient(135deg, ${p.accent}25 0%, ${p.accentLight}15 100%)`,border:`1px solid ${p.accent}40`},animate:{boxShadow:[`0 0 20px ${p.accent}20`,`0 0 40px ${p.accent}35`,`0 0 20px ${p.accent}20`]},transition:{duration:3,repeat:1/0},children:c.jsx(cs,{size:32,style:{color:p.accent}})}),c.jsx("h2",{className:"text-2xl font-bold mb-2",style:{color:p.text},children:"Aktiviere deine Aura"}),c.jsx("p",{style:{color:p.textSecondary},children:"Nur der Standort ist erforderlich"})]}),c.jsx("div",{className:"space-y-3",children:v.map((w,R)=>{const C=w.icon,A=w.status==="granted",O=w.status==="denied";return c.jsx(Ne.button,{onClick:()=>!A&&e(w.key),disabled:A,className:"w-full p-4 rounded-2xl text-left relative overflow-hidden",style:{background:A?`${p.success}12`:O?`${p.error}12`:p.cardBg,border:`1px solid ${A?`${p.success}40`:O?`${p.error}40`:p.border}`},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:R*.1},whileHover:A?{}:{background:`${p.accent}10`},whileTap:A?{}:{scale:.98},children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center",style:{background:A?`${p.success}20`:O?`${p.error}20`:`${p.accent}20`,color:A?p.success:O?p.error:p.accent},children:A?c.jsx(_r,{size:20}):c.jsx(C,{size:20})}),c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"font-medium",style:{color:p.text},children:w.title}),w.required&&!A&&c.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full font-medium",style:{background:`${p.accent}25`,color:p.accent},children:"Pflicht"})]}),c.jsx("p",{className:"text-sm mt-0.5",style:{color:p.textSecondary},children:w.description})]}),!A&&c.jsx(Fi,{size:18,style:{color:p.textMuted}})]})},w.key)})}),c.jsx(Ne.button,{onClick:r,disabled:!m||l,className:"w-full py-4 rounded-2xl font-semibold text-white relative overflow-hidden disabled:opacity-40",style:{background:m?`linear-gradient(135deg, ${p.success} 0%, #16A34A 100%)`:`linear-gradient(135deg, ${p.accent} 0%, ${p.accentLight} 100%)`,boxShadow:m?`0 4px 25px ${p.success}40`:`0 4px 25px ${p.accent}40`},whileHover:{scale:1.02},whileTap:{scale:.98},children:c.jsx("span",{className:"relative flex items-center justify-center gap-2",children:l?c.jsx(fi,{className:"animate-spin",size:20}):m?c.jsxs(c.Fragment,{children:[c.jsx(kn,{size:18}),"In die Cloud eintreten"]}):"Standort erforderlich"})}),c.jsx("p",{className:"text-xs text-center",style:{color:p.textMuted},children:"Du kannst Berechtigungen spter in den Einstellungen ndern"})]})},Sae=()=>{const t=yr(),[e]=Dw(),[r,a]=V.useState(OGe()),l=b0[r];V.useEffect(()=>{const rt=window.matchMedia("(prefers-color-scheme: dark)"),mt=yt=>a(yt.matches?"dark":"light");return rt.addEventListener("change",mt),()=>rt.removeEventListener("change",mt)},[]);const[u,p]=V.useState("credentials"),m=u==="credentials"?0:u==="profile"?1:2,[v,w]=V.useState({current:0,max:10,isFull:!1}),[R,C]=V.useState(!0),[A,O]=V.useState(!1),[U,F]=V.useState(null),[q,W]=V.useState(null),[H,X]=V.useState(null),[ne,te]=V.useState({email:"",password:"",username:"",displayName:"",avatarUrl:null,avatarFile:null}),[he,J]=V.useState({}),[Q,ce]=V.useState(!1),[de,pe]=V.useState(null),[be,ye]=V.useState({location:null,microphone:null,notifications:null});V.useEffect(()=>{(async()=>{try{const mt=await MO();w({current:mt.currentUsers,max:mt.maxUsers,isFull:mt.isFull}),mt.isFull&&O(!0)}catch(mt){console.error("Capacity check failed:",mt)}finally{C(!1)}})()},[]),V.useEffect(()=>{const rt=b9();rt&&(F(rt),x9(rt).then(mt=>{W(mt.valid),X(mt.valid?mt.referrerUsername||"Ein Freund":null)}))},[e]),V.useEffect(()=>{(async()=>{if("permissions"in navigator){try{const mt=await navigator.permissions.query({name:"geolocation"});ye(yt=>({...yt,location:mt.state}))}catch{ye(mt=>({...mt,location:"prompt"}))}try{const mt=await navigator.permissions.query({name:"microphone"});ye(yt=>({...yt,microphone:mt.state}))}catch{ye(mt=>({...mt,microphone:"prompt"}))}}"Notification"in window&&ye(mt=>({...mt,notifications:Notification.permission}))})()},[]);const Ze=()=>t("/"),It=()=>{u==="profile"?p("credentials"):u==="permissions"&&p("profile")},St=()=>{const rt={};return(!ne.email||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(ne.email))&&(rt.email="Gltige E-Mail erforderlich"),(!ne.password||ne.password.length<6)&&(rt.password="Mindestens 6 Zeichen"),J(rt),Object.keys(rt).length===0},lt=()=>{const rt={};return(!ne.displayName||ne.displayName.length<2)&&(rt.displayName="Mindestens 2 Zeichen"),(!ne.username||ne.username.length<3)&&(rt.username="Mindestens 3 Zeichen"),J(rt),Object.keys(rt).length===0},Le=()=>{St()&&p("profile")},Me=async()=>{var rt,mt;if(lt()){ce(!0),J({});try{console.log(" [REG] Step 1: Checking capacity...");const yt=await MO();if(console.log(" [REG] Capacity:",yt),yt.isFull){console.log(" [REG] Cloud is full!"),O(!0),ce(!1);return}console.log(" [REG] Step 2: Creating Firebase Auth user...");const Ot=(await $N(ws,ne.email,ne.password)).user;console.log(" [REG] Auth user created:",Ot.uid),pe(Ot);let vt=null;if(ne.avatarFile)try{console.log(" [REG] Step 3: Uploading avatar...");const zt=yO(Zhe,`avatars/${Ot.uid}`);await lz(zt,ne.avatarFile),vt=await _O(zt),console.log(" [REG] Avatar uploaded:",vt)}catch(zt){console.warn(" [REG] Avatar upload failed, continuing without avatar:",zt.code,zt.message)}console.log(" [REG] Step 4: Creating Firestore user doc..."),await Yi(tt(De,"users",Ot.uid),{id:Ot.uid,email:Ot.email,displayName:ne.displayName,username:ne.username,avatarUrl:vt,createdAt:ci(),onboardingCompleted:!1,level:1,xp:0,nebulaStars:q?Cl.referralRewardNewUser:0,isPremium:!1,role:"user",searchRadius:Cl.standardRadius,referredBy:q?H:null,referredByCode:q?U:null,permissions:{location:!1,microphone:!1,notifications:!1}}),console.log(" [REG] Firestore user doc created!"),console.log(" [REG] Step 5: Moving to permissions step..."),p("permissions")}catch(yt){console.error(" [REG] Registration error:",yt),console.error(" [REG] Error code:",yt.code),console.error(" [REG] Error message:",yt.message),yt.code==="auth/email-already-in-use"?(J({general:"Diese E-Mail wird bereits verwendet. Gehe zurck und ndere sie."}),p("credentials")):yt.code==="auth/weak-password"?(J({general:"Passwort zu schwach. Gehe zurck und whle ein strkeres."}),p("credentials")):yt.code==="auth/invalid-email"?(J({general:"Ungltige E-Mail-Adresse. Gehe zurck und korrigiere sie."}),p("credentials")):yt.code==="auth/operation-not-allowed"?J({general:"E-Mail/Passwort Anmeldung ist nicht aktiviert. Kontaktiere Support."}):yt.code==="auth/network-request-failed"?J({general:"Netzwerkfehler. Prfe deine Internetverbindung."}):(rt=yt.code)!=null&&rt.includes("permission-denied")?J({general:"Firestore Berechtigung fehlt. Kontaktiere Support."}):yt.code==="storage/unauthorized"||yt.code==="storage/permission-denied"?(console.warn(" [REG] Storage permission denied, continuing without avatar..."),J({general:"Profilbild konnte nicht hochgeladen werden. Du kannst es spter hinzufgen."})):(mt=yt.code)!=null&&mt.startsWith("storage/")?(console.warn(" [REG] Storage error:",yt.code),J({general:`Profilbild-Upload fehlgeschlagen: ${yt.message}`})):J({general:`Fehler: ${yt.code||yt.message||"Unbekannter Fehler"}`})}finally{ce(!1)}}},Ke=async rt=>{try{if(rt==="location"){const mt=await new Promise((yt,Ct)=>{navigator.geolocation.getCurrentPosition(yt,Ct,{enableHighAccuracy:!0,timeout:15e3})});ye(yt=>({...yt,location:"granted"})),de&&await Yi(tt(De,"users",de.uid),{location:{lat:mt.coords.latitude,lng:mt.coords.longitude,updatedAt:ci()},"permissions.location":!0},{merge:!0})}if(rt==="microphone"&&((await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(yt=>yt.stop()),ye(yt=>({...yt,microphone:"granted"})),de&&await Yi(tt(De,"users",de.uid),{"permissions.microphone":!0},{merge:!0})),rt==="notifications"){const mt=await Notification.requestPermission();ye(yt=>({...yt,notifications:mt})),de&&await Yi(tt(De,"users",de.uid),{"permissions.notifications":mt==="granted"},{merge:!0})}}catch(mt){console.error(`Permission ${rt} denied:`,mt),ye(yt=>({...yt,[rt]:"denied"}))}},Rt=async()=>{if(be.location==="granted"){ce(!0);try{de&&(await Yi(tt(De,"users",de.uid),{onboardingCompleted:!0},{merge:!0}),await Yz(de.uid,ne.email,ne.username,q&&U||void 0)),t("/")}catch(rt){console.error("Completion error:",rt),t("/")}finally{ce(!1)}}};return R?c.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{background:l.bg},children:c.jsxs(Ne.div,{className:"text-center",initial:{opacity:0},animate:{opacity:1},children:[c.jsx(fi,{className:"animate-spin mx-auto mb-4",size:32,style:{color:l.accent}}),c.jsx("p",{style:{color:l.textSecondary},children:"Prfe Verfgbarkeit..."})]})}):c.jsxs("div",{className:"min-h-screen relative overflow-hidden",children:[c.jsx(LGe,{theme:r}),c.jsx(Ur,{children:A&&c.jsx(Ige,{onClose:()=>O(!1),waitlistCount:v.current})}),c.jsxs("div",{className:"relative z-10 min-h-screen flex flex-col px-6 py-6 safe-top safe-bottom",children:[c.jsx(jGe,{theme:r,onExit:Ze,showBack:u!=="credentials",onBack:It}),c.jsx(MGe,{currentStep:m,totalSteps:3,theme:r}),c.jsx("div",{className:"flex-1 flex flex-col justify-center max-w-md mx-auto w-full",children:c.jsxs(Ur,{mode:"wait",children:[u==="credentials"&&c.jsx(UGe,{formData:ne,setFormData:te,errors:he,onNext:Le,isLoading:Q,referralValid:q,referrerName:H,theme:r},"credentials"),u==="profile"&&c.jsx(VGe,{formData:ne,setFormData:te,errors:he,onNext:Me,isLoading:Q,theme:r},"profile"),u==="permissions"&&c.jsx(FGe,{permissions:be,onRequestPermission:Ke,onComplete:Rt,onSkip:Rt,isLoading:Q,theme:r},"permissions")]})}),c.jsxs(Ne.p,{className:"text-xs text-center mt-6",style:{color:l.textMuted},initial:{opacity:0},animate:{opacity:1},children:["Mit der Registrierung akzeptierst du unsere"," ",c.jsx(Ju,{to:"/agb",style:{color:l.accent},children:"AGB"})," ","und"," ",c.jsx(Ju,{to:"/datenschutz",style:{color:l.accent},children:"Datenschutzerklrung"})]})]})]})},BGe=({type:t,size:e=24,className:r=""})=>{const l={mobile:Rpe,tablet:V5e,desktop:N5e,unknown:vie}[t]||vie;return c.jsx(l,{size:e,className:r})},zGe=({device:t,onRevoke:e,isRevoking:r})=>{const[a,l]=V.useState(!1),u=p=>{const v=new Date().getTime()-p.getTime(),w=Math.floor(v/6e4),R=Math.floor(w/60),C=Math.floor(R/24);return w<1?"Gerade aktiv":w<60?`Vor ${w} Min`:R<24?`Vor ${R} Std`:C<7?`Vor ${C} Tagen`:p.toLocaleDateString("de-DE")};return c.jsxs("div",{className:`
        relative rounded-2xl p-4 transition-all
        ${t.isCurrent?"bg-purple-500/10 border-2 border-purple-500/30":"bg-white/5 border border-white/10 hover:border-white/20"}
      `,children:[t.isCurrent&&c.jsx("div",{className:"absolute -top-2 left-4 px-2 py-0.5 bg-purple-500 rounded-full",children:c.jsx("span",{className:"text-[10px] font-bold text-white uppercase tracking-wider",children:"Dieses Gert"})}),c.jsxs("div",{className:"flex items-start gap-4",children:[c.jsx("div",{className:`
          w-12 h-12 rounded-xl flex items-center justify-center
          ${t.isCurrent?"bg-purple-500/20 text-purple-400":"bg-white/10 text-gray-400"}
        `,children:c.jsx(BGe,{type:t.deviceType,size:24})}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("h3",{className:"font-semibold text-white truncate",children:t.deviceName}),t.isCurrent&&c.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"})]}),c.jsxs("p",{className:"text-sm text-gray-400 truncate",children:[t.browser,"  ",t.os]}),c.jsxs("div",{className:"flex items-center gap-3 mt-2 text-xs text-gray-500",children:[c.jsxs("span",{className:"flex items-center gap-1",children:[c.jsx(Ua,{size:12}),u(t.lastActive)]}),t.location&&c.jsxs("span",{className:"flex items-center gap-1",children:[c.jsx(no,{size:12}),t.location]})]})]}),!t.isCurrent&&c.jsx("div",{children:a?c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("button",{onClick:()=>{e(),l(!1)},disabled:r,className:"w-8 h-8 rounded-lg bg-red-500/20 text-red-400 flex items-center justify-center hover:bg-red-500/30 transition-colors",children:r?c.jsx("div",{className:"w-4 h-4 border-2 border-red-400 border-t-transparent rounded-full animate-spin"}):c.jsx(_r,{size:16})}),c.jsx("button",{onClick:()=>l(!1),className:"w-8 h-8 rounded-lg bg-white/10 text-gray-400 flex items-center justify-center hover:bg-white/20 transition-colors",children:c.jsx(Di,{size:16})})]}):c.jsx("button",{onClick:()=>l(!0),className:"w-8 h-8 rounded-lg bg-white/5 text-gray-400 flex items-center justify-center hover:bg-red-500/20 hover:text-red-400 transition-colors",children:c.jsx(zL,{size:16})})})]})]})},GGe=()=>{const t=yr(),{user:e}=Jr(),[r,a]=V.useState([]),[l,u]=V.useState(!0),[p,m]=V.useState(null),[v,w]=V.useState(!1),R=()=>sessionStorage.getItem("synclulu_session_id")||"unknown",C=()=>{const F=navigator.userAgent;let q="desktop";/tablet|ipad/i.test(F)?q="tablet":/mobile|android|iphone/i.test(F)&&(q="mobile");let W="Unbekannt";F.includes("Chrome")?W="Chrome":F.includes("Safari")?W="Safari":F.includes("Firefox")?W="Firefox":F.includes("Edge")&&(W="Edge");let H="Unbekannt";F.includes("Mac")?H="macOS":F.includes("Windows")?H="Windows":F.includes("iPhone")||F.includes("iPad")?H="iOS":F.includes("Android")?H="Android":F.includes("Linux")&&(H="Linux");const X=q==="mobile"?`${H} Smartphone`:q==="tablet"?`${H} Tablet`:`${W} auf ${H}`;return{deviceType:q,deviceName:X,browser:W,os:H}};V.useEffect(()=>{(async()=>{if(e!=null&&e.id){u(!0);try{const q=Mr(mn(De,"user_sessions"),Kn("userId","==",e.id)),W=await Cr(q),H=R(),X=W.docs.map(ne=>{var he,J;const te=ne.data();return{id:ne.id,deviceType:te.deviceType||"unknown",deviceName:te.deviceName||"Unbekanntes Gert",browser:te.browser||"Unbekannt",os:te.os||"Unbekannt",location:te.location,ipAddress:te.ipAddress,lastActive:((he=te.lastActive)==null?void 0:he.toDate())||new Date,createdAt:((J=te.createdAt)==null?void 0:J.toDate())||new Date,isCurrent:ne.id===H}});if(X.sort((ne,te)=>ne.isCurrent?-1:te.isCurrent?1:te.lastActive.getTime()-ne.lastActive.getTime()),X.length===0){const ne=C();X.push({id:"current",...ne,lastActive:new Date,createdAt:new Date,isCurrent:!0})}a(X)}catch(q){console.error("[DevicesSettings] Load error:",q)}finally{u(!1)}}})()},[e==null?void 0:e.id]);const A=async F=>{m(F);try{await Tc(tt(De,"user_sessions",F)),a(q=>q.filter(W=>W.id!==F)),"vibrate"in navigator&&navigator.vibrate(20)}catch(q){console.error("[DevicesSettings] Revoke error:",q)}finally{m(null)}},O=async()=>{R();const F=r.filter(q=>!q.isCurrent);for(const q of F)try{await Tc(tt(De,"user_sessions",q.id))}catch(W){console.error("[DevicesSettings] Revoke error:",W)}a(q=>q.filter(W=>W.isCurrent)),w(!1),"vibrate"in navigator&&navigator.vibrate([20,50,20])},U=r.filter(F=>!F.isCurrent).length;return c.jsxs("div",{className:"min-h-screen",style:{background:Qs.dark.bg.primary},children:[c.jsx("div",{className:"sticky top-0 z-50 px-4 pt-6 pb-4 bg-gradient-to-b from-[#0A0A0B] to-transparent backdrop-blur-lg",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("button",{onClick:()=>t(-1),className:"w-10 h-10 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center hover:bg-white/10 transition-colors",children:c.jsx(dd,{size:20,className:"text-white"})}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-xl font-bold text-white",children:"Verknpfte Gerte"}),c.jsxs("p",{className:"text-sm text-gray-500",children:[r.length," ",r.length===1?"Gert":"Gerte"," aktiv"]})]})]})}),c.jsxs("div",{className:"px-4 pb-32 space-y-6",children:[c.jsxs("div",{className:"rounded-2xl p-4 border flex items-start gap-4",style:{background:Qs.dark.bg.secondary,borderColor:Qs.dark.border.default},children:[c.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center flex-shrink-0",children:c.jsx(cs,{size:20,className:"text-blue-400"})}),c.jsxs("div",{children:[c.jsx("h3",{className:"font-semibold text-white mb-1",children:"Sicherheitsbersicht"}),c.jsx("p",{className:"text-sm text-gray-400",children:"Hier siehst du alle Gerte, auf denen dein synclulu-Account aktiv ist. Entferne unbekannte Gerte sofort."})]})]}),l?c.jsx("div",{className:"flex items-center justify-center py-16",children:c.jsx("div",{className:"w-10 h-10 border-4 border-purple-500 border-t-transparent rounded-full animate-spin"})}):c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"space-y-3",children:r.map(F=>c.jsx(zGe,{device:F,onRevoke:()=>A(F.id),isRevoking:p===F.id},F.id))}),U>0&&c.jsx("div",{className:"pt-4",children:v?c.jsxs("div",{className:"rounded-2xl p-4 border",style:{background:"rgba(239, 68, 68, 0.1)",borderColor:"rgba(239, 68, 68, 0.2)"},children:[c.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[c.jsx(rh,{size:20,className:"text-red-400 flex-shrink-0 mt-0.5"}),c.jsxs("div",{children:[c.jsx("h3",{className:"font-semibold text-white mb-1",children:"Alle anderen Gerte abmelden?"}),c.jsxs("p",{className:"text-sm text-gray-400",children:["Du wirst auf ",U," anderen"," ",U===1?"Gert":"Gerten"," abgemeldet."]})]})]}),c.jsxs("div",{className:"flex gap-3",children:[c.jsx("button",{onClick:O,className:"flex-1 py-3 rounded-xl bg-red-500 text-white font-semibold hover:bg-red-600 transition-colors",children:"Ja, alle abmelden"}),c.jsx("button",{onClick:()=>w(!1),className:"flex-1 py-3 rounded-xl bg-white/10 text-white font-semibold hover:bg-white/20 transition-colors",children:"Abbrechen"})]})]}):c.jsxs("button",{onClick:()=>w(!0),className:"w-full py-4 rounded-xl bg-red-500/10 border border-red-500/20 text-red-400 font-semibold flex items-center justify-center gap-2 hover:bg-red-500/20 transition-colors",children:[c.jsx(Lm,{size:18}),"Alle anderen Gerte abmelden"]})})]})]})]})};async function WGe(t,e=20){try{const r=mn(De,"safety_score_history"),a=Mr(r,Kn("userId","==",t),ih("createdAt","desc"),up(e));return(await Cr(a)).docs.map(u=>{var m;const p=u.data();return{id:u.id,userId:p.userId,previousScore:p.previousScore,newScore:p.newScore,change:p.changeAmount,reason:p.reason,source:p.source,incidentId:p.incidentId,createdAt:((m=p.createdAt)==null?void 0:m.toDate())||new Date}})}catch(r){return console.error("Error fetching score history:",r),[]}}const HGe=({metrics:t})=>{const e=[{label:"Safety",value:t.safetyScore,color:"#22C55E"},{label:"Interaktion",value:t.interactionScore,color:"#A855F7"},{label:"Zuverlssig",value:t.reliabilityScore,color:"#3B82F6"},{label:"Community",value:t.communityScore,color:"#EC4899"},{label:"Verifiziert",value:t.verificationLevel,color:"#F59E0B"}],r=150,a=150,l=100,u=5,p=2*Math.PI/e.length,m=e.map((w,R)=>{const C=R*p-Math.PI/2,A=w.value/100*l;return{x:r+A*Math.cos(C),y:a+A*Math.sin(C)}}),v=m.map((w,R)=>`${R===0?"M":"L"} ${w.x} ${w.y}`).join(" ")+" Z";return c.jsx("div",{className:"relative",children:c.jsxs("svg",{width:"300",height:"300",viewBox:"0 0 300 300",className:"mx-auto",children:[[...Array(u)].map((w,R)=>c.jsx("circle",{cx:r,cy:a,r:l/u*(R+1),fill:"none",stroke:"rgba(255,255,255,0.1)",strokeWidth:"1"},R)),e.map((w,R)=>{const C=R*p-Math.PI/2,A=r+l*Math.cos(C),O=a+l*Math.sin(C);return c.jsx("line",{x1:r,y1:a,x2:A,y2:O,stroke:"rgba(255,255,255,0.1)",strokeWidth:"1"},R)}),c.jsx(Ne.path,{d:v,fill:"url(#trustGradient)",stroke:"#A855F7",strokeWidth:"2",initial:{opacity:0,scale:.5},animate:{opacity:.8,scale:1},transition:{duration:.8,ease:"easeOut"}}),c.jsx("defs",{children:c.jsxs("linearGradient",{id:"trustGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[c.jsx("stop",{offset:"0%",stopColor:"#A855F7",stopOpacity:"0.4"}),c.jsx("stop",{offset:"100%",stopColor:"#EC4899",stopOpacity:"0.4"})]})}),m.map((w,R)=>c.jsx(Ne.circle,{cx:w.x,cy:w.y,r:"6",fill:e[R].color,initial:{scale:0},animate:{scale:1},transition:{delay:.1*R,duration:.3}},R)),e.map((w,R)=>{const C=R*p-Math.PI/2,A=l+30,O=r+A*Math.cos(C),U=a+A*Math.sin(C);return c.jsxs("g",{children:[c.jsx("text",{x:O,y:U,textAnchor:"middle",dominantBaseline:"middle",className:"text-xs fill-white/70 font-medium",children:w.label}),c.jsxs("text",{x:O,y:U+14,textAnchor:"middle",dominantBaseline:"middle",className:"text-xs fill-white/50",children:[w.value,"%"]})]},R)})]})})},KGe=({score:t,rank:e})=>{const a=t>=95?{color:"from-emerald-400 to-green-500",label:"Vertrauenswrdig",icon:""}:t>=80?{color:"from-purple-400 to-violet-500",label:"Zuverlssig",icon:""}:t>=60?{color:"from-blue-400 to-cyan-500",label:"Aktiv",icon:""}:{color:"from-gray-400 to-gray-500",label:"Neu",icon:""};return c.jsxs(Ne.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:`relative inline-flex items-center gap-2 px-4 py-2 rounded-2xl bg-gradient-to-r ${a.color} shadow-lg`,children:[c.jsx("span",{className:"text-xl",children:a.icon}),c.jsxs("div",{children:[c.jsx("p",{className:"text-white font-bold text-sm",children:a.label}),c.jsxs("p",{className:"text-white/80 text-xs",children:["Trust Score: ",t]})]}),c.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-white rounded-full flex items-center justify-center shadow",children:c.jsx(BC,{size:12,className:"text-green-500"})})]})},qGe=()=>{const t=yr(),{user:e}=Jr(),[r,a]=V.useState(null),[l,u]=V.useState(null),[p,m]=V.useState([]),[v,w]=V.useState(!0),[R,C]=V.useState(!1);V.useEffect(()=>{e!=null&&e.id&&A()},[e==null?void 0:e.id]);const A=async()=>{var F;if(e!=null&&e.id){w(!0);try{const q=tt(De,"user_safety_profiles",e.id),W=await Bn(q),H=tt(De,"users",e.id),X=await Bn(H),ne=W.data()||{},te=X.data()||{},he=ne.safetyScore||100,J=te.totalInteractions||0,Q=te.roomsJoined||0,ce=te.friendsCount||0,de=((F=te.createdAt)==null?void 0:F.toDate())||new Date,pe=Math.floor((Date.now()-de.getTime())/(1e3*60*60*24));a({safetyScore:he,interactionScore:Math.min(100,Math.floor(J/10)),reliabilityScore:Math.min(100,Math.floor(Q*2)),communityScore:Math.min(100,Math.floor(ce*5)),verificationLevel:te.isVerified?100:te.emailVerified?50:0,accountAge:pe});const be=Math.min(99,Math.floor(J/5));let ye="newcomer";J>=1e3?ye="legend":J>=500?ye="veteran":J>=100?ye="regular":J>=20&&(ye="active"),u({totalInteractions:J,rank:ye,percentile:be});const Ze=await WGe(e.id,10);m(Ze)}catch(q){console.error("Error loading trust data:",q)}w(!1)}},O=async()=>{if(!r)return;const F=` Mein Trust Score bei synclulu: ${r.safetyScore}/100
 Rank: ${(l==null?void 0:l.rank)||"Newcomer"}

Join me: https://synclulu.app`;if(navigator.share)try{await navigator.share({title:"Mein synclulu Trust Badge",text:F})}catch{}else navigator.clipboard.writeText(F),C(!0),setTimeout(()=>C(!1),2e3)},U=F=>{switch(F){case"legend":return{label:"Legende",icon:"",color:"text-amber-400"};case"veteran":return{label:"Veteran",icon:"",color:"text-purple-400"};case"regular":return{label:"Stammgast",icon:"",color:"text-blue-400"};case"active":return{label:"Aktiv",icon:"",color:"text-green-400"};default:return{label:"Newcomer",icon:"",color:"text-gray-400"}}};return v?c.jsx("div",{className:"min-h-screen bg-dark-base flex items-center justify-center",children:c.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-purple-500 border-t-transparent rounded-full"})}):c.jsxs("div",{className:"min-h-screen bg-dark-base text-white safe-top pb-24",children:[c.jsx("div",{className:"sticky top-0 z-10 bg-dark-base/90 backdrop-blur-xl border-b border-white/10",children:c.jsxs("div",{className:"flex items-center justify-between p-4",children:[c.jsx("button",{onClick:()=>t(-1),className:"w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center",children:c.jsx(dd,{size:20})}),c.jsx("h1",{className:"font-display font-bold text-lg",children:"Trust Stats"}),c.jsx("button",{onClick:O,className:"w-10 h-10 rounded-xl bg-purple-500/20 flex items-center justify-center text-purple-400",children:c.jsx(GL,{size:20})})]})}),c.jsxs("div",{className:"p-4 space-y-6",children:[r&&l&&c.jsx("div",{className:"text-center",children:c.jsx(KGe,{score:r.safetyScore,rank:l.rank})}),r&&c.jsxs("div",{className:"bg-dark-card rounded-3xl p-6",children:[c.jsxs("h2",{className:"font-semibold text-center mb-4 flex items-center justify-center gap-2",children:[c.jsx(cs,{size:18,className:"text-purple-400"}),"Trust Radar"]}),c.jsx(HGe,{metrics:r})]}),l&&c.jsxs("div",{className:"bg-dark-card rounded-3xl p-6",children:[c.jsxs("h2",{className:"font-semibold mb-4 flex items-center gap-2",children:[c.jsx(gv,{size:18,className:"text-amber-400"}),"Interaktions-Ranking"]}),c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("span",{className:"text-3xl",children:U(l.rank).icon}),c.jsxs("div",{children:[c.jsx("p",{className:`font-bold ${U(l.rank).color}`,children:U(l.rank).label}),c.jsxs("p",{className:"text-sm text-white/50",children:["Top ",100-l.percentile,"% der Nutzer"]})]})]}),c.jsxs("div",{className:"text-right",children:[c.jsx("p",{className:"text-2xl font-bold text-purple-400",children:l.totalInteractions}),c.jsx("p",{className:"text-xs text-white/50",children:"Interaktionen"})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex justify-between text-xs text-white/50",children:[c.jsx("span",{children:"Fortschritt zum nchsten Rang"}),c.jsxs("span",{children:[l.totalInteractions," / 100"]})]}),c.jsx("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden",children:c.jsx(Ne.div,{className:"h-full bg-gradient-to-r from-purple-500 to-pink-500",initial:{width:0},animate:{width:`${Math.min(100,l.totalInteractions)}%`},transition:{duration:1}})})]})]}),r&&c.jsxs("div",{className:"bg-dark-card rounded-3xl p-6",children:[c.jsxs("h2",{className:"font-semibold mb-4 flex items-center gap-2",children:[c.jsx(fd,{size:18,className:"text-green-400"}),"Score Details"]}),c.jsxs("div",{className:"space-y-4",children:[c.jsx(sC,{icon:c.jsx(cs,{size:16,className:"text-green-400"}),label:"Safety Score",value:r.safetyScore,description:"Basiert auf deinem Verhalten"}),c.jsx(sC,{icon:c.jsx(hp,{size:16,className:"text-purple-400"}),label:"Interaktion",value:r.interactionScore,description:"Aktive Teilnahme"}),c.jsx(sC,{icon:c.jsx(Ua,{size:16,className:"text-blue-400"}),label:"Zuverlssigkeit",value:r.reliabilityScore,description:"Raum-Besuche"}),c.jsx(sC,{icon:c.jsx(xpe,{size:16,className:"text-pink-400"}),label:"Community",value:r.communityScore,description:"Freundschaften"}),c.jsx(sC,{icon:c.jsx(BC,{size:16,className:"text-amber-400"}),label:"Verifizierung",value:r.verificationLevel,description:r.verificationLevel===100?"Verifiziert":"Nicht verifiziert"})]})]}),p.length>0&&c.jsxs("div",{className:"bg-dark-card rounded-3xl p-6",children:[c.jsxs("h2",{className:"font-semibold mb-4 flex items-center gap-2",children:[c.jsx(ap,{size:18,className:"text-blue-400"}),"Score-Verlauf"]}),c.jsx("div",{className:"space-y-3",children:p.map(F=>c.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-xl",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[F.change>0?c.jsx("div",{className:"w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center",children:c.jsx(fd,{size:16,className:"text-green-400"})}):c.jsx("div",{className:"w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center",children:c.jsx(rh,{size:16,className:"text-red-400"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium",children:F.reason}),c.jsx("p",{className:"text-xs text-white/50",children:F.createdAt.toLocaleDateString("de-DE")})]})]}),c.jsxs("div",{className:`font-bold ${F.change>0?"text-green-400":"text-red-400"}`,children:[F.change>0?"+":"",F.change]})]},F.id))})]}),r&&c.jsxs("div",{className:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-3xl p-6 text-center",children:[c.jsx(ap,{size:24,className:"mx-auto mb-2 text-purple-400"}),c.jsxs("p",{className:"text-2xl font-bold",children:[r.accountAge," Tage"]}),c.jsx("p",{className:"text-sm text-white/60",children:"bei synclulu"})]})]}),c.jsx(Ur,{children:R&&c.jsx(Ne.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:50},className:"fixed bottom-24 left-4 right-4 bg-green-500 text-white p-4 rounded-2xl text-center font-semibold",children:" In Zwischenablage kopiert!"})})]})},sC=({icon:t,label:e,value:r,description:a})=>c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center",children:t}),c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:"flex justify-between items-center mb-1",children:[c.jsx("p",{className:"text-sm font-medium",children:e}),c.jsxs("p",{className:"text-sm font-bold",children:[r,"%"]})]}),c.jsx("div",{className:"h-1.5 bg-white/10 rounded-full overflow-hidden",children:c.jsx(Ne.div,{className:"h-full bg-gradient-to-r from-purple-500 to-pink-500",initial:{width:0},animate:{width:`${r}%`},transition:{duration:.5}})}),c.jsx("p",{className:"text-xs text-white/40 mt-1",children:a})]})]}),YGe="MIbamchs82Ve7y0ecX2TpPyymbw1",$Ge=t=>t>=30?"text-purple-500 bg-purple-500/10":t>=14?"text-orange-500 bg-orange-500/10":t>=7?"text-amber-500 bg-amber-500/10":"text-red-400 bg-red-400/10";function YC(t="light"){if(typeof navigator<"u"&&navigator.vibrate){const e={light:10,medium:25,heavy:50};navigator.vibrate(e[t])}}const Tae=({friend:t,index:e,onSelect:r,onMessage:a})=>{const l=$Ge(t.streakCount);return c.jsx(Ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:e*.05},className:"bg-[var(--synclulu-card)] rounded-2xl p-4 border border-[var(--synclulu-border)] shadow-sm hover:shadow-md transition-all",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsxs("button",{onClick:()=>{YC("light"),r()},className:"relative",children:[c.jsx("div",{className:"w-14 h-14 rounded-full overflow-hidden bg-gradient-to-br from-purple-500 to-pink-500",children:t.avatarUrl?c.jsx("img",{src:t.avatarUrl,alt:t.username,className:"w-full h-full object-cover"}):c.jsx("div",{className:"w-full h-full flex items-center justify-center text-white text-xl font-bold",children:(t.displayName||t.username).charAt(0).toUpperCase()})}),t.isActive&&c.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 bg-green-500 rounded-full border-2 border-[var(--synclulu-bg)]"}),t.isFounder&&c.jsx("div",{className:"absolute -top-1 -right-1 text-sm",children:""})]}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"font-semibold text-[var(--synclulu-text)] truncate",children:t.displayName||t.username}),t.isVerified&&c.jsx("span",{className:"text-emerald-500 text-xs",children:""})]}),c.jsxs("div",{className:"text-xs text-[var(--synclulu-muted)]",children:["@",t.username]})]}),t.streakCount>0&&c.jsxs("div",{className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full ${l}`,children:[c.jsx(BL,{size:14}),c.jsx("span",{className:"text-sm font-bold",children:t.streakCount})]}),c.jsx("button",{onClick:()=>{YC("light"),a()},className:"w-10 h-10 rounded-xl bg-[var(--synclulu-surface)] flex items-center justify-center hover:bg-purple-500/10 transition-colors",children:c.jsx(hp,{size:18,className:"text-[var(--synclulu-muted)]"})})]})})},XGe=()=>{const t=yr(),{user:e}=Jr(),[r,a]=V.useState([]),[l,u]=V.useState(!0),[p,m]=V.useState("");V.useEffect(()=>{async function A(){var O,U;if(e!=null&&e.id){u(!0);try{const F=Mr(mn(De,"friendships"),Kn("userIds","array-contains",e.id),Kn("status","==","accepted"),up(100)),q=await Cr(F),W=[],H={};q.docs.forEach(ne=>{var J;const te=ne.data(),he=te.userIds.find(Q=>Q!==e.id);he&&(W.push(he),H[he]={streakCount:te.streakCount||0,lastInteraction:(J=te.lastInteraction)==null?void 0:J.toDate()})});const X=[];for(const ne of W.slice(0,50))try{const te=await Bn(tt(De,"users",ne));if(te.exists()){const he=te.data();X.push({id:ne,username:he.username||"User",displayName:he.displayName,avatarUrl:he.photoURL||he.avatarUrl,isActive:he.isOnline||!1,streakCount:((O=H[ne])==null?void 0:O.streakCount)||0,lastInteraction:(U=H[ne])==null?void 0:U.lastInteraction,isFounder:ne===YGe,isVerified:he.isVerified||!1})}}catch(te){console.error("[Friends] Error fetching friend:",ne,te)}X.sort((ne,te)=>ne.isActive!==te.isActive?ne.isActive?-1:1:te.streakCount-ne.streakCount),a(X)}catch(F){console.error("[Friends] Error fetching friends:",F)}finally{u(!1)}}}A()},[e==null?void 0:e.id]);const v=r.filter(A=>{var O;return A.username.toLowerCase().includes(p.toLowerCase())||((O=A.displayName)==null?void 0:O.toLowerCase().includes(p.toLowerCase()))}),w=r.filter(A=>A.isActive).length,R=V.useCallback(A=>{t(`/user/${A}`)},[t]),C=V.useCallback(A=>{t(`/messages?userId=${A}`)},[t]);return c.jsxs("div",{className:"min-h-screen page-gradient theme-transition pb-24",children:[c.jsxs("div",{className:"px-4 pt-6 pb-4",children:[c.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[c.jsx("button",{onClick:()=>{YC("light"),t("/profile")},className:"w-10 h-10 rounded-xl bg-[var(--glass-bg)] backdrop-blur-sm border border-[var(--synclulu-border)] flex items-center justify-center hover:bg-[var(--synclulu-soft)] transition-colors",children:c.jsx(dd,{size:20,className:"text-[var(--synclulu-muted)]"})}),c.jsxs("div",{children:[c.jsx("h1",{className:"font-display text-2xl font-bold text-[var(--synclulu-text)]",children:"Deine Aura"}),c.jsxs("p",{className:"text-xs text-[var(--synclulu-muted)]",children:[r.length," Freunde  ",w," online"]})]})]}),c.jsxs("div",{className:"relative mb-4",children:[c.jsx(xw,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-[var(--synclulu-muted)]"}),c.jsx("input",{type:"text",value:p,onChange:A=>m(A.target.value),placeholder:"Freunde suchen...",className:"w-full pl-11 pr-4 py-3 rounded-2xl bg-[var(--synclulu-surface)] border border-[var(--synclulu-border)] text-[var(--synclulu-text)] placeholder:text-[var(--synclulu-muted)] focus:outline-none focus:border-purple-500/50 transition-colors"})]}),c.jsxs("div",{className:"flex gap-2 mb-6",children:[c.jsxs("button",{onClick:()=>{YC("light"),t("/invites")},className:"flex-1 flex items-center justify-center gap-2 py-3 rounded-xl bg-gradient-to-r from-violet-500 to-purple-600 text-white font-semibold text-sm shadow-lg shadow-purple-500/30",children:[c.jsx(op,{size:18}),c.jsx("span",{children:"Freunde einladen"})]}),c.jsx("button",{onClick:()=>{YC("light")},className:"w-12 h-12 rounded-xl bg-[var(--synclulu-surface)] border border-[var(--synclulu-border)] flex items-center justify-center hover:bg-purple-500/10 transition-colors",children:c.jsx(cr,{size:20,className:"text-[var(--synclulu-muted)]"})})]})]}),c.jsx("div",{className:"px-4",children:l?c.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[c.jsx("div",{className:"w-12 h-12 rounded-full border-2 border-purple-500 border-t-transparent animate-spin mb-4"}),c.jsx("p",{className:"text-sm text-[var(--synclulu-muted)]",children:"Lade Freunde..."})]}):v.length===0?c.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[c.jsx("div",{className:"w-16 h-16 rounded-full bg-purple-500/10 flex items-center justify-center mb-4",children:c.jsx(cr,{size:32,className:"text-purple-500"})}),c.jsx("h3",{className:"font-semibold text-[var(--synclulu-text)] mb-2",children:p?"Keine Treffer":"Noch keine Freunde"}),c.jsx("p",{className:"text-sm text-[var(--synclulu-muted)] max-w-xs",children:p?"Versuche einen anderen Suchbegriff":"Lade Freunde ein und baut gemeinsam eure Streaks auf!"}),!p&&c.jsx("button",{onClick:()=>t("/invites"),className:"mt-6 px-6 py-3 rounded-xl bg-gradient-to-r from-violet-500 to-purple-600 text-white font-semibold text-sm shadow-lg shadow-purple-500/30",children:"Freunde einladen"})]}):c.jsxs("div",{className:"space-y-3",children:[v.some(A=>A.streakCount>0&&A.streakCount<=1)&&c.jsxs("div",{className:"mb-6",children:[c.jsxs("h3",{className:"text-xs font-bold text-amber-500 uppercase tracking-wider mb-3 flex items-center gap-2",children:[c.jsx(BL,{size:14}),"Streak gefhrdet"]}),v.filter(A=>A.streakCount>0&&A.streakCount<=1).map((A,O)=>c.jsx(Tae,{friend:A,index:O,onSelect:()=>R(A.id),onMessage:()=>C(A.id)},A.id))]}),c.jsx(Ur,{children:v.filter(A=>A.streakCount===0||A.streakCount>1).map((A,O)=>c.jsx(Tae,{friend:A,index:O,onSelect:()=>R(A.id),onMessage:()=>C(A.id)},A.id))})]})})]})};function $z(t){if(t<60)return`${t} Min`;const e=Math.floor(t/60),r=t%60;return r===0?`${e} Std`:`${e}h ${r}m`}function JGe(t){const e=new Date,r=new Date(e);return r.setDate(r.getDate()-1),t.toDateString()===e.toDateString()?"Heute":t.toDateString()===r.toDateString()?"Gestern":t.toLocaleDateString("de-DE",{weekday:"long",day:"numeric",month:"long"})}function QGe(t){return t.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})}function ZGe(t){const e={};return t.forEach(r=>{const a=r.visitedAt.toDateString();e[a]||(e[a]={date:a,totalMinutes:0,roomCount:0,visits:[]}),e[a].totalMinutes+=r.duration,e[a].roomCount+=1,e[a].visits.push(r)}),Object.values(e).sort((r,a)=>new Date(a.date).getTime()-new Date(r.date).getTime())}const K2=({icon:t,value:e,label:r,color:a})=>c.jsxs(Ne.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100",children:[c.jsx("div",{className:`w-10 h-10 rounded-xl ${a} flex items-center justify-center mb-3`,children:c.jsx(t,{size:20,className:"text-white"})}),c.jsx("p",{className:"text-2xl font-bold text-gray-800",children:e}),c.jsx("p",{className:"text-xs text-gray-500 mt-1",children:r})]}),eWe=({visit:t,index:e,onRoomClick:r})=>c.jsxs(Ne.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:e*.05},onClick:()=>r(t.roomId),className:"w-full flex items-center gap-3 p-3 bg-white rounded-xl shadow-sm border border-gray-100 hover:border-violet-200 transition-colors",children:[c.jsxs("div",{className:"flex flex-col items-center",children:[c.jsx("div",{className:"w-3 h-3 rounded-full bg-violet-500"}),e<10&&c.jsx("div",{className:"w-0.5 h-8 bg-gray-200 -mb-4"})]}),c.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-violet-100 to-purple-100 flex items-center justify-center flex-shrink-0",children:c.jsx(Xo,{size:22,className:"text-violet-500"})}),c.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[c.jsx("p",{className:"text-sm font-semibold text-gray-800 truncate",children:t.roomName}),c.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[c.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[c.jsx(Ua,{size:10}),QGe(t.visitedAt)]}),c.jsxs("span",{className:"text-xs text-violet-600 font-medium flex items-center gap-1",children:[c.jsx(Qo,{size:10}),t.duration," Min"]}),t.participantCount&&c.jsxs("span",{className:"text-xs text-gray-400 flex items-center gap-1",children:[c.jsx(cr,{size:10}),t.participantCount]})]})]}),c.jsx(Fi,{size:16,className:"text-gray-300"})]}),tWe=({stats:t,onRoomClick:e})=>c.jsxs("div",{className:"mb-6",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3 px-1",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(ap,{size:14,className:"text-gray-400"}),c.jsx("span",{className:"text-sm font-semibold text-gray-700",children:JGe(new Date(t.date))})]}),c.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[c.jsxs("span",{className:"flex items-center gap-1",children:[c.jsx(Qo,{size:10,className:"text-violet-500"}),$z(t.totalMinutes)]}),c.jsxs("span",{className:"flex items-center gap-1",children:[c.jsx(Xo,{size:10,className:"text-purple-500"}),t.roomCount," Rume"]})]})]}),c.jsx("div",{className:"space-y-2",children:t.visits.map((r,a)=>c.jsx(eWe,{visit:r,index:a,onRoomClick:e},r.id))})]});function nWe(){const t=yr(),{user:e}=qv(),[r,a]=V.useState([]),[l,u]=V.useState({totalVoiceMinutes:0,roomsVisited:0,totalSessions:0,longestSession:0}),[p,m]=V.useState(!0);V.useEffect(()=>{if(!(e!=null&&e.uid))return;const R=tt(De,"users",e.uid),C=na(R,A=>{if(A.exists()){const O=A.data();u({totalVoiceMinutes:O.totalVoiceMinutes||O.voice_minutes||0,roomsVisited:O.roomsVisited||O.rooms_visited||0,totalSessions:O.totalSessions||O.total_sessions||0,longestSession:O.longestSession||0,favoriteRoom:O.favoriteRoom})}});return()=>C()},[e==null?void 0:e.uid]),V.useEffect(()=>{async function R(){if(!(e!=null&&e.uid)){m(!1);return}try{const C=Mr(mn(De,"room_visits"),Kn("userId","==",e.uid),ih("visitedAt","desc"),up(50)),O=(await Cr(C)).docs.map(U=>{var q;const F=U.data();return{id:U.id,roomId:F.roomId||U.id,roomName:F.roomName||"Unbenanntes Wlkchen",visitedAt:((q=F.visitedAt)==null?void 0:q.toDate())||new Date,duration:F.duration||0,participantCount:F.participantCount,location:F.location}});a(O)}catch(C){console.error("Error fetching room visits:",C)}finally{m(!1)}}R()},[e==null?void 0:e.uid]);const v=V.useMemo(()=>ZGe(r),[r]),w=R=>{t(`/room/${R}`)};return c.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-violet-50 to-white pb-24",children:[c.jsx("div",{className:"sticky top-0 z-50 bg-white/80 backdrop-blur-xl border-b border-gray-100",children:c.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[c.jsx("button",{onClick:()=>t(-1),className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:c.jsx(Eo,{size:20,className:"text-gray-600"})}),c.jsx("h1",{className:"text-lg font-bold text-gray-800",children:"Voice-Statistiken"}),c.jsx("div",{className:"w-10"})]})}),c.jsxs("div",{className:"px-4 py-6",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[c.jsx(K2,{icon:Qo,value:$z(l.totalVoiceMinutes),label:"Gesamte Voice-Zeit",color:"bg-gradient-to-br from-violet-500 to-purple-600"}),c.jsx(K2,{icon:Xo,value:l.roomsVisited,label:"Besuchte Wlkchen",color:"bg-gradient-to-br from-purple-500 to-pink-500"}),c.jsx(K2,{icon:fd,value:l.totalSessions,label:"Sessions",color:"bg-gradient-to-br from-emerald-500 to-teal-500"}),c.jsx(K2,{icon:G5e,value:$z(l.longestSession),label:"Lngste Session",color:"bg-gradient-to-br from-amber-500 to-orange-500"})]}),c.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[c.jsx(kn,{size:16,className:"text-violet-500"}),c.jsx("h2",{className:"text-sm font-bold text-gray-800",children:"Aktivittsverlauf"})]}),p&&c.jsx("div",{className:"space-y-4",children:[1,2,3].map(R=>c.jsxs("div",{className:"animate-pulse",children:[c.jsx("div",{className:"h-4 w-24 bg-gray-200 rounded mb-2"}),c.jsx("div",{className:"h-16 bg-gray-100 rounded-xl"})]},R))}),!p&&r.length===0&&c.jsxs(Ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-2xl p-8 text-center shadow-sm border border-gray-100",children:[c.jsx("div",{className:"w-16 h-16 rounded-full bg-violet-100 flex items-center justify-center mx-auto mb-4",children:c.jsx(Qo,{size:28,className:"text-violet-400"})}),c.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Noch keine Aktivitt"}),c.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Tritt einem Wlkchen bei, um deine Voice-Geschichte zu starten."}),c.jsx("button",{onClick:()=>t("/discover"),className:"px-6 py-3 bg-gradient-to-r from-violet-500 to-purple-600 text-white font-medium rounded-xl",children:"Wlkchen entdecken"})]}),!p&&v.length>0&&c.jsx("div",{children:v.map(R=>c.jsx(tWe,{stats:R,onRoomClick:w},R.date))})]})]})}function PB(t="light"){if(typeof navigator<"u"&&navigator.vibrate){const e={light:10,medium:25,heavy:50};navigator.vibrate(e[t])}}const Age=V.memo(({isOpen:t,onClose:e,onSearch:r,onCreate:a})=>{const l=V.useCallback(()=>{PB("medium"),r(),e()},[r,e]);V.useCallback(()=>{PB("medium"),a(),e()},[a,e]);const u=V.useCallback(()=>{PB("light"),e()},[e]);return c.jsx(Ur,{children:t&&c.jsxs(c.Fragment,{children:[c.jsx(Ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},onClick:u,className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[150]",style:{WebkitBackdropFilter:"blur(8px)"}}),c.jsx(Ne.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:25,stiffness:200},className:"fixed bottom-0 left-0 right-0 z-[160]",children:c.jsxs("div",{className:"mx-4 mb-4 rounded-[32px] overflow-hidden",style:{background:"rgba(15, 15, 15, 0.95)",backdropFilter:"blur(40px) saturate(180%)",WebkitBackdropFilter:"blur(40px) saturate(180%)",border:"1px solid rgba(255, 255, 255, 0.08)",boxShadow:"0 -10px 40px rgba(0, 0, 0, 0.5)"},children:[c.jsx("div",{className:"flex justify-center pt-4 pb-2",children:c.jsx("div",{className:"w-12 h-1.5 rounded-full bg-white/10"})}),c.jsxs("div",{className:"p-6 pt-2 space-y-4",children:[c.jsx("h3",{className:"text-center text-xs font-bold uppercase tracking-[0.3em] text-white/40 mb-6",children:"Wlkchen Optionen"}),c.jsxs(Ne.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:l,className:"w-full py-6 rounded-2xl flex flex-col items-center gap-3 transition-all",style:{background:"linear-gradient(135deg, rgba(124, 58, 237, 0.2) 0%, rgba(168, 85, 247, 0.15) 100%)",border:"1px solid rgba(124, 58, 237, 0.4)",boxShadow:"0 4px 20px rgba(124, 58, 237, 0.2)"},children:[c.jsx("span",{className:"text-4xl",children:""}),c.jsx("span",{className:"text-[12px] font-black tracking-[0.15em] uppercase text-purple-400",children:"Wlkchen entdecken"}),c.jsx("span",{className:"text-[10px] text-white/40",children:"Finde Rume und Leute in deiner Nhe"})]}),c.jsx(Ne.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:u,className:"w-full py-4 rounded-2xl text-[11px] font-bold uppercase tracking-widest text-white/40 hover:text-white/60 transition-colors",children:"Abbrechen"})]}),c.jsx("div",{className:"h-6"})]})})]})})});Age.displayName="CloudActionMenu";const rWe=()=>{const t=yr();dp();const{user:e}=qv(),[r,a]=V.useState(!1),[l,u]=V.useState(0),[p,m]=V.useState(!1);BFe(l,{stiffness:50,damping:20,mass:.5}),V.useEffect(()=>{if(!(e!=null&&e.uid))return;const U=na(tt(De,"users",e.uid),F=>{if(F.exists()){const H=(F.data().auraScore||0)%100;H<l&&l>90&&(m(!0),"vibrate"in navigator&&navigator.vibrate([50,30,50,30,100]),setTimeout(()=>m(!1),2e3)),u(H)}});return()=>U()},[e==null?void 0:e.uid,l]);const v=V.useCallback(()=>{"vibrate"in navigator&&navigator.vibrate([10,5,10])},[]),w=V.useCallback(()=>{v(),a(!0)},[v]),R=V.useCallback(()=>{t("/discover")},[t]),C=V.useCallback(()=>{t("/create-room")},[t]),A=[{to:"/",icon:wW,label:"Home"},{to:"/discover",icon:$m,label:"Entdecken"}],O=[{to:"/messages",icon:hp,label:"Chat"},{to:"/profile",icon:md,label:"Profil"}];return c.jsxs(c.Fragment,{children:[c.jsx(Age,{isOpen:r,onClose:()=>a(!1),onSearch:R,onCreate:C}),c.jsx("div",{className:"fixed left-1/2 -translate-x-1/2 pointer-events-auto",style:{bottom:56,zIndex:100},children:c.jsxs(Ne.button,{onClick:w,whileTap:{scale:.9},className:"relative w-16 h-16 cursor-pointer touch-manipulation",type:"button","aria-label":"Open action menu",children:[c.jsx(Ne.div,{className:"absolute inset-0 rounded-full pointer-events-none",style:{background:"radial-gradient(circle, rgba(139, 92, 246, 0.5) 0%, transparent 70%)"},animate:{scale:[1,1.6,1],opacity:[.7,0,.7]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}),c.jsx(Ne.div,{className:"absolute inset-0 rounded-full pointer-events-none",style:{background:"linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%)"},animate:{scale:[1,1.2,1],opacity:[.5,0,.5]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}}),c.jsx("div",{className:"relative w-full h-full rounded-full flex items-center justify-center",style:{background:"linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%)",boxShadow:"0 8px 32px rgba(139, 92, 246, 0.6), 0 0 60px rgba(139, 92, 246, 0.4), inset 0 2px 4px rgba(255, 255, 255, 0.2)",border:"3px solid rgba(255, 255, 255, 0.2)"},children:c.jsx(Ew,{size:32,className:"text-white",strokeWidth:2.5})})]})}),c.jsx("div",{className:"fixed bottom-0 left-0 right-0 h-[2px] z-[60] pointer-events-none",style:{background:"rgba(255, 255, 255, 0.03)",transform:"translateZ(0)"},children:c.jsx(Ne.div,{className:"h-full will-change-transform",style:{width:`${l}%`,background:"linear-gradient(90deg, #8B5CF6 0%, #A855F7 50%, #D946EF 100%)",boxShadow:p?"0 0 20px rgba(168, 85, 247, 1), 0 0 40px rgba(217, 70, 239, 0.8)":"0 0 8px rgba(168, 85, 247, 0.6)",transform:"translateZ(0)"},animate:{opacity:p?[1,.5,1]:1},transition:{duration:p?.3:0,repeat:p?3:0}})}),p&&c.jsx(Ne.div,{initial:{opacity:0},animate:{opacity:[0,1,0]},transition:{duration:2},className:"fixed bottom-0 left-0 right-0 h-20 z-[55] pointer-events-none",style:{background:"linear-gradient(to top, rgba(168, 85, 247, 0.3), transparent)",transform:"translateZ(0)"}}),c.jsx("nav",{className:"fixed bottom-0 left-0 right-0 safe-bottom z-50 will-change-transform",style:{background:"rgba(5, 5, 5, 0.9)",backdropFilter:"blur(40px) saturate(180%)",WebkitBackdropFilter:"blur(40px) saturate(180%)",borderTop:"1px solid rgba(255, 255, 255, 0.04)",transform:"translateZ(0)"},children:c.jsxs("div",{className:"flex items-center justify-around h-20 max-w-lg mx-auto px-4",children:[A.map(({to:U,icon:F,label:q})=>c.jsx(hne,{to:U,className:({isActive:W})=>`flex flex-col items-center justify-center gap-1 px-4 py-2 rounded-xl ${W?"text-violet-400":"text-white/40"}`,children:({isActive:W})=>c.jsxs(Ne.div,{className:"flex flex-col items-center gap-1 will-change-transform",whileHover:{scale:1.15,y:-3},whileTap:{scale:.95},transition:{type:"spring",stiffness:400,damping:17},style:{transform:"translateZ(0)"},children:[c.jsxs("div",{className:"relative",style:{filter:W?"drop-shadow(0 0 8px rgba(139, 92, 246, 0.6))":"none"},children:[c.jsx(F,{size:22,strokeWidth:W?2.5:1.5,stroke:"currentColor"}),W&&c.jsx(Ne.div,{layoutId:"nav-indicator-left",className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-1 h-1 bg-violet-400 rounded-full",style:{boxShadow:"0 0 6px rgba(139, 92, 246, 0.6)"}})]}),c.jsx("span",{className:"text-[10px] font-medium",children:q})]})},U)),c.jsx("div",{className:"w-16"}),O.map(({to:U,icon:F,label:q})=>c.jsx(hne,{to:U,className:({isActive:W})=>`flex flex-col items-center justify-center gap-1 px-4 py-2 rounded-xl ${W?"text-violet-400":"text-white/40"}`,children:({isActive:W})=>c.jsxs(Ne.div,{className:"flex flex-col items-center gap-1 will-change-transform",whileHover:{scale:1.15,y:-3},whileTap:{scale:.95},transition:{type:"spring",stiffness:400,damping:17},style:{transform:"translateZ(0)"},children:[c.jsxs("div",{className:"relative",style:{filter:W?"drop-shadow(0 0 8px rgba(139, 92, 246, 0.6))":"none"},children:[c.jsx(F,{size:22,strokeWidth:W?2.5:1.5,stroke:"currentColor"}),W&&c.jsx(Ne.div,{layoutId:"nav-indicator-right",className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-1 h-1 bg-violet-400 rounded-full",style:{boxShadow:"0 0 6px rgba(139, 92, 246, 0.6)"}})]}),c.jsx("span",{className:"text-[10px] font-medium",children:q})]})},U))]})})]})},iWe=()=>c.jsxs("div",{className:"min-h-screen min-h-[100dvh] bg-synclulu-bg flex flex-col items-center justify-center",children:[c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:"w-24 h-24 rounded-3xl bg-gradient-to-br from-synclulu-violet to-synclulu-violet-dark flex items-center justify-center shadow-lg",children:c.jsx("span",{className:"text-4xl",children:""})}),c.jsx("div",{className:"absolute inset-0 rounded-3xl bg-synclulu-violet/30 pulse-ring"})]}),c.jsx("h1",{className:"font-display text-3xl font-bold mt-6 gradient-text",children:"synclulu"}),c.jsx("p",{className:"text-synclulu-muted text-sm mt-2",children:"Wird geladen..."})]}),kge=V.createContext(null),sWe=()=>{const t=V.useContext(kge);if(!t)throw new Error("useNotifications must be used within NotificationProvider");return t},aWe=({children:t})=>{const{user:e}=Jr(),[r,a]=V.useState([]),[l,u]=V.useState(null),[p,m]=V.useState([]);V.useEffect(()=>{if(!(e!=null&&e.id))return;const O=mn(De,"friendRequests"),U=Mr(O,Kn("toId","==",e.id),Kn("status","==","pending")),F=na(U,q=>{q.docChanges().forEach(W=>{var H;if(W.type==="added"){const X=W.doc.data(),ne=((H=X.createdAt)==null?void 0:H.toDate())||new Date;if(Date.now()-ne.getTime()<3e4){const he={id:W.doc.id,type:"friend_request",title:"Neue Freundschaftsanfrage",message:`${X.fromDisplayName||X.fromUsername} mchte dein Freund sein!`,fromUserId:X.fromId,fromUsername:X.fromUsername,fromDisplayName:X.fromDisplayName,createdAt:ne,read:!1};a(J=>[he,...J]),v(he)}}})});return()=>F()},[e==null?void 0:e.id]),V.useEffect(()=>{if(!(e!=null&&e.id))return;const O=mn(De,"friendRequests"),U=Mr(O,Kn("fromId","==",e.id),Kn("status","==","accepted")),F=na(U,q=>{q.docChanges().forEach(W=>{if(W.type==="modified"){const H=W.doc.data(),X={id:`accepted-${W.doc.id}`,type:"friend_accepted",title:"Freundschaft besttigt!",message:`${H.toUsername||"Jemand"} hat deine Anfrage angenommen!`,fromUserId:H.toId,fromUsername:H.toUsername,createdAt:new Date,read:!1};a(ne=>[X,...ne]),v(X)}})});return()=>F()},[e==null?void 0:e.id]),V.useEffect(()=>{if(!(e!=null&&e.id))return;const O=mn(De,"stars"),U=Mr(O,Kn("toUserId","==",e.id)),F=na(U,q=>{q.docChanges().forEach(W=>{var H;if(W.type==="added"){const X=W.doc.data(),ne=((H=X.createdAt)==null?void 0:H.toDate())||new Date;if(Date.now()-ne.getTime()<3e4){const he={id:W.doc.id,type:"star_received",title:" Stern erhalten!",message:`${X.fromDisplayName||"Jemand"} hat dir einen Stern geschenkt!`,fromUserId:X.fromUserId,fromUsername:X.fromUsername,fromDisplayName:X.fromDisplayName,data:{amount:X.amount},createdAt:ne,read:!1};a(J=>[he,...J]),v(he)}}})});return()=>F()},[e==null?void 0:e.id]),V.useEffect(()=>{!l&&p.length>0&&(u(p[0]),m(O=>O.slice(1)))},[l,p]),V.useEffect(()=>{if(l){const O=setTimeout(()=>{u(null)},5e3);return()=>clearTimeout(O)}},[l]);const v=V.useCallback(O=>{const U={id:"id"in O?O.id:`toast-${Date.now()}`,createdAt:"createdAt"in O?O.createdAt:new Date,read:!1,...O};l?m(F=>[...F,U]):u(U),"vibrate"in navigator&&navigator.vibrate([50,30,50])},[l]),w=V.useCallback(()=>{u(null)},[]),R=V.useCallback(O=>{a(U=>U.map(F=>F.id===O?{...F,read:!0}:F))},[]),C=V.useCallback(()=>{a(O=>O.map(U=>({...U,read:!0})))},[]),A=r.filter(O=>!O.read).length;return c.jsx(kge.Provider,{value:{notifications:r,unreadCount:A,showToast:v,markAsRead:R,markAllAsRead:C,clearToast:w,currentToast:l},children:t})},oWe=()=>{const t=yr(),{currentToast:e,clearToast:r,markAsRead:a}=sWe(),[l,u]=V.useState(!1),[p,m]=V.useState(!1);V.useEffect(()=>{e&&(u(!0),m(!1))},[e]);const v=()=>{m(!0),setTimeout(()=>{u(!1),r()},300)},w=()=>{if(e){switch(a(e.id),e.type){case"friend_request":t("/notifications");break;case"friend_accepted":e.fromUserId&&t(`/user/${e.fromUserId}`);break;case"star_received":t("/profile");break;case"room_invite":t("/discover");break;default:t("/notifications")}v()}},R=A=>{switch(A){case"friend_request":return c.jsx(op,{size:24,className:"text-synclulu-violet"});case"friend_accepted":return c.jsx(_r,{size:24,className:"text-green-500"});case"star_received":return c.jsx(Ji,{size:24,className:"text-amber-500"});case"room_invite":return c.jsx(cr,{size:24,className:"text-blue-500"});default:return c.jsx(kl,{size:24,className:"text-synclulu-violet"})}},C=A=>{switch(A){case"friend_request":return"from-purple-500/10 to-pink-500/10 border-purple-200";case"friend_accepted":return"from-green-500/10 to-emerald-500/10 border-green-200";case"star_received":return"from-amber-500/10 to-yellow-500/10 border-amber-200";case"room_invite":return"from-blue-500/10 to-cyan-500/10 border-blue-200";default:return"from-gray-500/10 to-gray-400/10 border-gray-200"}};return!e||!l?null:c.jsxs("div",{className:"fixed top-0 left-0 right-0 z-[100] px-4 pt-safe-top pointer-events-none",children:[c.jsx("div",{className:`mt-4 pointer-events-auto transform transition-all duration-300 ease-out ${p?"translate-y-[-100%] opacity-0":"translate-y-0 opacity-100"}`,children:c.jsxs("div",{onClick:w,className:`bg-gradient-to-r ${C(e.type)} backdrop-blur-lg rounded-2xl p-4 shadow-lg border cursor-pointer active:scale-[0.98] transition-transform`,children:[c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx("div",{className:"w-12 h-12 rounded-xl bg-white shadow-sm flex items-center justify-center flex-shrink-0",children:R(e.type)}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("p",{className:"font-bold text-synclulu-text text-sm",children:e.title}),c.jsx("p",{className:"text-sm text-synclulu-muted mt-0.5 line-clamp-2",children:e.message}),c.jsx("p",{className:"text-xs text-synclulu-violet mt-1 font-medium",children:"Tippe zum Ansehen "})]}),c.jsx("button",{onClick:A=>{A.stopPropagation(),v()},className:"w-8 h-8 rounded-full bg-white/50 flex items-center justify-center text-gray-400 hover:text-gray-600 transition-colors flex-shrink-0",children:c.jsx(Di,{size:16})})]}),c.jsx("div",{className:"mt-3 h-1 bg-white/30 rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full bg-synclulu-violet rounded-full animate-shrink",style:{animationDuration:"5s"}})})]})}),c.jsx("style",{children:`
        @keyframes shrink {
          from { width: 100%; }
          to { width: 0%; }
        }
        .animate-shrink {
          animation: shrink linear forwards;
        }
      `})]})},DB={cyan:{default:{x:[0,-50,40,0],y:[0,30,-40,0],scale:[1,1.05,.95,1]},room:{x:[0,-30,20,0],y:[0,20,-30,0],scale:[1,1.1,.9,1]}},fuchsia:{default:{x:[0,60,-30,0],y:[0,-20,50,0],scale:[1,.9,1.1,1]},room:{x:[0,40,-10,0],y:[0,-10,40,0],scale:[1,.95,1.05,1]}},purple:{default:{x:[0,-20,50,0],y:[0,50,-20,0],rotate:[0,180,360]},room:{x:[0,-20,30,0],y:[0,30,-20,0],rotate:[0,90,180]}}},Pge=V.memo(({intensity:t=1,showCyan:e=!0,showFuchsia:r=!0,showPurple:a=!0,showParticles:l=!0,className:u="",variant:p="default"})=>{const m=t*.1,v=p==="room"?"room":"default",w=V.useMemo(()=>({background:`linear-gradient(
      135deg,
      rgba(168, 85, 247, ${.08*t}) 0%,
      transparent 40%,
      rgba(236, 72, 153, ${.05*t}) 60%,
      transparent 100%
    )`,backgroundSize:"400% 400%"}),[t]),R=V.useMemo(()=>({background:`radial-gradient(
      circle at 50% 50%,
      rgba(168, 85, 247, ${.05*t}) 0%,
      transparent 70%
    )`}),[t]);return c.jsxs("div",{className:`fixed inset-0 z-0 pointer-events-none overflow-hidden ${u}`,"aria-hidden":"true",children:[c.jsx("div",{className:"absolute inset-0 animate-nebula-gradient",style:w}),c.jsx(Ne.div,{className:"absolute inset-0",animate:{scale:[1,1.1,1],opacity:[.1,.2,.1]},transition:{duration:20,repeat:1/0,ease:"easeInOut"},style:R}),e&&c.jsx(Ne.div,{className:"absolute",style:{top:"15%",left:"15%",width:"28rem",height:"28rem",background:`rgba(34, 211, 238, ${m*.5})`,filter:"blur(120px)",borderRadius:"50%"},animate:DB.cyan[v],transition:{duration:20,repeat:1/0,ease:"easeInOut"}}),r&&c.jsx(Ne.div,{className:"absolute",style:{bottom:"20%",right:"15%",width:"24rem",height:"24rem",background:`rgba(232, 121, 249, ${m*.5})`,filter:"blur(120px)",borderRadius:"50%"},animate:DB.fuchsia[v],transition:{duration:25,repeat:1/0,ease:"easeInOut"}}),a&&c.jsx(Ne.div,{className:"absolute",style:{top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"36rem",height:"36rem",background:`rgba(168, 85, 247, ${m*.3})`,filter:"blur(150px)",borderRadius:"50%"},animate:DB.purple[v],transition:{duration:23,repeat:1/0,ease:"easeInOut"}}),p==="room"&&c.jsx(Ne.div,{className:"absolute top-1/4 right-1/4",style:{width:"24rem",height:"24rem",background:`rgba(34, 211, 238, ${m*.6})`,filter:"blur(150px)",borderRadius:"50%"},animate:{opacity:[.3,.6,.3],scale:[1,1.1,1]},transition:{duration:15,repeat:1/0,ease:"easeInOut"}}),l&&c.jsx("div",{className:"absolute inset-0 animate-scroll-particles-v20 opacity-50",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='10' cy='10' r='1' fill='%23A855F7' opacity='0.3'/%3E%3Ccircle cx='30' cy='40' r='0.5' fill='%2322D3EE' opacity='0.4'/%3E%3Ccircle cx='70' cy='20' r='0.8' fill='%23E879F9' opacity='0.3'/%3E%3Ccircle cx='90' cy='60' r='0.6' fill='%23A855F7' opacity='0.4'/%3E%3Ccircle cx='50' cy='80' r='0.7' fill='%2322D3EE' opacity='0.3'/%3E%3Ccircle cx='20' cy='70' r='0.5' fill='%23E879F9' opacity='0.4'/%3E%3Ccircle cx='80' cy='90' r='0.8' fill='%23A855F7' opacity='0.3'/%3E%3C/svg%3E")`,backgroundRepeat:"repeat"}}),c.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E")`}})]})});Pge.displayName="NebulaBackground";const cWe=V.memo(({className:t=""})=>c.jsx("div",{className:`fixed inset-0 z-0 pointer-events-none ${t}`,"aria-hidden":"true",children:c.jsx("div",{className:"absolute inset-0",style:{background:`
            radial-gradient(ellipse at 15% 20%, rgba(168, 85, 247, 0.1) 0%, transparent 50%),
            radial-gradient(ellipse at 85% 75%, rgba(236, 72, 153, 0.07) 0%, transparent 50%),
            radial-gradient(ellipse at 50% 50%, rgba(34, 211, 238, 0.05) 0%, transparent 70%)
          `}})}));cWe.displayName="NebulaBackgroundLite";const lWe=V.memo(({className:t=""})=>c.jsxs("div",{className:`fixed inset-0 z-0 pointer-events-none overflow-hidden ${t}`,"aria-hidden":"true",children:[c.jsx("div",{className:"absolute inset-0",style:{background:"linear-gradient(135deg, #050505 0%, #0a0a0a 50%, #050505 100%)"}}),c.jsx(Ne.div,{className:"absolute top-1/4 right-1/4",style:{width:"24rem",height:"24rem",background:"rgba(34, 211, 238, 0.08)",filter:"blur(150px)",borderRadius:"50%"},animate:{x:[0,-30,20,0],y:[0,20,-30,0],scale:[1,1.1,.9,1]},transition:{duration:20,repeat:1/0,ease:"easeInOut"}}),c.jsx(Ne.div,{className:"absolute bottom-1/3 left-1/4",style:{width:"20rem",height:"20rem",background:"rgba(168, 85, 247, 0.06)",filter:"blur(120px)",borderRadius:"50%"},animate:{x:[0,40,-10,0],y:[0,-10,40,0],scale:[1,.95,1.05,1]},transition:{duration:25,repeat:1/0,ease:"easeInOut"}})]}));lWe.displayName="NebulaRoomBackground";const OB=3;class dWe extends V.Component{constructor(){super(...arguments);Qc(this,"state",{hasError:!1,error:null,errorInfo:null,retryCount:0});Qc(this,"handleRetry",()=>{const{retryCount:r}=this.state;r<OB&&this.setState({hasError:!1,error:null,errorInfo:null,retryCount:r+1})});Qc(this,"handleGoHome",()=>{this.setState({hasError:!1,error:null,errorInfo:null,retryCount:0}),window.location.href="/"});Qc(this,"handleReload",()=>{window.location.reload()})}static getDerivedStateFromError(r){return{hasError:!0,error:r}}componentDidCatch(r,a){var l,u;this.setState({errorInfo:a}),console.error(" GlobalErrorBoundary caught error:",r),console.error("Component Stack:",a.componentStack),(u=(l=this.props).onError)==null||u.call(l,r,a)}render(){const{hasError:r,error:a,retryCount:l}=this.state,{children:u,fallback:p}=this.props;return r?p||c.jsxs("div",{className:"fixed inset-0 bg-[#050505] flex items-center justify-center p-6 safe-top safe-bottom",children:[c.jsx("div",{className:"absolute inset-0 overflow-hidden",children:c.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_center,rgba(239,68,68,0.1)_0%,transparent_70%)]"})}),c.jsxs(Ne.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"relative w-full max-w-md",children:[c.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-3xl border border-white/10 p-8 text-center",children:[c.jsx(Ne.div,{animate:{rotate:[0,-10,10,-10,0]},transition:{duration:.5,repeat:2},className:"w-20 h-20 mx-auto mb-6 rounded-full bg-red-500/20 flex items-center justify-center",children:c.jsx(rh,{size:40,className:"text-red-400"})}),c.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Oops! Etwas ist schiefgelaufen"}),c.jsx("p",{className:"text-white/60 mb-6",children:"Ein unerwarteter Fehler ist aufgetreten. Keine Sorge, deine Daten sind sicher."}),!1,l>0&&c.jsxs("p",{className:"text-amber-400/80 text-sm mb-4",children:["Versuch ",l," von ",OB]}),c.jsxs("div",{className:"space-y-3",children:[l<OB?c.jsxs(Ne.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:this.handleRetry,className:"w-full p-4 rounded-2xl bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-semibold flex items-center justify-center gap-2",children:[c.jsx(_v,{size:20}),"Nochmal versuchen"]}):c.jsxs(Ne.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:this.handleReload,className:"w-full p-4 rounded-2xl bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-semibold flex items-center justify-center gap-2",children:[c.jsx(_v,{size:20}),"Seite neu laden"]}),c.jsxs(Ne.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:this.handleGoHome,className:"w-full p-4 rounded-2xl bg-white/10 text-white/80 font-semibold flex items-center justify-center gap-2",children:[c.jsx(wW,{size:20}),"Zurck zur Startseite"]})]})]}),c.jsxs("div",{className:"mt-8 text-center",children:[c.jsx("span",{className:"text-4xl",children:""}),c.jsx("p",{className:"text-white/30 text-xs mt-2",children:"synclulu v23.0"})]})]})]}):u}}const uWe=V.createContext(void 0),LB="synclulu-theme",Rae=()=>typeof window>"u"?"light":window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",hWe=t=>{const e=document.querySelector('meta[name="theme-color"]'),r=t?"#0b0b0b":"#ffffff";if(e)e.setAttribute("content",r);else{const u=document.createElement("meta");u.name="theme-color",u.content=r,document.head.appendChild(u)}const a=document.querySelector('meta[name="apple-mobile-web-app-status-bar-style"]'),l=t?"black-translucent":"default";if(a)a.setAttribute("content",l);else{const u=document.createElement("meta");u.name="apple-mobile-web-app-status-bar-style",u.content=l,document.head.appendChild(u)}},jB=({children:t})=>{const[e,r]=V.useState(()=>typeof window>"u"?"system":localStorage.getItem(LB)||"system"),[a,l]=V.useState(()=>{if(typeof window>"u")return"light";const w=localStorage.getItem(LB);return w&&w!=="system"?w:Rae()}),u=V.useCallback(w=>{const R=document.documentElement;w==="dark"?(R.classList.add("dark"),R.classList.remove("light"),R.setAttribute("data-theme","dark")):(R.classList.add("light"),R.classList.remove("dark"),R.setAttribute("data-theme","light")),hWe(w==="dark")},[]),p=V.useCallback(w=>{r(w),localStorage.setItem(LB,w);const R=w==="system"?Rae():w;l(R),u(R)},[u]),m=V.useCallback(()=>{p(a==="dark"?"light":"dark")},[a,p]);V.useEffect(()=>{const w=window.matchMedia("(prefers-color-scheme: dark)"),R=C=>{if(e==="system"){const A=C.matches?"dark":"light";l(A),u(A)}};return w.addEventListener("change",R),u(a),()=>{w.removeEventListener("change",R)}},[e,a,u]),V.useEffect(()=>{u(a)},[]);const v={theme:e,resolvedTheme:a,setTheme:p,toggleTheme:m,isDark:a==="dark"};return c.jsx(uWe.Provider,{value:v,children:t})},pWe=()=>{const{showXPToast:t,xpToastAmount:e,xpToastReason:r,hideXPToast:a}=Jr(),{playXPSound:l}=mpe();return V.useEffect(()=>{if(t){l();const u=setTimeout(()=>{a()},3e3);return()=>clearTimeout(u)}},[t,a,l]),t?c.jsx("div",{className:"fixed top-4 right-4 z-50 animate-bounce",children:c.jsxs("div",{className:"bg-gradient-to-r from-amber-500 to-orange-500 text-white px-4 py-3 rounded-xl shadow-lg flex items-center gap-3",children:[c.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-full flex items-center justify-center",children:c.jsx(Vs,{size:20,className:"text-white"})}),c.jsxs("div",{children:[c.jsxs("p",{className:"font-bold text-lg",children:["+",e," XP"]}),c.jsx("p",{className:"text-xs opacity-90",children:r})]})]})}):null};function fWe(){const{isAuthenticated:t,isLoading:e}=qv(),{user:r}=Jr(),{isLoading:a}=gpe(),[l,u]=V.useState(!1),[p,m]=V.useState(!1),[v,w]=V.useState(!1),R=dp();return V.useEffect(()=>{const A=setTimeout(()=>{w(!0)},5e3);return()=>clearTimeout(A)},[]),V.useEffect(()=>{(async()=>{if(r!=null&&r.id)try{const U=(await Bn(tt(De,"users",r.id))).data(),F=(U==null?void 0:U.isAdmin)===!0||(U==null?void 0:U.role)==="founder"||(U==null?void 0:U.role)==="admin";u(F)}catch{u(!1)}m(!0)})()},[r==null?void 0:r.id]),(e||a||!p)&&!v?c.jsx(iWe,{}):(R.pathname.startsWith("/admin"),R.pathname,["/impressum","/datenschutz"].includes(R.pathname),t?(r==null?void 0:r.onboardingCompleted)===!0?c.jsx(dWe,{children:c.jsx(jB,{children:c.jsx(aWe,{children:c.jsxs("div",{className:"min-h-screen min-h-[100dvh] bg-[var(--synclulu-bg)] pb-24 theme-transition relative",children:[c.jsx(Pge,{intensity:.6}),c.jsx(oWe,{}),c.jsx(pWe,{}),c.jsxs(IF,{children:[c.jsx(Fn,{path:"/",element:c.jsx(tBe,{})}),c.jsx(Fn,{path:"/discover",element:c.jsx(ZBe,{})}),c.jsx(Fn,{path:"/messages",element:c.jsx(F6e,{})}),c.jsx(Fn,{path:"/profile",element:c.jsx(hze,{})}),c.jsx(Fn,{path:"/profile/full",element:c.jsx(aze,{})}),c.jsx(Fn,{path:"/profile/trust-stats",element:c.jsx(qGe,{})}),c.jsx(Fn,{path:"/voice-stats",element:c.jsx(nWe,{})}),c.jsx(Fn,{path:"/friends",element:c.jsx(XGe,{})}),c.jsx(Fn,{path:"/statistics",element:c.jsx(pze,{})}),c.jsx(Fn,{path:"/notifications",element:c.jsx(fze,{})}),c.jsx(Fn,{path:"/premium",element:c.jsx(mze,{})}),c.jsx(Fn,{path:"/settings",element:c.jsx(Nze,{})}),c.jsx(Fn,{path:"/settings/legacy",element:c.jsx(iae,{})}),c.jsx(Fn,{path:"/settings/security",element:c.jsx(iae,{})}),c.jsx(Fn,{path:"/settings/blocked",element:c.jsx(hae,{})}),c.jsx(Fn,{path:"/settings/devices",element:c.jsx(GGe,{})}),c.jsx(Fn,{path:"/help",element:c.jsx(Aze,{})}),c.jsx(Fn,{path:"/invites",element:c.jsx(_ae,{})}),c.jsx(Fn,{path:"/referral-status",element:c.jsx(_ae,{})}),c.jsx(Fn,{path:"/radar",element:c.jsx(uGe,{})}),c.jsx(Fn,{path:"/stars/apply",element:c.jsx(oae,{})}),c.jsx(Fn,{path:"/stars/dashboard",element:c.jsx(kze,{})}),c.jsx(Fn,{path:"/stars/schedule",element:c.jsx(Oze,{})}),c.jsx(Fn,{path:"/user/:userId",element:c.jsx(jze,{})}),c.jsx(Fn,{path:"/blocked-users",element:c.jsx(hae,{})}),c.jsx(Fn,{path:"/admin",element:c.jsx(lae,{})}),c.jsx(Fn,{path:"/creator",element:c.jsx(uae,{})}),c.jsx(Fn,{path:"/creator/dashboard",element:c.jsx(uae,{})}),c.jsx(Fn,{path:"/creator/new-content",element:c.jsx(Zze,{})}),c.jsx(Fn,{path:"/creator-application",element:c.jsx(oae,{})}),c.jsx(Fn,{path:"/impressum",element:c.jsx(z2,{})}),c.jsx(Fn,{path:"/datenschutz",element:c.jsx(wB,{})}),c.jsx(Fn,{path:"/legal",element:c.jsx(z2,{})}),c.jsx(Fn,{path:"/onboarding",element:c.jsx(T2,{to:"/",replace:!0})}),c.jsx(Fn,{path:"*",element:c.jsx(T2,{to:"/",replace:!0})})]}),c.jsx(rWe,{})]})})})}):c.jsx(jB,{children:c.jsxs(IF,{children:[c.jsx(Fn,{path:"/onboarding",element:c.jsx(tUe,{})}),c.jsx(Fn,{path:"/impressum",element:c.jsx(z2,{})}),c.jsx(Fn,{path:"/datenschutz",element:c.jsx(wB,{})}),c.jsx(Fn,{path:"*",element:c.jsx(T2,{to:"/onboarding",replace:!0})})]})}):c.jsx(jB,{children:c.jsxs(IF,{children:[c.jsx(Fn,{path:"/",element:c.jsx(Z5e,{})}),c.jsx(Fn,{path:"/login",element:c.jsx(eUe,{})}),c.jsx(Fn,{path:"/register",element:c.jsx(Sae,{})}),c.jsx(Fn,{path:"/signup",element:c.jsx(Sae,{})}),c.jsx(Fn,{path:"/register-legacy",element:c.jsx(wae,{})}),c.jsx(Fn,{path:"/join/:code",element:c.jsx(bae,{})}),c.jsx(Fn,{path:"/join",element:c.jsx(bae,{})}),c.jsx(Fn,{path:"/invite/:code",element:c.jsx(wae,{})}),c.jsx(Fn,{path:"/reset-password",element:c.jsx(e8e,{})}),c.jsx(Fn,{path:"/impressum",element:c.jsx(z2,{})}),c.jsx(Fn,{path:"/datenschutz",element:c.jsx(wB,{})}),c.jsx(Fn,{path:"/admin",element:c.jsx(lae,{})}),c.jsx(Fn,{path:"*",element:c.jsx(T2,{to:"/",replace:!0})})]})}))}MB.createRoot(document.getElementById("root")).render(c.jsx(Yb.StrictMode,{children:c.jsx(oIe,{children:c.jsx(fWe,{})})}));VN(async()=>{const{initializeCopyProtection:t}=await import("./copyProtection-CsCcj71o.js");return{initializeCopyProtection:t}},[]).then(({initializeCopyProtection:t})=>{setTimeout(()=>{try{t()}catch(e){console.warn("Protection init failed:",e)}},1e3)}).catch(()=>{});export{TWe as A,Kke as B,lG as C,jWe as D,zv as E,x_ as F,b_ as G,LWe as H,q1e as I,Km as J,IWe as K,Ine as L,Ske as M,Wle as N,oD as O,hke as P,FL as Q,PWe as R,w_ as T,_W as W,VN as _,vWe as a,X1e as b,$N as c,Lne as d,$ke as e,wWe as f,OPe as g,Gd as h,xWe as i,kWe as j,$1e as k,OWe as l,EWe as m,AWe as n,gWe as o,yWe as p,Mle as q,s1e as r,SWe as s,bWe as t,DWe as u,_We as v,CWe as w,NWe as x,RWe as y,T1e as z};
