import{W as N,g as s,a as S,c as C,b as O,d as f,f as y,e as v,O as a,i as U,E as g,F as d,G as h,h as R,R as p,l as _,T as I,j as k,k as P,s as T,m as W,n as A,o as m,p as G,q as L,t as D,u as V,v as M,w as H,x as F,y as B,z as x,A as w,B as $,C as j,D as Y,H as K,I as q,J,K as z,L as Q,M as X,N as Z,P as b,Q as ee}from"./index-CHVWbcH8.js";import{ProviderId as c,Persistence as E}from"./index-PdgDa5v1.js";class i extends N{constructor(){super(),this.lastConfirmationResult=new Map;const e=s();e.onAuthStateChanged(t=>this.handleAuthStateChange(t)),e.onIdTokenChanged(t=>void this.handleIdTokenChange(t))}async applyActionCode(e){const t=s();return S(t,e.oobCode)}async createUserWithEmailAndPassword(e){const t=s(),n=await C(t,e.email,e.password);return this.createSignInResult(n,null)}async confirmPasswordReset(e){const t=s();return O(t,e.oobCode,e.newPassword)}async confirmVerificationCode(e){const{verificationCode:t,verificationId:n}=e,r=this.lastConfirmationResult.get(n);if(!r)throw new Error(i.ERROR_CONFIRMATION_RESULT_MISSING);const o=await r.confirm(t);return this.createSignInResult(o,null)}async deleteUser(){const t=s().currentUser;if(!t)throw new Error(i.ERROR_NO_USER_SIGNED_IN);return f(t)}async fetchSignInMethodsForEmail(e){const t=s();return{signInMethods:await y(t,e.email)}}async getPendingAuthResult(){throw this.unimplemented("Not implemented on web.")}async getCurrentUser(){const e=s();return{user:this.createUserResult(e.currentUser)}}async getIdToken(e){const t=s();if(!t.currentUser)throw new Error(i.ERROR_NO_USER_SIGNED_IN);return{token:await t.currentUser.getIdToken(e==null?void 0:e.forceRefresh)||""}}async getIdTokenResult(e){const t=s();if(!t.currentUser)throw new Error(i.ERROR_NO_USER_SIGNED_IN);const n=await t.currentUser.getIdTokenResult(e==null?void 0:e.forceRefresh);return Object.assign(Object.assign({},n),{authTime:Date.parse(n.authTime),expirationTime:Date.parse(n.expirationTime),issuedAtTime:Date.parse(n.issuedAtTime)})}async getRedirectResult(){const e=s(),t=await v(e),n=t?a.credentialFromResult(t):null;return this.createSignInResult(t,n)}async getTenantId(){return{tenantId:s().tenantId}}async isSignInWithEmailLink(e){const t=s();return{isSignInWithEmailLink:U(t,e.emailLink)}}async linkWithApple(e){const t=new a(c.APPLE);this.applySignInOptions(e||{},t);const n=await this.linkCurrentUserWithPopupOrRedirect(t,e==null?void 0:e.mode),r=a.credentialFromResult(n);return this.createSignInResult(n,r)}async linkWithEmailAndPassword(e){const t=g.credential(e.email,e.password),n=await this.linkCurrentUserWithCredential(t);return this.createSignInResult(n,t)}async linkWithEmailLink(e){const t=g.credentialWithLink(e.email,e.emailLink),n=await this.linkCurrentUserWithCredential(t);return this.createSignInResult(n,t)}async linkWithFacebook(e){const t=new d;this.applySignInOptions(e||{},t);const n=await this.linkCurrentUserWithPopupOrRedirect(t,e==null?void 0:e.mode),r=d.credentialFromResult(n);return this.createSignInResult(n,r)}async linkWithGameCenter(){throw this.unimplemented("Not implemented on web.")}async linkWithGithub(e){const t=new h;this.applySignInOptions(e||{},t);const n=await this.linkCurrentUserWithPopupOrRedirect(t,e==null?void 0:e.mode),r=h.credentialFromResult(n);return this.createSignInResult(n,r)}async linkWithGoogle(e){const t=new R;this.applySignInOptions(e||{},t);const n=await this.linkCurrentUserWithPopupOrRedirect(t,e==null?void 0:e.mode),r=R.credentialFromResult(n);return this.createSignInResult(n,r)}async linkWithMicrosoft(e){const t=new a(c.MICROSOFT);this.applySignInOptions(e||{},t);const n=await this.linkCurrentUserWithPopupOrRedirect(t,e==null?void 0:e.mode),r=a.credentialFromResult(n);return this.createSignInResult(n,r)}async linkWithOpenIdConnect(e){const t=new a(e.providerId);this.applySignInOptions(e,t);const n=await this.linkCurrentUserWithPopupOrRedirect(t,e.mode),r=a.credentialFromResult(n);return this.createSignInResult(n,r)}async linkWithPhoneNumber(e){const n=s().currentUser;if(!n)throw new Error(i.ERROR_NO_USER_SIGNED_IN);if(!e.phoneNumber)throw new Error(i.ERROR_PHONE_NUMBER_MISSING);if(!e.recaptchaVerifier||!(e.recaptchaVerifier instanceof p))throw new Error(i.ERROR_RECAPTCHA_VERIFIER_MISSING);try{const r=await _(n,e.phoneNumber,e.recaptchaVerifier),{verificationId:o}=r;this.lastConfirmationResult.set(o,r);const u={verificationId:o};this.notifyListeners(i.PHONE_CODE_SENT_EVENT,u)}catch(r){const o={message:this.getErrorMessage(r)};this.notifyListeners(i.PHONE_VERIFICATION_FAILED_EVENT,o)}}async linkWithPlayGames(){throw this.unimplemented("Not implemented on web.")}async linkWithTwitter(e){const t=new I;this.applySignInOptions(e||{},t);const n=await this.linkCurrentUserWithPopupOrRedirect(t,e==null?void 0:e.mode),r=I.credentialFromResult(n);return this.createSignInResult(n,r)}async linkWithYahoo(e){const t=new a(c.YAHOO);this.applySignInOptions(e||{},t);const n=await this.linkCurrentUserWithPopupOrRedirect(t,e==null?void 0:e.mode),r=a.credentialFromResult(n);return this.createSignInResult(n,r)}async reload(){const t=s().currentUser;if(!t)throw new Error(i.ERROR_NO_USER_SIGNED_IN);return k(t)}async revokeAccessToken(e){const t=s();return P(t,e.token)}async sendEmailVerification(e){const n=s().currentUser;if(!n)throw new Error(i.ERROR_NO_USER_SIGNED_IN);return T(n,e==null?void 0:e.actionCodeSettings)}async sendPasswordResetEmail(e){const t=s();return W(t,e.email,e.actionCodeSettings)}async sendSignInLinkToEmail(e){const t=s();return A(t,e.email,e.actionCodeSettings)}async setLanguageCode(e){const t=s();t.languageCode=e.languageCode}async setPersistence(e){const t=s();switch(e.persistence){case E.BrowserLocal:await m(t,ee);break;case E.BrowserSession:await m(t,b);break;case E.IndexedDbLocal:await m(t,Z);break;case E.InMemory:await m(t,X);break}}async setTenantId(e){const t=s();t.tenantId=e.tenantId}async signInAnonymously(){const e=s(),t=await G(e);return this.createSignInResult(t,null)}async signInWithApple(e){const t=new a(c.APPLE);this.applySignInOptions(e||{},t);const n=await this.signInWithPopupOrRedirect(t,e==null?void 0:e.mode),r=a.credentialFromResult(n);return this.createSignInResult(n,r)}async signInWithCustomToken(e){const t=s(),n=await L(t,e.token);return this.createSignInResult(n,null)}async signInWithEmailAndPassword(e){const t=s(),n=await D(t,e.email,e.password);return this.createSignInResult(n,null)}async signInWithEmailLink(e){const t=s(),n=await V(t,e.email,e.emailLink);return this.createSignInResult(n,null)}async signInWithFacebook(e){const t=new d;this.applySignInOptions(e||{},t);const n=await this.signInWithPopupOrRedirect(t,e==null?void 0:e.mode),r=d.credentialFromResult(n);return this.createSignInResult(n,r)}async signInWithGithub(e){const t=new h;this.applySignInOptions(e||{},t);const n=await this.signInWithPopupOrRedirect(t,e==null?void 0:e.mode),r=h.credentialFromResult(n);return this.createSignInResult(n,r)}async signInWithGoogle(e){const t=new R;this.applySignInOptions(e||{},t);const n=await this.signInWithPopupOrRedirect(t,e==null?void 0:e.mode),r=R.credentialFromResult(n);return this.createSignInResult(n,r)}async signInWithMicrosoft(e){const t=new a(c.MICROSOFT);this.applySignInOptions(e||{},t);const n=await this.signInWithPopupOrRedirect(t,e==null?void 0:e.mode),r=a.credentialFromResult(n);return this.createSignInResult(n,r)}async signInWithOpenIdConnect(e){const t=new a(e.providerId);this.applySignInOptions(e,t);const n=await this.signInWithPopupOrRedirect(t,e.mode),r=a.credentialFromResult(n);return this.createSignInResult(n,r)}async signInWithPhoneNumber(e){if(!e.phoneNumber)throw new Error(i.ERROR_PHONE_NUMBER_MISSING);if(!e.recaptchaVerifier||!(e.recaptchaVerifier instanceof p))throw new Error(i.ERROR_RECAPTCHA_VERIFIER_MISSING);const t=s();try{const n=await M(t,e.phoneNumber,e.recaptchaVerifier),{verificationId:r}=n;this.lastConfirmationResult.set(r,n);const o={verificationId:r};this.notifyListeners(i.PHONE_CODE_SENT_EVENT,o)}catch(n){const r={message:this.getErrorMessage(n)};this.notifyListeners(i.PHONE_VERIFICATION_FAILED_EVENT,r)}}async signInWithPlayGames(){throw this.unimplemented("Not implemented on web.")}async signInWithGameCenter(){throw this.unimplemented("Not implemented on web.")}async signInWithTwitter(e){const t=new I;this.applySignInOptions(e||{},t);const n=await this.signInWithPopupOrRedirect(t,e==null?void 0:e.mode),r=I.credentialFromResult(n);return this.createSignInResult(n,r)}async signInWithYahoo(e){const t=new a(c.YAHOO);this.applySignInOptions(e||{},t);const n=await this.signInWithPopupOrRedirect(t,e==null?void 0:e.mode),r=a.credentialFromResult(n);return this.createSignInResult(n,r)}async signOut(){await s().signOut()}async unlink(e){const t=s();if(!t.currentUser)throw new Error(i.ERROR_NO_USER_SIGNED_IN);const n=await H(t.currentUser,e.providerId);return{user:this.createUserResult(n)}}async updateEmail(e){const n=s().currentUser;if(!n)throw new Error(i.ERROR_NO_USER_SIGNED_IN);return F(n,e.newEmail)}async updatePassword(e){const n=s().currentUser;if(!n)throw new Error(i.ERROR_NO_USER_SIGNED_IN);return B(n,e.newPassword)}async updateProfile(e){const n=s().currentUser;if(!n)throw new Error(i.ERROR_NO_USER_SIGNED_IN);return x(n,{displayName:e.displayName,photoURL:e.photoUrl})}async useAppLanguage(){s().useDeviceLanguage()}async useEmulator(e){const t=s(),n=e.port||9099,r=e.scheme||"http";e.host.includes("://")?w(t,`${e.host}:${n}`):w(t,`${r}://${e.host}:${n}`)}async verifyBeforeUpdateEmail(e){const n=s().currentUser;if(!n)throw new Error(i.ERROR_NO_USER_SIGNED_IN);return $(n,e==null?void 0:e.newEmail,e==null?void 0:e.actionCodeSettings)}handleAuthStateChange(e){const n={user:this.createUserResult(e)};this.notifyListeners(i.AUTH_STATE_CHANGE_EVENT,n,!0)}async handleIdTokenChange(e){if(!e)return;const n={token:await e.getIdToken(!1)};this.notifyListeners(i.ID_TOKEN_CHANGE_EVENT,n,!0)}applySignInOptions(e,t){if(e.customParameters){const n={};e.customParameters.map(r=>{n[r.key]=r.value}),t.setCustomParameters(n)}if(e.scopes)for(const n of e.scopes)t.addScope(n)}signInWithPopupOrRedirect(e,t){const n=s();return t==="redirect"?j(n,e):Y(n,e)}linkCurrentUserWithPopupOrRedirect(e,t){const n=s();if(!n.currentUser)throw new Error(i.ERROR_NO_USER_SIGNED_IN);return t==="redirect"?K(n.currentUser,e):q(n.currentUser,e)}linkCurrentUserWithCredential(e){const t=s();if(!t.currentUser)throw new Error(i.ERROR_NO_USER_SIGNED_IN);return J(t.currentUser,e)}requestAppTrackingTransparencyPermission(){throw this.unimplemented("Not implemented on web.")}checkAppTrackingTransparencyPermission(){throw this.unimplemented("Not implemented on web.")}createSignInResult(e,t){const n=this.createUserResult((e==null?void 0:e.user)||null),r=this.createCredentialResult(t),o=this.createAdditionalUserInfoResult(e);return{user:n,credential:r,additionalUserInfo:o}}createCredentialResult(e){if(!e)return null;const t={providerId:e.providerId};return e instanceof z&&(t.accessToken=e.accessToken,t.idToken=e.idToken,t.secret=e.secret),t}createUserResult(e){return e?{displayName:e.displayName,email:e.email,emailVerified:e.emailVerified,isAnonymous:e.isAnonymous,metadata:this.createUserMetadataResult(e.metadata),phoneNumber:e.phoneNumber,photoUrl:e.photoURL,providerData:this.createUserProviderDataResult(e.providerData),providerId:e.providerId,tenantId:e.tenantId,uid:e.uid}:null}createUserMetadataResult(e){const t={};return e.creationTime&&(t.creationTime=Date.parse(e.creationTime)),e.lastSignInTime&&(t.lastSignInTime=Date.parse(e.lastSignInTime)),t}createUserProviderDataResult(e){return e.map(t=>({displayName:t.displayName,email:t.email,phoneNumber:t.phoneNumber,photoUrl:t.photoURL,providerId:t.providerId,uid:t.uid}))}createAdditionalUserInfoResult(e){if(!e)return null;const t=Q(e);if(!t)return null;const{isNewUser:n,profile:r,providerId:o,username:u}=t,l={isNewUser:n};return o!==null&&(l.providerId=o),r!==null&&(l.profile=r),u!=null&&(l.username=u),l}getErrorMessage(e){return e instanceof Object&&"message"in e&&typeof e.message=="string"?e.message:JSON.stringify(e)}}i.AUTH_STATE_CHANGE_EVENT="authStateChange";i.ID_TOKEN_CHANGE_EVENT="idTokenChange";i.PHONE_CODE_SENT_EVENT="phoneCodeSent";i.PHONE_VERIFICATION_FAILED_EVENT="phoneVerificationFailed";i.ERROR_NO_USER_SIGNED_IN="No user is signed in.";i.ERROR_PHONE_NUMBER_MISSING="phoneNumber must be provided.";i.ERROR_RECAPTCHA_VERIFIER_MISSING="recaptchaVerifier must be provided and must be an instance of RecaptchaVerifier.";i.ERROR_CONFIRMATION_RESULT_MISSING="No confirmation result with this verification id was found.";export{i as FirebaseAuthenticationWeb};
